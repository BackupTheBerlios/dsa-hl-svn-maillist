<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3825 - in rl/trunk/engine: ai/include ai/src	common/include common/src core/include core/src rules/include	rules/src script/include script/src ui/include ui/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-September/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3825%20-%20in%20rl/trunk/engine%3A%20ai/include%20ai/src%0A%09common/include%20common/src%20core/include%20core/src%20rules/include%0A%09rules/src%20script/include%20script/src%20ui/include%20ui/src&In-Reply-To=%3C200709082022.l88KMsiq004857%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000895.html">
   <LINK REL="Next"  HREF="000897.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3825 - in rl/trunk/engine: ai/include ai/src	common/include common/src core/include core/src rules/include	rules/src script/include script/src ui/include ui/src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3825%20-%20in%20rl/trunk/engine%3A%20ai/include%20ai/src%0A%09common/include%20common/src%20core/include%20core/src%20rules/include%0A%09rules/src%20script/include%20script/src%20ui/include%20ui/src&In-Reply-To=%3C200709082022.l88KMsiq004857%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3825 - in rl/trunk/engine: ai/include ai/src	common/include common/src core/include core/src rules/include	rules/src script/include script/src ui/include ui/src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Sat Sep  8 22:22:54 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000895.html">[Dsa-hl-svn] r3824 - modules/common/dsa
</A></li>
        <LI>Next message: <A HREF="000897.html">[Dsa-hl-svn] r3826 - in rl/trunk/engine: ai/src script/swig
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#896">[ date ]</a>
              <a href="thread.html#896">[ thread ]</a>
              <a href="subject.html#896">[ subject ]</a>
              <a href="author.html#896">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2007-09-08 22:22:19 +0200 (Sat, 08 Sep 2007)
New Revision: 3825

Modified:
   rl/trunk/engine/ai/include/AgentManager.h
   rl/trunk/engine/ai/include/AiSubsystem.h
   rl/trunk/engine/ai/include/AimlNodeImplRl.h
   rl/trunk/engine/ai/include/WayPointGraph.h
   rl/trunk/engine/ai/src/AiSubsystem.cpp
   rl/trunk/engine/ai/src/AimlNodeImplRl.cpp
   rl/trunk/engine/ai/src/DialogResponse.cpp
   rl/trunk/engine/common/include/Exception.h
   rl/trunk/engine/common/include/PropertyReader.h
   rl/trunk/engine/common/include/PropertyWriter.h
   rl/trunk/engine/common/include/XmlErrorHandler.h
   rl/trunk/engine/common/include/XmlHelper.h
   rl/trunk/engine/common/include/XmlResource.h
   rl/trunk/engine/common/src/PropertyReader.cpp
   rl/trunk/engine/common/src/PropertyWriter.cpp
   rl/trunk/engine/common/src/XmlErrorHandler.cpp
   rl/trunk/engine/common/src/XmlHelper.cpp
   rl/trunk/engine/common/src/XmlResource.cpp
   rl/trunk/engine/common/src/XmlResourceManager.cpp
   rl/trunk/engine/core/include/DotSceneLoader.h
   rl/trunk/engine/core/src/CoreSubsystem.cpp
   rl/trunk/engine/core/src/DotSceneLoader.cpp
   rl/trunk/engine/core/src/DotSceneOctreeWorld.cpp
   rl/trunk/engine/rules/include/DsaDataLoader.h
   rl/trunk/engine/rules/include/SaveGameFileWriter.h
   rl/trunk/engine/rules/src/DsaDataLoader.cpp
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
   rl/trunk/engine/script/include/AbstractMapNodeProcessor.h
   rl/trunk/engine/script/include/MapLoader.h
   rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp
   rl/trunk/engine/script/src/EntityNodeProcessor.cpp
   rl/trunk/engine/script/src/EnvironmentProcessor.cpp
   rl/trunk/engine/script/src/GameObjectNodeProcessor.cpp
   rl/trunk/engine/script/src/LightNodeProcessor.cpp
   rl/trunk/engine/script/src/MapLoader.cpp
   rl/trunk/engine/script/src/ParticleSystemNodeProcessor.cpp
   rl/trunk/engine/script/src/SoundNodeProcessor.cpp
   rl/trunk/engine/script/src/WaypointProcessor.cpp
   rl/trunk/engine/script/src/ZoneProcessor.cpp
   rl/trunk/engine/ui/include/InputManager.h
   rl/trunk/engine/ui/src/InputManager.cpp
Log:
Replace XmlHelper static method usage with implementation inheritance

Modified: rl/trunk/engine/ai/include/AgentManager.h
===================================================================
--- rl/trunk/engine/ai/include/AgentManager.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/include/AgentManager.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -43,7 +43,7 @@
 
 	/** Executes AI during game as a RL::GameTask.
 	 * Each registered Agent gets executed once per gametask in order
-	 * to do its ai stuff (path finding, movement, decission making).
+	 * to do its ai stuff (path finding, movement, decision making).
 	 */
 	class _RlAiExport AgentManager
 		: public Ogre::Singleton&lt;AgentManager&gt;,

Modified: rl/trunk/engine/ai/include/AiSubsystem.h
===================================================================
--- rl/trunk/engine/ai/include/AiSubsystem.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/include/AiSubsystem.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -21,6 +21,7 @@
 #include &quot;AiPrerequisites.h&quot;
 
 #include &quot;MessagePump.h&quot;
+#include &quot;XmlHelper.h&quot;
 #include &quot;World.h&quot;
 
 namespace MadaBot
@@ -43,7 +44,9 @@
 	/** Central core of AI
 	 * Handles creation of all AI related object Managers.
 	 */
-	class _RlAiExport AiSubsystem : public Ogre::Singleton&lt;AiSubsystem&gt;
+	class _RlAiExport AiSubsystem 
+        : public Ogre::Singleton&lt;AiSubsystem&gt;,
+        private XmlProcessor
 	{
 	public:
 		//! default constructor

Modified: rl/trunk/engine/ai/include/AimlNodeImplRl.h
===================================================================
--- rl/trunk/engine/ai/include/AimlNodeImplRl.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/include/AimlNodeImplRl.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -19,6 +19,8 @@
 #include &quot;AiPrerequisites.h&quot;
 #include &quot;AimlNode.h&quot;
 
+#include &quot;XmlHelper.h&quot;
+
 using namespace MadaBot;
 namespace rl
 {
@@ -28,7 +30,9 @@
     /**
      * Implementation of the XmlNode interface for AIML files in Rastullahs Lockenpracht
      */
-	class AimlNodeImplRl :	public AimlNode&lt;CeGuiString&gt;
+	class AimlNodeImplRl 
+        :   public AimlNode&lt;CeGuiString&gt;,
+            private XmlProcessor
 	{
 	public:
 		AimlNodeImplRl(DOMNode* node);

Modified: rl/trunk/engine/ai/include/WayPointGraph.h
===================================================================
--- rl/trunk/engine/ai/include/WayPointGraph.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/include/WayPointGraph.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,11 +17,11 @@
 #define __RlAI_WayPointGraph_H__
 
 #include &quot;AiPrerequisites.h&quot;
+
+#include &quot;DebugVisualisable.h&quot;
 #include &quot;WayPointNode.h&quot;
-#include &quot;DebugVisualisable.h&quot;
-#include &quot;OgreVector3.h&quot;
+#include &quot;XmlHelper.h&quot;
 
-
 namespace rl
 {
 
@@ -32,7 +32,8 @@
 	 */
 	//template &lt;class NodeType&gt;
 	class _RlAiExport WayPointGraph 
-		: public DebugVisualisable
+		: public DebugVisualisable,
+        private XmlProcessor
 	{
 	public:
 		//! defines a list of waypoint nodes
@@ -77,7 +78,8 @@
 		 * configuration module in oder to fetch the module directory path.
 		 * @param filename of the file to load.
 		 */
-		void load (const Ogre::String&amp; filename);
+		void loadBinary(const Ogre::String&amp; filename);
+
 		/** saves the Waypoints to a file.
 		 * Structure of the file is as follows:
 		 * Header\n
@@ -99,8 +101,15 @@
 		 *
 		 * @param filename of the file to save to.
 		 */
-		void save (const Ogre::String&amp; filename) const;
+		void saveBinary(const Ogre::String&amp; filename) const;
 
+        /** loads the Waypoints from an xml file.
+		 * The Load functionality uses the module path querying of the
+		 * configuration module in oder to fetch the module directory path.
+		 * @param filename of the file to load.
+		 */
+		void load(const Ogre::String&amp; filename, const Ogre::String&amp; resourceGroup = &quot;&quot;);
+
 		/** retrieves the nearest WayPoint for the given position
 		 * @param position in world space whose nearest waypoint has to be found.
 		 * @returns WayPointNode pointer to a waypoint object

Modified: rl/trunk/engine/ai/src/AiSubsystem.cpp
===================================================================
--- rl/trunk/engine/ai/src/AiSubsystem.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/src/AiSubsystem.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -111,20 +111,19 @@
 	mCore-&gt;setParser(new AimlParserImplRl());
 	mCore-&gt;getBotInterpreter().addProcessor(new DialogScriptProcessor());
 	mCore-&gt;getAimlInterpreter().addProcessor(new ScriptProcessor());
-//  Initialize Xerces if this wasn't done already
-	try
-	{
-        XMLPlatformUtils::Initialize();
-		XmlHelper::initializeTranscoder();
-    }
-    catch (const XMLException&amp; exc)
-	{
-		char* excmsg = XMLString::transcode(exc.getMessage());
-		std::string excs=&quot;Exception while initializing Xerces: &quot;;
-		excs+=excmsg;
-		LOG_MESSAGE(Logger::DIALOG, excs);
-        XMLString::release(&amp;excmsg);
-    }
+////  Initialize Xerces if this wasn't done already
+//	try
+//	{
+//        
+//    }
+//    catch (const XMLException&amp; exc)
+//	{
+//		char* excmsg = XMLString::transcode(exc.getMessage());
+//		std::string excs=&quot;Exception while initializing Xerces: &quot;;
+//		excs+=excmsg;
+//		LOG_MESSAGE(Logger::DIALOG, excs);
+//        XMLString::release(&amp;excmsg);
+//    }
 }
 
 bool AiSubsystem::onBeforeClearScene()

Modified: rl/trunk/engine/ai/src/AimlNodeImplRl.cpp
===================================================================
--- rl/trunk/engine/ai/src/AimlNodeImplRl.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/src/AimlNodeImplRl.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -27,11 +27,11 @@
 
 AimlNodeImplRl::AimlNodeImplRl(DOMNode* pNode)
 {
-	mNodeName  = XmlHelper::transcodeToString(pNode-&gt;getLocalName());
+	mNodeName  = transcodeToString(pNode-&gt;getLocalName());
 	// #text or #comment have no local name, use NodeName for them
 	if(mNodeName.empty())
 	{
-		mNodeName  = XmlHelper::transcodeToString(pNode-&gt;getNodeName());
+		mNodeName  = transcodeToString(pNode-&gt;getNodeName());
 	}
 	mNodeName.c_str();
 
@@ -40,12 +40,12 @@
 	{
 		XMLCh* tmp = XMLString::replicate(pNode-&gt;getNodeValue());
 		XMLString::collapseWS(tmp);
-		mNodeValue = XmlHelper::transcodeToString(tmp);
+		mNodeValue = transcodeToString(tmp);
 		XMLString::release(&amp;tmp);
 	}
 	else
 	{
-		mNodeValue = XmlHelper::transcodeToString(pNode-&gt;getNodeValue());
+		mNodeValue = transcodeToString(pNode-&gt;getNodeValue());
 	}
 	mNodeValue.c_str();
 	// mpa attributes
@@ -55,9 +55,9 @@
 		for(unsigned int i = 0; i &lt; attributes-&gt;getLength(); ++i)
 		{
 			CeGuiString attributeName  =
-				XmlHelper::transcodeToString(attributes-&gt;item(i)-&gt;getNodeName());
+				transcodeToString(attributes-&gt;item(i)-&gt;getNodeName());
 			CeGuiString attributeValue =
-				XmlHelper::transcodeToString(attributes-&gt;item(i)-&gt;getNodeValue());
+				transcodeToString(attributes-&gt;item(i)-&gt;getNodeValue());
 			mAttributes.insert(Attributes::value_type(attributeName, attributeValue));
 		}
 	}

Modified: rl/trunk/engine/ai/src/DialogResponse.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogResponse.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/src/DialogResponse.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -15,19 +15,9 @@
  */
 #include &quot;stdinc.h&quot; //precompiled header
 
-#include &lt;xercesc/parsers/XercesDOMParser.hpp&gt;
-#include &lt;xercesc/framework/MemBufInputSource.hpp&gt;
-#include &lt;xercesc/dom/DOM.hpp&gt;
-
-#include &lt;CEGUIPropertyHelper.h&gt;
-
-#include &quot;XmlHelper.h&quot;
-//#include &quot;AimlProcessorManager.h&quot;
-//#include &quot;AimlProcessor.h&quot;
 #include &quot;DialogResponse.h&quot;
 #include &quot;DialogOption.h&quot;
 
-
 namespace rl
 {
 	DialogResponse::DialogResponse( const CeGuiString&amp; input,

Modified: rl/trunk/engine/common/include/Exception.h
===================================================================
--- rl/trunk/engine/common/include/Exception.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/Exception.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -108,14 +108,17 @@
 
    public:
       Exception(const std::string&amp; message,
-         const std::string&amp; file, const std::string&amp; function, int line) :
-      mMessage(message), mFile(file), mFunction(function), mLine(line) {}
+         const std::string&amp; file, const std::string&amp; function, int line)
+         : mMessage(message), mFile(file), mFunction(function), mLine(line), 
+         std::exception(message.c_str()) {}
       
-      Exception(const Exception&amp; rhs) :
+      Exception(const Exception&amp; rhs) 
+          :
          mMessage(rhs.mMessage),
          mFile(rhs.mFile),
          mFunction(rhs.mFunction),
-         mLine(rhs.mLine) {}
+         mLine(rhs.mLine),
+         std::exception(rhs.mMessage.c_str()) {}
 
       virtual ~Exception() throw() {}
 

Modified: rl/trunk/engine/common/include/PropertyReader.h
===================================================================
--- rl/trunk/engine/common/include/PropertyReader.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/PropertyReader.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -23,6 +23,8 @@
 #include &lt;xercesc/dom/DOMElement.hpp&gt;
 #include &lt;OgreDataStream.h&gt;
 
+#include &quot;XmlHelper.h&quot;
+
 namespace rl 
 {
     class Property;
@@ -31,6 +33,7 @@
     typedef std::pair&lt;Ogre::String, Property&gt; PropertyEntry;
 
     class _RlCommonExport XmlPropertyReader
+         : protected XmlProcessor
     {
     public:
         XmlPropertyReader();

Modified: rl/trunk/engine/common/include/PropertyWriter.h
===================================================================
--- rl/trunk/engine/common/include/PropertyWriter.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/PropertyWriter.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -25,6 +25,7 @@
 #include &lt;OgreDataStream.h&gt;
 
 #include &quot;Property.h&quot;
+#include &quot;XmlHelper.h&quot;
 
 namespace rl 
 {
@@ -34,9 +35,11 @@
     typedef std::pair&lt;Ogre::String, Property&gt; PropertyEntry;
 
     class _RlCommonExport XmlPropertyWriter
+        : protected XmlProcessor
     {
     public:
         XmlPropertyWriter();
+        virtual ~XmlPropertyWriter();
 
         std::vector&lt;PropertySet*&gt; getPropertySets();
         void setPropertySets(std::vector&lt;PropertySet*&gt; sets);

Modified: rl/trunk/engine/common/include/XmlErrorHandler.h
===================================================================
--- rl/trunk/engine/common/include/XmlErrorHandler.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/XmlErrorHandler.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -18,12 +18,15 @@
 #include &lt;string&gt;
 #include &lt;xercesc/sax/ErrorHandler.hpp&gt;
 #include &quot;CommonPrerequisites.h&quot;
+#include &quot;XmlHelper.h&quot;
 
-class XERCES_CPP_NAMESPACE::SAXParseException;
 
+
 namespace rl
 {
-    class _RlCommonExport XmlErrorHandler : public XERCES_CPP_NAMESPACE::ErrorHandler
+    /*class _RlCommonExport XmlErrorHandler 
+        :   public XERCES_CPP_NAMESPACE::ErrorHandler,
+            private XmlProcessor
     {
     public:
         XmlErrorHandler(void);
@@ -40,6 +43,6 @@
                               const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc ) const;
         
         std::string mFileName;
-    };
+    };*/
 }
 #endif

Modified: rl/trunk/engine/common/include/XmlHelper.h
===================================================================
--- rl/trunk/engine/common/include/XmlHelper.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/XmlHelper.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,13 +17,17 @@
 #ifndef __XmlHelper_h__
 #define __XmlHelper_h__
 
+#include &lt;OgreDataStream.h&gt;
+
 #include &lt;xercesc/dom/DOMElement.hpp&gt;
 #include &lt;xercesc/util/XMLChar.hpp&gt;
 #include &lt;xercesc/util/TransService.hpp&gt;
+#include &lt;xercesc/sax/ErrorHandler.hpp&gt;
 #include &lt;xercesc/sax2/Attributes.hpp&gt;
 
+class XERCES_CPP_NAMESPACE::SAXParseException;
+
 #include &quot;CommonPrerequisites.h&quot;
-#include &quot;XmlErrorHandler.h&quot;
 
 #include &quot;Tripel.h&quot;
 
@@ -45,12 +49,12 @@
 
 namespace rl {
 
-    class XmlErrorHandler;
 /**
- * Diese Klasse bietet Helferfunktionen, um XML einfacher verarbeiten zu k&#246;nnen
- * Alle Methoden sind statisch, es muss also keine Instanz dieser Klasse gebildet werden
+ * This class offers helper methods for XML processing
+ * To use this method, just privately inherit this class 
  */
-class _RlCommonExport XmlHelper
+class _RlCommonExport XmlProcessor
+    : public XERCES_CPP_NAMESPACE::ErrorHandler
 {
 public:
     
@@ -64,8 +68,8 @@
 	 *
 	 * @return Der Kindknoten
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* appendChildElement(XERCES_CPP_NAMESPACE::DOMDocument* doc, 
-        XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name);
+    XERCES_CPP_NAMESPACE::DOMElement* appendChildElement(XERCES_CPP_NAMESPACE::DOMDocument* doc, 
+        XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name) const;
 
     /**
 	 * Ermittelt einen Kindknoten eines DOM-Elements, das einen bestimmten Namen hat, 
@@ -76,7 +80,7 @@
 	 *
 	 * @return Der Kindknoten
 	 */
-	static XERCES_CPP_NAMESPACE::DOMElement* getChildNamed(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name);
+	XERCES_CPP_NAMESPACE::DOMElement* getChildNamed(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name) const;
 	
     /**
 	 * Setzt den Text eines Elementknotens
@@ -85,7 +89,7 @@
      * @param string Der zu setzende String
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsString(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, const CeGuiString &amp;value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsString(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, const CeGuiString &amp;value) const;
     
     /**
 	 * Ermittelt den Text eines Elementknotens
@@ -93,7 +97,7 @@
 	 * @param element Das DOM-Element
 	 * @return Text innerhalb der Element-Tags, als CeGuiString
 	 */
-	static CeGuiString getValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element);
+	CeGuiString getValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 	
     /**
 	 * Ermittelt den Text eines Elementknotens
@@ -101,7 +105,7 @@
 	 * @param element Das DOM-Element
 	 * @return Text innerhalb der Element-Tags, als CeGuiString
 	 */
-    static std::string getValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element);
+    std::string getValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
 	 * Setzt den Text eines Elementknotens, als UTF-8
@@ -111,7 +115,7 @@
      * @param utf Der zu setzende UTF String
 	 * @return Das DOM-Element
 	 */
-	static XERCES_CPP_NAMESPACE::DOMElement* setValueAsUtf8(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, utf8* value);
+	XERCES_CPP_NAMESPACE::DOMElement* setValueAsUtf8(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, utf8* value) const;
     
     /**
 	 * Ermittelt den Text eines Elementknotens, als UTF-8
@@ -121,7 +125,7 @@
 	 * @return Text innerhalb der Element-Tags, als utf8* (muss selbst gel&#246;scht werden)
 	 * @see initializeTranscoder()
 	 */
-	static utf8* getValueAsUtf8(XERCES_CPP_NAMESPACE::DOMElement* element);
+	utf8* getValueAsUtf8(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
 	/**
 	 * Formt eine Ganzzahl in einen String um und setzt diesen als Wert
@@ -130,7 +134,7 @@
      * @param value Der zu setzende Integer
 	 * @return Das DOM-Element
 	 */
-	static XERCES_CPP_NAMESPACE::DOMElement* setValueAsInteger(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, int value);
+	XERCES_CPP_NAMESPACE::DOMElement* setValueAsInteger(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, int value) const;
 
     
     /**
@@ -140,7 +144,7 @@
 	 * @param element Das DOM-Element
 	 * @return Zahl, die innerhalb der Element-Tags steht
 	 */
-	static int getValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element);
+	int getValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
 	 * Ermittelt den Text eines Elementknotens und parst ihn, 
@@ -149,7 +153,7 @@
 	 * @param element Das DOM-Element
 	 * @return Zahl, die innerhalb der Element-Tags steht
 	 */
-    static Ogre::Real getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element);
+    Ogre::Real getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
 	 * Formt einen Ganzzahldubel in einen String um und setzt diesen als Wert
@@ -158,7 +162,7 @@
      * @param value Das zu setzende IntegerPair
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, IntPair value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, IntPair value) const;
 
     /**
 	 * Ermittelt den Text eines Elementknotens und parst ihn, 
@@ -167,7 +171,7 @@
 	 * @param element Das DOM-Element
 	 * @return Zahl, die innerhalb der Element-Tags steht
 	 */
-    static IntPair getValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element);
+    IntPair getValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
 	 * Formt einen Ganzzahltripel in einen String um und setzt diesen als Wert
@@ -176,7 +180,7 @@
      * @param value Der zu setzende Tripel&lt;int&gt;
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, Tripel&lt;int&gt; value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, Tripel&lt;int&gt; value) const;
 
     /**
 	 * Ermittelt den Text eines Elementknotens und parst ihn, 
@@ -185,7 +189,7 @@
 	 * @param element Das DOM-Element
 	 * @return Zahl, die innerhalb der Element-Tags steht
 	 */
-    static Tripel&lt;int&gt; getValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element);
+    Tripel&lt;int&gt; getValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 	
     /**
      * Convert a vector3 to an xml tag
@@ -194,7 +198,7 @@
      * @param value The vector input
 	 * @return The DOM element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Vector3 value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Vector3 value) const;
 
     /**
 	 * Processes an element node of shape &lt;any_node_name x=&quot;0&quot; y=&quot;0&quot; z=&quot;0&quot;/&gt;
@@ -203,7 +207,7 @@
 	 * @param element The DOM element
 	 * @return the vector
 	 */
-	static Ogre::Vector3 getValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element);
+	Ogre::Vector3 getValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
      * Convert a quaternion to an xml tag
@@ -212,7 +216,7 @@
      * @param value The quaternion input
 	 * @return The DOM element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Quaternion value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Quaternion value) const;
 
     /**
 	 * Processes an element node of shape &lt;any_node_name x=&quot;0&quot; y=&quot;0&quot; z=&quot;0&quot; w=&quot;1&quot;/&gt;
@@ -221,7 +225,7 @@
 	 * @param element The DOM element
 	 * @return the quaternion
 	 */
-    static Ogre::Quaternion getValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element);
+    Ogre::Quaternion getValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
 	
     /**
@@ -231,7 +235,7 @@
 	 * @param name Name des Attributes
 	 * @return &lt;code&gt;true&lt;/code&gt;, wenn das Attribut an diesem Element existiert, sonst &lt;code&gt;false&lt;/code&gt;
 	 */
-	static bool hasAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	bool hasAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Setzt den Wert von einem Attribut eines Elementes
@@ -241,7 +245,7 @@
      * @param value Wert der gesetzt werden muss
 	 * @return &lt;code&gt;true&lt;/code&gt;, wenn das Attribut an diesem Element existiert, sonst &lt;code&gt;false&lt;/code&gt;
 	 */
-    static void setAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const char* const value);
+    void setAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const char* const value) const;
 
     /**
 	 * Checks whether a DOMNode has a certain name
@@ -250,7 +254,7 @@
 	 * @param name the name to check
 	 * @return &lt;code&gt;true&lt;/code&gt;, if the DOM node the name &lt;code&gt;name&lt;/code&gt;, &lt;code&gt;false&lt;/code&gt; otherwise
 	 */
-	static bool hasNodeName(XERCES_CPP_NAMESPACE::DOMNode* node, const char* const name);
+	bool hasNodeName(XERCES_CPP_NAMESPACE::DOMNode* node, const char* const name) const;
 
     
     /**
@@ -261,7 +265,7 @@
      * @param value das zu setzende Integer
 	 * @return Das DOM-Element
 	 */
-	static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, int value);
+	XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, int value) const;
 
     /**
 	 * Ermittelt den Text eines DOMElement-Attributes und parst ihn, 
@@ -271,7 +275,7 @@
 	 * @param name Name des Attributes
      * @return Zahlenwert des Attributes
 	 */
-	static int getAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	int getAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Wandelt eine Ganzzahldubel in einen Text um und setzt diesen als Attribut 
@@ -281,7 +285,7 @@
      * @param value das zu setzende IntegerPair
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, IntPair value);
+    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, IntPair value) const;
 
     /**
 	 * Ermittelt den Text eines DOMElement-Attributes und parst ihn, 
@@ -291,7 +295,7 @@
 	 * @param name Name des Attributes
      * @return Zahlendubel des Attributes
 	 */
-    static IntPair getAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+    IntPair getAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Wandelt eine Ganzzahltripel in einen Text um und setzt diesen als Attribut 
@@ -301,7 +305,7 @@
      * @param value das zu setzende Tripel&lt;int&gt;
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Tripel&lt;int&gt; value);
+    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Tripel&lt;int&gt; value) const;
 
     /**
 	 * Ermittelt den Text eines DOMElement-Attributes und parst ihn, 
@@ -311,7 +315,7 @@
 	 * @param name Name des Attributes
      * @return Zahlendubel des Attributes
 	 */
-    static Tripel&lt;int&gt; getAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+    Tripel&lt;int&gt; getAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 	
 	/**
 	 * Setzt den Text eines DOMElement-Attributes
@@ -321,7 +325,7 @@
 	 * @param value das zu setzende CeGuiString
 	 * @return Das DOM-Element
 	 */	
-	static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const CeGuiString &amp;value);
+	XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const CeGuiString &amp;value) const;
     
     /**
 	 * Ermittelt den Text eines DOMElement-Attributes und konvertiert ihn zu einem CeGuiString
@@ -330,7 +334,7 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als CeGuiString
 	 */	
-	static CeGuiString getAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	CeGuiString getAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Setzt den Text eines DOMElement-Attributes
@@ -340,7 +344,7 @@
 	 * @param value der zu setzende std::string
 	 * @return Das DOM-Element
 	 */	
-    static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const std::string &amp;value);
+    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const std::string &amp;value) const;
 
 	/**
 	 * Ermittelt den Text eines DOMElement-Attributes und konvertiert ihn zu einem std::string
@@ -349,7 +353,7 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als std::string
 	 */	
-    static std::string getAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+    std::string getAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 	
     /**
 	 * Ermittelt den Text eines SAX Element-Attributes und konvertiert ihn zu einem CeGuiString
@@ -358,7 +362,7 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als CeGuiString
 	 */
-	static CeGuiString getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes&amp; attributes, const char* const name);
+	CeGuiString getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes&amp; attributes, const char* const name) const;
 
     /**
 	 * Setzt den Text eines DOMElement-Attributes
@@ -368,7 +372,7 @@
 	 * @param value der zu setzende boolean
 	 * @return Das DOM-Element
 	 */	
-	static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, bool value);
+	XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, bool value) const;
 
 	/**
 	 * Ermittelt den Text eines DOMElement-Attributes und interpretier ihn als bool
@@ -377,7 +381,7 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als bool
 	 */	
-	static bool getAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	bool getAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Setzt den Text eines DOMElement-Attributes
@@ -387,7 +391,7 @@
 	 * @param value der zu setzende Real Wert
 	 * @return Das DOM-Element
 	 */	
-    static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Ogre::Real value);
+    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Ogre::Real value) const;
 
 	/**
 	 * Ermittelt den Text eines DOMElement-Attributes und konvertiert ihn zu Ogre::Real
@@ -396,14 +400,14 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als Ogre::Real
 	 */	
-	static Ogre::Real getAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	Ogre::Real getAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
 
 	/**
 	 * Initialisiert den XML&lt;-&gt;UTF-8 Transcoder, 
 	 * davor muss XMLPlatformUtils::Initialize() aufgerufen worden sein
 	 */
-	static void initializeTranscoder();
+	void initializeTranscoder();
 
 	/**
 	 * Konvertiert einen Xerces-XMLCh* in eine CeGuiString
@@ -413,19 +417,33 @@
 	 * 
 	 * @param string16 Der zu konvertierende Xerces-XMLCh*
 	 * @return Konvertierter Text als CeGuiString
-	 * @see transcodeToUtf8(const XMLCh* const string16);
+	 * @see transcodeToUtf8(const XMLCh* const string16) const;
 	 */
-	static CeGuiString transcodeToString(const XMLCh* const string16);
+	CeGuiString transcodeToString(const XMLCh* const string16) const;
 
-	static std::string transcodeToStdString(const XMLCh* const string16);
+	std::string transcodeToStdString(const XMLCh* const string16) const;
 
-    static XmlErrorHandler* getErrorHandler();
+    XERCES_CPP_NAMESPACE::DOMDocument* loadDocument(
+        const Ogre::String&amp; resourceName, const Ogre::String&amp; resourceGroup = &quot;&quot;);
+    XERCES_CPP_NAMESPACE::DOMDocument* loadDocument(
+        const Ogre::DataStreamPtr&amp; stream);
 
+    void initializeXml();
+    void shutdownXml();
+
+        virtual void warning(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc);
+        virtual void error(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc);
+        virtual void fatalError(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc);
+        virtual void resetErrors();
+
 private:
 	static XMLTranscoder* sTranscoder;
 	static XMLTransService::Codes sFailCode;
 
-    static XmlErrorHandler sErrorHandler;
+        std::string toString( const std::string&amp; type,
+                              const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc ) const;
+        
+        std::string mOpenXmlFileName;
 
 	/**
 	 * Konvertiert ein Xerces-XMLCh* in einen UTF-8-String
@@ -435,7 +453,7 @@
 	 * @return Konvertierter Text als utf8* (muss selbst gel&#246;scht werden)
 	 * @see initializeTranscoder()
 	 */
-	static utf8* transcodeToUtf8(const XMLCh* const string16);
+	utf8* transcodeToUtf8(const XMLCh* const string16) const;
 };
 
 class _RlCommonExport AutoXMLCh

Modified: rl/trunk/engine/common/include/XmlResource.h
===================================================================
--- rl/trunk/engine/common/include/XmlResource.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/XmlResource.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -26,6 +26,7 @@
 
 #include &quot;CommonPrerequisites.h&quot;
 #include &lt;OgreResource.h&gt;
+#include &quot;XmlHelper.h&quot;
 
 namespace rl {
 
@@ -43,8 +44,8 @@
 
         virtual ~XmlResource();
 
-        bool parseBy(XERCES_CPP_NAMESPACE::XercesDOMParser* parser, bool useErrorHandler=true);
-        bool parseBy(XERCES_CPP_NAMESPACE::SAX2XMLReader* parser, bool useErrorHandler=true);
+        bool parseBy(XERCES_CPP_NAMESPACE::XercesDOMParser* parser, XmlProcessor* const proc = NULL);
+        bool parseBy(XERCES_CPP_NAMESPACE::SAX2XMLReader* parser, XmlProcessor* const proc = NULL);
 
     protected:
         size_t calculateSize() const;

Modified: rl/trunk/engine/common/src/PropertyReader.cpp
===================================================================
--- rl/trunk/engine/common/src/PropertyReader.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/PropertyReader.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,12 +17,8 @@
 #include &quot;stdinc.h&quot; //precompiled header
 
 #include &lt;xercesc/dom/DOM.hpp&gt;
-#include &lt;xercesc/parsers/XercesDOMParser.hpp&gt;
-#include &lt;xercesc/util/XMLString.hpp&gt;
-#include &lt;xercesc/util/PlatformUtils.hpp&gt;
 
 #include &quot;XmlHelper.h&quot;
-#include &quot;OgreXercesInput.h&quot;
 
 #include &quot;Properties.h&quot;
 #include &quot;PropertyReader.h&quot;
@@ -42,19 +38,10 @@
 
 void XmlPropertyReader::parseGameObjectFile(Ogre::DataStreamPtr &amp;stream, const Ogre::String &amp;groupName)
 {
-    XMLPlatformUtils::Initialize();
+    initializeXml();
 
-	XmlHelper::initializeTranscoder();
-	XercesDOMParser* parser = new XercesDOMParser();
+    XERCES_CPP_NAMESPACE::DOMDocument* doc = loadDocument(stream);
 
-    parser-&gt;setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-    parser-&gt;setDoNamespaces(true);    // optional
-	
-    OgreInputSource source(stream);
-    parser-&gt;parse(source);
-
-    XERCES_CPP_NAMESPACE::DOMDocument* doc = parser-&gt;getDocument();
-
     DOMNodeList* godefsXml = doc-&gt;getDocumentElement()-&gt;getElementsByTagName(AutoXMLCh(&quot;gameobjectclass&quot;).data());
     for (unsigned int idx = 0; idx &lt; godefsXml-&gt;getLength(); idx++)
     {
@@ -89,7 +76,7 @@
 	
 	doc-&gt;release();
 
-	XMLPlatformUtils::Terminate();
+    shutdownXml();
 }
 
 std::vector&lt;PropertySet*&gt; XmlPropertyReader::getPropertySets()
@@ -100,27 +87,27 @@
 PropertyEntry XmlPropertyReader::processProperty(XERCES_CPP_NAMESPACE::DOMAttr* domAttr) const
 {
 	return std::make_pair(
-		XmlHelper::transcodeToStdString(domAttr-&gt;getName()), 
-		Property(XmlHelper::transcodeToString(domAttr-&gt;getValue())));
+		transcodeToStdString(domAttr-&gt;getName()), 
+		Property(transcodeToString(domAttr-&gt;getValue())));
 }
 
 PropertyEntry XmlPropertyReader::processProperty(XERCES_CPP_NAMESPACE::DOMElement* domElem) const
 {
-    if (!XmlHelper::hasAttribute(domElem, &quot;type&quot;))
+    if (!hasAttribute(domElem, &quot;type&quot;))
     {
         return std::make_pair(&quot;&quot;, Property(0));
     }
 
     Ogre::String key = &quot;&quot;;
-	if (XmlHelper::hasAttribute(domElem, &quot;name&quot;))
+	if (hasAttribute(domElem, &quot;name&quot;))
 	{
-		key = XmlHelper::getAttributeValueAsStdString(domElem, &quot;name&quot;);
+		key = getAttributeValueAsStdString(domElem, &quot;name&quot;);
 	}
-	Ogre::String type = XmlHelper::getAttributeValueAsStdString(domElem, &quot;type&quot;);
+	Ogre::String type = getAttributeValueAsStdString(domElem, &quot;type&quot;);
     CeGuiString value = &quot;&quot;;
-    if (XmlHelper::hasAttribute(domElem, &quot;data&quot;))
+    if (hasAttribute(domElem, &quot;data&quot;))
     {
-        value = XmlHelper::getAttributeValueAsString(domElem, &quot;data&quot;);
+        value = getAttributeValueAsString(domElem, &quot;data&quot;);
     }
 
     Property prop;
@@ -229,7 +216,7 @@
 			if (curChild-&gt;getNodeType() == DOMNode::ELEMENT_NODE)
 			{
 				DOMElement* curElem = static_cast&lt;DOMElement*&gt;(curChild);
-				CeGuiString key = XmlHelper::getAttributeValueAsString(curElem, &quot;name&quot;);
+				CeGuiString key = getAttributeValueAsString(curElem, &quot;name&quot;);
 				PropertyEntry entry = processProperty(curElem);
 				mapVal[key] = entry.second;
 			}

Modified: rl/trunk/engine/common/src/PropertyWriter.cpp
===================================================================
--- rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -13,7 +13,7 @@
 *  along with this program; if not you can get it here
 *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
 */
-
+
 #include &quot;stdinc.h&quot; //precompiled header
 
 #include &quot;XmlHelper.h&quot;
@@ -34,6 +34,10 @@
     {
     }
 
+    XmlPropertyWriter::~XmlPropertyWriter()
+    {
+    }
+
     void XmlPropertyWriter::setPropertySets(std::vector&lt;PropertySet*&gt; sets)
     {
         mPropertySets = sets;
@@ -59,31 +63,31 @@
             }
             else
             {
-                element = XmlHelper::appendChildElement(mDocument, parent, &quot;property&quot;);
+                element = appendChildElement(mDocument, parent, &quot;property&quot;);
                 if(entry.first != &quot;&quot;)
-                    XmlHelper::setAttribute(element, &quot;name&quot;, entry.first.c_str());
+                    setAttribute(element, &quot;name&quot;, entry.first.c_str());
 
                 //Ogre::String typeName = entry.second.getTypeName();
                 Ogre::String name = entry.second.getName();
                 Ogre::StringUtil::toUpperCase(name);
-                XmlHelper::setAttributeValueAsString(element, &quot;type&quot;, name);
+                setAttributeValueAsString(element, &quot;type&quot;, name);
 
                 if(entry.second.isBool())
-                    XmlHelper::setAttributeValueAsBool(element, &quot;data&quot;, entry.second.toBool());
+                    setAttributeValueAsBool(element, &quot;data&quot;, entry.second.toBool());
                 else if(entry.second.isInt())
-                    XmlHelper::setAttributeValueAsInteger(element, &quot;data&quot;, entry.second.toInt());
+                    setAttributeValueAsInteger(element, &quot;data&quot;, entry.second.toInt());
                 else if(entry.second.isIntPair())
-                    XmlHelper::setAttributeValueAsIntegerPair(element, &quot;data&quot;, entry.second.toIntPair());
+                    setAttributeValueAsIntegerPair(element, &quot;data&quot;, entry.second.toIntPair());
                 else if(entry.second.isIntPair())
-                    XmlHelper::setAttributeValueAsIntegerTriple(element, &quot;data&quot;, entry.second.toIntTriple());
+                    setAttributeValueAsIntegerTriple(element, &quot;data&quot;, entry.second.toIntTriple());
                 else if(entry.second.isQuaternion())
-                    XmlHelper::setValueAsQuaternion(element, entry.second.toQuaternion());
+                    setValueAsQuaternion(element, entry.second.toQuaternion());
                 else if(entry.second.isReal())
-                    XmlHelper::setAttributeValueAsReal(element, &quot;data&quot;, entry.second.toReal());
+                    setAttributeValueAsReal(element, &quot;data&quot;, entry.second.toReal());
                 else if(entry.second.isString())
-                    XmlHelper::setAttributeValueAsString(element, &quot;data&quot;, entry.second.toString());
+                    setAttributeValueAsString(element, &quot;data&quot;, entry.second.toString());
                 else if(entry.second.isVector3())
-                    XmlHelper::setValueAsVector3(element, entry.second.toVector3());
+                    setValueAsVector3(element, entry.second.toVector3());
             }
         }
         return element;
@@ -98,9 +102,9 @@
 
     DOMElement* XmlPropertyWriter::processPropertyArray(DOMElement *parent, const char *const name, PropertyVector vector)
     {
-        DOMElement* element = XmlHelper::appendChildElement(mDocument, parent, &quot;property&quot;);
-        XmlHelper::setAttribute(element, &quot;name&quot;, name);
-        XmlHelper::setAttribute(element, &quot;type&quot;, &quot;MAP&quot;);
+        DOMElement* element = appendChildElement(mDocument, parent, &quot;property&quot;);
+        setAttribute(element, &quot;name&quot;, name);
+        setAttribute(element, &quot;type&quot;, &quot;MAP&quot;);
 
         PropertyVector::iterator iter;
         for(iter = vector.begin(); iter != vector.end(); iter++)
@@ -112,9 +116,9 @@
 
     DOMElement* XmlPropertyWriter::processPropertyMap(DOMElement *parent, const char *const name, PropertyMap map)
     {
-        DOMElement* element = XmlHelper::appendChildElement(mDocument, parent, &quot;property&quot;);
-        XmlHelper::setAttribute(element, &quot;name&quot;, name);
-        XmlHelper::setAttribute(element, &quot;type&quot;, &quot;MAP&quot;);
+        DOMElement* element = appendChildElement(mDocument, parent, &quot;property&quot;);
+        setAttribute(element, &quot;name&quot;, name);
+        setAttribute(element, &quot;type&quot;, &quot;MAP&quot;);
 
         PropertyMap::iterator iter;
         for(iter = map.begin(); iter != map.end(); iter++)

Modified: rl/trunk/engine/common/src/XmlErrorHandler.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlErrorHandler.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/XmlErrorHandler.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,58 +17,27 @@
 #include &quot;stdinc.h&quot; //precompiled header
 
 #include &lt;sstream&gt;
-#include &lt;xercesc/sax/SAXParseException.hpp&gt;
+
 #include &quot;XmlErrorHandler.h&quot;
 #include &quot;XmlHelper.h&quot;
 
 
 namespace rl {
 
-XmlErrorHandler::XmlErrorHandler(void)
-    : mFileName(&quot;&quot;)
-{
-}
+//XmlErrorHandler::XmlErrorHandler(void)
+//    : mFileName(&quot;&quot;)
+//{
+//}
+//
+//XmlErrorHandler::~XmlErrorHandler(void)
+//{
+//}
+//
+//void XmlErrorHandler::setFileName(const std::string&amp; fileName)
+//{
+//    mFileName = fileName;
+//}
 
-XmlErrorHandler::~XmlErrorHandler(void)
-{
-}
 
-void XmlErrorHandler::setFileName(const std::string&amp; fileName)
-{
-    mFileName = fileName;
-}
 
-std::string XmlErrorHandler::toString( const std::string&amp; type,
-        const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc ) const
-{
-    std::stringstream strs;
-    strs &lt;&lt; &quot;A&quot; &lt;&lt; type &lt;&lt; &quot; occured while parsing &quot; &lt;&lt; mFileName
-         &lt;&lt; &quot; at line &quot; &lt;&lt; exc.getLineNumber() &lt;&lt; &quot; column &quot; &lt;&lt;  exc.getColumnNumber();
-
-    if( exc.getSystemId() != NULL )
-        strs &lt;&lt; &quot; with system &quot; &lt;&lt; XmlHelper::transcodeToStdString( exc.getSystemId() );
-    if( exc.getPublicId() != NULL )
-        strs &lt;&lt; &quot; with public &quot; &lt;&lt; XmlHelper::transcodeToStdString( exc.getPublicId() );
-    return strs.str();
 }
-
-void XmlErrorHandler::warning(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc)
-{
-    LOG_MESSAGE(Logger::CORE, toString( &quot; warning &quot;, exc ) );
-}
-
-void XmlErrorHandler::error(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc)
-{
-    LOG_ERROR(Logger::CORE, toString( &quot;n error&quot;, exc ) );
-}
-
-void XmlErrorHandler::fatalError(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc)
-{
-    LOG_CRITICAL(Logger::CORE, toString( &quot; fatal error&quot;, exc ) );
-}
-
-void XmlErrorHandler::resetErrors()
-{
-}
-
-}

Modified: rl/trunk/engine/common/src/XmlHelper.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlHelper.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/XmlHelper.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -16,42 +16,42 @@
 
 #include &quot;stdinc.h&quot; //precompiled header
 
+#include &lt;CEGUIPropertyHelper.h&gt;
+#include &lt;OgreResourceManager.h&gt;
 #include &lt;xercesc/dom/DOM.hpp&gt;
+#include &lt;xercesc/parsers/XercesDOMParser.hpp&gt;
+#include &lt;xercesc/util/PlatformUtils.hpp&gt;
+#include &lt;xercesc/sax/SAXParseException.hpp&gt;
 
-#include &quot;XmlHelper.h&quot;
-#include &quot;XmlErrorHandler.h&quot;
 #include &quot;Exception.h&quot;
 #include &quot;Logger.h&quot;
+#include &quot;OgreXercesInput.h&quot;
+#include &quot;XmlErrorHandler.h&quot;
+#include &quot;XmlHelper.h&quot;
+#include &quot;XmlResource.h&quot;
+#include &quot;XmlResourceManager.h&quot;
 
-#include &lt;CEGUIPropertyHelper.h&gt;
-
+using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
 
+namespace rl 
+{
 
-namespace rl {
+XERCES_CPP_NAMESPACE::XMLTranscoder* XmlProcessor::sTranscoder = NULL;
+XERCES_CPP_NAMESPACE::XMLTransService::Codes XmlProcessor::sFailCode = XERCES_CPP_NAMESPACE::XMLTransService::Ok;
 
-XMLTranscoder* XmlHelper::sTranscoder;
-XMLTransService::Codes XmlHelper::sFailCode;
-XmlErrorHandler XmlHelper::sErrorHandler;
-
-void XmlHelper::initializeTranscoder()
+DOMElement* XmlProcessor::appendChildElement(DOMDocument* doc, DOMElement* parent, const char* const name) const
 {
-	XmlHelper::sFailCode = XMLTransService::Ok;
-	XmlHelper::sTranscoder = XMLPlatformUtils::fgTransService-&gt;makeNewTranscoderFor(XMLRecognizer::UTF_8, XmlHelper::sFailCode, 16*1024);
-}
+    RlAssert(parent != NULL, &quot;XmlProcessor::appendChildElement: parent must not be NULL&quot; );
 
-DOMElement* XmlHelper::appendChildElement(DOMDocument* doc, DOMElement* parent, const char* const name)
-{
-    RlAssert(parent != NULL, &quot;XmlHelper::appendChildElement: parent must not be NULL&quot; );
-
     DOMElement* child = doc-&gt;createElement(XMLString::transcode(name));
     parent-&gt;appendChild(child);
     return child;
 }
 
-DOMElement* XmlHelper::getChildNamed(DOMElement* parent, const char* const name)
+DOMElement* XmlProcessor::getChildNamed(DOMElement* parent, const char* const name) const
 {
-    RlAssert(parent != NULL, &quot;XmlHelper::getChildNamed: parent must not be NULL&quot; );
+    RlAssert(parent != NULL, &quot;XmlProcessor::getChildNamed: parent must not be NULL&quot; );
 
 	AutoXMLCh nameXml = name;
 
@@ -70,53 +70,52 @@
 	return rval;
 }
 
-DOMElement* XmlHelper::setValueAsString(DOMDocument* doc, DOMElement *element, const CeGuiString &amp;value)
+DOMElement* XmlProcessor::setValueAsString(DOMDocument* doc, DOMElement *element, const CeGuiString &amp;value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setValueAsString: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::setValueAsString: Element must not be NULL&quot;);
     DOMText* text = doc-&gt;createTextNode(XMLString::transcode(value.c_str()));
     element-&gt;appendChild(text);
     return element;
 }
 
-CeGuiString XmlHelper::getValueAsString(DOMElement* element)
+CeGuiString XmlProcessor::getValueAsString(DOMElement* element) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getValueAsString: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::getValueAsString: Element must not be NULL&quot;);
 	return transcodeToString( element-&gt;getFirstChild()-&gt;getNodeValue() );
 }
 
-std::string XmlHelper::getValueAsStdString(DOMElement* element)
+std::string XmlProcessor::getValueAsStdString(DOMElement* element) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getValueAsStdString: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::getValueAsStdString: Element must not be NULL&quot;);
 	return transcodeToStdString( element-&gt;getFirstChild()-&gt;getNodeValue() );
 }
 
-DOMElement* XmlHelper::setValueAsUtf8(DOMDocument* doc, DOMElement* element, utf8* value)
+DOMElement* XmlProcessor::setValueAsUtf8(DOMDocument* doc, DOMElement* element, utf8* value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setValueAsUtf8: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::setValueAsUtf8: Element must not be NULL&quot;);
     CeGuiString temp(value);
     DOMText* text = doc-&gt;createTextNode(XMLString::transcode(temp.c_str()));
     element-&gt;appendChild(text);
     return element;
 }
 
-utf8* XmlHelper::getValueAsUtf8(DOMElement* element)
+utf8* XmlProcessor::getValueAsUtf8(DOMElement* element) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getValueAsUtf8: Element must not be NULL&quot;);
-	return XmlHelper::transcodeToUtf8(element-&gt;getFirstChild()-&gt;getNodeValue());
+    RlAssert(element != NULL, &quot;XmlProcessor::getValueAsUtf8: Element must not be NULL&quot;);
+	return XmlProcessor::transcodeToUtf8(element-&gt;getFirstChild()-&gt;getNodeValue());
 }
 
-bool XmlHelper::hasAttribute(DOMElement* element,const char* const name)
+bool XmlProcessor::hasAttribute(DOMElement* element,const char* const name) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::hasAttribute: Element must not be NULL&quot;);
-    XMLCh* attrName = XMLString::transcode(name);
-    bool rVal = element-&gt;hasAttribute(attrName);
-    XMLString::release(&amp;attrName);
+    RlAssert(element != NULL, &quot;XmlProcessor::hasAttribute: Element must not be NULL&quot;);
+    AutoXMLCh attrName(name);
+    bool rVal = element-&gt;hasAttribute(attrName.data());
     return rVal;
 }
 
-bool XmlHelper::hasNodeName(DOMNode* node, const char* const name)
+bool XmlProcessor::hasNodeName(DOMNode* node, const char* const name) const
 {
-    RlAssert(node != NULL, &quot;XmlHelper::hasNodeName: node must not be NULL&quot;);
+    RlAssert(node != NULL, &quot;XmlProcessor::hasNodeName: node must not be NULL&quot;);
     XMLCh* nodeName = XMLString::transcode(name);
     int ival = XMLString::compareString(node-&gt;getNodeName(), nodeName);
     bool rVal = (0 == ival);
@@ -124,49 +123,45 @@
     return rVal;
 }
 
-void XmlHelper::setAttribute(DOMElement* element, const char* const name, const char* const value)
+void XmlProcessor::setAttribute(DOMElement* element, const char* const name, const char* const value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setAttribute: Element must not be NULL&quot;);
-    XMLCh* attrName = XMLString::transcode(name);
-    element-&gt;setAttribute(attrName,XMLString::transcode(value));
-    XMLString::release(&amp;attrName);
+    RlAssert(element != NULL, &quot;XmlProcessor::setAttribute: Element must not be NULL&quot;);
+    AutoXMLCh attrName(name);
+    element-&gt;setAttribute(attrName.data(), XMLString::transcode(value));
 }
 
-DOMElement* XmlHelper::setAttributeValueAsInteger(DOMElement *element, const char *const name, int value)
+DOMElement* XmlProcessor::setAttributeValueAsInteger(DOMElement *element, const char *const name, int value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setAttributeValueAsInteger: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, &quot;XmlProcessor::setAttributeValueAsInteger: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value);
-    element-&gt;setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&amp;attrName);
+    element-&gt;setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-int XmlHelper::getAttributeValueAsInteger(DOMElement* element,const char* const name)
+int XmlProcessor::getAttributeValueAsInteger(DOMElement* element,const char* const name) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getAttributeValueAsInteger: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
-	const XMLCh* attribute = element-&gt;getAttribute(attrName);
+    RlAssert(element != NULL, &quot;XmlProcessor::getAttributeValueAsInteger: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
+	const XMLCh* attribute = element-&gt;getAttribute(attrName.data());
 	int rVal = XMLString::parseInt(attribute);
-	XMLString::release(&amp;attrName);
 	return rVal;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsIntegerPair(DOMElement* element, const char* const name, IntPair value)
+DOMElement* XmlProcessor::setAttributeValueAsIntegerPair(DOMElement* element, const char* const name, IntPair value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setAttributeValueAsIntegerPair: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, &quot;XmlProcessor::setAttributeValueAsIntegerPair: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value.first) + &quot;,&quot; + Ogre::StringConverter::toString(value.second);
-    element-&gt;setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&amp;attrName);
+    element-&gt;setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-IntPair XmlHelper::getAttributeValueAsIntegerPair(DOMElement* element, const char* const name)
+IntPair XmlProcessor::getAttributeValueAsIntegerPair(DOMElement* element, const char* const name) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getAttributeValueAsIntegerPair: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
-	const XMLCh* attribute = element-&gt;getAttribute(attrName);
+    RlAssert(element != NULL, &quot;XmlProcessor::getAttributeValueAsIntegerPair: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
+	const XMLCh* attribute = element-&gt;getAttribute(attrName.data());
 	
     CeGuiString value = transcodeToString(attribute);
     CeGuiString::size_type comma1 = value.find(&quot;,&quot;);
@@ -178,26 +173,24 @@
 			CEGUI::PropertyHelper::stringToInt(value.substr(0, comma1)),
 			CEGUI::PropertyHelper::stringToInt(value.substr(comma1 + 1)));
     }
-    XMLString::release(&amp;attrName);
 
     return intPairVal;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsIntegerTriple(DOMElement *element, const char *const name, Tripel&lt;int&gt; value)
+DOMElement* XmlProcessor::setAttributeValueAsIntegerTriple(DOMElement *element, const char *const name, Tripel&lt;int&gt; value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setAttributeValueAsIntegerTriple: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, &quot;XmlProcessor::setAttributeValueAsIntegerTriple: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value.first) + &quot;,&quot; + Ogre::StringConverter::toString(value.second) + &quot;&quot; + Ogre::StringConverter::toString(value.third);
-    element-&gt;setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&amp;attrName);
+    element-&gt;setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-Tripel&lt;int&gt; XmlHelper::getAttributeValueAsIntegerTriple(DOMElement* element, const char* const name)
+Tripel&lt;int&gt; XmlProcessor::getAttributeValueAsIntegerTriple(DOMElement* element, const char* const name) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getAttributeValueAsIntegerTriple: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
-	const XMLCh* attribute = element-&gt;getAttribute(attrName);
+    RlAssert(element != NULL, &quot;XmlProcessor::getAttributeValueAsIntegerTriple: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
+	const XMLCh* attribute = element-&gt;getAttribute(attrName.data());
 
     CeGuiString value = transcodeToString(attribute);
 
@@ -211,132 +204,123 @@
         intTripel.second = CEGUI::PropertyHelper::stringToFloat(value.substr(comma1 + 1, comma2 - comma1 - 1));
         intTripel.third = CEGUI::PropertyHelper::stringToFloat(value.substr(comma2 + 1));
     }
-    XMLString::release(&amp;attrName);
 
     return intTripel;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsReal(DOMElement *element, const char *const name, Ogre::Real value)
+DOMElement* XmlProcessor::setAttributeValueAsReal(DOMElement *element, const char *const name, Ogre::Real value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setAttributeValueAsReal: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, &quot;XmlProcessor::setAttributeValueAsReal: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value);
-    element-&gt;setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&amp;attrName);
+    element-&gt;setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-Ogre::Real XmlHelper::getAttributeValueAsReal(DOMElement* element,const char* const name)
+Ogre::Real XmlProcessor::getAttributeValueAsReal(DOMElement* element,const char* const name) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getAttributeValueAsReal: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, &quot;XmlProcessor::getAttributeValueAsReal: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
 	Ogre::Real rVal = Ogre::StringConverter::parseReal(
-		transcodeToString(element-&gt;getAttribute(attrName)).c_str() );
-	XMLString::release(&amp;attrName);
+		transcodeToString(element-&gt;getAttribute(attrName.data())).c_str() );
 	return rVal;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsString(DOMElement *element, const char *const name, const CeGuiString &amp;value)
+DOMElement* XmlProcessor::setAttributeValueAsString(DOMElement *element, const char *const name, const CeGuiString &amp;value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setAttributeValueAsString: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
-    element-&gt;setAttribute(attrName,XMLString::transcode(value.c_str()));
-    XMLString::release(&amp;attrName);
+    RlAssert(element != NULL, &quot;XmlProcessor::setAttributeValueAsString: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
+    element-&gt;setAttribute(attrName.data(), XMLString::transcode(value.c_str()));
     return element;
 }
 
-CeGuiString XmlHelper::getAttributeValueAsString(DOMElement* element, const char* const name)
+CeGuiString XmlProcessor::getAttributeValueAsString(DOMElement* element, const char* const name) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getAttributeValueAsString: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
-	CeGuiString rVal(transcodeToString(element-&gt;getAttribute(attrName)));
-	XMLString::release(&amp;attrName);
+    RlAssert(element != NULL, &quot;XmlProcessor::getAttributeValueAsString: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
+	CeGuiString rVal(transcodeToString(element-&gt;getAttribute(attrName.data())));
 	return rVal;
 }
 
-CeGuiString XmlHelper::getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes&amp; attributes, const char* const name)
+CeGuiString XmlProcessor::getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes&amp; attributes, const char* const name) const
 {
-	XMLCh* attrName = XMLString::transcode(name);
-	const XMLCh* valStr = attributes.getValue(attrName);
-	XMLString::release(&amp;attrName);
-	if(valStr != NULL)
+	AutoXMLCh attrName(name);
+	const XMLCh* valStr = attributes.getValue(attrName.data());
+	if (valStr != NULL)
 	{
 		return transcodeToString(valStr);
 	}
 	return CeGuiString();
 }
 
-DOMElement* XmlHelper::setAttributeValueAsStdString(DOMElement *element, const char *const name, const std::string &amp;value)
+DOMElement* XmlProcessor::setAttributeValueAsStdString(DOMElement *element, const char *const name, const std::string &amp;value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setAttributeValueAsStdString: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
-    element-&gt;setAttribute(attrName,XMLString::transcode(value.c_str()));
-    XMLString::release(&amp;attrName);
+    RlAssert(element != NULL, &quot;XmlProcessor::setAttributeValueAsStdString: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
+    element-&gt;setAttribute(attrName.data(), XMLString::transcode(value.c_str()));
     return element;
 }
 
-std::string XmlHelper::getAttributeValueAsStdString(DOMElement* element, const char* const name)
+std::string XmlProcessor::getAttributeValueAsStdString(DOMElement* element, const char* const name) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getAttributeValueAsStdString: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
-	std::string rVal(transcodeToStdString(element-&gt;getAttribute(attrName)));
-	XMLString::release(&amp;attrName);
+    RlAssert(element != NULL, &quot;XmlProcessor::getAttributeValueAsStdString: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
+	std::string rVal(transcodeToStdString(element-&gt;getAttribute(attrName.data())));
 	return rVal;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsBool(DOMElement *element, const char *const name, bool value)
+DOMElement* XmlProcessor::setAttributeValueAsBool(DOMElement *element, const char *const name, bool value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setAttributeValueAsBool: Element must not be NULL&quot;);
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, &quot;XmlProcessor::setAttributeValueAsBool: Element must not be NULL&quot;);
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value);
-    element-&gt;setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&amp;attrName);
+    element-&gt;setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-bool XmlHelper::getAttributeValueAsBool(DOMElement* element,const char* const name)
+bool XmlProcessor::getAttributeValueAsBool(DOMElement* element,const char* const name) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getAttributeValueAsBool: Element must not be NULL&quot;);
-	if( XMLString::compareIString(getAttributeValueAsString(element, name).c_str(),&quot;true&quot;) == 0  )
+    RlAssert(element != NULL, &quot;XmlProcessor::getAttributeValueAsBool: Element must not be NULL&quot;);
+	if ( XMLString::compareIString(getAttributeValueAsString(element, name).c_str(),&quot;true&quot;) == 0  )
 		return true;
 	else
 		return false;
 }
 
-DOMElement* XmlHelper::setValueAsInteger(DOMDocument* doc, DOMElement *element, int value)
+DOMElement* XmlProcessor::setValueAsInteger(DOMDocument* doc, DOMElement *element, int value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setValueAsInteger: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::setValueAsInteger: Element must not be NULL&quot;);
     CeGuiString temp = Ogre::StringConverter::toString(value);
     DOMText* text = doc-&gt;createTextNode(XMLString::transcode(temp.c_str()));
     element-&gt;appendChild(text);
     return element;
 }
 
-int XmlHelper::getValueAsInteger(DOMElement* element)
+int XmlProcessor::getValueAsInteger(DOMElement* element) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getValueAsInteger: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::getValueAsInteger: Element must not be NULL&quot;);
 	return XMLString::parseInt(element-&gt;getFirstChild()-&gt;getNodeValue());
 }
 
-Ogre::Real XmlHelper::getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element)
+Ogre::Real XmlProcessor::getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getValueAsInteger: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::getValueAsInteger: Element must not be NULL&quot;);
     return Ogre::StringConverter::parseReal(
         transcodeToString(element-&gt;getFirstChild()-&gt;getNodeValue()).c_str());
 }
 
-DOMElement* XmlHelper::setValueAsIntegerPair(DOMDocument *doc, DOMElement *element, IntPair value)
+DOMElement* XmlProcessor::setValueAsIntegerPair(DOMDocument *doc, DOMElement *element, IntPair value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setValueAsIntegerPair: Element must not be NULL&quot;);
-    String temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second);
+    RlAssert(element != NULL, &quot;XmlProcessor::setValueAsIntegerPair: Element must not be NULL&quot;);
+    CeGuiString temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second);
     DOMText* text = doc-&gt;createTextNode(XMLString::transcode(temp.c_str()));
     element-&gt;appendChild(text);
     return element;
 }
 
-IntPair XmlHelper::getValueAsIntegerPair(DOMElement* element)
+IntPair XmlProcessor::getValueAsIntegerPair(DOMElement* element) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getValueAsIntegerPair: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::getValueAsIntegerPair: Element must not be NULL&quot;);
     CeGuiString value = getValueAsString(element);
     CeGuiString::size_type comma1 = value.find(&quot;,&quot;);
 
@@ -350,19 +334,19 @@
     return intPairVal;
 }
 
-DOMElement* XmlHelper::setValueAsIntegerTriple(DOMDocument *doc, DOMElement *element, Tripel&lt;int&gt; value)
+DOMElement* XmlProcessor::setValueAsIntegerTriple(DOMDocument *doc, DOMElement *element, Tripel&lt;int&gt; value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setValueAsIntegerTriple: Element must not be NULL&quot;);
-    RlAssert(element != NULL, &quot;XmlHelper::setValueAsIntegerPair: Element must not be NULL&quot;);
-    String temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second) + ',' + CEGUI::PropertyHelper::intToString(value.third);
+    RlAssert(element != NULL, &quot;XmlProcessor::setValueAsIntegerTriple: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::setValueAsIntegerPair: Element must not be NULL&quot;);
+    CeGuiString temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second) + ',' + CEGUI::PropertyHelper::intToString(value.third);
     DOMText* text = doc-&gt;createTextNode(XMLString::transcode(temp.c_str()));
     element-&gt;appendChild(text);
     return element;
 }
 
-Tripel&lt;int&gt; XmlHelper::getValueAsIntegerTriple(DOMElement *element)
+Tripel&lt;int&gt; XmlProcessor::getValueAsIntegerTriple(DOMElement *element) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getValueAsIntegerTriple: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::getValueAsIntegerTriple: Element must not be NULL&quot;);
     CeGuiString value = getValueAsString(element);
 
     CeGuiString::size_type comma1 = value.find(&quot;,&quot;);
@@ -378,18 +362,18 @@
     return intTripel;
 }
 
-DOMElement* XmlHelper::setValueAsVector3( DOMElement *element, Ogre::Vector3 value)
+DOMElement* XmlProcessor::setValueAsVector3( DOMElement *element, Ogre::Vector3 value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setValueAsVector3: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::setValueAsVector3: Element must not be NULL&quot;);
     setAttribute(element, &quot;x&quot;, Ogre::StringConverter::toString(value.x).c_str());
     setAttribute(element, &quot;y&quot;, Ogre::StringConverter::toString(value.y).c_str());
     setAttribute(element, &quot;z&quot;, Ogre::StringConverter::toString(value.z).c_str());
     return element;
 }
 
-Ogre::Vector3 XmlHelper::getValueAsVector3(DOMElement* element)
+Ogre::Vector3 XmlProcessor::getValueAsVector3(DOMElement* element) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getValueAsVector3: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::getValueAsVector3: Element must not be NULL&quot;);
 	RlAssert(
 		hasAttribute(element, &quot;x&quot;) 
 		&amp;&amp; hasAttribute(element, &quot;y&quot;) 
@@ -401,9 +385,9 @@
 		getAttributeValueAsReal(element, &quot;z&quot;));
 }
 
-DOMElement* XmlHelper::setValueAsQuaternion(DOMElement *element, Ogre::Quaternion value)
+DOMElement* XmlProcessor::setValueAsQuaternion(DOMElement *element, Ogre::Quaternion value) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::setValueAsQuaternion: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::setValueAsQuaternion: Element must not be NULL&quot;);
     setAttribute(element, &quot;x&quot;, Ogre::StringConverter::toString(value.x).c_str());
     setAttribute(element, &quot;y&quot;, Ogre::StringConverter::toString(value.y).c_str());
     setAttribute(element, &quot;z&quot;, Ogre::StringConverter::toString(value.z).c_str());
@@ -411,9 +395,9 @@
     return element;
 }
 
-Ogre::Quaternion XmlHelper::getValueAsQuaternion(DOMElement* element)
+Ogre::Quaternion XmlProcessor::getValueAsQuaternion(DOMElement* element) const
 {
-    RlAssert(element != NULL, &quot;XmlHelper::getValueAsQuaternion: Element must not be NULL&quot;);
+    RlAssert(element != NULL, &quot;XmlProcessor::getValueAsQuaternion: Element must not be NULL&quot;);
 	RlAssert(
 		hasAttribute(element, &quot;x&quot;) 
 		&amp;&amp; hasAttribute(element, &quot;y&quot;) 
@@ -427,7 +411,7 @@
         getAttributeValueAsReal(element, &quot;w&quot;));
 }
 
-utf8* XmlHelper::transcodeToUtf8(const XMLCh* const string16)
+utf8* XmlProcessor::transcodeToUtf8(const XMLCh* const string16) const
 {
 	unsigned int str16len = XMLString::stringLen(string16);
 	if (str16len == 0)
@@ -455,7 +439,7 @@
 	return rval;	
 }
 
-CeGuiString XmlHelper::transcodeToString(const XMLCh* const string16)
+CeGuiString XmlProcessor::transcodeToString(const XMLCh* const string16) const
 {
 	unsigned int str16len = XMLString::stringLen(string16);
 	if (str16len == 0)
@@ -463,17 +447,15 @@
 		return CeGuiString();
 	}
 
-	initializeTranscoder();
-
 	utf8* tmpVal = transcodeToUtf8(string16);
 	CeGuiString rVal(tmpVal);
 	delete[] tmpVal;
 	return rVal;
 }
 
-std::string XmlHelper::transcodeToStdString(const XMLCh* const string16)
+std::string XmlProcessor::transcodeToStdString(const XMLCh* const string16) const
 {
-    if( string16 == NULL )
+    if ( string16 == NULL )
         return &quot;&quot;;
 
 	char* tmpVal = XMLString::transcode(string16);
@@ -482,9 +464,110 @@
 	return rVal;
 }
 
-XmlErrorHandler* XmlHelper::getErrorHandler()
+DOMDocument* XmlProcessor::loadDocument(
+    const Ogre::String&amp; resourceName, const Ogre::String&amp; resourceGroup)
 {
-    return &amp;XmlHelper::sErrorHandler;
+	XercesDOMParser* parser = new XercesDOMParser();
+
+    parser-&gt;setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
+    parser-&gt;setDoNamespaces(true);    // optional
+
+    XmlPtr res = XmlResourceManager::getSingleton().getByName(resourceName);
+    if (res.isNull())
+    {
+        Ogre::String group = ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME;
+        if (resourceGroup != &quot;&quot; 
+            &amp;&amp; ResourceGroupManager::getSingleton().resourceExists(
+                    resourceGroup, resourceName))
+        {
+            group = resourceGroup;
+        }
+        res = XmlResourceManager::getSingleton().create(resourceName, group);
+    }
+
+    mOpenXmlFileName = resourceName;
+
+    if (!res.isNull() &amp;&amp; res-&gt;parseBy(parser, this))
+    {
+        return parser-&gt;getDocument();
+    }
+
+    mOpenXmlFileName = &quot;&quot;;
+
+    return NULL;
 }
 
+DOMDocument* XmlProcessor::loadDocument(const Ogre::DataStreamPtr&amp; stream)
+{
+	XercesDOMParser* parser = new XercesDOMParser();
+
+    parser-&gt;setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
+    parser-&gt;setDoNamespaces(true);    // optional
+
+    OgreInputSource source(stream);
+    parser-&gt;setErrorHandler(this);
+
+    mOpenXmlFileName = stream-&gt;getName();
+    parser-&gt;parse(source);
+    mOpenXmlFileName = &quot;&quot;;
+
+    if (parser-&gt;getErrorCount() == 0)
+    {
+        return parser-&gt;getDocument();
+    }
+
+    return NULL;
+}
+
+void XmlProcessor::initializeXml()
+{
+  	XMLPlatformUtils::Initialize();
+
+	sTranscoder 
+        = XMLPlatformUtils::fgTransService-&gt;makeNewTranscoderFor(
+            XMLRecognizer::UTF_8, sFailCode, 16*1024);
+}
+
+void XmlProcessor::shutdownXml()
+{
+    delete sTranscoder;
+    sTranscoder = NULL;
+    
+    XMLPlatformUtils::Terminate();
+}
+
+std::string XmlProcessor::toString( const std::string&amp; type,
+        const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc ) const
+{
+    std::stringstream strs;
+    strs &lt;&lt; &quot;A&quot; &lt;&lt; type &lt;&lt; &quot; occured while parsing &quot; &lt;&lt; mOpenXmlFileName
+         &lt;&lt; &quot; at line &quot; &lt;&lt; exc.getLineNumber() &lt;&lt; &quot; column &quot; &lt;&lt;  exc.getColumnNumber();
+
+    if( exc.getSystemId() != NULL )
+        strs &lt;&lt; &quot; with system &quot; &lt;&lt; transcodeToStdString( exc.getSystemId() );
+    if( exc.getPublicId() != NULL )
+        strs &lt;&lt; &quot; with public &quot; &lt;&lt; transcodeToStdString( exc.getPublicId() );
+    return strs.str();
+}
+
+void XmlProcessor::warning(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc)
+{
+    LOG_MESSAGE(Logger::CORE, toString( &quot; warning &quot;, exc ) );
+}
+
+void XmlProcessor::error(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc)
+{
+    LOG_ERROR(Logger::CORE, toString( &quot;n error&quot;, exc ) );
+}
+
+void XmlProcessor::fatalError(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc)
+{
+    LOG_CRITICAL(Logger::CORE, toString( &quot; fatal error&quot;, exc ) );
+}
+
+void XmlProcessor::resetErrors()
+{
+}
+
+
 } // end namespace rl

Modified: rl/trunk/engine/common/src/XmlResource.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlResource.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/XmlResource.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -14,7 +14,7 @@
  *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
  */
 
-#include &quot;stdinc.h&quot; //precompiled header
+#include &quot;stdinc.h&quot; //precompiled header
 
 #include &quot;XmlResource.h&quot;
 #include &quot;XmlResourceManager.h&quot;
@@ -70,16 +70,18 @@
 /**
  * @todo both parseby methods could be merged in one template method, to avoid redundancy
  */
-bool XmlResource::parseBy(XERCES_CPP_NAMESPACE::XercesDOMParser* parser, bool useErrorHandler)
+bool XmlResource::parseBy(XERCES_CPP_NAMESPACE::XercesDOMParser* parser, XmlProcessor* const errorHandler)
 {
 	if (!isLoaded())
 		load();
-    if(useErrorHandler &amp;&amp; parser-&gt;getErrorHandler() == NULL)
+
+    if (errorHandler 
+        &amp;&amp; parser-&gt;getErrorHandler() == NULL)
     {
-        parser-&gt;setErrorHandler(XmlHelper::getErrorHandler());
-        XmlHelper::getErrorHandler()-&gt;setFileName(getName());
+        parser-&gt;setErrorHandler(errorHandler);
     }
-	parser-&gt;parse(*mXmlBuffer);
+
+    parser-&gt;parse(*mXmlBuffer);
     if(parser-&gt;getErrorCount() &gt; 0)
     {
         return false;
@@ -87,16 +89,18 @@
     return true;
 }
 
-bool XmlResource::parseBy(XERCES_CPP_NAMESPACE::SAX2XMLReader* parser, bool useErrorHandler)
+bool XmlResource::parseBy(XERCES_CPP_NAMESPACE::SAX2XMLReader* parser, XmlProcessor* const errorHandler)
 {
 	if (!isLoaded())
 		load();
-    if(useErrorHandler &amp;&amp; parser-&gt;getErrorHandler() == NULL)
+
+    if (errorHandler 
+        &amp;&amp; parser-&gt;getErrorHandler() == NULL)
     {
-        parser-&gt;setErrorHandler(XmlHelper::getErrorHandler());
-        XmlHelper::getErrorHandler()-&gt;setFileName(getName());
+        parser-&gt;setErrorHandler(errorHandler);
     }
-	parser-&gt;parse(*mXmlBuffer);
+
+    parser-&gt;parse(*mXmlBuffer);
     if(parser-&gt;getErrorCount() &gt; 0)
     {
         return false;

Modified: rl/trunk/engine/common/src/XmlResourceManager.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlResourceManager.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/XmlResourceManager.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -14,7 +14,7 @@
  *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
  */
 
-#include &quot;stdinc.h&quot; //precompiled header
+#include &quot;stdinc.h&quot; //precompiled header
 
 #include &quot;XmlResourceManager.h&quot;
 
@@ -30,9 +30,9 @@
 }
 
 Resource* XmlResourceManager::createImpl(
-	const String&amp; resName, 
+    const Ogre::String&amp; resName, 
 	ResourceHandle handle, 
-	const String&amp; groupName, 
+	const Ogre::String&amp; groupName, 
 	bool isManual, 
 	ManualResourceLoader* loader, 
 	const NameValuePairList* loadParams)

Modified: rl/trunk/engine/core/include/DotSceneLoader.h
===================================================================
--- rl/trunk/engine/core/include/DotSceneLoader.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/core/include/DotSceneLoader.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,18 +17,16 @@
 #ifndef __DotSceneLoader_H__
 #define __DotSceneLoader_H__
 
-#include &lt;xercesc/sax/ErrorHandler.hpp&gt;
 #include &lt;OgreNewt.h&gt;
 
 #include &lt;string&gt;
 #include &lt;map&gt;
 
 #include &quot;XmlResourceManager.h&quot;
+#include &quot;PropertyReader.h&quot;
 
 class Ogre::SceneNode;
 class XERCES_CPP_NAMESPACE::DOMElement;
-class XERCES_CPP_NAMESPACE::XercesDOMParser;
-class XERCES_CPP_NAMESPACE::SAXParseException;
 
 namespace rl {
 
@@ -38,7 +36,7 @@
 	 *   - Nodes ( Name, Hierarchie + Platzierung + Skalierung + Rotation )
 	 *   - Entities ( Name, TriMeshPhysik )
 	 */
-    class DotSceneLoader : protected XERCES_CPP_NAMESPACE::ErrorHandler
+    class DotSceneLoader : private XmlPropertyReader
 	{
 	public:
 		/// Erstellt einen Dotscene Loader, der das gew&#252;nschte File einliest
@@ -48,12 +46,7 @@
 
 		/// Laden der Szene
 		void initializeScene(Ogre::SceneManager* sceneManager);
-		
 
-        virtual void warning(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc);
-        virtual void error(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc);
-        virtual void fatalError(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc);
-        virtual void resetErrors();
 	private:
         struct NodeUserData
         {
@@ -76,9 +69,6 @@
         };
 
 
-		/// &#214;ffnen der XML-Ressource
-		XERCES_CPP_NAMESPACE::DOMDocument* openSceneFile();
-
 		/// Geht alle Nodes in der .scene durch
 		void processNodes(XERCES_CPP_NAMESPACE::DOMElement* rootNodesXml, 
 			Ogre::SceneManager* sceneManager,

Modified: rl/trunk/engine/core/src/CoreSubsystem.cpp
===================================================================
--- rl/trunk/engine/core/src/CoreSubsystem.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/core/src/CoreSubsystem.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -94,7 +94,7 @@
         delete mAnimationManager;
         delete mActorManager;
         delete mPhysicsManager;
-        delete mXmlResourceManager;
+//        delete mXmlResourceManager;
         delete mScriptWrapper;
         delete mDebugVisualsManager;
 		delete ConfigurationManager::getSingletonPtr();
@@ -341,7 +341,7 @@
         }
     }
 
-    ContentModule* CoreSubsystem::getModule(const String&amp; moduleId) const
+    ContentModule* CoreSubsystem::getModule(const Ogre::String&amp; moduleId) const
     {
         ModuleMap::const_iterator moduleIt = mModules.find(moduleId);
 
@@ -450,7 +450,7 @@
         StringVector deps = module-&gt;getDependencies();
         for (StringVector::const_iterator depsIt = deps.begin(); depsIt != deps.end(); depsIt++)
         {
-            String depName = *depsIt;
+            Ogre::String depName = *depsIt;
             ModuleMap::iterator modIt = mModules.find(depName);
             if (modIt == mModules.end())
             {
@@ -541,7 +541,7 @@
         return mRubyInterpreter;
     }
 
-    void CoreSubsystem::makeScreenshot( const String&amp; sName )
+    void CoreSubsystem::makeScreenshot( const Ogre::String&amp; sName )
     {
         mRenderWindow-&gt;writeContentsToTimestampedFile(sName, &quot;.png&quot;);
     }
@@ -556,8 +556,8 @@
         return mModules;
     }
 
-    void CoreSubsystem::loadMap(const String type, const String filename,
-        const String module)
+    void CoreSubsystem::loadMap(const Ogre::String type, const Ogre::String filename,
+        const Ogre::String module)
     {
         mWorld-&gt;loadScene(filename, module);
     }

Modified: rl/trunk/engine/core/src/DotSceneLoader.cpp
===================================================================
--- rl/trunk/engine/core/src/DotSceneLoader.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/core/src/DotSceneLoader.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -15,14 +15,7 @@
  */
 #include &quot;stdinc.h&quot; //precompiled header
 
-#include &lt;xercesc/framework/LocalFileInputSource.hpp&gt;
-#include &lt;xercesc/parsers/XercesDOMParser.hpp&gt;
-#include &lt;xercesc/dom/DOMDocument.hpp&gt;
-#include &lt;xercesc/dom/DOMElement.hpp&gt;
 #include &lt;xercesc/dom/DOM.hpp&gt;
-#include &lt;xercesc/util/XMLString.hpp&gt;
-#include &lt;xercesc/util/PlatformUtils.hpp&gt;
-#include &lt;xercesc/sax/SAXParseException.hpp&gt;
 
 #include &lt;OgreSceneNode.h&gt;
 
@@ -35,10 +28,7 @@
 #include &quot;ConfigurationManager.h&quot;
 
 #include &quot;Property.h&quot;
-#include &quot;PropertyReader.h&quot;
-#include &quot;XmlHelper.h&quot;
 
-
 #include &quot;Exception.h&quot;
 
 #include &lt;cstdlib&gt;
@@ -67,7 +57,7 @@
 
     DotSceneLoader::~DotSceneLoader()
     {
-        if (mRessource-&gt;isLoaded())
+        if (!mRessource.isNull() &amp;&amp; mRessource-&gt;isLoaded())
         {
             XmlResourceManager::getSingleton().unload(mSceneName);
             XmlResourceManager::getSingleton().remove(mRessource-&gt;getHandle());
@@ -76,11 +66,10 @@
 
     void DotSceneLoader::initializeScene(SceneManager* sceneManager)
     {
-        XMLPlatformUtils::Initialize();
-        XmlHelper::initializeTranscoder();
+        initializeXml();
 
         LOG_MESSAGE(Logger::CORE, &quot;Loading Scene from &quot; + mSceneName);
-        DOMDocument* doc = openSceneFile();
+        DOMDocument* doc = loadDocument(mSceneName, mResourceGroup);
 
         // Durch alle Unterelemente iterieren
         DOMNode* child = doc-&gt;getDocumentElement()-&gt;getFirstChild();
@@ -96,7 +85,7 @@
         }
 
         LOG_DEBUG(Logger::CORE, &quot; Beginne parsen der Unterelemente&quot;);
-        DOMElement* nodes = XmlHelper::getChildNamed(doc-&gt;getDocumentElement(), &quot;nodes&quot;);
+        DOMElement* nodes = getChildNamed(doc-&gt;getDocumentElement(), &quot;nodes&quot;);
 
         // Eine .scene wird in einem SceneNode mit dem Namen der .scene befestigt
         mSceneNode = sceneManager-&gt;getRootSceneNode()-&gt;createChildSceneNode(mSceneName);
@@ -155,47 +144,11 @@
         else
             LOG_DEBUG(Logger::CORE, &quot; Keine statischen Geometrien erstellt&quot;);
 
-        delete mParser;
-        XMLPlatformUtils::Terminate();
+        doc-&gt;release();
+        shutdownXml();
         LOG_DEBUG(Logger::CORE, &quot;Szenenbeschreibung aus &quot; + mSceneName +&quot; fertig geparst&quot;);
     }
 
-    DOMDocument* DotSceneLoader::openSceneFile()
-    {
-        mParser = new XercesDOMParser();
-        mParser-&gt;setValidationScheme(XercesDOMParser::Val_Auto);
-        mParser-&gt;setDoNamespaces(true);
-        mParser-&gt;setErrorHandler(this);
-
-        try
-        {
-            mRessource =
-                XmlResourceManager::getSingleton().create(
-                mSceneName,
-                   mResourceGroup);
-        }
-        catch(Ogre::Exception)
-        {
-            Throw(IllegalArgumentException, &quot;RessourceGroup '&quot;+mResourceGroup+&quot;' does not exist.&quot;);
-        }
-
-        mRessource-&gt;load();
-
-        if (!mRessource-&gt;isLoaded())
-        {
-            Throw(FileNotFoundException, &quot;File '&quot;+mSceneName+&quot;' was not found.&quot;);
-        }
-
-        mRessource.getPointer()-&gt;parseBy(mParser);
-
-        if (mErrorCount &gt; 0)
-            Throw(RuntimeException, &quot;File '&quot;+mSceneName+&quot;' could not be parsed.&quot;);
-
-        DOMDocument* doc = mParser-&gt;getDocument();
-
-        return doc;
-    }
-
     // Iteriert durch die einzelnen Nodes
     void DotSceneLoader::processNodes(DOMElement* rootNodesXml, SceneManager* sceneManager,
         Ogre::SceneNode* parentNode)
@@ -228,7 +181,7 @@
         if (parentNode == NULL)
             Throw(NullPointerException, &quot;parentNode darf nicht null sein&quot;);
 
-        string nodeName = XmlHelper::getAttributeValueAsStdString(rootNodeXml,
+        string nodeName = getAttributeValueAsStdString(rootNodeXml,
                         &quot;name&quot;);
 
         Ogre::SceneNode* newNode;
@@ -421,7 +374,7 @@
                 AutoXMLCh(&quot;manualLOD&quot;).data()) == 0)
             {
                 DOMElement* lodXml = static_cast&lt;DOMElement*&gt;(child);
-                string meshName = XmlHelper::getAttributeValueAsStdString(lodXml,
+                string meshName = getAttributeValueAsStdString(lodXml,
                     &quot;mesh&quot;);
 
                 try
@@ -446,9 +399,9 @@
                             try
                             {
                                 lodXml = static_cast&lt;DOMElement*&gt;(lodchild);
-                                loddist = XmlHelper::getAttributeValueAsReal(lodXml,
+                                loddist = getAttributeValueAsReal(lodXml,
                                     &quot;distance&quot;);
-                                lodmeshName = XmlHelper::getAttributeValueAsStdString(lodXml,
+                                lodmeshName = getAttributeValueAsStdString(lodXml,
                                     &quot;mesh&quot;);
 
                                 if (lodmeshName.length() &gt; 0 &amp;&amp; loddist &gt; 0)
@@ -482,7 +435,6 @@
     {
         DOMNode* child = rootUserDataXml-&gt;getFirstChild();
         LOG_DEBUG(Logger::CORE, &quot; NodeUserData gefunden&quot;);
-        XmlPropertyReader* propertyReader = new XmlPropertyReader();
 
         // Durch alle Unterelemente iterieren, um die properties zu finden
         while(child != NULL)
@@ -492,7 +444,7 @@
                 AutoXMLCh(&quot;property&quot;).data()) == 0)
             {
                 DOMElement* propertyXml = static_cast&lt;DOMElement*&gt;(child);
-                PropertyEntry entry = propertyReader-&gt;processProperty(propertyXml);
+                PropertyEntry entry = processProperty(propertyXml);
 
                 try
                 {
@@ -519,8 +471,6 @@
 
             child = child-&gt;getNextSibling();
         }
-
-        delete propertyReader;
     }
 
     // eine benutzerdefinierte Collision
@@ -547,7 +497,7 @@
             }
             collision.setNull();
             // am Anfang steht ein Node mit dem Typ
-            std::string typeAsString = XmlHelper::transcodeToStdString(child-&gt;getNodeName());
+            std::string typeAsString = transcodeToStdString(child-&gt;getNodeName());
 
             scale = Ogre::Vector3::UNIT_SCALE;
             offset = Ogre::Vector3::ZERO;
@@ -788,9 +738,9 @@
         SceneManager* sceneManager, Ogre::SceneNode* parentNode,
         Ogre::Real renderingDistance, const std::string &amp;physical_body)
     {
-        string entName = XmlHelper::getAttributeValueAsStdString(
+        string entName = getAttributeValueAsStdString(
             rootEntityXml, &quot;name&quot;);
-        string meshName = XmlHelper::getAttributeValueAsStdString(
+        string meshName = getAttributeValueAsStdString(
             rootEntityXml, &quot;meshFile&quot;);
 
         Ogre::Entity* newEnt = NULL;
@@ -1009,14 +959,14 @@
 
         try
         {
-            if (XmlHelper::hasAttribute(rootPositionXml, &quot;x&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootPositionXml, &quot;y&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootPositionXml, &quot;z&quot;))
+            if (hasAttribute(rootPositionXml, &quot;x&quot;) &amp;&amp;
+                hasAttribute(rootPositionXml, &quot;y&quot;) &amp;&amp;
+                hasAttribute(rootPositionXml, &quot;z&quot;))
             {
                 return Ogre::Vector3(
-                    XmlHelper::getAttributeValueAsReal(rootPositionXml, &quot;x&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootPositionXml, &quot;y&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootPositionXml, &quot;z&quot;));
+                    getAttributeValueAsReal(rootPositionXml, &quot;x&quot;),
+                    getAttributeValueAsReal(rootPositionXml, &quot;y&quot;),
+                    getAttributeValueAsReal(rootPositionXml, &quot;z&quot;));
             }
         }
         catch(...) { }
@@ -1033,14 +983,14 @@
 
         try
         {
-            if (XmlHelper::hasAttribute(rootScaleXml, &quot;x&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootScaleXml, &quot;y&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootScaleXml, &quot;z&quot;))
+            if (hasAttribute(rootScaleXml, &quot;x&quot;) &amp;&amp;
+                hasAttribute(rootScaleXml, &quot;y&quot;) &amp;&amp;
+                hasAttribute(rootScaleXml, &quot;z&quot;))
             {
                 return Ogre::Vector3(
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, &quot;x&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, &quot;y&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, &quot;z&quot;));
+                    getAttributeValueAsReal(rootScaleXml, &quot;x&quot;),
+                    getAttributeValueAsReal(rootScaleXml, &quot;y&quot;),
+                    getAttributeValueAsReal(rootScaleXml, &quot;z&quot;));
             }
         }
         catch(...) { }
@@ -1056,15 +1006,15 @@
 
         try
         {
-            if (XmlHelper::hasAttribute(rootScaleXml, &quot;x&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootScaleXml, &quot;y&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootScaleXml, &quot;z&quot;))
+            if (hasAttribute(rootScaleXml, &quot;x&quot;) &amp;&amp;
+                hasAttribute(rootScaleXml, &quot;y&quot;) &amp;&amp;
+                hasAttribute(rootScaleXml, &quot;z&quot;))
             {
                 error = false;
                 return Ogre::Vector3(
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, &quot;x&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, &quot;y&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, &quot;z&quot;));
+                    getAttributeValueAsReal(rootScaleXml, &quot;x&quot;),
+                    getAttributeValueAsReal(rootScaleXml, &quot;y&quot;),
+                    getAttributeValueAsReal(rootScaleXml, &quot;z&quot;));
             }
         }
         catch(...) { }
@@ -1083,43 +1033,43 @@
         try
         {
             // Durch w,x,y,z definiert
-            if (XmlHelper::hasAttribute(rootQuatXml, &quot;qw&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootQuatXml, &quot;qx&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootQuatXml, &quot;qy&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootQuatXml, &quot;qz&quot;))
+            if (hasAttribute(rootQuatXml, &quot;qw&quot;) &amp;&amp;
+                hasAttribute(rootQuatXml, &quot;qx&quot;) &amp;&amp;
+                hasAttribute(rootQuatXml, &quot;qy&quot;) &amp;&amp;
+                hasAttribute(rootQuatXml, &quot;qz&quot;))
             {
 
                 return Ogre::Quaternion(
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;qw&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;qx&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;qy&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;qz&quot;));
+                    getAttributeValueAsReal(rootQuatXml, &quot;qw&quot;),
+                    getAttributeValueAsReal(rootQuatXml, &quot;qx&quot;),
+                    getAttributeValueAsReal(rootQuatXml, &quot;qy&quot;),
+                    getAttributeValueAsReal(rootQuatXml, &quot;qz&quot;));
             }
 
             // Durch axisX,axisY,axisZ,angle definiert
-            if (XmlHelper::hasAttribute(rootQuatXml, &quot;angle&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootQuatXml, &quot;axisX&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootQuatXml, &quot;axisY&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootQuatXml, &quot;axisZ&quot;))
+            if (hasAttribute(rootQuatXml, &quot;angle&quot;) &amp;&amp;
+                hasAttribute(rootQuatXml, &quot;axisX&quot;) &amp;&amp;
+                hasAttribute(rootQuatXml, &quot;axisY&quot;) &amp;&amp;
+                hasAttribute(rootQuatXml, &quot;axisZ&quot;))
             {
                 return Ogre::Quaternion(
-                    Ogre::Degree(XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;angle&quot;)),
+                    Ogre::Degree(getAttributeValueAsReal(rootQuatXml, &quot;angle&quot;)),
                     Ogre::Vector3(
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;axisX&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;axisY&quot;),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;axisZ&quot;)));
+                    getAttributeValueAsReal(rootQuatXml, &quot;axisX&quot;),
+                    getAttributeValueAsReal(rootQuatXml, &quot;axisY&quot;),
+                    getAttributeValueAsReal(rootQuatXml, &quot;axisZ&quot;)));
             }
 
             // Durch angleX,angleY,angleZ definiert
-            if (XmlHelper::hasAttribute(rootQuatXml, &quot;angleX&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootQuatXml, &quot;angleY&quot;) &amp;&amp;
-                XmlHelper::hasAttribute(rootQuatXml, &quot;angleZ&quot;) )
+            if (hasAttribute(rootQuatXml, &quot;angleX&quot;) &amp;&amp;
+                hasAttribute(rootQuatXml, &quot;angleY&quot;) &amp;&amp;
+                hasAttribute(rootQuatXml, &quot;angleZ&quot;) )
             {
                 Ogre::Matrix3 mat;
                 mat.FromEulerAnglesXYZ(
-                    Degree(XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;angleX&quot;)),
-                    Degree(XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;angleY&quot;)),
-                    Degree(XmlHelper::getAttributeValueAsReal(rootQuatXml, &quot;angleZ&quot;)));
+                    Degree(getAttributeValueAsReal(rootQuatXml, &quot;angleX&quot;)),
+                    Degree(getAttributeValueAsReal(rootQuatXml, &quot;angleY&quot;)),
+                    Degree(getAttributeValueAsReal(rootQuatXml, &quot;angleZ&quot;)));
                 return Quaternion(mat);
             }
         }
@@ -1129,39 +1079,5 @@
 
         return Ogre::Quaternion::IDENTITY;
     }
-
-
-    void DotSceneLoader::warning(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc)
-    {
-        LOG_MESSAGE(Logger::CORE, toString(&quot; warning &quot;, exc));
-    }
-    void DotSceneLoader::error(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc)
-    {
-        LOG_ERROR(Logger::CORE, toString(&quot;n error&quot;, exc));
-        mErrorCount++;
-    }
-    void DotSceneLoader::fatalError(const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc)
-    {
-        LOG_CRITICAL(Logger::CORE, toString(&quot; fatal error&quot;, exc));
-        mErrorCount++;
-    }
-    void DotSceneLoader::resetErrors()
-    {
-    }
-
-    std::string DotSceneLoader::toString(const std::string&amp; type,
-        const XERCES_CPP_NAMESPACE::SAXParseException&amp; exc) const
-    {
-        std::stringstream strs;
-        strs &lt;&lt; &quot;A&quot; &lt;&lt; type &lt;&lt; &quot; occured while parsing &quot; &lt;&lt; mSceneName
-             &lt;&lt; &quot; at line &quot; &lt;&lt; exc.getLineNumber() &lt;&lt; &quot; column &quot; &lt;&lt;  exc.getColumnNumber();
-
-        if (exc.getSystemId() != NULL)
-            strs &lt;&lt; &quot; with system &quot; &lt;&lt; XmlHelper::transcodeToStdString(exc.getSystemId());
-        if (exc.getPublicId() != NULL)
-            strs &lt;&lt; &quot; with public &quot; &lt;&lt; XmlHelper::transcodeToStdString(exc.getPublicId());
-
-        return strs.str();
-    }
 }
 

Modified: rl/trunk/engine/core/src/DotSceneOctreeWorld.cpp
===================================================================
--- rl/trunk/engine/core/src/DotSceneOctreeWorld.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/core/src/DotSceneOctreeWorld.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -71,14 +71,14 @@
 		}
     }
 
-    void DotSceneOctreeWorld::loadScene(const String&amp; levelName, const String&amp; module)
+    void DotSceneOctreeWorld::loadScene(const Ogre::String&amp; levelName, const Ogre::String&amp; module)
     {
         // Alte Szene l&#246;schen
         clearScene();
 
 		setCastShadows( true );
 
-        // Leerer String, keine Map laden
+        // Leerer Ogre::String, keine Map laden
         if (levelName.length() != 0)
         {
             /// TODO - In den Sky-Sonnenpart verschieben

Modified: rl/trunk/engine/rules/include/DsaDataLoader.h
===================================================================
--- rl/trunk/engine/rules/include/DsaDataLoader.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/rules/include/DsaDataLoader.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -21,6 +21,7 @@
 #include &lt;xercesc/dom/DOMElement.hpp&gt;
 
 #include &lt;OgreScriptLoader.h&gt;
+#include &quot;XmlHelper.h&quot;
 
 namespace rl {
 
@@ -28,7 +29,9 @@
 	class Person;
 	class Kampftechnik;
 
-    class XdimlLoader : public Ogre::ScriptLoader
+    class XdimlLoader 
+        : public Ogre::ScriptLoader,
+        private XmlProcessor
 	{
     public:
         XdimlLoader();
@@ -38,16 +41,16 @@
 		virtual Ogre::Real getLoadingOrder() const;
 
     private:
-		static int getEBeFromString(const Ogre::String&amp; eBeString);
+		int getEBeFromString(const Ogre::String&amp; eBeString);
 
-		static void initializeTalente(XERCES_CPP_NAMESPACE::DOMElement* rootTalente);
-		static Talent* processTalent(int gruppe, XERCES_CPP_NAMESPACE::DOMElement* talentXml);
+		void initializeTalente(XERCES_CPP_NAMESPACE::DOMElement* rootTalente);
+		Talent* processTalent(int gruppe, XERCES_CPP_NAMESPACE::DOMElement* talentXml);
 
-		static void initializePersonen(XERCES_CPP_NAMESPACE::DOMElement* rootPersonen);
-		static Person* processPerson(XERCES_CPP_NAMESPACE::DOMElement* talentXml);
+		void initializePersonen(XERCES_CPP_NAMESPACE::DOMElement* rootPersonen);
+		Person* processPerson(XERCES_CPP_NAMESPACE::DOMElement* talentXml);
 			
-		static void initializeKampftechniken(XERCES_CPP_NAMESPACE::DOMElement* rootKampftechniken);
-		static Kampftechnik* processKampftechnik(XERCES_CPP_NAMESPACE::DOMElement* kampftechnikXml);
+		void initializeKampftechniken(XERCES_CPP_NAMESPACE::DOMElement* rootKampftechniken);
+		Kampftechnik* processKampftechnik(XERCES_CPP_NAMESPACE::DOMElement* kampftechnikXml);
 
         Ogre::StringVector mScriptPatterns;
     };

Modified: rl/trunk/engine/rules/include/SaveGameFileWriter.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -26,7 +26,8 @@
 
 namespace rl
 {
-    class _RlRulesExport SaveGameFileWriter : public XmlPropertyWriter
+    class _RlRulesExport SaveGameFileWriter 
+        : protected XmlPropertyWriter
     {
     public:
         void buildSaveGameFile(SaveGameFile *file);

Modified: rl/trunk/engine/rules/src/DsaDataLoader.cpp
===================================================================
--- rl/trunk/engine/rules/src/DsaDataLoader.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/rules/src/DsaDataLoader.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -16,9 +16,6 @@
 #include &quot;stdinc.h&quot; //precompiled header
 
 #include &lt;xercesc/dom/DOM.hpp&gt;
-#include &lt;xercesc/parsers/XercesDOMParser.hpp&gt;
-#include &lt;xercesc/util/XMLString.hpp&gt;
-#include &lt;xercesc/util/PlatformUtils.hpp&gt;
 
 // #include &quot;XdimlLoader.h&quot;
 #include &quot;DsaDataLoader.h&quot;
@@ -54,28 +51,19 @@
 
     void XdimlLoader::parseScript(Ogre::DataStreamPtr &amp;stream, const Ogre::String &amp;groupName)
     {
-		XMLPlatformUtils::Initialize();
+        initializeXml();
 
-		XmlHelper::initializeTranscoder();
-		XercesDOMParser* parser = new XercesDOMParser();
-
-        parser-&gt;setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-        parser-&gt;setDoNamespaces(true);    // optional
-
-        OgreInputSource source(stream);
-        parser-&gt;parse(source);
-
-		DOMDocument* doc = parser-&gt;getDocument();
-		DOMElement* dataDocumentContent = XmlHelper::getChildNamed(
+		DOMDocument* doc = loadDocument(stream);
+		DOMElement* dataDocumentContent = getChildNamed(
             doc-&gt;getDocumentElement(), &quot;Inhalt&quot;);
 
-		initializeTalente(XmlHelper::getChildNamed(dataDocumentContent, &quot;Talente&quot;));
-		initializeKampftechniken(XmlHelper::getChildNamed(dataDocumentContent, &quot;Kampftechniken&quot;));
-		initializePersonen(XmlHelper::getChildNamed(dataDocumentContent, &quot;Personen&quot;));
+		initializeTalente(getChildNamed(dataDocumentContent, &quot;Talente&quot;));
+		initializeKampftechniken(getChildNamed(dataDocumentContent, &quot;Kampftechniken&quot;));
+		initializePersonen(getChildNamed(dataDocumentContent, &quot;Personen&quot;));
 
 		doc-&gt;release();
 
-		XMLPlatformUtils::Terminate();
+        shutdownXml();
     }
 
     const StringVector&amp; XdimlLoader::getScriptPatterns() const
@@ -112,17 +100,17 @@
 
     Talent* XdimlLoader::processTalent(int gruppe, DOMElement* talentXml)
     {
-		CeGuiString desc = XmlHelper::getValueAsString(XmlHelper::getChildNamed(talentXml, &quot;Beschreibung&quot;));
-        CeGuiString probe = XmlHelper::getValueAsString(XmlHelper::getChildNamed(talentXml, &quot;Probe&quot;));
-        CeGuiString art = XmlHelper::getValueAsString(XmlHelper::getChildNamed(talentXml, &quot;Art&quot;));
-		DOMElement* eBeNode = XmlHelper::getChildNamed(talentXml, &quot;eBE&quot;);
-        DOMElement* ausweichTalenteNode = static_cast&lt;DOMElement*&gt;(XmlHelper::getChildNamed(talentXml, &quot;Ausweichtalente&quot;));
+		CeGuiString desc = getValueAsString(getChildNamed(talentXml, &quot;Beschreibung&quot;));
+        CeGuiString probe = getValueAsString(getChildNamed(talentXml, &quot;Probe&quot;));
+        CeGuiString art = getValueAsString(getChildNamed(talentXml, &quot;Art&quot;));
+		DOMElement* eBeNode = getChildNamed(talentXml, &quot;eBE&quot;);
+        DOMElement* ausweichTalenteNode = static_cast&lt;DOMElement*&gt;(getChildNamed(talentXml, &quot;Ausweichtalente&quot;));
 
 		int ebe = EBE_KEINE_BE;
         if (eBeNode != NULL)
 			ebe = getEBeFromString(AutoChar(eBeNode-&gt;getFirstChild()-&gt;getNodeValue()).data());
 
-		CeGuiString name = XmlHelper::transcodeToString(
+		CeGuiString name = transcodeToString(
             talentXml-&gt;getAttribute(AutoXMLCh(&quot;ID&quot;).data()));
         EigenschaftTripel eigenschaften;
 		eigenschaften.first = probe.substr(0,2);
@@ -139,11 +127,11 @@
             for( unsigned int ausweich = 0; ausweich &lt; ausweichTalentGruppen-&gt;getLength(); ausweich++ )
             {
 			    DOMElement* ausweichData = static_cast&lt;DOMElement*&gt;(ausweichTalentGruppen-&gt;item(ausweich));
-	            CeGuiString ausweichName = XmlHelper::transcodeToString(
+	            CeGuiString ausweichName = transcodeToString(
                     ausweichData-&gt;getAttribute(AutoXMLCh(&quot;ID&quot;).data()));
 
                 ausweichTalente[ausweichName] = 
-                    XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(ausweichData, &quot;Aufschlag&quot;));
+                    getValueAsInteger(getChildNamed(ausweichData, &quot;Aufschlag&quot;));
             }
         }
 
@@ -200,14 +188,14 @@
 
 	Kampftechnik* XdimlLoader::processKampftechnik(DOMElement* kampftechnikXml)
 	{
-		CeGuiString desc = XmlHelper::getValueAsString(XmlHelper::getChildNamed(kampftechnikXml, &quot;Beschreibung&quot;));
-		CeGuiString art = XmlHelper::getValueAsString(XmlHelper::getChildNamed(kampftechnikXml, &quot;Art&quot;));
-		DOMElement* eBeNode = XmlHelper::getChildNamed(kampftechnikXml, &quot;eBE&quot;);
+		CeGuiString desc = getValueAsString(getChildNamed(kampftechnikXml, &quot;Beschreibung&quot;));
+		CeGuiString art = getValueAsString(getChildNamed(kampftechnikXml, &quot;Art&quot;));
+		DOMElement* eBeNode = getChildNamed(kampftechnikXml, &quot;eBE&quot;);
 		int ebe = EBE_KEINE_BE;
 		if (eBeNode != NULL)
 			ebe = getEBeFromString(AutoChar(eBeNode-&gt;getFirstChild()-&gt;getNodeValue()).data());
 
-		CeGuiString name = XmlHelper::transcodeToString(
+		CeGuiString name = transcodeToString(
             kampftechnikXml-&gt;getAttribute(AutoXMLCh(&quot;ID&quot;).data()));
 
 		Kampftechnik* k = new Kampftechnik(
@@ -244,9 +232,9 @@
 		AutoXMLCh EIGENSCHAFT = &quot;Eigenschaft&quot;;
 
 		CeGuiString name =
-			XmlHelper::getValueAsString(XmlHelper::getChildNamed(personXml, &quot;Name&quot;));
+			getValueAsString(getChildNamed(personXml, &quot;Name&quot;));
 		CeGuiString desc =
-			XmlHelper::getValueAsString(XmlHelper::getChildNamed(personXml, &quot;Beschreibung&quot;));
+			getValueAsString(getChildNamed(personXml, &quot;Beschreibung&quot;));
 
         //@warning replace this by correct loading process
 		Person* rval = new Person(10000);
@@ -255,13 +243,13 @@
 
 		// Eigenschaften laden
 		DOMNodeList* eigensch =
-			XmlHelper::getChildNamed(personXml, &quot;Eigenschaften&quot;)-&gt;
+			getChildNamed(personXml, &quot;Eigenschaften&quot;)-&gt;
 				getElementsByTagName(EIGENSCHAFT.data());
 		// Die Eigenschaftsnamen mssen durch ihre Abkrzung ersetzt werden.
 		for (unsigned int idx = 0; idx &lt; eigensch-&gt;getLength(); idx++)
 		{
 			DOMElement* eigenschXml = static_cast&lt;DOMElement*&gt;(eigensch-&gt;item(idx));
-			CeGuiString eigName = XmlHelper::transcodeToString(eigenschXml-&gt;getAttribute(ID.data()));
+			CeGuiString eigName = transcodeToString(eigenschXml-&gt;getAttribute(ID.data()));
 			if (eigName == DsaManager::getSingleton().getEigenschaft(E_MUT)-&gt;getName())
 				eigName = DsaManager::getSingleton().getEigenschaft(E_MUT)-&gt;getNameAbbreviation();
 			if (eigName == DsaManager::getSingleton().getEigenschaft(E_KLUGHEIT)-&gt;getName())
@@ -278,20 +266,20 @@
 				eigName = DsaManager::getSingleton().getEigenschaft(E_KONSTITUTION)-&gt;getNameAbbreviation();
 			if (eigName == DsaManager::getSingleton().getEigenschaft(E_KOERPERKRAFT)-&gt;getName())
 				eigName = DsaManager::getSingleton().getEigenschaft(E_KOERPERKRAFT)-&gt;getNameAbbreviation();
-			int wert = XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(eigenschXml, &quot;Wert&quot;));
+			int wert = getValueAsInteger(getChildNamed(eigenschXml, &quot;Wert&quot;));
 
 			rval-&gt;setEigenschaft(eigName, wert);
 		}
 
 		// Abgeleitete Werte laden
 		DOMNodeList* werte =
-			XmlHelper::getChildNamed(personXml, &quot;AbgeleiteteWerte&quot;)-&gt;
+			getChildNamed(personXml, &quot;AbgeleiteteWerte&quot;)-&gt;
 				getElementsByTagName(ABGELEITETER_WERT.data());
 		for (unsigned int idx = 0; idx &lt; werte-&gt;getLength(); idx++)
 		{
 			DOMElement* wertXml = static_cast&lt;DOMElement*&gt;(werte-&gt;item(idx));
-			int basis = XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(wertXml, &quot;Basiswert&quot;));
-			int wert = XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(wertXml, &quot;Wert&quot;));
+			int basis = getValueAsInteger(getChildNamed(wertXml, &quot;Basiswert&quot;));
+			int wert = getValueAsInteger(getChildNamed(wertXml, &quot;Wert&quot;));
 
 			AutoChar wertId = wertXml-&gt;getAttribute(ID.data());
 			if (strcmp(wertId.data(), &quot;Lebensenergie&quot;) == 0)
@@ -318,13 +306,13 @@
 		// Talente, die direkt unter &lt;Person&gt; angeordnet sind,
         // ergeben bereits die zusammengefassten Werte
 		DOMNodeList* talente =
-			XmlHelper::getChildNamed(personXml, &quot;Talente&quot;)-&gt;
+			getChildNamed(personXml, &quot;Talente&quot;)-&gt;
 				getElementsByTagName(TALENT.data());
 		for (unsigned int idx = 0; idx &lt; talente-&gt;getLength(); idx++)
 		{
 			DOMElement* talentXml = static_cast&lt;DOMElement*&gt;(talente-&gt;item(idx));
 
-			CeGuiString talentName = XmlHelper::transcodeToString(
+			CeGuiString talentName = transcodeToString(
                 talentXml-&gt;getAttribute(ID.data()));
 
 			Talent* tal =
@@ -333,7 +321,7 @@
 			rval-&gt;addTalent(talentName);
 			rval-&gt;setTalent(
 				talentName,
-				XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(talentXml, &quot;Wert&quot;)));
+				getValueAsInteger(getChildNamed(talentXml, &quot;Wert&quot;)));
 		}
 		return rval;
 	}

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -44,16 +44,14 @@
     void SaveGameFileWriter::buildSaveGameFile(SaveGameFile *file)
     {
         //@toto: build
-        XMLPlatformUtils::Initialize();
+        initializeXml();
 
-        XmlHelper::initializeTranscoder();
-
         XMLCh tempStr[100];
         XMLString::transcode(&quot;LS&quot;, tempStr, 99);
         mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
-        mWriter = ((DOMImplementationLS*)mImplementation)-&gt;createDOMWriter();
+        mWriter = static_cast&lt;DOMImplementationLS*&gt;(mImplementation)-&gt;createDOMWriter();
         mTarget = file-&gt;getFormatTarget();
-        mDocument = ((DOMImplementation*)mImplementation)-&gt;createDocument(0, XMLString::transcode(&quot;SaveGameFile&quot;), 0);
+        mDocument = static_cast&lt;DOMImplementation*&gt;(mImplementation)-&gt;createDocument(0, XMLString::transcode(&quot;SaveGameFile&quot;), 0);
         mDocument-&gt;setNodeValue(XMLString::transcode(&quot;SaveGameFile&quot;));
 
         if (mWriter-&gt;canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
@@ -63,12 +61,12 @@
              mWriter-&gt;setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
 
         //Write modul of save game
-        DOMElement* header = XmlHelper::appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;header&quot;);
-        XmlHelper::setAttributeValueAsString(header, &quot;ModuleID&quot;, CoreSubsystem::getSingleton().getActiveAdventureModule()-&gt;getId());
-        XmlHelper::setAttributeValueAsInteger(header, &quot;EngineVersion&quot;, CoreSubsystem::getSingleton().getEngineBuildNumber());
+        DOMElement* header = appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;header&quot;);
+        setAttributeValueAsString(header, &quot;ModuleID&quot;, CoreSubsystem::getSingleton().getActiveAdventureModule()-&gt;getId());
+        setAttributeValueAsInteger(header, &quot;EngineVersion&quot;, CoreSubsystem::getSingleton().getEngineBuildNumber());
         
         //Write date and time
-        DOMElement* timeNode = XmlHelper::appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;time&quot;);
+        DOMElement* timeNode = appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;time&quot;);
         
         time_t rawtime;
         tm* timeinfo;
@@ -76,22 +74,22 @@
         time ( &amp;rawtime );
         timeinfo = localtime ( &amp;rawtime );
 
-        XmlHelper::setAttributeValueAsInteger(timeNode, &quot;day&quot;, timeinfo-&gt;tm_mday);
-        XmlHelper::setAttributeValueAsInteger(timeNode, &quot;month&quot;, timeinfo-&gt;tm_mon);
-        XmlHelper::setAttributeValueAsInteger(timeNode, &quot;year&quot;, timeinfo-&gt;tm_year+1900);
+        setAttributeValueAsInteger(timeNode, &quot;day&quot;, timeinfo-&gt;tm_mday);
+        setAttributeValueAsInteger(timeNode, &quot;month&quot;, timeinfo-&gt;tm_mon);
+        setAttributeValueAsInteger(timeNode, &quot;year&quot;, timeinfo-&gt;tm_year+1900);
 
-        XmlHelper::setAttributeValueAsInteger(timeNode, &quot;hour&quot;, timeinfo-&gt;tm_hour);
-        XmlHelper::setAttributeValueAsInteger(timeNode, &quot;minute&quot;, timeinfo-&gt;tm_min);
-        XmlHelper::setAttributeValueAsInteger(timeNode, &quot;second&quot;, timeinfo-&gt;tm_sec);
+        setAttributeValueAsInteger(timeNode, &quot;hour&quot;, timeinfo-&gt;tm_hour);
+        setAttributeValueAsInteger(timeNode, &quot;minute&quot;, timeinfo-&gt;tm_min);
+        setAttributeValueAsInteger(timeNode, &quot;second&quot;, timeinfo-&gt;tm_sec);
 
         //Write globals
-        DOMElement* globals = XmlHelper::appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;globals&quot;);
-        DOMElement* gameTime = XmlHelper::appendChildElement(mDocument, globals, &quot;gametime&quot;);
+        DOMElement* globals = appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;globals&quot;);
+        DOMElement* gameTime = appendChildElement(mDocument, globals, &quot;gametime&quot;);
         TimeSource* gameTimeSource = TimeSourceManager::getSingleton().getTimeSource(TimeSource::GAMETIME);
-        XmlHelper::setAttributeValueAsInteger(gameTime, &quot;milliseconds&quot;, gameTimeSource-&gt;getClock());
+        setAttributeValueAsInteger(gameTime, &quot;milliseconds&quot;, gameTimeSource-&gt;getClock());
 
         //Write Quests
-        DOMElement* quests = XmlHelper::appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;quests&quot;);
+        DOMElement* quests = appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;quests&quot;);
         QuestBook* questBook = RulesSubsystem::getSingleton().getQuestBook();
         PropertySet* set = questBook-&gt;getAllProperties();
         PropertySetMap::const_iterator it_quests;
@@ -101,7 +99,7 @@
         }
 
         //Write game objects
-        DOMElement* gameobjects = XmlHelper::appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;gameobjects&quot;);
+        DOMElement* gameobjects = appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;gameobjects&quot;);
         
         std::list&lt;const GameObject*&gt;::const_iterator it_gameobjects;
         std::list&lt;const GameObject*&gt; gos;
@@ -109,9 +107,9 @@
 
         for(it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
         {
-            DOMElement* gameobject = XmlHelper::appendChildElement(mDocument, gameobjects, &quot;gameobject&quot;);
-            XmlHelper::setAttributeValueAsInteger(gameobject, &quot;ID&quot;, (*it_gameobjects)-&gt;getId());
-            XmlHelper::setAttributeValueAsString(gameobject, &quot;ClassID&quot;, (*it_gameobjects)-&gt;getClassId());
+            DOMElement* gameobject = appendChildElement(mDocument, gameobjects, &quot;gameobject&quot;);
+            setAttributeValueAsInteger(gameobject, &quot;ID&quot;, (*it_gameobjects)-&gt;getId());
+            setAttributeValueAsString(gameobject, &quot;ClassID&quot;, (*it_gameobjects)-&gt;getClassId());
 
             PropertyMap map = (*it_gameobjects)-&gt;getAllProperties()-&gt;toPropertyMap();
             PropertyMap::iterator it_properties;
@@ -124,11 +122,16 @@
         //Write Zones?
 
         //Write scripts
-        DOMElement* scripts = XmlHelper::appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;scripts&quot;);
+        DOMElement* scripts = appendChildElement(mDocument, mDocument-&gt;getDocumentElement(), &quot;scripts&quot;);
 
         mWriter-&gt;writeNode(mTarget, *mDocument);
 
         mWriter-&gt;release();
         delete mTarget;
+
+        mDocument-&gt;release();
+        delete mDocument;
+
+        shutdownXml();
     }
 }

Modified: rl/trunk/engine/script/include/AbstractMapNodeProcessor.h
===================================================================
--- rl/trunk/engine/script/include/AbstractMapNodeProcessor.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/include/AbstractMapNodeProcessor.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -22,11 +22,14 @@
 
 #include &lt;OgreSceneNode.h&gt;
 
+#include &quot;PropertyReader.h&quot;
+
 namespace rl
 {
     class XmlPropertyReader;
 
     class AbstractMapNodeProcessor
+        : protected XmlPropertyReader
     {
     public:
         virtual ~AbstractMapNodeProcessor();
@@ -45,11 +48,8 @@
         
         Ogre::SceneNode* getRootSceneNode() const;
         
-        XmlPropertyReader* getXmlPropertyReader() const;
-    
     private:
         Ogre::SceneNode* mRootSceneNode;
-        XmlPropertyReader* mXmlPropertyReader;
     };
 }
 

Modified: rl/trunk/engine/script/include/MapLoader.h
===================================================================
--- rl/trunk/engine/script/include/MapLoader.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/include/MapLoader.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -22,14 +22,14 @@
 
 #include &lt;OgreSceneNode.h&gt;
 #include &lt;list&gt;
+#include &quot;XmlHelper.h&quot;
 
 namespace rl {
 
     class AbstractMapNodeProcessor;
     class ProgressWindow;
-    class XmlPropertyReader;
 
-    class _RlScriptExport MapLoader 
+    class _RlScriptExport MapLoader : private XmlProcessor 
     {
     public:
         MapLoader(const Ogre::String&amp; resourceGroup);
@@ -43,7 +43,6 @@
         void loadMap(const Ogre::String&amp; mapresource, bool loadGameObjects = true);
 
     private:
-        XmlPropertyReader* mXmlPropertyProcessor;
         std::list&lt;AbstractMapNodeProcessor*&gt; mNodeProcessors;
 
         Ogre::SceneNode* mRootSceneNode;

Modified: rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -19,9 +19,6 @@
 
 #include &lt;OgreColourValue.h&gt;
 
-#include &quot;PropertyReader.h&quot;
-#include &quot;XmlHelper.h&quot;
-
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
 
@@ -29,13 +26,12 @@
 {
     AbstractMapNodeProcessor::AbstractMapNodeProcessor()
     : mRootSceneNode(NULL),
-      mXmlPropertyReader()
+      XmlPropertyReader()
     {
     }
 
     AbstractMapNodeProcessor::~AbstractMapNodeProcessor()
     {
-        delete mXmlPropertyReader;
     }
 
     Vector3 AbstractMapNodeProcessor::processVector3(DOMElement* vec3Elem) const
@@ -43,17 +39,17 @@
         Vector3 rval(Vector3::ZERO);
         if (vec3Elem != NULL)
         {
-            if (XmlHelper::hasAttribute(vec3Elem, &quot;x&quot;))
+            if (hasAttribute(vec3Elem, &quot;x&quot;))
             {
-                rval.x = XmlHelper::getAttributeValueAsReal(vec3Elem, &quot;x&quot;);
+                rval.x = getAttributeValueAsReal(vec3Elem, &quot;x&quot;);
             }
-            if (XmlHelper::hasAttribute(vec3Elem, &quot;y&quot;))
+            if (hasAttribute(vec3Elem, &quot;y&quot;))
             {
-                rval.y = XmlHelper::getAttributeValueAsReal(vec3Elem, &quot;y&quot;);
+                rval.y = getAttributeValueAsReal(vec3Elem, &quot;y&quot;);
             }
-            if (XmlHelper::hasAttribute(vec3Elem, &quot;z&quot;))
+            if (hasAttribute(vec3Elem, &quot;z&quot;))
             {
-                rval.z = XmlHelper::getAttributeValueAsReal(vec3Elem, &quot;z&quot;);
+                rval.z = getAttributeValueAsReal(vec3Elem, &quot;z&quot;);
             }
         }
 
@@ -65,21 +61,21 @@
         Quaternion rval(Quaternion::IDENTITY);
         if (quatElem != NULL)
         {
-            if (XmlHelper::hasAttribute(quatElem, &quot;qw&quot;))
+            if (hasAttribute(quatElem, &quot;qw&quot;))
             {
-                rval.w = XmlHelper::getAttributeValueAsReal(quatElem, &quot;qw&quot;);
+                rval.w = getAttributeValueAsReal(quatElem, &quot;qw&quot;);
             }
-            if (XmlHelper::hasAttribute(quatElem, &quot;qx&quot;))
+            if (hasAttribute(quatElem, &quot;qx&quot;))
             {
-                rval.x = XmlHelper::getAttributeValueAsReal(quatElem, &quot;qx&quot;);
+                rval.x = getAttributeValueAsReal(quatElem, &quot;qx&quot;);
             }
-            if (XmlHelper::hasAttribute(quatElem, &quot;qy&quot;))
+            if (hasAttribute(quatElem, &quot;qy&quot;))
             {
-                rval.y = XmlHelper::getAttributeValueAsReal(quatElem, &quot;qy&quot;);
+                rval.y = getAttributeValueAsReal(quatElem, &quot;qy&quot;);
             }
-            if (XmlHelper::hasAttribute(quatElem, &quot;qz&quot;))
+            if (hasAttribute(quatElem, &quot;qz&quot;))
             {
-                rval.z = XmlHelper::getAttributeValueAsReal(quatElem, &quot;qz&quot;);
+                rval.z = getAttributeValueAsReal(quatElem, &quot;qz&quot;);
             }
         }
 
@@ -91,21 +87,21 @@
         ColourValue rval(1, 1, 1, 1);
         if (colElem != NULL)
         {
-            if (XmlHelper::hasAttribute(colElem, &quot;r&quot;))
+            if (hasAttribute(colElem, &quot;r&quot;))
             {
-                rval.r = XmlHelper::getAttributeValueAsReal(colElem, &quot;r&quot;);
+                rval.r = getAttributeValueAsReal(colElem, &quot;r&quot;);
             }
-            if (XmlHelper::hasAttribute(colElem, &quot;g&quot;))
+            if (hasAttribute(colElem, &quot;g&quot;))
             {
-                rval.g = XmlHelper::getAttributeValueAsReal(colElem, &quot;g&quot;);
+                rval.g = getAttributeValueAsReal(colElem, &quot;g&quot;);
             }
-            if (XmlHelper::hasAttribute(colElem, &quot;b&quot;))
+            if (hasAttribute(colElem, &quot;b&quot;))
             {
-                rval.b = XmlHelper::getAttributeValueAsReal(colElem, &quot;b&quot;);
+                rval.b = getAttributeValueAsReal(colElem, &quot;b&quot;);
             }
-            if (XmlHelper::hasAttribute(colElem, &quot;a&quot;))
+            if (hasAttribute(colElem, &quot;a&quot;))
             {
-                rval.a = XmlHelper::getAttributeValueAsReal(colElem, &quot;a&quot;);
+                rval.a = getAttributeValueAsReal(colElem, &quot;a&quot;);
             }
         }
         return rval;
@@ -129,9 +125,4 @@
     {
         return mRootSceneNode;
     }
-
-    XmlPropertyReader* AbstractMapNodeProcessor::getXmlPropertyReader() const
-    {
-        return mXmlPropertyReader;
-    }
 }

Modified: rl/trunk/engine/script/src/EntityNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/EntityNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/EntityNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -25,7 +25,6 @@
 #include &quot;CoreSubsystem.h&quot;
 #include &quot;PhysicsManager.h&quot;
 #include &quot;World.h&quot;
-#include &quot;XmlHelper.h&quot;
 
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
@@ -40,37 +39,37 @@
 
     bool EntityNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-        if (!XmlHelper::hasNodeName(nodeElem, &quot;entity&quot;))
+        if (!hasNodeName(nodeElem, &quot;entity&quot;))
         {
             return false;
         }
 
-        Ogre::String entName = XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;name&quot;);
+        Ogre::String entName = getAttributeValueAsStdString(nodeElem, &quot;name&quot;);
 
         LOG_DEBUG(Logger::RULES,
             &quot;Processing entity node &quot;
                 + entName);
 
-        if (!XmlHelper::hasAttribute(nodeElem, &quot;meshfile&quot;))
+        if (!hasAttribute(nodeElem, &quot;meshfile&quot;))
         {
             LOG_ERROR(Logger::RULES, &quot;Entity node defines no meshfile attribute&quot;);
             return false;
         }
 
-        Ogre::String meshFile = XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;meshfile&quot;);
+        Ogre::String meshFile = getAttributeValueAsStdString(nodeElem, &quot;meshfile&quot;);
         if (entName == &quot;&quot;)
         {
             entName = getRandomName(meshFile);
         }
 
         //Actor* act = ActorManager::getSingleton().createMeshActor(
-        //    XmlHelper::getAttributeValueAsStdString(entityElem, &quot;name&quot;),
+        //    getAttributeValueAsStdString(entityElem, &quot;name&quot;),
         //    meshFile); ///@todo: Collision proxy
 
         Vector3 position(Vector3::ZERO);
         Quaternion orientation(Quaternion::IDENTITY);
 
-        DOMElement* posElem = XmlHelper::getChildNamed(nodeElem, &quot;position&quot;);
+        DOMElement* posElem = getChildNamed(nodeElem, &quot;position&quot;);
         if (posElem != NULL)
         {
             position = processVector3(posElem);
@@ -80,7 +79,7 @@
             LOG_WARNING(Logger::RULES, &quot;No position given for entity, used (0,0,0)&quot;);
         }
 
-        DOMElement* oriElem = XmlHelper::getChildNamed(nodeElem, &quot;rotation&quot;);
+        DOMElement* oriElem = getChildNamed(nodeElem, &quot;rotation&quot;);
         if (oriElem != NULL)
         {
             orientation = processQuaternion(oriElem);
@@ -121,9 +120,9 @@
         }
 
         parentNode-&gt;attachObject(newEnt);
-        createCollision(newEnt, meshFile, XmlHelper::getChildNamed(nodeElem, &quot;physicsproxy&quot;));
+        createCollision(newEnt, meshFile, getChildNamed(nodeElem, &quot;physicsproxy&quot;));
 
-        DOMElement* scaleElem = XmlHelper::getChildNamed(nodeElem, &quot;scale&quot;);
+        DOMElement* scaleElem = getChildNamed(nodeElem, &quot;scale&quot;);
         if (scaleElem != NULL)
         {
             parentNode-&gt;scale(processVector3(scaleElem));
@@ -148,13 +147,13 @@
         std::vector&lt;OgreNewt::CollisionPtr&gt; collisions;
 
         Ogre::String physicsProxyType;
-        if (physicsProxyElem == NULL || !XmlHelper::hasAttribute(physicsProxyElem, &quot;type&quot;))
+        if (physicsProxyElem == NULL || !hasAttribute(physicsProxyElem, &quot;type&quot;))
         {
             physicsProxyType = &quot;auto&quot;;
         }
         else
         {
-            physicsProxyType = XmlHelper::getAttributeValueAsStdString(physicsProxyElem, &quot;type&quot;);
+            physicsProxyType = getAttributeValueAsStdString(physicsProxyElem, &quot;type&quot;);
         }
 
         // ------- Falls noetig automatisch bodyproxy erstellen -------------

Modified: rl/trunk/engine/script/src/EnvironmentProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/EnvironmentProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/EnvironmentProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -31,8 +31,8 @@
 	{
 		if (nodeElem)
 		{
-		    processSkySettings(XmlHelper::getChildNamed(nodeElem, &quot;sky&quot;));
-		    processFogSettings(XmlHelper::getChildNamed(nodeElem, &quot;fog&quot;));
+		    processSkySettings(getChildNamed(nodeElem, &quot;sky&quot;));
+		    processFogSettings(getChildNamed(nodeElem, &quot;fog&quot;));
         }
 
 		return true;
@@ -43,26 +43,26 @@
         if (skyElem)
 		{
 
-		    if (!XmlHelper::hasAttribute(skyElem, &quot;material&quot;)
-			    || !XmlHelper::hasAttribute(skyElem, &quot;type&quot;))
+		    if (!hasAttribute(skyElem, &quot;material&quot;)
+			    || !hasAttribute(skyElem, &quot;type&quot;))
 		    {
 			    LOG_ERROR(Logger::RULES, &quot;&lt;sky&gt; element must have at least attributes 'type' and 'material'.&quot;);
 		    }
 		    else
 		    {
-			    Ogre::String type = XmlHelper::getAttributeValueAsStdString(skyElem, &quot;type&quot;);
-			    Ogre::String material = XmlHelper::getAttributeValueAsStdString(skyElem, &quot;material&quot;);
+			    Ogre::String type = getAttributeValueAsStdString(skyElem, &quot;type&quot;);
+			    Ogre::String material = getAttributeValueAsStdString(skyElem, &quot;material&quot;);
 
 			    bool drawFirst = true;
-			    if (XmlHelper::hasAttribute(skyElem, &quot;drawfirst&quot;))
+			    if (hasAttribute(skyElem, &quot;drawfirst&quot;))
 			    {
-				    drawFirst = XmlHelper::getAttributeValueAsBool(skyElem, &quot;drawfirst&quot;);
+				    drawFirst = getAttributeValueAsBool(skyElem, &quot;drawfirst&quot;);
 			    }
 
 			    Ogre::Real distance = 5000;
-			    if (XmlHelper::hasAttribute(skyElem, &quot;distance&quot;))
+			    if (hasAttribute(skyElem, &quot;distance&quot;))
 			    {
-				    distance = XmlHelper::getAttributeValueAsReal(skyElem, &quot;distance&quot;);
+				    distance = getAttributeValueAsReal(skyElem, &quot;distance&quot;);
 			    }
 
 			    if (type == &quot;dome&quot;)
@@ -70,16 +70,16 @@
 				    Ogre::Real curvature = 10;
 				    Ogre::Real tiling = 8;
 
-				    DOMElement* domeSettings = XmlHelper::getChildNamed(skyElem, &quot;skydomesettings&quot;);
+				    DOMElement* domeSettings = getChildNamed(skyElem, &quot;skydomesettings&quot;);
 				    if (domeSettings != NULL)
 				    {
-					    if (XmlHelper::hasAttribute(domeSettings, &quot;curvature&quot;))
+					    if (hasAttribute(domeSettings, &quot;curvature&quot;))
 					    {
-						    curvature = XmlHelper::getAttributeValueAsReal(domeSettings, &quot;curvature&quot;);
+						    curvature = getAttributeValueAsReal(domeSettings, &quot;curvature&quot;);
 					    }
-					    if (XmlHelper::hasAttribute(domeSettings, &quot;tiling&quot;))
+					    if (hasAttribute(domeSettings, &quot;tiling&quot;))
 					    {
-						    curvature = XmlHelper::getAttributeValueAsReal(domeSettings, &quot;tiling&quot;);
+						    curvature = getAttributeValueAsReal(domeSettings, &quot;tiling&quot;);
 					    }
 				    }
 				    CoreSubsystem::getSingleton().getWorld()-&gt;setSkyDome(
@@ -102,7 +102,7 @@
 	{
         if (fogElem)
         {
-		    if (!XmlHelper::hasAttribute(fogElem, &quot;material&quot;))
+		    if (!hasAttribute(fogElem, &quot;material&quot;))
 		    {
 			    LOG_ERROR(
 				    Logger::RULES,
@@ -110,7 +110,7 @@
 			    return;
 		    }
 
-		    DOMElement* colourElem = XmlHelper::getChildNamed(fogElem, &quot;colour&quot;);
+		    DOMElement* colourElem = getChildNamed(fogElem, &quot;colour&quot;);
 		    if (colourElem == NULL)
 		    {
 			    LOG_ERROR(Logger::RULES, &quot;No fog colour set.&quot;);
@@ -118,12 +118,12 @@
 		    }
 		    ColourValue fogColour = processColour(colourElem);
 
-		    Ogre::String type = XmlHelper::getAttributeValueAsStdString(fogElem, &quot;type&quot;);
+		    Ogre::String type = getAttributeValueAsStdString(fogElem, &quot;type&quot;);
 		    if (type == &quot;exp&quot; || type == &quot;exp2&quot;)
 		    {
-			    if (XmlHelper::hasAttribute(fogElem, &quot;density&quot;))
+			    if (hasAttribute(fogElem, &quot;density&quot;))
 			    {
-				    Ogre::Real density = XmlHelper::getAttributeValueAsReal(fogElem, &quot;density&quot;);
+				    Ogre::Real density = getAttributeValueAsReal(fogElem, &quot;density&quot;);
 				    if (type == &quot;exp&quot;)
 				    {
 					    CoreSubsystem::getSingleton().getWorld()-&gt;setFog(
@@ -143,11 +143,11 @@
 		    }
 		    else if (type == &quot;linear&quot;)
 		    {
-			    if (XmlHelper::hasAttribute(fogElem, &quot;start&quot;)
-				    &amp;&amp; XmlHelper::hasAttribute(fogElem, &quot;end&quot;))
+			    if (hasAttribute(fogElem, &quot;start&quot;)
+				    &amp;&amp; hasAttribute(fogElem, &quot;end&quot;))
 			    {
-				    Ogre::Real start = XmlHelper::getAttributeValueAsReal(fogElem, &quot;start&quot;);
-				    Ogre::Real end = XmlHelper::getAttributeValueAsReal(fogElem, &quot;end&quot;);
+				    Ogre::Real start = getAttributeValueAsReal(fogElem, &quot;start&quot;);
+				    Ogre::Real end = getAttributeValueAsReal(fogElem, &quot;end&quot;);
 				    CoreSubsystem::getSingleton().getWorld()-&gt;setFog(
 					    World::FOG_LINEAR, fogColour, 0, start, end);
 			    }

Modified: rl/trunk/engine/script/src/GameObjectNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/GameObjectNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/GameObjectNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -21,8 +21,6 @@
 
 #include &quot;GameObject.h&quot;
 #include &quot;GameObjectManager.h&quot;
-#include &quot;PropertyReader.h&quot;
-#include &quot;XmlHelper.h&quot;
 
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
@@ -31,34 +29,34 @@
 {
     bool GameObjectNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-        if (!XmlHelper::hasNodeName(nodeElem, &quot;gameobject&quot;))
+        if (!hasNodeName(nodeElem, &quot;gameobject&quot;))
         {
             return false;
         }
 
         LOG_DEBUG(Logger::RULES,
             &quot;Processing game object node &quot;
-                + XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;name&quot;));
+                + getAttributeValueAsStdString(nodeElem, &quot;name&quot;));
 
-        Ogre::String classname = XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;class&quot;);
+        Ogre::String classname = getAttributeValueAsStdString(nodeElem, &quot;class&quot;);
 
         unsigned int goid = GameObject::NO_OBJECT_ID;
 
-        if (XmlHelper::hasAttribute(nodeElem, &quot;id&quot;))
+        if (hasAttribute(nodeElem, &quot;id&quot;))
         {
-            goid = XmlHelper::getAttributeValueAsInteger(nodeElem, &quot;id&quot;);
+            goid = getAttributeValueAsInteger(nodeElem, &quot;id&quot;);
         }
 
         GameObject* go = GameObjectManager::getSingleton().createGameObject(classname, goid);
 
-        DOMElement* posElem = XmlHelper::getChildNamed(nodeElem, &quot;position&quot;);
+        DOMElement* posElem = getChildNamed(nodeElem, &quot;position&quot;);
         if (posElem != NULL)
         {
             Vector3 pos = processVector3(posElem);
             go-&gt;setPosition(pos);
         }
 
-        DOMElement* oriElem = XmlHelper::getChildNamed(nodeElem, &quot;rotation&quot;);
+        DOMElement* oriElem = getChildNamed(nodeElem, &quot;rotation&quot;);
         if (oriElem != NULL)
         {
             Quaternion ori = processQuaternion(oriElem);
@@ -70,9 +68,9 @@
         {
             DOMNode* cur = goElChildNodes-&gt;item(idx);
             if (cur-&gt;getNodeType() == DOMNode::ENTITY_NODE
-                &amp;&amp; XmlHelper::hasNodeName(cur, &quot;property&quot;))
+                &amp;&amp; hasNodeName(cur, &quot;property&quot;))
             {
-                PropertyEntry propEntry = getXmlPropertyReader()-&gt;processProperty(static_cast&lt;DOMElement*&gt;(cur));
+                PropertyEntry propEntry = processProperty(static_cast&lt;DOMElement*&gt;(cur));
                 if (propEntry.first != &quot;&quot;)
                 {
                     go-&gt;setProperty(propEntry.first, propEntry.second);
@@ -81,9 +79,9 @@
         }
 
 		GameObjectState state = GOS_LOADED;
-		if (XmlHelper::hasAttribute(nodeElem, &quot;state&quot;))
+		if (hasAttribute(nodeElem, &quot;state&quot;))
 		{
-			Ogre::String stateStr = XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;state&quot;);
+			Ogre::String stateStr = getAttributeValueAsStdString(nodeElem, &quot;state&quot;);
 			if (stateStr == &quot;LOADED&quot;)
 			{
 				state = GOS_LOADED;

Modified: rl/trunk/engine/script/src/LightNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/LightNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/LightNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,8 +17,6 @@
 
 #include &quot;LightNodeProcessor.h&quot;
 
-#include &quot;XmlHelper.h&quot;
-
 #include &quot;Actor.h&quot;
 #include &quot;ActorManager.h&quot;
 
@@ -29,19 +27,19 @@
 {
     bool LightNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-        if (!XmlHelper::hasNodeName(nodeElem, &quot;light&quot;))
+        if (!hasNodeName(nodeElem, &quot;light&quot;))
         {
             return false;
         }
 
         LOG_DEBUG(Logger::RULES,
             &quot;Processing light node &quot;
-                + XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;name&quot;));
+                + getAttributeValueAsStdString(nodeElem, &quot;name&quot;));
 
-        Ogre::String name = XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;name&quot;);
-        Ogre::String stype = XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;type&quot;);
-        bool visible = XmlHelper::getAttributeValueAsBool(nodeElem, &quot;visible&quot;);
-        bool shadowCaster = XmlHelper::getAttributeValueAsBool(nodeElem, &quot;castShadows&quot;);
+        Ogre::String name = getAttributeValueAsStdString(nodeElem, &quot;name&quot;);
+        Ogre::String stype = getAttributeValueAsStdString(nodeElem, &quot;type&quot;);
+        bool visible = getAttributeValueAsBool(nodeElem, &quot;visible&quot;);
+        bool shadowCaster = getAttributeValueAsBool(nodeElem, &quot;castShadows&quot;);
 
         LightObject::LightTypes type = LightObject::LT_DIRECTIONAL;
         if (stype == &quot;point&quot;)
@@ -63,7 +61,7 @@
         }
         Actor* lightActor = ActorManager::getSingleton().createLightActor(name, type);
 
-        DOMElement* posElem = XmlHelper::getChildNamed(nodeElem, &quot;position&quot;);
+        DOMElement* posElem = getChildNamed(nodeElem, &quot;position&quot;);
         if (posElem != NULL)
         {
             lightActor-&gt;placeIntoScene(processVector3(posElem));
@@ -78,30 +76,30 @@
         light-&gt;setCastShadows(shadowCaster);
         light-&gt;setVisible(visible);
 
-        DOMElement* diffElem = XmlHelper::getChildNamed(nodeElem, &quot;colourDiffuse&quot;);
+        DOMElement* diffElem = getChildNamed(nodeElem, &quot;colourDiffuse&quot;);
         if (diffElem != NULL)
         {
             light-&gt;setDiffuseColour(processColour(diffElem));
         }
 
-        DOMElement* specElem = XmlHelper::getChildNamed(nodeElem, &quot;colourSpecular&quot;);
+        DOMElement* specElem = getChildNamed(nodeElem, &quot;colourSpecular&quot;);
         if (specElem != NULL)
         {
             light-&gt;setSpecularColour(processColour(specElem));
         }
 
-        DOMElement* attElem = XmlHelper::getChildNamed(nodeElem, &quot;lightAttenuation&quot;);
+        DOMElement* attElem = getChildNamed(nodeElem, &quot;lightAttenuation&quot;);
         if (attElem != NULL)
         {
-            if (XmlHelper::hasAttribute(attElem, &quot;range&quot;)
-                &amp;&amp; XmlHelper::hasAttribute(attElem, &quot;constant&quot;)
-                &amp;&amp; XmlHelper::hasAttribute(attElem, &quot;linear&quot;)
-                &amp;&amp; XmlHelper::hasAttribute(attElem, &quot;quadratic&quot;))
+            if (hasAttribute(attElem, &quot;range&quot;)
+                &amp;&amp; hasAttribute(attElem, &quot;constant&quot;)
+                &amp;&amp; hasAttribute(attElem, &quot;linear&quot;)
+                &amp;&amp; hasAttribute(attElem, &quot;quadratic&quot;))
             {
-                Ogre::Real range = XmlHelper::getAttributeValueAsReal(attElem, &quot;range&quot;);
-                Ogre::Real constant = XmlHelper::getAttributeValueAsReal(attElem, &quot;constant&quot;);
-                Ogre::Real linear = XmlHelper::getAttributeValueAsReal(attElem, &quot;linear&quot;);
-                Ogre::Real quadratic = XmlHelper::getAttributeValueAsReal(attElem, &quot;quadratic&quot;);
+                Ogre::Real range = getAttributeValueAsReal(attElem, &quot;range&quot;);
+                Ogre::Real constant = getAttributeValueAsReal(attElem, &quot;constant&quot;);
+                Ogre::Real linear = getAttributeValueAsReal(attElem, &quot;linear&quot;);
+                Ogre::Real quadratic = getAttributeValueAsReal(attElem, &quot;quadratic&quot;);
 
                 light-&gt;setAttenuation(range, constant, linear, quadratic);
             }
@@ -110,7 +108,7 @@
 
         if (stype == &quot;directional&quot;)
         {
-            DOMElement* dirElem = XmlHelper::getChildNamed(nodeElem, &quot;direction&quot;);
+            DOMElement* dirElem = getChildNamed(nodeElem, &quot;direction&quot;);
             if (dirElem != NULL)
             {
                 light-&gt;setDirection(processVector3(dirElem));
@@ -122,15 +120,15 @@
         }
         else if (stype == &quot;spot&quot;)
         {
-            DOMElement* rangeElem = XmlHelper::getChildNamed(nodeElem, &quot;spotlightrange&quot;);
+            DOMElement* rangeElem = getChildNamed(nodeElem, &quot;spotlightrange&quot;);
             if (rangeElem != NULL)
             {
-                Ogre::Real innerAngle = XmlHelper::getAttributeValueAsReal(rangeElem, &quot;inner&quot;);
-                Ogre::Real outerAngle = XmlHelper::getAttributeValueAsReal(rangeElem, &quot;outer&quot;);
-                if (XmlHelper::hasAttribute(rangeElem, &quot;falloff&quot;))
+                Ogre::Real innerAngle = getAttributeValueAsReal(rangeElem, &quot;inner&quot;);
+                Ogre::Real outerAngle = getAttributeValueAsReal(rangeElem, &quot;outer&quot;);
+                if (hasAttribute(rangeElem, &quot;falloff&quot;))
                 {
                     light-&gt;setSpotlightRange(
-                        innerAngle, outerAngle, XmlHelper::getAttributeValueAsReal(rangeElem, &quot;falloff&quot;));
+                        innerAngle, outerAngle, getAttributeValueAsReal(rangeElem, &quot;falloff&quot;));
                 }
                 else
                 {

Modified: rl/trunk/engine/script/src/MapLoader.cpp
===================================================================
--- rl/trunk/engine/script/src/MapLoader.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/MapLoader.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -15,13 +15,9 @@
 */
 #include &quot;stdinc.h&quot; //precompiled header
 
-#include &lt;xercesc/dom/DOM.hpp&gt;
-#include &lt;xercesc/parsers/XercesDOMParser.hpp&gt;
-#include &lt;xercesc/util/PlatformUtils.hpp&gt;
-
 #include &quot;MapLoader.h&quot;
 
-#include &lt;OgreResourceManager.h&gt;
+#include &lt;xercesc/dom/DOM.hpp&gt;
 
 #include &quot;AbstractMapNodeProcessor.h&quot;
 #include &quot;CoreSubsystem.h&quot;
@@ -36,8 +32,6 @@
 #include &quot;WaypointProcessor.h&quot;
 #include &quot;World.h&quot;
 #include &quot;XmlHelper.h&quot;
-#include &quot;XmlResource.h&quot;
-#include &quot;XmlResourceManager.h&quot;
 #include &quot;ZoneProcessor.h&quot;
 
 using namespace Ogre;
@@ -53,8 +47,6 @@
           mResourceGroup(resourceGroup),
           mPercentageWindow(NULL)
     {
-        mXmlPropertyProcessor = new XmlPropertyReader();
-
         mNodeProcessors.push_back(new EntityNodeProcessor(resourceGroup));
         mNodeProcessors.push_back(new GameObjectNodeProcessor());
         mNodeProcessors.push_back(new SoundNodeProcessor());
@@ -69,63 +61,43 @@
         {
             delete *it;
         }
-        delete mXmlPropertyProcessor;
         delete mPercentageWindow;
     }
 
     void MapLoader::loadMap(const Ogre::String&amp; mapresource, bool loadGameObjects)
     {
         LOG_MESSAGE(Logger::RULES, &quot;Loading map &quot; + mapresource);
-  		XMLPlatformUtils::Initialize();
 
-		XmlHelper::initializeTranscoder();
-		XercesDOMParser* parser = new XercesDOMParser();
+  		initializeXml();
 
-        parser-&gt;setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-        parser-&gt;setDoNamespaces(true);    // optional
+        DOMDocument* doc = loadDocument(mapresource, mResourceGroup);
 
-        XmlPtr res = XmlResourceManager::getSingleton().getByName(mapresource);
-        if (res.isNull())
+        if (doc)
         {
-            Ogre::String group = ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME;
-            if (ResourceGroupManager::getSingleton().resourceExists(
-                mResourceGroup, mapresource))
-            {
-                group = mResourceGroup;
-            }
-            res = XmlResourceManager::getSingleton().create(mapresource, group);
-        }
-
-        if (!res.isNull())
-        {
-            res-&gt;parseBy(parser);
-
             setRootSceneNode(CoreSubsystem::getSingleton().getWorld()
                     -&gt;getSceneManager()-&gt;getRootSceneNode()-&gt;createChildSceneNode(mapresource));
 
-            DOMDocument* doc = parser-&gt;getDocument();
-            DOMElement* dataDocumentContent = doc-&gt;getDocumentElement();
-
 			CoreSubsystem::getSingleton().getWorld()-&gt;initializeDefaultCamera();
 			///@todo: Window fade jobs don't work if Core is paused, think about solution for: CoreSubsystem::getSingleton().setPaused(true);
 
             LOG_MESSAGE(Logger::RULES, &quot;Processing nodes&quot;);
 
-            processSceneNodes(XmlHelper::getChildNamed(dataDocumentContent, &quot;nodes&quot;), loadGameObjects);
+            DOMElement* dataDocumentContent = doc-&gt;getDocumentElement();
+            processSceneNodes(getChildNamed(dataDocumentContent, &quot;nodes&quot;), loadGameObjects);
 
 			ZoneProcessor zp;
-			zp.processNode(XmlHelper::getChildNamed(dataDocumentContent, &quot;zones&quot;), loadGameObjects);
+			zp.processNode(getChildNamed(dataDocumentContent, &quot;zones&quot;), loadGameObjects);
 
 			EnvironmentProcessor ep;
-			ep.processNode(XmlHelper::getChildNamed(dataDocumentContent, &quot;environment&quot;), loadGameObjects);
+			ep.processNode(getChildNamed(dataDocumentContent, &quot;environment&quot;), loadGameObjects);
 
 			WaypointProcessor wp;
-			wp.processNode(XmlHelper::getChildNamed(dataDocumentContent, &quot;waypoints&quot;), loadGameObjects);
+			wp.processNode(getChildNamed(dataDocumentContent, &quot;waypoints&quot;), loadGameObjects);
 
-            LOG_MESSAGE(Logger::RULES, &quot;Map loaded&quot;);
-
             doc-&gt;release();
 
+            LOG_MESSAGE(Logger::RULES, &quot;Map loaded&quot;);
+
 			CoreSubsystem::getSingleton().getWorld()-&gt;initializeDefaultCamera();
 			///@todo: Window fade jobs don't work if Core is paused, think about solution for: CoreSubsystem::getSingleton().setPaused(false);
         }
@@ -134,7 +106,8 @@
             LOG_ERROR(Logger::RULES, &quot;Map resource '&quot; + mapresource + &quot;' not found&quot;);
         }
 
-		XMLPlatformUtils::Terminate();
+
+        shutdownXml();
     }
 
     void MapLoader::processSceneNodes(DOMElement* nodesElem, bool loadGameObjects)
@@ -165,7 +138,7 @@
                 if (it == mNodeProcessors.end())
                 {
                     LOG_WARNING(Logger::RULES,
-                        &quot;Node &quot; + XmlHelper::transcodeToString(curElem-&gt;getNodeName()) + &quot; could not be processed.&quot;);
+                        &quot;Node &quot; + transcodeToString(curElem-&gt;getNodeName()) + &quot; could not be processed.&quot;);
                 }
             }
 

Modified: rl/trunk/engine/script/src/ParticleSystemNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/ParticleSystemNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/ParticleSystemNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,8 +17,6 @@
 
 #include &quot;ParticleSystemNodeProcessor.h&quot;
 
-#include &quot;XmlHelper.h&quot;
-
 #include &quot;Actor.h&quot;
 #include &quot;ActorManager.h&quot;
 #include &quot;ParticleSystemObject.h&quot;
@@ -30,30 +28,30 @@
 {
     bool ParticleSystemNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-		if (!XmlHelper::hasNodeName(nodeElem, &quot;particlesystem&quot;))
+		if (!hasNodeName(nodeElem, &quot;particlesystem&quot;))
 		{
 			return false;
 		}
 
-		if (!XmlHelper::hasAttribute(nodeElem, &quot;material&quot;))
+		if (!hasAttribute(nodeElem, &quot;material&quot;))
 		{
 			LOG_WARNING(Logger::SCRIPT, &quot;Particle system nodes must at least have the attribute 'material'.&quot;);
 			return false;
 		}
 
-		Ogre::String name = XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;name&quot;);
+		Ogre::String name = getAttributeValueAsStdString(nodeElem, &quot;name&quot;);
 
 		LOG_DEBUG(Logger::SCRIPT,
             &quot;Processing particle system node &quot; + name);
 
-		Ogre::String material = XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;material&quot;);
+		Ogre::String material = getAttributeValueAsStdString(nodeElem, &quot;material&quot;);
 
 		Actor* part = ActorManager::getSingleton().createParticleSystemActor(
 			name, material);
 
-		if (XmlHelper::hasAttribute(nodeElem, &quot;active&quot;))
+		if (hasAttribute(nodeElem, &quot;active&quot;))
 		{
-			bool active = XmlHelper::getAttributeValueAsBool(nodeElem, &quot;active&quot;);
+			bool active = getAttributeValueAsBool(nodeElem, &quot;active&quot;);
 			static_cast&lt;ParticleSystemObject*&gt;(part-&gt;getControlledObject())-&gt;setActive(active);
 		}
 

Modified: rl/trunk/engine/script/src/SoundNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/SoundNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/SoundNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,8 +17,6 @@
 
 #include &quot;SoundNodeProcessor.h&quot;
 
-#include &quot;XmlHelper.h&quot;
-
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
 
@@ -26,14 +24,14 @@
 {
     bool SoundNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-        if (!XmlHelper::hasNodeName(nodeElem, &quot;sound&quot;))
+        if (!hasNodeName(nodeElem, &quot;sound&quot;))
         {
             return false;
         }
 
         LOG_DEBUG(Logger::RULES,
             &quot;Processing sound node &quot;
-                + XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;name&quot;));
+                + getAttributeValueAsStdString(nodeElem, &quot;name&quot;));
 
 
 

Modified: rl/trunk/engine/script/src/WaypointProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/WaypointProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/WaypointProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -20,7 +20,6 @@
 #include &quot;AiSubsystem.h&quot;
 #include &quot;Landmark.h&quot;
 #include &quot;LandmarkPath.h&quot;
-#include &quot;XmlHelper.h&quot;
 
 using namespace XERCES_CPP_NAMESPACE;
 using namespace Ogre;
@@ -36,11 +35,11 @@
 
 		for (DOMNode* cur = nodeElem-&gt;getFirstChild(); cur != NULL; cur = cur-&gt;getNextSibling())
 		{
-			if (cur-&gt;getNodeType() == DOMNode::ELEMENT_NODE &amp;&amp; XmlHelper::hasNodeName(cur, &quot;landmark&quot;))
+			if (cur-&gt;getNodeType() == DOMNode::ELEMENT_NODE &amp;&amp; hasNodeName(cur, &quot;landmark&quot;))
 			{
 				DOMElement* elem = static_cast&lt;DOMElement*&gt;(cur);
-				Ogre::String name = XmlHelper::getAttributeValueAsStdString(elem, &quot;name&quot;);
-				DOMElement* posChild = XmlHelper::getChildNamed(elem, &quot;position&quot;);
+				Ogre::String name = getAttributeValueAsStdString(elem, &quot;name&quot;);
+				DOMElement* posChild = getChildNamed(elem, &quot;position&quot;);
 				if (name != &quot;&quot; &amp;&amp; posChild != NULL)
 				{
 					AiSubsystem::getSingleton().createLandmark(
@@ -51,7 +50,7 @@
 
 		for (DOMNode* cur = nodeElem-&gt;getFirstChild(); cur != NULL; cur = cur-&gt;getNextSibling())
 		{
-			if (cur-&gt;getNodeType() == DOMNode::ELEMENT_NODE &amp;&amp; XmlHelper::hasNodeName(cur, &quot;landmarkgraph&quot;))
+			if (cur-&gt;getNodeType() == DOMNode::ELEMENT_NODE &amp;&amp; hasNodeName(cur, &quot;landmarkgraph&quot;))
 			{
 				DOMElement* elem = static_cast&lt;DOMElement*&gt;(cur);
 				///@todo process waypointgraph
@@ -63,11 +62,11 @@
 					curPathChild != NULL; curPathChild = curPathChild-&gt;getNextSibling())
 				{
 					if (curPathChild-&gt;getNodeType() == DOMNode::ELEMENT_NODE
-						&amp;&amp; XmlHelper::hasNodeName(curPathChild, &quot;landmark&quot;))
+						&amp;&amp; hasNodeName(curPathChild, &quot;landmark&quot;))
 					{
 						DOMElement* curLmElem = static_cast&lt;DOMElement*&gt;(curPathChild);
 						Landmark* lm = AiSubsystem::getSingleton().getLandmark(
-							XmlHelper::getAttributeValueAsStdString(curLmElem, &quot;name&quot;));
+							getAttributeValueAsStdString(curLmElem, &quot;name&quot;));
 
 						if (lm != NULL)
 						{

Modified: rl/trunk/engine/script/src/ZoneProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -22,7 +22,6 @@
 #include &quot;ScriptSubsystem.h&quot;
 #include &quot;Trigger.h&quot;
 #include &quot;TriggerFactory.h&quot;
-#include &quot;XmlHelper.h&quot;
 #include &quot;Zone.h&quot;
 #include &quot;ZoneManager.h&quot;
 
@@ -42,12 +41,12 @@
         for (DOMNode* cur = zonesElem-&gt;getFirstChild(); cur != NULL; cur = cur-&gt;getNextSibling())
         {
             if (cur-&gt;getNodeType() == DOMNode::ELEMENT_NODE
-				&amp;&amp; XmlHelper::hasNodeName(cur, &quot;zone&quot;))
+				&amp;&amp; hasNodeName(cur, &quot;zone&quot;))
             {
 				DOMElement* curZoneElem = static_cast&lt;DOMElement*&gt;(cur);
-				if (XmlHelper::hasAttribute(curZoneElem, &quot;name&quot;))
+				if (hasAttribute(curZoneElem, &quot;name&quot;))
 				{
-					Ogre::String name = XmlHelper::getAttributeValueAsStdString(curZoneElem, &quot;name&quot;);
+					Ogre::String name = getAttributeValueAsStdString(curZoneElem, &quot;name&quot;);
                     Zone* zone = NULL;
                     if( name == &quot;default&quot; )
                         zone = ZoneManager::getSingleton().getDefaultZone();
@@ -62,55 +61,55 @@
                         for(DOMNode* curArea = cur-&gt;getFirstChild(); curArea != NULL; curArea = curArea-&gt;getNextSibling())
                         {
                             if( curArea-&gt;getNodeType() == DOMNode::ELEMENT_NODE
-                                &amp;&amp; XmlHelper::hasNodeName(curArea, &quot;area&quot;) )
+                                &amp;&amp; hasNodeName(curArea, &quot;area&quot;) )
                             {
                                 DOMElement *curAreaElem = static_cast&lt;DOMElement*&gt;(curArea);
-                                if( XmlHelper::hasAttribute(curAreaElem, &quot;type&quot;) )
+                                if( hasAttribute(curAreaElem, &quot;type&quot;) )
                                 {
                                     // type
                                     Ogre::String type;
-                                    type = XmlHelper::getAttributeValueAsStdString(curAreaElem, &quot;type&quot;);
+                                    type = getAttributeValueAsStdString(curAreaElem, &quot;type&quot;);
 
                                     // add or subtract?
                                     bool subtract = false;
-                                    if( XmlHelper::hasAttribute(curAreaElem, &quot;subtract&quot;) )
-                                        subtract = XmlHelper::getAttributeValueAsBool(curAreaElem, &quot;subtract&quot;);
+                                    if( hasAttribute(curAreaElem, &quot;subtract&quot;) )
+                                        subtract = getAttributeValueAsBool(curAreaElem, &quot;subtract&quot;);
 
                                     // position
                                     Vector3 position = Vector3::ZERO;
-                                    DOMElement* positionElem = XmlHelper::getChildNamed(curAreaElem, &quot;position&quot;);
+                                    DOMElement* positionElem = getChildNamed(curAreaElem, &quot;position&quot;);
                                     if( positionElem != NULL )
-                                        position = XmlHelper::getValueAsVector3(positionElem);
+                                        position = getValueAsVector3(positionElem);
 
                                     //scale, rotation, offset
                                     Vector3 scale = Vector3::UNIT_SCALE;
-                                    DOMElement* scaleElem = XmlHelper::getChildNamed(curAreaElem, &quot;scale&quot;);
+                                    DOMElement* scaleElem = getChildNamed(curAreaElem, &quot;scale&quot;);
                                     if( scaleElem != NULL )
-                                        scale = XmlHelper::getValueAsVector3(scaleElem);
+                                        scale = getValueAsVector3(scaleElem);
 
                                     Vector3 offset = Vector3::ZERO;
-                                    DOMElement* offsetElem = XmlHelper::getChildNamed(curAreaElem, &quot;offset&quot;);
+                                    DOMElement* offsetElem = getChildNamed(curAreaElem, &quot;offset&quot;);
                                     if( offsetElem != NULL )
-                                        offset = XmlHelper::getValueAsVector3(offsetElem);
+                                        offset = getValueAsVector3(offsetElem);
 
                                     Quaternion rotation = Quaternion::IDENTITY;
-                                    DOMElement* rotationElem = XmlHelper::getChildNamed(curAreaElem, &quot;rotation&quot;);
+                                    DOMElement* rotationElem = getChildNamed(curAreaElem, &quot;rotation&quot;);
                                     if( rotationElem != NULL )
-                                        rotation = XmlHelper::getValueAsQuaternion(rotationElem);
+                                        rotation = getValueAsQuaternion(rotationElem);
 
                                     //transition distance
                                     Real transitionDistance = 0;
-                                    DOMElement* transitionElem = XmlHelper::getChildNamed(curAreaElem, &quot;transition_distance&quot;);
+                                    DOMElement* transitionElem = getChildNamed(curAreaElem, &quot;transition_distance&quot;);
                                     if( transitionElem != NULL )
-                                        transitionDistance = XmlHelper::getValueAsReal(transitionElem);
+                                        transitionDistance = getValueAsReal(transitionElem);
 
 					            
                                     if (type == &quot;mesh&quot;)
     					            {
                                         Ogre::String meshName;
-                                        if( XmlHelper::hasAttribute(curAreaElem, &quot;meshfile&quot;) )
+                                        if( hasAttribute(curAreaElem, &quot;meshfile&quot;) )
                                         {
-                                            meshName = XmlHelper::getAttributeValueAsStdString(curAreaElem, &quot;meshfile&quot;);
+                                            meshName = getAttributeValueAsStdString(curAreaElem, &quot;meshfile&quot;);
                                             if( subtract )
                                                 ZoneManager::getSingleton().subtractMeshAreaFromZone(name,
                                                     meshName, GT_CONVEXHULL, position, scale, offset, rotation, transitionDistance, QUERYFLAG_PLAYER);
@@ -168,29 +167,29 @@
 							if (cur-&gt;getNodeType() == DOMNode::ELEMENT_NODE)
 							{
 								DOMElement* curElem = static_cast&lt;DOMElement*&gt;(cur);
-								if (XmlHelper::hasNodeName(curElem, &quot;light&quot;))
+								if (hasNodeName(curElem, &quot;light&quot;))
 								{
-									Ogre::String name = XmlHelper::getAttributeValueAsStdString(curElem, &quot;name&quot;);
+									Ogre::String name = getAttributeValueAsStdString(curElem, &quot;name&quot;);
 									zone-&gt;addLight(ActorManager::getSingleton().getActor(name));
 								}
-								else if (XmlHelper::hasNodeName(curElem, &quot;sound&quot;))
+								else if (hasNodeName(curElem, &quot;sound&quot;))
 								{
-									Ogre::String name = XmlHelper::getAttributeValueAsStdString(curElem, &quot;name&quot;);
+									Ogre::String name = getAttributeValueAsStdString(curElem, &quot;name&quot;);
 									zone-&gt;addSound(name);
 								}
-								else if (XmlHelper::hasNodeName(curElem, &quot;trigger&quot;))
+								else if (hasNodeName(curElem, &quot;trigger&quot;))
 								{
 									Ogre::String classname =
-										XmlHelper::getAttributeValueAsStdString(curElem, &quot;classname&quot;);
+										getAttributeValueAsStdString(curElem, &quot;classname&quot;);
 
 									Trigger* trigger = ScriptSubsystem::getSingleton().getTriggerFactory()
 										-&gt;createTrigger(classname);
 
 									///@todo trigger properties
 								}
-                                else if (XmlHelper::hasNodeName(curElem, &quot;eaxpreset&quot;))
+                                else if (hasNodeName(curElem, &quot;eaxpreset&quot;))
                                 {
-									Ogre::String name = XmlHelper::getAttributeValueAsStdString(curElem, &quot;name&quot;);
+									Ogre::String name = getAttributeValueAsStdString(curElem, &quot;name&quot;);
                                     zone-&gt;setEaxPreset(name);
                                 }
 							}

Modified: rl/trunk/engine/ui/include/InputManager.h
===================================================================
--- rl/trunk/engine/ui/include/InputManager.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ui/include/InputManager.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -25,11 +25,12 @@
 #include &lt;OgreRenderWindow.h&gt;
 #include &lt;OgreSingleton.h&gt;
 
+#include &lt;stack&gt;
+
 #include &quot;FixRubyHeaders.h&quot;
 #include &quot;GameTask.h&quot;
+#include &quot;XmlHelper.h&quot;
 
-#include &lt;stack&gt;
-
 namespace rl {
 
     class AbstractWindow;
@@ -39,7 +40,8 @@
 
     class _RlUiExport InputManager
         :    public Ogre::Singleton&lt;InputManager&gt;,
-            public GameTask
+            public GameTask,
+            private XmlProcessor
     {
     public:
 

Modified: rl/trunk/engine/ui/src/InputManager.cpp
===================================================================
--- rl/trunk/engine/ui/src/InputManager.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ui/src/InputManager.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,18 +17,13 @@
 
 #include &quot;InputManager.h&quot;
 
-#include &lt;xercesc/parsers/XercesDOMParser.hpp&gt;
 #include &lt;xercesc/dom/DOM.hpp&gt;
-#include &lt;xercesc/util/XMLString.hpp&gt;
-#include &lt;xercesc/util/PlatformUtils.hpp&gt;
 
 #include &lt;OISInputManager.h&gt;
 
 #include &quot;Exception.h&quot;
 
 #include &quot;XmlHelper.h&quot;
-#include &quot;XmlResource.h&quot;
-#include &quot;XmlResourceManager.h&quot;
 
 #include &quot;AbstractWindow.h&quot;
 #include &quot;Action.h&quot;
@@ -250,76 +245,43 @@
         using XERCES_CPP_NAMESPACE::DOMDocument;
         using std::make_pair;
 
-        XMLPlatformUtils::Initialize();
-        XmlHelper::initializeTranscoder();
+        initializeXml();
 
-        XercesDOMParser* parser = new XercesDOMParser();
-        parser-&gt;setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-        parser-&gt;setDoNamespaces(true);    // optional
-
-/*        ErrorHandler* errHandler = (ErrorHandler*) new HandlerBase();
-        parser-&gt;setErrorHandler(errHandler);*/
-
-        XMLCh* ALT = XMLString::transcode(&quot;AltChar&quot;);
-        XMLCh* SHIFT = XMLString::transcode(&quot;ShiftChar&quot;);
-        XMLCh* NORMAL = XMLString::transcode(&quot;NormalChar&quot;);
-        XMLCh* DESCR = XMLString::transcode(&quot;KeyDescription&quot;);
-        XMLCh* CODE = XMLString::transcode(&quot;KeyCode&quot;);
-        XMLCh* KEY = XMLString::transcode(&quot;Key&quot;);
-
-        XmlPtr res =
-            XmlResourceManager::getSingleton().create(
-            filename,
-            ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME);
-        res-&gt;parseBy(parser);
-        DOMDocument* doc = parser-&gt;getDocument();
+        DOMDocument* doc = loadDocument(filename);
         DOMElement* dataDocumentContent = doc-&gt;getDocumentElement();
 
-        DOMNodeList* keymaps = dataDocumentContent-&gt;getElementsByTagName(KEY);
+        DOMNodeList* keymaps 
+            = dataDocumentContent-&gt;getElementsByTagName(AutoXMLCh(&quot;Key&quot;).data());
         for (unsigned int idx = 0; idx &lt; keymaps-&gt;getLength(); idx++)
         {
             DOMElement* key = static_cast&lt;DOMElement*&gt;(keymaps-&gt;item(idx));
-            int keycode = XMLString::parseInt(key-&gt;getAttribute(CODE));
+            int keycode = getAttributeValueAsInteger(key, &quot;KeyCode&quot;);
 
-            const XMLCh* xmlch;
-
-            xmlch = key-&gt;getAttribute(NORMAL);
-            if (xmlch != NULL &amp;&amp; XMLString::stringLen(xmlch) &gt; 0)
+            CeGuiString s;
+            s = getAttributeValueAsString(key, &quot;NormalChar&quot;);
+            if (!s.empty())
             {
-                CeGuiString s(XmlHelper::transcodeToString(xmlch));
                 mKeyMapNormal.insert(make_pair(keycode, s[0]));
             }
 
-            xmlch = key-&gt;getAttribute(ALT);
-            if (xmlch != NULL &amp;&amp; XMLString::stringLen(xmlch) &gt; 0)
+            s = getAttributeValueAsString(key, &quot;AltChar&quot;);
+            if (!s.empty())
             {
-                CeGuiString s(XmlHelper::transcodeToString(xmlch));
                 mKeyMapAlt.insert(make_pair(keycode, s[0]));
             }
 
-            xmlch = key-&gt;getAttribute(SHIFT);
-            if (xmlch != NULL &amp;&amp; XMLString::stringLen(xmlch) &gt; 0)
+            s = getAttributeValueAsString(key, &quot;ShiftChar&quot;);
+            if (!s.empty())
             {
-                CeGuiString s(XmlHelper::transcodeToString(xmlch));
                 mKeyMapShift.insert(make_pair(keycode, s[0]));
             }
 
-            xmlch = key-&gt;getAttribute(DESCR);
-            mKeyNames.insert(make_pair(keycode, XmlHelper::transcodeToString(xmlch)));
+            s = getAttributeValueAsString(key, &quot;KeyDescription&quot;);
+            mKeyNames.insert(make_pair(keycode, s));
         }
 
-        XMLString::release(&amp;ALT);
-        XMLString::release(&amp;SHIFT);
-        XMLString::release(&amp;NORMAL);
-        XMLString::release(&amp;CODE);
-        XMLString::release(&amp;DESCR);
-        XMLString::release(&amp;KEY);
-
         doc-&gt;release();
-        XMLPlatformUtils::Terminate();
-
-        //XmlResourceManager::getSingleton().remove(filename);
-        //res.setNull();
+        shutdownXml();
     }
 
     const CEGUI::utf8&amp; InputManager::getKeyChar(int scancode, int modifiers) const


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000895.html">[Dsa-hl-svn] r3824 - modules/common/dsa
</A></li>
	<LI>Next message: <A HREF="000897.html">[Dsa-hl-svn] r3826 - in rl/trunk/engine: ai/src script/swig
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#896">[ date ]</a>
              <a href="thread.html#896">[ thread ]</a>
              <a href="subject.html#896">[ subject ]</a>
              <a href="author.html#896">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
