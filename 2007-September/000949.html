<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3878 - modules/regressiontest/dsa	modules/regressiontest/maps modules/regressiontest/scripts	modules/regressiontest/scripts/maps	rl/trunk/engine/common/include rl/trunk/engine/common/src	rl/trunk/engine/rules/include rl/trunk/engine/rules/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-September/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3878%20-%20modules/regressiontest/dsa%0A%09modules/regressiontest/maps%20modules/regressiontest/scripts%0A%09modules/regressiontest/scripts/maps%0A%09rl/trunk/engine/common/include%20rl/trunk/engine/common/src%0A%09rl/trunk/engine/rules/include%20rl/trunk/engine/rules/src&In-Reply-To=%3C200709252224.l8PMO15d001759%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000948.html">
   <LINK REL="Next"  HREF="000950.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3878 - modules/regressiontest/dsa	modules/regressiontest/maps modules/regressiontest/scripts	modules/regressiontest/scripts/maps	rl/trunk/engine/common/include rl/trunk/engine/common/src	rl/trunk/engine/rules/include rl/trunk/engine/rules/src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3878%20-%20modules/regressiontest/dsa%0A%09modules/regressiontest/maps%20modules/regressiontest/scripts%0A%09modules/regressiontest/scripts/maps%0A%09rl/trunk/engine/common/include%20rl/trunk/engine/common/src%0A%09rl/trunk/engine/rules/include%20rl/trunk/engine/rules/src&In-Reply-To=%3C200709252224.l8PMO15d001759%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3878 - modules/regressiontest/dsa	modules/regressiontest/maps modules/regressiontest/scripts	modules/regressiontest/scripts/maps	rl/trunk/engine/common/include rl/trunk/engine/common/src	rl/trunk/engine/rules/include rl/trunk/engine/rules/src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Wed Sep 26 00:24:01 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000948.html">[Dsa-hl-svn] r3877 - modules/regressiontest/scripts/maps
</A></li>
        <LI>Next message: <A HREF="000950.html">[Dsa-hl-svn] r3879 - modules/common/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#949">[ date ]</a>
              <a href="thread.html#949">[ thread ]</a>
              <a href="subject.html#949">[ subject ]</a>
              <a href="author.html#949">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2007-09-26 00:23:52 +0200 (Wed, 26 Sep 2007)
New Revision: 3878

Modified:
   modules/regressiontest/dsa/gameobjectdefinitions.gof
   modules/regressiontest/maps/regressiontest.scene
   modules/regressiontest/scripts/GameObjectCreationTest.rb
   modules/regressiontest/scripts/maps/regressiontest.rb
   rl/trunk/engine/common/include/Properties.h
   rl/trunk/engine/common/src/Properties.cpp
   rl/trunk/engine/rules/include/GameObject.h
   rl/trunk/engine/rules/include/GameObjectManager.h
   rl/trunk/engine/rules/src/GameObject.cpp
   rl/trunk/engine/rules/src/GameObjectManager.cpp
Log:
Added inheritance for GO property sets
+ test in GameObjectCreationTest in module regressiontest

Modified: modules/regressiontest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-09-25 21:29:38 UTC (rev 3877)
+++ modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-09-25 22:23:52 UTC (rev 3878)
@@ -15,6 +15,12 @@
         &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;65&quot;/&gt;
     &lt;/gameobjectclass&gt;
 
+    &lt;gameobjectclass classid=&quot;apple2&quot; baseclass=&quot;GameObject&quot; inherits=&quot;apple&quot;&gt;
+        &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Apfel 2.0&quot;/&gt;
+        &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Ein Apfel. Definitiv.&quot;/&gt;
+        &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;75&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+
     &lt;gameobjectclass classid=&quot;TestPerson&quot; baseclass=&quot;NPC&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;TestPerson&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Wenn man mal jemanden zum Reden braucht...&quot;/&gt;

Modified: modules/regressiontest/maps/regressiontest.scene
===================================================================
--- modules/regressiontest/maps/regressiontest.scene	2007-09-25 21:29:38 UTC (rev 3877)
+++ modules/regressiontest/maps/regressiontest.scene	2007-09-25 22:23:52 UTC (rev 3878)
@@ -4,9 +4,6 @@
             &lt;position x=&quot;0.0&quot; y=&quot;0.0&quot; z=&quot;0.0&quot; /&gt;
             &lt;scale x=&quot;1.0&quot; y=&quot;1.0&quot; z=&quot;1.0&quot; /&gt;
         &lt;/entity&gt;
-        &lt;gameobject class=&quot;hero&quot; id=&quot;1&quot; state=&quot;IN_SCENE&quot;&gt;
-            &lt;position x=&quot;0&quot; y=&quot;0.0&quot; z=&quot;0&quot;/&gt;
-        &lt;/gameobject&gt;
         &lt;gameobject class=&quot;mckhero&quot; id=&quot;10&quot; state=&quot;IN_SCENE&quot;&gt;
             &lt;position x=&quot;2&quot; y=&quot;0.0&quot; z=&quot;0&quot;/&gt;
         &lt;/gameobject&gt;

Modified: modules/regressiontest/scripts/GameObjectCreationTest.rb
===================================================================
--- modules/regressiontest/scripts/GameObjectCreationTest.rb	2007-09-25 21:29:38 UTC (rev 3877)
+++ modules/regressiontest/scripts/GameObjectCreationTest.rb	2007-09-25 22:23:52 UTC (rev 3878)
@@ -1,11 +1,24 @@
 require 'testcase.rb'
 
 class GameObjectCreationTest &lt; TestCase
-  def execure()
-    appl = $GOM.createGameObject(&quot;apple&quot;);
-    appl.setPosition(rel_pos[0,0,0]);
+  def execute()
+	$SCRIPT.log(&quot;GameObjectCreationTest start&quot;);
+    
+	appl = $GOM.createGameObject(&quot;apple&quot;);
+    appl.setPosition(rel_pos([0,0,0]));
+	appl.placeIntoScene()
 
     appl2 = $GOM.createGameObject(&quot;apple&quot;, 15);
-    appl2.setPosition(rel_pos[0,1,0]);
+    appl2.setPosition(rel_pos([0,1,0]));
+	appl2.placeIntoScene()
+	
+	appl3 = $GOM.createGameObject(&quot;apple2&quot;);
+    appl3.setPosition(rel_pos([0,0,1]));
+	appl3.placeIntoScene()
+	assertEquals(appl3.getProperty(&quot;meshfile&quot;), &quot;sphere.1m.mesh&quot;, &quot;mesh file&quot;)
+	assertEquals(appl3.getProperty(&quot;description&quot;), &quot;Ein Apfel. Definitiv.&quot;, &quot;description&quot;)
+	assertEquals(appl3.getProperty(&quot;mass&quot;), 75, &quot;property mass&quot;)
+	
+	$SCRIPT.log(&quot;GameObjectCreationTest finished&quot;);
   end
 end
\ No newline at end of file

Modified: modules/regressiontest/scripts/maps/regressiontest.rb
===================================================================
--- modules/regressiontest/scripts/maps/regressiontest.rb	2007-09-25 21:29:38 UTC (rev 3877)
+++ modules/regressiontest/scripts/maps/regressiontest.rb	2007-09-25 22:23:52 UTC (rev 3878)
@@ -45,6 +45,7 @@
          TimeTest.new([ -5, 0, -5]).run()
    MapLoadingTest.new([ -5, 0, -10]).run()
           NpcTest.new([ -5, 0, 5]).run()
+GameObjectCreationTest.new([0, 0, -10]).run()
          DoorTest.new([  0, 0, -5]).run()
 	  WalkJobTest.new([  0, 0, -3]).run()
    NpcCapsuleTest.new([  0, 0, 5]).run()

Modified: rl/trunk/engine/common/include/Properties.h
===================================================================
--- rl/trunk/engine/common/include/Properties.h	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/common/include/Properties.h	2007-09-25 22:23:52 UTC (rev 3878)
@@ -45,6 +45,7 @@
 
         virtual const Property getProperty(const Ogre::String&amp; key) const;
         virtual void setProperty(const Ogre::String&amp; key, const Property&amp; value);
+        bool hasProperty(const Ogre::String&amp; key) const;
         virtual PropertySet* getAllProperties() const;
         const PropertySetMap::const_iterator begin() const;
         const PropertySetMap::const_iterator end() const;

Modified: rl/trunk/engine/common/src/Properties.cpp
===================================================================
--- rl/trunk/engine/common/src/Properties.cpp	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/common/src/Properties.cpp	2007-09-25 22:23:52 UTC (rev 3878)
@@ -74,6 +74,11 @@
         return (*it).second;
     }
 
+    bool PropertySet::hasProperty(const Ogre::String&amp; key) const
+    {
+        return mProperties.find(key) != mProperties.end();
+    }
+
     void PropertySet::setProperty(const Ogre::String&amp; key, const Property&amp; value)
     {
         mProperties[key] = value;

Modified: rl/trunk/engine/rules/include/GameObject.h
===================================================================
--- rl/trunk/engine/rules/include/GameObject.h	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/rules/include/GameObject.h	2007-09-25 22:23:52 UTC (rev 3878)
@@ -54,6 +54,7 @@
 
         static const Ogre::String PROPERTY_CLASS_ID;
         static const Ogre::String PROPERTY_OBJECT_ID;
+        static const Ogre::String PROPERTY_INHERITS;
         static const Ogre::String PROPERTY_BASE_CLASS;
         static const Ogre::String PROPERTY_POSITION; 
         static const Ogre::String PROPERTY_ORIENTATION; 

Modified: rl/trunk/engine/rules/include/GameObjectManager.h
===================================================================
--- rl/trunk/engine/rules/include/GameObjectManager.h	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/rules/include/GameObjectManager.h	2007-09-25 22:23:52 UTC (rev 3878)
@@ -81,7 +81,8 @@
         GameObjectStateListenerSet mGameObjectStateListeners;
 
         unsigned int generateId();
-        PropertySet* getClassProperties(const Ogre::String&amp; classId);
+        PropertySet* getClassProperties(const Ogre::String&amp; classId) const;
+        void applyProperties(GameObject* go, PropertySet* ps) const;
     };
 }
 

Modified: rl/trunk/engine/rules/src/GameObject.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObject.cpp	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/rules/src/GameObject.cpp	2007-09-25 22:23:52 UTC (rev 3878)
@@ -42,6 +42,7 @@
     const Ogre::String GameObject::PROPERTY_CLASS_ID = &quot;classid&quot;;
     const Ogre::String GameObject::PROPERTY_BASE_CLASS = &quot;baseclass&quot;;
     const Ogre::String GameObject::PROPERTY_POSITION = &quot;position&quot;;
+    const Ogre::String GameObject::PROPERTY_INHERITS = &quot;inherits&quot;;
     const Ogre::String GameObject::PROPERTY_ORIENTATION = &quot;orientation&quot;;
     const Ogre::String GameObject::PROPERTY_NAME = &quot;name&quot;;
     const Ogre::String GameObject::PROPERTY_DESCRIPTION = &quot;description&quot;;

Modified: rl/trunk/engine/rules/src/GameObjectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObjectManager.cpp	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/rules/src/GameObjectManager.cpp	2007-09-25 22:23:52 UTC (rev 3878)
@@ -144,11 +144,22 @@
                 goId);
 
         go-&gt;setClassId(classId);
-        go-&gt;setProperties(ps);
+        applyProperties(go, ps);
         mGameObjects[goId] = go;
         return go;
     }
 
+    void GameObjectManager::applyProperties(GameObject* go, PropertySet* ps) const
+    {
+        if (ps-&gt;hasProperty(GameObject::PROPERTY_INHERITS))
+        {
+            PropertySet* superClassProps = 
+                getClassProperties(ps-&gt;getProperty(GameObject::PROPERTY_INHERITS).toString().c_str());
+            applyProperties(go, superClassProps);
+        }
+        go-&gt;setProperties(ps);
+    }
+
 	GameObject* GameObjectManager::createGameObjectFromProperty(const Property&amp; goProp)
 	{
 		CeGuiString serializedString = goProp.toString();
@@ -170,7 +181,7 @@
 		return Property(go-&gt;getClassId() + &quot;|&quot; + CEGUI::PropertyHelper::uintToString(go-&gt;getId()));
 	}
 
-    PropertySet* GameObjectManager::getClassProperties(const Ogre::String&amp; classId)
+    PropertySet* GameObjectManager::getClassProperties(const Ogre::String&amp; classId) const
     {
         ClassPropertyMap::const_iterator it = mClassProperties.find(classId);
         if (it == mClassProperties.end())


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000948.html">[Dsa-hl-svn] r3877 - modules/regressiontest/scripts/maps
</A></li>
	<LI>Next message: <A HREF="000950.html">[Dsa-hl-svn] r3879 - modules/common/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#949">[ date ]</a>
              <a href="thread.html#949">[ thread ]</a>
              <a href="subject.html#949">[ subject ]</a>
              <a href="author.html#949">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
