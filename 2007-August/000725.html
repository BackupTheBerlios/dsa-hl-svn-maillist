<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3654 - in modules: common/materials	common/materials/programs ruchin/maps	ruchin/materials/textures ruchin/models ruchin/scripts	ruchin/scripts/maps
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3654%20-%20in%20modules%3A%20common/materials%0A%09common/materials/programs%20ruchin/maps%0A%09ruchin/materials/textures%20ruchin/models%20ruchin/scripts%0A%09ruchin/scripts/maps&In-Reply-To=%3C200708021230.l72CUCH1001513%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000724.html">
   <LINK REL="Next"  HREF="000726.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3654 - in modules: common/materials	common/materials/programs ruchin/maps	ruchin/materials/textures ruchin/models ruchin/scripts	ruchin/scripts/maps</H1>
    <B>pnyx at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3654%20-%20in%20modules%3A%20common/materials%0A%09common/materials/programs%20ruchin/maps%0A%09ruchin/materials/textures%20ruchin/models%20ruchin/scripts%0A%09ruchin/scripts/maps&In-Reply-To=%3C200708021230.l72CUCH1001513%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3654 - in modules: common/materials	common/materials/programs ruchin/maps	ruchin/materials/textures ruchin/models ruchin/scripts	ruchin/scripts/maps">pnyx at mail.berlios.de
       </A><BR>
    <I>Thu Aug  2 14:30:12 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000724.html">[Dsa-hl-svn] r3653 - in rl/trunk/engine/rules: include src
</A></li>
        <LI>Next message: <A HREF="000726.html">[Dsa-hl-svn] r3655 - rl/trunk/docs/documents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#725">[ date ]</a>
              <a href="thread.html#725">[ thread ]</a>
              <a href="subject.html#725">[ subject ]</a>
              <a href="author.html#725">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: pnyx
Date: 2007-08-02 14:28:37 +0200 (Thu, 02 Aug 2007)
New Revision: 3654

Added:
   modules/common/materials/programs/Skin_Vertex_Shader.material
   modules/common/materials/programs/Skin_Vertex_Shader.source
   modules/common/materials/programs/Torso_Vertex_Shader.source
   modules/ruchin/maps/ruchin_lightzones.rlmap.xml
   modules/ruchin/materials/textures/Ligthingmap_default.png
Modified:
   modules/common/materials/men_human_female_hand_nude.mesh.material
   modules/common/materials/men_human_female_head02.mesh.material
   modules/common/materials/programs/Basic_Vertex_Shader.material
   modules/common/materials/programs/Basic_Vertex_Shader.source
   modules/common/materials/programs/Basic_Vertex_ShaderUV1.material
   modules/common/materials/programs/Basic_Vertex_Shader_Alpha.material
   modules/common/materials/programs/Basic_Vertex_Shader_Variation.material
   modules/common/materials/programs/Basic_Vertex_Shader_ground.material
   modules/common/materials/programs/TerrainVColorBlending_Pixel_Shader.program.source
   modules/common/materials/programs/Torso_Pixel_Shader.source
   modules/common/materials/programs/Torso_Pixel_Shader_2.source
   modules/common/materials/programs/Torso_Vertex_Shader.material
   modules/ruchin/maps/ruchin.scene
   modules/ruchin/models/House_dummies.mesh
   modules/ruchin/models/Ruchin_ground.material
   modules/ruchin/models/Ruchin_ground.mesh
   modules/ruchin/models/Ruchin_map.mesh
   modules/ruchin/models/ruchin.material
   modules/ruchin/models/ruchin_terrain.material
   modules/ruchin/scripts/maps/maptest.rb
   modules/ruchin/scripts/particle.rb
Log:
Added Skin shader
Added 3rd lightsource to Vertexshaders


Modified: modules/common/materials/men_human_female_hand_nude.mesh.material
===================================================================
--- modules/common/materials/men_human_female_hand_nude.mesh.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/men_human_female_hand_nude.mesh.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -1,5 +1,5 @@
 
-material men_human_female_hand_nude : Basic_Vertex_Shader
+material men_human_female_hand_nude : Skin_Vertex_Shader
 {
 set_texture_alias diffuse rl_mensch_female.png
 

Modified: modules/common/materials/men_human_female_head02.mesh.material
===================================================================
--- modules/common/materials/men_human_female_head02.mesh.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/men_human_female_head02.mesh.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -1,5 +1,5 @@
 
-material men_human_female_head_02 : Basic_Vertex_Shader
+material men_human_female_head_02 : Skin_Vertex_Shader
 {
 set_texture_alias diffuse men_human_female_head02.png
 

Modified: modules/common/materials/programs/Basic_Vertex_Shader.material
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Basic_Vertex_Shader.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -50,7 +50,12 @@
 				param_named_auto Light2_position light_position_object_space 1
 				param_named Light2_spec_power float 0.3
 				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
 				
+				
 				param_named_auto matViewProjection worldviewproj_matrix
 				param_named_auto vViewPosition camera_position_object_space
 				

Modified: modules/common/materials/programs/Basic_Vertex_Shader.source
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader.source	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Basic_Vertex_Shader.source	2007-08-02 12:28:37 UTC (rev 3654)
@@ -10,6 +10,12 @@
 float4 Light2_position;
 float4 Light2_color;
 float4 Light2_spec_power;
+
+float4 Light3_attenuation;
+float4 Light3_position;
+float4 Light3_color;
+float4 Light3_spec_power;
+
 float4 vViewPosition;
 
 struct VS_INPUT 
@@ -58,9 +64,30 @@
                               Light1_attenuation.w * Dist * Dist)
                           ,0,1);
    
-   Output.Color += (Light1_color * DistAttn * AngleAttn) + SpecAttn;
+   Output.Color += (Light1_color * AngleAttn + SpecAttn) * DistAttn ;
    
    
+   // Light3
+   
+   LightDir = Light3_position - Input.Position * Light3_position.w;
+   Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   EyeVect = normalize(Input.Position - vViewPosition);
+   HalfVect = normalize(LightDir - EyeVect);
+   
+   SpecAttn = Light3_color * Light3_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   DistAttn = clamp(1/ (Light3_attenuation.y +
+                              Light3_attenuation.z * Dist +
+                              Light3_attenuation.w * Dist * Dist)
+                          ,0,1);
+   
+   Output.Color += (Light3_color * AngleAttn + SpecAttn) * DistAttn ;
+   
+   
    // Light2
    
    LightDir = Light2_position - Input.Position * Light2_position.w;
@@ -78,7 +105,7 @@
                         Light2_attenuation.w * Dist * Dist)
                         ,0,1);
    
-   Output.Color += (Light2_color * DistAttn * AngleAttn) + SpecAttn;
+   Output.Color += (Light2_color * AngleAttn + SpecAttn) * DistAttn ;
    
    Output.Texcoord = Input.Texcoord;
    Output.Texcoord1 = Input.Texcoord1;

Modified: modules/common/materials/programs/Basic_Vertex_ShaderUV1.material
===================================================================
--- modules/common/materials/programs/Basic_Vertex_ShaderUV1.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Basic_Vertex_ShaderUV1.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -25,14 +25,21 @@
 				// param_named_auto
 
 				param_named_auto Light1_attenuation light_attenuation 0
-				//param_named Light1_attenuation float4 0.4 0.002 0.00001 1.0
-				
 				param_named_auto Light1_color light_diffuse_colour 0
-				//param_named Light1_color float4 1.0 1.0 1.0 1.0
 				param_named_auto Light1_position light_position_object_space 0
-				//param_named Light1_position float4 1.0 1.0 1.0 1.0
 				param_named Light1_spec_power float 0.3
 				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
+				
+				
 				param_named_auto matViewProjection worldviewproj_matrix
 				param_named_auto vViewPosition camera_position_object_space
 				

Modified: modules/common/materials/programs/Basic_Vertex_Shader_Alpha.material
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader_Alpha.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Basic_Vertex_Shader_Alpha.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -33,7 +33,12 @@
 				param_named_auto Light2_position light_position_object_space 1
 				param_named Light2_spec_power float 0.3
 				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
 				
+				
 				param_named_auto matViewProjection worldviewproj_matrix
 				param_named_auto vViewPosition camera_position_object_space
 				
@@ -69,14 +74,21 @@
 				// param_named_auto
 
 				param_named_auto Light1_attenuation light_attenuation 0
-				//param_named Light1_attenuation float4 0.4 0.002 0.00001 1.0
-				
 				param_named_auto Light1_color light_diffuse_colour 0
-				//param_named Light1_color float4 1.0 1.0 1.0 1.0
 				param_named_auto Light1_position light_position_object_space 0
-				//param_named Light1_position float4 1.0 1.0 1.0 1.0
 				param_named Light1_spec_power float 0.3
 				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
+				
+				
 				param_named_auto matViewProjection worldviewproj_matrix
 				param_named_auto vViewPosition camera_position_object_space
 				

Modified: modules/common/materials/programs/Basic_Vertex_Shader_Variation.material
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader_Variation.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Basic_Vertex_Shader_Variation.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -35,7 +35,12 @@
 				param_named_auto Light2_position light_position_object_space 1
 				param_named Light2_spec_power float 0.3
 				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
 				
+				
 				param_named_auto matViewProjection worldviewproj_matrix
 				param_named_auto vViewPosition camera_position_object_space
 				

Modified: modules/common/materials/programs/Basic_Vertex_Shader_ground.material
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader_ground.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Basic_Vertex_Shader_ground.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -27,7 +27,12 @@
 				param_named_auto Light2_position light_position_object_space 1
 				param_named Light2_spec_power float 0.3
 				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
 				
+				
 				param_named_auto matViewProjection worldviewproj_matrix
 				param_named_auto vViewPosition camera_position_object_space
 				

Added: modules/common/materials/programs/Skin_Vertex_Shader.material
===================================================================
--- modules/common/materials/programs/Skin_Vertex_Shader.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Skin_Vertex_Shader.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -0,0 +1,69 @@
+vertex_program Skin_Vertex_Shader hlsl
+{
+	source Skin_Vertex_Shader.source
+	target vs_2_0
+	entry_point vs_main
+}
+
+material Skin_Vertex_Shader
+{
+	receive_shadows off
+	technique
+	{
+		//Rendering Pass: Pass 0 (pass index: #0 )
+		pass
+		{
+			alpha_rejection greater 128
+			//DirectX 9.0 HLSL Pixel Shader ps_2_0
+			fragment_program_ref Basic_Pixel_Shader
+			{
+			}
+			//DirectX 9.0 HLSL Vertex Shader vs_2_0
+			vertex_program_ref Skin_Vertex_Shader
+			{
+				// param_named_auto
+
+				param_named_auto Light1_attenuation light_attenuation 0
+				param_named_auto Light1_color light_diffuse_colour 0
+				param_named_auto Light1_position light_position_object_space 0
+				param_named Light1_spec_power float 0.3
+				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
+				
+				param_named subsurfcolor float4 0.8 0 0 1
+				
+				param_named_auto matViewProjection worldviewproj_matrix
+				param_named_auto vViewPosition camera_position_object_space
+				
+				
+				param_named skycolor float4 0.5 0.5 0.5 1.0
+				param_named groundcolor float4 0.10 0.10 0.10 1.0
+			}
+			
+			texture_unit
+			{
+				texture_alias diffuse
+
+			}
+		}
+	}
+
+	technique
+	{
+        pass
+        {
+            texture_unit
+            {
+                texture_alias diffuse
+            }
+        }
+    }
+}

Added: modules/common/materials/programs/Skin_Vertex_Shader.source
===================================================================
--- modules/common/materials/programs/Skin_Vertex_Shader.source	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Skin_Vertex_Shader.source	2007-08-02 12:28:37 UTC (rev 3654)
@@ -0,0 +1,126 @@
+float4x4 matViewProjection;
+float4 skycolor;
+float4 groundcolor;
+float4 Light1_attenuation;
+float4 Light1_position;
+float4 Light1_color;
+float4 Light1_spec_power;
+
+float4 Light2_attenuation;
+float4 Light2_position;
+float4 Light2_color;
+float4 Light2_spec_power;
+
+float4 Light3_attenuation;
+float4 Light3_position;
+float4 Light3_color;
+float4 Light3_spec_power;
+
+float4 subsurfcolor;
+
+float4 vViewPosition;
+
+struct VS_INPUT 
+{
+   float4 Position : POSITION0;
+   float2 Texcoord : TEXCOORD0;
+   float2 Texcoord1 : TEXCOORD1;
+   float2 Texcoord2: TEXCOORD2;
+   float3 Normal   : NORMAL;
+   
+};
+
+struct VS_OUTPUT 
+{
+   float4 Position : POSITION0;
+   float2 Texcoord : TEXCOORD0;
+   float2 Texcoord1: TEXCOORD1;
+   float2 Texcoord2: TEXCOORD2;
+   float4 Color    : TEXCOORD3;
+   
+};
+
+VS_OUTPUT vs_main( VS_INPUT Input )
+{
+   VS_OUTPUT Output;
+   Output.Color = float4(0,0,0,0);
+   Output.Position = mul( matViewProjection, Input.Position );
+   
+   
+   
+   // Light1
+   
+   float3 LightDir = Light1_position - Input.Position * Light1_position.w;
+   float Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   float AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   float3 EyeVect = normalize(Input.Position - vViewPosition);
+   float3 HalfVect = normalize(LightDir - EyeVect);
+   
+   float SpecAttn = Light1_color * Light1_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   float DistAttn = clamp(1/ (Light1_attenuation.y +
+                              Light1_attenuation.z * Dist +
+                              Light1_attenuation.w * Dist * Dist)
+                          ,0,1);
+   
+   Output.Color += (Light1_color * AngleAttn + SpecAttn) * DistAttn ;
+   
+   
+   // Light3
+   
+   LightDir = Light3_position - Input.Position * Light3_position.w;
+   Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   EyeVect = normalize(Input.Position - vViewPosition);
+   HalfVect = normalize(LightDir - EyeVect);
+   
+   SpecAttn = Light3_color * Light3_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   DistAttn = clamp(1/ (Light3_attenuation.y +
+                              Light3_attenuation.z * Dist +
+                              Light3_attenuation.w * Dist * Dist)
+                          ,0,1);
+   
+   Output.Color += (Light3_color * AngleAttn + SpecAttn) * DistAttn ;
+   
+   
+   // Light2
+   
+   LightDir = Light2_position - Input.Position * Light2_position.w;
+   Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   HalfVect = normalize(LightDir - EyeVect);
+   
+   SpecAttn = Light2_color *Light2_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   DistAttn = clamp(1/ (Light2_attenuation.y +
+                        Light2_attenuation.z * Dist +
+                        Light2_attenuation.w * Dist * Dist)
+                        ,0,1);
+   
+   Output.Color += (Light2_color * AngleAttn + SpecAttn) * DistAttn ;
+   
+   // fake SSS
+   Output.Color = lerp((subsurfcolor*Output.Color),Output.Color,( saturate(abs(Output.Color*3 -0.2))));
+   
+   Output.Color += lerp(skycolor,groundcolor,(dot(Input.Normal, float3(0,-1,0))+1)/2 );
+   
+   Output.Texcoord = Input.Texcoord;
+   Output.Texcoord1 = Input.Texcoord1;
+   Output.Texcoord2 = Input.Texcoord2;
+   
+   return( Output );
+   
+}
+
+
+

Modified: modules/common/materials/programs/TerrainVColorBlending_Pixel_Shader.program.source
===================================================================
--- modules/common/materials/programs/TerrainVColorBlending_Pixel_Shader.program.source	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/TerrainVColorBlending_Pixel_Shader.program.source	2007-08-02 12:28:37 UTC (rev 3654)
@@ -27,7 +27,7 @@
    TexColor = lerp(float4(tex2D(Texture4,UV4.xy).rgb,tex2D(Texture4,UV4.zw * scale_Detail4).a),TexColor,Color.a);
    
 
-  return TexColor * (TexColor.a+ 0.5) * (tex2D(Texture5,UV4.zw) + Light);
+  return TexColor * (TexColor.a+ 0.5) * ((tex2D(Texture5,UV4.zw)-0.5) + Light);
   //return float4(Color.aaaa);
 
 }

Modified: modules/common/materials/programs/Torso_Pixel_Shader.source
===================================================================
--- modules/common/materials/programs/Torso_Pixel_Shader.source	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Torso_Pixel_Shader.source	2007-08-02 12:28:37 UTC (rev 3654)
@@ -7,15 +7,16 @@
    float2 Texcoord1: TEXCOORD1;
    float2 Texcoord2: TEXCOORD2;
    float4 Color    : TEXCOORD3;
+   float4 SubColor : TEXCOORD4;
    
 };
 
 float4 ps_main( PS_INPUT Input ) : COLOR0
 {
 
-   float4 skin = tex2D( baseMap, Input.Texcoord );	
-   float4 cloth = tex2D( clothMap, Input.Texcoord1 );
-   return float4(lerp(skin.rgb,cloth.rgb, cloth.a )* Input.Color.rgb,skin.a+cloth.a);
+   float4 skin = tex2D( baseMap, Input.Texcoord )* float4(Input.SubColor.rgb,1);
+   float4 cloth = tex2D( clothMap, Input.Texcoord1 )* float4(Input.Color.rgb,1);
+   return float4(lerp(skin.rgb,cloth.rgb, cloth.a ),skin.a+cloth.a);
 }
 
 

Modified: modules/common/materials/programs/Torso_Pixel_Shader_2.source
===================================================================
--- modules/common/materials/programs/Torso_Pixel_Shader_2.source	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Torso_Pixel_Shader_2.source	2007-08-02 12:28:37 UTC (rev 3654)
@@ -7,15 +7,16 @@
    float2 Texcoord1: TEXCOORD1;
    float2 Texcoord2: TEXCOORD2;
    float4 Color    : TEXCOORD3;
+   float4 SubColor : TEXCOORD4;
    
 };
 
 float4 ps_main( PS_INPUT Input ) : COLOR0
 {
 
-   float4 skin = tex2D( baseMap, Input.Texcoord );	
-   float4 cloth = tex2D( clothMap, Input.Texcoord2 );
-   return float4(lerp(skin.rgb,cloth.rgb, cloth.a )* Input.Color.rgb,skin.a+cloth.a);
+   float4 skin = tex2D( baseMap, Input.Texcoord )* float4(Input.SubColor.rgb,1);	
+   float4 cloth = tex2D( clothMap, Input.Texcoord2 )* float4(Input.Color.rgb,1);
+   return float4(lerp(skin.rgb,cloth.rgb, cloth.a ),skin.a+cloth.a);
 }
 
 

Modified: modules/common/materials/programs/Torso_Vertex_Shader.material
===================================================================
--- modules/common/materials/programs/Torso_Vertex_Shader.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Torso_Vertex_Shader.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -14,6 +14,15 @@
 	entry_point ps_main
 }
 
+vertex_program Torso_Vertex_Shader hlsl
+{
+	source Torso_Vertex_Shader.source
+	target vs_2_0
+	entry_point vs_main
+}
+
+
+
 material Torso_Vertex_Shader_Short
 {
 	technique
@@ -27,7 +36,7 @@
 			{
 			}
 			//DirectX 9.0 HLSL Vertex Shader vs_2_0
-			vertex_program_ref Basic_Vertex_Shader
+			vertex_program_ref Torso_Vertex_Shader
 			{
 				// param_named_auto
 
@@ -41,9 +50,15 @@
 				param_named_auto Light2_position light_position_object_space 1
 				param_named Light2_spec_power float 0.3
 				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
+				
 				param_named_auto matViewProjection worldviewproj_matrix
 				param_named_auto vViewPosition camera_position_object_space
 				
+				param_named subsurfcolor float4 0.8 0 0 1
 				
 				param_named skycolor float4 0.5 0.5 0.5 1.0
 				param_named groundcolor float4 0.10 0.10 0.10 1.0
@@ -93,7 +108,7 @@
 			{
 			}
 			//DirectX 9.0 HLSL Vertex Shader vs_2_0
-			vertex_program_ref Basic_Vertex_Shader
+			vertex_program_ref Torso_Vertex_Shader
 			{
 				// param_named_auto
 
@@ -110,6 +125,7 @@
 				param_named_auto matViewProjection worldviewproj_matrix
 				param_named_auto vViewPosition camera_position_object_space
 				
+				param_named subsurfcolor float4 0.8 0 0 1
 				
 				param_named skycolor float4 0.5 0.5 0.5 1.0
 				param_named groundcolor float4 0.10 0.10 0.10 1.0

Added: modules/common/materials/programs/Torso_Vertex_Shader.source
===================================================================
--- modules/common/materials/programs/Torso_Vertex_Shader.source	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/common/materials/programs/Torso_Vertex_Shader.source	2007-08-02 12:28:37 UTC (rev 3654)
@@ -0,0 +1,128 @@
+float4x4 matViewProjection;
+float4 skycolor;
+float4 groundcolor;
+float4 Light1_attenuation;
+float4 Light1_position;
+float4 Light1_color;
+float4 Light1_spec_power;
+
+float4 Light2_attenuation;
+float4 Light2_position;
+float4 Light2_color;
+float4 Light2_spec_power;
+
+float4 Light3_attenuation;
+float4 Light3_position;
+float4 Light3_color;
+float4 Light3_spec_power;
+
+float4 subsurfcolor;
+
+float4 vViewPosition;
+
+struct VS_INPUT 
+{
+   float4 Position : POSITION0;
+   float2 Texcoord : TEXCOORD0;
+   float2 Texcoord1 : TEXCOORD1;
+   float2 Texcoord2: TEXCOORD2;
+   float3 Normal   : NORMAL;
+   
+};
+
+struct VS_OUTPUT 
+{
+   float4 Position : POSITION0;
+   float2 Texcoord : TEXCOORD0;
+   float2 Texcoord1: TEXCOORD1;
+   float2 Texcoord2: TEXCOORD2;
+   float4 Color    : TEXCOORD3;
+   float4 SubColor : TEXCOORD4;
+   
+};
+
+VS_OUTPUT vs_main( VS_INPUT Input )
+{
+   VS_OUTPUT Output;
+   Output.Color = float4(0,0,0,0);
+   Output.Position = mul( matViewProjection, Input.Position );
+   
+   
+   
+   // Light1
+   
+   float3 LightDir = Light1_position - Input.Position * Light1_position.w;
+   float Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   float AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   float3 EyeVect = normalize(Input.Position - vViewPosition);
+   float3 HalfVect = normalize(LightDir - EyeVect);
+   
+   float SpecAttn = Light1_color * Light1_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   float DistAttn = clamp(1/ (Light1_attenuation.y +
+                              Light1_attenuation.z * Dist +
+                              Light1_attenuation.w * Dist * Dist)
+                          ,0,1);
+   
+   Output.Color += (Light1_color * AngleAttn + SpecAttn) * DistAttn ;
+   
+   
+   // Light3
+   
+   LightDir = Light3_position - Input.Position * Light3_position.w;
+   Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   EyeVect = normalize(Input.Position - vViewPosition);
+   HalfVect = normalize(LightDir - EyeVect);
+   
+   SpecAttn = Light3_color * Light3_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   DistAttn = clamp(1/ (Light3_attenuation.y +
+                              Light3_attenuation.z * Dist +
+                              Light3_attenuation.w * Dist * Dist)
+                          ,0,1);
+   
+   Output.Color += (Light3_color * AngleAttn + SpecAttn) * DistAttn ;
+   
+   
+   // Light2
+   
+   LightDir = Light2_position - Input.Position * Light2_position.w;
+   Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   HalfVect = normalize(LightDir - EyeVect);
+   
+   SpecAttn = Light2_color *Light2_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   DistAttn = clamp(1/ (Light2_attenuation.y +
+                        Light2_attenuation.z * Dist +
+                        Light2_attenuation.w * Dist * Dist)
+                        ,0,1);
+   
+   Output.Color += (Light2_color * AngleAttn + SpecAttn) * DistAttn ;
+   
+   // fake SSS
+   Output.SubColor = lerp((subsurfcolor*Output.Color),Output.Color,( saturate(abs(Output.Color*3 -0.2))));
+   
+   Output.Color += lerp(skycolor,groundcolor,(dot(Input.Normal, float3(0,-1,0))+1)/2 );
+   Output.SubColor += lerp(skycolor,groundcolor,(dot(Input.Normal, float3(0,-1,0))+1)/2 );
+   
+   Output.Texcoord = Input.Texcoord;
+   Output.Texcoord1 = Input.Texcoord1;
+   Output.Texcoord2 = Input.Texcoord2;
+   
+   return( Output );
+   
+}
+
+
+

Modified: modules/ruchin/maps/ruchin.scene
===================================================================
--- modules/ruchin/maps/ruchin.scene	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/ruchin/maps/ruchin.scene	2007-08-02 12:28:37 UTC (rev 3654)
@@ -120,21 +120,7 @@
   
 
 		&lt;/node&gt;
-		&lt;node name=&quot;Ruchin_l_innen&quot; id=&quot;17&quot; &gt;
-			&lt;position x=&quot;65.2876&quot; y=&quot;6.02141&quot; z=&quot;-66.9458&quot; /&gt;
-			&lt;rotation qx=&quot;0.0&quot; qy=&quot;0.0&quot; qz=&quot;0.0&quot; qw=&quot;1.0&quot; /&gt;
-			&lt;scale x=&quot;1.0&quot; y=&quot;1.0&quot; z=&quot;1.0&quot; /&gt;
-			&lt;entity
-				name=&quot;Ruchin_l_innen&quot;
-				id=&quot;18&quot;
-				meshFile =&quot;Ruchin_l_innen.mesh&quot;
-				materialFile=&quot;ruchin_terrainlayout19.material&quot;
-				castsShadow=&quot;false&quot;
-			/&gt;
-
-  
-
-		&lt;/node&gt;
+		
 		&lt;node name=&quot;Ruchin_map&quot; id=&quot;19&quot; &gt;
 			&lt;position x=&quot;68.5845&quot; y=&quot;-0.00679748&quot; z=&quot;-47.3902&quot; /&gt;
 			&lt;rotation qx=&quot;0.0&quot; qy=&quot;0.0&quot; qz=&quot;0.0&quot; qw=&quot;1.0&quot; /&gt;
@@ -359,7 +345,7 @@
 		&lt;/node&gt;
 		
 		&lt;node name=&quot;Ruchin_ground&quot; id=&quot;3&quot; &gt;
-			&lt;position x=&quot;0.0&quot; y=&quot;0.0&quot; z=&quot;0.0&quot; /&gt;
+			&lt;position x=&quot;35.0&quot; y=&quot;0.0&quot; z=&quot;-20.0&quot; /&gt;
 			&lt;rotation qx=&quot;0.0&quot; qy=&quot;0.0&quot; qz=&quot;0.0&quot; qw=&quot;0.0&quot; /&gt;
 			&lt;scale x=&quot;1.0&quot; y=&quot;1.0&quot; z=&quot;1.0&quot; /&gt;
 			&lt;entity

Added: modules/ruchin/maps/ruchin_lightzones.rlmap.xml
===================================================================
--- modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-08-02 12:28:37 UTC (rev 3654)
@@ -0,0 +1,47 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
+&lt;rastullahmap formatVersion=&quot;0.4.0&quot;&gt;
+	&lt;nodes&gt;
+		&lt;entity name=&quot;Ruchin_l_innen&quot; meshFile=&quot;Ruchin_l_innen.mesh&quot; visible=&quot;true&quot; receivesShadow=&quot;true&quot;&gt;
+			&lt;position x=&quot;65.2876&quot; y=&quot;6.02141&quot; z=&quot;-66.9458&quot; /&gt;
+			&lt;rotation qx=&quot;0.0&quot; qy=&quot;0.0&quot; qz=&quot;0.0&quot; qw=&quot;1.0&quot; /&gt;
+			&lt;scale x=&quot;1.0&quot; y=&quot;1.0&quot; z=&quot;1.0&quot; /&gt;
+			&lt;staticgeometrygroup id=&quot;0&quot;/&gt;
+			 &lt;renderingdistance data=&quot;100&quot; /&gt; 
+		&lt;/entity&gt;	
+		
+		&lt;light name=&quot;red pointlight&quot; type=&quot;point&quot; visible=&quot;false&quot;
+			castShadows=&quot;false&quot;&gt;
+			&lt;position x=&quot;65.2876&quot; y=&quot;6.02141&quot; z=&quot;-66.9458&quot; /&gt;
+			&lt;colourDiffuse r=&quot;1&quot; g=&quot;0&quot; b=&quot;0&quot; /&gt;
+			&lt;colourSpecular r=&quot;1&quot; g=&quot;0&quot; b=&quot;0&quot; /&gt;
+			&lt;lightAttenuation range=&quot;20.0&quot; constant=&quot;1.0&quot; linear=&quot;0.1&quot;
+				quadratic=&quot;0.1&quot; /&gt;
+		&lt;/light&gt;	
+		
+		&lt;light name=&quot;green spotlight&quot; type=&quot;spot&quot; visible=&quot;false&quot;
+			castShadows=&quot;false&quot;&gt;
+			&lt;position x=&quot;65.2876&quot; y=&quot;6.02141&quot; z=&quot;-66.9458&quot; /&gt;
+			&lt;colourDiffuse r=&quot;0&quot; g=&quot;1&quot; b=&quot;0&quot; /&gt;
+			&lt;colourSpecular r=&quot;0&quot; g=&quot;1&quot; b=&quot;0&quot; /&gt;
+			&lt;lightAttenuation range=&quot;20.0&quot; constant=&quot;1.0&quot; linear=&quot;0.1&quot;
+				quadratic=&quot;0.1&quot; /&gt;
+			&lt;spotlightrange inner=&quot;10&quot; outer=&quot;20&quot; falloff=&quot;1&quot; /&gt;
+			&lt;direction x=&quot;0&quot; y=&quot;-1&quot; z=&quot;0.5&quot; /&gt;
+		&lt;/light&gt;
+		&lt;light name=&quot;sun&quot; type=&quot;directional&quot; visible=&quot;true&quot; castShadows=&quot;false&quot;&gt;
+			&lt;colourDiffuse r=&quot;0.8&quot; g=&quot;0.8&quot; b=&quot;0.8&quot; /&gt;
+			&lt;colourSpecular r=&quot;0&quot; g=&quot;0&quot; b=&quot;1&quot; /&gt;
+			&lt;direction x=&quot;-0.17101&quot; y=&quot;-0.873647&quot; z=&quot;0.969846&quot; /&gt;
+		&lt;/light&gt;
+	&lt;/nodes&gt;
+	&lt;zones&gt;
+		&lt;zone type=&quot;default&quot;&gt;
+			&lt;light name=&quot;sun&quot;/&gt;
+		&lt;/zone&gt;
+		&lt;zone type=&quot;mesh&quot; name=&quot;Ruchin_l_innen&quot;&gt;
+			&lt;light name=&quot;red pointlight&quot;/&gt;
+			&lt;light name=&quot;green spotlight&quot;/&gt;
+			&lt;sound name=&quot;lachen.ogg&quot;/&gt;
+		&lt;/zone&gt;
+	&lt;/zones&gt;
+&lt;/rastullahmap&gt;

Added: modules/ruchin/materials/textures/Ligthingmap_default.png
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/materials/textures/Ligthingmap_default.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/ruchin/models/House_dummies.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_ground.material
===================================================================
--- modules/ruchin/models/Ruchin_ground.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/ruchin/models/Ruchin_ground.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -5,8 +5,8 @@
    set_texture_alias red         laub01.dds
    set_texture_alias green       nat_gras_01.dds
    set_texture_alias blue        nat_steingrund_01.dds
-   set_texture_alias alpha       Tiles.dds
-   set_texture_alias Lightingmap Lightingmap2.png
+   set_texture_alias alpha       nat_steingrund_01.dds
+   set_texture_alias Lightingmap Ligthingmap_default.png
    
    technique
    {
@@ -30,7 +30,7 @@
             param_named scale_Texture2 float 0.28500 // Gruen
             param_named scale_Detail2 float 0.60000
 
-            param_named scale_Texture3 float 0.58000 // Blau
+            param_named scale_Texture3 float 0.88000 // Blau
             param_named scale_Detail3 float 1.00000
 
             param_named scale_Texture4 float 0.016000 // Alpha

Modified: modules/ruchin/models/Ruchin_ground.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_map.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/ruchin.material
===================================================================
--- modules/ruchin/models/ruchin.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/ruchin/models/ruchin.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -2,21 +2,75 @@
 {
 	technique
 	{
+		//Rendering Pass: Pass 0 (pass index: #0 )
 		pass
 		{
-			lighting off
-			alpha_rejection greater 128
 
+			//DirectX 9.0 HLSL Pixel Shader ps_2_0
+			fragment_program_ref Basic_Pixel_Shader_Variation
+			{
+			}
+			//DirectX 9.0 HLSL Vertex Shader vs_2_0
+			vertex_program_ref Basic_Vertex_Shader
+			{
+				// param_named_auto
+
+				param_named_auto Light1_attenuation light_attenuation 0
+				param_named_auto Light1_color light_diffuse_colour 0
+				param_named_auto Light1_position light_position_object_space 0
+				param_named Light1_spec_power float 0.3
+				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				
+				param_named_auto matViewProjection worldviewproj_matrix
+				param_named_auto vViewPosition camera_position_object_space
+				
+				
+				param_named skycolor float4 0.5 0.5 0.5 1.0
+				param_named groundcolor float4 0.10 0.10 0.10 1.0
+			}
+			
+			// HLSL Vertex Shader
+			shadow_receiver_vertex_program_ref Basic_Vertex_Shader_SR
+			{
+				//Shader Constant: matWorldViewProjection
+				param_named_auto matWorldViewProjection worldviewproj_matrix
+				//Shader Constant: matWorld
+				param_named_auto matWorld world_matrix
+				//Shader Constant: matTextureViewProjection
+				param_named_auto matTextureViewProjection texture_viewproj_matrix
+			}
+
 			texture_unit
 			{
-				texture_alias 0
+				texture ruchin_atlasmap.dds
+
+			}
+			texture_unit
+			{
 				texture Ruchin_ao_l_inside.dds
-				tex_coord_set 1
+
 			}
 		}
-
 	}
+	technique
+	{
+        pass
+        {
+            texture_unit
+            {
+                texture_alias diffuse
+            }
+        }
+    }
+//set_texture_alias diffuse ruchin_atlasmap.dds
 
+//set_texture_alias variation Ruchin_ao_l_inside.dds
+
 }
 
 material Material_#25/02_-_Default

Modified: modules/ruchin/models/ruchin_terrain.material
===================================================================
--- modules/ruchin/models/ruchin_terrain.material	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/ruchin/models/ruchin_terrain.material	2007-08-02 12:28:37 UTC (rev 3654)
@@ -6,8 +6,8 @@
    set_texture_alias red         nat_felsen_01.dds
    set_texture_alias green       boden_02.png
    set_texture_alias blue        nat_steingrund_01.dds
-   set_texture_alias alpha       Tiles.dds
-   set_texture_alias Lightingmap Lightingmap2.png
+   set_texture_alias alpha       nat_steingrund_01.dds
+   set_texture_alias Lightingmap Ligthingmap_default.png
    
    technique
    {

Modified: modules/ruchin/scripts/maps/maptest.rb
===================================================================
--- modules/ruchin/scripts/maps/maptest.rb	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/ruchin/scripts/maps/maptest.rb	2007-08-02 12:28:37 UTC (rev 3654)
@@ -10,13 +10,13 @@
 
 $CORE.getWorld().setSkyBox(true, &quot;rl/dsa07&quot;, 100.0)
 
-$SCRIPT.log(&quot;Tageslicht erstellen..&quot;);
-sunlight = $AM.createLightActor(&quot;sunlight&quot;, LightObject::LT_DIRECTIONAL);
-sunlight.getControlledObject().setDirection(-0.17101, -0.873647, 0.969846);
-sunlight.getControlledObject().setCastShadows(true);
+#$SCRIPT.log(&quot;Tageslicht erstellen..&quot;);
+#sunlight = $AM.createLightActor(&quot;sunlight&quot;, LightObject::LT_DIRECTIONAL);
+#sunlight.getControlledObject().setDirection(-0.17101, -0.873647, 0.969846);
+#sunlight.getControlledObject().setCastShadows(true);
 
-sunlight.getControlledObject().setDiffuseColour(0.8,0.8,0.8);
-sunlight.getControlledObject().setSpecularColour(1.0,1.0,1.0);
+#sunlight.getControlledObject().setDiffuseColour(0.8,0.8,0.8);
+#sunlight.getControlledObject().setSpecularColour(1.0,1.0,1.0);
 
 #sunlight.getControlledObject().setDiffuseColour(0.1,0.1,0.2);
 $SCRIPT.log(&quot;Tageslicht erstellt.&quot;);
@@ -29,8 +29,6 @@
 
 
 
-
-
 $World.setFog( World::FOG_EXP, [0.658,0.7568,0.9137,1.0], 0.00049, 0.8, 4.0);
 #$World.setAmbientLight( 0.3, 0.3, 0.3  );
 
@@ -75,6 +73,11 @@
 #BoxAnim = BoxActor.getControlledObject().startAnimation(&quot;Speak&quot;);
 #$SCRIPT.log(&quot;animation abgespielt.&quot;);
 
+
+
+loader = MapLoader.new(&quot;ruchin&quot;);
+loader.loadMap(&quot;ruchin_lightzones.rlmap.xml&quot;);
+
 ##########################
 
 load &quot;particle.rb&quot;

Modified: modules/ruchin/scripts/particle.rb
===================================================================
--- modules/ruchin/scripts/particle.rb	2007-08-01 11:41:16 UTC (rev 3653)
+++ modules/ruchin/scripts/particle.rb	2007-08-02 12:28:37 UTC (rev 3654)
@@ -9,11 +9,11 @@
 templefire2 = $AM.createParticleSystemActor(&quot;templefire2&quot;, &quot;feuertest&quot; );
 templefire2.placeIntoScene( 123.28,3.0,-18.93, 1.0, 0.0, 0.0, 0.0 );
 
-nebel = $AM.createParticleSystemActor(&quot;nebel&quot;, &quot;nebel&quot; );
-nebel.placeIntoScene( 32.02, -2.26, -24.40, 1.0, 0.0, 0.0, 0.0 );
+#nebel = $AM.createParticleSystemActor(&quot;nebel&quot;, &quot;nebel&quot; );
+#nebel.placeIntoScene( 32.02, -2.26, -24.40, 1.0, 0.0, 0.0, 0.0 );
 
-nebel2 = $AM.createParticleSystemActor(&quot;nebel2&quot;, &quot;nebel&quot; );
-nebel2.placeIntoScene( 26.47, -2.5, -37.92, 1.0, 0.0, 0.0, 0.0 );
+#nebel2 = $AM.createParticleSystemActor(&quot;nebel2&quot;, &quot;nebel&quot; );
+#nebel2.placeIntoScene( 26.47, -2.5, -37.92, 1.0, 0.0, 0.0, 0.0 );
 
 qualm1 = $AM.createParticleSystemActor(&quot;qualm1&quot;, &quot;qualm&quot; );
 qualm1.placeIntoScene( -4.28, 3.00, -1.66, 1.0, 0.0, 0.0, 0.0 );


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000724.html">[Dsa-hl-svn] r3653 - in rl/trunk/engine/rules: include src
</A></li>
	<LI>Next message: <A HREF="000726.html">[Dsa-hl-svn] r3655 - rl/trunk/docs/documents
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#725">[ date ]</a>
              <a href="thread.html#725">[ thread ]</a>
              <a href="subject.html#725">[ subject ]</a>
              <a href="author.html#725">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
