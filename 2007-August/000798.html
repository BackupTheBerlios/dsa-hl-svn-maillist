<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3727 - modules/common/scripts	modules/techdemo2/scripts modules/tutorial/scripts/maps	rl/trunk rl/trunk/engine rl/trunk/engine/ai	rl/trunk/engine/ai/include	rl/trunk/engine/ai/include/predicates rl/trunk/engine/ai/src	rl/trunk/engine/script rl/trunk/engine/script/swig	rl/trunk/engine/startup/src rl/trunk/engine/ui	rl/trunk/engine/ui/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3727%20-%20modules/common/scripts%0A%09modules/techdemo2/scripts%20modules/tutorial/scripts/maps%0A%09rl/trunk%20rl/trunk/engine%20rl/trunk/engine/ai%0A%09rl/trunk/engine/ai/include%0A%09rl/trunk/engine/ai/include/predicates%20rl/trunk/engine/ai/src%0A%09rl/trunk/engine/script%20rl/trunk/engine/script/swig%0A%09rl/trunk/engine/startup/src%20rl/trunk/engine/ui%0A%09rl/trunk/engine/ui/src&In-Reply-To=%3C200708212206.l7LM6OIY009253%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000797.html">
   <LINK REL="Next"  HREF="000799.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3727 - modules/common/scripts	modules/techdemo2/scripts modules/tutorial/scripts/maps	rl/trunk rl/trunk/engine rl/trunk/engine/ai	rl/trunk/engine/ai/include	rl/trunk/engine/ai/include/predicates rl/trunk/engine/ai/src	rl/trunk/engine/script rl/trunk/engine/script/swig	rl/trunk/engine/startup/src rl/trunk/engine/ui	rl/trunk/engine/ui/src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3727%20-%20modules/common/scripts%0A%09modules/techdemo2/scripts%20modules/tutorial/scripts/maps%0A%09rl/trunk%20rl/trunk/engine%20rl/trunk/engine/ai%0A%09rl/trunk/engine/ai/include%0A%09rl/trunk/engine/ai/include/predicates%20rl/trunk/engine/ai/src%0A%09rl/trunk/engine/script%20rl/trunk/engine/script/swig%0A%09rl/trunk/engine/startup/src%20rl/trunk/engine/ui%0A%09rl/trunk/engine/ui/src&In-Reply-To=%3C200708212206.l7LM6OIY009253%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3727 - modules/common/scripts	modules/techdemo2/scripts modules/tutorial/scripts/maps	rl/trunk rl/trunk/engine rl/trunk/engine/ai	rl/trunk/engine/ai/include	rl/trunk/engine/ai/include/predicates rl/trunk/engine/ai/src	rl/trunk/engine/script rl/trunk/engine/script/swig	rl/trunk/engine/startup/src rl/trunk/engine/ui	rl/trunk/engine/ui/src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Wed Aug 22 00:06:24 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000797.html">[Dsa-hl-svn] r3726 - in rl/trunk/engine/common: include src
</A></li>
        <LI>Next message: <A HREF="000799.html">[Dsa-hl-svn] r3728 - in modules: common/scripts minidemo/scripts	techdemo2/scripts techdemo2/scripts/maps tutorial/scripts/maps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#798">[ date ]</a>
              <a href="thread.html#798">[ thread ]</a>
              <a href="subject.html#798">[ subject ]</a>
              <a href="author.html#798">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2007-08-22 00:05:49 +0200 (Wed, 22 Aug 2007)
New Revision: 3727

Removed:
   rl/trunk/engine/ai/include/DialogPrerequisites.h
   rl/trunk/engine/ai/include/DialogSubsystem.h
   rl/trunk/engine/dialog/
   rl/trunk/engine/script/swig/RlDialog.head.swig
   rl/trunk/engine/script/swig/RlDialog.swig
Modified:
   modules/common/scripts/globals.rb
   modules/common/scripts/npc.rb
   modules/techdemo2/scripts/forrest.rb
   modules/techdemo2/scripts/jarn.rb
   modules/tutorial/scripts/maps/nscs.rb
   rl/trunk/Rastullah2005.sln
   rl/trunk/configure.in
   rl/trunk/engine/ai/RlAI2005.vcproj
   rl/trunk/engine/ai/include/AiSubsystem.h
   rl/trunk/engine/ai/include/AimlNodeImplRl.h
   rl/trunk/engine/ai/include/AimlParserImplRl.h
   rl/trunk/engine/ai/include/ContextConditionProcessor.h
   rl/trunk/engine/ai/include/ContextInterpreter.h
   rl/trunk/engine/ai/include/DialogCharacter.h
   rl/trunk/engine/ai/include/DialogOption.h
   rl/trunk/engine/ai/include/DialogResponse.h
   rl/trunk/engine/ai/include/DialogScriptProcessor.h
   rl/trunk/engine/ai/include/Makefile.am
   rl/trunk/engine/ai/include/ScriptProcessor.h
   rl/trunk/engine/ai/include/predicates/CreaturePredicates.h
   rl/trunk/engine/ai/include/predicates/QuestKnownPredicates.h
   rl/trunk/engine/ai/include/predicates/QuestPartsPredicates.h
   rl/trunk/engine/ai/include/predicates/QuestStatePredicates.h
   rl/trunk/engine/ai/include/predicates/ScriptPredicates.h
   rl/trunk/engine/ai/src/AgentDialogState.cpp
   rl/trunk/engine/ai/src/AiSubsystem.cpp
   rl/trunk/engine/ai/src/DialogCharacter.cpp
   rl/trunk/engine/ai/src/DialogOption.cpp
   rl/trunk/engine/ai/src/Makefile.am
   rl/trunk/engine/script/RlScript2005.vcproj
   rl/trunk/engine/script/swig/RlAi.head.swig
   rl/trunk/engine/script/swig/RlAi.swig
   rl/trunk/engine/script/swig/RlCore.swig
   rl/trunk/engine/script/swig/RlExports.i
   rl/trunk/engine/startup/src/RastullahMain.cpp
   rl/trunk/engine/ui/RlUI2005.vcproj
   rl/trunk/engine/ui/src/DialogControlState.cpp
Log:
Finished merging dialog subsystem into the AI subsystem

Modified: modules/common/scripts/globals.rb
===================================================================
--- modules/common/scripts/globals.rb	2007-08-21 19:44:44 UTC (rev 3726)
+++ modules/common/scripts/globals.rb	2007-08-21 22:05:49 UTC (rev 3727)
@@ -11,7 +11,6 @@
 $PM = PhysicsManager.getSingleton();
 $UI = UiSubsystem.getSingleton();
 $DM = DsaManager.getSingleton();
-$DS = DialogSubsystem.getSingleton();
 $WF = WindowFactory.getSingleton();
 $AI = AgentManager.getSingleton();
 $WPGM = WayPointGraphManager.getSingleton();

Modified: modules/common/scripts/npc.rb
===================================================================
--- modules/common/scripts/npc.rb	2007-08-21 19:44:44 UTC (rev 3726)
+++ modules/common/scripts/npc.rb	2007-08-21 22:05:49 UTC (rev 3727)
@@ -6,14 +6,23 @@
   end
 
   def doAction(object, actor, target)
-    bot = $DS.getBot(object.getName())
+    bot = $AI.getBot(object.getName())
     if (bot.nil?)
-      bot = $DS.loadBot(object.getName(), object.getDialogfile())
+      bot = $AI.loadBot(object.getName(), object.getDialogfile())
     end
     if ( not bot.nil? )
+	  p &quot;foo1&quot;
       bot.setPlayerCharacter( actor );
+	  p &quot;foo2&quot;
       bot.setNonPlayerCharacter( object );
-      $IM.pushControlState(CST_DIALOG);
+	  p &quot;foo3&quot;
+	  p &quot;foo4&quot;
+	  agent = AgentManager::getSingleton().createAgent(object)
+	  agent.pushState(RlScript::AST_DIALOG);
+	  p &quot;foo5&quot;
+	  agent.getCurrentState().setDialogPartner(
+		AgentManager::getSingleton().createAgent(actor))
+	  p &quot;foo6&quot;
     end
   end
 end

Modified: modules/techdemo2/scripts/forrest.rb
===================================================================
--- modules/techdemo2/scripts/forrest.rb	2007-08-21 19:44:44 UTC (rev 3726)
+++ modules/techdemo2/scripts/forrest.rb	2007-08-21 22:05:49 UTC (rev 3727)
@@ -10,7 +10,7 @@
 #forrest.setActor($AM.createMeshActor(&quot;Forrest&quot;, &quot;men_Gennisch.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 #forrest.getActor().placeIntoScene([-20.83, -6.70, 19.46]);
 #
-#bot=$DS.loadBot(&quot;Forrest&quot;, &quot;forrest.xml&quot;);
+#bot=$AI.loadBot(&quot;Forrest&quot;, &quot;forrest.xml&quot;);
 #bot.setNonPlayerCharacter(forrest);
 #forrest.addAction(TalkAction.new(&quot;Forrest&quot;, &quot;forrest.xml&quot;));
 #agent = $AI.createAgent(bot);

Modified: modules/techdemo2/scripts/jarn.rb
===================================================================
--- modules/techdemo2/scripts/jarn.rb	2007-08-21 19:44:44 UTC (rev 3726)
+++ modules/techdemo2/scripts/jarn.rb	2007-08-21 22:05:49 UTC (rev 3727)
@@ -11,7 +11,7 @@
 #jarn.setActor($AM.createMeshActor(&quot;Jarn&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 #jarn.getActor().placeIntoScene([ -36.16, -6.25, 18.12],[0.0, -23.40, 0.0]);
 
-#bot = $DS.loadBot(&quot;Jarn&quot;, &quot;jarn.xml&quot;);
+#bot = $AI.loadBot(&quot;Jarn&quot;, &quot;jarn.xml&quot;);
 #bot.setNonPlayerCharacter(jarn);
 #jarn.addAction(TalkAction.new(&quot;Jarn&quot;, &quot;jarn.xml&quot;));
 #agent = $AI.createAgent(bot);

Modified: modules/tutorial/scripts/maps/nscs.rb
===================================================================
--- modules/tutorial/scripts/maps/nscs.rb	2007-08-21 19:44:44 UTC (rev 3726)
+++ modules/tutorial/scripts/maps/nscs.rb	2007-08-21 22:05:49 UTC (rev 3727)
@@ -7,7 +7,7 @@
 nsc01.setActor($AM.createMeshActor(&quot;AIML01&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 nsc01.getActor().placeIntoScene([ -1.46, 0.00, -3.57],[0.0, 180.0, 0.0]);
 
-bot01 = $DS.loadBot(&quot;AIML01&quot;, &quot;nscs.xml&quot;);
+bot01 = $AI.loadBot(&quot;AIML01&quot;, &quot;nscs.xml&quot;);
 bot01.setNonPlayerCharacter(nsc01);
 nsc01.addAction(TalkAction.new(&quot;AIML01&quot;, &quot;nscs.xml&quot;));
 agent01 = $AI.createAgent(bot01);
@@ -22,7 +22,7 @@
 nsc02.setActor($AM.createMeshActor(&quot;AIML02&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 nsc02.getActor().placeIntoScene([ -0.46, 0.00, -3.57],[0.0, 180.0, 0.0]);
 
-bot02 = $DS.loadBot(&quot;AIML02&quot;, &quot;nscs.xml&quot;);
+bot02 = $AI.loadBot(&quot;AIML02&quot;, &quot;nscs.xml&quot;);
 bot02.setNonPlayerCharacter(nsc02);
 nsc02.addAction(TalkAction.new(&quot;AIML02&quot;, &quot;nscs.xml&quot;));
 agent02 = $AI.createAgent(bot02);
@@ -37,7 +37,7 @@
 nsc03.setActor($AM.createMeshActor(&quot;AIML03&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 nsc03.getActor().placeIntoScene([ 0.7, 0.00, -3.57],[0.0, 180.0, 0.0]);
 
-bot03 = $DS.loadBot(&quot;AIML03&quot;, &quot;nscs.xml&quot;);
+bot03 = $AI.loadBot(&quot;AIML03&quot;, &quot;nscs.xml&quot;);
 bot03.setNonPlayerCharacter(nsc03);
 nsc03.addAction(TalkAction.new(&quot;AIML03&quot;, &quot;nscs.xml&quot;));
 agent03 = $AI.createAgent(bot03);
@@ -52,7 +52,7 @@
 nsc04.setActor($AM.createMeshActor(&quot;AIML04&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 nsc04.getActor().placeIntoScene([ 1.82, 0.00, -3.57],[0.0, 180.0, 0.0]);
 
-bot04 = $DS.loadBot(&quot;AIML04&quot;, &quot;nscs.xml&quot;);
+bot04 = $AI.loadBot(&quot;AIML04&quot;, &quot;nscs.xml&quot;);
 bot04.setNonPlayerCharacter(nsc04);
 nsc04.addAction(TalkAction.new(&quot;AIML04&quot;, &quot;nscs.xml&quot;));
 agent04 = $AI.createAgent(bot04);
@@ -67,7 +67,7 @@
 nsc05.setActor($AM.createMeshActor(&quot;AIML05&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 nsc05.getActor().placeIntoScene([ 2.88, -0.01, -0.58],[0.0, 90.0, 0.0]);
 
-bot05 = $DS.loadBot(&quot;AIML05&quot;, &quot;nscs.xml&quot;);
+bot05 = $AI.loadBot(&quot;AIML05&quot;, &quot;nscs.xml&quot;);
 bot05.setNonPlayerCharacter(nsc05);
 nsc05.addAction(TalkAction.new(&quot;AIML05&quot;, &quot;nscs.xml&quot;));
 agent05 = $AI.createAgent(bot05);
@@ -83,7 +83,7 @@
 nsc06.setActor($AM.createMeshActor(&quot;AIML06&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 nsc06.getActor().placeIntoScene([ 2.88, -0.01, 1.0],[0.0, 90.0, 0.0]);
 
-bot06 = $DS.loadBot(&quot;AIML06&quot;, &quot;nscs.xml&quot;);
+bot06 = $AI.loadBot(&quot;AIML06&quot;, &quot;nscs.xml&quot;);
 bot06.setNonPlayerCharacter(nsc06);
 nsc06.addAction(TalkAction.new(&quot;AIML06&quot;, &quot;nscs.xml&quot;));
 agent06 = $AI.createAgent(bot06);
@@ -100,7 +100,7 @@
 nsc08.setActor($AM.createMeshActor(&quot;AIML08&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 nsc08.getActor().placeIntoScene([ 2.88, -0.01, 2.36],[0.0, 90.0, 0.0]);
 
-bot08 = $DS.loadBot(&quot;AIML08&quot;, &quot;nscs.xml&quot;);
+bot08 = $AI.loadBot(&quot;AIML08&quot;, &quot;nscs.xml&quot;);
 bot08.setNonPlayerCharacter(nsc08);
 nsc08.addAction(TalkAction.new(&quot;AIML08&quot;, &quot;nscs.xml&quot;));
 agent08 = $AI.createAgent(bot08);
@@ -115,7 +115,7 @@
 nsc09.setActor($AM.createMeshActor(&quot;AIML09&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 nsc09.getActor().placeIntoScene([ 1.97, -0.01, 3.78],[0.0, 0.0, 0.0]);
 
-bot09 = $DS.loadBot(&quot;AIML09&quot;, &quot;nscs.xml&quot;);
+bot09 = $AI.loadBot(&quot;AIML09&quot;, &quot;nscs.xml&quot;);
 bot09.setNonPlayerCharacter(nsc09);
 nsc09.addAction(TalkAction.new(&quot;AIML09&quot;, &quot;nscs.xml&quot;));
 agent09 = $AI.createAgent(bot09);
@@ -131,7 +131,7 @@
 nsc10.setActor($AM.createMeshActor(&quot;AIML10&quot;, &quot;men_gennisch2.mesh&quot;, PhysicsManager::GT_ELLIPSOID, 75.0));
 nsc10.getActor().placeIntoScene([ 0.13, -0.01, 3.78],[0.0, 0.0, 0.0]);
 
-bot10 = $DS.loadBot(&quot;AIML10&quot;, &quot;nscs.xml&quot;);
+bot10 = $AI.loadBot(&quot;AIML10&quot;, &quot;nscs.xml&quot;);
 bot10.setNonPlayerCharacter(nsc10);
 nsc10.addAction(TalkAction.new(&quot;AIML10&quot;, &quot;nscs.xml&quot;));
 agent10 = $AI.createAgent(bot10);

Modified: rl/trunk/Rastullah2005.sln
===================================================================
--- rl/trunk/Rastullah2005.sln	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/Rastullah2005.sln	2007-08-21 22:05:49 UTC (rev 3727)
@@ -7,13 +7,6 @@
 		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
 	EndProjectSection
 EndProject
-Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlDialog&quot;, &quot;engine\dialog\RlDialog2005.vcproj&quot;, &quot;{6361481B-A6D5-4BC2-826C-C26A49C631A8}&quot;
-	ProjectSection(ProjectDependencies) = postProject
-		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
-		{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070} = {1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}
-		{0935F495-4540-40E3-AC8F-AA54C85DC5B2} = {0935F495-4540-40E3-AC8F-AA54C85DC5B2}
-	EndProjectSection
-EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlRules&quot;, &quot;engine\rules\RlRules2005.vcproj&quot;, &quot;{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}&quot;
 	ProjectSection(ProjectDependencies) = postProject
 		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
@@ -27,7 +20,6 @@
 		{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070} = {1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}
 		{0935F495-4540-40E3-AC8F-AA54C85DC5B2} = {0935F495-4540-40E3-AC8F-AA54C85DC5B2}
 		{C3E78B89-587B-499A-BE7D-4FE8564F0CD7} = {C3E78B89-587B-499A-BE7D-4FE8564F0CD7}
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8} = {6361481B-A6D5-4BC2-826C-C26A49C631A8}
 	EndProjectSection
 EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlStartup&quot;, &quot;engine\startup\RlStartup2005.vcproj&quot;, &quot;{B78AEF70-E618-4E9D-BD67-E17995ECF714}&quot;
@@ -38,20 +30,18 @@
 		{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070} = {1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}
 		{0935F495-4540-40E3-AC8F-AA54C85DC5B2} = {0935F495-4540-40E3-AC8F-AA54C85DC5B2}
 		{C3E78B89-587B-499A-BE7D-4FE8564F0CD7} = {C3E78B89-587B-499A-BE7D-4FE8564F0CD7}
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8} = {6361481B-A6D5-4BC2-826C-C26A49C631A8}
 	EndProjectSection
 EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlUI&quot;, &quot;engine\ui\RlUI2005.vcproj&quot;, &quot;{53FE20F3-E726-44FE-BBEC-D29CAE210D25}&quot;
 	ProjectSection(ProjectDependencies) = postProject
+		{C3E78B89-587B-499A-BE7D-4FE8564F0CD7} = {C3E78B89-587B-499A-BE7D-4FE8564F0CD7}
 		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
 		{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070} = {1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}
 		{0935F495-4540-40E3-AC8F-AA54C85DC5B2} = {0935F495-4540-40E3-AC8F-AA54C85DC5B2}
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8} = {6361481B-A6D5-4BC2-826C-C26A49C631A8}
 	EndProjectSection
 EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlAI&quot;, &quot;engine\ai\RlAI2005.vcproj&quot;, &quot;{C3E78B89-587B-499A-BE7D-4FE8564F0CD7}&quot;
 	ProjectSection(ProjectDependencies) = postProject
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8} = {6361481B-A6D5-4BC2-826C-C26A49C631A8}
 		{0935F495-4540-40E3-AC8F-AA54C85DC5B2} = {0935F495-4540-40E3-AC8F-AA54C85DC5B2}
 		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
 		{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070} = {1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}
@@ -90,12 +80,6 @@
 		{0935F495-4540-40E3-AC8F-AA54C85DC5B2}.Release|Win32.Build.0 = Release|Win32
 		{0935F495-4540-40E3-AC8F-AA54C85DC5B2}.ReleaseWithSymbols|Win32.ActiveCfg = Release with Symbols|Win32
 		{0935F495-4540-40E3-AC8F-AA54C85DC5B2}.ReleaseWithSymbols|Win32.Build.0 = Release with Symbols|Win32
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8}.Debug|Win32.ActiveCfg = Debug|Win32
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8}.Debug|Win32.Build.0 = Debug|Win32
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8}.Release|Win32.ActiveCfg = Release|Win32
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8}.Release|Win32.Build.0 = Release|Win32
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8}.ReleaseWithSymbols|Win32.ActiveCfg = Release with Symbols|Win32
-		{6361481B-A6D5-4BC2-826C-C26A49C631A8}.ReleaseWithSymbols|Win32.Build.0 = Release with Symbols|Win32
 		{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}.Debug|Win32.ActiveCfg = Debug|Win32
 		{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}.Debug|Win32.Build.0 = Debug|Win32
 		{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}.Release|Win32.ActiveCfg = Release|Win32

Modified: rl/trunk/configure.in
===================================================================
--- rl/trunk/configure.in	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/configure.in	2007-08-21 22:05:49 UTC (rev 3727)
@@ -178,7 +178,6 @@
         engine/ai/Makefile engine/ai/src/Makefile engine/ai/include/Makefile\
         engine/common/Makefile engine/common/src/Makefile engine/common/include/Makefile \
         engine/core/Makefile engine/core/src/Makefile engine/core/include/Makefile \
-        engine/dialog/Makefile engine/dialog/src/Makefile engine/dialog/include/Makefile \
         engine/ui/Makefile engine/ui/src/Makefile engine/ui/include/Makefile \
         engine/rules/Makefile engine/rules/src/Makefile engine/rules/include/Makefile \
         engine/script/Makefile engine/script/swig/Makefile engine/script/src/Makefile engine/script/include/Makefile \

Modified: rl/trunk/engine/ai/RlAI2005.vcproj
===================================================================
--- rl/trunk/engine/ai/RlAI2005.vcproj	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/RlAI2005.vcproj	2007-08-21 22:05:49 UTC (rev 3727)
@@ -41,7 +41,7 @@
 				Name=&quot;VCCLCompilerTool&quot;
 				AdditionalOptions=&quot;-Zm130&quot;
 				Optimization=&quot;0&quot;
-				AdditionalIncludeDirectories=&quot;.\include;..\common\include;..\core\include;..\rules\include;..\dialog\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\cegui_mk2\include;..\..\dependencies\opensteer\include;..\..\dependencies\boost\include;..\..\dependencies\NewtonSDK\sdk\&quot;
+				AdditionalIncludeDirectories=&quot;.\include;.\include\predicates;..\common\include;..\core\include;..\rules\include;..\dialog\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\cegui_mk2\include;..\..\dependencies\opensteer\include;..\..\dependencies\boost\include;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\aiml\MadaBot\include;..\..\dependencies\aiml\dependencies&quot;
 				PreprocessorDefinitions=&quot;WITH_FMOD3;_WINDOWS;_DEBUG;WIN32;RLAI_EXPORTS;_CRT_SECURE_NO_DEPRECATE;RL_USE_PCH&quot;
 				MinimalRebuild=&quot;true&quot;
 				BasicRuntimeChecks=&quot;3&quot;
@@ -73,10 +73,10 @@
 				Name=&quot;VCLinkerTool&quot;
 				IgnoreImportLibrary=&quot;false&quot;
 				AdditionalOptions=&quot;/NODEFAULTLIB:MSVCRT&amp;#x0D;&amp;#x0A;&quot;
-				AdditionalDependencies=&quot;OgreMain_d.lib OgreNewt_d.lib CEGUIBase_d.lib opensteerd.lib RlCommon.lib RlCore.lib RlRules.lib RlDialog.lib Newton.lib&quot;
+				AdditionalDependencies=&quot;OgreMain_d.lib OgreNewt_d.lib CEGUIBase_d.lib opensteerd.lib RlCommon.lib RlCore.lib RlRules.lib Newton.lib MadaBot.lib xerces-c_2D.lib&quot;
 				OutputFile=&quot;$(OutDir)/RlAI.dll&quot;
 				LinkIncremental=&quot;2&quot;
-				AdditionalLibraryDirectories=&quot;&quot;..\common\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\dialog\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib\;&quot;..\..\dependencies\ogrenewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\opensteer\lib;..\..\dependencies\boost\lib;..\..\dependencies\NewtonSDK\sdk\dll&quot;
+				AdditionalLibraryDirectories=&quot;&quot;..\common\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\dialog\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib\;&quot;..\..\dependencies\ogrenewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\opensteer\lib;..\..\dependencies\boost\lib;..\..\dependencies\NewtonSDK\sdk\dll;&quot;..\..\dependencies\aiml\MadaBot\lib\$(ConfigurationName)&quot;&quot;
 				GenerateDebugInformation=&quot;true&quot;
 				AssemblyDebug=&quot;1&quot;
 				ProgramDatabaseFile=&quot;$(OutDir)/RlAI.pdb&quot;
@@ -141,7 +141,7 @@
 				Optimization=&quot;3&quot;
 				EnableIntrinsicFunctions=&quot;true&quot;
 				FavorSizeOrSpeed=&quot;1&quot;
-				AdditionalIncludeDirectories=&quot;.\include;..\common\include;..\core\include;..\rules\include;..\dialog\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\cegui_mk2\include;..\..\dependencies\opensteer\include;..\..\dependencies\boost\include;..\..\dependencies\NewtonSDK\sdk\&quot;
+				AdditionalIncludeDirectories=&quot;.\include;.\include\predicates;..\common\include;..\core\include;..\rules\include;..\dialog\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\cegui_mk2\include;..\..\dependencies\opensteer\include;..\..\dependencies\boost\include;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\aiml\MadaBot\include;..\..\dependencies\aiml\dependencies&quot;
 				PreprocessorDefinitions=&quot;WITH_FMOD3;WIN32;NDEBUG;_WINDOWS;_USRDLL;RLAI_EXPORTS;_CRT_SECURE_NO_DEPRECATE;RL_USE_PCH&quot;
 				RuntimeLibrary=&quot;2&quot;
 				UsePrecompiledHeader=&quot;2&quot;
@@ -161,10 +161,10 @@
 			/&gt;
 			&lt;Tool
 				Name=&quot;VCLinkerTool&quot;
-				AdditionalDependencies=&quot;OgreMain.lib OgreNewt.lib CEGUIBase.lib opensteer.lib RlCommon.lib RlCore.lib RlRules.lib RlDialog.lib Newton.lib&quot;
+				AdditionalDependencies=&quot;OgreMain.lib OgreNewt.lib CEGUIBase.lib opensteer.lib RlCommon.lib RlCore.lib RlRules.lib Newton.lib MadaBot.lib xerces-c_2.lib&quot;
 				OutputFile=&quot;$(OutDir)/RlAI.dll&quot;
 				LinkIncremental=&quot;1&quot;
-				AdditionalLibraryDirectories=&quot;&quot;..\common\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\dialog\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;&quot;..\..\dependencies\ogrenewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\opensteer\lib;..\..\dependencies\boost\lib;..\..\dependencies\NewtonSDK\sdk\dll&quot;
+				AdditionalLibraryDirectories=&quot;&quot;..\common\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\dialog\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib\;&quot;..\..\dependencies\ogrenewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\opensteer\lib;..\..\dependencies\boost\lib;..\..\dependencies\NewtonSDK\sdk\dll;&quot;..\..\dependencies\aiml\MadaBot\lib\$(ConfigurationName)&quot;&quot;
 				GenerateDebugInformation=&quot;false&quot;
 				SubSystem=&quot;2&quot;
 				OptimizeReferences=&quot;2&quot;
@@ -227,7 +227,7 @@
 				Optimization=&quot;3&quot;
 				EnableIntrinsicFunctions=&quot;true&quot;
 				FavorSizeOrSpeed=&quot;1&quot;
-				AdditionalIncludeDirectories=&quot;.\include;..\common\include;..\core\include;..\rules\include;..\dialog\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\cegui_mk2\include;..\..\dependencies\opensteer\include;..\..\dependencies\boost\include;..\..\dependencies\NewtonSDK\sdk\&quot;
+				AdditionalIncludeDirectories=&quot;.\include;.\include\predicates;..\common\include;..\core\include;..\rules\include;..\dialog\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\cegui_mk2\include;..\..\dependencies\opensteer\include;..\..\dependencies\boost\include;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\aiml\MadaBot\include;..\..\dependencies\aiml\dependencies&quot;
 				PreprocessorDefinitions=&quot;WITH_FMOD3;WIN32;NDEBUG;_WINDOWS;_USRDLL;RLAI_EXPORTS;_CRT_SECURE_NO_DEPRECATE;RL_USE_PCH&quot;
 				RuntimeLibrary=&quot;2&quot;
 				UsePrecompiledHeader=&quot;2&quot;
@@ -247,10 +247,10 @@
 			/&gt;
 			&lt;Tool
 				Name=&quot;VCLinkerTool&quot;
-				AdditionalDependencies=&quot;OgreMain.lib OgreNewt.lib CEGUIBase.lib opensteer.lib RlCommon.lib RlCore.lib RlRules.lib RlDialog.lib Newton.lib&quot;
+				AdditionalDependencies=&quot;OgreMain.lib OgreNewt.lib CEGUIBase.lib opensteer.lib RlCommon.lib RlCore.lib RlRules.lib Newton.lib MadaBot.lib xerces-c_2.lib&quot;
 				OutputFile=&quot;$(OutDir)/RlAI.dll&quot;
 				LinkIncremental=&quot;1&quot;
-				AdditionalLibraryDirectories=&quot;..\common\lib\Release;..\core\lib\Release;..\rules\lib\Release;..\dialog\lib\Release;..\..\dependencies\ogrenew\lib;..\..\dependencies\ogrenewt\lib\Release;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\opensteer\lib;..\..\dependencies\boost\lib;..\..\dependencies\NewtonSDK\sdk\dll&quot;
+				AdditionalLibraryDirectories=&quot;&quot;..\common\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\dialog\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib\;&quot;..\..\dependencies\ogrenewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\opensteer\lib;..\..\dependencies\boost\lib;..\..\dependencies\NewtonSDK\sdk\dll;&quot;..\..\dependencies\aiml\MadaBot\lib\$(ConfigurationName)&quot;&quot;
 				GenerateDebugInformation=&quot;true&quot;
 				SubSystem=&quot;2&quot;
 				OptimizeReferences=&quot;2&quot;
@@ -315,6 +315,14 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\AimlNodeImplRl.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\src\AimlParserImplRl.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\AiSubsystem.cpp&quot;
 				&gt;
 			&lt;/File&gt;
@@ -343,10 +351,34 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\ContextConditionProcessor.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\src\ContextInterpreter.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\CreatureWalkPathJob.cpp&quot;
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\DialogCharacter.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\src\DialogOption.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\src\DialogResponse.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\src\DialogScriptProcessor.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\Landmark.cpp&quot;
 				&gt;
 			&lt;/File&gt;
@@ -359,6 +391,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\ScriptProcessor.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\stdinc.cpp&quot;
 				&gt;
 				&lt;FileConfiguration
@@ -402,6 +438,50 @@
 				RelativePath=&quot;.\src\WayPointNode.cpp&quot;
 				&gt;
 			&lt;/File&gt;
+			&lt;Filter
+				Name=&quot;predicates&quot;
+				&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\CreaturePredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\EigenschaftsProbePredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\EigenschaftsWertPredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\GrundWertPredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\QuestKnownPredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\QuestPartsPredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\QuestStatePredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\ScriptPredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\TalentProbePredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\predicates\TalentWertPredicates.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+			&lt;/Filter&gt;
 		&lt;/Filter&gt;
 		&lt;Filter
 			Name=&quot;Headerdateien&quot;
@@ -433,6 +513,14 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\AimlNodeImplRl.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\include\AimlParserImplRl.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\AiPrerequisites.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -465,10 +553,34 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\ContextConditionProcessor.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\include\ContextInterpreter.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\CreatureWalkPathJob.h&quot;
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\DialogCharacter.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\include\DialogOption.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\include\DialogResponse.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\include\DialogScriptProcessor.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\FuzzyState.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -489,6 +601,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\ScriptProcessor.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\stdinc.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -512,6 +628,50 @@
 				RelativePath=&quot;.\include\WayPointNode.h&quot;
 				&gt;
 			&lt;/File&gt;
+			&lt;Filter
+				Name=&quot;predicates&quot;
+				&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\CreaturePredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\EigenschaftsProbePredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\EigenschaftsWertPredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\GrundWertPredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\QuestKnownPredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\QuestPartsPredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\QuestStatePredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\ScriptPredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\TalentProbePredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\predicates\TalentWertPredicates.h&quot;
+					&gt;
+				&lt;/File&gt;
+			&lt;/Filter&gt;
 		&lt;/Filter&gt;
 		&lt;Filter
 			Name=&quot;Ressourcendateien&quot;

Modified: rl/trunk/engine/ai/include/AiSubsystem.h
===================================================================
--- rl/trunk/engine/ai/include/AiSubsystem.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/AiSubsystem.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -23,11 +23,18 @@
 #include &quot;MessagePump.h&quot;
 #include &quot;World.h&quot;
 
+namespace MadaBot
+{
+	template &lt;class S&gt; class AimlCore;
+}
+
 namespace rl
 {
 	class Agent;
 	class AgentManager;
 	class AiWorld;
+	class ContextInterpreter;
+	class DialogCharacter;
 	class Landmark;
 	class LandmarkPath;
 	class WayPointGraphManager;
@@ -74,8 +81,45 @@
 
 		Landmark* getLandmark(const Ogre::String&amp; name) const;
 
+		/**
+		 * Get the bot with the given name
+		 * @return the bot or NULL if the bot does not exist
+		 */
+		DialogCharacter* getBot(const CeGuiString&amp; botName);
+
+		ContextInterpreter* getContextInterpreter();
+
+		/**
+		 * Load a DialogCharacter from a xml file
+		 * If no name is given, the first available bot in the xml file is loaded
+		 * @param fileName xml file with the bot definition
+		 * @param botName name of the bot to load
+		 * @return will return a DialogCharacter...
+		 */
+		DialogCharacter* loadBot(const CeGuiString&amp; botName, const CeGuiString&amp; fileName = &quot;&quot;);
+	
+        /**
+         * Helper function, that retrieves an xml resource from its file name
+         * If resource not yet created, it gets first searched in the current
+         * adventure module group, then in the default group.
+         */
+        Ogre::ResourcePtr getXmlResource(const Ogre::String&amp; filename);
+
+		/**
+		 * Set the DialogCharacter loaded from ruby
+		 */
+		void setCurrentDialogCharacter(DialogCharacter* bot);
+		DialogCharacter* getCurrentDialogCharacter() const;
+
 	private:
-		/** Initializes the AI subsystem.
+		typedef std::map&lt;CeGuiString, DialogCharacter*&gt; BotMap;
+		typedef MadaBot::AimlCore&lt;CeGuiString&gt; AimlCore; 
+		BotMap mBots;
+		AimlCore* mCore;
+		ContextInterpreter* mContextInterpreter;
+		DialogCharacter* mCurrentBot;
+
+        /** Initializes the AI subsystem.
 		 * Creates AiWorld and AgentManager, registers a scene listener,
 		 * adds the AgentManager to the GameLoop as a task.
 		 */
@@ -107,8 +151,13 @@
 	    MessagePump::ScopedConnection mSceneClearingConnection;
 	};
 
-	inline AiWorld* AiSubsystem::getWorld()
+	inline ContextInterpreter* AiSubsystem::getContextInterpreter()
 	{
+		return mContextInterpreter;
+	}
+
+    inline AiWorld* AiSubsystem::getWorld()
+	{
 		return mWorld;
 	}
 }

Modified: rl/trunk/engine/ai/include/AimlNodeImplRl.h
===================================================================
--- rl/trunk/engine/ai/include/AimlNodeImplRl.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/AimlNodeImplRl.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_AimlNodeImplRl_H__
 #define __Rl_AimlNodeImplRl_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;AimlNode.h&quot;
 
 using namespace MadaBot;

Modified: rl/trunk/engine/ai/include/AimlParserImplRl.h
===================================================================
--- rl/trunk/engine/ai/include/AimlParserImplRl.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/AimlParserImplRl.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_AimlParserImplRl_H__
 #define __Rl_AimlParserImplRl_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;XmlMapper/XmlParser.h&quot;
 
 #include &lt;OgreResource.h&gt;

Modified: rl/trunk/engine/ai/include/ContextConditionProcessor.h
===================================================================
--- rl/trunk/engine/ai/include/ContextConditionProcessor.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/ContextConditionProcessor.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -17,7 +17,7 @@
 #define __Rl_ContextConditionProcessor_H__
 
 #include &quot;XmlMapper/XmlNodeProcessor.h&quot;
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;AimlBot.h&quot;
 
 using namespace XmlMapper;

Modified: rl/trunk/engine/ai/include/ContextInterpreter.h
===================================================================
--- rl/trunk/engine/ai/include/ContextInterpreter.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/ContextInterpreter.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -17,7 +17,7 @@
 #define __Rl_AimlContextInterpreter_H__
 
 #include &quot;AimlInterpreter.h&quot;
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;DialogResponse.h&quot;
 using namespace MadaBot;
 

Modified: rl/trunk/engine/ai/include/DialogCharacter.h
===================================================================
--- rl/trunk/engine/ai/include/DialogCharacter.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/DialogCharacter.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_DialogCharacter_H__
 #define __Rl_DialogCharacter_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 //#include &quot;DialogListener.h&quot;
 
 namespace MadaBot
@@ -35,7 +35,7 @@
      * Representation of a Character that is able to respond in a Dialog
      * @todo Art der Erstellung &#228;ndern, das ist zu kompliziert.
      */
-	class _RlDialogExport DialogCharacter 
+	class _RlAiExport DialogCharacter 
 	{
 	public:
 		DialogCharacter();

Modified: rl/trunk/engine/ai/include/DialogOption.h
===================================================================
--- rl/trunk/engine/ai/include/DialogOption.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/DialogOption.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_DialogOption_H__
 #define __Rl_DialogOption_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 
 namespace MadaBot
 {
@@ -29,7 +29,7 @@
     /**
      * The selectable options a player can choose from in a Dialog
      */
-	class _RlDialogExport DialogOption
+	class _RlAiExport DialogOption
 	{
 	public:
 		DialogOption(const Response&lt;CeGuiString&gt;&amp; pData, AimlBot&lt;CeGuiString&gt;* pBot = NULL);

Deleted: rl/trunk/engine/ai/include/DialogPrerequisites.h
===================================================================
--- rl/trunk/engine/ai/include/DialogPrerequisites.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/DialogPrerequisites.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -1,38 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
- */
-#ifndef __DialogPrerequisites_H__
-#define __DialogPrerequisites_H__
-
-// Common is only needed for the CeGuiString typedef
-#include &quot;CommonPrerequisites.h&quot;
-
-#include &quot;RastullahPrerequisites.h&quot;
-
-#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
-// Export control
-#   if defined( RLDIALOG_EXPORTS )
-#       define _RlDialogExport __declspec( dllexport )
-#   else
-#       define _RlDialogExport __declspec( dllimport )
-#   endif
-#else // Linux / Mac OSX etc
-#   define _RlDialogExport
-#endif
-
-#pragma warning (disable : 4251)
-
-#endif
-

Modified: rl/trunk/engine/ai/include/DialogResponse.h
===================================================================
--- rl/trunk/engine/ai/include/DialogResponse.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/DialogResponse.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_DialogResponse_H__
 #define __Rl_DialogResponse_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;CommonPrerequisites.h&quot;
 
 namespace MadaBot
@@ -33,7 +33,7 @@
     /**
      * The reponse a DialogCharacter can give in a Dialog
      */
-	class _RlDialogExport DialogResponse
+	class _RlAiExport DialogResponse
 	{
 	public:
 		typedef std::map&lt;int, CeGuiString&gt; Options;

Modified: rl/trunk/engine/ai/include/DialogScriptProcessor.h
===================================================================
--- rl/trunk/engine/ai/include/DialogScriptProcessor.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/DialogScriptProcessor.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -17,7 +17,7 @@
 #define __Rl_DialogScriptProcessor_H__
 
 #include &quot;XmlMapper/XmlNodeProcessor.h&quot;
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;AimlBot.h&quot;
 
 using namespace XmlMapper;

Deleted: rl/trunk/engine/ai/include/DialogSubsystem.h
===================================================================
--- rl/trunk/engine/ai/include/DialogSubsystem.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/DialogSubsystem.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -1,94 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
- */
-#ifndef __DialogSubsystem_H__
-#define __DialogSubsystem_H__
-
-#include &quot;DialogPrerequisites.h&quot;
-
-#include &lt;OgreResource.h&gt;
-#include &lt;OgreSingleton.h&gt;
-
-//#include &quot;CommonPrerequisites.h&quot;
-
-namespace MadaBot
-{
-	template &lt;class S&gt; class AimlCore;
-}
-namespace rl
-{
-	class DialogCharacter;
-	class ContextInterpreter;
-
-	/// Initialises and manages everything for using dialogs in Rl
-	class _RlDialogExport DialogSubsystem : 
-	//	public AimlCoreComponent,
-		public Ogre::Singleton&lt;DialogSubsystem&gt;
-	{
-	public:
-		DialogSubsystem();
-		virtual ~DialogSubsystem();
-		
-		/**
-		 * Get the bot with the given name
-		 * @return the bot or NULL if the bot does not exist
-		 */
-		DialogCharacter* getBot(const CeGuiString&amp; botName);
-
-		ContextInterpreter* getContextInterpreter();
-
-		/**
-		 * Load a DialogCharacter from a xml file
-		 * If no name is given, the first available bot in the xml file is loaded
-		 * @param fileName xml file with the bot definition
-		 * @param botName name of the bot to load
-		 * @return will return a DialogCharacter...
-		 */
-		DialogCharacter* loadBot(const CeGuiString&amp; botName, const CeGuiString&amp; fileName = &quot;&quot;);
-	
-        /**
-         * Helper function, that retrieves an xml resource from its file name
-         * If resource not yet created, it gets first searched in the current
-         * adventure module group, then in the default group.
-         */
-        Ogre::ResourcePtr getXmlResource(const Ogre::String&amp; filename);
-
-		/**
-		 * Set the DialogCharacter loaded from ruby
-		 */
-		void setCurrentDialogCharacter(DialogCharacter* bot);
-		DialogCharacter* getCurrentDialogCharacter() const;
-
-	private:
-		void initialize();
-		typedef std::map&lt;CeGuiString, DialogCharacter*&gt; BotMap;
-		typedef MadaBot::AimlCore&lt;CeGuiString&gt; AimlCore; 
-		BotMap mBots;
-		AimlCore* mCore;
-		ContextInterpreter* mContextInterpreter;
-		DialogCharacter* mCurrentBot;
-	};
-
-/*	inline DialogCharacter* DialogSubsystem::getCurrentBot()
-	{
-		return mCurrentBot;
-	}
-*/
-	inline ContextInterpreter* DialogSubsystem::getContextInterpreter()
-	{
-		return mContextInterpreter;
-	}
-}
-#endif

Modified: rl/trunk/engine/ai/include/Makefile.am
===================================================================
--- rl/trunk/engine/ai/include/Makefile.am	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/Makefile.am	2007-08-21 22:05:49 UTC (rev 3727)
@@ -22,4 +22,24 @@
 	SteeringVehicle.h \
 	WayPointNode.h \
 	WayPointGraph.h \
-	WayPointGraphManager.h
+	WayPointGraphManager.h \
+	AimlNodeImplRl.h \
+	AimlParserImplRl.h \
+	ContextConditionProcessor.h \
+	ContextInterpreter.h \
+	DialogCharacter.h \
+	DialogOption.h \
+	DialogPrerequisites.h \
+	DialogResponse.h \
+	DialogScriptProcessor.h \
+	DialogSubsystem.h \
+	ScriptProcessor.h \
+	predicates/CreaturePredicates.h \
+	predicates/EigenschaftsWertPredicates.h \
+	predicates/EigenschaftsProbePredicates.h \
+	predicates/QuestKnownPredicates.h \
+	predicates/QuestPartsPredicates.h \
+	predicates/QuestStatePredicates.h \
+	predicates/ScriptPredicates.h \
+	predicates/TalentProbePredicates.h \
+	predicates/TalentWertPredicates.h

Modified: rl/trunk/engine/ai/include/ScriptProcessor.h
===================================================================
--- rl/trunk/engine/ai/include/ScriptProcessor.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/ScriptProcessor.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -17,7 +17,7 @@
 #define __Rl_ScriptProcessor_H__
 
 #include &quot;XmlMapper/XmlNodeProcessor.h&quot;
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;AimlBot.h&quot;
 
 using namespace XmlMapper;

Modified: rl/trunk/engine/ai/include/predicates/CreaturePredicates.h
===================================================================
--- rl/trunk/engine/ai/include/predicates/CreaturePredicates.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/predicates/CreaturePredicates.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_CreaturePredicates_H__
 #define __Rl_CreaturePredicates_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;Predicates.h&quot;
 using namespace MadaBot;
 

Modified: rl/trunk/engine/ai/include/predicates/QuestKnownPredicates.h
===================================================================
--- rl/trunk/engine/ai/include/predicates/QuestKnownPredicates.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/predicates/QuestKnownPredicates.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_QuestKnownPredicates_H__
 #define __Rl_QuestKnownPredicates_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;Predicates.h&quot;
 
 namespace rl

Modified: rl/trunk/engine/ai/include/predicates/QuestPartsPredicates.h
===================================================================
--- rl/trunk/engine/ai/include/predicates/QuestPartsPredicates.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/predicates/QuestPartsPredicates.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_QuestPartsPredicates_H__
 #define __Rl_QuestPartsPredicates_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;Predicates.h&quot;
 
 namespace rl

Modified: rl/trunk/engine/ai/include/predicates/QuestStatePredicates.h
===================================================================
--- rl/trunk/engine/ai/include/predicates/QuestStatePredicates.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/predicates/QuestStatePredicates.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_QuestStatePredicates_H__
 #define __Rl_QuestStatePredicates_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;Predicates.h&quot;
 
 namespace rl

Modified: rl/trunk/engine/ai/include/predicates/ScriptPredicates.h
===================================================================
--- rl/trunk/engine/ai/include/predicates/ScriptPredicates.h	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/include/predicates/ScriptPredicates.h	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #ifndef __Rl_ScriptPredicates_H__
 #define __Rl_ScriptPredicates_H__
 
-#include &quot;DialogPrerequisites.h&quot;
+#include &quot;AiPrerequisites.h&quot;
 #include &quot;Predicates.h&quot;
 
 using namespace MadaBot;

Modified: rl/trunk/engine/ai/src/AgentDialogState.cpp
===================================================================
--- rl/trunk/engine/ai/src/AgentDialogState.cpp	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/src/AgentDialogState.cpp	2007-08-21 22:05:49 UTC (rev 3727)
@@ -49,7 +49,7 @@
                 CreatureControllerManager::getSingleton().getCreatureController(
                     mAgent-&gt;getControlledCreature());
 
-        if (!mAgent-&gt;getPosition().squaredDistance(mPartner-&gt;getPosition()) &gt; 1.5)
+        if (mAgent-&gt;getPosition().squaredDistance(mPartner-&gt;getPosition()) &gt; 1.5)
         {		
             mAgent-&gt;addForce(mAgent-&gt;calcPursuit(mPartner));
             mAgent-&gt;updateVehicle(0, elapsedTime);
@@ -59,7 +59,7 @@
         //    mAgent-&gt;addForce(mAgent-&gt;calcPursuit(mPartner));
         //    mAgent-&gt;updateVehicle(0, elapsedTime);
         //}
-        ///@todo: Turn if near
+        ///@todo: Turn if near but not correctly oriented
 		else
         {
 			if (!mTalking)

Modified: rl/trunk/engine/ai/src/AiSubsystem.cpp
===================================================================
--- rl/trunk/engine/ai/src/AiSubsystem.cpp	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/src/AiSubsystem.cpp	2007-08-21 22:05:49 UTC (rev 3727)
@@ -28,7 +28,24 @@
 #include &quot;WayPointGraphManager.h&quot;
 #include &quot;World.h&quot;
 
+#include &lt;xercesc/util/PlatformUtils.hpp&gt;
+
+#include &quot;XmlHelper.h&quot;
+#include &quot;XmlResourceManager.h&quot;
+#include &quot;ContentModule.h&quot;
+
+#include &quot;AimlCore.h&quot;
+#include &quot;AimlParserImplRl.h&quot;
+#include &quot;DialogCharacter.h&quot;
+#include &quot;ScriptProcessor.h&quot;
+#include &quot;DialogScriptProcessor.h&quot;
+#include &quot;ContextInterpreter.h&quot;
+
 using namespace Ogre;
+using namespace MadaBot;
+using namespace XERCES_CPP_NAMESPACE;
+
+using namespace Ogre;
 using namespace OpenSteer;
 
 template&lt;&gt; rl::AiSubsystem* Singleton&lt;rl::AiSubsystem&gt;::ms_Singleton = 0;
@@ -38,7 +55,11 @@
 AiSubsystem::AiSubsystem(void)
     : mAgentManager(NULL),
 	  mWayPointGraphManager(NULL),
-      mWorld(NULL)
+      mWorld(NULL),
+      mCore(new AimlCore()),
+	  mContextInterpreter(new ContextInterpreter()),
+	  mCurrentBot(NULL)
+
 {
     LOG_MESSAGE(Logger::AI, &quot;Init Start&quot;);
     initialize();
@@ -55,6 +76,17 @@
     delete mAgentManager;
 	delete mWayPointGraphManager;
     delete mWorld;
+
+  	delete mCore;
+	delete mContextInterpreter;
+
+	for(BotMap::iterator iter = mBots.begin();
+		iter != mBots.end();
+		++iter)
+	{
+		delete iter-&gt;second;
+	}
+
 }
 
 void AiSubsystem::initialize()
@@ -71,6 +103,28 @@
 		    boost::bind(&amp;AiSubsystem::onBeforeClearScene, this));
 
     GameLoop::getSingleton().addTask(AgentManager::getSingletonPtr(), GameLoop::TG_LOGIC);
+
+#if OGRE_PLATFORM != OGRE_PLATFORM_WIN32
+    setlocale(LC_ALL, &quot;C&quot;);
+#endif
+
+	mCore-&gt;setParser(new AimlParserImplRl());
+	mCore-&gt;getBotInterpreter().addProcessor(new DialogScriptProcessor());
+	mCore-&gt;getAimlInterpreter().addProcessor(new ScriptProcessor());
+//  Initialize Xerces if this wasn't done already
+	try
+	{
+        XMLPlatformUtils::Initialize();
+		XmlHelper::initializeTranscoder();
+    }
+    catch (const XMLException&amp; exc)
+	{
+		char* excmsg = XMLString::transcode(exc.getMessage());
+		std::string excs=&quot;Exception while initializing Xerces: &quot;;
+		excs+=excmsg;
+		LOG_MESSAGE(Logger::DIALOG, excs);
+        XMLString::release(&amp;excmsg);
+    }
 }
 
 bool AiSubsystem::onBeforeClearScene()
@@ -151,5 +205,65 @@
 	mLandmarks.clear();
 }
 
+DialogCharacter* AiSubsystem::getBot(const CeGuiString&amp; botName)
+{
+	BotMap::iterator itr = mBots.find(botName);
+	if(itr != mBots.end())
+	{
+		return itr-&gt;second;
+	}
+	return NULL;
+}
 
+
+DialogCharacter* AiSubsystem::loadBot(const CeGuiString&amp; botName, const CeGuiString&amp; fileName)
+{
+	mCurrentBot = NULL;
+	AimlBot&lt;CeGuiString&gt;* bot = mCore-&gt;loadBot(botName.c_str(), fileName.c_str());
+//  while processing the bot definition, a DialogCharacter should have been created
+//  through a ruby script and stored in mCurrentBot
+    if (mCurrentBot == NULL)
+    {
+        mCurrentBot = new DialogCharacter();
+    }
+
+	if(bot != NULL)
+	{
+		mCurrentBot-&gt;setBot(bot);
+		mCurrentBot-&gt;initialize();
+	}
+	LOG_MESSAGE(Logger::DIALOG,&quot;AimlBot &quot; + botName + &quot;loaded and initialized&quot;);
+	mBots.insert(BotMap::value_type(mCurrentBot-&gt;getName(), mCurrentBot));
+	return mCurrentBot;
 }
+
+ResourcePtr AiSubsystem::getXmlResource(const Ogre::String&amp; filename)
+{
+    ResourcePtr res = XmlResourceManager::getSingleton().getByName(filename);
+
+    if (res.isNull())
+    {
+        Ogre::String group = ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME;
+        if (ResourceGroupManager::getSingleton().resourceExists(
+			CoreSubsystem::getSingleton().getActiveAdventureModule()-&gt;getId(), filename))
+        {
+            group = CoreSubsystem::getSingleton().getActiveAdventureModule()-&gt;getId();
+        }
+        res = XmlResourceManager::getSingleton().create(filename, group);
+
+    }
+    return res;
+}
+
+void AiSubsystem::setCurrentDialogCharacter(DialogCharacter* bot)
+{
+	mCurrentBot = bot;
+}
+
+DialogCharacter* AiSubsystem::getCurrentDialogCharacter() const
+{
+    return mCurrentBot;
+}
+
+
+}

Modified: rl/trunk/engine/ai/src/DialogCharacter.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogCharacter.cpp	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/src/DialogCharacter.cpp	2007-08-21 22:05:49 UTC (rev 3727)
@@ -16,7 +16,7 @@
 #include &quot;stdinc.h&quot; //precompiled header
 
 #include &quot;DialogCharacter.h&quot;
-#include &quot;DialogSubsystem.h&quot;
+#include &quot;AiSubsystem.h&quot;
 #include &quot;ContextInterpreter.h&quot;
 #include &quot;AimlBot.h&quot;
 #include &quot;Response.h&quot;
@@ -116,7 +116,7 @@
 		Response&lt;CeGuiString&gt; response = mBot-&gt;respond(input);
 		if(response.hasGossip())
 		{
-			ContextInterpreter* interpreter = DialogSubsystem::getSingleton().getContextInterpreter();
+			ContextInterpreter* interpreter = AiSubsystem::getSingleton().getContextInterpreter();
 			if(interpreter!= NULL)
 			{
 				LOG_MESSAGE(Logger::DIALOG, &quot;Create DialogResponse&quot;);

Modified: rl/trunk/engine/ai/src/DialogOption.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogOption.cpp	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/src/DialogOption.cpp	2007-08-21 22:05:49 UTC (rev 3727)
@@ -17,7 +17,7 @@
 
 #include &quot;DialogOption.h&quot;
 #include &quot;DialogResponse.h&quot;
-#include &quot;DialogSubsystem.h&quot;
+#include &quot;AiSubsystem.h&quot;
 #include &quot;ContextInterpreter.h&quot;
 #include &quot;Response.h&quot;
 
@@ -44,7 +44,7 @@
 void DialogOption::processSelection()
 {
 	DialogResponse* response = NULL;
-	ContextInterpreter* interpreter = DialogSubsystem::getSingleton().getContextInterpreter();
+	ContextInterpreter* interpreter = AiSubsystem::getSingleton().getContextInterpreter();
 	if(interpreter != NULL)
 	{
 		response = interpreter-&gt;interpret(mData-&gt;getGossip(), mBot);

Modified: rl/trunk/engine/ai/src/Makefile.am
===================================================================
--- rl/trunk/engine/ai/src/Makefile.am	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ai/src/Makefile.am	2007-08-21 22:05:49 UTC (rev 3727)
@@ -1,5 +1,5 @@
 INCLUDES = $(OGRE_CFLAGS) $(STLPORT_CFLAGS) $(CEGUIOGRE_CFLAGS) -I../include -I ../../core/include \
-	-I ../../common/include -I ../../dialog/include -I ../../rules/include
+	-I ../../common/include -I ../../dialog/include -I ../../rules/include -I../include/predicates
 
 lib_LTLIBRARIES = libRlAi.la
 libRlAi_la_LDFLAGS = $(OGRE_LIBS) $(LIBS)
@@ -24,4 +24,24 @@
 	SteeringVehicle.cpp \
 	WayPointNode.cpp \
 	WayPointGraph.cpp \
-	WayPointGraphManager.cpp
+	WayPointGraphManager.cpp \
+	AimlNodeImplRl.cpp \
+	AimlParserImplRl.cpp \
+	ContextConditionProcessor.cpp \
+	ContextInterpreter.cpp \
+	DialogCharacter.cpp \
+	DialogOption.cpp \
+	DialogResponse.cpp \
+	DialogScriptProcessor.cpp \
+	DialogSubsystem.cpp \
+	ScriptProcessor.cpp \
+	predicates/CreaturePredicates.cpp \
+	predicates/EigenschaftsProbePredicates.cpp \
+	predicates/EigenschaftsWertPredicates.cpp \
+	predicates/GrundWertPredicates.cpp \
+	predicates/QuestKnownPredicates.cpp \
+	predicates/QuestPartsPredicates.cpp \
+	predicates/QuestStatePredicates.cpp \
+	predicates/ScriptPredicates.cpp \
+	predicates/TalentProbePredicates.cpp \
+	predicates/TalentWertPredicates.cpp	

Modified: rl/trunk/engine/script/RlScript2005.vcproj
===================================================================
--- rl/trunk/engine/script/RlScript2005.vcproj	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/script/RlScript2005.vcproj	2007-08-21 22:05:49 UTC (rev 3727)
@@ -66,10 +66,10 @@
 			/&gt;
 			&lt;Tool
 				Name=&quot;VCLinkerTool&quot;
-				AdditionalDependencies=&quot;RlCore.lib RlAi.lib RlUi.lib RlRules.lib RlDialog.lib OgreMain_d.lib msvcrt-ruby18.lib CEGUIBase_d.lib xerces-c_2D.lib OgreNewt_d.lib Newton.lib&quot;
+				AdditionalDependencies=&quot;RlCore.lib RlAi.lib RlUi.lib RlRules.lib OgreMain_d.lib msvcrt-ruby18.lib CEGUIBase_d.lib xerces-c_2D.lib OgreNewt_d.lib Newton.lib&quot;
 				OutputFile=&quot;$(OutDir)/RlScript.dll&quot;
 				LinkIncremental=&quot;2&quot;
-				AdditionalLibraryDirectories=&quot;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\dialog\lib\$(ConfigurationName)&quot;;&quot;..\ui\lib\$(ConfigurationName)&quot;;&quot;..\ai\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;&quot;..\..\dependencies\OgreNewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll&quot;
+				AdditionalLibraryDirectories=&quot;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\ui\lib\$(ConfigurationName)&quot;;&quot;..\ai\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;&quot;..\..\dependencies\OgreNewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll&quot;
 				GenerateDebugInformation=&quot;true&quot;
 				AssemblyDebug=&quot;1&quot;
 				ProgramDatabaseFile=&quot;$(OutDir)/RlScript.pdb&quot;
@@ -152,10 +152,10 @@
 			/&gt;
 			&lt;Tool
 				Name=&quot;VCLinkerTool&quot;
-				AdditionalDependencies=&quot;RlCore.lib RlAi.lib RlUi.lib RlRules.lib RlDialog.lib OgreMain.lib msvcrt-ruby18.lib CEGUIBase.lib xerces-c_2.lib OgreNewt.lib Newton.lib&quot;
+				AdditionalDependencies=&quot;RlCore.lib RlAi.lib RlUi.lib RlRules.lib OgreMain.lib msvcrt-ruby18.lib CEGUIBase.lib xerces-c_2.lib OgreNewt.lib Newton.lib&quot;
 				OutputFile=&quot;$(OutDir)/RlScript.dll&quot;
 				LinkIncremental=&quot;1&quot;
-				AdditionalLibraryDirectories=&quot;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\dialog\lib\$(ConfigurationName)&quot;;&quot;..\ui\lib\$(ConfigurationName)&quot;;&quot;..\ai\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;&quot;..\..\dependencies\OgreNewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll&quot;
+				AdditionalLibraryDirectories=&quot;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\ui\lib\$(ConfigurationName)&quot;;&quot;..\ai\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;&quot;..\..\dependencies\OgreNewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll&quot;
 				GenerateDebugInformation=&quot;false&quot;
 				SubSystem=&quot;2&quot;
 				OptimizeReferences=&quot;2&quot;
@@ -236,10 +236,10 @@
 			/&gt;
 			&lt;Tool
 				Name=&quot;VCLinkerTool&quot;
-				AdditionalDependencies=&quot;RlCore.lib RlAi.lib RlUi.lib RlRules.lib RlDialog.lib OgreMain.lib msvcrt-ruby18.lib CEGUIBase.lib xerces-c_2.lib OgreNewt.lib Newton.lib&quot;
+				AdditionalDependencies=&quot;RlCore.lib RlAi.lib RlUi.lib RlRules.lib OgreMain.lib msvcrt-ruby18.lib CEGUIBase.lib xerces-c_2.lib OgreNewt.lib Newton.lib&quot;
 				OutputFile=&quot;$(OutDir)/RlScript.dll&quot;
 				LinkIncremental=&quot;1&quot;
-				AdditionalLibraryDirectories=&quot;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\dialog\lib\$(ConfigurationName)&quot;;&quot;..\ui\lib\$(ConfigurationName)&quot;;&quot;..\ai\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;&quot;..\..\dependencies\OgreNewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll&quot;
+				AdditionalLibraryDirectories=&quot;&quot;..\rules\lib\$(ConfigurationName)&quot;;&quot;..\core\lib\$(ConfigurationName)&quot;;&quot;..\ui\lib\$(ConfigurationName)&quot;;&quot;..\ai\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;&quot;..\..\dependencies\OgreNewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll&quot;
 				GenerateDebugInformation=&quot;true&quot;
 				SubSystem=&quot;2&quot;
 				OptimizeReferences=&quot;2&quot;
@@ -572,10 +572,6 @@
 					&gt;
 				&lt;/File&gt;
 				&lt;File
-					RelativePath=&quot;.\swig\RlDialog.head.swig&quot;
-					&gt;
-				&lt;/File&gt;
-				&lt;File
 					RelativePath=&quot;.\swig\RlRules.head.swig&quot;
 					&gt;
 				&lt;/File&gt;
@@ -604,10 +600,6 @@
 					&gt;
 				&lt;/File&gt;
 				&lt;File
-					RelativePath=&quot;.\swig\RlDialog.swig&quot;
-					&gt;
-				&lt;/File&gt;
-				&lt;File
 					RelativePath=&quot;.\swig\RlRules.swig&quot;
 					&gt;
 				&lt;/File&gt;

Modified: rl/trunk/engine/script/swig/RlAi.head.swig
===================================================================
--- rl/trunk/engine/script/swig/RlAi.head.swig	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/script/swig/RlAi.head.swig	2007-08-21 22:05:49 UTC (rev 3727)
@@ -34,4 +34,5 @@
 #include &quot;Landmark.h&quot;
 #include &quot;LandmarkPath.h&quot;
 #include &quot;CreatureWalkPathJob.h&quot;
+#include &quot;DialogCharacter.h&quot;
 %}
\ No newline at end of file

Modified: rl/trunk/engine/script/swig/RlAi.swig
===================================================================
--- rl/trunk/engine/script/swig/RlAi.swig	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/script/swig/RlAi.swig	2007-08-21 22:05:49 UTC (rev 3727)
@@ -93,10 +93,37 @@
         void pushState(rl::AgentStateType type);
 	};
 
+    %feature(&quot;director&quot;) DialogCharacter;
+	class DialogCharacter
+	{
+	public:
+		DialogCharacter();
+		virtual ~DialogCharacter();
+
+		const rl::CeGuiString getName() const;
+		rl::Creature* getDialogCharacter() const;
+		void setDialogCharacter(rl::Creature* dialogCharacter);
+		rl::Creature* getDialogPartner() const;
+		void setDialogPartner(rl::Creature* dialogPartner);
+		
+		rl::Creature* getNonPlayerCharacter()const;
+		void setNonPlayerCharacter(rl::Creature* npc);
+		
+		rl::Creature* getPlayerCharacter()const;
+		void setPlayerCharacter(rl::Creature* pc);
+		
+		virtual int calcOptionValue(const rl::CeGuiString&amp; optionName)=0;	
+		virtual int calcResponseValue(const rl::CeGuiString&amp; responseName)=0;
+		virtual int calcSelectionValue(const rl::CeGuiString&amp; selectionName)=0;
+	};
+
 	class AiSubsystem 
 	{
 	public:
 		static AiSubsystem&amp; getSingleton(void);
+		rl::DialogCharacter* getBot(const rl::CeGuiString&amp; botName);
+		rl::DialogCharacter* loadBot(const rl::CeGuiString&amp; fileName, const rl::CeGuiString&amp; botName = &quot;&quot;);
+		void setCurrentDialogCharacter(rl::DialogCharacter* bot);
 	};
 	
 	%feature(&quot;director&quot;) BehaviourFactory;

Modified: rl/trunk/engine/script/swig/RlCore.swig
===================================================================
--- rl/trunk/engine/script/swig/RlCore.swig	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/script/swig/RlCore.swig	2007-08-21 22:05:49 UTC (rev 3727)
@@ -958,7 +958,7 @@
     virtual void setTimeFactor(Ogre::Real factor = 1.0) = 0;
 };
 
-class TimeSourceManager : public Ogre::Singleton&lt;rl::TimeSourceManager&gt;
+class TimeSourceManager
 {
 public:
     static rl::TimeSourceManager&amp; getSingleton();

Deleted: rl/trunk/engine/script/swig/RlDialog.head.swig
===================================================================
--- rl/trunk/engine/script/swig/RlDialog.head.swig	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/script/swig/RlDialog.head.swig	2007-08-21 22:05:49 UTC (rev 3727)
@@ -1,23 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
- */
-
-%{
-//----------- Includes - Dialog -----------
-#include &quot;FixRubyHeaders.h&quot;
-#include &quot;DialogPrerequisites.h&quot;
-#include &quot;DialogSubsystem.h&quot;
-#include &quot;DialogCharacter.h&quot;
-%}
\ No newline at end of file

Deleted: rl/trunk/engine/script/swig/RlDialog.swig
===================================================================
--- rl/trunk/engine/script/swig/RlDialog.swig	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/script/swig/RlDialog.swig	2007-08-21 22:05:49 UTC (rev 3727)
@@ -1,51 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
- */
-
-namespace rl 
-{
-	%feature(&quot;director&quot;) DialogCharacter;
-	class DialogCharacter
-	{
-	public:
-		DialogCharacter();
-		virtual ~DialogCharacter();
-
-		const rl::CeGuiString getName() const;
-		rl::Creature* getDialogCharacter() const;
-		void setDialogCharacter(rl::Creature* dialogCharacter);
-		rl::Creature* getDialogPartner() const;
-		void setDialogPartner(rl::Creature* dialogPartner);
-		
-		rl::Creature* getNonPlayerCharacter()const;
-		void setNonPlayerCharacter(rl::Creature* npc);
-		
-		rl::Creature* getPlayerCharacter()const;
-		void setPlayerCharacter(rl::Creature* pc);
-		
-		virtual int calcOptionValue(const rl::CeGuiString&amp; optionName)=0;	
-		virtual int calcResponseValue(const rl::CeGuiString&amp; responseName)=0;
-		virtual int calcSelectionValue(const rl::CeGuiString&amp; selectionName)=0;
-	};
-
-	class DialogSubsystem 
-	{
-	public:
-		static DialogSubsystem&amp; getSingleton(void);
-		rl::DialogCharacter* getBot(const rl::CeGuiString&amp; botName);
-		rl::DialogCharacter* loadBot(const rl::CeGuiString&amp; fileName, const rl::CeGuiString&amp; botName = &quot;&quot;);
-		void setCurrentDialogCharacter(rl::DialogCharacter* bot);
-	};
-}

Modified: rl/trunk/engine/script/swig/RlExports.i
===================================================================
--- rl/trunk/engine/script/swig/RlExports.i	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/script/swig/RlExports.i	2007-08-21 22:05:49 UTC (rev 3727)
@@ -60,7 +60,6 @@
 %include &quot;RlUi.head.swig&quot;
 %include &quot;RlCore.head.swig&quot;
 %include &quot;RlRules.head.swig&quot;
-%include &quot;RlDialog.head.swig&quot;
 %include &quot;RlAi.head.swig&quot;
 %include &quot;RlScript.head.swig&quot;
 
@@ -174,7 +173,6 @@
 %include &quot;RlCommon.swig&quot;
 %include &quot;RlCore.swig&quot;
 %include &quot;RlRules.swig&quot;
-%include &quot;RlDialog.swig&quot;
 %include &quot;RlUi.swig&quot;
 %include &quot;RlAi.swig&quot;
 %include &quot;RlScript.swig&quot;

Modified: rl/trunk/engine/startup/src/RastullahMain.cpp
===================================================================
--- rl/trunk/engine/startup/src/RastullahMain.cpp	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/startup/src/RastullahMain.cpp	2007-08-21 22:05:49 UTC (rev 3727)
@@ -23,7 +23,6 @@
 #include &quot;CoreSubsystem.h&quot;
 #include &quot;GameLoop.h&quot;
 #include &quot;RulesSubsystem.h&quot;
-#include &quot;DialogSubsystem.h&quot;
 #include &quot;AiSubsystem.h&quot;
 #include &quot;UiSubsystem.h&quot;
 #include &quot;ScriptSubsystem.h&quot;
@@ -43,7 +42,6 @@
 {
     rl::CoreSubsystem* core = NULL;
     rl::RulesSubsystem* rules = NULL;
-    rl::DialogSubsystem* dialog = NULL;
     rl::AiSubsystem* ai = NULL;
     rl::UiSubsystem* ui =  NULL;
     rl::ScriptSubsystem* script =  NULL;
@@ -72,9 +70,6 @@
         rules = new rl::RulesSubsystem();
         LOG_MESSAGE_SHORT(&quot;RulesSubsystem gestartet&quot;);
 
-        dialog = new rl::DialogSubsystem();
-        LOG_MESSAGE_SHORT(&quot;DialogSubsystem gestartet&quot;);
-
         ai = new rl::AiSubsystem();
         LOG_MESSAGE_SHORT(&quot;AiSubsystem gestartet&quot;);
 
@@ -130,7 +125,6 @@
         delete script;
         delete ui;
         delete ai;
-        delete dialog;
         delete rules;
         delete core;
         delete logger;

Modified: rl/trunk/engine/ui/RlUI2005.vcproj
===================================================================
--- rl/trunk/engine/ui/RlUI2005.vcproj	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ui/RlUI2005.vcproj	2007-08-21 22:05:49 UTC (rev 3727)
@@ -48,7 +48,7 @@
 				Name=&quot;VCCLCompilerTool&quot;
 				AdditionalOptions=&quot;-Zm130&quot;
 				Optimization=&quot;0&quot;
-				AdditionalIncludeDirectories=&quot;.\include;;..\common\include;..\dialog\include;..\core\include;..\rules\include;..\..\dependencies\ogrenew\OgreMain\include;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\cegui_mk2\include;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\fmod\api\inc;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Samples\Common\CEGUIRenderer\include;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\ois\includes&quot;
+				AdditionalIncludeDirectories=&quot;.\include;..\common\include;..\ai\include;..\core\include;..\rules\include;..\..\dependencies\ogrenew\OgreMain\include;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\cegui_mk2\include;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\fmod\api\inc;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Samples\Common\CEGUIRenderer\include;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\ois\includes&quot;
 				PreprocessorDefinitions=&quot;WITH_FMOD3;_WINDOWS,_DEBUG,WIN32,RLUI_EXPORTS;_CRT_SECURE_NO_DEPRECATE;RL_USE_PCH&quot;
 				MinimalRebuild=&quot;true&quot;
 				BasicRuntimeChecks=&quot;3&quot;
@@ -162,7 +162,7 @@
 				Optimization=&quot;3&quot;
 				EnableIntrinsicFunctions=&quot;true&quot;
 				FavorSizeOrSpeed=&quot;1&quot;
-				AdditionalIncludeDirectories=&quot;.\include;;..\common\include;..\dialog\include;..\core\include;..\rules\include;..\..\dependencies\ogrenew\OgreMain\include;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\cegui_mk2\include;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\fmod\api\inc;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Samples\Common\CEGUIRenderer\include;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\ois\includes&quot;
+				AdditionalIncludeDirectories=&quot;.\include;..\common\include;..\ai\include;..\core\include;..\rules\include;..\..\dependencies\ogrenew\OgreMain\include;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\cegui_mk2\include;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\fmod\api\inc;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Samples\Common\CEGUIRenderer\include;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\ois\includes&quot;
 				PreprocessorDefinitions=&quot;WITH_FMOD3;NDEBUG,_WINDOWS,WIN32,RLUI_EXPORTS;_CRT_SECURE_NO_DEPRECATE;RL_USE_PCH&quot;
 				StringPooling=&quot;false&quot;
 				ExceptionHandling=&quot;1&quot;
@@ -266,7 +266,7 @@
 				Optimization=&quot;3&quot;
 				EnableIntrinsicFunctions=&quot;true&quot;
 				FavorSizeOrSpeed=&quot;1&quot;
-				AdditionalIncludeDirectories=&quot;.\include;;..\common\include;..\dialog\include;..\core\include;..\rules\include;..\..\dependencies\ogrenew\OgreMain\include;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\cegui_mk2\include;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\fmod\api\inc;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Samples\Common\CEGUIRenderer\include;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\ois\includes&quot;
+				AdditionalIncludeDirectories=&quot;.\include;..\common\include;..\ai\include;..\core\include;..\rules\include;..\..\dependencies\ogrenew\OgreMain\include;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\cegui_mk2\include;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\fmod\api\inc;..\..\dependencies\OgreNewt\include\OgreNewt;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Samples\Common\CEGUIRenderer\include;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\ois\includes&quot;
 				PreprocessorDefinitions=&quot;WITH_FMOD3;NDEBUG,_WINDOWS,WIN32,RLUI_EXPORTS;_CRT_SECURE_NO_DEPRECATE;RL_USE_PCH&quot;
 				StringPooling=&quot;false&quot;
 				ExceptionHandling=&quot;1&quot;

Modified: rl/trunk/engine/ui/src/DialogControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/DialogControlState.cpp	2007-08-21 19:44:44 UTC (rev 3726)
+++ rl/trunk/engine/ui/src/DialogControlState.cpp	2007-08-21 22:05:49 UTC (rev 3727)
@@ -20,6 +20,7 @@
 #include &quot;Exception.h&quot;
 
 #include &quot;Actor.h&quot;
+#include &quot;AiSubsystem.h&quot;
 #include &quot;CameraObject.h&quot;
 #include &quot;CommandMapper.h&quot;
 #include &quot;ConfigurationManager.h&quot;
@@ -27,7 +28,6 @@
 #include &quot;DialogCharacter.h&quot;
 #include &quot;DialogOption.h&quot;
 #include &quot;DialogResponse.h&quot;
-#include &quot;DialogSubsystem.h&quot;
 #include &quot;DialogWindow.h&quot;
 #include &quot;GameLoggerWindow.h&quot;
 #include &quot;InputManager.h&quot;
@@ -121,7 +121,7 @@
 
 		mGameLogger = WindowFactory::getSingleton().getGameLogger();
 
-		DialogCharacter* bot = DialogSubsystem::getSingleton().getCurrentDialogCharacter();
+		DialogCharacter* bot = AiSubsystem::getSingleton().getCurrentDialogCharacter();
 		initialize(bot);
     }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000797.html">[Dsa-hl-svn] r3726 - in rl/trunk/engine/common: include src
</A></li>
	<LI>Next message: <A HREF="000799.html">[Dsa-hl-svn] r3728 - in modules: common/scripts minidemo/scripts	techdemo2/scripts techdemo2/scripts/maps tutorial/scripts/maps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#798">[ date ]</a>
              <a href="thread.html#798">[ thread ]</a>
              <a href="subject.html#798">[ subject ]</a>
              <a href="author.html#798">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
