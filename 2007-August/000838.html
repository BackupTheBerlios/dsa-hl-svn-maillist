<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3767 - modules/common/dsa modules/common/scripts	modules/regressiontest/dsa rl/trunk/engine/rules/include	rl/trunk/engine/rules/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3767%20-%20modules/common/dsa%20modules/common/scripts%0A%09modules/regressiontest/dsa%20rl/trunk/engine/rules/include%0A%09rl/trunk/engine/rules/src&In-Reply-To=%3C200708272355.l7RNtlLO021541%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000837.html">
   <LINK REL="Next"  HREF="000839.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3767 - modules/common/dsa modules/common/scripts	modules/regressiontest/dsa rl/trunk/engine/rules/include	rl/trunk/engine/rules/src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3767%20-%20modules/common/dsa%20modules/common/scripts%0A%09modules/regressiontest/dsa%20rl/trunk/engine/rules/include%0A%09rl/trunk/engine/rules/src&In-Reply-To=%3C200708272355.l7RNtlLO021541%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3767 - modules/common/dsa modules/common/scripts	modules/regressiontest/dsa rl/trunk/engine/rules/include	rl/trunk/engine/rules/src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Tue Aug 28 01:55:47 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000837.html">[Dsa-hl-svn] r3766 - rl/trunk/engine/script/swig
</A></li>
        <LI>Next message: <A HREF="000839.html">[Dsa-hl-svn] r3768 - dependencies/opensteer/include/OpenSteer	dependencies/opensteer/plugins dependencies/opensteer/src	modules/common/scripts rl/trunk/engine/ai	rl/trunk/engine/ai/include rl/trunk/engine/ai/src	rl/trunk/engine/rules/include rl/trunk/engine/rules/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#838">[ date ]</a>
              <a href="thread.html#838">[ thread ]</a>
              <a href="subject.html#838">[ subject ]</a>
              <a href="author.html#838">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2007-08-28 01:55:37 +0200 (Tue, 28 Aug 2007)
New Revision: 3767

Modified:
   modules/common/dsa/gameobjectdefinitions.gof
   modules/common/scripts/hero.rb
   modules/common/scripts/mckhero.rb
   modules/regressiontest/dsa/gameobjectdefinitions.gof
   rl/trunk/engine/rules/include/Inventory.h
   rl/trunk/engine/rules/src/Creature.cpp
   rl/trunk/engine/rules/src/Inventory.cpp
Log:
Use GOF properties for inventory slots

Modified: modules/common/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/common/dsa/gameobjectdefinitions.gof	2007-08-27 23:53:07 UTC (rev 3766)
+++ modules/common/dsa/gameobjectdefinitions.gof	2007-08-27 23:55:37 UTC (rev 3767)
@@ -52,5 +52,110 @@
 		&lt;property name=&quot;lit&quot; type=&quot;BOOL&quot; data=&quot;true&quot;/&gt;
 	&lt;/gameobjectclass&gt;
 
+    &lt;gameobjectclass classid=&quot;mckhero&quot;  baseclass=&quot;MCKHero&quot;&gt;
+        &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot; /&gt;
+        &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;75&quot;/&gt;
+        &lt;property name=&quot;inventorywindowtype&quot; type=&quot;STRING&quot; data=&quot;inventory_human.xml&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
+        &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot;/&gt;
+		&lt;property name=&quot;meshparts&quot; type=&quot;MAP&quot;&gt;
+            &lt;property name=&quot;torso&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
+            &lt;property name=&quot;hand&quot; type=&quot;STRING&quot; data=&quot;men_human_female_hand_nude.mesh&quot;/&gt;
+            &lt;property name=&quot;head&quot; type=&quot;STRING&quot; data=&quot;men_human_female_head_02.mesh&quot;/&gt;
+            &lt;property name=&quot;hair&quot; type=&quot;STRING&quot; data=&quot;men_human_female_hair_long_01_normal.mesh&quot;/&gt;
+            &lt;property name=&quot;trousers&quot; type=&quot;STRING&quot; data=&quot;men_human_female_legs_underpants.mesh&quot;/&gt;
+            &lt;property name=&quot;boots&quot; type=&quot;STRING&quot; data=&quot;men_human_female_feet_nude.mesh&quot;/&gt;
+        &lt;/property&gt;
+		&lt;property name=&quot;inventory&quot; type=&quot;MAP&quot;&gt;
+			&lt;property name=&quot;slots&quot; type=&quot;ARRAY&quot;&gt;
+				&lt;!-- Rings on left hand --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Left Ring&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;bone&quot;/&gt;
+					&lt;property name=&quot;bone&quot; type=&quot;STRING&quot; data=&quot;Bip01 L Finger21&quot;/&gt;
+					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;4&quot;/&gt; &lt;!-- Rings --&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;4&quot;/&gt; &lt;!-- Rings --&gt;
+				&lt;/property&gt;
+				&lt;!-- Rings on right hand --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Right Ring&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;bone&quot;/&gt;
+					&lt;property name=&quot;bone&quot; type=&quot;STRING&quot; data=&quot;Bip01 R Finger21&quot;/&gt;
+					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;4&quot;/&gt; &lt;!-- Rings --&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;4&quot;/&gt; &lt;!-- Rings --&gt;
+				&lt;/property&gt;
+				&lt;!-- Left hand --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Left Hand&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;bone&quot;/&gt;
+					&lt;property name=&quot;bone&quot; type=&quot;STRING&quot; data=&quot;Bip01 L SlotHand&quot;/&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;3&quot;/&gt; &lt;!-- Weapons | Shields --&gt;
+				&lt;/property&gt;
+				&lt;!-- Right hand --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Right Hand&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;bone&quot;/&gt;
+					&lt;property name=&quot;bone&quot; type=&quot;STRING&quot; data=&quot;Bip01 R SlotHand&quot;/&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;3&quot;/&gt; &lt;!-- Weapons | Shields --&gt;
+				&lt;/property&gt;
+				&lt;!-- Head --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Head&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;submesh&quot;/&gt;
+					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;head&quot;/&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;2048&quot;/&gt; &lt;!-- Helmets --&gt;
+					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;2048&quot;/&gt; &lt;!-- Helmets --&gt;
+				&lt;/property&gt;
+				&lt;!-- Back --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Back&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;submesh&quot;/&gt;
+					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;back&quot;/&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;256&quot;/&gt; &lt;!-- Backpacks --&gt;
+					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;256&quot;/&gt; &lt;!-- Backpacks --&gt;
+				&lt;/property&gt;
+				&lt;!-- Armor --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Armor&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;submesh&quot;/&gt;
+					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;armor&quot;/&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;32&quot;/&gt; &lt;!-- Armor --&gt;
+					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;32&quot;/&gt; &lt;!-- Armor --&gt;
+				&lt;/property&gt;
+				&lt;!-- Torso --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Torso&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;material&quot;/&gt;
+					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso&quot;/&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;32800&quot;/&gt; &lt;!-- Armor | Clothes --&gt;
+					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;32800&quot;/&gt; &lt;!-- Armor | Clothes --&gt;
+				&lt;/property&gt;
+				&lt;!-- Clothes --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Clothes&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;submesh&quot;/&gt;
+					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;clothes&quot;/&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;32768&quot;/&gt; &lt;!-- Clothes --&gt;
+					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;32768&quot;/&gt; &lt;!-- Clothes --&gt;
+				&lt;/property&gt;
+				&lt;!-- Boots --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Boots&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;submesh&quot;/&gt;
+					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;boots&quot;/&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;16384&quot;/&gt; &lt;!-- Boots --&gt;
+					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;16384&quot;/&gt; &lt;!-- Boots --&gt;
+				&lt;/property&gt;
+				&lt;!-- Trousers --&gt;
+				&lt;property type=&quot;MAP&quot;&gt; 
+					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Trousers&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;submesh&quot;/&gt;
+					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;trousers&quot;/&gt;
+					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;4096&quot;/&gt; &lt;!-- Trousers --&gt;
+					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;4096&quot;/&gt; &lt;!-- Trousers --&gt;
+				&lt;/property&gt;				
+			&lt;/property&gt;
+		&lt;/property&gt;
+    &lt;/gameobjectclass&gt;
 
 &lt;/GameObjectDefinitions&gt;

Modified: modules/common/scripts/hero.rb
===================================================================
--- modules/common/scripts/hero.rb	2007-08-27 23:53:07 UTC (rev 3766)
+++ modules/common/scripts/hero.rb	2007-08-27 23:55:37 UTC (rev 3767)
@@ -12,15 +12,6 @@
         modifyAu(1000); # Au = voll
         #modifyLe(-20); # 10 LeP abziehen
 
-		$SCRIPT.log(&quot;Inventar konfigurieren.&quot;);
-		inv = getInventory();
-		inv.addSlot(&quot;Left Ring&quot;, &quot;l_finger_2&quot;, Item::ITEMTYPE_RING, Item::ITEMTYPE_RING);
-		inv.addSlot(&quot;Right Ring&quot;, &quot;r_finger_2&quot;, Item::ITEMTYPE_RING, Item::ITEMTYPE_RING);
-		inv.addSlot(&quot;Left Hand&quot;, &quot;l_hand&quot;, Item::ITEMTYPE_WEAPON, Item::ITEMTYPE_ALL_ITEMS);
-		inv.addSlot(&quot;Right Hand&quot;, &quot;r_hand&quot;, Item::ITEMTYPE_WEAPON, Item::ITEMTYPE_ALL_ITEMS);
-		inv.addSlot(&quot;Head&quot;, &quot;kopf&quot;, Item::ITEMTYPE_HELMET, Item::ITEMTYPE_HELMET);
-		inv.addSlot(&quot;Back&quot;, &quot;hals&quot;, Item::ITEMTYPE_ALL_ITEMS, Item::ITEMTYPE_ALL_ITEMS);
-
 		#addSounds()
         $SCRIPT.log(&quot;done.&quot;);
     end

Modified: modules/common/scripts/mckhero.rb
===================================================================
--- modules/common/scripts/mckhero.rb	2007-08-27 23:53:07 UTC (rev 3766)
+++ modules/common/scripts/mckhero.rb	2007-08-27 23:55:37 UTC (rev 3767)
@@ -29,21 +29,6 @@
 
         $SCRIPT.log(&quot;Heldenaktor beschreiben...&quot;);
 
-	$SCRIPT.log(&quot;Inventar konfigurieren.&quot;);
-	inv = getInventory();
-	inv.addSlot(&quot;Left Ring&quot;, &quot;Bip01 L Finger21&quot;, Item::ITEMTYPE_RING, Item::ITEMTYPE_RING);
-	inv.addSlot(&quot;Right Ring&quot;, &quot;Bip01 R Finger21&quot;, Item::ITEMTYPE_RING, Item::ITEMTYPE_RING);
-	inv.addSlot(&quot;Left Hand&quot;, &quot;Bip01 L SlotHand&quot;, Item::ITEMTYPE_WEAPON | Item::ITEMTYPE_SHIELD, Item::ITEMTYPE_ALL_ITEMS);
-	inv.addSlot(&quot;Right Hand&quot;, &quot;Bip01 R SlotHand&quot;, Item::ITEMTYPE_WEAPON | Item::ITEMTYPE_SHIELD, Item::ITEMTYPE_ALL_ITEMS);
-	inv.addSlot(&quot;Head&quot;, &quot;Bip01 Head&quot;, Item::ITEMTYPE_HELMET, Item::ITEMTYPE_HELMET, RlScript::SLOT_SUBMESH);
-	inv.addSlot(&quot;Back&quot;, &quot;back&quot;, 0, Item::ITEMTYPE_BACKPACK, RlScript::SLOT_SUBMESH);
-	#inv.addSlot(&quot;Back&quot;, &quot;Bip01 Neck&quot;, Item::ITEMTYPE_ALL_ITEMS);
-        inv.addSlot(&quot;Armor&quot;, &quot;armor&quot;, Item::ITEMTYPE_ARMOR, Item::ITEMTYPE_ARMOR, RlScript::SLOT_SUBMESH);
-	inv.addSlot(&quot;Torso&quot;, &quot;men_human_female_torso&quot;, Item::ITEMTYPE_ARMOR | Item::ITEMTYPE_CLOTHES, Item::ITEMTYPE_ARMOR | Item::ITEMTYPE_CLOTHES, RlScript::SLOT_MATERIAL);
-	inv.addSlot(&quot;Clothes&quot;, &quot;clothes&quot;, Item::ITEMTYPE_CLOTHES,  Item::ITEMTYPE_CLOTHES, RlScript::SLOT_SUBMESH);
-	inv.addSlot(&quot;Boots&quot;, &quot;boots&quot;, Item::ITEMTYPE_BOOTS,  Item::ITEMTYPE_BOOTS, RlScript::SLOT_SUBMESH);
-	inv.addSlot(&quot;Trousers&quot;, &quot;trousers&quot;, Item::ITEMTYPE_TROUSERS,  Item::ITEMTYPE_TROUSERS, RlScript::SLOT_SUBMESH);
-
 	#addSounds()
         $SCRIPT.log(&quot;done.&quot;);
     end

Modified: modules/regressiontest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-08-27 23:53:07 UTC (rev 3766)
+++ modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-08-27 23:55:37 UTC (rev 3767)
@@ -1,22 +1,6 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
 &lt;GameObjectDefinitions&gt;
 
-    &lt;gameobjectclass classid=&quot;mckhero&quot;  baseclass=&quot;MCKHero&quot;&gt;
-        &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot; /&gt;
-        &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;75&quot;/&gt;
-        &lt;property name=&quot;inventorywindowtype&quot; type=&quot;STRING&quot; data=&quot;inventory_human.xml&quot;/&gt;
-        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
-        &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot;/&gt;
-        &lt;property name=&quot;meshparts&quot; type=&quot;MAP&quot;&gt;
-            &lt;property name=&quot;torso&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
-            &lt;property name=&quot;hand&quot; type=&quot;STRING&quot; data=&quot;men_human_female_hand_nude.mesh&quot;/&gt;
-            &lt;property name=&quot;head&quot; type=&quot;STRING&quot; data=&quot;men_human_female_head_02.mesh&quot;/&gt;
-            &lt;property name=&quot;hair&quot; type=&quot;STRING&quot; data=&quot;men_human_female_hair_long_01_normal.mesh&quot;/&gt;
-            &lt;property name=&quot;trousers&quot; type=&quot;STRING&quot; data=&quot;men_human_female_legs_underpants.mesh&quot;/&gt;
-            &lt;property name=&quot;boots&quot; type=&quot;STRING&quot; data=&quot;men_human_female_feet_nude.mesh&quot;/&gt;
-        &lt;/property&gt;
-    &lt;/gameobjectclass&gt;
-
     &lt;gameobjectclass classid=&quot;Holzscheit&quot; baseclass=&quot;GameObject&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Holzscheit&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Greater log of time check. (Very rare)&quot;/&gt;

Modified: rl/trunk/engine/rules/include/Inventory.h
===================================================================
--- rl/trunk/engine/rules/include/Inventory.h	2007-08-27 23:53:07 UTC (rev 3766)
+++ rl/trunk/engine/rules/include/Inventory.h	2007-08-27 23:55:37 UTC (rev 3767)
@@ -36,6 +36,7 @@
 public:
 
 	static const Ogre::String PROPERTY_CONTENT;
+	static const Ogre::String PROPERTY_SLOTS;
 	/** 
 	* @brief Eine Liste mit Zeigern auf Items
 	**/

Modified: rl/trunk/engine/rules/src/Creature.cpp
===================================================================
--- rl/trunk/engine/rules/src/Creature.cpp	2007-08-27 23:53:07 UTC (rev 3766)
+++ rl/trunk/engine/rules/src/Creature.cpp	2007-08-27 23:55:37 UTC (rev 3767)
@@ -24,7 +24,6 @@
 #include &quot;EffectManager.h&quot;
 #include &quot;Exception.h&quot;
 #include &quot;Inventory.h&quot;
-#include &quot;Item.h&quot;
 #include &quot;Kampftechnik.h&quot;
 #include &quot;MeshObject.h&quot;
 #include &quot;StateSet.h&quot;
@@ -79,7 +78,6 @@
 
 
 
-
     Creature::Creature(unsigned int id)
         : GameObject(id),
 		mCurrentLe(0),
@@ -1027,7 +1025,7 @@
         }
         else if (key == Creature::PROPERTY_INVENTORY)
         {
-            mInventory-&gt;setProperty(Inventory::PROPERTY_CONTENT, value);
+            mInventory-&gt;setProperties(value.toMap());
         }
         else
         {

Modified: rl/trunk/engine/rules/src/Inventory.cpp
===================================================================
--- rl/trunk/engine/rules/src/Inventory.cpp	2007-08-27 23:53:07 UTC (rev 3766)
+++ rl/trunk/engine/rules/src/Inventory.cpp	2007-08-27 23:55:37 UTC (rev 3767)
@@ -33,6 +33,7 @@
 {
 
 	const Ogre::String Inventory::PROPERTY_CONTENT = &quot;content&quot;;
+	const Ogre::String Inventory::PROPERTY_SLOTS = &quot;slots&quot;;
 
     /**
        Just to remember all parts of the inventory
@@ -234,21 +235,23 @@
     {
         if (mSlots.find(name) != mSlots.end())
         {
-            Throw(rl::IllegalArgumentException, Ogre::String(&quot;Slot '&quot;)+name.c_str()+&quot;' already exists.&quot;);
+            LOG_ERROR(Logger::RULES, &quot;Slot '&quot; + name + &quot;' already exists.&quot;);
         }
-
-		switch (type)
+        else
         {
-            case SLOT_BONE:
-			    mSlots[name] = new BoneSlot(mOwner, name, itemReadyMask, itemHeldMask, meshpartname);
-                break;
-            case SLOT_SUBMESH:
-			    mSlots[name] = new SubmeshSlot(mOwner, name, itemReadyMask, itemHeldMask, meshpartname);
-                break;
-            case SLOT_MATERIAL:
-			    mSlots[name] = new MaterialSlot(mOwner, name, itemReadyMask, itemHeldMask, meshpartname);
-                break;
-		}
+		    switch (type)
+            {
+                case SLOT_BONE:
+			        mSlots[name] = new BoneSlot(mOwner, name, itemReadyMask, itemHeldMask, meshpartname);
+                    break;
+                case SLOT_SUBMESH:
+			        mSlots[name] = new SubmeshSlot(mOwner, name, itemReadyMask, itemHeldMask, meshpartname);
+                    break;
+                case SLOT_MATERIAL:
+			        mSlots[name] = new MaterialSlot(mOwner, name, itemReadyMask, itemHeldMask, meshpartname);
+                    break;
+		    }
+        }
     }
 
     const Inventory::SlotMap&amp; Inventory::getAllSlots() const
@@ -281,7 +284,53 @@
 
 	void Inventory::setProperty(const Ogre::String&amp; key, const Property&amp; value)
 	{
-		if (key == Inventory::PROPERTY_CONTENT)
+        if (key == Inventory::PROPERTY_SLOTS)
+        {
+            PropertyVector slotVec = value.toArray();
+
+            for (PropertyVector::const_iterator it = slotVec.begin(); it != slotVec.end(); ++it)
+            {
+                PropertyMap slotProps = it-&gt;toMap();
+
+                CeGuiString name = slotProps[&quot;name&quot;].toString();
+                int holdItems = Item::ITEMTYPE_ALL_ITEMS;
+                if (slotProps.find(&quot;holds&quot;) != slotProps.end())
+                {
+                    holdItems = slotProps[&quot;holds&quot;].toInt();
+                }
+                int readyItems = Item::ITEMTYPE_ALL_ITEMS;
+                if (slotProps.find(&quot;readies&quot;) != slotProps.end())
+                {
+                    readyItems = slotProps[&quot;readies&quot;].toInt();
+                }
+
+                CeGuiString type = slotProps.find(&quot;type&quot;)-&gt;second.toString();
+                if (type == &quot;bone&quot;)
+                {
+                    CeGuiString bone = slotProps[&quot;bone&quot;].toString();
+                    LOG_MESSAGE(&quot;Inventory&quot;, &quot;Add bone slot &quot;+ bone);
+                    addSlot(name, bone.c_str(), holdItems, readyItems, SLOT_BONE);
+                }
+                else if (type == &quot;submesh&quot;)
+                {
+                    CeGuiString submesh = slotProps[&quot;submesh&quot;].toString();
+                    LOG_MESSAGE(&quot;Inventory&quot;, &quot;Add submesh slot &quot;+ submesh);
+                    addSlot(name, submesh.c_str(), holdItems, readyItems, SLOT_SUBMESH);
+                }
+                else if (type == &quot;material&quot;)
+                {
+                    CeGuiString submesh = slotProps[&quot;submesh&quot;].toString();
+                    LOG_MESSAGE(&quot;Inventory&quot;, &quot;Add material slot &quot;+ submesh);
+                    addSlot(name, submesh.c_str(), holdItems, readyItems, SLOT_MATERIAL);
+                }
+                else
+                {
+                    LOG_ERROR(Logger::RULES, 
+                        &quot;Unknown slot type '&quot;+type+&quot;' in inventory properties.&quot;);
+                }
+            }
+        }
+		else if (key == Inventory::PROPERTY_CONTENT)
 		{
 			PropertyMap bonesContent = value.toMap();
 			for (PropertyMap::const_iterator it = bonesContent.begin();
@@ -301,8 +350,8 @@
     PropertySet* Inventory::getAllProperties() const
 	{
 		PropertySet* ps = new PropertySet();
+		ps-&gt;setProperty(Inventory::PROPERTY_SLOTS, getProperty(Inventory::PROPERTY_SLOTS));
 		ps-&gt;setProperty(Inventory::PROPERTY_CONTENT, getProperty(Inventory::PROPERTY_CONTENT));
 		return ps;
 	}
-
 }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000837.html">[Dsa-hl-svn] r3766 - rl/trunk/engine/script/swig
</A></li>
	<LI>Next message: <A HREF="000839.html">[Dsa-hl-svn] r3768 - dependencies/opensteer/include/OpenSteer	dependencies/opensteer/plugins dependencies/opensteer/src	modules/common/scripts rl/trunk/engine/ai	rl/trunk/engine/ai/include rl/trunk/engine/ai/src	rl/trunk/engine/rules/include rl/trunk/engine/rules/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#838">[ date ]</a>
              <a href="thread.html#838">[ thread ]</a>
              <a href="subject.html#838">[ subject ]</a>
              <a href="author.html#838">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
