<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3695 - in modules/common: materials materials/model	materials/programs materials/programs/Normalmapping models scripts
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3695%20-%20in%20modules/common%3A%20materials%20materials/model%0A%09materials/programs%20materials/programs/Normalmapping%20models%20scripts&In-Reply-To=%3C200708162032.l7GKWgIo009849%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000765.html">
   <LINK REL="Next"  HREF="000767.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3695 - in modules/common: materials materials/model	materials/programs materials/programs/Normalmapping models scripts</H1>
    <B>pnyx at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3695%20-%20in%20modules/common%3A%20materials%20materials/model%0A%09materials/programs%20materials/programs/Normalmapping%20models%20scripts&In-Reply-To=%3C200708162032.l7GKWgIo009849%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3695 - in modules/common: materials materials/model	materials/programs materials/programs/Normalmapping models scripts">pnyx at mail.berlios.de
       </A><BR>
    <I>Thu Aug 16 22:32:42 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000765.html">[Dsa-hl-svn] r3694 - modules/common/gui/windows
</A></li>
        <LI>Next message: <A HREF="000767.html">[Dsa-hl-svn] r3696 - modules/common/models
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#766">[ date ]</a>
              <a href="thread.html#766">[ thread ]</a>
              <a href="subject.html#766">[ subject ]</a>
              <a href="author.html#766">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: pnyx
Date: 2007-08-16 22:18:12 +0200 (Thu, 16 Aug 2007)
New Revision: 3695

Added:
   modules/common/materials/model/lookup_skin.png
   modules/common/materials/model/men_eye_normal.png
   modules/common/materials/model/men_female_human_diffuse.png
   modules/common/materials/model/men_human_female_backpack_leather_01_normal.png
   modules/common/materials/model/men_human_female_hair_long_01_normal.png
   modules/common/materials/model/men_human_female_head_02_diffuse.png
   modules/common/materials/model/men_human_female_head_02_normal.png
   modules/common/materials/model/men_human_female_normalmap.png
   modules/common/materials/model/obj_Garetherplatte_diffuse.png
   modules/common/materials/model/obj_Garetherplatte_normal.png
   modules/common/materials/model/obj_Garetherplatte_spec.png
   modules/common/materials/model/obj_boots_01_normal.png
   modules/common/materials/model/obj_kroetenhaut_diffuse.png
   modules/common/materials/model/obj_kroetenhaut_normal.png
   modules/common/materials/model/obj_kroetenhaut_specular.png
   modules/common/materials/model/obj_pants_01_diffuse.png
   modules/common/materials/model/obj_pants_01_normal.png
   modules/common/materials/model/obj_shortsleeve02_normal.png
   modules/common/materials/model/obj_shortsleeve02_specular.png
   modules/common/materials/programs/Normalmapping/
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping.program
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_PS.hlsl
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec.program
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec_PS.hlsl
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec_mirrored_PS.hlsl
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV0_VS.hlsl
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV1_VS.hlsl
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV2_VS.hlsl
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_mirrored_PS.hlsl
   modules/common/materials/programs/Normalmapping/Eye_Normalmapping_PS.hlsl
   modules/common/materials/programs/Normalmapping/Eye_Normalmapping_VS.hlsl
   modules/common/materials/programs/Normalmapping/Skin_Normalmapping.program
   modules/common/materials/programs/Normalmapping/Skin_Normalmapping_PS.hlsl
   modules/common/materials/programs/Normalmapping/Skin_Normalmapping_mirrored_PS.hlsl
   modules/common/materials/programs/Normalmapping/Torso_Normalmapping.program
Removed:
   modules/common/materials/model/men_human_female_hand.png
   modules/common/materials/model/obj_kroetenhaut.png
   modules/common/materials/model/obj_pants01.png
   modules/common/materials/model/obj_plattediffuse.png
   modules/common/materials/model/rl_mensch_female.png
Modified:
   modules/common/materials/men_human_female_armor_garethplatte.mesh.material
   modules/common/materials/men_human_female_armor_kroetenhaut.mesh.material
   modules/common/materials/men_human_female_backpack_leather_01.material
   modules/common/materials/men_human_female_feet_boots01.mesh.material
   modules/common/materials/men_human_female_hair_long01_normal.mesh.material
   modules/common/materials/men_human_female_hand_nude.mesh.material
   modules/common/materials/men_human_female_head02.mesh.material
   modules/common/materials/men_human_female_leg_pants01_long.mesh.material
   modules/common/materials/men_human_female_torso.mesh.material
   modules/common/materials/model/men_human_female_hair_long_01_spec.png
   modules/common/materials/programs/NormalMap2Lights.hlsl
   modules/common/models/men_human_female.skeleton
   modules/common/models/men_human_female_armor_garethplatte.mesh
   modules/common/models/men_human_female_armor_kroetenhaut.mesh
   modules/common/models/men_human_female_backpack_leather_01.mesh
   modules/common/models/men_human_female_backpack_leather_01_smalll.mesh
   modules/common/models/men_human_female_feet_boots_01.mesh
   modules/common/models/men_human_female_hair_long_01_normal.mesh
   modules/common/models/men_human_female_hand_nude.mesh
   modules/common/models/men_human_female_head_02.mesh
   modules/common/models/men_human_female_leg_pants_01_long.mesh
   modules/common/models/men_human_female_torso.mesh
   modules/common/scripts/moduleconfig.rb
Log:
* Added Normalmapping shaders (Spec, mirrored UV support, Skin, eyemovement etc.)
* Changed character materials to use these shaders
* Changed Meshes and Skeleton to support Lexi Exporter

Modified: modules/common/materials/men_human_female_armor_garethplatte.mesh.material
===================================================================
--- modules/common/materials/men_human_female_armor_garethplatte.mesh.material	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/men_human_female_armor_garethplatte.mesh.material	2007-08-16 20:18:12 UTC (rev 3695)
@@ -1,5 +1,7 @@
 
-material men_human_female_armor_garethplatte : Basic_Vertex_Shader
+material men_human_female_armor_garethplatte : Basic_Normalmapping_Spec
 {
-set_texture_alias diffuse obj_plattediffuse.png
+set_texture_alias DiffuseMap obj_Garetherplatte_diffuse.png
+set_texture_alias NormalMap obj_Garetherplatte_normal.png
+set_texture_alias SpecMap obj_Garetherplatte_spec.png
 }

Modified: modules/common/materials/men_human_female_armor_kroetenhaut.mesh.material
===================================================================
--- modules/common/materials/men_human_female_armor_kroetenhaut.mesh.material	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/men_human_female_armor_kroetenhaut.mesh.material	2007-08-16 20:18:12 UTC (rev 3695)
@@ -1,5 +1,7 @@
 
-material men_human_female_armor_kroetenhaut : Basic_Vertex_Shader
+material men_human_female_armor_kroetenhaut : Basic_Normalmapping_Spec_mirrored
 {
-set_texture_alias diffuse obj_kroetenhaut.png
+set_texture_alias DiffuseMap obj_kroetenhaut_diffuse.png
+set_texture_alias NormalMap obj_kroetenhaut_normal.png
+set_texture_alias SpecMap obj_kroetenhaut_specular.png
 }

Modified: modules/common/materials/men_human_female_backpack_leather_01.material
===================================================================
--- modules/common/materials/men_human_female_backpack_leather_01.material	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/men_human_female_backpack_leather_01.material	2007-08-16 20:18:12 UTC (rev 3695)
@@ -1,5 +1,6 @@
 
-material men_human_female_backpack_leather_01: Basic_Vertex_Shader
+material men_human_female_backpack_leather_01: Basic_Normalmapping
 {
-set_texture_alias diffuse men_human_female_backpack_leather_01_diffuse.png
+set_texture_alias DiffuseMap men_human_female_backpack_leather_01_diffuse.png
+set_texture_alias NormalMap men_human_female_backpack_leather_01_normal.png
 }

Modified: modules/common/materials/men_human_female_feet_boots01.mesh.material
===================================================================
--- modules/common/materials/men_human_female_feet_boots01.mesh.material	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/men_human_female_feet_boots01.mesh.material	2007-08-16 20:18:12 UTC (rev 3695)
@@ -1,6 +1,7 @@
 
-material men_human_female_feet_boots_01 : Basic_Vertex_ShaderUV1
+material men_human_female_feet_boots_01 : Basic_Normalmapping_UV1_mirrored
 {
-set_texture_alias diffuse obj_boots01.png
-			//	tex_coord_set 1
+set_texture_alias DiffuseMap obj_boots01.png
+set_texture_alias NormalMap obj_boots_01_normal.png
+			//	tex_coord_set 1 obj_boots_01_normal.png
 }

Modified: modules/common/materials/men_human_female_hair_long01_normal.mesh.material
===================================================================
--- modules/common/materials/men_human_female_hair_long01_normal.mesh.material	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/men_human_female_hair_long01_normal.mesh.material	2007-08-16 20:18:12 UTC (rev 3695)
@@ -1,6 +1,7 @@
 
-material men_human_female_hair_long_01_normal : Hair_Vertex_Shader
+material men_human_female_hair_long_01_normal : Basic_Normalmapping_Spec_Alpha
 {
-set_texture_alias diffuse men_human_female_hair_long_01.png
-set_texture_alias spec men_human_female_hair_long_01_spec.png
+set_texture_alias DiffuseMap men_human_female_hair_long_01.png
+set_texture_alias NormalMap men_human_female_hair_long_01_normal.png
+set_texture_alias SpecMap men_human_female_hair_long_01_spec.png
 }

Modified: modules/common/materials/men_human_female_hand_nude.mesh.material
===================================================================
--- modules/common/materials/men_human_female_hand_nude.mesh.material	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/men_human_female_hand_nude.mesh.material	2007-08-16 20:18:12 UTC (rev 3695)
@@ -1,6 +1,8 @@
 
-material men_human_female_hand_nude : Skin_Vertex_Shader
+material men_human_female_hand_nude : Skin_Normalmapping
 {
-set_texture_alias diffuse rl_mensch_female.png
+set_texture_alias DiffuseMap men_female_human_diffuse.png
+set_texture_alias NormalMap men_human_female_normalmap.png
+set_texture_alias SpecMap men_female_human_diffuse.png
 
 }

Modified: modules/common/materials/men_human_female_head02.mesh.material
===================================================================
--- modules/common/materials/men_human_female_head02.mesh.material	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/men_human_female_head02.mesh.material	2007-08-16 20:18:12 UTC (rev 3695)
@@ -1,8 +1,16 @@
 
-material men_human_female_head_02 : Face_Vertex_Shader
+material men_human_female_head_02 : Face_Normalmapping_mirrored
 {
-set_texture_alias diffuse men_human_female_head02.png
-set_texture_alias eyeColor men_eye_blue.png
-set_texture_alias eyeShadow men_eyeshadow.png
+set_texture_alias DiffuseMap men_human_female_head_02_diffuse.png
+set_texture_alias NormalMap men_human_female_head_02_normal.png
+set_texture_alias SpecMap men_human_female_head_02_diffuse.png
 
+set_texture_alias EyeDiffuseMap men_eye_blue.png
+set_texture_alias EyeNormalMap men_eye_normal.png
+set_texture_alias EyeShadowMap men_eyeshadow.png
+
+
 }
+//set_texture_alias diffuse men_human_female_head02.png
+//set_texture_alias eyeColor men_eye_blue.png
+//set_texture_alias eyeShadow men_eyeshadow.png

Modified: modules/common/materials/men_human_female_leg_pants01_long.mesh.material
===================================================================
--- modules/common/materials/men_human_female_leg_pants01_long.mesh.material	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/men_human_female_leg_pants01_long.mesh.material	2007-08-16 20:18:12 UTC (rev 3695)
@@ -1,6 +1,10 @@
 
-material men_human_female_legs_pants_01_long : Basic_Vertex_Shader
+material men_human_female_legs_pants_01_long : Basic_Normalmapping_Spec_mirrored
 {
-set_texture_alias diffuse obj_pants01.png
+set_texture_alias DiffuseMap obj_pants_01_diffuse.png
+set_texture_alias NormalMap obj_pants_01_normal.png
+set_texture_alias SpecMap obj_pants_01_diffuse.png
+}
+// set_texture_alias diffuse obj_pants01.png
 
-}
+

Modified: modules/common/materials/men_human_female_torso.mesh.material
===================================================================
--- modules/common/materials/men_human_female_torso.mesh.material	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/men_human_female_torso.mesh.material	2007-08-16 20:18:12 UTC (rev 3695)
@@ -1,5 +1,10 @@
-material men_human_female_torso : Torso_Vertex_Shader_Short
+material men_human_female_torso : Torso_Normalmapping_Short
 {
-	set_texture_alias skin rl_mensch_female.png
-	set_texture_alias cloth obj_shortsleeve02_diffuse.png
-}
+set_texture_alias DiffuseMapSkin men_female_human_diffuse.png
+set_texture_alias NormalMapSkin men_human_female_normalmap.png
+set_texture_alias SpecMapSkin men_female_human_diffuse.png
+
+set_texture_alias DiffuseMapCloth obj_shortsleeve02_diffuse.png
+set_texture_alias NormalMapCloth obj_shortsleeve02_normal.png
+set_texture_alias SpecMapCloth obj_shortsleeve02_specular.png
+}
\ No newline at end of file

Added: modules/common/materials/model/lookup_skin.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/lookup_skin.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/men_eye_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/men_eye_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/men_female_human_diffuse.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/men_female_human_diffuse.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/men_human_female_backpack_leather_01_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/men_human_female_backpack_leather_01_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/men_human_female_hair_long_01_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/men_human_female_hair_long_01_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/common/materials/model/men_human_female_hair_long_01_spec.png
===================================================================
(Binary files differ)

Deleted: modules/common/materials/model/men_human_female_hand.png
===================================================================
(Binary files differ)

Added: modules/common/materials/model/men_human_female_head_02_diffuse.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/men_human_female_head_02_diffuse.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/men_human_female_head_02_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/men_human_female_head_02_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/men_human_female_normalmap.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/men_human_female_normalmap.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/obj_Garetherplatte_diffuse.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_Garetherplatte_diffuse.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/obj_Garetherplatte_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_Garetherplatte_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/obj_Garetherplatte_spec.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_Garetherplatte_spec.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/obj_boots_01_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_boots_01_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: modules/common/materials/model/obj_kroetenhaut.png
===================================================================
(Binary files differ)

Copied: modules/common/materials/model/obj_kroetenhaut_diffuse.png (from rev 3694, modules/common/materials/model/obj_kroetenhaut.png)
===================================================================
(Binary files differ)

Added: modules/common/materials/model/obj_kroetenhaut_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_kroetenhaut_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/obj_kroetenhaut_specular.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_kroetenhaut_specular.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: modules/common/materials/model/obj_pants01.png
===================================================================
(Binary files differ)

Added: modules/common/materials/model/obj_pants_01_diffuse.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_pants_01_diffuse.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/obj_pants_01_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_pants_01_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: modules/common/materials/model/obj_plattediffuse.png
===================================================================
(Binary files differ)

Added: modules/common/materials/model/obj_shortsleeve02_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_shortsleeve02_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/common/materials/model/obj_shortsleeve02_specular.png
===================================================================
(Binary files differ)


Property changes on: modules/common/materials/model/obj_shortsleeve02_specular.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: modules/common/materials/model/rl_mensch_female.png
===================================================================
(Binary files differ)

Modified: modules/common/materials/programs/NormalMap2Lights.hlsl
===================================================================
--- modules/common/materials/programs/NormalMap2Lights.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/NormalMap2Lights.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -10,7 +10,7 @@
 
 VS_OUTPUT vs_main_1uv(float4 inPos     : POSITION,
                       float3 inNormal  : NORMAL,
-                      float3 inTangent : TEXCOORD1,
+                      float3 inTangent : TANGENT,
                       float2 inUV      : TEXCOORD0,
                       uniform float4 EyePosOS,
                       uniform float4 Light1PosOS,
@@ -43,7 +43,7 @@
 
 VS_OUTPUT vs_main_2uv(float4 inPos     : POSITION,
                       float3 inNormal  : NORMAL,
-                      float3 inTangent : TEXCOORD2,
+                      float3 inTangent : TANGENT,
                       float2 inUV      : TEXCOORD0,
                       uniform float4 EyePosOS,
                       uniform float4 Light1PosOS,
@@ -77,7 +77,7 @@
 
 VS_OUTPUT vs_main_3uv(float4 inPos     : POSITION,
                       float3 inNormal  : NORMAL,
-                      float3 inTangent : TEXCOORD3,
+                      float3 inTangent : TANGENT,
                       float2 inUV      : TEXCOORD0,
                       uniform float4 EyePosOS,
                       uniform float4 Light1PosOS,
@@ -125,7 +125,7 @@
                uniform float4  AmbientLight) : COLOR 
 {
     // Read normal from texture. *2-1 to convert it from signed to unsigned.
-    float4 Normal = tex2D(NormalMap, In.UV) * 2 - 1;
+    float3 Normal = tex2D(NormalMap, In.UV).xyz * 2 - 1;
     float4 TexColour = tex2D(DiffuseMap, In.UV);
 
     // Ambient component

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping.program
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping.program	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping.program	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,163 @@
+vertex_program Basic_Normalmapping_UV0_VS_HLSL hlsl
+{
+    source Basic_Normalmapping_UV0_VS.hlsl
+    entry_point vs_main
+    target vs_1_1
+}
+
+vertex_program Basic_Normalmapping_UV1_VS_HLSL hlsl
+{
+    source Basic_Normalmapping_UV1_VS.hlsl
+    entry_point vs_main
+    target vs_1_1
+}
+
+vertex_program Basic_Normalmapping_UV2_VS_HLSL hlsl
+{
+    source Basic_Normalmapping_UV2_VS.hlsl
+    entry_point vs_main
+    target vs_1_1
+}
+
+fragment_program Basic_Normalmapping_PS_HLSL hlsl
+{
+    source Basic_Normalmapping_PS.hlsl
+    entry_point ps_main
+    target ps_2_0
+}
+
+
+fragment_program Basic_Normalmapping_mirrored_PS_HLSL hlsl
+{
+    source Basic_Normalmapping_mirrored_PS.hlsl
+    entry_point ps_main
+    target ps_2_0
+}
+
+
+material Basic_Normalmapping
+{
+    technique hlsl
+    {
+        pass
+        {
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+                param_named SpecColor float4 0.2 0.2 0.2 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
+
+
+material Basic_Normalmapping_UV1_mirrored
+{
+    technique hlsl
+    {
+        pass
+        {
+            vertex_program_ref Basic_Normalmapping_UV1_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_mirrored_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+                param_named SpecColor float4 0.2 0.2 0.2 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
\ No newline at end of file

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_PS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_PS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_PS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,66 @@
+float4 LightColor_0;
+float4 LightColor_1;
+float4 LightColor_2;
+float4 groundcolor;
+float4 skycolor;
+float4 SpecColor;
+float SpecExp;
+sampler DiffuseMap;
+sampler NormalMap;
+
+
+float4 ps_main(
+               float2 UV        : TEXCOORD0,
+               float4 LightDir_0  : TEXCOORD1,
+               float3 HalfVect_0  : TEXCOORD2,
+               float4 LightDir_1 : TEXCOORD3,
+               float3 HalfVect_1 : TEXCOORD4,
+               float4 LightDir_2 : TEXCOORD5,
+               float3 HalfVect_2 : TEXCOORD6,
+               float3 SkyDir     : TEXCOORD7
+               ) : COLOR0
+{ 
+
+   float3 normal = tex2D(NormalMap,UV).rgb *2 -1;
+   float4 ambient= lerp(skycolor , groundcolor, ((dot(normal, SkyDir) + 1.0)/2.0));
+
+   float specAttn;
+   float specAttn1;
+   float specAttn2;
+   float4 AngleAttn;
+   float4 AngleAttn1;
+   float4 AngleAttn2;
+   
+   
+   AngleAttn= saturate(dot(normal,LightDir_0.xyz));
+   AngleAttn1= saturate(dot(normal,LightDir_1.xyz));
+   AngleAttn2= saturate(dot(normal,LightDir_2.xyz));
+   
+   if (AngleAttn.r &gt; 0.0)
+   {
+      specAttn = LightColor_0 * pow(clamp(dot(normal,normalize(HalfVect_0)),0,1),SpecExp)* LightDir_0.w;
+      AngleAttn *= LightColor_0 * LightDir_0.w;
+   }
+   
+   if (AngleAttn1.r &gt; 0.0)
+   {
+      specAttn1  =LightColor_1 *  pow(clamp(dot(normal,normalize(HalfVect_1)),0,1),SpecExp)* LightDir_1.w;
+      AngleAttn1 *= LightColor_1 * LightDir_1.w;
+   }
+  
+   if (AngleAttn2.r &gt; 0.0)
+   {
+      specAttn2  =LightColor_2 *  pow(clamp(dot(normal,normalize(HalfVect_2)),0,1),SpecExp)* LightDir_2.w;
+      AngleAttn2 *= LightColor_2 * LightDir_2.w;
+   }
+  
+  
+   float4 Diffuse = AngleAttn + AngleAttn1 + AngleAttn2;
+   float4 specular = SpecColor * (specAttn + specAttn1 + specAttn2) * Diffuse;
+   
+   
+   return (tex2D(DiffuseMap,UV) * (ambient + Diffuse)) +specular;
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec.program
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec.program	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec.program	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,222 @@
+fragment_program Basic_Normalmapping_Spec_PS_HLSL hlsl
+{
+    source Basic_Normalmapping_Spec_PS.hlsl
+    entry_point ps_main
+    target ps_2_0
+}
+
+fragment_program Basic_Normalmapping_Spec_mirrored_PS_HLSL hlsl
+{
+    source Basic_Normalmapping_Spec_mirrored_PS.hlsl
+    entry_point ps_main
+    target ps_2_0
+}
+
+
+material Basic_Normalmapping_Spec
+{
+    technique hlsl
+    {
+        pass
+        {
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_Spec_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
+
+
+material Basic_Normalmapping_Spec_mirrored
+{
+    technique hlsl
+    {
+        pass
+        {
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_Spec_mirrored_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
+
+
+material Basic_Normalmapping_Spec_Alpha
+{
+    technique hlsl
+    {
+        pass
+        {
+	        scene_blend alpha_blend 
+      		// Tiefenpuffer aus
+      		depth_write off
+      		
+      		
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_Spec_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
\ No newline at end of file

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec_PS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec_PS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec_PS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,68 @@
+uniform float4 LightColor_0;
+uniform float4 LightColor_1;
+uniform float4 LightColor_2;
+uniform float4 groundcolor;
+uniform float4 skycolor;
+uniform float SpecExp;
+uniform sampler2D DiffuseMap;
+uniform sampler2D NormalMap;
+uniform sampler2D SpecMap;
+
+
+float4 ps_main(
+               float2 UV         : TEXCOORD0,
+               float4 LightDir_0 : TEXCOORD1,
+               float3 HalfVect_0 : TEXCOORD2,
+               float4 LightDir_1 : TEXCOORD3,
+               float3 HalfVect_1 : TEXCOORD4,
+               float4 LightDir_2 : TEXCOORD5,
+               float3 HalfVect_2 : TEXCOORD6,
+               float3 SkyDir     : TEXCOORD7
+               ) : COLOR0
+{ 
+
+   float3 normal = tex2D(NormalMap,UV).rgb *2 -1;
+   float4 ambient= lerp(skycolor , groundcolor, ((dot(normal, SkyDir) + 1.0)/2.0));
+
+   
+   
+   float specAttn;
+   float4 AngleAttn;
+   float4 AngleAttn1;
+   float4 AngleAttn2;
+   
+   AngleAttn= saturate(dot(normal,LightDir_0.xyz));
+   AngleAttn1= saturate(dot(normal,LightDir_1.xyz));
+   AngleAttn2= saturate(dot(normal,LightDir_2.xyz));
+   
+   float4 Diffuse;
+   
+   if (AngleAttn.r &gt; 0.0)
+   {
+      specAttn =LightColor_0 * pow(clamp(dot(normal,normalize(HalfVect_0)),0,1),SpecExp)* LightDir_0.w;
+      Diffuse = AngleAttn* LightColor_0 * LightDir_0.w;  
+   }
+   
+   if (AngleAttn1.r &gt; 0.0)
+   {
+      specAttn  += LightColor_1 * pow(clamp(dot(normal,normalize(HalfVect_1)),0,1),SpecExp)* LightDir_1.w;
+      Diffuse += AngleAttn1* LightColor_1 * LightDir_1.w;
+   }
+  
+   if (AngleAttn2.r &gt; 0.0)
+   {
+      specAttn  +=LightColor_2 * pow(clamp(dot(normal,normalize(HalfVect_2)),0,1),SpecExp)* LightDir_2.w;
+      Diffuse += AngleAttn2* LightColor_2 * LightDir_2.w;
+   }
+  
+  
+   //float4 Diffuse = AngleAttn + AngleAttn1 + AngleAttn2;
+   float4 specular = tex2D(SpecMap, UV) * specAttn * (float(Diffuse.r + Diffuse.g + Diffuse.b)/3);
+   
+   float4 color = tex2D(DiffuseMap,UV);
+   
+   return float4((color.rgb * (ambient.rgb + Diffuse.rgb)) + specular.rgb ,color.a);
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec_mirrored_PS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec_mirrored_PS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec_mirrored_PS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,74 @@
+uniform float4 LightColor_0;
+uniform float4 LightColor_1;
+uniform float4 LightColor_2;
+uniform float4 groundcolor;
+uniform float4 skycolor;
+uniform float SpecExp;
+uniform sampler2D DiffuseMap;
+uniform sampler2D NormalMap;
+uniform sampler2D SpecMap;
+
+
+float4 ps_main(
+               float2 UV         : TEXCOORD0,
+               float4 LightDir_0 : TEXCOORD1,
+               float3 HalfVect_0 : TEXCOORD2,
+               float4 LightDir_1 : TEXCOORD3,
+               float3 HalfVect_1 : TEXCOORD4,
+               float4 LightDir_2 : TEXCOORD5,
+               float3 HalfVect_2 : TEXCOORD6,
+               float3 SkyDir     : TEXCOORD7
+               ) : COLOR0
+{ 
+
+   float3 normal = tex2D(NormalMap,UV).rgb *2 -1;
+   if (floor(UV.x)== 1)
+   {
+	  normal = float3(normal.x, -normal.y, normal.z);
+   }
+   
+   
+   float4 ambient= lerp(skycolor , groundcolor, ((dot(normal, SkyDir) + 1.0)/2.0));
+
+   
+   
+   float specAttn;
+   float4 AngleAttn;
+   float4 AngleAttn1;
+   float4 AngleAttn2;
+   
+   AngleAttn= saturate(dot(normal,LightDir_0.xyz));
+   AngleAttn1= saturate(dot(normal,LightDir_1.xyz));
+   AngleAttn2= saturate(dot(normal,LightDir_2.xyz));
+   
+   float4 Diffuse;
+   
+   if (AngleAttn.r &gt; 0.0)
+   {
+      specAttn =LightColor_0 * pow(clamp(dot(normal,normalize(HalfVect_0)),0,1),SpecExp)* LightDir_0.w;
+      Diffuse = AngleAttn* LightColor_0 * LightDir_0.w;  
+   }
+   
+   if (AngleAttn1.r &gt; 0.0)
+   {
+      specAttn  += LightColor_1 * pow(clamp(dot(normal,normalize(HalfVect_1)),0,1),SpecExp)* LightDir_1.w;
+      Diffuse += AngleAttn1* LightColor_1 * LightDir_1.w;
+   }
+  
+   if (AngleAttn2.r &gt; 0.0)
+   {
+      specAttn  +=LightColor_2 * pow(clamp(dot(normal,normalize(HalfVect_2)),0,1),SpecExp)* LightDir_2.w;
+      Diffuse += AngleAttn2* LightColor_2 * LightDir_2.w;
+   }
+  
+  
+   //float4 Diffuse = AngleAttn + AngleAttn1 + AngleAttn2;
+   float4 specular = tex2D(SpecMap, UV) * specAttn * (float(Diffuse.r + Diffuse.g + Diffuse.b)/3);
+   
+   float4 color = tex2D(DiffuseMap,UV);
+   
+   return float4((color.rgb * (ambient.rgb + Diffuse.rgb)) + specular.rgb ,color.a);
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV0_VS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV0_VS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV0_VS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,98 @@
+float4x4 matViewProjection;
+float4 LightPosition_0;
+float4 LightPosition_1;
+float4 LightPosition_2;
+float4 vViewPosition;
+float4 LightAttn_0;
+float4 LightAttn_1;
+float4 LightAttn_2;
+
+struct VS_OUTPUT 
+{
+   float4 Position   : POSITION0;
+   float2 UV         : TEXCOORD0;
+   float4 LightDir_0 : TEXCOORD1;
+   float3 HalfVect_0 : TEXCOORD2;
+   float4 LightDir_1 : TEXCOORD3;
+   float3 HalfVect_1 : TEXCOORD4;
+   float4 LightDir_2 : TEXCOORD5;
+   float3 HalfVect_2 : TEXCOORD6;
+   float3 SkyDir     : TEXCOORD7;
+   
+};
+
+VS_OUTPUT vs_main(      float4 inPosition : POSITION0,
+                        float3 inNormal : NORMAL0,
+                        float3 inTangent : TANGENT0,
+                        float2 inUV:   TEXCOORD )
+{
+   VS_OUTPUT Output;
+
+   Output.Position = mul( matViewProjection, inPosition );
+   Output.UV = inUV;
+   
+   float3x3 TangentSpace;
+   
+   TangentSpace[0] = inTangent;   
+   TangentSpace[1] = cross(inTangent,inNormal);   
+   TangentSpace[2] = inNormal;
+   
+   float3 EyeVector = normalize(vViewPosition - inPosition);
+   
+   //################# Light 0  ################
+   float4 LightDir;
+   LightDir.xyz = LightPosition_0 - inPosition * LightPosition_0.w;
+   float Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_0.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_0.y +
+                            LightAttn_0.z * Dist +
+                            LightAttn_0.w * Dist * Dist));
+                            
+   
+   
+   Output.HalfVect_0 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_0 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 1  ################
+   LightDir;
+   LightDir.xyz = LightPosition_1 - inPosition * LightPosition_1.w;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_1.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_1.y +
+                            LightAttn_1.z * Dist +
+                            LightAttn_1.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_1 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_1 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 2  ################
+   LightDir;
+   LightDir.xyz = LightPosition_2 - inPosition * LightPosition_2.w;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_2.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_2.y +
+                            LightAttn_2.z * Dist +
+                            LightAttn_2.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_2 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_2 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   
+   // SkyLight
+   Output.SkyDir    = mul(TangentSpace, float3(0,-1,0));
+   
+   
+   return( Output );
+   
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV1_VS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV1_VS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV1_VS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,98 @@
+float4x4 matViewProjection;
+float4 LightPosition_0;
+float4 LightPosition_1;
+float4 LightPosition_2;
+float4 vViewPosition;
+float4 LightAttn_0;
+float4 LightAttn_1;
+float4 LightAttn_2;
+
+struct VS_OUTPUT 
+{
+   float4 Position   : POSITION0;
+   float2 UV         : TEXCOORD0;
+   float4 LightDir_0 : TEXCOORD1;
+   float3 HalfVect_0 : TEXCOORD2;
+   float4 LightDir_1 : TEXCOORD3;
+   float3 HalfVect_1 : TEXCOORD4;
+   float4 LightDir_2 : TEXCOORD5;
+   float3 HalfVect_2 : TEXCOORD6;
+   float3 SkyDir     : TEXCOORD7;
+   
+};
+
+VS_OUTPUT vs_main(      float4 inPosition : POSITION0,
+                        float3 inNormal : NORMAL0,
+                        float3 inTangent : TANGENT0,
+                        float2 inUV:   TEXCOORD1 )
+{
+   VS_OUTPUT Output;
+
+   Output.Position = mul( matViewProjection, inPosition );
+   Output.UV = inUV;
+   
+   float3x3 TangentSpace;
+   
+   TangentSpace[0] = inTangent;   
+   TangentSpace[1] = cross(inTangent,inNormal);   
+   TangentSpace[2] = inNormal;
+   
+   float3 EyeVector = normalize(vViewPosition - inPosition);
+   
+   //################# Light 0  ################
+   float4 LightDir;
+   LightDir.xyz = LightPosition_0 - inPosition * LightPosition_0.w;
+   float Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_0.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_0.y +
+                            LightAttn_0.z * Dist +
+                            LightAttn_0.w * Dist * Dist));
+                            
+   
+   
+   Output.HalfVect_0 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_0 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 1  ################
+   LightDir;
+   LightDir.xyz = LightPosition_1 - inPosition * LightPosition_1.w;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_1.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_1.y +
+                            LightAttn_1.z * Dist +
+                            LightAttn_1.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_1 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_1 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 2  ################
+   LightDir;
+   LightDir.xyz = LightPosition_2 - inPosition * LightPosition_2.w;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_2.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_2.y +
+                            LightAttn_2.z * Dist +
+                            LightAttn_2.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_2 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_2 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   
+   // SkyLight
+   Output.SkyDir    = mul(TangentSpace, float3(0,-1,0));
+   
+   
+   return( Output );
+   
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV2_VS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV2_VS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV2_VS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,98 @@
+float4x4 matViewProjection;
+float4 LightPosition_0;
+float4 LightPosition_1;
+float4 LightPosition_2;
+float4 vViewPosition;
+float4 LightAttn_0;
+float4 LightAttn_1;
+float4 LightAttn_2;
+
+struct VS_OUTPUT 
+{
+   float4 Position   : POSITION0;
+   float2 UV         : TEXCOORD0;
+   float4 LightDir_0 : TEXCOORD1;
+   float3 HalfVect_0 : TEXCOORD2;
+   float4 LightDir_1 : TEXCOORD3;
+   float3 HalfVect_1 : TEXCOORD4;
+   float4 LightDir_2 : TEXCOORD5;
+   float3 HalfVect_2 : TEXCOORD6;
+   float3 SkyDir     : TEXCOORD7;
+   
+};
+
+VS_OUTPUT vs_main(      float4 inPosition : POSITION0,
+                        float3 inNormal : NORMAL0,
+                        float3 inTangent : TANGENT0,
+                        float2 inUV:   TEXCOORD2 )
+{
+   VS_OUTPUT Output;
+
+   Output.Position = mul( matViewProjection, inPosition );
+   Output.UV = inUV;
+   
+   float3x3 TangentSpace;
+   
+   TangentSpace[0] = inTangent;   
+   TangentSpace[1] = cross(inTangent,inNormal);   
+   TangentSpace[2] = inNormal;
+   
+   float3 EyeVector = normalize(vViewPosition - inPosition);
+   
+   //################# Light 0  ################
+   float4 LightDir;
+   LightDir.xyz = LightPosition_0 - inPosition * LightPosition_0.w;
+   float Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_0.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_0.y +
+                            LightAttn_0.z * Dist +
+                            LightAttn_0.w * Dist * Dist));
+                            
+   
+   
+   Output.HalfVect_0 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_0 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 1  ################
+   LightDir;
+   LightDir.xyz = LightPosition_1 - inPosition * LightPosition_1.w;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_1.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_1.y +
+                            LightAttn_1.z * Dist +
+                            LightAttn_1.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_1 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_1 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 2  ################
+   LightDir;
+   LightDir.xyz = LightPosition_2 - inPosition * LightPosition_2.w;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_2.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_2.y +
+                            LightAttn_2.z * Dist +
+                            LightAttn_2.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_2 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_2 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   
+   // SkyLight
+   Output.SkyDir    = mul(TangentSpace, float3(0,-1,0));
+   
+   
+   return( Output );
+   
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_mirrored_PS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_mirrored_PS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_mirrored_PS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,72 @@
+float4 LightColor_0;
+float4 LightColor_1;
+float4 LightColor_2;
+float4 groundcolor;
+float4 skycolor;
+float4 SpecColor;
+float SpecExp;
+sampler DiffuseMap;
+sampler NormalMap;
+
+
+float4 ps_main(
+               float2 UV        : TEXCOORD0,
+               float4 LightDir_0  : TEXCOORD1,
+               float3 HalfVect_0  : TEXCOORD2,
+               float4 LightDir_1 : TEXCOORD3,
+               float3 HalfVect_1 : TEXCOORD4,
+               float4 LightDir_2 : TEXCOORD5,
+               float3 HalfVect_2 : TEXCOORD6,
+               float3 SkyDir     : TEXCOORD7
+               ) : COLOR0
+{ 
+
+   float3 normal = tex2D(NormalMap,UV).rgb *2 -1;
+   
+   if (floor(UV.x)== 1)
+   {
+	  normal = float3(normal.x, -normal.y, normal.z);
+   }
+   
+   float4 ambient= lerp(skycolor , groundcolor, ((dot(normal, SkyDir) + 1.0)/2.0));
+
+   float specAttn;
+   float specAttn1;
+   float specAttn2;
+   float4 AngleAttn;
+   float4 AngleAttn1;
+   float4 AngleAttn2;
+   
+   
+   AngleAttn= saturate(dot(normal,LightDir_0.xyz));
+   AngleAttn1= saturate(dot(normal,LightDir_1.xyz));
+   AngleAttn2= saturate(dot(normal,LightDir_2.xyz));
+   
+   if (AngleAttn.r &gt; 0.0)
+   {
+      specAttn = LightColor_0 * pow(clamp(dot(normal,normalize(HalfVect_0)),0,1),SpecExp)* LightDir_0.w;
+      AngleAttn *= LightColor_0 * LightDir_0.w;
+   }
+   
+   if (AngleAttn1.r &gt; 0.0)
+   {
+      specAttn1  =LightColor_1 *  pow(clamp(dot(normal,normalize(HalfVect_1)),0,1),SpecExp)* LightDir_1.w;
+      AngleAttn1 *= LightColor_1 * LightDir_1.w;
+   }
+  
+   if (AngleAttn2.r &gt; 0.0)
+   {
+      specAttn2  =LightColor_2 *  pow(clamp(dot(normal,normalize(HalfVect_2)),0,1),SpecExp)* LightDir_2.w;
+      AngleAttn2 *= LightColor_2 * LightDir_2.w;
+   }
+  
+  
+   float4 Diffuse = AngleAttn + AngleAttn1 + AngleAttn2;
+   float4 specular = SpecColor * (specAttn + specAttn1 + specAttn2) * Diffuse;
+   
+   
+   return (tex2D(DiffuseMap,UV) * (ambient + Diffuse)) +specular;
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Eye_Normalmapping_PS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Eye_Normalmapping_PS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Eye_Normalmapping_PS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,72 @@
+float4 LightColor_0;
+float4 LightColor_1;
+float4 LightColor_2;
+float4 groundcolor;
+float4 skycolor;
+float4 SpecColor;
+float SpecExp;
+sampler DiffuseMap;
+sampler NormalMap;
+sampler ShadowMap;
+
+
+float4 ps_main(
+               float4 UV        : TEXCOORD0,
+               float4 LightDir_0  : TEXCOORD1,
+               float3 HalfVect_0  : TEXCOORD2,
+               float4 LightDir_1 : TEXCOORD3,
+               float3 HalfVect_1 : TEXCOORD4,
+               float4 LightDir_2 : TEXCOORD5,
+               float3 HalfVect_2 : TEXCOORD6,
+               float3 SkyDir     : TEXCOORD7
+               ) : COLOR0
+{ 
+
+   float3 normal = tex2D(NormalMap,UV.xy).rgb *2 -1;
+   
+   if (UV.z &gt; 1)
+   {
+	  normal = float3(-normal.x, -normal.y, normal.z);
+   }
+   float4 ambient= lerp(skycolor , groundcolor, ((dot(normal, SkyDir) + 1.0)/2.0));
+   
+   float specAttn;
+   float specAttn1;
+   float specAttn2;
+   float4 AngleAttn;
+   float4 AngleAttn1;
+   float4 AngleAttn2;
+   
+   
+   AngleAttn= saturate(dot(normal,LightDir_0.xyz));
+   AngleAttn1= saturate(dot(normal,LightDir_1.xyz));
+   AngleAttn2= saturate(dot(normal,LightDir_2.xyz));
+   
+   if (AngleAttn.r &gt; 0.0)
+   {
+      specAttn = LightColor_0 * pow(clamp(dot(normal,normalize(HalfVect_0)),0,1),SpecExp)* LightDir_0.w;
+      AngleAttn *= LightColor_0 * LightDir_0.w;
+   }
+   
+   if (AngleAttn1.r &gt; 0.0)
+   {
+      specAttn1  =LightColor_1 *  pow(clamp(dot(normal,normalize(HalfVect_1)),0,1),SpecExp)* LightDir_1.w;
+      AngleAttn1 *= LightColor_1 * LightDir_1.w;
+   }
+  
+   if (AngleAttn2.r &gt; 0.0)
+   {
+      specAttn2  =LightColor_2 *  pow(clamp(dot(normal,normalize(HalfVect_2)),0,1),SpecExp)* LightDir_2.w;
+      AngleAttn2 *= LightColor_2 * LightDir_2.w;
+   }
+  
+  
+   float4 Diffuse = AngleAttn + AngleAttn1 + AngleAttn2;
+   float4 specular = SpecColor * (specAttn + specAttn1 + specAttn2) * Diffuse;
+   
+   
+   return ((tex2D(DiffuseMap,UV.xy) * (ambient + Diffuse)) *tex2D(ShadowMap,UV.zw)+specular);
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Eye_Normalmapping_VS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Eye_Normalmapping_VS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Eye_Normalmapping_VS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,109 @@
+float4x4 matViewProjection;
+float4 LightPosition_0;
+float4 LightPosition_1;
+float4 LightPosition_2;
+float4 vViewPosition;
+float4 LightAttn_0;
+float4 LightAttn_1;
+float4 LightAttn_2;
+float3 eyeDirection;
+
+struct VS_OUTPUT 
+{
+   float4 Position   : POSITION0;
+   float4 UV         : TEXCOORD0;
+   float4 LightDir_0 : TEXCOORD1;
+   float3 HalfVect_0 : TEXCOORD2;
+   float4 LightDir_1 : TEXCOORD3;
+   float3 HalfVect_1 : TEXCOORD4;
+   float4 LightDir_2 : TEXCOORD5;
+   float3 HalfVect_2 : TEXCOORD6;
+   float3 SkyDir     : TEXCOORD7;
+   
+};
+
+VS_OUTPUT vs_main(      float4 inPosition : POSITION0,
+                        float3 inNormal : NORMAL0,
+                        float3 inTangent : TANGENT0,
+                        float2 inUV:   TEXCOORD1 )
+{
+   VS_OUTPUT Output;
+
+   Output.Position = mul( matViewProjection, inPosition );
+   Output.UV.zw = inUV;
+   
+   float2 eyeDir; 
+   eyeDir.x = clamp(-eyeDirection.x/3,-0.3,0.3);
+   eyeDir.y = clamp(-eyeDirection.z/3,-0.3,0.3);
+     
+   Output.UV.x        = inUV.x + eyeDir.x;
+   Output.UV.y        = inUV.y + eyeDir.y;
+   
+   
+   
+   
+   float3x3 TangentSpace;
+   
+   TangentSpace[0] = inTangent;   
+   TangentSpace[1] = cross(inTangent,inNormal);   
+   TangentSpace[2] = inNormal;
+   
+   float3 EyeVector = normalize(vViewPosition - inPosition);
+   
+   //################# Light 0  ################
+   float4 LightDir;
+   LightDir.xyz = LightPosition_0 - inPosition * LightPosition_0.w;
+   float Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_0.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_0.y +
+                            LightAttn_0.z * Dist +
+                            LightAttn_0.w * Dist * Dist));
+                            
+   
+   
+   Output.HalfVect_0 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_0 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 1  ################
+   LightDir;
+   LightDir.xyz = LightPosition_1 - inPosition * LightPosition_1.w;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_1.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_1.y +
+                            LightAttn_1.z * Dist +
+                            LightAttn_1.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_1 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_1 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 2  ################
+   LightDir;
+   LightDir.xyz = LightPosition_2 - inPosition * LightPosition_2.w;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_2.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_2.y +
+                            LightAttn_2.z * Dist +
+                            LightAttn_2.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_2 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_2 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   
+   // SkyLight
+   Output.SkyDir    = mul(TangentSpace, float3(0,-1,0));
+   
+   
+   return( Output );
+   
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Skin_Normalmapping.program
===================================================================
--- modules/common/materials/programs/Normalmapping/Skin_Normalmapping.program	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Skin_Normalmapping.program	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,308 @@
+fragment_program Skin_Normalmapping_PS_HLSL hlsl
+{
+    source Skin_Normalmapping_PS.hlsl
+    entry_point ps_main
+    target ps_2_0
+}
+
+fragment_program Skin_Normalmapping_mirrored_PS_HLSL hlsl
+{
+    source Skin_Normalmapping_mirrored_PS.hlsl
+    entry_point ps_main
+    target ps_2_0
+}
+
+fragment_program Eye_Normalmapping_PS_HLSL hlsl
+{
+    source Eye_Normalmapping_PS.hlsl
+    entry_point ps_main
+    target ps_2_0
+}
+
+vertex_program Eye_Normalmapping_VS_HLSL hlsl
+{
+    source Eye_Normalmapping_VS.hlsl
+    entry_point vs_main
+    target vs_1_1
+}
+
+material Skin_Normalmapping
+{
+    technique hlsl
+    {
+        pass
+        {
+	        alpha_rejection greater 128
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Skin_Normalmapping_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named skycolor float4 0.6 0.6 0.6 1.0
+				param_named groundcolor float4 0.2 0.2 0.2 1.0
+                param_named SkinColor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+            
+            texture_unit LookupSkin
+            {
+                texture_alias LookupSkin
+                texture lookup_skin.png 1d
+                tex_address_mode clamp
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
+
+
+
+
+material Face_Normalmapping_mirrored
+{
+    technique hlsl
+    {
+        pass
+        {
+            vertex_program_ref Eye_Normalmapping_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named eyeDirection float3 0.0 1 0.0
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Eye_Normalmapping_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named skycolor float4 0.6 0.6 0.6 1.0
+				param_named groundcolor float4 0.2 0.2 0.2 1.0
+                param_named SpecColor float4 1.0 1.0 1.0 1.0
+                param_named SpecExp float 64.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias EyeDiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias EyeNormalMap
+            }
+            
+            texture_unit ShadowMap
+            {
+                texture_alias EyeShadowMap
+                texture men_eyeshadow.png
+            }
+        }
+        
+        pass
+        {
+	        alpha_rejection greater 128
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Skin_Normalmapping_mirrored_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named skycolor float4 0.6 0.6 0.6 1.0
+				param_named groundcolor float4 0.2 0.2 0.2 1.0
+                param_named SkinColor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+            
+            texture_unit LookupSkin
+            {
+                texture_alias LookupSkin
+                texture lookup_skin.png 1d
+                tex_address_mode clamp
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
+
+
+material Skin_Normalmapping_mirrored
+{
+    technique hlsl
+    {
+        pass
+        {
+	        alpha_rejection greater 128
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Skin_Normalmapping_mirrored_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named skycolor float4 0.6 0.6 0.6 1.0
+				param_named groundcolor float4 0.2 0.2 0.2 1.0
+                param_named SkinColor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+            
+            texture_unit LookupSkin
+            {
+                texture_alias LookupSkin
+                texture lookup_skin.png 1d
+                tex_address_mode clamp
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
\ No newline at end of file

Added: modules/common/materials/programs/Normalmapping/Skin_Normalmapping_PS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Skin_Normalmapping_PS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Skin_Normalmapping_PS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,72 @@
+uniform float4 LightColor_0;
+uniform float4 LightColor_1;
+uniform float4 LightColor_2;
+uniform float4 groundcolor;
+uniform float4 skycolor;
+uniform float4 SkinColor;
+uniform float SpecExp;
+uniform sampler2D DiffuseMap;
+uniform sampler2D NormalMap;
+uniform sampler2D SpecMap;
+uniform sampler1D LookupSkin;
+
+
+float4 ps_main(
+               float2 UV         : TEXCOORD0,
+               float4 LightDir_0 : TEXCOORD1,
+               float3 HalfVect_0 : TEXCOORD2,
+               float4 LightDir_1 : TEXCOORD3,
+               float3 HalfVect_1 : TEXCOORD4,
+               float4 LightDir_2 : TEXCOORD5,
+               float3 HalfVect_2 : TEXCOORD6,
+               float3 SkyDir     : TEXCOORD7
+               ) : COLOR0
+{ 
+
+   float3 normal = tex2D(NormalMap,UV).rgb *2 -1;
+   float4 ambient= lerp(skycolor , groundcolor, ((dot(normal, SkyDir) + 1.0)/2.0));
+
+   
+   
+   float specAttn;
+   float4 AngleAttn;
+   float4 AngleAttn1;
+   float4 AngleAttn2;
+   
+   AngleAttn= saturate(dot(normal,LightDir_0.xyz));
+   AngleAttn1= saturate(dot(normal,LightDir_1.xyz));
+   AngleAttn2= saturate(dot(normal,LightDir_2.xyz));
+   
+   float4 Diffuse;
+   
+   if (AngleAttn.r &gt; 0.0)
+   {
+      specAttn =LightColor_0 *  pow(clamp(dot(normal,normalize(HalfVect_0)),0,1),SpecExp)* LightDir_0.w;
+      AngleAttn = tex1D(LookupSkin, AngleAttn);
+      Diffuse = AngleAttn* LightColor_0 * LightDir_0.w;  
+   }
+   
+   if (AngleAttn1.r &gt; 0.0)
+   {
+      specAttn  +=LightColor_1 *  pow(clamp(dot(normal,normalize(HalfVect_1)),0,1),SpecExp)* LightDir_1.w;
+      AngleAttn1 = tex1D(LookupSkin, AngleAttn1);
+      Diffuse += AngleAttn1* LightColor_1 * LightDir_1.w;
+   }
+  
+   if (AngleAttn2.r &gt; 0.0)
+   {
+      specAttn  +=LightColor_2 *  pow(clamp(dot(normal,normalize(HalfVect_2)),0,1),SpecExp)* LightDir_2.w;
+      AngleAttn2 = tex1D(LookupSkin, AngleAttn2);
+      Diffuse += AngleAttn2* LightColor_2 * LightDir_2.w;
+   }
+  
+  
+   //float4 Diffuse = AngleAttn + AngleAttn1 + AngleAttn2;
+   float4 specular = tex2D(SpecMap, UV) * specAttn * (float(Diffuse.r + Diffuse.g + Diffuse.b)/3);
+   
+   
+   return (SkinColor-0.5 +(tex2D(DiffuseMap,UV))  * (ambient + Diffuse)) +specular;
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Skin_Normalmapping_mirrored_PS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Skin_Normalmapping_mirrored_PS.hlsl	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Skin_Normalmapping_mirrored_PS.hlsl	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,72 @@
+uniform float4 LightColor_0;
+uniform float4 LightColor_1;
+uniform float4 LightColor_2;
+uniform float4 groundcolor;
+uniform float4 skycolor;
+uniform float4 SkinColor;
+uniform float SpecExp;
+uniform sampler2D DiffuseMap;
+uniform sampler2D NormalMap;
+uniform sampler2D SpecMap;
+uniform sampler1D LookupSkin;
+
+
+float4 ps_main(
+               float2 UV         : TEXCOORD0,
+               float4 LightDir_0 : TEXCOORD1,
+               float3 HalfVect_0 : TEXCOORD2,
+               float4 LightDir_1 : TEXCOORD3,
+               float3 HalfVect_1 : TEXCOORD4,
+               float4 LightDir_2 : TEXCOORD5,
+               float3 HalfVect_2 : TEXCOORD6,
+               float3 SkyDir     : TEXCOORD7
+               ) : COLOR0
+{ 
+
+   float3 normal = tex2D(NormalMap,UV.xy).rgb *2 -1;
+   if (UV.x &gt; 1)
+   {
+	  normal = float3(normal.x, -normal.y, normal.z);
+   }
+   float4 ambient= lerp(skycolor , groundcolor, ((dot(normal, SkyDir) + 1.0)/2.0));
+
+   
+   
+   float specAttn;
+   float4 AngleAttn;
+   float4 AngleAttn1;
+   float4 AngleAttn2;
+   
+   AngleAttn= saturate(dot(normal,LightDir_0.xyz));
+   AngleAttn1= saturate(dot(normal,LightDir_1.xyz));
+   AngleAttn2= saturate(dot(normal,LightDir_2.xyz));
+   
+   float4 Diffuse;
+   
+
+      specAttn =LightColor_0 *  pow(clamp(dot(normal,normalize(HalfVect_0)),0,1),SpecExp)* LightDir_0.w;
+      AngleAttn = tex1D(LookupSkin, AngleAttn);
+      Diffuse = AngleAttn* LightColor_0 * LightDir_0.w;  
+   
+
+      specAttn  +=LightColor_1 *  pow(clamp(dot(normal,normalize(HalfVect_1)),0,1),SpecExp)* LightDir_1.w;
+      AngleAttn1 = tex1D(LookupSkin, AngleAttn1);
+      Diffuse += AngleAttn1* LightColor_1 * LightDir_1.w;
+
+  
+
+      specAttn  +=LightColor_2 *  pow(clamp(dot(normal,normalize(HalfVect_2)),0,1),SpecExp)* LightDir_2.w;
+      AngleAttn2 = tex1D(LookupSkin, AngleAttn2);
+      Diffuse += AngleAttn2* LightColor_2 * LightDir_2.w;
+
+  
+  
+   //float4 Diffuse = AngleAttn + AngleAttn1 + AngleAttn2;
+   float4 specular = tex2D(SpecMap, UV.xy) * specAttn * (float(Diffuse.r + Diffuse.g + Diffuse.b)/3);
+   float4 diffuseColor = (tex2D(DiffuseMap,UV.xy)) ;
+   
+   return float4(((SkinColor.rgb-0.5 + diffuseColor.rgb) * (ambient + Diffuse)) +specular.rgb , diffuseColor.a);
+}
+
+
+

Added: modules/common/materials/programs/Normalmapping/Torso_Normalmapping.program
===================================================================
--- modules/common/materials/programs/Normalmapping/Torso_Normalmapping.program	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/materials/programs/Normalmapping/Torso_Normalmapping.program	2007-08-16 20:18:12 UTC (rev 3695)
@@ -0,0 +1,250 @@
+material Torso_Normalmapping_Short
+{
+    technique hlsl
+    {
+        pass
+        {
+	        alpha_rejection greater 128
+	        
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Skin_Normalmapping_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named skycolor float4 0.6 0.6 0.6 1.0
+				param_named groundcolor float4 0.2 0.2 0.2 1.0
+                param_named SkinColor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit 
+            {
+                texture_alias DiffuseMapSkin
+            }
+
+            // Normal map
+            texture_unit 
+            {
+                texture_alias NormalMapSkin
+            }
+            
+            texture_unit 
+            {
+                texture_alias SpecMapSkin
+            }
+            
+            texture_unit LookupSkin
+            {
+                texture_alias LookupSkin
+                texture lookup_skin.png 1d
+                tex_address_mode clamp
+            }
+        }
+        
+        
+        pass
+        {
+	        alpha_rejection greater 128
+	        
+            vertex_program_ref Basic_Normalmapping_UV1_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_Spec_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named skycolor float4 0.6 0.6 0.6 1.0
+				param_named groundcolor float4 0.2 0.2 0.2 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit 
+            {
+                texture_alias DiffuseMapCloth
+            }
+
+            // Normal map
+            texture_unit 
+            {
+                texture_alias NormalMapCloth
+            }
+            
+            texture_unit 
+            {
+                texture_alias SpecMapCloth
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
+
+
+material Torso_Normalmapping_Long
+{
+    technique hlsl
+    {
+        pass
+        {
+	        alpha_rejection greater 128
+	        
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Skin_Normalmapping_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named skycolor float4 0.6 0.6 0.6 1.0
+				param_named groundcolor float4 0.2 0.2 0.2 1.0
+                param_named SkinColor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit 
+            {
+                texture_alias DiffuseMapSkin
+            }
+
+            // Normal map
+            texture_unit 
+            {
+                texture_alias NormalMapSkin
+            }
+            
+            texture_unit 
+            {
+                texture_alias SpecMapSkin
+            }
+            
+            texture_unit LookupSkin
+            {
+                texture_alias LookupSkin
+                texture lookup_skin.png 1d
+                tex_address_mode clamp
+            }
+        }
+        
+        
+        pass
+        {
+	        alpha_rejection greater 128
+	        
+            vertex_program_ref Basic_Normalmapping_UV2_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_Spec_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named skycolor float4 0.6 0.6 0.6 1.0
+				param_named groundcolor float4 0.2 0.2 0.2 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit
+            {
+                texture_alias DiffuseMapCloth
+            }
+
+            // Normal map
+            texture_unit 
+            {
+                texture_alias NormalMapCloth
+            }
+            
+            texture_unit 
+            {
+                texture_alias SpecMapCloth
+            }
+        }
+    }
+
+    technique fixed_function
+    {
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
\ No newline at end of file

Modified: modules/common/models/men_human_female.skeleton
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_armor_garethplatte.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_armor_kroetenhaut.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_backpack_leather_01.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_backpack_leather_01_smalll.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_feet_boots_01.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_hair_long_01_normal.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_hand_nude.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_head_02.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_leg_pants_01_long.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_torso.mesh
===================================================================
(Binary files differ)

Modified: modules/common/scripts/moduleconfig.rb
===================================================================
--- modules/common/scripts/moduleconfig.rb	2007-08-13 20:26:47 UTC (rev 3694)
+++ modules/common/scripts/moduleconfig.rb	2007-08-16 20:18:12 UTC (rev 3695)
@@ -10,7 +10,7 @@
     end
 
     def getTextureLocations()
-	return [&quot;alpha&quot;, &quot;env&quot;, &quot;model&quot;, &quot;programs&quot;, &quot;templates&quot;, &quot;tiled&quot;, &quot;particle&quot;]
+	return [&quot;alpha&quot;, &quot;env&quot;, &quot;model&quot;, &quot;programs&quot;, &quot;programs/Normalmapping&quot;, &quot;templates&quot;, &quot;tiled&quot;, &quot;particle&quot;]
     end
 
     def getSoundLocations()


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000765.html">[Dsa-hl-svn] r3694 - modules/common/gui/windows
</A></li>
	<LI>Next message: <A HREF="000767.html">[Dsa-hl-svn] r3696 - modules/common/models
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#766">[ date ]</a>
              <a href="thread.html#766">[ thread ]</a>
              <a href="subject.html#766">[ subject ]</a>
              <a href="author.html#766">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
