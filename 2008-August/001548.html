<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4491 - in rl/branches/newton20:	Mac/Rastullah.xcodeproj Mac/tools engine/ai/src	engine/core/src engine/rules/src engine/script/include	engine/script/src engine/ui/include engine/ui/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2008-August/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4491%20-%20in%20rl/branches/newton20%3A%0A%09Mac/Rastullah.xcodeproj%20Mac/tools%20engine/ai/src%0A%09engine/core/src%20engine/rules/src%20engine/script/include%0A%09engine/script/src%20engine/ui/include%20engine/ui/src&In-Reply-To=%3C200808281841.m7SIfrac031248%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001547.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4491 - in rl/branches/newton20:	Mac/Rastullah.xcodeproj Mac/tools engine/ai/src	engine/core/src engine/rules/src engine/script/include	engine/script/src engine/ui/include engine/ui/src</H1>
    <B>melven at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4491%20-%20in%20rl/branches/newton20%3A%0A%09Mac/Rastullah.xcodeproj%20Mac/tools%20engine/ai/src%0A%09engine/core/src%20engine/rules/src%20engine/script/include%0A%09engine/script/src%20engine/ui/include%20engine/ui/src&In-Reply-To=%3C200808281841.m7SIfrac031248%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4491 - in rl/branches/newton20:	Mac/Rastullah.xcodeproj Mac/tools engine/ai/src	engine/core/src engine/rules/src engine/script/include	engine/script/src engine/ui/include engine/ui/src">melven at mail.berlios.de
       </A><BR>
    <I>Thu Aug 28 20:41:53 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001547.html">[Dsa-hl-svn] r4490 - rl/trunk/Mac/Rastullah.xcodeproj
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1548">[ date ]</a>
              <a href="thread.html#1548">[ thread ]</a>
              <a href="subject.html#1548">[ subject ]</a>
              <a href="author.html#1548">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: melven
Date: 2008-08-28 20:41:29 +0200 (Thu, 28 Aug 2008)
New Revision: 4491

Modified:
   rl/branches/newton20/Mac/Rastullah.xcodeproj/project.pbxproj
   rl/branches/newton20/Mac/tools/renameinstalldirs.sh
   rl/branches/newton20/engine/ai/src/DialogImplication.cpp
   rl/branches/newton20/engine/core/src/ConfigurationManager.cpp
   rl/branches/newton20/engine/rules/src/CreatureController.cpp
   rl/branches/newton20/engine/rules/src/StandAroundMovement.cpp
   rl/branches/newton20/engine/rules/src/StepRecognitionMovement.cpp
   rl/branches/newton20/engine/script/include/PlaneNodeProcessor.h
   rl/branches/newton20/engine/script/src/PlaneNodeProcessor.cpp
   rl/branches/newton20/engine/ui/include/CombatControlState.h
   rl/branches/newton20/engine/ui/include/ItemDescriptionDragContainer.h
   rl/branches/newton20/engine/ui/include/ItemDragContainer.h
   rl/branches/newton20/engine/ui/include/ItemIconDragContainer.h
   rl/branches/newton20/engine/ui/include/WindowFadeJob.h
   rl/branches/newton20/engine/ui/src/CombatControlState.cpp
   rl/branches/newton20/engine/ui/src/ContainerContentWindow.cpp
   rl/branches/newton20/engine/ui/src/InventoryWindow.cpp
   rl/branches/newton20/engine/ui/src/ItemDescriptionDragContainer.cpp
   rl/branches/newton20/engine/ui/src/ItemDragContainer.cpp
   rl/branches/newton20/engine/ui/src/ItemIconDragContainer.cpp
   rl/branches/newton20/engine/ui/src/UiSubsystem.cpp
   rl/branches/newton20/engine/ui/src/WindowFadeJob.cpp
Log:
- merged changes from trunk
- fixed CEGUI-errors with the inventory-window and drag'n drop items
  Item*DragContainer now created with CEGUI::WindowManager and a CEGUI-
  window-factory (needs changes in modules/common/gui/windows/item*dragcontainer.xml
  ( -    &lt;Window Type=&quot;DefaultWindow&quot; Name=&quot;ItemDescriptionDragContainer&quot;&gt;
    +    &lt;Window Type=&quot;ItemDescriptionDragContainer&quot; Name=&quot;ItemDescriptionDragContainer&quot;&gt;
    and same with itemicondragcontainer.xml)
- fixed some errors in CreatureController and movements (StepRecognition now activated)
  TODO: use TriggerCollisions for StepRecognition
- implemented camera-movement in CombatControlState 
  TODO: camera-collision



Modified: rl/branches/newton20/Mac/Rastullah.xcodeproj/project.pbxproj
===================================================================
--- rl/branches/newton20/Mac/Rastullah.xcodeproj/project.pbxproj	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/Mac/Rastullah.xcodeproj/project.pbxproj	2008-08-28 18:41:29 UTC (rev 4491)
@@ -429,6 +429,7 @@
 		44D8147A0BF7B62F00534175 /* Trigger.h in Headers */ = {isa = PBXBuildFile; fileRef = 44D814750BF7B62F00534175 /* Trigger.h */; };
 		44D8147B0BF7B62F00534175 /* Zone.h in Headers */ = {isa = PBXBuildFile; fileRef = 44D814760BF7B62F00534175 /* Zone.h */; };
 		44D8147C0BF7B62F00534175 /* ZoneManager.h in Headers */ = {isa = PBXBuildFile; fileRef = 44D814770BF7B62F00534175 /* ZoneManager.h */; };
+		48003B550E3211660056D073 /* libboost_system.dylib in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
 		483646990D83D13700912FEC /* ContentLoader.h in Headers */ = {isa = PBXBuildFile; fileRef = 483646960D83D13700912FEC /* ContentLoader.h */; };
 		4836469A0D83D13700912FEC /* SoundStitching.h in Headers */ = {isa = PBXBuildFile; fileRef = 483646970D83D13700912FEC /* SoundStitching.h */; };
 		4836469B0D83D13700912FEC /* StartAnimationJob.h in Headers */ = {isa = PBXBuildFile; fileRef = 483646980D83D13700912FEC /* StartAnimationJob.h */; };
@@ -645,18 +646,23 @@
 		4890C0E30E18062B00BE5850 /* StrafeMovement.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 4890C0D50E18062B00BE5850 /* StrafeMovement.cpp */; };
 		4890C0E40E18062B00BE5850 /* WalkMovement.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 4890C0D60E18062B00BE5850 /* WalkMovement.cpp */; };
 		48A52B220E0EDA0E008DBDD8 /* libboost_filesystem.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52B210E0EDA0E008DBDD8 /* libboost_filesystem.dylib */; };
-		48A52CB00E0EF55C008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
-		48A52CB10E0EF55C008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
+		48A52CB00E0EF55C008DBDD8 /* libboost_system.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
+		48A52CB10E0EF55C008DBDD8 /* libboost_system.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
 		48A52CB30E0EF577008DBDD8 /* libboost_filesystem.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52B210E0EDA0E008DBDD8 /* libboost_filesystem.dylib */; };
 		48A52CB60E0EF5BD008DBDD8 /* ApplyDamageJob.h in Headers */ = {isa = PBXBuildFile; fileRef = 48A52CB50E0EF5BD008DBDD8 /* ApplyDamageJob.h */; };
 		48A52CB80E0EF5D0008DBDD8 /* ApplyDamageJob.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48A52CB70E0EF5D0008DBDD8 /* ApplyDamageJob.cpp */; };
-		48A52CBC0E0EF77B008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
-		48A52CBD0E0EF77B008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
-		48A52CBE0E0EF77C008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
-		48A52CBF0E0EF77C008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
-		48A52CC00E0EF77D008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
-		48A52CC20E0EF77E008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
-		48A52CC30E0EF785008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
+		48A52CBC0E0EF77B008DBDD8 /* libboost_system.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
+		48A52CBD0E0EF77B008DBDD8 /* libboost_system.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
+		48A52CBE0E0EF77C008DBDD8 /* libboost_system.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
+		48A52CBF0E0EF77C008DBDD8 /* libboost_system.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
+		48A52CC00E0EF77D008DBDD8 /* libboost_system.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
+		48A52CC20E0EF77E008DBDD8 /* libboost_system.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
+		48A52CC30E0EF785008DBDD8 /* libboost_system.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */; };
+		48B0B0350E6534690023B198 /* PlaneNodeProcessor.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48B0B0340E6534690023B198 /* PlaneNodeProcessor.cpp */; };
+		48B0B0370E6534810023B198 /* PlaneNodeProcessor.h in Headers */ = {isa = PBXBuildFile; fileRef = 48B0B0360E6534810023B198 /* PlaneNodeProcessor.h */; };
+		48B0B03C0E6535AB0023B198 /* libmeshmagick.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 440785DD0C09D231006E496D /* libmeshmagick.dylib */; };
+		48B0B0490E65BBB30023B198 /* libfmodex.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48B0B0480E65BBB30023B198 /* libfmodex.dylib */; };
+		48B0B04A0E65BBC10023B198 /* libfmodex.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 48B0B0480E65BBB30023B198 /* libfmodex.dylib */; };
 		48B5F63A0DAF48AF00D05C95 /* Info.plist in Resources */ = {isa = PBXBuildFile; fileRef = 8D0C4E960486CD37000505A6 /* Info.plist */; };
 		48B772DD0D58350B000A3B97 /* XmlProcessor.h in Headers */ = {isa = PBXBuildFile; fileRef = 48B772DA0D58350B000A3B97 /* XmlProcessor.h */; };
 		48B772DE0D58350B000A3B97 /* XmlPropertyReader.h in Headers */ = {isa = PBXBuildFile; fileRef = 48B772DB0D58350B000A3B97 /* XmlPropertyReader.h */; };
@@ -845,8 +851,9 @@
 			dstPath = &quot;&quot;;
 			dstSubfolderSpec = 10;
 			files = (
+				48003B550E3211660056D073 /* libboost_system.dylib in Copy Frameworks */,
+				48D0BDE60E23378700863824 /* libboost_filesystem.dylib in Copy Frameworks */,
 				48CFBF8F0E2E869000CD0C51 /* FreeType.framework in Copy Frameworks */,
-				48D0BDE60E23378700863824 /* libboost_filesystem.dylib in Copy Frameworks */,
 				48D0BDC70E23375E00863824 /* libruby.dylib in Copy Frameworks */,
 				484D92140E1E060200BCFC2B /* Xerces.framework in Copy Frameworks */,
 				484D92150E1E060200BCFC2B /* OIS.framework in Copy Frameworks */,
@@ -1466,9 +1473,12 @@
 		4890C0D50E18062B00BE5850 /* StrafeMovement.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = StrafeMovement.cpp; path = ../engine/rules/src/StrafeMovement.cpp; sourceTree = SOURCE_ROOT; };
 		4890C0D60E18062B00BE5850 /* WalkMovement.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = WalkMovement.cpp; path = ../engine/rules/src/WalkMovement.cpp; sourceTree = SOURCE_ROOT; };
 		48A52B210E0EDA0E008DBDD8 /* libboost_filesystem.dylib */ = {isa = PBXFileReference; lastKnownFileType = &quot;compiled.mach-o.dylib&quot;; name = libboost_filesystem.dylib; path = /usr/local/lib/libboost_filesystem.dylib; sourceTree = &quot;&lt;absolute&gt;&quot;; };
-		48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */ = {isa = PBXFileReference; lastKnownFileType = &quot;compiled.mach-o.dylib&quot;; name = libboost_system.lib; path = /usr/local/lib/libboost_system.lib; sourceTree = &quot;&lt;absolute&gt;&quot;; };
+		48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */ = {isa = PBXFileReference; lastKnownFileType = &quot;compiled.mach-o.dylib&quot;; name = libboost_system.dylib; path = /usr/local/lib/libboost_system.dylib; sourceTree = &quot;&lt;absolute&gt;&quot;; };
 		48A52CB50E0EF5BD008DBDD8 /* ApplyDamageJob.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = ApplyDamageJob.h; path = ../engine/rules/include/ApplyDamageJob.h; sourceTree = SOURCE_ROOT; };
 		48A52CB70E0EF5D0008DBDD8 /* ApplyDamageJob.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = ApplyDamageJob.cpp; path = ../engine/rules/src/ApplyDamageJob.cpp; sourceTree = SOURCE_ROOT; };
+		48B0B0340E6534690023B198 /* PlaneNodeProcessor.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = PlaneNodeProcessor.cpp; path = ../engine/script/src/PlaneNodeProcessor.cpp; sourceTree = SOURCE_ROOT; };
+		48B0B0360E6534810023B198 /* PlaneNodeProcessor.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = PlaneNodeProcessor.h; path = ../engine/script/include/PlaneNodeProcessor.h; sourceTree = SOURCE_ROOT; };
+		48B0B0480E65BBB30023B198 /* libfmodex.dylib */ = {isa = PBXFileReference; lastKnownFileType = &quot;compiled.mach-o.dylib&quot;; name = libfmodex.dylib; path = &quot;FMOD Programmers API/api/lib/libfmodex.dylib&quot;; sourceTree = SYSTEM_DEVELOPER_DIR; };
 		48B772DA0D58350B000A3B97 /* XmlProcessor.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = XmlProcessor.h; path = ../engine/common/include/XmlProcessor.h; sourceTree = SOURCE_ROOT; };
 		48B772DB0D58350B000A3B97 /* XmlPropertyReader.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = XmlPropertyReader.h; path = ../engine/common/include/XmlPropertyReader.h; sourceTree = SOURCE_ROOT; };
 		48B772DC0D58350B000A3B97 /* XmlPropertyWriter.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = XmlPropertyWriter.h; path = ../engine/common/include/XmlPropertyWriter.h; sourceTree = SOURCE_ROOT; };
@@ -1509,7 +1519,7 @@
 				444EAEBF0BD0F09900C6D4A0 /* CEGUI.framework in Frameworks */,
 				444EAEC00BD0F09900C6D4A0 /* Ogre.framework in Frameworks */,
 				4836CBCE0D8FB0BE002FE5D7 /* Xerces.framework in Frameworks */,
-				48A52CB00E0EF55C008DBDD8 /* libboost_system.lib in Frameworks */,
+				48A52CB00E0EF55C008DBDD8 /* libboost_system.dylib in Frameworks */,
 				484FE6BA0E17BC8800FA880F /* Carbon.framework in Frameworks */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
@@ -1526,7 +1536,7 @@
 				444EB0890BD1153500C6D4A0 /* OgreNewt.framework in Frameworks */,
 				440785DE0C09D231006E496D /* libmeshmagick.dylib in Frameworks */,
 				4836CBCD0D8FB0BE002FE5D7 /* Xerces.framework in Frameworks */,
-				48A52CB10E0EF55C008DBDD8 /* libboost_system.lib in Frameworks */,
+				48A52CB10E0EF55C008DBDD8 /* libboost_system.dylib in Frameworks */,
 				484FE6BC0E17BC8800FA880F /* Carbon.framework in Frameworks */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
@@ -1544,7 +1554,7 @@
 				444EB0D80BD1198B00C6D4A0 /* OgreNewt.framework in Frameworks */,
 				444EB0DB0BD119BB00C6D4A0 /* OpenSteer.framework in Frameworks */,
 				4836CBCC0D8FB0BE002FE5D7 /* Xerces.framework in Frameworks */,
-				48A52CBC0E0EF77B008DBDD8 /* libboost_system.lib in Frameworks */,
+				48A52CBC0E0EF77B008DBDD8 /* libboost_system.dylib in Frameworks */,
 				484FE6BD0E17BC8800FA880F /* Carbon.framework in Frameworks */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
@@ -1560,7 +1570,7 @@
 				444EB3410BD172BA00C6D4A0 /* CEGUI.framework in Frameworks */,
 				444EB3420BD172BA00C6D4A0 /* Ogre.framework in Frameworks */,
 				4836CBCB0D8FB0BE002FE5D7 /* Xerces.framework in Frameworks */,
-				48A52CBD0E0EF77B008DBDD8 /* libboost_system.lib in Frameworks */,
+				48A52CBD0E0EF77B008DBDD8 /* libboost_system.dylib in Frameworks */,
 				484FE6BE0E17BC8800FA880F /* Carbon.framework in Frameworks */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
@@ -1579,7 +1589,7 @@
 				444EB3730BD1784A00C6D4A0 /* OgreCEGUIRenderer.framework in Frameworks */,
 				4857E4E50D46A664009D376D /* OIS.framework in Frameworks */,
 				4836CBCA0D8FB0BE002FE5D7 /* Xerces.framework in Frameworks */,
-				48A52CBE0E0EF77C008DBDD8 /* libboost_system.lib in Frameworks */,
+				48A52CBE0E0EF77C008DBDD8 /* libboost_system.dylib in Frameworks */,
 				484FE6BF0E17BC8800FA880F /* Carbon.framework in Frameworks */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
@@ -1594,8 +1604,9 @@
 				48365BEC0D8D56DC00BF3313 /* libRlCommon.dylib in Frameworks */,
 				48365C950D8D56EA00BF3313 /* CEGUI.framework in Frameworks */,
 				4836CBCF0D8FB0BE002FE5D7 /* Xerces.framework in Frameworks */,
-				48A52CC30E0EF785008DBDD8 /* libboost_system.lib in Frameworks */,
+				48A52CC30E0EF785008DBDD8 /* libboost_system.dylib in Frameworks */,
 				484FE6C10E17BC8800FA880F /* Carbon.framework in Frameworks */,
+				48B0B0490E65BBB30023B198 /* libfmodex.dylib in Frameworks */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
@@ -1604,7 +1615,7 @@
 			buildActionMask = 2147483647;
 			files = (
 				483D87CE0D8C564400F3629E /* libRlScript.dylib in Frameworks */,
-				48A52CC00E0EF77D008DBDD8 /* libboost_system.lib in Frameworks */,
+				48A52CC00E0EF77D008DBDD8 /* libboost_system.dylib in Frameworks */,
 				484FE6C20E17BC8800FA880F /* Carbon.framework in Frameworks */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
@@ -1623,7 +1634,7 @@
 				48570C480D8A6E9900096E35 /* libRlRules.dylib in Frameworks */,
 				48570C490D8A6E9900096E35 /* libRlUi.dylib in Frameworks */,
 				4836CBC90D8FB0BE002FE5D7 /* Xerces.framework in Frameworks */,
-				48A52CBF0E0EF77C008DBDD8 /* libboost_system.lib in Frameworks */,
+				48A52CBF0E0EF77C008DBDD8 /* libboost_system.dylib in Frameworks */,
 				484FE6C00E17BC8800FA880F /* Carbon.framework in Frameworks */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
@@ -1644,7 +1655,7 @@
 				444EB7A00BD195E800C6D4A0 /* libRlUi.dylib in Frameworks */,
 				4836F8BC0D885AAA00E3632F /* libruby.dylib in Frameworks */,
 				48570E020D8A6F8300096E35 /* libRlScript.dylib in Frameworks */,
-				48A52CC20E0EF77E008DBDD8 /* libboost_system.lib in Frameworks */,
+				48A52CC20E0EF77E008DBDD8 /* libboost_system.dylib in Frameworks */,
 				484FE6BB0E17BC8800FA880F /* Carbon.framework in Frameworks */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
@@ -1671,6 +1682,7 @@
 		20286C29FDCF999611CA2CEA /* Rastullah */ = {
 			isa = PBXGroup;
 			children = (
+				48B0B0480E65BBB30023B198 /* libfmodex.dylib */,
 				20286C2AFDCF999611CA2CEA /* Sources */,
 				20286C2CFDCF999611CA2CEA /* Resources */,
 				20286C32FDCF999611CA2CEA /* External Frameworks and Libraries */,
@@ -1712,7 +1724,7 @@
 			children = (
 				48CFBF8E0E2E869000CD0C51 /* FreeType.framework */,
 				484FE6B90E17BC8800FA880F /* Carbon.framework */,
-				48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */,
+				48A52CAF0E0EF55C008DBDD8 /* libboost_system.dylib */,
 				48A52B210E0EDA0E008DBDD8 /* libboost_filesystem.dylib */,
 				4836CBC80D8FB0BE002FE5D7 /* Xerces.framework */,
 				4857E4E40D46A664009D376D /* OIS.framework */,
@@ -2294,42 +2306,9 @@
 		444EAE600BD0E66500C6D4A0 /* RlScript */ = {
 			isa = PBXGroup;
 			children = (
-				485B89570E15796500D5B19C /* Scene.cpp */,
-				485B89580E15796500D5B19C /* SceneLoader.cpp */,
-				485B89590E15796500D5B19C /* SceneManager.cpp */,
-				485B89510E15794A00D5B19C /* Scene.h */,
-				485B89520E15794A00D5B19C /* SceneLoader.h */,
-				485B89530E15794A00D5B19C /* SceneManager.h */,
-				48760AA90D92E4B700BEB57C /* RlExports_wrap.cxx */,
-				48760AAA0D92E4B700BEB57C /* RlExports_wrap.h */,
+				48B0B0230E6533940023B198 /* Headers */,
+				48B0B0240E6533A50023B198 /* Source */,
 				48389C010D86783200AFAB66 /* swig */,
-				48389C190D867AA900AFAB66 /* stdinc.cpp */,
-				4404DA840C48D01E007B4657 /* stdinc.h */,
-				446BF4810C4532B50013C214 /* UnifiedFactory.h */,
-				444825ED0BF7B32100C5A94F /* AbstractMapNodeProcessor.h */,
-				444825EE0BF7B32100C5A94F /* EntityNodeProcessor.h */,
-				444825EF0BF7B32100C5A94F /* EnvironmentProcessor.h */,
-				444825F00BF7B32100C5A94F /* GameObjectNodeProcessor.h */,
-				444825F10BF7B32100C5A94F /* LightNodeProcessor.h */,
-				444825F20BF7B32100C5A94F /* MapLoader.h */,
-				444825F30BF7B32100C5A94F /* ParticleSystemNodeProcessor.h */,
-				48389C1A0D867AA900AFAB66 /* TriggerFactory.cpp */,
-				444825F40BF7B32100C5A94F /* SoundNodeProcessor.h */,
-				444825F50BF7B32100C5A94F /* TriggerFactory.h */,
-				444825F60BF7B32100C5A94F /* WaypointProcessor.h */,
-				444825F70BF7B32100C5A94F /* ZoneProcessor.h */,
-				444825D90BF7B2B200C5A94F /* AbstractMapNodeProcessor.cpp */,
-				444825DA0BF7B2B200C5A94F /* EntityNodeProcessor.cpp */,
-				444825DB0BF7B2B200C5A94F /* EnvironmentProcessor.cpp */,
-				444825DC0BF7B2B200C5A94F /* GameObjectNodeProcessor.cpp */,
-				444825DD0BF7B2B200C5A94F /* LightNodeProcessor.cpp */,
-				444825DE0BF7B2B200C5A94F /* MapLoader.cpp */,
-				444825DF0BF7B2B200C5A94F /* ParticleSystemNodeProcessor.cpp */,
-				444825E00BF7B2B200C5A94F /* SoundNodeProcessor.cpp */,
-				444825E10BF7B2B200C5A94F /* WaypointProcessor.cpp */,
-				444825E20BF7B2B200C5A94F /* ZoneProcessor.cpp */,
-				444EAE670BD0E6D400C6D4A0 /* ScriptObjectMarker.cpp */,
-				444EAE680BD0E6D400C6D4A0 /* ScriptSubsystem.cpp */,
 				444EAE610BD0E6C000C6D4A0 /* ScriptObjectMarker.h */,
 				444EAE620BD0E6C000C6D4A0 /* ScriptPrerequisites.h */,
 				444EAE630BD0E6C000C6D4A0 /* ScriptSubsystem.h */,
@@ -2340,6 +2319,8 @@
 		48389C010D86783200AFAB66 /* swig */ = {
 			isa = PBXGroup;
 			children = (
+				48760AA90D92E4B700BEB57C /* RlExports_wrap.cxx */,
+				48760AAA0D92E4B700BEB57C /* RlExports_wrap.h */,
 				48500B780D906A1000EAD8DB /* RlScriptExportsMac.cpp */,
 				48389C020D86787900AFAB66 /* RlExports.i */,
 				48389BE80D8677EE00AFAB66 /* RlAi.head.swig */,
@@ -2408,6 +2389,55 @@
 			path = src;
 			sourceTree = &quot;&lt;group&gt;&quot;;
 		};
+		48B0B0230E6533940023B198 /* Headers */ = {
+			isa = PBXGroup;
+			children = (
+				444825ED0BF7B32100C5A94F /* AbstractMapNodeProcessor.h */,
+				444825EE0BF7B32100C5A94F /* EntityNodeProcessor.h */,
+				444825EF0BF7B32100C5A94F /* EnvironmentProcessor.h */,
+				444825F00BF7B32100C5A94F /* GameObjectNodeProcessor.h */,
+				444825F10BF7B32100C5A94F /* LightNodeProcessor.h */,
+				444825F20BF7B32100C5A94F /* MapLoader.h */,
+				444825F30BF7B32100C5A94F /* ParticleSystemNodeProcessor.h */,
+				48B0B0360E6534810023B198 /* PlaneNodeProcessor.h */,
+				485B89510E15794A00D5B19C /* Scene.h */,
+				485B89520E15794A00D5B19C /* SceneLoader.h */,
+				485B89530E15794A00D5B19C /* SceneManager.h */,
+				444825F40BF7B32100C5A94F /* SoundNodeProcessor.h */,
+				4404DA840C48D01E007B4657 /* stdinc.h */,
+				444825F50BF7B32100C5A94F /* TriggerFactory.h */,
+				446BF4810C4532B50013C214 /* UnifiedFactory.h */,
+				444825F60BF7B32100C5A94F /* WaypointProcessor.h */,
+				444825F70BF7B32100C5A94F /* ZoneProcessor.h */,
+			);
+			name = Headers;
+			sourceTree = &quot;&lt;group&gt;&quot;;
+		};
+		48B0B0240E6533A50023B198 /* Source */ = {
+			isa = PBXGroup;
+			children = (
+				444825D90BF7B2B200C5A94F /* AbstractMapNodeProcessor.cpp */,
+				444825DA0BF7B2B200C5A94F /* EntityNodeProcessor.cpp */,
+				444825DB0BF7B2B200C5A94F /* EnvironmentProcessor.cpp */,
+				444825DC0BF7B2B200C5A94F /* GameObjectNodeProcessor.cpp */,
+				444825DD0BF7B2B200C5A94F /* LightNodeProcessor.cpp */,
+				444825DE0BF7B2B200C5A94F /* MapLoader.cpp */,
+				444825DF0BF7B2B200C5A94F /* ParticleSystemNodeProcessor.cpp */,
+				48B0B0340E6534690023B198 /* PlaneNodeProcessor.cpp */,
+				485B89570E15796500D5B19C /* Scene.cpp */,
+				485B89580E15796500D5B19C /* SceneLoader.cpp */,
+				485B89590E15796500D5B19C /* SceneManager.cpp */,
+				444EAE670BD0E6D400C6D4A0 /* ScriptObjectMarker.cpp */,
+				444EAE680BD0E6D400C6D4A0 /* ScriptSubsystem.cpp */,
+				444825E00BF7B2B200C5A94F /* SoundNodeProcessor.cpp */,
+				48389C190D867AA900AFAB66 /* stdinc.cpp */,
+				48389C1A0D867AA900AFAB66 /* TriggerFactory.cpp */,
+				444825E10BF7B2B200C5A94F /* WaypointProcessor.cpp */,
+				444825E20BF7B2B200C5A94F /* ZoneProcessor.cpp */,
+			);
+			name = Source;
+			sourceTree = &quot;&lt;group&gt;&quot;;
+		};
 		48CFBFD60E2E87A800CD0C51 /* Scripts */ = {
 			isa = PBXGroup;
 			children = (
@@ -2779,6 +2809,7 @@
 				485B89540E15794A00D5B19C /* Scene.h in Headers */,
 				485B89550E15794A00D5B19C /* SceneLoader.h in Headers */,
 				485B89560E15794A00D5B19C /* SceneManager.h in Headers */,
+				48B0B0370E6534810023B198 /* PlaneNodeProcessor.h in Headers */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
@@ -2995,11 +3026,13 @@
 			isa = PBXResourcesBuildPhase;
 			buildActionMask = 2147483647;
 			files = (
+				48B0B03C0E6535AB0023B198 /* libmeshmagick.dylib in Resources */,
 				484D921E0E1E078100BCFC2B /* libRlCommon.dylib in Resources */,
 				484D921F0E1E078100BCFC2B /* libRlCore.dylib in Resources */,
 				484D92200E1E078100BCFC2B /* libRlAi.dylib in Resources */,
 				484D92210E1E078100BCFC2B /* libRlRules.dylib in Resources */,
 				484D92220E1E078100BCFC2B /* libRlUi.dylib in Resources */,
+				48B0B04A0E65BBC10023B198 /* libfmodex.dylib in Resources */,
 				484D92230E1E078100BCFC2B /* libRlScript.dylib in Resources */,
 				484D92240E1E078100BCFC2B /* libRlFmod4Driver.dylib in Resources */,
 				484D92250E1E078100BCFC2B /* RlScript.bundle in Resources */,
@@ -3366,6 +3399,7 @@
 				485B895A0E15796500D5B19C /* Scene.cpp in Sources */,
 				485B895B0E15796500D5B19C /* SceneLoader.cpp in Sources */,
 				485B895C0E15796500D5B19C /* SceneManager.cpp in Sources */,
+				48B0B0350E6534690023B198 /* PlaneNodeProcessor.cpp in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
@@ -3538,7 +3572,7 @@
 				OTHER_LDFLAGS = &quot;-pthread&quot;;
 				PREBINDING = NO;
 				PRODUCT_NAME = libRlCommon;
-				ZERO_LINK = YES;
+				ZERO_LINK = NO;
 			};
 			name = Debug;
 		};
@@ -3609,7 +3643,7 @@
 				OTHER_LDFLAGS = &quot;&quot;;
 				PREBINDING = NO;
 				PRODUCT_NAME = libRlCore;
-				ZERO_LINK = YES;
+				ZERO_LINK = NO;
 			};
 			name = Debug;
 		};
@@ -3688,7 +3722,7 @@
 				OTHER_LDFLAGS = &quot;&quot;;
 				PREBINDING = NO;
 				PRODUCT_NAME = libRlAi;
-				ZERO_LINK = YES;
+				ZERO_LINK = NO;
 			};
 			name = Debug;
 		};
@@ -3761,7 +3795,7 @@
 				PREBINDING = NO;
 				PRODUCT_NAME = libRlRules;
 				SHARED_PRECOMPS_DIR = &quot;&quot;;
-				ZERO_LINK = YES;
+				ZERO_LINK = NO;
 			};
 			name = Debug;
 		};
@@ -3835,7 +3869,7 @@
 				);
 				PREBINDING = NO;
 				PRODUCT_NAME = libRlUi;
-				ZERO_LINK = YES;
+				ZERO_LINK = NO;
 			};
 			name = Debug;
 		};
@@ -3898,12 +3932,16 @@
 				);
 				HEADER_SEARCH_PATHS_QUOTED_FOR_TARGET_1 = &quot;\&quot;/Developer/FMOD Programmers API/api/inc\&quot;&quot;;
 				INSTALL_PATH = &quot;@executable_path/../Resources&quot;;
-				LIBRARY_SEARCH_PATHS = &quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1)&quot;;
+				LIBRARY_SEARCH_PATHS = (
+					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1)&quot;,
+					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_2)&quot;,
+				);
 				LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1 = &quot;\&quot;/Developer/FMOD Programmers API/api/lib\&quot;&quot;;
+				LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_2 = &quot;\&quot;$(DEVELOPER_DIR)/FMOD Programmers API/api/lib\&quot;&quot;;
 				OTHER_LDFLAGS = &quot;-lfmodex&quot;;
 				PREBINDING = NO;
 				PRODUCT_NAME = RlFmod4Driver;
-				ZERO_LINK = YES;
+				ZERO_LINK = NO;
 			};
 			name = Debug;
 		};
@@ -3926,8 +3964,12 @@
 				);
 				HEADER_SEARCH_PATHS_QUOTED_FOR_TARGET_1 = &quot;\&quot;/Developer/FMOD Programmers API/api/inc\&quot;&quot;;
 				INSTALL_PATH = &quot;@executable_path/../Resources&quot;;
-				LIBRARY_SEARCH_PATHS = &quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1)&quot;;
+				LIBRARY_SEARCH_PATHS = (
+					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1)&quot;,
+					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_2)&quot;,
+				);
 				LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1 = &quot;\&quot;/Developer/FMOD Programmers API/api/lib\&quot;&quot;;
+				LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_2 = &quot;\&quot;$(DEVELOPER_DIR)/FMOD Programmers API/api/lib\&quot;&quot;;
 				OTHER_LDFLAGS = &quot;-lfmodex&quot;;
 				PREBINDING = NO;
 				PRODUCT_NAME = RlFmod4Driver;
@@ -3961,7 +4003,7 @@
 				MACH_O_TYPE = mh_bundle;
 				PREBINDING = NO;
 				PRODUCT_NAME = RlScript;
-				ZERO_LINK = YES;
+				ZERO_LINK = NO;
 			};
 			name = Debug;
 		};
@@ -4026,7 +4068,7 @@
 				MACH_O_TYPE = mh_dylib;
 				PREBINDING = NO;
 				PRODUCT_NAME = RlScript;
-				ZERO_LINK = YES;
+				ZERO_LINK = NO;
 			};
 			name = Debug;
 		};
@@ -4088,10 +4130,12 @@
 					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1)&quot;,
 					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_2)&quot;,
 					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_3)&quot;,
+					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_4)&quot;,
 				);
 				LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1 = &quot;\&quot;$(SRCROOT)/build/Debug\&quot;&quot;;
 				LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_2 = &quot;\&quot;$(SYSTEM_LIBRARY_DIR)/Frameworks/Ruby.framework/Versions/1.8/usr/lib\&quot;&quot;;
 				LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_3 = &quot;\&quot;$(SRCROOT)/build/Debug\&quot;&quot;;
+				LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_4 = &quot;\&quot;$(DEVELOPER_DIR)/FMOD Programmers API/api/lib\&quot;&quot;;
 				PRODUCT_NAME = Rastullah;
 				WRAPPER_EXTENSION = app;
 				ZERO_LINK = YES;
@@ -4119,10 +4163,12 @@
 					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_1)&quot;,
 					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_2)&quot;,
 					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_3)&quot;,
+					&quot;$(LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1)&quot;,
 				);
 				LIBRARY_SEARCH_PATHS_QUOTED_1 = &quot;\&quot;$(SRCROOT)/build/Debug\&quot;&quot;;
 				LIBRARY_SEARCH_PATHS_QUOTED_2 = &quot;\&quot;$(SYSTEM_LIBRARY_DIR)/Frameworks/Ruby.framework/Versions/1.8/usr/lib\&quot;&quot;;
 				LIBRARY_SEARCH_PATHS_QUOTED_3 = &quot;\&quot;$(SRCROOT)/build/Debug\&quot;&quot;;
+				LIBRARY_SEARCH_PATHS_QUOTED_FOR_TARGET_1 = &quot;\&quot;$(DEVELOPER_DIR)/FMOD Programmers API/api/lib\&quot;&quot;;
 				PRODUCT_NAME = Rastullah;
 				WRAPPER_EXTENSION = app;
 			};
@@ -4154,6 +4200,7 @@
 				);
 				PREBINDING = NO;
 				SDKROOT = /Developer/SDKs/MacOSX10.4u.sdk;
+				ZERO_LINK = NO;
 			};
 			name = Debug;
 		};

Modified: rl/branches/newton20/Mac/tools/renameinstalldirs.sh
===================================================================
--- rl/branches/newton20/Mac/tools/renameinstalldirs.sh	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/Mac/tools/renameinstalldirs.sh	2008-08-28 18:41:29 UTC (rev 4491)
@@ -1,23 +1,29 @@
-#!/bin/sh
+#!/bin/bash
 RASTULLAH_APP_DIR=$1
 RASTULLAH_APP_NAME=$2
 RASTULLAH_APP_BIN=${RASTULLAH_APP_DIR}/${RASTULLAH_APP_NAME}
 CEGUI_BIN=${RASTULLAH_APP_DIR}/../Frameworks/CEGUI.framework/CEGUI
+RASTULLAH_RES_DIR=$1/../Resources
 
 #TODO: Replace the absolute source paths to something with olist -L $RASTULLAH_APP_NAME and grep
 
 echo Changing library installation directories for $RASTULLAH_APP_NAME
 
+RL_BINARIES=&quot;$RASTULLAH_APP_BIN $RASTULLAH_RES_DIR/libRlAi.dylib $RASTULLAH_RES_DIR/libRlCommon.dylib $RASTULLAH_RES_DIR/libRlCore.dylib $RASTULLAH_RES_DIR/libRlRules.dylib $RASTULLAH_RES_DIR/libRlScript.dylib $RASTULLAH_RES_DIR/libRlUi.dylib $RASTULLAH_RES_DIR/libRlFmod4Driver.dylib&quot;
 # RL Application binary
-install_name_tool -change /Library/Frameworks/CEGUI.framework/Versions/A/CEGUI @executable_path/../Frameworks/CEGUI.framework/Versions/A/CEGUI $RASTULLAH_APP_BIN
-install_name_tool -change libboost_system-mt-1_35.dylib @executable_path/../Frameworks/libboost_system-mt-1_35.dylib $RASTULLAH_APP_BIN
-install_name_tool -change /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/libruby.1.dylib @executable_path/../Frameworks/libruby.1.dylib $RASTULLAH_APP_BIN
-install_name_tool -change /Users/blakharaz/Library/Frameworks/OgreNewt.framework/Versions/A/OgreNewt @executable_path/../Frameworks/OgreNewt.framework/Versions/A/OgreNewt $RASTULLAH_APP_BIN
-install_name_tool -change /Users/blakharaz/Library/Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer @executable_path/../Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer $RASTULLAH_APP_BIN
+for cur in $RL_BINARIES 
+do
+    echo Processing $cur
+    install_name_tool -change /Library/Frameworks/CEGUI.framework/Versions/A/CEGUI @executable_path/../Frameworks/CEGUI.framework/Versions/A/CEGUI $cur
+    install_name_tool -change libboost_system-mt-1_35.dylib @executable_path/../Frameworks/libboost_system.dylib $cur
+    install_name_tool -change /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/libruby.1.dylib @executable_path/../Frameworks/libruby.1.dylib $cur
+    install_name_tool -change /Users/blakharaz/Library/Frameworks/OgreNewt.framework/Versions/A/OgreNewt @executable_path/../Frameworks/OgreNewt.framework/Versions/A/OgreNewt $cur
+    install_name_tool -change /Users/blakharaz/Library/Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer @executable_path/../Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer $cur
+    install_name_tool -change /usr/local/bin/libmeshmagick.dylib @executable_path/../Resources/libmeshmagick.dylib $cur
+done
 
 # CEGUI
 install_name_tool -change /Library/Frameworks/CEGUI.framework/Versions/A/CEGUI @executable_path/../Frameworks/CEGUI.framework/Versions/A/CEGUI ${CEGUI_BIN}
 install_name_tool -change /Library/Frameworks/FreeType.framework/Versions/2.3/FreeType @executable_path/../Frameworks/FreeType.framework/Versions/2.3/FreeType ${CEGUI_BIN}
 
-
 echo done.
\ No newline at end of file

Modified: rl/branches/newton20/engine/ai/src/DialogImplication.cpp
===================================================================
--- rl/branches/newton20/engine/ai/src/DialogImplication.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ai/src/DialogImplication.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -48,7 +48,7 @@
         dialog-&gt;setProperty(mVariableName, prop);
     }
 
-        DialogVariableIncrease::DialogVariableIncrease(const Ogre::String&amp; variableName, 
+	DialogVariableIncrease::DialogVariableIncrease(const Ogre::String&amp; variableName, 
                                                    const CeGuiString&amp; value)
         : DialogVariableAssignment(variableName, value)
     {

Modified: rl/branches/newton20/engine/core/src/ConfigurationManager.cpp
===================================================================
--- rl/branches/newton20/engine/core/src/ConfigurationManager.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/core/src/ConfigurationManager.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -286,6 +286,7 @@
         addPlugin(&quot;RenderSystem_GL&quot;, mOgrePluginDirectory);
         addPlugin(&quot;Plugin_ParticleFX&quot;, mOgrePluginDirectory);
         addPlugin(&quot;Plugin_OctreeSceneManager&quot;, mOgrePluginDirectory);
+		addPlugin(&quot;Plugin_CgProgramManager&quot;, mOgrePluginDirectory);
 
         // Load the module list
         ConfigFile* configfile = new ConfigFile();

Modified: rl/branches/newton20/engine/rules/src/CreatureController.cpp
===================================================================
--- rl/branches/newton20/engine/rules/src/CreatureController.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/rules/src/CreatureController.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -446,7 +446,8 @@
 //oss &lt;&lt; &quot;  \t Tangent-Directions: &quot; &lt;&lt; vec1 &lt;&lt; &quot; &quot; &lt;&lt; vec2;
 //LOG_MESSAGE(Logger::RULES, oss.str());
 
-        setContactFrictionState(0,0);
+        rotateTangentDirections(/*charOri*mDirection + */Vector3::UNIT_Y);
+        setContactFrictionState(1,0);
         setContactFrictionState(0,1);
 
         if( stepHeight &lt; 0.4 )
@@ -456,15 +457,14 @@
                                    // too high means the creature stops if moving slowly onto a step because of the friction
             {
                 //setContactNormalAcceleration(5);
-                rotateTangentDirections(charOri*mDirection + Vector3::UNIT_Y);
                 setContactTangentAcceleration(5,0);
-                setContactFrictionState(1,0);
-                setContactFrictionState(1,1);
+                //setContactFrictionState(1,0);
+                //setContactFrictionState(1,1);
             }
             else
             {
-                setContactFrictionState(1,0);
-                setContactFrictionState(1,1);
+                //setContactFrictionState(1,0);
+                //setContactFrictionState(1,1);
             }
             //setContactElasticity(0.0f);
         }
@@ -474,13 +474,13 @@
             vel = mCreature-&gt;getActor()-&gt;getPhysicalThing()-&gt;getVelocity();
             if( vel.y &gt;= 0 )
             {
-                setContactFrictionState(1,0);
-                setContactFrictionState(1,1);    
+                //setContactFrictionState(1,0);
+                //setContactFrictionState(1,1);    
             }
             else
             {
-                setContactFrictionState(0,0);
-                setContactFrictionState(0,1);
+                //setContactFrictionState(0,0);
+                //setContactFrictionState(0,1);
             }
         }
 

Modified: rl/branches/newton20/engine/rules/src/StandAroundMovement.cpp
===================================================================
--- rl/branches/newton20/engine/rules/src/StandAroundMovement.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/rules/src/StandAroundMovement.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -44,14 +44,14 @@
     {
         AbstractMovement::activate();
         getRotationMovement()-&gt;activate();
-        //getStepRecognitionMovement()-&gt;activate();
+        getStepRecognitionMovement()-&gt;activate();
     }
 
     void StandAroundMovement::deactivate()
     {
         AbstractMovement::deactivate();
         getRotationMovement()-&gt;deactivate();
-        //getStepRecognitionMovement()-&gt;deactivate();
+        getStepRecognitionMovement()-&gt;deactivate();
     }
 
     bool StandAroundMovement::calculateBaseVelocity(Real &amp;velocity)
@@ -89,7 +89,7 @@
         // (changing direction during slow movement makes char slide sideways)
         force.y = 0;
 
-        //getStepRecognitionMovement()-&gt;calculateForceAndTorque(force, torque, timestep);
+        getStepRecognitionMovement()-&gt;calculateForceAndTorque(force, torque, timestep);
     }
 
     bool StandAroundMovement::run(Ogre::Real elapsedTime,  Ogre::Vector3 direction, Ogre::Vector3 rotation)
@@ -104,9 +104,9 @@
         if( getRotationMovement()-&gt;isPossible() )
             if( getRotationMovement()-&gt;run(elapsedTime, direction, rotation) )
                 ret = true;
-        //if( getStepRecognitionMovement()-&gt;isPossible() )
-        //    if (getStepRecognitionMovement()-&gt;run(elapsedTime, direction, rotation) )
-        //        ret = true;
+        if( getStepRecognitionMovement()-&gt;isPossible() )
+            if (getStepRecognitionMovement()-&gt;run(elapsedTime, direction, rotation) )
+                ret = true;
         return ret;
     }
 

Modified: rl/branches/newton20/engine/rules/src/StepRecognitionMovement.cpp
===================================================================
--- rl/branches/newton20/engine/rules/src/StepRecognitionMovement.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/rules/src/StepRecognitionMovement.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -21,6 +21,8 @@
 using namespace Ogre;
 
 
+/// @todo: use TriggerVolumes
+// void NewtonCollisionSetAsTriggerVolume(const NewtonCollision* convexCollision, int trigger);
 
 
 namespace rl

Modified: rl/branches/newton20/engine/script/include/PlaneNodeProcessor.h
===================================================================
--- rl/branches/newton20/engine/script/include/PlaneNodeProcessor.h	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/script/include/PlaneNodeProcessor.h	2008-08-28 18:41:29 UTC (rev 4491)
@@ -28,8 +28,8 @@
 
 #include &quot;AbstractMapNodeProcessor.h&quot;
 
-#include &lt;OgreMaterial.h&gt;
-#include &lt;OgreRenderTargetListener.h&gt;
+//#include &lt;OgreMaterial.h&gt;
+//#include &lt;OgreRenderTargetListener.h&gt;
 
 namespace rl
 {

Modified: rl/branches/newton20/engine/script/src/PlaneNodeProcessor.cpp
===================================================================
--- rl/branches/newton20/engine/script/src/PlaneNodeProcessor.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/script/src/PlaneNodeProcessor.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -23,7 +23,7 @@
 #include &quot;PhysicsManager.h&quot;
 #include &quot;World.h&quot;
 
-#include &lt;OgreMaterialManager.h&gt;
+//#include &lt;OgreMaterialManager.h&gt;
 
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
@@ -90,19 +90,20 @@
 			entName = getRandomName(&quot;Plane&quot;);
 		}
 
-		SceneNode* node = getRootSceneNode()-&gt;createChildSceneNode(entName, position, orientation);
+		SceneNode* node = getRootSceneNode()-&gt;createChildSceneNode(entName + &quot;Node&quot;, position, orientation);
 
-		Plane* plane = new MovablePlane(entName);
+		MovablePlane* plane = new MovablePlane(entName + &quot;Plane&quot;);
 		plane-&gt;d = 0;
 		plane-&gt;normal = Vector3::UNIT_Y;
 
-		MeshManager::getSingleton().createPlane(entName, &quot;custom&quot;, *plane, scale.x, scale.y, 10, 10, true, 1, 1, 1, Vector3::UNIT_Z);
+		MeshManager::getSingleton().createPlane(entName + &quot;Mesh&quot;, &quot;custom&quot;, *plane, scale.x, scale.y, 10, 10, true, 1, 1, 1, Vector3::UNIT_Z);
 
-		Entity* ent = CoreSubsystem::getSingleton().getWorld()-&gt;getSceneManager()-&gt;createEntity(entName, entName);
+		Entity* ent = CoreSubsystem::getSingleton().getWorld()-&gt;getSceneManager()-&gt;createEntity(entName, entName + &quot;Mesh&quot;);
 
 		LOG_DEBUG(Logger::RULES, &quot; Loaded plane &quot;+entName);
 
 		node-&gt;attachObject(ent);
+		node-&gt;attachObject(plane);
 		//node-&gt;scale(scale.x,1,scale.y);
 
 		createCollision(ent, getChildNamed(nodeElem, &quot;physicsproxy&quot;));
@@ -169,9 +170,12 @@
 			return;
 
 		Camera* cam = CoreSubsystem::getSingleton().getWorld()-&gt;getSceneManager()-&gt;createCamera(&quot;Cam&quot; + entity-&gt;getName());
+		cam-&gt;setNearClipDistance(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getNearClipDistance());
+        cam-&gt;setFarClipDistance(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getFarClipDistance());
+		cam-&gt;setAutoAspectRatio(true);
 		cam-&gt;setFOVy(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getFOVy());
 		cam-&gt;enableCustomNearClipPlane((MovablePlane*)plane);
-		//MeshPtr mesh = entity-&gt;getMesh();
+
 		AliasTextureNamePairList aliases;
 
 		if(getAttributeValueAsBool(rttElem, &quot;reflection&quot;))
@@ -181,18 +185,11 @@
 				512, 512, 0, PF_R8G8B8, TU_RENDERTARGET );
 			RenderTexture* rttTex = texture-&gt;getBuffer()-&gt;getRenderTarget();
 
-			Viewport *v = rttTex-&gt;addViewport( cam ); //Bleibt die Kamera immer die gleiche?
+			Viewport *v = rttTex-&gt;addViewport( cam );
 			v-&gt;setOverlaysEnabled(false);
 			rttTex-&gt;addListener(new PlaneReflectionTextureListener(entity, cam, plane));
 			
 			aliases[&quot;reflection&quot;] = &quot;Reflection&quot; + entity-&gt;getName();
-			/*int num = mesh-&gt;getNumSubMeshes();
-			for(int i = 0; i &lt; mesh-&gt;getNumSubMeshes(); i++)
-			{
-				SubMesh* sub = mesh-&gt;getSubMesh(i);
-				sub-&gt;addTextureAlias(&quot;reflection&quot;, &quot;Reflection&quot; + entity-&gt;getName());
-			}
-			mesh-&gt;updateMaterialForAllSubMeshes();*/
 		}
 		if(getAttributeValueAsBool(rttElem, &quot;refraction&quot;))
 		{
@@ -206,11 +203,6 @@
 			rttTex-&gt;addListener(new PlaneRefractionTextureListener(entity, cam));
 
 			aliases[&quot;refraction&quot;] = &quot;Refraction&quot; + entity-&gt;getName();
-			/*for(int i = 0; i &lt; mesh-&gt;getNumSubMeshes(); i++)
-			{
-				SubMesh* sub = mesh-&gt;getSubMesh(i);
-				sub-&gt;addTextureAlias(&quot;refraction&quot;, &quot;Refraction&quot; + entity-&gt;getName());
-			}*/
 		}
 		if(!material-&gt;applyTextureAliases(aliases))
 			LOG_ERROR(&quot;PLANE&quot;, &quot;Texture Aliase konnten nicht angewandt werden&quot;);

Modified: rl/branches/newton20/engine/ui/include/CombatControlState.h
===================================================================
--- rl/branches/newton20/engine/ui/include/CombatControlState.h	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/include/CombatControlState.h	2008-08-28 18:41:29 UTC (rev 4491)
@@ -22,6 +22,8 @@
 #include &quot;ControlState.h&quot;
 #include &quot;Combatant.h&quot;
 #include &quot;MessagePump.h&quot;
+#include &quot;PhysicsController.h&quot;
+#include &quot;PhysicsGenericContactCallback.h&quot;
 #include &quot;Selector.h&quot;
 
 
@@ -32,7 +34,11 @@
     class CombatGui;
     class CombatManager;
 
-	class _RlUiExport CombatControlState : public ControlState, public Combatant
+	class _RlUiExport CombatControlState :
+            public ControlState,
+            public Combatant,
+            public PhysicsController,
+            public PhysicsGenericContactCallback
 	{
 	public:
 		/**
@@ -46,6 +52,8 @@
 
         virtual void pause();
         virtual void resume();
+        virtual bool keyPressed(const OIS::KeyEvent&amp; evt, bool handled);
+        virtual bool keyReleased(const OIS::KeyEvent&amp; evt, bool handled);
 
 		void run(Ogre::Real elapsedTime);
 
@@ -54,6 +62,14 @@
         virtual Ogre::String getCombatantTypeName() const;
         virtual void requestCombatantAction();
 
+
+        // camera collision: OgreNewt::ContactCallback overides
+        int OnAABBOverlap(int threadIndex);
+        int userProcess(Ogre::Real timestep, int threadIndex);
+
+        // camera movement: Newton force and torque callback
+        void OnApplyForceAndTorque(PhysicalThing *pt, float timstep);
+
     private:
 		enum State {REQUEST_USER_INPUT, ROUND_EXECUTION};
 
@@ -74,6 +90,17 @@
         CameraObject* mCamera;
 
 		State mState;
+        // Camera:
+        Ogre::Degree mCameraYaw, mCameraPitch;
+        Ogre::Real mMaxCameraDistance, mMinCameraDistance;
+        int mMovementState;
+        Ogre::Real mCameraLinearDampingK, mCameraLinearSpringK;
+
+        // Camera helper functions
+        void resetCamera();
+        void updateCameraLookAt(Ogre::Real timestep);
+        Ogre::Vector3 getCombatCenterPosition();
+        Ogre::Vector3 calculateOptimalCameraPosition();
         
         // Event handlers
 		bool userRequestAttackOpponent(Combatant*);

Modified: rl/branches/newton20/engine/ui/include/ItemDescriptionDragContainer.h
===================================================================
--- rl/branches/newton20/engine/ui/include/ItemDescriptionDragContainer.h	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/include/ItemDescriptionDragContainer.h	2008-08-28 18:41:29 UTC (rev 4491)
@@ -25,9 +25,17 @@
 	class ItemDescriptionDragContainer : public ItemDragContainer
 	{
 	public:
-		ItemDescriptionDragContainer(Item* item, const CeGuiString&amp; name);
+		ItemDescriptionDragContainer(const CeGuiString &amp;type, const CeGuiString&amp; name);
+                void setItem(Item*);
+                static const CeGuiString WidgetTypeName; // for CEGUI
 	};
 
 } // namespace rl
+namespace CEGUI{
 
+    using rl::ItemDescriptionDragContainer;
+
+    CEGUI_DECLARE_WINDOW_FACTORY(ItemDescriptionDragContainer)
+}
+
 #endif //__ItemDescriptionDragContainer_H__

Modified: rl/branches/newton20/engine/ui/include/ItemDragContainer.h
===================================================================
--- rl/branches/newton20/engine/ui/include/ItemDragContainer.h	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/include/ItemDragContainer.h	2008-08-28 18:41:29 UTC (rev 4491)
@@ -18,6 +18,7 @@
 
 #include &quot;UiPrerequisites.h&quot;
 
+#include &lt;CEGUI.h&gt;
 #include &lt;elements/CEGUIDragContainer.h&gt;
 
 namespace rl 
@@ -41,6 +42,7 @@
 		const CeGuiString&amp; getItemParentSlot() const;
 		Inventory* getItemParentInventory() const;
 		Item* getItem() const;
+                virtual void setItem(Item*); // can only be used once to initialize the Container
 		CEGUI::Window* getContentWindow() const;
 	
 		bool _handleItemMouseClick(const CEGUI::EventArgs&amp; evt, Item* item);
@@ -49,13 +51,15 @@
         bool fadeOutAndHide(Ogre::Real delay);
         bool stopFadeOut();
 
-        void destroyWindow(); // this is internally done with a windowfadejob to prevent problems
+        virtual void destroy(void); // inherited from CEGUI::WINDOW
 
-        void setDestroyListener(ItemDragContainerDestroyListener *listener) {mDestroyListener = listener;}
+        //void destroyWindow(); // this is internally done with a windowfadejob to prevent problems
+
+        void setDestroyListener(ItemDragContainerDestroyListener *listener);
 	protected:
 		CEGUI::Window* mContentWindow;
 		
-		ItemDragContainer(Item* item, const CeGuiString&amp; name);
+		ItemDragContainer(const CeGuiString &amp;type, const CeGuiString&amp; name);
 		virtual bool testClassName_impl(const CEGUI::String&amp; class_name) const;
 
 	private:
@@ -71,7 +75,17 @@
     class ItemDragContainerDestroyListener
     {
     public:
+        ItemDragContainerDestroyListener();
+        virtual ~ItemDragContainerDestroyListener();
         virtual void notifyItemDragContainerDestroyed(ItemDragContainer* cont) = 0;
+    protected:
+        void addDragContainer(ItemDragContainer* dragcont);
+        void removeDragContainer(ItemDragContainer* dragcont);
+        friend class ItemDragContainer;
+    private:
+        typedef std::map&lt;CeGuiString, ItemDragContainer*&gt; DndContainerMap;
+        DndContainerMap mContainers;
+        bool mIsDestroying;
     };
 
 } // namespace rl

Modified: rl/branches/newton20/engine/ui/include/ItemIconDragContainer.h
===================================================================
--- rl/branches/newton20/engine/ui/include/ItemIconDragContainer.h	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/include/ItemIconDragContainer.h	2008-08-28 18:41:29 UTC (rev 4491)
@@ -27,9 +27,19 @@
 	class ItemIconDragContainer : public ItemDragContainer
 	{
 	public:
-		ItemIconDragContainer(Item* item, const CeGuiString&amp; name);
+		ItemIconDragContainer(const CeGuiString &amp;type, const CeGuiString&amp; name);
+                void setItem(Item* item);
+                static const CeGuiString WidgetTypeName; // for CEGUI
 	};
 
 } // namespace rl
 
+namespace CEGUI{
+
+    using rl::ItemIconDragContainer;
+
+    CEGUI_DECLARE_WINDOW_FACTORY(ItemIconDragContainer)
+
+}
+
 #endif //__ItemIconDragContainer_H__

Modified: rl/branches/newton20/engine/ui/include/WindowFadeJob.h
===================================================================
--- rl/branches/newton20/engine/ui/include/WindowFadeJob.h	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/include/WindowFadeJob.h	2008-08-28 18:41:29 UTC (rev 4491)
@@ -40,8 +40,8 @@
             Ogre::Real targetAlpha = 1.0f, Ogre::Real changeRate = 4.0f);
         WindowFadeJob(CEGUI::Window* window, Mode mode, 
             Ogre::Real targetAlpha = 1.0f, Ogre::Real changeRate = 4.0f);
-        WindowFadeJob(ItemDragContainer* window, Mode mode, 
-            Ogre::Real targetAlpha = 1.0f, Ogre::Real changeRate = 4.0f);
+        //WindowFadeJob(ItemDragContainer* window, Mode mode, 
+        //    Ogre::Real targetAlpha = 1.0f, Ogre::Real changeRate = 4.0f);
 
         virtual bool execute(Ogre::Real time);
         virtual void discard();
@@ -49,7 +49,7 @@
     protected:
         AbstractWindow* mAbstractWindow;
         CEGUI::Window* mCEGUIWindow;
-        ItemDragContainer* mItemDragContainer;
+        //ItemDragContainer* mItemDragContainer;
         Mode mMode;
         Ogre::Real mChangeRate;
         Ogre::Real mCurrentAlpha;

Modified: rl/branches/newton20/engine/ui/src/CombatControlState.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/CombatControlState.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/src/CombatControlState.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -22,6 +22,7 @@
 #include &quot;Combat.h&quot;
 #include &quot;CombatGui.h&quot;
 #include &quot;CombatManager.h&quot;
+#include &quot;CommandMapper.h&quot;
 #include &quot;CoreSubsystem.h&quot;
 #include &quot;Creature.h&quot;
 #include &quot;CreatureController.h&quot;
@@ -49,7 +50,14 @@
           mEnemySelector(CoreSubsystem::getSingleton().getWorld()-&gt;getSceneManager(),
             QUERYFLAG_CREATURE),
           mCamera(NULL),
-		  mState(ROUND_EXECUTION)
+		  mState(ROUND_EXECUTION),
+          mCameraYaw(0),
+          mCameraPitch(60), // the same value as in resetCamera
+          mMovementState(0),
+          mCameraLinearSpringK(100.0f),
+          mCameraLinearDampingK(Math::NEG_INFINITY),
+          mMaxCameraDistance(30.0f),
+          mMinCameraDistance(5.0f)
     {
         CreatureSelectionFilter* filter = new CreatureSelectionFilter();
         filter-&gt;setAlignmentMask(Creature::ALIGNMENT_ENEMY);
@@ -74,6 +82,11 @@
 
         mCamera = static_cast&lt;CameraObject*&gt;(mCameraActor-&gt;getControlledObject());
 		mCombatGui = new CombatGui(mCombat, mCamera);
+
+
+        // calculate camera spring-damping system coefficients
+        Real relationCoefficient = 0.8f;
+        mCameraLinearDampingK = relationCoefficient * 2.0 * Math::Sqrt(mCameraLinearSpringK);
     }
 
 	CombatControlState::~CombatControlState()
@@ -85,9 +98,43 @@
 
     void CombatControlState::resume()
     {
-        mCameraActor-&gt;getPhysicalThing()-&gt;freeze();
-        mCharacterActor-&gt;getPhysicalThing()-&gt;freeze();
+        // control camera
+        mCameraActor-&gt;getPhysicalThing()-&gt;setMaterialID(
+        PhysicsManager::getSingleton().getMaterialID(&quot;camera&quot;));
+        mCameraActor-&gt;getPhysicalThing()-&gt;unfreeze();
+        mCameraActor-&gt;getPhysicalThing()-&gt;setPhysicsController(this);
+        mCameraActor-&gt;getPhysicalThing()-&gt;setUpConstraint(Vector3::ZERO);
+        
+        // We also handle cam&lt;-&gt;level, cam&lt;-&gt;default cam&lt;-&gt;char collision from now on
+        OgreNewt::MaterialPair* mat_pair = NULL;
+        mat_pair = PhysicsManager::getSingleton().createMaterialPair(
+            PhysicsManager::getSingleton().getMaterialID(&quot;camera&quot;),
+            PhysicsManager::getSingleton().getMaterialID(&quot;default&quot;));
+        mat_pair-&gt;setContactCallback(this);
+        mat_pair-&gt;setDefaultCollidable(1);
+        mat_pair-&gt;setDefaultFriction(0,0);
+        mat_pair-&gt;setDefaultFriction(0,1);
+        mat_pair = PhysicsManager::getSingleton().createMaterialPair(
+            PhysicsManager::getSingleton().getMaterialID(&quot;camera&quot;),
+            PhysicsManager::getSingleton().getMaterialID(&quot;level&quot;));
+        mat_pair-&gt;setContactCallback(this);
+        mat_pair-&gt;setDefaultCollidable(1);
+        mat_pair-&gt;setDefaultFriction(0,0);
+        mat_pair-&gt;setDefaultFriction(0,1);
+        mat_pair = PhysicsManager::getSingleton().createMaterialPair(
+            PhysicsManager::getSingleton().getMaterialID(&quot;camera&quot;),
+            PhysicsManager::getSingleton().getMaterialID(&quot;character&quot;));
+        mat_pair-&gt;setContactCallback(this);
+        mat_pair-&gt;setDefaultCollidable(1);
+        mat_pair-&gt;setDefaultFriction(0,0);
+        mat_pair-&gt;setDefaultFriction(0,1);
 
+        // reset camera
+        //resetCamera(); // if you don't call this here, the camera should smoothly move to the new position -&gt; looks nicer
+        // perhaps this should be handled differently!
+        mMovementState = 0;
+
+
         ///\todo Richtig machen, nur tempor&#228;r Ani hier setzen.
         static_cast&lt;MeshObject*&gt;(mCharacterActor-&gt;getControlledObject())
             -&gt;startAnimation(&quot;kampf_schwerter_idle&quot;);
@@ -123,20 +170,202 @@
 
     void CombatControlState::pause()
     {
-		mCombatGui-&gt;hide();
+        mCombatGui-&gt;hide();
 
-        mCameraActor-&gt;getPhysicalThing()-&gt;unfreeze();
-        mCharacterActor-&gt;getPhysicalThing()-&gt;unfreeze();
+
+        // stop controlling camera actor
+        mCameraActor-&gt;getPhysicalThing()-&gt;setPhysicsController(NULL);
+        mCameraActor-&gt;getPhysicalThing()-&gt;freeze();
+        // cam&lt;-&gt;Level collision back to default
+        PhysicsManager::getSingleton().resetMaterialPair(
+            PhysicsManager::getSingleton().getMaterialID(&quot;camera&quot;),
+            PhysicsManager::getSingleton().getMaterialID(&quot;default&quot;));
+        // cam&lt;-&gt;Default collision back to default
+        PhysicsManager::getSingleton().resetMaterialPair(
+            PhysicsManager::getSingleton().getMaterialID(&quot;camera&quot;),
+            PhysicsManager::getSingleton().getMaterialID(&quot;level&quot;));
+        PhysicsManager::getSingleton().resetMaterialPair(
+            PhysicsManager::getSingleton().getMaterialID(&quot;camera&quot;),
+            PhysicsManager::getSingleton().getMaterialID(&quot;character&quot;));
+
         static_cast&lt;MeshObject*&gt;(mCharacterActor-&gt;getControlledObject())-&gt;stopAllAnimations();
 
         mCombat-&gt;pause();
     }
 
-	void CombatControlState::run(Ogre::Real elapsedTime)
+    bool CombatControlState::keyPressed(const OIS::KeyEvent&amp; evt, bool handled)
     {
-		mCombatGui-&gt;update();
+        bool retval = false;
+        if( !handled )
+        {
+            int movement = mCommandMapper-&gt;getMovement(evt.key);
+            mMovementState |= movement;
+            
+            if( movement != MOVE_NONE )
+                retval = true;
+        }
+
+        if( ControlState::keyPressed(evt, handled || retval) )
+            retval = true;
+
+        return retval;
     }
+     
+    bool CombatControlState::keyReleased(const OIS::KeyEvent&amp; evt, bool handled)
+    {
+        bool retval = false;
+        int movement = mCommandMapper-&gt;getMovement(evt.key);
+        if( movement != MOVE_NONE )
+        {
+            mMovementState &amp;= (~movement);
+            retval = true;
+        }
 
+        if( ControlState::keyReleased(evt, handled || retval) )
+            retval = true;
+        return retval;
+    }
+
+    void CombatControlState::run(Ogre::Real elapsedTime)
+    {
+        // update CombatGui
+        mCombatGui-&gt;update();
+
+
+
+        // update camera look-at position
+        updateCameraLookAt(elapsedTime);
+
+        if( mMovementState &amp; MOVE_RIGHT )
+            mCameraYaw += Degree( 360.0/10.0 * elapsedTime );
+        if( mMovementState &amp; MOVE_LEFT )
+            mCameraYaw -= Degree( 360.0/10.0 * elapsedTime );
+
+    }
+
+    void CombatControlState::resetCamera(void)
+    {
+        mCameraYaw = Degree(0);
+        mCameraPitch = Degree(50);
+        mCameraActor-&gt;setPosition(calculateOptimalCameraPosition());
+    }
+
+    void CombatControlState::updateCameraLookAt(Real elapsedTime)
+    {
+        Vector3 combatCenter = getCombatCenterPosition();
+        SceneNode* cameraNode = mCameraActor-&gt;_getSceneNode();
+
+        cameraNode-&gt;lookAt(combatCenter + 2*Vector3::UNIT_Y, Node::TS_WORLD);
+    }
+
+    Vector3 CombatControlState::getCombatCenterPosition()
+    {
+        // get the center of all persons (allies and opponents)
+        int n = 0;
+        Vector3 pos = Vector3::ZERO;
+
+        const Combat::CombatantSet &amp;allies (mCombat-&gt;getAllAllies() );
+        for(Combat::CombatantSet::iterator it = allies.begin(); it != allies.end(); it++)
+        {
+            pos += (*it)-&gt;getCreature()-&gt;getPosition();
+            n++;
+        }
+
+        const Combat::CombatantSet &amp;opponents (mCombat-&gt;getAllOpponents());
+        for(Combat::CombatantSet::iterator it = opponents.begin(); it != opponents.end(); it++)
+        {
+            pos += (*it)-&gt;getCreature()-&gt;getPosition();
+            n++;
+        }
+
+        if( n &gt; 0 )
+            pos /= n;
+        else
+        {
+            pos = mCharacter-&gt;getPosition();
+        }
+
+        return pos;
+    }
+    
+    Vector3 CombatControlState::calculateOptimalCameraPosition()
+    {
+        Vector3 center = getCombatCenterPosition();
+
+        // get the greatest distance from center from all persons
+        Real distance = 0;
+        const Combat::CombatantSet &amp;allies (mCombat-&gt;getAllAllies() );
+        for(Combat::CombatantSet::iterator it = allies.begin(); it != allies.end(); it++)
+        {
+            distance = std::max( ( (*it)-&gt;getCreature()-&gt;getPosition() - center ).length(), distance );
+        }
+        const Combat::CombatantSet &amp;opponents = mCombat-&gt;getAllOpponents();
+        for(Combat::CombatantSet::iterator it = opponents.begin(); it != opponents.end(); it++)
+        {
+            distance = std::max( ( (*it)-&gt;getCreature()-&gt;getPosition() - center ).length(), distance );
+        }
+        distance+=2;
+
+
+        // put camera on the line player-center far enough to see all persons
+        // if player is &quot;exactly&quot; in the center, use player orientation as fallback orientation
+        // + rotation from mCameraYaw
+        Vector3 playerPos = mCharacter-&gt;getPosition();
+        Vector3 diff = playerPos - center;
+        diff.y = 0;
+        Quaternion camYaw;
+        camYaw.FromAngleAxis(mCameraYaw, Vector3::UNIT_Y);
+        if( diff.squaredLength() &lt; 0.01 )
+        {
+            diff = mCharacterActor-&gt;getOrientation()*Vector3::UNIT_Z;
+        }
+        diff.y = 0;
+        diff.normalise();
+        diff = camYaw*diff;
+        diff.y = Math::Tan(mCameraPitch.valueRadians());
+
+        distance = std::max( distance,  mMinCameraDistance*Math::Cos(mCameraPitch.valueRadians()) );
+        distance = std::min( distance,  mMaxCameraDistance*Math::Cos(mCameraPitch.valueRadians()) );
+            
+        Vector3 camPos = center + distance*diff;
+        return camPos;
+    }
+
+    void CombatControlState::OnApplyForceAndTorque(PhysicalThing* thing, float timestep)
+    {
+        Vector3 camPos;
+        Quaternion camOri;
+        mCamBody-&gt;getPositionOrientation(camPos, camOri);
+
+        Vector3 optimalCamPos = calculateOptimalCameraPosition();
+
+
+        Vector3 diff = camPos - optimalCamPos;
+        Vector3 cameraVelocity;
+        cameraVelocity = mCamBody-&gt;getVelocity();
+        // spring velocity
+        Vector3 springAcc = -mCameraLinearSpringK*diff - mCameraLinearDampingK * cameraVelocity;
+                                            
+        // get the camera mass
+        Real mass;
+        Vector3 inertia;
+        mCamBody-&gt;getMassMatrix(mass, inertia);
+                                                
+        mCamBody-&gt;setForce(springAcc * mass);
+    }
+
+    int CombatControlState::OnAABBOverlap(int threadIndex)
+    {
+        // TODO handle camera collisions here
+        return 0;
+    }
+   
+    int CombatControlState::userProcess(Ogre::Real timestep, int threadIndex)
+    {
+        // TODO handle camera collisions here
+        return 0;
+    }
+
     Ogre::String CombatControlState::getCombatantTypeName() const
     {
         return &quot;CombatControlState&quot;;

Modified: rl/branches/newton20/engine/ui/src/ContainerContentWindow.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/ContainerContentWindow.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/src/ContainerContentWindow.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -72,7 +72,7 @@
 
 		if (evtArgs.dragDropItem-&gt;testClassName(&quot;ItemDragContainer&quot;))
 		{
-			ItemDragContainer* dragcont = static_cast&lt;ItemDragContainer*&gt;(
+			ItemDragContainer* dragcont = dynamic_cast&lt;ItemDragContainer*&gt;(
 				evtArgs.dragDropItem);
 			Item* item = dragcont-&gt;getItem();
 
@@ -158,7 +158,7 @@
 
 		if (evtArgs.dragDropItem-&gt;testClassName(&quot;ItemDragContainer&quot;))
 		{
-			ItemDragContainer* dragcont = static_cast&lt;ItemDragContainer*&gt;(
+			ItemDragContainer* dragcont = dynamic_cast&lt;ItemDragContainer*&gt;(
 				evtArgs.dragDropItem);
 			Item* item = dragcont-&gt;getItem();
 
@@ -179,7 +179,8 @@
             {
                 if( dragcont != getItemWindow(item) )
                 {
-                    dragcont-&gt;destroyWindow();
+                    CEGUI::WindowManager::getSingleton().destroyWindow(dragcont);
+                    //dragcont-&gt;destroyWindow();
                     dragcont = createItemWindow(item);
                     mContentWindow-&gt;addChildWindow(dragcont);
                 }
@@ -211,8 +212,11 @@
 			mWindow-&gt;getName() +  &quot;/item/&quot;
 			+ Ogre::StringConverter::toString(item-&gt;getId())+&quot;_DragContainer&quot;;
 
-		itemhandler = new ItemIconDragContainer(item,
-			dragContainerName);
+                itemhandler = dynamic_cast&lt;ItemIconDragContainer*&gt;(
+                    AbstractWindow::loadWindow(&quot;itemicondragcontainer.xml&quot;, dragContainerName));
+                    //CEGUI::WindowManager::getSingleton().createWindow(&quot;ItemIconDragContainer&quot;, dragContainerName));
+                itemhandler-&gt;setItem(item);
+		//itemhandler = new ItemIconDragContainer(item, dragContainerName);
         itemhandler-&gt;setDestroyListener(this);
         mItemDragContainerMap.insert(std::make_pair(item, itemhandler));
 		itemhandler-&gt;setItemParent(mContainer);

Modified: rl/branches/newton20/engine/ui/src/InventoryWindow.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/InventoryWindow.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/src/InventoryWindow.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -23,6 +23,7 @@
 #include &lt;CEGUIWindowManager.h&gt;
 #include &lt;elements/CEGUIFrameWindow.h&gt;
 
+#include &quot;AbstractWindow.h&quot;
 #include &quot;Actor.h&quot;
 #include &quot;ActorManager.h&quot;
 #include &quot;CameraObject.h&quot;
@@ -214,10 +215,19 @@
 		else
 		{
 			if (showdescription)
-				itemhandler = new ItemDescriptionDragContainer(item, dragContainerName);
+                        {
+				itemhandler = dynamic_cast&lt;ItemDescriptionDragContainer*&gt; (
+                                        AbstractWindow::loadWindow(&quot;itemdescriptiondragcontainer.xml&quot;, dragContainerName));
+                                //new ItemDescriptionDragContainer(item, dragContainerName);
+                                itemhandler-&gt;setItem(item);
+                        }
 			else
             {
-				itemhandler = new ItemIconDragContainer(item, dragContainerName);
+				itemhandler = dynamic_cast&lt;ItemIconDragContainer*&gt; (
+                                        AbstractWindow::loadWindow(&quot;itemicondragcontainer.xml&quot;, dragContainerName));
+                                    //CEGUI::WindowManager::getSingleton().createWindow(&quot;ItemIconDragContainer&quot;, dragContainerName));
+                                itemhandler-&gt;setItem(item);
+				//itemhandler = new ItemIconDragContainer(item, dragContainerName);
                 itemhandler-&gt;setTooltipText(item-&gt;getName());
             }
 
@@ -287,20 +297,14 @@
 
 			if (mInventory-&gt;canHold(item, targetSlot))
 			{
-				if (dragcont-&gt;getItemParentContainer() != NULL)
-				{
-					dragcont-&gt;getParent()-&gt;removeChildWindow(dragcont);
-				}
-				else if (dragcont-&gt;getItemParentSlot() != &quot;&quot;)
-				{
-					dragcont-&gt;getParent()-&gt;removeChildWindow(dragcont);
-				}
+				dragcont-&gt;getParent()-&gt;removeChildWindow(dragcont);
 
 				ItemDragContainer* newCont = createItemDragContainer(item, false, targetSlot);
 
 				if (newCont)
 				{
-                    dragcont-&gt;destroyWindow();
+                                    CEGUI::WindowManager::getSingleton().destroyWindow(dragcont);
+//                    dragcont-&gt;destroyWindow();
 				}
 				else
 				{
@@ -413,7 +417,8 @@
 				-1);
 
 
-            dragcont-&gt;destroyWindow();
+                        CEGUI::WindowManager::getSingleton().destroyWindow(dragcont);
+//            dragcont-&gt;destroyWindow();
 
 			Ogre::Vector3 targetPosWorldSpace =
 				mInventory-&gt;getOwner()-&gt;getPosition()

Modified: rl/branches/newton20/engine/ui/src/ItemDescriptionDragContainer.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/ItemDescriptionDragContainer.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/src/ItemDescriptionDragContainer.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -22,10 +22,34 @@
 #include &quot;AbstractWindow.h&quot;
 #include &quot;Item.h&quot;
 
+
+
+namespace CEGUI
+{
+    CEGUI_DEFINE_WINDOW_FACTORY(ItemDescriptionDragContainer)
+}
+
 namespace rl {
-	ItemDescriptionDragContainer::ItemDescriptionDragContainer(Item* item, const CeGuiString&amp; name)
-		: ItemDragContainer(item, name)
+
+    const CeGuiString ItemDescriptionDragContainer::WidgetTypeName(&quot;ItemDescriptionDragContainer&quot;);
+
+
+
+
+	ItemDescriptionDragContainer::ItemDescriptionDragContainer(const CeGuiString &amp;type, const CeGuiString&amp; name)
+		: ItemDragContainer(type, name)
 	{
+		CeGuiString prefix = name;
+
+		mContentWindow = this; //AbstractWindow::loadWindow(&quot;itemdescriptiondragcontainer.xml&quot;, prefix);
+		addChildWindow(mContentWindow);
+                mContentWindow-&gt;setDestroyedByParent(true);
+	}
+
+        void ItemDescriptionDragContainer::setItem(Item* item)
+        {
+            ItemDragContainer::setItem(item);
+
 		CeGuiString icon = item-&gt;getImageName();
 
 		if (icon == &quot;&quot;)
@@ -33,19 +57,20 @@
 			icon = ICON_UNKNOWN_ITEM;
 		}
 
-		CeGuiString prefix = name;
-		mContentWindow = AbstractWindow::loadWindow(&quot;itemdescriptiondragcontainer.xml&quot;, prefix);
+                const CeGuiString &amp;name = getName();
 
+
 		mContentWindow-&gt;getChild(
-			name+&quot;ItemDescriptionDragContainer/Icon&quot;)
+			name+&quot;/Icon&quot;)
 			-&gt;setProperty(&quot;Image&quot;, icon);
 		mContentWindow-&gt;getChild(
-			name+&quot;ItemDescriptionDragContainer/Name&quot;)
+			name+&quot;/Name&quot;)
 			-&gt;setText(item-&gt;getName());
 		mContentWindow-&gt;getChild(
-			name+&quot;ItemDescriptionDragContainer/Description&quot;)
+			name+&quot;/Description&quot;)
 			-&gt;setText(item-&gt;getDescription());
 
+
 		mContentWindow-&gt;subscribeEvent(
 			Window::EventMouseClick,
 			boost::bind(&amp;ItemDragContainer::_handleItemMouseClick, this, _1, item));
@@ -54,7 +79,8 @@
 			Window::EventMouseDoubleClick,
 			boost::bind(&amp;ItemDragContainer::_handleItemDoubleClick, this, _1, item));
 
-		setSize(mContentWindow-&gt;getSize());
-		addChildWindow(mContentWindow);
-	}
+
+
+	    setSize(mContentWindow-&gt;getSize());
+        }
 }

Modified: rl/branches/newton20/engine/ui/src/ItemDragContainer.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/ItemDragContainer.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/src/ItemDragContainer.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -31,9 +31,9 @@
 namespace rl {
 	const Ogre::String ItemDragContainer::ICON_UNKNOWN_ITEM = &quot;set:ModelThumbnails image:item_unknown&quot;;
 
-	ItemDragContainer::ItemDragContainer(Item* item, const CeGuiString&amp; name)
-		: CEGUI::DragContainer(&quot;DragContainer&quot;, name),
-		mItem(item),
+	ItemDragContainer::ItemDragContainer(const CeGuiString &amp;type, const CeGuiString&amp; name)
+		: CEGUI::DragContainer(type, name),
+		mItem(NULL),
 		mParentContainer(NULL),
 		mParentSlot(&quot;&quot;),
 		mContentWindow(NULL),
@@ -43,10 +43,28 @@
 	{
 	}
 
-	ItemDragContainer::~ItemDragContainer()
+        void ItemDragContainer::setItem(Item* item)
+        {
+            if( mItem != NULL )
+                Throw(IllegalArgumentException,&quot;The item of an ItemDragContainer can only be set once!&quot;);
+            mItem = item;
+        }
+
+        ItemDragContainer::~ItemDragContainer()
+        {
+            if(mDestroyListener)
+                mDestroyListener-&gt;notifyItemDragContainerDestroyed(this);
+            setDestroyListener(NULL);
+        }
+
+	void ItemDragContainer::destroy()
 	{
-        if(mDestroyListener)
-            mDestroyListener-&gt;notifyItemDragContainerDestroyed(this);
+            if(mDestroyListener)
+                mDestroyListener-&gt;notifyItemDragContainerDestroyed(this);
+            setDestroyListener(NULL);
+
+            CEGUI::DragContainer::destroy();
+/*        
         stopFadeOut();
 
         hide();
@@ -59,8 +77,9 @@
 		removeChildWindow(mContentWindow);
 		CEGUI::WindowManager::getSingleton().destroyWindow(mContentWindow);
         CEGUI::WindowManager::getSingleton().destroyWindow(this);
+*/
 	}
-
+/*
     void ItemDragContainer::destroyWindow()
     {
         if(mDestroyListener)
@@ -80,7 +99,7 @@
             JobScheduler::JP_NORMAL,
             0.0f);
     }
-
+*/
 	void ItemDragContainer::setItemParent(Container* container)
 	{
 		mParentContainer = container;
@@ -179,4 +198,65 @@
 
         return true;
     }
+
+    void ItemDragContainer::setDestroyListener(ItemDragContainerDestroyListener *listener)
+    {
+        if( listener == mDestroyListener )
+            return ;
+
+        if( mDestroyListener )
+            mDestroyListener-&gt;removeDragContainer(this);
+
+        mDestroyListener = listener;
+
+        if( listener )
+            mDestroyListener-&gt;addDragContainer(this);
+    }
+
+
+    ItemDragContainerDestroyListener::ItemDragContainerDestroyListener() : mIsDestroying(false)
+    {
+    }
+
+    ItemDragContainerDestroyListener::~ItemDragContainerDestroyListener()
+    {
+        // remove all dragContainers from list
+        mIsDestroying = true;
+        for( DndContainerMap::iterator it = mContainers.begin(); it != mContainers.end(); it++ )
+            it-&gt;second-&gt;setDestroyListener(NULL);
+    }
+
+    void ItemDragContainerDestroyListener::addDragContainer(ItemDragContainer *dragcont)
+    {
+        if( dragcont == NULL )
+            Throw(NullPointerException, &quot;Parameter dragcont in ItemDragContainerDestroyListener::addDragContainer should not be NULL!&quot;);
+
+        DndContainerMap::iterator it = mContainers.find(dragcont-&gt;getName());
+        if( it != mContainers.end() )
+        {
+            Throw(IllegalArgumentException, &quot;ItemDragContainerDestroyListener::addDragContainer: ItemDragContainer with name '&quot;+
+                    dragcont-&gt;getName()+&quot;' already added!&quot;);
+        }
+
+        mContainers.insert(std::make_pair(dragcont-&gt;getName(), dragcont));
+    }
+
+    void ItemDragContainerDestroyListener::removeDragContainer(ItemDragContainer *dragcont)
+    {
+        if( mIsDestroying )  // if this Listener is destroyed, we don't need to care about the list
+            return ;
+
+        if( dragcont == NULL )
+            Throw(NullPointerException, &quot;Parameter dragcont in ItemDragContainerDestroyListener::removeDragContainer should not be NULL!&quot;);
+
+        DndContainerMap::iterator it = mContainers.find(dragcont-&gt;getName());
+        if( it == mContainers.end() )
+        {
+            Throw(IllegalArgumentException, &quot;ItemDragContainerDestroyListener::removeDragContainer: ItemDragContainer with name '&quot;+
+                    dragcont-&gt;getName()+&quot;' was not added before!&quot;);
+        }
+
+        mContainers.erase(it);
+   }
+
 }

Modified: rl/branches/newton20/engine/ui/src/ItemIconDragContainer.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/ItemIconDragContainer.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/src/ItemIconDragContainer.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -22,26 +22,49 @@
 #include &quot;AbstractWindow.h&quot;
 #include &quot;Item.h&quot;
 
+namespace CEGUI{
+    CEGUI_DEFINE_WINDOW_FACTORY(ItemIconDragContainer)
+}
 namespace rl {
-	ItemIconDragContainer::ItemIconDragContainer(Item* item, const CeGuiString&amp; name)
-		: ItemDragContainer(item, name)
+
+    const CeGuiString ItemIconDragContainer::WidgetTypeName(&quot;ItemIconDragContainer&quot;);
+
+
+
+	ItemIconDragContainer::ItemIconDragContainer(const CeGuiString &amp;type, const CeGuiString&amp; name)
+		: ItemDragContainer(type, name)
 	{
+		CeGuiString prefix = name;
+		mContentWindow = this; //AbstractWindow::loadWindow(&quot;itemicondragcontainer.xml&quot;, prefix);
+
+
+		for (size_t idx = 0; idx &lt; mContentWindow-&gt;getChildCount(); ++idx)
+		{
+			LOG_MESSAGE(Logger::UI, mContentWindow-&gt;getChildAtIdx(idx)-&gt;getName());
+		}
+
+		addChildWindow(mContentWindow);
+                mContentWindow-&gt;setDestroyedByParent(true);
+	}
+
+        void ItemIconDragContainer::setItem(Item* item)
+        {
+            ItemDragContainer::setItem(item);
+
+
+
+
 		CeGuiString icon = item-&gt;getImageName();
 
 		if (icon == &quot;&quot;)
 		{
 			icon = ICON_UNKNOWN_ITEM;
 		}
+                const CeGuiString &amp;name = getName();
 
-		CeGuiString prefix = name;
-		mContentWindow = AbstractWindow::loadWindow(&quot;itemicondragcontainer.xml&quot;, prefix);
 
-		for (size_t idx = 0; idx &lt; mContentWindow-&gt;getChildCount(); ++idx)
-		{
-			LOG_MESSAGE(Logger::UI, mContentWindow-&gt;getChildAtIdx(idx)-&gt;getName());
-		}
 
-		mContentWindow-&gt;getChild(name+&quot;ItemIconDragContainer/Icon&quot;)
+		mContentWindow-&gt;getChild(name+&quot;/Icon&quot;)
 			-&gt;setProperty(&quot;Image&quot;, icon);
 
 		mContentWindow-&gt;subscribeEvent(
@@ -59,6 +82,6 @@
 			cegui_absdim(item-&gt;getSize().first*30),
 			cegui_absdim(item-&gt;getSize().second*30)));
 
-		addChildWindow(mContentWindow);
-	}
+
+        }
 }

Modified: rl/branches/newton20/engine/ui/src/UiSubsystem.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/UiSubsystem.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/src/UiSubsystem.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -17,9 +17,7 @@
 
 #include &quot;UiSubsystem.h&quot;
 
-#include &lt;CEGUISystem.h&gt;
-#include &lt;CEGUIWindow.h&gt;
-#include &lt;CEGUIWindowManager.h&gt;
+#include &lt;CEGUI.h&gt;
 
 #ifdef __APPLE__
 #   include &lt;OgreCEGUIRenderer/OgreCEGUIRenderer.h&gt;
@@ -39,6 +37,8 @@
 #include &quot;GameLoop.h&quot;
 #include &quot;GameObjectManager.h&quot;
 #include &quot;InputManager.h&quot;
+#include &quot;ItemDescriptionDragContainer.h&quot;
+#include &quot;ItemIconDragContainer.h&quot;
 #include &quot;Logger.h&quot;
 #include &quot;ScriptWrapper.h&quot;
 #include &quot;SoundManager.h&quot;
@@ -49,6 +49,18 @@
 using namespace Ogre;
 template&lt;&gt; rl::UiSubsystem* Singleton&lt;rl::UiSubsystem&gt;::ms_Singleton = 0;
 
+// this function needs to be in the CEGUI-namespace
+namespace CEGUI{
+    void initializeOwnCeguiWindowFactories()
+    {
+            CEGUI::WindowFactoryManager&amp; wfMgr = CEGUI::WindowFactoryManager::getSingleton();
+            wfMgr.addFactory(&amp;CEGUI_WINDOW_FACTORY(ItemDescriptionDragContainer)); // ohne rl:: davor hier!
+            //wfMgr.addFalagardWindowMapping(&quot;ItemDescriptionDragContainer&quot;, &quot;CEGUI/ItemDescriptionDragContainer&quot;, &quot;&quot;, &quot;Falagard/Default&quot;);
+            wfMgr.addFactory(&amp;CEGUI_WINDOW_FACTORY(ItemIconDragContainer)); // ohne rl:: davor hier!
+            //wfMgr.addFalagardWindowMapping(&quot;ItemIconDragContainer&quot;, &quot;CEGUI/ItemIconDragContainer&quot;, &quot;&quot;, &quot;Falagard/Default&quot;);
+    }
+}
+
 namespace rl {
     const char* UiSubsystem::CEGUI_ROOT = &quot;RootWindow&quot;;
 
@@ -75,11 +87,12 @@
 
     UiSubsystem::~UiSubsystem()
     {
+		delete mInputManager;
+	
         delete mWindowFactory;
         delete mWindowManager;
+        
 
-        delete mInputManager;
-
         delete mGuiSystem;
         delete mGuiRenderer;
     }
@@ -130,9 +143,14 @@
         sheet-&gt;setZOrderingEnabled(true);
         sheet-&gt;moveToBack();
         System::getSingleton().setDefaultTooltip(&quot;RastullahLook/Tooltip&quot;);
+
+        CEGUI::initializeOwnCeguiWindowFactories();
+
         LOG_MESSAGE2(Logger::UI, &quot;CEGUI initialized.&quot;,
             &quot;UiSubsystem::initializeUiSubsystem&quot;);
 
+
+
         mWindowManager = new WindowManager();
 
         //Initializing InputManager

Modified: rl/branches/newton20/engine/ui/src/WindowFadeJob.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/WindowFadeJob.cpp	2008-08-27 22:12:19 UTC (rev 4490)
+++ rl/branches/newton20/engine/ui/src/WindowFadeJob.cpp	2008-08-28 18:41:29 UTC (rev 4491)
@@ -32,7 +32,7 @@
         : Job(true, true),
         mAbstractWindow(window),
         mCEGUIWindow(window-&gt;getWindow()),
-        mItemDragContainer(NULL),
+//        mItemDragContainer(NULL),
         mMode(mode),
         mChangeRate(changeRate),
         mCurrentAlpha(mode == FADE_IN ? 0.0f : 1.0f),
@@ -47,7 +47,7 @@
         : Job(true, true),
         mAbstractWindow(NULL),
         mCEGUIWindow(window),
-        mItemDragContainer(NULL),
+//        mItemDragContainer(NULL),
         mMode(mode),
         mChangeRate(changeRate),
         mCurrentAlpha(mode == FADE_IN ? 0.0f : 1.0f),
@@ -57,7 +57,7 @@
         mCEGUIWindow-&gt;setVisible(true);
         mCEGUIWindow-&gt;setAlpha(mCurrentAlpha);
     }
-
+/*
     WindowFadeJob::WindowFadeJob(ItemDragContainer* window, Mode mode, Real targetAlpha, Real changeRate)
         : Job(true, true),
         mAbstractWindow(NULL),
@@ -72,7 +72,7 @@
         mCEGUIWindow-&gt;setVisible(true);
         mCEGUIWindow-&gt;setAlpha(mCurrentAlpha);
     }
-
+*/
     bool WindowFadeJob::execute(Real time)
     {
         mCurrentAlpha += time * mChangeRate * Math::Sign(mTargetAlpha - mCurrentAlpha);
@@ -97,8 +97,8 @@
         {
             if( mAbstractWindow )
                 WindowManager::getSingleton().destroyWindow(mAbstractWindow);
-            else if(mItemDragContainer)
-                delete mItemDragContainer;
+//            else if(mItemDragContainer)
+//                delete mItemDragContainer;
             else
                 CEGUI::WindowManager::getSingleton().destroyWindow(mCEGUIWindow);
         }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001547.html">[Dsa-hl-svn] r4490 - rl/trunk/Mac/Rastullah.xcodeproj
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1548">[ date ]</a>
              <a href="thread.html#1548">[ thread ]</a>
              <a href="subject.html#1548">[ subject ]</a>
              <a href="author.html#1548">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
