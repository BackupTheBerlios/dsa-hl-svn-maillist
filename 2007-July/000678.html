<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3607 - modules/common/scripts	modules/regressiontest/dsa modules/regressiontest/materials	modules/regressiontest/materials/textures	modules/regressiontest/models modules/regressiontest/scripts	modules/regressiontest/scripts/maps	rl/trunk/engine/core/include rl/trunk/engine/core/src	rl/trunk/engine/rules rl/trunk/engine/rules/include	rl/trunk/engine/rules/src rl/trunk/engine/script/swig
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-July/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3607%20-%20modules/common/scripts%0A%09modules/regressiontest/dsa%20modules/regressiontest/materials%0A%09modules/regressiontest/materials/textures%0A%09modules/regressiontest/models%20modules/regressiontest/scripts%0A%09modules/regressiontest/scripts/maps%0A%09rl/trunk/engine/core/include%20rl/trunk/engine/core/src%0A%09rl/trunk/engine/rules%20rl/trunk/engine/rules/include%0A%09rl/trunk/engine/rules/src%20rl/trunk/engine/script/swig&In-Reply-To=%3C200707182327.l6INRC65014010%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000677.html">
   <LINK REL="Next"  HREF="000679.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3607 - modules/common/scripts	modules/regressiontest/dsa modules/regressiontest/materials	modules/regressiontest/materials/textures	modules/regressiontest/models modules/regressiontest/scripts	modules/regressiontest/scripts/maps	rl/trunk/engine/core/include rl/trunk/engine/core/src	rl/trunk/engine/rules rl/trunk/engine/rules/include	rl/trunk/engine/rules/src rl/trunk/engine/script/swig</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3607%20-%20modules/common/scripts%0A%09modules/regressiontest/dsa%20modules/regressiontest/materials%0A%09modules/regressiontest/materials/textures%0A%09modules/regressiontest/models%20modules/regressiontest/scripts%0A%09modules/regressiontest/scripts/maps%0A%09rl/trunk/engine/core/include%20rl/trunk/engine/core/src%0A%09rl/trunk/engine/rules%20rl/trunk/engine/rules/include%0A%09rl/trunk/engine/rules/src%20rl/trunk/engine/script/swig&In-Reply-To=%3C200707182327.l6INRC65014010%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3607 - modules/common/scripts	modules/regressiontest/dsa modules/regressiontest/materials	modules/regressiontest/materials/textures	modules/regressiontest/models modules/regressiontest/scripts	modules/regressiontest/scripts/maps	rl/trunk/engine/core/include rl/trunk/engine/core/src	rl/trunk/engine/rules rl/trunk/engine/rules/include	rl/trunk/engine/rules/src rl/trunk/engine/script/swig">blakharaz at mail.berlios.de
       </A><BR>
    <I>Thu Jul 19 01:27:12 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000677.html">[Dsa-hl-svn] r3606 - rl/trunk/engine/core/include
</A></li>
        <LI>Next message: <A HREF="000679.html">[Dsa-hl-svn] r3608 - rl/trunk/engine/rules/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#678">[ date ]</a>
              <a href="thread.html#678">[ thread ]</a>
              <a href="subject.html#678">[ subject ]</a>
              <a href="author.html#678">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2007-07-19 01:26:04 +0200 (Thu, 19 Jul 2007)
New Revision: 3607

Added:
   modules/regressiontest/materials/obj_Shortsleeve.material
   modules/regressiontest/materials/obj_Shortsleeve_2.material
   modules/regressiontest/materials/textures/obj_shortsleeve_dummy.png
   modules/regressiontest/models/obj_shortsleeve.mesh
   modules/regressiontest/models/obj_shortsleeve_2.mesh
   rl/trunk/engine/rules/include/RulesConstants.h
Removed:
   rl/trunk/engine/rules/include/GameObjectConstants.h
Modified:
   modules/common/scripts/gameobjectprops.rb
   modules/regressiontest/dsa/gameobjectdefinitions.gof
   modules/regressiontest/scripts/MergeableMeshTest.rb
   modules/regressiontest/scripts/maps/regressiontest.rb
   modules/regressiontest/scripts/mckhero.rb
   rl/trunk/engine/core/include/MeshObject.h
   rl/trunk/engine/core/src/MeshObject.cpp
   rl/trunk/engine/rules/RlRules2005.vcproj
   rl/trunk/engine/rules/include/GameObject.h
   rl/trunk/engine/rules/include/GameObjectStateListener.h
   rl/trunk/engine/rules/include/Inventory.h
   rl/trunk/engine/rules/include/Slot.h
   rl/trunk/engine/rules/src/Inventory.cpp
   rl/trunk/engine/script/swig/RlRules.head.swig
   rl/trunk/engine/script/swig/RlRules.swig
Log:
Added a third slot type - this slot changes the material of a submesh (item must have property &quot;material&quot;)

Modified: modules/common/scripts/gameobjectprops.rb
===================================================================
--- modules/common/scripts/gameobjectprops.rb	2007-07-17 15:15:11 UTC (rev 3606)
+++ modules/common/scripts/gameobjectprops.rb	2007-07-18 23:26:04 UTC (rev 3607)
@@ -6,8 +6,8 @@
         $SCRIPT.log(&quot;Check Ruby GameObject for properties.&quot;);
         
         #  Get all properties from the parent C++ class
-        ps = PropertySet.new
-        ps = super.getAllProperties()
+        #ps = PropertySet.new
+        ps = super()
     
         #  Get all instance variables from the ruby class
         aPropArray = instance_variables
@@ -26,5 +26,13 @@
         end
         return ps
     end
+	
+#	def setProperty(key, value)
+#		instance_variable_set(&quot;@_prop_&quot;+key, value)
+#	end
+
+#	def getProperty(key)
+#		return instance_variable_get(&quot;@_prop_&quot;+key)
+#	end
   
 end

Modified: modules/regressiontest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-07-17 15:15:11 UTC (rev 3606)
+++ modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-07-18 23:26:04 UTC (rev 3607)
@@ -96,8 +96,10 @@
         &lt;property name=&quot;capacity&quot; type=&quot;REAL&quot; data=&quot;20.0&quot;/&gt;
         &lt;property name=&quot;volume&quot; type=&quot;INTPAIR&quot; data=&quot;8,6&quot;/&gt;
         &lt;property name=&quot;size&quot; type=&quot;INTPAIR&quot; data=&quot;2,2&quot;/&gt;
+		&lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;5.0&quot;/&gt;
+		&lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot;/&gt;
         &lt;property name=&quot;actions&quot; type=&quot;ARRAY&quot;&gt;
-        &lt;property type=&quot;STRING&quot; data=&quot;showcontainercontent&quot;/&gt;
+			&lt;property type=&quot;STRING&quot; data=&quot;showcontainercontent&quot;/&gt;
         &lt;/property&gt;
         &lt;property name=&quot;defaultaction&quot; type=&quot;STRING&quot; data=&quot;showcontainercontent&quot;/&gt;
     &lt;/gameobjectclass&gt;
@@ -140,5 +142,20 @@
         &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;box&quot;/&gt;
     &lt;/gameobjectclass&gt;
 
-
+	&lt;!--InventoryTest clothes--&gt;
+    &lt;gameobjectclass classid=&quot;Clothes #1&quot; baseclass=&quot;Clothing&quot;&gt;
+        &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Kleidung #1&quot;/&gt;
+        &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Kleidung, Variante 1&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve.mesh&quot;/&gt;
+        &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;box&quot;/&gt;
+        &lt;property name=&quot;material&quot; type=&quot;STRING&quot; data=&quot;obj_Shortsleeve&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+    &lt;gameobjectclass classid=&quot;Clothes #2&quot; baseclass=&quot;Clothing&quot;&gt;
+        &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Kleidung #2&quot;/&gt;
+        &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Kleidung, Variante 2&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve_2.mesh&quot;/&gt;
+        &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;box&quot;/&gt;
+        &lt;property name=&quot;material&quot; type=&quot;STRING&quot; data=&quot;obj_Shortsleeve_2&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+	
 &lt;/GameObjectDefinitions&gt;

Added: modules/regressiontest/materials/obj_Shortsleeve.material
===================================================================
--- modules/regressiontest/materials/obj_Shortsleeve.material	2007-07-17 15:15:11 UTC (rev 3606)
+++ modules/regressiontest/materials/obj_Shortsleeve.material	2007-07-18 23:26:04 UTC (rev 3607)
@@ -0,0 +1,6 @@
+
+material obj_Shortsleeve : Basic_Vertex_Shader
+{
+set_texture_alias diffuse obj_shortsleeve02_diffuse.png
+
+}

Added: modules/regressiontest/materials/obj_Shortsleeve_2.material
===================================================================
--- modules/regressiontest/materials/obj_Shortsleeve_2.material	2007-07-17 15:15:11 UTC (rev 3606)
+++ modules/regressiontest/materials/obj_Shortsleeve_2.material	2007-07-18 23:26:04 UTC (rev 3607)
@@ -0,0 +1,6 @@
+
+material obj_Shortsleeve_2 : Basic_Vertex_Shader
+{
+set_texture_alias diffuse obj_shortsleeve_dummy.png
+
+}

Added: modules/regressiontest/materials/textures/obj_shortsleeve_dummy.png
===================================================================
(Binary files differ)


Property changes on: modules/regressiontest/materials/textures/obj_shortsleeve_dummy.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/regressiontest/models/obj_shortsleeve.mesh
===================================================================
(Binary files differ)


Property changes on: modules/regressiontest/models/obj_shortsleeve.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/regressiontest/models/obj_shortsleeve_2.mesh
===================================================================
(Binary files differ)


Property changes on: modules/regressiontest/models/obj_shortsleeve_2.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/regressiontest/scripts/MergeableMeshTest.rb
===================================================================
--- modules/regressiontest/scripts/MergeableMeshTest.rb	2007-07-17 15:15:11 UTC (rev 3606)
+++ modules/regressiontest/scripts/MergeableMeshTest.rb	2007-07-18 23:26:04 UTC (rev 3607)
@@ -24,23 +24,22 @@
         test_obj1.setPosition(rel_pos([1, 0, 0]))
         test_obj1.placeIntoScene();
 
-
         test_obj2 = $GOM.createGameObject(&quot;mesh construction kit test creature&quot;)
         test_obj2.setPosition(rel_pos([2, 0, 0]))
         test_obj2.placeIntoScene();
 #        test_obj2.getActor().getControlledObject().startAnimation(&quot;Walk&quot;)
-        test_obj2.getInventory().addSlot(&quot;Head&quot;, &quot;head&quot;, Item::ITEMTYPE_HELMET, false);
-        test_obj2.getInventory().addSlot(&quot;Right Hand&quot;, &quot;Bip01 R SlotHand&quot;, Item::ITEMTYPE_ALL_ITEMS);
-        test_obj2.getInventory().addSlot(&quot;Armor&quot;, &quot;armor&quot;, Item::ITEMTYPE_ALL_ITEMS, false);
+        test_obj2.getInventory().addSlot(&quot;Head&quot;, &quot;head&quot;, Item::ITEMTYPE_HELMET, RlScript::SLOT_SUBMESH);
+        test_obj2.getInventory().addSlot(&quot;Right Hand&quot;, &quot;Bip01 R SlotHand&quot;, Item::ITEMTYPE_ALL_ITEMS, RlScript::SLOT_BONE);
+        test_obj2.getInventory().addSlot(&quot;Armor&quot;, &quot;armor&quot;, Item::ITEMTYPE_ALL_ITEMS, RlScript::SLOT_SUBMESH);
         test_item2 = $GOM.createGameObject(&quot;mesh construction kit test item 1&quot;)
         test_obj2.getInventory().hold(test_item2, &quot;Armor&quot;)
 
         test_obj3 = $GOM.createGameObject(&quot;mesh construction kit test creature&quot;)
         test_obj3.setPosition(rel_pos([3, 0, 0]))
         test_obj3.placeIntoScene();
-        test_obj3.getInventory().addSlot(&quot;Head&quot;, &quot;head&quot;, Item::ITEMTYPE_HELMET, false);
-        test_obj3.getInventory().addSlot(&quot;Right Hand&quot;, &quot;Bip01 R SlotHand&quot;, Item::ITEMTYPE_ALL_ITEMS);
-        test_obj3.getInventory().addSlot(&quot;Armor&quot;, &quot;armor&quot;, Item::ITEMTYPE_ALL_ITEMS, false);
+        test_obj3.getInventory().addSlot(&quot;Head&quot;, &quot;head&quot;, Item::ITEMTYPE_HELMET, RlScript::SLOT_SUBMESH);
+        test_obj3.getInventory().addSlot(&quot;Right Hand&quot;, &quot;Bip01 R SlotHand&quot;, Item::ITEMTYPE_ALL_ITEMS, RlScript::SLOT_BONE);
+        test_obj3.getInventory().addSlot(&quot;Armor&quot;, &quot;armor&quot;, Item::ITEMTYPE_ALL_ITEMS, RlScript::SLOT_SUBMESH);
         test_item3 = $GOM.createGameObject(&quot;mesh construction kit test item 2&quot;)
         test_obj3.getInventory().hold(test_item3, &quot;Armor&quot;)
         test_obj3.getActor().getControlledObject().startAnimation(&quot;Walk&quot;)
@@ -48,9 +47,9 @@
         test_obj4 = $GOM.createGameObject(&quot;mesh construction kit test creature&quot;)
         test_obj4.setPosition(rel_pos([4, 0, 0]))
         test_obj4.placeIntoScene();
-        test_obj4.getInventory().addSlot(&quot;Head&quot;, &quot;head&quot;, Item::ITEMTYPE_HELMET, false);
-        test_obj4.getInventory().addSlot(&quot;Right Hand&quot;, &quot;Bip01 R SlotHand&quot;, Item::ITEMTYPE_ALL_ITEMS);
-        test_obj4.getInventory().addSlot(&quot;Armor&quot;, &quot;armor&quot;, Item::ITEMTYPE_ALL_ITEMS, false);
+        test_obj4.getInventory().addSlot(&quot;Head&quot;, &quot;head&quot;, Item::ITEMTYPE_HELMET, RlScript::SLOT_SUBMESH);
+        test_obj4.getInventory().addSlot(&quot;Right Hand&quot;, &quot;Bip01 R SlotHand&quot;, Item::ITEMTYPE_ALL_ITEMS, RlScript::SLOT_BONE);
+        test_obj4.getInventory().addSlot(&quot;Armor&quot;, &quot;armor&quot;, Item::ITEMTYPE_ALL_ITEMS, RlScript::SLOT_SUBMESH);
         test_item4 = $GOM.createGameObject(&quot;mesh construction kit test item 2&quot;)
         test_obj4.getInventory().hold(test_item4, &quot;Armor&quot;)
         test_obj4.getInventory().dropItem(&quot;Armor&quot;)

Modified: modules/regressiontest/scripts/maps/regressiontest.rb
===================================================================
--- modules/regressiontest/scripts/maps/regressiontest.rb	2007-07-17 15:15:11 UTC (rev 3606)
+++ modules/regressiontest/scripts/maps/regressiontest.rb	2007-07-18 23:26:04 UTC (rev 3607)
@@ -15,6 +15,7 @@
 require 'effecttest.rb'
 require 'LightzoneTest.rb'
 require 'MapLoadingTest.rb'
+require 'MaterialSlotTest.rb'
 require 'MergeableMeshTest.rb'
 require 'WalkJobTest.rb'
 require 'SelectorTest.rb'
@@ -37,20 +38,21 @@
 
 $SCRIPT.log(&quot;begin tests.&quot;);
 
-         DoorTest.new([0, 0, -5]).run()
-          NpcTest.new([-5, 0, 5]).run()
-   NpcCapsuleTest.new([0, 0, 5]).run()
-         TimeTest.new([-5, 0, -5]).run()
+ MaterialSlotTest.new([-15, 0, -5]).run()
+    LightzoneTest.new([-10, 0, -5]).run()
 ErrorHandlingTest.new([-10, 0, 5]).run()
-    InventoryTest.new([0, 0, 10]).run()
-  JobSequenceTest.new([5, 0, -5]).run()
-       EffectTest.new([5, 0, 5]).run()
-        SoundTest.new([10, 0, 10]).run()
-    LightzoneTest.new([-10, 0, -5]).run()
-   MapLoadingTest.new([-5, 0, -10]).run()
-MergeableMeshTest.new([10, 0, 0]).run()
-     SelectorTest.new([5, 0, 0]).run()
-	  WalkJobTest.new([0.0,0.0,0.0]).run()
+         TimeTest.new([ -5, 0, -5]).run()
+   MapLoadingTest.new([ -5, 0, -10]).run()
+          NpcTest.new([ -5, 0, 5]).run()
+         DoorTest.new([  0, 0, -5]).run()
+	  WalkJobTest.new([  0, 0, -3]).run()
+   NpcCapsuleTest.new([  0, 0, 5]).run()
+    InventoryTest.new([  0, 0, 10]).run()
+  JobSequenceTest.new([  5, 0, -5]).run()
+     SelectorTest.new([  5, 0, 0]).run()
+       EffectTest.new([  5, 0, 5]).run()
+MergeableMeshTest.new([ 10, 0, 0]).run()
+        SoundTest.new([ 10, 0, 10]).run()
 
 $SCRIPT.log(&quot;tests initialisiert.&quot;);
 

Modified: modules/regressiontest/scripts/mckhero.rb
===================================================================
--- modules/regressiontest/scripts/mckhero.rb	2007-07-17 15:15:11 UTC (rev 3606)
+++ modules/regressiontest/scripts/mckhero.rb	2007-07-18 23:26:04 UTC (rev 3607)
@@ -35,10 +35,12 @@
 	inv.addSlot(&quot;Right Ring&quot;, &quot;Bip01 R Finger21&quot;, Item::ITEMTYPE_RING);
 	inv.addSlot(&quot;Left Hand&quot;, &quot;Bip01 L SlotHand&quot;, Item::ITEMTYPE_ALL_ITEMS);
 	inv.addSlot(&quot;Right Hand&quot;, &quot;Bip01 R SlotHand&quot;, Item::ITEMTYPE_ALL_ITEMS);
-	inv.addSlot(&quot;Head&quot;, &quot;Bip01 Head&quot;, Item::ITEMTYPE_HELMET, false);
-	inv.addSlot(&quot;Back&quot;, &quot;back&quot;, Item::ITEMTYPE_ALL_ITEMS, false);
+	inv.addSlot(&quot;Head&quot;, &quot;Bip01 Head&quot;, Item::ITEMTYPE_HELMET, RlScript::SLOT_SUBMESH);
+	inv.addSlot(&quot;Back&quot;, &quot;back&quot;, Item::ITEMTYPE_ALL_ITEMS, RlScript::SLOT_SUBMESH);
 	#inv.addSlot(&quot;Back&quot;, &quot;Bip01 Neck&quot;, Item::ITEMTYPE_ALL_ITEMS);
-    inv.addSlot(&quot;Armor&quot;, &quot;armor&quot;, Item::ITEMTYPE_ARMOR, false);
+    inv.addSlot(&quot;Armor&quot;, &quot;armor&quot;, Item::ITEMTYPE_ARMOR, RlScript::SLOT_SUBMESH);
+	inv.addSlot(&quot;Torso&quot;, &quot;men_human_female_torso&quot;, Item::ITEMTYPE_ARMOR, RlScript::SLOT_MATERIAL);
+	
 
 	#addSounds()
         $SCRIPT.log(&quot;done.&quot;);

Modified: rl/trunk/engine/core/include/MeshObject.h
===================================================================
--- rl/trunk/engine/core/include/MeshObject.h	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/core/include/MeshObject.h	2007-07-18 23:26:04 UTC (rev 3607)
@@ -84,19 +84,27 @@
 		/** creates a mesh animated to the specified pose.
 		 * @param animName name of the animation to be posed at.
 		 */
-		MeshObject *createPosedCopy(const Ogre::String&amp; animName);
+		MeshObject* createPosedCopy(const Ogre::String&amp; animName);
 
 		const Ogre::String &amp;getMeshName() const;
 
 		virtual bool isMeshObject() const;
 
         /// Per Skeleton-Blend-Setting
-        bool getBlendCumulative(void) const;
+        bool getBlendCumulative() const;
         void setBlendCumulative(bool cumulative);
 
         void setHighlighted( bool highlight );
         
         virtual Ogre::String getObjectType() const;
+
+        /** Changes the Material of a submesh
+         * if the submesh is not specified (or the parameter is set to &quot;&quot;) 
+         * the first submesh's material is changed
+         * @param material the name of the new material
+         * @param submesh (optional) the name of the submesh
+         */
+        void setMaterial(const Ogre::String&amp; material, const Ogre::String&amp; submesh);
     private:
 		Ogre::String mMeshName;
         Ogre::AxisAlignedBox mSize;

Modified: rl/trunk/engine/core/src/MeshObject.cpp
===================================================================
--- rl/trunk/engine/core/src/MeshObject.cpp	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/core/src/MeshObject.cpp	2007-07-18 23:26:04 UTC (rev 3607)
@@ -340,7 +340,7 @@
             if( subent == NULL )
                 continue;
 
-            // TODO - optimieren, nur wenn der Typ ver&#65533;ndert wird
+            // TODO - optimieren, nur wenn der Typ veraendert wird
             //if(StringUtil::endsWith(subent-&gt;getMaterialName(),nameExtension)
             // == highlight )
             //  continue;
@@ -383,4 +383,20 @@
     {
         return true;
     }
+
+    void MeshObject::setMaterial(const Ogre::String&amp; material, const Ogre::String&amp; submesh)
+    {
+        if (submesh == &quot;&quot;)
+        {
+            ///@todo implement
+        }
+        else
+        {
+            SubEntity* subent = getEntity()-&gt;getSubEntity(submesh);
+            if (subent)
+            {
+                subent-&gt;setMaterialName(material);
+            }
+        }
+    }
 }

Modified: rl/trunk/engine/rules/RlRules2005.vcproj
===================================================================
--- rl/trunk/engine/rules/RlRules2005.vcproj	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/rules/RlRules2005.vcproj	2007-07-18 23:26:04 UTC (rev 3607)
@@ -569,10 +569,6 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
-				RelativePath=&quot;.\include\GameObjectConstants.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
 				RelativePath=&quot;.\include\GameObjectManager.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -621,6 +617,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\RulesConstants.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\RulesPrerequisites.h&quot;
 				&gt;
 			&lt;/File&gt;

Modified: rl/trunk/engine/rules/include/GameObject.h
===================================================================
--- rl/trunk/engine/rules/include/GameObject.h	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/rules/include/GameObject.h	2007-07-18 23:26:04 UTC (rev 3607)
@@ -20,7 +20,7 @@
 #include &quot;RulesPrerequisites.h&quot;
 
 #include &quot;Action.h&quot;
-#include &quot;GameObjectConstants.h&quot;
+#include &quot;RulesConstants.h&quot;
 #include &quot;ObjectStateChangeEventSource.h&quot;
 #include &quot;Properties.h&quot;
 #include &quot;CoreDefines.h&quot;

Deleted: rl/trunk/engine/rules/include/GameObjectConstants.h
===================================================================
--- rl/trunk/engine/rules/include/GameObjectConstants.h	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/rules/include/GameObjectConstants.h	2007-07-18 23:26:04 UTC (rev 3607)
@@ -1,46 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
- */
-
-#ifndef __GAMEOBJECTSTATE_H__
-#define __GAMEOBJECTSTATE_H__
-
-namespace rl {
-
-    /// Basic states, a GameObject can have.
-    /// Values are chosen so, that they are maskable.
-    enum GameObjectState
-    {
-        GOS_UNDEFINED     =     0, ///!&lt; Nothing known about such a GO.
-        GOS_UNLOADED      =  1&lt;&lt;0, ///!&lt; GO is known, but its actual properties are not loaded yet.
-        GOS_LOADED        =  1&lt;&lt;1, ///!&lt; GO is loaded, unused.
-        GOS_IN_POSSESSION =  1&lt;&lt;2, ///!&lt; GO is owned by another GO. (e.g. inside a chest)
-        GOS_IN_SCENE      =  1&lt;&lt;3, ///!&lt; GO is placed openly in the scene.
-        GOS_HELD          =  1&lt;&lt;4, ///!&lt; GO is held openly by another GO. (e.g. apple in NPC's hand)
-        GOS_READY         =  1&lt;&lt;5  ///!&lt; GO is ready for usage by another GO. (sword in NPC's hand)
-    };
-
-	static const unsigned long QUERYFLAG_GAMEOBJECT = 1&lt;&lt;1;
-    static const unsigned long QUERYFLAG_CREATURE   = 1&lt;&lt;2;
-    static const unsigned long QUERYFLAG_ITEM       = 1&lt;&lt;3;
-    static const unsigned long QUERYFLAG_CONTAINER  = 1&lt;&lt;4;
-    static const unsigned long QUERYFLAG_WEAPON     = 1&lt;&lt;5;
-    static const unsigned long QUERYFLAG_ARMOR      = 1&lt;&lt;6;
-    static const unsigned long QUERYFLAG_PERSON     = 1&lt;&lt;7;
-
-	static const unsigned long QUERYFLAG_PLAYER     = 1&lt;&lt;8;
-}
-
-#endif // GAMEOBJECTSTATE

Modified: rl/trunk/engine/rules/include/GameObjectStateListener.h
===================================================================
--- rl/trunk/engine/rules/include/GameObjectStateListener.h	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/rules/include/GameObjectStateListener.h	2007-07-18 23:26:04 UTC (rev 3607)
@@ -17,7 +17,7 @@
 #ifndef __RL_GAMEOBJECTSTATELISTENER_H__
 #define __RL_GAMEOBJECTSTATELISTENER_H__
 
-#include &quot;GameObjectConstants.h&quot;
+#include &quot;RulesConstants.h&quot;
 
 namespace rl {
 

Modified: rl/trunk/engine/rules/include/Inventory.h
===================================================================
--- rl/trunk/engine/rules/include/Inventory.h	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/rules/include/Inventory.h	2007-07-18 23:26:04 UTC (rev 3607)
@@ -19,8 +19,8 @@
 
 #include &quot;RulesPrerequisites.h&quot;
 
-#include &quot;Container.h&quot;
 #include &quot;Properties.h&quot;
+#include &quot;RulesConstants.h&quot;
 
 namespace rl {
 
@@ -83,7 +83,7 @@
     void ready(Item* item);
 
     Item* getItem(const CeGuiString&amp; slotName) const;
-    void addSlot(const CeGuiString&amp; name, const Ogre::String&amp; meshpartname, int itemMask, bool boneSlot = true);
+    void addSlot(const CeGuiString&amp; name, const Ogre::String&amp; meshpartname, int itemMask, SlotType type = SLOT_BONE);
     const SlotMap&amp; getAllSlots() const;
 
 	Creature* getOwner() const;

Copied: rl/trunk/engine/rules/include/RulesConstants.h (from rev 3605, rl/trunk/engine/rules/include/GameObjectConstants.h)
===================================================================
--- rl/trunk/engine/rules/include/GameObjectConstants.h	2007-07-17 14:41:51 UTC (rev 3605)
+++ rl/trunk/engine/rules/include/RulesConstants.h	2007-07-18 23:26:04 UTC (rev 3607)
@@ -0,0 +1,54 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2007 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+ */
+
+#ifndef __RULESCONSTANTS_H__
+#define __RULESCONSTANTS_H__
+
+namespace rl {
+
+    /// Basic states, a GameObject can have.
+    /// Values are chosen so, that they are maskable.
+    enum GameObjectState
+    {
+        GOS_UNDEFINED     =     0, ///!&lt; Nothing known about such a GO.
+        GOS_UNLOADED      =  1&lt;&lt;0, ///!&lt; GO is known, but its actual properties are not loaded yet.
+        GOS_LOADED        =  1&lt;&lt;1, ///!&lt; GO is loaded, unused.
+        GOS_IN_POSSESSION =  1&lt;&lt;2, ///!&lt; GO is owned by another GO. (e.g. inside a chest)
+        GOS_IN_SCENE      =  1&lt;&lt;3, ///!&lt; GO is placed openly in the scene.
+        GOS_HELD          =  1&lt;&lt;4, ///!&lt; GO is held openly by another GO. (e.g. apple in NPC's hand)
+        GOS_READY         =  1&lt;&lt;5  ///!&lt; GO is ready for usage by another GO. (sword in NPC's hand)
+    };
+
+	static const unsigned long QUERYFLAG_GAMEOBJECT = 1&lt;&lt;1;
+    static const unsigned long QUERYFLAG_CREATURE   = 1&lt;&lt;2;
+    static const unsigned long QUERYFLAG_ITEM       = 1&lt;&lt;3;
+    static const unsigned long QUERYFLAG_CONTAINER  = 1&lt;&lt;4;
+    static const unsigned long QUERYFLAG_WEAPON     = 1&lt;&lt;5;
+    static const unsigned long QUERYFLAG_ARMOR      = 1&lt;&lt;6;
+    static const unsigned long QUERYFLAG_PERSON     = 1&lt;&lt;7;
+
+	static const unsigned long QUERYFLAG_PLAYER     = 1&lt;&lt;8;
+
+
+    enum SlotType
+    {
+        SLOT_BONE,
+        SLOT_SUBMESH,
+        SLOT_MATERIAL
+    };
+}
+
+#endif // __RULESCONSTANTS_H__
\ No newline at end of file

Modified: rl/trunk/engine/rules/include/Slot.h
===================================================================
--- rl/trunk/engine/rules/include/Slot.h	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/rules/include/Slot.h	2007-07-18 23:26:04 UTC (rev 3607)
@@ -29,10 +29,10 @@
     virtual void setItem(Item* item) = 0;
     Item* getItem() const;
     bool isAllowed(Item* item) const;
+    virtual ~Slot();
 
 protected:
     Slot(Creature* owner, const CeGuiString&amp; name, int itemMask);
-    virtual ~Slot();
 
     Creature* mOwner;
     Item* mItem;
@@ -62,6 +62,16 @@
     Ogre::String mSubmesh;
 };
 
+class MaterialSlot : public Slot
+{
+public:
+    MaterialSlot(Creature* owner, const CeGuiString&amp; name, int itemMask, const Ogre::String&amp; submesh);
+    virtual void setItem(Item* item);
+
+private:
+    Ogre::String mSubmesh;
+};
+
 } // namespace rl
 
 #endif //__SLOT_H__

Modified: rl/trunk/engine/rules/src/Inventory.cpp
===================================================================
--- rl/trunk/engine/rules/src/Inventory.cpp	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/rules/src/Inventory.cpp	2007-07-18 23:26:04 UTC (rev 3607)
@@ -15,10 +15,11 @@
  */
 #include &quot;stdinc.h&quot; //precompiled header
 
+#include &quot;Inventory.h&quot;
+
 #include &quot;Item.h&quot;
 #include &quot;Armor.h&quot;
 #include &quot;Weapon.h&quot;
-#include &quot;Inventory.h&quot;
 #include &quot;Exception.h&quot;
 #include &quot;ActorManager.h&quot;
 #include &quot;Creature.h&quot;
@@ -218,21 +219,25 @@
     {
     }
 
-    void Inventory::addSlot(const CeGuiString&amp; name, const Ogre::String&amp; meshpartname, int itemMask, bool boneSlot)
+    void Inventory::addSlot(const CeGuiString&amp; name, const Ogre::String&amp; meshpartname, int itemMask, SlotType type)
     {
         if (mSlots.find(name) != mSlots.end())
         {
             Throw(rl::IllegalArgumentException, Ogre::String(&quot;Slot '&quot;)+name.c_str()+&quot;' already exists.&quot;);
         }
 
-		if (boneSlot)
-		{
-			mSlots[name] = new BoneSlot(mOwner, name, itemMask, meshpartname);
+		switch (type)
+        {
+            case SLOT_BONE:
+			    mSlots[name] = new BoneSlot(mOwner, name, itemMask, meshpartname);
+                break;
+            case SLOT_SUBMESH:
+			    mSlots[name] = new SubmeshSlot(mOwner, name, itemMask, meshpartname);
+                break;
+            case SLOT_MATERIAL:
+			    mSlots[name] = new MaterialSlot(mOwner, name, itemMask, meshpartname);
+                break;
 		}
-		else
-		{
-			mSlots[name] = new SubmeshSlot(mOwner, name, itemMask, meshpartname);
-		}
     }
 
     const Inventory::SlotMap&amp; Inventory::getAllSlots() const

Modified: rl/trunk/engine/script/swig/RlRules.head.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.head.swig	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/script/swig/RlRules.head.swig	2007-07-18 23:26:04 UTC (rev 3607)
@@ -41,6 +41,7 @@
 #include &quot;QuestBook.h&quot;
 #include &quot;QuestEvent.h&quot;
 #include &quot;QuestListener.h&quot;
+#include &quot;RulesConstants.h&quot;
 #include &quot;RulesSubsystem.h&quot;
 #include &quot;Selector.h&quot;
 #include &quot;SonderfertigkeitenStateSet.h&quot;

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2007-07-17 15:15:11 UTC (rev 3606)
+++ rl/trunk/engine/script/swig/RlRules.swig	2007-07-18 23:26:04 UTC (rev 3607)
@@ -14,7 +14,7 @@
  *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
  */
 
-// %template(GameObjectVector) std::vector&lt; rl::GameObject* &gt;;         
+//%template(GameObjectVector) std::vector&lt; rl::GameObject* &gt;;
 
 namespace rl {
 
@@ -598,13 +598,20 @@
         void setEffectFactory(rl::EffectFactory* factory);
         static rl::EffectFactoryManager&amp; getSingleton();
     };
-    
+
+    enum SlotType
+    {
+        SLOT_BONE,
+        SLOT_SUBMESH,
+        SLOT_MATERIAL
+    };
+
     class Inventory 
     {
     private:
         Inventory(rl::Creature* owner);
     public:
-		void addSlot(const rl::CeGuiString&amp; name, const Ogre::String&amp; meshpartname, int itemMask, bool boneSlot = true);
+        void addSlot(const rl::CeGuiString&amp; name, const Ogre::String&amp; meshpartname, int itemMask, SlotType type = SLOT_BONE);
         rl::Item* getItem(const rl::CeGuiString&amp; slotName) const;
         void hold(rl::Item* item, const rl::CeGuiString&amp; slot);
         void dropItem(const rl::CeGuiString&amp; slotName);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000677.html">[Dsa-hl-svn] r3606 - rl/trunk/engine/core/include
</A></li>
	<LI>Next message: <A HREF="000679.html">[Dsa-hl-svn] r3608 - rl/trunk/engine/rules/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#678">[ date ]</a>
              <a href="thread.html#678">[ thread ]</a>
              <a href="subject.html#678">[ subject ]</a>
              <a href="author.html#678">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
