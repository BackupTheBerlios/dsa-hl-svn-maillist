<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4621 - in rl/branches/persistence: common/include	common/src rules/src ui/include ui/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2008-December/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4621%20-%20in%20rl/branches/persistence%3A%20common/include%0A%09common/src%20rules/src%20ui/include%20ui/src&In-Reply-To=%3C200812012013.mB1KDpUZ004545%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001677.html">
   <LINK REL="Next"  HREF="001679.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4621 - in rl/branches/persistence: common/include	common/src rules/src ui/include ui/src</H1>
    <B>timm at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4621%20-%20in%20rl/branches/persistence%3A%20common/include%0A%09common/src%20rules/src%20ui/include%20ui/src&In-Reply-To=%3C200812012013.mB1KDpUZ004545%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4621 - in rl/branches/persistence: common/include	common/src rules/src ui/include ui/src">timm at mail.berlios.de
       </A><BR>
    <I>Mon Dec  1 21:13:51 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001677.html">[Dsa-hl-svn] r4620 - in rl/trunk/engine/common: include src
</A></li>
        <LI>Next message: <A HREF="001679.html">[Dsa-hl-svn] r4622 - modules/common/dsa
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1678">[ date ]</a>
              <a href="thread.html#1678">[ thread ]</a>
              <a href="subject.html#1678">[ subject ]</a>
              <a href="author.html#1678">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: timm
Date: 2008-12-01 21:13:40 +0100 (Mon, 01 Dec 2008)
New Revision: 4621

Modified:
   rl/branches/persistence/common/include/MathUtil.h
   rl/branches/persistence/common/src/MathUtil.cpp
   rl/branches/persistence/rules/src/GoToJob.cpp
   rl/branches/persistence/ui/include/AbstractWindow.h
   rl/branches/persistence/ui/include/GameSettings.h
   rl/branches/persistence/ui/src/AbstractWindow.cpp
   rl/branches/persistence/ui/src/GameSettings.cpp
Log:
merged changes from trunk

Modified: rl/branches/persistence/common/include/MathUtil.h
===================================================================
--- rl/branches/persistence/common/include/MathUtil.h	2008-12-01 20:08:06 UTC (rev 4620)
+++ rl/branches/persistence/common/include/MathUtil.h	2008-12-01 20:13:40 UTC (rev 4621)
@@ -1,39 +1,43 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
- */
-
-#ifndef __MathUtil_H__
-#define __MathUtil_H__
-
-#include &quot;CommonPrerequisites.h&quot;
-
-namespace rl {
-
-class _RlCommonExport MathUtil
-{
-    public:
-        static const Ogre::Real EPSILON;
-
-        static Ogre::Vector3 sphericalToCartesian(Ogre::Real r,
-            Ogre::Radian azimuth, Ogre::Radian altitude);
-
-        static void cartesianToSpherical(Ogre::Vector3 cartesian, Ogre::Real&amp; r,
-            Ogre::Radian&amp; azimuth, Ogre::Radian&amp; altitude);
-        static Ogre::Real normaliseAngle(Ogre::Real angle);
-
-		static Ogre::Real distance(const Ogre::AxisAlignedBox&amp; b1, const Ogre::AxisAlignedBox&amp; b2);
-};
-}
-#endif
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+ */
+
+#ifndef __MathUtil_H__
+#define __MathUtil_H__
+
+#include &quot;CommonPrerequisites.h&quot;
+
+namespace rl 
+{
+    
+    class _RlCommonExport MathUtil
+    {
+    public:
+        static const Ogre::Real EPSILON;
+        
+        static Ogre::Vector3 sphericalToCartesian(Ogre::Real r,
+                                                  Ogre::Radian azimuth, Ogre::Radian altitude);
+        
+        static void cartesianToSpherical(Ogre::Vector3 cartesian, Ogre::Real&amp; r,
+                                         Ogre::Radian&amp; azimuth, Ogre::Radian&amp; altitude);
+        static Ogre::Real normaliseAngle(Ogre::Real angle);
+        
+		static Ogre::Real distance(const Ogre::AxisAlignedBox&amp; b1, const Ogre::AxisAlignedBox&amp; b2);
+        static Ogre::Real distance(const Ogre::Vector3&amp; v, const Ogre::AxisAlignedBox&amp; b);
+        static Ogre::Real distance(const Ogre::AxisAlignedBox&amp; b, const Ogre::Vector3&amp; v);
+    };
+    
+}
+#endif

Modified: rl/branches/persistence/common/src/MathUtil.cpp
===================================================================
--- rl/branches/persistence/common/src/MathUtil.cpp	2008-12-01 20:08:06 UTC (rev 4620)
+++ rl/branches/persistence/common/src/MathUtil.cpp	2008-12-01 20:13:40 UTC (rev 4621)
@@ -1,78 +1,104 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
- */
-
-#include &quot;stdinc.h&quot; //precompiled header
-
-#include &quot;MathUtil.h&quot;
-
-
-using namespace Ogre;
-
-namespace rl
-{
-    const Ogre::Real MathUtil::EPSILON = 0.00001f;
-
-    Ogre::Vector3 MathUtil::sphericalToCartesian(Ogre::Real r,
-        Ogre::Radian azimuth, Ogre::Radian altitude)
-    {
-        Vector3 rval;
-        rval.x = r*Math::Sin(azimuth)*Math::Sin(altitude + Radian(Math::HALF_PI));
-        rval.y = r*Math::Cos(altitude + Radian(Math::HALF_PI));
-        rval.z = r*Math::Cos(azimuth)*Math::Sin(altitude + Radian(Math::HALF_PI));
-        return rval;
-    }
-
-    void MathUtil::cartesianToSpherical(Ogre::Vector3 cartesian, Ogre::Real&amp; r,
-        Ogre::Radian&amp; azimuth, Ogre::Radian&amp; altitude)
-    {
-        r = Math::Sqrt(Math::Sqr(cartesian.x)*Math::Sqr(cartesian.y)*Math::Sqr(cartesian.z));
-        azimuth = Math::ATan2(cartesian.x, cartesian.z);
-        altitude = Math::ACos(cartesian.y/r) - Radian(Math::HALF_PI);
-    }
-
-    Ogre::Real MathUtil::normaliseAngle(Ogre::Real angle)
-	{
-        Ogre::Real ang = angle;
-
-		while (ang &lt; 0) ang += 360;
-		while (ang &gt; 360) ang -= 360;
-
-		return ang;
-	}	
-
-	Real MathUtil::distance(const AxisAlignedBox&amp; b1, const AxisAlignedBox&amp; b2)
-	{
-		if (b1.intersects(b2))
-		{
-			return 0.0f;
-		}
-		else
-		{
-			Vector3 dv;
-
-			const Vector3&amp; min1 = b1.getMinimum();
-			const Vector3&amp; min2 = b2.getMinimum();
-			const Vector3&amp; max1 = b1.getMaximum();
-			const Vector3&amp; max2 = b2.getMaximum();
-
-			dv.x = min1.x &gt; max2.x ? min1.x - max2.x : min2.x &gt; max1.x ? min2.x - max1.x : 0.0f;
-			dv.y = min1.y &gt; max2.y ? min1.y - max2.y : min2.y &gt; max1.y ? min2.y - max1.y : 0.0f;
-			dv.z = min1.z &gt; max2.z ? min1.z - max2.z : min2.z &gt; max1.z ? min2.z - max1.z : 0.0f;
-
-			return dv.length();
-		}
-	}
-}
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+ */
+
+#include &quot;stdinc.h&quot; //precompiled header
+
+#include &quot;MathUtil.h&quot;
+
+
+using namespace Ogre;
+
+namespace rl
+{
+    const Ogre::Real MathUtil::EPSILON = 0.00001f;
+
+    Ogre::Vector3 MathUtil::sphericalToCartesian(Ogre::Real r,
+        Ogre::Radian azimuth, Ogre::Radian altitude)
+    {
+        Vector3 rval;
+        rval.x = r*Math::Sin(azimuth)*Math::Sin(altitude + Radian(Math::HALF_PI));
+        rval.y = r*Math::Cos(altitude + Radian(Math::HALF_PI));
+        rval.z = r*Math::Cos(azimuth)*Math::Sin(altitude + Radian(Math::HALF_PI));
+        return rval;
+    }
+
+    void MathUtil::cartesianToSpherical(Ogre::Vector3 cartesian, Ogre::Real&amp; r,
+        Ogre::Radian&amp; azimuth, Ogre::Radian&amp; altitude)
+    {
+        r = Math::Sqrt(Math::Sqr(cartesian.x)*Math::Sqr(cartesian.y)*Math::Sqr(cartesian.z));
+        azimuth = Math::ATan2(cartesian.x, cartesian.z);
+        altitude = Math::ACos(cartesian.y/r) - Radian(Math::HALF_PI);
+    }
+
+    Ogre::Real MathUtil::normaliseAngle(Ogre::Real angle)
+	{
+        Ogre::Real ang = angle;
+
+		while (ang &lt; 0) ang += 360;
+		while (ang &gt; 360) ang -= 360;
+
+		return ang;
+	}	
+
+	Real MathUtil::distance(const AxisAlignedBox&amp; b1, const AxisAlignedBox&amp; b2)
+	{
+		if (b1.intersects(b2))
+		{
+			return 0.0f;
+		}
+		else
+		{
+			Vector3 dv;
+
+			const Vector3&amp; min1 = b1.getMinimum();
+			const Vector3&amp; min2 = b2.getMinimum();
+			const Vector3&amp; max1 = b1.getMaximum();
+			const Vector3&amp; max2 = b2.getMaximum();
+
+			dv.x = min1.x &gt; max2.x ? min1.x - max2.x : min2.x &gt; max1.x ? min2.x - max1.x : 0.0f;
+			dv.y = min1.y &gt; max2.y ? min1.y - max2.y : min2.y &gt; max1.y ? min2.y - max1.y : 0.0f;
+			dv.z = min1.z &gt; max2.z ? min1.z - max2.z : min2.z &gt; max1.z ? min2.z - max1.z : 0.0f;
+
+			return dv.length();
+		}
+	}
+    
+	Real MathUtil::distance(const Vector3&amp; v, const AxisAlignedBox&amp; b)
+    {
+        return MathUtil::distance(b, v);
+    }
+    
+	Real MathUtil::distance(const AxisAlignedBox&amp; b, const Vector3&amp; v)
+	{
+		if (b.contains(v))
+		{
+			return 0.0f;
+		}
+		else
+		{
+			Vector3 dv;
+            
+			const Vector3&amp; min1 = b.getMinimum();
+			const Vector3&amp; max1 = b.getMaximum();
+            
+			dv.x = min1.x &gt; v.x ? min1.x - v.x : v.x &gt; max1.x ? v.x - max1.x : 0.0f;
+			dv.y = min1.y &gt; v.y ? min1.y - v.y : v.y &gt; max1.y ? v.y - max1.y : 0.0f;
+			dv.z = min1.z &gt; v.z ? min1.z - v.z : v.z &gt; max1.z ? v.z - max1.z : 0.0f;
+            
+			return dv.length();
+		}
+	}
+}

Modified: rl/branches/persistence/rules/src/GoToJob.cpp
===================================================================
--- rl/branches/persistence/rules/src/GoToJob.cpp	2008-12-01 20:08:06 UTC (rev 4620)
+++ rl/branches/persistence/rules/src/GoToJob.cpp	2008-12-01 20:13:40 UTC (rev 4621)
@@ -60,15 +60,22 @@
 			mActor-&gt;setMovement(CreatureController::MT_STEHEN, Vector3::ZERO, Vector3::ZERO);
 			return true;
 		}
+        
+        Ogre::Real distance;
+        
 		// update target position
 		if (mTarget)
 		{
 			mTargetPos = mTarget-&gt;getPosition();
-		}
-
+            distance = MathUtil::distance(mTarget-&gt;getWorldBoundingBox(),
+                                                     mActor-&gt;getCreature()-&gt;getWorldBoundingBox());
+        }
+        else 
+        {
+            distance = MathUtil::distance(mTargetPos, mActor-&gt;getCreature()-&gt;getWorldBoundingBox());
+        }
+        
 		// Are we there now?
-		Ogre::Real distance = MathUtil::distance(mTarget-&gt;getWorldBoundingBox(),
-			mActor-&gt;getCreature()-&gt;getWorldBoundingBox());
 		if (distance &lt; mMaxDistance)
 		{
 			// Stay put where ever we are.

Modified: rl/branches/persistence/ui/include/AbstractWindow.h
===================================================================
--- rl/branches/persistence/ui/include/AbstractWindow.h	2008-12-01 20:08:06 UTC (rev 4620)
+++ rl/branches/persistence/ui/include/AbstractWindow.h	2008-12-01 20:13:40 UTC (rev 4621)
@@ -22,6 +22,7 @@
 
 #include &lt;CEGUIWindow.h&gt;
 #include &lt;elements/CEGUICheckbox.h&gt;
+#include &lt;elements/CEGUIRadioButton.h&gt;
 #include &lt;elements/CEGUIEditbox.h&gt;
 #include &lt;elements/CEGUIListbox.h&gt;
 #include &lt;elements/CEGUIMultiColumnList.h&gt;
@@ -77,6 +78,7 @@
 		CEGUI::MenuBase* getMenu(const char* name);
 		CEGUI::MenuItem* getMenuItem(const char* name);
 		CEGUI::PushButton* getPushButton(const char* name);
+		CEGUI::RadioButton* getRadioButton(const char* name);
 		CEGUI::Combobox* getCombobox(const char* name);
 		CEGUI::ComboDropList* getComboDropList(const char* name);
         CEGUI::ScrollablePane* getScrollablePane(const char* name);

Modified: rl/branches/persistence/ui/include/GameSettings.h
===================================================================
--- rl/branches/persistence/ui/include/GameSettings.h	2008-12-01 20:08:06 UTC (rev 4620)
+++ rl/branches/persistence/ui/include/GameSettings.h	2008-12-01 20:13:40 UTC (rev 4621)
@@ -84,7 +84,12 @@
 		bool onRenderSystemChanged();
         
         void update();
-
+        
+        void setOption(const Ogre::ConfigOptionMap&amp; configuration, const Ogre::String&amp; option, CEGUI::Checkbox* checkbox);
+        void setOption(const Ogre::ConfigOptionMap&amp; configuration, const Ogre::String&amp; option, CEGUI::Combobox* combobox);
+        void setOption(const Ogre::ConfigOptionMap&amp; configuration, const Ogre::String&amp; option, std::vector&lt;CEGUI::RadioButton*&gt; radioGroup);
+        void createElements(CEGUI::Combobox* combobox, size_t count);
+        
 		std::list&lt;SoundDriverConfigComponent*&gt; mSoundDriverConfigs;   //!&lt; List of registered sounddriver configuration components
 		SoundDriverConfigComponent* mCurrentSoundDriverConfig;        //!&lt; Configuration component of currently selected sound driver
 		std::list&lt;RenderSystemConfigComponent*&gt; mRenderSystemConfigs; //!&lt; List of registered rendersystem configuration components
@@ -93,6 +98,9 @@
         CEGUI::Combobox* mVideoRenderer;
         CEGUI::Combobox* mVideoResolution;
         CEGUI::Checkbox* mVideoFullscreen;
+        CEGUI::RadioButton* mVideoColorDepth32, *mVideoColorDepth16;
+        CEGUI::RadioButton* mVideoFsaa0, *mVideoFsaa2, *mVideoFsaa4, *mVideoFsaa8;
+        CEGUI::RadioButton* mVideoRttModeFBO, *mVideoRttModePBuffer, *mVideoRttModeCopy;
 	};
 }
 

Modified: rl/branches/persistence/ui/src/AbstractWindow.cpp
===================================================================
--- rl/branches/persistence/ui/src/AbstractWindow.cpp	2008-12-01 20:08:06 UTC (rev 4620)
+++ rl/branches/persistence/ui/src/AbstractWindow.cpp	2008-12-01 20:13:40 UTC (rev 4621)
@@ -232,7 +232,12 @@
 	{
 		return static_cast&lt;PushButton*&gt;(getWindow(name, &quot;PushButton&quot;));
 	}
-
+    
+	RadioButton* AbstractWindow::getRadioButton(const char* name)
+	{
+		return static_cast&lt;RadioButton*&gt;(getWindow(name, &quot;RadioButton&quot;));
+	}
+    
 	Combobox* AbstractWindow::getCombobox(const char* name)
 	{
 		return static_cast&lt;Combobox*&gt;(getWindow(name, &quot;Combobox&quot;));

Modified: rl/branches/persistence/ui/src/GameSettings.cpp
===================================================================
--- rl/branches/persistence/ui/src/GameSettings.cpp	2008-12-01 20:08:06 UTC (rev 4620)
+++ rl/branches/persistence/ui/src/GameSettings.cpp	2008-12-01 20:13:40 UTC (rev 4621)
@@ -18,14 +18,22 @@
 #include &quot;GameSettings.h&quot;
 
 #include &lt;boost/bind.hpp&gt;
+#if OGRE_PLATFORM == OGRE_PLATFORM_APPLE
+#include &lt;CEGUI/elements/CEGUIFrameWindow.h&gt;
+#include &lt;CEGUI/elements/CEGUIListboxTextItem.h&gt;
+#else
 #include &lt;elements/CEGUIFrameWindow.h&gt;
 #include &lt;elements/CEGUIListboxTextItem.h&gt;
+#endif
+
 #include &lt;iostream&gt;
 
 #include &quot;SoundManager.h&quot;
 #include &quot;SoundDriver.h&quot;
 
 using namespace Ogre;
+using namespace CEGUI;
+using namespace std;
 
 namespace rl
 {
@@ -51,6 +59,37 @@
         mVideoRenderer = getCombobox(&quot;GameOptionsWindow/Video/Renderer&quot;);
         mVideoResolution = getCombobox(&quot;GameOptionsWindow/Video/Resolution&quot;);
         mVideoFullscreen = getCheckbox(&quot;GameOptionsWindow/Video/Fullscreen&quot;);
+        
+        mVideoColorDepth32 = getRadioButton(&quot;GameOptionsWindow/Video/ColorDepth/32&quot;);
+        mVideoColorDepth32-&gt;setUserData(new Ogre::String(&quot;32&quot;));
+        mVideoColorDepth32-&gt;setGroupID(1);
+        mVideoColorDepth16 = getRadioButton(&quot;GameOptionsWindow/Video/ColorDepth/16&quot;);
+        mVideoColorDepth16-&gt;setUserData(new Ogre::String(&quot;16&quot;));
+        mVideoColorDepth16-&gt;setGroupID(1);
+        
+        mVideoFsaa0 = getRadioButton(&quot;GameOptionsWindow/Video/FSAA/Off&quot;);
+        mVideoFsaa0-&gt;setUserData(new Ogre::String(&quot;0&quot;));
+        mVideoFsaa0-&gt;setGroupID(2);
+        mVideoFsaa2 = getRadioButton(&quot;GameOptionsWindow/Video/FSAA/2x&quot;);
+        mVideoFsaa2-&gt;setUserData(new Ogre::String(&quot;2&quot;));
+        mVideoFsaa2-&gt;setGroupID(2);
+        mVideoFsaa4 = getRadioButton(&quot;GameOptionsWindow/Video/FSAA/4x&quot;);
+        mVideoFsaa4-&gt;setUserData(new Ogre::String(&quot;4&quot;));
+        mVideoFsaa4-&gt;setGroupID(2);
+        mVideoFsaa8 = getRadioButton(&quot;GameOptionsWindow/Video/FSAA/8x&quot;);
+        mVideoFsaa8-&gt;setUserData(new Ogre::String(&quot;8&quot;));
+        mVideoFsaa8-&gt;setGroupID(2);
+        
+        mVideoRttModeFBO = getRadioButton(&quot;GameOptionsWindow/Video/RTT/FBO&quot;);
+        mVideoRttModeFBO-&gt;setUserData(new Ogre::String(&quot;FBO&quot;));
+        mVideoRttModeFBO-&gt;setGroupID(3);
+        mVideoRttModePBuffer = getRadioButton(&quot;GameOptionsWindow/Video/RTT/PBuffer&quot;);
+        mVideoRttModePBuffer-&gt;setUserData(new Ogre::String(&quot;PBuffer&quot;));
+        mVideoRttModePBuffer-&gt;setGroupID(3);
+        mVideoRttModeCopy = getRadioButton(&quot;GameOptionsWindow/Video/RTT/Copy&quot;);
+        mVideoRttModeCopy-&gt;setUserData(new Ogre::String(&quot;Copy&quot;));
+        mVideoRttModeCopy-&gt;setGroupID(3);
+        
         centerWindow();
         setVisible(false);
         update();
@@ -137,50 +176,124 @@
     void GameSettings::update()
     {
         Root* root = Ogre::Root::getSingletonPtr();
+        
+        RenderSystemList* renderers = root-&gt;getAvailableRenderers();
         RenderSystem* renderer = root-&gt;getRenderSystem();
         
+        createElements(mVideoRenderer, renderers-&gt;size());
+
+        for (int i = 0; i &lt; renderers-&gt;size(); ++i)
+        {
+            RenderSystem* cur = renderers-&gt;operator[](i);
+            ListboxItem* item = mVideoRenderer-&gt;getListboxItemFromIndex(i);
+            item-&gt;setText(cur-&gt;getName());
+            if (cur == renderer)
+            {
+                mVideoRenderer-&gt;setItemSelectState(item, true);
+            }
+        }
+        
         ConfigOptionMap config = renderer-&gt;getConfigOptions();
         
-		ConfigOptionMap::iterator cfi;
-		
-		cfi = config.find( &quot;Full Screen&quot; );
-		if( cfi != config.end() )
-		{
-			mVideoFullscreen-&gt;setSelected(cfi-&gt;second.currentValue == &quot;Yes&quot;);
-		}
+        setOption(config, &quot;Full Screen&quot;, mVideoFullscreen);
+        vector&lt;RadioButton*&gt; videoColorDepth;
+        videoColorDepth.push_back(mVideoColorDepth32);
+        videoColorDepth.push_back(mVideoColorDepth16);
         
-/*		cfi = config.find( &quot;FSAA&quot; );
-		if( cfi != config.end() )
-		{
-			if( cfi-&gt;second.currentValue == &quot;0&quot; )
-			{
-				SetControlValue( iFSAARef, 1 );
-			}
-			else if( cfi-&gt;second.currentValue == &quot;2&quot; )
-			{
-				SetControlValue( iFSAARef, 2 );
-			}
-			else if( cfi-&gt;second.currentValue == &quot;4&quot; )
-			{
-				SetControlValue( iFSAARef, 3 );
-			}
-			else if( cfi-&gt;second.currentValue == &quot;6&quot; )
-			{
-				SetControlValue( iFSAARef, 4 );
-			}
-		}
+        setOption(config, &quot;Colour Depth&quot;, videoColorDepth);
+        vector&lt;RadioButton*&gt; videoAntiAliasing;
+        videoAntiAliasing.push_back(mVideoFsaa0);
+        videoAntiAliasing.push_back(mVideoFsaa2);
+        videoAntiAliasing.push_back(mVideoFsaa4);
+        videoAntiAliasing.push_back(mVideoFsaa8);
+        setOption(config, &quot;FSAA&quot;, videoAntiAliasing);
         
-		cfi = config.find( &quot;Colour Depth&quot; );
-		if( cfi != config.end() )
-		{
-			if( cfi-&gt;second.currentValue == &quot;32&quot; )
-			{
-				SetControlValue( iColorDepthRef, 1 );
-			}
-			else
-			{
-				SetControlValue( iColorDepthRef, 2 );
-			}
-		}*/
+        vector&lt;RadioButton*&gt; videoRttMode;
+        videoRttMode.push_back(mVideoRttModeFBO);
+        videoRttMode.push_back(mVideoRttModePBuffer);
+        videoRttMode.push_back(mVideoRttModeCopy);
+        setOption(config, &quot;RTT Preferred Mode&quot;, videoRttMode);
+        
+        setOption(config, &quot;Video Mode&quot;, mVideoResolution);
     }
+    
+    void GameSettings::setOption(const ConfigOptionMap&amp; configuration, const Ogre::String&amp; option, Checkbox* checkbox)
+    {
+        ConfigOptionMap::const_iterator cfi = configuration.find(option);
+        if (cfi != configuration.end()) 
+        {
+            checkbox-&gt;setSelected(cfi-&gt;second.currentValue == &quot;Yes&quot;);            
+        }
+    }
+
+    void GameSettings::setOption(const ConfigOptionMap&amp; configuration, const Ogre::String&amp; option, Combobox* combobox)
+    {
+        ConfigOptionMap::const_iterator cfi = configuration.find(option);
+        if (cfi != configuration.end()) 
+        {
+            ConfigOption curOption = cfi-&gt;second;
+            int delta = curOption.possibleValues.size() - combobox-&gt;getItemCount();
+            if (delta &gt; 0)
+            {
+                for (int i = 0; i &lt; delta; ++i)
+                {
+                    combobox-&gt;addItem(new ListboxTextItem(&quot;&quot;));
+                }
+            }
+            else if (delta &lt; 0)
+            {
+                for (int i = 0; i &lt; -delta; ++i)
+                {
+                    ListboxItem* item = combobox-&gt;getListboxItemFromIndex(combobox-&gt;getItemCount() - 1);
+                    combobox-&gt;removeItem(item);
+                    delete item;
+                }
+            }
+            
+            for (int i = 0; i &lt; combobox-&gt;getItemCount(); ++i)
+            {
+                ListboxItem* item = combobox-&gt;getListboxItemFromIndex(i);
+                item-&gt;setText(curOption.possibleValues[i]);
+            }
+        }
+    }
+
+    void GameSettings::setOption(const ConfigOptionMap&amp; configuration, const Ogre::String&amp; option, std::vector&lt;RadioButton*&gt; radioGroup)
+    {
+        ConfigOptionMap::const_iterator cfi = configuration.find(option);
+        if (cfi != configuration.end()) 
+        {
+            ConfigOption curOption = cfi-&gt;second;
+            for (std::vector&lt;RadioButton*&gt;::const_iterator it = radioGroup.begin(); it != radioGroup.end(); ++it)
+            {
+                Ogre::String* value = static_cast&lt;Ogre::String*&gt;((*it)-&gt;getUserData());
+                if (value &amp;&amp; (*value == curOption.currentValue))
+                {
+                    (*it)-&gt;setSelected(true);
+                    break;
+                }
+            }
+        }
+    }
+    
+    void GameSettings::createElements(CEGUI::Combobox* combobox, size_t count)
+    {
+        int delta = count - combobox-&gt;getItemCount();
+        if (delta &gt; 0)
+        {
+            for (int i = 0; i &lt; delta; ++i)
+            {
+                combobox-&gt;addItem(new ListboxTextItem(&quot;&quot;));
+            }
+        }
+        else if (delta &lt; 0)
+        {
+            for (int i = 0; i &lt; -delta; ++i)
+            {
+                ListboxItem* item = combobox-&gt;getListboxItemFromIndex(combobox-&gt;getItemCount() - 1);
+                combobox-&gt;removeItem(item);
+                delete item;
+            }
+        }
+    }    
 }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001677.html">[Dsa-hl-svn] r4620 - in rl/trunk/engine/common: include src
</A></li>
	<LI>Next message: <A HREF="001679.html">[Dsa-hl-svn] r4622 - modules/common/dsa
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1678">[ date ]</a>
              <a href="thread.html#1678">[ thread ]</a>
              <a href="subject.html#1678">[ subject ]</a>
              <a href="author.html#1678">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
