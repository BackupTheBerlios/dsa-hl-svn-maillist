<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3451 - modules/regressiontest/dsa	rl/trunk/engine/rules/include rl/trunk/engine/rules/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-May/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3451%20-%20modules/regressiontest/dsa%0A%09rl/trunk/engine/rules/include%20rl/trunk/engine/rules/src&In-Reply-To=%3C200705170710.l4H7ADPT027752%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000521.html">
   <LINK REL="Next"  HREF="000523.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3451 - modules/regressiontest/dsa	rl/trunk/engine/rules/include rl/trunk/engine/rules/src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3451%20-%20modules/regressiontest/dsa%0A%09rl/trunk/engine/rules/include%20rl/trunk/engine/rules/src&In-Reply-To=%3C200705170710.l4H7ADPT027752%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3451 - modules/regressiontest/dsa	rl/trunk/engine/rules/include rl/trunk/engine/rules/src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Thu May 17 09:10:13 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000521.html">[Dsa-hl-svn] r3450 - in rl/trunk: . engine/common/include	engine/common/src engine/core engine/core/include	engine/core/src engine/script/swig tools
</A></li>
        <LI>Next message: <A HREF="000523.html">[Dsa-hl-svn] r3452 - modules/regressiontest/maps	modules/regressiontest/scripts	modules/regressiontest/scripts/maps rl/trunk/engine/rules	rl/trunk/engine/rules/include rl/trunk/engine/rules/src	rl/trunk/engine/script/swig
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#522">[ date ]</a>
              <a href="thread.html#522">[ thread ]</a>
              <a href="subject.html#522">[ subject ]</a>
              <a href="author.html#522">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2007-05-17 09:10:07 +0200 (Thu, 17 May 2007)
New Revision: 3451

Added:
   modules/regressiontest/dsa/mapmeshparttest.gof
Modified:
   rl/trunk/engine/rules/include/GameObject.h
   rl/trunk/engine/rules/src/GameObject.cpp
Log:
Properties for &quot;mesh construction kit&quot; parts

Added: modules/regressiontest/dsa/mapmeshparttest.gof
===================================================================
--- modules/regressiontest/dsa/mapmeshparttest.gof	2007-05-17 07:08:08 UTC (rev 3450)
+++ modules/regressiontest/dsa/mapmeshparttest.gof	2007-05-17 07:10:07 UTC (rev 3451)
@@ -0,0 +1,44 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
+&lt;GameObjectDefinitions&gt;
+
+    &lt;gameobjectclass classid=&quot;M.C.K. test object&quot; baseclass=&quot;GameObject&quot;&gt;
+        &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;M.C.K. Test object&quot;/&gt;
+        &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;This is the testing object for the M.C.K.&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
+        &lt;property name=&quot;meshparts&quot; type=&quot;MAP&quot;&gt;
+            &lt;property name=&quot;torso&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
+            &lt;property name=&quot;hand&quot; type=&quot;STRING&quot; data=&quot;men_human_female_hand_nude.mesh&quot;/&gt;
+            &lt;property name=&quot;head&quot; type=&quot;STRING&quot; data=&quot;men_human_female_head02.mesh&quot;/&gt;
+            &lt;property name=&quot;hair&quot; type=&quot;STRING&quot; data=&quot;men_human_female_hair_long01_normal.mesh&quot;/&gt;
+            &lt;property name=&quot;leg&quot; type=&quot;STRING&quot; data=&quot;men_human_female_leg_pants01_long.mesh&quot;/&gt;
+            &lt;property name=&quot;feet&quot; type=&quot;STRING&quot; data=&quot;men_human_female_feet_boots01.mesh&quot;/&gt;
+        &lt;/property&gt;
+    &lt;/gameobjectclass&gt;
+
+    &lt;gameobjectclass classid=&quot;M.C.K. test creature&quot; baseclass=&quot;Creature&quot;&gt;
+        &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;M.C.K. Test creature&quot;/&gt;
+        &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;This is the testing creature for the M.C.K.&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
+        &lt;property name=&quot;meshparts&quot; type=&quot;MAP&quot;&gt;
+            &lt;property name=&quot;torso&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
+            &lt;property name=&quot;hand&quot; type=&quot;STRING&quot; data=&quot;men_human_female_hand_nude.mesh&quot;/&gt;
+            &lt;property name=&quot;head&quot; type=&quot;STRING&quot; data=&quot;men_human_female_head02.mesh&quot;/&gt;
+            &lt;property name=&quot;hair&quot; type=&quot;STRING&quot; data=&quot;men_human_female_hair_long01_normal.mesh&quot;/&gt;
+            &lt;property name=&quot;leg&quot; type=&quot;STRING&quot; data=&quot;men_human_female_leg_pants01_long.mesh&quot;/&gt;
+            &lt;property name=&quot;feet&quot; type=&quot;STRING&quot; data=&quot;men_human_female_feet_boots01.mesh&quot;/&gt;
+        &lt;/property&gt;
+    &lt;/gameobjectclass&gt;
+
+    &lt;gameobjectclass classid=&quot;M.C.K. test item 1&quot; baseclass=&quot;Item&quot;&gt;
+        &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;M.C.K. Test item I&quot;/&gt;
+        &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;This is the 1st testing item for the M.C.K.&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;men_human_female_armor_garethplatte.mesh&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+
+    &lt;gameobjectclass classid=&quot;M.C.K. test item 2&quot; baseclass=&quot;Item&quot;&gt;
+        &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;M.C.K. Test item II&quot;/&gt;
+        &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;This is the 2nd testing item for the M.C.K.&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;men_human_female_armor_kroetenhaut.mesh&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+
+&lt;/GameObjectDefinitions&gt;

Modified: rl/trunk/engine/rules/include/GameObject.h
===================================================================
--- rl/trunk/engine/rules/include/GameObject.h	2007-05-17 07:08:08 UTC (rev 3450)
+++ rl/trunk/engine/rules/include/GameObject.h	2007-05-17 07:10:07 UTC (rev 3451)
@@ -58,7 +58,8 @@
         static const Ogre::String PROPERTY_NAME;
         static const Ogre::String PROPERTY_DESCRIPTION; 
         static const Ogre::String PROPERTY_MESHFILE; 
-        static const Ogre::String PROPERTY_GEOMETRY_TYPE; 
+  		static const Ogre::String PROPERTY_MESHPARTS; 
+		static const Ogre::String PROPERTY_GEOMETRY_TYPE; 
         static const Ogre::String PROPERTY_MASS; 
         static const Ogre::String PROPERTY_ACTIONS; 
         static const Ogre::String PROPERTY_DEFAULT_ACTION;
@@ -162,6 +163,7 @@
         CeGuiString mName;
         CeGuiString mDescription;
         CeGuiString mMeshfile;
+		MeshPartMap mMeshParts;
         Ogre::String mClassId;
         
         Actor* mActor;

Modified: rl/trunk/engine/rules/src/GameObject.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObject.cpp	2007-05-17 07:08:08 UTC (rev 3450)
+++ rl/trunk/engine/rules/src/GameObject.cpp	2007-05-17 07:10:07 UTC (rev 3451)
@@ -43,6 +43,7 @@
     const Ogre::String GameObject::PROPERTY_NAME = &quot;name&quot;; 
     const Ogre::String GameObject::PROPERTY_DESCRIPTION = &quot;description&quot;; 
     const Ogre::String GameObject::PROPERTY_MESHFILE = &quot;meshfile&quot;; 
+	const Ogre::String GameObject::PROPERTY_MESHPARTS = &quot;meshparts&quot;; 
     const Ogre::String GameObject::PROPERTY_GEOMETRY_TYPE = &quot;geometrytype&quot;; 
     const Ogre::String GameObject::PROPERTY_MASS = &quot;mass&quot;; 
     const Ogre::String GameObject::PROPERTY_ACTIONS = &quot;actions&quot;;
@@ -53,6 +54,7 @@
             mName(&quot;&quot;),
             mDescription(&quot;&quot;),
             mMeshfile(&quot;&quot;),
+			mMeshParts(),
             mQueryFlags(QUERYFLAG_GAMEOBJECT),
             mHighlightingEnabled(true),
             mActor(NULL),
@@ -425,6 +427,16 @@
         {
             prop.setValue(mMass);
         }
+		else if (key == PROPERTY_MESHPARTS)
+		{
+			PropertyMap map;
+			for (MeshPartMap::const_iterator
+					it = mMeshParts.begin(); it != mMeshParts.end(); ++it)
+			{
+				map[(*it).first] = Property((*it).second);
+			}
+			prop.setValue(map);
+		}
         else
         {
             Throw(IllegalArgumentException, key + &quot; is not a property of this gameobject (&quot;+mName.c_str()+&quot;)&quot;);
@@ -457,6 +469,15 @@
             {
                 setMeshfile(value.toString());
             }
+            else if (key == PROPERTY_MESHPARTS)
+            {
+				PropertyMap map = value.toMap();
+				for (PropertyMap::const_iterator 
+					it = map.begin(); it != map.end(); ++it)
+				{
+					mMeshParts[(*it).first.c_str()] = (*it).second.toString().c_str();
+				}
+            }
             else if (key == PROPERTY_GEOMETRY_TYPE)
             {
                 setGeometryType(PhysicsManager::convertStringToGeometryType(value.toString().c_str()));            
@@ -519,6 +540,7 @@
         ps-&gt;setProperty(PROPERTY_POSITION, Property(getPosition()));
         ps-&gt;setProperty(PROPERTY_ORIENTATION, Property(getOrientation()));
         ps-&gt;setProperty(PROPERTY_MESHFILE, Property(mMeshfile));
+        ps-&gt;setProperty(PROPERTY_MESHPARTS, getProperty(PROPERTY_MESHPARTS));
         ps-&gt;setProperty(PROPERTY_GEOMETRY_TYPE, Property(mGeometryType));
         ps-&gt;setProperty(PROPERTY_MASS, Property(mMass));
 
@@ -530,24 +552,40 @@
         if (mActor == NULL)
         {
             Ogre::String actorName = Ogre::StringConverter::toString(mId);
+			Actor* actor = NULL;
 
+			if (mMeshfile.empty() &amp;&amp; mMeshParts.empty())
+			{
+				LOG_ERROR(
+					Logger::RULES, 
+					&quot;Neither mesh file nor mesh parts are set on gameobject '&quot; + getName()
+					+ &quot;' (id: &quot; + getId() + &quot;). Can't create actor!&quot;);
+			}
+			else if (!mMeshParts.empty())
+			{
+				actor = ActorManager::getSingleton().createMeshActor(
+						actorName,
+						mMeshfile.c_str(),
+						mMeshParts,
+						mGeometryType,
+						mMass);
+			}
+			else
+			{
+				actor = ActorManager::getSingleton().createMeshActor(
+						actorName,
+						mMeshfile.c_str(),
+						mGeometryType,
+						mMass);
+			}
 
-            Actor* actor = ActorManager::getSingleton().createMeshActor(
-                    actorName,
-                    mMeshfile.c_str(),
-                    mGeometryType,
-                    mMass);
-
-            if (actor == NULL)
-            {
-                LOG_ERROR(
-                    Logger::RULES, 
-                    &quot;Error creating actor '&quot;
-                    + actorName
-                    + &quot;' with mesh file &quot;
-                    + mMeshfile);
-            }
-
+			if (actor == NULL)
+			{
+				LOG_ERROR(
+					Logger::RULES, 
+					&quot;Error creating actor '&quot;
+					+ actorName	+ &quot;'.&quot;);
+			}
             return actor;
         }
         else


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000521.html">[Dsa-hl-svn] r3450 - in rl/trunk: . engine/common/include	engine/common/src engine/core engine/core/include	engine/core/src engine/script/swig tools
</A></li>
	<LI>Next message: <A HREF="000523.html">[Dsa-hl-svn] r3452 - modules/regressiontest/maps	modules/regressiontest/scripts	modules/regressiontest/scripts/maps rl/trunk/engine/rules	rl/trunk/engine/rules/include rl/trunk/engine/rules/src	rl/trunk/engine/script/swig
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#522">[ date ]</a>
              <a href="thread.html#522">[ thread ]</a>
              <a href="subject.html#522">[ subject ]</a>
              <a href="author.html#522">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
