From no22 at mail.berlios.de  Sat Sep  1 04:19:21 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Sat, 1 Sep 2007 04:19:21 +0200
Subject: [Dsa-hl-svn] r3780 - in rl/trunk/engine: rules/include rules/src
	script/swig
Message-ID: <200709010219.l812JLRB022256@sheep.berlios.de>

Author: no22
Date: 2007-09-01 04:19:01 +0200 (Sat, 01 Sep 2007)
New Revision: 3780

Modified:
   rl/trunk/engine/rules/include/Effect.h
   rl/trunk/engine/rules/src/CreatureControllerManager.cpp
   rl/trunk/engine/rules/src/Effect.cpp
   rl/trunk/engine/rules/src/EffectManager.cpp
   rl/trunk/engine/script/swig/RlRules.swig
Log:
* renamed Effect.test() to Effect.check(), which is more appropiate due to the "new" effect system and was renamed already in the ruby scripts, which caused crashes
* fixed a typo in an error log message in the CreatureController

Modified: rl/trunk/engine/rules/include/Effect.h
===================================================================
--- rl/trunk/engine/rules/include/Effect.h	2007-08-31 20:39:52 UTC (rev 3779)
+++ rl/trunk/engine/rules/include/Effect.h	2007-09-01 02:19:01 UTC (rev 3780)
@@ -114,7 +114,7 @@
          * @return Returns the time to the next check. If REMOVE is returned, the 
          * effect will be removed, if PERMANENT is returned, the effect lasts permanently.
          **/
-		virtual RL_LONGLONG test();
+		virtual RL_LONGLONG check();
         
         /// Returns the status that is applied to the creature by this effect.
         virtual Status getStatus();

Modified: rl/trunk/engine/rules/src/CreatureControllerManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/CreatureControllerManager.cpp	2007-08-31 20:39:52 UTC (rev 3779)
+++ rl/trunk/engine/rules/src/CreatureControllerManager.cpp	2007-09-01 02:19:01 UTC (rev 3780)
@@ -132,8 +132,8 @@
 
             if (it == mBodyControllers.end())
             {
-                LOG_ERROR(Logger::RULES,
-                    "Der Kollisionsk?rper konnte keiner Creature zugeordner werden.");
+                //LOG_ERROR(Logger::RULES,
+                //    "Der Kollisionsk?rper konnte keiner Creature zugeordnet werden.");
                 return 1;
             }
         }

Modified: rl/trunk/engine/rules/src/Effect.cpp
===================================================================
--- rl/trunk/engine/rules/src/Effect.cpp	2007-08-31 20:39:52 UTC (rev 3779)
+++ rl/trunk/engine/rules/src/Effect.cpp	2007-09-01 02:19:01 UTC (rev 3780)
@@ -87,7 +87,7 @@
 		}
 	}
 
-    RL_LONGLONG Effect::test()
+    RL_LONGLONG Effect::check()
     {
       return PERMANENT;
     }

Modified: rl/trunk/engine/rules/src/EffectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/EffectManager.cpp	2007-08-31 20:39:52 UTC (rev 3779)
+++ rl/trunk/engine/rules/src/EffectManager.cpp	2007-09-01 02:19:01 UTC (rev 3780)
@@ -15,6 +15,8 @@
  */
 #include "stdinc.h" //precompiled header
 
+#include <sstream>
+
 #include "EffectManager.h"
 #include "DsaManager.h"
 #include "Exception.h"
@@ -44,11 +46,14 @@
         if (checkIt == mChecklist.end()) return;
         while ( checkIt != mChecklist.end() && checkIt->first <= now )
         {
-			std::cout << "Effect check: " << checkIt->first << " now: " << now << std::endl;
+				std::stringstream debugInfo;
+				debugInfo << "Effect check: " << checkIt->first << " now: " << now << std::endl;
+                LOG_DEBUG(Logger::RULES,
+					debugInfo.str());
             for (Effects::iterator effIt = checkIt->second.begin(); effIt != checkIt->second.end(); effIt++)
             {
                 int nextCheck;
-                nextCheck = (*effIt)->test();
+                nextCheck = (*effIt)->check();
                 switch (nextCheck)
                 {
                   case Effect::REMOVE:
@@ -72,6 +77,10 @@
         // Get current ingame time and add timeUntilCheck
         RL_LONGLONG now = DsaManager::getSingleton().getTimestamp();
         RL_LONGLONG timeForCheck = now + timeUntilCheck;
+				std::stringstream debugInfo;
+				debugInfo << "Adding check! now:" << now << " check: " << timeForCheck << std::endl;
+                LOG_DEBUG(Logger::RULES,
+					debugInfo.str());
         // Insert Sum and effect into the checklist
         mChecklist[timeForCheck].insert(effect);
     }
@@ -83,12 +92,20 @@
         if (date <= now) Throw(IllegalArgumentException, "date lies in the past!");
         if (effect == NULL) Throw(IllegalArgumentException, "effect pointer is NULL!");
         // Insert date and effect into the checklist
+				std::stringstream debugInfo;
+				debugInfo << "Adding check! now:" << now << " check: " << date << std::endl;
+                LOG_DEBUG(Logger::RULES,
+					debugInfo.str());
         mChecklist[date].insert(effect);
     }
 
 
 	void EffectManager::addEffect(Effect* effect)
 	{
+				std::stringstream debugInfo;
+				debugInfo << "Adding effect " << effect->getName() << std::endl;
+                LOG_DEBUG(Logger::RULES,
+					debugInfo.str());
 		for (Effects::iterator it = mEffects.begin(); it != mEffects.end(); it++)
 		{
 			if ((*it)->getName() == effect->getName())

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2007-08-31 20:39:52 UTC (rev 3779)
+++ rl/trunk/engine/script/swig/RlRules.swig	2007-09-01 02:19:01 UTC (rev 3780)
@@ -590,7 +590,7 @@
         virtual void decreaseStufe();
         virtual void enable();
         virtual void disable();
-        virtual RL_LONGLONG test() = 0;
+        virtual RL_LONGLONG check() = 0;
 
         virtual Status getStatus();
         virtual int getMod(rl::CeGuiString target, ModType type, ModTag tag);



From no22 at mail.berlios.de  Sat Sep  1 04:34:22 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Sat, 1 Sep 2007 04:34:22 +0200
Subject: [Dsa-hl-svn] r3781 - rl/trunk/engine/rules/src
Message-ID: <200709010234.l812YMBu022843@sheep.berlios.de>

Author: no22
Date: 2007-09-01 04:34:19 +0200 (Sat, 01 Sep 2007)
New Revision: 3781

Modified:
   rl/trunk/engine/rules/src/CreatureControllerManager.cpp
Log:
* accidently commented annoying error message out

Modified: rl/trunk/engine/rules/src/CreatureControllerManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/CreatureControllerManager.cpp	2007-09-01 02:19:01 UTC (rev 3780)
+++ rl/trunk/engine/rules/src/CreatureControllerManager.cpp	2007-09-01 02:34:19 UTC (rev 3781)
@@ -132,8 +132,8 @@
 
             if (it == mBodyControllers.end())
             {
-                //LOG_ERROR(Logger::RULES,
-                //    "Der Kollisionsk?rper konnte keiner Creature zugeordnet werden.");
+                LOG_ERROR(Logger::RULES,
+                    "Der Kollisionsk?rper konnte keiner Creature zugeordnet werden.");
                 return 1;
             }
         }



From melven at mail.berlios.de  Sat Sep  1 14:10:32 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sat, 1 Sep 2007 14:10:32 +0200
Subject: [Dsa-hl-svn] r3782 - in rl/trunk/engine: rules/include rules/src
	script/swig
Message-ID: <200709011210.l81CAW0E017521@sheep.berlios.de>

Author: melven
Date: 2007-09-01 14:10:15 +0200 (Sat, 01 Sep 2007)
New Revision: 3782

Modified:
   rl/trunk/engine/rules/include/Talent.h
   rl/trunk/engine/rules/src/DsaDataLoader.cpp
   rl/trunk/engine/rules/src/Talent.cpp
   rl/trunk/engine/script/swig/RlRules.swig
Log:
added Ausweich-Talente.
Definitions int eh xdi file like this:
        <Talent ID="Tanzen">
          <Probe>CH/GE/GE</Probe>
          <Art>Basis</Art>
          <eBE>BEx2</eBE>
          <Spezialisierungen>
            <Spezialisierung>Ausdruckst?\195?\164nze</Spezialisierung>
            <Spezialisierung>Formationst?\195?\164nze</Spezialisierung>
            <Spezialisierung>Meditationst?\195?\164nze</Spezialisierung>
          </Spezialisierungen>
          <Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
	  <Ausweichtalente>
            <Ausweichtalent ID="K?\195?\182rperbeherrschung">
              <Aufschlag>10</Aufschlag>
            </Ausweichtalent>
            <Ausweichtalent ID="Taschendiebstahl">
              <Aufschlag>5</Aufschlag>
            </Ausweichtalent>
          </Ausweichtalente>
        </Talent>

Modified: rl/trunk/engine/rules/include/Talent.h
===================================================================
--- rl/trunk/engine/rules/include/Talent.h	2007-09-01 02:34:19 UTC (rev 3781)
+++ rl/trunk/engine/rules/include/Talent.h	2007-09-01 12:10:15 UTC (rev 3782)
@@ -33,7 +33,8 @@
                const EigenschaftTripel& eigenschaften,
                int ebe,
 			   int gruppe,
-			   const CeGuiString art);
+			   const CeGuiString art,
+               const AusweichTalente& ausweichTalente);
 
         bool operator==(const Talent& rhs) const;
         bool operator<(const Talent& rhs) const;

Modified: rl/trunk/engine/rules/src/DsaDataLoader.cpp
===================================================================
--- rl/trunk/engine/rules/src/DsaDataLoader.cpp	2007-09-01 02:34:19 UTC (rev 3781)
+++ rl/trunk/engine/rules/src/DsaDataLoader.cpp	2007-09-01 12:10:15 UTC (rev 3782)
@@ -116,6 +116,8 @@
         CeGuiString probe = XmlHelper::getValueAsString(XmlHelper::getChildNamed(talentXml, "Probe"));
         CeGuiString art = XmlHelper::getValueAsString(XmlHelper::getChildNamed(talentXml, "Art"));
 		DOMElement* eBeNode = XmlHelper::getChildNamed(talentXml, "eBE");
+        DOMElement* ausweichTalenteNode = static_cast<DOMElement*>(XmlHelper::getChildNamed(talentXml, "Ausweichtalente"));
+
 		int ebe = EBE_KEINE_BE;
         if (eBeNode != NULL)
 			ebe = getEBeFromString(AutoChar(eBeNode->getFirstChild()->getNodeValue()).data());
@@ -128,14 +130,31 @@
         eigenschaften.third = probe.substr(6,2);
 		probe.clear();
 
+        // process AusweichTalente
+        Talent::AusweichTalente ausweichTalente;
+        if( ausweichTalenteNode )
+        {
+	        DOMNodeList* ausweichTalentGruppen =
+                ausweichTalenteNode->getElementsByTagName(AutoXMLCh("Ausweichtalent").data());
+            for( unsigned int ausweich = 0; ausweich < ausweichTalentGruppen->getLength(); ausweich++ )
+            {
+			    DOMElement* ausweichData = static_cast<DOMElement*>(ausweichTalentGruppen->item(ausweich));
+	            CeGuiString ausweichName = XmlHelper::transcodeToString(
+                    ausweichData->getAttribute(AutoXMLCh("ID").data()));
+
+                ausweichTalente[ausweichName] = 
+                    XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(ausweichData, "Aufschlag"));
+            }
+        }
+
         Talent* t = new Talent(
 			name,
             desc,
             eigenschaften,
             ebe,
             gruppe,
-			art);
-        // @todo DOMNodeList* ausweichTalenteNode = XmlHelper::getChildNamed(talentXml, "Ausweichtalente");
+			art,
+            ausweichTalente);
 
         return t;
     }

Modified: rl/trunk/engine/rules/src/Talent.cpp
===================================================================
--- rl/trunk/engine/rules/src/Talent.cpp	2007-09-01 02:34:19 UTC (rev 3781)
+++ rl/trunk/engine/rules/src/Talent.cpp	2007-09-01 12:10:15 UTC (rev 3782)
@@ -25,7 +25,8 @@
                    const EigenschaftTripel& eigenschaften,
                    int ebe,
 				   int gruppe,
-				   const CeGuiString art)
+				   const CeGuiString art,
+                   const AusweichTalente& ausweichTalente)
                                        : mName(name),
                                          mDescription(description),
                                          mEigenschaften(eigenschaften),
@@ -33,6 +34,7 @@
 										 mTalentGruppe(gruppe),
 										 mArt(art)
     {
+        mAusweichTalente = ausweichTalente;
     }
 
     bool Talent::operator==(const Talent& rhs) const

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2007-09-01 02:34:19 UTC (rev 3781)
+++ rl/trunk/engine/script/swig/RlRules.swig	2007-09-01 12:10:15 UTC (rev 3782)
@@ -213,12 +213,14 @@
     class Talent
     {
     public:
+        typedef std::map<const rl::CeGuiString,int> AusweichTalente;
         Talent(const rl::CeGuiString name,
                const rl::CeGuiString description,
                const Tripel<rl::CeGuiString>& eigenschaften,
                int ebe,
                int gruppe,
-               const rl::CeGuiString art);
+               const rl::CeGuiString art,
+               const AusweichTalente &ausweichTalente);
 
         bool operator==(const Talent& rhs) const;
         bool operator<(const Talent& rhs) const;



From no22 at mail.berlios.de  Sat Sep  1 17:17:33 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Sat, 1 Sep 2007 17:17:33 +0200
Subject: [Dsa-hl-svn] r3783 - modules/common/dsa
Message-ID: <200709011517.l81FHX0F026550@sheep.berlios.de>

Author: no22
Date: 2007-09-01 17:17:20 +0200 (Sat, 01 Sep 2007)
New Revision: 3783

Modified:
   modules/common/dsa/basis.xdi
Log:
*Added Ausweichtalente of k?\195?\182rperliche Talente

Modified: modules/common/dsa/basis.xdi
===================================================================
--- modules/common/dsa/basis.xdi	2007-09-01 12:10:15 UTC (rev 3782)
+++ modules/common/dsa/basis.xdi	2007-09-01 15:17:20 UTC (rev 3783)
@@ -1,1550 +1,1643 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <XDIML lang="de" version="1.01">
-  <Inhalt>
-    <Personen>
-    </Personen>
-    <Rassen>
-    </Rassen>
-    <Kulturen>
-    </Kulturen>
-    <Professionen>
-    </Professionen>
-    <Talente>
-      <Talentgruppe ID="K?rperliche Talente">
-        <Talent ID="Akrobatik">
-          <Probe>MU/GE/KK</Probe>
-          <Art>Spezial</Art>
-          <eBE>BEx2</eBE>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="K?rperbeherrschung">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Balancieren</Spezialisierung>
-            <Spezialisierung>Bodenakrobatik</Spezialisierung>
-            <Spezialisierung>Schwingen</Spezialisierung>
-            <Spezialisierung>Spr?nge</Spezialisierung>
-            <Spezialisierung>Winden</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
-        </Talent>
-        <Talent ID="Athletik">
-          <Probe>GE/KO/KK</Probe>
-          <Art>Spezial</Art>
-          <eBE>BEx2</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Hochsprung</Spezialisierung>
-            <Spezialisierung>Kraftakte</Spezialisierung>
-            <Spezialisierung>Langlauf</Spezialisierung>
-            <Spezialisierung>Sprint</Spezialisierung>
-            <Spezialisierung>Weitsprung</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
-        </Talent>
-        <Talent ID="Fliegen">
-          <Probe>MU/IN/GE</Probe>
-          <Art>Spezial</Art>
-          <eBE>BE</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Hexenbesen</Spezialisierung>
-            <Spezialisierung>Fliegender Teppich</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
-        </Talent>
-        <Talent ID="Gaukeleien">
-          <Probe>MU/CH/FF</Probe>
-          <Art>Spezial</Art>
-          <eBE>BEx2</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Bauchreden</Spezialisierung>
-            <Spezialisierung>Feuerkunst</Spezialisierung>
-            <Spezialisierung>Jonglieren</Spezialisierung>
-            <Spezialisierung>Possenrei?en</Spezialisierung>
-            <Spezialisierung>Taschenspielereien</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
-        </Talent>
-        <Talent ID="Klettern">
-          <Probe>MU/GE/KK</Probe>
-          <Art>Basis</Art>
-          <eBE>BEx2</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Bergsteigen</Spezialisierung>
-            <Spezialisierung>Eisklettern</Spezialisierung>
-            <Spezialisierung>Freiklettern</Spezialisierung>
-            <Spezialisierung>Seilklettern</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
-        </Talent>
-        <Talent ID="K?rperbeherrschung">
-          <Probe>MU/IN/GE</Probe>
-          <Art>Basis</Art>
-          <eBE>BEx2</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Fallen</Spezialisierung>
-            <Spezialisierung>Spr?nge</Spezialisierung>
-            <Spezialisierung>Standfestigkeit</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
-        </Talent>
-        <Talent ID="Reiten">
-          <Probe>CH/GE/KK</Probe>
-          <Art>Spezial</Art>
-          <eBE>BE-2</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Pferd/Esel/Muli</Spezialisierung>
-            <Spezialisierung>Kamel</Spezialisierung>
-            <Spezialisierung>Strau?</Spezialisierung>
-            <Spezialisierung>Reitechse</Spezialisierung>
-            <Spezialisierung>Flugechse</Spezialisierung>
-            <Spezialisierung>Hippogriff</Spezialisierung>
-            <Spezialisierung>goblinisches Reit-Wildschwein</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
-        </Talent>
-        <Talent ID="Schleichen">
-          <Probe>MU/IN/GE</Probe>
-          <Art>Basis</Art>
-          <eBE>BE</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Eis und Schnee</Spezialisierung>
-            <Spezialisierung>Geb?ude</Spezialisierung>
-            <Spezialisierung>Ger?ll</Spezialisierung>
-            <Spezialisierung>Stra?en</Spezialisierung>
-            <Spezialisierung>Wald und Dschungel</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
-        </Talent>
-        <Talent ID="Schwimmen">
-          <Probe>GE/KO/KK</Probe>
-          <Art>Basis</Art>
-          <eBE>BEx2</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Langstreckenschwimmen</Spezialisierung>
-            <Spezialisierung>Schnellschwimmen</Spezialisierung>
-            <Spezialisierung>Tauchen</Spezialisierung>
-            <Spezialisierung>Unterwasserkampf</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
-        </Talent>
-        <Talent ID="Selbstbeherrschung">
-          <Probe>MU/KO/KK</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Ersch?pfungen Ignorieren</Spezialisierung>
-            <Spezialisierung>Schmerz Unterdr?cken</Spezialisierung>
-            <Spezialisierung>St?rungen Ignorieren</Spezialisierung>
-            <Spezialisierung>Wunden Ignorieren</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
-        </Talent>
-        <Talent ID="Sich Verstecken">
-          <Probe>MU/IN/GE</Probe>
-          <Art>Basis</Art>
-          <eBE>BE-2</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Geb?ude</Spezialisierung>
-            <Spezialisierung>Gebirge</Spezialisierung>
-            <Spezialisierung>Grasland</Spezialisierung>
-            <Spezialisierung>Eis und Schnee</Spezialisierung>
-            <Spezialisierung>Stadt</Spezialisierung>
-            <Spezialisierung>Wald und Dschungel</Spezialisierung>
-            <Spezialisierung>W?ste</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-        </Talent>
-        <Talent ID="Singen">
-          <Probe>IN/CH/CH</Probe>
-          <Art>Basis</Art>
-          <eBE>BE-3</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Balladenvortrag</Spezialisierung>
-            <Spezialisierung>Chorgesang</Spezialisierung>
-            <Spezialisierung>Mehrstimmigkeit</Spezialisierung>
-            <Spezialisierung>Operngesang</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-        </Talent>
-        <Talent ID="Sinnensch?rfe">
-          <Probe>KL/IN/IN</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>H?ren</Spezialisierung>
-            <Spezialisierung>Riechen und Schmecken</Spezialisierung>
-            <Spezialisierung>Sehen</Spezialisierung>
-            <Spezialisierung>Tasten</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-        </Talent>
-        <Talent ID="Skifahren">
-          <Probe>GE/GE/KO</Probe>
-          <Art>Spezial</Art>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-        </Talent>
-        <Talent ID="Stimmen Imitieren">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Spezial</Art>
-          <eBE>BE-4</eBE>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Sinnensch?rfe">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Haustiere</Spezialisierung>
-            <Spezialisierung>Jagdwild</Spezialisierung>
-            <Spezialisierung>Menschliche Stimmen</Spezialisierung>
-            <Spezialisierung>Raubtiere</Spezialisierung>
-            <Spezialisierung>V?gel</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-        </Talent>
-        <Talent ID="Tanzen">
-          <Probe>CH/GE/GE</Probe>
-          <Art>Basis</Art>
-          <eBE>BEx2</eBE>
-          <Spezialisierungen>
-            <Spezialisierung>Ausdruckst?nze</Spezialisierung>
-            <Spezialisierung>Formationst?nze</Spezialisierung>
-            <Spezialisierung>Meditationst?nze</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-        </Talent>
-        <Talent ID="Taschendiebstahl">
-          <Probe>MU/IN/FF</Probe>
-          <Art>Spezial</Art>
-          <eBE>BEx2</eBE>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Menschenkenntnis">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-        </Talent>
-        <Talent ID="Zechen">
-          <Probe>IN/KO/KK</Probe>
-          <Art>Basis</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-        </Talent>
-      </Talentgruppe>
-      <Talentgruppe ID="Gesellschaftliche Talente">
-        <Talent ID="Bet?ren">
-          <Probe>IN/CH/CH</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Menschenkenntnis">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
-        </Talent>
-        <Talent ID="Etikette">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
-        </Talent>
-        <Talent ID="Galanterie">
-          <Probe>IN/CH/FF</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Festgestaltung</Spezialisierung>
-            <Spezialisierung>Garderobe und Schminke</Spezialisierung>
-            <Spezialisierung>Liebesk?nste</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
-        </Talent>
-        <Talent ID="Gassenwissen">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Beschatten</Spezialisierung>
-            <Spezialisierung>Hehlerei</Spezialisierung>
-            <Spezialisierung>Kontakte</Spezialisierung>
-            <Spezialisierung>Ortseinsch?tzung</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
-        </Talent>
-        <Talent ID="Lehren">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Menschenkenntnis">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Kampftalente</Spezialisierung>
-            <Spezialisierung>K?rperliche Talente</Spezialisierung>
-            <Spezialisierung>Gesellschaftliche Talente</Spezialisierung>
-            <Spezialisierung>Natur-Talente</Spezialisierung>
-            <Spezialisierung>Wissenstalente</Spezialisierung>
-            <Spezialisierung>Handwerkstalente</Spezialisierung>
-            <Spezialisierung>Sprachen und Schriften</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
-        </Talent>
-        <Talent ID="Menschenkenntnis">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Basis</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 23/24</Beschreibung>
-        </Talent>
-        <Talent ID="Schauspielerei">
-          <Probe>MU/KL/CH</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Etikette">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Sich Verkleiden">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Singen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="?berreden">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="?berzeugen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Kom?die</Spezialisierung>
-            <Spezialisierung>Possen</Spezialisierung>
-            <Spezialisierung>Trag?die</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 24</Beschreibung>
-        </Talent>
-        <Talent ID="Schriftlicher Ausdruck">
-          <Probe>KL/IN/IN</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Schreiber</Spezialisierung>
-            <Spezialisierung>Schriftsteller</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 24</Beschreibung>
-        </Talent>
-        <Talent ID="Sich Verkleiden">
-          <Probe>MU/CH/GE</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>anderer Stand</Spezialisierung>
-            <Spezialisierung>anderes Geschlecht</Spezialisierung>
-            <Spezialisierung>andere Rolle</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 24</Beschreibung>
-        </Talent>
-        <Talent ID="?berreden">
-          <Probe>MU/IN/CH</Probe>
-          <Art>Basis</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Menschenkenntnis">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Aufwiegeln</Spezialisierung>
-            <Spezialisierung>Betteln</Spezialisierung>
-            <Spezialisierung>Einsch?chtern</Spezialisierung>
-            <Spezialisierung>Feilschen</Spezialisierung>
-            <Spezialisierung>L?gen</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 24/25</Beschreibung>
-        </Talent>
-        <Talent ID="?berzeugen">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Menschenkenntnis">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Demagogie, Pl?doyer oder Predigt</Spezialisierung>
-            <Spezialisierung>Einzelgespr?ch und Verh?r</Spezialisierung>
-            <Spezialisierung>Diskussions-Rhetorik</Spezialisierung>
-            <Spezialisierung>schriftliche Rhetorik</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 25</Beschreibung>
-        </Talent>
-      </Talentgruppe>
-      <Talentgruppe ID="Natur-Talente">
-        <Talent ID="Fallenstellen">
-          <Probe>KL/FF/KK</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Wildnisleben">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Gruben</Spezialisierung>
-            <Spezialisierung>Schlingen</Spezialisierung>
-            <Spezialisierung>Speere</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 25/26</Beschreibung>
-        </Talent>
-        <Talent ID="Fesseln / Entfesseln">
-          <Probe>FF/GE/KK</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Entfesseln</Spezialisierung>
-            <Spezialisierung>Fesseln</Spezialisierung>
-            <Spezialisierung>Knotenkunde</Spezialisierung>
-            <Spezialisierung>Taue Splei?en</Spezialisierung>
-            <Spezialisierung>Netze Kn?pfen</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
-        </Talent>
-        <Talent ID="Fischen / Angeln">
-          <Probe>IN/FF/KK</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Fl?sse und B?che</Spezialisierung>
-            <Spezialisierung>Hochseeangeln</Spezialisierung>
-            <Spezialisierung>Seen, Sumpf oder Brackwasser</Spezialisierung>
-            <Spezialisierung>Strand und Riff</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
-        </Talent>
-        <Talent ID="F?hrtensuchen">
-          <Probe>KL/IN/KO</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Eis und Schnee</Spezialisierung>
-            <Spezialisierung>Gebirge</Spezialisierung>
-            <Spezialisierung>Grasland</Spezialisierung>
-            <Spezialisierung>Stadt</Spezialisierung>
-            <Spezialisierung>Sumpf</Spezialisierung>
-            <Spezialisierung>Unterirdisch</Spezialisierung>
-            <Spezialisierung>Wald und Dschungel</Spezialisierung>
-            <Spezialisierung>W?ste</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 25</Beschreibung>
-        </Talent>
-        <Talent ID="Orientierung">
-          <Probe>KL/IN/IN</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Dschungel</Spezialisierung>
-            <Spezialisierung>Eis und Schnee</Spezialisierung>
-            <Spezialisierung>Gebirge</Spezialisierung>
-            <Spezialisierung>Grasland</Spezialisierung>
-            <Spezialisierung>Meer</Spezialisierung>
-            <Spezialisierung>Stadt</Spezialisierung>
-            <Spezialisierung>Unterirdisch</Spezialisierung>
-            <Spezialisierung>Wald</Spezialisierung>
-            <Spezialisierung>W?ste</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
-        </Talent>
-        <Talent ID="Seefischerei">
-          <Probe>IN/FF/KK</Probe>
-          <Art>Beruf</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
-        </Talent>
-        <Talent ID="Wettervorhersage">
-          <Probe>KL/IN/IN</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
-        </Talent>
-        <Talent ID="Wildnisleben">
-          <Probe>IN/GE/KO</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Dschungel</Spezialisierung>
-            <Spezialisierung>Eis und Schnee</Spezialisierung>
-            <Spezialisierung>Gebirge</Spezialisierung>
-            <Spezialisierung>Meer</Spezialisierung>
-            <Spezialisierung>Steppe</Spezialisierung>
-            <Spezialisierung>Sumpf</Spezialisierung>
-            <Spezialisierung>Wald</Spezialisierung>
-            <Spezialisierung>W?ste</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
-        </Talent>
-      </Talentgruppe>
-      <Talentgruppe ID="Wissenstalente">
-        <Talent ID="Anatomie">
-          <Probe>MU/KL/FF</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Totenangst">
-              <kein/>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
-        </Talent>
-        <Talent ID="Baukunst">
-          <Probe>KL/KL/FF</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Malen / Zeichnen">
-              <Wert ID="minimal">5</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Rechnen">
-              <Wert ID="minimal">5</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Hochbau</Spezialisierung>
-            <Spezialisierung>Tiefbau</Spezialisierung>
-            <Spezialisierung>Wehranlagen</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
-        </Talent>
-        <Talent ID="Brettspiel">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
-        </Talent>
-        <Talent ID="Geographie">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
-        </Talent>
-        <Talent ID="Geschichtswissen">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
-        </Talent>
-        <Talent ID="Gesteinskunde">
-          <Probe>KL/IN/FF</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Baugestein</Spezialisierung>
-            <Spezialisierung>Edelmetalle</Spezialisierung>
-            <Spezialisierung>Edelsteine</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
-        </Talent>
-        <Talent ID="G?tter und Kulte">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Basis</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
-        </Talent>
-        <Talent ID="Heraldik">
-          <Probe>KL/KL/FF</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
-        </Talent>
-        <Talent ID="H?ttenkunde">
-          <Probe>KL/IN/KO</Probe>
-          <Art>Beruf</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
-        </Talent>
-        <Talent ID="Kriegskunst">
-          <Probe>MU/KL/CH</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Logistik</Spezialisierung>
-            <Spezialisierung>Milit?rgeschichte</Spezialisierung>
-            <Spezialisierung>Monstren</Spezialisierung>
-            <Spezialisierung>Seegefechte</Spezialisierung>
-            <Spezialisierung>Strategie</Spezialisierung>
-            <Spezialisierung>Taktik</Spezialisierung>
-            <Spezialisierung>Drachenbek?mpfung</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
-        </Talent>
-        <Talent ID="Kryptographie">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Malen / Zeichnen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Rechnen">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Sprachenkunde">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
-        </Talent>
-        <Talent ID="Magiekunde">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Artefaktherstellung</Spezialisierung>
-            <Spezialisierung>D?monologie</Spezialisierung>
-            <Spezialisierung>Elementarismus</Spezialisierung>
-            <Spezialisierung>Magiehistorie</Spezialisierung>
-            <Spezialisierung>Magietheorie</Spezialisierung>
-            <Spezialisierung>Magische Analyse</Spezialisierung>
-            <Spezialisierung>Sph?rologie</Spezialisierung>
-            <Spezialisierung>Zauberpraxis</Spezialisierung>
-            <Spezialisierung>Zauberwerkstatt</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
-        </Talent>
-        <Talent ID="Mechanik">
-          <Probe>KL/KL/FF</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Malen / Zeichnen">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Rechnen">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Belagerungswaffen</Spezialisierung>
-            <Spezialisierung>Kr?ne, Hebewerke und Mahlwerke</Spezialisierung>
-            <Spezialisierung>Materialkunde</Spezialisierung>
-            <Spezialisierung>Pumpen und Wasserkraft</Spezialisierung>
-            <Spezialisierung>Windkraft</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
-        </Talent>
-        <Talent ID="Pflanzenkunde">
-          <Probe>KL/IN/FF</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Dschungel</Spezialisierung>
-            <Spezialisierung>Gebirge</Spezialisierung>
-            <Spezialisierung>Grasland</Spezialisierung>
-            <Spezialisierung>Meer</Spezialisierung>
-            <Spezialisierung>Steppe</Spezialisierung>
-            <Spezialisierung>Sumpf</Spezialisierung>
-            <Spezialisierung>Tundra</Spezialisierung>
-            <Spezialisierung>Wlad</Spezialisierung>
-            <Spezialisierung>W?ste</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
-        </Talent>
-        <Talent ID="Philosophie">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 29/30</Beschreibung>
-        </Talent>
-        <Talent ID="Rechnen">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Arithemtik</Spezialisierung>
-            <Spezialisierung>Buchf?hrung</Spezialisierung>
-            <Spezialisierung>Geometrie</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
-        </Talent>
-        <Talent ID="Rechtskunde">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Gildenrecht</Spezialisierung>
-            <Spezialisierung>Kirchenrecht</Spezialisierung>
-            <Spezialisierung>Strafrecht</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
-        </Talent>
-        <Talent ID="Sagen / Legenden">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Basis</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
-        </Talent>
-        <Talent ID="Schiffbau">
-          <Probe>KL/KL/FF</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Malen / Zeichnen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Rechnen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
-        </Talent>
-        <Talent ID="Sch?tzen">
-          <Probe>KL/IN/IN</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Antiquit?ten</Spezialisierung>
-            <Spezialisierung>Materialwert</Spezialisierung>
-            <Spezialisierung>Schmuck</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
-        </Talent>
-        <Talent ID="Sprachenkunde">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 30/31</Beschreibung>
-        </Talent>
-        <Talent ID="Staatskunst">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Diplomatie</Spezialisierung>
-            <Spezialisierung>Intrige</Spezialisierung>
-            <Spezialisierung>Verwaltung</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 31</Beschreibung>
-        </Talent>
-        <Talent ID="Sternkunde">
-          <Probe>KL/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Rechnen">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Sinnensch?rfe">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Himmelskartographie</Spezialisierung>
-            <Spezialisierung>Horoskope</Spezialisierung>
-            <Spezialisierung>Navigation</Spezialisierung>
-            <Spezialisierung>Zeitbestimmung</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 31</Beschreibung>
-        </Talent>
-        <Talent ID="Tierkunde">
-          <Probe>MU/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Drachen</Spezialisierung>
-            <Spezialisierung>Jagdwild</Spezialisierung>
-            <Spezialisierung>Meeresgetier</Spezialisierung>
-            <Spezialisierung>Monstren</Spezialisierung>
-            <Spezialisierung>Nutztiere</Spezialisierung>
-            <Spezialisierung>Raubtiere</Spezialisierung>
-            <Spezialisierung>Sch?dlinge</Spezialisierung>
-            <Spezialisierung>Vielbeiner</Spezialisierung>
-            <Spezialisierung>V?gel</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 31</Beschreibung>
-        </Talent>
-      </Talentgruppe>
-      <Talentgruppe ID="Handwerkliche Talente">
-        <Talent ID="Abrichten">
-          <Probe>MU/IN/CH</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Tierkunde">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Dompteur</Spezialisierung>
-            <Spezialisierung>Falkner</Spezialisierung>
-            <Spezialisierung>Hundef?hrer</Spezialisierung>
-            <Spezialisierung>Zureiter</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 33/34</Beschreibung>
-        </Talent>
-        <Talent ID="Ackerbau">
-          <Probe>IN/FF/KO</Probe>
-          <Art>Beruf</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
-        </Talent>
-        <Talent ID="Alchimie">
-          <Probe>MU/KL/FF</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Rechnen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Brandmittel</Spezialisierung>
-            <Spezialisierung>Gifte</Spezialisierung>
-            <Spezialisierung>Laborpraxis</Spezialisierung>
-            <Spezialisierung>Zauber-Elixiere</Spezialisierung>
-            <Spezialisierung>Farben und Lacke</Spezialisierung>
-            <Spezialisierung>Gl?se</Spezialisierung>
-            <Spezialisierung>Porzellan</Spezialisierung>
-            <Spezialisierung>Legierungen</Spezialisierung>
-            <Spezialisierung>Goldmacherei</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
-        </Talent>
-        <Talent ID="Bergbau">
-          <Probe>IN/KO/KK</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Gesteinskunde">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Bergwerke</Spezialisierung>
-            <Spezialisierung>Kanalisation</Spezialisierung>
-            <Spezialisierung>nat?rliche H?hlen</Spezialisierung>
-            <Spezialisierung>Sappeur</Spezialisierung>
-            <Spezialisierung>unterirdische St?dte</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
-        </Talent>
-        <Talent ID="Bogenbau">
-          <Probe>KL/IN/FF</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Holzbearbeitung">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Armbrust</Spezialisierung>
-            <Spezialisierung>Bogen</Spezialisierung>
-            <Spezialisierung>Bolzen und Pfeile</Spezialisierung>
-            <Spezialisierung>Torsionswaffen</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
-        </Talent>
-        <Talent ID="Boote Fahren">
-          <Probe>GE/KO/KK</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Einmaster Segeln</Spezialisierung>
-            <Spezialisierung>Fl??e Staken</Spezialisierung>
-            <Spezialisierung>Kanus und Kajaks Paddeln</Spezialisierung>
-            <Spezialisierung>Ruderboote Rudern</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
-        </Talent>
-        <Talent ID="Brauer">
-          <Probe>KL/FF/KK</Probe>
-          <Art>Beruf</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
-        </Talent>
-        <Talent ID="Drucker">
-          <Probe>KL/FF/KO</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Malen / Zeichnen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Mechanik">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Buchdruck</Spezialisierung>
-            <Spezialisierung>Druckereitechnologie</Spezialisierung>
-            <Spezialisierung>Pamphlete</Spezialisierung>
-            <Spezialisierung>Typographie</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
-        </Talent>
-        <Talent ID="Eissegler Fahren">
-          <Probe>IN/GE/KK</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 34/35</Beschreibung>
-        </Talent>
-        <Talent ID="Fahrzeug Lenken">
-          <Probe>IN/CH/FF</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Lastkarren</Spezialisierung>
-            <Spezialisierung>Streitwagen</Spezialisierung>
-            <Spezialisierung>Zuggespanne</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
-        </Talent>
-        <Talent ID="Falschspiel">
-          <Probe>MU/CH/FF</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Menschenkenntnis">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>W?rfel</Spezialisierung>
-            <Spezialisierung>Karten</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
-        </Talent>
-        <Talent ID="Feinmechanik">
-          <Probe>KL/FF/FF</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Malen / Zeichnen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Gold- und Silberschmied</Spezialisierung>
-            <Spezialisierung>Gravieren</Spezialisierung>
-            <Spezialisierung>Schl?sser</Spezialisierung>
-            <Spezialisierung>Siegelst?cke</Spezialisierung>
-            <Spezialisierung>Trickwaffen und Fallen</Spezialisierung>
-            <Spezialisierung>Uhrwerke</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
-        </Talent>
-        <Talent ID="Feuersteinbearbeitung">
-          <Probe>KL/FF/FF</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
-        </Talent>
-        <Talent ID="Fleischer">
-          <Probe>KL/FF/KK</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Fische</Spezialisierung>
-            <Spezialisierung>Gefl?gel</Spezialisierung>
-            <Spezialisierung>Reptilien</Spezialisierung>
-            <Spezialisierung>S?ugetiere</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
-        </Talent>
-        <Talent ID="Gerber / K?rschner">
-          <Probe>KL/FF/KO</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Gerber</Spezialisierung>
-            <Spezialisierung>K?rschner</Spezialisierung>
-            <Spezialisierung>Troph?en</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
-        </Talent>
-        <Talent ID="Glaskunst">
-          <Probe>FF/FF/KO</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Fensterscheiben</Spezialisierung>
-            <Spezialisierung>Glasbl?serei</Spezialisierung>
-            <Spezialisierung>Linsenschleifen</Spezialisierung>
-            <Spezialisierung>Spiegel</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
-        </Talent>
-        <Talent ID="Grobschmied">
-          <Probe>FF/KK/KO</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Drahtzieher</Spezialisierung>
-            <Spezialisierung>Hufschmied</Spezialisierung>
-            <Spezialisierung>Pl?ttner</Spezialisierung>
-            <Spezialisierung>Schwarzschmied</Spezialisierung>
-            <Spezialisierung>Spengler</Spezialisierung>
-            <Spezialisierung>Waffenschmied</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
-        </Talent>
-        <Talent ID="Handel">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Rechnen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 35/36</Beschreibung>
-        </Talent>
-        <Talent ID="Hauswirtschaft">
-          <Probe>IN/CH/FF</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Bewirtung und Feiern</Spezialisierung>
-            <Spezialisierung>Personal</Spezialisierung>
-            <Spezialisierung>Vorratshaltung</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 36</Beschreibung>
-        </Talent>
-        <Talent ID="Heilkunde Gift">
-          <Probe>MU/KL/IN</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 36</Beschreibung>
-        </Talent>
-        <Talent ID="Heilkunde Krankheiten">
-          <Probe>MU/KL/CH</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 36</Beschreibung>
-        </Talent>
-        <Talent ID="Heilkunde Seele">
-          <Probe>IN/CH/CH</Probe>
-          <Art>Beruf</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 36/37</Beschreibung>
-        </Talent>
-        <Talent ID="Heilkunde Wunden">
-          <Probe>KL/CH/FF</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Br?che und Quetschungen</Spezialisierung>
-            <Spezialisierung>Schnitte</Spezialisierung>
-            <Spezialisierung>Verbrennungen</Spezialisierung>
-            <Spezialisierung>Zahnleiden</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 37</Beschreibung>
-        </Talent>
-        <Talent ID="Holzbearbeitung">
-          <Probe>KL/FF/KK</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Beinschnitzerei</Spezialisierung>
-            <Spezialisierung>Holzkunde</Spezialisierung>
-            <Spezialisierung>Holzwaffen</Spezialisierung>
-            <Spezialisierung>K?fer und Wagner</Spezialisierung>
-            <Spezialisierung>M?belschreinerei und Tichlerei</Spezialisierung>
-            <Spezialisierung>Schnitzen</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
-        </Talent>
-        <Talent ID="Hundeschlitten Fahren">
-          <Probe>CH/FF/GE</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
-        </Talent>
-        <Talent ID="Instrumentenbauer">
-          <Probe>KL/IN/FF</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Feinmechanik">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Holzbearbeitung">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Musizieren">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Blasinstrumente</Spezialisierung>
-            <Spezialisierung>Saiteninstrumente</Spezialisierung>
-            <Spezialisierung>Tasteninstrumente</Spezialisierung>
-            <Spezialisierung>Trommeln</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
-        </Talent>
-        <Talent ID="Kapellmeister">
-          <Probe>KL/IN/CH</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Lesen / Schreiben">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Musizieren">
-              <Wert ID="minimal">7</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Dirigieren</Spezialisierung>
-            <Spezialisierung>Komponieren</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
-        </Talent>
-        <Talent ID="Kartographie">
-          <Probe>KL/KL/FF</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Malen / Zeichnen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Geb?ude</Spezialisierung>
-            <Spezialisierung>H?hlen und Tunnel</Spezialisierung>
-            <Spezialisierung>K?sten und Meere</Spezialisierung>
-            <Spezialisierung>Landschaften</Spezialisierung>
-            <Spezialisierung>Stadt</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
-        </Talent>
-        <Talent ID="Kochen">
-          <Probe>KL/IN/FF</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Backen und Braten</Spezialisierung>
-            <Spezialisierung>Festmahle</Spezialisierung>
-            <Spezialisierung>Haltbarmachen</Spezialisierung>
-            <Spezialisierung>Marschversorgung</Spezialisierung>
-            <Spezialisierung>Tr?nke</Spezialisierung>
-            <Spezialisierung>Vorkoster</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
-        </Talent>
-        <Talent ID="Kristallzucht">
-          <Probe>KL/IN/FF</Probe>
-          <Art>Beruf</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
-        </Talent>
-        <Talent ID="Lederarbeiten">
-          <Probe>KL/FF/FF</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Gurte und Riemen</Spezialisierung>
-            <Spezialisierung>Lederkleidung</Spezialisierung>
-            <Spezialisierung>Lederr?stung</Spezialisierung>
-            <Spezialisierung>S?ttel</Spezialisierung>
-            <Spezialisierung>Schuhwerk</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 38/39</Beschreibung>
-        </Talent>
-        <Talent ID="Malen / Zeichnen">
-          <Probe>KL/IN/FF</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Architektur</Spezialisierung>
-            <Spezialisierung>Landschaften</Spezialisierung>
-            <Spezialisierung>Portr?t</Spezialisierung>
-            <Spezialisierung>technische Skizze</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
-        </Talent>
-        <Talent ID="Maurer">
-          <Probe>FF/GE/KK</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Steinbau</Spezialisierung>
-            <Spezialisierung>Steinguss</Spezialisierung>
-            <Spezialisierung>Ziegelbau</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
-        </Talent>
-        <Talent ID="Metallguss">
-          <Probe>KL/FF/KK</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="H?ttenkunde">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Klangk?rper</Spezialisierung>
-            <Spezialisierung>Rohre</Spezialisierung>
-            <Spezialisierung>Reliefplatten und Statuen</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
-        </Talent>
-        <Talent ID="Musizieren">
-          <Probe>IN/CH/FF</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Blechblasinstrumente</Spezialisierung>
-            <Spezialisierung>Fl?ten</Spezialisierung>
-            <Spezialisierung>Harfen</Spezialisierung>
-            <Spezialisierung>Lauten</Spezialisierung>
-            <Spezialisierung>Rhythmusinstrumente</Spezialisierung>
-            <Spezialisierung>Streichinstrumente</Spezialisierung>
-            <Spezialisierung>Tasteninstrumente</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
-        </Talent>
-        <Talent ID="Schl?sser Knacken">
-          <Probe>IN/FF/FF</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Fallen</Spezialisierung>
-            <Spezialisierung>Schl?sser</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
-        </Talent>
-        <Talent ID="Schnaps Brennen">
-          <Probe>KL/IN/FF</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>alchimistische Destillation</Spezialisierung>
-            <Spezialisierung>Beeren- und Obstbr?nde</Spezialisierung>
-            <Spezialisierung>Kornbr?nde</Spezialisierung>
-            <Spezialisierung>Kr?uterschn?pse</Spezialisierung>
-            <Spezialisierung>Lagerung</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
-        </Talent>
-        <Talent ID="Schneidern">
-          <Probe>KL/FF/FF</Probe>
-          <Art>Basis</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Entwurf und Festgew?nder</Spezialisierung>
-            <Spezialisierung>Flcik und Gebrauchsschneiderei</Spezialisierung>
-            <Spezialisierung>Tuchr?stung</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
-        </Talent>
-        <Talent ID="Seefahrt">
-          <Probe>FF/GE/KK</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Ruderschiff</Spezialisierung>
-            <Spezialisierung>Segelschiff</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
-        </Talent>
-        <Talent ID="Seiler">
-          <Probe>FF/FF/KK</Probe>
-          <Art>Beruf</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 39/40</Beschreibung>
-        </Talent>
-        <Talent ID="Steinmetz">
-          <Probe>FF/FF/KK</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Gesteinskunde">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Baugestein</Spezialisierung>
-            <Spezialisierung>Reliefs</Spezialisierung>
-            <Spezialisierung>Statuen</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="Steinschneider / Juwelier">
-          <Probe>IN/FF/FF</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Gesteinskunde">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="Stellmacher">
-          <Probe>KL/FF/KK</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Grobschmied">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Holzbearbeitung">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-            <Voraussetzung ID="Lederarbeiten">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Karren und Wagen</Spezialisierung>
-            <Spezialisierung>Schlitten</Spezialisierung>
-            <Spezialisierung>Streitwagen</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="Steuermann">
-          <Probe>IN/CH/KK</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Seefahrt">
-              <Wert ID="minimal">6</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Ruderschiff</Spezialisierung>
-            <Spezialisierung>Segelschiff</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="Stoffe F?rben">
-          <Probe>KL/FF/KK</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>alchimistische Farben</Spezialisierung>
-            <Spezialisierung>mineralische Farben</Spezialisierung>
-            <Spezialisierung>pflanzliche Farben</Spezialisierung>
-            <Spezialisierung>tierische Farben</Spezialisierung>
-            <Spezialisierung>Stoffdruck</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="T?towieren">
-          <Probe>IN/FF/FF</Probe>
-          <Art>Spezial</Art>
-          <Voraussetzungen ID="allgemein">
-            <Voraussetzung ID="Malen / Zeichnen">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Naturalistische Darstellungen</Spezialisierung>
-            <Spezialisierung>Ornamente</Spezialisierung>
-            <Spezialisierung>Zaubert?towierungen</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="T?pfern">
-          <Probe>KL/FF/FF</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Gef??e</Spezialisierung>
-            <Spezialisierung>Statuetten</Spezialisierung>
-            <Spezialisierung>Ziegelei</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="Viehzucht">
-          <Probe>KL/IN/KK</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Rind</Spezialisierung>
-            <Spezialisierung>Schaf und Ziege</Spezialisierung>
-            <Spezialisierung>Schwein</Spezialisierung>
-            <Spezialisierung>Pferd</Spezialisierung>
-            <Spezialisierung>Hund</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="Webkunst">
-          <Probe>FF/FF/KK</Probe>
-          <Art>Spezial</Art>
-          <Spezialisierungen>
-            <Spezialisierung>H?keln</Spezialisierung>
-            <Spezialisierung>Kl?ppeln</Spezialisierung>
-            <Spezialisierung>Stricken</Spezialisierung>
-            <Spezialisierung>Teppichkn?pfen</Spezialisierung>
-            <Spezialisierung>Weben</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="Winzer">
-          <Probe>KL/FF/KK</Probe>
-          <Art>Beruf</Art>
-          <Spezialisierungen>
-            <Spezialisierung>Wein</Spezialisierung>
-            <Spezialisierung>Fruchtweine</Spezialisierung>
-            <Spezialisierung>Schaumweine</Spezialisierung>
-            <Spezialisierung>Weinkenner</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-        <Talent ID="Zimmermann">
-          <Probe>KL/FF/KK</Probe>
-          <Art>Beruf</Art>
-          <Voraussetzungen ID="meisterlich">
-            <Voraussetzung ID="Holzbearbeitung">
-              <Wert ID="minimal">4</Wert>
-            </Voraussetzung>
-          </Voraussetzungen>
-          <Spezialisierungen>
-            <Spezialisierung>Dachdecker</Spezialisierung>
-            <Spezialisierung>Holzkonstruktionen</Spezialisierung>
-            <Spezialisierung>Schiffszimmermann</Spezialisierung>
-          </Spezialisierungen>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
-        </Talent>
-      </Talentgruppe>
-      <Talentgruppe ID="Sprachen &amp; Schriften">
-        <Talent ID="Lesen / Schreiben">
-          <Probe>KL/KL/FF</Probe>
-          <Art>Spezial</Art>
-          <Beschreibung>siehe Mit Flinken Fingern, S. 31-33</Beschreibung>
-        </Talent>
-      </Talentgruppe>
-    </Talente>
-    <Sprachen>
-    </Sprachen>
-    <Schriften>
-    </Schriften>
-    <Kampftechniken>
-      <Kampfart ID="Bewaffneter Nahkampf">
-        <Kampftechnik ID="Anderthalbh?nder">
-          <Art>Spezial</Art>
-          <SKT-Spalte>E</SKT-Spalte>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 74</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Dolche">
-          <Art>Basis</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-1</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Fechtwaffen">
-          <Art>Spezial</Art>
-          <SKT-Spalte>E</SKT-Spalte>
-          <eBE>BE-1</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Hiebwaffen">
-          <Art>Basis</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-4</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Infanteriewaffen">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-3</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Kettenst?be">
-          <Art>Spezial</Art>
-          <SKT-Spalte>E</SKT-Spalte>
-          <eBE>BE-1</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Kettenwaffen">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-3</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Schwerter">
-          <Art>Spezial</Art>
-          <SKT-Spalte>E</SKT-Spalte>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Speere">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-3</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="St?be">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="S?bel">
-          <Art>Basis</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 76/77</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Zweihand-Hiebwaffen">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-3</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 78</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Zweihandflegel">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-3</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 78</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Zweihandschwerter und -s?bel">
-          <Art>Spezial</Art>
-          <SKT-Spalte>E</SKT-Spalte>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 78</Beschreibung>
-        </Kampftechnik>
-      </Kampfart>
-      <Kampfart ID="Bewaffneter Kampf">
-        <Kampftechnik ID="Lanzenreiten">
-          <Art>Spezial</Art>
-          <SKT-Spalte>E</SKT-Spalte>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 58 und 76</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Peitsche">
-          <Art>Spezial</Art>
-          <SKT-Spalte>E</SKT-Spalte>
-          <eBE>BE-1</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
-        </Kampftechnik>
-      </Kampfart>
-      <Kampfart ID="Waffenloser Kampf">
-        <Kampftechnik ID="Raufen">
-          <Art>Basis</Art>
-          <SKT-Spalte>C</SKT-Spalte>
-          <eBE>BE</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Ringen">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
-        </Kampftechnik>
-      </Kampfart>
-      <Kampfart ID="Fernkampf">
-        <Kampftechnik ID="Armbrust">
-          <Art>Spezial</Art>
-          <SKT-Spalte>C</SKT-Spalte>
-          <eBE>BE-5</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 74</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Belagerungswaffen">
-          <Art>Beruf</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 74/75</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Blasrohr">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-5</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Bogen">
-          <Art>Spezial</Art>
-          <SKT-Spalte>E</SKT-Spalte>
-          <eBE>BE-3</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Diskus">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Schleuder">
-          <Art>Spezial</Art>
-          <SKT-Spalte>E</SKT-Spalte>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Wurfbeile">
-          <Art>Spezial</Art>
-          <SKT-Spalte>D</SKT-Spalte>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Wurfmesser">
-          <Art>Basis</Art>
-          <SKT-Spalte>C</SKT-Spalte>
-          <eBE>BE-3</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
-        </Kampftechnik>
-        <Kampftechnik ID="Wurfspeere">
-          <Art>Spezial</Art>
-          <SKT-Spalte>C</SKT-Spalte>
-          <eBE>BE-2</eBE>
-          <Beschreibung>siehe Mit Blitzenden Klingen, S. 77/78</Beschreibung>
-        </Kampftechnik>
-      </Kampfart>
-    </Kampftechniken>
-    <Charakteristika>
-    </Charakteristika>
-    <Sonderfertigkeiten>
-    </Sonderfertigkeiten>
-    <Zauberspr?che>
-    </Zauberspr?che>
-  </Inhalt>
+	<Inhalt>
+		<Personen>
+		</Personen>
+		<Rassen>
+		</Rassen>
+		<Kulturen>
+		</Kulturen>
+		<Professionen>
+		</Professionen>
+		<Talente>
+			<Talentgruppe ID="K?rperliche Talente">
+				<Talent ID="Akrobatik">
+					<Probe>MU/GE/KK</Probe>
+					<Art>Spezial</Art>
+					<eBE>BEx2</eBE>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="K?rperbeherrschung">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Balancieren</Spezialisierung>
+						<Spezialisierung>Bodenakrobatik</Spezialisierung>
+						<Spezialisierung>Schwingen</Spezialisierung>
+						<Spezialisierung>Spr?nge</Spezialisierung>
+						<Spezialisierung>Winden</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="K?rperbeherrschung">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Athletik">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Athletik">
+					<Probe>GE/KO/KK</Probe>
+					<Art>Spezial</Art>
+					<eBE>BEx2</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Hochsprung</Spezialisierung>
+						<Spezialisierung>Kraftakte</Spezialisierung>
+						<Spezialisierung>Langlauf</Spezialisierung>
+						<Spezialisierung>Sprint</Spezialisierung>
+						<Spezialisierung>Weitsprung</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="K?rperbeherrschung">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Akrobatik">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Fliegen">
+					<Probe>MU/IN/GE</Probe>
+					<Art>Spezial</Art>
+					<eBE>BE</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Hexenbesen</Spezialisierung>
+						<Spezialisierung>Fliegender Teppich</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Akrobatik">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Gaukeleien">
+					<Probe>MU/CH/FF</Probe>
+					<Art>Spezial</Art>
+					<eBE>BEx2</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Bauchreden</Spezialisierung>
+						<Spezialisierung>Feuerkunst</Spezialisierung>
+						<Spezialisierung>Jonglieren</Spezialisierung>
+						<Spezialisierung>Possenrei?en</Spezialisierung>
+						<Spezialisierung>Taschenspielereien</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Taschendiebstahl">
+							<Ausweichwert>10</Ausweichwert>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Falschspiel">
+							<Ausweichwert>10</Ausweichwert>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Klettern">
+					<Probe>MU/GE/KK</Probe>
+					<Art>Basis</Art>
+					<eBE>BEx2</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Bergsteigen</Spezialisierung>
+						<Spezialisierung>Eisklettern</Spezialisierung>
+						<Spezialisierung>Freiklettern</Spezialisierung>
+						<Spezialisierung>Seilklettern</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Athletik">
+							<Ausweichwert>5</Ausweichwert>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Akrobatik">
+							<Ausweichwert>5</Ausweichwert>
+						</Ausweichtalent>
+						<Ausweichtalent ID="K?rperbeherrschung">
+							<Ausweichwert>10</Ausweichwert>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="K?rperbeherrschung">
+					<Probe>MU/IN/GE</Probe>
+					<Art>Basis</Art>
+					<eBE>BEx2</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Fallen</Spezialisierung>
+						<Spezialisierung>Spr?nge</Spezialisierung>
+						<Spezialisierung>Standfestigkeit</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Akrobatik">
+							<Ausweichwert>5</Ausweichwert>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Athletik">
+							<Ausweichwert>10</Ausweichwert>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Reiten">
+					<Probe>CH/GE/KK</Probe>
+					<Art>Spezial</Art>
+					<eBE>BE-2</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Pferd/Esel/Muli</Spezialisierung>
+						<Spezialisierung>Kamel</Spezialisierung>
+						<Spezialisierung>Strau?</Spezialisierung>
+						<Spezialisierung>Reitechse</Spezialisierung>
+						<Spezialisierung>Flugechse</Spezialisierung>
+						<Spezialisierung>Hippogriff</Spezialisierung>
+						<Spezialisierung>goblinisches Reit-Wildschwein</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="K?rperbeherrschung">
+							<Ausweichwert>10</Ausweichwert>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Akrobatik">
+							<Ausweichwert>15</Ausweichwert>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Schleichen">
+					<Probe>MU/IN/GE</Probe>
+					<Art>Basis</Art>
+					<eBE>BE</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Eis und Schnee</Spezialisierung>
+						<Spezialisierung>Geb?ude</Spezialisierung>
+						<Spezialisierung>Ger?ll</Spezialisierung>
+						<Spezialisierung>Stra?en</Spezialisierung>
+						<Spezialisierung>Wald und Dschungel</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="K?rperbeherrschung">
+							<Ausweichwert>10</Ausweichwert>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Sich Verstecken">
+							<Ausweichwert>10</Ausweichwert>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Schwimmen">
+					<Probe>GE/KO/KK</Probe>
+					<Art>Basis</Art>
+					<eBE>BEx2</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Langstreckenschwimmen</Spezialisierung>
+						<Spezialisierung>Schnellschwimmen</Spezialisierung>
+						<Spezialisierung>Tauchen</Spezialisierung>
+						<Spezialisierung>Unterwasserkampf</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Athletik">
+							<Ausweichwert>15</Ausweichwert>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Selbstbeherrschung">
+					<Probe>MU/KO/KK</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Ersch?pfungen Ignorieren</Spezialisierung>
+						<Spezialisierung>Schmerz Unterdr?cken</Spezialisierung>
+						<Spezialisierung>St?rungen Ignorieren</Spezialisierung>
+						<Spezialisierung>Wunden Ignorieren</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
+				</Talent>
+				<Talent ID="Sich Verstecken">
+					<Probe>MU/IN/GE</Probe>
+					<Art>Basis</Art>
+					<eBE>BE-2</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Geb?ude</Spezialisierung>
+						<Spezialisierung>Gebirge</Spezialisierung>
+						<Spezialisierung>Grasland</Spezialisierung>
+						<Spezialisierung>Eis und Schnee</Spezialisierung>
+						<Spezialisierung>Stadt</Spezialisierung>
+						<Spezialisierung>Wald und Dschungel</Spezialisierung>
+						<Spezialisierung>W?ste</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Schleichen">
+							<Ausweichwert>10</Ausweichwert>
+						</Ausweichtalent>
+						<Ausweichtalent ID="K?rperbeherrschung">
+							<Ausweichwert>15</Ausweichwert>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Singen">
+					<Probe>IN/CH/CH</Probe>
+					<Art>Basis</Art>
+					<eBE>BE-3</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Balladenvortrag</Spezialisierung>
+						<Spezialisierung>Chorgesang</Spezialisierung>
+						<Spezialisierung>Mehrstimmigkeit</Spezialisierung>
+						<Spezialisierung>Operngesang</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+				</Talent>
+				<Talent ID="Sinnensch?rfe">
+					<Probe>KL/IN/IN</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>H?ren</Spezialisierung>
+						<Spezialisierung>Riechen und Schmecken</Spezialisierung>
+						<Spezialisierung>Sehen</Spezialisierung>
+						<Spezialisierung>Tasten</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+				</Talent>
+				<Talent ID="Skifahren">
+					<Probe>GE/GE/KO</Probe>
+					<Art>Spezial</Art>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Athletik">
+							<Ausweichwert>10</Ausweichwert>
+						</Ausweichtalent>
+						<Ausweichtalent ID="K?rperbeherrschung">
+							<Ausweichwert>15</Ausweichwert>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Stimmen Imitieren">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Spezial</Art>
+					<eBE>BE-4</eBE>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Sinnensch?rfe">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Haustiere</Spezialisierung>
+						<Spezialisierung>Jagdwild</Spezialisierung>
+						<Spezialisierung>Menschliche Stimmen</Spezialisierung>
+						<Spezialisierung>Raubtiere</Spezialisierung>
+						<Spezialisierung>V?gel</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+				</Talent>
+				<Talent ID="Tanzen">
+					<Probe>CH/GE/GE</Probe>
+					<Art>Basis</Art>
+					<eBE>BEx2</eBE>
+					<Spezialisierungen>
+						<Spezialisierung>Ausdruckst?nze</Spezialisierung>
+						<Spezialisierung>Formationst?nze</Spezialisierung>
+						<Spezialisierung>Meditationst?nze</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="K?rperbeherrschung">
+							<Ausweichwert>5</Ausweichwert>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Akrobatik">
+							<Ausweichwert>5</Ausweichwert>
+						</Ausweichtalent>
+					</Ausweichtalente>
+				</Talent>
+				<Talent ID="Taschendiebstahl">
+					<Probe>MU/IN/FF</Probe>
+					<Art>Spezial</Art>
+					<eBE>BEx2</eBE>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Menschenkenntnis">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+				</Talent>
+				<Talent ID="Zechen">
+					<Probe>IN/KO/KK</Probe>
+					<Art>Basis</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+				</Talent>
+			</Talentgruppe>
+			<Talentgruppe ID="Gesellschaftliche Talente">
+				<Talent ID="Bet?ren">
+					<Probe>IN/CH/CH</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Menschenkenntnis">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+				</Talent>
+				<Talent ID="Etikette">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+				</Talent>
+				<Talent ID="Galanterie">
+					<Probe>IN/CH/FF</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Festgestaltung</Spezialisierung>
+						<Spezialisierung>Garderobe und Schminke</Spezialisierung>
+						<Spezialisierung>Liebesk?nste</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+				</Talent>
+				<Talent ID="Gassenwissen">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Beschatten</Spezialisierung>
+						<Spezialisierung>Hehlerei</Spezialisierung>
+						<Spezialisierung>Kontakte</Spezialisierung>
+						<Spezialisierung>Ortseinsch?tzung</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+				</Talent>
+				<Talent ID="Lehren">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Menschenkenntnis">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Kampftalente</Spezialisierung>
+						<Spezialisierung>K?rperliche Talente</Spezialisierung>
+						<Spezialisierung>Gesellschaftliche Talente</Spezialisierung>
+						<Spezialisierung>Natur-Talente</Spezialisierung>
+						<Spezialisierung>Wissenstalente</Spezialisierung>
+						<Spezialisierung>Handwerkstalente</Spezialisierung>
+						<Spezialisierung>Sprachen und Schriften</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+				</Talent>
+				<Talent ID="Menschenkenntnis">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Basis</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 23/24</Beschreibung>
+				</Talent>
+				<Talent ID="Schauspielerei">
+					<Probe>MU/KL/CH</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Etikette">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Sich Verkleiden">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Singen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="?berreden">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="?berzeugen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Kom?die</Spezialisierung>
+						<Spezialisierung>Possen</Spezialisierung>
+						<Spezialisierung>Trag?die</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 24</Beschreibung>
+				</Talent>
+				<Talent ID="Schriftlicher Ausdruck">
+					<Probe>KL/IN/IN</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Schreiber</Spezialisierung>
+						<Spezialisierung>Schriftsteller</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 24</Beschreibung>
+				</Talent>
+				<Talent ID="Sich Verkleiden">
+					<Probe>MU/CH/GE</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>anderer Stand</Spezialisierung>
+						<Spezialisierung>anderes Geschlecht</Spezialisierung>
+						<Spezialisierung>andere Rolle</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 24</Beschreibung>
+				</Talent>
+				<Talent ID="?berreden">
+					<Probe>MU/IN/CH</Probe>
+					<Art>Basis</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Menschenkenntnis">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Aufwiegeln</Spezialisierung>
+						<Spezialisierung>Betteln</Spezialisierung>
+						<Spezialisierung>Einsch?chtern</Spezialisierung>
+						<Spezialisierung>Feilschen</Spezialisierung>
+						<Spezialisierung>L?gen</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 24/25</Beschreibung>
+				</Talent>
+				<Talent ID="?berzeugen">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Menschenkenntnis">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Demagogie, Pl?doyer oder Predigt</Spezialisierung>
+						<Spezialisierung>Einzelgespr?ch und Verh?r</Spezialisierung>
+						<Spezialisierung>Diskussions-Rhetorik</Spezialisierung>
+						<Spezialisierung>schriftliche Rhetorik</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 25</Beschreibung>
+				</Talent>
+			</Talentgruppe>
+			<Talentgruppe ID="Natur-Talente">
+				<Talent ID="Fallenstellen">
+					<Probe>KL/FF/KK</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Wildnisleben">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Gruben</Spezialisierung>
+						<Spezialisierung>Schlingen</Spezialisierung>
+						<Spezialisierung>Speere</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 25/26</Beschreibung>
+				</Talent>
+				<Talent ID="Fesseln / Entfesseln">
+					<Probe>FF/GE/KK</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Entfesseln</Spezialisierung>
+						<Spezialisierung>Fesseln</Spezialisierung>
+						<Spezialisierung>Knotenkunde</Spezialisierung>
+						<Spezialisierung>Taue Splei?en</Spezialisierung>
+						<Spezialisierung>Netze Kn?pfen</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+				</Talent>
+				<Talent ID="Fischen / Angeln">
+					<Probe>IN/FF/KK</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Fl?sse und B?che</Spezialisierung>
+						<Spezialisierung>Hochseeangeln</Spezialisierung>
+						<Spezialisierung>Seen, Sumpf oder Brackwasser</Spezialisierung>
+						<Spezialisierung>Strand und Riff</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+				</Talent>
+				<Talent ID="F?hrtensuchen">
+					<Probe>KL/IN/KO</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Eis und Schnee</Spezialisierung>
+						<Spezialisierung>Gebirge</Spezialisierung>
+						<Spezialisierung>Grasland</Spezialisierung>
+						<Spezialisierung>Stadt</Spezialisierung>
+						<Spezialisierung>Sumpf</Spezialisierung>
+						<Spezialisierung>Unterirdisch</Spezialisierung>
+						<Spezialisierung>Wald und Dschungel</Spezialisierung>
+						<Spezialisierung>W?ste</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 25</Beschreibung>
+				</Talent>
+				<Talent ID="Orientierung">
+					<Probe>KL/IN/IN</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Dschungel</Spezialisierung>
+						<Spezialisierung>Eis und Schnee</Spezialisierung>
+						<Spezialisierung>Gebirge</Spezialisierung>
+						<Spezialisierung>Grasland</Spezialisierung>
+						<Spezialisierung>Meer</Spezialisierung>
+						<Spezialisierung>Stadt</Spezialisierung>
+						<Spezialisierung>Unterirdisch</Spezialisierung>
+						<Spezialisierung>Wald</Spezialisierung>
+						<Spezialisierung>W?ste</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+				</Talent>
+				<Talent ID="Seefischerei">
+					<Probe>IN/FF/KK</Probe>
+					<Art>Beruf</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+				</Talent>
+				<Talent ID="Wettervorhersage">
+					<Probe>KL/IN/IN</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+				</Talent>
+				<Talent ID="Wildnisleben">
+					<Probe>IN/GE/KO</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Dschungel</Spezialisierung>
+						<Spezialisierung>Eis und Schnee</Spezialisierung>
+						<Spezialisierung>Gebirge</Spezialisierung>
+						<Spezialisierung>Meer</Spezialisierung>
+						<Spezialisierung>Steppe</Spezialisierung>
+						<Spezialisierung>Sumpf</Spezialisierung>
+						<Spezialisierung>Wald</Spezialisierung>
+						<Spezialisierung>W?ste</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+				</Talent>
+			</Talentgruppe>
+			<Talentgruppe ID="Wissenstalente">
+				<Talent ID="Anatomie">
+					<Probe>MU/KL/FF</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Totenangst">
+							<kein/>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+				</Talent>
+				<Talent ID="Baukunst">
+					<Probe>KL/KL/FF</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Malen / Zeichnen">
+							<Wert ID="minimal">5</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Rechnen">
+							<Wert ID="minimal">5</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Hochbau</Spezialisierung>
+						<Spezialisierung>Tiefbau</Spezialisierung>
+						<Spezialisierung>Wehranlagen</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+				</Talent>
+				<Talent ID="Brettspiel">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+				</Talent>
+				<Talent ID="Geographie">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+				</Talent>
+				<Talent ID="Geschichtswissen">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+				</Talent>
+				<Talent ID="Gesteinskunde">
+					<Probe>KL/IN/FF</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Baugestein</Spezialisierung>
+						<Spezialisierung>Edelmetalle</Spezialisierung>
+						<Spezialisierung>Edelsteine</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+				</Talent>
+				<Talent ID="G?tter und Kulte">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Basis</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+				</Talent>
+				<Talent ID="Heraldik">
+					<Probe>KL/KL/FF</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+				</Talent>
+				<Talent ID="H?ttenkunde">
+					<Probe>KL/IN/KO</Probe>
+					<Art>Beruf</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+				</Talent>
+				<Talent ID="Kriegskunst">
+					<Probe>MU/KL/CH</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Logistik</Spezialisierung>
+						<Spezialisierung>Milit?rgeschichte</Spezialisierung>
+						<Spezialisierung>Monstren</Spezialisierung>
+						<Spezialisierung>Seegefechte</Spezialisierung>
+						<Spezialisierung>Strategie</Spezialisierung>
+						<Spezialisierung>Taktik</Spezialisierung>
+						<Spezialisierung>Drachenbek?mpfung</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+				</Talent>
+				<Talent ID="Kryptographie">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Malen / Zeichnen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Rechnen">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Sprachenkunde">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+				</Talent>
+				<Talent ID="Magiekunde">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Artefaktherstellung</Spezialisierung>
+						<Spezialisierung>D?monologie</Spezialisierung>
+						<Spezialisierung>Elementarismus</Spezialisierung>
+						<Spezialisierung>Magiehistorie</Spezialisierung>
+						<Spezialisierung>Magietheorie</Spezialisierung>
+						<Spezialisierung>Magische Analyse</Spezialisierung>
+						<Spezialisierung>Sph?rologie</Spezialisierung>
+						<Spezialisierung>Zauberpraxis</Spezialisierung>
+						<Spezialisierung>Zauberwerkstatt</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+				</Talent>
+				<Talent ID="Mechanik">
+					<Probe>KL/KL/FF</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Malen / Zeichnen">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Rechnen">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Belagerungswaffen</Spezialisierung>
+						<Spezialisierung>Kr?ne, Hebewerke und Mahlwerke</Spezialisierung>
+						<Spezialisierung>Materialkunde</Spezialisierung>
+						<Spezialisierung>Pumpen und Wasserkraft</Spezialisierung>
+						<Spezialisierung>Windkraft</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+				</Talent>
+				<Talent ID="Pflanzenkunde">
+					<Probe>KL/IN/FF</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Dschungel</Spezialisierung>
+						<Spezialisierung>Gebirge</Spezialisierung>
+						<Spezialisierung>Grasland</Spezialisierung>
+						<Spezialisierung>Meer</Spezialisierung>
+						<Spezialisierung>Steppe</Spezialisierung>
+						<Spezialisierung>Sumpf</Spezialisierung>
+						<Spezialisierung>Tundra</Spezialisierung>
+						<Spezialisierung>Wlad</Spezialisierung>
+						<Spezialisierung>W?ste</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+				</Talent>
+				<Talent ID="Philosophie">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 29/30</Beschreibung>
+				</Talent>
+				<Talent ID="Rechnen">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Arithemtik</Spezialisierung>
+						<Spezialisierung>Buchf?hrung</Spezialisierung>
+						<Spezialisierung>Geometrie</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
+				</Talent>
+				<Talent ID="Rechtskunde">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Gildenrecht</Spezialisierung>
+						<Spezialisierung>Kirchenrecht</Spezialisierung>
+						<Spezialisierung>Strafrecht</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
+				</Talent>
+				<Talent ID="Sagen / Legenden">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Basis</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
+				</Talent>
+				<Talent ID="Schiffbau">
+					<Probe>KL/KL/FF</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Malen / Zeichnen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Rechnen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
+				</Talent>
+				<Talent ID="Sch?tzen">
+					<Probe>KL/IN/IN</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Antiquit?ten</Spezialisierung>
+						<Spezialisierung>Materialwert</Spezialisierung>
+						<Spezialisierung>Schmuck</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
+				</Talent>
+				<Talent ID="Sprachenkunde">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 30/31</Beschreibung>
+				</Talent>
+				<Talent ID="Staatskunst">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Diplomatie</Spezialisierung>
+						<Spezialisierung>Intrige</Spezialisierung>
+						<Spezialisierung>Verwaltung</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 31</Beschreibung>
+				</Talent>
+				<Talent ID="Sternkunde">
+					<Probe>KL/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Rechnen">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Sinnensch?rfe">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Himmelskartographie</Spezialisierung>
+						<Spezialisierung>Horoskope</Spezialisierung>
+						<Spezialisierung>Navigation</Spezialisierung>
+						<Spezialisierung>Zeitbestimmung</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 31</Beschreibung>
+				</Talent>
+				<Talent ID="Tierkunde">
+					<Probe>MU/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Drachen</Spezialisierung>
+						<Spezialisierung>Jagdwild</Spezialisierung>
+						<Spezialisierung>Meeresgetier</Spezialisierung>
+						<Spezialisierung>Monstren</Spezialisierung>
+						<Spezialisierung>Nutztiere</Spezialisierung>
+						<Spezialisierung>Raubtiere</Spezialisierung>
+						<Spezialisierung>Sch?dlinge</Spezialisierung>
+						<Spezialisierung>Vielbeiner</Spezialisierung>
+						<Spezialisierung>V?gel</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 31</Beschreibung>
+				</Talent>
+			</Talentgruppe>
+			<Talentgruppe ID="Handwerkliche Talente">
+				<Talent ID="Abrichten">
+					<Probe>MU/IN/CH</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Tierkunde">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Dompteur</Spezialisierung>
+						<Spezialisierung>Falkner</Spezialisierung>
+						<Spezialisierung>Hundef?hrer</Spezialisierung>
+						<Spezialisierung>Zureiter</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 33/34</Beschreibung>
+				</Talent>
+				<Talent ID="Ackerbau">
+					<Probe>IN/FF/KO</Probe>
+					<Art>Beruf</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+				</Talent>
+				<Talent ID="Alchimie">
+					<Probe>MU/KL/FF</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Rechnen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Brandmittel</Spezialisierung>
+						<Spezialisierung>Gifte</Spezialisierung>
+						<Spezialisierung>Laborpraxis</Spezialisierung>
+						<Spezialisierung>Zauber-Elixiere</Spezialisierung>
+						<Spezialisierung>Farben und Lacke</Spezialisierung>
+						<Spezialisierung>Gl?se</Spezialisierung>
+						<Spezialisierung>Porzellan</Spezialisierung>
+						<Spezialisierung>Legierungen</Spezialisierung>
+						<Spezialisierung>Goldmacherei</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+				</Talent>
+				<Talent ID="Bergbau">
+					<Probe>IN/KO/KK</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Gesteinskunde">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Bergwerke</Spezialisierung>
+						<Spezialisierung>Kanalisation</Spezialisierung>
+						<Spezialisierung>nat?rliche H?hlen</Spezialisierung>
+						<Spezialisierung>Sappeur</Spezialisierung>
+						<Spezialisierung>unterirdische St?dte</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+				</Talent>
+				<Talent ID="Bogenbau">
+					<Probe>KL/IN/FF</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Holzbearbeitung">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Armbrust</Spezialisierung>
+						<Spezialisierung>Bogen</Spezialisierung>
+						<Spezialisierung>Bolzen und Pfeile</Spezialisierung>
+						<Spezialisierung>Torsionswaffen</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+				</Talent>
+				<Talent ID="Boote Fahren">
+					<Probe>GE/KO/KK</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Einmaster Segeln</Spezialisierung>
+						<Spezialisierung>Fl??e Staken</Spezialisierung>
+						<Spezialisierung>Kanus und Kajaks Paddeln</Spezialisierung>
+						<Spezialisierung>Ruderboote Rudern</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+				</Talent>
+				<Talent ID="Brauer">
+					<Probe>KL/FF/KK</Probe>
+					<Art>Beruf</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+				</Talent>
+				<Talent ID="Drucker">
+					<Probe>KL/FF/KO</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Malen / Zeichnen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Mechanik">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Buchdruck</Spezialisierung>
+						<Spezialisierung>Druckereitechnologie</Spezialisierung>
+						<Spezialisierung>Pamphlete</Spezialisierung>
+						<Spezialisierung>Typographie</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+				</Talent>
+				<Talent ID="Eissegler Fahren">
+					<Probe>IN/GE/KK</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 34/35</Beschreibung>
+				</Talent>
+				<Talent ID="Fahrzeug Lenken">
+					<Probe>IN/CH/FF</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Lastkarren</Spezialisierung>
+						<Spezialisierung>Streitwagen</Spezialisierung>
+						<Spezialisierung>Zuggespanne</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+				</Talent>
+				<Talent ID="Falschspiel">
+					<Probe>MU/CH/FF</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Menschenkenntnis">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>W?rfel</Spezialisierung>
+						<Spezialisierung>Karten</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+				</Talent>
+				<Talent ID="Feinmechanik">
+					<Probe>KL/FF/FF</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Malen / Zeichnen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Gold- und Silberschmied</Spezialisierung>
+						<Spezialisierung>Gravieren</Spezialisierung>
+						<Spezialisierung>Schl?sser</Spezialisierung>
+						<Spezialisierung>Siegelst?cke</Spezialisierung>
+						<Spezialisierung>Trickwaffen und Fallen</Spezialisierung>
+						<Spezialisierung>Uhrwerke</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+				</Talent>
+				<Talent ID="Feuersteinbearbeitung">
+					<Probe>KL/FF/FF</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+				</Talent>
+				<Talent ID="Fleischer">
+					<Probe>KL/FF/KK</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Fische</Spezialisierung>
+						<Spezialisierung>Gefl?gel</Spezialisierung>
+						<Spezialisierung>Reptilien</Spezialisierung>
+						<Spezialisierung>S?ugetiere</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+				</Talent>
+				<Talent ID="Gerber / K?rschner">
+					<Probe>KL/FF/KO</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Gerber</Spezialisierung>
+						<Spezialisierung>K?rschner</Spezialisierung>
+						<Spezialisierung>Troph?en</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+				</Talent>
+				<Talent ID="Glaskunst">
+					<Probe>FF/FF/KO</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Fensterscheiben</Spezialisierung>
+						<Spezialisierung>Glasbl?serei</Spezialisierung>
+						<Spezialisierung>Linsenschleifen</Spezialisierung>
+						<Spezialisierung>Spiegel</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+				</Talent>
+				<Talent ID="Grobschmied">
+					<Probe>FF/KK/KO</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Drahtzieher</Spezialisierung>
+						<Spezialisierung>Hufschmied</Spezialisierung>
+						<Spezialisierung>Pl?ttner</Spezialisierung>
+						<Spezialisierung>Schwarzschmied</Spezialisierung>
+						<Spezialisierung>Spengler</Spezialisierung>
+						<Spezialisierung>Waffenschmied</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+				</Talent>
+				<Talent ID="Handel">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Rechnen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 35/36</Beschreibung>
+				</Talent>
+				<Talent ID="Hauswirtschaft">
+					<Probe>IN/CH/FF</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Bewirtung und Feiern</Spezialisierung>
+						<Spezialisierung>Personal</Spezialisierung>
+						<Spezialisierung>Vorratshaltung</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 36</Beschreibung>
+				</Talent>
+				<Talent ID="Heilkunde Gift">
+					<Probe>MU/KL/IN</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 36</Beschreibung>
+				</Talent>
+				<Talent ID="Heilkunde Krankheiten">
+					<Probe>MU/KL/CH</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 36</Beschreibung>
+				</Talent>
+				<Talent ID="Heilkunde Seele">
+					<Probe>IN/CH/CH</Probe>
+					<Art>Beruf</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 36/37</Beschreibung>
+				</Talent>
+				<Talent ID="Heilkunde Wunden">
+					<Probe>KL/CH/FF</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Br?che und Quetschungen</Spezialisierung>
+						<Spezialisierung>Schnitte</Spezialisierung>
+						<Spezialisierung>Verbrennungen</Spezialisierung>
+						<Spezialisierung>Zahnleiden</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 37</Beschreibung>
+				</Talent>
+				<Talent ID="Holzbearbeitung">
+					<Probe>KL/FF/KK</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Beinschnitzerei</Spezialisierung>
+						<Spezialisierung>Holzkunde</Spezialisierung>
+						<Spezialisierung>Holzwaffen</Spezialisierung>
+						<Spezialisierung>K?fer und Wagner</Spezialisierung>
+						<Spezialisierung>M?belschreinerei und Tichlerei</Spezialisierung>
+						<Spezialisierung>Schnitzen</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+				</Talent>
+				<Talent ID="Hundeschlitten Fahren">
+					<Probe>CH/FF/GE</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+				</Talent>
+				<Talent ID="Instrumentenbauer">
+					<Probe>KL/IN/FF</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Feinmechanik">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Holzbearbeitung">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Musizieren">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Blasinstrumente</Spezialisierung>
+						<Spezialisierung>Saiteninstrumente</Spezialisierung>
+						<Spezialisierung>Tasteninstrumente</Spezialisierung>
+						<Spezialisierung>Trommeln</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+				</Talent>
+				<Talent ID="Kapellmeister">
+					<Probe>KL/IN/CH</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Lesen / Schreiben">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Musizieren">
+							<Wert ID="minimal">7</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Dirigieren</Spezialisierung>
+						<Spezialisierung>Komponieren</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+				</Talent>
+				<Talent ID="Kartographie">
+					<Probe>KL/KL/FF</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Malen / Zeichnen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Geb?ude</Spezialisierung>
+						<Spezialisierung>H?hlen und Tunnel</Spezialisierung>
+						<Spezialisierung>K?sten und Meere</Spezialisierung>
+						<Spezialisierung>Landschaften</Spezialisierung>
+						<Spezialisierung>Stadt</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+				</Talent>
+				<Talent ID="Kochen">
+					<Probe>KL/IN/FF</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Backen und Braten</Spezialisierung>
+						<Spezialisierung>Festmahle</Spezialisierung>
+						<Spezialisierung>Haltbarmachen</Spezialisierung>
+						<Spezialisierung>Marschversorgung</Spezialisierung>
+						<Spezialisierung>Tr?nke</Spezialisierung>
+						<Spezialisierung>Vorkoster</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+				</Talent>
+				<Talent ID="Kristallzucht">
+					<Probe>KL/IN/FF</Probe>
+					<Art>Beruf</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+				</Talent>
+				<Talent ID="Lederarbeiten">
+					<Probe>KL/FF/FF</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Gurte und Riemen</Spezialisierung>
+						<Spezialisierung>Lederkleidung</Spezialisierung>
+						<Spezialisierung>Lederr?stung</Spezialisierung>
+						<Spezialisierung>S?ttel</Spezialisierung>
+						<Spezialisierung>Schuhwerk</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 38/39</Beschreibung>
+				</Talent>
+				<Talent ID="Malen / Zeichnen">
+					<Probe>KL/IN/FF</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Architektur</Spezialisierung>
+						<Spezialisierung>Landschaften</Spezialisierung>
+						<Spezialisierung>Portr?t</Spezialisierung>
+						<Spezialisierung>technische Skizze</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+				</Talent>
+				<Talent ID="Maurer">
+					<Probe>FF/GE/KK</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Steinbau</Spezialisierung>
+						<Spezialisierung>Steinguss</Spezialisierung>
+						<Spezialisierung>Ziegelbau</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+				</Talent>
+				<Talent ID="Metallguss">
+					<Probe>KL/FF/KK</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="H?ttenkunde">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Klangk?rper</Spezialisierung>
+						<Spezialisierung>Rohre</Spezialisierung>
+						<Spezialisierung>Reliefplatten und Statuen</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+				</Talent>
+				<Talent ID="Musizieren">
+					<Probe>IN/CH/FF</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Blechblasinstrumente</Spezialisierung>
+						<Spezialisierung>Fl?ten</Spezialisierung>
+						<Spezialisierung>Harfen</Spezialisierung>
+						<Spezialisierung>Lauten</Spezialisierung>
+						<Spezialisierung>Rhythmusinstrumente</Spezialisierung>
+						<Spezialisierung>Streichinstrumente</Spezialisierung>
+						<Spezialisierung>Tasteninstrumente</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+				</Talent>
+				<Talent ID="Schl?sser Knacken">
+					<Probe>IN/FF/FF</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Fallen</Spezialisierung>
+						<Spezialisierung>Schl?sser</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+				</Talent>
+				<Talent ID="Schnaps Brennen">
+					<Probe>KL/IN/FF</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>alchimistische Destillation</Spezialisierung>
+						<Spezialisierung>Beeren- und Obstbr?nde</Spezialisierung>
+						<Spezialisierung>Kornbr?nde</Spezialisierung>
+						<Spezialisierung>Kr?uterschn?pse</Spezialisierung>
+						<Spezialisierung>Lagerung</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+				</Talent>
+				<Talent ID="Schneidern">
+					<Probe>KL/FF/FF</Probe>
+					<Art>Basis</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Entwurf und Festgew?nder</Spezialisierung>
+						<Spezialisierung>Flcik und Gebrauchsschneiderei</Spezialisierung>
+						<Spezialisierung>Tuchr?stung</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+				</Talent>
+				<Talent ID="Seefahrt">
+					<Probe>FF/GE/KK</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Ruderschiff</Spezialisierung>
+						<Spezialisierung>Segelschiff</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+				</Talent>
+				<Talent ID="Seiler">
+					<Probe>FF/FF/KK</Probe>
+					<Art>Beruf</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 39/40</Beschreibung>
+				</Talent>
+				<Talent ID="Steinmetz">
+					<Probe>FF/FF/KK</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Gesteinskunde">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Baugestein</Spezialisierung>
+						<Spezialisierung>Reliefs</Spezialisierung>
+						<Spezialisierung>Statuen</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="Steinschneider / Juwelier">
+					<Probe>IN/FF/FF</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Gesteinskunde">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="Stellmacher">
+					<Probe>KL/FF/KK</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Grobschmied">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Holzbearbeitung">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+						<Voraussetzung ID="Lederarbeiten">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Karren und Wagen</Spezialisierung>
+						<Spezialisierung>Schlitten</Spezialisierung>
+						<Spezialisierung>Streitwagen</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="Steuermann">
+					<Probe>IN/CH/KK</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Seefahrt">
+							<Wert ID="minimal">6</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Ruderschiff</Spezialisierung>
+						<Spezialisierung>Segelschiff</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="Stoffe F?rben">
+					<Probe>KL/FF/KK</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>alchimistische Farben</Spezialisierung>
+						<Spezialisierung>mineralische Farben</Spezialisierung>
+						<Spezialisierung>pflanzliche Farben</Spezialisierung>
+						<Spezialisierung>tierische Farben</Spezialisierung>
+						<Spezialisierung>Stoffdruck</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="T?towieren">
+					<Probe>IN/FF/FF</Probe>
+					<Art>Spezial</Art>
+					<Voraussetzungen ID="allgemein">
+						<Voraussetzung ID="Malen / Zeichnen">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Naturalistische Darstellungen</Spezialisierung>
+						<Spezialisierung>Ornamente</Spezialisierung>
+						<Spezialisierung>Zaubert?towierungen</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="T?pfern">
+					<Probe>KL/FF/FF</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Gef??e</Spezialisierung>
+						<Spezialisierung>Statuetten</Spezialisierung>
+						<Spezialisierung>Ziegelei</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="Viehzucht">
+					<Probe>KL/IN/KK</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Rind</Spezialisierung>
+						<Spezialisierung>Schaf und Ziege</Spezialisierung>
+						<Spezialisierung>Schwein</Spezialisierung>
+						<Spezialisierung>Pferd</Spezialisierung>
+						<Spezialisierung>Hund</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="Webkunst">
+					<Probe>FF/FF/KK</Probe>
+					<Art>Spezial</Art>
+					<Spezialisierungen>
+						<Spezialisierung>H?keln</Spezialisierung>
+						<Spezialisierung>Kl?ppeln</Spezialisierung>
+						<Spezialisierung>Stricken</Spezialisierung>
+						<Spezialisierung>Teppichkn?pfen</Spezialisierung>
+						<Spezialisierung>Weben</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="Winzer">
+					<Probe>KL/FF/KK</Probe>
+					<Art>Beruf</Art>
+					<Spezialisierungen>
+						<Spezialisierung>Wein</Spezialisierung>
+						<Spezialisierung>Fruchtweine</Spezialisierung>
+						<Spezialisierung>Schaumweine</Spezialisierung>
+						<Spezialisierung>Weinkenner</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+				<Talent ID="Zimmermann">
+					<Probe>KL/FF/KK</Probe>
+					<Art>Beruf</Art>
+					<Voraussetzungen ID="meisterlich">
+						<Voraussetzung ID="Holzbearbeitung">
+							<Wert ID="minimal">4</Wert>
+						</Voraussetzung>
+					</Voraussetzungen>
+					<Spezialisierungen>
+						<Spezialisierung>Dachdecker</Spezialisierung>
+						<Spezialisierung>Holzkonstruktionen</Spezialisierung>
+						<Spezialisierung>Schiffszimmermann</Spezialisierung>
+					</Spezialisierungen>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+				</Talent>
+			</Talentgruppe>
+			<Talentgruppe ID="Sprachen &amp; Schriften">
+				<Talent ID="Lesen / Schreiben">
+					<Probe>KL/KL/FF</Probe>
+					<Art>Spezial</Art>
+					<Beschreibung>siehe Mit Flinken Fingern, S. 31-33</Beschreibung>
+				</Talent>
+			</Talentgruppe>
+		</Talente>
+		<Sprachen>
+		</Sprachen>
+		<Schriften>
+		</Schriften>
+		<Kampftechniken>
+			<Kampfart ID="Bewaffneter Nahkampf">
+				<Kampftechnik ID="Anderthalbh?nder">
+					<Art>Spezial</Art>
+					<SKT-Spalte>E</SKT-Spalte>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 74</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Dolche">
+					<Art>Basis</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-1</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Fechtwaffen">
+					<Art>Spezial</Art>
+					<SKT-Spalte>E</SKT-Spalte>
+					<eBE>BE-1</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Hiebwaffen">
+					<Art>Basis</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-4</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Infanteriewaffen">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-3</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Kettenst?be">
+					<Art>Spezial</Art>
+					<SKT-Spalte>E</SKT-Spalte>
+					<eBE>BE-1</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Kettenwaffen">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-3</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Schwerter">
+					<Art>Spezial</Art>
+					<SKT-Spalte>E</SKT-Spalte>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Speere">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-3</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="St?be">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="S?bel">
+					<Art>Basis</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 76/77</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Zweihand-Hiebwaffen">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-3</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 78</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Zweihandflegel">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-3</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 78</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Zweihandschwerter und -s?bel">
+					<Art>Spezial</Art>
+					<SKT-Spalte>E</SKT-Spalte>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 78</Beschreibung>
+				</Kampftechnik>
+			</Kampfart>
+			<Kampfart ID="Bewaffneter Kampf">
+				<Kampftechnik ID="Lanzenreiten">
+					<Art>Spezial</Art>
+					<SKT-Spalte>E</SKT-Spalte>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 58 und 76</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Peitsche">
+					<Art>Spezial</Art>
+					<SKT-Spalte>E</SKT-Spalte>
+					<eBE>BE-1</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
+				</Kampftechnik>
+			</Kampfart>
+			<Kampfart ID="Waffenloser Kampf">
+				<Kampftechnik ID="Raufen">
+					<Art>Basis</Art>
+					<SKT-Spalte>C</SKT-Spalte>
+					<eBE>BE</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Ringen">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 76</Beschreibung>
+				</Kampftechnik>
+			</Kampfart>
+			<Kampfart ID="Fernkampf">
+				<Kampftechnik ID="Armbrust">
+					<Art>Spezial</Art>
+					<SKT-Spalte>C</SKT-Spalte>
+					<eBE>BE-5</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 74</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Belagerungswaffen">
+					<Art>Beruf</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 74/75</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Blasrohr">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-5</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Bogen">
+					<Art>Spezial</Art>
+					<SKT-Spalte>E</SKT-Spalte>
+					<eBE>BE-3</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Diskus">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 75</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Schleuder">
+					<Art>Spezial</Art>
+					<SKT-Spalte>E</SKT-Spalte>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Wurfbeile">
+					<Art>Spezial</Art>
+					<SKT-Spalte>D</SKT-Spalte>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Wurfmesser">
+					<Art>Basis</Art>
+					<SKT-Spalte>C</SKT-Spalte>
+					<eBE>BE-3</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 77</Beschreibung>
+				</Kampftechnik>
+				<Kampftechnik ID="Wurfspeere">
+					<Art>Spezial</Art>
+					<SKT-Spalte>C</SKT-Spalte>
+					<eBE>BE-2</eBE>
+					<Beschreibung>siehe Mit Blitzenden Klingen, S. 77/78</Beschreibung>
+				</Kampftechnik>
+			</Kampfart>
+		</Kampftechniken>
+		<Charakteristika>
+		</Charakteristika>
+		<Sonderfertigkeiten>
+		</Sonderfertigkeiten>
+		<Zauberspr?che>
+		</Zauberspr?che>
+	</Inhalt>
 </XDIML>



From no22 at mail.berlios.de  Sat Sep  1 20:08:33 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Sat, 1 Sep 2007 20:08:33 +0200
Subject: [Dsa-hl-svn] r3784 - modules/common/dsa
Message-ID: <200709011808.l81I8Xw8017136@sheep.berlios.de>

Author: no22
Date: 2007-09-01 20:08:31 +0200 (Sat, 01 Sep 2007)
New Revision: 3784

Modified:
   modules/common/dsa/basis.xdi
Log:
* Used the wrong DTD, sorry for the inconvinience

Modified: modules/common/dsa/basis.xdi
===================================================================
--- modules/common/dsa/basis.xdi	2007-09-01 15:17:20 UTC (rev 3783)
+++ modules/common/dsa/basis.xdi	2007-09-01 18:08:31 UTC (rev 3784)
@@ -87,10 +87,10 @@
 					<Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
 					<Ausweichtalente>
 						<Ausweichtalent ID="Taschendiebstahl">
-							<Ausweichwert>10</Ausweichwert>
+							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
 						<Ausweichtalent ID="Falschspiel">
-							<Ausweichwert>10</Ausweichwert>
+							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
@@ -107,13 +107,13 @@
 					<Beschreibung>siehe Mit Flinken Fingern, S. 20</Beschreibung>
 					<Ausweichtalente>
 						<Ausweichtalent ID="Athletik">
-							<Ausweichwert>5</Ausweichwert>
+							<Aufschlag>5</Aufschlag>
 						</Ausweichtalent>
 						<Ausweichtalent ID="Akrobatik">
-							<Ausweichwert>5</Ausweichwert>
+							<Aufschlag>5</Aufschlag>
 						</Ausweichtalent>
 						<Ausweichtalent ID="K?rperbeherrschung">
-							<Ausweichwert>10</Ausweichwert>
+							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
@@ -129,10 +129,10 @@
 					<Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
 					<Ausweichtalente>
 						<Ausweichtalent ID="Akrobatik">
-							<Ausweichwert>5</Ausweichwert>
+							<Aufschlag>5</Aufschlag>
 						</Ausweichtalent>
 						<Ausweichtalent ID="Athletik">
-							<Ausweichwert>10</Ausweichwert>
+							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
@@ -152,10 +152,10 @@
 					<Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
 					<Ausweichtalente>
 						<Ausweichtalent ID="K?rperbeherrschung">
-							<Ausweichwert>10</Ausweichwert>
+							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
 						<Ausweichtalent ID="Akrobatik">
-							<Ausweichwert>15</Ausweichwert>
+							<Aufschlag>15</Aufschlag>
 						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
@@ -173,10 +173,10 @@
 					<Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
 					<Ausweichtalente>
 						<Ausweichtalent ID="K?rperbeherrschung">
-							<Ausweichwert>10</Ausweichwert>
+							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
 						<Ausweichtalent ID="Sich Verstecken">
-							<Ausweichwert>10</Ausweichwert>
+							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
@@ -193,7 +193,7 @@
 					<Beschreibung>siehe Mit Flinken Fingern, S. 21</Beschreibung>
 					<Ausweichtalente>
 						<Ausweichtalent ID="Athletik">
-							<Ausweichwert>15</Ausweichwert>
+							<Aufschlag>15</Aufschlag>
 						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
@@ -224,10 +224,10 @@
 					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
 					<Ausweichtalente>
 						<Ausweichtalent ID="Schleichen">
-							<Ausweichwert>10</Ausweichwert>
+							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
 						<Ausweichtalent ID="K?rperbeherrschung">
-							<Ausweichwert>15</Ausweichwert>
+							<Aufschlag>15</Aufschlag>
 						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
@@ -261,10 +261,10 @@
 					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
 					<Ausweichtalente>
 						<Ausweichtalent ID="Athletik">
-							<Ausweichwert>10</Ausweichwert>
+							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
 						<Ausweichtalent ID="K?rperbeherrschung">
-							<Ausweichwert>15</Ausweichwert>
+							<Aufschlag>15</Aufschlag>
 						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
@@ -298,10 +298,10 @@
 					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
 					<Ausweichtalente>
 						<Ausweichtalent ID="K?rperbeherrschung">
-							<Ausweichwert>5</Ausweichwert>
+							<Aufschlag>5</Aufschlag>
 						</Ausweichtalent>
 						<Ausweichtalent ID="Akrobatik">
-							<Ausweichwert>5</Ausweichwert>
+							<Aufschlag>5</Aufschlag>
 						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>



From no22 at mail.berlios.de  Sat Sep  1 20:58:21 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Sat, 1 Sep 2007 20:58:21 +0200
Subject: [Dsa-hl-svn] r3785 - in rl/trunk/engine: rules/include rules/src
	script/swig
Message-ID: <200709011858.l81IwL3w019118@sheep.berlios.de>

Author: no22
Date: 2007-09-01 20:58:17 +0200 (Sat, 01 Sep 2007)
New Revision: 3785

Modified:
   rl/trunk/engine/rules/include/Effect.h
   rl/trunk/engine/rules/src/Creature.cpp
   rl/trunk/engine/rules/src/Effect.cpp
   rl/trunk/engine/rules/src/EffectManager.cpp
   rl/trunk/engine/script/swig/RlRules.swig
Log:
* renamed check to timeCheck for Mac OS compatibility

Modified: rl/trunk/engine/rules/include/Effect.h
===================================================================
--- rl/trunk/engine/rules/include/Effect.h	2007-09-01 18:08:31 UTC (rev 3784)
+++ rl/trunk/engine/rules/include/Effect.h	2007-09-01 18:58:17 UTC (rev 3785)
@@ -110,11 +110,15 @@
 		virtual void disable();
 
 		/**
-         * runs a check on the effect.
+         * If a check at a certain time is registered within the EffectManager, the manager calls 
+         * this function.
+         *
+         * This function should be overridden by the explicit effect. If not, the default return 
+         * value is PERMANENT.
          * @return Returns the time to the next check. If REMOVE is returned, the 
          * effect will be removed, if PERMANENT is returned, the effect lasts permanently.
          **/
-		virtual RL_LONGLONG check();
+		virtual RL_LONGLONG timeCheck();
         
         /// Returns the status that is applied to the creature by this effect.
         virtual Status getStatus();

Modified: rl/trunk/engine/rules/src/Creature.cpp
===================================================================
--- rl/trunk/engine/rules/src/Creature.cpp	2007-09-01 18:08:31 UTC (rev 3784)
+++ rl/trunk/engine/rules/src/Creature.cpp	2007-09-01 18:58:17 UTC (rev 3785)
@@ -366,7 +366,6 @@
 
     int Creature::getTalent(const CeGuiString talentName)
     {
-		checkEffects();
         TalentMap::const_iterator it = mTalente.find(talentName);
         if (it == mTalente.end())
         {

Modified: rl/trunk/engine/rules/src/Effect.cpp
===================================================================
--- rl/trunk/engine/rules/src/Effect.cpp	2007-09-01 18:08:31 UTC (rev 3784)
+++ rl/trunk/engine/rules/src/Effect.cpp	2007-09-01 18:58:17 UTC (rev 3785)
@@ -87,7 +87,7 @@
 		}
 	}
 
-    RL_LONGLONG Effect::check()
+    RL_LONGLONG Effect::timeCheck()
     {
       return PERMANENT;
     }

Modified: rl/trunk/engine/rules/src/EffectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/EffectManager.cpp	2007-09-01 18:08:31 UTC (rev 3784)
+++ rl/trunk/engine/rules/src/EffectManager.cpp	2007-09-01 18:58:17 UTC (rev 3785)
@@ -53,7 +53,7 @@
             for (Effects::iterator effIt = checkIt->second.begin(); effIt != checkIt->second.end(); effIt++)
             {
                 int nextCheck;
-                nextCheck = (*effIt)->check();
+                nextCheck = (*effIt)->timeCheck();
                 switch (nextCheck)
                 {
                   case Effect::REMOVE:

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2007-09-01 18:08:31 UTC (rev 3784)
+++ rl/trunk/engine/script/swig/RlRules.swig	2007-09-01 18:58:17 UTC (rev 3785)
@@ -592,7 +592,7 @@
         virtual void decreaseStufe();
         virtual void enable();
         virtual void disable();
-        virtual RL_LONGLONG check() = 0;
+        virtual RL_LONGLONG timeCheck() = 0;
 
         virtual Status getStatus();
         virtual int getMod(rl::CeGuiString target, ModType type, ModTag tag);



From no22 at mail.berlios.de  Sat Sep  1 20:59:43 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Sat, 1 Sep 2007 20:59:43 +0200
Subject: [Dsa-hl-svn] r3786 - in modules/common/scripts: . effects
Message-ID: <200709011859.l81Ixhk0019159@sheep.berlios.de>

Author: no22
Date: 2007-09-01 20:59:39 +0200 (Sat, 01 Sep 2007)
New Revision: 3786

Removed:
   modules/common/scripts/modathletik.rb
Modified:
   modules/common/scripts/effects/astraleregeneration.rb
   modules/common/scripts/effects/ausdauernd.rb
   modules/common/scripts/effects/paralues.rb
   modules/common/scripts/effects/resistentgegenkrankheiten.rb
   modules/common/scripts/effects/ruestung.rb
   modules/common/scripts/effects/wunde.rb
Log:
* renamed check to timeCheck for Mac OS compatibility
* deleted "modathletik" effect, which was only for testing

Modified: modules/common/scripts/effects/astraleregeneration.rb
===================================================================
--- modules/common/scripts/effects/astraleregeneration.rb	2007-09-01 18:58:17 UTC (rev 3785)
+++ modules/common/scripts/effects/astraleregeneration.rb	2007-09-01 18:59:39 UTC (rev 3786)
@@ -18,7 +18,7 @@
 
   end
 
-  def check()
+  def timeCheck()
 	  return PERMANENT;
   end
 end

Modified: modules/common/scripts/effects/ausdauernd.rb
===================================================================
--- modules/common/scripts/effects/ausdauernd.rb	2007-09-01 18:58:17 UTC (rev 3785)
+++ modules/common/scripts/effects/ausdauernd.rb	2007-09-01 18:59:39 UTC (rev 3786)
@@ -19,7 +19,7 @@
       return 0;
   end
 
-  def check()
+  def timeCheck()
 	  return PERMANENT;
   end
 end

Modified: modules/common/scripts/effects/paralues.rb
===================================================================
--- modules/common/scripts/effects/paralues.rb	2007-09-01 18:58:17 UTC (rev 3785)
+++ modules/common/scripts/effects/paralues.rb	2007-09-01 18:59:39 UTC (rev 3786)
@@ -10,7 +10,7 @@
     return rval;
   end
     
-  def check()
+  def timeCheck()
     p "Paralues check called";
     return REMOVE;
   end

Modified: modules/common/scripts/effects/resistentgegenkrankheiten.rb
===================================================================
--- modules/common/scripts/effects/resistentgegenkrankheiten.rb	2007-09-01 18:58:17 UTC (rev 3785)
+++ modules/common/scripts/effects/resistentgegenkrankheiten.rb	2007-09-01 18:59:39 UTC (rev 3786)
@@ -13,7 +13,7 @@
     end
   end
 
-  def check()
+  def timeCheck()
     p "Resistent gegen Krankheiten check called";
     return PERMANENT;
   end

Modified: modules/common/scripts/effects/ruestung.rb
===================================================================
--- modules/common/scripts/effects/ruestung.rb	2007-09-01 18:58:17 UTC (rev 3785)
+++ modules/common/scripts/effects/ruestung.rb	2007-09-01 18:59:39 UTC (rev 3786)
@@ -27,7 +27,7 @@
     end
   end
 
-  def check()
+  def timeCheck()
 	  return PERMANENT;
   end
 end

Modified: modules/common/scripts/effects/wunde.rb
===================================================================
--- modules/common/scripts/effects/wunde.rb	2007-09-01 18:58:17 UTC (rev 3785)
+++ modules/common/scripts/effects/wunde.rb	2007-09-01 18:59:39 UTC (rev 3786)
@@ -20,7 +20,7 @@
     end
   end
 
-  def check()
+  def timeCheck()
     return REMOVE;
   end
 end

Deleted: modules/common/scripts/modathletik.rb
===================================================================
--- modules/common/scripts/modathletik.rb	2007-09-01 18:58:17 UTC (rev 3785)
+++ modules/common/scripts/modathletik.rb	2007-09-01 18:59:39 UTC (rev 3786)
@@ -1,18 +0,0 @@
-class ModAthletik < Effect
-  def initialize(modifier)
-    super(1);
-    @mModifier = modifier;
-  end
-
-  def isAlive()
-	return getTimePassed <= 1000;
-  end
-
-  def apply()
-	  getOwner().getTalentStateSet("Athletik").setModifier(@mModifier);
-  end
-
-  def remove()
-	  getOwner().getTalentStateSet("Athletik").setModifier(0);
-  end
-end



From melven at mail.berlios.de  Sun Sep  2 00:12:27 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sun, 2 Sep 2007 00:12:27 +0200
Subject: [Dsa-hl-svn] r3787 - rl/trunk/engine/rules/src
Message-ID: <200709012212.l81MCRPM029288@sheep.berlios.de>

Author: melven
Date: 2007-09-02 00:12:20 +0200 (Sun, 02 Sep 2007)
New Revision: 3787

Modified:
   rl/trunk/engine/rules/src/CreatureController.cpp
Log:
fixed bug 22 (without talent "athletik" errors in creaturecontroller)

Modified: rl/trunk/engine/rules/src/CreatureController.cpp
===================================================================
--- rl/trunk/engine/rules/src/CreatureController.cpp	2007-09-01 18:59:39 UTC (rev 3786)
+++ rl/trunk/engine/rules/src/CreatureController.cpp	2007-09-01 22:12:20 UTC (rev 3787)
@@ -449,7 +449,7 @@
                         mTimePerAu += taw * 5;
                     }
                 }
-                catch(OutOfRangeException)
+                catch(IllegalArgumentException)
                 {
                     mTimePerAu = 120; // was 180
                 }
@@ -559,7 +559,7 @@
                         mVelocityImprovement += taw * 0.1;
                     }
                 }
-                catch(OutOfRangeException)
+                catch(IllegalArgumentException)
                 {
                     mVelocityImprovement = 0;
                 }
@@ -747,7 +747,7 @@
                     }
                 }
             }
-            catch(OutOfRangeException err)
+            catch(IllegalArgumentException)
             {
             }
             mMovingCreature->getCreature()->damageAu(2./3);
@@ -929,7 +929,7 @@
                     }
                 }
             }
-            catch(OutOfRangeException err)
+            catch(IllegalArgumentException)
             {
             }
             mMovingCreature->getCreature()->damageAu(2./3);



From melven at mail.berlios.de  Sun Sep  2 13:50:30 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sun, 2 Sep 2007 13:50:30 +0200
Subject: [Dsa-hl-svn] r3788 - in rl/trunk/engine: common/include common/src
	core/include core/src rules/include rules/src script/src script/swig
Message-ID: <200709021150.l82BoUCH013180@sheep.berlios.de>

Author: melven
Date: 2007-09-02 13:49:51 +0200 (Sun, 02 Sep 2007)
New Revision: 3788

Modified:
   rl/trunk/engine/common/include/XmlHelper.h
   rl/trunk/engine/common/src/XmlHelper.cpp
   rl/trunk/engine/core/include/GameAreaEventSource.h
   rl/trunk/engine/core/include/GameAreaTypes.h
   rl/trunk/engine/core/include/GameEventManager.h
   rl/trunk/engine/core/include/Zone.h
   rl/trunk/engine/core/include/ZoneManager.h
   rl/trunk/engine/core/src/GameAreaEventSource.cpp
   rl/trunk/engine/core/src/GameAreaTypes.cpp
   rl/trunk/engine/core/src/GameEventManager.cpp
   rl/trunk/engine/core/src/Zone.cpp
   rl/trunk/engine/core/src/ZoneManager.cpp
   rl/trunk/engine/rules/include/Creature.h
   rl/trunk/engine/rules/src/Creature.cpp
   rl/trunk/engine/rules/src/CreatureController.cpp
   rl/trunk/engine/script/src/ZoneProcessor.cpp
   rl/trunk/engine/script/swig/RlCore.swig
   rl/trunk/engine/script/swig/RlRules.swig
Log:
-added hasTalent to creature for creaturecontroller to prevent problems if Talent "Athletik" does not exist
-adapted zones/areas:
now a zone can consist of different areas(you can also add holes by subtracting an area from a zone)
fixed inheritance of zone/ZoneManager
-added new zones/areas to zoneprocessor (wiki -> mapformat)

Modified: rl/trunk/engine/common/include/XmlHelper.h
===================================================================
--- rl/trunk/engine/common/include/XmlHelper.h	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/common/include/XmlHelper.h	2007-09-02 11:49:51 UTC (rev 3788)
@@ -96,6 +96,14 @@
 	static CeGuiString getValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element);
 	
     /**
+	 * Ermittelt den Text eines Elementknotens
+	 *
+	 * @param element Das DOM-Element
+	 * @return Text innerhalb der Element-Tags, als CeGuiString
+	 */
+    static std::string getValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element);
+
+    /**
 	 * Setzt den Text eines Elementknotens, als UTF-8
 	 * vor Benutzung muss initializeTranscoder() aufgerufen werden
 	 *
@@ -135,6 +143,15 @@
 	static int getValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element);
 
     /**
+	 * Ermittelt den Text eines Elementknotens und parst ihn, 
+	 * um eine Ganzzahl daraus zu machen
+	 *
+	 * @param element Das DOM-Element
+	 * @return Zahl, die innerhalb der Element-Tags steht
+	 */
+    static Ogre::Real getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element);
+
+    /**
 	 * Formt einen Ganzzahldubel in einen String um und setzt diesen als Wert
 	 *
 	 * @param element Das DOM-Element

Modified: rl/trunk/engine/common/src/XmlHelper.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlHelper.cpp	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/common/src/XmlHelper.cpp	2007-09-02 11:49:51 UTC (rev 3788)
@@ -84,6 +84,12 @@
 	return transcodeToString( element->getFirstChild()->getNodeValue() );
 }
 
+std::string XmlHelper::getValueAsStdString(DOMElement* element)
+{
+    RlAssert(element != NULL, "XmlHelper::getValueAsStdString: Element must not be NULL");
+	return transcodeToStdString( element->getFirstChild()->getNodeValue() );
+}
+
 DOMElement* XmlHelper::setValueAsUtf8(DOMDocument* doc, DOMElement* element, utf8* value)
 {
     RlAssert(element != NULL, "XmlHelper::setValueAsUtf8: Element must not be NULL");
@@ -312,6 +318,13 @@
 	return XMLString::parseInt(element->getFirstChild()->getNodeValue());
 }
 
+Ogre::Real XmlHelper::getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element)
+{
+    RlAssert(element != NULL, "XmlHelper::getValueAsInteger: Element must not be NULL");
+    return Ogre::StringConverter::parseReal(
+        transcodeToString(element->getFirstChild()->getNodeValue()).c_str());
+}
+
 DOMElement* XmlHelper::setValueAsIntegerPair(DOMDocument *doc, DOMElement *element, IntPair value)
 {
     RlAssert(element != NULL, "XmlHelper::setValueAsIntegerPair: Element must not be NULL");

Modified: rl/trunk/engine/core/include/GameAreaEventSource.h
===================================================================
--- rl/trunk/engine/core/include/GameAreaEventSource.h	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/include/GameAreaEventSource.h	2007-09-02 11:49:51 UTC (rev 3788)
@@ -28,6 +28,7 @@
 
 namespace rl {
 
+class ZoneManager;
 /** 
  * GameAreaEventSource
  * Die Quelle f?r Ereignisse die das betreten/verlassen eines Areals betreffen.
@@ -70,12 +71,18 @@
     bool hasListeners( ) const;
 
     /// Gibt die Art des Areals zur?ck
-    GameAreaType* getGameAreaType() const { return mAreaType; };
+    GameAreaType* getGameAreaType() { return mAreaType; };
     /// Gibt die Actoren die bei der letzten Abfrage innerhalb des Areals waren zur?ck
     const ActorMap& getInsideAreaList() const { return mInsideAreaList; };
     /// Gibt den Actor zur?ck, den das Areal umgibt
     Actor* getActor() const { return mActor; };
-private: 
+protected:
+    /// helps the zonemanager to associate zones with areas
+    friend class ZoneManager;
+    void setId(long id) {mId = id;}
+    long getId() const {return mId;}
+private:
+    long mId;
     /** Verteilt die Events an die angef?gten Listener
     * F?r jeden Actor wird ein einzelnes Ereigniss generiert, zuerst f?r alle
     * verlassenden Actoren, dann f?r die betretenden

Modified: rl/trunk/engine/core/include/GameAreaTypes.h
===================================================================
--- rl/trunk/engine/core/include/GameAreaTypes.h	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/include/GameAreaTypes.h	2007-09-02 11:49:51 UTC (rev 3788)
@@ -35,6 +35,7 @@
 class _RlCoreExport GameAreaType
 {
 public:
+    virtual ~GameAreaType();
     /** F?hrt die Anfrage durch und sammelt die Aktoren innerhalb einer std::map 
      *  Key Wert ist der einzigartige Name des Actors
      *
@@ -67,11 +68,18 @@
     //virtual bool getShowDebug() const = 0;
 
     virtual OgreNewt::Body* getBody() { return NULL;}
+
+    virtual Ogre::Real getDistance(Actor* actor) = 0;
+
+    /// Der minimale abstand, den ein aktor von der zone haben muss, um die zone zu verlassen (um st?ndige wechsel in und aus der zone zu vermeiden)
+    virtual Ogre::Real getTransitionDistance() const = 0;
+    virtual void setTransitionDistance(Ogre::Real dist) = 0;
 };
 
 /** GameSphereAreaType
 * Implementierung einer Kugelanfrage
 */
+/*
 class _RlCoreExport GameSphereAreaType : public GameAreaType
 {
 public:
@@ -80,7 +88,7 @@
      * @param center Das Zentrum der Kugel
      * @param radius Der Radius der Kugel
      * @param mask Die Anfrage Maske
-     */
+    
     GameSphereAreaType(Ogre::Vector3 center, Ogre::Real radius, unsigned long mask = 0xFFFFFFFF );
     /// Dekonstruktor
     virtual ~GameSphereAreaType();
@@ -105,10 +113,11 @@
     /// Die Kugel-Anfrage
     Ogre::SphereSceneQuery* mSphereQuery;
 };
+*/
 
-
 /// ein Problem k?nnte die zeitliche Verschiebung um eine Framedauer sein, wenn position und orientation
 /// neu gesetzt werden, muss erst newton wieder upgedated werden!
+/// Von dieser Klasse muss abgleitet werden, sie definiert keinen eigenen body!
 class _RlCoreExport GameNewtonBodyAreaType : 
     public GameAreaType
 {
@@ -141,10 +150,16 @@
     virtual void resetFoundCollisions();
 
     virtual OgreNewt::Body* getBody() { return mBody;}
+
+    Ogre::Real getDistance(Actor* actor);
+
+    Ogre::Real getTransitionDistance() const;
+    void setTransitionDistance(Ogre::Real dist);
 protected:
     OgreNewt::Body* mBody;
     ActorMap mFoundActors;
     unsigned long mQueryMask;
+    Ogre::Real mTransitionDistance;
 };
 
 
@@ -154,11 +169,23 @@
 public:
     GameMeshAreaType(
             Ogre::Entity* entity,
-            const GeometryType& geomType = GT_NONE,
-			Ogre::Vector3* offset = NULL,
-			Ogre::Quaternion* orientation = NULL);
+            GeometryType geomType = GT_CONVEXHULL,
+            Ogre::Vector3 offset = Ogre::Vector3::ZERO,
+            Ogre::Quaternion orientation = Ogre::Quaternion::IDENTITY);
 };
 
+class _RlCoreExport GameSimpleCollisionAreaType :
+    public GameNewtonBodyAreaType
+{
+public:
+    GameSimpleCollisionAreaType(
+            Ogre::AxisAlignedBox aabb,
+            GeometryType geomType = GT_BOX,
+            Ogre::Vector3 offset = Ogre::Vector3::ZERO,
+            Ogre::Quaternion orientation = Ogre::Quaternion::IDENTITY);
+};
+
+
 }
 
 #endif

Modified: rl/trunk/engine/core/include/GameEventManager.h
===================================================================
--- rl/trunk/engine/core/include/GameEventManager.h	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/include/GameEventManager.h	2007-09-02 11:49:51 UTC (rev 3788)
@@ -32,6 +32,7 @@
 
 class PhysicalThing;
 class GameNewtonBodyAreaType;
+class Zone;
 
 typedef std::set<GameAreaEventSource*> GameAreaEventSourceList;
 
@@ -61,13 +62,43 @@
     * @param actor Der Actor um den herum die Kugel aufgespannt werden soll
     * @param queryMask Die Maske um die SzenenAnfrage zu beschleunigen
     * @param radius Der Radius der Kugel
-    * @param list Der neu hinzuzuf?gende Listener    
+    * @param list Der neu hinzuzuf?gende Listener
+    * @param forceNew erstellt auf jeden Fall eine neue GameAreaEventSource (z.B. f?r den ZoneManager)
+    * @retval Die GameAreaEventSource, der der Listener hinzugef?gt wurde
     */
-    void addSphereAreaListener( Actor* actor, Ogre::Real radius,
-        GameAreaListener* list, unsigned long queryMask = 0xFFFFFFFF );
+    GameAreaEventSource* addSphereAreaListener( Actor* actor, Ogre::Real radius,
+        GameAreaListener* list, unsigned long queryMask = 0xFFFFFFFF, bool forceNew = false);
 
-	void addMeshAreaListener( Actor* meshactor, GeometryType geom, GameAreaListener* list, unsigned long queryMask = 0xFFFFFFFF );
+    /** F?gt eine neue Mesh-Area hinzu und h?ngt einen Listener an
+    *
+    * @param meshactor der meshactor um den herum die area gelegt werden soll
+    * @param geom der Geometrietype, sinnvoll w?re GT_CONVEXHULL (eventuell GT_MESH)
+    * @param list Der neu hinzuzufpgende Listener
+    * @param queryMask Die Querymaske, welche Aktoren von der Area betroffen sind
+    * @param forceNew erstellt auf jeden Fall eine neue GameAreaEventSource (z.B. f?r den ZoneManager)
+    * @retval Die GameAreaEventSource, der der Listener hinzugef?gt wurde
+    */
+	GameAreaEventSource* addMeshAreaListener( Actor* meshactor, GeometryType geom, GameAreaListener* list, 
+        unsigned long queryMask = 0xFFFFFFFF, 
+        Ogre::Vector3 offset = Ogre::Vector3::ZERO, Ogre::Quaternion orientation = Ogre::Quaternion::IDENTITY,
+        bool forceNew = false);
 
+    /** F?gt eine neue Area hinzu und h?ngt einen Listener an
+    *
+    * @param actor Der Actor um den herum die Area aufgespannt werden soll
+    * @param aabb Die Gr??e der Area
+    * @param geom der Geometrietype, m?glich sind GT_BOX, GT_ELLIPSOID, GT_SPHERE, GT_PYRAMID
+    * @param list Der neu hinzuzufpgende Listener
+    * @param queryMask Die Querymaske, welche Aktoren von der Area betroffen sind
+    * @param forceNew erstellt auf jeden Fall eine neue GameAreaEventSource (z.B. f?r den ZoneManager)
+    * @retval Die GameAreaEventSource, der der Listener hinzugef?gt wurde
+    */
+	GameAreaEventSource* addAreaListener( Actor* actor, 
+        Ogre::AxisAlignedBox aabb, GeometryType geom, GameAreaListener* list, 
+        unsigned long queryMask = 0xFFFFFFFF, 
+        Ogre::Vector3 offset = Ogre::Vector3::ZERO, Ogre::Quaternion orientation = Ogre::Quaternion::IDENTITY,
+        bool forceNew = false);
+
     /** Entfernt an allen Areas diesen Listener
     *
     * @param list Der Listener an den GameAreaEventSource
@@ -76,6 +107,11 @@
     */
     void removeAreaListener( GameAreaListener* list );
 
+    /** Entfernt eine bestimmte GameAreaEventSource
+    *
+    */
+    void removeAreaEventSource( GameAreaEventSource *gam );
+
     /** Entfernt alle Areas die an einen Actor gekn?pft sind
       *
       * @param actor Der Actor der GameAreaEventSource

Modified: rl/trunk/engine/core/include/Zone.h
===================================================================
--- rl/trunk/engine/core/include/Zone.h	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/include/Zone.h	2007-09-02 11:49:51 UTC (rev 3788)
@@ -17,20 +17,22 @@
 #define __Zone_H__
 
 #include "CorePrerequisites.h"
+#include "GameEventManager.h"  /* wegen GameAreaEventSourceList */
 
-#include "GameAreaListener.h"
 
 namespace rl {
 
 	class Actor;
 	class LightObject;
 	class Trigger;
+    class GameAreaEventSource;
+    class ZoneManager;
 
-	///@todo: Inheritance is wrong, Zone should be a GameAreaEventSource, ZoneManager a GameAreaListener
-	class _RlCoreExport Zone : public GameAreaListener
+    /// an abstraction of an zone, consisting of all GameAreaEventSources with the associated id
+    class _RlCoreExport Zone
 	{
 	public:
-		Zone(Actor* actor);
+        virtual ~Zone();
 
 		void addLight(Actor* light);
         void addSound(const Ogre::String& name);
@@ -38,19 +40,23 @@
 		std::list<Actor*> getLights() const;
         std::list<Ogre::String> getSounds() const;
 		std::list<Trigger*> getTriggers() const;
-
-		Actor* getActor() const;
-
-		virtual void areaLeft(GameAreaEvent *anEvent);
-	    virtual void areaEntered(GameAreaEvent *anEvent);
-
+        void removeLight(Actor* light);
+        void removeSound(const Ogre::String& name);
+        void removeTrigger(Trigger* trigger);
+        long getId() const {return mId;}
+    protected:
+        friend class ZoneManager;
+        Zone(long id);
+        void addEventSource(GameAreaEventSource* gam);
+        void removeEventSource(GameAreaEventSource* gam);
+        GameAreaEventSourceList& getEventSources();
 	private:
+        long mId;
+        Zone();
 		std::list<Actor*> mLights;
 		std::list<Ogre::String> mSounds;
 		std::list<Trigger*> mTriggers;
-		Actor* mActor;
-
-		void deleteTriggers(const std::list<Trigger*>& toDelete);
+        GameAreaEventSourceList mEventSources;
 	};
 
 }

Modified: rl/trunk/engine/core/include/ZoneManager.h
===================================================================
--- rl/trunk/engine/core/include/ZoneManager.h	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/include/ZoneManager.h	2007-09-02 11:49:51 UTC (rev 3788)
@@ -17,28 +17,62 @@
 #define __ZoneManager_H__
 
 #include "CorePrerequisites.h"
+#include "CoreDefines.h"
+#include "GameAreaListener.h"
 
 namespace rl
 {
     class Zone;
 
-    class _RlCoreExport ZoneManager : public Ogre::Singleton<ZoneManager>
+    class _RlCoreExport ZoneManager : 
+        public Ogre::Singleton<ZoneManager>,
+        public GameAreaListener
 	{
 	public:
 		ZoneManager();
 		~ZoneManager();
 
-        Zone* createZone(const Ogre::String& name, const Ogre::Vector3& position, const Ogre::Real radius, unsigned long queryflags);
-		Zone* getDefaultZone() const;
-		Zone* getZone(const Ogre::String& name) const;
+        Zone* createZone(const Ogre::String& name);
+        void destroyZone(const Ogre::String& name);
+        /// Adds a new area to the zone
+        void addAreaToZone(const Ogre::String& name, 
+            Ogre::AxisAlignedBox aabb, GeometryType geom,
+            Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+            Ogre::Real transitionDistance,
+            unsigned long queryflags);
+        /// subtracts an area from the zone (it must ly in another area in this zone, else the beaviour is not defined)
+        void subtractAreaFromZone(const Ogre::String& name, 
+            Ogre::AxisAlignedBox aabb, GeometryType geom,
+            Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+            Ogre::Real transitionDistance,
+            unsigned long queryflags);
+        /// Adds a new mesh area to the zone
+        void addMeshAreaToZone(const Ogre::String& name,
+            const Ogre::String& meshname, GeometryType geom,
+            Ogre::Vector3 position,
+            Ogre::Vector3 scale, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+            Ogre::Real transitionDistance,
+            unsigned long queryflags);
+        /// subtracts a mesh-area from the zone (it must ly in another area in this zone, else the beaviour is not defined)
+        void subtractMeshAreaFromZone(const Ogre::String& name,
+            const Ogre::String& meshname, GeometryType geom,
+            Ogre::Vector3 position,
+            Ogre::Vector3 scale, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+            Ogre::Real transitionDistance,
+            unsigned long queryflags);
+		Zone* getDefaultZone();
+		Zone* getZone(const Ogre::String& name);
+        Zone* getZone(long id);
 
-		void areaLeft(Zone* zone);
-	    void areaEntered(Zone* zone);
+		void areaLeft(GameAreaEvent* gae);
+	    void areaEntered(GameAreaEvent* gae);
 		
 	private:
 		std::map<const Ogre::String, Zone*> mZones;
+        std::map<long, Zone*> mZonesIdMap;
 		std::list<Zone*> mActiveZones;
 		Zone* mDefaultZone;
+        long mNextZoneId;
 
 		void switchLights();
 		void switchSounds();

Modified: rl/trunk/engine/core/src/GameAreaEventSource.cpp
===================================================================
--- rl/trunk/engine/core/src/GameAreaEventSource.cpp	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/src/GameAreaEventSource.cpp	2007-09-02 11:49:51 UTC (rev 3788)
@@ -65,11 +65,26 @@
         std::set_difference( currInside.begin(), currInside.end(),
             mInsideAreaList.begin(), mInsideAreaList.end(), enteredInsert );
 
+        // diejenigen die rausgefallen sind, aber noch nicht den noetigen abstand haben, wieder hinzufuegen
+        ActorMap reallyLeftMap;
+        ActorMap notReallyLeftMap;
+        ActorMap::iterator it = leftMap.begin();
+        for( ; it != leftMap.end(); it++ )
+        {
+            if( mAreaType->getDistance(it->second) <= mAreaType->getTransitionDistance() )
+                notReallyLeftMap.insert( *it );
+            else
+                reallyLeftMap.insert( *it );
+        }
+
         // Die ???riggebliebenen in mInsideAreaList speichern
+        //mInsideAreaList = currInside + notReallyLeftMap;
         mInsideAreaList = currInside;
+        mInsideAreaList.insert(notReallyLeftMap.begin(), notReallyLeftMap.end());
+        
 
         // Die Neuen und die Rausgefallenen an die Listener dispatchen
-		doDispatchEvents( enteredMap, leftMap );
+		doDispatchEvents( enteredMap, reallyLeftMap );
     }
 
     void GameAreaEventSource::doDispatchEvents(

Modified: rl/trunk/engine/core/src/GameAreaTypes.cpp
===================================================================
--- rl/trunk/engine/core/src/GameAreaTypes.cpp	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/src/GameAreaTypes.cpp	2007-09-02 11:49:51 UTC (rev 3788)
@@ -17,14 +17,21 @@
 
 #include "GameAreaTypes.h"
 
+#include "Actor.h"
 #include "World.h"
 #include "CoreSubsystem.h"
+#include "Exception.h"
 #include "PhysicsManager.h"
+#include "PhysicalThing.h"
 
 
 using namespace Ogre;
 
 namespace rl {
+    GameAreaType::~GameAreaType()
+    {
+    }
+
     void GameAreaType::addQueryFlag( unsigned long flag  )
     {
         setQueryMask(  getQueryMask() | flag );
@@ -38,7 +45,7 @@
 
 
 namespace rl {
-
+/*
     GameSphereAreaType::GameSphereAreaType(Vector3 center, Real radius, unsigned long mask)
     {
         mSphereQuery = CoreSubsystem::getSingleton().getWorld()->
@@ -99,12 +106,13 @@
     {
         return mSphereQuery->getSphere().getCenter( );
     }
+*/
 
 
 
-
     GameNewtonBodyAreaType::GameNewtonBodyAreaType() :
-        mBody(NULL)
+        mBody(NULL),
+        mTransitionDistance(0)
     {
     }
 
@@ -177,15 +185,49 @@
         return mFoundActors;
     }
 
+    Ogre::Real GameNewtonBodyAreaType::getDistance(Actor* actor)
+    {
+        if(!actor)
+            Throw(NullPointerException, "Argument actor cannot be NULL!");
+        OgreNewt::World *world = 
+            PhysicsManager::getSingleton()._getNewtonWorld();
+        Vector3 retA, retB, retNorm;
+        Vector3 positionA;
+        Quaternion orientationA;
+        mBody->getPositionOrientation(positionA, orientationA);
+        int intRet = 
+            OgreNewt::CollisionTools::CollisionClosestPoint(
+                world,
+                mBody->getCollision(), orientationA, positionA,
+                actor->getPhysicalThing()->_getBody()->getCollision(),
+                actor->getOrientation(), actor->getPosition(),
+                retA, retB, retNorm);
+
+        if( intRet == 0 )
+            return 0;
+
+        return (retA - retB).length();
+    }
+
+    Ogre::Real GameNewtonBodyAreaType::getTransitionDistance() const
+    {
+        return mTransitionDistance;
+    }
+
+    void GameNewtonBodyAreaType::setTransitionDistance(Ogre::Real dist) 
+    {
+        mTransitionDistance = dist;
+    }
+
     GameMeshAreaType::GameMeshAreaType(
             Ogre::Entity* entity,
-            const GeometryType& geomType,
-			Ogre::Vector3* offset,
-			Ogre::Quaternion* orientation)
+            GeometryType geomType,
+			Ogre::Vector3 offset,
+			Ogre::Quaternion orientation)
     {
         OgreNewt::CollisionPtr col =
-            PhysicsManager::getSingleton().createCollision(entity,
-            geomType, "", offset, orientation);
+            PhysicsManager::getSingleton().getCollisionFactory()->createCollisionFromEntity(entity,
+            geomType, &offset, &orientation);
         mBody = new OgreNewt::Body(
             PhysicsManager::getSingleton()._getNewtonWorld(),
             col);
@@ -194,5 +236,22 @@
         mBody->setUserData(NULL);
     }
 
+    GameSimpleCollisionAreaType::GameSimpleCollisionAreaType(
+            Ogre::AxisAlignedBox aabb,
+            GeometryType geomType,
+            Ogre::Vector3 offset,
+            Ogre::Quaternion orientation)
+    {
+        OgreNewt::CollisionPtr col =
+            PhysicsManager::getSingleton().getCollisionFactory()->createCollisionFromAABB(
+            aabb, geomType, &offset, &orientation);
+        mBody = new OgreNewt::Body(
+            PhysicsManager::getSingleton()._getNewtonWorld(),
+            col);
+        mBody->setMaterialGroupID(
+            PhysicsManager::getSingleton().getMaterialID("gamearea"));
+        mBody->setUserData(NULL);
+    }
+
 }
 

Modified: rl/trunk/engine/core/src/GameEventManager.cpp
===================================================================
--- rl/trunk/engine/core/src/GameEventManager.cpp	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/src/GameEventManager.cpp	2007-09-02 11:49:51 UTC (rev 3788)
@@ -21,8 +21,12 @@
 #include "CoreSubsystem.h"
 #include "MeshObject.h"
 #include "PhysicsManager.h"
+#include "Zone.h"
 
 
+
+using namespace Ogre;
+
 template<> rl::GameEventManager* Ogre::Singleton<rl::GameEventManager>::ms_Singleton = 0;
 
 namespace rl {
@@ -54,11 +58,11 @@
         // remove collision callbacks
         PhysicsManager *physicsManager = PhysicsManager::getSingletonPtr();
 
-        const OgreNewt::MaterialID *area_mat = physicsManager->createMaterialID("gamearea");
-        const OgreNewt::MaterialID *char_mat = physicsManager->createMaterialID("character");
-        const OgreNewt::MaterialID *def_mat = physicsManager->createMaterialID("default");
-        const OgreNewt::MaterialID *cam_mat = physicsManager->createMaterialID("camera");
-        const OgreNewt::MaterialID *lev_mat = physicsManager->createMaterialID("level");
+        const OgreNewt::MaterialID *area_mat = physicsManager->getMaterialID("gamearea");
+        const OgreNewt::MaterialID *char_mat = physicsManager->getMaterialID("character");
+        const OgreNewt::MaterialID *def_mat = physicsManager->getMaterialID("default");
+        const OgreNewt::MaterialID *cam_mat = physicsManager->getMaterialID("camera");
+        const OgreNewt::MaterialID *lev_mat = physicsManager->getMaterialID("level");
 
         physicsManager->resetMaterialPair(area_mat, char_mat);
         physicsManager->resetMaterialPair(area_mat, def_mat);
@@ -80,11 +84,18 @@
     }
 
 	/// @todo  Doppelte Aktoren nachnutzen??
-    void GameEventManager::addSphereAreaListener( Actor* actor, Ogre::Real radius,
-        GameAreaListener* list, unsigned long queryMask )
+    GameAreaEventSource* GameEventManager::addSphereAreaListener( Actor* actor, Ogre::Real radius,
+        GameAreaListener* list, unsigned long queryMask, bool forceNew )
     {
-        // Neues Areal erzeugen
-        GameAreaType* at = new GameSphereAreaType( actor->getWorldPosition(), radius, queryMask );
+        Ogre::AxisAlignedBox aabb;
+        aabb.setMaximum(radius, radius, radius);
+        aabb.setMaximum(-radius, -radius, -radius);
+        // neues areal ereugen
+        GameNewtonBodyAreaType* at = new GameSimpleCollisionAreaType(
+            aabb, GT_SPHERE);
+
+        at->setQueryMask(queryMask);
+
         // Event-Quelle erzeugen
         GameAreaEventSource* gam = new GameAreaEventSource( at, actor );
         // In die Menge einf?gen
@@ -92,15 +103,23 @@
 		ScriptWrapper::getSingleton().owned( gam );
         // Und Listener anh?ngen
         gam->addAreaListener( list );
+
+        // add to newton collision list
+        mBodyGameAreaMap.insert(std::make_pair(at->getBody(), at));
+
+        return gam;
     }
 
-    void GameEventManager::addMeshAreaListener( Actor* actor, GeometryType geom, GameAreaListener* list, unsigned long queryMask )
+    /// @todo  Doppelte Aktoren nachnutzen??
+    GameAreaEventSource* GameEventManager::addMeshAreaListener( 
+        Actor* actor, GeometryType geom, GameAreaListener* list, unsigned long queryMask, 
+        Vector3 offset, Quaternion orientation, bool forceNew )
     {
         // neues areal ereugen
         MeshObject* meshObj = static_cast<MeshObject*>(actor->getControlledObject());
 
         GameNewtonBodyAreaType* at = new GameMeshAreaType(
-            meshObj->getEntity(), geom);
+            meshObj->getEntity(), geom, offset, orientation);
 
         at->setQueryMask(queryMask);
 
@@ -114,8 +133,36 @@
 
         // add to newton collision list
         mBodyGameAreaMap.insert(std::make_pair(at->getBody(), at));
+
+        return gam;
     }
 
+    /// @todo  Doppelte Aktoren nachnutzen??
+    GameAreaEventSource* GameEventManager::addAreaListener(Actor* actor,
+        Ogre::AxisAlignedBox aabb, GeometryType geom, GameAreaListener* list, 
+        unsigned long queryMask, 
+        Vector3 offset, Quaternion orientation,
+        bool forceNew)
+    {
+        GameNewtonBodyAreaType* at = new GameSimpleCollisionAreaType(
+            aabb, geom, offset, orientation);
+
+        at->setQueryMask(queryMask);
+
+        // Event-Quelle erzeugen
+        GameAreaEventSource* gam = new GameAreaEventSource( at, actor );
+        // In die Menge einf?gen
+        mAreaEventSources.insert( gam );
+		ScriptWrapper::getSingleton().owned( gam );
+        // Und Listener anh?ngen
+        gam->addAreaListener( list );
+
+        // add to newton collision list
+        mBodyGameAreaMap.insert(std::make_pair(at->getBody(), at));
+
+        return gam;
+    }
+
     void GameEventManager::removeAreaListener( GameAreaListener* list )
     {
         GameAreaEventSourceList::iterator it;
@@ -136,6 +183,18 @@
         }
     }
 
+    void GameEventManager::removeAreaEventSource( GameAreaEventSource *gam )
+    {
+        GameAreaEventSourceList::iterator it = mAreaEventSources.find(gam);
+        if( it != mAreaEventSources.end() )
+        {
+            it = mQueuedDeletionSources.find(gam);
+            if( it == mQueuedDeletionSources.end() )
+                mQueuedDeletionSources.insert(gam);
+        }
+
+    }
+
     void GameEventManager::removeAllAreas( Actor* actor )
     {
         GameAreaEventSourceList::iterator it;
@@ -147,6 +206,7 @@
             if( gam->getActor() == actor )
             {
 				// Sp?ter l?schen
+
                 mQueuedDeletionSources.insert( gam );
             }
 
@@ -217,7 +277,7 @@
             return 0;
         }
 
-        LOG_WARNING(Logger::CORE, "Der Kollisionsk?rper konne keiner GameArea zugeordnet werden!");
+        LOG_WARNING(Logger::CORE, "Der Kollisionsk?rper konnte keiner GameArea zugeordnet werden!");
         return 0;
     }
 

Modified: rl/trunk/engine/core/src/Zone.cpp
===================================================================
--- rl/trunk/engine/core/src/Zone.cpp	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/src/Zone.cpp	2007-09-02 11:49:51 UTC (rev 3788)
@@ -26,51 +26,15 @@
 namespace rl
 {
 
-	Zone::Zone(Actor* actor)
-	 : GameAreaListener(),
-	   mActor(actor)
-	{
-	}
 
-	Actor* Zone::getActor() const
-	{
-		return mActor;
-	}
+    Zone::Zone(long id) : mId(id)
+    {
+    }
 
-	void Zone::areaLeft(GameAreaEvent *anEvent)
-	{
-		ZoneManager::getSingleton().areaLeft(this);
+    Zone::~Zone()
+    {
+    }
 
-		std::list<Trigger*> toDelete;
-		for (std::list<Trigger*>::iterator it = mTriggers.begin(); it != mTriggers.end(); ++it)
-		{
-			bool remove = (*it)->deactivate();
-			if (remove)
-			{
-				toDelete.push_back(*it);
-			}
-		}
-
-		deleteTriggers(toDelete);
-	}
-
-    void Zone::areaEntered(GameAreaEvent *anEvent)
-	{
-		ZoneManager::getSingleton().areaEntered(this);
-
-		std::list<Trigger*> toDelete;
-		for (std::list<Trigger*>::iterator it = mTriggers.begin(); it != mTriggers.end(); ++it)
-		{
-			bool remove = (*it)->activate();
-			if (remove)
-			{
-				toDelete.push_back(*it);
-			}
-		}
-
-		deleteTriggers(toDelete);
-	}
-
 	void Zone::addLight(Actor* lo)
 	{
 		if (lo != NULL)
@@ -87,6 +51,14 @@
 		}
 	}
 
+	void Zone::addTrigger(Trigger* trigger)
+	{
+		if (trigger != NULL)
+		{
+			mTriggers.push_back(trigger);
+		}
+	}
+
 	std::list<Actor*> Zone::getLights() const
 	{
 		std::list<Actor*> rval(mLights);
@@ -99,17 +71,66 @@
 		return rval;
 	}
 
+	std::list<Trigger*> Zone::getTriggers() const
+	{
+		std::list<Trigger*> rval(mTriggers);
+		return rval;
+	}
 
-	void Zone::deleteTriggers(const std::list<Trigger*>& toDelete)
+    void Zone::removeLight(Actor *light)
+    {
+        if( !light )
+            Throw(NullPointerException, "Light-Actor is NULL!");
+        std::list<Actor*>::iterator it = 
+            std::find(mLights.begin(), mLights.end(), light);
+        if( it == mLights.end() )
+            Throw(IllegalArgumentException, "Could not find light-actor '" + light->getName() + "' in this zone!");
+
+        mLights.erase(it);
+    }
+
+    void Zone::removeSound(const Ogre::String& sound)
+    {
+        std::list<Ogre::String>::iterator it = 
+            std::find(mSounds.begin(), mSounds.end(), sound);
+        if( it == mSounds.end() )
+            Throw(IllegalArgumentException, "Could not find sound '" + sound + "' in this zone!");
+
+        mSounds.erase(it);
+    }
+
+    void Zone::removeTrigger(Trigger* trigger)
+    {
+        if( !trigger )
+            Throw(NullPointerException, "Trigger is NULL!");
+        std::list<Trigger*>::iterator it = 
+            std::find(mTriggers.begin(), mTriggers.end(), trigger);
+        if( it == mTriggers.end() )
+            Throw(IllegalArgumentException, "Could not find the Trigger in this zone!");
+
+        mTriggers.erase(it);
+    }
+
+    void Zone::addEventSource(GameAreaEventSource *gam)
+    {
+        if( gam != NULL )
+            mEventSources.insert(gam);
+    }
+
+    void Zone::removeEventSource(GameAreaEventSource *gam)
+    {
+        if( gam )
+        {
+            GameAreaEventSourceList::iterator it = mEventSources.find(gam);
+            if( it == mEventSources.end() )
+                LOG_ERROR(Logger::CORE, "Could not find the GameAreaEventSource in this zone!");
+
+            mEventSources.erase(it);
+        }
+    }
+
+	GameAreaEventSourceList& Zone::getEventSources()
 	{
-		for (std::list<Trigger*>::const_iterator it = toDelete.begin();
-			it != toDelete.end(); ++it)
-		{
-			const Trigger* cur = *it;
-
-			std::list<Trigger*>::iterator trigIt =
-				std::find(mTriggers.begin(), mTriggers.end(), cur);
-			mTriggers.erase(trigIt);
-		}
+		return mEventSources;
 	}
 }

Modified: rl/trunk/engine/core/src/ZoneManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-02 11:49:51 UTC (rev 3788)
@@ -22,6 +22,10 @@
 #include "GameEventManager.h"
 #include "Zone.h"
 
+
+using namespace Ogre;
+
+
 template<> rl::ZoneManager* Ogre::Singleton<rl::ZoneManager>::ms_Singleton = 0;
 
 namespace rl
@@ -30,32 +34,33 @@
 		: Ogre::Singleton<ZoneManager>()
 	{
 		// the default zone is active when no other Zone is active
-		mDefaultZone = new Zone(NULL);
+		mDefaultZone = new Zone(0);
+        mNextZoneId = 1;
 		mActiveZones.push_front(mDefaultZone);
 	}
 
 	ZoneManager::~ZoneManager()
 	{
+        GameEventManager::getSingleton().removeAreaListener(this);
+        GameEventManager::getSingleton().removeQueuedDeletionSources();
 		for (std::map<const Ogre::String, Zone*>::iterator it = mZones.begin(); it != mZones.end(); ++it)
 		{
 			Zone* curZone = (*it).second;
-			GameEventManager::getSingleton().removeAreaListener(curZone);
+            delete curZone;
 		}
-		GameEventManager::getSingleton().removeQueuedDeletionSources();
 		delete mDefaultZone;
 	}
 
-	Zone* ZoneManager::getDefaultZone() const
+	Zone* ZoneManager::getDefaultZone()
 	{
 		return mDefaultZone;
 	}
 
-	Zone* ZoneManager::getZone(const Ogre::String& name) const
+	Zone* ZoneManager::getZone(const Ogre::String& name)
 	{
 		std::map<const Ogre::String, Zone*>::const_iterator it = mZones.find(name);
 		if (it == mZones.end())
 		{
-			LOG_ERROR(Logger::CORE, "Zone '"+name+"' not found.");
 			return NULL;
 		}
 		else
@@ -64,30 +69,198 @@
 		}
 	}
 
-    Zone* ZoneManager::createZone(const Ogre::String& name, const Ogre::Vector3& position, const Ogre::Real radius, unsigned long queryflags)
+	Zone* ZoneManager::getZone(long id)
 	{
+		std::map<long, Zone*>::const_iterator it = mZonesIdMap.find(id);
+		if (it == mZonesIdMap.end())
+		{
+			return NULL;
+		}
+		else
+		{
+			return (*it).second;
+		}
+	}
 
-		Actor* kugelDings = ActorManager::getSingleton().createEmptyActor("Light zone center");
-		kugelDings->placeIntoScene(position);
-		Zone* lz = new Zone(kugelDings);
-		mZones[name] = lz;
-		GameEventManager::getSingleton().addSphereAreaListener(kugelDings, radius, lz, queryflags);
+    Zone* ZoneManager::createZone(const Ogre::String& name)
+	{
+        Zone* zone = new Zone(mNextZoneId);
+        mZonesIdMap[mNextZoneId] = zone;
+        mZones[name] = zone;
+        mNextZoneId++;
 
-		return lz;
+		return zone;
 	}
 
-	void ZoneManager::areaLeft(Zone* zone)
+    void ZoneManager::destroyZone(const Ogre::String& name)
+    {
+        Zone* zone = getZone(name);
+        if(zone == NULL)
+            return;
+
+        //destroy all areas
+        GameAreaEventSourceList::iterator iter = zone->getEventSources().begin();
+        for( ; iter != zone->getEventSources().end(); iter++ )
+        {
+            // we have our own actors, remove them
+            ActorManager::getSingleton().destroyActor( (*iter)->getActor() );
+		    GameEventManager::getSingleton().removeAreaEventSource(
+                (*iter));
+        }
+
+        std::map<const Ogre::String, Zone*>::iterator it = mZones.find(name);
+        if( it != mZones.end() )
+            mZones.erase(it);
+
+        std::map<long, Zone*>::iterator it_ = mZonesIdMap.find(zone->getId());
+        if( it_ != mZonesIdMap.end() )
+            mZonesIdMap.erase(it_);
+
+        delete zone;
+    }
+
+    void ZoneManager::addAreaToZone(const Ogre::String& name, 
+        AxisAlignedBox aabb, GeometryType geom,
+        Vector3 position, Vector3 offset, Quaternion orientation,
+        Real transitionDistance,
+        unsigned long queryflags)
+    {
+        Zone* zone = getZone(name);
+        if( !zone )
+            return;
+
+        Actor* actor = ActorManager::getSingleton().createEmptyActor("Zone_"+name);
+        actor->placeIntoScene(position);
+
+        GameAreaEventSource* gam =
+            GameEventManager::getSingleton().addAreaListener(actor, 
+                aabb, geom, this, queryflags, offset, orientation, true);
+
+        gam->getGameAreaType()->setTransitionDistance(transitionDistance);
+        gam->setId(zone->getId());
+    }
+    
+    void ZoneManager::subtractAreaFromZone(const Ogre::String& name, 
+        AxisAlignedBox aabb, GeometryType geom,
+        Vector3 position, Vector3 offset, Quaternion orientation,
+        Real transitionDistance,
+        unsigned long queryflags)
+    {
+        Zone* zone = getZone(name);
+        if( !zone )
+            return;
+
+        Actor* actor = ActorManager::getSingleton().createEmptyActor("Zone_Area_"+name);
+        actor->placeIntoScene(position);
+
+        GameAreaEventSource* gam =
+            GameEventManager::getSingleton().addAreaListener(actor, 
+                aabb, geom, this, queryflags, offset, orientation, true);
+
+        gam->getGameAreaType()->setTransitionDistance(transitionDistance);
+        gam->setId( - (zone->getId())); // a negative id indicates to subtract this area from the zone
+    }
+
+    void ZoneManager::addMeshAreaToZone(const Ogre::String& name,
+        const Ogre::String& meshname, GeometryType geom,
+        Vector3 position,
+        Vector3 scale, Vector3 offset, Quaternion orientation,
+        Real transitionDistance,
+        unsigned long queryflags)
+    {
+        Zone* zone = getZone(name);
+        if( !zone )
+            return;
+
+        Actor *actor = ActorManager::getSingleton().createMeshActor(
+            "Zone_MeshArea_"+name+"_"+meshname, 
+            meshname, GT_NONE); // don't create physics-proxy
+        if(!actor)
+            return;
+
+        actor->placeIntoScene(position);
+        actor->setScale(scale.x, scale.y, scale.z);
+
+        GameAreaEventSource* gam =
+            GameEventManager::getSingleton().addMeshAreaListener(
+                actor, geom, this, queryflags, offset, orientation, true);
+
+        gam->getGameAreaType()->setTransitionDistance(transitionDistance);
+        gam->setId( zone->getId() );
+    }
+
+    void ZoneManager::subtractMeshAreaFromZone(const Ogre::String& name,
+        const Ogre::String& meshname, GeometryType geom,
+        Vector3 position,
+        Vector3 scale, Vector3 offset, Quaternion orientation,
+        Real transitionDistance,
+        unsigned long queryflags)
+    {
+        Zone* zone = getZone(name);
+        if( !zone )
+            return;
+
+        Actor *actor = ActorManager::getSingleton().createMeshActor(
+            "Zone_MeshArea_"+name+"_"+meshname, 
+            meshname, GT_NONE); // don't create physics-proxy
+        if(!actor)
+            return;
+
+        actor->placeIntoScene(position);
+        actor->setScale(scale.x, scale.y, scale.z);
+
+        GameAreaEventSource* gam =
+            GameEventManager::getSingleton().addMeshAreaListener(
+                actor, geom, this, queryflags, offset, orientation, true);
+
+        gam->getGameAreaType()->setTransitionDistance(transitionDistance);
+        gam->setId( - (zone->getId()) ); // a negative id indicates to subtract this area from the zone
+    }
+
+	void ZoneManager::areaLeft(GameAreaEvent* gae)
 	{
-		mActiveZones.remove(zone);
-		switchLights();
-		switchSounds();
+        long id = gae->getSource()->getId();
+        if( id != 0 )
+        {
+            if( id > 0 )
+            {
+                Zone *zone = getZone(id);
+                if( zone )
+                    mActiveZones.remove(zone);
+            }
+            else
+            {
+                Zone *zone = getZone(-id); // means we have to subtract this area from the zone
+                if( zone )
+                    mActiveZones.push_front(zone);
+            }
+
+		    switchLights();
+		    switchSounds();
+        }
 	}
 
-	void ZoneManager::areaEntered(Zone* zone)
+	void ZoneManager::areaEntered(GameAreaEvent* gae)
 	{
-		mActiveZones.push_front(zone);
-		switchLights();
-		switchSounds();
+        long id = gae->getSource()->getId();
+        if( id != 0 )
+        {
+            if( id > 0 )
+            {
+                Zone *zone = getZone(id);
+                if( zone )
+                    mActiveZones.push_front(zone);
+            }
+            else
+            {
+                Zone *zone = getZone(-id); // means we have to subtract this area from the zone
+                if( zone )
+                    mActiveZones.remove(zone);
+            }
+
+		    switchLights();
+		    switchSounds();
+        }
 	}
 
 	void ZoneManager::switchLights()

Modified: rl/trunk/engine/rules/include/Creature.h
===================================================================
--- rl/trunk/engine/rules/include/Creature.h	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/rules/include/Creature.h	2007-09-02 11:49:51 UTC (rev 3788)
@@ -349,6 +349,14 @@
              *  @throws InvalidArgumentException Das Talent konnte in \c mTalente
              *   nicht gefunden werden.
              */
+
+            /**
+                  * Gibt true zurueck, falls das Talent \a talentName \a gefunden wurde
+              * @param talentName Bezeichnet das Talent
+              * @param checkAusweichTalente Gibt an, ob ebenfalls nach Ausweichtalenten gesucht werden soll
+            */
+            bool hasTalent(const CeGuiString talentName, bool checkAusweichTalente = true);
+
             virtual int getTalent(const CeGuiString talentName);
             /**
                    *  Setzt den Wert des Talents \a talentName.

Modified: rl/trunk/engine/rules/src/Creature.cpp
===================================================================
--- rl/trunk/engine/rules/src/Creature.cpp	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/rules/src/Creature.cpp	2007-09-02 11:49:51 UTC (rev 3788)
@@ -364,6 +364,29 @@
 		fireObjectStateChangeEvent();
     }
 
+    bool Creature::hasTalent(const CeGuiString talentName, bool ausweich)
+    {
+		checkEffects();
+        TalentMap::const_iterator it = mTalente.find(talentName);
+        if (it != mTalente.end())
+            return true;
+        /*
+        if( ausweich )
+        {
+            Talent::AusweichTalente ausweichTalente;
+            ausweichTalente =
+                DsaManager::getSingleton().getTalent(talentName)->getAusweichTalente();
+            Talent::AusweichTalente::const_iterator ausweichIt = ausweichTalente.begin();
+            if (ausweichIt != ausweichTalente.end())
+            {
+                return true;
+            }
+        }
+        */
+		
+        return false;
+    }
+
     int Creature::getTalent(const CeGuiString talentName)
     {
         TalentMap::const_iterator it = mTalente.find(talentName);

Modified: rl/trunk/engine/rules/src/CreatureController.cpp
===================================================================
--- rl/trunk/engine/rules/src/CreatureController.cpp	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/rules/src/CreatureController.cpp	2007-09-02 11:49:51 UTC (rev 3788)
@@ -432,7 +432,7 @@
             if( mLastProbe + Date::ONE_SPIELRUNDE >= now || mLastProbe == 0 )
             {
                 mTimePerAu = 120; // was 180
-                try
+                if( mMovingCreature->getCreature()->hasTalent("Athletik") )
                 {
                     mLastProbe = now;
                     int taw = mMovingCreature->getCreature()->doTalentprobe("Athletik",0);
@@ -449,7 +449,7 @@
                         mTimePerAu += taw * 5;
                     }
                 }
-                catch(IllegalArgumentException)
+                else
                 {
                     mTimePerAu = 120; // was 180
                 }
@@ -542,7 +542,7 @@
             if( mLastProbe + mMovingCreature->getCreature()->getAuMax() * Date::ONE_SECOND >= now || mLastProbe == 0)
             {
                 mVelocityImprovement = 0;
-                try
+                if( mMovingCreature->getCreature()->hasTalent("Athletik") )
                 {
                     mLastProbe = now;
                     int taw = mMovingCreature->getCreature()->doTalentprobe("Athletik",0);
@@ -559,7 +559,7 @@
                         mVelocityImprovement += taw * 0.1;
                     }
                 }
-                catch(IllegalArgumentException)
+                else
                 {
                     mVelocityImprovement = 0;
                 }
@@ -728,7 +728,7 @@
             mTimer = 0;
             calculateBaseVelocity(mHeight);
 
-            try
+            if( mMovingCreature->getCreature()->hasTalent("Athletik") )
             {
                 int taw = mMovingCreature->getCreature()->doTalentprobe("Athletik", 0);
                 if( taw > 0 )
@@ -747,7 +747,7 @@
                     }
                 }
             }
-            catch(IllegalArgumentException)
+            else
             {
             }
             mMovingCreature->getCreature()->damageAu(2./3);
@@ -896,22 +896,22 @@
             mTimer = 0;
             calculateBaseVelocity(mWidth);
 
-            try
+
+            // the person will only achieve this width if it is running
+            // retrieve run movement
+            AbstractMovement *run = mMovingCreature->getMovementFromId(CreatureController::MT_RENNEN);
+            if( run != NULL )
             {
-                // the person will only achieve this width if it is running
-                // retrieve run movement
-                AbstractMovement *run = mMovingCreature->getMovementFromId(CreatureController::MT_RENNEN);
-                if( run != NULL )
-                {
-                    Real vel(0);
-                    run->calculateBaseVelocity(vel);
-                    Real factor = -mMovingCreature->getVelocity().z / vel;
-                    factor = std::max(Real(0),factor);
-                    // without moving before, the width will be 1/3
-                    mWidth = mWidth/3. + mWidth * 2./3. * factor;
-                }
+                Real vel(0);
+                run->calculateBaseVelocity(vel);
+                Real factor = -mMovingCreature->getVelocity().z / vel;
+                factor = std::max(Real(0),factor);
+                // without moving before, the width will be 1/3
+                mWidth = mWidth/3. + mWidth * 2./3. * factor;
+            }
 
-
+            if( mMovingCreature->getCreature()->hasTalent("Athletik") )
+            {
                 int taw = mMovingCreature->getCreature()->doTalentprobe("Athletik", 0);
                 if( taw > 0 )
                 {
@@ -929,9 +929,7 @@
                     }
                 }
             }
-            catch(IllegalArgumentException)
-            {
-            }
+
             mMovingCreature->getCreature()->damageAu(2./3);
         }
         virtual void deactivate()

Modified: rl/trunk/engine/script/src/ZoneProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-02 11:49:51 UTC (rev 3788)
@@ -45,40 +45,122 @@
 				&& XmlHelper::hasNodeName(cur, "zone"))
             {
 				DOMElement* curZoneElem = static_cast<DOMElement*>(cur);
-				if (XmlHelper::hasAttribute(curZoneElem, "type"))
+				if (XmlHelper::hasAttribute(curZoneElem, "name"))
 				{
-					Ogre::String type = XmlHelper::getAttributeValueAsStdString(curZoneElem, "type");
-					Zone* zone = NULL;
-					if (type == "default")
-					{
-						zone = ZoneManager::getSingleton().getDefaultZone();
-					}
-					else if (type == "mesh")
-					{
-						///@todo: zone = ZoneManager::getSingleton().createZone(...);
-					}
-					else if (type == "sphere")
-					{
-						Vector3 center = Vector3::ZERO;
-						DOMElement* centerElem = XmlHelper::getChildNamed(curZoneElem, "center");
-						if (centerElem != NULL)
-						{
-							center = XmlHelper::getValueAsVector3(centerElem);
-						}
+					Ogre::String name = XmlHelper::getAttributeValueAsStdString(curZoneElem, "name");
+                    Zone* zone = NULL;
+                    if( name == "default" )
+                        zone = ZoneManager::getSingleton().getDefaultZone();
+                    else
+                    {
+                        // get the zone with that name or create one
+                        zone = ZoneManager::getSingleton().getZone(name);
+                        if( !zone )
+                            zone = ZoneManager::getSingleton().createZone(name);
 
-						Real radius = 1;
-						DOMElement* radiusElem = XmlHelper::getChildNamed(curZoneElem, "radius");
-						if (radiusElem != NULL)
-						{
-							radius = XmlHelper::getAttributeValueAsReal(radiusElem, "r");
-						}
+                        // multiple areas
+                        for(DOMNode* curArea = cur->getFirstChild(); curArea != NULL; curArea = curArea->getNextSibling())
+                        {
+                            if( curArea->getNodeType() == DOMNode::ELEMENT_NODE
+                                && XmlHelper::hasNodeName(curArea, "area") )
+                            {
+                                DOMElement *curAreaElem = static_cast<DOMElement*>(curArea);
+                                if( XmlHelper::hasAttribute(curAreaElem, "type") )
+                                {
+                                    // type
+                                    Ogre::String type;
+                                    type = XmlHelper::getAttributeValueAsStdString(curAreaElem, "type");
 
-						Ogre::String name = XmlHelper::getAttributeValueAsStdString(curZoneElem, "name");
+                                    // add or subtract?
+                                    bool subtract = false;
+                                    if( XmlHelper::hasAttribute(curAreaElem, "subtract") )
+                                        subtract = XmlHelper::getAttributeValueAsBool(curAreaElem, "subtract");
 
-						zone = ZoneManager::getSingleton().createZone(
-							name, center, radius, QUERYFLAG_PLAYER);
-					}
+                                    // position
+                                    Vector3 position = Vector3::ZERO;
+                                    DOMElement* positionElem = XmlHelper::getChildNamed(curAreaElem, "position");
+                                    if( positionElem != NULL )
+                                        position = XmlHelper::getValueAsVector3(positionElem);
 
+                                    //scale, rotation, offset
+                                    Vector3 scale = Vector3::UNIT_SCALE;
+                                    DOMElement* scaleElem = XmlHelper::getChildNamed(curAreaElem, "scale");
+                                    if( scaleElem != NULL )
+                                        scale = XmlHelper::getValueAsVector3(scaleElem);
+
+                                    Vector3 offset = Vector3::ZERO;
+                                    DOMElement* offsetElem = XmlHelper::getChildNamed(curAreaElem, "offset");
+                                    if( offsetElem != NULL )
+                                        offset = XmlHelper::getValueAsVector3(offsetElem);
+
+                                    Quaternion rotation = Quaternion::IDENTITY;
+                                    DOMElement* rotationElem = XmlHelper::getChildNamed(curAreaElem, "rotation");
+                                    if( rotationElem != NULL )
+                                        rotation = XmlHelper::getValueAsQuaternion(rotationElem);
+
+                                    //transition distance
+                                    Real transitionDistance = 0;
+                                    DOMElement* transitionElem = XmlHelper::getChildNamed(curAreaElem, "transition_distance");
+                                    if( transitionElem != NULL )
+                                        transitionDistance = XmlHelper::getValueAsReal(transitionElem);
+
+					            
+                                    if (type == "mesh")
+    					            {
+                                        Ogre::String meshName;
+                                        if( XmlHelper::hasAttribute(curAreaElem, "meshfile") )
+                                        {
+                                            meshName = XmlHelper::getAttributeValueAsStdString(curAreaElem, "meshfile");
+                                            if( subtract )
+                                                ZoneManager::getSingleton().subtractMeshAreaFromZone(name,
+                                                    meshName, GT_CONVEXHULL, position, scale, offset, rotation, transitionDistance, QUERYFLAG_PLAYER);
+                                            else
+                                                ZoneManager::getSingleton().addMeshAreaToZone(name,
+                                                    meshName, GT_CONVEXHULL, position, scale, offset, rotation, transitionDistance, QUERYFLAG_PLAYER);
+                                        }
+                                        else
+                                            LOG_ERROR(Logger::SCRIPT, "an <area> element with type=\"mesh\" must have attribute 'meshfile'");
+                                    }
+    					            else
+                                    {
+                                        GeometryType geom = GT_NONE;
+                                        if (type == "sphere" )
+                                            geom = GT_SPHERE;
+                                        else if (type == "box" )
+                                            geom = GT_BOX;
+                                        else if (type == "ellipsoid" )
+                                            geom = GT_ELLIPSOID;
+                                        else if (type == "pyramid" )
+                                            geom = GT_PYRAMID;
+                                        else if (type == "capsule" )
+                                            geom = GT_CAPSULE;
+                                        else
+                                        {
+                                            LOG_ERROR(Logger::SCRIPT, "Unknown area type '" + type + "' !");
+                                        }
+                                        if ( geom != GT_NONE )
+                                        {
+                                            Ogre::AxisAlignedBox aabb;
+                                            aabb.setMinimum( - scale / 2.0f);
+                                            aabb.setMaximum( + scale / 2.0f);
+
+                                            if( subtract )
+                                                ZoneManager::getSingleton().subtractAreaFromZone(name,
+                                                    aabb, geom, position, offset, rotation, transitionDistance, QUERYFLAG_PLAYER);
+                                            else
+                                                ZoneManager::getSingleton().addAreaToZone(name,
+                                                    aabb, geom, position, offset, rotation, transitionDistance, QUERYFLAG_PLAYER);
+                                        }
+                                    }
+                                }
+                                else
+                                {
+                                    LOG_ERROR(Logger::SCRIPT, "<area> elemt must have attribute 'type'");
+                                }
+                            }
+                        }
+                    }
+
 					if (zone != NULL)
 					{
 						for (DOMNode* cur = curZoneElem->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
@@ -111,12 +193,12 @@
 					}
 					else
 					{
-						LOG_ERROR(Logger::RULES, "Zone of type '"+type+"' could not be processes.");
+						LOG_ERROR(Logger::SCRIPT, "Zone named '"+name+"' could not be processes.");
 					}
 				}
 				else
 				{
-					LOG_ERROR(Logger::RULES, "<zone> element must have attribute 'type'.");
+					LOG_ERROR(Logger::SCRIPT, "<zone> element must have attribute 'name'.");
 				}
 			}
 		}

Modified: rl/trunk/engine/script/swig/RlCore.swig
===================================================================
--- rl/trunk/engine/script/swig/RlCore.swig	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/script/swig/RlCore.swig	2007-09-02 11:49:51 UTC (rev 3788)
@@ -14,7 +14,9 @@
  *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
  */
 
+
 namespace rl {
+/*
 %{
 static swig_type_info *GameAreaType_dynamic_cast(void **ptr) {
     rl::GameAreaType *pGameAreaType = static_cast<rl::GameAreaType *>(*ptr);
@@ -29,9 +31,9 @@
 }
 %}
 DYNAMIC_CAST(SWIGTYPE_p_rl__GameAreaType, GameAreaType_dynamic_cast);
+*/
 
 
-
 %{
 static swig_type_info *BaseAnimation_dynamic_cast(void **ptr) {
     rl::BaseAnimation *pBaseAnimation = static_cast<rl::BaseAnimation *>(*ptr);
@@ -205,13 +207,14 @@
     const Ogre::Vector3& getQueryPosition() const;
 };
 
+/*
 class GameSphereAreaType : public GameAreaType
 {
 private:
 	GameSphereAreaType( Ogre::Vector3, Ogre::Real, unsigned long mask = 0xFFFFFFFF );
 public:
 };
-
+*/
 class GameAreaEventSource
 {
 private: 
@@ -221,7 +224,7 @@
     void removeAreaListener( rl::GameAreaListener* list );
     bool hasListeners( ) const;
 
-    rl::GameAreaType* getGameAreaType() const;
+    rl::GameAreaType* getGameAreaType();
     // const ActorMap& getInsideAreaList() const;
     rl::Actor* getActor() const;
 };
@@ -885,20 +888,59 @@
 
 class Zone
 {
-private:
-	Zone(Actor* actor);
 public:
 	void addLight(Actor* light);
-	void addSound(const Ogre::String& sound);
+    void addSound(const Ogre::String& name);
+	//void addTrigger(Trigger* trigger);
+	std::list<Actor*> getLights() const;
+    std::list<Ogre::String> getSounds() const;
+	//std::list<Trigger*> getTriggers() const;
+    void removeLight(Actor* light);
+    void removeSound(const Ogre::String& name);
+    //void removeTrigger(Trigger* trigger);
+protected:
+    Zone(long id);
+private:
+    Zone();
 };
 
+
 class ZoneManager
 {
 public:
 	static const ZoneManager& getSingleton();
-	Zone* createZone(const Ogre::String& name, const Ogre::Vector3& position, const Ogre::Real radius, unsigned long queryflags);
-	Zone* getDefaultZone() const;
-	Zone* getZone(const Ogre::String& name) const;
+    rl::Zone* createZone(const Ogre::String& name);
+    void destroyZone(const Ogre::String& name);
+
+    void addAreaToZone(const Ogre::String& name, 
+        Ogre::AxisAlignedBox aabb, rl::GeometryType geom,
+        Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+        Ogre::Real transitionDistance,
+        unsigned long queryflags);
+
+    void subtractAreaFromZone(const Ogre::String& name, 
+        Ogre::AxisAlignedBox aabb, rl::GeometryType geom,
+        Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+        Ogre::Real transitionDistance,
+        unsigned long queryflags);
+
+    void addMeshAreaToZone(const Ogre::String& name,
+        const Ogre::String& meshname, rl::GeometryType geom,
+        Ogre::Vector3 position,
+        Ogre::Vector3 scale, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+        Ogre::Real transitionDistance,
+        unsigned long queryflags);
+
+    void subtractMeshAreaFromZone(const Ogre::String& name,
+        const Ogre::String& meshname, rl::GeometryType geom,
+        Ogre::Vector3 position,
+        Ogre::Vector3 scale, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+        Ogre::Real transitionDistance,
+        unsigned long queryflags);
+        
+	rl::Zone* getDefaultZone();
+	rl::Zone* getZone(const Ogre::String& name);
+    rl::Zone* getZone(long id);
 };
 
 class  Trigger

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2007-09-01 22:12:20 UTC (rev 3787)
+++ rl/trunk/engine/script/swig/RlRules.swig	2007-09-02 11:49:51 UTC (rev 3788)
@@ -681,6 +681,7 @@
 
         
         void addTalent(const rl::CeGuiString talentName, int value=0);
+        bool hasTalent(const rl::CeGuiString talentName, bool checkAusweichTalente = true);
         virtual int getTalent(const rl::CeGuiString talentName);
         virtual void setTalent(const rl::CeGuiString talentName, int value);
         virtual void modifyTalent(const rl::CeGuiString talentName, int mod);



From melven at mail.berlios.de  Sun Sep  2 13:51:39 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sun, 2 Sep 2007 13:51:39 +0200
Subject: [Dsa-hl-svn] r3789 - in modules: regressiontest/maps ruchin/maps
Message-ID: <200709021151.l82BpdnW013230@sheep.berlios.de>

Author: melven
Date: 2007-09-02 13:51:31 +0200 (Sun, 02 Sep 2007)
New Revision: 3789

Modified:
   modules/regressiontest/maps/regressiontest_lights.rlmap.xml
   modules/ruchin/maps/ruchin_lightzones.rlmap.xml
Log:
adapted light-maps to new zone-definitions

Modified: modules/regressiontest/maps/regressiontest_lights.rlmap.xml
===================================================================
--- modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-02 11:49:51 UTC (rev 3788)
+++ modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-02 11:51:31 UTC (rev 3789)
@@ -26,12 +26,15 @@
 		</light>
 	</nodes>
 	<zones>
-		<zone type="default">
+		<zone name="default">
 			<light name="blue sun"/>
 		</zone>
-		<zone type="sphere" name="Testzone">
-			<center x="-10" y="0" z="-5"/>
-			<radius r="3"/>
+		<zone name="Testzone">
+			<area type="sphere">
+				<position x="-10" y="0" z="-5"/>
+				<scale x="6" y="6" z="6"/>
+				<transition_distance>0.5</transition_distance>
+			</area>
 			<light name="red pointlight"/>
 			<light name="green spotlight"/>
 			<sound name="lachen.ogg"/>

Modified: modules/ruchin/maps/ruchin_lightzones.rlmap.xml
===================================================================
--- modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-02 11:49:51 UTC (rev 3788)
+++ modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-02 11:51:31 UTC (rev 3789)
@@ -215,10 +215,14 @@
 		</light>
 	</nodes>
 	<zones>
-		<zone type="default">
+		<zone name="default">
 			<light name="sun"/>
 		</zone>
-		<zone type="mesh" name="Ruchin_l_innen">
+		<zone name="Ruchin_innen">
+			<!-- we need areas like this: >
+			<area type="mesh" meshfile="name.mesh">
+				<position x="0" y="1" z="34"/>
+			</area -->
 			<light name="red pointlight"/>
 			<light name="green spotlight"/>
 			<sound name="lachen.ogg"/>



From melven at mail.berlios.de  Sun Sep  2 16:30:37 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sun, 2 Sep 2007 16:30:37 +0200
Subject: [Dsa-hl-svn] r3790 - in rl/trunk/engine: core/include core/src
	script/src script/swig
Message-ID: <200709021430.l82EUbBk024421@sheep.berlios.de>

Author: melven
Date: 2007-09-02 16:30:21 +0200 (Sun, 02 Sep 2007)
New Revision: 3790

Modified:
   rl/trunk/engine/core/include/GameAreaEventSource.h
   rl/trunk/engine/core/include/GameEventManager.h
   rl/trunk/engine/core/include/ZoneManager.h
   rl/trunk/engine/core/src/GameAreaEventSource.cpp
   rl/trunk/engine/core/src/GameAreaTypes.cpp
   rl/trunk/engine/core/src/GameEventManager.cpp
   rl/trunk/engine/core/src/ZoneManager.cpp
   rl/trunk/engine/script/src/ZoneProcessor.cpp
   rl/trunk/engine/script/swig/RlCore.swig
Log:
Zones/Areas:
-not using actors any more for all areas (only moving areas need an actor)
-doesn't place place the mesh from a zone into scene
-the moving-actor and the entity (mesh) can be different

Modified: rl/trunk/engine/core/include/GameAreaEventSource.h
===================================================================
--- rl/trunk/engine/core/include/GameAreaEventSource.h	2007-09-02 11:51:31 UTC (rev 3789)
+++ rl/trunk/engine/core/include/GameAreaEventSource.h	2007-09-02 14:30:21 UTC (rev 3790)
@@ -42,9 +42,9 @@
 public:
     /** Konstruktor
      *  @param areaType Die Art des abzufragenden Areals 
-     *  @param act Der Actor, an den das Zentrum des Areals gekn?pft ist
+     *  @param act Der Actor, an den das Zentrum des Areals gekn?pft ist, kann NULL sein f?r unbewegte areas
      */
-    GameAreaEventSource( GameAreaType* areaType, Actor* act );
+    GameAreaEventSource( GameAreaType* areaType, Actor* act = NULL);
     /// Dekonstruktor
     virtual ~GameAreaEventSource();
 

Modified: rl/trunk/engine/core/include/GameEventManager.h
===================================================================
--- rl/trunk/engine/core/include/GameEventManager.h	2007-09-02 11:51:31 UTC (rev 3789)
+++ rl/trunk/engine/core/include/GameEventManager.h	2007-09-02 14:30:21 UTC (rev 3790)
@@ -71,21 +71,29 @@
 
     /** F?gt eine neue Mesh-Area hinzu und h?ngt einen Listener an
     *
-    * @param meshactor der meshactor um den herum die area gelegt werden soll
+    * @param actor der actor um den herum die area gelegt werden soll, kann NULL sein
+    * @param ent die Entity mit dem Mesh, das f?r die Area verwendet werden soll, falls NULL wird das mesh des actors verwendet
     * @param geom der Geometrietype, sinnvoll w?re GT_CONVEXHULL (eventuell GT_MESH)
     * @param list Der neu hinzuzufpgende Listener
     * @param queryMask Die Querymaske, welche Aktoren von der Area betroffen sind
     * @param forceNew erstellt auf jeden Fall eine neue GameAreaEventSource (z.B. f?r den ZoneManager)
     * @retval Die GameAreaEventSource, der der Listener hinzugef?gt wurde
     */
-	GameAreaEventSource* addMeshAreaListener( Actor* meshactor, GeometryType geom, GameAreaListener* list, 
+	GameAreaEventSource* addMeshAreaListener( Actor* actor,
+        Ogre::Entity* ent, GeometryType geom, GameAreaListener* list, 
         unsigned long queryMask = 0xFFFFFFFF, 
         Ogre::Vector3 offset = Ogre::Vector3::ZERO, Ogre::Quaternion orientation = Ogre::Quaternion::IDENTITY,
         bool forceNew = false);
 
+	GameAreaEventSource* addMeshAreaListener( Actor* actor,
+        GeometryType geom, GameAreaListener* list, 
+        unsigned long queryMask = 0xFFFFFFFF, 
+        Ogre::Vector3 offset = Ogre::Vector3::ZERO, Ogre::Quaternion orientation = Ogre::Quaternion::IDENTITY,
+        bool forceNew = false);
+
     /** F?gt eine neue Area hinzu und h?ngt einen Listener an
     *
-    * @param actor Der Actor um den herum die Area aufgespannt werden soll
+    * @param actor Der Actor um den herum die Area aufgespannt werden soll, kann NULL sein
     * @param aabb Die Gr??e der Area
     * @param geom der Geometrietype, m?glich sind GT_BOX, GT_ELLIPSOID, GT_SPHERE, GT_PYRAMID
     * @param list Der neu hinzuzufpgende Listener

Modified: rl/trunk/engine/core/include/ZoneManager.h
===================================================================
--- rl/trunk/engine/core/include/ZoneManager.h	2007-09-02 11:51:31 UTC (rev 3789)
+++ rl/trunk/engine/core/include/ZoneManager.h	2007-09-02 14:30:21 UTC (rev 3790)
@@ -66,6 +66,9 @@
 
 		void areaLeft(GameAreaEvent* gae);
 	    void areaEntered(GameAreaEvent* gae);
+
+        /// only needed if the lights/etc of the active zone changed
+        void update();
 		
 	private:
 		std::map<const Ogre::String, Zone*> mZones;

Modified: rl/trunk/engine/core/src/GameAreaEventSource.cpp
===================================================================
--- rl/trunk/engine/core/src/GameAreaEventSource.cpp	2007-09-02 11:51:31 UTC (rev 3789)
+++ rl/trunk/engine/core/src/GameAreaEventSource.cpp	2007-09-02 14:30:21 UTC (rev 3790)
@@ -46,11 +46,13 @@
 			return;
 
         // Position bertragen
-        mAreaType->setQueryPosition( mActor->getWorldPosition() );
+        if( mActor )
+            mAreaType->setQueryPosition( mActor->getWorldPosition() );
         ActorMap currInside = mAreaType->performQuery();
         // Der Actor um den herum die Quelle ist, wird vermutlich auch gefunden :)
         // Also rausl???chen
-        currInside.erase( mActor->getName() );
+        if( mActor )
+            currInside.erase( mActor->getName() );
 
         ActorMap enteredMap, leftMap;
         // EinfuegeIteratoren erstellen

Modified: rl/trunk/engine/core/src/GameAreaTypes.cpp
===================================================================
--- rl/trunk/engine/core/src/GameAreaTypes.cpp	2007-09-02 11:51:31 UTC (rev 3789)
+++ rl/trunk/engine/core/src/GameAreaTypes.cpp	2007-09-02 14:30:21 UTC (rev 3790)
@@ -225,6 +225,11 @@
 			Ogre::Vector3 offset,
 			Ogre::Quaternion orientation)
     {
+        if(geomType == GT_MESH)
+        {
+            LOG_ERROR(Logger::CORE, "Geometrie Typ 'GT_MESH' is not (yet) support by GameMeshAreaType, use GT_CONVEXHULL instead!");
+            geomType = GT_CONVEXHULL;
+        }
         OgreNewt::CollisionPtr col =
             PhysicsManager::getSingleton().getCollisionFactory()->createCollisionFromEntity(entity,
             geomType, &offset, &orientation);

Modified: rl/trunk/engine/core/src/GameEventManager.cpp
===================================================================
--- rl/trunk/engine/core/src/GameEventManager.cpp	2007-09-02 11:51:31 UTC (rev 3789)
+++ rl/trunk/engine/core/src/GameEventManager.cpp	2007-09-02 14:30:21 UTC (rev 3790)
@@ -111,15 +111,21 @@
     }
 
     /// @todo  Doppelte Aktoren nachnutzen??
-    GameAreaEventSource* GameEventManager::addMeshAreaListener( 
-        Actor* actor, GeometryType geom, GameAreaListener* list, unsigned long queryMask, 
+    GameAreaEventSource* GameEventManager::addMeshAreaListener(Actor* actor,
+        Ogre::Entity* ent, GeometryType geom, GameAreaListener* list, unsigned long queryMask, 
         Vector3 offset, Quaternion orientation, bool forceNew )
     {
         // neues areal ereugen
-        MeshObject* meshObj = static_cast<MeshObject*>(actor->getControlledObject());
+        if( ent == NULL )
+        {
+            if( actor == NULL )
+                Throw(IllegalArgumentException, "actor and entity cannot be NULL!");
+            MeshObject* meshObj = static_cast<MeshObject*>(actor->getControlledObject());
+            ent = meshObj->getEntity();
+        }
 
         GameNewtonBodyAreaType* at = new GameMeshAreaType(
-            meshObj->getEntity(), geom, offset, orientation);
+            ent, geom, offset, orientation);
 
         at->setQueryMask(queryMask);
 
@@ -137,6 +143,13 @@
         return gam;
     }
 
+    GameAreaEventSource* GameEventManager::addMeshAreaListener(Actor* actor,
+        GeometryType geom, GameAreaListener* list, unsigned long queryMask, 
+        Vector3 offset, Quaternion orientation, bool forceNew )
+    {
+        return addMeshAreaListener(actor, NULL, geom, list, queryMask, offset, orientation, forceNew);
+    }
+
     /// @todo  Doppelte Aktoren nachnutzen??
     GameAreaEventSource* GameEventManager::addAreaListener(Actor* actor,
         Ogre::AxisAlignedBox aabb, GeometryType geom, GameAreaListener* list, 
@@ -197,6 +210,8 @@
 
     void GameEventManager::removeAllAreas( Actor* actor )
     {
+        if( actor == NULL )
+            Throw(IllegalArgumentException, "actor cannot be NULL!");
         GameAreaEventSourceList::iterator it;
         for( it = mAreaEventSources.begin(); it != mAreaEventSources.end();)
         {

Modified: rl/trunk/engine/core/src/ZoneManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-02 11:51:31 UTC (rev 3789)
+++ rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-02 14:30:21 UTC (rev 3790)
@@ -19,8 +19,10 @@
 
 #include "Actor.h"
 #include "ActorManager.h"
+#include "CoreSubsystem.h"
 #include "GameEventManager.h"
 #include "Zone.h"
+#include "World.h"
 
 
 using namespace Ogre;
@@ -129,12 +131,10 @@
         if( !zone )
             return;
 
-        Actor* actor = ActorManager::getSingleton().createEmptyActor("Zone_"+name);
-        actor->placeIntoScene(position);
 
         GameAreaEventSource* gam =
-            GameEventManager::getSingleton().addAreaListener(actor, 
-                aabb, geom, this, queryflags, offset, orientation, true);
+            GameEventManager::getSingleton().addAreaListener(NULL, 
+                aabb, geom, this, queryflags, position + offset, orientation, true);
 
         gam->getGameAreaType()->setTransitionDistance(transitionDistance);
         gam->setId(zone->getId());
@@ -150,12 +150,9 @@
         if( !zone )
             return;
 
-        Actor* actor = ActorManager::getSingleton().createEmptyActor("Zone_Area_"+name);
-        actor->placeIntoScene(position);
-
         GameAreaEventSource* gam =
-            GameEventManager::getSingleton().addAreaListener(actor, 
-                aabb, geom, this, queryflags, offset, orientation, true);
+            GameEventManager::getSingleton().addAreaListener(NULL, 
+                aabb, geom, this, queryflags, position + offset, orientation, true);
 
         gam->getGameAreaType()->setTransitionDistance(transitionDistance);
         gam->setId( - (zone->getId())); // a negative id indicates to subtract this area from the zone
@@ -172,21 +169,20 @@
         if( !zone )
             return;
 
-        Actor *actor = ActorManager::getSingleton().createMeshActor(
-            "Zone_MeshArea_"+name+"_"+meshname, 
-            meshname, GT_NONE); // don't create physics-proxy
-        if(!actor)
+        Entity* entity = CoreSubsystem::getSingletonPtr()->getWorld()
+            ->getSceneManager()->createEntity("Zone_"+name+"_MeshArea_"+meshname, meshname);
+        if( !entity )
             return;
 
-        actor->placeIntoScene(position);
-        actor->setScale(scale.x, scale.y, scale.z);
-
         GameAreaEventSource* gam =
-            GameEventManager::getSingleton().addMeshAreaListener(
-                actor, geom, this, queryflags, offset, orientation, true);
+            GameEventManager::getSingleton().addMeshAreaListener(NULL, 
+                entity, geom, this, queryflags, position + offset, orientation, true);
 
         gam->getGameAreaType()->setTransitionDistance(transitionDistance);
-        gam->setId( zone->getId() );
+        gam->setId(zone->getId());
+
+        CoreSubsystem::getSingletonPtr()->getWorld()
+            ->getSceneManager()->destroyEntity(entity);
     }
 
     void ZoneManager::subtractMeshAreaFromZone(const Ogre::String& name,
@@ -200,21 +196,21 @@
         if( !zone )
             return;
 
-        Actor *actor = ActorManager::getSingleton().createMeshActor(
-            "Zone_MeshArea_"+name+"_"+meshname, 
-            meshname, GT_NONE); // don't create physics-proxy
-        if(!actor)
+        Entity* entity = CoreSubsystem::getSingletonPtr()->getWorld()
+            ->getSceneManager()->createEntity("Zone_"+name+"_MeshArea_"+meshname, meshname);
+        if( !entity )
             return;
 
-        actor->placeIntoScene(position);
-        actor->setScale(scale.x, scale.y, scale.z);
 
         GameAreaEventSource* gam =
-            GameEventManager::getSingleton().addMeshAreaListener(
-                actor, geom, this, queryflags, offset, orientation, true);
+            GameEventManager::getSingleton().addMeshAreaListener(NULL, 
+                entity, geom, this, queryflags, position + offset, orientation, true);
 
         gam->getGameAreaType()->setTransitionDistance(transitionDistance);
         gam->setId( - (zone->getId()) ); // a negative id indicates to subtract this area from the zone
+
+        CoreSubsystem::getSingletonPtr()->getWorld()
+            ->getSceneManager()->destroyEntity(entity);
     }
 
 	void ZoneManager::areaLeft(GameAreaEvent* gae)
@@ -263,6 +259,12 @@
         }
 	}
 
+    void ZoneManager::update()
+    {
+        switchLights();
+        switchSounds();
+    }
+
 	void ZoneManager::switchLights()
 	{
 		Zone* currentZone = mActiveZones.front();

Modified: rl/trunk/engine/script/src/ZoneProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-02 11:51:31 UTC (rev 3789)
+++ rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-02 14:30:21 UTC (rev 3790)
@@ -203,6 +203,7 @@
 			}
 		}
 
+        ZoneManager::getSingleton().update();
 		return true;
 	}
 

Modified: rl/trunk/engine/script/swig/RlCore.swig
===================================================================
--- rl/trunk/engine/script/swig/RlCore.swig	2007-09-02 11:51:31 UTC (rev 3789)
+++ rl/trunk/engine/script/swig/RlCore.swig	2007-09-02 14:30:21 UTC (rev 3790)
@@ -245,8 +245,10 @@
 public:
     void addSphereAreaListener( rl::Actor* actor, Ogre::Real radius, 
 		rl::GameAreaListener* list, unsigned long queryMask = 0xFFFFFFFF );
-	void addMeshAreaListener( rl::Actor* meshactor, rl::GeometryType geom, 
+	void addMeshAreaListener( rl::Actor* actor, Ogre::Entity* ent, rl::GeometryType geom, 
 	    rl::GameAreaListener* list, unsigned long queryMask = 0xFFFFFFFF );
+	void addMeshAreaListener( rl::Actor* actor, rl::GeometryType geom, 
+	    rl::GameAreaListener* list, unsigned long queryMask = 0xFFFFFFFF );
 	
     void removeAreaListener( rl::GameAreaListener* list );
     void removeAllAreas( rl::Actor* actor );



From melven at mail.berlios.de  Sun Sep  2 16:31:02 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sun, 2 Sep 2007 16:31:02 +0200
Subject: [Dsa-hl-svn] r3791 - modules/regressiontest/maps
Message-ID: <200709021431.l82EV2qV024447@sheep.berlios.de>

Author: melven
Date: 2007-09-02 16:30:56 +0200 (Sun, 02 Sep 2007)
New Revision: 3791

Modified:
   modules/regressiontest/maps/regressiontest_lights.rlmap.xml
Log:
added a mesharea for testing purposes

Modified: modules/regressiontest/maps/regressiontest_lights.rlmap.xml
===================================================================
--- modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-02 14:30:21 UTC (rev 3790)
+++ modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-02 14:30:56 UTC (rev 3791)
@@ -35,6 +35,10 @@
 				<scale x="6" y="6" z="6"/>
 				<transition_distance>0.5</transition_distance>
 			</area>
+			<area type="mesh" meshfile="arc_UnbHaus_07.mesh">
+				<position x="25" y="0" z="-50"/>
+				<transition_distance>0.5</transition_distance>
+			</area>
 			<light name="red pointlight"/>
 			<light name="green spotlight"/>
 			<sound name="lachen.ogg"/>



From timm at mail.berlios.de  Sun Sep  2 19:20:39 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 2 Sep 2007 19:20:39 +0200
Subject: [Dsa-hl-svn] r3792 - rl/trunk/engine/rules/src
Message-ID: <200709021720.l82HKdof017091@sheep.berlios.de>

Author: timm
Date: 2007-09-02 19:20:26 +0200 (Sun, 02 Sep 2007)
New Revision: 3792

Modified:
   rl/trunk/engine/rules/src/GameObject.cpp
Log:
fixed a crash with a game object which is not in scene

Modified: rl/trunk/engine/rules/src/GameObject.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObject.cpp	2007-09-02 14:30:56 UTC (rev 3791)
+++ rl/trunk/engine/rules/src/GameObject.cpp	2007-09-02 17:20:26 UTC (rev 3792)
@@ -571,8 +571,11 @@
         PropertySet* ps = new PropertySet();
         ps->setProperty(PROPERTY_NAME, Property(mName));
         ps->setProperty(PROPERTY_DESCRIPTION, Property(mDescription));
-        ps->setProperty(PROPERTY_POSITION, Property(getPosition()));
-        ps->setProperty(PROPERTY_ORIENTATION, Property(getOrientation()));
+        if(this->getState() == GOS_IN_SCENE)
+        {
+            ps->setProperty(PROPERTY_POSITION, Property(getPosition()));
+            ps->setProperty(PROPERTY_ORIENTATION, Property(getOrientation()));
+        }
         ps->setProperty(PROPERTY_MESHFILE, Property(mMeshfile));
         ps->setProperty(PROPERTY_MESHPARTS, getProperty(PROPERTY_MESHPARTS));
         ps->setProperty(PROPERTY_GEOMETRY_TYPE, Property(mGeometryType));



From timm at mail.berlios.de  Sun Sep  2 19:34:40 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 2 Sep 2007 19:34:40 +0200
Subject: [Dsa-hl-svn] r3793 - in rl/trunk/engine/common: include src
Message-ID: <200709021734.l82HYe8c018028@sheep.berlios.de>

Author: timm
Date: 2007-09-02 19:34:36 +0200 (Sun, 02 Sep 2007)
New Revision: 3793

Modified:
   rl/trunk/engine/common/include/Property.h
   rl/trunk/engine/common/src/Property.cpp
Log:
added possibility to get the name of the property

Modified: rl/trunk/engine/common/include/Property.h
===================================================================
--- rl/trunk/engine/common/include/Property.h	2007-09-02 17:20:26 UTC (rev 3792)
+++ rl/trunk/engine/common/include/Property.h	2007-09-02 17:34:36 UTC (rev 3793)
@@ -31,6 +31,7 @@
     Property(Type value) \
     { \
         setValue(value); \
+        mName = Ogre::String(#Name);\
     } \
     \
     bool is##Name() const\
@@ -93,9 +94,12 @@
 		PropertyMethod(Map, const PropertyMap);
 
         Ogre::String getTypeName() const;
+        Ogre::String getName() const;
 
+        bool isEmpty() const;
     private:
         boost::any mValue;
+        Ogre::String mName;
     };
 
     class _RlCommonExport PropertyPtr :

Modified: rl/trunk/engine/common/src/Property.cpp
===================================================================
--- rl/trunk/engine/common/src/Property.cpp	2007-09-02 17:20:26 UTC (rev 3792)
+++ rl/trunk/engine/common/src/Property.cpp	2007-09-02 17:34:36 UTC (rev 3793)
@@ -33,4 +33,14 @@
     {
         return mValue.type().name();
     }
+
+    Ogre::String Property::getName() const
+    {
+        return mName;
+    }
+
+    bool Property::isEmpty() const
+    {
+        return mValue.empty();
+    }
 }



From timm at mail.berlios.de  Sun Sep  2 22:32:16 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 2 Sep 2007 22:32:16 +0200
Subject: [Dsa-hl-svn] r3794 - in rl/trunk/engine: common common/include
	rules rules/include rules/src ui/src
Message-ID: <200709022032.l82KWGST026410@sheep.berlios.de>

Author: timm
Date: 2007-09-02 22:31:53 +0200 (Sun, 02 Sep 2007)
New Revision: 3794

Added:
   rl/trunk/engine/common/include/PropertyWriter.h
   rl/trunk/engine/rules/include/SaveGameFileWriter.h
   rl/trunk/engine/rules/src/SaveGameFile.cpp
Modified:
   rl/trunk/engine/common/RlCommon2005.vcproj
   rl/trunk/engine/rules/RlRules2005.vcproj
   rl/trunk/engine/ui/src/SaveLoadWindow.cpp
Log:
submitted fundamental game saving features

Modified: rl/trunk/engine/common/RlCommon2005.vcproj
===================================================================
--- rl/trunk/engine/common/RlCommon2005.vcproj	2007-09-02 17:34:36 UTC (rev 3793)
+++ rl/trunk/engine/common/RlCommon2005.vcproj	2007-09-02 20:31:53 UTC (rev 3794)
@@ -339,6 +339,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\src\PropertyWriter.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\ScriptWrapper.cpp"
 				>
 			</File>
@@ -459,6 +463,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\PropertyWriter.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\RastullahPrerequisites.h"
 				>
 			</File>

Added: rl/trunk/engine/common/include/PropertyWriter.h
===================================================================
--- rl/trunk/engine/common/include/PropertyWriter.h	2007-09-02 17:34:36 UTC (rev 3793)
+++ rl/trunk/engine/common/include/PropertyWriter.h	2007-09-02 20:31:53 UTC (rev 3794)
@@ -0,0 +1,61 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#ifndef __PropertyWriter_H__
+#define __PropertyWriter_H__
+
+#include "CommonPrerequisites.h"
+
+#include <xercesc/dom/DOM.hpp>
+#include <xercesc/dom/DOMAttr.hpp>
+#include <xercesc/dom/DOMElement.hpp>
+#include <OgreDataStream.h>
+
+#include "Property.h"
+
+namespace rl 
+{
+    class Property;
+    class PropertySet;
+
+    typedef std::pair<Ogre::String, Property> PropertyEntry;
+
+    class _RlCommonExport XmlPropertyWriter
+    {
+    public:
+        XmlPropertyWriter();
+
+        std::vector<PropertySet*> getPropertySets();
+        void setPropertySets(std::vector<PropertySet*> sets);
+        void addPropertySet(PropertySet* set);
+
+        XERCES_CPP_NAMESPACE::DOMElement* processProperty(XERCES_CPP_NAMESPACE::DOMElement* parent, PropertyEntry entry);
+        XERCES_CPP_NAMESPACE::DOMElement* processPropertySet(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertySet set);
+        XERCES_CPP_NAMESPACE::DOMElement* processPropertyArray(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyVector vector);
+        XERCES_CPP_NAMESPACE::DOMElement* processPropertyMap(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyMap map);
+    protected:
+        std::vector<PropertySet*> mPropertySets;
+
+        XERCES_CPP_NAMESPACE::DOMDocument* mDocument;
+        XERCES_CPP_NAMESPACE::DOMImplementation* mImplementation;
+        XERCES_CPP_NAMESPACE::DOMWriter* mWriter;
+        XERCES_CPP_NAMESPACE::XMLFormatTarget* mTarget;
+
+        Property getProperty(const Ogre::String& key, const CeGuiString& value);
+    };
+} // namespace rl
+
+#endif //__PropertyWriter_H__

Modified: rl/trunk/engine/rules/RlRules2005.vcproj
===================================================================
--- rl/trunk/engine/rules/RlRules2005.vcproj	2007-09-02 17:34:36 UTC (rev 3793)
+++ rl/trunk/engine/rules/RlRules2005.vcproj	2007-09-02 20:31:53 UTC (rev 3794)
@@ -403,6 +403,14 @@
 				>
 			</File>
 			<File
+				RelativePath=".\src\SaveGameFile.cpp"
+				>
+			</File>
+			<File
+				RelativePath=".\src\SaveGameFileWriter.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\SelectionHelper.cpp"
 				>
 			</File>
@@ -629,6 +637,14 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\SaveGameFile.h"
+				>
+			</File>
+			<File
+				RelativePath=".\include\SaveGameFileWriter.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\SelectionHelper.h"
 				>
 			</File>

Added: rl/trunk/engine/rules/include/SaveGameFileWriter.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-02 17:34:36 UTC (rev 3793)
+++ rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-02 20:31:53 UTC (rev 3794)
@@ -0,0 +1,36 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#ifndef _SaveGameFileWriter_H_
+#define _SaveGameFileWriter_H_
+
+#include "RulesPrerequisites.h"
+
+#include <PropertyWriter.h>
+
+#include "GameObject.h"
+#include "SaveGameFile.h"
+
+namespace rl
+{
+    class _RlRulesExport SaveGameFileWriter : public XmlPropertyWriter
+    {
+    public:
+        void buildSaveGameFile(SaveGameFile *file);
+    };
+}
+
+#endif
\ No newline at end of file

Added: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-02 17:34:36 UTC (rev 3793)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-02 20:31:53 UTC (rev 3794)
@@ -0,0 +1,56 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h" //precompiled header
+
+#include "SaveGameFile.h"
+#include "OgreString.h"
+#include <xercesc/framework/LocalFileFormatTarget.hpp>
+
+namespace rl
+{
+
+    SaveGameFile::SaveGameFile(const CeGuiString &name)
+    {
+        mName = name;
+    }
+
+    void SaveGameFile::setModulName(const CeGuiString &modulName)
+    {
+        mModulName = modulName;
+    }
+
+    CeGuiString SaveGameFile::buildFilename()
+    {
+        return "modules/" + mModulName + "/saves/" + mName + ".save";
+    }
+
+    CeGuiString SaveGameFile::getName()
+    {
+        return mName;
+    }
+
+    Ogre::DataStreamPtr SaveGameFile::load()
+    {
+        return Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r")));
+    }
+
+    XERCES_CPP_NAMESPACE::XMLFormatTarget* SaveGameFile::save()
+    {
+        return new XERCES_CPP_NAMESPACE::LocalFileFormatTarget(this->buildFilename().c_str());
+    }
+
+}
\ No newline at end of file

Modified: rl/trunk/engine/ui/src/SaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-02 17:34:36 UTC (rev 3793)
+++ rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-02 20:31:53 UTC (rev 3794)
@@ -27,8 +27,13 @@
 #include <Exception.h>
 #include <GameObjectManager.h>
 #include <GameObject.h>
+#include <Actor.h>
 
 #include "SaveLoadWindow.h"
+#include "SaveGameFile.h"
+#include "SaveGameFileWriter.h"
+#include "CoreSubsystem.h"
+#include "ContentModule.h"
 
 using namespace CEGUI;
 
@@ -106,18 +111,26 @@
     {
         LOG_MESSAGE(Logger::UI, "Save Button pressed");
 
+        LOG_MESSAGE(Logger::UI, "Create a SaveGameFile");
+
+        SaveGameFile saveGameFile(mFilename->getText());
+        saveGameFile.setModulName(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName());
+
         std::list<const GameObject*>::const_iterator it;
         std::list<const GameObject*> gos;
         gos = GameObjectManager::getSingleton().getAllGameObjects();
 
-        LOG_MESSAGE(Logger::UI, "Following GOs must be saved:");
+        std::vector<PropertySet*> sets;
         for( it=gos.begin(); it!=gos.end(); ++it )
         {
-            //const CeGuiString test = (*it)->getName();
-            LOG_MESSAGE(Logger::UI, "ClassId: " + (*it)->getClassId() +
-                " Name: " + (*it)->getName());
+            sets.push_back((*it)->getAllProperties());
         }
+        SaveGameFileWriter saveGameFileWriter;
+        saveGameFileWriter.setPropertySets(sets);
+        saveGameFileWriter.buildSaveGameFile(&saveGameFile);
 
+        LOG_MESSAGE(Logger::UI, "Created save game");
+
         return true;
     }
 



From timm at mail.berlios.de  Sun Sep  2 22:37:42 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 2 Sep 2007 22:37:42 +0200
Subject: [Dsa-hl-svn] r3795 - in modules: aitest combattest minidemo
	regressiontest ruchin techdemo techdemo2 tutorial
Message-ID: <200709022037.l82KbgbK026546@sheep.berlios.de>

Author: timm
Date: 2007-09-02 22:37:29 +0200 (Sun, 02 Sep 2007)
New Revision: 3795

Added:
   modules/aitest/saves/
   modules/combattest/saves/
   modules/minidemo/saves/
   modules/regressiontest/saves/
   modules/ruchin/saves/
   modules/techdemo/saves/
   modules/techdemo2/saves/
   modules/tutorial/saves/
Log:
added folders for save games



From timm at mail.berlios.de  Sun Sep  2 23:03:14 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 2 Sep 2007 23:03:14 +0200
Subject: [Dsa-hl-svn] r3796 - in rl/trunk/engine: rules/include rules/src
	ui/src
Message-ID: <200709022103.l82L3Eb6027915@sheep.berlios.de>

Author: timm
Date: 2007-09-02 23:03:07 +0200 (Sun, 02 Sep 2007)
New Revision: 3796

Added:
   rl/trunk/engine/rules/include/SaveGameFile.h
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
Modified:
   rl/trunk/engine/rules/src/SaveGameFile.cpp
   rl/trunk/engine/ui/src/SaveLoadWindow.cpp
Log:
- forgot to add SaveGameFileWriter
- update of saving games


Added: rl/trunk/engine/rules/include/SaveGameFile.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-02 20:37:29 UTC (rev 3795)
+++ rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-02 21:03:07 UTC (rev 3796)
@@ -0,0 +1,44 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#ifndef __SaveGameFile_H__
+#define __SaveGameFile_H__
+
+#include "CommonPrerequisites.h"
+#include <OgreDataStream.h>
+
+#include <xercesc/framework/XMLFormatter.hpp>
+
+namespace rl
+{
+    class _RlCommonExport SaveGameFile
+    {
+    public:
+        SaveGameFile(const CeGuiString &name);
+        ~SaveGameFile();
+        void setModulName(const CeGuiString &modulName);
+        CeGuiString buildFilename();
+        CeGuiString getName();
+
+        Ogre::DataStreamPtr load();
+        XERCES_CPP_NAMESPACE::XMLFormatTarget* save();
+    protected:
+        CeGuiString mModulName;
+        CeGuiString mName;
+    };
+}
+
+#endif
\ No newline at end of file

Modified: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-02 20:37:29 UTC (rev 3795)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-02 21:03:07 UTC (rev 3796)
@@ -28,6 +28,10 @@
         mName = name;
     }
 
+    SaveGameFile::~SaveGameFile()
+    {
+    }
+
     void SaveGameFile::setModulName(const CeGuiString &modulName)
     {
         mModulName = modulName;
@@ -45,11 +49,13 @@
 
     Ogre::DataStreamPtr SaveGameFile::load()
     {
+        ///@todo: decryption
         return Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r")));
     }
 
     XERCES_CPP_NAMESPACE::XMLFormatTarget* SaveGameFile::save()
     {
+        ///@todo: encryption
         return new XERCES_CPP_NAMESPACE::LocalFileFormatTarget(this->buildFilename().c_str());
     }
 

Added: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-02 20:37:29 UTC (rev 3795)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-02 21:03:07 UTC (rev 3796)
@@ -0,0 +1,87 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h"
+
+#include <XmlHelper.h>
+#include <xercesc/dom/DOM.hpp>
+#include <xercesc/dom/DOMAttr.hpp>
+#include <xercesc/dom/DOMElement.hpp>
+#include <Properties.h>
+
+#include "SaveGameFileWriter.h"
+#include <GameObjectManager.h>
+
+#include <OgreResourceManager.h>
+#include <CEGUIPropertyHelper.h>
+
+using namespace XERCES_CPP_NAMESPACE;
+using namespace Ogre;
+
+namespace rl
+{
+    void SaveGameFileWriter::buildSaveGameFile(SaveGameFile *file)
+    {
+        //@toto: build
+        XMLPlatformUtils::Initialize();
+
+        XmlHelper::initializeTranscoder();
+
+        XMLCh tempStr[100];
+        XMLString::transcode("LS", tempStr, 99);
+        mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
+        mWriter = ((DOMImplementationLS*)mImplementation)->createDOMWriter();
+        mTarget = file->save();
+        mDocument = ((DOMImplementation*)mImplementation)->createDocument(0, XMLString::transcode("SaveGameFile"), 0);
+        mDocument->setNodeValue(XMLString::transcode("SaveGameFile"));
+
+        if (mWriter->canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
+            mWriter->setFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true);
+
+        if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
+             mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
+
+        //Write globals
+        DOMElement* globals = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
+
+        //Write game objects
+        DOMElement* gameobjects = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "gameobjects");
+        
+        std::list<const GameObject*>::const_iterator it;
+        std::list<const GameObject*> gos;
+        gos = GameObjectManager::getSingleton().getAllGameObjects();
+
+        for(it = gos.begin(); it != gos.end(); it++)
+        {
+            DOMElement* gameobject = XmlHelper::appendChildElement(mDocument, gameobjects, "gameobject");
+
+            PropertyMap map = (*it)->getAllProperties()->toPropertyMap();
+            PropertyMap::iterator it2;
+            for(it2 = map.begin(); it2 != map.end(); it2)
+            {
+                this->processProperty(gameobject, PropertyEntry(it2->first.c_str(), it2->second));
+            }
+        }        
+
+        //Write scripts
+        DOMElement* scripts = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "scripts");
+
+        mWriter->writeNode(mTarget, *mDocument);
+
+        mWriter->release();
+        delete mTarget;
+    }
+}

Modified: rl/trunk/engine/ui/src/SaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-02 20:37:29 UTC (rev 3795)
+++ rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-02 21:03:07 UTC (rev 3796)
@@ -116,7 +116,7 @@
         SaveGameFile saveGameFile(mFilename->getText());
         saveGameFile.setModulName(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName());
 
-        std::list<const GameObject*>::const_iterator it;
+        /*std::list<const GameObject*>::const_iterator it;
         std::list<const GameObject*> gos;
         gos = GameObjectManager::getSingleton().getAllGameObjects();
 
@@ -124,9 +124,9 @@
         for( it=gos.begin(); it!=gos.end(); ++it )
         {
             sets.push_back((*it)->getAllProperties());
-        }
+        }*/
         SaveGameFileWriter saveGameFileWriter;
-        saveGameFileWriter.setPropertySets(sets);
+        //saveGameFileWriter.setPropertySets(sets);
         saveGameFileWriter.buildSaveGameFile(&saveGameFile);
 
         LOG_MESSAGE(Logger::UI, "Created save game");



From timm at mail.berlios.de  Sun Sep  2 23:52:20 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 2 Sep 2007 23:52:20 +0200
Subject: [Dsa-hl-svn] r3797 - in rl/trunk/engine: common/src rules/src
Message-ID: <200709022152.l82LqKnO030100@sheep.berlios.de>

Author: timm
Date: 2007-09-02 23:52:14 +0200 (Sun, 02 Sep 2007)
New Revision: 3797

Added:
   rl/trunk/engine/common/src/PropertyWriter.cpp
Modified:
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
Log:
added the last file and fixed a damn typo

Added: rl/trunk/engine/common/src/PropertyWriter.cpp
===================================================================
--- rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-02 21:03:07 UTC (rev 3796)
+++ rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-02 21:52:14 UTC (rev 3797)
@@ -0,0 +1,123 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h" //precompiled header
+
+#include "XmlHelper.h"
+
+#include "Properties.h"
+#include "PropertyWriter.h"
+
+#include <OgreResourceManager.h>
+#include <CEGUIPropertyHelper.h>
+
+
+using namespace XERCES_CPP_NAMESPACE;
+using namespace Ogre;
+
+namespace rl {
+
+    XmlPropertyWriter::XmlPropertyWriter()
+    {
+    }
+
+    void XmlPropertyWriter::setPropertySets(std::vector<PropertySet*> sets)
+    {
+        mPropertySets = sets;
+    }
+
+    void XmlPropertyWriter::addPropertySet(PropertySet* set)
+    {
+        mPropertySets.push_back(set);
+    }
+
+    DOMElement* XmlPropertyWriter::processProperty(DOMElement* parent, PropertyEntry entry)
+    {
+        DOMElement* element;
+        if(entry.second.isArray())
+        {
+            element = this->processPropertyArray(parent, entry.first.c_str(), entry.second.toArray());
+        }
+        else if(entry.second.isMap())
+        {
+            element = this->processPropertyMap(parent, entry.first.c_str(), entry.second.toMap());
+        }
+        else
+        {
+            element = XmlHelper::appendChildElement(mDocument, parent, "property");
+            if(entry.first != "")
+                XmlHelper::setAttribute(element, "name", entry.first.c_str());
+
+            //Ogre::String typeName = entry.second.getTypeName();
+            Ogre::String name = entry.second.getName();
+            Ogre::StringUtil::toUpperCase(name);
+            XmlHelper::setAttributeValueAsString(element, "type", name);
+
+            if(entry.second.isBool())
+                XmlHelper::setAttributeValueAsBool(element, "data", entry.second.toBool());
+            else if(entry.second.isInt())
+                XmlHelper::setAttributeValueAsInteger(element, "data", entry.second.toInt());
+            else if(entry.second.isIntPair())
+                XmlHelper::setAttributeValueAsIntegerPair(element, "data", entry.second.toIntPair());
+            else if(entry.second.isIntPair())
+                XmlHelper::setAttributeValueAsIntegerTriple(element, "data", entry.second.toIntTriple());
+            else if(entry.second.isQuaternion())
+                XmlHelper::setValueAsQuaternion(element, entry.second.toQuaternion());
+            else if(entry.second.isReal())
+                XmlHelper::setAttributeValueAsReal(element, "data", entry.second.toReal());
+            else if(entry.second.isString())
+                XmlHelper::setAttributeValueAsString(element, "data", entry.second.toString());
+            else if(entry.second.isVector3())
+                XmlHelper::setValueAsVector3(element, entry.second.toVector3());
+        }
+        return element;
+    }
+
+    DOMElement* XmlPropertyWriter::processPropertySet(DOMElement* parent, const char* const name, PropertySet set)
+    {
+        PropertyMap map = set.toPropertyMap();
+
+        return processPropertyMap(parent, name, map);
+    }
+
+    DOMElement* XmlPropertyWriter::processPropertyArray(DOMElement *parent, const char *const name, PropertyVector vector)
+    {
+        DOMElement* element = XmlHelper::appendChildElement(mDocument, parent, "property");
+        XmlHelper::setAttribute(element, "name", name);
+        XmlHelper::setAttribute(element, "type", "MAP");
+
+        PropertyVector::iterator iter;
+        for(iter = vector.begin(); iter != vector.end(); iter++)
+        {
+            processProperty(element, PropertyEntry("",*iter));
+        }
+        return element;
+    }
+
+    DOMElement* XmlPropertyWriter::processPropertyMap(DOMElement *parent, const char *const name, PropertyMap map)
+    {
+        DOMElement* element = XmlHelper::appendChildElement(mDocument, parent, "property");
+        XmlHelper::setAttribute(element, "name", name);
+        XmlHelper::setAttribute(element, "type", "MAP");
+
+        PropertyMap::iterator iter;
+        for(iter = map.begin(); iter != map.end(); iter++)
+        {
+            processProperty(element, PropertyEntry(iter->first.c_str(), iter->second));
+        }
+        return element;
+    }
+}

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-02 21:03:07 UTC (rev 3796)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-02 21:52:14 UTC (rev 3797)
@@ -70,12 +70,14 @@
 
             PropertyMap map = (*it)->getAllProperties()->toPropertyMap();
             PropertyMap::iterator it2;
-            for(it2 = map.begin(); it2 != map.end(); it2)
+            for(it2 = map.begin(); it2 != map.end(); it2++)
             {
                 this->processProperty(gameobject, PropertyEntry(it2->first.c_str(), it2->second));
             }
         }        
 
+        //Write Zones?
+
         //Write scripts
         DOMElement* scripts = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "scripts");
 



From timm at mail.berlios.de  Sun Sep  2 23:53:50 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 2 Sep 2007 23:53:50 +0200
Subject: [Dsa-hl-svn] r3798 - rl/trunk/engine/rules/include
Message-ID: <200709022153.l82Lrokf030236@sheep.berlios.de>

Author: timm
Date: 2007-09-02 23:53:48 +0200 (Sun, 02 Sep 2007)
New Revision: 3798

Modified:
   rl/trunk/engine/rules/include/SaveGameFile.h
Log:
common -> rules

Modified: rl/trunk/engine/rules/include/SaveGameFile.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-02 21:52:14 UTC (rev 3797)
+++ rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-02 21:53:48 UTC (rev 3798)
@@ -17,14 +17,14 @@
 #ifndef __SaveGameFile_H__
 #define __SaveGameFile_H__
 
-#include "CommonPrerequisites.h"
+#include "RulesPrerequisites.h"
 #include <OgreDataStream.h>
 
 #include <xercesc/framework/XMLFormatter.hpp>
 
 namespace rl
 {
-    class _RlCommonExport SaveGameFile
+    class _RlRulesExport SaveGameFile
     {
     public:
         SaveGameFile(const CeGuiString &name);



From timm at mail.berlios.de  Mon Sep  3 00:02:34 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 3 Sep 2007 00:02:34 +0200
Subject: [Dsa-hl-svn] r3799 - rl/trunk/engine/rules/src
Message-ID: <200709022202.l82M2Y1A030764@sheep.berlios.de>

Author: timm
Date: 2007-09-03 00:02:28 +0200 (Mon, 03 Sep 2007)
New Revision: 3799

Modified:
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
Log:
save id and classid

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-02 21:53:48 UTC (rev 3798)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-02 22:02:28 UTC (rev 3799)
@@ -67,6 +67,8 @@
         for(it = gos.begin(); it != gos.end(); it++)
         {
             DOMElement* gameobject = XmlHelper::appendChildElement(mDocument, gameobjects, "gameobject");
+            XmlHelper::setAttributeValueAsInteger(gameobject, "ID", (*it)->getId());
+            XmlHelper::setAttributeValueAsString(gameobject, "ClassID", (*it)->getClassId());
 
             PropertyMap map = (*it)->getAllProperties()->toPropertyMap();
             PropertyMap::iterator it2;



From timm at mail.berlios.de  Mon Sep  3 22:06:15 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 3 Sep 2007 22:06:15 +0200
Subject: [Dsa-hl-svn] r3800 - in rl/trunk/engine/ui: include src
Message-ID: <200709032006.l83K6F6J005240@sheep.berlios.de>

Author: timm
Date: 2007-09-03 22:06:11 +0200 (Mon, 03 Sep 2007)
New Revision: 3800

Modified:
   rl/trunk/engine/ui/include/SaveLoadWindow.h
   rl/trunk/engine/ui/src/SaveLoadWindow.cpp
Log:
- list existing save games
- capturing keyboard input

Modified: rl/trunk/engine/ui/include/SaveLoadWindow.h
===================================================================
--- rl/trunk/engine/ui/include/SaveLoadWindow.h	2007-09-02 22:02:28 UTC (rev 3799)
+++ rl/trunk/engine/ui/include/SaveLoadWindow.h	2007-09-03 20:06:11 UTC (rev 3800)
@@ -59,6 +59,8 @@
         bool handleLoadEvent();
         bool handleSaveEvent();
         bool handleDeleteEvent();
+
+        void listSaveGames();
         
         CEGUI::MultiColumnList     *mSaveGameTable;     //!< SaveGame table
         CEGUI::Editbox             *mFilename;         //!< Filename for the savegame 

Modified: rl/trunk/engine/ui/src/SaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-02 22:02:28 UTC (rev 3799)
+++ rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-03 20:06:11 UTC (rev 3800)
@@ -28,12 +28,14 @@
 #include <GameObjectManager.h>
 #include <GameObject.h>
 #include <Actor.h>
+#include <OgreResourceGroupManager.h>
 
 #include "SaveLoadWindow.h"
 #include "SaveGameFile.h"
 #include "SaveGameFileWriter.h"
 #include "CoreSubsystem.h"
 #include "ContentModule.h"
+#include "ConfigurationManager.h"
 
 using namespace CEGUI;
 
@@ -42,12 +44,14 @@
     //------------------------------------------------------- Constructor
 
     SaveLoadWindow::SaveLoadWindow() :
-        AbstractWindow("saveloadwindow.xml", WIT_MOUSE_INPUT)
+        AbstractWindow("saveloadwindow.xml", WIT_MOUSE_INPUT | WIT_KEYBOARD_INPUT)
     {
         // Get a access to the filename edit box
         mFilename = getEditbox("SaveLoadWindow/FileSheet/Filename");
-        RlAssert(mFilename != NULL, "SaveLoadWindow/FileSheet/File is null");
+        RlAssert(mFilename != NULL, "SaveLoadWindow/FileSheet/Filename is null");
 
+        mFilename->activate();
+
         // Get a access to the savegame table
         mSaveGameTable = getMultiColumnList("SaveLoadWindow/FileSheet/SaveGameTable");
         RlAssert(mSaveGameTable != NULL, "SaveLoadWindow/FileSheet/SaveGameTable is null");
@@ -95,6 +99,7 @@
     {
         //mSaveGameTable->autoSizeColumnHeader(0);
         //mSaveGameTable->autoSizeColumnHeader(1);
+        listSaveGames();
     }
 
     //------------------------------------------------------- LoadEvent
@@ -131,6 +136,8 @@
 
         LOG_MESSAGE(Logger::UI, "Created save game");
 
+        listSaveGames();
+
         return true;
     }
 
@@ -142,4 +149,28 @@
         return true;
     }
 
+    void SaveLoadWindow::listSaveGames()
+    {
+        Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
+        Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() + Ogre::String("/")
+            + Ogre::String(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName().c_str()) + Ogre::String("/saves"), "FileSystem", "SaveGames");
+        Ogre::StringVectorPtr saveGames = Ogre::ResourceGroupManager::getSingleton().listResourceNames("SaveGames");
+        Ogre::StringVector::iterator it;
+        
+        while(mSaveGameTable->getRowCount() > saveGames->size())
+		    mSaveGameTable->removeRow(mSaveGameTable->getRowCount()-1);
+        while(mSaveGameTable->getRowCount() < saveGames->size())
+		    mSaveGameTable->addRow();
+        
+        int saveGameNum = 0;
+
+        for(it = saveGames->begin(); it != saveGames->end(); it++)
+        {
+            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->data()), 0, saveGameNum);
+            saveGameNum++;
+        }
+
+        Ogre::ResourceGroupManager::getSingleton().destroyResourceGroup("SaveGames");
+    }
+
 } // namespace rl



From timm at mail.berlios.de  Mon Sep  3 22:35:57 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 3 Sep 2007 22:35:57 +0200
Subject: [Dsa-hl-svn] r3801 - in rl/trunk/engine: rules/include rules/src
	ui/src
Message-ID: <200709032035.l83KZvjJ006945@sheep.berlios.de>

Author: timm
Date: 2007-09-03 22:35:50 +0200 (Mon, 03 Sep 2007)
New Revision: 3801

Modified:
   rl/trunk/engine/rules/include/SaveGameFile.h
   rl/trunk/engine/rules/src/SaveGameFile.cpp
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
   rl/trunk/engine/ui/src/SaveLoadWindow.cpp
Log:
- removed setModulName
- added saveGameExists

Modified: rl/trunk/engine/rules/include/SaveGameFile.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-03 20:06:11 UTC (rev 3800)
+++ rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-03 20:35:50 UTC (rev 3801)
@@ -29,14 +29,13 @@
     public:
         SaveGameFile(const CeGuiString &name);
         ~SaveGameFile();
-        void setModulName(const CeGuiString &modulName);
         CeGuiString buildFilename();
         CeGuiString getName();
+        bool saveGameExists();
 
-        Ogre::DataStreamPtr load();
-        XERCES_CPP_NAMESPACE::XMLFormatTarget* save();
+        Ogre::DataStreamPtr getDataStream();
+        XERCES_CPP_NAMESPACE::XMLFormatTarget* getFormatTarget();
     protected:
-        CeGuiString mModulName;
         CeGuiString mName;
     };
 }

Modified: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-03 20:06:11 UTC (rev 3800)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-03 20:35:50 UTC (rev 3801)
@@ -20,6 +20,10 @@
 #include "OgreString.h"
 #include <xercesc/framework/LocalFileFormatTarget.hpp>
 
+#include <ConfigurationManager.h>
+#include <CoreSubsystem.h>
+#include <ContentModule.h>
+
 namespace rl
 {
 
@@ -32,14 +36,10 @@
     {
     }
 
-    void SaveGameFile::setModulName(const CeGuiString &modulName)
-    {
-        mModulName = modulName;
-    }
-
     CeGuiString SaveGameFile::buildFilename()
     {
-        return "modules/" + mModulName + "/saves/" + mName + ".save";
+        return ConfigurationManager::getSingleton().getModulesRootDirectory() + "/" 
+            + CoreSubsystem::getSingleton().getActiveAdventureModule()->getName() + "/saves/" + mName + ".save";
     }
 
     CeGuiString SaveGameFile::getName()
@@ -47,16 +47,20 @@
         return mName;
     }
 
-    Ogre::DataStreamPtr SaveGameFile::load()
+    Ogre::DataStreamPtr SaveGameFile::getDataStream()
     {
         ///@todo: decryption
         return Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r")));
     }
 
-    XERCES_CPP_NAMESPACE::XMLFormatTarget* SaveGameFile::save()
+    XERCES_CPP_NAMESPACE::XMLFormatTarget* SaveGameFile::getFormatTarget()
     {
         ///@todo: encryption
         return new XERCES_CPP_NAMESPACE::LocalFileFormatTarget(this->buildFilename().c_str());
     }
 
+    bool SaveGameFile::saveGameExists()
+    {
+        return !Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r"))).isNull();
+    }
 }
\ No newline at end of file

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-03 20:06:11 UTC (rev 3800)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-03 20:35:50 UTC (rev 3801)
@@ -44,7 +44,7 @@
         XMLString::transcode("LS", tempStr, 99);
         mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
         mWriter = ((DOMImplementationLS*)mImplementation)->createDOMWriter();
-        mTarget = file->save();
+        mTarget = file->getFormatTarget();
         mDocument = ((DOMImplementation*)mImplementation)->createDocument(0, XMLString::transcode("SaveGameFile"), 0);
         mDocument->setNodeValue(XMLString::transcode("SaveGameFile"));
 

Modified: rl/trunk/engine/ui/src/SaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-03 20:06:11 UTC (rev 3800)
+++ rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-03 20:35:50 UTC (rev 3801)
@@ -119,7 +119,6 @@
         LOG_MESSAGE(Logger::UI, "Create a SaveGameFile");
 
         SaveGameFile saveGameFile(mFilename->getText());
-        saveGameFile.setModulName(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName());
 
         /*std::list<const GameObject*>::const_iterator it;
         std::list<const GameObject*> gos;
@@ -152,8 +151,8 @@
     void SaveLoadWindow::listSaveGames()
     {
         Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
-        Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() + Ogre::String("/")
-            + Ogre::String(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName().c_str()) + Ogre::String("/saves"), "FileSystem", "SaveGames");
+        Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() + "/"
+            + Ogre::String(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName().c_str()) + "/saves", "FileSystem", "SaveGames");
         Ogre::StringVectorPtr saveGames = Ogre::ResourceGroupManager::getSingleton().listResourceNames("SaveGames");
         Ogre::StringVector::iterator it;
         



From timm at mail.berlios.de  Mon Sep  3 23:12:55 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 3 Sep 2007 23:12:55 +0200
Subject: [Dsa-hl-svn] r3802 - rl/trunk/engine/rules/src
Message-ID: <200709032112.l83LCtZZ008729@sheep.berlios.de>

Author: timm
Date: 2007-09-03 23:12:53 +0200 (Mon, 03 Sep 2007)
New Revision: 3802

Modified:
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
Log:
set a time stamp in the save game

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-03 20:35:50 UTC (rev 3801)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-03 21:12:53 UTC (rev 3802)
@@ -28,6 +28,8 @@
 #include <OgreResourceManager.h>
 #include <CEGUIPropertyHelper.h>
 
+#include <ctime>
+
 using namespace XERCES_CPP_NAMESPACE;
 using namespace Ogre;
 
@@ -54,6 +56,23 @@
         if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
              mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
 
+        //Write date and time
+        DOMElement* timeNode = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
+        
+        time_t rawtime;
+        tm* timeinfo;
+
+        time ( &rawtime );
+        timeinfo = localtime ( &rawtime );
+
+        XmlHelper::setAttributeValueAsInteger(timeNode, "day", timeinfo->tm_mday);
+        XmlHelper::setAttributeValueAsInteger(timeNode, "month", timeinfo->tm_mon);
+        XmlHelper::setAttributeValueAsInteger(timeNode, "year", timeinfo->tm_year+1900);
+
+        XmlHelper::setAttributeValueAsInteger(timeNode, "hour", timeinfo->tm_hour);
+        XmlHelper::setAttributeValueAsInteger(timeNode, "minute", timeinfo->tm_min);
+        XmlHelper::setAttributeValueAsInteger(timeNode, "second", timeinfo->tm_sec);
+
         //Write globals
         DOMElement* globals = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
 



From melven at mail.berlios.de  Tue Sep  4 16:29:06 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Tue, 4 Sep 2007 16:29:06 +0200
Subject: [Dsa-hl-svn] r3803 - in rl/trunk/engine: ai/src rules/src
	script/swig ui/src
Message-ID: <200709041429.l84ET6Fl025245@sheep.berlios.de>

Author: melven
Date: 2007-09-04 16:28:54 +0200 (Tue, 04 Sep 2007)
New Revision: 3803

Modified:
   rl/trunk/engine/ai/src/SteeringVehicle.cpp
   rl/trunk/engine/rules/src/CreatureControllerManager.cpp
   rl/trunk/engine/script/swig/RlRules.head.swig
   rl/trunk/engine/script/swig/RlRules.swig
   rl/trunk/engine/ui/src/DialogControlState.cpp
Log:
-fixed: strange behavior (no movement possible) after talking to someone (SteeringVehicle should not control the player)

Modified: rl/trunk/engine/ai/src/SteeringVehicle.cpp
===================================================================
--- rl/trunk/engine/ai/src/SteeringVehicle.cpp	2007-09-03 21:12:53 UTC (rev 3802)
+++ rl/trunk/engine/ai/src/SteeringVehicle.cpp	2007-09-04 14:28:54 UTC (rev 3803)
@@ -115,7 +115,7 @@
 
 
     // only process if mMovingCreature not NULL
-    if (mController == NULL)
+    if (mController == NULL || mCreature->getQueryFlags() & QUERYFLAG_PLAYER)
     {
         mCurrentForce = Vector3::ZERO;
         return;

Modified: rl/trunk/engine/rules/src/CreatureControllerManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/CreatureControllerManager.cpp	2007-09-03 21:12:53 UTC (rev 3802)
+++ rl/trunk/engine/rules/src/CreatureControllerManager.cpp	2007-09-04 14:28:54 UTC (rev 3803)
@@ -106,13 +106,16 @@
 
         mControllers.find(creature);
         ControllerMap::iterator it = mControllers.find(creature);
-        if (it == mControllers.end())
+        if (it != mControllers.end())
         {
             delete it->second;
             mControllers.erase(it);
         }
 
-        mBodyControllers.erase(creature->getActor()->getPhysicalThing()->_getBody());
+        BodyControllerMap::iterator it_ = mBodyControllers.find(
+            creature->getActor()->getPhysicalThing()->_getBody());
+        if( it_ != mBodyControllers.end() )
+            mBodyControllers.erase(it_);
     }
 
     void CreatureControllerManager::run(Real elapsedTime)

Modified: rl/trunk/engine/script/swig/RlRules.head.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.head.swig	2007-09-03 21:12:53 UTC (rev 3802)
+++ rl/trunk/engine/script/swig/RlRules.head.swig	2007-09-04 14:28:54 UTC (rev 3803)
@@ -24,6 +24,8 @@
 #include "Armor.h"
 #include "Container.h"
 #include "Creature.h"
+#include "CreatureController.h"
+#include "CreatureControllerManager.h"
 #include "Date.h"
 #include "DsaManager.h"
 #include "Effect.h"
@@ -50,5 +52,4 @@
 #include "TalentStateSet.h"
 #include "Tripel.h"
 #include "Weapon.h"
-#include "CreatureController.h"
 %}

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2007-09-03 21:12:53 UTC (rev 3802)
+++ rl/trunk/engine/script/swig/RlRules.swig	2007-09-04 14:28:54 UTC (rev 3803)
@@ -731,7 +731,7 @@
         virtual void onStateChange(GameObjectState oldState, GameObjectState newState);
     };
         
-    %feature("director") ActionMananger;
+    %feature("director") ActionManager;
     class ActionManager
     {
     public:
@@ -747,7 +747,6 @@
     class CreatureController
     {
     public:
-        CreatureController(Creature *character); 
         
         typedef enum
         {
@@ -770,7 +769,7 @@
         } MovementType;
         
         Creature *getCreature();
-        bool setMovement(MovementType type, Ogre::Vector3 direction, Ogre::Vector3 rotation);
+        //bool setMovement(MovementType type, Ogre::Vector3 direction, Ogre::Vector3 rotation);
         MovementType getMovementId() const;
         Ogre::Vector3 getDirection() const;
         Ogre::Vector3 getRotation() const;
@@ -780,8 +779,25 @@
                           Ogre::Real speed = 1, 
                           unsigned int timesToPlay = 0, 
                           const Ogre::String &collisionName = "");
+    protected:
+        CreatureController(Creature *character);
+        ~CreatureController();
     };
+    
+    class CreatureControllerManager
+    {
+    public:
+        /// Returns a CreatureController that can be used to control given Creature.
+        /// There is only one controller per Creature at a given time.
+        /// If no such controller exists yet, it is created.
+        rl::CreatureController* getCreatureController(rl::Creature* creature);
 
+        /// This function detaches a controller attached to the given Creature, if any.
+        void detachController(rl::Creature* creature);
+
+        static rl::CreatureControllerManager& getSingleton();
+    };
+
 	// Before first use of Selector or subclasses!
     %apply SWIGTYPE *DYNAMIC { rl::Selector* };
 

Modified: rl/trunk/engine/ui/src/DialogControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/DialogControlState.cpp	2007-09-03 21:12:53 UTC (rev 3802)
+++ rl/trunk/engine/ui/src/DialogControlState.cpp	2007-09-04 14:28:54 UTC (rev 3803)
@@ -86,6 +86,7 @@
 
     void DialogControlState::pause()
     {
+        /*
         if (mDialogPartner)
         {
             MeshObject* mesh = dynamic_cast<MeshObject*>(mDialogPartner->getControlledObject());
@@ -98,8 +99,9 @@
                 }
             }
         }
-        mCameraActor->getPhysicalThing()->unfreeze();
-        mCharacterActor->getPhysicalThing()->unfreeze();
+        */
+        //mCameraActor->getPhysicalThing()->unfreeze();
+        //mCharacterActor->getPhysicalThing()->unfreeze();
         mDialogWindow->setVisible(false, false);
         mSubtitleWindow->setVisible(false, false);
     }
@@ -108,8 +110,8 @@
     {
         mCharacterActor->setVisible(true);
 
-        mCameraActor->getPhysicalThing()->freeze();
-        mCharacterActor->getPhysicalThing()->freeze();
+        //mCameraActor->getPhysicalThing()->freeze();
+        //mCharacterActor->getPhysicalThing()->freeze();
         Camera* ogreCam = static_cast<Camera*>(mCameraActor->_getMovableObject());
         ogreCam->setFixedYawAxis(true);
         ogreCam->setPosition(Vector3::ZERO);



From melven at mail.berlios.de  Tue Sep  4 16:29:39 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Tue, 4 Sep 2007 16:29:39 +0200
Subject: [Dsa-hl-svn] r3804 - modules/regressiontest/scripts
Message-ID: <200709041429.l84ETdnB025311@sheep.berlios.de>

Author: melven
Date: 2007-09-04 16:29:31 +0200 (Tue, 04 Sep 2007)
New Revision: 3804

Modified:
   modules/regressiontest/scripts/WalkJobTest.rb
Log:
using CreatureControllerManager to create a CreatureController

Modified: modules/regressiontest/scripts/WalkJobTest.rb
===================================================================
--- modules/regressiontest/scripts/WalkJobTest.rb	2007-09-04 14:28:54 UTC (rev 3803)
+++ modules/regressiontest/scripts/WalkJobTest.rb	2007-09-04 14:29:31 UTC (rev 3804)
@@ -7,7 +7,7 @@
 	walkingCreature.setPosition(getCenter())
 	walkingCreature.modifyAu(1000)
 
-    creatureController = CreatureController.new(walkingCreature)
+    creatureController = CreatureControllerManager.getSingleton().getCreatureController(walkingCreature)
 
     job = CreatureWalkPathJob.new("WalkJobTest", creatureController, Landmark.new("point", [5.0, 0.0, -10.0]))
     job.addLandmark("1",[5.0,0.0,-20.0])
@@ -16,4 +16,4 @@
 	
 	$SCRIPT.log("WalkJobTest initialisiert")
   end
-end
\ No newline at end of file
+end



From pnyx at mail.berlios.de  Tue Sep  4 18:34:12 2007
From: pnyx at mail.berlios.de (pnyx at mail.berlios.de)
Date: Tue, 4 Sep 2007 18:34:12 +0200
Subject: [Dsa-hl-svn] r3805 - in modules/ruchin: maps models
Message-ID: <200709041634.l84GYClO018099@sheep.berlios.de>

Author: pnyx
Date: 2007-09-04 18:34:06 +0200 (Tue, 04 Sep 2007)
New Revision: 3805

Added:
   modules/ruchin/models/Ruchin_l_innen_lightzone_laden.mesh
   modules/ruchin/models/Ruchin_l_innen_lightzone_mitte.mesh
   modules/ruchin/models/Ruchin_l_innen_lightzone_oben.mesh
   modules/ruchin/models/Ruchin_l_innen_lightzone_unten.mesh
   modules/ruchin/models/temple_lightzone.mesh
Modified:
   modules/ruchin/maps/ruchin_lightzones.rlmap.xml
   modules/ruchin/models/temple_inside.material
Log:
added some mesh lightzones

Modified: modules/ruchin/maps/ruchin_lightzones.rlmap.xml
===================================================================
--- modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-04 14:29:31 UTC (rev 3804)
+++ modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-04 16:34:06 UTC (rev 3805)
@@ -188,26 +188,80 @@
 		
 		
 		
-		
-		<light name="red pointlight" type="point" visible="false"
+		<light name="templeLight1" type="point" visible="false"
 			castShadows="false">
-			<position x="65.2876" y="6.02141" z="-66.9458" />
-			<colourDiffuse r="1" g="0" b="0" />
-			<colourSpecular r="1" g="0" b="0" />
-			<lightAttenuation range="20.0" constant="1.0" linear="0.1"
+			<position x="123.291" y="3.02" z="-22.166" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="5" constant="1.0" linear="0.1"
 				quadratic="0.1" />
-		</light>	
+		</light>
+		<light name="templeLight2" type="point" visible="false"
+			castShadows="false">
+			<position x="123.291" y="3.02" z="-18.952" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="5" constant="1.0" linear="0.1"
+				quadratic="0.1" />
+		</light>		
 		
-		<light name="green spotlight" type="spot" visible="false"
+		<light name="Ruchin_l_Light1" type="point" visible="false"
 			castShadows="false">
-			<position x="65.2876" y="6.02141" z="-66.9458" />
-			<colourDiffuse r="0" g="1" b="0" />
-			<colourSpecular r="0" g="1" b="0" />
-			<lightAttenuation range="20.0" constant="1.0" linear="0.1"
-				quadratic="0.1" />
-			<spotlightrange inner="10" outer="20" falloff="1" />
-			<direction x="0" y="-1" z="0.5" />
+			<position x="77.001" y="2.353" z="-57.601" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.1"
+				quadratic="0.2" />
 		</light>
+		<light name="Ruchin_l_Light2" type="point" visible="false"
+			castShadows="false">
+			<position x="69.205" y="2.304" z="-41.19" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.4" />
+		</light>
+		<light name="Ruchin_l_Light3" type="point" visible="false"
+			castShadows="false">
+			<position x="67.586" y="2.304" z="-48.682" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.4" />
+		</light>
+		<light name="Ruchin_l_Light4" type="point" visible="false"
+			castShadows="false">
+			<position x="59.405" y="4.778" z="-54.343" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.4" />
+		</light>
+		<light name="Ruchin_l_Light5" type="point" visible="false"
+			castShadows="false">
+			<position x="64.84" y="6.133" z="-53.722" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.4" />
+		</light>
+		<light name="Ruchin_l_Light6" type="point" visible="false"
+			castShadows="false">
+			<position x="59.654" y="6.135" z="-49.188" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.4" />
+		</light>
+		<light name="Ruchin_l_Light7" type="point" visible="false"
+			castShadows="false">
+			<position x="72.564" y="6.133" z="-42.606" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.4" />
+		</light>
+		
 		<light name="sun" type="directional" visible="true" castShadows="true">
 			<colourDiffuse r="0.8" g="0.8" b="0.8" />
 			<colourSpecular r="0" g="0" b="1" />
@@ -218,14 +272,43 @@
 		<zone name="default">
 			<light name="sun"/>
 		</zone>
-		<zone name="Ruchin_innen">
-			<!-- we need areas like this: >
-			<area type="mesh" meshfile="name.mesh">
-				<position x="0" y="1" z="34"/>
-			</area -->
-			<light name="red pointlight"/>
-			<light name="green spotlight"/>
-			<sound name="lachen.ogg"/>
+		<zone name="temple_zone">
+			<area type="mesh" meshfile="temple_lightzone.mesh">
+				<position x="123.798" y="0" z="-20.5"/>
+			</area>
+			<light name="templeLight1"/>
+			<light name="templeLight2"/>
 		</zone>
+		<zone name="Ruchin_l_laden">
+			<area type="mesh" meshfile="Ruchin_l_innen_lightzone_laden.mesh">
+				<position x="73.014" y="0" z="-57.7"/>
+			</area>
+			<light name="Ruchin_l_Light1"/>
+		</zone>
+		
+		<zone name="Ruchin_l_unten">
+			<area type="mesh" meshfile="Ruchin_l_innen_lightzone_unten.mesh">
+				<position x="69.839" y="0" z="-48.335"/>
+			</area>
+			<light name="Ruchin_l_Light2"/>
+			<light name="Ruchin_l_Light3"/>
+			<light name="Ruchin_l_Light4"/>
+		</zone>
+		<zone name="Ruchin_l_mitte">
+			<area type="mesh" meshfile="Ruchin_l_innen_lightzone_mitte.mesh">
+				<position x="69.839" y="0" z="-48.335"/>
+			</area>
+			<light name="Ruchin_l_Light4"/>
+			<light name="Ruchin_l_Light5"/>
+			<light name="Ruchin_l_Light3"/>
+		</zone>
+		<zone name="Ruchin_l_oben">
+			<area type="mesh" meshfile="Ruchin_l_innen_lightzone_oben.mesh">
+				<position x="69.839" y="0" z="-48.335"/>
+			</area>
+			<light name="Ruchin_l_Light5"/>
+			<light name="Ruchin_l_Light6"/>
+			<light name="Ruchin_l_Light7"/>
+		</zone>
 	</zones>
 </rastullahmap>

Added: modules/ruchin/models/Ruchin_l_innen_lightzone_laden.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_l_innen_lightzone_laden.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/ruchin/models/Ruchin_l_innen_lightzone_mitte.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_l_innen_lightzone_mitte.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/ruchin/models/Ruchin_l_innen_lightzone_oben.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_l_innen_lightzone_oben.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/ruchin/models/Ruchin_l_innen_lightzone_unten.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_l_innen_lightzone_unten.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/ruchin/models/temple_inside.material
===================================================================
--- modules/ruchin/models/temple_inside.material	2007-09-04 14:29:31 UTC (rev 3804)
+++ modules/ruchin/models/temple_inside.material	2007-09-04 16:34:06 UTC (rev 3805)
@@ -5,11 +5,8 @@
 	{
 		pass
 		{
-			lighting off
-			ambient 0.0 0.0 0.0 1
-			diffuse 0.533333 0.533333 0.533333 1
+			ambient 0.5 0.5 0.5 1
 
-
 			texture_unit
 			{
 				texture_alias 0

Added: modules/ruchin/models/temple_lightzone.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/temple_lightzone.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From melven at mail.berlios.de  Tue Sep  4 20:46:21 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Tue, 4 Sep 2007 20:46:21 +0200
Subject: [Dsa-hl-svn] r3806 - in rl/trunk/engine/ui: include src
Message-ID: <200709041846.l84IkLQf026992@sheep.berlios.de>

Author: melven
Date: 2007-09-04 20:46:06 +0200 (Tue, 04 Sep 2007)
New Revision: 3806

Modified:
   rl/trunk/engine/ui/include/ControlState.h
   rl/trunk/engine/ui/src/ControlState.cpp
   rl/trunk/engine/ui/src/DialogControlState.cpp
   rl/trunk/engine/ui/src/FreeflightControlState.cpp
   rl/trunk/engine/ui/src/InventoryWindow.cpp
   rl/trunk/engine/ui/src/MovementControlState.cpp
Log:
-input-functions return only true, if they processed the input
-if cegui is actuve but doesn't process the input, actions etc can still be started

Modified: rl/trunk/engine/ui/include/ControlState.h
===================================================================
--- rl/trunk/engine/ui/include/ControlState.h	2007-09-04 16:34:06 UTC (rev 3805)
+++ rl/trunk/engine/ui/include/ControlState.h	2007-09-04 18:46:06 UTC (rev 3806)
@@ -71,7 +71,7 @@
         /// Returns true, if the key event should be injected into CEGUI
         /// This is the case, if an open window requests key input and it is
         /// an input or navigation key.
-        bool sendKeyToCeGui(const OIS::KeyEvent& evt) const;
+        //bool sendKeyToCeGui(const OIS::KeyEvent& evt) const;
 
         Person* mCharacter;
 

Modified: rl/trunk/engine/ui/src/ControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/ControlState.cpp	2007-09-04 16:34:06 UTC (rev 3805)
+++ rl/trunk/engine/ui/src/ControlState.cpp	2007-09-04 18:46:06 UTC (rev 3806)
@@ -134,101 +134,102 @@
     {
         if (WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT)
         {
-            CEGUI::System::getSingleton().injectMouseButtonDown(
+            bool retval = CEGUI::System::getSingleton().injectMouseButtonDown(
                 static_cast<CEGUI::MouseButton>(id));
-            return true;
+            return retval;
         }
-        else
-        {
-            return false;
-        }
+        
+        return false;
     }
 
     bool ControlState::mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id)
     {
         if (WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT)
         {
-            CEGUI::System::getSingleton().injectMouseButtonUp(static_cast<CEGUI::MouseButton>(id));
-            return true;
+            bool retval = CEGUI::System::getSingleton().injectMouseButtonUp(static_cast<CEGUI::MouseButton>(id));
+            return retval;
         }
-        else
-        {
-            return false;
-        }
+
+        return false;
     }
 
     bool ControlState::mouseMoved(const OIS::MouseEvent& evt)
     {
         if (WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT)
         {
-            CEGUI::Renderer* renderer = CEGUI::System::getSingleton().getRenderer();
-            CEGUI::System::getSingleton().injectMouseMove(evt.state.X.rel, evt.state.Y.rel);
+            bool retval;
+            //CEGUI::Renderer* renderer = CEGUI::System::getSingleton().getRenderer();
+            retval = CEGUI::System::getSingleton().injectMouseMove(evt.state.X.rel, evt.state.Y.rel);
             return true;
         }
-        else
-        {
-            return false;
-        }
+
+        return false;
     }
 
     bool ControlState::keyPressed(const OIS::KeyEvent& evt)
     {
         InputManager* im = InputManager::getSingletonPtr();
 
-        if (sendKeyToCeGui(evt))
+        if ( WindowManager::getSingleton().getWindowInputMask()
+            & AbstractWindow::WIT_KEYBOARD_INPUT )
         {
+            bool retval;
             CEGUI::System& cegui = CEGUI::System::getSingleton();
-            cegui.injectKeyDown(evt.key);
-            return true;
+            retval = cegui.injectKeyDown(evt.key);
+            return retval;
         }
-        else
-        {
-            return false;
-        }
+
+        return false;
     }
 
     bool ControlState::keyReleased(const OIS::KeyEvent& evt)
     {
         InputManager* im = InputManager::getSingletonPtr();
 
-        if (sendKeyToCeGui(evt))
+        if ( WindowManager::getSingleton().getWindowInputMask()
+            & AbstractWindow::WIT_KEYBOARD_INPUT )
         {
+            bool retval;
             CEGUI::System& cegui = CEGUI::System::getSingleton();
-            cegui.injectKeyUp(evt.key);
-            cegui.injectChar(im->getKeyChar(evt.key, im->getModifierCode()));
-            return true;
+            retval = cegui.injectKeyUp(evt.key);
+            if( !retval )
+                retval = cegui.injectChar(im->getKeyChar(evt.key, im->getModifierCode()));
+            
+            if( retval )
+                return true;
         }
-        else
+
+        int code = CommandMapper::encodeKey(evt.key, im->getModifierCode());
+
+        // First see, if a control state action is defined
+	    CeGuiString action = mCommandMapper->getControlStateAction(code, mType);
+        if (action == "")
         {
-            int code = CommandMapper::encodeKey(evt.key, im->getModifierCode());
+            // No. So try global actions.
+            action = mCommandMapper->getGlobalAction(code);
+        }
+        return startAction(action, mCharacter);
 
-            // First see, if a control state action is defined
-		    CeGuiString action = mCommandMapper->getControlStateAction(code, mType);
-            if (action == "")
-            {
-                // No. So try global actions.
-                action = mCommandMapper->getGlobalAction(code);
-            }
-            return startAction(action, mCharacter);
-        }
     }
 
     bool ControlState::isCeguiActive() const
     {
         return WindowManager::getSingleton().getWindowInputMask() != 0;
     }
-
+/*
     bool ControlState::sendKeyToCeGui(const OIS::KeyEvent& evt) const
     {
         InputManager* im = InputManager::getSingletonPtr();
 
         // Wenn kein Fenster mit Tastatureingabe aktiv ist, kriegt CEGUI keine KeyEvents
         if ((WindowManager::getSingleton().getWindowInputMask()
-            & AbstractWindow::WIT_KEYBOARD_INPUT) == 0)
+            & AbstractWindow::WIT_KEYBOARD_INPUT) )
         {
-            return false;
+            return true;
         }
 
+        return false;
+
         // ---- Tastatureingabe gefordert ----
 
         // Tasten, die Zeichen liefern sollen an CEGUI gesendet werden
@@ -250,4 +251,5 @@
 
         return false;
     }
+*/
 }

Modified: rl/trunk/engine/ui/src/DialogControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/DialogControlState.cpp	2007-09-04 16:34:06 UTC (rev 3805)
+++ rl/trunk/engine/ui/src/DialogControlState.cpp	2007-09-04 18:46:06 UTC (rev 3806)
@@ -319,6 +319,8 @@
     bool DialogControlState::mouseReleased(const OIS::MouseEvent& evt,
         OIS::MouseButtonID id)
     {
+        if( ControlState::mouseReleased(evt, id) )
+            return true;
 
         if (mTextShown && (mCurrFadeTextTime + 0.25) < mTotalFadeTextTime)
         {

Modified: rl/trunk/engine/ui/src/FreeflightControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/FreeflightControlState.cpp	2007-09-04 16:34:06 UTC (rev 3805)
+++ rl/trunk/engine/ui/src/FreeflightControlState.cpp	2007-09-04 18:46:06 UTC (rev 3806)
@@ -17,6 +17,7 @@
 
 #include "FreeflightControlState.h"
 
+#include "AbstractWindow.h"
 #include "CoreSubsystem.h"
 #include "ConfigurationManager.h"
 #include "Exception.h"
@@ -27,6 +28,8 @@
 #include "InputManager.h"
 #include "CommandMapper.h"
 #include "MeshObject.h"
+#include "WindowManager.h"
+#include "Person.h"
 
 #include <OgreSceneManager.h>
 
@@ -219,12 +222,8 @@
 
     bool FreeflightControlState::keyPressed(const OIS::KeyEvent& evt)
 	{
-        // CEGUI is handled by base class, so hand it down if necessary.
-        if( sendKeyToCeGui(evt) )
-        {
-            mCurrentMovementState = MOVE_NONE;
-            return ControlState::keyPressed(evt);
-        }
+        if( ControlState::keyPressed(evt) )
+            return true;
 
         int movement = mCommandMapper->getMovement(evt.key);
 
@@ -239,40 +238,54 @@
 
     bool FreeflightControlState::keyReleased(const OIS::KeyEvent& evt)
 	{
-        // CEGUI is handled by base class, so hand it down if necessary.
-        if( sendKeyToCeGui(evt) )
+        // this should be the same as in ControlState::keyReleased!
+        InputManager* im = InputManager::getSingletonPtr();
+        if ( WindowManager::getSingleton().getWindowInputMask()
+            & AbstractWindow::WIT_KEYBOARD_INPUT )
         {
-            mCurrentMovementState = MOVE_NONE;
-            return ControlState::keyReleased(evt);
+            bool retval;
+            CEGUI::System& cegui = CEGUI::System::getSingleton();
+            retval = cegui.injectKeyUp(evt.key);
+            if( !retval )
+                retval = cegui.injectChar(im->getKeyChar(evt.key, im->getModifierCode()));
+            
+            if( retval )
+                return true;
         }
 
+
+        int code = CommandMapper::encodeKey(evt.key, im->getModifierCode());
+        // First see, if a control state action is defined
+	    CeGuiString command = mCommandMapper->getControlStateAction(code, mType);
+        if (command == "")
+        {
+            // No. So try global actions.
+            command = mCommandMapper->getGlobalAction(code);
+        }
+        if (command == "back_to_character_movement")
+        {
+            InputManager::getSingleton().popControlState();
+            return true;
+        }
+        if (command == "toggle_camera_collision")
+        {
+            toggleCameraCollision();
+            return true;
+        }
+        if( startAction(command, mCharacter) )
+            return true;
+
+
+
+
         int movement = mCommandMapper->getMovement(evt.key);
-
 		if (movement != MOVE_NONE)
 		{
 			mCurrentMovementState &= ~movement;
 			return true;
 		}
-        else
-        {
-            InputManager* im = InputManager::getSingletonPtr();
-            int keycode = CommandMapper::encodeKey(evt.key, im->getModifierCode());
-            CeGuiString command = mCommandMapper->getControlStateAction(keycode, CST_FREEFLIGHT);
-            if (command == "back_to_character_movement")
-            {
-                InputManager::getSingleton().popControlState();
-                return true;
-            }
-            if (command == "toggle_camera_collision")
-            {
-                toggleCameraCollision();
-                return true;
-            }
-            else
-            {
-                return ControlState::keyReleased(evt);
-            }
-        }
+
+        return false;
 	}
 
     int FreeflightControlState::userProcess()

Modified: rl/trunk/engine/ui/src/InventoryWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/InventoryWindow.cpp	2007-09-04 16:34:06 UTC (rev 3805)
+++ rl/trunk/engine/ui/src/InventoryWindow.cpp	2007-09-04 18:46:06 UTC (rev 3806)
@@ -508,7 +508,7 @@
             action = InputManager::getSingleton().getControlState()
                         ->getCommandMapper()->getGlobalAction(kevt.scancode);
         }
-        if( action == "inventoryshowworldobjects" )
+        if( action == "inventoryshowworldobjects" )  // we only handle this action here
 		{
 			if (down)
 			{
@@ -564,14 +564,6 @@
 
 			return true;
 		}
-        else if(!down)
-        {
-            InputManager::getSingleton().getControlState()->startAction(
-                action,
-                mInventory->getOwner()
-                );
-            return true;
-        }
 
 		return false;
 	}

Modified: rl/trunk/engine/ui/src/MovementControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/MovementControlState.cpp	2007-09-04 16:34:06 UTC (rev 3805)
+++ rl/trunk/engine/ui/src/MovementControlState.cpp	2007-09-04 18:46:06 UTC (rev 3806)
@@ -52,6 +52,7 @@
 #include "WindowFactory.h"
 #include "AnimationManager.h"
 #include "UiSubsystem.h"
+#include "WindowManager.h"
 
 #include <numeric>
 
@@ -1265,74 +1266,79 @@
     //------------------------------------------------------------------------
     bool MovementControlState::keyPressed(const OIS::KeyEvent& evt)
     {
-        // CEGUI is handled by base class, so hand it down if necessary.
-        if( sendKeyToCeGui(evt) )
-        {
-            mCharacterState.mCurrentMovementState = MOVE_NONE |
-                (mCharacterState.mCurrentMovementState & MOVE_RUN_LOCK);
-            return ControlState::keyPressed(evt);
-        }
+        if( ControlState::keyPressed(evt) )
+            return true;
 
         int movement = mCommandMapper->getMovement(evt.key);
 
+        bool retval = false;
         if (movement & MOVE_RUN_LOCK) // dieses einrasten lassen
         {
             mCharacterState.mCurrentMovementState ^= MOVE_RUN_LOCK;
             movement &= ~MOVE_RUN_LOCK;
+            retval = true;
         }
         if (movement != MOVE_NONE)
         {
             mCharacterState.mCurrentMovementState |= movement;
-            return true;
+            retval = true;
         }
-        return false;
+        return retval;
     }
 
     //------------------------------------------------------------------------
     bool MovementControlState::keyReleased(const OIS::KeyEvent& evt)
     {
-        // CEGUI is handled by base class, so hand it down if necessary.
-        if( sendKeyToCeGui(evt) )
+        // this should be the same as in ControlState::keyReleased!
+        InputManager* im = InputManager::getSingletonPtr();
+        if ( WindowManager::getSingleton().getWindowInputMask()
+            & AbstractWindow::WIT_KEYBOARD_INPUT )
         {
-            mCharacterState.mCurrentMovementState = MOVE_NONE |
-                (mCharacterState.mCurrentMovementState & MOVE_RUN_LOCK);
-            return ControlState::keyReleased(evt);
+            bool retval;
+            CEGUI::System& cegui = CEGUI::System::getSingleton();
+            retval = cegui.injectKeyUp(evt.key);
+            if( !retval )
+                retval = cegui.injectChar(im->getKeyChar(evt.key, im->getModifierCode()));
+            
+            if( retval )
+                return true;
         }
 
-        int movement = mCommandMapper->getMovement(evt.key);
 
-        if (movement != MOVE_NONE)
+        int code = CommandMapper::encodeKey(evt.key, im->getModifierCode());
+        // First see, if a control state action is defined
+	    CeGuiString command = mCommandMapper->getControlStateAction(code, mType);
+        if (command == "")
         {
-            mCharacterState.mCurrentMovementState &= (~movement | MOVE_RUN_LOCK);
+            // No. So try global actions.
+            command = mCommandMapper->getGlobalAction(code);
+        }
+        if (command == "freeflight_mode")
+        {
+            InputManager::getSingleton().pushControlState(CST_FREEFLIGHT);
             return true;
         }
-        else
+        if (command == "reset_camera")
         {
-            InputManager* im = InputManager::getSingletonPtr();
-            int keycode = CommandMapper::encodeKey(evt.key, im->getModifierCode());
-            CeGuiString command = mCommandMapper->getControlStateAction(keycode, CST_MOVEMENT);
-            if (command == "freeflight_mode")
-            {
-                InputManager::getSingleton().pushControlState(CST_FREEFLIGHT);
-                return true;
-            }
-            else if (command == "reset_camera")
-            {
-                resetCamera();
-                return true;
-            }
-            else if (command == "toggle_view_mode")
-            {
-                toggleViewMode();
-                return true;
-            }
-            else
-            {
-                // Nothing we handle here, see if base class can make something of this input.
-                return ControlState::keyReleased(evt);
-            }
+            resetCamera();
+            return true;
         }
+        if (command == "toggle_view_mode")
+        {
+            toggleViewMode();
+            return true;
+        }
+        if( startAction(command, mCharacter) )
+            return true;
 
+
+        int movement = mCommandMapper->getMovement(evt.key);
+        if (movement != MOVE_NONE)
+        {
+            mCharacterState.mCurrentMovementState &= (~movement | MOVE_RUN_LOCK);
+            return true;
+        }
+
         return false;
     }
 
@@ -1340,17 +1346,14 @@
     bool MovementControlState::mouseReleased(const OIS::MouseEvent& evt,
         OIS::MouseButtonID id)
     {
-        if (!isCeguiActive())
-        {
-            InputManager* im = InputManager::getSingletonPtr();
-            int mouseButtonMask = CommandMapper::encodeKey(id, im->getModifierCode());
-            return startAction(mCommandMapper->getControlStateAction(mouseButtonMask,
-                CST_MOVEMENT), mCharacter);
-        }
-        else
-        {
-            return ControlState::mouseReleased(evt, id);
-        }
+        if( ControlState::mouseReleased(evt, id) )
+            return true;
+
+
+        InputManager* im = InputManager::getSingletonPtr();
+        int mouseButtonMask = CommandMapper::encodeKey(id, im->getModifierCode());
+        return startAction(mCommandMapper->getControlStateAction(mouseButtonMask,
+            CST_MOVEMENT), mCharacter);
     }
 
     //------------------------------------------------------------------------



From timm at mail.berlios.de  Tue Sep  4 21:07:30 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Tue, 4 Sep 2007 21:07:30 +0200
Subject: [Dsa-hl-svn] r3807 - in rl/trunk/engine: rules/src ui/src
Message-ID: <200709041907.l84J7U0s028290@sheep.berlios.de>

Author: timm
Date: 2007-09-04 21:07:21 +0200 (Tue, 04 Sep 2007)
New Revision: 3807

Modified:
   rl/trunk/engine/rules/src/SaveGameFile.cpp
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
   rl/trunk/engine/ui/src/SaveLoadWindow.cpp
Log:
- fixed path for save games
- added writing quests

Modified: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-04 18:46:06 UTC (rev 3806)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-04 19:07:21 UTC (rev 3807)
@@ -39,7 +39,7 @@
     CeGuiString SaveGameFile::buildFilename()
     {
         return ConfigurationManager::getSingleton().getModulesRootDirectory() + "/" 
-            + CoreSubsystem::getSingleton().getActiveAdventureModule()->getName() + "/saves/" + mName + ".save";
+            + CoreSubsystem::getSingleton().getActiveAdventureModule()->getId() + "/saves/" + mName + ".save";
     }
 
     CeGuiString SaveGameFile::getName()

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-04 18:46:06 UTC (rev 3806)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-04 19:07:21 UTC (rev 3807)
@@ -16,14 +16,17 @@
 
 #include "stdinc.h"
 
+#include "SaveGameFileWriter.h"
+
 #include <XmlHelper.h>
 #include <xercesc/dom/DOM.hpp>
 #include <xercesc/dom/DOMAttr.hpp>
 #include <xercesc/dom/DOMElement.hpp>
 #include <Properties.h>
 
-#include "SaveGameFileWriter.h"
-#include <GameObjectManager.h>
+#include "GameObjectManager.h"
+#include "QuestBook.h"
+#include "RulesSubsystem.h"
 
 #include <OgreResourceManager.h>
 #include <CEGUIPropertyHelper.h>
@@ -76,24 +79,34 @@
         //Write globals
         DOMElement* globals = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
 
+        //Write Quests
+        DOMElement* quests = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "quests");
+        QuestBook* questBook = RulesSubsystem::getSingleton().getQuestBook();
+        PropertySet* set = questBook->getAllProperties();
+        PropertySetMap::const_iterator it_quests;
+        for(it_quests = set->begin(); it_quests != set->end(); it_quests++)
+        {
+            this->processProperty(quests, PropertyEntry(it_quests->first.c_str(), it_quests->second));
+        }
+
         //Write game objects
         DOMElement* gameobjects = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "gameobjects");
         
-        std::list<const GameObject*>::const_iterator it;
+        std::list<const GameObject*>::const_iterator it_gameobjects;
         std::list<const GameObject*> gos;
         gos = GameObjectManager::getSingleton().getAllGameObjects();
 
-        for(it = gos.begin(); it != gos.end(); it++)
+        for(it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
         {
             DOMElement* gameobject = XmlHelper::appendChildElement(mDocument, gameobjects, "gameobject");
-            XmlHelper::setAttributeValueAsInteger(gameobject, "ID", (*it)->getId());
-            XmlHelper::setAttributeValueAsString(gameobject, "ClassID", (*it)->getClassId());
+            XmlHelper::setAttributeValueAsInteger(gameobject, "ID", (*it_gameobjects)->getId());
+            XmlHelper::setAttributeValueAsString(gameobject, "ClassID", (*it_gameobjects)->getClassId());
 
-            PropertyMap map = (*it)->getAllProperties()->toPropertyMap();
-            PropertyMap::iterator it2;
-            for(it2 = map.begin(); it2 != map.end(); it2++)
+            PropertyMap map = (*it_gameobjects)->getAllProperties()->toPropertyMap();
+            PropertyMap::iterator it_properties;
+            for(it_properties = map.begin(); it_properties != map.end(); it_properties++)
             {
-                this->processProperty(gameobject, PropertyEntry(it2->first.c_str(), it2->second));
+                this->processProperty(gameobject, PropertyEntry(it_properties->first.c_str(), it_properties->second));
             }
         }        
 

Modified: rl/trunk/engine/ui/src/SaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-04 18:46:06 UTC (rev 3806)
+++ rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-04 19:07:21 UTC (rev 3807)
@@ -152,7 +152,7 @@
     {
         Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
         Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() + "/"
-            + Ogre::String(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName().c_str()) + "/saves", "FileSystem", "SaveGames");
+            + Ogre::String(CoreSubsystem::getSingleton().getActiveAdventureModule()->getId().c_str()) + "/saves", "FileSystem", "SaveGames");
         Ogre::StringVectorPtr saveGames = Ogre::ResourceGroupManager::getSingleton().listResourceNames("SaveGames");
         Ogre::StringVector::iterator it;
         



From melven at mail.berlios.de  Tue Sep  4 21:08:51 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Tue, 4 Sep 2007 21:08:51 +0200
Subject: [Dsa-hl-svn] r3808 - rl/trunk/engine/ui/src
Message-ID: <200709041908.l84J8pJq028396@sheep.berlios.de>

Author: melven
Date: 2007-09-04 21:08:44 +0200 (Tue, 04 Sep 2007)
New Revision: 3808

Modified:
   rl/trunk/engine/ui/src/Console.cpp
Log:
chars are processed by console::handleKeyDown

Modified: rl/trunk/engine/ui/src/Console.cpp
===================================================================
--- rl/trunk/engine/ui/src/Console.cpp	2007-09-04 19:07:21 UTC (rev 3807)
+++ rl/trunk/engine/ui/src/Console.cpp	2007-09-04 19:08:44 UTC (rev 3808)
@@ -22,6 +22,7 @@
 
 #include "RubyInterpreter.h"
 #include "ListboxWrappedTextItem.h"
+#include "InputManager.h"
 #include "CoreSubsystem.h"
 
 using namespace Ogre;
@@ -91,6 +92,10 @@
 			mCommandLine->setText((utf8*)"");
 			return true;
 		}
+        InputManager* im = InputManager::getSingletonPtr();
+        static const CEGUI::utf8 NO_CHAR = 0;
+        if( im->getKeyChar(ke.scancode, im->getModifierCode()) != NO_CHAR )
+            return true;
 
 		return false;
 	}



From timm at mail.berlios.de  Tue Sep  4 21:59:08 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Tue, 4 Sep 2007 21:59:08 +0200
Subject: [Dsa-hl-svn] r3809 - in rl/trunk/engine/common: include src
Message-ID: <200709041959.l84Jx8Am031389@sheep.berlios.de>

Author: timm
Date: 2007-09-04 21:59:02 +0200 (Tue, 04 Sep 2007)
New Revision: 3809

Modified:
   rl/trunk/engine/common/include/Property.h
   rl/trunk/engine/common/src/PropertyWriter.cpp
Log:
fixed empty type tag

Modified: rl/trunk/engine/common/include/Property.h
===================================================================
--- rl/trunk/engine/common/include/Property.h	2007-09-04 19:08:44 UTC (rev 3808)
+++ rl/trunk/engine/common/include/Property.h	2007-09-04 19:59:02 UTC (rev 3809)
@@ -50,6 +50,7 @@
     void setValue(Type value) \
     { \
         mValue = value; \
+        mName = #Name; \
     } \
     \
     Type to##Name() const \

Modified: rl/trunk/engine/common/src/PropertyWriter.cpp
===================================================================
--- rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-04 19:08:44 UTC (rev 3808)
+++ rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-04 19:59:02 UTC (rev 3809)
@@ -46,42 +46,45 @@
 
     DOMElement* XmlPropertyWriter::processProperty(DOMElement* parent, PropertyEntry entry)
     {
-        DOMElement* element;
-        if(entry.second.isArray())
+        DOMElement* element = NULL;
+        if(!entry.second.isEmpty())
         {
-            element = this->processPropertyArray(parent, entry.first.c_str(), entry.second.toArray());
-        }
-        else if(entry.second.isMap())
-        {
-            element = this->processPropertyMap(parent, entry.first.c_str(), entry.second.toMap());
-        }
-        else
-        {
-            element = XmlHelper::appendChildElement(mDocument, parent, "property");
-            if(entry.first != "")
-                XmlHelper::setAttribute(element, "name", entry.first.c_str());
+            if(entry.second.isArray())
+            {
+                element = this->processPropertyArray(parent, entry.first.c_str(), entry.second.toArray());
+            }
+            else if(entry.second.isMap())
+            {
+                element = this->processPropertyMap(parent, entry.first.c_str(), entry.second.toMap());
+            }
+            else
+            {
+                element = XmlHelper::appendChildElement(mDocument, parent, "property");
+                if(entry.first != "")
+                    XmlHelper::setAttribute(element, "name", entry.first.c_str());
 
-            //Ogre::String typeName = entry.second.getTypeName();
-            Ogre::String name = entry.second.getName();
-            Ogre::StringUtil::toUpperCase(name);
-            XmlHelper::setAttributeValueAsString(element, "type", name);
+                //Ogre::String typeName = entry.second.getTypeName();
+                Ogre::String name = entry.second.getName();
+                Ogre::StringUtil::toUpperCase(name);
+                XmlHelper::setAttributeValueAsString(element, "type", name);
 
-            if(entry.second.isBool())
-                XmlHelper::setAttributeValueAsBool(element, "data", entry.second.toBool());
-            else if(entry.second.isInt())
-                XmlHelper::setAttributeValueAsInteger(element, "data", entry.second.toInt());
-            else if(entry.second.isIntPair())
-                XmlHelper::setAttributeValueAsIntegerPair(element, "data", entry.second.toIntPair());
-            else if(entry.second.isIntPair())
-                XmlHelper::setAttributeValueAsIntegerTriple(element, "data", entry.second.toIntTriple());
-            else if(entry.second.isQuaternion())
-                XmlHelper::setValueAsQuaternion(element, entry.second.toQuaternion());
-            else if(entry.second.isReal())
-                XmlHelper::setAttributeValueAsReal(element, "data", entry.second.toReal());
-            else if(entry.second.isString())
-                XmlHelper::setAttributeValueAsString(element, "data", entry.second.toString());
-            else if(entry.second.isVector3())
-                XmlHelper::setValueAsVector3(element, entry.second.toVector3());
+                if(entry.second.isBool())
+                    XmlHelper::setAttributeValueAsBool(element, "data", entry.second.toBool());
+                else if(entry.second.isInt())
+                    XmlHelper::setAttributeValueAsInteger(element, "data", entry.second.toInt());
+                else if(entry.second.isIntPair())
+                    XmlHelper::setAttributeValueAsIntegerPair(element, "data", entry.second.toIntPair());
+                else if(entry.second.isIntPair())
+                    XmlHelper::setAttributeValueAsIntegerTriple(element, "data", entry.second.toIntTriple());
+                else if(entry.second.isQuaternion())
+                    XmlHelper::setValueAsQuaternion(element, entry.second.toQuaternion());
+                else if(entry.second.isReal())
+                    XmlHelper::setAttributeValueAsReal(element, "data", entry.second.toReal());
+                else if(entry.second.isString())
+                    XmlHelper::setAttributeValueAsString(element, "data", entry.second.toString());
+                else if(entry.second.isVector3())
+                    XmlHelper::setValueAsVector3(element, entry.second.toVector3());
+            }
         }
         return element;
     }



From melven at mail.berlios.de  Wed Sep  5 13:01:22 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Wed, 5 Sep 2007 13:01:22 +0200
Subject: [Dsa-hl-svn] r3810 - in rl/trunk/engine/core: include src
Message-ID: <200709051101.l85B1MqV000467@sheep.berlios.de>

Author: melven
Date: 2007-09-05 13:01:15 +0200 (Wed, 05 Sep 2007)
New Revision: 3810

Modified:
   rl/trunk/engine/core/include/ZoneManager.h
   rl/trunk/engine/core/src/ZoneManager.cpp
Log:
zones can now play sounds

Modified: rl/trunk/engine/core/include/ZoneManager.h
===================================================================
--- rl/trunk/engine/core/include/ZoneManager.h	2007-09-04 19:59:02 UTC (rev 3809)
+++ rl/trunk/engine/core/include/ZoneManager.h	2007-09-05 11:01:15 UTC (rev 3810)
@@ -23,6 +23,7 @@
 namespace rl
 {
     class Zone;
+    class Sound;
 
     class _RlCoreExport ZoneManager : 
         public Ogre::Singleton<ZoneManager>,
@@ -74,6 +75,8 @@
 		std::map<const Ogre::String, Zone*> mZones;
         std::map<long, Zone*> mZonesIdMap;
 		std::list<Zone*> mActiveZones;
+        typedef std::map<const Ogre::String, Sound*> SoundMap;
+        SoundMap mActiveSounds;
 		Zone* mDefaultZone;
         long mNextZoneId;
 

Modified: rl/trunk/engine/core/src/ZoneManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-04 19:59:02 UTC (rev 3809)
+++ rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-05 11:01:15 UTC (rev 3810)
@@ -23,6 +23,8 @@
 #include "GameEventManager.h"
 #include "Zone.h"
 #include "World.h"
+#include "Sound.h"
+#include "SoundManager.h"
 
 
 using namespace Ogre;
@@ -302,34 +304,36 @@
 	void ZoneManager::switchSounds()
 	{
 		Zone* currentZone = mActiveZones.front();
-		std::set<Ogre::String> activeSounds;
+		SoundMap newActiveSounds;
 
+        // create all new sounds, or take existing ones
 		std::list<Ogre::String> curSounds = currentZone->getSounds();
 		for (std::list<Ogre::String>::const_iterator it = curSounds.begin(); it != curSounds.end(); it++)
 		{
-			activeSounds.insert(*it);
-			///@todo switch sound on
+            SoundMap::iterator it_ = mActiveSounds.find(*it);
+            if( it_ != mActiveSounds.end() )
+            {
+                // this sound already exists, only copy and don't destroy later
+                newActiveSounds.insert(*it_);
+                mActiveSounds.erase(it_); // remember, it_ is now invalid
+            }
+            else
+            {
+                // we need to create a new sound
+                Sound *sound = SoundManager::getSingleton().createSound(*it, ST_STREAM);
+                sound->setLooping(true);
+                sound->play(false);
+                newActiveSounds.insert(make_pair(*it, sound));
+            }
 		}
 
-		for (std::map<const Ogre::String, Zone*>::const_iterator itZones = mZones.begin(); itZones != mZones.end(); itZones++)
-		{
-			std::list<Ogre::String> curSounds = (*itZones).second->getSounds();
-			for (std::list<Ogre::String>::const_iterator itSounds = curSounds.begin(); itSounds != curSounds.end(); itSounds++)
-			{
-				if (activeSounds.find(*itSounds) == activeSounds.end())
-				{
-					///@todo switch sound off
-				}
-			}
-		}
+        // destroy old sounds
+        for( SoundMap::iterator it = mActiveSounds.begin(); it != mActiveSounds.end(); it++ )
+        {
+            SoundManager::getSingleton().destroySound(it->second);
+        }
 
-		std::list<Ogre::String> defSounds = mDefaultZone->getSounds();
-		for (std::list<Ogre::String>::const_iterator itSounds = defSounds.begin(); itSounds != defSounds.end(); itSounds++)
-		{
-			if (activeSounds.find(*itSounds) == activeSounds.end())
-			{
-				///@todo switch sound off
-			}
-		}
+        // copy new active sounds
+        mActiveSounds = newActiveSounds;
 	}
 }



From melven at mail.berlios.de  Wed Sep  5 13:01:51 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Wed, 5 Sep 2007 13:01:51 +0200
Subject: [Dsa-hl-svn] r3811 - modules/regressiontest/maps
Message-ID: <200709051101.l85B1pmv000950@sheep.berlios.de>

Author: melven
Date: 2007-09-05 13:01:42 +0200 (Wed, 05 Sep 2007)
New Revision: 3811

Modified:
   modules/regressiontest/maps/regressiontest_lights.rlmap.xml
Log:
using a nicer sound in the zone

Modified: modules/regressiontest/maps/regressiontest_lights.rlmap.xml
===================================================================
--- modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-05 11:01:15 UTC (rev 3810)
+++ modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-05 11:01:42 UTC (rev 3811)
@@ -41,7 +41,7 @@
 			</area>
 			<light name="red pointlight"/>
 			<light name="green spotlight"/>
-			<sound name="lachen.ogg"/>
+			<sound name="wind_hintergrund_001.ogg"/>
 		</zone>
 	</zones>
 </rastullahmap>



From no22 at mail.berlios.de  Wed Sep  5 14:24:15 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Wed, 5 Sep 2007 14:24:15 +0200
Subject: [Dsa-hl-svn] r3812 - in rl/trunk/engine: rules/src script/swig
Message-ID: <200709051224.l85COFk3001216@sheep.berlios.de>

Author: no22
Date: 2007-09-05 14:24:10 +0200 (Wed, 05 Sep 2007)
New Revision: 3812

Modified:
   rl/trunk/engine/rules/src/Creature.cpp
   rl/trunk/engine/rules/src/CreatureController.cpp
   rl/trunk/engine/rules/src/DsaManager.cpp
   rl/trunk/engine/rules/src/Person.cpp
   rl/trunk/engine/script/swig/RlRules.swig
Log:
Creature:
* exportet addSf to ruby (Sonderfertigkeiten don't work yet, though)
CreatureController:
* renamed taw to tap which seems to be more appropriate
* used the IMMOBILE metastatus, which is more robust to changes
DsaManager:
* more information in error message



Modified: rl/trunk/engine/rules/src/Creature.cpp
===================================================================
--- rl/trunk/engine/rules/src/Creature.cpp	2007-09-05 11:01:42 UTC (rev 3811)
+++ rl/trunk/engine/rules/src/Creature.cpp	2007-09-05 12:24:10 UTC (rev 3812)
@@ -389,6 +389,7 @@
 
     int Creature::getTalent(const CeGuiString talentName)
     {
+        LOG_DEBUG(Logger::RULES, "Using talent " + talentName);
         TalentMap::const_iterator it = mTalente.find(talentName);
         if (it == mTalente.end())
         {
@@ -567,7 +568,8 @@
 			Throw(IllegalArgumentException, "Sonderfertigkeit schon in mSonderfertigkeiten enthalten.");
 		}
 		//ueberpruefe ob es die Sonderfertigkeit ueberhaupt gib
-		DsaManager::getSingleton().getTalent(sfName);
+        /// @todo
+		//DsaManager::getSingleton().getSf(sfName);
 		mSonderfertigkeiten[sfName] = new SonderfertigkeitenStateSet();
 		mSonderfertigkeiten[sfName]->setOriginalValue( value );
 		fireObjectStateChangeEvent();

Modified: rl/trunk/engine/rules/src/CreatureController.cpp
===================================================================
--- rl/trunk/engine/rules/src/CreatureController.cpp	2007-09-05 11:01:42 UTC (rev 3811)
+++ rl/trunk/engine/rules/src/CreatureController.cpp	2007-09-05 12:24:10 UTC (rev 3812)
@@ -61,7 +61,7 @@
             return
                 mMovingCreature->getAbstractLocation() == CreatureController::AL_FLOOR &&
                 mMovingCreature->getCreature()->getAu() > 0 &&
-                !(mMovingCreature->getCreature()->getStatus() & (Effect::STATUS_DEAD | Effect::STATUS_UNCONSCIOUS | Effect::STATUS_SLEEPING));
+                !(mMovingCreature->getCreature()->getStatus() & (Effect::STATUS_IMMOBILE));
         }
         virtual void calculateForceAndTorque(Vector3 &force, Vector3 &torque, Real timestep)
         {
@@ -730,20 +730,20 @@
 
             if( mMovingCreature->getCreature()->hasTalent("Athletik") )
             {
-                int taw = mMovingCreature->getCreature()->doTalentprobe("Athletik", 0);
-                if( taw > 0 )
+                int tap = mMovingCreature->getCreature()->doTalentprobe("Athletik", 0);
+                if( tap > 0 )
                 {
-                    if( taw == RESULT_SPEKT_AUTOERFOLG )
+                    if( tap == RESULT_SPEKT_AUTOERFOLG )
                     {
                         mHeight += mMovingCreature->getCreature()->getTalent("Athletik") / 12.5;
                     }
-                    else if( taw == RESULT_AUTOERFOLG )
+                    else if( tap == RESULT_AUTOERFOLG )
                     {
                         mHeight += mMovingCreature->getCreature()->getTalent("Athletik") / 25.0;
                     }
                     else
                     {
-                        mHeight += taw / 25.0;
+                        mHeight += tap / 25.0;
                     }
                 }
             }

Modified: rl/trunk/engine/rules/src/DsaManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/DsaManager.cpp	2007-09-05 11:01:42 UTC (rev 3811)
+++ rl/trunk/engine/rules/src/DsaManager.cpp	2007-09-05 12:24:10 UTC (rev 3812)
@@ -212,7 +212,8 @@
         }
         else
         {
-            Throw(IllegalArgumentException, "Talent nicht gefunden.");
+            CeGuiString errorMessage = "Talent " + talentName + " nicht gefunden.";
+            Throw(IllegalArgumentException, errorMessage.c_str());
         }
     }
 

Modified: rl/trunk/engine/rules/src/Person.cpp
===================================================================
--- rl/trunk/engine/rules/src/Person.cpp	2007-09-05 11:01:42 UTC (rev 3811)
+++ rl/trunk/engine/rules/src/Person.cpp	2007-09-05 12:24:10 UTC (rev 3812)
@@ -26,6 +26,7 @@
     {
         mQueryFlags |= QUERYFLAG_PERSON;
 		setWert(WERT_SOZIALSTATUS, 0);
+        setWert(WERT_KAMPFUNFAEHIGKEITSSCHWELLE, 5);
     }
 
 }

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2007-09-05 11:01:42 UTC (rev 3811)
+++ rl/trunk/engine/script/swig/RlRules.swig	2007-09-05 12:24:10 UTC (rev 3812)
@@ -644,6 +644,13 @@
             ALIGNMENT_NEUTRAL, ///< Creature doesn't fight for either side.
             ALIGNMENT_ENEMY    ///< Creature fights against the player.
         };
+
+            enum SfStatus
+            {
+                SFSTATUS_IN_TRAINING = 1,
+                SFSTATUS_OK,
+                SFSTATUS_REQUIREMENTS_NOT_MET /// @todo Wird das ueberhaupt gebraucht?
+        };
         
 
         // some targets
@@ -691,6 +698,7 @@
         void addNachteil(const rl::CeGuiString nachteilName, int value = 0);        
         
         void addKampftechnik(const rl::CeGuiString kampftechnikName, std::pair<int,int> value = make_pair(0,0));
+        virtual void addSf(const rl::CeGuiString sfName, SfStatus value = SFSTATUS_IN_TRAINING);
         
         virtual int doTalentprobe(const rl::CeGuiString talentName, int modifier);
         virtual int doEigenschaftsprobe(const rl::CeGuiString eigenschaftName, int modifier);



From no22 at mail.berlios.de  Wed Sep  5 14:28:13 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Wed, 5 Sep 2007 14:28:13 +0200
Subject: [Dsa-hl-svn] r3813 - modules/common/scripts
Message-ID: <200709051228.l85CSDCM001367@sheep.berlios.de>

Author: no22
Date: 2007-09-05 14:28:10 +0200 (Wed, 05 Sep 2007)
New Revision: 3813

Modified:
   modules/common/scripts/mckhero.rb
Log:
*mckhero:
Added more Values to Alrike to resemble a (nearly) complete DSA charakter (DSA4 Rules yet, will make a real DSA 4.1 Charakter when I get my book back)

Modified: modules/common/scripts/mckhero.rb
===================================================================
--- modules/common/scripts/mckhero.rb	2007-09-05 12:24:10 UTC (rev 3812)
+++ modules/common/scripts/mckhero.rb	2007-09-05 12:28:10 UTC (rev 3813)
@@ -16,7 +16,10 @@
         setEigenschaft("GE", 12);
         setEigenschaft("KO", 13); #KO
         setEigenschaft("KK", 14); #KK
-	setWert(Creature::WERT_MOD_LE, 10); # LE-Mod
+	setWert(WERT_MOD_LE, 10); # LE-Mod
+	setWert(WERT_MOD_AU, 11); # AU-Mod
+	setWert(WERT_MOD_MR, -4); # MR-Mod
+	setWert(WERT_SOZIALSTATUS, 5);
 
 	$SCRIPT.log("LeP und AuP auff?llen");
         modifyLe(1000, false); # LeP = LE
@@ -24,9 +27,56 @@
         #modifyLe(-20); # 10 LeP abziehen
 
 	$SCRIPT.log("Talente hinzuf?gen");
-	addTalent("Athletik", 3);
-	#addTalent("K?rperbeherrschung", 3);
+	#Kampffertigkeiten
+	#addTalent("Armbrust", 4);
+	#addTalent("Dolche", 3);
+	#addTalent("Infanteriewaffen", 6);
+	#addTalent("Raufen", 6);
+	#addTalent("Ringen", 3);
+	#addTalent("Schwerter", 4);
 
+	#K?rperliche Talente
+	addTalent("Athletik", 2);
+	addTalent("Klettern", 1);
+	addTalent("K?rperbeherrschung", 2);
+	addTalent("Schwimmen", 2);
+	addTalent("Selbstbeherrschung", 2);
+	addTalent("Sinnensch?rfe", 3);
+	addTalent("Zechen", 3);
+
+	#Gesellschaftliche Talente
+	addTalent("Etikette", 3);
+	addTalent("Gassenwissen", 3);
+	addTalent("Menschenkenntnis", 4);
+	addTalent("?berreden", 2);
+
+	#Naturtalente
+	addTalent("F?hrtensuchen", 1);
+	addTalent("Fesseln / Entfesseln", 3);
+	addTalent("Orientierung", 1);
+
+	#Wissenstalente
+	addTalent("G?tter und Kulte", 3);
+	addTalent("Heraldik", 3);
+	addTalent("Kriegskunst", 2);
+	addTalent("Rechnen", 1);
+	addTalent("Rechtskunde", 4);
+	addTalent("Sagen / Legenden", 2);
+	addTalent("Sch?tzen", 3);
+
+	#Handwerkstalente
+	addTalent("Hauswirtschaft", 1);
+
+	#Sprachen
+	# Muttersprache Garethi
+	# 1 Fremdsprache +3
+	# L/S Garethi 4
+	
+	$SCRIPT.log("Sonderfertigkeiten hinzuf?gen");
+	addSf("Ortskenntnis", SFSTATUS_OK);
+	addSf("R?stungsgew?hnung I", SFSTATUS_OK);
+
+
         $SCRIPT.log("Heldenaktor beschreiben...");
 
 	#addSounds()



From melven at mail.berlios.de  Wed Sep  5 15:40:43 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Wed, 5 Sep 2007 15:40:43 +0200
Subject: [Dsa-hl-svn] r3814 - modules/regressiontest/maps
Message-ID: <200709051340.l85DehnH005466@sheep.berlios.de>

Author: melven
Date: 2007-09-05 15:40:36 +0200 (Wed, 05 Sep 2007)
New Revision: 3814

Modified:
   modules/regressiontest/maps/regressiontest_lights.rlmap.xml
Log:
added eaxpreset setting in the little sphere-zone in the big sphere-zone

Modified: modules/regressiontest/maps/regressiontest_lights.rlmap.xml
===================================================================
--- modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-05 12:28:10 UTC (rev 3813)
+++ modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-05 13:40:36 UTC (rev 3814)
@@ -41,7 +41,18 @@
 			</area>
 			<light name="red pointlight"/>
 			<light name="green spotlight"/>
-			<sound name="wind_hintergrund_001.ogg"/>
+			<sound name="ruchin001.ogg"/>
 		</zone>
+		<zone name="Underwater">
+			<area type="sphere">
+				<position x="-10" y="0" z="-5"/>
+				<scale x="2" y="2" z="2"/>
+				<transition_distance>0.2</transition_distance>
+			</area>
+			<light name="red pointlight"/>
+			<light name="green spotlight"/>
+			<eaxpreset name="Underwater"/>
+			<sound name="ruchin001.ogg"/>
+		</zone>
 	</zones>
 </rastullahmap>



From melven at mail.berlios.de  Wed Sep  5 15:43:28 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Wed, 5 Sep 2007 15:43:28 +0200
Subject: [Dsa-hl-svn] r3815 - in rl/trunk: engine/core/include
	engine/core/include/nulldriver engine/core/src
	engine/core/src/nulldriver engine/script/src
	plugins/fmod4driver/include plugins/fmod4driver/src
	plugins/openaldriver/include plugins/openaldriver/src
Message-ID: <200709051343.l85DhSL8005609@sheep.berlios.de>

Author: melven
Date: 2007-09-05 15:43:03 +0200 (Wed, 05 Sep 2007)
New Revision: 3815

Modified:
   rl/trunk/engine/core/include/SoundDriver.h
   rl/trunk/engine/core/include/Zone.h
   rl/trunk/engine/core/include/ZoneManager.h
   rl/trunk/engine/core/include/nulldriver/NullDriver.h
   rl/trunk/engine/core/src/Zone.cpp
   rl/trunk/engine/core/src/ZoneManager.cpp
   rl/trunk/engine/core/src/nulldriver/NullDriver.cpp
   rl/trunk/engine/script/src/ZoneProcessor.cpp
   rl/trunk/plugins/fmod4driver/include/Fmod4Driver.h
   rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp
   rl/trunk/plugins/openaldriver/include/OpenALDriver.h
   rl/trunk/plugins/openaldriver/src/OpenALDriver.cpp
Log:
added eaxpreset value in zone-definitions

Modified: rl/trunk/engine/core/include/SoundDriver.h
===================================================================
--- rl/trunk/engine/core/include/SoundDriver.h	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/engine/core/include/SoundDriver.h	2007-09-05 13:43:03 UTC (rev 3815)
@@ -111,6 +111,12 @@
          */
         virtual void applySettings(const Ogre::NameValuePairList& settings);
 
+        /**
+         * Sets an eax preset, the preset is defined by a string
+         * @retval true if successfull
+        */
+        virtual bool setEaxPreset(const Ogre::String& name) = 0;
+
     protected:
         virtual Sound* createSoundImpl(SoundResourcePtr res, SoundType type) = 0;
 

Modified: rl/trunk/engine/core/include/Zone.h
===================================================================
--- rl/trunk/engine/core/include/Zone.h	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/engine/core/include/Zone.h	2007-09-05 13:43:03 UTC (rev 3815)
@@ -37,9 +37,16 @@
 		void addLight(Actor* light);
         void addSound(const Ogre::String& name);
 		void addTrigger(Trigger* trigger);
+        /**
+         * sets an aex-preset
+         * @param name The name of the preset (possible names can be found in the wiki), 
+         * an empty String ("") signifies that no change of the eax-preset is needed
+        */
+        void setEaxPreset(const Ogre::String& name);
 		std::list<Actor*> getLights() const;
         std::list<Ogre::String> getSounds() const;
 		std::list<Trigger*> getTriggers() const;
+        const Ogre::String& getEaxPreset() const;
         void removeLight(Actor* light);
         void removeSound(const Ogre::String& name);
         void removeTrigger(Trigger* trigger);
@@ -57,6 +64,7 @@
 		std::list<Ogre::String> mSounds;
 		std::list<Trigger*> mTriggers;
         GameAreaEventSourceList mEventSources;
+        Ogre::String mEaxPreset;
 	};
 
 }

Modified: rl/trunk/engine/core/include/ZoneManager.h
===================================================================
--- rl/trunk/engine/core/include/ZoneManager.h	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/engine/core/include/ZoneManager.h	2007-09-05 13:43:03 UTC (rev 3815)
@@ -82,6 +82,7 @@
 
 		void switchLights();
 		void switchSounds();
+        void switchEaxSettings();
 	};
 }
 

Modified: rl/trunk/engine/core/include/nulldriver/NullDriver.h
===================================================================
--- rl/trunk/engine/core/include/nulldriver/NullDriver.h	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/engine/core/include/nulldriver/NullDriver.h	2007-09-05 13:43:03 UTC (rev 3815)
@@ -51,6 +51,9 @@
     /// Set volume attenuation factor f in 1/(f*distance)
     virtual void setRolloffFactor(const Ogre::Real&);
     virtual const Ogre::Real getRolloffFactor();
+
+    /// Sets an eax preset
+    virtual bool setEaxPreset(const Ogre::String& name);
 
 protected:
     virtual Sound* createSoundImpl(SoundResourcePtr res, SoundType type);

Modified: rl/trunk/engine/core/src/Zone.cpp
===================================================================
--- rl/trunk/engine/core/src/Zone.cpp	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/engine/core/src/Zone.cpp	2007-09-05 13:43:03 UTC (rev 3815)
@@ -27,7 +27,7 @@
 {
 
 
-    Zone::Zone(long id) : mId(id)
+    Zone::Zone(long id) : mId(id), mEaxPreset("")
     {
     }
 
@@ -59,6 +59,11 @@
 		}
 	}
 
+    void Zone::setEaxPreset(const Ogre::String& name)
+    {
+        mEaxPreset = name;
+    }
+
 	std::list<Actor*> Zone::getLights() const
 	{
 		std::list<Actor*> rval(mLights);
@@ -77,6 +82,11 @@
 		return rval;
 	}
 
+    const Ogre::String& Zone::getEaxPreset() const
+    {
+        return mEaxPreset;
+    }
+
     void Zone::removeLight(Actor *light)
     {
         if( !light )

Modified: rl/trunk/engine/core/src/ZoneManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-05 13:43:03 UTC (rev 3815)
@@ -25,6 +25,7 @@
 #include "World.h"
 #include "Sound.h"
 #include "SoundManager.h"
+#include "SoundDriver.h"
 
 
 using namespace Ogre;
@@ -233,8 +234,7 @@
                     mActiveZones.push_front(zone);
             }
 
-		    switchLights();
-		    switchSounds();
+		    update();
         }
 	}
 
@@ -256,14 +256,14 @@
                     mActiveZones.remove(zone);
             }
 
-		    switchLights();
-		    switchSounds();
+		    update();
         }
 	}
 
     void ZoneManager::update()
     {
         switchLights();
+        switchEaxSettings();
         switchSounds();
     }
 
@@ -336,4 +336,17 @@
         // copy new active sounds
         mActiveSounds = newActiveSounds;
 	}
+
+    void ZoneManager::switchEaxSettings()
+    {
+        if( mActiveZones.front()->getEaxPreset() != "" )
+        {
+            SoundManager::getSingleton().getActiveDriver()->setEaxPreset(
+                mActiveZones.front()->getEaxPreset() );
+        }
+        else
+        {
+            SoundManager::getSingleton().getActiveDriver()->setEaxPreset("Off");
+        }
+    }
 }

Modified: rl/trunk/engine/core/src/nulldriver/NullDriver.cpp
===================================================================
--- rl/trunk/engine/core/src/nulldriver/NullDriver.cpp	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/engine/core/src/nulldriver/NullDriver.cpp	2007-09-05 13:43:03 UTC (rev 3815)
@@ -122,4 +122,9 @@
     return 1.0;
 }
 
+bool NullDriver::setEaxPreset(const Ogre::String& name)
+{
+    return true;
 }
+
+}

Modified: rl/trunk/engine/script/src/ZoneProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-05 13:43:03 UTC (rev 3815)
@@ -188,6 +188,11 @@
 
 									///@todo trigger properties
 								}
+                                else if (XmlHelper::hasNodeName(curElem, "eaxpreset"))
+                                {
+									Ogre::String name = XmlHelper::getAttributeValueAsStdString(curElem, "name");
+                                    zone->setEaxPreset(name);
+                                }
 							}
 						}
 					}

Modified: rl/trunk/plugins/fmod4driver/include/Fmod4Driver.h
===================================================================
--- rl/trunk/plugins/fmod4driver/include/Fmod4Driver.h	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/plugins/fmod4driver/include/Fmod4Driver.h	2007-09-05 13:43:03 UTC (rev 3815)
@@ -91,6 +91,12 @@
          */
         virtual void applySettings(const Ogre::NameValuePairList& settings);
 
+        /**
+         * Sets an eax preset, the preset is defined by a string
+         * @retval true if successfull
+        */
+        virtual bool setEaxPreset(const Ogre::String& name);
+
         /// Setzt den Faktor f, mit der die Lautst?rke nach der Formel 1/(f*Entfernung) abnimmt
         virtual void setRolloffFactor(const Ogre::Real&);
         virtual const Ogre::Real getRolloffFactor();
@@ -143,6 +149,11 @@
             unsigned int commanddata2
         );
 
+        typedef std::map<const Ogre::String, FMOD_REVERB_PROPERTIES> EaxPresetMap;
+        EaxPresetMap mEaxPresetMap;
+
+        void initializeEaxPresetMap();
+
         /// Log driver config data
         virtual void printData() const;
         void printDriverInfo(int driver) const;

Modified: rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp
===================================================================
--- rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp	2007-09-05 13:43:03 UTC (rev 3815)
@@ -22,6 +22,7 @@
 #include "SoundResource.h"
 
 using namespace Ogre;
+using namespace std;
 
 namespace rl
 {
@@ -80,6 +81,8 @@
         }
 
         mFmod4System->getMasterChannelGroup(&mMasterChannelGroup);
+
+        initializeEaxPresetMap();
         return true;
     }
 
@@ -129,6 +132,58 @@
         mMasterChannelGroup->setVolume(mMasterVolume);
     }
 
+#define DEF_PRESET(NAME, DEFINITION) \
+    { \
+        FMOD_REVERB_PROPERTIES prop = DEFINITION; \
+        mEaxPresetMap.insert(make_pair(NAME, prop)); \
+    }
+
+    void Fmod4Driver::initializeEaxPresetMap()
+    {
+        DEF_PRESET("Alley", FMOD_PRESET_ALLEY);
+        DEF_PRESET("Arena", FMOD_PRESET_ARENA);
+        DEF_PRESET("Auditorium", FMOD_PRESET_AUDITORIUM);
+        DEF_PRESET("Bathroom", FMOD_PRESET_BATHROOM);
+        DEF_PRESET("Carpetted Hallway", FMOD_PRESET_CARPETTEDHALLWAY);
+        DEF_PRESET("Cave", FMOD_PRESET_CAVE);
+        DEF_PRESET("City", FMOD_PRESET_CITY);
+        DEF_PRESET("Concert Hall", FMOD_PRESET_CONCERTHALL);
+        DEF_PRESET("Dizzy", FMOD_PRESET_DIZZY);
+        DEF_PRESET("Drugged", FMOD_PRESET_DRUGGED);
+        DEF_PRESET("Forest", FMOD_PRESET_FOREST);
+        DEF_PRESET("Generic", FMOD_PRESET_GENERIC);
+        DEF_PRESET("Hallway", FMOD_PRESET_HALLWAY);
+        DEF_PRESET("Hangar", FMOD_PRESET_HANGAR);
+        DEF_PRESET("Living Room", FMOD_PRESET_LIVINGROOM);
+        DEF_PRESET("Mountains", FMOD_PRESET_MOUNTAINS);
+        DEF_PRESET("Off", FMOD_PRESET_OFF);
+        DEF_PRESET("Padded Cell", FMOD_PRESET_PADDEDCELL);
+        DEF_PRESET("Parkinglot", FMOD_PRESET_PARKINGLOT);
+        DEF_PRESET("Plain", FMOD_PRESET_PLAIN);
+        DEF_PRESET("Psychotic", FMOD_PRESET_PSYCHOTIC);
+        DEF_PRESET("Quarry", FMOD_PRESET_QUARRY);
+        DEF_PRESET("Room", FMOD_PRESET_ROOM);
+        DEF_PRESET("Sewerpipe", FMOD_PRESET_SEWERPIPE);
+        DEF_PRESET("Stone Corridor", FMOD_PRESET_STONECORRIDOR);
+        DEF_PRESET("Stone Room", FMOD_PRESET_STONEROOM);
+        DEF_PRESET("Underwater", FMOD_PRESET_UNDERWATER);
+    }
+#undef DEF_PRESET
+
+    bool Fmod4Driver::setEaxPreset(const Ogre::String& name)
+    {
+        EaxPresetMap::iterator it = mEaxPresetMap.find(name);
+
+        if( it != mEaxPresetMap.end() )
+        {
+            FMOD_RESULT result;
+            result = mFmod4System->setReverbProperties(&(it->second)); ///@todo seems not to work correctly
+            CHECK_FMOD4_ERRORS(result);
+        }
+
+        return false;
+    }
+
     Ogre::NameValuePairList Fmod4Driver::getSettings() const
     {
         return SoundDriver::getSettings();

Modified: rl/trunk/plugins/openaldriver/include/OpenALDriver.h
===================================================================
--- rl/trunk/plugins/openaldriver/include/OpenALDriver.h	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/plugins/openaldriver/include/OpenALDriver.h	2007-09-05 13:43:03 UTC (rev 3815)
@@ -57,6 +57,9 @@
          */
         virtual bool isDriverPlugin();
 
+        /// Sets an eax preset
+        virtual bool setEaxPreset(const Ogre::String& name);
+
     protected:
         virtual Sound* createSoundImpl(SoundResourcePtr res, SoundType type);
 

Modified: rl/trunk/plugins/openaldriver/src/OpenALDriver.cpp
===================================================================
--- rl/trunk/plugins/openaldriver/src/OpenALDriver.cpp	2007-09-05 13:40:36 UTC (rev 3814)
+++ rl/trunk/plugins/openaldriver/src/OpenALDriver.cpp	2007-09-05 13:43:03 UTC (rev 3815)
@@ -194,4 +194,9 @@
     {
         return 1.0;
     }
+
+    bool OpenALDriver::setEaxPreset(const Ogre::String& name)
+    {
+        return true;
+    }
 }



From twel at mail.berlios.de  Wed Sep  5 18:45:09 2007
From: twel at mail.berlios.de (twel at mail.berlios.de)
Date: Wed, 5 Sep 2007 18:45:09 +0200
Subject: [Dsa-hl-svn] r3816 - rl/trunk/engine
Message-ID: <200709051645.l85Gj99p023990@sheep.berlios.de>

Author: twel
Date: 2007-09-05 18:45:06 +0200 (Wed, 05 Sep 2007)
New Revision: 3816

Modified:
   rl/trunk/engine/Makefile.am
Log:
removed subdir dialog (was deleted with rev 3727)

Modified: rl/trunk/engine/Makefile.am
===================================================================
--- rl/trunk/engine/Makefile.am	2007-09-05 13:43:03 UTC (rev 3815)
+++ rl/trunk/engine/Makefile.am	2007-09-05 16:45:06 UTC (rev 3816)
@@ -1,2 +1,2 @@
-SUBDIRS = common dialog ai ui core rules script startup
+SUBDIRS = common ai ui core rules script startup
 



From no22 at mail.berlios.de  Wed Sep  5 18:53:47 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Wed, 5 Sep 2007 18:53:47 +0200
Subject: [Dsa-hl-svn] r3817 - in rl/trunk/engine: rules/include rules/src
	script/swig ui/include ui/src
Message-ID: <200709051653.l85Grlux032614@sheep.berlios.de>

Author: no22
Date: 2007-09-05 18:53:39 +0200 (Wed, 05 Sep 2007)
New Revision: 3817

Modified:
   rl/trunk/engine/rules/include/Creature.h
   rl/trunk/engine/rules/include/EffectManager.h
   rl/trunk/engine/rules/include/GameObject.h
   rl/trunk/engine/rules/include/Person.h
   rl/trunk/engine/rules/src/EffectManager.cpp
   rl/trunk/engine/rules/src/GameObject.cpp
   rl/trunk/engine/rules/src/Person.cpp
   rl/trunk/engine/script/swig/RlRules.swig
   rl/trunk/engine/ui/include/CharacterSheetWindow.h
   rl/trunk/engine/ui/src/CharacterSheetWindow.cpp
Log:
CharacterSheetWindow:
*Actually displays Rasse, Kultur and Profession
*Displays a list of all active effects

Modified: rl/trunk/engine/rules/include/Creature.h
===================================================================
--- rl/trunk/engine/rules/include/Creature.h	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/rules/include/Creature.h	2007-09-05 16:53:39 UTC (rev 3817)
@@ -281,7 +281,7 @@
              **/
             int getAp();
             /**
-             *  Ver?dert die verbrauchten @ref abbdea "AP", wird beim Steigern
+             *  Veraendert die verbrauchten @ref abbdea "AP", wird beim Steigern
              *  aufgerufen.
              *  @param modifier Kann auch negativ sein (z.B. Borbarad-Moskitos).
              **/

Modified: rl/trunk/engine/rules/include/EffectManager.h
===================================================================
--- rl/trunk/engine/rules/include/EffectManager.h	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/rules/include/EffectManager.h	2007-09-05 16:53:39 UTC (rev 3817)
@@ -29,7 +29,7 @@
      * Verwaltet die Effekte die auf einer Kreatur wirken.
      * Diese Klasse verwaltet alle Effekte, die auf einer Kreatur liegen.
      * Jede Kreatur hat ihren eigenen EffectManager. Die Funktion checkeffects
-     * sollte w?rend jeder Aktion (gemeint ist die DSA-Zeiteinheit) aufgerufen
+     * sollte waehrend jeder Aktion (gemeint ist die DSA-Zeiteinheit) aufgerufen
      * werden.
      **/
 
@@ -88,6 +88,11 @@
          **/
         int getMod(CeGuiString target, Effect::ModType type, Effect::ModTag tag = Effect::MODTAG_NONE);
 
+        /**
+         * Returns a printable list of all effects
+         **/
+        CeGuiString getEffects();
+
 	private:
         /// Eine einfache Menge von Effekten
 		typedef std::set<Effect*> Effects;

Modified: rl/trunk/engine/rules/include/GameObject.h
===================================================================
--- rl/trunk/engine/rules/include/GameObject.h	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/rules/include/GameObject.h	2007-09-05 16:53:39 UTC (rev 3817)
@@ -167,6 +167,10 @@
         void addEffectWithCheckTime(Effect* effect, RL_LONGLONG time);
         void addEffectWithCheckDate(Effect* effect, RL_LONGLONG date);
         void removeEffect(Effect* effect);
+        /**
+         * Returns a printable list of all Effects app
+         */
+        CeGuiString getEffects();
 
     protected:
         int mId;

Modified: rl/trunk/engine/rules/include/Person.h
===================================================================
--- rl/trunk/engine/rules/include/Person.h	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/rules/include/Person.h	2007-09-05 16:53:39 UTC (rev 3817)
@@ -29,6 +29,18 @@
         static const Ogre::String CLASS_NAME;
 
         Person(unsigned int id);
+
+        CeGuiString getRasse();
+        void setRasse(CeGuiString rasse);
+        CeGuiString getKultur();
+        void setKultur(CeGuiString kultur);
+        CeGuiString getProfession();
+        void setProfession(CeGuiString profession);
+
+    private:
+        CeGuiString mRasse;
+        CeGuiString mKultur;
+        CeGuiString mProfession;
 	};	
 }
 

Modified: rl/trunk/engine/rules/src/EffectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/EffectManager.cpp	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/rules/src/EffectManager.cpp	2007-09-05 16:53:39 UTC (rev 3817)
@@ -173,5 +173,16 @@
       }
       return mod;
     }
+
+    CeGuiString EffectManager::getEffects()
+    {
+        CeGuiString retVal = "";
+        for (Effects::iterator it = mEffects.begin(); it != mEffects.end(); it++)
+        {
+            retVal += (*it)->getName() + "\n";
+            retVal += (*it)->getDescription() + "\n";
+        }
+        return retVal;
+    }
 }
 

Modified: rl/trunk/engine/rules/src/GameObject.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObject.cpp	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/rules/src/GameObject.cpp	2007-09-05 16:53:39 UTC (rev 3817)
@@ -430,6 +430,11 @@
 		mEffectManager->removeEffect(effect);
 	}
 
+    CeGuiString GameObject::getEffects()
+    {
+        return mEffectManager->getEffects();
+    }
+
     const Property GameObject::getProperty(const Ogre::String& key) const
     {
         Property prop;

Modified: rl/trunk/engine/rules/src/Person.cpp
===================================================================
--- rl/trunk/engine/rules/src/Person.cpp	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/rules/src/Person.cpp	2007-09-05 16:53:39 UTC (rev 3817)
@@ -29,4 +29,34 @@
         setWert(WERT_KAMPFUNFAEHIGKEITSSCHWELLE, 5);
     }
 
+    CeGuiString Person::getRasse()
+    {
+        return mRasse;
+    }
+
+    void Person::setRasse(CeGuiString rasse)
+    {
+        mRasse = rasse;
+    }
+
+    CeGuiString Person::getKultur()
+    {
+        return mKultur;
+    }
+
+    void Person::setKultur(CeGuiString kultur)
+    {
+        mKultur = kultur;
+    }
+
+    CeGuiString Person::getProfession()
+    {
+        return mProfession;
+    }
+
+    void Person::setProfession(CeGuiString profession)
+    {
+        mProfession = profession;
+    }
+
 }

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/script/swig/RlRules.swig	2007-09-05 16:53:39 UTC (rev 3817)
@@ -732,6 +732,13 @@
    public:
         Person(unsigned int id);
 
+        rl::CeGuiString getRasse();
+        void setRasse(rl::CeGuiString rasse);
+        rl::CeGuiString getKultur();
+        void setKultur(rl::CeGuiString kultur);
+        rl::CeGuiString getProfession();
+        void setProfession(rl::CeGuiString profession);
+
         virtual const rl::Property getProperty(const Ogre::String& key) const;
         virtual void setProperty(const Ogre::String& key, const rl::Property& value);
         virtual rl::PropertySet* getAllProperties() const;

Modified: rl/trunk/engine/ui/include/CharacterSheetWindow.h
===================================================================
--- rl/trunk/engine/ui/include/CharacterSheetWindow.h	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/ui/include/CharacterSheetWindow.h	2007-09-05 16:53:39 UTC (rev 3817)
@@ -58,7 +58,9 @@
 		CEGUI::Window* mAP;
 		CEGUI::Window* mName;
 		CEGUI::Window* mRasse;
+        CEGUI::Window* mKultur;
 		CEGUI::Window* mProfession;
+        CEGUI::Window* mEffekte;
 		
 		void updateTalents();
 

Modified: rl/trunk/engine/ui/src/CharacterSheetWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/CharacterSheetWindow.cpp	2007-09-05 16:45:06 UTC (rev 3816)
+++ rl/trunk/engine/ui/src/CharacterSheetWindow.cpp	2007-09-05 16:53:39 UTC (rev 3817)
@@ -49,7 +49,9 @@
 	mAP = getWindow("CharacterSheet/CharacterSheet/AP");
 	mName = getWindow("CharacterSheet/CharacterSheet/Name");
 	mRasse = getWindow("CharacterSheet/CharacterSheet/Rasse");
+    mKultur = getWindow("CharacterSheet/CharacterSheet/Kultur");
 	mProfession = getWindow("CharacterSheet/CharacterSheet/Profession");
+    mEffekte = getWindow("CharacterSheet/CharacterSheet/Effekte");
 
 	bindHideWindowToXButton();
 
@@ -98,8 +100,10 @@
 void CharacterSheetWindow::updateValues()
 {
 	mName->setText("Name: "+mCharacter->getName());
-	mRasse->setText("Rasse: ");
-	mProfession->setText("Profession: ");
+    mRasse->setText("Rasse: "+mCharacter->getRasse());
+    mKultur->setText("Kultur: "+mCharacter->getKultur());
+    mProfession->setText("Profession: "+mCharacter->getProfession());
+    mEffekte->setText("Effekte:\n"+mCharacter->getEffects());
 
 	mLE->setText("LeP: "+
 		StringConverter::toString(mCharacter->getLe())+"/"+



From no22 at mail.berlios.de  Wed Sep  5 18:54:39 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Wed, 5 Sep 2007 18:54:39 +0200
Subject: [Dsa-hl-svn] r3818 - in modules/common: gui/windows scripts
Message-ID: <200709051654.l85GsdHl032720@sheep.berlios.de>

Author: no22
Date: 2007-09-05 18:54:33 +0200 (Wed, 05 Sep 2007)
New Revision: 3818

Modified:
   modules/common/gui/windows/charactersheet.xml
   modules/common/scripts/mckhero.rb
Log:
CharacterSheetWindow:
*Actually displays Rasse, Kultur and Profession
*Displays a list of all active effects

Modified: modules/common/gui/windows/charactersheet.xml
===================================================================
--- modules/common/gui/windows/charactersheet.xml	2007-09-05 16:53:39 UTC (rev 3817)
+++ modules/common/gui/windows/charactersheet.xml	2007-09-05 16:54:33 UTC (rev 3818)
@@ -24,12 +24,24 @@
 						<Property Name="FrameEnabled" Value="False"/>
                     </Window>
                       
+                    <Window Type="RastullahLook/StaticText" Name="CharacterSheet/CharacterSheet/Kultur">
+                        <Property Name="UnifiedPosition" Value="{{0,10},{0,62}}"/>
+                        <Property Name="UnifiedSize" Value="{{0,300},{0,30}}"/>
+						<Property Name="FrameEnabled" Value="False"/>
+                    </Window>
+                      
                     <Window Type="RastullahLook/StaticText" Name="CharacterSheet/CharacterSheet/Profession">
                         <Property Name="UnifiedPosition" Value="{{0,10},{0,80}}"/>
                         <Property Name="UnifiedSize" Value="{{0,300},{0,30}}"/>
 						<Property Name="FrameEnabled" Value="False"/>
                     </Window>
 
+                    <Window Type="RastullahLook/StaticText" Name="CharacterSheet/CharacterSheet/Effekte">
+                        <Property Name="UnifiedPosition" Value="{{0,300},{0,10}}"/>
+                        <Property Name="UnifiedSize" Value="{{0,300},{0,300}}"/>
+						<Property Name="FrameEnabled" Value="False"/>
+                    </Window>
+
                     <Window Type="RastullahLook/StaticText" Name="CharacterSheet/CharacterSheet/LE">
                         <Property Name="UnifiedPosition" Value="{{0,10},{0,410}}"/>
                         <Property Name="UnifiedSize" Value="{{0,150},{0,30}}"/>

Modified: modules/common/scripts/mckhero.rb
===================================================================
--- modules/common/scripts/mckhero.rb	2007-09-05 16:53:39 UTC (rev 3817)
+++ modules/common/scripts/mckhero.rb	2007-09-05 16:54:33 UTC (rev 3818)
@@ -6,6 +6,11 @@
         addQueryFlag(RlScript::QUERYFLAG_PLAYER)
 	setName("Alrike");
 	setDescription("Heldin von Berufung");
+	$SCRIPT.log("Rasse, Kultur und Profession...");
+	setRasse("Mittell?nder");
+	setKultur("Garetien");
+	setProfession("Gardist");
+
 	$SCRIPT.log("Gute Eigenschaften zuweisen...");
 
         setEigenschaft("MU", 12);



From timm at mail.berlios.de  Wed Sep  5 21:16:29 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Wed, 5 Sep 2007 21:16:29 +0200
Subject: [Dsa-hl-svn] r3819 - in rl/trunk/engine: ai/include ai/src
	common/include common/src rules/include rules/src
Message-ID: <200709051916.l85JGTLr009499@sheep.berlios.de>

Author: timm
Date: 2007-09-05 21:16:09 +0200 (Wed, 05 Sep 2007)
New Revision: 3819

Modified:
   rl/trunk/engine/ai/include/Makefile.am
   rl/trunk/engine/ai/src/Makefile.am
   rl/trunk/engine/common/include/Makefile.am
   rl/trunk/engine/common/src/Makefile.am
   rl/trunk/engine/rules/include/Makefile.am
   rl/trunk/engine/rules/src/Makefile.am
Log:
updated make files

Modified: rl/trunk/engine/ai/include/Makefile.am
===================================================================
--- rl/trunk/engine/ai/include/Makefile.am	2007-09-05 16:54:33 UTC (rev 3818)
+++ rl/trunk/engine/ai/include/Makefile.am	2007-09-05 19:16:09 UTC (rev 3819)
@@ -2,6 +2,7 @@
 	Agent.h \
 	AgentManager.h \
 	AgentCombatState.h \
+	AgentDialogState.h \
 	AgentState.h \
 	AgentSteeringState.h \
 	AiPrerequisites.h \

Modified: rl/trunk/engine/ai/src/Makefile.am
===================================================================
--- rl/trunk/engine/ai/src/Makefile.am	2007-09-05 16:54:33 UTC (rev 3818)
+++ rl/trunk/engine/ai/src/Makefile.am	2007-09-05 19:16:09 UTC (rev 3819)
@@ -6,6 +6,7 @@
 libRlAi_la_SOURCES = \
 	Agent.cpp \
 	AgentCombatState.cpp \
+	AgentDialogState.cpp \
 	AgentManager.cpp \
 	AgentSteeringState.cpp \
 	AiSubsystem.cpp \

Modified: rl/trunk/engine/common/include/Makefile.am
===================================================================
--- rl/trunk/engine/common/include/Makefile.am	2007-09-05 16:54:33 UTC (rev 3818)
+++ rl/trunk/engine/common/include/Makefile.am	2007-09-05 19:16:09 UTC (rev 3819)
@@ -15,6 +15,7 @@
     Properties.h \
     Property.h \
     PropertyReader.h \
+	PropertyWriter.h \
     RastullahPrerequisites.h \
     ScriptWrapper.h \
 	Sleep.h \

Modified: rl/trunk/engine/common/src/Makefile.am
===================================================================
--- rl/trunk/engine/common/src/Makefile.am	2007-09-05 16:54:33 UTC (rev 3818)
+++ rl/trunk/engine/common/src/Makefile.am	2007-09-05 19:16:09 UTC (rev 3819)
@@ -14,6 +14,7 @@
   Properties.cpp \
   Property.cpp \
   PropertyReader.cpp \
+  PropertyWriter.cpp \
   ScriptWrapper.cpp \
   XmlErrorHandler.cpp \
   XmlHelper.cpp \

Modified: rl/trunk/engine/rules/include/Makefile.am
===================================================================
--- rl/trunk/engine/rules/include/Makefile.am	2007-09-05 16:54:33 UTC (rev 3818)
+++ rl/trunk/engine/rules/include/Makefile.am	2007-09-05 19:16:09 UTC (rev 3819)
@@ -34,6 +34,8 @@
 	QuestListener.h \
 	RulesPrerequisites.h \
 	RulesSubsystem.h \
+	SaveGameFile.h \
+	SaveGameFileWriter.h \
 	SelectionHelper.h \
 	Selector.h \
 	Slot.h \

Modified: rl/trunk/engine/rules/src/Makefile.am
===================================================================
--- rl/trunk/engine/rules/src/Makefile.am	2007-09-05 16:54:33 UTC (rev 3818)
+++ rl/trunk/engine/rules/src/Makefile.am	2007-09-05 19:16:09 UTC (rev 3819)
@@ -37,6 +37,8 @@
 	QuestEvent.cpp \
 	QuestListener.cpp \
 	RulesSubsystem.cpp \
+	SaveGameFile.cpp \
+	SaveGameFileWriter.cpp \
 	SelectionHelper.cpp \
 	Selector.cpp \
 	Slot.cpp \



From timm at mail.berlios.de  Wed Sep  5 21:18:05 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Wed, 5 Sep 2007 21:18:05 +0200
Subject: [Dsa-hl-svn] r3820 - rl/trunk/engine/rules/src
Message-ID: <200709051918.l85JI5Vp009546@sheep.berlios.de>

Author: timm
Date: 2007-09-05 21:18:00 +0200 (Wed, 05 Sep 2007)
New Revision: 3820

Modified:
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
Log:
write header and gametime

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-05 19:16:09 UTC (rev 3819)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-05 19:18:00 UTC (rev 3820)
@@ -30,6 +30,9 @@
 
 #include <OgreResourceManager.h>
 #include <CEGUIPropertyHelper.h>
+#include <CoreSubsystem.h>
+#include <ContentModule.h>
+#include <TimeSource.h>
 
 #include <ctime>
 
@@ -59,6 +62,11 @@
         if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
              mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
 
+        //Write modul of save game
+        DOMElement* header = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "header");
+        XmlHelper::setAttributeValueAsString(header, "ModuleID", CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
+        XmlHelper::setAttributeValueAsInteger(header, "EngineVersion", CoreSubsystem::getSingleton().getEngineBuildNumber());
+        
         //Write date and time
         DOMElement* timeNode = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
         
@@ -78,6 +86,9 @@
 
         //Write globals
         DOMElement* globals = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
+        DOMElement* gameTime = XmlHelper::appendChildElement(mDocument, globals, "gametime");
+        TimeSource* gameTimeSource = TimeSourceManager::getSingleton().getTimeSource(TimeSource::GAMETIME);
+        XmlHelper::setAttributeValueAsInteger(gameTime, "milliseconds", gameTimeSource->getClock());
 
         //Write Quests
         DOMElement* quests = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "quests");



From timm at mail.berlios.de  Wed Sep  5 21:55:19 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Wed, 5 Sep 2007 21:55:19 +0200
Subject: [Dsa-hl-svn] r3821 - in rl/trunk/engine/ai: include src
Message-ID: <200709051955.l85JtJcA011531@sheep.berlios.de>

Author: timm
Date: 2007-09-05 21:55:17 +0200 (Wed, 05 Sep 2007)
New Revision: 3821

Modified:
   rl/trunk/engine/ai/include/Makefile.am
   rl/trunk/engine/ai/src/Makefile.am
Log:
just another update of the make files

Modified: rl/trunk/engine/ai/include/Makefile.am
===================================================================
--- rl/trunk/engine/ai/include/Makefile.am	2007-09-05 19:18:00 UTC (rev 3820)
+++ rl/trunk/engine/ai/include/Makefile.am	2007-09-05 19:55:17 UTC (rev 3821)
@@ -5,6 +5,7 @@
 	AgentDialogState.h \
 	AgentState.h \
 	AgentSteeringState.h \
+	AiMessages.h \
 	AiPrerequisites.h \
 	AiSubsystem.h \
 	AiWorld.h \

Modified: rl/trunk/engine/ai/src/Makefile.am
===================================================================
--- rl/trunk/engine/ai/src/Makefile.am	2007-09-05 19:18:00 UTC (rev 3820)
+++ rl/trunk/engine/ai/src/Makefile.am	2007-09-05 19:55:17 UTC (rev 3821)
@@ -9,6 +9,7 @@
 	AgentDialogState.cpp \
 	AgentManager.cpp \
 	AgentSteeringState.cpp \
+	AiMessages.h \
 	AiSubsystem.cpp \
 	AiWorld.cpp \
 	AStarCosts.cpp \



From timm at mail.berlios.de  Wed Sep  5 22:00:05 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Wed, 5 Sep 2007 22:00:05 +0200
Subject: [Dsa-hl-svn] r3822 - rl/trunk/engine/ai/src
Message-ID: <200709052000.l85K05Il011785@sheep.berlios.de>

Author: timm
Date: 2007-09-05 22:00:02 +0200 (Wed, 05 Sep 2007)
New Revision: 3822

Modified:
   rl/trunk/engine/ai/src/Makefile.am
Log:
h -> cpp

Modified: rl/trunk/engine/ai/src/Makefile.am
===================================================================
--- rl/trunk/engine/ai/src/Makefile.am	2007-09-05 19:55:17 UTC (rev 3821)
+++ rl/trunk/engine/ai/src/Makefile.am	2007-09-05 20:00:02 UTC (rev 3822)
@@ -9,7 +9,7 @@
 	AgentDialogState.cpp \
 	AgentManager.cpp \
 	AgentSteeringState.cpp \
-	AiMessages.h \
+	AiMessages.cpp \
 	AiSubsystem.cpp \
 	AiWorld.cpp \
 	AStarCosts.cpp \



From no22 at mail.berlios.de  Thu Sep  6 18:16:03 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Thu, 6 Sep 2007 18:16:03 +0200
Subject: [Dsa-hl-svn] r3823 - modules/common/dsa
Message-ID: <200709061616.l86GG338027114@sheep.berlios.de>

Author: no22
Date: 2007-09-06 18:16:01 +0200 (Thu, 06 Sep 2007)
New Revision: 3823

Modified:
   modules/common/dsa/basis.xdi
Log:
Ausweichtalente f?\195?\188r Gesellschafts-, Natur- und Wissenstalente hinzugef?\195?\188gt

Modified: modules/common/dsa/basis.xdi
===================================================================
--- modules/common/dsa/basis.xdi	2007-09-05 20:00:02 UTC (rev 3822)
+++ modules/common/dsa/basis.xdi	2007-09-06 16:16:01 UTC (rev 3823)
@@ -285,6 +285,7 @@
 						<Spezialisierung>V?gel</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+					<!-- todo Gaukeleien (Bauchreden) -->
 				</Talent>
 				<Talent ID="Tanzen">
 					<Probe>CH/GE/GE</Probe>
@@ -315,6 +316,7 @@
 						</Voraussetzung>
 					</Voraussetzungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
+					<!-- todo Gaukeleien (Taschenspielereien) -->
 				</Talent>
 				<Talent ID="Zechen">
 					<Probe>IN/KO/KK</Probe>
@@ -332,11 +334,27 @@
 						</Voraussetzung>
 					</Voraussetzungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="?berreden">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="?berzeugen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Galanterie">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Etikette">
 					<Probe>KL/IN/CH</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Galanterie">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Galanterie">
 					<Probe>IN/CH/FF</Probe>
@@ -347,6 +365,14 @@
 						<Spezialisierung>Liebesk?nste</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Bet?ren">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Etikette">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Gassenwissen">
 					<Probe>KL/IN/CH</Probe>
@@ -358,6 +384,11 @@
 						<Spezialisierung>Ortseinsch?tzung</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Menschenkenntnis">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Lehren">
 					<Probe>KL/IN/CH</Probe>
@@ -377,11 +408,21 @@
 						<Spezialisierung>Sprachen und Schriften</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 23</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="?berzeugen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Menschenkenntnis">
 					<Probe>KL/IN/CH</Probe>
 					<Art>Basis</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 23/24</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Heilkunde Seele">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Schauspielerei">
 					<Probe>MU/KL/CH</Probe>
@@ -409,6 +450,11 @@
 						<Spezialisierung>Trag?die</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 24</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="?berreden">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Schriftlicher Ausdruck">
 					<Probe>KL/IN/IN</Probe>
@@ -423,6 +469,12 @@
 						<Spezialisierung>Schriftsteller</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 24</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Lesen / Schreiben">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<!-- todo ?berzeugen(Rhetorik schriftl.) -->
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Sich Verkleiden">
 					<Probe>MU/CH/GE</Probe>
@@ -433,6 +485,11 @@
 						<Spezialisierung>andere Rolle</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 24</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Schauspielerei">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="?berreden">
 					<Probe>MU/IN/CH</Probe>
@@ -450,6 +507,11 @@
 						<Spezialisierung>L?gen</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 24/25</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="?berzeugen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="?berzeugen">
 					<Probe>KL/IN/CH</Probe>
@@ -466,6 +528,11 @@
 						<Spezialisierung>schriftliche Rhetorik</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 25</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="?berreden">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 			</Talentgruppe>
 			<Talentgruppe ID="Natur-Talente">
@@ -483,6 +550,11 @@
 						<Spezialisierung>Speere</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 25/26</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Wildnisleben">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Fesseln / Entfesseln">
 					<Probe>FF/GE/KK</Probe>
@@ -495,6 +567,16 @@
 						<Spezialisierung>Netze Kn?pfen</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Seiler">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Seefahrt">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<!-- todo Akrobatik (winden) nur entfesseln +5 -->
+						<!-- todo Ringen PA +10-->
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Fischen / Angeln">
 					<Probe>IN/FF/KK</Probe>
@@ -506,6 +588,11 @@
 						<Spezialisierung>Strand und Riff</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Wildnisleben">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="F?hrtensuchen">
 					<Probe>KL/IN/KO</Probe>
@@ -521,6 +608,11 @@
 						<Spezialisierung>W?ste</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 25</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Sinnensch?rfe">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Orientierung">
 					<Probe>KL/IN/IN</Probe>
@@ -537,16 +629,31 @@
 						<Spezialisierung>W?ste</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Sternkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Seefischerei">
 					<Probe>IN/FF/KK</Probe>
 					<Art>Beruf</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Fischen / Angeln">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Wettervorhersage">
 					<Probe>KL/IN/IN</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Wildnisleben">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Wildnisleben">
 					<Probe>IN/GE/KO</Probe>
@@ -562,6 +669,14 @@
 						<Spezialisierung>W?ste</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 26</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Tierkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Pflanzenkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 			</Talentgruppe>
 			<Talentgruppe ID="Wissenstalente">
@@ -574,6 +689,14 @@
 						</Voraussetzung>
 					</Voraussetzungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Heilkunde Wunden">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Heilkunde Krankheiten">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Baukunst">
 					<Probe>KL/KL/FF</Probe>
@@ -595,16 +718,36 @@
 						<Spezialisierung>Wehranlagen</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Zimmermann">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Maurer">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Steinmetz">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Brettspiel">
 					<Probe>KL/KL/IN</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+					<!-- todo Kriegskunst (Strategie) -->
+						<Ausweichtalent ID="Rechnen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
 				</Talent>
 				<Talent ID="Geographie">
 					<Probe>KL/KL/IN</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Sagen / Legenden">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Geschichtswissen">
 					<Probe>KL/KL/IN</Probe>
@@ -615,6 +758,11 @@
 						</Voraussetzung>
 					</Voraussetzungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Sagen / Legenden">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Gesteinskunde">
 					<Probe>KL/IN/FF</Probe>
@@ -625,21 +773,62 @@
 						<Spezialisierung>Edelsteine</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Baukunst">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Steinschneider">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Bergbau">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="H?ttenkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Steinmetz">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="G?tter und Kulte">
 					<Probe>KL/KL/IN</Probe>
 					<Art>Basis</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Geschichtswissen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Sagen / Legenden">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Heraldik">
 					<Probe>KL/KL/FF</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Etikette">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="H?ttenkunde">
 					<Probe>KL/IN/KO</Probe>
 					<Art>Beruf</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Alchimie">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Grobschmied">
+							<Aufschlag>15</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Metallguss">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Kriegskunst">
 					<Probe>MU/KL/CH</Probe>
@@ -654,6 +843,11 @@
 						<Spezialisierung>Drachenbek?mpfung</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Brettspiel">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Kryptographie">
 					<Probe>KL/KL/IN</Probe>
@@ -673,6 +867,14 @@
 						</Voraussetzung>
 					</Voraussetzungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Sprachenkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Rechnen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Magiekunde">
 					<Probe>KL/KL/IN</Probe>
@@ -694,6 +896,14 @@
 						<Spezialisierung>Zauberwerkstatt</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Sagen / Legenden">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="G?tter und Kulte">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Mechanik">
 					<Probe>KL/KL/FF</Probe>
@@ -717,6 +927,11 @@
 						<Spezialisierung>Windkraft</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Feinmechanik">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Pflanzenkunde">
 					<Probe>KL/IN/FF</Probe>
@@ -733,11 +948,30 @@
 						<Spezialisierung>W?ste</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 29</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Wildnisleben">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Philosophie">
 					<Probe>KL/KL/IN</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 29/30</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="G?tter und Kulte">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Magiekunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Geschichtswissen">
+							<Aufschlag>15</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Sagen / Legenden">
+							<Aufschlag>15</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Rechnen">
 					<Probe>KL/KL/IN</Probe>
@@ -758,11 +992,27 @@
 						<Spezialisierung>Strafrecht</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Etikette">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Staatskunst">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Sagen / Legenden">
 					<Probe>KL/IN/CH</Probe>
 					<Art>Basis</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Geschichtswissen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="G?tter und Kulte">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Schiffbau">
 					<Probe>KL/KL/FF</Probe>
@@ -779,6 +1029,11 @@
 						</Voraussetzung>
 					</Voraussetzungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Zimmermann">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Sch?tzen">
 					<Probe>KL/IN/IN</Probe>
@@ -789,6 +1044,15 @@
 						<Spezialisierung>Schmuck</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 30</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Handel">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Juwelier">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+						<!-- todo Feinmechanik (Goldschmied) -->
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Sprachenkunde">
 					<Probe>KL/KL/IN</Probe>
@@ -804,6 +1068,12 @@
 						<Spezialisierung>Verwaltung</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 31</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Hauswirtschaft">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+								<!-- todo Rechtskunde (Staatsrecht) -->
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Sternkunde">
 					<Probe>KL/KL/IN</Probe>
@@ -826,6 +1096,9 @@
 						<Spezialisierung>Zeitbestimmung</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 31</Beschreibung>
+					<Ausweichtalente>
+						<!-- todo Prophezeien (Astrologie) +5 -->
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Tierkunde">
 					<Probe>MU/KL/IN</Probe>
@@ -842,6 +1115,20 @@
 						<Spezialisierung>V?gel</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 31</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Viehzucht">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Seefischerei">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Reiten">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Wildnisleben">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 			</Talentgruppe>
 			<Talentgruppe ID="Handwerkliche Talente">



From no22 at mail.berlios.de  Fri Sep  7 20:12:39 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Fri, 7 Sep 2007 20:12:39 +0200
Subject: [Dsa-hl-svn] r3824 - modules/common/dsa
Message-ID: <200709071812.l87ICdA0029880@sheep.berlios.de>

Author: no22
Date: 2007-09-07 20:12:37 +0200 (Fri, 07 Sep 2007)
New Revision: 3824

Modified:
   modules/common/dsa/basis.xdi
Log:
Handwerkstalente eingetragen

Modified: modules/common/dsa/basis.xdi
===================================================================
--- modules/common/dsa/basis.xdi	2007-09-06 16:16:01 UTC (rev 3823)
+++ modules/common/dsa/basis.xdi	2007-09-07 18:12:37 UTC (rev 3824)
@@ -285,7 +285,12 @@
 						<Spezialisierung>V?gel</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-					<!-- todo Gaukeleien (Bauchreden) -->
+					<Ausweichtalente>
+						<Ausweichtalent ID="Gaukeleien">
+							<!-- todo Bauchreden -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Tanzen">
 					<Probe>CH/GE/GE</Probe>
@@ -316,7 +321,12 @@
 						</Voraussetzung>
 					</Voraussetzungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 22</Beschreibung>
-					<!-- todo Gaukeleien (Taschenspielereien) -->
+					<Ausweichtalente>
+						<Ausweichtalent ID="Gaukeleien">
+							<!-- todo Taschenspielereien -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Zechen">
 					<Probe>IN/KO/KK</Probe>
@@ -473,7 +483,10 @@
 						<Ausweichtalent ID="Lesen / Schreiben">
 							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
-						<!-- todo ?berzeugen(Rhetorik schriftl.) -->
+						<Ausweichtalent ID="?berzeugen">
+							<!-- todo Rhetorik schriftl. -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Sich Verkleiden">
@@ -574,7 +587,10 @@
 						<Ausweichtalent ID="Seefahrt">
 							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
-						<!-- todo Akrobatik (winden) nur entfesseln +5 -->
+						<Ausweichtalent ID="Akrobatik">
+							<!-- todo winden -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
 						<!-- todo Ringen PA +10-->
 					</Ausweichtalente>
 				</Talent>
@@ -734,10 +750,15 @@
 					<Probe>KL/KL/IN</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 28</Beschreibung>
-					<!-- todo Kriegskunst (Strategie) -->
+					<Ausweichtalente>
+					<Ausweichtalent ID="Kriegskunst">
+						<!-- todo Strategie -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
 						<Ausweichtalent ID="Rechnen">
 							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Geographie">
 					<Probe>KL/KL/IN</Probe>
@@ -1051,7 +1072,10 @@
 						<Ausweichtalent ID="Juwelier">
 							<Aufschlag>5</Aufschlag>
 						</Ausweichtalent>
-						<!-- todo Feinmechanik (Goldschmied) -->
+						<Ausweichtalent ID="Feinmechanik">
+							<!-- todo Goldschmied -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Sprachenkunde">
@@ -1072,7 +1096,10 @@
 						<Ausweichtalent ID="Hauswirtschaft">
 							<Aufschlag>10</Aufschlag>
 						</Ausweichtalent>
-								<!-- todo Rechtskunde (Staatsrecht) -->
+								<Ausweichtalent ID="Rechtskunde">
+									<!-- todo Staatsrecht -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
 					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Sternkunde">
@@ -1147,11 +1174,30 @@
 						<Spezialisierung>Zureiter</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 33/34</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Viehzucht">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Tierkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Reiten">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Ackerbau">
 					<Probe>IN/FF/KO</Probe>
 					<Art>Beruf</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Viehzucht">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Pflanzenkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Alchimie">
 					<Probe>MU/KL/FF</Probe>
@@ -1176,6 +1222,15 @@
 						<Spezialisierung>Goldmacherei</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Kochen">
+							<!-- todo Tr?nke -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Pflanzenkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Bergbau">
 					<Probe>IN/KO/KK</Probe>
@@ -1193,6 +1248,20 @@
 						<Spezialisierung>unterirdische St?dte</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Steinmetz">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Maurer">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Baukunst">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Gesteinskunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Bogenbau">
 					<Probe>KL/IN/FF</Probe>
@@ -1209,6 +1278,17 @@
 						<Spezialisierung>Torsionswaffen</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Holzbearbeitung">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Feinmechanik">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Grobschmied">
+							<Aufschlag>15</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Boote Fahren">
 					<Probe>GE/KO/KK</Probe>
@@ -1220,11 +1300,24 @@
 						<Spezialisierung>Ruderboote Rudern</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Seefahrt">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Fahrzeug Lenken">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Brauer">
 					<Probe>KL/FF/KK</Probe>
 					<Art>Beruf</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Alchimie">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Drucker">
 					<Probe>KL/FF/KO</Probe>
@@ -1247,11 +1340,24 @@
 						<Spezialisierung>Typographie</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 34</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Mechanik">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Eissegler Fahren">
 					<Probe>IN/GE/KK</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 34/35</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Boote Fahren">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Fahrzeug Lenken">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Fahrzeug Lenken">
 					<Probe>IN/CH/FF</Probe>
@@ -1262,6 +1368,11 @@
 						<Spezialisierung>Zuggespanne</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Hundeschlitten Fahren">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Falschspiel">
 					<Probe>MU/CH/FF</Probe>
@@ -1276,6 +1387,12 @@
 						<Spezialisierung>Karten</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Gaukeleien">
+							<!-- Taschenspielereien -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Feinmechanik">
 					<Probe>KL/FF/FF</Probe>
@@ -1299,6 +1416,11 @@
 					<Probe>KL/FF/FF</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Steinmetz">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Fleischer">
 					<Probe>KL/FF/KK</Probe>
@@ -1310,6 +1432,27 @@
 						<Spezialisierung>S?ugetiere</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Viehzucht">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Fischen / Angeln">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Tierkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Kochen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Anatomie">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Gerber / K?rschner">
+							<!-- todo Troph?en -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Gerber / K?rschner">
 					<Probe>KL/FF/KO</Probe>
@@ -1320,6 +1463,14 @@
 						<Spezialisierung>Troph?en</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Alchimie">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Fleischer">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Glaskunst">
 					<Probe>FF/FF/KO</Probe>
@@ -1331,6 +1482,11 @@
 						<Spezialisierung>Spiegel</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Juwelier">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Grobschmied">
 					<Probe>FF/KK/KO</Probe>
@@ -1344,6 +1500,11 @@
 						<Spezialisierung>Waffenschmied</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 35</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Metallguss">
+							<Aufschlag>15</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Handel">
 					<Probe>KL/IN/CH</Probe>
@@ -1354,6 +1515,17 @@
 						</Voraussetzung>
 					</Voraussetzungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 35/36</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Hauswirtschaft">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Geographie">
+							<Aufschlag>15</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Sch?tzen">
+							<Aufschlag>15</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Hauswirtschaft">
 					<Probe>IN/CH/FF</Probe>
@@ -1364,21 +1536,57 @@
 						<Spezialisierung>Vorratshaltung</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 36</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Rechnen">
+							<!-- todo Buchf?hrung -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Galanterie">
+							<!-- todo Festgestaltung -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Heilkunde Gift">
 					<Probe>MU/KL/IN</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 36</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Alchimie">
+							<!-- todo Gifte -->
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Heilkunde Krankheiten">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Kochen">
+							<!-- (Tr?nke) -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Heilkunde Krankheiten">
 					<Probe>MU/KL/CH</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 36</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Heilkunde Gift">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Heilkunde Seele">
 					<Probe>IN/CH/CH</Probe>
 					<Art>Beruf</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 36/37</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Menschenkenntnis">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="?berzeugen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Heilkunde Wunden">
 					<Probe>KL/CH/FF</Probe>
@@ -1390,6 +1598,11 @@
 						<Spezialisierung>Zahnleiden</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 37</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Anatomie">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Holzbearbeitung">
 					<Probe>KL/FF/KK</Probe>
@@ -1403,11 +1616,25 @@
 						<Spezialisierung>Schnitzen</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Zimmermann">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Hundeschlitten Fahren">
 					<Probe>CH/FF/GE</Probe>
 					<Art>Spezial</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Fahrzeug Lenken">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Abrichten">
+							<!-- todo Hundef?hrer -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Instrumentenbauer">
 					<Probe>KL/IN/FF</Probe>
@@ -1430,6 +1657,14 @@
 						<Spezialisierung>Trommeln</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Holzbearbeitung">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Feinmechanik">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Kapellmeister">
 					<Probe>KL/IN/CH</Probe>
@@ -1447,6 +1682,11 @@
 						<Spezialisierung>Komponieren</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Musizieren">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Kartographie">
 					<Probe>KL/KL/FF</Probe>
@@ -1464,6 +1704,14 @@
 						<Spezialisierung>Stadt</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Orientierung">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Sternkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Kochen">
 					<Probe>KL/IN/FF</Probe>
@@ -1477,11 +1725,30 @@
 						<Spezialisierung>Vorkoster</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Fleischer">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Fischen / Angeln">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Wildnisleben">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Alchimie">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Kristallzucht">
 					<Probe>KL/IN/FF</Probe>
 					<Art>Beruf</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 38</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Alchimie">
+							<Aufschlag>15</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Lederarbeiten">
 					<Probe>KL/FF/FF</Probe>
@@ -1494,6 +1761,14 @@
 						<Spezialisierung>Schuhwerk</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 38/39</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Gerber / K?rschner">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Schneidern">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Malen / Zeichnen">
 					<Probe>KL/IN/FF</Probe>
@@ -1505,6 +1780,18 @@
 						<Spezialisierung>technische Skizze</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Kartographie">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Steinmetz">
+							<!-- todo Bildhauer -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="T?towieren">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Maurer">
 					<Probe>FF/GE/KK</Probe>
@@ -1515,6 +1802,11 @@
 						<Spezialisierung>Ziegelbau</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Baukunst">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Metallguss">
 					<Probe>KL/FF/KK</Probe>
@@ -1530,6 +1822,14 @@
 						<Spezialisierung>Reliefplatten und Statuen</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="H?ttenkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Grobschmied">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Musizieren">
 					<Probe>IN/CH/FF</Probe>
@@ -1553,6 +1853,11 @@
 						<Spezialisierung>Schl?sser</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Feinmechanik">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Schnaps Brennen">
 					<Probe>KL/IN/FF</Probe>
@@ -1565,6 +1870,17 @@
 						<Spezialisierung>Lagerung</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Alchimie">
+							<Aufschlag>5</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Brauer">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Winzer">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Schneidern">
 					<Probe>KL/FF/FF</Probe>
@@ -1575,6 +1891,14 @@
 						<Spezialisierung>Tuchr?stung</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Webkunst">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Lederarbeiten">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Seefahrt">
 					<Probe>FF/GE/KK</Probe>
@@ -1584,11 +1908,25 @@
 						<Spezialisierung>Segelschiff</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 39</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Boote Fahren">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Steuermann">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Seiler">
 					<Probe>FF/FF/KK</Probe>
 					<Art>Beruf</Art>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 39/40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Fesseln / Entfesseln">
+							<!-- todo Taue splei?en -->
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Steinmetz">
 					<Probe>FF/FF/KK</Probe>
@@ -1604,6 +1942,17 @@
 						<Spezialisierung>Statuen</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Baukunst">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Maurer">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Bergbau">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Steinschneider / Juwelier">
 					<Probe>IN/FF/FF</Probe>
@@ -1614,6 +1963,14 @@
 						</Voraussetzung>
 					</Voraussetzungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Feinmechanik">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Kristallzucht">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Stellmacher">
 					<Probe>KL/FF/KK</Probe>
@@ -1635,6 +1992,14 @@
 						<Spezialisierung>Streitwagen</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Zimmermann">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Schiffbau">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Steuermann">
 					<Probe>IN/CH/KK</Probe>
@@ -1649,6 +2014,11 @@
 						<Spezialisierung>Segelschiff</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Seefahrt">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Stoffe F?rben">
 					<Probe>KL/FF/KK</Probe>
@@ -1661,6 +2031,12 @@
 						<Spezialisierung>Stoffdruck</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Alchimie">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<!-- "eventuell Drucker f?r Stoffdrucke" -->
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="T?towieren">
 					<Probe>IN/FF/FF</Probe>
@@ -1676,6 +2052,11 @@
 						<Spezialisierung>Zaubert?towierungen</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Malen / Zeichnen">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="T?pfern">
 					<Probe>KL/FF/FF</Probe>
@@ -1686,6 +2067,14 @@
 						<Spezialisierung>Ziegelei</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Maurer">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Steinmetz">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Viehzucht">
 					<Probe>KL/IN/KK</Probe>
@@ -1698,6 +2087,11 @@
 						<Spezialisierung>Hund</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Tierkunde">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Webkunst">
 					<Probe>FF/FF/KK</Probe>
@@ -1710,6 +2104,11 @@
 						<Spezialisierung>Weben</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Schneidern">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 				<Talent ID="Winzer">
 					<Probe>KL/FF/KK</Probe>
@@ -1736,6 +2135,14 @@
 						<Spezialisierung>Schiffszimmermann</Spezialisierung>
 					</Spezialisierungen>
 					<Beschreibung>siehe Mit Flinken Fingern, S. 40</Beschreibung>
+					<Ausweichtalente>
+						<Ausweichtalent ID="Holzbearbeitung">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+						<Ausweichtalent ID="Schiffbau">
+							<Aufschlag>10</Aufschlag>
+						</Ausweichtalent>
+					</Ausweichtalente>
 				</Talent>
 			</Talentgruppe>
 			<Talentgruppe ID="Sprachen &amp; Schriften">



From blakharaz at mail.berlios.de  Sat Sep  8 22:22:54 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:22:54 +0200
Subject: [Dsa-hl-svn] r3825 - in rl/trunk/engine: ai/include ai/src
	common/include common/src core/include core/src rules/include
	rules/src script/include script/src ui/include ui/src
Message-ID: <200709082022.l88KMsiq004857@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:22:19 +0200 (Sat, 08 Sep 2007)
New Revision: 3825

Modified:
   rl/trunk/engine/ai/include/AgentManager.h
   rl/trunk/engine/ai/include/AiSubsystem.h
   rl/trunk/engine/ai/include/AimlNodeImplRl.h
   rl/trunk/engine/ai/include/WayPointGraph.h
   rl/trunk/engine/ai/src/AiSubsystem.cpp
   rl/trunk/engine/ai/src/AimlNodeImplRl.cpp
   rl/trunk/engine/ai/src/DialogResponse.cpp
   rl/trunk/engine/common/include/Exception.h
   rl/trunk/engine/common/include/PropertyReader.h
   rl/trunk/engine/common/include/PropertyWriter.h
   rl/trunk/engine/common/include/XmlErrorHandler.h
   rl/trunk/engine/common/include/XmlHelper.h
   rl/trunk/engine/common/include/XmlResource.h
   rl/trunk/engine/common/src/PropertyReader.cpp
   rl/trunk/engine/common/src/PropertyWriter.cpp
   rl/trunk/engine/common/src/XmlErrorHandler.cpp
   rl/trunk/engine/common/src/XmlHelper.cpp
   rl/trunk/engine/common/src/XmlResource.cpp
   rl/trunk/engine/common/src/XmlResourceManager.cpp
   rl/trunk/engine/core/include/DotSceneLoader.h
   rl/trunk/engine/core/src/CoreSubsystem.cpp
   rl/trunk/engine/core/src/DotSceneLoader.cpp
   rl/trunk/engine/core/src/DotSceneOctreeWorld.cpp
   rl/trunk/engine/rules/include/DsaDataLoader.h
   rl/trunk/engine/rules/include/SaveGameFileWriter.h
   rl/trunk/engine/rules/src/DsaDataLoader.cpp
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
   rl/trunk/engine/script/include/AbstractMapNodeProcessor.h
   rl/trunk/engine/script/include/MapLoader.h
   rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp
   rl/trunk/engine/script/src/EntityNodeProcessor.cpp
   rl/trunk/engine/script/src/EnvironmentProcessor.cpp
   rl/trunk/engine/script/src/GameObjectNodeProcessor.cpp
   rl/trunk/engine/script/src/LightNodeProcessor.cpp
   rl/trunk/engine/script/src/MapLoader.cpp
   rl/trunk/engine/script/src/ParticleSystemNodeProcessor.cpp
   rl/trunk/engine/script/src/SoundNodeProcessor.cpp
   rl/trunk/engine/script/src/WaypointProcessor.cpp
   rl/trunk/engine/script/src/ZoneProcessor.cpp
   rl/trunk/engine/ui/include/InputManager.h
   rl/trunk/engine/ui/src/InputManager.cpp
Log:
Replace XmlHelper static method usage with implementation inheritance

Modified: rl/trunk/engine/ai/include/AgentManager.h
===================================================================
--- rl/trunk/engine/ai/include/AgentManager.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/include/AgentManager.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -43,7 +43,7 @@
 
 	/** Executes AI during game as a RL::GameTask.
 	 * Each registered Agent gets executed once per gametask in order
-	 * to do its ai stuff (path finding, movement, decission making).
+	 * to do its ai stuff (path finding, movement, decision making).
 	 */
 	class _RlAiExport AgentManager
 		: public Ogre::Singleton<AgentManager>,

Modified: rl/trunk/engine/ai/include/AiSubsystem.h
===================================================================
--- rl/trunk/engine/ai/include/AiSubsystem.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/include/AiSubsystem.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -21,6 +21,7 @@
 #include "AiPrerequisites.h"
 
 #include "MessagePump.h"
+#include "XmlHelper.h"
 #include "World.h"
 
 namespace MadaBot
@@ -43,7 +44,9 @@
 	/** Central core of AI
 	 * Handles creation of all AI related object Managers.
 	 */
-	class _RlAiExport AiSubsystem : public Ogre::Singleton<AiSubsystem>
+	class _RlAiExport AiSubsystem 
+        : public Ogre::Singleton<AiSubsystem>,
+        private XmlProcessor
 	{
 	public:
 		//! default constructor

Modified: rl/trunk/engine/ai/include/AimlNodeImplRl.h
===================================================================
--- rl/trunk/engine/ai/include/AimlNodeImplRl.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/include/AimlNodeImplRl.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -19,6 +19,8 @@
 #include "AiPrerequisites.h"
 #include "AimlNode.h"
 
+#include "XmlHelper.h"
+
 using namespace MadaBot;
 namespace rl
 {
@@ -28,7 +30,9 @@
     /**
      * Implementation of the XmlNode interface for AIML files in Rastullahs Lockenpracht
      */
-	class AimlNodeImplRl :	public AimlNode<CeGuiString>
+	class AimlNodeImplRl 
+        :   public AimlNode<CeGuiString>,
+            private XmlProcessor
 	{
 	public:
 		AimlNodeImplRl(DOMNode* node);

Modified: rl/trunk/engine/ai/include/WayPointGraph.h
===================================================================
--- rl/trunk/engine/ai/include/WayPointGraph.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/include/WayPointGraph.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,11 +17,11 @@
 #define __RlAI_WayPointGraph_H__
 
 #include "AiPrerequisites.h"
+
+#include "DebugVisualisable.h"
 #include "WayPointNode.h"
-#include "DebugVisualisable.h"
-#include "OgreVector3.h"
+#include "XmlHelper.h"
 
-
 namespace rl
 {
 
@@ -32,7 +32,8 @@
 	 */
 	//template <class NodeType>
 	class _RlAiExport WayPointGraph 
-		: public DebugVisualisable
+		: public DebugVisualisable,
+        private XmlProcessor
 	{
 	public:
 		//! defines a list of waypoint nodes
@@ -77,7 +78,8 @@
 		 * configuration module in oder to fetch the module directory path.
 		 * @param filename of the file to load.
 		 */
-		void load (const Ogre::String& filename);
+		void loadBinary(const Ogre::String& filename);
+
 		/** saves the Waypoints to a file.
 		 * Structure of the file is as follows:
 		 * Header\n
@@ -99,8 +101,15 @@
 		 *
 		 * @param filename of the file to save to.
 		 */
-		void save (const Ogre::String& filename) const;
+		void saveBinary(const Ogre::String& filename) const;
 
+        /** loads the Waypoints from an xml file.
+		 * The Load functionality uses the module path querying of the
+		 * configuration module in oder to fetch the module directory path.
+		 * @param filename of the file to load.
+		 */
+		void load(const Ogre::String& filename, const Ogre::String& resourceGroup = "");
+
 		/** retrieves the nearest WayPoint for the given position
 		 * @param position in world space whose nearest waypoint has to be found.
 		 * @returns WayPointNode pointer to a waypoint object

Modified: rl/trunk/engine/ai/src/AiSubsystem.cpp
===================================================================
--- rl/trunk/engine/ai/src/AiSubsystem.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/src/AiSubsystem.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -111,20 +111,19 @@
 	mCore->setParser(new AimlParserImplRl());
 	mCore->getBotInterpreter().addProcessor(new DialogScriptProcessor());
 	mCore->getAimlInterpreter().addProcessor(new ScriptProcessor());
-//  Initialize Xerces if this wasn't done already
-	try
-	{
-        XMLPlatformUtils::Initialize();
-		XmlHelper::initializeTranscoder();
-    }
-    catch (const XMLException& exc)
-	{
-		char* excmsg = XMLString::transcode(exc.getMessage());
-		std::string excs="Exception while initializing Xerces: ";
-		excs+=excmsg;
-		LOG_MESSAGE(Logger::DIALOG, excs);
-        XMLString::release(&excmsg);
-    }
+////  Initialize Xerces if this wasn't done already
+//	try
+//	{
+//        
+//    }
+//    catch (const XMLException& exc)
+//	{
+//		char* excmsg = XMLString::transcode(exc.getMessage());
+//		std::string excs="Exception while initializing Xerces: ";
+//		excs+=excmsg;
+//		LOG_MESSAGE(Logger::DIALOG, excs);
+//        XMLString::release(&excmsg);
+//    }
 }
 
 bool AiSubsystem::onBeforeClearScene()

Modified: rl/trunk/engine/ai/src/AimlNodeImplRl.cpp
===================================================================
--- rl/trunk/engine/ai/src/AimlNodeImplRl.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/src/AimlNodeImplRl.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -27,11 +27,11 @@
 
 AimlNodeImplRl::AimlNodeImplRl(DOMNode* pNode)
 {
-	mNodeName  = XmlHelper::transcodeToString(pNode->getLocalName());
+	mNodeName  = transcodeToString(pNode->getLocalName());
 	// #text or #comment have no local name, use NodeName for them
 	if(mNodeName.empty())
 	{
-		mNodeName  = XmlHelper::transcodeToString(pNode->getNodeName());
+		mNodeName  = transcodeToString(pNode->getNodeName());
 	}
 	mNodeName.c_str();
 
@@ -40,12 +40,12 @@
 	{
 		XMLCh* tmp = XMLString::replicate(pNode->getNodeValue());
 		XMLString::collapseWS(tmp);
-		mNodeValue = XmlHelper::transcodeToString(tmp);
+		mNodeValue = transcodeToString(tmp);
 		XMLString::release(&tmp);
 	}
 	else
 	{
-		mNodeValue = XmlHelper::transcodeToString(pNode->getNodeValue());
+		mNodeValue = transcodeToString(pNode->getNodeValue());
 	}
 	mNodeValue.c_str();
 	// mpa attributes
@@ -55,9 +55,9 @@
 		for(unsigned int i = 0; i < attributes->getLength(); ++i)
 		{
 			CeGuiString attributeName  =
-				XmlHelper::transcodeToString(attributes->item(i)->getNodeName());
+				transcodeToString(attributes->item(i)->getNodeName());
 			CeGuiString attributeValue =
-				XmlHelper::transcodeToString(attributes->item(i)->getNodeValue());
+				transcodeToString(attributes->item(i)->getNodeValue());
 			mAttributes.insert(Attributes::value_type(attributeName, attributeValue));
 		}
 	}

Modified: rl/trunk/engine/ai/src/DialogResponse.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogResponse.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ai/src/DialogResponse.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -15,19 +15,9 @@
  */
 #include "stdinc.h" //precompiled header
 
-#include <xercesc/parsers/XercesDOMParser.hpp>
-#include <xercesc/framework/MemBufInputSource.hpp>
-#include <xercesc/dom/DOM.hpp>
-
-#include <CEGUIPropertyHelper.h>
-
-#include "XmlHelper.h"
-//#include "AimlProcessorManager.h"
-//#include "AimlProcessor.h"
 #include "DialogResponse.h"
 #include "DialogOption.h"
 
-
 namespace rl
 {
 	DialogResponse::DialogResponse( const CeGuiString& input,

Modified: rl/trunk/engine/common/include/Exception.h
===================================================================
--- rl/trunk/engine/common/include/Exception.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/Exception.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -108,14 +108,17 @@
 
    public:
       Exception(const std::string& message,
-         const std::string& file, const std::string& function, int line) :
-      mMessage(message), mFile(file), mFunction(function), mLine(line) {}
+         const std::string& file, const std::string& function, int line)
+         : mMessage(message), mFile(file), mFunction(function), mLine(line), 
+         std::exception(message.c_str()) {}
       
-      Exception(const Exception& rhs) :
+      Exception(const Exception& rhs) 
+          :
          mMessage(rhs.mMessage),
          mFile(rhs.mFile),
          mFunction(rhs.mFunction),
-         mLine(rhs.mLine) {}
+         mLine(rhs.mLine),
+         std::exception(rhs.mMessage.c_str()) {}
 
       virtual ~Exception() throw() {}
 

Modified: rl/trunk/engine/common/include/PropertyReader.h
===================================================================
--- rl/trunk/engine/common/include/PropertyReader.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/PropertyReader.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -23,6 +23,8 @@
 #include <xercesc/dom/DOMElement.hpp>
 #include <OgreDataStream.h>
 
+#include "XmlHelper.h"
+
 namespace rl 
 {
     class Property;
@@ -31,6 +33,7 @@
     typedef std::pair<Ogre::String, Property> PropertyEntry;
 
     class _RlCommonExport XmlPropertyReader
+         : protected XmlProcessor
     {
     public:
         XmlPropertyReader();

Modified: rl/trunk/engine/common/include/PropertyWriter.h
===================================================================
--- rl/trunk/engine/common/include/PropertyWriter.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/PropertyWriter.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -25,6 +25,7 @@
 #include <OgreDataStream.h>
 
 #include "Property.h"
+#include "XmlHelper.h"
 
 namespace rl 
 {
@@ -34,9 +35,11 @@
     typedef std::pair<Ogre::String, Property> PropertyEntry;
 
     class _RlCommonExport XmlPropertyWriter
+        : protected XmlProcessor
     {
     public:
         XmlPropertyWriter();
+        virtual ~XmlPropertyWriter();
 
         std::vector<PropertySet*> getPropertySets();
         void setPropertySets(std::vector<PropertySet*> sets);

Modified: rl/trunk/engine/common/include/XmlErrorHandler.h
===================================================================
--- rl/trunk/engine/common/include/XmlErrorHandler.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/XmlErrorHandler.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -18,12 +18,15 @@
 #include <string>
 #include <xercesc/sax/ErrorHandler.hpp>
 #include "CommonPrerequisites.h"
+#include "XmlHelper.h"
 
-class XERCES_CPP_NAMESPACE::SAXParseException;
 
+
 namespace rl
 {
-    class _RlCommonExport XmlErrorHandler : public XERCES_CPP_NAMESPACE::ErrorHandler
+    /*class _RlCommonExport XmlErrorHandler 
+        :   public XERCES_CPP_NAMESPACE::ErrorHandler,
+            private XmlProcessor
     {
     public:
         XmlErrorHandler(void);
@@ -40,6 +43,6 @@
                               const XERCES_CPP_NAMESPACE::SAXParseException& exc ) const;
         
         std::string mFileName;
-    };
+    };*/
 }
 #endif

Modified: rl/trunk/engine/common/include/XmlHelper.h
===================================================================
--- rl/trunk/engine/common/include/XmlHelper.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/XmlHelper.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,13 +17,17 @@
 #ifndef __XmlHelper_h__
 #define __XmlHelper_h__
 
+#include <OgreDataStream.h>
+
 #include <xercesc/dom/DOMElement.hpp>
 #include <xercesc/util/XMLChar.hpp>
 #include <xercesc/util/TransService.hpp>
+#include <xercesc/sax/ErrorHandler.hpp>
 #include <xercesc/sax2/Attributes.hpp>
 
+class XERCES_CPP_NAMESPACE::SAXParseException;
+
 #include "CommonPrerequisites.h"
-#include "XmlErrorHandler.h"
 
 #include "Tripel.h"
 
@@ -45,12 +49,12 @@
 
 namespace rl {
 
-    class XmlErrorHandler;
 /**
- * Diese Klasse bietet Helferfunktionen, um XML einfacher verarbeiten zu k?nnen
- * Alle Methoden sind statisch, es muss also keine Instanz dieser Klasse gebildet werden
+ * This class offers helper methods for XML processing
+ * To use this method, just privately inherit this class 
  */
-class _RlCommonExport XmlHelper
+class _RlCommonExport XmlProcessor
+    : public XERCES_CPP_NAMESPACE::ErrorHandler
 {
 public:
     
@@ -64,8 +68,8 @@
 	 *
 	 * @return Der Kindknoten
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* appendChildElement(XERCES_CPP_NAMESPACE::DOMDocument* doc, 
-        XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name);
+    XERCES_CPP_NAMESPACE::DOMElement* appendChildElement(XERCES_CPP_NAMESPACE::DOMDocument* doc, 
+        XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name) const;
 
     /**
 	 * Ermittelt einen Kindknoten eines DOM-Elements, das einen bestimmten Namen hat, 
@@ -76,7 +80,7 @@
 	 *
 	 * @return Der Kindknoten
 	 */
-	static XERCES_CPP_NAMESPACE::DOMElement* getChildNamed(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name);
+	XERCES_CPP_NAMESPACE::DOMElement* getChildNamed(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name) const;
 	
     /**
 	 * Setzt den Text eines Elementknotens
@@ -85,7 +89,7 @@
      * @param string Der zu setzende String
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsString(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, const CeGuiString &value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsString(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, const CeGuiString &value) const;
     
     /**
 	 * Ermittelt den Text eines Elementknotens
@@ -93,7 +97,7 @@
 	 * @param element Das DOM-Element
 	 * @return Text innerhalb der Element-Tags, als CeGuiString
 	 */
-	static CeGuiString getValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element);
+	CeGuiString getValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 	
     /**
 	 * Ermittelt den Text eines Elementknotens
@@ -101,7 +105,7 @@
 	 * @param element Das DOM-Element
 	 * @return Text innerhalb der Element-Tags, als CeGuiString
 	 */
-    static std::string getValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element);
+    std::string getValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
 	 * Setzt den Text eines Elementknotens, als UTF-8
@@ -111,7 +115,7 @@
      * @param utf Der zu setzende UTF String
 	 * @return Das DOM-Element
 	 */
-	static XERCES_CPP_NAMESPACE::DOMElement* setValueAsUtf8(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, utf8* value);
+	XERCES_CPP_NAMESPACE::DOMElement* setValueAsUtf8(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, utf8* value) const;
     
     /**
 	 * Ermittelt den Text eines Elementknotens, als UTF-8
@@ -121,7 +125,7 @@
 	 * @return Text innerhalb der Element-Tags, als utf8* (muss selbst gel?scht werden)
 	 * @see initializeTranscoder()
 	 */
-	static utf8* getValueAsUtf8(XERCES_CPP_NAMESPACE::DOMElement* element);
+	utf8* getValueAsUtf8(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
 	/**
 	 * Formt eine Ganzzahl in einen String um und setzt diesen als Wert
@@ -130,7 +134,7 @@
      * @param value Der zu setzende Integer
 	 * @return Das DOM-Element
 	 */
-	static XERCES_CPP_NAMESPACE::DOMElement* setValueAsInteger(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, int value);
+	XERCES_CPP_NAMESPACE::DOMElement* setValueAsInteger(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, int value) const;
 
     
     /**
@@ -140,7 +144,7 @@
 	 * @param element Das DOM-Element
 	 * @return Zahl, die innerhalb der Element-Tags steht
 	 */
-	static int getValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element);
+	int getValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
 	 * Ermittelt den Text eines Elementknotens und parst ihn, 
@@ -149,7 +153,7 @@
 	 * @param element Das DOM-Element
 	 * @return Zahl, die innerhalb der Element-Tags steht
 	 */
-    static Ogre::Real getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element);
+    Ogre::Real getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
 	 * Formt einen Ganzzahldubel in einen String um und setzt diesen als Wert
@@ -158,7 +162,7 @@
      * @param value Das zu setzende IntegerPair
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, IntPair value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, IntPair value) const;
 
     /**
 	 * Ermittelt den Text eines Elementknotens und parst ihn, 
@@ -167,7 +171,7 @@
 	 * @param element Das DOM-Element
 	 * @return Zahl, die innerhalb der Element-Tags steht
 	 */
-    static IntPair getValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element);
+    IntPair getValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
 	 * Formt einen Ganzzahltripel in einen String um und setzt diesen als Wert
@@ -176,7 +180,7 @@
      * @param value Der zu setzende Tripel<int>
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, Tripel<int> value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, Tripel<int> value) const;
 
     /**
 	 * Ermittelt den Text eines Elementknotens und parst ihn, 
@@ -185,7 +189,7 @@
 	 * @param element Das DOM-Element
 	 * @return Zahl, die innerhalb der Element-Tags steht
 	 */
-    static Tripel<int> getValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element);
+    Tripel<int> getValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 	
     /**
      * Convert a vector3 to an xml tag
@@ -194,7 +198,7 @@
      * @param value The vector input
 	 * @return The DOM element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Vector3 value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Vector3 value) const;
 
     /**
 	 * Processes an element node of shape <any_node_name x="0" y="0" z="0"/>
@@ -203,7 +207,7 @@
 	 * @param element The DOM element
 	 * @return the vector
 	 */
-	static Ogre::Vector3 getValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element);
+	Ogre::Vector3 getValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
     /**
      * Convert a quaternion to an xml tag
@@ -212,7 +216,7 @@
      * @param value The quaternion input
 	 * @return The DOM element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Quaternion value);
+    XERCES_CPP_NAMESPACE::DOMElement* setValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Quaternion value) const;
 
     /**
 	 * Processes an element node of shape <any_node_name x="0" y="0" z="0" w="1"/>
@@ -221,7 +225,7 @@
 	 * @param element The DOM element
 	 * @return the quaternion
 	 */
-    static Ogre::Quaternion getValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element);
+    Ogre::Quaternion getValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element) const;
 
 	
     /**
@@ -231,7 +235,7 @@
 	 * @param name Name des Attributes
 	 * @return <code>true</code>, wenn das Attribut an diesem Element existiert, sonst <code>false</code>
 	 */
-	static bool hasAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	bool hasAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Setzt den Wert von einem Attribut eines Elementes
@@ -241,7 +245,7 @@
      * @param value Wert der gesetzt werden muss
 	 * @return <code>true</code>, wenn das Attribut an diesem Element existiert, sonst <code>false</code>
 	 */
-    static void setAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const char* const value);
+    void setAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const char* const value) const;
 
     /**
 	 * Checks whether a DOMNode has a certain name
@@ -250,7 +254,7 @@
 	 * @param name the name to check
 	 * @return <code>true</code>, if the DOM node the name <code>name</code>, <code>false</code> otherwise
 	 */
-	static bool hasNodeName(XERCES_CPP_NAMESPACE::DOMNode* node, const char* const name);
+	bool hasNodeName(XERCES_CPP_NAMESPACE::DOMNode* node, const char* const name) const;
 
     
     /**
@@ -261,7 +265,7 @@
      * @param value das zu setzende Integer
 	 * @return Das DOM-Element
 	 */
-	static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, int value);
+	XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, int value) const;
 
     /**
 	 * Ermittelt den Text eines DOMElement-Attributes und parst ihn, 
@@ -271,7 +275,7 @@
 	 * @param name Name des Attributes
      * @return Zahlenwert des Attributes
 	 */
-	static int getAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	int getAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Wandelt eine Ganzzahldubel in einen Text um und setzt diesen als Attribut 
@@ -281,7 +285,7 @@
      * @param value das zu setzende IntegerPair
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, IntPair value);
+    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, IntPair value) const;
 
     /**
 	 * Ermittelt den Text eines DOMElement-Attributes und parst ihn, 
@@ -291,7 +295,7 @@
 	 * @param name Name des Attributes
      * @return Zahlendubel des Attributes
 	 */
-    static IntPair getAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+    IntPair getAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Wandelt eine Ganzzahltripel in einen Text um und setzt diesen als Attribut 
@@ -301,7 +305,7 @@
      * @param value das zu setzende Tripel<int>
 	 * @return Das DOM-Element
 	 */
-    static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Tripel<int> value);
+    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Tripel<int> value) const;
 
     /**
 	 * Ermittelt den Text eines DOMElement-Attributes und parst ihn, 
@@ -311,7 +315,7 @@
 	 * @param name Name des Attributes
      * @return Zahlendubel des Attributes
 	 */
-    static Tripel<int> getAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+    Tripel<int> getAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 	
 	/**
 	 * Setzt den Text eines DOMElement-Attributes
@@ -321,7 +325,7 @@
 	 * @param value das zu setzende CeGuiString
 	 * @return Das DOM-Element
 	 */	
-	static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const CeGuiString &value);
+	XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const CeGuiString &value) const;
     
     /**
 	 * Ermittelt den Text eines DOMElement-Attributes und konvertiert ihn zu einem CeGuiString
@@ -330,7 +334,7 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als CeGuiString
 	 */	
-	static CeGuiString getAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	CeGuiString getAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Setzt den Text eines DOMElement-Attributes
@@ -340,7 +344,7 @@
 	 * @param value der zu setzende std::string
 	 * @return Das DOM-Element
 	 */	
-    static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const std::string &value);
+    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const std::string &value) const;
 
 	/**
 	 * Ermittelt den Text eines DOMElement-Attributes und konvertiert ihn zu einem std::string
@@ -349,7 +353,7 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als std::string
 	 */	
-    static std::string getAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+    std::string getAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 	
     /**
 	 * Ermittelt den Text eines SAX Element-Attributes und konvertiert ihn zu einem CeGuiString
@@ -358,7 +362,7 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als CeGuiString
 	 */
-	static CeGuiString getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes& attributes, const char* const name);
+	CeGuiString getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes& attributes, const char* const name) const;
 
     /**
 	 * Setzt den Text eines DOMElement-Attributes
@@ -368,7 +372,7 @@
 	 * @param value der zu setzende boolean
 	 * @return Das DOM-Element
 	 */	
-	static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, bool value);
+	XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, bool value) const;
 
 	/**
 	 * Ermittelt den Text eines DOMElement-Attributes und interpretier ihn als bool
@@ -377,7 +381,7 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als bool
 	 */	
-	static bool getAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	bool getAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
     /**
 	 * Setzt den Text eines DOMElement-Attributes
@@ -387,7 +391,7 @@
 	 * @param value der zu setzende Real Wert
 	 * @return Das DOM-Element
 	 */	
-    static XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Ogre::Real value);
+    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Ogre::Real value) const;
 
 	/**
 	 * Ermittelt den Text eines DOMElement-Attributes und konvertiert ihn zu Ogre::Real
@@ -396,14 +400,14 @@
 	 * @param name Name des Attributes
 	 * @return Konvertierter Text als Ogre::Real
 	 */	
-	static Ogre::Real getAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name);
+	Ogre::Real getAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
 
 
 	/**
 	 * Initialisiert den XML<->UTF-8 Transcoder, 
 	 * davor muss XMLPlatformUtils::Initialize() aufgerufen worden sein
 	 */
-	static void initializeTranscoder();
+	void initializeTranscoder();
 
 	/**
 	 * Konvertiert einen Xerces-XMLCh* in eine CeGuiString
@@ -413,19 +417,33 @@
 	 * 
 	 * @param string16 Der zu konvertierende Xerces-XMLCh*
 	 * @return Konvertierter Text als CeGuiString
-	 * @see transcodeToUtf8(const XMLCh* const string16);
+	 * @see transcodeToUtf8(const XMLCh* const string16) const;
 	 */
-	static CeGuiString transcodeToString(const XMLCh* const string16);
+	CeGuiString transcodeToString(const XMLCh* const string16) const;
 
-	static std::string transcodeToStdString(const XMLCh* const string16);
+	std::string transcodeToStdString(const XMLCh* const string16) const;
 
-    static XmlErrorHandler* getErrorHandler();
+    XERCES_CPP_NAMESPACE::DOMDocument* loadDocument(
+        const Ogre::String& resourceName, const Ogre::String& resourceGroup = "");
+    XERCES_CPP_NAMESPACE::DOMDocument* loadDocument(
+        const Ogre::DataStreamPtr& stream);
 
+    void initializeXml();
+    void shutdownXml();
+
+        virtual void warning(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
+        virtual void error(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
+        virtual void fatalError(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
+        virtual void resetErrors();
+
 private:
 	static XMLTranscoder* sTranscoder;
 	static XMLTransService::Codes sFailCode;
 
-    static XmlErrorHandler sErrorHandler;
+        std::string toString( const std::string& type,
+                              const XERCES_CPP_NAMESPACE::SAXParseException& exc ) const;
+        
+        std::string mOpenXmlFileName;
 
 	/**
 	 * Konvertiert ein Xerces-XMLCh* in einen UTF-8-String
@@ -435,7 +453,7 @@
 	 * @return Konvertierter Text als utf8* (muss selbst gel?scht werden)
 	 * @see initializeTranscoder()
 	 */
-	static utf8* transcodeToUtf8(const XMLCh* const string16);
+	utf8* transcodeToUtf8(const XMLCh* const string16) const;
 };
 
 class _RlCommonExport AutoXMLCh

Modified: rl/trunk/engine/common/include/XmlResource.h
===================================================================
--- rl/trunk/engine/common/include/XmlResource.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/include/XmlResource.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -26,6 +26,7 @@
 
 #include "CommonPrerequisites.h"
 #include <OgreResource.h>
+#include "XmlHelper.h"
 
 namespace rl {
 
@@ -43,8 +44,8 @@
 
         virtual ~XmlResource();
 
-        bool parseBy(XERCES_CPP_NAMESPACE::XercesDOMParser* parser, bool useErrorHandler=true);
-        bool parseBy(XERCES_CPP_NAMESPACE::SAX2XMLReader* parser, bool useErrorHandler=true);
+        bool parseBy(XERCES_CPP_NAMESPACE::XercesDOMParser* parser, XmlProcessor* const proc = NULL);
+        bool parseBy(XERCES_CPP_NAMESPACE::SAX2XMLReader* parser, XmlProcessor* const proc = NULL);
 
     protected:
         size_t calculateSize() const;

Modified: rl/trunk/engine/common/src/PropertyReader.cpp
===================================================================
--- rl/trunk/engine/common/src/PropertyReader.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/PropertyReader.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,12 +17,8 @@
 #include "stdinc.h" //precompiled header
 
 #include <xercesc/dom/DOM.hpp>
-#include <xercesc/parsers/XercesDOMParser.hpp>
-#include <xercesc/util/XMLString.hpp>
-#include <xercesc/util/PlatformUtils.hpp>
 
 #include "XmlHelper.h"
-#include "OgreXercesInput.h"
 
 #include "Properties.h"
 #include "PropertyReader.h"
@@ -42,19 +38,10 @@
 
 void XmlPropertyReader::parseGameObjectFile(Ogre::DataStreamPtr &stream, const Ogre::String &groupName)
 {
-    XMLPlatformUtils::Initialize();
+    initializeXml();
 
-	XmlHelper::initializeTranscoder();
-	XercesDOMParser* parser = new XercesDOMParser();
+    XERCES_CPP_NAMESPACE::DOMDocument* doc = loadDocument(stream);
 
-    parser->setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-    parser->setDoNamespaces(true);    // optional
-	
-    OgreInputSource source(stream);
-    parser->parse(source);
-
-    XERCES_CPP_NAMESPACE::DOMDocument* doc = parser->getDocument();
-
     DOMNodeList* godefsXml = doc->getDocumentElement()->getElementsByTagName(AutoXMLCh("gameobjectclass").data());
     for (unsigned int idx = 0; idx < godefsXml->getLength(); idx++)
     {
@@ -89,7 +76,7 @@
 	
 	doc->release();
 
-	XMLPlatformUtils::Terminate();
+    shutdownXml();
 }
 
 std::vector<PropertySet*> XmlPropertyReader::getPropertySets()
@@ -100,27 +87,27 @@
 PropertyEntry XmlPropertyReader::processProperty(XERCES_CPP_NAMESPACE::DOMAttr* domAttr) const
 {
 	return std::make_pair(
-		XmlHelper::transcodeToStdString(domAttr->getName()), 
-		Property(XmlHelper::transcodeToString(domAttr->getValue())));
+		transcodeToStdString(domAttr->getName()), 
+		Property(transcodeToString(domAttr->getValue())));
 }
 
 PropertyEntry XmlPropertyReader::processProperty(XERCES_CPP_NAMESPACE::DOMElement* domElem) const
 {
-    if (!XmlHelper::hasAttribute(domElem, "type"))
+    if (!hasAttribute(domElem, "type"))
     {
         return std::make_pair("", Property(0));
     }
 
     Ogre::String key = "";
-	if (XmlHelper::hasAttribute(domElem, "name"))
+	if (hasAttribute(domElem, "name"))
 	{
-		key = XmlHelper::getAttributeValueAsStdString(domElem, "name");
+		key = getAttributeValueAsStdString(domElem, "name");
 	}
-	Ogre::String type = XmlHelper::getAttributeValueAsStdString(domElem, "type");
+	Ogre::String type = getAttributeValueAsStdString(domElem, "type");
     CeGuiString value = "";
-    if (XmlHelper::hasAttribute(domElem, "data"))
+    if (hasAttribute(domElem, "data"))
     {
-        value = XmlHelper::getAttributeValueAsString(domElem, "data");
+        value = getAttributeValueAsString(domElem, "data");
     }
 
     Property prop;
@@ -229,7 +216,7 @@
 			if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
 			{
 				DOMElement* curElem = static_cast<DOMElement*>(curChild);
-				CeGuiString key = XmlHelper::getAttributeValueAsString(curElem, "name");
+				CeGuiString key = getAttributeValueAsString(curElem, "name");
 				PropertyEntry entry = processProperty(curElem);
 				mapVal[key] = entry.second;
 			}

Modified: rl/trunk/engine/common/src/PropertyWriter.cpp
===================================================================
--- rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -13,7 +13,7 @@
 *  along with this program; if not you can get it here
 *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
 */
-
+
 #include "stdinc.h" //precompiled header
 
 #include "XmlHelper.h"
@@ -34,6 +34,10 @@
     {
     }
 
+    XmlPropertyWriter::~XmlPropertyWriter()
+    {
+    }
+
     void XmlPropertyWriter::setPropertySets(std::vector<PropertySet*> sets)
     {
         mPropertySets = sets;
@@ -59,31 +63,31 @@
             }
             else
             {
-                element = XmlHelper::appendChildElement(mDocument, parent, "property");
+                element = appendChildElement(mDocument, parent, "property");
                 if(entry.first != "")
-                    XmlHelper::setAttribute(element, "name", entry.first.c_str());
+                    setAttribute(element, "name", entry.first.c_str());
 
                 //Ogre::String typeName = entry.second.getTypeName();
                 Ogre::String name = entry.second.getName();
                 Ogre::StringUtil::toUpperCase(name);
-                XmlHelper::setAttributeValueAsString(element, "type", name);
+                setAttributeValueAsString(element, "type", name);
 
                 if(entry.second.isBool())
-                    XmlHelper::setAttributeValueAsBool(element, "data", entry.second.toBool());
+                    setAttributeValueAsBool(element, "data", entry.second.toBool());
                 else if(entry.second.isInt())
-                    XmlHelper::setAttributeValueAsInteger(element, "data", entry.second.toInt());
+                    setAttributeValueAsInteger(element, "data", entry.second.toInt());
                 else if(entry.second.isIntPair())
-                    XmlHelper::setAttributeValueAsIntegerPair(element, "data", entry.second.toIntPair());
+                    setAttributeValueAsIntegerPair(element, "data", entry.second.toIntPair());
                 else if(entry.second.isIntPair())
-                    XmlHelper::setAttributeValueAsIntegerTriple(element, "data", entry.second.toIntTriple());
+                    setAttributeValueAsIntegerTriple(element, "data", entry.second.toIntTriple());
                 else if(entry.second.isQuaternion())
-                    XmlHelper::setValueAsQuaternion(element, entry.second.toQuaternion());
+                    setValueAsQuaternion(element, entry.second.toQuaternion());
                 else if(entry.second.isReal())
-                    XmlHelper::setAttributeValueAsReal(element, "data", entry.second.toReal());
+                    setAttributeValueAsReal(element, "data", entry.second.toReal());
                 else if(entry.second.isString())
-                    XmlHelper::setAttributeValueAsString(element, "data", entry.second.toString());
+                    setAttributeValueAsString(element, "data", entry.second.toString());
                 else if(entry.second.isVector3())
-                    XmlHelper::setValueAsVector3(element, entry.second.toVector3());
+                    setValueAsVector3(element, entry.second.toVector3());
             }
         }
         return element;
@@ -98,9 +102,9 @@
 
     DOMElement* XmlPropertyWriter::processPropertyArray(DOMElement *parent, const char *const name, PropertyVector vector)
     {
-        DOMElement* element = XmlHelper::appendChildElement(mDocument, parent, "property");
-        XmlHelper::setAttribute(element, "name", name);
-        XmlHelper::setAttribute(element, "type", "MAP");
+        DOMElement* element = appendChildElement(mDocument, parent, "property");
+        setAttribute(element, "name", name);
+        setAttribute(element, "type", "MAP");
 
         PropertyVector::iterator iter;
         for(iter = vector.begin(); iter != vector.end(); iter++)
@@ -112,9 +116,9 @@
 
     DOMElement* XmlPropertyWriter::processPropertyMap(DOMElement *parent, const char *const name, PropertyMap map)
     {
-        DOMElement* element = XmlHelper::appendChildElement(mDocument, parent, "property");
-        XmlHelper::setAttribute(element, "name", name);
-        XmlHelper::setAttribute(element, "type", "MAP");
+        DOMElement* element = appendChildElement(mDocument, parent, "property");
+        setAttribute(element, "name", name);
+        setAttribute(element, "type", "MAP");
 
         PropertyMap::iterator iter;
         for(iter = map.begin(); iter != map.end(); iter++)

Modified: rl/trunk/engine/common/src/XmlErrorHandler.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlErrorHandler.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/XmlErrorHandler.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,58 +17,27 @@
 #include "stdinc.h" //precompiled header
 
 #include <sstream>
-#include <xercesc/sax/SAXParseException.hpp>
+
 #include "XmlErrorHandler.h"
 #include "XmlHelper.h"
 
 
 namespace rl {
 
-XmlErrorHandler::XmlErrorHandler(void)
-    : mFileName("")
-{
-}
+//XmlErrorHandler::XmlErrorHandler(void)
+//    : mFileName("")
+//{
+//}
+//
+//XmlErrorHandler::~XmlErrorHandler(void)
+//{
+//}
+//
+//void XmlErrorHandler::setFileName(const std::string& fileName)
+//{
+//    mFileName = fileName;
+//}
 
-XmlErrorHandler::~XmlErrorHandler(void)
-{
-}
 
-void XmlErrorHandler::setFileName(const std::string& fileName)
-{
-    mFileName = fileName;
-}
 
-std::string XmlErrorHandler::toString( const std::string& type,
-        const XERCES_CPP_NAMESPACE::SAXParseException& exc ) const
-{
-    std::stringstream strs;
-    strs << "A" << type << " occured while parsing " << mFileName
-         << " at line " << exc.getLineNumber() << " column " <<  exc.getColumnNumber();
-
-    if( exc.getSystemId() != NULL )
-        strs << " with system " << XmlHelper::transcodeToStdString( exc.getSystemId() );
-    if( exc.getPublicId() != NULL )
-        strs << " with public " << XmlHelper::transcodeToStdString( exc.getPublicId() );
-    return strs.str();
 }
-
-void XmlErrorHandler::warning(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
-{
-    LOG_MESSAGE(Logger::CORE, toString( " warning ", exc ) );
-}
-
-void XmlErrorHandler::error(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
-{
-    LOG_ERROR(Logger::CORE, toString( "n error", exc ) );
-}
-
-void XmlErrorHandler::fatalError(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
-{
-    LOG_CRITICAL(Logger::CORE, toString( " fatal error", exc ) );
-}
-
-void XmlErrorHandler::resetErrors()
-{
-}
-
-}

Modified: rl/trunk/engine/common/src/XmlHelper.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlHelper.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/XmlHelper.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -16,42 +16,42 @@
 
 #include "stdinc.h" //precompiled header
 
+#include <CEGUIPropertyHelper.h>
+#include <OgreResourceManager.h>
 #include <xercesc/dom/DOM.hpp>
+#include <xercesc/parsers/XercesDOMParser.hpp>
+#include <xercesc/util/PlatformUtils.hpp>
+#include <xercesc/sax/SAXParseException.hpp>
 
-#include "XmlHelper.h"
-#include "XmlErrorHandler.h"
 #include "Exception.h"
 #include "Logger.h"
+#include "OgreXercesInput.h"
+#include "XmlErrorHandler.h"
+#include "XmlHelper.h"
+#include "XmlResource.h"
+#include "XmlResourceManager.h"
 
-#include <CEGUIPropertyHelper.h>
-
+using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
 
+namespace rl 
+{
 
-namespace rl {
+XERCES_CPP_NAMESPACE::XMLTranscoder* XmlProcessor::sTranscoder = NULL;
+XERCES_CPP_NAMESPACE::XMLTransService::Codes XmlProcessor::sFailCode = XERCES_CPP_NAMESPACE::XMLTransService::Ok;
 
-XMLTranscoder* XmlHelper::sTranscoder;
-XMLTransService::Codes XmlHelper::sFailCode;
-XmlErrorHandler XmlHelper::sErrorHandler;
-
-void XmlHelper::initializeTranscoder()
+DOMElement* XmlProcessor::appendChildElement(DOMDocument* doc, DOMElement* parent, const char* const name) const
 {
-	XmlHelper::sFailCode = XMLTransService::Ok;
-	XmlHelper::sTranscoder = XMLPlatformUtils::fgTransService->makeNewTranscoderFor(XMLRecognizer::UTF_8, XmlHelper::sFailCode, 16*1024);
-}
+    RlAssert(parent != NULL, "XmlProcessor::appendChildElement: parent must not be NULL" );
 
-DOMElement* XmlHelper::appendChildElement(DOMDocument* doc, DOMElement* parent, const char* const name)
-{
-    RlAssert(parent != NULL, "XmlHelper::appendChildElement: parent must not be NULL" );
-
     DOMElement* child = doc->createElement(XMLString::transcode(name));
     parent->appendChild(child);
     return child;
 }
 
-DOMElement* XmlHelper::getChildNamed(DOMElement* parent, const char* const name)
+DOMElement* XmlProcessor::getChildNamed(DOMElement* parent, const char* const name) const
 {
-    RlAssert(parent != NULL, "XmlHelper::getChildNamed: parent must not be NULL" );
+    RlAssert(parent != NULL, "XmlProcessor::getChildNamed: parent must not be NULL" );
 
 	AutoXMLCh nameXml = name;
 
@@ -70,53 +70,52 @@
 	return rval;
 }
 
-DOMElement* XmlHelper::setValueAsString(DOMDocument* doc, DOMElement *element, const CeGuiString &value)
+DOMElement* XmlProcessor::setValueAsString(DOMDocument* doc, DOMElement *element, const CeGuiString &value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setValueAsString: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::setValueAsString: Element must not be NULL");
     DOMText* text = doc->createTextNode(XMLString::transcode(value.c_str()));
     element->appendChild(text);
     return element;
 }
 
-CeGuiString XmlHelper::getValueAsString(DOMElement* element)
+CeGuiString XmlProcessor::getValueAsString(DOMElement* element) const
 {
-    RlAssert(element != NULL, "XmlHelper::getValueAsString: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::getValueAsString: Element must not be NULL");
 	return transcodeToString( element->getFirstChild()->getNodeValue() );
 }
 
-std::string XmlHelper::getValueAsStdString(DOMElement* element)
+std::string XmlProcessor::getValueAsStdString(DOMElement* element) const
 {
-    RlAssert(element != NULL, "XmlHelper::getValueAsStdString: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::getValueAsStdString: Element must not be NULL");
 	return transcodeToStdString( element->getFirstChild()->getNodeValue() );
 }
 
-DOMElement* XmlHelper::setValueAsUtf8(DOMDocument* doc, DOMElement* element, utf8* value)
+DOMElement* XmlProcessor::setValueAsUtf8(DOMDocument* doc, DOMElement* element, utf8* value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setValueAsUtf8: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::setValueAsUtf8: Element must not be NULL");
     CeGuiString temp(value);
     DOMText* text = doc->createTextNode(XMLString::transcode(temp.c_str()));
     element->appendChild(text);
     return element;
 }
 
-utf8* XmlHelper::getValueAsUtf8(DOMElement* element)
+utf8* XmlProcessor::getValueAsUtf8(DOMElement* element) const
 {
-    RlAssert(element != NULL, "XmlHelper::getValueAsUtf8: Element must not be NULL");
-	return XmlHelper::transcodeToUtf8(element->getFirstChild()->getNodeValue());
+    RlAssert(element != NULL, "XmlProcessor::getValueAsUtf8: Element must not be NULL");
+	return XmlProcessor::transcodeToUtf8(element->getFirstChild()->getNodeValue());
 }
 
-bool XmlHelper::hasAttribute(DOMElement* element,const char* const name)
+bool XmlProcessor::hasAttribute(DOMElement* element,const char* const name) const
 {
-    RlAssert(element != NULL, "XmlHelper::hasAttribute: Element must not be NULL");
-    XMLCh* attrName = XMLString::transcode(name);
-    bool rVal = element->hasAttribute(attrName);
-    XMLString::release(&attrName);
+    RlAssert(element != NULL, "XmlProcessor::hasAttribute: Element must not be NULL");
+    AutoXMLCh attrName(name);
+    bool rVal = element->hasAttribute(attrName.data());
     return rVal;
 }
 
-bool XmlHelper::hasNodeName(DOMNode* node, const char* const name)
+bool XmlProcessor::hasNodeName(DOMNode* node, const char* const name) const
 {
-    RlAssert(node != NULL, "XmlHelper::hasNodeName: node must not be NULL");
+    RlAssert(node != NULL, "XmlProcessor::hasNodeName: node must not be NULL");
     XMLCh* nodeName = XMLString::transcode(name);
     int ival = XMLString::compareString(node->getNodeName(), nodeName);
     bool rVal = (0 == ival);
@@ -124,49 +123,45 @@
     return rVal;
 }
 
-void XmlHelper::setAttribute(DOMElement* element, const char* const name, const char* const value)
+void XmlProcessor::setAttribute(DOMElement* element, const char* const name, const char* const value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setAttribute: Element must not be NULL");
-    XMLCh* attrName = XMLString::transcode(name);
-    element->setAttribute(attrName,XMLString::transcode(value));
-    XMLString::release(&attrName);
+    RlAssert(element != NULL, "XmlProcessor::setAttribute: Element must not be NULL");
+    AutoXMLCh attrName(name);
+    element->setAttribute(attrName.data(), XMLString::transcode(value));
 }
 
-DOMElement* XmlHelper::setAttributeValueAsInteger(DOMElement *element, const char *const name, int value)
+DOMElement* XmlProcessor::setAttributeValueAsInteger(DOMElement *element, const char *const name, int value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setAttributeValueAsInteger: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsInteger: Element must not be NULL");
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value);
-    element->setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&attrName);
+    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-int XmlHelper::getAttributeValueAsInteger(DOMElement* element,const char* const name)
+int XmlProcessor::getAttributeValueAsInteger(DOMElement* element,const char* const name) const
 {
-    RlAssert(element != NULL, "XmlHelper::getAttributeValueAsInteger: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
-	const XMLCh* attribute = element->getAttribute(attrName);
+    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsInteger: Element must not be NULL");
+	AutoXMLCh attrName(name);
+	const XMLCh* attribute = element->getAttribute(attrName.data());
 	int rVal = XMLString::parseInt(attribute);
-	XMLString::release(&attrName);
 	return rVal;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsIntegerPair(DOMElement* element, const char* const name, IntPair value)
+DOMElement* XmlProcessor::setAttributeValueAsIntegerPair(DOMElement* element, const char* const name, IntPair value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setAttributeValueAsIntegerPair: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsIntegerPair: Element must not be NULL");
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value.first) + "," + Ogre::StringConverter::toString(value.second);
-    element->setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&attrName);
+    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-IntPair XmlHelper::getAttributeValueAsIntegerPair(DOMElement* element, const char* const name)
+IntPair XmlProcessor::getAttributeValueAsIntegerPair(DOMElement* element, const char* const name) const
 {
-    RlAssert(element != NULL, "XmlHelper::getAttributeValueAsIntegerPair: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
-	const XMLCh* attribute = element->getAttribute(attrName);
+    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsIntegerPair: Element must not be NULL");
+	AutoXMLCh attrName(name);
+	const XMLCh* attribute = element->getAttribute(attrName.data());
 	
     CeGuiString value = transcodeToString(attribute);
     CeGuiString::size_type comma1 = value.find(",");
@@ -178,26 +173,24 @@
 			CEGUI::PropertyHelper::stringToInt(value.substr(0, comma1)),
 			CEGUI::PropertyHelper::stringToInt(value.substr(comma1 + 1)));
     }
-    XMLString::release(&attrName);
 
     return intPairVal;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsIntegerTriple(DOMElement *element, const char *const name, Tripel<int> value)
+DOMElement* XmlProcessor::setAttributeValueAsIntegerTriple(DOMElement *element, const char *const name, Tripel<int> value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setAttributeValueAsIntegerTriple: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsIntegerTriple: Element must not be NULL");
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value.first) + "," + Ogre::StringConverter::toString(value.second) + "" + Ogre::StringConverter::toString(value.third);
-    element->setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&attrName);
+    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-Tripel<int> XmlHelper::getAttributeValueAsIntegerTriple(DOMElement* element, const char* const name)
+Tripel<int> XmlProcessor::getAttributeValueAsIntegerTriple(DOMElement* element, const char* const name) const
 {
-    RlAssert(element != NULL, "XmlHelper::getAttributeValueAsIntegerTriple: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
-	const XMLCh* attribute = element->getAttribute(attrName);
+    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsIntegerTriple: Element must not be NULL");
+	AutoXMLCh attrName(name);
+	const XMLCh* attribute = element->getAttribute(attrName.data());
 
     CeGuiString value = transcodeToString(attribute);
 
@@ -211,132 +204,123 @@
         intTripel.second = CEGUI::PropertyHelper::stringToFloat(value.substr(comma1 + 1, comma2 - comma1 - 1));
         intTripel.third = CEGUI::PropertyHelper::stringToFloat(value.substr(comma2 + 1));
     }
-    XMLString::release(&attrName);
 
     return intTripel;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsReal(DOMElement *element, const char *const name, Ogre::Real value)
+DOMElement* XmlProcessor::setAttributeValueAsReal(DOMElement *element, const char *const name, Ogre::Real value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setAttributeValueAsReal: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsReal: Element must not be NULL");
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value);
-    element->setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&attrName);
+    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-Ogre::Real XmlHelper::getAttributeValueAsReal(DOMElement* element,const char* const name)
+Ogre::Real XmlProcessor::getAttributeValueAsReal(DOMElement* element,const char* const name) const
 {
-    RlAssert(element != NULL, "XmlHelper::getAttributeValueAsReal: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsReal: Element must not be NULL");
+	AutoXMLCh attrName(name);
 	Ogre::Real rVal = Ogre::StringConverter::parseReal(
-		transcodeToString(element->getAttribute(attrName)).c_str() );
-	XMLString::release(&attrName);
+		transcodeToString(element->getAttribute(attrName.data())).c_str() );
 	return rVal;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsString(DOMElement *element, const char *const name, const CeGuiString &value)
+DOMElement* XmlProcessor::setAttributeValueAsString(DOMElement *element, const char *const name, const CeGuiString &value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setAttributeValueAsString: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
-    element->setAttribute(attrName,XMLString::transcode(value.c_str()));
-    XMLString::release(&attrName);
+    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsString: Element must not be NULL");
+	AutoXMLCh attrName(name);
+    element->setAttribute(attrName.data(), XMLString::transcode(value.c_str()));
     return element;
 }
 
-CeGuiString XmlHelper::getAttributeValueAsString(DOMElement* element, const char* const name)
+CeGuiString XmlProcessor::getAttributeValueAsString(DOMElement* element, const char* const name) const
 {
-    RlAssert(element != NULL, "XmlHelper::getAttributeValueAsString: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
-	CeGuiString rVal(transcodeToString(element->getAttribute(attrName)));
-	XMLString::release(&attrName);
+    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsString: Element must not be NULL");
+	AutoXMLCh attrName(name);
+	CeGuiString rVal(transcodeToString(element->getAttribute(attrName.data())));
 	return rVal;
 }
 
-CeGuiString XmlHelper::getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes& attributes, const char* const name)
+CeGuiString XmlProcessor::getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes& attributes, const char* const name) const
 {
-	XMLCh* attrName = XMLString::transcode(name);
-	const XMLCh* valStr = attributes.getValue(attrName);
-	XMLString::release(&attrName);
-	if(valStr != NULL)
+	AutoXMLCh attrName(name);
+	const XMLCh* valStr = attributes.getValue(attrName.data());
+	if (valStr != NULL)
 	{
 		return transcodeToString(valStr);
 	}
 	return CeGuiString();
 }
 
-DOMElement* XmlHelper::setAttributeValueAsStdString(DOMElement *element, const char *const name, const std::string &value)
+DOMElement* XmlProcessor::setAttributeValueAsStdString(DOMElement *element, const char *const name, const std::string &value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setAttributeValueAsStdString: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
-    element->setAttribute(attrName,XMLString::transcode(value.c_str()));
-    XMLString::release(&attrName);
+    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsStdString: Element must not be NULL");
+	AutoXMLCh attrName(name);
+    element->setAttribute(attrName.data(), XMLString::transcode(value.c_str()));
     return element;
 }
 
-std::string XmlHelper::getAttributeValueAsStdString(DOMElement* element, const char* const name)
+std::string XmlProcessor::getAttributeValueAsStdString(DOMElement* element, const char* const name) const
 {
-    RlAssert(element != NULL, "XmlHelper::getAttributeValueAsStdString: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
-	std::string rVal(transcodeToStdString(element->getAttribute(attrName)));
-	XMLString::release(&attrName);
+    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsStdString: Element must not be NULL");
+	AutoXMLCh attrName(name);
+	std::string rVal(transcodeToStdString(element->getAttribute(attrName.data())));
 	return rVal;
 }
 
-DOMElement* XmlHelper::setAttributeValueAsBool(DOMElement *element, const char *const name, bool value)
+DOMElement* XmlProcessor::setAttributeValueAsBool(DOMElement *element, const char *const name, bool value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setAttributeValueAsBool: Element must not be NULL");
-	XMLCh* attrName = XMLString::transcode(name);
+    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsBool: Element must not be NULL");
+	AutoXMLCh attrName(name);
     CeGuiString temp = Ogre::StringConverter::toString(value);
-    element->setAttribute(attrName,XMLString::transcode(temp.c_str()));
-    XMLString::release(&attrName);
+    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
     return element;
 }
 
-bool XmlHelper::getAttributeValueAsBool(DOMElement* element,const char* const name)
+bool XmlProcessor::getAttributeValueAsBool(DOMElement* element,const char* const name) const
 {
-    RlAssert(element != NULL, "XmlHelper::getAttributeValueAsBool: Element must not be NULL");
-	if( XMLString::compareIString(getAttributeValueAsString(element, name).c_str(),"true") == 0  )
+    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsBool: Element must not be NULL");
+	if ( XMLString::compareIString(getAttributeValueAsString(element, name).c_str(),"true") == 0  )
 		return true;
 	else
 		return false;
 }
 
-DOMElement* XmlHelper::setValueAsInteger(DOMDocument* doc, DOMElement *element, int value)
+DOMElement* XmlProcessor::setValueAsInteger(DOMDocument* doc, DOMElement *element, int value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setValueAsInteger: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::setValueAsInteger: Element must not be NULL");
     CeGuiString temp = Ogre::StringConverter::toString(value);
     DOMText* text = doc->createTextNode(XMLString::transcode(temp.c_str()));
     element->appendChild(text);
     return element;
 }
 
-int XmlHelper::getValueAsInteger(DOMElement* element)
+int XmlProcessor::getValueAsInteger(DOMElement* element) const
 {
-    RlAssert(element != NULL, "XmlHelper::getValueAsInteger: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::getValueAsInteger: Element must not be NULL");
 	return XMLString::parseInt(element->getFirstChild()->getNodeValue());
 }
 
-Ogre::Real XmlHelper::getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element)
+Ogre::Real XmlProcessor::getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element) const
 {
-    RlAssert(element != NULL, "XmlHelper::getValueAsInteger: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::getValueAsInteger: Element must not be NULL");
     return Ogre::StringConverter::parseReal(
         transcodeToString(element->getFirstChild()->getNodeValue()).c_str());
 }
 
-DOMElement* XmlHelper::setValueAsIntegerPair(DOMDocument *doc, DOMElement *element, IntPair value)
+DOMElement* XmlProcessor::setValueAsIntegerPair(DOMDocument *doc, DOMElement *element, IntPair value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setValueAsIntegerPair: Element must not be NULL");
-    String temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second);
+    RlAssert(element != NULL, "XmlProcessor::setValueAsIntegerPair: Element must not be NULL");
+    CeGuiString temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second);
     DOMText* text = doc->createTextNode(XMLString::transcode(temp.c_str()));
     element->appendChild(text);
     return element;
 }
 
-IntPair XmlHelper::getValueAsIntegerPair(DOMElement* element)
+IntPair XmlProcessor::getValueAsIntegerPair(DOMElement* element) const
 {
-    RlAssert(element != NULL, "XmlHelper::getValueAsIntegerPair: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::getValueAsIntegerPair: Element must not be NULL");
     CeGuiString value = getValueAsString(element);
     CeGuiString::size_type comma1 = value.find(",");
 
@@ -350,19 +334,19 @@
     return intPairVal;
 }
 
-DOMElement* XmlHelper::setValueAsIntegerTriple(DOMDocument *doc, DOMElement *element, Tripel<int> value)
+DOMElement* XmlProcessor::setValueAsIntegerTriple(DOMDocument *doc, DOMElement *element, Tripel<int> value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setValueAsIntegerTriple: Element must not be NULL");
-    RlAssert(element != NULL, "XmlHelper::setValueAsIntegerPair: Element must not be NULL");
-    String temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second) + ',' + CEGUI::PropertyHelper::intToString(value.third);
+    RlAssert(element != NULL, "XmlProcessor::setValueAsIntegerTriple: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::setValueAsIntegerPair: Element must not be NULL");
+    CeGuiString temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second) + ',' + CEGUI::PropertyHelper::intToString(value.third);
     DOMText* text = doc->createTextNode(XMLString::transcode(temp.c_str()));
     element->appendChild(text);
     return element;
 }
 
-Tripel<int> XmlHelper::getValueAsIntegerTriple(DOMElement *element)
+Tripel<int> XmlProcessor::getValueAsIntegerTriple(DOMElement *element) const
 {
-    RlAssert(element != NULL, "XmlHelper::getValueAsIntegerTriple: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::getValueAsIntegerTriple: Element must not be NULL");
     CeGuiString value = getValueAsString(element);
 
     CeGuiString::size_type comma1 = value.find(",");
@@ -378,18 +362,18 @@
     return intTripel;
 }
 
-DOMElement* XmlHelper::setValueAsVector3( DOMElement *element, Ogre::Vector3 value)
+DOMElement* XmlProcessor::setValueAsVector3( DOMElement *element, Ogre::Vector3 value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setValueAsVector3: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::setValueAsVector3: Element must not be NULL");
     setAttribute(element, "x", Ogre::StringConverter::toString(value.x).c_str());
     setAttribute(element, "y", Ogre::StringConverter::toString(value.y).c_str());
     setAttribute(element, "z", Ogre::StringConverter::toString(value.z).c_str());
     return element;
 }
 
-Ogre::Vector3 XmlHelper::getValueAsVector3(DOMElement* element)
+Ogre::Vector3 XmlProcessor::getValueAsVector3(DOMElement* element) const
 {
-    RlAssert(element != NULL, "XmlHelper::getValueAsVector3: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::getValueAsVector3: Element must not be NULL");
 	RlAssert(
 		hasAttribute(element, "x") 
 		&& hasAttribute(element, "y") 
@@ -401,9 +385,9 @@
 		getAttributeValueAsReal(element, "z"));
 }
 
-DOMElement* XmlHelper::setValueAsQuaternion(DOMElement *element, Ogre::Quaternion value)
+DOMElement* XmlProcessor::setValueAsQuaternion(DOMElement *element, Ogre::Quaternion value) const
 {
-    RlAssert(element != NULL, "XmlHelper::setValueAsQuaternion: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::setValueAsQuaternion: Element must not be NULL");
     setAttribute(element, "x", Ogre::StringConverter::toString(value.x).c_str());
     setAttribute(element, "y", Ogre::StringConverter::toString(value.y).c_str());
     setAttribute(element, "z", Ogre::StringConverter::toString(value.z).c_str());
@@ -411,9 +395,9 @@
     return element;
 }
 
-Ogre::Quaternion XmlHelper::getValueAsQuaternion(DOMElement* element)
+Ogre::Quaternion XmlProcessor::getValueAsQuaternion(DOMElement* element) const
 {
-    RlAssert(element != NULL, "XmlHelper::getValueAsQuaternion: Element must not be NULL");
+    RlAssert(element != NULL, "XmlProcessor::getValueAsQuaternion: Element must not be NULL");
 	RlAssert(
 		hasAttribute(element, "x") 
 		&& hasAttribute(element, "y") 
@@ -427,7 +411,7 @@
         getAttributeValueAsReal(element, "w"));
 }
 
-utf8* XmlHelper::transcodeToUtf8(const XMLCh* const string16)
+utf8* XmlProcessor::transcodeToUtf8(const XMLCh* const string16) const
 {
 	unsigned int str16len = XMLString::stringLen(string16);
 	if (str16len == 0)
@@ -455,7 +439,7 @@
 	return rval;	
 }
 
-CeGuiString XmlHelper::transcodeToString(const XMLCh* const string16)
+CeGuiString XmlProcessor::transcodeToString(const XMLCh* const string16) const
 {
 	unsigned int str16len = XMLString::stringLen(string16);
 	if (str16len == 0)
@@ -463,17 +447,15 @@
 		return CeGuiString();
 	}
 
-	initializeTranscoder();
-
 	utf8* tmpVal = transcodeToUtf8(string16);
 	CeGuiString rVal(tmpVal);
 	delete[] tmpVal;
 	return rVal;
 }
 
-std::string XmlHelper::transcodeToStdString(const XMLCh* const string16)
+std::string XmlProcessor::transcodeToStdString(const XMLCh* const string16) const
 {
-    if( string16 == NULL )
+    if ( string16 == NULL )
         return "";
 
 	char* tmpVal = XMLString::transcode(string16);
@@ -482,9 +464,110 @@
 	return rVal;
 }
 
-XmlErrorHandler* XmlHelper::getErrorHandler()
+DOMDocument* XmlProcessor::loadDocument(
+    const Ogre::String& resourceName, const Ogre::String& resourceGroup)
 {
-    return &XmlHelper::sErrorHandler;
+	XercesDOMParser* parser = new XercesDOMParser();
+
+    parser->setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
+    parser->setDoNamespaces(true);    // optional
+
+    XmlPtr res = XmlResourceManager::getSingleton().getByName(resourceName);
+    if (res.isNull())
+    {
+        Ogre::String group = ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME;
+        if (resourceGroup != "" 
+            && ResourceGroupManager::getSingleton().resourceExists(
+                    resourceGroup, resourceName))
+        {
+            group = resourceGroup;
+        }
+        res = XmlResourceManager::getSingleton().create(resourceName, group);
+    }
+
+    mOpenXmlFileName = resourceName;
+
+    if (!res.isNull() && res->parseBy(parser, this))
+    {
+        return parser->getDocument();
+    }
+
+    mOpenXmlFileName = "";
+
+    return NULL;
 }
 
+DOMDocument* XmlProcessor::loadDocument(const Ogre::DataStreamPtr& stream)
+{
+	XercesDOMParser* parser = new XercesDOMParser();
+
+    parser->setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
+    parser->setDoNamespaces(true);    // optional
+
+    OgreInputSource source(stream);
+    parser->setErrorHandler(this);
+
+    mOpenXmlFileName = stream->getName();
+    parser->parse(source);
+    mOpenXmlFileName = "";
+
+    if (parser->getErrorCount() == 0)
+    {
+        return parser->getDocument();
+    }
+
+    return NULL;
+}
+
+void XmlProcessor::initializeXml()
+{
+  	XMLPlatformUtils::Initialize();
+
+	sTranscoder 
+        = XMLPlatformUtils::fgTransService->makeNewTranscoderFor(
+            XMLRecognizer::UTF_8, sFailCode, 16*1024);
+}
+
+void XmlProcessor::shutdownXml()
+{
+    delete sTranscoder;
+    sTranscoder = NULL;
+    
+    XMLPlatformUtils::Terminate();
+}
+
+std::string XmlProcessor::toString( const std::string& type,
+        const XERCES_CPP_NAMESPACE::SAXParseException& exc ) const
+{
+    std::stringstream strs;
+    strs << "A" << type << " occured while parsing " << mOpenXmlFileName
+         << " at line " << exc.getLineNumber() << " column " <<  exc.getColumnNumber();
+
+    if( exc.getSystemId() != NULL )
+        strs << " with system " << transcodeToStdString( exc.getSystemId() );
+    if( exc.getPublicId() != NULL )
+        strs << " with public " << transcodeToStdString( exc.getPublicId() );
+    return strs.str();
+}
+
+void XmlProcessor::warning(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
+{
+    LOG_MESSAGE(Logger::CORE, toString( " warning ", exc ) );
+}
+
+void XmlProcessor::error(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
+{
+    LOG_ERROR(Logger::CORE, toString( "n error", exc ) );
+}
+
+void XmlProcessor::fatalError(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
+{
+    LOG_CRITICAL(Logger::CORE, toString( " fatal error", exc ) );
+}
+
+void XmlProcessor::resetErrors()
+{
+}
+
+
 } // end namespace rl

Modified: rl/trunk/engine/common/src/XmlResource.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlResource.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/XmlResource.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -14,7 +14,7 @@
  *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
  */
 
-#include "stdinc.h" //precompiled header
+#include "stdinc.h" //precompiled header
 
 #include "XmlResource.h"
 #include "XmlResourceManager.h"
@@ -70,16 +70,18 @@
 /**
  * @todo both parseby methods could be merged in one template method, to avoid redundancy
  */
-bool XmlResource::parseBy(XERCES_CPP_NAMESPACE::XercesDOMParser* parser, bool useErrorHandler)
+bool XmlResource::parseBy(XERCES_CPP_NAMESPACE::XercesDOMParser* parser, XmlProcessor* const errorHandler)
 {
 	if (!isLoaded())
 		load();
-    if(useErrorHandler && parser->getErrorHandler() == NULL)
+
+    if (errorHandler 
+        && parser->getErrorHandler() == NULL)
     {
-        parser->setErrorHandler(XmlHelper::getErrorHandler());
-        XmlHelper::getErrorHandler()->setFileName(getName());
+        parser->setErrorHandler(errorHandler);
     }
-	parser->parse(*mXmlBuffer);
+
+    parser->parse(*mXmlBuffer);
     if(parser->getErrorCount() > 0)
     {
         return false;
@@ -87,16 +89,18 @@
     return true;
 }
 
-bool XmlResource::parseBy(XERCES_CPP_NAMESPACE::SAX2XMLReader* parser, bool useErrorHandler)
+bool XmlResource::parseBy(XERCES_CPP_NAMESPACE::SAX2XMLReader* parser, XmlProcessor* const errorHandler)
 {
 	if (!isLoaded())
 		load();
-    if(useErrorHandler && parser->getErrorHandler() == NULL)
+
+    if (errorHandler 
+        && parser->getErrorHandler() == NULL)
     {
-        parser->setErrorHandler(XmlHelper::getErrorHandler());
-        XmlHelper::getErrorHandler()->setFileName(getName());
+        parser->setErrorHandler(errorHandler);
     }
-	parser->parse(*mXmlBuffer);
+
+    parser->parse(*mXmlBuffer);
     if(parser->getErrorCount() > 0)
     {
         return false;

Modified: rl/trunk/engine/common/src/XmlResourceManager.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlResourceManager.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/common/src/XmlResourceManager.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -14,7 +14,7 @@
  *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
  */
 
-#include "stdinc.h" //precompiled header
+#include "stdinc.h" //precompiled header
 
 #include "XmlResourceManager.h"
 
@@ -30,9 +30,9 @@
 }
 
 Resource* XmlResourceManager::createImpl(
-	const String& resName, 
+    const Ogre::String& resName, 
 	ResourceHandle handle, 
-	const String& groupName, 
+	const Ogre::String& groupName, 
 	bool isManual, 
 	ManualResourceLoader* loader, 
 	const NameValuePairList* loadParams)

Modified: rl/trunk/engine/core/include/DotSceneLoader.h
===================================================================
--- rl/trunk/engine/core/include/DotSceneLoader.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/core/include/DotSceneLoader.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,18 +17,16 @@
 #ifndef __DotSceneLoader_H__
 #define __DotSceneLoader_H__
 
-#include <xercesc/sax/ErrorHandler.hpp>
 #include <OgreNewt.h>
 
 #include <string>
 #include <map>
 
 #include "XmlResourceManager.h"
+#include "PropertyReader.h"
 
 class Ogre::SceneNode;
 class XERCES_CPP_NAMESPACE::DOMElement;
-class XERCES_CPP_NAMESPACE::XercesDOMParser;
-class XERCES_CPP_NAMESPACE::SAXParseException;
 
 namespace rl {
 
@@ -38,7 +36,7 @@
 	 *   - Nodes ( Name, Hierarchie + Platzierung + Skalierung + Rotation )
 	 *   - Entities ( Name, TriMeshPhysik )
 	 */
-    class DotSceneLoader : protected XERCES_CPP_NAMESPACE::ErrorHandler
+    class DotSceneLoader : private XmlPropertyReader
 	{
 	public:
 		/// Erstellt einen Dotscene Loader, der das gew?nschte File einliest
@@ -48,12 +46,7 @@
 
 		/// Laden der Szene
 		void initializeScene(Ogre::SceneManager* sceneManager);
-		
 
-        virtual void warning(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
-        virtual void error(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
-        virtual void fatalError(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
-        virtual void resetErrors();
 	private:
         struct NodeUserData
         {
@@ -76,9 +69,6 @@
         };
 
 
-		/// ?ffnen der XML-Ressource
-		XERCES_CPP_NAMESPACE::DOMDocument* openSceneFile();
-
 		/// Geht alle Nodes in der .scene durch
 		void processNodes(XERCES_CPP_NAMESPACE::DOMElement* rootNodesXml, 
 			Ogre::SceneManager* sceneManager,

Modified: rl/trunk/engine/core/src/CoreSubsystem.cpp
===================================================================
--- rl/trunk/engine/core/src/CoreSubsystem.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/core/src/CoreSubsystem.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -94,7 +94,7 @@
         delete mAnimationManager;
         delete mActorManager;
         delete mPhysicsManager;
-        delete mXmlResourceManager;
+//        delete mXmlResourceManager;
         delete mScriptWrapper;
         delete mDebugVisualsManager;
 		delete ConfigurationManager::getSingletonPtr();
@@ -341,7 +341,7 @@
         }
     }
 
-    ContentModule* CoreSubsystem::getModule(const String& moduleId) const
+    ContentModule* CoreSubsystem::getModule(const Ogre::String& moduleId) const
     {
         ModuleMap::const_iterator moduleIt = mModules.find(moduleId);
 
@@ -450,7 +450,7 @@
         StringVector deps = module->getDependencies();
         for (StringVector::const_iterator depsIt = deps.begin(); depsIt != deps.end(); depsIt++)
         {
-            String depName = *depsIt;
+            Ogre::String depName = *depsIt;
             ModuleMap::iterator modIt = mModules.find(depName);
             if (modIt == mModules.end())
             {
@@ -541,7 +541,7 @@
         return mRubyInterpreter;
     }
 
-    void CoreSubsystem::makeScreenshot( const String& sName )
+    void CoreSubsystem::makeScreenshot( const Ogre::String& sName )
     {
         mRenderWindow->writeContentsToTimestampedFile(sName, ".png");
     }
@@ -556,8 +556,8 @@
         return mModules;
     }
 
-    void CoreSubsystem::loadMap(const String type, const String filename,
-        const String module)
+    void CoreSubsystem::loadMap(const Ogre::String type, const Ogre::String filename,
+        const Ogre::String module)
     {
         mWorld->loadScene(filename, module);
     }

Modified: rl/trunk/engine/core/src/DotSceneLoader.cpp
===================================================================
--- rl/trunk/engine/core/src/DotSceneLoader.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/core/src/DotSceneLoader.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -15,14 +15,7 @@
  */
 #include "stdinc.h" //precompiled header
 
-#include <xercesc/framework/LocalFileInputSource.hpp>
-#include <xercesc/parsers/XercesDOMParser.hpp>
-#include <xercesc/dom/DOMDocument.hpp>
-#include <xercesc/dom/DOMElement.hpp>
 #include <xercesc/dom/DOM.hpp>
-#include <xercesc/util/XMLString.hpp>
-#include <xercesc/util/PlatformUtils.hpp>
-#include <xercesc/sax/SAXParseException.hpp>
 
 #include <OgreSceneNode.h>
 
@@ -35,10 +28,7 @@
 #include "ConfigurationManager.h"
 
 #include "Property.h"
-#include "PropertyReader.h"
-#include "XmlHelper.h"
 
-
 #include "Exception.h"
 
 #include <cstdlib>
@@ -67,7 +57,7 @@
 
     DotSceneLoader::~DotSceneLoader()
     {
-        if (mRessource->isLoaded())
+        if (!mRessource.isNull() && mRessource->isLoaded())
         {
             XmlResourceManager::getSingleton().unload(mSceneName);
             XmlResourceManager::getSingleton().remove(mRessource->getHandle());
@@ -76,11 +66,10 @@
 
     void DotSceneLoader::initializeScene(SceneManager* sceneManager)
     {
-        XMLPlatformUtils::Initialize();
-        XmlHelper::initializeTranscoder();
+        initializeXml();
 
         LOG_MESSAGE(Logger::CORE, "Loading Scene from " + mSceneName);
-        DOMDocument* doc = openSceneFile();
+        DOMDocument* doc = loadDocument(mSceneName, mResourceGroup);
 
         // Durch alle Unterelemente iterieren
         DOMNode* child = doc->getDocumentElement()->getFirstChild();
@@ -96,7 +85,7 @@
         }
 
         LOG_DEBUG(Logger::CORE, " Beginne parsen der Unterelemente");
-        DOMElement* nodes = XmlHelper::getChildNamed(doc->getDocumentElement(), "nodes");
+        DOMElement* nodes = getChildNamed(doc->getDocumentElement(), "nodes");
 
         // Eine .scene wird in einem SceneNode mit dem Namen der .scene befestigt
         mSceneNode = sceneManager->getRootSceneNode()->createChildSceneNode(mSceneName);
@@ -155,47 +144,11 @@
         else
             LOG_DEBUG(Logger::CORE, " Keine statischen Geometrien erstellt");
 
-        delete mParser;
-        XMLPlatformUtils::Terminate();
+        doc->release();
+        shutdownXml();
         LOG_DEBUG(Logger::CORE, "Szenenbeschreibung aus " + mSceneName +" fertig geparst");
     }
 
-    DOMDocument* DotSceneLoader::openSceneFile()
-    {
-        mParser = new XercesDOMParser();
-        mParser->setValidationScheme(XercesDOMParser::Val_Auto);
-        mParser->setDoNamespaces(true);
-        mParser->setErrorHandler(this);
-
-        try
-        {
-            mRessource =
-                XmlResourceManager::getSingleton().create(
-                mSceneName,
-                   mResourceGroup);
-        }
-        catch(Ogre::Exception)
-        {
-            Throw(IllegalArgumentException, "RessourceGroup '"+mResourceGroup+"' does not exist.");
-        }
-
-        mRessource->load();
-
-        if (!mRessource->isLoaded())
-        {
-            Throw(FileNotFoundException, "File '"+mSceneName+"' was not found.");
-        }
-
-        mRessource.getPointer()->parseBy(mParser);
-
-        if (mErrorCount > 0)
-            Throw(RuntimeException, "File '"+mSceneName+"' could not be parsed.");
-
-        DOMDocument* doc = mParser->getDocument();
-
-        return doc;
-    }
-
     // Iteriert durch die einzelnen Nodes
     void DotSceneLoader::processNodes(DOMElement* rootNodesXml, SceneManager* sceneManager,
         Ogre::SceneNode* parentNode)
@@ -228,7 +181,7 @@
         if (parentNode == NULL)
             Throw(NullPointerException, "parentNode darf nicht null sein");
 
-        string nodeName = XmlHelper::getAttributeValueAsStdString(rootNodeXml,
+        string nodeName = getAttributeValueAsStdString(rootNodeXml,
                         "name");
 
         Ogre::SceneNode* newNode;
@@ -421,7 +374,7 @@
                 AutoXMLCh("manualLOD").data()) == 0)
             {
                 DOMElement* lodXml = static_cast<DOMElement*>(child);
-                string meshName = XmlHelper::getAttributeValueAsStdString(lodXml,
+                string meshName = getAttributeValueAsStdString(lodXml,
                     "mesh");
 
                 try
@@ -446,9 +399,9 @@
                             try
                             {
                                 lodXml = static_cast<DOMElement*>(lodchild);
-                                loddist = XmlHelper::getAttributeValueAsReal(lodXml,
+                                loddist = getAttributeValueAsReal(lodXml,
                                     "distance");
-                                lodmeshName = XmlHelper::getAttributeValueAsStdString(lodXml,
+                                lodmeshName = getAttributeValueAsStdString(lodXml,
                                     "mesh");
 
                                 if (lodmeshName.length() > 0 && loddist > 0)
@@ -482,7 +435,6 @@
     {
         DOMNode* child = rootUserDataXml->getFirstChild();
         LOG_DEBUG(Logger::CORE, " NodeUserData gefunden");
-        XmlPropertyReader* propertyReader = new XmlPropertyReader();
 
         // Durch alle Unterelemente iterieren, um die properties zu finden
         while(child != NULL)
@@ -492,7 +444,7 @@
                 AutoXMLCh("property").data()) == 0)
             {
                 DOMElement* propertyXml = static_cast<DOMElement*>(child);
-                PropertyEntry entry = propertyReader->processProperty(propertyXml);
+                PropertyEntry entry = processProperty(propertyXml);
 
                 try
                 {
@@ -519,8 +471,6 @@
 
             child = child->getNextSibling();
         }
-
-        delete propertyReader;
     }
 
     // eine benutzerdefinierte Collision
@@ -547,7 +497,7 @@
             }
             collision.setNull();
             // am Anfang steht ein Node mit dem Typ
-            std::string typeAsString = XmlHelper::transcodeToStdString(child->getNodeName());
+            std::string typeAsString = transcodeToStdString(child->getNodeName());
 
             scale = Ogre::Vector3::UNIT_SCALE;
             offset = Ogre::Vector3::ZERO;
@@ -788,9 +738,9 @@
         SceneManager* sceneManager, Ogre::SceneNode* parentNode,
         Ogre::Real renderingDistance, const std::string &physical_body)
     {
-        string entName = XmlHelper::getAttributeValueAsStdString(
+        string entName = getAttributeValueAsStdString(
             rootEntityXml, "name");
-        string meshName = XmlHelper::getAttributeValueAsStdString(
+        string meshName = getAttributeValueAsStdString(
             rootEntityXml, "meshFile");
 
         Ogre::Entity* newEnt = NULL;
@@ -1009,14 +959,14 @@
 
         try
         {
-            if (XmlHelper::hasAttribute(rootPositionXml, "x") &&
-                XmlHelper::hasAttribute(rootPositionXml, "y") &&
-                XmlHelper::hasAttribute(rootPositionXml, "z"))
+            if (hasAttribute(rootPositionXml, "x") &&
+                hasAttribute(rootPositionXml, "y") &&
+                hasAttribute(rootPositionXml, "z"))
             {
                 return Ogre::Vector3(
-                    XmlHelper::getAttributeValueAsReal(rootPositionXml, "x"),
-                    XmlHelper::getAttributeValueAsReal(rootPositionXml, "y"),
-                    XmlHelper::getAttributeValueAsReal(rootPositionXml, "z"));
+                    getAttributeValueAsReal(rootPositionXml, "x"),
+                    getAttributeValueAsReal(rootPositionXml, "y"),
+                    getAttributeValueAsReal(rootPositionXml, "z"));
             }
         }
         catch(...) { }
@@ -1033,14 +983,14 @@
 
         try
         {
-            if (XmlHelper::hasAttribute(rootScaleXml, "x") &&
-                XmlHelper::hasAttribute(rootScaleXml, "y") &&
-                XmlHelper::hasAttribute(rootScaleXml, "z"))
+            if (hasAttribute(rootScaleXml, "x") &&
+                hasAttribute(rootScaleXml, "y") &&
+                hasAttribute(rootScaleXml, "z"))
             {
                 return Ogre::Vector3(
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, "x"),
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, "y"),
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, "z"));
+                    getAttributeValueAsReal(rootScaleXml, "x"),
+                    getAttributeValueAsReal(rootScaleXml, "y"),
+                    getAttributeValueAsReal(rootScaleXml, "z"));
             }
         }
         catch(...) { }
@@ -1056,15 +1006,15 @@
 
         try
         {
-            if (XmlHelper::hasAttribute(rootScaleXml, "x") &&
-                XmlHelper::hasAttribute(rootScaleXml, "y") &&
-                XmlHelper::hasAttribute(rootScaleXml, "z"))
+            if (hasAttribute(rootScaleXml, "x") &&
+                hasAttribute(rootScaleXml, "y") &&
+                hasAttribute(rootScaleXml, "z"))
             {
                 error = false;
                 return Ogre::Vector3(
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, "x"),
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, "y"),
-                    XmlHelper::getAttributeValueAsReal(rootScaleXml, "z"));
+                    getAttributeValueAsReal(rootScaleXml, "x"),
+                    getAttributeValueAsReal(rootScaleXml, "y"),
+                    getAttributeValueAsReal(rootScaleXml, "z"));
             }
         }
         catch(...) { }
@@ -1083,43 +1033,43 @@
         try
         {
             // Durch w,x,y,z definiert
-            if (XmlHelper::hasAttribute(rootQuatXml, "qw") &&
-                XmlHelper::hasAttribute(rootQuatXml, "qx") &&
-                XmlHelper::hasAttribute(rootQuatXml, "qy") &&
-                XmlHelper::hasAttribute(rootQuatXml, "qz"))
+            if (hasAttribute(rootQuatXml, "qw") &&
+                hasAttribute(rootQuatXml, "qx") &&
+                hasAttribute(rootQuatXml, "qy") &&
+                hasAttribute(rootQuatXml, "qz"))
             {
 
                 return Ogre::Quaternion(
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, "qw"),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, "qx"),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, "qy"),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, "qz"));
+                    getAttributeValueAsReal(rootQuatXml, "qw"),
+                    getAttributeValueAsReal(rootQuatXml, "qx"),
+                    getAttributeValueAsReal(rootQuatXml, "qy"),
+                    getAttributeValueAsReal(rootQuatXml, "qz"));
             }
 
             // Durch axisX,axisY,axisZ,angle definiert
-            if (XmlHelper::hasAttribute(rootQuatXml, "angle") &&
-                XmlHelper::hasAttribute(rootQuatXml, "axisX") &&
-                XmlHelper::hasAttribute(rootQuatXml, "axisY") &&
-                XmlHelper::hasAttribute(rootQuatXml, "axisZ"))
+            if (hasAttribute(rootQuatXml, "angle") &&
+                hasAttribute(rootQuatXml, "axisX") &&
+                hasAttribute(rootQuatXml, "axisY") &&
+                hasAttribute(rootQuatXml, "axisZ"))
             {
                 return Ogre::Quaternion(
-                    Ogre::Degree(XmlHelper::getAttributeValueAsReal(rootQuatXml, "angle")),
+                    Ogre::Degree(getAttributeValueAsReal(rootQuatXml, "angle")),
                     Ogre::Vector3(
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, "axisX"),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, "axisY"),
-                    XmlHelper::getAttributeValueAsReal(rootQuatXml, "axisZ")));
+                    getAttributeValueAsReal(rootQuatXml, "axisX"),
+                    getAttributeValueAsReal(rootQuatXml, "axisY"),
+                    getAttributeValueAsReal(rootQuatXml, "axisZ")));
             }
 
             // Durch angleX,angleY,angleZ definiert
-            if (XmlHelper::hasAttribute(rootQuatXml, "angleX") &&
-                XmlHelper::hasAttribute(rootQuatXml, "angleY") &&
-                XmlHelper::hasAttribute(rootQuatXml, "angleZ") )
+            if (hasAttribute(rootQuatXml, "angleX") &&
+                hasAttribute(rootQuatXml, "angleY") &&
+                hasAttribute(rootQuatXml, "angleZ") )
             {
                 Ogre::Matrix3 mat;
                 mat.FromEulerAnglesXYZ(
-                    Degree(XmlHelper::getAttributeValueAsReal(rootQuatXml, "angleX")),
-                    Degree(XmlHelper::getAttributeValueAsReal(rootQuatXml, "angleY")),
-                    Degree(XmlHelper::getAttributeValueAsReal(rootQuatXml, "angleZ")));
+                    Degree(getAttributeValueAsReal(rootQuatXml, "angleX")),
+                    Degree(getAttributeValueAsReal(rootQuatXml, "angleY")),
+                    Degree(getAttributeValueAsReal(rootQuatXml, "angleZ")));
                 return Quaternion(mat);
             }
         }
@@ -1129,39 +1079,5 @@
 
         return Ogre::Quaternion::IDENTITY;
     }
-
-
-    void DotSceneLoader::warning(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
-    {
-        LOG_MESSAGE(Logger::CORE, toString(" warning ", exc));
-    }
-    void DotSceneLoader::error(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
-    {
-        LOG_ERROR(Logger::CORE, toString("n error", exc));
-        mErrorCount++;
-    }
-    void DotSceneLoader::fatalError(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
-    {
-        LOG_CRITICAL(Logger::CORE, toString(" fatal error", exc));
-        mErrorCount++;
-    }
-    void DotSceneLoader::resetErrors()
-    {
-    }
-
-    std::string DotSceneLoader::toString(const std::string& type,
-        const XERCES_CPP_NAMESPACE::SAXParseException& exc) const
-    {
-        std::stringstream strs;
-        strs << "A" << type << " occured while parsing " << mSceneName
-             << " at line " << exc.getLineNumber() << " column " <<  exc.getColumnNumber();
-
-        if (exc.getSystemId() != NULL)
-            strs << " with system " << XmlHelper::transcodeToStdString(exc.getSystemId());
-        if (exc.getPublicId() != NULL)
-            strs << " with public " << XmlHelper::transcodeToStdString(exc.getPublicId());
-
-        return strs.str();
-    }
 }
 

Modified: rl/trunk/engine/core/src/DotSceneOctreeWorld.cpp
===================================================================
--- rl/trunk/engine/core/src/DotSceneOctreeWorld.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/core/src/DotSceneOctreeWorld.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -71,14 +71,14 @@
 		}
     }
 
-    void DotSceneOctreeWorld::loadScene(const String& levelName, const String& module)
+    void DotSceneOctreeWorld::loadScene(const Ogre::String& levelName, const Ogre::String& module)
     {
         // Alte Szene l?schen
         clearScene();
 
 		setCastShadows( true );
 
-        // Leerer String, keine Map laden
+        // Leerer Ogre::String, keine Map laden
         if (levelName.length() != 0)
         {
             /// TODO - In den Sky-Sonnenpart verschieben

Modified: rl/trunk/engine/rules/include/DsaDataLoader.h
===================================================================
--- rl/trunk/engine/rules/include/DsaDataLoader.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/rules/include/DsaDataLoader.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -21,6 +21,7 @@
 #include <xercesc/dom/DOMElement.hpp>
 
 #include <OgreScriptLoader.h>
+#include "XmlHelper.h"
 
 namespace rl {
 
@@ -28,7 +29,9 @@
 	class Person;
 	class Kampftechnik;
 
-    class XdimlLoader : public Ogre::ScriptLoader
+    class XdimlLoader 
+        : public Ogre::ScriptLoader,
+        private XmlProcessor
 	{
     public:
         XdimlLoader();
@@ -38,16 +41,16 @@
 		virtual Ogre::Real getLoadingOrder() const;
 
     private:
-		static int getEBeFromString(const Ogre::String& eBeString);
+		int getEBeFromString(const Ogre::String& eBeString);
 
-		static void initializeTalente(XERCES_CPP_NAMESPACE::DOMElement* rootTalente);
-		static Talent* processTalent(int gruppe, XERCES_CPP_NAMESPACE::DOMElement* talentXml);
+		void initializeTalente(XERCES_CPP_NAMESPACE::DOMElement* rootTalente);
+		Talent* processTalent(int gruppe, XERCES_CPP_NAMESPACE::DOMElement* talentXml);
 
-		static void initializePersonen(XERCES_CPP_NAMESPACE::DOMElement* rootPersonen);
-		static Person* processPerson(XERCES_CPP_NAMESPACE::DOMElement* talentXml);
+		void initializePersonen(XERCES_CPP_NAMESPACE::DOMElement* rootPersonen);
+		Person* processPerson(XERCES_CPP_NAMESPACE::DOMElement* talentXml);
 			
-		static void initializeKampftechniken(XERCES_CPP_NAMESPACE::DOMElement* rootKampftechniken);
-		static Kampftechnik* processKampftechnik(XERCES_CPP_NAMESPACE::DOMElement* kampftechnikXml);
+		void initializeKampftechniken(XERCES_CPP_NAMESPACE::DOMElement* rootKampftechniken);
+		Kampftechnik* processKampftechnik(XERCES_CPP_NAMESPACE::DOMElement* kampftechnikXml);
 
         Ogre::StringVector mScriptPatterns;
     };

Modified: rl/trunk/engine/rules/include/SaveGameFileWriter.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -26,7 +26,8 @@
 
 namespace rl
 {
-    class _RlRulesExport SaveGameFileWriter : public XmlPropertyWriter
+    class _RlRulesExport SaveGameFileWriter 
+        : protected XmlPropertyWriter
     {
     public:
         void buildSaveGameFile(SaveGameFile *file);

Modified: rl/trunk/engine/rules/src/DsaDataLoader.cpp
===================================================================
--- rl/trunk/engine/rules/src/DsaDataLoader.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/rules/src/DsaDataLoader.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -16,9 +16,6 @@
 #include "stdinc.h" //precompiled header
 
 #include <xercesc/dom/DOM.hpp>
-#include <xercesc/parsers/XercesDOMParser.hpp>
-#include <xercesc/util/XMLString.hpp>
-#include <xercesc/util/PlatformUtils.hpp>
 
 // #include "XdimlLoader.h"
 #include "DsaDataLoader.h"
@@ -54,28 +51,19 @@
 
     void XdimlLoader::parseScript(Ogre::DataStreamPtr &stream, const Ogre::String &groupName)
     {
-		XMLPlatformUtils::Initialize();
+        initializeXml();
 
-		XmlHelper::initializeTranscoder();
-		XercesDOMParser* parser = new XercesDOMParser();
-
-        parser->setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-        parser->setDoNamespaces(true);    // optional
-
-        OgreInputSource source(stream);
-        parser->parse(source);
-
-		DOMDocument* doc = parser->getDocument();
-		DOMElement* dataDocumentContent = XmlHelper::getChildNamed(
+		DOMDocument* doc = loadDocument(stream);
+		DOMElement* dataDocumentContent = getChildNamed(
             doc->getDocumentElement(), "Inhalt");
 
-		initializeTalente(XmlHelper::getChildNamed(dataDocumentContent, "Talente"));
-		initializeKampftechniken(XmlHelper::getChildNamed(dataDocumentContent, "Kampftechniken"));
-		initializePersonen(XmlHelper::getChildNamed(dataDocumentContent, "Personen"));
+		initializeTalente(getChildNamed(dataDocumentContent, "Talente"));
+		initializeKampftechniken(getChildNamed(dataDocumentContent, "Kampftechniken"));
+		initializePersonen(getChildNamed(dataDocumentContent, "Personen"));
 
 		doc->release();
 
-		XMLPlatformUtils::Terminate();
+        shutdownXml();
     }
 
     const StringVector& XdimlLoader::getScriptPatterns() const
@@ -112,17 +100,17 @@
 
     Talent* XdimlLoader::processTalent(int gruppe, DOMElement* talentXml)
     {
-		CeGuiString desc = XmlHelper::getValueAsString(XmlHelper::getChildNamed(talentXml, "Beschreibung"));
-        CeGuiString probe = XmlHelper::getValueAsString(XmlHelper::getChildNamed(talentXml, "Probe"));
-        CeGuiString art = XmlHelper::getValueAsString(XmlHelper::getChildNamed(talentXml, "Art"));
-		DOMElement* eBeNode = XmlHelper::getChildNamed(talentXml, "eBE");
-        DOMElement* ausweichTalenteNode = static_cast<DOMElement*>(XmlHelper::getChildNamed(talentXml, "Ausweichtalente"));
+		CeGuiString desc = getValueAsString(getChildNamed(talentXml, "Beschreibung"));
+        CeGuiString probe = getValueAsString(getChildNamed(talentXml, "Probe"));
+        CeGuiString art = getValueAsString(getChildNamed(talentXml, "Art"));
+		DOMElement* eBeNode = getChildNamed(talentXml, "eBE");
+        DOMElement* ausweichTalenteNode = static_cast<DOMElement*>(getChildNamed(talentXml, "Ausweichtalente"));
 
 		int ebe = EBE_KEINE_BE;
         if (eBeNode != NULL)
 			ebe = getEBeFromString(AutoChar(eBeNode->getFirstChild()->getNodeValue()).data());
 
-		CeGuiString name = XmlHelper::transcodeToString(
+		CeGuiString name = transcodeToString(
             talentXml->getAttribute(AutoXMLCh("ID").data()));
         EigenschaftTripel eigenschaften;
 		eigenschaften.first = probe.substr(0,2);
@@ -139,11 +127,11 @@
             for( unsigned int ausweich = 0; ausweich < ausweichTalentGruppen->getLength(); ausweich++ )
             {
 			    DOMElement* ausweichData = static_cast<DOMElement*>(ausweichTalentGruppen->item(ausweich));
-	            CeGuiString ausweichName = XmlHelper::transcodeToString(
+	            CeGuiString ausweichName = transcodeToString(
                     ausweichData->getAttribute(AutoXMLCh("ID").data()));
 
                 ausweichTalente[ausweichName] = 
-                    XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(ausweichData, "Aufschlag"));
+                    getValueAsInteger(getChildNamed(ausweichData, "Aufschlag"));
             }
         }
 
@@ -200,14 +188,14 @@
 
 	Kampftechnik* XdimlLoader::processKampftechnik(DOMElement* kampftechnikXml)
 	{
-		CeGuiString desc = XmlHelper::getValueAsString(XmlHelper::getChildNamed(kampftechnikXml, "Beschreibung"));
-		CeGuiString art = XmlHelper::getValueAsString(XmlHelper::getChildNamed(kampftechnikXml, "Art"));
-		DOMElement* eBeNode = XmlHelper::getChildNamed(kampftechnikXml, "eBE");
+		CeGuiString desc = getValueAsString(getChildNamed(kampftechnikXml, "Beschreibung"));
+		CeGuiString art = getValueAsString(getChildNamed(kampftechnikXml, "Art"));
+		DOMElement* eBeNode = getChildNamed(kampftechnikXml, "eBE");
 		int ebe = EBE_KEINE_BE;
 		if (eBeNode != NULL)
 			ebe = getEBeFromString(AutoChar(eBeNode->getFirstChild()->getNodeValue()).data());
 
-		CeGuiString name = XmlHelper::transcodeToString(
+		CeGuiString name = transcodeToString(
             kampftechnikXml->getAttribute(AutoXMLCh("ID").data()));
 
 		Kampftechnik* k = new Kampftechnik(
@@ -244,9 +232,9 @@
 		AutoXMLCh EIGENSCHAFT = "Eigenschaft";
 
 		CeGuiString name =
-			XmlHelper::getValueAsString(XmlHelper::getChildNamed(personXml, "Name"));
+			getValueAsString(getChildNamed(personXml, "Name"));
 		CeGuiString desc =
-			XmlHelper::getValueAsString(XmlHelper::getChildNamed(personXml, "Beschreibung"));
+			getValueAsString(getChildNamed(personXml, "Beschreibung"));
 
         //@warning replace this by correct loading process
 		Person* rval = new Person(10000);
@@ -255,13 +243,13 @@
 
 		// Eigenschaften laden
 		DOMNodeList* eigensch =
-			XmlHelper::getChildNamed(personXml, "Eigenschaften")->
+			getChildNamed(personXml, "Eigenschaften")->
 				getElementsByTagName(EIGENSCHAFT.data());
 		// Die Eigenschaftsnamen mssen durch ihre Abkrzung ersetzt werden.
 		for (unsigned int idx = 0; idx < eigensch->getLength(); idx++)
 		{
 			DOMElement* eigenschXml = static_cast<DOMElement*>(eigensch->item(idx));
-			CeGuiString eigName = XmlHelper::transcodeToString(eigenschXml->getAttribute(ID.data()));
+			CeGuiString eigName = transcodeToString(eigenschXml->getAttribute(ID.data()));
 			if (eigName == DsaManager::getSingleton().getEigenschaft(E_MUT)->getName())
 				eigName = DsaManager::getSingleton().getEigenschaft(E_MUT)->getNameAbbreviation();
 			if (eigName == DsaManager::getSingleton().getEigenschaft(E_KLUGHEIT)->getName())
@@ -278,20 +266,20 @@
 				eigName = DsaManager::getSingleton().getEigenschaft(E_KONSTITUTION)->getNameAbbreviation();
 			if (eigName == DsaManager::getSingleton().getEigenschaft(E_KOERPERKRAFT)->getName())
 				eigName = DsaManager::getSingleton().getEigenschaft(E_KOERPERKRAFT)->getNameAbbreviation();
-			int wert = XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(eigenschXml, "Wert"));
+			int wert = getValueAsInteger(getChildNamed(eigenschXml, "Wert"));
 
 			rval->setEigenschaft(eigName, wert);
 		}
 
 		// Abgeleitete Werte laden
 		DOMNodeList* werte =
-			XmlHelper::getChildNamed(personXml, "AbgeleiteteWerte")->
+			getChildNamed(personXml, "AbgeleiteteWerte")->
 				getElementsByTagName(ABGELEITETER_WERT.data());
 		for (unsigned int idx = 0; idx < werte->getLength(); idx++)
 		{
 			DOMElement* wertXml = static_cast<DOMElement*>(werte->item(idx));
-			int basis = XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(wertXml, "Basiswert"));
-			int wert = XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(wertXml, "Wert"));
+			int basis = getValueAsInteger(getChildNamed(wertXml, "Basiswert"));
+			int wert = getValueAsInteger(getChildNamed(wertXml, "Wert"));
 
 			AutoChar wertId = wertXml->getAttribute(ID.data());
 			if (strcmp(wertId.data(), "Lebensenergie") == 0)
@@ -318,13 +306,13 @@
 		// Talente, die direkt unter <Person> angeordnet sind,
         // ergeben bereits die zusammengefassten Werte
 		DOMNodeList* talente =
-			XmlHelper::getChildNamed(personXml, "Talente")->
+			getChildNamed(personXml, "Talente")->
 				getElementsByTagName(TALENT.data());
 		for (unsigned int idx = 0; idx < talente->getLength(); idx++)
 		{
 			DOMElement* talentXml = static_cast<DOMElement*>(talente->item(idx));
 
-			CeGuiString talentName = XmlHelper::transcodeToString(
+			CeGuiString talentName = transcodeToString(
                 talentXml->getAttribute(ID.data()));
 
 			Talent* tal =
@@ -333,7 +321,7 @@
 			rval->addTalent(talentName);
 			rval->setTalent(
 				talentName,
-				XmlHelper::getValueAsInteger(XmlHelper::getChildNamed(talentXml, "Wert")));
+				getValueAsInteger(getChildNamed(talentXml, "Wert")));
 		}
 		return rval;
 	}

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -44,16 +44,14 @@
     void SaveGameFileWriter::buildSaveGameFile(SaveGameFile *file)
     {
         //@toto: build
-        XMLPlatformUtils::Initialize();
+        initializeXml();
 
-        XmlHelper::initializeTranscoder();
-
         XMLCh tempStr[100];
         XMLString::transcode("LS", tempStr, 99);
         mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
-        mWriter = ((DOMImplementationLS*)mImplementation)->createDOMWriter();
+        mWriter = static_cast<DOMImplementationLS*>(mImplementation)->createDOMWriter();
         mTarget = file->getFormatTarget();
-        mDocument = ((DOMImplementation*)mImplementation)->createDocument(0, XMLString::transcode("SaveGameFile"), 0);
+        mDocument = static_cast<DOMImplementation*>(mImplementation)->createDocument(0, XMLString::transcode("SaveGameFile"), 0);
         mDocument->setNodeValue(XMLString::transcode("SaveGameFile"));
 
         if (mWriter->canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
@@ -63,12 +61,12 @@
              mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
 
         //Write modul of save game
-        DOMElement* header = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "header");
-        XmlHelper::setAttributeValueAsString(header, "ModuleID", CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
-        XmlHelper::setAttributeValueAsInteger(header, "EngineVersion", CoreSubsystem::getSingleton().getEngineBuildNumber());
+        DOMElement* header = appendChildElement(mDocument, mDocument->getDocumentElement(), "header");
+        setAttributeValueAsString(header, "ModuleID", CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
+        setAttributeValueAsInteger(header, "EngineVersion", CoreSubsystem::getSingleton().getEngineBuildNumber());
         
         //Write date and time
-        DOMElement* timeNode = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
+        DOMElement* timeNode = appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
         
         time_t rawtime;
         tm* timeinfo;
@@ -76,22 +74,22 @@
         time ( &rawtime );
         timeinfo = localtime ( &rawtime );
 
-        XmlHelper::setAttributeValueAsInteger(timeNode, "day", timeinfo->tm_mday);
-        XmlHelper::setAttributeValueAsInteger(timeNode, "month", timeinfo->tm_mon);
-        XmlHelper::setAttributeValueAsInteger(timeNode, "year", timeinfo->tm_year+1900);
+        setAttributeValueAsInteger(timeNode, "day", timeinfo->tm_mday);
+        setAttributeValueAsInteger(timeNode, "month", timeinfo->tm_mon);
+        setAttributeValueAsInteger(timeNode, "year", timeinfo->tm_year+1900);
 
-        XmlHelper::setAttributeValueAsInteger(timeNode, "hour", timeinfo->tm_hour);
-        XmlHelper::setAttributeValueAsInteger(timeNode, "minute", timeinfo->tm_min);
-        XmlHelper::setAttributeValueAsInteger(timeNode, "second", timeinfo->tm_sec);
+        setAttributeValueAsInteger(timeNode, "hour", timeinfo->tm_hour);
+        setAttributeValueAsInteger(timeNode, "minute", timeinfo->tm_min);
+        setAttributeValueAsInteger(timeNode, "second", timeinfo->tm_sec);
 
         //Write globals
-        DOMElement* globals = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
-        DOMElement* gameTime = XmlHelper::appendChildElement(mDocument, globals, "gametime");
+        DOMElement* globals = appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
+        DOMElement* gameTime = appendChildElement(mDocument, globals, "gametime");
         TimeSource* gameTimeSource = TimeSourceManager::getSingleton().getTimeSource(TimeSource::GAMETIME);
-        XmlHelper::setAttributeValueAsInteger(gameTime, "milliseconds", gameTimeSource->getClock());
+        setAttributeValueAsInteger(gameTime, "milliseconds", gameTimeSource->getClock());
 
         //Write Quests
-        DOMElement* quests = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "quests");
+        DOMElement* quests = appendChildElement(mDocument, mDocument->getDocumentElement(), "quests");
         QuestBook* questBook = RulesSubsystem::getSingleton().getQuestBook();
         PropertySet* set = questBook->getAllProperties();
         PropertySetMap::const_iterator it_quests;
@@ -101,7 +99,7 @@
         }
 
         //Write game objects
-        DOMElement* gameobjects = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "gameobjects");
+        DOMElement* gameobjects = appendChildElement(mDocument, mDocument->getDocumentElement(), "gameobjects");
         
         std::list<const GameObject*>::const_iterator it_gameobjects;
         std::list<const GameObject*> gos;
@@ -109,9 +107,9 @@
 
         for(it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
         {
-            DOMElement* gameobject = XmlHelper::appendChildElement(mDocument, gameobjects, "gameobject");
-            XmlHelper::setAttributeValueAsInteger(gameobject, "ID", (*it_gameobjects)->getId());
-            XmlHelper::setAttributeValueAsString(gameobject, "ClassID", (*it_gameobjects)->getClassId());
+            DOMElement* gameobject = appendChildElement(mDocument, gameobjects, "gameobject");
+            setAttributeValueAsInteger(gameobject, "ID", (*it_gameobjects)->getId());
+            setAttributeValueAsString(gameobject, "ClassID", (*it_gameobjects)->getClassId());
 
             PropertyMap map = (*it_gameobjects)->getAllProperties()->toPropertyMap();
             PropertyMap::iterator it_properties;
@@ -124,11 +122,16 @@
         //Write Zones?
 
         //Write scripts
-        DOMElement* scripts = XmlHelper::appendChildElement(mDocument, mDocument->getDocumentElement(), "scripts");
+        DOMElement* scripts = appendChildElement(mDocument, mDocument->getDocumentElement(), "scripts");
 
         mWriter->writeNode(mTarget, *mDocument);
 
         mWriter->release();
         delete mTarget;
+
+        mDocument->release();
+        delete mDocument;
+
+        shutdownXml();
     }
 }

Modified: rl/trunk/engine/script/include/AbstractMapNodeProcessor.h
===================================================================
--- rl/trunk/engine/script/include/AbstractMapNodeProcessor.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/include/AbstractMapNodeProcessor.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -22,11 +22,14 @@
 
 #include <OgreSceneNode.h>
 
+#include "PropertyReader.h"
+
 namespace rl
 {
     class XmlPropertyReader;
 
     class AbstractMapNodeProcessor
+        : protected XmlPropertyReader
     {
     public:
         virtual ~AbstractMapNodeProcessor();
@@ -45,11 +48,8 @@
         
         Ogre::SceneNode* getRootSceneNode() const;
         
-        XmlPropertyReader* getXmlPropertyReader() const;
-    
     private:
         Ogre::SceneNode* mRootSceneNode;
-        XmlPropertyReader* mXmlPropertyReader;
     };
 }
 

Modified: rl/trunk/engine/script/include/MapLoader.h
===================================================================
--- rl/trunk/engine/script/include/MapLoader.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/include/MapLoader.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -22,14 +22,14 @@
 
 #include <OgreSceneNode.h>
 #include <list>
+#include "XmlHelper.h"
 
 namespace rl {
 
     class AbstractMapNodeProcessor;
     class ProgressWindow;
-    class XmlPropertyReader;
 
-    class _RlScriptExport MapLoader 
+    class _RlScriptExport MapLoader : private XmlProcessor 
     {
     public:
         MapLoader(const Ogre::String& resourceGroup);
@@ -43,7 +43,6 @@
         void loadMap(const Ogre::String& mapresource, bool loadGameObjects = true);
 
     private:
-        XmlPropertyReader* mXmlPropertyProcessor;
         std::list<AbstractMapNodeProcessor*> mNodeProcessors;
 
         Ogre::SceneNode* mRootSceneNode;

Modified: rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -19,9 +19,6 @@
 
 #include <OgreColourValue.h>
 
-#include "PropertyReader.h"
-#include "XmlHelper.h"
-
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
 
@@ -29,13 +26,12 @@
 {
     AbstractMapNodeProcessor::AbstractMapNodeProcessor()
     : mRootSceneNode(NULL),
-      mXmlPropertyReader()
+      XmlPropertyReader()
     {
     }
 
     AbstractMapNodeProcessor::~AbstractMapNodeProcessor()
     {
-        delete mXmlPropertyReader;
     }
 
     Vector3 AbstractMapNodeProcessor::processVector3(DOMElement* vec3Elem) const
@@ -43,17 +39,17 @@
         Vector3 rval(Vector3::ZERO);
         if (vec3Elem != NULL)
         {
-            if (XmlHelper::hasAttribute(vec3Elem, "x"))
+            if (hasAttribute(vec3Elem, "x"))
             {
-                rval.x = XmlHelper::getAttributeValueAsReal(vec3Elem, "x");
+                rval.x = getAttributeValueAsReal(vec3Elem, "x");
             }
-            if (XmlHelper::hasAttribute(vec3Elem, "y"))
+            if (hasAttribute(vec3Elem, "y"))
             {
-                rval.y = XmlHelper::getAttributeValueAsReal(vec3Elem, "y");
+                rval.y = getAttributeValueAsReal(vec3Elem, "y");
             }
-            if (XmlHelper::hasAttribute(vec3Elem, "z"))
+            if (hasAttribute(vec3Elem, "z"))
             {
-                rval.z = XmlHelper::getAttributeValueAsReal(vec3Elem, "z");
+                rval.z = getAttributeValueAsReal(vec3Elem, "z");
             }
         }
 
@@ -65,21 +61,21 @@
         Quaternion rval(Quaternion::IDENTITY);
         if (quatElem != NULL)
         {
-            if (XmlHelper::hasAttribute(quatElem, "qw"))
+            if (hasAttribute(quatElem, "qw"))
             {
-                rval.w = XmlHelper::getAttributeValueAsReal(quatElem, "qw");
+                rval.w = getAttributeValueAsReal(quatElem, "qw");
             }
-            if (XmlHelper::hasAttribute(quatElem, "qx"))
+            if (hasAttribute(quatElem, "qx"))
             {
-                rval.x = XmlHelper::getAttributeValueAsReal(quatElem, "qx");
+                rval.x = getAttributeValueAsReal(quatElem, "qx");
             }
-            if (XmlHelper::hasAttribute(quatElem, "qy"))
+            if (hasAttribute(quatElem, "qy"))
             {
-                rval.y = XmlHelper::getAttributeValueAsReal(quatElem, "qy");
+                rval.y = getAttributeValueAsReal(quatElem, "qy");
             }
-            if (XmlHelper::hasAttribute(quatElem, "qz"))
+            if (hasAttribute(quatElem, "qz"))
             {
-                rval.z = XmlHelper::getAttributeValueAsReal(quatElem, "qz");
+                rval.z = getAttributeValueAsReal(quatElem, "qz");
             }
         }
 
@@ -91,21 +87,21 @@
         ColourValue rval(1, 1, 1, 1);
         if (colElem != NULL)
         {
-            if (XmlHelper::hasAttribute(colElem, "r"))
+            if (hasAttribute(colElem, "r"))
             {
-                rval.r = XmlHelper::getAttributeValueAsReal(colElem, "r");
+                rval.r = getAttributeValueAsReal(colElem, "r");
             }
-            if (XmlHelper::hasAttribute(colElem, "g"))
+            if (hasAttribute(colElem, "g"))
             {
-                rval.g = XmlHelper::getAttributeValueAsReal(colElem, "g");
+                rval.g = getAttributeValueAsReal(colElem, "g");
             }
-            if (XmlHelper::hasAttribute(colElem, "b"))
+            if (hasAttribute(colElem, "b"))
             {
-                rval.b = XmlHelper::getAttributeValueAsReal(colElem, "b");
+                rval.b = getAttributeValueAsReal(colElem, "b");
             }
-            if (XmlHelper::hasAttribute(colElem, "a"))
+            if (hasAttribute(colElem, "a"))
             {
-                rval.a = XmlHelper::getAttributeValueAsReal(colElem, "a");
+                rval.a = getAttributeValueAsReal(colElem, "a");
             }
         }
         return rval;
@@ -129,9 +125,4 @@
     {
         return mRootSceneNode;
     }
-
-    XmlPropertyReader* AbstractMapNodeProcessor::getXmlPropertyReader() const
-    {
-        return mXmlPropertyReader;
-    }
 }

Modified: rl/trunk/engine/script/src/EntityNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/EntityNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/EntityNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -25,7 +25,6 @@
 #include "CoreSubsystem.h"
 #include "PhysicsManager.h"
 #include "World.h"
-#include "XmlHelper.h"
 
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
@@ -40,37 +39,37 @@
 
     bool EntityNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-        if (!XmlHelper::hasNodeName(nodeElem, "entity"))
+        if (!hasNodeName(nodeElem, "entity"))
         {
             return false;
         }
 
-        Ogre::String entName = XmlHelper::getAttributeValueAsStdString(nodeElem, "name");
+        Ogre::String entName = getAttributeValueAsStdString(nodeElem, "name");
 
         LOG_DEBUG(Logger::RULES,
             "Processing entity node "
                 + entName);
 
-        if (!XmlHelper::hasAttribute(nodeElem, "meshfile"))
+        if (!hasAttribute(nodeElem, "meshfile"))
         {
             LOG_ERROR(Logger::RULES, "Entity node defines no meshfile attribute");
             return false;
         }
 
-        Ogre::String meshFile = XmlHelper::getAttributeValueAsStdString(nodeElem, "meshfile");
+        Ogre::String meshFile = getAttributeValueAsStdString(nodeElem, "meshfile");
         if (entName == "")
         {
             entName = getRandomName(meshFile);
         }
 
         //Actor* act = ActorManager::getSingleton().createMeshActor(
-        //    XmlHelper::getAttributeValueAsStdString(entityElem, "name"),
+        //    getAttributeValueAsStdString(entityElem, "name"),
         //    meshFile); ///@todo: Collision proxy
 
         Vector3 position(Vector3::ZERO);
         Quaternion orientation(Quaternion::IDENTITY);
 
-        DOMElement* posElem = XmlHelper::getChildNamed(nodeElem, "position");
+        DOMElement* posElem = getChildNamed(nodeElem, "position");
         if (posElem != NULL)
         {
             position = processVector3(posElem);
@@ -80,7 +79,7 @@
             LOG_WARNING(Logger::RULES, "No position given for entity, used (0,0,0)");
         }
 
-        DOMElement* oriElem = XmlHelper::getChildNamed(nodeElem, "rotation");
+        DOMElement* oriElem = getChildNamed(nodeElem, "rotation");
         if (oriElem != NULL)
         {
             orientation = processQuaternion(oriElem);
@@ -121,9 +120,9 @@
         }
 
         parentNode->attachObject(newEnt);
-        createCollision(newEnt, meshFile, XmlHelper::getChildNamed(nodeElem, "physicsproxy"));
+        createCollision(newEnt, meshFile, getChildNamed(nodeElem, "physicsproxy"));
 
-        DOMElement* scaleElem = XmlHelper::getChildNamed(nodeElem, "scale");
+        DOMElement* scaleElem = getChildNamed(nodeElem, "scale");
         if (scaleElem != NULL)
         {
             parentNode->scale(processVector3(scaleElem));
@@ -148,13 +147,13 @@
         std::vector<OgreNewt::CollisionPtr> collisions;
 
         Ogre::String physicsProxyType;
-        if (physicsProxyElem == NULL || !XmlHelper::hasAttribute(physicsProxyElem, "type"))
+        if (physicsProxyElem == NULL || !hasAttribute(physicsProxyElem, "type"))
         {
             physicsProxyType = "auto";
         }
         else
         {
-            physicsProxyType = XmlHelper::getAttributeValueAsStdString(physicsProxyElem, "type");
+            physicsProxyType = getAttributeValueAsStdString(physicsProxyElem, "type");
         }
 
         // ------- Falls noetig automatisch bodyproxy erstellen -------------

Modified: rl/trunk/engine/script/src/EnvironmentProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/EnvironmentProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/EnvironmentProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -31,8 +31,8 @@
 	{
 		if (nodeElem)
 		{
-		    processSkySettings(XmlHelper::getChildNamed(nodeElem, "sky"));
-		    processFogSettings(XmlHelper::getChildNamed(nodeElem, "fog"));
+		    processSkySettings(getChildNamed(nodeElem, "sky"));
+		    processFogSettings(getChildNamed(nodeElem, "fog"));
         }
 
 		return true;
@@ -43,26 +43,26 @@
         if (skyElem)
 		{
 
-		    if (!XmlHelper::hasAttribute(skyElem, "material")
-			    || !XmlHelper::hasAttribute(skyElem, "type"))
+		    if (!hasAttribute(skyElem, "material")
+			    || !hasAttribute(skyElem, "type"))
 		    {
 			    LOG_ERROR(Logger::RULES, "<sky> element must have at least attributes 'type' and 'material'.");
 		    }
 		    else
 		    {
-			    Ogre::String type = XmlHelper::getAttributeValueAsStdString(skyElem, "type");
-			    Ogre::String material = XmlHelper::getAttributeValueAsStdString(skyElem, "material");
+			    Ogre::String type = getAttributeValueAsStdString(skyElem, "type");
+			    Ogre::String material = getAttributeValueAsStdString(skyElem, "material");
 
 			    bool drawFirst = true;
-			    if (XmlHelper::hasAttribute(skyElem, "drawfirst"))
+			    if (hasAttribute(skyElem, "drawfirst"))
 			    {
-				    drawFirst = XmlHelper::getAttributeValueAsBool(skyElem, "drawfirst");
+				    drawFirst = getAttributeValueAsBool(skyElem, "drawfirst");
 			    }
 
 			    Ogre::Real distance = 5000;
-			    if (XmlHelper::hasAttribute(skyElem, "distance"))
+			    if (hasAttribute(skyElem, "distance"))
 			    {
-				    distance = XmlHelper::getAttributeValueAsReal(skyElem, "distance");
+				    distance = getAttributeValueAsReal(skyElem, "distance");
 			    }
 
 			    if (type == "dome")
@@ -70,16 +70,16 @@
 				    Ogre::Real curvature = 10;
 				    Ogre::Real tiling = 8;
 
-				    DOMElement* domeSettings = XmlHelper::getChildNamed(skyElem, "skydomesettings");
+				    DOMElement* domeSettings = getChildNamed(skyElem, "skydomesettings");
 				    if (domeSettings != NULL)
 				    {
-					    if (XmlHelper::hasAttribute(domeSettings, "curvature"))
+					    if (hasAttribute(domeSettings, "curvature"))
 					    {
-						    curvature = XmlHelper::getAttributeValueAsReal(domeSettings, "curvature");
+						    curvature = getAttributeValueAsReal(domeSettings, "curvature");
 					    }
-					    if (XmlHelper::hasAttribute(domeSettings, "tiling"))
+					    if (hasAttribute(domeSettings, "tiling"))
 					    {
-						    curvature = XmlHelper::getAttributeValueAsReal(domeSettings, "tiling");
+						    curvature = getAttributeValueAsReal(domeSettings, "tiling");
 					    }
 				    }
 				    CoreSubsystem::getSingleton().getWorld()->setSkyDome(
@@ -102,7 +102,7 @@
 	{
         if (fogElem)
         {
-		    if (!XmlHelper::hasAttribute(fogElem, "material"))
+		    if (!hasAttribute(fogElem, "material"))
 		    {
 			    LOG_ERROR(
 				    Logger::RULES,
@@ -110,7 +110,7 @@
 			    return;
 		    }
 
-		    DOMElement* colourElem = XmlHelper::getChildNamed(fogElem, "colour");
+		    DOMElement* colourElem = getChildNamed(fogElem, "colour");
 		    if (colourElem == NULL)
 		    {
 			    LOG_ERROR(Logger::RULES, "No fog colour set.");
@@ -118,12 +118,12 @@
 		    }
 		    ColourValue fogColour = processColour(colourElem);
 
-		    Ogre::String type = XmlHelper::getAttributeValueAsStdString(fogElem, "type");
+		    Ogre::String type = getAttributeValueAsStdString(fogElem, "type");
 		    if (type == "exp" || type == "exp2")
 		    {
-			    if (XmlHelper::hasAttribute(fogElem, "density"))
+			    if (hasAttribute(fogElem, "density"))
 			    {
-				    Ogre::Real density = XmlHelper::getAttributeValueAsReal(fogElem, "density");
+				    Ogre::Real density = getAttributeValueAsReal(fogElem, "density");
 				    if (type == "exp")
 				    {
 					    CoreSubsystem::getSingleton().getWorld()->setFog(
@@ -143,11 +143,11 @@
 		    }
 		    else if (type == "linear")
 		    {
-			    if (XmlHelper::hasAttribute(fogElem, "start")
-				    && XmlHelper::hasAttribute(fogElem, "end"))
+			    if (hasAttribute(fogElem, "start")
+				    && hasAttribute(fogElem, "end"))
 			    {
-				    Ogre::Real start = XmlHelper::getAttributeValueAsReal(fogElem, "start");
-				    Ogre::Real end = XmlHelper::getAttributeValueAsReal(fogElem, "end");
+				    Ogre::Real start = getAttributeValueAsReal(fogElem, "start");
+				    Ogre::Real end = getAttributeValueAsReal(fogElem, "end");
 				    CoreSubsystem::getSingleton().getWorld()->setFog(
 					    World::FOG_LINEAR, fogColour, 0, start, end);
 			    }

Modified: rl/trunk/engine/script/src/GameObjectNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/GameObjectNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/GameObjectNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -21,8 +21,6 @@
 
 #include "GameObject.h"
 #include "GameObjectManager.h"
-#include "PropertyReader.h"
-#include "XmlHelper.h"
 
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
@@ -31,34 +29,34 @@
 {
     bool GameObjectNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-        if (!XmlHelper::hasNodeName(nodeElem, "gameobject"))
+        if (!hasNodeName(nodeElem, "gameobject"))
         {
             return false;
         }
 
         LOG_DEBUG(Logger::RULES,
             "Processing game object node "
-                + XmlHelper::getAttributeValueAsStdString(nodeElem, "name"));
+                + getAttributeValueAsStdString(nodeElem, "name"));
 
-        Ogre::String classname = XmlHelper::getAttributeValueAsStdString(nodeElem, "class");
+        Ogre::String classname = getAttributeValueAsStdString(nodeElem, "class");
 
         unsigned int goid = GameObject::NO_OBJECT_ID;
 
-        if (XmlHelper::hasAttribute(nodeElem, "id"))
+        if (hasAttribute(nodeElem, "id"))
         {
-            goid = XmlHelper::getAttributeValueAsInteger(nodeElem, "id");
+            goid = getAttributeValueAsInteger(nodeElem, "id");
         }
 
         GameObject* go = GameObjectManager::getSingleton().createGameObject(classname, goid);
 
-        DOMElement* posElem = XmlHelper::getChildNamed(nodeElem, "position");
+        DOMElement* posElem = getChildNamed(nodeElem, "position");
         if (posElem != NULL)
         {
             Vector3 pos = processVector3(posElem);
             go->setPosition(pos);
         }
 
-        DOMElement* oriElem = XmlHelper::getChildNamed(nodeElem, "rotation");
+        DOMElement* oriElem = getChildNamed(nodeElem, "rotation");
         if (oriElem != NULL)
         {
             Quaternion ori = processQuaternion(oriElem);
@@ -70,9 +68,9 @@
         {
             DOMNode* cur = goElChildNodes->item(idx);
             if (cur->getNodeType() == DOMNode::ENTITY_NODE
-                && XmlHelper::hasNodeName(cur, "property"))
+                && hasNodeName(cur, "property"))
             {
-                PropertyEntry propEntry = getXmlPropertyReader()->processProperty(static_cast<DOMElement*>(cur));
+                PropertyEntry propEntry = processProperty(static_cast<DOMElement*>(cur));
                 if (propEntry.first != "")
                 {
                     go->setProperty(propEntry.first, propEntry.second);
@@ -81,9 +79,9 @@
         }
 
 		GameObjectState state = GOS_LOADED;
-		if (XmlHelper::hasAttribute(nodeElem, "state"))
+		if (hasAttribute(nodeElem, "state"))
 		{
-			Ogre::String stateStr = XmlHelper::getAttributeValueAsStdString(nodeElem, "state");
+			Ogre::String stateStr = getAttributeValueAsStdString(nodeElem, "state");
 			if (stateStr == "LOADED")
 			{
 				state = GOS_LOADED;

Modified: rl/trunk/engine/script/src/LightNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/LightNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/LightNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,8 +17,6 @@
 
 #include "LightNodeProcessor.h"
 
-#include "XmlHelper.h"
-
 #include "Actor.h"
 #include "ActorManager.h"
 
@@ -29,19 +27,19 @@
 {
     bool LightNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-        if (!XmlHelper::hasNodeName(nodeElem, "light"))
+        if (!hasNodeName(nodeElem, "light"))
         {
             return false;
         }
 
         LOG_DEBUG(Logger::RULES,
             "Processing light node "
-                + XmlHelper::getAttributeValueAsStdString(nodeElem, "name"));
+                + getAttributeValueAsStdString(nodeElem, "name"));
 
-        Ogre::String name = XmlHelper::getAttributeValueAsStdString(nodeElem, "name");
-        Ogre::String stype = XmlHelper::getAttributeValueAsStdString(nodeElem, "type");
-        bool visible = XmlHelper::getAttributeValueAsBool(nodeElem, "visible");
-        bool shadowCaster = XmlHelper::getAttributeValueAsBool(nodeElem, "castShadows");
+        Ogre::String name = getAttributeValueAsStdString(nodeElem, "name");
+        Ogre::String stype = getAttributeValueAsStdString(nodeElem, "type");
+        bool visible = getAttributeValueAsBool(nodeElem, "visible");
+        bool shadowCaster = getAttributeValueAsBool(nodeElem, "castShadows");
 
         LightObject::LightTypes type = LightObject::LT_DIRECTIONAL;
         if (stype == "point")
@@ -63,7 +61,7 @@
         }
         Actor* lightActor = ActorManager::getSingleton().createLightActor(name, type);
 
-        DOMElement* posElem = XmlHelper::getChildNamed(nodeElem, "position");
+        DOMElement* posElem = getChildNamed(nodeElem, "position");
         if (posElem != NULL)
         {
             lightActor->placeIntoScene(processVector3(posElem));
@@ -78,30 +76,30 @@
         light->setCastShadows(shadowCaster);
         light->setVisible(visible);
 
-        DOMElement* diffElem = XmlHelper::getChildNamed(nodeElem, "colourDiffuse");
+        DOMElement* diffElem = getChildNamed(nodeElem, "colourDiffuse");
         if (diffElem != NULL)
         {
             light->setDiffuseColour(processColour(diffElem));
         }
 
-        DOMElement* specElem = XmlHelper::getChildNamed(nodeElem, "colourSpecular");
+        DOMElement* specElem = getChildNamed(nodeElem, "colourSpecular");
         if (specElem != NULL)
         {
             light->setSpecularColour(processColour(specElem));
         }
 
-        DOMElement* attElem = XmlHelper::getChildNamed(nodeElem, "lightAttenuation");
+        DOMElement* attElem = getChildNamed(nodeElem, "lightAttenuation");
         if (attElem != NULL)
         {
-            if (XmlHelper::hasAttribute(attElem, "range")
-                && XmlHelper::hasAttribute(attElem, "constant")
-                && XmlHelper::hasAttribute(attElem, "linear")
-                && XmlHelper::hasAttribute(attElem, "quadratic"))
+            if (hasAttribute(attElem, "range")
+                && hasAttribute(attElem, "constant")
+                && hasAttribute(attElem, "linear")
+                && hasAttribute(attElem, "quadratic"))
             {
-                Ogre::Real range = XmlHelper::getAttributeValueAsReal(attElem, "range");
-                Ogre::Real constant = XmlHelper::getAttributeValueAsReal(attElem, "constant");
-                Ogre::Real linear = XmlHelper::getAttributeValueAsReal(attElem, "linear");
-                Ogre::Real quadratic = XmlHelper::getAttributeValueAsReal(attElem, "quadratic");
+                Ogre::Real range = getAttributeValueAsReal(attElem, "range");
+                Ogre::Real constant = getAttributeValueAsReal(attElem, "constant");
+                Ogre::Real linear = getAttributeValueAsReal(attElem, "linear");
+                Ogre::Real quadratic = getAttributeValueAsReal(attElem, "quadratic");
 
                 light->setAttenuation(range, constant, linear, quadratic);
             }
@@ -110,7 +108,7 @@
 
         if (stype == "directional")
         {
-            DOMElement* dirElem = XmlHelper::getChildNamed(nodeElem, "direction");
+            DOMElement* dirElem = getChildNamed(nodeElem, "direction");
             if (dirElem != NULL)
             {
                 light->setDirection(processVector3(dirElem));
@@ -122,15 +120,15 @@
         }
         else if (stype == "spot")
         {
-            DOMElement* rangeElem = XmlHelper::getChildNamed(nodeElem, "spotlightrange");
+            DOMElement* rangeElem = getChildNamed(nodeElem, "spotlightrange");
             if (rangeElem != NULL)
             {
-                Ogre::Real innerAngle = XmlHelper::getAttributeValueAsReal(rangeElem, "inner");
-                Ogre::Real outerAngle = XmlHelper::getAttributeValueAsReal(rangeElem, "outer");
-                if (XmlHelper::hasAttribute(rangeElem, "falloff"))
+                Ogre::Real innerAngle = getAttributeValueAsReal(rangeElem, "inner");
+                Ogre::Real outerAngle = getAttributeValueAsReal(rangeElem, "outer");
+                if (hasAttribute(rangeElem, "falloff"))
                 {
                     light->setSpotlightRange(
-                        innerAngle, outerAngle, XmlHelper::getAttributeValueAsReal(rangeElem, "falloff"));
+                        innerAngle, outerAngle, getAttributeValueAsReal(rangeElem, "falloff"));
                 }
                 else
                 {

Modified: rl/trunk/engine/script/src/MapLoader.cpp
===================================================================
--- rl/trunk/engine/script/src/MapLoader.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/MapLoader.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -15,13 +15,9 @@
 */
 #include "stdinc.h" //precompiled header
 
-#include <xercesc/dom/DOM.hpp>
-#include <xercesc/parsers/XercesDOMParser.hpp>
-#include <xercesc/util/PlatformUtils.hpp>
-
 #include "MapLoader.h"
 
-#include <OgreResourceManager.h>
+#include <xercesc/dom/DOM.hpp>
 
 #include "AbstractMapNodeProcessor.h"
 #include "CoreSubsystem.h"
@@ -36,8 +32,6 @@
 #include "WaypointProcessor.h"
 #include "World.h"
 #include "XmlHelper.h"
-#include "XmlResource.h"
-#include "XmlResourceManager.h"
 #include "ZoneProcessor.h"
 
 using namespace Ogre;
@@ -53,8 +47,6 @@
           mResourceGroup(resourceGroup),
           mPercentageWindow(NULL)
     {
-        mXmlPropertyProcessor = new XmlPropertyReader();
-
         mNodeProcessors.push_back(new EntityNodeProcessor(resourceGroup));
         mNodeProcessors.push_back(new GameObjectNodeProcessor());
         mNodeProcessors.push_back(new SoundNodeProcessor());
@@ -69,63 +61,43 @@
         {
             delete *it;
         }
-        delete mXmlPropertyProcessor;
         delete mPercentageWindow;
     }
 
     void MapLoader::loadMap(const Ogre::String& mapresource, bool loadGameObjects)
     {
         LOG_MESSAGE(Logger::RULES, "Loading map " + mapresource);
-  		XMLPlatformUtils::Initialize();
 
-		XmlHelper::initializeTranscoder();
-		XercesDOMParser* parser = new XercesDOMParser();
+  		initializeXml();
 
-        parser->setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-        parser->setDoNamespaces(true);    // optional
+        DOMDocument* doc = loadDocument(mapresource, mResourceGroup);
 
-        XmlPtr res = XmlResourceManager::getSingleton().getByName(mapresource);
-        if (res.isNull())
+        if (doc)
         {
-            Ogre::String group = ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME;
-            if (ResourceGroupManager::getSingleton().resourceExists(
-                mResourceGroup, mapresource))
-            {
-                group = mResourceGroup;
-            }
-            res = XmlResourceManager::getSingleton().create(mapresource, group);
-        }
-
-        if (!res.isNull())
-        {
-            res->parseBy(parser);
-
             setRootSceneNode(CoreSubsystem::getSingleton().getWorld()
                     ->getSceneManager()->getRootSceneNode()->createChildSceneNode(mapresource));
 
-            DOMDocument* doc = parser->getDocument();
-            DOMElement* dataDocumentContent = doc->getDocumentElement();
-
 			CoreSubsystem::getSingleton().getWorld()->initializeDefaultCamera();
 			///@todo: Window fade jobs don't work if Core is paused, think about solution for: CoreSubsystem::getSingleton().setPaused(true);
 
             LOG_MESSAGE(Logger::RULES, "Processing nodes");
 
-            processSceneNodes(XmlHelper::getChildNamed(dataDocumentContent, "nodes"), loadGameObjects);
+            DOMElement* dataDocumentContent = doc->getDocumentElement();
+            processSceneNodes(getChildNamed(dataDocumentContent, "nodes"), loadGameObjects);
 
 			ZoneProcessor zp;
-			zp.processNode(XmlHelper::getChildNamed(dataDocumentContent, "zones"), loadGameObjects);
+			zp.processNode(getChildNamed(dataDocumentContent, "zones"), loadGameObjects);
 
 			EnvironmentProcessor ep;
-			ep.processNode(XmlHelper::getChildNamed(dataDocumentContent, "environment"), loadGameObjects);
+			ep.processNode(getChildNamed(dataDocumentContent, "environment"), loadGameObjects);
 
 			WaypointProcessor wp;
-			wp.processNode(XmlHelper::getChildNamed(dataDocumentContent, "waypoints"), loadGameObjects);
+			wp.processNode(getChildNamed(dataDocumentContent, "waypoints"), loadGameObjects);
 
-            LOG_MESSAGE(Logger::RULES, "Map loaded");
-
             doc->release();
 
+            LOG_MESSAGE(Logger::RULES, "Map loaded");
+
 			CoreSubsystem::getSingleton().getWorld()->initializeDefaultCamera();
 			///@todo: Window fade jobs don't work if Core is paused, think about solution for: CoreSubsystem::getSingleton().setPaused(false);
         }
@@ -134,7 +106,8 @@
             LOG_ERROR(Logger::RULES, "Map resource '" + mapresource + "' not found");
         }
 
-		XMLPlatformUtils::Terminate();
+
+        shutdownXml();
     }
 
     void MapLoader::processSceneNodes(DOMElement* nodesElem, bool loadGameObjects)
@@ -165,7 +138,7 @@
                 if (it == mNodeProcessors.end())
                 {
                     LOG_WARNING(Logger::RULES,
-                        "Node " + XmlHelper::transcodeToString(curElem->getNodeName()) + " could not be processed.");
+                        "Node " + transcodeToString(curElem->getNodeName()) + " could not be processed.");
                 }
             }
 

Modified: rl/trunk/engine/script/src/ParticleSystemNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/ParticleSystemNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/ParticleSystemNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,8 +17,6 @@
 
 #include "ParticleSystemNodeProcessor.h"
 
-#include "XmlHelper.h"
-
 #include "Actor.h"
 #include "ActorManager.h"
 #include "ParticleSystemObject.h"
@@ -30,30 +28,30 @@
 {
     bool ParticleSystemNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-		if (!XmlHelper::hasNodeName(nodeElem, "particlesystem"))
+		if (!hasNodeName(nodeElem, "particlesystem"))
 		{
 			return false;
 		}
 
-		if (!XmlHelper::hasAttribute(nodeElem, "material"))
+		if (!hasAttribute(nodeElem, "material"))
 		{
 			LOG_WARNING(Logger::SCRIPT, "Particle system nodes must at least have the attribute 'material'.");
 			return false;
 		}
 
-		Ogre::String name = XmlHelper::getAttributeValueAsStdString(nodeElem, "name");
+		Ogre::String name = getAttributeValueAsStdString(nodeElem, "name");
 
 		LOG_DEBUG(Logger::SCRIPT,
             "Processing particle system node " + name);
 
-		Ogre::String material = XmlHelper::getAttributeValueAsStdString(nodeElem, "material");
+		Ogre::String material = getAttributeValueAsStdString(nodeElem, "material");
 
 		Actor* part = ActorManager::getSingleton().createParticleSystemActor(
 			name, material);
 
-		if (XmlHelper::hasAttribute(nodeElem, "active"))
+		if (hasAttribute(nodeElem, "active"))
 		{
-			bool active = XmlHelper::getAttributeValueAsBool(nodeElem, "active");
+			bool active = getAttributeValueAsBool(nodeElem, "active");
 			static_cast<ParticleSystemObject*>(part->getControlledObject())->setActive(active);
 		}
 

Modified: rl/trunk/engine/script/src/SoundNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/SoundNodeProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/SoundNodeProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,8 +17,6 @@
 
 #include "SoundNodeProcessor.h"
 
-#include "XmlHelper.h"
-
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
 
@@ -26,14 +24,14 @@
 {
     bool SoundNodeProcessor::processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects)
     {
-        if (!XmlHelper::hasNodeName(nodeElem, "sound"))
+        if (!hasNodeName(nodeElem, "sound"))
         {
             return false;
         }
 
         LOG_DEBUG(Logger::RULES,
             "Processing sound node "
-                + XmlHelper::getAttributeValueAsStdString(nodeElem, "name"));
+                + getAttributeValueAsStdString(nodeElem, "name"));
 
 
 

Modified: rl/trunk/engine/script/src/WaypointProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/WaypointProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/WaypointProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -20,7 +20,6 @@
 #include "AiSubsystem.h"
 #include "Landmark.h"
 #include "LandmarkPath.h"
-#include "XmlHelper.h"
 
 using namespace XERCES_CPP_NAMESPACE;
 using namespace Ogre;
@@ -36,11 +35,11 @@
 
 		for (DOMNode* cur = nodeElem->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
 		{
-			if (cur->getNodeType() == DOMNode::ELEMENT_NODE && XmlHelper::hasNodeName(cur, "landmark"))
+			if (cur->getNodeType() == DOMNode::ELEMENT_NODE && hasNodeName(cur, "landmark"))
 			{
 				DOMElement* elem = static_cast<DOMElement*>(cur);
-				Ogre::String name = XmlHelper::getAttributeValueAsStdString(elem, "name");
-				DOMElement* posChild = XmlHelper::getChildNamed(elem, "position");
+				Ogre::String name = getAttributeValueAsStdString(elem, "name");
+				DOMElement* posChild = getChildNamed(elem, "position");
 				if (name != "" && posChild != NULL)
 				{
 					AiSubsystem::getSingleton().createLandmark(
@@ -51,7 +50,7 @@
 
 		for (DOMNode* cur = nodeElem->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
 		{
-			if (cur->getNodeType() == DOMNode::ELEMENT_NODE && XmlHelper::hasNodeName(cur, "landmarkgraph"))
+			if (cur->getNodeType() == DOMNode::ELEMENT_NODE && hasNodeName(cur, "landmarkgraph"))
 			{
 				DOMElement* elem = static_cast<DOMElement*>(cur);
 				///@todo process waypointgraph
@@ -63,11 +62,11 @@
 					curPathChild != NULL; curPathChild = curPathChild->getNextSibling())
 				{
 					if (curPathChild->getNodeType() == DOMNode::ELEMENT_NODE
-						&& XmlHelper::hasNodeName(curPathChild, "landmark"))
+						&& hasNodeName(curPathChild, "landmark"))
 					{
 						DOMElement* curLmElem = static_cast<DOMElement*>(curPathChild);
 						Landmark* lm = AiSubsystem::getSingleton().getLandmark(
-							XmlHelper::getAttributeValueAsStdString(curLmElem, "name"));
+							getAttributeValueAsStdString(curLmElem, "name"));
 
 						if (lm != NULL)
 						{

Modified: rl/trunk/engine/script/src/ZoneProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -22,7 +22,6 @@
 #include "ScriptSubsystem.h"
 #include "Trigger.h"
 #include "TriggerFactory.h"
-#include "XmlHelper.h"
 #include "Zone.h"
 #include "ZoneManager.h"
 
@@ -42,12 +41,12 @@
         for (DOMNode* cur = zonesElem->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
         {
             if (cur->getNodeType() == DOMNode::ELEMENT_NODE
-				&& XmlHelper::hasNodeName(cur, "zone"))
+				&& hasNodeName(cur, "zone"))
             {
 				DOMElement* curZoneElem = static_cast<DOMElement*>(cur);
-				if (XmlHelper::hasAttribute(curZoneElem, "name"))
+				if (hasAttribute(curZoneElem, "name"))
 				{
-					Ogre::String name = XmlHelper::getAttributeValueAsStdString(curZoneElem, "name");
+					Ogre::String name = getAttributeValueAsStdString(curZoneElem, "name");
                     Zone* zone = NULL;
                     if( name == "default" )
                         zone = ZoneManager::getSingleton().getDefaultZone();
@@ -62,55 +61,55 @@
                         for(DOMNode* curArea = cur->getFirstChild(); curArea != NULL; curArea = curArea->getNextSibling())
                         {
                             if( curArea->getNodeType() == DOMNode::ELEMENT_NODE
-                                && XmlHelper::hasNodeName(curArea, "area") )
+                                && hasNodeName(curArea, "area") )
                             {
                                 DOMElement *curAreaElem = static_cast<DOMElement*>(curArea);
-                                if( XmlHelper::hasAttribute(curAreaElem, "type") )
+                                if( hasAttribute(curAreaElem, "type") )
                                 {
                                     // type
                                     Ogre::String type;
-                                    type = XmlHelper::getAttributeValueAsStdString(curAreaElem, "type");
+                                    type = getAttributeValueAsStdString(curAreaElem, "type");
 
                                     // add or subtract?
                                     bool subtract = false;
-                                    if( XmlHelper::hasAttribute(curAreaElem, "subtract") )
-                                        subtract = XmlHelper::getAttributeValueAsBool(curAreaElem, "subtract");
+                                    if( hasAttribute(curAreaElem, "subtract") )
+                                        subtract = getAttributeValueAsBool(curAreaElem, "subtract");
 
                                     // position
                                     Vector3 position = Vector3::ZERO;
-                                    DOMElement* positionElem = XmlHelper::getChildNamed(curAreaElem, "position");
+                                    DOMElement* positionElem = getChildNamed(curAreaElem, "position");
                                     if( positionElem != NULL )
-                                        position = XmlHelper::getValueAsVector3(positionElem);
+                                        position = getValueAsVector3(positionElem);
 
                                     //scale, rotation, offset
                                     Vector3 scale = Vector3::UNIT_SCALE;
-                                    DOMElement* scaleElem = XmlHelper::getChildNamed(curAreaElem, "scale");
+                                    DOMElement* scaleElem = getChildNamed(curAreaElem, "scale");
                                     if( scaleElem != NULL )
-                                        scale = XmlHelper::getValueAsVector3(scaleElem);
+                                        scale = getValueAsVector3(scaleElem);
 
                                     Vector3 offset = Vector3::ZERO;
-                                    DOMElement* offsetElem = XmlHelper::getChildNamed(curAreaElem, "offset");
+                                    DOMElement* offsetElem = getChildNamed(curAreaElem, "offset");
                                     if( offsetElem != NULL )
-                                        offset = XmlHelper::getValueAsVector3(offsetElem);
+                                        offset = getValueAsVector3(offsetElem);
 
                                     Quaternion rotation = Quaternion::IDENTITY;
-                                    DOMElement* rotationElem = XmlHelper::getChildNamed(curAreaElem, "rotation");
+                                    DOMElement* rotationElem = getChildNamed(curAreaElem, "rotation");
                                     if( rotationElem != NULL )
-                                        rotation = XmlHelper::getValueAsQuaternion(rotationElem);
+                                        rotation = getValueAsQuaternion(rotationElem);
 
                                     //transition distance
                                     Real transitionDistance = 0;
-                                    DOMElement* transitionElem = XmlHelper::getChildNamed(curAreaElem, "transition_distance");
+                                    DOMElement* transitionElem = getChildNamed(curAreaElem, "transition_distance");
                                     if( transitionElem != NULL )
-                                        transitionDistance = XmlHelper::getValueAsReal(transitionElem);
+                                        transitionDistance = getValueAsReal(transitionElem);
 
 					            
                                     if (type == "mesh")
     					            {
                                         Ogre::String meshName;
-                                        if( XmlHelper::hasAttribute(curAreaElem, "meshfile") )
+                                        if( hasAttribute(curAreaElem, "meshfile") )
                                         {
-                                            meshName = XmlHelper::getAttributeValueAsStdString(curAreaElem, "meshfile");
+                                            meshName = getAttributeValueAsStdString(curAreaElem, "meshfile");
                                             if( subtract )
                                                 ZoneManager::getSingleton().subtractMeshAreaFromZone(name,
                                                     meshName, GT_CONVEXHULL, position, scale, offset, rotation, transitionDistance, QUERYFLAG_PLAYER);
@@ -168,29 +167,29 @@
 							if (cur->getNodeType() == DOMNode::ELEMENT_NODE)
 							{
 								DOMElement* curElem = static_cast<DOMElement*>(cur);
-								if (XmlHelper::hasNodeName(curElem, "light"))
+								if (hasNodeName(curElem, "light"))
 								{
-									Ogre::String name = XmlHelper::getAttributeValueAsStdString(curElem, "name");
+									Ogre::String name = getAttributeValueAsStdString(curElem, "name");
 									zone->addLight(ActorManager::getSingleton().getActor(name));
 								}
-								else if (XmlHelper::hasNodeName(curElem, "sound"))
+								else if (hasNodeName(curElem, "sound"))
 								{
-									Ogre::String name = XmlHelper::getAttributeValueAsStdString(curElem, "name");
+									Ogre::String name = getAttributeValueAsStdString(curElem, "name");
 									zone->addSound(name);
 								}
-								else if (XmlHelper::hasNodeName(curElem, "trigger"))
+								else if (hasNodeName(curElem, "trigger"))
 								{
 									Ogre::String classname =
-										XmlHelper::getAttributeValueAsStdString(curElem, "classname");
+										getAttributeValueAsStdString(curElem, "classname");
 
 									Trigger* trigger = ScriptSubsystem::getSingleton().getTriggerFactory()
 										->createTrigger(classname);
 
 									///@todo trigger properties
 								}
-                                else if (XmlHelper::hasNodeName(curElem, "eaxpreset"))
+                                else if (hasNodeName(curElem, "eaxpreset"))
                                 {
-									Ogre::String name = XmlHelper::getAttributeValueAsStdString(curElem, "name");
+									Ogre::String name = getAttributeValueAsStdString(curElem, "name");
                                     zone->setEaxPreset(name);
                                 }
 							}

Modified: rl/trunk/engine/ui/include/InputManager.h
===================================================================
--- rl/trunk/engine/ui/include/InputManager.h	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ui/include/InputManager.h	2007-09-08 20:22:19 UTC (rev 3825)
@@ -25,11 +25,12 @@
 #include <OgreRenderWindow.h>
 #include <OgreSingleton.h>
 
+#include <stack>
+
 #include "FixRubyHeaders.h"
 #include "GameTask.h"
+#include "XmlHelper.h"
 
-#include <stack>
-
 namespace rl {
 
     class AbstractWindow;
@@ -39,7 +40,8 @@
 
     class _RlUiExport InputManager
         :    public Ogre::Singleton<InputManager>,
-            public GameTask
+            public GameTask,
+            private XmlProcessor
     {
     public:
 

Modified: rl/trunk/engine/ui/src/InputManager.cpp
===================================================================
--- rl/trunk/engine/ui/src/InputManager.cpp	2007-09-07 18:12:37 UTC (rev 3824)
+++ rl/trunk/engine/ui/src/InputManager.cpp	2007-09-08 20:22:19 UTC (rev 3825)
@@ -17,18 +17,13 @@
 
 #include "InputManager.h"
 
-#include <xercesc/parsers/XercesDOMParser.hpp>
 #include <xercesc/dom/DOM.hpp>
-#include <xercesc/util/XMLString.hpp>
-#include <xercesc/util/PlatformUtils.hpp>
 
 #include <OISInputManager.h>
 
 #include "Exception.h"
 
 #include "XmlHelper.h"
-#include "XmlResource.h"
-#include "XmlResourceManager.h"
 
 #include "AbstractWindow.h"
 #include "Action.h"
@@ -250,76 +245,43 @@
         using XERCES_CPP_NAMESPACE::DOMDocument;
         using std::make_pair;
 
-        XMLPlatformUtils::Initialize();
-        XmlHelper::initializeTranscoder();
+        initializeXml();
 
-        XercesDOMParser* parser = new XercesDOMParser();
-        parser->setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-        parser->setDoNamespaces(true);    // optional
-
-/*        ErrorHandler* errHandler = (ErrorHandler*) new HandlerBase();
-        parser->setErrorHandler(errHandler);*/
-
-        XMLCh* ALT = XMLString::transcode("AltChar");
-        XMLCh* SHIFT = XMLString::transcode("ShiftChar");
-        XMLCh* NORMAL = XMLString::transcode("NormalChar");
-        XMLCh* DESCR = XMLString::transcode("KeyDescription");
-        XMLCh* CODE = XMLString::transcode("KeyCode");
-        XMLCh* KEY = XMLString::transcode("Key");
-
-        XmlPtr res =
-            XmlResourceManager::getSingleton().create(
-            filename,
-            ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME);
-        res->parseBy(parser);
-        DOMDocument* doc = parser->getDocument();
+        DOMDocument* doc = loadDocument(filename);
         DOMElement* dataDocumentContent = doc->getDocumentElement();
 
-        DOMNodeList* keymaps = dataDocumentContent->getElementsByTagName(KEY);
+        DOMNodeList* keymaps 
+            = dataDocumentContent->getElementsByTagName(AutoXMLCh("Key").data());
         for (unsigned int idx = 0; idx < keymaps->getLength(); idx++)
         {
             DOMElement* key = static_cast<DOMElement*>(keymaps->item(idx));
-            int keycode = XMLString::parseInt(key->getAttribute(CODE));
+            int keycode = getAttributeValueAsInteger(key, "KeyCode");
 
-            const XMLCh* xmlch;
-
-            xmlch = key->getAttribute(NORMAL);
-            if (xmlch != NULL && XMLString::stringLen(xmlch) > 0)
+            CeGuiString s;
+            s = getAttributeValueAsString(key, "NormalChar");
+            if (!s.empty())
             {
-                CeGuiString s(XmlHelper::transcodeToString(xmlch));
                 mKeyMapNormal.insert(make_pair(keycode, s[0]));
             }
 
-            xmlch = key->getAttribute(ALT);
-            if (xmlch != NULL && XMLString::stringLen(xmlch) > 0)
+            s = getAttributeValueAsString(key, "AltChar");
+            if (!s.empty())
             {
-                CeGuiString s(XmlHelper::transcodeToString(xmlch));
                 mKeyMapAlt.insert(make_pair(keycode, s[0]));
             }
 
-            xmlch = key->getAttribute(SHIFT);
-            if (xmlch != NULL && XMLString::stringLen(xmlch) > 0)
+            s = getAttributeValueAsString(key, "ShiftChar");
+            if (!s.empty())
             {
-                CeGuiString s(XmlHelper::transcodeToString(xmlch));
                 mKeyMapShift.insert(make_pair(keycode, s[0]));
             }
 
-            xmlch = key->getAttribute(DESCR);
-            mKeyNames.insert(make_pair(keycode, XmlHelper::transcodeToString(xmlch)));
+            s = getAttributeValueAsString(key, "KeyDescription");
+            mKeyNames.insert(make_pair(keycode, s));
         }
 
-        XMLString::release(&ALT);
-        XMLString::release(&SHIFT);
-        XMLString::release(&NORMAL);
-        XMLString::release(&CODE);
-        XMLString::release(&DESCR);
-        XMLString::release(&KEY);
-
         doc->release();
-        XMLPlatformUtils::Terminate();
-
-        //XmlResourceManager::getSingleton().remove(filename);
-        //res.setNull();
+        shutdownXml();
     }
 
     const CEGUI::utf8& InputManager::getKeyChar(int scancode, int modifiers) const



From blakharaz at mail.berlios.de  Sat Sep  8 22:24:26 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:24:26 +0200
Subject: [Dsa-hl-svn] r3826 - in rl/trunk/engine: ai/src script/swig
Message-ID: <200709082024.l88KOQhY004946@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:24:18 +0200 (Sat, 08 Sep 2007)
New Revision: 3826

Modified:
   rl/trunk/engine/ai/src/WayPointGraph.cpp
   rl/trunk/engine/script/swig/RlAi.swig
Log:
Load WayPointGraph from XML files

Modified: rl/trunk/engine/ai/src/WayPointGraph.cpp
===================================================================
--- rl/trunk/engine/ai/src/WayPointGraph.cpp	2007-09-08 20:22:19 UTC (rev 3825)
+++ rl/trunk/engine/ai/src/WayPointGraph.cpp	2007-09-08 20:24:18 UTC (rev 3826)
@@ -16,16 +16,20 @@
 #include "stdinc.h" //precompiled header
 
 #include "WayPointGraph.h"
-#include "WayPointNode.h"
+
 #include <algorithm>
-#include "OgreVector3.h"
+#include <xercesc/dom/DOM.hpp>
+
+#include "ConfigurationManager.h"
+#include "ContentModule.h"
 #include "CoreSubsystem.h"
-#include "World.h"
 #include "Exception.h"
 #include "LineSetPrimitive.h"
-#include "ConfigurationManager.h"
+#include "WayPointNode.h"
+#include "World.h"
 
 using namespace std;
+using namespace Ogre;
 
 namespace rl {
 
@@ -54,7 +58,7 @@
     }
 }
 
-WayPointNode* WayPointGraph::addWayPoint(const Ogre::Vector3& position, const WayPointNode::WayPointNodeType type)
+WayPointNode* WayPointGraph::addWayPoint(const Vector3& position, const WayPointNode::WayPointNodeType type)
 {
 	WayPointNodeList::iterator it;
 
@@ -69,7 +73,7 @@
 
 }
 
-WayPointNode* WayPointGraph::rawAddWayPoint(const Ogre::Vector3& position, const WayPointNode::WayPointNodeType type)
+WayPointNode* WayPointGraph::rawAddWayPoint(const Vector3& position, const WayPointNode::WayPointNodeType type)
 {
 	WayPointNode* newWayPoint = new WayPointNode(position, type);
 	mNodeList.push_back(newWayPoint);
@@ -91,7 +95,7 @@
 	mChanged = true;
 }
 
-void WayPointGraph::load (const Ogre::String& filename)
+void WayPointGraph::loadBinary(const Ogre::String& filename)
 {
 	// fetch modules directory
 	Ogre::String modulespath(
@@ -127,7 +131,7 @@
 	input.getline(line, sizeof(line));
 
 	// read in the points
-	Ogre::Vector3 Position;
+	Vector3 Position;
 	WayPointNode::WayPointNodeType type;
 	unsigned int count = 0;
 	while (!input.eof() && count < numberOfNodes)
@@ -177,7 +181,7 @@
 	mChanged = true;
 }
 
-void WayPointGraph::save (const Ogre::String& filename) const
+void WayPointGraph::saveBinary(const Ogre::String& filename) const
 {
 	unsigned int count;
 	WayPointNodeList::const_iterator it;
@@ -203,7 +207,7 @@
 	// save the full list of points
 	// and construct an index map for the nodes
 	count = 0;
-	Ogre::Vector3 Position;
+	Vector3 Position;
 	WayPointNode::WayPointNodeType type;
 	for (it = mNodeList.begin(); it != mNodeList.end(); it++)
 	{
@@ -243,11 +247,75 @@
 	output.close();
 }
 
-const WayPointNode* WayPointGraph::getNearestWayPoint(const Ogre::Vector3& position) const
+void WayPointGraph::load(const Ogre::String& filename, const Ogre::String& resourceGroup)
 {
+    using namespace XERCES_CPP_NAMESPACE;
+
+    Ogre::String group = resourceGroup;
+    if (group.empty())
+    {
+        group = CoreSubsystem::getSingleton().getActiveAdventureModule()->getId();
+    }
+
+    initializeXml();
+
+    DOMDocument* doc = loadDocument(filename, group);
+    if (doc)
+    {
+        DOMElement* rootElem = doc->getDocumentElement();
+
+        DOMElement* nodesElem = getChildNamed(rootElem, "waypointnodes");
+        std::map<int, WayPointNode*> lookupTable;
+        for (DOMNode* curNode = nodesElem->getFirstChild(); curNode; curNode = curNode->getNextSibling())
+        {
+            if (curNode->getNodeType() == DOMNode::ELEMENT_NODE
+                || hasNodeName(curNode, "node"))
+            {
+                DOMElement* curElem = static_cast<DOMElement*>(curNode);
+
+                Vector3 pos = getValueAsVector3(curElem);
+                CeGuiString typeS = getAttributeValueAsString(curElem, "type");
+                int id = getAttributeValueAsInteger(curElem, "id");
+
+                WayPointNode::WayPointNodeType type = WayPointNode::WP_UNKNOWN;
+                if (typeS == "int")
+                {
+                    type = WayPointNode::WP_INTERIOR;
+                }
+                else if (typeS == "ext")
+                {
+                    type = WayPointNode::WP_EXTERIOR;
+                }
+
+                WayPointNode* node = addWayPoint(pos, type);
+                lookupTable[id] = node;
+            }
+        }
+
+        DOMElement* edgesElem = getChildNamed(rootElem, "waypointedges");
+        for (DOMNode* curNode = edgesElem->getFirstChild(); curNode; curNode = curNode->getNextSibling())
+        {
+            if (curNode->getNodeType() == DOMNode::ELEMENT_NODE
+                || hasNodeName(curNode, "edge"))
+            {
+                DOMElement* curElem = static_cast<DOMElement*>(curNode);
+                int source = getAttributeValueAsInteger(curElem, "source");
+                int destination = getAttributeValueAsInteger(curElem, "destination");
+                addDirectedConnection(lookupTable[source], lookupTable[destination]);
+            }
+        }
+
+        doc->release();
+    }
+
+    shutdownXml();
+}
+
+const WayPointNode* WayPointGraph::getNearestWayPoint(const Vector3& position) const
+{
 	WayPointNodeList::const_iterator it;
 	WayPointNode* nearestWayPoint = NULL;
-	Ogre::Vector3 nearestVec;
+	Vector3 nearestVec;
 	Ogre::Real nearestDistance;
 
 	// if list is empty simply return no waypoint
@@ -318,14 +386,14 @@
 	std::multimap<const WayPointNode*,const WayPointNode*>::iterator edgeListIt;
 
 	WayPointNodeList::const_iterator it;
-	Ogre::Vector3 wp1Vec;
-	Ogre::Vector3 wp2Vec;
+	Vector3 wp1Vec;
+	Vector3 wp2Vec;
 
 	for (it = mNodeList.begin(); it != mNodeList.end(); it++)
 	{
 		wp1Vec = (*it)->getPosition();
 		// draw the waypoint itself
-		lineSet->addLine(wp1Vec, wp1Vec + Ogre::Vector3(0,1,0), Ogre::ColourValue::Red);
+		lineSet->addLine(wp1Vec, wp1Vec + Vector3(0,1,0), Ogre::ColourValue::Red);
 
 		const WayPointNode::WayPointWeightNodeList subnodes = (*it)->getNeighbours();
 		WayPointNode::WayPointWeightNodeList::const_iterator nit;

Modified: rl/trunk/engine/script/swig/RlAi.swig
===================================================================
--- rl/trunk/engine/script/swig/RlAi.swig	2007-09-08 20:22:19 UTC (rev 3825)
+++ rl/trunk/engine/script/swig/RlAi.swig	2007-09-08 20:24:18 UTC (rev 3826)
@@ -16,9 +16,9 @@
 
 %include std_vector.i
 
-//namespace std {
-//	%template(Ogrevec3Vector) vector<Ogre::Vector3 >;
-//};
+namespace std {
+	%template(Ogrevec3Vector) vector<Ogre::Vector3 >;
+};
 
 namespace rl 
 {
@@ -253,8 +253,8 @@
 		WayPointNode* addWayPoint(const Ogre::Vector3& position, const WayPointNode::WayPointNodeType type);
 		void addConnection(rl::WayPointNode* wp1, rl::WayPointNode* wp2);
 		void addDirectedConnection(rl::WayPointNode* wp1, const rl::WayPointNode* wp2);
-		void load (const Ogre::String& filename);
-		void save (const Ogre::String& filename) const;
+		void load(const Ogre::String& filename);
+		void saveBinary(const Ogre::String& filename) const;
 		const rl::WayPointNode* getNearestWayPoint(const Ogre::Vector3& position) const;
 		const rl::WayPointNode* getWayPointAt(unsigned int index) const;
 	};



From blakharaz at mail.berlios.de  Sat Sep  8 22:26:51 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:26:51 +0200
Subject: [Dsa-hl-svn] r3827 - rl/trunk/engine/common/include
Message-ID: <200709082026.l88KQpqb005056@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:26:48 +0200 (Sat, 08 Sep 2007)
New Revision: 3827

Added:
   rl/trunk/engine/common/include/XmlPropertyReader.h
Removed:
   rl/trunk/engine/common/include/PropertyReader.h
Log:
Renamed remotely

Deleted: rl/trunk/engine/common/include/PropertyReader.h
===================================================================
--- rl/trunk/engine/common/include/PropertyReader.h	2007-09-08 20:24:18 UTC (rev 3826)
+++ rl/trunk/engine/common/include/PropertyReader.h	2007-09-08 20:26:48 UTC (rev 3827)
@@ -1,54 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#ifndef __PropertyReader_H__
-#define __PropertyReader_H__
-
-#include "CommonPrerequisites.h"
-
-#include <xercesc/dom/DOMAttr.hpp>
-#include <xercesc/dom/DOMElement.hpp>
-#include <OgreDataStream.h>
-
-#include "XmlHelper.h"
-
-namespace rl 
-{
-    class Property;
-    class PropertySet;
-
-    typedef std::pair<Ogre::String, Property> PropertyEntry;
-
-    class _RlCommonExport XmlPropertyReader
-         : protected XmlProcessor
-    {
-    public:
-        XmlPropertyReader();
-
-        void parseGameObjectFile(Ogre::DataStreamPtr &stream, const Ogre::String &groupName);
-        std::vector<PropertySet*> getPropertySets();
-
-        PropertyEntry processProperty(XERCES_CPP_NAMESPACE::DOMElement* domElem) const;
-		PropertyEntry processProperty(XERCES_CPP_NAMESPACE::DOMAttr* domAttr) const;
-
-    private:
-        std::vector<PropertySet*> mPropertySets;
-
-        Property getProperty(const Ogre::String& key, const CeGuiString& value);
-    };
-} // namespace rl
-
-#endif //__PropertyReader_H__

Copied: rl/trunk/engine/common/include/XmlPropertyReader.h (from rev 3826, rl/trunk/engine/common/include/PropertyReader.h)



From blakharaz at mail.berlios.de  Sat Sep  8 22:27:12 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:27:12 +0200
Subject: [Dsa-hl-svn] r3828 - rl/trunk/engine/common/include
Message-ID: <200709082027.l88KRCGk005108@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:27:07 +0200 (Sat, 08 Sep 2007)
New Revision: 3828

Added:
   rl/trunk/engine/common/include/XmlPropertyWriter.h
Removed:
   rl/trunk/engine/common/include/PropertyWriter.h
Log:
Renamed remotely

Deleted: rl/trunk/engine/common/include/PropertyWriter.h
===================================================================
--- rl/trunk/engine/common/include/PropertyWriter.h	2007-09-08 20:26:48 UTC (rev 3827)
+++ rl/trunk/engine/common/include/PropertyWriter.h	2007-09-08 20:27:07 UTC (rev 3828)
@@ -1,64 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#ifndef __PropertyWriter_H__
-#define __PropertyWriter_H__
-
-#include "CommonPrerequisites.h"
-
-#include <xercesc/dom/DOM.hpp>
-#include <xercesc/dom/DOMAttr.hpp>
-#include <xercesc/dom/DOMElement.hpp>
-#include <OgreDataStream.h>
-
-#include "Property.h"
-#include "XmlHelper.h"
-
-namespace rl 
-{
-    class Property;
-    class PropertySet;
-
-    typedef std::pair<Ogre::String, Property> PropertyEntry;
-
-    class _RlCommonExport XmlPropertyWriter
-        : protected XmlProcessor
-    {
-    public:
-        XmlPropertyWriter();
-        virtual ~XmlPropertyWriter();
-
-        std::vector<PropertySet*> getPropertySets();
-        void setPropertySets(std::vector<PropertySet*> sets);
-        void addPropertySet(PropertySet* set);
-
-        XERCES_CPP_NAMESPACE::DOMElement* processProperty(XERCES_CPP_NAMESPACE::DOMElement* parent, PropertyEntry entry);
-        XERCES_CPP_NAMESPACE::DOMElement* processPropertySet(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertySet set);
-        XERCES_CPP_NAMESPACE::DOMElement* processPropertyArray(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyVector vector);
-        XERCES_CPP_NAMESPACE::DOMElement* processPropertyMap(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyMap map);
-    protected:
-        std::vector<PropertySet*> mPropertySets;
-
-        XERCES_CPP_NAMESPACE::DOMDocument* mDocument;
-        XERCES_CPP_NAMESPACE::DOMImplementation* mImplementation;
-        XERCES_CPP_NAMESPACE::DOMWriter* mWriter;
-        XERCES_CPP_NAMESPACE::XMLFormatTarget* mTarget;
-
-        Property getProperty(const Ogre::String& key, const CeGuiString& value);
-    };
-} // namespace rl
-
-#endif //__PropertyWriter_H__

Copied: rl/trunk/engine/common/include/XmlPropertyWriter.h (from rev 3827, rl/trunk/engine/common/include/PropertyWriter.h)



From blakharaz at mail.berlios.de  Sat Sep  8 22:28:05 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:28:05 +0200
Subject: [Dsa-hl-svn] r3829 - rl/trunk/engine/common/include
Message-ID: <200709082028.l88KS5BU005180@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:27:59 +0200 (Sat, 08 Sep 2007)
New Revision: 3829

Added:
   rl/trunk/engine/common/include/XmlProcessor.h
Removed:
   rl/trunk/engine/common/include/XmlHelper.h
Log:
Renamed remotely

Deleted: rl/trunk/engine/common/include/XmlHelper.h
===================================================================
--- rl/trunk/engine/common/include/XmlHelper.h	2007-09-08 20:27:07 UTC (rev 3828)
+++ rl/trunk/engine/common/include/XmlHelper.h	2007-09-08 20:27:59 UTC (rev 3829)
@@ -1,548 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
- */
-
-#ifndef __XmlHelper_h__
-#define __XmlHelper_h__
-
-#include <OgreDataStream.h>
-
-#include <xercesc/dom/DOMElement.hpp>
-#include <xercesc/util/XMLChar.hpp>
-#include <xercesc/util/TransService.hpp>
-#include <xercesc/sax/ErrorHandler.hpp>
-#include <xercesc/sax2/Attributes.hpp>
-
-class XERCES_CPP_NAMESPACE::SAXParseException;
-
-#include "CommonPrerequisites.h"
-
-#include "Tripel.h"
-
-// Da sollten wir uns auf etwas einigen
-// So ist das laestig.
-#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
-#   pragma warning (push)
-#   pragma warning (disable : 4267)
-#   include <CEGUIString.h>
-#   pragma warning (pop)
-#else
-#   include <CEGUI/CEGUIString.h>
-#endif
-using XERCES_CPP_NAMESPACE::XMLTranscoder;
-using XERCES_CPP_NAMESPACE::XMLTransService;
-using XERCES_CPP_NAMESPACE::Attributes;
-using CEGUI::utf8;
-using CEGUI::String;
-
-namespace rl {
-
-/**
- * This class offers helper methods for XML processing
- * To use this method, just privately inherit this class 
- */
-class _RlCommonExport XmlProcessor
-    : public XERCES_CPP_NAMESPACE::ErrorHandler
-{
-public:
-    
-    /**
-	 * Erzeugt einen Kindknoten eines DOM-Elements, das einen bestimmten Namen hat, 
-	 * dieser ist wiederum ein Element-Knoten
-	 *
-     * @param doc Das DOM-Document
-	 * @param parent Knoten, dessen Kind erzeugt wird
-	 * @param name Name des Kindknotens von parent
-	 *
-	 * @return Der Kindknoten
-	 */
-    XERCES_CPP_NAMESPACE::DOMElement* appendChildElement(XERCES_CPP_NAMESPACE::DOMDocument* doc, 
-        XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name) const;
-
-    /**
-	 * Ermittelt einen Kindknoten eines DOM-Elements, das einen bestimmten Namen hat, 
-	 * dieser ist wiederum ein Element-Knoten
-	 *
-	 * @param parent Knoten, dessen Kinder gesucht sind
-	 * @param name Name des gesuchten Kindknotens von parent
-	 *
-	 * @return Der Kindknoten
-	 */
-	XERCES_CPP_NAMESPACE::DOMElement* getChildNamed(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name) const;
-	
-    /**
-	 * Setzt den Text eines Elementknotens
-	 *
-	 * @param element Das DOM-Element
-     * @param string Der zu setzende String
-	 * @return Das DOM-Element
-	 */
-    XERCES_CPP_NAMESPACE::DOMElement* setValueAsString(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, const CeGuiString &value) const;
-    
-    /**
-	 * Ermittelt den Text eines Elementknotens
-	 *
-	 * @param element Das DOM-Element
-	 * @return Text innerhalb der Element-Tags, als CeGuiString
-	 */
-	CeGuiString getValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element) const;
-	
-    /**
-	 * Ermittelt den Text eines Elementknotens
-	 *
-	 * @param element Das DOM-Element
-	 * @return Text innerhalb der Element-Tags, als CeGuiString
-	 */
-    std::string getValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element) const;
-
-    /**
-	 * Setzt den Text eines Elementknotens, als UTF-8
-	 * vor Benutzung muss initializeTranscoder() aufgerufen werden
-	 *
-	 * @param element Das DOM-Element
-     * @param utf Der zu setzende UTF String
-	 * @return Das DOM-Element
-	 */
-	XERCES_CPP_NAMESPACE::DOMElement* setValueAsUtf8(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, utf8* value) const;
-    
-    /**
-	 * Ermittelt den Text eines Elementknotens, als UTF-8
-	 * vor Benutzung muss initializeTranscoder() aufgerufen werden
-	 *
-	 * @param element Das DOM-Element
-	 * @return Text innerhalb der Element-Tags, als utf8* (muss selbst gel?scht werden)
-	 * @see initializeTranscoder()
-	 */
-	utf8* getValueAsUtf8(XERCES_CPP_NAMESPACE::DOMElement* element) const;
-
-	/**
-	 * Formt eine Ganzzahl in einen String um und setzt diesen als Wert
-	 *
-	 * @param element Das DOM-Element
-     * @param value Der zu setzende Integer
-	 * @return Das DOM-Element
-	 */
-	XERCES_CPP_NAMESPACE::DOMElement* setValueAsInteger(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, int value) const;
-
-    
-    /**
-	 * Ermittelt den Text eines Elementknotens und parst ihn, 
-	 * um eine Ganzzahl daraus zu machen
-	 *
-	 * @param element Das DOM-Element
-	 * @return Zahl, die innerhalb der Element-Tags steht
-	 */
-	int getValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element) const;
-
-    /**
-	 * Ermittelt den Text eines Elementknotens und parst ihn, 
-	 * um eine Ganzzahl daraus zu machen
-	 *
-	 * @param element Das DOM-Element
-	 * @return Zahl, die innerhalb der Element-Tags steht
-	 */
-    Ogre::Real getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element) const;
-
-    /**
-	 * Formt einen Ganzzahldubel in einen String um und setzt diesen als Wert
-	 *
-	 * @param element Das DOM-Element
-     * @param value Das zu setzende IntegerPair
-	 * @return Das DOM-Element
-	 */
-    XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, IntPair value) const;
-
-    /**
-	 * Ermittelt den Text eines Elementknotens und parst ihn, 
-	 * um einen Ganzzahldubel daraus zu machen
-	 *
-	 * @param element Das DOM-Element
-	 * @return Zahl, die innerhalb der Element-Tags steht
-	 */
-    IntPair getValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element) const;
-
-    /**
-	 * Formt einen Ganzzahltripel in einen String um und setzt diesen als Wert
-	 *
-	 * @param element Das DOM-Element
-     * @param value Der zu setzende Tripel<int>
-	 * @return Das DOM-Element
-	 */
-    XERCES_CPP_NAMESPACE::DOMElement* setValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMDocument* doc, XERCES_CPP_NAMESPACE::DOMElement* element, Tripel<int> value) const;
-
-    /**
-	 * Ermittelt den Text eines Elementknotens und parst ihn, 
-	 * um einen Ganzzahltripel daraus zu machen
-	 *
-	 * @param element Das DOM-Element
-	 * @return Zahl, die innerhalb der Element-Tags steht
-	 */
-    Tripel<int> getValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element) const;
-	
-    /**
-     * Convert a vector3 to an xml tag
-	 *
-	 * @param element The DOM element
-     * @param value The vector input
-	 * @return The DOM element
-	 */
-    XERCES_CPP_NAMESPACE::DOMElement* setValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Vector3 value) const;
-
-    /**
-	 * Processes an element node of shape <any_node_name x="0" y="0" z="0"/>
-	 * into a three component Ogre vector
-	 *
-	 * @param element The DOM element
-	 * @return the vector
-	 */
-	Ogre::Vector3 getValueAsVector3(XERCES_CPP_NAMESPACE::DOMElement* element) const;
-
-    /**
-     * Convert a quaternion to an xml tag
-	 *
-	 * @param element The DOM element
-     * @param value The quaternion input
-	 * @return The DOM element
-	 */
-    XERCES_CPP_NAMESPACE::DOMElement* setValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element, Ogre::Quaternion value) const;
-
-    /**
-	 * Processes an element node of shape <any_node_name x="0" y="0" z="0" w="1"/>
-	 * into a three component Ogre vector
-	 *
-	 * @param element The DOM element
-	 * @return the quaternion
-	 */
-    Ogre::Quaternion getValueAsQuaternion(XERCES_CPP_NAMESPACE::DOMElement* element) const;
-
-	
-    /**
-	 * Ermittelt, ob ein DOMElement ein bestimmtes Attribut bestitzt
-	 *
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-	 * @return <code>true</code>, wenn das Attribut an diesem Element existiert, sonst <code>false</code>
-	 */
-	bool hasAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
-
-    /**
-	 * Setzt den Wert von einem Attribut eines Elementes
-	 *
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-     * @param value Wert der gesetzt werden muss
-	 * @return <code>true</code>, wenn das Attribut an diesem Element existiert, sonst <code>false</code>
-	 */
-    void setAttribute(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const char* const value) const;
-
-    /**
-	 * Checks whether a DOMNode has a certain name
-	 *
-	 * @param node the DOM node
-	 * @param name the name to check
-	 * @return <code>true</code>, if the DOM node the name <code>name</code>, <code>false</code> otherwise
-	 */
-	bool hasNodeName(XERCES_CPP_NAMESPACE::DOMNode* node, const char* const name) const;
-
-    
-    /**
-	 * Wandelt eine Ganzzahl in einen Text um und setzt diesen als Attribut 
-	 *
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-     * @param value das zu setzende Integer
-	 * @return Das DOM-Element
-	 */
-	XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, int value) const;
-
-    /**
-	 * Ermittelt den Text eines DOMElement-Attributes und parst ihn, 
-	 * um eine Ganzzahl daraus zu machen
-	 *
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-     * @return Zahlenwert des Attributes
-	 */
-	int getAttributeValueAsInteger(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
-
-    /**
-	 * Wandelt eine Ganzzahldubel in einen Text um und setzt diesen als Attribut 
-	 *
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-     * @param value das zu setzende IntegerPair
-	 * @return Das DOM-Element
-	 */
-    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, IntPair value) const;
-
-    /**
-	 * Ermittelt den Text eines DOMElement-Attributes und parst ihn, 
-	 * um eine Ganzzahldubel daraus zu machen
-	 *
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-     * @return Zahlendubel des Attributes
-	 */
-    IntPair getAttributeValueAsIntegerPair(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
-
-    /**
-	 * Wandelt eine Ganzzahltripel in einen Text um und setzt diesen als Attribut 
-	 *
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-     * @param value das zu setzende Tripel<int>
-	 * @return Das DOM-Element
-	 */
-    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Tripel<int> value) const;
-
-    /**
-	 * Ermittelt den Text eines DOMElement-Attributes und parst ihn, 
-	 * um eine Ganzzahltripel daraus zu machen
-	 *
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-     * @return Zahlendubel des Attributes
-	 */
-    Tripel<int> getAttributeValueAsIntegerTriple(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
-	
-	/**
-	 * Setzt den Text eines DOMElement-Attributes
-	 * 
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-	 * @param value das zu setzende CeGuiString
-	 * @return Das DOM-Element
-	 */	
-	XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const CeGuiString &value) const;
-    
-    /**
-	 * Ermittelt den Text eines DOMElement-Attributes und konvertiert ihn zu einem CeGuiString
-	 * 
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-	 * @return Konvertierter Text als CeGuiString
-	 */	
-	CeGuiString getAttributeValueAsString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
-
-    /**
-	 * Setzt den Text eines DOMElement-Attributes
-	 * 
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-	 * @param value der zu setzende std::string
-	 * @return Das DOM-Element
-	 */	
-    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, const std::string &value) const;
-
-	/**
-	 * Ermittelt den Text eines DOMElement-Attributes und konvertiert ihn zu einem std::string
-	 * 
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-	 * @return Konvertierter Text als std::string
-	 */	
-    std::string getAttributeValueAsStdString(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
-	
-    /**
-	 * Ermittelt den Text eines SAX Element-Attributes und konvertiert ihn zu einem CeGuiString
-	 *
-	 * @param element Liste aller Attribute des aktuellen Elementes
-	 * @param name Name des Attributes
-	 * @return Konvertierter Text als CeGuiString
-	 */
-	CeGuiString getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes& attributes, const char* const name) const;
-
-    /**
-	 * Setzt den Text eines DOMElement-Attributes
-	 * 
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-	 * @param value der zu setzende boolean
-	 * @return Das DOM-Element
-	 */	
-	XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, bool value) const;
-
-	/**
-	 * Ermittelt den Text eines DOMElement-Attributes und interpretier ihn als bool
-	 * 
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-	 * @return Konvertierter Text als bool
-	 */	
-	bool getAttributeValueAsBool(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
-
-    /**
-	 * Setzt den Text eines DOMElement-Attributes
-	 * 
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-	 * @param value der zu setzende Real Wert
-	 * @return Das DOM-Element
-	 */	
-    XERCES_CPP_NAMESPACE::DOMElement* setAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name, Ogre::Real value) const;
-
-	/**
-	 * Ermittelt den Text eines DOMElement-Attributes und konvertiert ihn zu Ogre::Real
-	 * 
-	 * @param element Das DOM-Element
-	 * @param name Name des Attributes
-	 * @return Konvertierter Text als Ogre::Real
-	 */	
-	Ogre::Real getAttributeValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element, const char* const name) const;
-
-
-	/**
-	 * Initialisiert den XML<->UTF-8 Transcoder, 
-	 * davor muss XMLPlatformUtils::Initialize() aufgerufen worden sein
-	 */
-	void initializeTranscoder();
-
-	/**
-	 * Konvertiert einen Xerces-XMLCh* in eine CeGuiString
-	 * Intern wird eine Konvertierung in utf8* vorgenommen,
-	 * wobei man sich hier um das nachtr?gliche aufr?umen 
-	 * nicht mehr zu k?mmern braucht.
-	 * 
-	 * @param string16 Der zu konvertierende Xerces-XMLCh*
-	 * @return Konvertierter Text als CeGuiString
-	 * @see transcodeToUtf8(const XMLCh* const string16) const;
-	 */
-	CeGuiString transcodeToString(const XMLCh* const string16) const;
-
-	std::string transcodeToStdString(const XMLCh* const string16) const;
-
-    XERCES_CPP_NAMESPACE::DOMDocument* loadDocument(
-        const Ogre::String& resourceName, const Ogre::String& resourceGroup = "");
-    XERCES_CPP_NAMESPACE::DOMDocument* loadDocument(
-        const Ogre::DataStreamPtr& stream);
-
-    void initializeXml();
-    void shutdownXml();
-
-        virtual void warning(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
-        virtual void error(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
-        virtual void fatalError(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
-        virtual void resetErrors();
-
-private:
-	static XMLTranscoder* sTranscoder;
-	static XMLTransService::Codes sFailCode;
-
-        std::string toString( const std::string& type,
-                              const XERCES_CPP_NAMESPACE::SAXParseException& exc ) const;
-        
-        std::string mOpenXmlFileName;
-
-	/**
-	 * Konvertiert ein Xerces-XMLCh* in einen UTF-8-String
-	 * Vor Benutzung muss initializeTranscoder() aufgerufen werden
-	 *
-	 * @param string16 Der zu konvertierende Xerces-XMLCh*
-	 * @return Konvertierter Text als utf8* (muss selbst gel?scht werden)
-	 * @see initializeTranscoder()
-	 */
-	utf8* transcodeToUtf8(const XMLCh* const string16) const;
-};
-
-class _RlCommonExport AutoXMLCh
-{
-public:
-    AutoXMLCh() : mData(0) { }
-
-    AutoXMLCh(const char* rhs) : mData(0)
-    {
-        mData = XERCES_CPP_NAMESPACE::XMLString::transcode(rhs);
-    }
-
-    AutoXMLCh(const AutoXMLCh& rhs) : mData(0)
-    {
-        mData = XERCES_CPP_NAMESPACE::XMLString::replicate(rhs.mData);
-    }
-
-    ~AutoXMLCh()
-    {
-        XERCES_CPP_NAMESPACE::XMLString::release(&mData);
-    }
-
-    const AutoXMLCh& operator=(const AutoXMLCh& rhs)
-    {
-        if (mData != NULL)
-        {
-            XERCES_CPP_NAMESPACE::XMLString::release(&mData);
-        }
-        mData = XERCES_CPP_NAMESPACE::XMLString::replicate(rhs.mData);
-        return *this;
-    }
-
-    const AutoXMLCh& operator=(const char* rhs)
-    {
-        if (mData != NULL)
-        {
-            XERCES_CPP_NAMESPACE::XMLString::release(&mData);
-        }
-        mData = XERCES_CPP_NAMESPACE::XMLString::transcode(rhs);
-        return *this;
-    }
-
-    XMLCh* data() const { return mData; }
-private:
-    XMLCh* mData;
-};
-
-class _RlCommonExport AutoChar
-{
-public:
-    AutoChar() : mData(0) { }
-
-    AutoChar(const XMLCh* str) : mData(0)
-    {
-        mData = XERCES_CPP_NAMESPACE::XMLString::transcode(str);
-    }
-
-    AutoChar(const AutoChar& rhs) : mData(0)
-    {
-        mData = XERCES_CPP_NAMESPACE::XMLString::replicate(rhs.mData);
-    }
-
-    ~AutoChar()
-    {
-        XERCES_CPP_NAMESPACE::XMLString::release(&mData);
-    }
-
-    const AutoChar& operator=(const AutoChar& rhs)
-    {
-        XERCES_CPP_NAMESPACE::XMLString::release(&mData);
-        mData = XERCES_CPP_NAMESPACE::XMLString::replicate(rhs.mData);
-        return *this;
-    }
-
-    const AutoChar& operator=(XMLCh* rhs)
-    {
-        if (mData != NULL)
-        {
-            XERCES_CPP_NAMESPACE::XMLString::release(&mData);
-        }
-        mData = XERCES_CPP_NAMESPACE::XMLString::transcode(rhs);
-        return *this;
-    }
-
-    char* data() const { return mData; }
-private:
-    char* mData;
-};
-
-}
-
-#endif

Copied: rl/trunk/engine/common/include/XmlProcessor.h (from rev 3828, rl/trunk/engine/common/include/XmlHelper.h)



From blakharaz at mail.berlios.de  Sat Sep  8 22:31:18 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:31:18 +0200
Subject: [Dsa-hl-svn] r3830 - rl/trunk/engine/common/src
Message-ID: <200709082031.l88KVIAN005354@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:31:16 +0200 (Sat, 08 Sep 2007)
New Revision: 3830

Added:
   rl/trunk/engine/common/src/XmlProcessor.cpp
Removed:
   rl/trunk/engine/common/src/XmlHelper.cpp
Log:
Renamed remotely

Deleted: rl/trunk/engine/common/src/XmlHelper.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlHelper.cpp	2007-09-08 20:27:59 UTC (rev 3829)
+++ rl/trunk/engine/common/src/XmlHelper.cpp	2007-09-08 20:31:16 UTC (rev 3830)
@@ -1,573 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
- */
-
-#include "stdinc.h" //precompiled header
-
-#include <CEGUIPropertyHelper.h>
-#include <OgreResourceManager.h>
-#include <xercesc/dom/DOM.hpp>
-#include <xercesc/parsers/XercesDOMParser.hpp>
-#include <xercesc/util/PlatformUtils.hpp>
-#include <xercesc/sax/SAXParseException.hpp>
-
-#include "Exception.h"
-#include "Logger.h"
-#include "OgreXercesInput.h"
-#include "XmlErrorHandler.h"
-#include "XmlHelper.h"
-#include "XmlResource.h"
-#include "XmlResourceManager.h"
-
-using namespace Ogre;
-using namespace XERCES_CPP_NAMESPACE;
-
-namespace rl 
-{
-
-XERCES_CPP_NAMESPACE::XMLTranscoder* XmlProcessor::sTranscoder = NULL;
-XERCES_CPP_NAMESPACE::XMLTransService::Codes XmlProcessor::sFailCode = XERCES_CPP_NAMESPACE::XMLTransService::Ok;
-
-DOMElement* XmlProcessor::appendChildElement(DOMDocument* doc, DOMElement* parent, const char* const name) const
-{
-    RlAssert(parent != NULL, "XmlProcessor::appendChildElement: parent must not be NULL" );
-
-    DOMElement* child = doc->createElement(XMLString::transcode(name));
-    parent->appendChild(child);
-    return child;
-}
-
-DOMElement* XmlProcessor::getChildNamed(DOMElement* parent, const char* const name) const
-{
-    RlAssert(parent != NULL, "XmlProcessor::getChildNamed: parent must not be NULL" );
-
-	AutoXMLCh nameXml = name;
-
-	DOMElement* rval = 0;
-	
-	for (DOMNode* cur = parent->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
-	{
-		if (cur->getNodeType() == DOMNode::ELEMENT_NODE &&
-			XMLString::compareString(cur->getNodeName(), nameXml.data()) == 0)
-		{
-			rval = static_cast<DOMElement*>(cur);
-			break;
-		}
-	}
-
-	return rval;
-}
-
-DOMElement* XmlProcessor::setValueAsString(DOMDocument* doc, DOMElement *element, const CeGuiString &value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setValueAsString: Element must not be NULL");
-    DOMText* text = doc->createTextNode(XMLString::transcode(value.c_str()));
-    element->appendChild(text);
-    return element;
-}
-
-CeGuiString XmlProcessor::getValueAsString(DOMElement* element) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getValueAsString: Element must not be NULL");
-	return transcodeToString( element->getFirstChild()->getNodeValue() );
-}
-
-std::string XmlProcessor::getValueAsStdString(DOMElement* element) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getValueAsStdString: Element must not be NULL");
-	return transcodeToStdString( element->getFirstChild()->getNodeValue() );
-}
-
-DOMElement* XmlProcessor::setValueAsUtf8(DOMDocument* doc, DOMElement* element, utf8* value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setValueAsUtf8: Element must not be NULL");
-    CeGuiString temp(value);
-    DOMText* text = doc->createTextNode(XMLString::transcode(temp.c_str()));
-    element->appendChild(text);
-    return element;
-}
-
-utf8* XmlProcessor::getValueAsUtf8(DOMElement* element) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getValueAsUtf8: Element must not be NULL");
-	return XmlProcessor::transcodeToUtf8(element->getFirstChild()->getNodeValue());
-}
-
-bool XmlProcessor::hasAttribute(DOMElement* element,const char* const name) const
-{
-    RlAssert(element != NULL, "XmlProcessor::hasAttribute: Element must not be NULL");
-    AutoXMLCh attrName(name);
-    bool rVal = element->hasAttribute(attrName.data());
-    return rVal;
-}
-
-bool XmlProcessor::hasNodeName(DOMNode* node, const char* const name) const
-{
-    RlAssert(node != NULL, "XmlProcessor::hasNodeName: node must not be NULL");
-    XMLCh* nodeName = XMLString::transcode(name);
-    int ival = XMLString::compareString(node->getNodeName(), nodeName);
-    bool rVal = (0 == ival);
-    XMLString::release(&nodeName);
-    return rVal;
-}
-
-void XmlProcessor::setAttribute(DOMElement* element, const char* const name, const char* const value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setAttribute: Element must not be NULL");
-    AutoXMLCh attrName(name);
-    element->setAttribute(attrName.data(), XMLString::transcode(value));
-}
-
-DOMElement* XmlProcessor::setAttributeValueAsInteger(DOMElement *element, const char *const name, int value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsInteger: Element must not be NULL");
-	AutoXMLCh attrName(name);
-    CeGuiString temp = Ogre::StringConverter::toString(value);
-    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
-    return element;
-}
-
-int XmlProcessor::getAttributeValueAsInteger(DOMElement* element,const char* const name) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsInteger: Element must not be NULL");
-	AutoXMLCh attrName(name);
-	const XMLCh* attribute = element->getAttribute(attrName.data());
-	int rVal = XMLString::parseInt(attribute);
-	return rVal;
-}
-
-DOMElement* XmlProcessor::setAttributeValueAsIntegerPair(DOMElement* element, const char* const name, IntPair value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsIntegerPair: Element must not be NULL");
-	AutoXMLCh attrName(name);
-    CeGuiString temp = Ogre::StringConverter::toString(value.first) + "," + Ogre::StringConverter::toString(value.second);
-    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
-    return element;
-}
-
-IntPair XmlProcessor::getAttributeValueAsIntegerPair(DOMElement* element, const char* const name) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsIntegerPair: Element must not be NULL");
-	AutoXMLCh attrName(name);
-	const XMLCh* attribute = element->getAttribute(attrName.data());
-	
-    CeGuiString value = transcodeToString(attribute);
-    CeGuiString::size_type comma1 = value.find(",");
-
-	std::pair<int,int> intPairVal = std::make_pair(0, 0);
-    if (comma1 != CeGuiString::npos)
-    {
-		intPairVal = std::make_pair(
-			CEGUI::PropertyHelper::stringToInt(value.substr(0, comma1)),
-			CEGUI::PropertyHelper::stringToInt(value.substr(comma1 + 1)));
-    }
-
-    return intPairVal;
-}
-
-DOMElement* XmlProcessor::setAttributeValueAsIntegerTriple(DOMElement *element, const char *const name, Tripel<int> value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsIntegerTriple: Element must not be NULL");
-	AutoXMLCh attrName(name);
-    CeGuiString temp = Ogre::StringConverter::toString(value.first) + "," + Ogre::StringConverter::toString(value.second) + "" + Ogre::StringConverter::toString(value.third);
-    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
-    return element;
-}
-
-Tripel<int> XmlProcessor::getAttributeValueAsIntegerTriple(DOMElement* element, const char* const name) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsIntegerTriple: Element must not be NULL");
-	AutoXMLCh attrName(name);
-	const XMLCh* attribute = element->getAttribute(attrName.data());
-
-    CeGuiString value = transcodeToString(attribute);
-
-    CeGuiString::size_type comma1 = value.find(",");
-    CeGuiString::size_type comma2 = value.find(",", comma1 + 1);
-
-    Tripel<int> intTripel(0,0,0);
-    if (comma1 != CeGuiString::npos && comma2 != CeGuiString::npos)
-    {
-        intTripel.first = CEGUI::PropertyHelper::stringToFloat(value.substr(0, comma1));
-        intTripel.second = CEGUI::PropertyHelper::stringToFloat(value.substr(comma1 + 1, comma2 - comma1 - 1));
-        intTripel.third = CEGUI::PropertyHelper::stringToFloat(value.substr(comma2 + 1));
-    }
-
-    return intTripel;
-}
-
-DOMElement* XmlProcessor::setAttributeValueAsReal(DOMElement *element, const char *const name, Ogre::Real value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsReal: Element must not be NULL");
-	AutoXMLCh attrName(name);
-    CeGuiString temp = Ogre::StringConverter::toString(value);
-    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
-    return element;
-}
-
-Ogre::Real XmlProcessor::getAttributeValueAsReal(DOMElement* element,const char* const name) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsReal: Element must not be NULL");
-	AutoXMLCh attrName(name);
-	Ogre::Real rVal = Ogre::StringConverter::parseReal(
-		transcodeToString(element->getAttribute(attrName.data())).c_str() );
-	return rVal;
-}
-
-DOMElement* XmlProcessor::setAttributeValueAsString(DOMElement *element, const char *const name, const CeGuiString &value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsString: Element must not be NULL");
-	AutoXMLCh attrName(name);
-    element->setAttribute(attrName.data(), XMLString::transcode(value.c_str()));
-    return element;
-}
-
-CeGuiString XmlProcessor::getAttributeValueAsString(DOMElement* element, const char* const name) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsString: Element must not be NULL");
-	AutoXMLCh attrName(name);
-	CeGuiString rVal(transcodeToString(element->getAttribute(attrName.data())));
-	return rVal;
-}
-
-CeGuiString XmlProcessor::getAttributeValueAsString(const XERCES_CPP_NAMESPACE::Attributes& attributes, const char* const name) const
-{
-	AutoXMLCh attrName(name);
-	const XMLCh* valStr = attributes.getValue(attrName.data());
-	if (valStr != NULL)
-	{
-		return transcodeToString(valStr);
-	}
-	return CeGuiString();
-}
-
-DOMElement* XmlProcessor::setAttributeValueAsStdString(DOMElement *element, const char *const name, const std::string &value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsStdString: Element must not be NULL");
-	AutoXMLCh attrName(name);
-    element->setAttribute(attrName.data(), XMLString::transcode(value.c_str()));
-    return element;
-}
-
-std::string XmlProcessor::getAttributeValueAsStdString(DOMElement* element, const char* const name) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsStdString: Element must not be NULL");
-	AutoXMLCh attrName(name);
-	std::string rVal(transcodeToStdString(element->getAttribute(attrName.data())));
-	return rVal;
-}
-
-DOMElement* XmlProcessor::setAttributeValueAsBool(DOMElement *element, const char *const name, bool value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setAttributeValueAsBool: Element must not be NULL");
-	AutoXMLCh attrName(name);
-    CeGuiString temp = Ogre::StringConverter::toString(value);
-    element->setAttribute(attrName.data(), XMLString::transcode(temp.c_str()));
-    return element;
-}
-
-bool XmlProcessor::getAttributeValueAsBool(DOMElement* element,const char* const name) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getAttributeValueAsBool: Element must not be NULL");
-	if ( XMLString::compareIString(getAttributeValueAsString(element, name).c_str(),"true") == 0  )
-		return true;
-	else
-		return false;
-}
-
-DOMElement* XmlProcessor::setValueAsInteger(DOMDocument* doc, DOMElement *element, int value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setValueAsInteger: Element must not be NULL");
-    CeGuiString temp = Ogre::StringConverter::toString(value);
-    DOMText* text = doc->createTextNode(XMLString::transcode(temp.c_str()));
-    element->appendChild(text);
-    return element;
-}
-
-int XmlProcessor::getValueAsInteger(DOMElement* element) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getValueAsInteger: Element must not be NULL");
-	return XMLString::parseInt(element->getFirstChild()->getNodeValue());
-}
-
-Ogre::Real XmlProcessor::getValueAsReal(XERCES_CPP_NAMESPACE::DOMElement* element) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getValueAsInteger: Element must not be NULL");
-    return Ogre::StringConverter::parseReal(
-        transcodeToString(element->getFirstChild()->getNodeValue()).c_str());
-}
-
-DOMElement* XmlProcessor::setValueAsIntegerPair(DOMDocument *doc, DOMElement *element, IntPair value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setValueAsIntegerPair: Element must not be NULL");
-    CeGuiString temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second);
-    DOMText* text = doc->createTextNode(XMLString::transcode(temp.c_str()));
-    element->appendChild(text);
-    return element;
-}
-
-IntPair XmlProcessor::getValueAsIntegerPair(DOMElement* element) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getValueAsIntegerPair: Element must not be NULL");
-    CeGuiString value = getValueAsString(element);
-    CeGuiString::size_type comma1 = value.find(",");
-
-	std::pair<int,int> intPairVal = std::make_pair(0, 0);
-    if (comma1 != CeGuiString::npos)
-    {
-		intPairVal = std::make_pair(
-			CEGUI::PropertyHelper::stringToInt(value.substr(0, comma1)),
-			CEGUI::PropertyHelper::stringToInt(value.substr(comma1 + 1)));
-    }
-    return intPairVal;
-}
-
-DOMElement* XmlProcessor::setValueAsIntegerTriple(DOMDocument *doc, DOMElement *element, Tripel<int> value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setValueAsIntegerTriple: Element must not be NULL");
-    RlAssert(element != NULL, "XmlProcessor::setValueAsIntegerPair: Element must not be NULL");
-    CeGuiString temp = CEGUI::PropertyHelper::intToString(value.first) + ',' + CEGUI::PropertyHelper::intToString(value.second) + ',' + CEGUI::PropertyHelper::intToString(value.third);
-    DOMText* text = doc->createTextNode(XMLString::transcode(temp.c_str()));
-    element->appendChild(text);
-    return element;
-}
-
-Tripel<int> XmlProcessor::getValueAsIntegerTriple(DOMElement *element) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getValueAsIntegerTriple: Element must not be NULL");
-    CeGuiString value = getValueAsString(element);
-
-    CeGuiString::size_type comma1 = value.find(",");
-    CeGuiString::size_type comma2 = value.find(",", comma1 + 1);
-
-    Tripel<int> intTripel(0,0,0);
-    if (comma1 != CeGuiString::npos && comma2 != CeGuiString::npos)
-    {
-        intTripel.first = CEGUI::PropertyHelper::stringToFloat(value.substr(0, comma1));
-        intTripel.second = CEGUI::PropertyHelper::stringToFloat(value.substr(comma1 + 1, comma2 - comma1 - 1));
-        intTripel.third = CEGUI::PropertyHelper::stringToFloat(value.substr(comma2 + 1));
-    }
-    return intTripel;
-}
-
-DOMElement* XmlProcessor::setValueAsVector3( DOMElement *element, Ogre::Vector3 value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setValueAsVector3: Element must not be NULL");
-    setAttribute(element, "x", Ogre::StringConverter::toString(value.x).c_str());
-    setAttribute(element, "y", Ogre::StringConverter::toString(value.y).c_str());
-    setAttribute(element, "z", Ogre::StringConverter::toString(value.z).c_str());
-    return element;
-}
-
-Ogre::Vector3 XmlProcessor::getValueAsVector3(DOMElement* element) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getValueAsVector3: Element must not be NULL");
-	RlAssert(
-		hasAttribute(element, "x") 
-		&& hasAttribute(element, "y") 
-		&& hasAttribute(element, "z"),
-		"Element must have attributes x, y and z");
-	return Ogre::Vector3(
-		getAttributeValueAsReal(element, "x"),
-		getAttributeValueAsReal(element, "y"),
-		getAttributeValueAsReal(element, "z"));
-}
-
-DOMElement* XmlProcessor::setValueAsQuaternion(DOMElement *element, Ogre::Quaternion value) const
-{
-    RlAssert(element != NULL, "XmlProcessor::setValueAsQuaternion: Element must not be NULL");
-    setAttribute(element, "x", Ogre::StringConverter::toString(value.x).c_str());
-    setAttribute(element, "y", Ogre::StringConverter::toString(value.y).c_str());
-    setAttribute(element, "z", Ogre::StringConverter::toString(value.z).c_str());
-    setAttribute(element, "w", Ogre::StringConverter::toString(value.w).c_str());
-    return element;
-}
-
-Ogre::Quaternion XmlProcessor::getValueAsQuaternion(DOMElement* element) const
-{
-    RlAssert(element != NULL, "XmlProcessor::getValueAsQuaternion: Element must not be NULL");
-	RlAssert(
-		hasAttribute(element, "x") 
-		&& hasAttribute(element, "y") 
-		&& hasAttribute(element, "z")
-        && hasAttribute(element, "w"),
-		"Element must have attributes x, y z and w");
-    return Ogre::Quaternion(
-		getAttributeValueAsReal(element, "x"),
-		getAttributeValueAsReal(element, "y"),
-		getAttributeValueAsReal(element, "z"),
-        getAttributeValueAsReal(element, "w"));
-}
-
-utf8* XmlProcessor::transcodeToUtf8(const XMLCh* const string16) const
-{
-	unsigned int str16len = XMLString::stringLen(string16);
-	if (str16len == 0)
-		return (utf8*)"";
-
-	utf8* rval;
-	unsigned int eaten = 0;
-	unsigned int size = str16len;
-
-	do
-	{
-		rval = new utf8[size+1];
-	
-		sTranscoder->transcodeTo(string16, str16len, rval, size, eaten, XMLTranscoder::UnRep_RepChar);
-		rval[size] = 0;
-
-		if (eaten < str16len)
-		{
-			size += str16len - eaten;
-			delete[] rval;
-		}
-	}
-	while (eaten < str16len);
-
-	return rval;	
-}
-
-CeGuiString XmlProcessor::transcodeToString(const XMLCh* const string16) const
-{
-	unsigned int str16len = XMLString::stringLen(string16);
-	if (str16len == 0)
-	{
-		return CeGuiString();
-	}
-
-	utf8* tmpVal = transcodeToUtf8(string16);
-	CeGuiString rVal(tmpVal);
-	delete[] tmpVal;
-	return rVal;
-}
-
-std::string XmlProcessor::transcodeToStdString(const XMLCh* const string16) const
-{
-    if ( string16 == NULL )
-        return "";
-
-	char* tmpVal = XMLString::transcode(string16);
-	std::string rVal(tmpVal);
-	XMLString::release(&tmpVal);
-	return rVal;
-}
-
-DOMDocument* XmlProcessor::loadDocument(
-    const Ogre::String& resourceName, const Ogre::String& resourceGroup)
-{
-	XercesDOMParser* parser = new XercesDOMParser();
-
-    parser->setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-    parser->setDoNamespaces(true);    // optional
-
-    XmlPtr res = XmlResourceManager::getSingleton().getByName(resourceName);
-    if (res.isNull())
-    {
-        Ogre::String group = ResourceGroupManager::DEFAULT_RESOURCE_GROUP_NAME;
-        if (resourceGroup != "" 
-            && ResourceGroupManager::getSingleton().resourceExists(
-                    resourceGroup, resourceName))
-        {
-            group = resourceGroup;
-        }
-        res = XmlResourceManager::getSingleton().create(resourceName, group);
-    }
-
-    mOpenXmlFileName = resourceName;
-
-    if (!res.isNull() && res->parseBy(parser, this))
-    {
-        return parser->getDocument();
-    }
-
-    mOpenXmlFileName = "";
-
-    return NULL;
-}
-
-DOMDocument* XmlProcessor::loadDocument(const Ogre::DataStreamPtr& stream)
-{
-	XercesDOMParser* parser = new XercesDOMParser();
-
-    parser->setValidationScheme(XercesDOMParser::Val_Auto);    // optional.
-    parser->setDoNamespaces(true);    // optional
-
-    OgreInputSource source(stream);
-    parser->setErrorHandler(this);
-
-    mOpenXmlFileName = stream->getName();
-    parser->parse(source);
-    mOpenXmlFileName = "";
-
-    if (parser->getErrorCount() == 0)
-    {
-        return parser->getDocument();
-    }
-
-    return NULL;
-}
-
-void XmlProcessor::initializeXml()
-{
-  	XMLPlatformUtils::Initialize();
-
-	sTranscoder 
-        = XMLPlatformUtils::fgTransService->makeNewTranscoderFor(
-            XMLRecognizer::UTF_8, sFailCode, 16*1024);
-}
-
-void XmlProcessor::shutdownXml()
-{
-    delete sTranscoder;
-    sTranscoder = NULL;
-    
-    XMLPlatformUtils::Terminate();
-}
-
-std::string XmlProcessor::toString( const std::string& type,
-        const XERCES_CPP_NAMESPACE::SAXParseException& exc ) const
-{
-    std::stringstream strs;
-    strs << "A" << type << " occured while parsing " << mOpenXmlFileName
-         << " at line " << exc.getLineNumber() << " column " <<  exc.getColumnNumber();
-
-    if( exc.getSystemId() != NULL )
-        strs << " with system " << transcodeToStdString( exc.getSystemId() );
-    if( exc.getPublicId() != NULL )
-        strs << " with public " << transcodeToStdString( exc.getPublicId() );
-    return strs.str();
-}
-
-void XmlProcessor::warning(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
-{
-    LOG_MESSAGE(Logger::CORE, toString( " warning ", exc ) );
-}
-
-void XmlProcessor::error(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
-{
-    LOG_ERROR(Logger::CORE, toString( "n error", exc ) );
-}
-
-void XmlProcessor::fatalError(const XERCES_CPP_NAMESPACE::SAXParseException& exc)
-{
-    LOG_CRITICAL(Logger::CORE, toString( " fatal error", exc ) );
-}
-
-void XmlProcessor::resetErrors()
-{
-}
-
-
-} // end namespace rl

Copied: rl/trunk/engine/common/src/XmlProcessor.cpp (from rev 3829, rl/trunk/engine/common/src/XmlHelper.cpp)



From blakharaz at mail.berlios.de  Sat Sep  8 22:31:37 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:31:37 +0200
Subject: [Dsa-hl-svn] r3831 - rl/trunk/engine/common/src
Message-ID: <200709082031.l88KVbUL005392@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:31:31 +0200 (Sat, 08 Sep 2007)
New Revision: 3831

Added:
   rl/trunk/engine/common/src/XmlPropertyReader.cpp
Removed:
   rl/trunk/engine/common/src/PropertyReader.cpp
Log:
Renamed remotely

Deleted: rl/trunk/engine/common/src/PropertyReader.cpp
===================================================================
--- rl/trunk/engine/common/src/PropertyReader.cpp	2007-09-08 20:31:16 UTC (rev 3830)
+++ rl/trunk/engine/common/src/PropertyReader.cpp	2007-09-08 20:31:31 UTC (rev 3831)
@@ -1,230 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#include "stdinc.h" //precompiled header
-
-#include <xercesc/dom/DOM.hpp>
-
-#include "XmlHelper.h"
-
-#include "Properties.h"
-#include "PropertyReader.h"
-
-#include <OgreResourceManager.h>
-#include <CEGUIPropertyHelper.h>
-
-
-using namespace XERCES_CPP_NAMESPACE;
-using namespace Ogre;
-
-namespace rl {
-
-XmlPropertyReader::XmlPropertyReader()
-{
-}
-
-void XmlPropertyReader::parseGameObjectFile(Ogre::DataStreamPtr &stream, const Ogre::String &groupName)
-{
-    initializeXml();
-
-    XERCES_CPP_NAMESPACE::DOMDocument* doc = loadDocument(stream);
-
-    DOMNodeList* godefsXml = doc->getDocumentElement()->getElementsByTagName(AutoXMLCh("gameobjectclass").data());
-    for (unsigned int idx = 0; idx < godefsXml->getLength(); idx++)
-    {
-		PropertySet* ps = new PropertySet();
-		DOMElement* curNode = static_cast<DOMElement*>(godefsXml->item(idx));
-		
-		const DOMNamedNodeMap* godefAttrs = curNode->getAttributes();
-		for (XMLSize_t attrIdx = 0; attrIdx < godefAttrs->getLength(); attrIdx++)
-		{
-			PropertyEntry entry = processProperty(static_cast<DOMAttr*>(godefAttrs->item(attrIdx)));
-            if (entry.first != "")
-            {
-                ps->setProperty(entry.first, entry.second);
-            }
-		}
-
-        DOMNodeList* godefChildren = curNode->getChildNodes();
-        for (XMLSize_t childIdx = 0; childIdx < godefChildren->getLength(); childIdx++)
-        {
-            DOMNode* curChild = godefChildren->item(childIdx);
-            if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
-            {
-                PropertyEntry entry = processProperty(static_cast<DOMElement*>(curChild));
-                if (entry.first != "")
-                {
-                    ps->setProperty(entry.first, entry.second);
-                }
-            }
-        }
-        mPropertySets.push_back(ps);
-    }
-	
-	doc->release();
-
-    shutdownXml();
-}
-
-std::vector<PropertySet*> XmlPropertyReader::getPropertySets()
-{
-    return mPropertySets;
-}
-
-PropertyEntry XmlPropertyReader::processProperty(XERCES_CPP_NAMESPACE::DOMAttr* domAttr) const
-{
-	return std::make_pair(
-		transcodeToStdString(domAttr->getName()), 
-		Property(transcodeToString(domAttr->getValue())));
-}
-
-PropertyEntry XmlPropertyReader::processProperty(XERCES_CPP_NAMESPACE::DOMElement* domElem) const
-{
-    if (!hasAttribute(domElem, "type"))
-    {
-        return std::make_pair("", Property(0));
-    }
-
-    Ogre::String key = "";
-	if (hasAttribute(domElem, "name"))
-	{
-		key = getAttributeValueAsStdString(domElem, "name");
-	}
-	Ogre::String type = getAttributeValueAsStdString(domElem, "type");
-    CeGuiString value = "";
-    if (hasAttribute(domElem, "data"))
-    {
-        value = getAttributeValueAsString(domElem, "data");
-    }
-
-    Property prop;
-    if (type == "STRING")
-    {
-        prop = Property(value);
-    }
-    else if (type == "INT")
-    {
-        const int intVal = CEGUI::PropertyHelper::stringToInt(value);
-        prop = Property(intVal);
-    }
-    else if (type == "REAL" || type == "FLOAT")
-    {
-        const Ogre::Real realVal = CEGUI::PropertyHelper::stringToFloat(value);
-        prop = Property(realVal);
-    }
-    else if (type == "VECTOR3")
-    {
-        CeGuiString::size_type comma1 = value.find(",");
-        CeGuiString::size_type comma2 = value.find(",", comma1 + 1);
-
-        Ogre::Vector3 vec(Ogre::Vector3::ZERO);
-        if (comma1 != CeGuiString::npos && comma2 != CeGuiString::npos)
-        {
-            vec.x = CEGUI::PropertyHelper::stringToFloat(value.substr(0, comma1));
-            vec.y = CEGUI::PropertyHelper::stringToFloat(value.substr(comma1 + 1, comma2 - comma1 - 1));
-            vec.z = CEGUI::PropertyHelper::stringToFloat(value.substr(comma2 + 1));
-        }
-        prop = Property(vec);
-    }
-    else if (type == "QUATERNION")
-    {
-        CeGuiString::size_type comma1 = value.find(",");
-        CeGuiString::size_type comma2 = value.find(",", comma1 + 1);
-        CeGuiString::size_type comma3 = value.find(",", comma2 + 1);
-
-        Ogre::Quaternion quat(Ogre::Quaternion::IDENTITY);
-        if (comma1 != CeGuiString::npos 
-            && comma2 != CeGuiString::npos 
-            && comma3 != CeGuiString::npos)
-        {
-            quat.w = CEGUI::PropertyHelper::stringToFloat(value.substr(0, comma1));
-            quat.x = CEGUI::PropertyHelper::stringToFloat(value.substr(comma1 + 1, comma2 - comma1 - 1));
-            quat.y = CEGUI::PropertyHelper::stringToFloat(value.substr(comma2 + 1, comma3 - comma2 - 1));
-            quat.z = CEGUI::PropertyHelper::stringToFloat(value.substr(comma3 + 1));
-        }
-        else if (comma1 != CeGuiString::npos 
-            && comma2 != CeGuiString::npos 
-            && comma3 == CeGuiString::npos)
-        {
-            Quaternion rotX, rotY, rotZ;
-
-            rotX.FromAngleAxis(
-			    Ogre::Degree(CEGUI::PropertyHelper::stringToFloat(value.substr(0, comma1))), 
-			    Ogre::Vector3::UNIT_X);
-            rotY.FromAngleAxis(
-			    Ogre::Degree(CEGUI::PropertyHelper::stringToFloat(value.substr(comma1 + 1, comma2 - comma1 - 1))), 
-			    Ogre::Vector3::UNIT_Y);
-            rotZ.FromAngleAxis(
-			    Ogre::Degree(CEGUI::PropertyHelper::stringToFloat(value.substr(comma2 + 1))), 
-			    Ogre::Vector3::UNIT_Z);
-
-            quat = rotX * rotY * rotZ;
-        }
-        prop = Property(quat);
-    }
-    else if (type == "BOOL")
-    {
-        const bool boolVal = CEGUI::PropertyHelper::stringToBool(value);
-        prop = Property(boolVal);
-    }
-	else if (type == "ARRAY")
-	{
-		std::vector<Property> vecVal;
-		for (DOMNode* curChild  = domElem->getFirstChild(); curChild != NULL;
-			curChild = curChild->getNextSibling())
-		{
-			if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
-			{
-				PropertyEntry entry = processProperty(static_cast<DOMElement*>(curChild));
-				vecVal.push_back(entry.second);
-			}
-		}
-		prop = Property(vecVal);
-	}
-	else if (type == "INTPAIR")
-    {
-        CeGuiString::size_type comma1 = value.find(",");
-
-		std::pair<int,int> intpairVal = std::make_pair(0, 0);
-        if (comma1 != CeGuiString::npos)
-        {
-			intpairVal = std::make_pair(
-				CEGUI::PropertyHelper::stringToInt(value.substr(0, comma1)),
-				CEGUI::PropertyHelper::stringToInt(value.substr(comma1 + 1)));
-        }
-        prop = Property(intpairVal);
-    }
-	else if (type == "MAP")
-	{
-		PropertyMap mapVal;
-		for (DOMNode* curChild  = domElem->getFirstChild(); curChild != NULL;
-			curChild = curChild->getNextSibling())
-		{
-			if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
-			{
-				DOMElement* curElem = static_cast<DOMElement*>(curChild);
-				CeGuiString key = getAttributeValueAsString(curElem, "name");
-				PropertyEntry entry = processProperty(curElem);
-				mapVal[key] = entry.second;
-			}
-		}
-		prop = Property(mapVal);
-	}
-
-    return std::make_pair(key, prop);
-}
-
-}

Copied: rl/trunk/engine/common/src/XmlPropertyReader.cpp (from rev 3830, rl/trunk/engine/common/src/PropertyReader.cpp)



From blakharaz at mail.berlios.de  Sat Sep  8 22:32:05 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:32:05 +0200
Subject: [Dsa-hl-svn] r3832 - rl/trunk/engine/common/src
Message-ID: <200709082032.l88KW5E7005408@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:32:02 +0200 (Sat, 08 Sep 2007)
New Revision: 3832

Added:
   rl/trunk/engine/common/src/XmlPropertyWriter.cpp
Removed:
   rl/trunk/engine/common/src/PropertyWriter.cpp
Log:
Renamed remotely

Deleted: rl/trunk/engine/common/src/PropertyWriter.cpp
===================================================================
--- rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-08 20:31:31 UTC (rev 3831)
+++ rl/trunk/engine/common/src/PropertyWriter.cpp	2007-09-08 20:32:02 UTC (rev 3832)
@@ -1,130 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#include "stdinc.h" //precompiled header
-
-#include "XmlHelper.h"
-
-#include "Properties.h"
-#include "PropertyWriter.h"
-
-#include <OgreResourceManager.h>
-#include <CEGUIPropertyHelper.h>
-
-
-using namespace XERCES_CPP_NAMESPACE;
-using namespace Ogre;
-
-namespace rl {
-
-    XmlPropertyWriter::XmlPropertyWriter()
-    {
-    }
-
-    XmlPropertyWriter::~XmlPropertyWriter()
-    {
-    }
-
-    void XmlPropertyWriter::setPropertySets(std::vector<PropertySet*> sets)
-    {
-        mPropertySets = sets;
-    }
-
-    void XmlPropertyWriter::addPropertySet(PropertySet* set)
-    {
-        mPropertySets.push_back(set);
-    }
-
-    DOMElement* XmlPropertyWriter::processProperty(DOMElement* parent, PropertyEntry entry)
-    {
-        DOMElement* element = NULL;
-        if(!entry.second.isEmpty())
-        {
-            if(entry.second.isArray())
-            {
-                element = this->processPropertyArray(parent, entry.first.c_str(), entry.second.toArray());
-            }
-            else if(entry.second.isMap())
-            {
-                element = this->processPropertyMap(parent, entry.first.c_str(), entry.second.toMap());
-            }
-            else
-            {
-                element = appendChildElement(mDocument, parent, "property");
-                if(entry.first != "")
-                    setAttribute(element, "name", entry.first.c_str());
-
-                //Ogre::String typeName = entry.second.getTypeName();
-                Ogre::String name = entry.second.getName();
-                Ogre::StringUtil::toUpperCase(name);
-                setAttributeValueAsString(element, "type", name);
-
-                if(entry.second.isBool())
-                    setAttributeValueAsBool(element, "data", entry.second.toBool());
-                else if(entry.second.isInt())
-                    setAttributeValueAsInteger(element, "data", entry.second.toInt());
-                else if(entry.second.isIntPair())
-                    setAttributeValueAsIntegerPair(element, "data", entry.second.toIntPair());
-                else if(entry.second.isIntPair())
-                    setAttributeValueAsIntegerTriple(element, "data", entry.second.toIntTriple());
-                else if(entry.second.isQuaternion())
-                    setValueAsQuaternion(element, entry.second.toQuaternion());
-                else if(entry.second.isReal())
-                    setAttributeValueAsReal(element, "data", entry.second.toReal());
-                else if(entry.second.isString())
-                    setAttributeValueAsString(element, "data", entry.second.toString());
-                else if(entry.second.isVector3())
-                    setValueAsVector3(element, entry.second.toVector3());
-            }
-        }
-        return element;
-    }
-
-    DOMElement* XmlPropertyWriter::processPropertySet(DOMElement* parent, const char* const name, PropertySet set)
-    {
-        PropertyMap map = set.toPropertyMap();
-
-        return processPropertyMap(parent, name, map);
-    }
-
-    DOMElement* XmlPropertyWriter::processPropertyArray(DOMElement *parent, const char *const name, PropertyVector vector)
-    {
-        DOMElement* element = appendChildElement(mDocument, parent, "property");
-        setAttribute(element, "name", name);
-        setAttribute(element, "type", "MAP");
-
-        PropertyVector::iterator iter;
-        for(iter = vector.begin(); iter != vector.end(); iter++)
-        {
-            processProperty(element, PropertyEntry("",*iter));
-        }
-        return element;
-    }
-
-    DOMElement* XmlPropertyWriter::processPropertyMap(DOMElement *parent, const char *const name, PropertyMap map)
-    {
-        DOMElement* element = appendChildElement(mDocument, parent, "property");
-        setAttribute(element, "name", name);
-        setAttribute(element, "type", "MAP");
-
-        PropertyMap::iterator iter;
-        for(iter = map.begin(); iter != map.end(); iter++)
-        {
-            processProperty(element, PropertyEntry(iter->first.c_str(), iter->second));
-        }
-        return element;
-    }
-}

Copied: rl/trunk/engine/common/src/XmlPropertyWriter.cpp (from rev 3831, rl/trunk/engine/common/src/PropertyWriter.cpp)



From blakharaz at mail.berlios.de  Sat Sep  8 22:33:27 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:33:27 +0200
Subject: [Dsa-hl-svn] r3833 - in rl/trunk/engine/common: . include src
Message-ID: <200709082033.l88KXRb0005525@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:33:20 +0200 (Sat, 08 Sep 2007)
New Revision: 3833

Modified:
   rl/trunk/engine/common/RlCommon2005.vcproj
   rl/trunk/engine/common/include/Makefile.am
   rl/trunk/engine/common/src/Makefile.am
Log:
Adapt makefiles and projects to renamings

Modified: rl/trunk/engine/common/RlCommon2005.vcproj
===================================================================
--- rl/trunk/engine/common/RlCommon2005.vcproj	2007-09-08 20:32:02 UTC (rev 3832)
+++ rl/trunk/engine/common/RlCommon2005.vcproj	2007-09-08 20:33:20 UTC (rev 3833)
@@ -335,11 +335,11 @@
 				>
 			</File>
 			<File
-				RelativePath=".\src\PropertyReader.cpp"
+				RelativePath=".\src\XmlPropertyReader.cpp"
 				>
 			</File>
 			<File
-				RelativePath=".\src\PropertyWriter.cpp"
+				RelativePath=".\src\XmlPropertyWriter.cpp"
 				>
 			</File>
 			<File
@@ -379,7 +379,7 @@
 				>
 			</File>
 			<File
-				RelativePath=".\src\XmlHelper.cpp"
+				RelativePath=".\src\XmlProcessor.cpp"
 				>
 			</File>
 			<File
@@ -459,11 +459,11 @@
 				>
 			</File>
 			<File
-				RelativePath=".\include\PropertyReader.h"
+				RelativePath=".\include\XmlPropertyReader.h"
 				>
 			</File>
 			<File
-				RelativePath=".\include\PropertyWriter.h"
+				RelativePath=".\include\XmlPropertyWriter.h"
 				>
 			</File>
 			<File
@@ -491,7 +491,7 @@
 				>
 			</File>
 			<File
-				RelativePath=".\include\XmlHelper.h"
+				RelativePath=".\include\XmlProcessor.h"
 				>
 			</File>
 			<File

Modified: rl/trunk/engine/common/include/Makefile.am
===================================================================
--- rl/trunk/engine/common/include/Makefile.am	2007-09-08 20:32:02 UTC (rev 3832)
+++ rl/trunk/engine/common/include/Makefile.am	2007-09-08 20:33:20 UTC (rev 3833)
@@ -14,12 +14,12 @@
 	OgreXercesInput.h \
     Properties.h \
     Property.h \
-    PropertyReader.h \
-	PropertyWriter.h \
     RastullahPrerequisites.h \
     ScriptWrapper.h \
 	Sleep.h \
 	Tripel.h \
-	XmlHelper.h \
+	XmlProcessor.h \
+    XmlPropertyReader.h \
+	XmlPropertyWriter.h \
 	XmlResource.h \
 	XmlResourceManager.h

Modified: rl/trunk/engine/common/src/Makefile.am
===================================================================
--- rl/trunk/engine/common/src/Makefile.am	2007-09-08 20:32:02 UTC (rev 3832)
+++ rl/trunk/engine/common/src/Makefile.am	2007-09-08 20:33:20 UTC (rev 3833)
@@ -13,10 +13,10 @@
   OgreXercesInput.cpp \
   Properties.cpp \
   Property.cpp \
-  PropertyReader.cpp \
-  PropertyWriter.cpp \
   ScriptWrapper.cpp \
   XmlErrorHandler.cpp \
-  XmlHelper.cpp \
+  XmlProcessor.cpp \
+  XmlPropertyReader.cpp \
+  XmlPropertyWriter.cpp \
   XmlResource.cpp \
   XmlResourceManager.cpp   



From blakharaz at mail.berlios.de  Sat Sep  8 22:40:42 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 8 Sep 2007 22:40:42 +0200
Subject: [Dsa-hl-svn] r3834 - in rl/trunk/engine: ai/include ai/src common
	common/include common/src core/include rules/include
	rules/src script/include script/src startup/src ui/include ui/src
Message-ID: <200709082040.l88Keg8R005906@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-08 22:40:08 +0200 (Sat, 08 Sep 2007)
New Revision: 3834

Removed:
   rl/trunk/engine/common/include/XmlErrorHandler.h
   rl/trunk/engine/common/src/XmlErrorHandler.cpp
Modified:
   rl/trunk/engine/ai/include/AiSubsystem.h
   rl/trunk/engine/ai/include/AimlNodeImplRl.h
   rl/trunk/engine/ai/include/WayPointGraph.h
   rl/trunk/engine/ai/src/AiSubsystem.cpp
   rl/trunk/engine/ai/src/AimlNodeImplRl.cpp
   rl/trunk/engine/common/RlCommon2005.vcproj
   rl/trunk/engine/common/include/XmlPropertyReader.h
   rl/trunk/engine/common/include/XmlPropertyWriter.h
   rl/trunk/engine/common/include/XmlResource.h
   rl/trunk/engine/common/src/OgreXercesInput.cpp
   rl/trunk/engine/common/src/XmlProcessor.cpp
   rl/trunk/engine/common/src/XmlPropertyReader.cpp
   rl/trunk/engine/common/src/XmlPropertyWriter.cpp
   rl/trunk/engine/common/src/XmlResource.cpp
   rl/trunk/engine/core/include/DotSceneLoader.h
   rl/trunk/engine/rules/include/DsaDataLoader.h
   rl/trunk/engine/rules/src/DsaDataLoader.cpp
   rl/trunk/engine/rules/src/GameObjectManager.cpp
   rl/trunk/engine/script/include/AbstractMapNodeProcessor.h
   rl/trunk/engine/script/include/MapLoader.h
   rl/trunk/engine/script/src/EnvironmentProcessor.cpp
   rl/trunk/engine/script/src/MapLoader.cpp
   rl/trunk/engine/startup/src/RastullahMain.cpp
   rl/trunk/engine/ui/include/InputManager.h
   rl/trunk/engine/ui/src/InputManager.cpp
Log:
- fix #includes (renamings)
- removed now unused class XmlErrorHandler

Modified: rl/trunk/engine/ai/include/AiSubsystem.h
===================================================================
--- rl/trunk/engine/ai/include/AiSubsystem.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/ai/include/AiSubsystem.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -21,7 +21,7 @@
 #include "AiPrerequisites.h"
 
 #include "MessagePump.h"
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 #include "World.h"
 
 namespace MadaBot

Modified: rl/trunk/engine/ai/include/AimlNodeImplRl.h
===================================================================
--- rl/trunk/engine/ai/include/AimlNodeImplRl.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/ai/include/AimlNodeImplRl.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -19,7 +19,7 @@
 #include "AiPrerequisites.h"
 #include "AimlNode.h"
 
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 using namespace MadaBot;
 namespace rl

Modified: rl/trunk/engine/ai/include/WayPointGraph.h
===================================================================
--- rl/trunk/engine/ai/include/WayPointGraph.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/ai/include/WayPointGraph.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -20,7 +20,7 @@
 
 #include "DebugVisualisable.h"
 #include "WayPointNode.h"
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 namespace rl
 {

Modified: rl/trunk/engine/ai/src/AiSubsystem.cpp
===================================================================
--- rl/trunk/engine/ai/src/AiSubsystem.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/ai/src/AiSubsystem.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -30,7 +30,7 @@
 
 #include <xercesc/util/PlatformUtils.hpp>
 
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 #include "XmlResourceManager.h"
 #include "ContentModule.h"
 

Modified: rl/trunk/engine/ai/src/AimlNodeImplRl.cpp
===================================================================
--- rl/trunk/engine/ai/src/AimlNodeImplRl.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/ai/src/AimlNodeImplRl.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -21,7 +21,7 @@
 #include <xercesc/util/TransService.hpp>
 #include "AimlNodeImplRl.h"
 
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 namespace rl {
 

Modified: rl/trunk/engine/common/RlCommon2005.vcproj
===================================================================
--- rl/trunk/engine/common/RlCommon2005.vcproj	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/RlCommon2005.vcproj	2007-09-08 20:40:08 UTC (rev 3834)
@@ -335,14 +335,6 @@
 				>
 			</File>
 			<File
-				RelativePath=".\src\XmlPropertyReader.cpp"
-				>
-			</File>
-			<File
-				RelativePath=".\src\XmlPropertyWriter.cpp"
-				>
-			</File>
-			<File
 				RelativePath=".\src\ScriptWrapper.cpp"
 				>
 			</File>
@@ -375,14 +367,18 @@
 				</FileConfiguration>
 			</File>
 			<File
-				RelativePath=".\src\XmlErrorHandler.cpp"
+				RelativePath=".\src\XmlProcessor.cpp"
 				>
 			</File>
 			<File
-				RelativePath=".\src\XmlProcessor.cpp"
+				RelativePath=".\src\XmlPropertyReader.cpp"
 				>
 			</File>
 			<File
+				RelativePath=".\src\XmlPropertyWriter.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\XmlResource.cpp"
 				>
 			</File>
@@ -459,14 +455,6 @@
 				>
 			</File>
 			<File
-				RelativePath=".\include\XmlPropertyReader.h"
-				>
-			</File>
-			<File
-				RelativePath=".\include\XmlPropertyWriter.h"
-				>
-			</File>
-			<File
 				RelativePath=".\include\RastullahPrerequisites.h"
 				>
 			</File>
@@ -487,14 +475,18 @@
 				>
 			</File>
 			<File
-				RelativePath=".\include\XmlErrorHandler.h"
+				RelativePath=".\include\XmlProcessor.h"
 				>
 			</File>
 			<File
-				RelativePath=".\include\XmlProcessor.h"
+				RelativePath=".\include\XmlPropertyReader.h"
 				>
 			</File>
 			<File
+				RelativePath=".\include\XmlPropertyWriter.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\XmlResource.h"
 				>
 			</File>

Deleted: rl/trunk/engine/common/include/XmlErrorHandler.h
===================================================================
--- rl/trunk/engine/common/include/XmlErrorHandler.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/include/XmlErrorHandler.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -1,48 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
- */
-#ifndef __XmlErrorHandler_H__
-#define __XmlErrorHandler_H__
-#include <string>
-#include <xercesc/sax/ErrorHandler.hpp>
-#include "CommonPrerequisites.h"
-#include "XmlHelper.h"
-
-
-
-namespace rl
-{
-    /*class _RlCommonExport XmlErrorHandler 
-        :   public XERCES_CPP_NAMESPACE::ErrorHandler,
-            private XmlProcessor
-    {
-    public:
-        XmlErrorHandler(void);
-        virtual~XmlErrorHandler(void);
-
-        void setFileName(const std::string& fileName);
-
-        virtual void warning(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
-        virtual void error(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
-        virtual void fatalError(const XERCES_CPP_NAMESPACE::SAXParseException& exc);
-        virtual void resetErrors();
-    private:
-        std::string toString( const std::string& type,
-                              const XERCES_CPP_NAMESPACE::SAXParseException& exc ) const;
-        
-        std::string mFileName;
-    };*/
-}
-#endif

Modified: rl/trunk/engine/common/include/XmlPropertyReader.h
===================================================================
--- rl/trunk/engine/common/include/XmlPropertyReader.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/include/XmlPropertyReader.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -23,7 +23,7 @@
 #include <xercesc/dom/DOMElement.hpp>
 #include <OgreDataStream.h>
 
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 namespace rl 
 {

Modified: rl/trunk/engine/common/include/XmlPropertyWriter.h
===================================================================
--- rl/trunk/engine/common/include/XmlPropertyWriter.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/include/XmlPropertyWriter.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -25,7 +25,7 @@
 #include <OgreDataStream.h>
 
 #include "Property.h"
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 namespace rl 
 {

Modified: rl/trunk/engine/common/include/XmlResource.h
===================================================================
--- rl/trunk/engine/common/include/XmlResource.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/include/XmlResource.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -26,7 +26,7 @@
 
 #include "CommonPrerequisites.h"
 #include <OgreResource.h>
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 namespace rl {
 

Modified: rl/trunk/engine/common/src/OgreXercesInput.cpp
===================================================================
--- rl/trunk/engine/common/src/OgreXercesInput.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/src/OgreXercesInput.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -17,7 +17,6 @@
 #include "stdinc.h" //precompiled header
 
 #include "OgreXercesInput.h"
-#include "XmlErrorHandler.h"
 
 using namespace XERCES_CPP_NAMESPACE;
 using namespace Ogre;

Deleted: rl/trunk/engine/common/src/XmlErrorHandler.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlErrorHandler.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/src/XmlErrorHandler.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -1,43 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
- */
-
-#include "stdinc.h" //precompiled header
-
-#include <sstream>
-
-#include "XmlErrorHandler.h"
-#include "XmlHelper.h"
-
-
-namespace rl {
-
-//XmlErrorHandler::XmlErrorHandler(void)
-//    : mFileName("")
-//{
-//}
-//
-//XmlErrorHandler::~XmlErrorHandler(void)
-//{
-//}
-//
-//void XmlErrorHandler::setFileName(const std::string& fileName)
-//{
-//    mFileName = fileName;
-//}
-
-
-
-}

Modified: rl/trunk/engine/common/src/XmlProcessor.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlProcessor.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/src/XmlProcessor.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -27,7 +27,7 @@
 #include "Logger.h"
 #include "OgreXercesInput.h"
 #include "XmlErrorHandler.h"
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 #include "XmlResource.h"
 #include "XmlResourceManager.h"
 

Modified: rl/trunk/engine/common/src/XmlPropertyReader.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlPropertyReader.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/src/XmlPropertyReader.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -18,10 +18,10 @@
 
 #include <xercesc/dom/DOM.hpp>
 
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 #include "Properties.h"
-#include "PropertyReader.h"
+#include "XmlPropertyReader.h"
 
 #include <OgreResourceManager.h>
 #include <CEGUIPropertyHelper.h>

Modified: rl/trunk/engine/common/src/XmlPropertyWriter.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlPropertyWriter.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/src/XmlPropertyWriter.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -16,10 +16,10 @@
 
 #include "stdinc.h" //precompiled header
 
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 #include "Properties.h"
-#include "PropertyWriter.h"
+#include "XmlPropertyWriter.h"
 
 #include <OgreResourceManager.h>
 #include <CEGUIPropertyHelper.h>

Modified: rl/trunk/engine/common/src/XmlResource.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlResource.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/common/src/XmlResource.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -18,7 +18,7 @@
 
 #include "XmlResource.h"
 #include "XmlResourceManager.h"
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 #include "XmlErrorHandler.h"
 
 using namespace XERCES_CPP_NAMESPACE;

Modified: rl/trunk/engine/core/include/DotSceneLoader.h
===================================================================
--- rl/trunk/engine/core/include/DotSceneLoader.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/core/include/DotSceneLoader.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -23,7 +23,7 @@
 #include <map>
 
 #include "XmlResourceManager.h"
-#include "PropertyReader.h"
+#include "XmlPropertyReader.h"
 
 class Ogre::SceneNode;
 class XERCES_CPP_NAMESPACE::DOMElement;

Modified: rl/trunk/engine/rules/include/DsaDataLoader.h
===================================================================
--- rl/trunk/engine/rules/include/DsaDataLoader.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/rules/include/DsaDataLoader.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -21,7 +21,7 @@
 #include <xercesc/dom/DOMElement.hpp>
 
 #include <OgreScriptLoader.h>
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 namespace rl {
 

Modified: rl/trunk/engine/rules/src/DsaDataLoader.cpp
===================================================================
--- rl/trunk/engine/rules/src/DsaDataLoader.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/rules/src/DsaDataLoader.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -22,7 +22,7 @@
 
 #include <OgreResourceGroupManager.h>
 
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 #include "OgreXercesInput.h"
 
 #include "DsaManager.h"

Modified: rl/trunk/engine/rules/src/GameObjectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObjectManager.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/rules/src/GameObjectManager.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -28,7 +28,7 @@
 #include "Item.h"
 #include "Person.h"
 #include "Properties.h"
-#include "PropertyReader.h"
+#include "XmlPropertyReader.h"
 #include "Property.h"
 #include "RubyInterpreter.h"
 #include "Weapon.h"

Modified: rl/trunk/engine/script/include/AbstractMapNodeProcessor.h
===================================================================
--- rl/trunk/engine/script/include/AbstractMapNodeProcessor.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/script/include/AbstractMapNodeProcessor.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -22,7 +22,7 @@
 
 #include <OgreSceneNode.h>
 
-#include "PropertyReader.h"
+#include "XmlPropertyReader.h"
 
 namespace rl
 {

Modified: rl/trunk/engine/script/include/MapLoader.h
===================================================================
--- rl/trunk/engine/script/include/MapLoader.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/script/include/MapLoader.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -22,7 +22,7 @@
 
 #include <OgreSceneNode.h>
 #include <list>
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 namespace rl {
 

Modified: rl/trunk/engine/script/src/EnvironmentProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/EnvironmentProcessor.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/script/src/EnvironmentProcessor.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -19,7 +19,7 @@
 
 #include "CoreSubsystem.h"
 #include "World.h"
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 using namespace XERCES_CPP_NAMESPACE;
 using namespace Ogre;

Modified: rl/trunk/engine/script/src/MapLoader.cpp
===================================================================
--- rl/trunk/engine/script/src/MapLoader.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/script/src/MapLoader.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -27,11 +27,11 @@
 #include "LightNodeProcessor.h"
 #include "ParticleSystemNodeProcessor.h"
 #include "ProgressWindow.h"
-#include "PropertyReader.h"
+#include "XmlPropertyReader.h"
 #include "SoundNodeProcessor.h"
 #include "WaypointProcessor.h"
 #include "World.h"
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 #include "ZoneProcessor.h"
 
 using namespace Ogre;

Modified: rl/trunk/engine/startup/src/RastullahMain.cpp
===================================================================
--- rl/trunk/engine/startup/src/RastullahMain.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/startup/src/RastullahMain.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -174,9 +174,9 @@
     int argc;
     LPWSTR* argList = CommandLineToArgvW(GetCommandLineW(), &argc);
     char** argv = new char*[argc];
-    for (int argIdx = 0; argIdx < argc; argIdx++)
+    for (size_t argIdx = 0; argIdx < argc; argIdx++)
     {
-        int len = wcslen(argList[argIdx])+1;
+        size_t len = wcslen(argList[argIdx])+1;
         argv[argIdx] = new char[len];
         wcstombs(argv[argIdx], argList[argIdx], len);
         argv[argIdx][len-1] = '\0';

Modified: rl/trunk/engine/ui/include/InputManager.h
===================================================================
--- rl/trunk/engine/ui/include/InputManager.h	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/ui/include/InputManager.h	2007-09-08 20:40:08 UTC (rev 3834)
@@ -29,7 +29,7 @@
 
 #include "FixRubyHeaders.h"
 #include "GameTask.h"
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 namespace rl {
 

Modified: rl/trunk/engine/ui/src/InputManager.cpp
===================================================================
--- rl/trunk/engine/ui/src/InputManager.cpp	2007-09-08 20:33:20 UTC (rev 3833)
+++ rl/trunk/engine/ui/src/InputManager.cpp	2007-09-08 20:40:08 UTC (rev 3834)
@@ -23,7 +23,7 @@
 
 #include "Exception.h"
 
-#include "XmlHelper.h"
+#include "XmlProcessor.h"
 
 #include "AbstractWindow.h"
 #include "Action.h"



From blakharaz at mail.berlios.de  Sun Sep  9 00:44:08 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sun, 9 Sep 2007 00:44:08 +0200
Subject: [Dsa-hl-svn] r3835 - rl/trunk/engine/common/src
Message-ID: <200709082244.l88Mi8OS013332@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-09 00:44:02 +0200 (Sun, 09 Sep 2007)
New Revision: 3835

Modified:
   rl/trunk/engine/common/src/XmlProcessor.cpp
   rl/trunk/engine/common/src/XmlResource.cpp
Log:
Removed deleted header #includes


Modified: rl/trunk/engine/common/src/XmlProcessor.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlProcessor.cpp	2007-09-08 20:40:08 UTC (rev 3834)
+++ rl/trunk/engine/common/src/XmlProcessor.cpp	2007-09-08 22:44:02 UTC (rev 3835)
@@ -26,7 +26,6 @@
 #include "Exception.h"
 #include "Logger.h"
 #include "OgreXercesInput.h"
-#include "XmlErrorHandler.h"
 #include "XmlProcessor.h"
 #include "XmlResource.h"
 #include "XmlResourceManager.h"

Modified: rl/trunk/engine/common/src/XmlResource.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlResource.cpp	2007-09-08 20:40:08 UTC (rev 3834)
+++ rl/trunk/engine/common/src/XmlResource.cpp	2007-09-08 22:44:02 UTC (rev 3835)
@@ -19,7 +19,6 @@
 #include "XmlResource.h"
 #include "XmlResourceManager.h"
 #include "XmlProcessor.h"
-#include "XmlErrorHandler.h"
 
 using namespace XERCES_CPP_NAMESPACE;
 using namespace Ogre;



From timm at mail.berlios.de  Sun Sep  9 00:54:30 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 9 Sep 2007 00:54:30 +0200
Subject: [Dsa-hl-svn] r3836 - in rl/trunk/engine/rules: include src
Message-ID: <200709082254.l88MsUIN021087@sheep.berlios.de>

Author: timm
Date: 2007-09-09 00:54:26 +0200 (Sun, 09 Sep 2007)
New Revision: 3836

Modified:
   rl/trunk/engine/rules/include/SaveGameFileWriter.h
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
Log:
fixed #include

Modified: rl/trunk/engine/rules/include/SaveGameFileWriter.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-08 22:44:02 UTC (rev 3835)
+++ rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-08 22:54:26 UTC (rev 3836)
@@ -19,7 +19,7 @@
 
 #include "RulesPrerequisites.h"
 
-#include <PropertyWriter.h>
+#include <XmlPropertyWriter.h>
 
 #include "GameObject.h"
 #include "SaveGameFile.h"

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-08 22:44:02 UTC (rev 3835)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-08 22:54:26 UTC (rev 3836)
@@ -18,7 +18,7 @@
 
 #include "SaveGameFileWriter.h"
 
-#include <XmlHelper.h>
+#include <XmlProcessor.h>
 #include <xercesc/dom/DOM.hpp>
 #include <xercesc/dom/DOMAttr.hpp>
 #include <xercesc/dom/DOMElement.hpp>



From blakharaz at mail.berlios.de  Sun Sep  9 01:01:44 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sun, 9 Sep 2007 01:01:44 +0200
Subject: [Dsa-hl-svn] r3837 - rl/trunk/engine/ui/src
Message-ID: <200709082301.l88N1iXM026264@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-09 01:01:38 +0200 (Sun, 09 Sep 2007)
New Revision: 3837

Modified:
   rl/trunk/engine/ui/src/MovementControlState.cpp
Log:



Modified: rl/trunk/engine/ui/src/MovementControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/MovementControlState.cpp	2007-09-08 22:54:26 UTC (rev 3836)
+++ rl/trunk/engine/ui/src/MovementControlState.cpp	2007-09-08 23:01:38 UTC (rev 3837)
@@ -60,7 +60,7 @@
 
 namespace rl {
 
-    String MovementControlState::msDebugWindowPageName = "MovementControlState";
+    Ogre::String MovementControlState::msDebugWindowPageName = "MovementControlState";
 
     MovementControlState::CharacterState::CharacterState()
         :
@@ -223,6 +223,8 @@
             PhysicsManager::getSingleton().getMaterialID("camera"),
             PhysicsManager::getSingleton().getMaterialID("character"))->setContactCallback(this);
 
+        mCharacterState.mCurrentMovementState = MOVE_NONE;
+
         setViewMode(VM_THIRD_PERSON);
     }
 
@@ -763,17 +765,17 @@
                     RaycastInfo infoCastNewPos;
                     Real delta = lenToOptCamPos/2.0f;
                     Vector3 temp = charPos + delta * normToOptCamPos;
-                    // Ann?erung in Schritten, an den Punkt, der von der aktuellen Position aus erreicht werden kann!
+                    // Annaeherung in Schritten, an den Punkt, der von der aktuellen Position aus erreicht werden kann!
                     while( delta > 0.05 ) // genauigkeit des gefundenen Punktes
                     {
                         infoCastNewPos = mRaycast->execute(
                             world,
                             &materialVector,
-                            camPos + camRadius * normToOptCamPos, // Gr?e der Kamera!
+                            camPos + camRadius * normToOptCamPos, // Groesse der Kamera!
                             temp,
                             true);
                         delta = delta/2.0f;
-                        if( infoCastNewPos.mBody ) // Hindernis gefunden, n?er an Char ran
+                        if( infoCastNewPos.mBody ) // Hindernis gefunden, naeher an Char ran
                         {
                             temp = temp - delta * normToOptCamPos;
                         }
@@ -783,16 +785,16 @@
                         }
                     }
 
-                    // Jetzt k?nen wir sicher sein, dass diese Stelle erreichbar ist:
+                    // Jetzt koennen wir sicher sein, dass diese Stelle erreichbar ist:
                     temp = temp - 0.05 * normToOptCamPos;
-                    // Gr?e der Kamera einbeziehen
+                    // Groesse der Kamera einbeziehen
                     optimalCamPos = temp - camRadius * normToOptCamPos;
                     // so ab hier kann ganz normal weiter gerechnet werden!
                 }
             }
 
 
-            // gibt an, ob schon gebufferte Daten fr den
+            // gibt an, ob schon gebufferte Daten fuer den
             // neuen Weg existieren und dort weitergemacht werden kann,
             // oder ob neu nach einem Weg gesucht werden muss!
             if( infoCastChar.mBody && infoCastOptPos.mBody ) // neue Position und Character nicht erreichbar
@@ -800,7 +802,7 @@
                 // anderen Weg finden
                 // hier werden erstmal nur alte Player-Positionen betrachtet
                 // es wird davon ausgegangen, dass diese "nah" genug aneinanderliegen
-                // und durch "Geraden" miteinander verbunden werden k?nen
+                // und durch "Geraden" miteinander verbunden werden koennen
                 // durch das spring-Acc-Damping System sollten die Bewegungen trotzdem flssig
                 // und weich (keine scharfen Kurven) erscheinen
 
@@ -847,7 +849,7 @@
 
                     // suche von lastReachableBufPos aus der letzten Frame nach neuen erreichbaren Buffer-Positionen
                     unsigned int delta = mLastReachableBufPos; // das ist die von der letzten Frame!
-                    while ( delta > 0 ) // delta = 0 braucht nicht berprft zu werden, wurde oben schon ausgeschlossen!
+                    while ( delta > 0 ) // delta = 0 braucht nicht ueberprft zu werden, wurde oben schon ausgeschlossen!
                     {
                         RaycastInfo info = mRaycast->execute(
                             world,
@@ -1278,6 +1280,7 @@
             movement &= ~MOVE_RUN_LOCK;
             retval = true;
         }
+
         if (movement != MOVE_NONE)
         {
             mCharacterState.mCurrentMovementState |= movement;



From josch at mail.berlios.de  Sun Sep  9 02:16:20 2007
From: josch at mail.berlios.de (josch at mail.berlios.de)
Date: Sun, 9 Sep 2007 02:16:20 +0200
Subject: [Dsa-hl-svn] r3838 - dependencies/OgreNewt dependencies/aiml
	dependencies/opensteer dependencies/opensteer/src rl/trunk
	rl/trunk/engine/ai/include rl/trunk/engine/ai/src
	rl/trunk/engine/common/include rl/trunk/engine/common/src
	rl/trunk/engine/core/include rl/trunk/engine/script/src
	rl/trunk/engine/script/swig rl/trunk/engine/startup/src
	rl/trunk/engine/ui/include rl/trunk/engine/ui/src
Message-ID: <200709090016.l890GK2N000799@sheep.berlios.de>

Author: josch
Date: 2007-09-09 02:16:08 +0200 (Sun, 09 Sep 2007)
New Revision: 3838

Modified:
   dependencies/OgreNewt/
   dependencies/aiml/
   dependencies/opensteer/
   dependencies/opensteer/src/Makefile.am
   rl/trunk/configure.in
   rl/trunk/engine/ai/include/Agent.h
   rl/trunk/engine/ai/include/Makefile.am
   rl/trunk/engine/ai/src/Agent.cpp
   rl/trunk/engine/ai/src/Makefile.am
   rl/trunk/engine/common/include/Exception.h
   rl/trunk/engine/common/src/Makefile.am
   rl/trunk/engine/core/include/GameAreaTypes.h
   rl/trunk/engine/script/src/Makefile.am
   rl/trunk/engine/script/swig/Makefile.am
   rl/trunk/engine/startup/src/Makefile.am
   rl/trunk/engine/ui/include/WindowFadeJob.h
   rl/trunk/engine/ui/src/Makefile.am
Log:
Fixed Linux build


Property changes on: dependencies/OgreNewt
___________________________________________________________________
Name: svn:ignore
   - .cdtproject
.project
.sconsign.dblite
Makefile.in
OgreNewt.pc
aclocal.m4
config.guess
config.status
config.sub
configure
depcomp
install-sh
libtool
ltmain.sh
missing
stamp-h1
config.h
Makefile
autom4te.cache

   + .cdtproject
.project
.sconsign.dblite
Makefile.in
OgreNewt.pc
aclocal.m4
config.guess
config.status
config.sub
configure
depcomp
install-sh
libtool
ltmain.sh
missing
stamp-h1
config.h
Makefile
autom4te.cache
config.log



Property changes on: dependencies/aiml
___________________________________________________________________
Name: svn:ignore
   - 
depcomp
install-sh
missing
mkinstalldirs
config.guess
.in
Makefile.in
aclocal.m4
ltmain.sh
config.sub
autom4te.cache
configure
libtool
Makefile
config.status

   + config.log
depcomp
install-sh
missing
mkinstalldirs
config.guess
.in
Makefile.in
aclocal.m4
ltmain.sh
config.sub
autom4te.cache
configure
libtool
Makefile
config.status



Property changes on: dependencies/opensteer
___________________________________________________________________
Name: svn:ignore
   - 
.cdtproject
.project
autom4te.cache
compile
configure
depcomp
install-sh
libtool
Makefile
missing
mkinstalldirs
config.guess
Makefile.in
aclocal.m4
ltmain.sh
config.status
config.sub

   + config.log
.cdtproject
.project
autom4te.cache
compile
configure
depcomp
install-sh
libtool
Makefile
missing
mkinstalldirs
config.guess
Makefile.in
aclocal.m4
ltmain.sh
config.status
config.sub


Modified: dependencies/opensteer/src/Makefile.am
===================================================================
--- dependencies/opensteer/src/Makefile.am	2007-09-08 23:01:38 UTC (rev 3837)
+++ dependencies/opensteer/src/Makefile.am	2007-09-09 00:16:08 UTC (rev 3838)
@@ -4,7 +4,6 @@
 libOpenSteer_la_LDFLAGS =  $(LIBS)
 libOpenSteer_la_SOURCES = \
 	lq.c \
-	Camera.cpp \
 	Clock.cpp \
 	Color.cpp \
 	Obstacle.cpp \

Modified: rl/trunk/configure.in
===================================================================
--- rl/trunk/configure.in	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/configure.in	2007-09-09 00:16:08 UTC (rev 3838)
@@ -93,11 +93,6 @@
 PKG_CHECK_MODULES([CEGUI], [CEGUI >= 0.5.0])
 PKG_CHECK_MODULES([CEGUIOGRE], [CEGUI-OGRE])
 
-# OpenSteer
-AC_CHECK_HEADERS([OpenSteer/SteerLibrary.h], ,[AC_MSG_ERROR([Can't find OpenSteer headers])])
-AC_CHECK_LIB([OpenSteer], [main], , [AC_MSG_ERROR([Can't find libOpenSteer])])
-
-
 dnl Other stuff we need
 AC_CHECK_PROG(HAVE_DOXYGEN_PROG, doxygen, `which doxygen`, false)
 AC_CHECK_LIB([MadaBot], [main], [], AC_MSG_ERROR([Can't find libMadaBot]))
@@ -112,7 +107,7 @@
 OGRE_LIBS="${OGRE_LIBS} ${OgreNewt_LIBS}"
 
 # DSA4Werkzeug
-PKG_CHECK_MODULES(Dsa4Wz, Dsa4Wz >= 1.33.0)
+#PKG_CHECK_MODULES(Dsa4Wz, Dsa4Wz >= 1.33.0)
 
 # meshmagick libraries
 PKG_CHECK_MODULES(meshmagick, meshmagick >= 0.4.0)
@@ -161,6 +156,25 @@
 SWIG_ENABLE_CXX
 SWIG_RUBY
 
+# OpenSteer (need to do that last)
+OLDCFLAGS="${CFLAGS}"
+OLDCXXFLAGS="${CXXFLAGS}"
+OLDCPPFLAGS="${CPPFLAGS}"
+OLDLDFLAGS="${LDFLAGS}"
+CFLAGS="${CFLAGS} ${OGRE_CFLAGS}"
+CXXFLAGS="${CXXFLAGS} ${OGRE_CFLAGS}"
+CPPFLAGS="${CPPFLAGS} ${OGRE_CFLAGS}"
+LDFLAGS="${LDFLAGS} ${OGRE_LIBS}"
+AC_CHECK_HEADERS([OpenSteer/SteerLibrary.h], ,[AC_MSG_ERROR([Can't find OpenSteer headers])])
+AC_CHECK_LIB([OpenSteer], [main], , [AC_MSG_ERROR([Can't find libOpenSteer])])
+CFLAGS="${OLDCFLAGS}"
+CXXFLAGS="${OLDCXXFLAGS}"
+CPPFLAGS="${OLDCPPFLAGS}"
+LDFLAGS="${OLDLDFLAGS}"
+
+
+
+
 dnl Define the directory, where RL should look for modules
 if test "x${prefix}" = "xNONE"; then
     prefix=${ac_default_prefix}

Modified: rl/trunk/engine/ai/include/Agent.h
===================================================================
--- rl/trunk/engine/ai/include/Agent.h	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/ai/include/Agent.h	2007-09-09 00:16:08 UTC (rev 3838)
@@ -20,6 +20,7 @@
 #include "AgentState.h"
 #include "SteeringMachine.h"
 #include "SteeringVehicle.h"
+#include <stack>
 
 namespace rl
 {

Modified: rl/trunk/engine/ai/include/Makefile.am
===================================================================
--- rl/trunk/engine/ai/include/Makefile.am	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/ai/include/Makefile.am	2007-09-09 00:16:08 UTC (rev 3838)
@@ -5,7 +5,6 @@
 	AgentDialogState.h \
 	AgentState.h \
 	AgentSteeringState.h \
-	AiMessages.h \
 	AiPrerequisites.h \
 	AiSubsystem.h \
 	AiWorld.h \
@@ -34,7 +33,6 @@
 	DialogPrerequisites.h \
 	DialogResponse.h \
 	DialogScriptProcessor.h \
-	DialogSubsystem.h \
 	ScriptProcessor.h \
 	predicates/CreaturePredicates.h \
 	predicates/EigenschaftsWertPredicates.h \

Modified: rl/trunk/engine/ai/src/Agent.cpp
===================================================================
--- rl/trunk/engine/ai/src/Agent.cpp	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/ai/src/Agent.cpp	2007-09-09 00:16:08 UTC (rev 3838)
@@ -118,4 +118,4 @@
     SteeringVehicle::update(currentTime, elapsedTime);
 }
 
-}
\ No newline at end of file
+}

Modified: rl/trunk/engine/ai/src/Makefile.am
===================================================================
--- rl/trunk/engine/ai/src/Makefile.am	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/ai/src/Makefile.am	2007-09-09 00:16:08 UTC (rev 3838)
@@ -9,7 +9,6 @@
 	AgentDialogState.cpp \
 	AgentManager.cpp \
 	AgentSteeringState.cpp \
-	AiMessages.cpp \
 	AiSubsystem.cpp \
 	AiWorld.cpp \
 	AStarCosts.cpp \
@@ -35,7 +34,6 @@
 	DialogOption.cpp \
 	DialogResponse.cpp \
 	DialogScriptProcessor.cpp \
-	DialogSubsystem.cpp \
 	ScriptProcessor.cpp \
 	predicates/CreaturePredicates.cpp \
 	predicates/EigenschaftsProbePredicates.cpp \

Modified: rl/trunk/engine/common/include/Exception.h
===================================================================
--- rl/trunk/engine/common/include/Exception.h	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/common/include/Exception.h	2007-09-09 00:16:08 UTC (rev 3838)
@@ -110,7 +110,7 @@
       Exception(const std::string& message,
          const std::string& file, const std::string& function, int line)
          : mMessage(message), mFile(file), mFunction(function), mLine(line), 
-         std::exception(message.c_str()) {}
+         std::exception() {}
       
       Exception(const Exception& rhs) 
           :
@@ -118,7 +118,7 @@
          mFile(rhs.mFile),
          mFunction(rhs.mFunction),
          mLine(rhs.mLine),
-         std::exception(rhs.mMessage.c_str()) {}
+         std::exception() {}
 
       virtual ~Exception() throw() {}
 

Modified: rl/trunk/engine/common/src/Makefile.am
===================================================================
--- rl/trunk/engine/common/src/Makefile.am	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/common/src/Makefile.am	2007-09-09 00:16:08 UTC (rev 3838)
@@ -14,7 +14,6 @@
   Properties.cpp \
   Property.cpp \
   ScriptWrapper.cpp \
-  XmlErrorHandler.cpp \
   XmlProcessor.cpp \
   XmlPropertyReader.cpp \
   XmlPropertyWriter.cpp \

Modified: rl/trunk/engine/core/include/GameAreaTypes.h
===================================================================
--- rl/trunk/engine/core/include/GameAreaTypes.h	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/core/include/GameAreaTypes.h	2007-09-09 00:16:08 UTC (rev 3838)
@@ -21,14 +21,16 @@
 #include "CorePrerequisites.h"
 #include "CoreDefines.h"
 
-
+namespace OgreNewt {
+	class Body;
+}
 namespace rl {
 
 	class PhysicalThing;
 
 /** GameAreaType
- * Verwaltet verschiedene Flaechenarten und Methoden die Aktoren innerhalb dieser Fl?chen zu
- * sammeln. Dabei lassen sich die gefundenen Aktoren ?ber Masken beschr?nken.
+ * Verwaltet verschiedene Flaechenarten und Methoden die Aktoren innerhalb dieser Fl??chen zu
+ * sammeln. Dabei lassen sich die gefundenen Aktoren ??ber Masken beschr??nken.
  *
  *  @see GameAreaListener, GameAreaEventSource, GameEventManager, GameAreaEvent
  */
@@ -36,42 +38,42 @@
 {
 public:
     virtual ~GameAreaType();
-    /** F?hrt die Anfrage durch und sammelt die Aktoren innerhalb einer std::map 
+    /** F???hrt die Anfrage durch und sammelt die Aktoren innerhalb einer std::map 
      *  Key Wert ist der einzigartige Name des Actors
      *
-     *  Die genaue Implementation wird in den Unterklassen durchgef?hrt.
+     *  Die genaue Implementation wird in den Unterklassen durchgef???hrt.
      */
     virtual ActorMap performQuery(  ) = 0;
 
-    /// Gibt die Anfrage-Maske zur?ck, wird in Unterklassen implementiert
+    /// Gibt die Anfrage-Maske zur???ck, wird in Unterklassen implementiert
     virtual unsigned long getQueryMask() const = 0;
     /// Setzt die Anfrage-Maske, wird in Unterklassen implementiert
     virtual void setQueryMask( unsigned long mask = 0xFFFFFFFF ) = 0;
 
-    /// F?gt der Anfrage-Maske ein Flag hinzu
+    /// F???gt der Anfrage-Maske ein Flag hinzu
     void addQueryFlag( unsigned long flag  );
     /// Entfernt ein Flag aus der Anfrage-Maske
     void removeQueryFlag( unsigned long flag );
 
     /// Setzt die genaue Position der Anfrage, wird in Unterklassen implementiert
     virtual void setQueryPosition( const Ogre::Vector3& vec ) = 0;
-    /// Gibt die Position der Anfrage zur?ck, wird in Unterklassen implementiert
+    /// Gibt die Position der Anfrage zur???ck, wird in Unterklassen implementiert
     virtual Ogre::Vector3 getQueryPosition() const = 0;
     /// Setzt die genaue Orientierung der Anfrage, wird in Unterklassen implementiert
     virtual void setQueryOrientation( const Ogre::Quaternion& ori ) = 0;
-    /// Gibt die Orientierung der Anfrage zur?ck, wird in Unterklassen implementiert
+    /// Gibt die Orientierung der Anfrage zur???ck, wird in Unterklassen implementiert
     virtual Ogre::Quaternion getQueryOrientation() const = 0;
 
     /// Blendet ein Debug-Objekt ein, um das Areal zu verdeutlichen
     //virtual setShowDebug() = 0;
-    /// Gibt zur?ck ob ein Debug-Objekt eingeblendet ist
+    /// Gibt zur???ck ob ein Debug-Objekt eingeblendet ist
     //virtual bool getShowDebug() const = 0;
 
     virtual OgreNewt::Body* getBody() { return NULL;}
 
     virtual Ogre::Real getDistance(Actor* actor) = 0;
 
-    /// Der minimale abstand, den ein aktor von der zone haben muss, um die zone zu verlassen (um st?ndige wechsel in und aus der zone zu vermeiden)
+    /// Der minimale abstand, den ein aktor von der zone haben muss, um die zone zu verlassen (um st???ndige wechsel in und aus der zone zu vermeiden)
     virtual Ogre::Real getTransitionDistance() const = 0;
     virtual void setTransitionDistance(Ogre::Real dist) = 0;
 };
@@ -83,7 +85,7 @@
 class _RlCoreExport GameSphereAreaType : public GameAreaType
 {
 public:
-    /** Konstruktor f?r eine Kugelanfrage 
+    /** Konstruktor f???r eine Kugelanfrage 
      *  
      * @param center Das Zentrum der Kugel
      * @param radius Der Radius der Kugel
@@ -93,21 +95,21 @@
     /// Dekonstruktor
     virtual ~GameSphereAreaType();
 
-    /// Implementierung der Anfrage ?ber einen SphereSceneQuery
+    /// Implementierung der Anfrage ???ber einen SphereSceneQuery
     virtual ActorMap performQuery(  );
 
-    /// Gibt die Anfrage-Maske zur?ck
+    /// Gibt die Anfrage-Maske zur???ck
     virtual unsigned long getQueryMask() const;
     /// Setzt die Anfrage-Maske
     virtual void setQueryMask( unsigned long mask = 0xFFFFFFFF );
 
      /// Setzt die genaue Position der Anfrage
     virtual void setQueryPosition( const Ogre::Vector3& vec );
-    /// Gibt die Position der Anfrage zur?ck
+    /// Gibt die Position der Anfrage zur???ck
     virtual Ogre::Vector3 getQueryPosition() const;
     /// Setzt die genaue Orientierung der Anfrage, wird in Unterklassen implementiert
     virtual void setQueryOrientation( const Ogre::Quaternion& ori ) {}
-    /// Gibt die Orientierung der Anfrage zur?ck, wird in Unterklassen implementiert
+    /// Gibt die Orientierung der Anfrage zur???ck, wird in Unterklassen implementiert
     virtual Ogre::Quaternion getQueryOrientation() const {return Ogre::Quaternion::IDENTITY;}
 private:
     /// Die Kugel-Anfrage
@@ -115,7 +117,7 @@
 };
 */
 
-/// ein Problem k?nnte die zeitliche Verschiebung um eine Framedauer sein, wenn position und orientation
+/// ein Problem k???nnte die zeitliche Verschiebung um eine Framedauer sein, wenn position und orientation
 /// neu gesetzt werden, muss erst newton wieder upgedated werden!
 /// Von dieser Klasse muss abgleitet werden, sie definiert keinen eigenen body!
 class _RlCoreExport GameNewtonBodyAreaType : 
@@ -128,21 +130,21 @@
     /// Destruktor
     virtual ~GameNewtonBodyAreaType();
 
-    /// Implementierung der Anfrage ?ber einen SphereSceneQuery
+    /// Implementierung der Anfrage ???ber einen SphereSceneQuery
     virtual ActorMap performQuery(  );
 
-    /// Gibt die Anfrage-Maske zur?ck
+    /// Gibt die Anfrage-Maske zur???ck
     virtual unsigned long getQueryMask() const;
     /// Setzt die Anfrage-Maske
     virtual void setQueryMask( unsigned long mask = 0xFFFFFFFF );
 
      /// Setzt die genaue Position der Anfrage
     virtual void setQueryPosition( const Ogre::Vector3& vec );
-    /// Gibt die Position der Anfrage zur?ck
+    /// Gibt die Position der Anfrage zur???ck
     virtual Ogre::Vector3 getQueryPosition() const;
     /// Setzt die genaue Orientierung der Anfrage, wird in Unterklassen implementiert
     virtual void setQueryOrientation( const Ogre::Quaternion& ori );
-    /// Gibt die Orientierung der Anfrage zur?ck, wird in Unterklassen implementiert
+    /// Gibt die Orientierung der Anfrage zur???ck, wird in Unterklassen implementiert
     virtual Ogre::Quaternion getQueryOrientation() const;
 
     virtual void foundCollision(Actor* actor);

Modified: rl/trunk/engine/script/src/Makefile.am
===================================================================
--- rl/trunk/engine/script/src/Makefile.am	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/script/src/Makefile.am	2007-09-09 00:16:08 UTC (rev 3838)
@@ -1,13 +1,12 @@
 INCLUDES = $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(OIS_CFLAGS) \
 	$(STLPORT_CFLAGS) -I../include -I../../common/include -I../../core/include \
-	-I../../dialog/include -I../../rules/include -I../../ui/include \
+	-I../../rules/include -I../../ui/include \
 	-I../../ai/include
 
 lib_LTLIBRARIES = libRlScript.la
 libRlScript_la_LDFLAGS = \
     $(top_builddir)/engine/common/src/libRlCommon.la \
     $(top_builddir)/engine/core/src/libRlCore.la \
-    $(top_builddir)/engine/dialog/src/libRlDialog.la \
     $(top_builddir)/engine/ui/src/libRlUi.la \
     $(top_builddir)/engine/rules/src/libRlRules.la \
     $(CEGUI_LIBS) $(OGRE_LIBS) $(RUBY_LIBS) $(LIBS) \

Modified: rl/trunk/engine/script/swig/Makefile.am
===================================================================
--- rl/trunk/engine/script/swig/Makefile.am	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/script/swig/Makefile.am	2007-09-09 00:16:08 UTC (rev 3838)
@@ -5,7 +5,7 @@
 RlExports.cxx: RlCore.head.swig RlCore.swig RlRules.head.swig \
  RlRules.swig RlUi.head.swig RlUi.swig RlAi.head.swig RlAi.swig \
  RlScript.head.swig RlScript.swig RlCommon.head.swig RlCommon.swig \
- RlDialog.head.swig RlDialog.swig RlExports.i TypeMaps.i RlExports.i \
+ RlExports.i TypeMaps.i RlExports.i \
  TypeDynamicDirector.swig TypeOgreColourValue.swig TypeOgreQuaternion.swig \
  TypeOgreRadian.swig TypeOgreReal.swig TypeOgreString.swig TypeOgreStringVector.swig \
  TypeOgreVector3.swig TypeRlCeGuiString.swig TypeRlCeGuiStringVector.swig \

Modified: rl/trunk/engine/startup/src/Makefile.am
===================================================================
--- rl/trunk/engine/startup/src/Makefile.am	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/startup/src/Makefile.am	2007-09-09 00:16:08 UTC (rev 3838)
@@ -1,6 +1,6 @@
 INCLUDES = $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(OIS_CFLAGS) $(STLPORT_CFLAGS) \
 	-I../../common/include -I../../core/include -I../../rules/include \
-	-I../../ui/include -I../../dialog/include -I../../script/include -I../../ai/include
+	-I../../ui/include -I../../script/include -I../../ai/include
 
 bin_PROGRAMS = rastullah
 rastullah_SOURCES = RastullahMain.cpp
@@ -8,7 +8,6 @@
     $(top_builddir)/engine/common/src/libRlCommon.la \
     $(top_builddir)/engine/core/src/libRlCore.la \
     $(top_builddir)/engine/ui/src/libRlUi.la \
-    $(top_builddir)/engine/dialog/src/libRlDialog.la \
     $(top_builddir)/engine/rules/src/libRlRules.la \
     $(top_builddir)/engine/script/src/libRlScript.la \
     $(top_builddir)/engine/ai/src/libRlAi.la \

Modified: rl/trunk/engine/ui/include/WindowFadeJob.h
===================================================================
--- rl/trunk/engine/ui/include/WindowFadeJob.h	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/ui/include/WindowFadeJob.h	2007-09-09 00:16:08 UTC (rev 3838)
@@ -39,9 +39,9 @@
 
         WindowFadeJob(AbstractWindow* window, Mode mode,
             Ogre::Real targetAlpha = 1.0f, Ogre::Real changeRate = 4.0f);
-        WindowFadeJob::WindowFadeJob(CEGUI::Window* window, Mode mode, 
+        WindowFadeJob(CEGUI::Window* window, Mode mode, 
             Ogre::Real targetAlpha = 1.0f, Ogre::Real changeRate = 4.0f);
-        WindowFadeJob::WindowFadeJob(ItemDragContainer* window, Mode mode, 
+        WindowFadeJob(ItemDragContainer* window, Mode mode, 
             Ogre::Real targetAlpha = 1.0f, Ogre::Real changeRate = 4.0f);
 
         virtual bool execute(Ogre::Real time);

Modified: rl/trunk/engine/ui/src/Makefile.am
===================================================================
--- rl/trunk/engine/ui/src/Makefile.am	2007-09-08 23:01:38 UTC (rev 3837)
+++ rl/trunk/engine/ui/src/Makefile.am	2007-09-09 00:16:08 UTC (rev 3838)
@@ -1,7 +1,7 @@
 INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(CEGUIOGRE_CFLAGS) \
     $(STLPORT_CFLAGS) $(OIS_CFLAGS) -I../include -I../../common/include  -I../../core/include \
     -I../../rules/include -I../components/include -I../../dialog/include \
-    -I../../startup/include 
+    -I../../startup/include  -I../../ai/include
 
 lib_LTLIBRARIES = libRlUi.la
 libRlUi_la_LIBADD = \



From timm at mail.berlios.de  Sun Sep  9 20:44:55 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 9 Sep 2007 20:44:55 +0200
Subject: [Dsa-hl-svn] r3839 - in rl/trunk/engine: rules rules/include
	rules/src ui/src
Message-ID: <200709091844.l89IitCT023977@sheep.berlios.de>

Author: timm
Date: 2007-09-09 20:44:44 +0200 (Sun, 09 Sep 2007)
New Revision: 3839

Modified:
   rl/trunk/engine/rules/RlRules2005.vcproj
   rl/trunk/engine/rules/include/RulesSubsystem.h
   rl/trunk/engine/rules/include/SaveGameFile.h
   rl/trunk/engine/rules/src/RulesSubsystem.cpp
   rl/trunk/engine/rules/src/SaveGameFile.cpp
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
   rl/trunk/engine/ui/src/SaveLoadWindow.cpp
Log:
- started with building a SaveGameManager. Many features are missing
- fixed a crash while freeing after writing the data to a xml FileHandleDataStream
- save game files are not stored in the module folders anymore
- listing the save games is broken

Modified: rl/trunk/engine/rules/RlRules2005.vcproj
===================================================================
--- rl/trunk/engine/rules/RlRules2005.vcproj	2007-09-09 00:16:08 UTC (rev 3838)
+++ rl/trunk/engine/rules/RlRules2005.vcproj	2007-09-09 18:44:44 UTC (rev 3839)
@@ -411,6 +411,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\src\SaveGameManager.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\SelectionHelper.cpp"
 				>
 			</File>
@@ -645,6 +649,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\SaveGameManager.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\SelectionHelper.h"
 				>
 			</File>

Modified: rl/trunk/engine/rules/include/RulesSubsystem.h
===================================================================
--- rl/trunk/engine/rules/include/RulesSubsystem.h	2007-09-09 00:16:08 UTC (rev 3838)
+++ rl/trunk/engine/rules/include/RulesSubsystem.h	2007-09-09 18:44:44 UTC (rev 3839)
@@ -28,6 +28,7 @@
     class CombatManager;
     class DsaManager;
     class CreatureControllerManager;
+    class SaveGameManager;
     class XdimlLoader;
 
 	class _RlRulesExport RulesSubsystem : public Ogre::Singleton<RulesSubsystem>
@@ -45,6 +46,7 @@
         CombatManager* mCombatManager;
         DsaManager* mDsaManager;
         CreatureControllerManager *mMovingCreatureManager;
+        SaveGameManager* mSaveGameManager;
         XdimlLoader* mXdimlLoader;
     };
 }

Modified: rl/trunk/engine/rules/include/SaveGameFile.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-09 00:16:08 UTC (rev 3838)
+++ rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-09 18:44:44 UTC (rev 3839)
@@ -22,21 +22,30 @@
 
 #include <xercesc/framework/XMLFormatter.hpp>
 
+#include <ctime>
+
 namespace rl
 {
     class _RlRulesExport SaveGameFile
     {
     public:
-        SaveGameFile(const CeGuiString &name);
+        SaveGameFile(const CeGuiString &name, const CeGuiString &moduleID, tm* localTime);
         ~SaveGameFile();
         CeGuiString buildFilename();
         CeGuiString getName();
         bool saveGameExists();
 
+        tm* getLocalTime();
+        CeGuiString getLocalTimeAsString() const;
+
+        CeGuiString getModuleID();
+
         Ogre::DataStreamPtr getDataStream();
         XERCES_CPP_NAMESPACE::XMLFormatTarget* getFormatTarget();
     protected:
         CeGuiString mName;
+        CeGuiString mModuleID;
+        tm* mLocalTime;
     };
 }
 

Modified: rl/trunk/engine/rules/src/RulesSubsystem.cpp
===================================================================
--- rl/trunk/engine/rules/src/RulesSubsystem.cpp	2007-09-09 00:16:08 UTC (rev 3838)
+++ rl/trunk/engine/rules/src/RulesSubsystem.cpp	2007-09-09 18:44:44 UTC (rev 3839)
@@ -24,6 +24,7 @@
 #include "EffectFactory.h"
 #include "Logger.h"
 #include "CreatureControllerManager.h"
+#include "SaveGameManager.h"
 #include "GameObjectManager.h"
 #include "QuestBook.h"
 #include "GameTimeSource.h"
@@ -56,6 +57,8 @@
 		LOG_MESSAGE(Logger::RULES, "DsaManager erzeugt");
         mMovingCreatureManager = new CreatureControllerManager();
 		LOG_MESSAGE(Logger::RULES, "CreatureControllerManager erzeugt");
+        mSaveGameManager = new SaveGameManager();
+        LOG_MESSAGE(Logger::RULES, "SaveGameManager erzeugt");
 		resetQuestBook();
 		LOG_MESSAGE(Logger::RULES, "Questverwaltung erzeugt");
 
@@ -72,6 +75,7 @@
     {
         delete mQuestBook;
         delete mDsaManager;
+        delete mSaveGameManager;
         delete mMovingCreatureManager;
         delete mCombatManager;
         delete mActionManager;

Modified: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-09 00:16:08 UTC (rev 3838)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-09 18:44:44 UTC (rev 3839)
@@ -27,9 +27,11 @@
 namespace rl
 {
 
-    SaveGameFile::SaveGameFile(const CeGuiString &name)
+    SaveGameFile::SaveGameFile(const CeGuiString &name, const CeGuiString &moduleID, tm* localTime)
     {
         mName = name;
+        mModuleID = moduleID;
+        mLocalTime = localTime;
     }
 
     SaveGameFile::~SaveGameFile()
@@ -38,8 +40,8 @@
 
     CeGuiString SaveGameFile::buildFilename()
     {
-        return ConfigurationManager::getSingleton().getModulesRootDirectory() + "/" 
-            + CoreSubsystem::getSingleton().getActiveAdventureModule()->getId() + "/saves/" + mName + ".save";
+        return ConfigurationManager::getSingleton().getModulesRootDirectory() + /*"/" 
+            + CoreSubsystem::getSingleton().getActiveAdventureModule()->getId()*/ + "/saves/" + mName + ".save";
     }
 
     CeGuiString SaveGameFile::getName()
@@ -63,4 +65,25 @@
     {
         return !Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r"))).isNull();
     }
+
+    tm* SaveGameFile::getLocalTime()
+    {
+        return mLocalTime;
+    }
+
+    CeGuiString SaveGameFile::getLocalTimeAsString() const
+    {
+        CeGuiString string = ((Ogre::String)(Ogre::StringConverter::toString(mLocalTime->tm_mday) + "." 
+            + Ogre::StringConverter::toString(mLocalTime->tm_mon) + "."
+            + Ogre::StringConverter::toString(mLocalTime->tm_year + 1900) + " - " 
+            + Ogre::StringConverter::toString(mLocalTime->tm_hour) + ":"
+            + Ogre::StringConverter::toString(mLocalTime->tm_min) + ":" 
+            + Ogre::StringConverter::toString(mLocalTime->tm_sec))).c_str();
+        return string;
+    }
+
+    CeGuiString SaveGameFile::getModuleID()
+    {
+        return mModuleID;
+    }
 }
\ No newline at end of file

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-09 00:16:08 UTC (rev 3838)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-09 18:44:44 UTC (rev 3839)
@@ -68,12 +68,8 @@
         //Write date and time
         DOMElement* timeNode = appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
         
-        time_t rawtime;
-        tm* timeinfo;
+        tm* timeinfo = file->getLocalTime();
 
-        time ( &rawtime );
-        timeinfo = localtime ( &rawtime );
-
         setAttributeValueAsInteger(timeNode, "day", timeinfo->tm_mday);
         setAttributeValueAsInteger(timeNode, "month", timeinfo->tm_mon);
         setAttributeValueAsInteger(timeNode, "year", timeinfo->tm_year+1900);
@@ -126,11 +122,13 @@
 
         mWriter->writeNode(mTarget, *mDocument);
 
+        //mDocument->release();
+        
+
         mWriter->release();
-        delete mTarget;
 
-        mDocument->release();
         delete mDocument;
+        delete mTarget;
 
         shutdownXml();
     }

Modified: rl/trunk/engine/ui/src/SaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-09 00:16:08 UTC (rev 3838)
+++ rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-09 18:44:44 UTC (rev 3839)
@@ -31,11 +31,8 @@
 #include <OgreResourceGroupManager.h>
 
 #include "SaveLoadWindow.h"
-#include "SaveGameFile.h"
-#include "SaveGameFileWriter.h"
-#include "CoreSubsystem.h"
-#include "ContentModule.h"
 #include "ConfigurationManager.h"
+#include "SaveGameManager.h"
 
 using namespace CEGUI;
 
@@ -118,7 +115,7 @@
 
         LOG_MESSAGE(Logger::UI, "Create a SaveGameFile");
 
-        SaveGameFile saveGameFile(mFilename->getText());
+        //SaveGameFile saveGameFile(mFilename->getText());
 
         /*std::list<const GameObject*>::const_iterator it;
         std::list<const GameObject*> gos;
@@ -129,10 +126,12 @@
         {
             sets.push_back((*it)->getAllProperties());
         }*/
-        SaveGameFileWriter saveGameFileWriter;
+        //SaveGameFileWriter saveGameFileWriter;
         //saveGameFileWriter.setPropertySets(sets);
-        saveGameFileWriter.buildSaveGameFile(&saveGameFile);
+        //saveGameFileWriter.buildSaveGameFile(&saveGameFile);
 
+        SaveGameManager::getSingleton().saveSaveGameFile(mFilename->getText());
+
         LOG_MESSAGE(Logger::UI, "Created save game");
 
         listSaveGames();
@@ -150,7 +149,7 @@
 
     void SaveLoadWindow::listSaveGames()
     {
-        Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
+        /*Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
         Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() + "/"
             + Ogre::String(CoreSubsystem::getSingleton().getActiveAdventureModule()->getId().c_str()) + "/saves", "FileSystem", "SaveGames");
         Ogre::StringVectorPtr saveGames = Ogre::ResourceGroupManager::getSingleton().listResourceNames("SaveGames");
@@ -169,7 +168,7 @@
             saveGameNum++;
         }
 
-        Ogre::ResourceGroupManager::getSingleton().destroyResourceGroup("SaveGames");
+        Ogre::ResourceGroupManager::getSingleton().destroyResourceGroup("SaveGames");*/
     }
 
 } // namespace rl



From timm at mail.berlios.de  Sun Sep  9 20:49:29 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 9 Sep 2007 20:49:29 +0200
Subject: [Dsa-hl-svn] r3840 - in rl/trunk/engine/rules: include src
Message-ID: <200709091849.l89InTOH024162@sheep.berlios.de>

Author: timm
Date: 2007-09-09 20:49:23 +0200 (Sun, 09 Sep 2007)
New Revision: 3840

Modified:
   rl/trunk/engine/rules/include/SaveGameFile.h
   rl/trunk/engine/rules/src/SaveGameFile.cpp
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
Log:
new lines at end of files

Modified: rl/trunk/engine/rules/include/SaveGameFile.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-09 18:44:44 UTC (rev 3839)
+++ rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-09 18:49:23 UTC (rev 3840)
@@ -49,4 +49,4 @@
     };
 }
 
-#endif
\ No newline at end of file
+#endif

Modified: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-09 18:44:44 UTC (rev 3839)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-09 18:49:23 UTC (rev 3840)
@@ -86,4 +86,4 @@
     {
         return mModuleID;
     }
-}
\ No newline at end of file
+}

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-09 18:44:44 UTC (rev 3839)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-09 18:49:23 UTC (rev 3840)
@@ -122,8 +122,6 @@
 
         mWriter->writeNode(mTarget, *mDocument);
 
-        //mDocument->release();
-        
 
         mWriter->release();
 



From timm at mail.berlios.de  Sun Sep  9 20:51:16 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 9 Sep 2007 20:51:16 +0200
Subject: [Dsa-hl-svn] r3841 - in rl/trunk/engine/rules: include src
Message-ID: <200709091851.l89IpGaf024269@sheep.berlios.de>

Author: timm
Date: 2007-09-09 20:51:09 +0200 (Sun, 09 Sep 2007)
New Revision: 3841

Added:
   rl/trunk/engine/rules/include/SaveGameManager.h
   rl/trunk/engine/rules/src/SaveGameManager.cpp
Log:
added the missing files ;)

Added: rl/trunk/engine/rules/include/SaveGameManager.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-09 18:49:23 UTC (rev 3840)
+++ rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-09 18:51:09 UTC (rev 3841)
@@ -0,0 +1,58 @@
+/* 
+ * (C) 2003-2007. Team Pantheon. www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here:
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm
+ */
+#ifndef _SaveGameManager_H_
+#define _SaveGameManager_H_
+
+#include "RulesPrerequisites.h"
+#include "SaveGameFileWriter.h"
+#include "SaveGameFile.h"
+
+#include <XmlPropertyWriter.h>
+#include <XmlPropertyReader.h>
+
+namespace rl
+{
+    typedef std::map<CeGuiString, SaveGameFile*> SaveGameEntryMap;
+
+    class SaveGameIndexWriter : public XmlPropertyWriter
+    {
+    public: 
+        SaveGameIndexWriter();
+        void buildIndexFile(const SaveGameEntryMap &map);
+    };
+
+    class SaveGameIndexReader : public XmlPropertyReader
+    {
+    public:
+        SaveGameIndexReader();
+        SaveGameEntryMap &parseIndexFile() const;
+    };
+
+    class _RlRulesExport SaveGameManager : public Ogre::Singleton<SaveGameManager>
+    {
+    public:
+        SaveGameManager();
+
+        SaveGameEntryMap listSaveGames();
+        void saveSaveGameFile(const CeGuiString &name);
+        void loadSaveGameFile(const CeGuiString &name);
+    protected:
+        SaveGameIndexReader* mReader;
+        SaveGameIndexWriter* mWriter;
+    };
+}
+
+#endif

Added: rl/trunk/engine/rules/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-09 18:49:23 UTC (rev 3840)
+++ rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-09 18:51:09 UTC (rev 3841)
@@ -0,0 +1,70 @@
+/* 
+ * (C) 2003-2007. Team Pantheon. www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here:
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm
+ */
+
+#include "stdinc.h"
+
+#include "SaveGameManager.h"
+
+#include <CoreSubsystem.h>
+#include <ContentModule.h>
+
+template<> rl::SaveGameManager* rl::SaveGameManager::ms_Singleton = 0;
+
+namespace rl
+{
+    SaveGameIndexWriter::SaveGameIndexWriter()
+    {
+    }
+
+    void SaveGameIndexWriter::buildIndexFile(const SaveGameEntryMap &map)
+    {
+    }
+
+    SaveGameIndexReader::SaveGameIndexReader()
+    {
+    }
+
+    SaveGameEntryMap &SaveGameIndexReader::parseIndexFile() const
+    {
+        SaveGameEntryMap entries;
+        return entries;
+    }
+
+    SaveGameManager::SaveGameManager()
+    {
+    }
+
+    SaveGameEntryMap SaveGameManager::listSaveGames()
+    {
+        return mReader->parseIndexFile();
+    }
+
+    void SaveGameManager::saveSaveGameFile(const CeGuiString &name)
+    {
+        time_t rawTime;
+        tm* localTime; 
+        time(&rawTime);
+        localTime = localtime(&rawTime); 
+        SaveGameFile file(name, CoreSubsystem::getSingleton().getActiveAdventureModule()->getId(), localTime);
+
+        SaveGameFileWriter writer;
+        writer.buildSaveGameFile(&file);
+    }
+
+    void SaveGameManager::loadSaveGameFile(const CeGuiString &name)
+    {
+    }
+}



From chrber at mail.berlios.de  Sun Sep  9 21:16:31 2007
From: chrber at mail.berlios.de (chrber at mail.berlios.de)
Date: Sun, 9 Sep 2007 21:16:31 +0200
Subject: [Dsa-hl-svn] r3842 - in dependencies/opensteer: . src
Message-ID: <200709091916.l89JGVSi025264@sheep.berlios.de>

Author: chrber
Date: 2007-09-09 21:16:25 +0200 (Sun, 09 Sep 2007)
New Revision: 3842

Added:
   dependencies/opensteer/opensteer.pc.in
Removed:
   dependencies/opensteer/linux/
Modified:
   dependencies/opensteer/Makefile.am
   dependencies/opensteer/configure.in
   dependencies/opensteer/src/Makefile.am
Log:
Removed the obsolete linux build directory
Removed unneeded GCC hash check
Added support for a pkg-config file
Bumped version to 0.9 to differ between official OpenSteer version


Modified: dependencies/opensteer/Makefile.am
===================================================================
--- dependencies/opensteer/Makefile.am	2007-09-09 18:51:09 UTC (rev 3841)
+++ dependencies/opensteer/Makefile.am	2007-09-09 19:16:25 UTC (rev 3842)
@@ -1 +1,5 @@
 SUBDIRS =  src include
+
+pkgconfigdir = $(libdir)/pkgconfig
+pkgconfig_DATA = opensteer.pc
+EXTRA_DIST = opensteer.pc.in

Modified: dependencies/opensteer/configure.in
===================================================================
--- dependencies/opensteer/configure.in	2007-09-09 18:51:09 UTC (rev 3841)
+++ dependencies/opensteer/configure.in	2007-09-09 19:16:25 UTC (rev 3842)
@@ -1,6 +1,6 @@
 AC_PREREQ(2.50)
 
-AC_INIT(OpenSteer, 0.11.0)
+AC_INIT(OpenSteer, 0.9.0)
 AC_CANONICAL_TARGET
 AM_INIT_AUTOMAKE([1.6.1 foreign no-installinfo no-installman subdir-objects])
 
@@ -12,20 +12,8 @@
 AC_PROG_INSTALL
 AM_PROG_LIBTOOL
 
-
-dnl GCC ersion check
-if test x$GCC = xyes; then
-    AC_MSG_CHECKING([version 3.x of gcc])
-    if test -n "`$CC --version 2>&1|grep '3.'`"; then
-        AC_DEFINE(EXT_HASH, 1, Use old STL hash options)
-        AC_DEFINE(GCC_3_1, 1, 3.x GCC version)
-        AC_MSG_RESULT(yes);
-    else
-        AC_MSG_RESULT(no);
-    fi
-fi
-
 CXXFLAGS="$CXXFLAGS -DNOT_OPENSTEERDEMO -DOPENSTEER -Wall "
+
 # ***** DEBUGGING
 AC_ARG_ENABLE(debug,[  --enable-debug          enable debugging [default=no]])
 if test "$enable_debug" = "yes"; then
@@ -48,9 +36,10 @@
 PKG_CHECK_MODULES([OGRE], [OGRE >= 1.4.0])
 
 dnl Create the makefiles
-AC_CONFIG_FILES([Makefile \
-		src/Makefile include/Makefile
-    ])
+AC_CONFIG_FILES([Makefile
+		 src/Makefile
+                 include/Makefile
+                 opensteer.pc])
 
 AC_OUTPUT
 

Added: dependencies/opensteer/opensteer.pc.in
===================================================================
--- dependencies/opensteer/opensteer.pc.in	2007-09-09 18:51:09 UTC (rev 3841)
+++ dependencies/opensteer/opensteer.pc.in	2007-09-09 19:16:25 UTC (rev 3842)
@@ -0,0 +1,11 @@
+prefix=@prefix@
+exec_prefix=@exec_prefix@
+libdir=@libdir@
+includedir=@includedir@
+
+Name: OpenSteer
+Description: C++ steering behavior library
+Version: @VERSION@
+Requires: OGRE
+Libs: -L${libdir} -lopensteer
+Cflags: -I${includedir}/@PACKAGE@

Modified: dependencies/opensteer/src/Makefile.am
===================================================================
--- dependencies/opensteer/src/Makefile.am	2007-09-09 18:51:09 UTC (rev 3841)
+++ dependencies/opensteer/src/Makefile.am	2007-09-09 19:16:25 UTC (rev 3842)
@@ -1,7 +1,7 @@
 INCLUDES =  -I. -I../include $(OGRE_CFLAGS)
 
 lib_LTLIBRARIES = libOpenSteer.la
-libOpenSteer_la_LDFLAGS =  $(LIBS)
+libOpenSteer_la_LDFLAGS =  $(LIBS) -version-number 0:9:0
 libOpenSteer_la_SOURCES = \
 	lq.c \
 	Clock.cpp \



From timm at mail.berlios.de  Sun Sep  9 21:26:11 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 9 Sep 2007 21:26:11 +0200
Subject: [Dsa-hl-svn] r3843 - in rl/trunk/engine/rules: include src
Message-ID: <200709091926.l89JQBEg026429@sheep.berlios.de>

Author: timm
Date: 2007-09-09 21:26:04 +0200 (Sun, 09 Sep 2007)
New Revision: 3843

Modified:
   rl/trunk/engine/rules/include/Makefile.am
   rl/trunk/engine/rules/src/Makefile.am
Log:
fixed make files

Modified: rl/trunk/engine/rules/include/Makefile.am
===================================================================
--- rl/trunk/engine/rules/include/Makefile.am	2007-09-09 19:16:25 UTC (rev 3842)
+++ rl/trunk/engine/rules/include/Makefile.am	2007-09-09 19:26:04 UTC (rev 3843)
@@ -36,6 +36,7 @@
 	RulesSubsystem.h \
 	SaveGameFile.h \
 	SaveGameFileWriter.h \
+	SaveGameManager.h \
 	SelectionHelper.h \
 	Selector.h \
 	Slot.h \

Modified: rl/trunk/engine/rules/src/Makefile.am
===================================================================
--- rl/trunk/engine/rules/src/Makefile.am	2007-09-09 19:16:25 UTC (rev 3842)
+++ rl/trunk/engine/rules/src/Makefile.am	2007-09-09 19:26:04 UTC (rev 3843)
@@ -39,6 +39,7 @@
 	RulesSubsystem.cpp \
 	SaveGameFile.cpp \
 	SaveGameFileWriter.cpp \
+	SaveGameManager.cpp \
 	SelectionHelper.cpp \
 	Selector.cpp \
 	Slot.cpp \



From zero-gravity at mail.berlios.de  Sun Sep  9 22:26:21 2007
From: zero-gravity at mail.berlios.de (zero-gravity at mail.berlios.de)
Date: Sun, 9 Sep 2007 22:26:21 +0200
Subject: [Dsa-hl-svn] r3844 - tools/MaterialParser
Message-ID: <200709092026.l89KQLN8031194@sheep.berlios.de>

Author: zero-gravity
Date: 2007-09-09 22:26:15 +0200 (Sun, 09 Sep 2007)
New Revision: 3844

Modified:
   tools/MaterialParser/MaterialClasses.rb
   tools/MaterialParser/MaterialParser.rb
   tools/MaterialParser/Materializer.rb
Log:
Just a test commit (but also some old bug fixes)

Modified: tools/MaterialParser/MaterialClasses.rb
===================================================================
--- tools/MaterialParser/MaterialClasses.rb	2007-09-09 19:26:04 UTC (rev 3843)
+++ tools/MaterialParser/MaterialClasses.rb	2007-09-09 20:26:15 UTC (rev 3844)
@@ -17,19 +17,21 @@
 end
 
 class AttributedObject
+    attr_reader :attributes
+
     def initialize
         @attributes = []
     end
 
     def addAttribute( name, attributes )
         attributes.pop
-        @attributes.push( Attribute.new( name, attributes ) )
+        @attributes.push( Attribute.new( name, attributes ) )     
     end
 
     def getAttributes( name )
         rets = []
         @attributes.each { |att| 
-            ret.push( att ) unless name != att.name
+            rets.push( att ) unless name != att.name
         }
         return rets
     end
@@ -99,14 +101,15 @@
 end
 
 class Pass < AttributedObject
-    attr_reader :tus, :vprs, :scvprs, :fprs, :name
-    attr_writer :tus, :vprs, :scvprs, :fprs, :name
+    attr_reader :tus, :vprs, :scvprs, :srvprs, :fprs, :name
+    attr_writer :tus, :vprs, :scvprs, :srvprs, :fprs, :name
 
     def initialize( )
         super()
         @tus = []
         @vprs = []
         @scvprs = []
+        @srvprs = []
         @fprs = []
         @name = nil
     end
@@ -121,6 +124,7 @@
         @tus.each { |su| temparr << su.to_s.gsub(/^/, TAB ) }
         @vprs.each { |su| temparr << su.to_s.gsub(/^/, TAB ) }
         @scvprs.each { |su| temparr << su.to_s.gsub(/^/, TAB ) }
+        @srvprs.each { |su| temparr << su.to_s.gsub(/^/, TAB ) }
         @fprs.each { |su| temparr << su.to_s.gsub(/^/, TAB ) }
         temparr << "}\n"
 
@@ -194,6 +198,28 @@
     end
 end
 
+class ShadowReceiverVertexProgramRef < AttributedObject
+    attr_reader :name
+    attr_writer :name
+
+    def initialize( )
+        super()
+        @name = nil
+    end
+
+    def to_s
+        temparr = []
+        
+        temparr << "shadow_receiver_vertex_program_ref"
+        temparr << " " << @name unless @name.nil?
+        temparr << "\n{\n"
+        temparr << super()
+        temparr << "}\n"
+
+        temparr.join
+    end
+end
+
 class FragmentProgramRef < AttributedObject
     attr_reader :name
     attr_writer :name

Modified: tools/MaterialParser/MaterialParser.rb
===================================================================
--- tools/MaterialParser/MaterialParser.rb	2007-09-09 19:26:04 UTC (rev 3843)
+++ tools/MaterialParser/MaterialParser.rb	2007-09-09 20:26:15 UTC (rev 3844)
@@ -4,10 +4,12 @@
 
 class MaterialParser
     attr_reader :materials
+    attr_reader :loose_strings
     include Enumerable
 
 	def initialize
-        @materials = []     
+        @materials = []    
+        @loose_strings = Hash.new
 	end
 
 	def parseFile( filename )
@@ -19,6 +21,15 @@
         @materials.push( mat )
     end
 
+    def addLooseString( filename, string)
+        temp = @loose_strings[filename];
+        temp = string if ( temp == nil )
+        
+        p string;
+
+        @loose_strings[filename] = temp;
+    end
+
     def each
         @materials.each do
             yield
@@ -34,6 +45,7 @@
         tu = TextureUnit.new
         vpr = VertexProgramRef.new
         scvpr = ShadowCasterVertexProgramRef.new
+        srvpr = ShadowReceiverVertexProgramRef.new
         fpr = FragmentProgramRef.new
 
         parser = RDParser.new do
@@ -52,15 +64,19 @@
                 ao.addAttribute( name, attr ); 
             end
 
-            start :skript do
-                match('material', :string, :newlines, '{', :material, '}' ) {|_,n| mat.name = n; mp.addMaterial(mat);mat = Material.new( filename, false ) }
+            start :skript do 
+                match('material', :string, :newlines, '{', :material, '}' ) {|_,n| mat.name = n; mp.addMaterial(mat); mat = Material.new( filename, false ) }
                 match('material', :string, ':', :string, :newlines, '{', :material, '}' ) {|_,n,_,b| mat.name = n; mat.basename = b; mp.addMaterial(mat); mat = Material.new( filename, false ) }
+                
+                match('vertex_program', :string, :string, :newlines, '{', :shader_def, '}' )
+                match('fragment_program', :string, :string, :newlines, '{', :shader_def, '}' )
 
                 match( ::NEWLINE )
+
                 match(:skript, :skript ) 
             end
 
-            rule :material do
+            rule :material do 
                 match('technique', :string, :newlines, '{', :technique, '}' ) {|_,n| tec.name = n; mat.techniques.push( tec ); tec = Technique.new; }
                 match('technique', :newlines, '{', :technique, '}' ) { mat.techniques.push( tec ); tec = Technique.new; } 
 
@@ -73,7 +89,7 @@
                 match(:material, :material ) 
             end
 
-            rule :technique do
+            rule :technique do 
                 match('pass', :string, :newlines, '{', :pass, '}' ) {|_,n| pa.name = n; tec.passes.push( pa ); pa = Pass.new; }
                 match('pass', :newlines, '{', :pass, '}' ) { tec.passes.push( pa ); pa = Pass.new; } 
 
@@ -84,7 +100,7 @@
                 match(:technique, :technique ) 
             end
 
-            rule :pass do
+            rule :pass do 
                 match('texture_unit', :string, :newlines, '{', :texture_unit, '}' ) {|_,n| tu.name = n; pa.tus.push( tu ); tu = TextureUnit.new; }
                 match('texture_unit', :newlines, '{', :texture_unit, '}' ) { pa.tus.push( tu ); tu = TextureUnit.new; } 
 
@@ -94,10 +110,15 @@
                 match('shadow_caster_vertex_program_ref', :string, :newlines, '{', :shadow_caster_vertex_program_ref, '}' ) { pa.scvprs.push( scvpr ); scvpr = ShadowCasterVertexProgramRef.new; } 
                 match('shadow_caster_vertex_program_ref', :newlines,'{', :shadow_caster_vertex_program_ref, '}' ) { pa.scvprs.push( scvpr ); scvpr = ShadowCasterVertexProgramRef.new; } 
 
+                match('shadow_receiver_vertex_program_ref', :string, :newlines, '{', :shadow_caster_vertex_program_ref, '}' ) { pa.srvprs.push( srvpr ); srvpr = ShadowReceiverVertexProgramRef.new; } 
+                match('shadow_receiver_vertex_program_ref', :newlines,'{', :shadow_caster_vertex_program_ref, '}' ) { pa.srvprs.push( srvpr ); srvpr = ShadowReceiverVertexProgramRef.new; } 
+
+
                 match('fragment_program_ref', :string, :newlines, '{', :fragment_program_ref, '}' ) { pa.fprs.push( fpr ); fpr = FragmentProgramRef.new; } 
                 match('fragment_program_ref', :newlines,'{', :fragment_program_ref, '}' ) { pa.fprs.push( fpr ); fpr = FragmentProgramRef.new; } 
 
                 match('alpha_rejection', :string, :int, ::NEWLINE ) {|n,*a| save_attr(pa,n,a) }
+                match('receive_shadows', :string, ::NEWLINE ) {|n,*a| save_attr(pa,n,a) }
                 match('depth_write', :string, ::NEWLINE ) {|n,*a| save_attr(pa,n,a) }
                 match('point_sprites', :string, ::NEWLINE ) {|n,*a| save_attr(pa,n,a) }
                 match('point_size', :int, ::NEWLINE ) {|n,*a| save_attr(pa,n,a) }
@@ -121,7 +142,8 @@
                 match(:pass, :pass ) 
             end
 
-            rule :texture_unit do                 
+            rule :texture_unit do    
+                match('texture', :string, :string, ::NEWLINE ) {|n,*a| save_attr(tu,n,a) }
                 match('texture', :string, ::NEWLINE ) {|n,*a| save_attr(tu,n,a) }
                 match('texture_alias', :string, ::NEWLINE ) {|n,*a| save_attr(tu,n,a) }
                 match('tex_coord_set', :int, ::NEWLINE ) {|n,*a| save_attr(tu,n,a) } 
@@ -142,7 +164,7 @@
                 match(:texture_unit, :texture_unit ) 
             end
 
-            rule :vertex_program_ref do
+            rule :vertex_program_ref do 
                 match('param_named', :string, :params, ::NEWLINE ) {|n,*a| save_attr(vpr,n,a) }
                 match('param_named_auto', :string, :params, ::NEWLINE ) {|n,*a| save_attr(vpr,n,a) }
 
@@ -150,15 +172,23 @@
                 match(:vertex_program_ref, :vertex_program_ref ) 
             end
              
-            rule :shadow_caster_vertex_program_ref do
+            rule :shadow_caster_vertex_program_ref do 
                 match('param_named', :string, :params, ::NEWLINE ) {|n,*a| save_attr(scvpr,n,a) }
                 match('param_named_auto', :string, :params, ::NEWLINE ) {|n,*a| save_attr(scvpr,n,a) }
 
                 match( ::NEWLINE )
                 match(:shadow_caster_vertex_program_ref, :shadow_caster_vertex_program_ref ) 
             end
+             
+            rule :shadow_receiver_vertex_program_ref do 
+                match('param_named', :string, :params, ::NEWLINE ) {|n,*a| save_attr(srvpr,n,a) }
+                match('param_named_auto', :string, :params, ::NEWLINE ) {|n,*a| save_attr(srvpr,n,a) }
 
-            rule :fragment_program_ref do
+                match( ::NEWLINE )
+                match(:shadow_receiver_vertex_program_ref, :shadow_receiver_vertex_program_ref ) 
+            end
+
+            rule :fragment_program_ref do 
                 match('param_named', :string, :params, ::NEWLINE ) {|n,*a| save_attr(fpr,n,a) }
                 match('param_named_auto', :string, :params, ::NEWLINE  ) {|n,*a| save_attr(fpr,n,a) }
 
@@ -166,7 +196,7 @@
                 match(:fragment_program_ref, :fragment_program_ref ) 
             end
 
-            rule :params do                 
+            rule :params do              
                 match( 'float4', :float, :float, :float, :float ) {|*a| a.join(" ") }
                 match( 'float', :float ) {|*a| a.join(" ") }
                 match( :string, :int ) {|*a| a.join(" ") }
@@ -180,6 +210,15 @@
                 match('vertexcolour') 
             end
 
+            rule :shader_def do 
+                match( "source", :string, ::NEWLINE ) 
+	            match( "target", :string, ::NEWLINE ) 
+	            match( "entry_point", :string, ::NEWLINE ) 
+
+                match( ::NEWLINE )
+                match(:shader_def, :shader_def ) 
+            end
+
             rule :string do                
                 match(Float) {|f| String(f) }
                 match(Integer) {|i| String(i) }

Modified: tools/MaterialParser/Materializer.rb
===================================================================
--- tools/MaterialParser/Materializer.rb	2007-09-09 19:26:04 UTC (rev 3843)
+++ tools/MaterialParser/Materializer.rb	2007-09-09 20:26:15 UTC (rev 3844)
@@ -10,10 +10,12 @@
 
 # Change Dir and search for all material files
 Dir.chdir( basePath )
-materialFiles = Dir['**/*.material']
+materialFiles = Dir['**/*.{material,program}']
 
 print "Found #{materialFiles.size} different material-files.\n"
 
+skipped = 0;
+
 # Load all material files and parse them
 materialFiles.each { |filename|
     begin 
@@ -23,7 +25,7 @@
         print "\n"
         print basePath+filename+":0:"+error.to_s
         print "\n"
-        break
+        skipped += 1;
     end
 }
 
@@ -33,12 +35,41 @@
 # Collect some infos...
 numfiles = 0
 materials.each {|m| numfiles+=1 unless not m.firstinfile }
-print "Parsed #{materials.size} different materials in #{numfiles} files.\n\n"
+print "Parsed #{materials.size} different materials in #{numfiles} files (skipped #{skipped}).\n\n"
 
+
+# Collect all 'simple' materials containing just 
+#  - One Technique, - One Pass, - One Texture-Unit AND - One texture
+#  - NO Basematerial
+#  - NO additional attributes
+working = []
+materials.each {|m| 
+    if  m.basename.nil? and
+        m.techniques.size == 1 and 
+        m.techniques.first.attributes.empty? and
+        m.techniques.first.passes.size == 1 and 
+        m.techniques.first.passes.first.attributes.empty? and
+        m.techniques.first.passes.first.tus.size == 1 and
+        m.techniques.first.passes.first.vprs.empty? and
+        m.techniques.first.passes.first.scvprs.empty? and
+        m.techniques.first.passes.first.fprs.empty? and
+        m.techniques.first.passes.first.tus.first.getAttributes( "texture" ).size == 1
+        working << m
+    end
+}
+
+print "Filtered " + working.size.to_s + " materials."
+
+#working.each{ |m| print m.to_s }
+
+exit
+
 # Save the materials
+numfiles = 0
 materials.each {|m| 
     if( m.firstinfile )
         modes = File::CREAT|File::TRUNC|File::WRONLY  
+        numfiles = numfiles +1
     else
         modes = File::CREAT|File::APPEND|File::WRONLY
     end
@@ -46,3 +77,4 @@
     f << m.to_s
     f.close
 }
+print "Saved #{materials.size} different materials in #{numfiles} files.\n\n"
\ No newline at end of file



From chrber at mail.berlios.de  Sun Sep  9 23:09:20 2007
From: chrber at mail.berlios.de (chrber at mail.berlios.de)
Date: Sun, 9 Sep 2007 23:09:20 +0200
Subject: [Dsa-hl-svn] r3845 - in rl/trunk: . engine/ai/src engine/common/src
	engine/core/src engine/rules/include engine/rules/src
	engine/script/src engine/startup/src engine/ui/src
	plugins/fmod4driver/src
Message-ID: <200709092109.l89L9Kcc000878@sheep.berlios.de>

Author: chrber
Date: 2007-09-09 23:09:07 +0200 (Sun, 09 Sep 2007)
New Revision: 3845

Modified:
   rl/trunk/configure.in
   rl/trunk/engine/ai/src/Makefile.am
   rl/trunk/engine/common/src/Makefile.am
   rl/trunk/engine/core/src/Makefile.am
   rl/trunk/engine/rules/include/SaveGameFileWriter.h
   rl/trunk/engine/rules/src/Makefile.am
   rl/trunk/engine/rules/src/SaveGameManager.cpp
   rl/trunk/engine/script/src/Makefile.am
   rl/trunk/engine/startup/src/Makefile.am
   rl/trunk/engine/ui/src/Makefile.am
   rl/trunk/plugins/fmod4driver/src/Makefile.am
Log:
Replaced self written check for OpenSteer with a pkg-config based
Adapted the Makefiles to this change
Fixed a "no newline at end of file" warning
Corrected the instantiation of a singleton varibale (looks like only GCC 4 thinks, this is not per standard, but this is no surprise ^^)


Modified: rl/trunk/configure.in
===================================================================
--- rl/trunk/configure.in	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/configure.in	2007-09-09 21:09:07 UTC (rev 3845)
@@ -103,9 +103,10 @@
 
 # OgreNewt
 PKG_CHECK_MODULES([OgreNewt], [OgreNewt >= 0.07])
-OGRE_CFLAGS="${OGRE_CFLAGS} ${OgreNewt_CFLAGS}"
-OGRE_LIBS="${OGRE_LIBS} ${OgreNewt_LIBS}"
 
+# OpenSteer
+PKG_CHECK_MODULES([OpenSteer], [opensteer >= 0.0.9])
+
 # DSA4Werkzeug
 #PKG_CHECK_MODULES(Dsa4Wz, Dsa4Wz >= 1.33.0)
 
@@ -156,25 +157,6 @@
 SWIG_ENABLE_CXX
 SWIG_RUBY
 
-# OpenSteer (need to do that last)
-OLDCFLAGS="${CFLAGS}"
-OLDCXXFLAGS="${CXXFLAGS}"
-OLDCPPFLAGS="${CPPFLAGS}"
-OLDLDFLAGS="${LDFLAGS}"
-CFLAGS="${CFLAGS} ${OGRE_CFLAGS}"
-CXXFLAGS="${CXXFLAGS} ${OGRE_CFLAGS}"
-CPPFLAGS="${CPPFLAGS} ${OGRE_CFLAGS}"
-LDFLAGS="${LDFLAGS} ${OGRE_LIBS}"
-AC_CHECK_HEADERS([OpenSteer/SteerLibrary.h], ,[AC_MSG_ERROR([Can't find OpenSteer headers])])
-AC_CHECK_LIB([OpenSteer], [main], , [AC_MSG_ERROR([Can't find libOpenSteer])])
-CFLAGS="${OLDCFLAGS}"
-CXXFLAGS="${OLDCXXFLAGS}"
-CPPFLAGS="${OLDCPPFLAGS}"
-LDFLAGS="${OLDLDFLAGS}"
-
-
-
-
 dnl Define the directory, where RL should look for modules
 if test "x${prefix}" = "xNONE"; then
     prefix=${ac_default_prefix}

Modified: rl/trunk/engine/ai/src/Makefile.am
===================================================================
--- rl/trunk/engine/ai/src/Makefile.am	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/engine/ai/src/Makefile.am	2007-09-09 21:09:07 UTC (rev 3845)
@@ -1,8 +1,8 @@
-INCLUDES = $(OGRE_CFLAGS) $(STLPORT_CFLAGS) $(CEGUIOGRE_CFLAGS) -I../include -I ../../core/include \
-	-I ../../common/include -I ../../dialog/include -I ../../rules/include -I../include/predicates
+INCLUDES = $(OGRE_CFLAGS) $(OgreNewt_CFLAGS) $(STLPORT_CFLAGS) $(CEGUIOGRE_CFLAGS) $(BOOST_CPPFLAGS) $(OpenSteer_CFLAGS) \
+	-I../include -I ../../core/include -I ../../common/include -I ../../dialog/include -I ../../rules/include -I../include/predicates
 
 lib_LTLIBRARIES = libRlAi.la
-libRlAi_la_LDFLAGS = $(OGRE_LIBS) $(LIBS)
+libRlAi_la_LDFLAGS = $(OgreNewt_LIBS) $(OpenSteer_LIBS) $(LIBS)
 libRlAi_la_SOURCES = \
 	Agent.cpp \
 	AgentCombatState.cpp \

Modified: rl/trunk/engine/common/src/Makefile.am
===================================================================
--- rl/trunk/engine/common/src/Makefile.am	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/engine/common/src/Makefile.am	2007-09-09 21:09:07 UTC (rev 3845)
@@ -1,4 +1,4 @@
-INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(STLPORT_CFLAGS) $(CEGUI_CFLAGS) -I../include -I../../core/include
+INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(STLPORT_CFLAGS) $(CEGUI_CFLAGS) $(BOOST_CPPFLAGS) -I../include -I../../core/include
 
 lib_LTLIBRARIES = libRlCommon.la
 libRlCommon_la_LDFLAGS = $(RUBY_LIBS) $(OGRE_LIBS) $(CEGUI_LIBS) $(BOOST_FILESYSTEM_LIB) $(LIBS)

Modified: rl/trunk/engine/core/src/Makefile.am
===================================================================
--- rl/trunk/engine/core/src/Makefile.am	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/engine/core/src/Makefile.am	2007-09-09 21:09:07 UTC (rev 3845)
@@ -1,7 +1,8 @@
 # Default values, if configuration file is missing (hard coded)
 AM_CPPFLAGS = -DRL_MODULEDIR=\"$(RL_MODULEDIR)\" -DOGRE_PLUGINDIR=\"$(OGRE_PLUGINDIR)\"
 
-INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(STLPORT_CFLAGS) -I../include -I../../common/include -I../include/nulldriver $(meshmagick_CFLAGS)
+INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(STLPORT_CFLAGS) $(BOOST_CPPFLAGS) \
+           -I../include -I../../common/include -I../include/nulldriver $(meshmagick_CFLAGS)
 
 lib_LTLIBRARIES = libRlCore.la
 libRlCore_la_LDFLAGS = $(OGRE_LIBS) $(CEGUI_LIBS) $(RUBY_LIBS) $(LIBS) $(meshmagick_LIBS)

Modified: rl/trunk/engine/rules/include/SaveGameFileWriter.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-09 21:09:07 UTC (rev 3845)
@@ -34,4 +34,5 @@
     };
 }
 
-#endif
\ No newline at end of file
+#endif
+

Modified: rl/trunk/engine/rules/src/Makefile.am
===================================================================
--- rl/trunk/engine/rules/src/Makefile.am	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/engine/rules/src/Makefile.am	2007-09-09 21:09:07 UTC (rev 3845)
@@ -1,4 +1,4 @@
-INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(STLPORT_CFLAGS) -I../include -I../../common/include -I../../core/include
+INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(STLPORT_CFLAGS) $(BOOST_CPPFLAGS) -I../include -I../../common/include -I../../core/include
 
 lib_LTLIBRARIES = libRlRules.la
 libRlRules_la_LDFLAGS = $(RUBY_LIBS) $(OGRE_LIBS) $(CEGUI_LIBS) $(LIBS)

Modified: rl/trunk/engine/rules/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-09 21:09:07 UTC (rev 3845)
@@ -21,7 +21,7 @@
 #include <CoreSubsystem.h>
 #include <ContentModule.h>
 
-template<> rl::SaveGameManager* rl::SaveGameManager::ms_Singleton = 0;
+template<> rl::SaveGameManager* Ogre::Singleton<rl::SaveGameManager>::ms_Singleton = 0;
 
 namespace rl
 {

Modified: rl/trunk/engine/script/src/Makefile.am
===================================================================
--- rl/trunk/engine/script/src/Makefile.am	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/engine/script/src/Makefile.am	2007-09-09 21:09:07 UTC (rev 3845)
@@ -1,6 +1,6 @@
-INCLUDES = $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(OIS_CFLAGS) \
-	$(STLPORT_CFLAGS) -I../include -I../../common/include -I../../core/include \
-	-I../../rules/include -I../../ui/include \
+INCLUDES = $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(OgreNewt_CFLAGS) $(OIS_CFLAGS) \
+	$(STLPORT_CFLAGS) $(BOOST_CPPFLAGS) -I../include -I../../common/include \
+	-I../../core/include -I../../rules/include -I../../ui/include \
 	-I../../ai/include
 
 lib_LTLIBRARIES = libRlScript.la

Modified: rl/trunk/engine/startup/src/Makefile.am
===================================================================
--- rl/trunk/engine/startup/src/Makefile.am	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/engine/startup/src/Makefile.am	2007-09-09 21:09:07 UTC (rev 3845)
@@ -1,5 +1,5 @@
 INCLUDES = $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(OIS_CFLAGS) $(STLPORT_CFLAGS) \
-	-I../../common/include -I../../core/include -I../../rules/include \
+	$(BOOST_CPPFLAGS) -I../../common/include -I../../core/include -I../../rules/include \
 	-I../../ui/include -I../../script/include -I../../ai/include
 
 bin_PROGRAMS = rastullah

Modified: rl/trunk/engine/ui/src/Makefile.am
===================================================================
--- rl/trunk/engine/ui/src/Makefile.am	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/engine/ui/src/Makefile.am	2007-09-09 21:09:07 UTC (rev 3845)
@@ -1,5 +1,5 @@
 INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(CEGUIOGRE_CFLAGS) \
-    $(STLPORT_CFLAGS) $(OIS_CFLAGS) -I../include -I../../common/include  -I../../core/include \
+    $(STLPORT_CFLAGS) $(OIS_CFLAGS) $(BOOST_CPPFLAGS) -I../include -I../../common/include  -I../../core/include \
     -I../../rules/include -I../components/include -I../../dialog/include \
     -I../../startup/include  -I../../ai/include
 
@@ -15,7 +15,7 @@
     CharacterStateWindow.cpp \
     CloseConfirmationWindow.cpp \
     CombatControlState.cpp \
-	CombatWindow.cpp \
+    CombatWindow.cpp \
     CommandMapper.cpp \
     ConfigComponent.cpp \
     ContainerContentWindow.cpp \

Modified: rl/trunk/plugins/fmod4driver/src/Makefile.am
===================================================================
--- rl/trunk/plugins/fmod4driver/src/Makefile.am	2007-09-09 20:26:15 UTC (rev 3844)
+++ rl/trunk/plugins/fmod4driver/src/Makefile.am	2007-09-09 21:09:07 UTC (rev 3845)
@@ -1,5 +1,5 @@
-INCLUDES = $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(RUBY_CFLAGS) -I../include \
-	-I../../../engine/ui/include -I../../../engine/core/include \
+INCLUDES = $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(BOOST_CPPFLAGS) \
+	-I../include -I../../../engine/ui/include -I../../../engine/core/include \
 	-I../../../engine/common/include
 
 lib_LTLIBRARIES = libRlFmod4Driver.la



From chrber at mail.berlios.de  Sun Sep  9 23:11:04 2007
From: chrber at mail.berlios.de (chrber at mail.berlios.de)
Date: Sun, 9 Sep 2007 23:11:04 +0200
Subject: [Dsa-hl-svn] r3846 - dependencies/OgreNewt
Message-ID: <200709092111.l89LB4Mr000949@sheep.berlios.de>

Author: chrber
Date: 2007-09-09 23:11:02 +0200 (Sun, 09 Sep 2007)
New Revision: 3846

Modified:
   dependencies/OgreNewt/OgreNewt.pc.in
Log:
Set Ogre as a required dependency so CFLAGS and LDFLAGS are merged


Modified: dependencies/OgreNewt/OgreNewt.pc.in
===================================================================
--- dependencies/OgreNewt/OgreNewt.pc.in	2007-09-09 21:09:07 UTC (rev 3845)
+++ dependencies/OgreNewt/OgreNewt.pc.in	2007-09-09 21:11:02 UTC (rev 3846)
@@ -5,6 +5,7 @@
 
 Name: OgreNewt
 Description: Ogre Bindings for the Newton Physics SDK
+Requires: OGRE
 Version: @VERSION@
 Libs: -L${libdir} -lOgreNewt
 Cflags: -I${includedir}/OgreNewt



From chrber at mail.berlios.de  Mon Sep 10 15:20:50 2007
From: chrber at mail.berlios.de (chrber at mail.berlios.de)
Date: Mon, 10 Sep 2007 15:20:50 +0200
Subject: [Dsa-hl-svn] r3847 - rl/trunk/plugins/openaldriver/src
Message-ID: <200709101320.l8ADKo82032732@sheep.berlios.de>

Author: chrber
Date: 2007-09-10 15:20:48 +0200 (Mon, 10 Sep 2007)
New Revision: 3847

Modified:
   rl/trunk/plugins/openaldriver/src/Makefile.am
Log:
Added missing BOOST_CPPFLAGS to Makefile


Modified: rl/trunk/plugins/openaldriver/src/Makefile.am
===================================================================
--- rl/trunk/plugins/openaldriver/src/Makefile.am	2007-09-09 21:11:02 UTC (rev 3846)
+++ rl/trunk/plugins/openaldriver/src/Makefile.am	2007-09-10 13:20:48 UTC (rev 3847)
@@ -1,5 +1,5 @@
-INCLUDES = $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(RUBY_CFLAGS)  -I../include \
-	-I../../../engine/ui/include -I../../../engine/core/include \
+INCLUDES = $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(BOOST_CPPFLAGS) \
+	-I../include -I../../../engine/ui/include -I../../../engine/core/include \
 	-I../../../engine/common/include
 
 lib_LTLIBRARIES = libRlOpenALDriver.la



From timm at mail.berlios.de  Mon Sep 10 15:28:52 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 10 Sep 2007 15:28:52 +0200
Subject: [Dsa-hl-svn] r3848 - modules
Message-ID: <200709101328.l8ADSqnZ000263@sheep.berlios.de>

Author: timm
Date: 2007-09-10 15:28:47 +0200 (Mon, 10 Sep 2007)
New Revision: 3848

Added:
   modules/saves/
Log:
added folder for saves



From timm at mail.berlios.de  Mon Sep 10 21:13:09 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 10 Sep 2007 21:13:09 +0200
Subject: [Dsa-hl-svn] r3849 - in rl/trunk/engine/rules: include src
Message-ID: <200709101913.l8AJD9Xq011530@sheep.berlios.de>

Author: timm
Date: 2007-09-10 21:12:58 +0200 (Mon, 10 Sep 2007)
New Revision: 3849

Modified:
   rl/trunk/engine/rules/include/SaveGameFile.h
   rl/trunk/engine/rules/include/SaveGameManager.h
   rl/trunk/engine/rules/src/SaveGameFile.cpp
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
   rl/trunk/engine/rules/src/SaveGameManager.cpp
Log:
- SaveGameFile is a PropertyHolder now
- Time and ModuleID -> PropertyMap
- building a index file of all savegames

Modified: rl/trunk/engine/rules/include/SaveGameFile.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-10 13:28:47 UTC (rev 3848)
+++ rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-10 19:12:58 UTC (rev 3849)
@@ -20,32 +20,34 @@
 #include "RulesPrerequisites.h"
 #include <OgreDataStream.h>
 
+#include <Property.h>
+#include <Properties.h>
+
 #include <xercesc/framework/XMLFormatter.hpp>
 
 #include <ctime>
 
 namespace rl
 {
-    class _RlRulesExport SaveGameFile
+    class _RlRulesExport SaveGameFile : public PropertyHolder
     {
     public:
-        SaveGameFile(const CeGuiString &name, const CeGuiString &moduleID, tm* localTime);
+        SaveGameFile(const CeGuiString &name);
         ~SaveGameFile();
         CeGuiString buildFilename();
         CeGuiString getName();
         bool saveGameExists();
 
-        tm* getLocalTime();
-        CeGuiString getLocalTimeAsString() const;
-
-        CeGuiString getModuleID();
-
         Ogre::DataStreamPtr getDataStream();
         XERCES_CPP_NAMESPACE::XMLFormatTarget* getFormatTarget();
+
+        virtual const Property getProperty(const Ogre::String& key) const;
+        virtual void setProperty(const Ogre::String& key, const Property& value);
+        virtual PropertySet* getAllProperties() const;
     protected:
         CeGuiString mName;
         CeGuiString mModuleID;
-        tm* mLocalTime;
+        CeGuiString mLocalTime;
     };
 }
 

Modified: rl/trunk/engine/rules/include/SaveGameManager.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-10 13:28:47 UTC (rev 3848)
+++ rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-10 19:12:58 UTC (rev 3849)
@@ -38,13 +38,14 @@
     {
     public:
         SaveGameIndexReader();
-        SaveGameEntryMap &parseIndexFile() const;
+        SaveGameEntryMap parseIndexFile() const;
     };
 
     class _RlRulesExport SaveGameManager : public Ogre::Singleton<SaveGameManager>
     {
     public:
         SaveGameManager();
+        virtual ~SaveGameManager();    
 
         SaveGameEntryMap listSaveGames();
         void saveSaveGameFile(const CeGuiString &name);

Modified: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-10 13:28:47 UTC (rev 3848)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-10 19:12:58 UTC (rev 3849)
@@ -27,11 +27,9 @@
 namespace rl
 {
 
-    SaveGameFile::SaveGameFile(const CeGuiString &name, const CeGuiString &moduleID, tm* localTime)
+    SaveGameFile::SaveGameFile(const CeGuiString &name)
     {
         mName = name;
-        mModuleID = moduleID;
-        mLocalTime = localTime;
     }
 
     SaveGameFile::~SaveGameFile()
@@ -66,24 +64,35 @@
         return !Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r"))).isNull();
     }
 
-    tm* SaveGameFile::getLocalTime()
+    const Property SaveGameFile::getProperty(const Ogre::String& key) const
     {
-        return mLocalTime;
+        if(key == "ModuleID")
+            return Property(mModuleID);
+        else if(key == "Time")
+            return Property(mLocalTime);
+        else
+            return Property();
     }
 
-    CeGuiString SaveGameFile::getLocalTimeAsString() const
+    void SaveGameFile::setProperty(const Ogre::String& key, const Property& value)
     {
-        CeGuiString string = ((Ogre::String)(Ogre::StringConverter::toString(mLocalTime->tm_mday) + "." 
-            + Ogre::StringConverter::toString(mLocalTime->tm_mon) + "."
-            + Ogre::StringConverter::toString(mLocalTime->tm_year + 1900) + " - " 
-            + Ogre::StringConverter::toString(mLocalTime->tm_hour) + ":"
-            + Ogre::StringConverter::toString(mLocalTime->tm_min) + ":" 
-            + Ogre::StringConverter::toString(mLocalTime->tm_sec))).c_str();
-        return string;
+        if(key == "ModuleID")
+        {
+            if(value.isString())
+                mModuleID = value.toString();
+        }
+        else if(key == "Time")
+        {
+            if(value.isString())
+                mLocalTime = value.toString();
+        }
     }
 
-    CeGuiString SaveGameFile::getModuleID()
+    PropertySet* SaveGameFile::getAllProperties() const
     {
-        return mModuleID;
+        PropertySet* set = new PropertySet();
+        set->setProperty("ModuleID", getProperty("ModuleID"));
+        set->setProperty("Time", getProperty("Time"));
+        return set;
     }
 }

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-10 13:28:47 UTC (rev 3848)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-10 19:12:58 UTC (rev 3849)
@@ -52,7 +52,6 @@
         mWriter = static_cast<DOMImplementationLS*>(mImplementation)->createDOMWriter();
         mTarget = file->getFormatTarget();
         mDocument = static_cast<DOMImplementation*>(mImplementation)->createDocument(0, XMLString::transcode("SaveGameFile"), 0);
-        mDocument->setNodeValue(XMLString::transcode("SaveGameFile"));
 
         if (mWriter->canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
             mWriter->setFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true);
@@ -60,15 +59,21 @@
         if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
              mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
 
+        mDocument->setNodeValue(XMLString::transcode("SaveGameFile")); //Set name of document root node
+
+        //Write SaveGameVersion
+        setAttributeValueAsString(mDocument->getDocumentElement(), "Version", "0.1");
+
         //Write modul of save game
         DOMElement* header = appendChildElement(mDocument, mDocument->getDocumentElement(), "header");
         setAttributeValueAsString(header, "ModuleID", CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
         setAttributeValueAsInteger(header, "EngineVersion", CoreSubsystem::getSingleton().getEngineBuildNumber());
-        
+        setAttributeValueAsString(header, "LocalTime", file->getProperty("Time").toString());
+
         //Write date and time
-        DOMElement* timeNode = appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
+        //DOMElement* timeNode = appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
         
-        tm* timeinfo = file->getLocalTime();
+        /*tm* timeinfo = file->getLocalTime();
 
         setAttributeValueAsInteger(timeNode, "day", timeinfo->tm_mday);
         setAttributeValueAsInteger(timeNode, "month", timeinfo->tm_mon);
@@ -76,7 +81,7 @@
 
         setAttributeValueAsInteger(timeNode, "hour", timeinfo->tm_hour);
         setAttributeValueAsInteger(timeNode, "minute", timeinfo->tm_min);
-        setAttributeValueAsInteger(timeNode, "second", timeinfo->tm_sec);
+        setAttributeValueAsInteger(timeNode, "second", timeinfo->tm_sec);*/
 
         //Write globals
         DOMElement* globals = appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");

Modified: rl/trunk/engine/rules/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-10 13:28:47 UTC (rev 3848)
+++ rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-10 19:12:58 UTC (rev 3849)
@@ -20,24 +20,88 @@
 
 #include <CoreSubsystem.h>
 #include <ContentModule.h>
+#include <ConfigurationManager.h>
 
+#include <xercesc/framework/LocalFileFormatTarget.hpp>
+
 template<> rl::SaveGameManager* Ogre::Singleton<rl::SaveGameManager>::ms_Singleton = 0;
 
+using namespace XERCES_CPP_NAMESPACE;
+
 namespace rl
 {
+    CeGuiString printTimeAsString(tm* time)
+    {
+        CeGuiString string = ((Ogre::String)(Ogre::StringConverter::toString(time->tm_mday) + "." 
+            + Ogre::StringConverter::toString(time->tm_mon) + "."
+            + Ogre::StringConverter::toString(time->tm_year + 1900) + " - " 
+            + Ogre::StringConverter::toString(time->tm_hour) + ":"
+            + Ogre::StringConverter::toString(time->tm_min) + ":" 
+            + Ogre::StringConverter::toString(time->tm_sec))).c_str();
+        return string;
+    }
+
     SaveGameIndexWriter::SaveGameIndexWriter()
     {
     }
 
     void SaveGameIndexWriter::buildIndexFile(const SaveGameEntryMap &map)
     {
+        initializeXml();
+
+        XMLCh tempStr[256];
+        XMLString::transcode("LS", tempStr, 255);
+        mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
+        mWriter = static_cast<DOMImplementationLS*>(mImplementation)->createDOMWriter();
+        XMLString::transcode(((Ogre::String)(ConfigurationManager::getSingleton().getModulesRootDirectory() + "/saves/index.saves")).c_str(), tempStr, 255);
+        mTarget = new LocalFileFormatTarget(tempStr);
+        mDocument = static_cast<DOMImplementation*>(mImplementation)->createDocument(0, XMLString::transcode("SaveGameIndexFile"), 0);
+        
+        if (mWriter->canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
+            mWriter->setFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true);
+
+        if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
+             mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
+
+        mDocument->setNodeValue(XMLString::transcode("SaveGameIndexFile")); //Set name of document root node
+
+         //Write SaveGameIndexVersion
+        setAttributeValueAsString(mDocument->getDocumentElement(), "Version", "0.1");
+
+
+        //write save games
+        SaveGameEntryMap::const_iterator it_saves;
+
+        for(it_saves = map.begin(); it_saves != map.end(); it_saves++)
+        {
+            DOMElement* saveGame = appendChildElement(mDocument, mDocument->getDocumentElement(), "savegame");
+            setAttributeValueAsString(saveGame, "Name", it_saves->second->getName());
+
+            PropertyMap map = it_saves->second->getAllProperties()->toPropertyMap();
+            PropertyMap::iterator it_properties;
+            for(it_properties = map.begin(); it_properties != map.end(); it_properties++)
+            {
+                this->processProperty(saveGame, PropertyEntry(it_properties->first.c_str(), it_properties->second));
+            }
+        }        
+
+
+        mWriter->writeNode(mTarget, *mDocument);
+
+
+        mWriter->release();
+
+        delete mDocument;
+        delete mTarget;
+
+        shutdownXml();
     }
 
     SaveGameIndexReader::SaveGameIndexReader()
     {
     }
 
-    SaveGameEntryMap &SaveGameIndexReader::parseIndexFile() const
+    SaveGameEntryMap SaveGameIndexReader::parseIndexFile() const
     {
         SaveGameEntryMap entries;
         return entries;
@@ -45,8 +109,16 @@
 
     SaveGameManager::SaveGameManager()
     {
+        mReader = new SaveGameIndexReader();
+        mWriter = new SaveGameIndexWriter();
     }
 
+    SaveGameManager::~SaveGameManager()
+    {
+        delete mReader;
+        delete mWriter;
+    }
+
     SaveGameEntryMap SaveGameManager::listSaveGames()
     {
         return mReader->parseIndexFile();
@@ -58,13 +130,21 @@
         tm* localTime; 
         time(&rawTime);
         localTime = localtime(&rawTime); 
-        SaveGameFile file(name, CoreSubsystem::getSingleton().getActiveAdventureModule()->getId(), localTime);
+        SaveGameFile file(name);
+        file.setProperty("Time", Property(printTimeAsString(localTime)));
+        file.setProperty("ModuleID", Property(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName()));
 
+        SaveGameEntryMap map = listSaveGames();
+        map[name] = &file;
+
+        mWriter->buildIndexFile(map);
+
         SaveGameFileWriter writer;
         writer.buildSaveGameFile(&file);
     }
 
     void SaveGameManager::loadSaveGameFile(const CeGuiString &name)
     {
+        ///@todo: SaveGameReader
     }
 }



From josch at mail.berlios.de  Mon Sep 10 23:32:43 2007
From: josch at mail.berlios.de (josch at mail.berlios.de)
Date: Mon, 10 Sep 2007 23:32:43 +0200
Subject: [Dsa-hl-svn] r3850 - dependencies/opensteer
	rl/trunk/engine/core/src rl/trunk/engine/rules/src
	rl/trunk/engine/startup/src rl/trunk/engine/ui/src
Message-ID: <200709102132.l8ALWhaA021354@sheep.berlios.de>

Author: josch
Date: 2007-09-10 23:32:18 +0200 (Mon, 10 Sep 2007)
New Revision: 3850

Modified:
   dependencies/opensteer/
   dependencies/opensteer/opensteer.pc.in
   rl/trunk/engine/core/src/Makefile.am
   rl/trunk/engine/rules/src/Makefile.am
   rl/trunk/engine/startup/src/Makefile.am
   rl/trunk/engine/ui/src/Makefile.am
Log:
Fixed Linux build


Property changes on: dependencies/opensteer
___________________________________________________________________
Name: svn:ignore
   - config.log
.cdtproject
.project
autom4te.cache
compile
configure
depcomp
install-sh
libtool
Makefile
missing
mkinstalldirs
config.guess
Makefile.in
aclocal.m4
ltmain.sh
config.status
config.sub

   + config.log
.cdtproject
.project
autom4te.cache
compile
configure
depcomp
install-sh
libtool
Makefile
missing
mkinstalldirs
config.guess
Makefile.in
aclocal.m4
ltmain.sh
config.status
config.sub
opensteer.pc


Modified: dependencies/opensteer/opensteer.pc.in
===================================================================
--- dependencies/opensteer/opensteer.pc.in	2007-09-10 19:12:58 UTC (rev 3849)
+++ dependencies/opensteer/opensteer.pc.in	2007-09-10 21:32:18 UTC (rev 3850)
@@ -7,5 +7,5 @@
 Description: C++ steering behavior library
 Version: @VERSION@
 Requires: OGRE
-Libs: -L${libdir} -lopensteer
+Libs: -L${libdir} -lOpenSteer
 Cflags: -I${includedir}/@PACKAGE@

Modified: rl/trunk/engine/core/src/Makefile.am
===================================================================
--- rl/trunk/engine/core/src/Makefile.am	2007-09-10 19:12:58 UTC (rev 3849)
+++ rl/trunk/engine/core/src/Makefile.am	2007-09-10 21:32:18 UTC (rev 3850)
@@ -1,11 +1,11 @@
 # Default values, if configuration file is missing (hard coded)
 AM_CPPFLAGS = -DRL_MODULEDIR=\"$(RL_MODULEDIR)\" -DOGRE_PLUGINDIR=\"$(OGRE_PLUGINDIR)\"
 
-INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(STLPORT_CFLAGS) $(BOOST_CPPFLAGS) \
+INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(STLPORT_CFLAGS) $(BOOST_CPPFLAGS) $(OgreNewt_CFLAGS) \
            -I../include -I../../common/include -I../include/nulldriver $(meshmagick_CFLAGS)
 
 lib_LTLIBRARIES = libRlCore.la
-libRlCore_la_LDFLAGS = $(OGRE_LIBS) $(CEGUI_LIBS) $(RUBY_LIBS) $(LIBS) $(meshmagick_LIBS)
+libRlCore_la_LDFLAGS = $(OGRE_LIBS) $(CEGUI_LIBS) $(RUBY_LIBS) $(LIBS) $(meshmagick_LIBS) $(OgreNewt_LIBS)
 libRlCore_la_SOURCES = \
 	Actor.cpp \
 	ActorControlledObject.cpp \

Modified: rl/trunk/engine/rules/src/Makefile.am
===================================================================
--- rl/trunk/engine/rules/src/Makefile.am	2007-09-10 19:12:58 UTC (rev 3849)
+++ rl/trunk/engine/rules/src/Makefile.am	2007-09-10 21:32:18 UTC (rev 3850)
@@ -1,7 +1,7 @@
-INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(STLPORT_CFLAGS) $(BOOST_CPPFLAGS) -I../include -I../../common/include -I../../core/include
+INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(STLPORT_CFLAGS) $(BOOST_CPPFLAGS) $(OgreNewt_CFLAGS) -I../include -I../../common/include -I../../core/include
 
 lib_LTLIBRARIES = libRlRules.la
-libRlRules_la_LDFLAGS = $(RUBY_LIBS) $(OGRE_LIBS) $(CEGUI_LIBS) $(LIBS)
+libRlRules_la_LDFLAGS = $(RUBY_LIBS) $(OGRE_LIBS) $(CEGUI_LIBS) $(LIBS) $(OgreNewt_LIBS)
 libRlRules_la_SOURCES = \
 	Action.cpp \
 	ActionManager.cpp \

Modified: rl/trunk/engine/startup/src/Makefile.am
===================================================================
--- rl/trunk/engine/startup/src/Makefile.am	2007-09-10 19:12:58 UTC (rev 3849)
+++ rl/trunk/engine/startup/src/Makefile.am	2007-09-10 21:32:18 UTC (rev 3850)
@@ -1,6 +1,6 @@
 INCLUDES = $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(OIS_CFLAGS) $(STLPORT_CFLAGS) \
 	$(BOOST_CPPFLAGS) -I../../common/include -I../../core/include -I../../rules/include \
-	-I../../ui/include -I../../script/include -I../../ai/include
+	-I../../ui/include -I../../script/include -I../../ai/include $(OgreNewt_CFLAGS)
 
 bin_PROGRAMS = rastullah
 rastullah_SOURCES = RastullahMain.cpp
@@ -11,7 +11,7 @@
     $(top_builddir)/engine/rules/src/libRlRules.la \
     $(top_builddir)/engine/script/src/libRlScript.la \
     $(top_builddir)/engine/ai/src/libRlAi.la \
-    $(RUBY_LIBS) $(LIBS) $(CEGUI_LIBS) $(OGRE_LIBS)
+    $(RUBY_LIBS) $(LIBS) $(CEGUI_LIBS) $(OGRE_LIBS) $(OgreNewt_LIBS)
 
 
 

Modified: rl/trunk/engine/ui/src/Makefile.am
===================================================================
--- rl/trunk/engine/ui/src/Makefile.am	2007-09-10 19:12:58 UTC (rev 3849)
+++ rl/trunk/engine/ui/src/Makefile.am	2007-09-10 21:32:18 UTC (rev 3850)
@@ -1,11 +1,11 @@
-INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(CEGUIOGRE_CFLAGS) \
+INCLUDES = $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(CEGUI_CFLAGS) $(CEGUIOGRE_CFLAGS) $(OgreNewt_CFLAGS) \
     $(STLPORT_CFLAGS) $(OIS_CFLAGS) $(BOOST_CPPFLAGS) -I../include -I../../common/include  -I../../core/include \
     -I../../rules/include -I../components/include -I../../dialog/include \
     -I../../startup/include  -I../../ai/include
 
 lib_LTLIBRARIES = libRlUi.la
 libRlUi_la_LIBADD = \
-    $(RUBY_LIBS) $(LIBS) $(CEGUI_LIBS) $(OGRE_LIBS) $(CEGUIOGRE_LIBS) $(OIS_LIBS)
+    $(RUBY_LIBS) $(LIBS) $(CEGUI_LIBS) $(OGRE_LIBS) $(CEGUIOGRE_LIBS) $(OIS_LIBS) $(OgreNewt_LIBS)
 
 libRlUi_la_SOURCES = \
     AboutWindow.cpp \



From no22 at mail.berlios.de  Wed Sep 12 21:44:02 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Wed, 12 Sep 2007 21:44:02 +0200
Subject: [Dsa-hl-svn] r3851 - rl/trunk/engine/rules/include
Message-ID: <200709121944.l8CJi2U5021074@sheep.berlios.de>

Author: no22
Date: 2007-09-12 21:44:01 +0200 (Wed, 12 Sep 2007)
New Revision: 3851

Modified:
   rl/trunk/engine/rules/include/Creature.h
Log:
* translated a few (very few) interface docs into english

Modified: rl/trunk/engine/rules/include/Creature.h
===================================================================
--- rl/trunk/engine/rules/include/Creature.h	2007-09-10 21:32:18 UTC (rev 3850)
+++ rl/trunk/engine/rules/include/Creature.h	2007-09-12 19:44:01 UTC (rev 3851)
@@ -101,8 +101,8 @@
 ///////////////////////////////////////////////////////////////////////////////
 // Typedefs
             /**
-             *  Liste der Talente. Besteht aus den Namen der Talente (z.B. Athletik)
-                   *  als Schluessel und ihrem Wert.
+             *  List of all talents. Consists of the (german) name of the talent
+             *  (e.g. "Athletik") as key and its value (TaW)
              **/
             typedef std::map<const CeGuiString, int> TalentMap;
 
@@ -127,7 +127,7 @@
 
             typedef Ogre::String Wert;
 
-    // some targets
+            // some targets
 			static const std::string ALL_EIGENSCHAFTEN;
 			static const std::string ALL_TALENTE;
 
@@ -162,40 +162,37 @@
                 ALIGNMENT_ENEMY   = 4  ///< Creature fights against the player.
             };
 
-            /// Beschreibt die art des zugefuegten Schadens
+            /// Determines the damage type
             enum DamageTag
             {
                 DAMAGETAG_NORMAL = 1,
                 DAMAGETAG_PIERCING, ///< Wie Pfeile, Bolzen oder gezielte Stiche, verletzen schon bei KO/2 < SP
                 DAMAGETAG_FIRE
         };
-            /// Die verschiedenen stati in denen sich eine @ref abbdes "SF" befinden kann.
-            enum SfStatus
+            /// The differente states a @ref abbdes "SF" can be in.
+             enum SfStatus
             {
                 SFSTATUS_IN_TRAINING = 1,
                 SFSTATUS_OK,
-                SFSTATUS_REQUIREMENTS_NOT_MET /// @todo Wird das ueberhaupt gebraucht?
+                SFSTATUS_REQUIREMENTS_NOT_MET /// @todo Is this even needed?
         };
 
 ///////////////////////////////////////////////////////////////////////////////
 // Werte
 
             /**
-             *  Veraendert die aktuelle @ref abbdel "LE" der Kreatur.
-             *  @param mod Der Wert um den die LE erhoeht (erniedrigt bei 
-             *   negativem Wert) werden soll
-             *  @param ignoreMax Wenn true kann die LE auch ueber das Maximum
-             *   hinaus erhoeht werden.
-             *  @ingroup CreatureRubyExports
+             *  Modifies the current @ref abbdel "LE" of the creature.
+             *  @param mod The value to be added to the LE (so to lower the LE, pass a negative 
+             *  value).
+             *  @param ignoreMax If ture, the LE can be increased beayond the maximum.
              **/
             virtual void modifyLe(int mod, bool ignoreMax = false);
             /**
-             *  Gibt die aktuelle @ref abbdel "LE" der Kreatur zurueck.
-             *  @ingroup CreatureRubyExports
+             *  Returns the current @ref abbdel "LE" of the creature.
              **/
             virtual int getLe();
             /**
-             *  Gibt die maximale Anzahl an @ref abbdel "LE" zurueck, die die Kreatur haben kann.
+             *  Returns the maximum @ref abbdel "LE" the creature can have.
              **/
             virtual int getLeMax();
 



From pnyx at mail.berlios.de  Sun Sep 16 11:41:08 2007
From: pnyx at mail.berlios.de (pnyx at mail.berlios.de)
Date: Sun, 16 Sep 2007 11:41:08 +0200
Subject: [Dsa-hl-svn] r3852 - in modules: common/materials
	common/materials/model common/materials/programs
	common/materials/programs/Normalmapping common/models
	ruchin/dsa ruchin/maps ruchin/models ruchin/scripts
	ruchin/scripts/maps
Message-ID: <200709160941.l8G9f8Aq005900@sheep.berlios.de>

Author: pnyx
Date: 2007-09-16 11:34:55 +0200 (Sun, 16 Sep 2007)
New Revision: 3852

Added:
   modules/common/materials/programs/Basic_Vertex_Shader_noDirectional.source
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV0_noDirectional_VS.hlsl
   modules/ruchin/models/Ruchin_Hessi_innen.mesh
   modules/ruchin/models/Ruchin_g.mesh
   modules/ruchin/scripts/equip.rb
Removed:
   modules/ruchin/dsa/mckherotest.gof
Modified:
   modules/common/materials/men_human_female_hair_long01_normal.mesh.material
   modules/common/materials/model/men_human_female_hair_long_01_spec.png
   modules/common/materials/programs/Basic_Vertex_Shader.program
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping.material
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec.material
   modules/common/materials/programs/Normalmapping/Normalmapping.program
   modules/common/materials/programs/Normalmapping/Skin_Normalmapping.material
   modules/common/models/men_human_female_cloth_long.mesh
   modules/common/models/men_human_female_cloth_short.mesh
   modules/common/models/men_human_female_leg_pants_01_long.mesh
   modules/common/models/men_human_female_torso.mesh
   modules/ruchin/maps/ruchin_lightzones.rlmap.xml
   modules/ruchin/models/House_dummies.mesh
   modules/ruchin/models/Ruchin_inside.material
   modules/ruchin/models/Ruchin_l.mesh
   modules/ruchin/models/Ruchin_map.mesh
   modules/ruchin/models/Ruchin_n.mesh
   modules/ruchin/models/Ruchin_s.mesh
   modules/ruchin/models/Ruchintest.material
   modules/ruchin/models/Stadtmauer.mesh
   modules/ruchin/scripts/maps/maptest.rb
Log:
Added WIP of part g
Added Hessi interior
Added Shader that ignores directional lights to fake interior light form outside the zone.
Changed stuff I cant remember :)

Modified: modules/common/materials/men_human_female_hair_long01_normal.mesh.material
===================================================================
--- modules/common/materials/men_human_female_hair_long01_normal.mesh.material	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/common/materials/men_human_female_hair_long01_normal.mesh.material	2007-09-16 09:34:55 UTC (rev 3852)
@@ -1,5 +1,5 @@
 
-material men_human_female_hair_long_01_normal : Basic_Normalmapping_Spec_Alpha
+material men_human_female_hair_long_01_normal : Basic_Normalmapping_Spec_Hair
 {
 set_texture_alias DiffuseMap men_human_female_hair_long_01.png
 set_texture_alias NormalMap men_human_female_hair_long_01_normal.png

Modified: modules/common/materials/model/men_human_female_hair_long_01_spec.png
===================================================================
(Binary files differ)

Modified: modules/common/materials/programs/Basic_Vertex_Shader.program
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader.program	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/common/materials/programs/Basic_Vertex_Shader.program	2007-09-16 09:34:55 UTC (rev 3852)
@@ -7,7 +7,15 @@
 	target vs_2_0
 	entry_point vs_main
 }
-//DirectX 9.0 HLSL Pixel Shader ps_2_0
+
+vertex_program Basic_Vertex_Shader_noDirectional hlsl
+{
+	source Basic_Vertex_Shader_noDirectional.source
+	target vs_2_0
+	entry_point vs_main
+}
+
+//DirectX 9.0 HLSL Pixel Shader ps_2_0 
 fragment_program Basic_Pixel_Shader hlsl
 {
 	source Basic_Pixel_Shader.source
@@ -141,3 +149,114 @@
         }
     }
 }
+
+
+material Basic_Vertex_Shader_noDirectional
+{
+	receive_shadows off
+	technique glsl
+	{
+		//Rendering Pass: Pass 0 (pass index: #0 )
+		pass
+		{
+			alpha_rejection greater 128
+			//DirectX 9.0 HLSL Pixel Shader ps_2_0
+			fragment_program_ref Basic_Pixel_Shader_glsl
+			{
+				param_named baseMap int 0
+			}
+			//DirectX 9.0 HLSL Vertex Shader vs_2_0
+			vertex_program_ref Basic_Vertex_Shader_glsl
+			{
+				// param_named_auto
+
+				param_named_auto Light1_attenuation light_attenuation 0
+				param_named_auto Light1_color light_diffuse_colour 0
+				param_named_auto Light1_position light_position_object_space 0
+				param_named Light1_spec_power float 0.3
+				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
+				
+				
+				param_named_auto matViewProjection worldviewproj_matrix
+				param_named_auto vViewPosition camera_position_object_space
+				
+				
+				param_named skycolor float4 0.5 0.5 0.5 1.0
+				param_named groundcolor float4 0.10 0.10 0.10 1.0
+			}
+			
+			texture_unit
+			{
+				texture_alias diffuse
+
+			}
+		}
+	}
+	
+	technique hlsl
+	{
+		//Rendering Pass: Pass 0 (pass index: #0 )
+		pass
+		{
+			alpha_rejection greater 128
+			//DirectX 9.0 HLSL Pixel Shader ps_2_0
+			fragment_program_ref Basic_Pixel_Shader
+			{
+			}
+			//DirectX 9.0 HLSL Vertex Shader vs_2_0
+			vertex_program_ref Basic_Vertex_Shader_noDirectional
+			{
+				// param_named_auto
+
+				param_named_auto Light1_attenuation light_attenuation 0
+				param_named_auto Light1_color light_diffuse_colour 0
+				param_named_auto Light1_position light_position_object_space 0
+				param_named Light1_spec_power float 0.3
+				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
+				
+				
+				param_named_auto matViewProjection worldviewproj_matrix
+				param_named_auto vViewPosition camera_position_object_space
+				
+				
+				param_named skycolor float4 0.5 0.5 0.5 1.0
+				param_named groundcolor float4 0.10 0.10 0.10 1.0
+			}
+			
+			texture_unit
+			{
+				texture_alias diffuse
+
+			}
+		}
+	}
+
+	technique
+	{
+        pass
+        {
+            texture_unit
+            {
+                texture_alias diffuse
+            }
+        }
+    }
+}

Added: modules/common/materials/programs/Basic_Vertex_Shader_noDirectional.source
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader_noDirectional.source	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/common/materials/programs/Basic_Vertex_Shader_noDirectional.source	2007-09-16 09:34:55 UTC (rev 3852)
@@ -0,0 +1,119 @@
+float4x4 matViewProjection;
+float4 skycolor;
+float4 groundcolor;
+float4 Light1_attenuation;
+float4 Light1_position;
+float4 Light1_color;
+float4 Light1_spec_power;
+
+float4 Light2_attenuation;
+float4 Light2_position;
+float4 Light2_color;
+float4 Light2_spec_power;
+
+float4 Light3_attenuation;
+float4 Light3_position;
+float4 Light3_color;
+float4 Light3_spec_power;
+
+float4 vViewPosition;
+
+struct VS_INPUT 
+{
+   float4 Position : POSITION0;
+   float2 Texcoord : TEXCOORD0;
+   float2 Texcoord1 : TEXCOORD1;
+   float2 Texcoord2: TEXCOORD2;
+   float3 Normal   : NORMAL;
+   
+};
+
+struct VS_OUTPUT 
+{
+   float4 Position : POSITION0;
+   float2 Texcoord : TEXCOORD0;
+   float2 Texcoord1: TEXCOORD1;
+   float2 Texcoord2: TEXCOORD2;
+   float4 Color    : TEXCOORD3;
+   
+};
+
+VS_OUTPUT vs_main( VS_INPUT Input )
+{
+   VS_OUTPUT Output;
+   Output.Color = lerp(skycolor,groundcolor,(dot(Input.Normal, float3(0,-1,0))+1)/2 );
+   Output.Position = mul( matViewProjection, Input.Position );
+   
+   
+   
+   // Light1
+   
+   float3 LightDir = Light1_position - Input.Position;
+   float Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   float AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   float3 EyeVect = normalize(Input.Position - vViewPosition);
+   float3 HalfVect = normalize(LightDir - EyeVect);
+   
+   float SpecAttn = Light1_color * Light1_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   float DistAttn = clamp(1/ (Light1_attenuation.y +
+                              Light1_attenuation.z * Dist +
+                              Light1_attenuation.w * Dist * Dist)
+                          ,0,1);
+   
+   Output.Color += (Light1_color * AngleAttn + SpecAttn) * DistAttn * Light1_position.w;
+   
+   
+   // Light3
+   
+   LightDir = Light3_position - Input.Position;
+   Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   EyeVect = normalize(Input.Position - vViewPosition);
+   HalfVect = normalize(LightDir - EyeVect);
+   
+   SpecAttn = Light3_color * Light3_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   DistAttn = clamp(1/ (Light3_attenuation.y +
+                              Light3_attenuation.z * Dist +
+                              Light3_attenuation.w * Dist * Dist)
+                          ,0,1);
+   
+   Output.Color += (Light3_color * AngleAttn + SpecAttn) * DistAttn * Light3_position.w;
+   
+   
+   // Light2
+   
+   LightDir = Light2_position - Input.Position;
+   Dist = length(LightDir);
+   LightDir = LightDir / Dist;
+   
+   AngleAttn = saturate( dot(Input.Normal ,LightDir));
+   
+   HalfVect = normalize(LightDir - EyeVect);
+   
+   SpecAttn = Light2_color *Light2_spec_power * pow(clamp(dot(Input.Normal,HalfVect),0,1),32);
+   
+   DistAttn = clamp(1/ (Light2_attenuation.y +
+                        Light2_attenuation.z * Dist +
+                        Light2_attenuation.w * Dist * Dist)
+                        ,0,1);
+   
+   Output.Color += (Light2_color * AngleAttn + SpecAttn) * DistAttn * Light2_position.w;
+   
+   Output.Texcoord = Input.Texcoord;
+   Output.Texcoord1 = Input.Texcoord1;
+   Output.Texcoord2 = Input.Texcoord2;
+   
+   return( Output );
+   
+}
+
+
+

Modified: modules/common/materials/programs/Normalmapping/Basic_Normalmapping.material
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping.material	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping.material	2007-09-16 09:34:55 UTC (rev 3852)
@@ -1,4 +1,4 @@
-material Basic_Normalmapping
+material Basic_Normalmapping 
 {
 	lod_distances 12 100
 	
@@ -230,4 +230,122 @@
             }
         } 
     }
+}
+
+
+
+material Basic_Normalmapping_noDirectional
+{
+	lod_distances 12 100
+	
+    technique hlsl
+    {
+	    lod_index 0
+        pass
+        {
+            vertex_program_ref Basic_Normalmapping_UV0_noDirectional_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+                param_named SpecColor float4 0.2 0.2 0.2 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+        }
+    }
+    
+    technique hlsl1
+	{
+		lod_index 1
+		//Rendering Pass: Pass 0 (pass index: #0 )
+		pass
+		{
+			alpha_rejection greater 128
+			//DirectX 9.0 HLSL Pixel Shader ps_2_0
+			fragment_program_ref Basic_Pixel_Shader
+			{
+			}
+			//DirectX 9.0 HLSL Vertex Shader vs_2_0
+			vertex_program_ref Basic_Vertex_Shader
+			{
+				// param_named_auto
+
+				param_named_auto Light1_attenuation light_attenuation 0
+				param_named_auto Light1_color light_diffuse_colour 0
+				param_named_auto Light1_position light_position_object_space 0
+				param_named Light1_spec_power float 0.3
+				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
+				
+				
+				param_named_auto matViewProjection worldviewproj_matrix
+				param_named_auto vViewPosition camera_position_object_space
+				
+				
+				param_named skycolor float4 0.5 0.5 0.5 1.0
+				param_named groundcolor float4 0.10 0.10 0.10 1.0
+			}
+			
+			texture_unit
+			{
+				texture_alias DiffuseMap
+
+			}
+		}
+	}
+    
+
+    technique fixed_function
+    {
+	    lod_index 2
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
 }
\ No newline at end of file

Modified: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec.material
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec.material	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_Spec.material	2007-09-16 09:34:55 UTC (rev 3852)
@@ -364,4 +364,266 @@
             }
         } 
     }
+}
+
+
+material Basic_Normalmapping_Spec_Hair
+{
+	lod_distances 12 100
+	
+    technique hlsl
+    {
+	    lod_index 0
+        pass
+        {
+	        scene_blend alpha_blend 
+      		// Tiefenpuffer aus
+      		depth_write off
+      		//alpha_rejection greater 128
+      		
+      		cull_hardware anticlockwise 
+      		cull_software back
+      		
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_Spec_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+        }
+        
+        
+        pass
+        {
+	        scene_blend alpha_blend 
+      		// Tiefenpuffer aus
+      		depth_write off
+      		//alpha_rejection greater 20
+      		
+      		cull_hardware clockwise 
+      		cull_software front 
+      		
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_Spec_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+        }
+    }
+    
+    technique hlsl1
+	{
+		//Rendering Pass: Pass 0 (pass index: #0 )
+		pass
+		{
+			scene_blend alpha_blend 
+      		// Tiefenpuffer aus
+      		//depth_write off
+      		alpha_rejection greater 128
+      		
+      		cull_hardware anticlockwise 
+      		cull_software back 
+      		
+			//DirectX 9.0 HLSL Pixel Shader ps_2_0
+			fragment_program_ref Hair_Pixel_Shader
+			{
+			}
+			//DirectX 9.0 HLSL Vertex Shader vs_2_0
+			vertex_program_ref Hair_Vertex_Shader
+			{
+				// param_named_auto
+
+				param_named_auto Light1_attenuation light_attenuation 0
+				param_named_auto Light1_color light_diffuse_colour 0
+				param_named_auto Light1_position light_position_object_space 0
+				param_named Light1_spec_power float 0.3
+				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 1.0
+				
+				
+				param_named_auto matViewProjection worldviewproj_matrix
+				param_named_auto vViewPosition camera_position_object_space
+				
+				
+				param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+		}
+		
+		pass
+		{
+			scene_blend alpha_blend 
+      		// Tiefenpuffer aus
+      		//depth_write off
+      		alpha_rejection greater 20
+      		
+      		cull_hardware clockwise 
+      		cull_software front 
+      		
+			//DirectX 9.0 HLSL Pixel Shader ps_2_0
+			fragment_program_ref Hair_Pixel_Shader
+			{
+			}
+			//DirectX 9.0 HLSL Vertex Shader vs_2_0
+			vertex_program_ref Hair_Vertex_Shader
+			{
+				// param_named_auto
+
+				param_named_auto Light1_attenuation light_attenuation 0
+				param_named_auto Light1_color light_diffuse_colour 0
+				param_named_auto Light1_position light_position_object_space 0
+				param_named Light1_spec_power float 0.3
+				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 1.0
+				
+				
+				param_named_auto matViewProjection worldviewproj_matrix
+				param_named_auto vViewPosition camera_position_object_space
+				
+				
+				param_named groundcolor float4 0.1 0.1 0.1 1.0
+                param_named skycolor float4 0.5 0.5 0.5 1.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+            
+            texture_unit SpecMap
+            {
+                texture_alias SpecMap
+            }
+		}
+		
+		
+	}
+
+    technique fixed_function
+    {
+	    lod_index 1
+        pass
+        {
+            ambient 0.6 0.6 0.6 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
 }
\ No newline at end of file

Added: modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV0_noDirectional_VS.hlsl
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV0_noDirectional_VS.hlsl	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping_UV0_noDirectional_VS.hlsl	2007-09-16 09:34:55 UTC (rev 3852)
@@ -0,0 +1,98 @@
+float4x4 matViewProjection;
+float4 LightPosition_0;
+float4 LightPosition_1;
+float4 LightPosition_2;
+float4 vViewPosition;
+float4 LightAttn_0;
+float4 LightAttn_1;
+float4 LightAttn_2;
+
+struct VS_OUTPUT 
+{
+   float4 Position   : POSITION0;
+   float2 UV         : TEXCOORD0;
+   float4 LightDir_0 : TEXCOORD1;
+   float3 HalfVect_0 : TEXCOORD2;
+   float4 LightDir_1 : TEXCOORD3;
+   float3 HalfVect_1 : TEXCOORD4;
+   float4 LightDir_2 : TEXCOORD5;
+   float3 HalfVect_2 : TEXCOORD6;
+   float3 SkyDir     : TEXCOORD7;
+   
+};
+
+VS_OUTPUT vs_main(      float4 inPosition : POSITION0,
+                        float3 inNormal : NORMAL0,
+                        float3 inTangent : TANGENT0,
+                        float2 inUV:   TEXCOORD )
+{
+   VS_OUTPUT Output;
+
+   Output.Position = mul( matViewProjection, inPosition );
+   Output.UV = inUV;
+   
+   float3x3 TangentSpace;
+   
+   TangentSpace[0] = inTangent;   
+   TangentSpace[1] = cross(inTangent,inNormal);   
+   TangentSpace[2] = inNormal;
+   
+   float3 EyeVector = normalize(vViewPosition - inPosition);
+   
+   //################# Light 0  ################
+   float4 LightDir;
+   LightDir.xyz = LightPosition_0 - inPosition;
+   float Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_0.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_0.y +
+                            LightAttn_0.z * Dist +
+                            LightAttn_0.w * Dist * Dist));
+                            
+   
+   
+   Output.HalfVect_0 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_0 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 1  ################
+   LightDir;
+   LightDir.xyz = LightPosition_1 - inPosition;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_1.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_1.y +
+                            LightAttn_1.z * Dist +
+                            LightAttn_1.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_1 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_1 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   //################# Light 2  ################
+   LightDir;
+   LightDir.xyz = LightPosition_2 - inPosition;
+   Dist = length(LightDir.xyz);
+   LightDir.xyz = LightDir.xyz /Dist;
+   
+   if (LightPosition_2.w != 0.0)
+   LightDir.w = saturate(1/(LightAttn_2.y +
+                            LightAttn_2.z * Dist +
+                            LightAttn_2.w * Dist * Dist));
+                            
+   
+   Output.HalfVect_2 = mul(TangentSpace, normalize(LightDir.xyz + EyeVector));
+   Output.LightDir_2 = float4(mul(TangentSpace,LightDir.xyz),LightDir.w);
+   
+   
+   // SkyLight
+   Output.SkyDir    = mul(TangentSpace, float3(0,-1,0));
+   
+   
+   return( Output );
+   
+}
+
+
+

Modified: modules/common/materials/programs/Normalmapping/Normalmapping.program
===================================================================
--- modules/common/materials/programs/Normalmapping/Normalmapping.program	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/common/materials/programs/Normalmapping/Normalmapping.program	2007-09-16 09:34:55 UTC (rev 3852)
@@ -5,6 +5,13 @@
     target vs_1_1
 }
 
+vertex_program Basic_Normalmapping_UV0_noDirectional_VS_HLSL hlsl
+{
+    source Basic_Normalmapping_UV0_noDirectional_VS.hlsl
+    entry_point vs_main
+    target vs_1_1
+}
+
 vertex_program Basic_Normalmapping_UV1_VS_HLSL hlsl
 {
     source Basic_Normalmapping_UV1_VS.hlsl

Modified: modules/common/materials/programs/Normalmapping/Skin_Normalmapping.material
===================================================================
--- modules/common/materials/programs/Normalmapping/Skin_Normalmapping.material	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/common/materials/programs/Normalmapping/Skin_Normalmapping.material	2007-09-16 09:34:55 UTC (rev 3852)
@@ -162,7 +162,7 @@
                 param_named_auto LightAttn_1 light_attenuation 1
                 param_named_auto LightAttn_2 light_attenuation 2
                 
-                param_named eyeDirection float3 0.0 1 0.0
+                param_named eyeDirection float3 0.25 1 0.0
                 
                 param_named_auto vViewPosition	 camera_position_object_space
             }

Modified: modules/common/models/men_human_female_cloth_long.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_cloth_short.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_leg_pants_01_long.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_torso.mesh
===================================================================
(Binary files differ)

Deleted: modules/ruchin/dsa/mckherotest.gof
===================================================================
--- modules/ruchin/dsa/mckherotest.gof	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/ruchin/dsa/mckherotest.gof	2007-09-16 09:34:55 UTC (rev 3852)
@@ -1,20 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<GameObjectDefinitions>
-
-    <gameobjectclass classid="mckhero"  baseclass="MCKHero">
-        <property name="geometrytype" type="STRING" data="ellipsoid" />
-        <property name="mass" type="REAL" data="75"/>
-        <property name="inventorywindowtype" type="STRING" data="inventory_human.xml"/>
-        <property name="meshfile" type="STRING" data="men_human_female_torso.mesh"/>
-        <property name="geometrytype" type="STRING" data="ellipsoid"/>
-        <property name="meshparts" type="MAP">
-            <property name="torso" type="STRING" data="men_human_female_torso.mesh"/>
-            <property name="hand" type="STRING" data="men_human_female_hand_nude.mesh"/>
-            <property name="head" type="STRING" data="men_human_female_head_02.mesh"/>
-            <property name="hair" type="STRING" data="men_human_female_hair_long_01_normal.mesh"/>
-            <property name="leg" type="STRING" data="men_human_female_leg_pants_01_long.mesh"/>
-            <property name="feet" type="STRING" data="men_human_female_feet_boots_01.mesh"/>
-        </property>
-    </gameobjectclass>
-    
-</GameObjectDefinitions>
\ No newline at end of file

Modified: modules/ruchin/maps/ruchin_lightzones.rlmap.xml
===================================================================
--- modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-16 09:34:55 UTC (rev 3852)
@@ -1,6 +1,22 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <rastullahmap formatVersion="0.4.0">
 	<nodes>
+		<entity name="Ruchin_Hessi_innen" meshfile="Ruchin_Hessi_innen.mesh" visible="true" receivesShadow="true">
+			<position x="130.0" y="0.0" z="-50.0" />
+			<rotation qx="0.0" qy="0.0" qz="0.0" qw="1.0" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<staticgeometrygroup id="0"/>
+			<renderingdistance data="100" /> 
+		</entity>
+		
+		<entity name="Ruchin_g" meshfile="Ruchin_g.mesh" visible="true" receivesShadow="true">
+			<position x="120.0" y="0.0" z="-50.0" />
+			<rotation qx="0.0" qy="0.0" qz="0.0" qw="1.0" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<staticgeometrygroup id="0"/>
+			<renderingdistance data="100" /> 
+		</entity>
+	
 		<entity name="Ruchin_l_innen" meshfile="Ruchin_l_innen.mesh" visible="true" receivesShadow="true">
 			<position x="65.2876" y="6.02141" z="-66.9458" />
 			<rotation qx="0.0" qy="0.0" qz="0.0" qw="1.0" />
@@ -144,14 +160,14 @@
 			<position x="112.486" y="1.53497" z="-17.18" />
 			<rotation qx="0.0" qy="-0.707107" qz="0.0" qw="0.707107" />
 			<scale x="1.0" y="1.0" z="1.0" />
-			<staticgeometrygroup id="39"/>
+			<staticgeometrygroup id="3"/>
 			<renderingdistance data="100" />
 		</entity>
 		<entity name="Statue_02" meshfile ="Statue_02.mesh" visible="true" receivesShadow="true">
 			<position x="112.486" y="1.53497" z="-24.0179" />
 			<rotation qx="0.0" qy="-0.707107" qz="0.0" qw="0.707107" />
 			<scale x="1.0" y="1.0" z="1.0" />
-			<staticgeometrygroup id="40"/>
+			<staticgeometrygroup id="3"/>
 			<renderingdistance data="100" />
 		</entity>
 		
@@ -264,13 +280,17 @@
 		
 		<light name="sun" type="directional" visible="true" castShadows="true">
 			<colourDiffuse r="0.8" g="0.8" b="0.8" />
-			<colourSpecular r="0" g="0" b="1" />
+			<colourDiffuse r="0.8" g="0.8" b="0.8" />
 			<direction x="-0.17101" y="-0.873647" z="0.969846" />
 		</light>
 	</nodes>
 	<zones>
 		<zone name="default">
 			<light name="sun"/>
+			<light name="Ruchin_l_Light2"/>
+			<light name="Ruchin_l_Light1"/>
+			<light name="templeLight1"/>
+			<light name="templeLight2"/>
 		</zone>
 		<zone name="temple_zone">
 			<area type="mesh" meshfile="temple_lightzone.mesh">

Modified: modules/ruchin/models/House_dummies.mesh
===================================================================
(Binary files differ)

Added: modules/ruchin/models/Ruchin_Hessi_innen.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_Hessi_innen.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/ruchin/models/Ruchin_g.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_g.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/ruchin/models/Ruchin_inside.material
===================================================================
--- modules/ruchin/models/Ruchin_inside.material	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/ruchin/models/Ruchin_inside.material	2007-09-16 09:34:55 UTC (rev 3852)
@@ -1,5 +1,5 @@
 
-material Ruchin_inside/base : Basic_Vertex_Shader
+material Ruchin_inside/base : Basic_Vertex_Shader_noDirectional
 {
 set_texture_alias diffuse ruchin_atlasmap.png
 

Modified: modules/ruchin/models/Ruchin_l.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_map.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_n.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_s.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchintest.material
===================================================================
--- modules/ruchin/models/Ruchintest.material	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/ruchin/models/Ruchintest.material	2007-09-16 09:34:55 UTC (rev 3852)
@@ -127,13 +127,6 @@
 
 }
 
-material base : Basic_Vertex_Shader
-{
-set_texture_alias diffuse ruchin_atlasmap.png
-
-}
-
-
 material Ruchin/Schiefer : Basic_Vertex_Shader
 {
 set_texture_alias diffuse arc_schieferdach.png
@@ -144,4 +137,4 @@
 {
 set_texture_alias diffuse ruchin_atlasmap.dds
 
-}
\ No newline at end of file
+}

Modified: modules/ruchin/models/Stadtmauer.mesh
===================================================================
(Binary files differ)

Added: modules/ruchin/scripts/equip.rb
===================================================================
--- modules/ruchin/scripts/equip.rb	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/ruchin/scripts/equip.rb	2007-09-16 09:34:55 UTC (rev 3852)
@@ -0,0 +1,23 @@
+require 'npc.rb'
+	
+	$SCRIPT.log("aktiven hero geten");
+	hero = $UI.getActiveCharacter();
+	
+	$SCRIPT.log("backpack erstellen");
+    #backpack = $GOM.createGameObject("leather backpack");
+    #backpack.addAction(ShowContainerContentAction.new());
+    #backpack.setPosition(center);
+    #backpack.placeIntoScene();
+    
+    #$SCRIPT.log("inventar f?llen!!!");
+    #hero.getInventory().hold(backpack, "Back");
+    
+    itemToAdd = $GOM.createGameObject("men_human_female_leg_pants_01_long");
+    hero.getInventory().hold(itemToAdd, "Trousers");
+    #hero.getInventory().getItem("Back").addItem(itemToAdd);
+    itemToAdd = $GOM.createGameObject("men_human_female_cloth_short");
+    hero.getInventory().hold(itemToAdd, "Clothes");
+    #hero.getInventory().getItem("Back").addItem(itemToAdd);
+    itemToAdd = $GOM.createGameObject("men_human_female_feet_boots_01");
+    hero.getInventory().hold(itemToAdd, "Boots");
+   # hero.getInventory().getItem("Back").addItem(itemToAdd);
\ No newline at end of file

Modified: modules/ruchin/scripts/maps/maptest.rb
===================================================================
--- modules/ruchin/scripts/maps/maptest.rb	2007-09-12 19:44:01 UTC (rev 3851)
+++ modules/ruchin/scripts/maps/maptest.rb	2007-09-16 09:34:55 UTC (rev 3852)
@@ -81,3 +81,4 @@
 ##########################
 
 load "particle.rb"
+load "equip.rb"
\ No newline at end of file



From blakharaz at mail.berlios.de  Tue Sep 18 00:53:44 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 18 Sep 2007 00:53:44 +0200
Subject: [Dsa-hl-svn] r3853 - in modules: aitest/models common/models
Message-ID: <200709172253.l8HMriuC016398@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-18 00:53:37 +0200 (Tue, 18 Sep 2007)
New Revision: 3853

Added:
   modules/common/models/tie_wolf_01.mesh
Removed:
   modules/aitest/models/tie_wolf_01.mesh
Log:
Moved to common

Deleted: modules/aitest/models/tie_wolf_01.mesh
===================================================================
(Binary files differ)

Copied: modules/common/models/tie_wolf_01.mesh (from rev 3852, modules/aitest/models/tie_wolf_01.mesh)



From blakharaz at mail.berlios.de  Tue Sep 18 00:54:16 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 18 Sep 2007 00:54:16 +0200
Subject: [Dsa-hl-svn] r3854 - in modules: aitest/models common/models
Message-ID: <200709172254.l8HMsGRM017235@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-18 00:54:10 +0200 (Tue, 18 Sep 2007)
New Revision: 3854

Added:
   modules/common/models/tie_wolf_01_mesh.skeleton
Removed:
   modules/aitest/models/tie_wolf_01_mesh.skeleton
Log:
Moved wolf to common

Deleted: modules/aitest/models/tie_wolf_01_mesh.skeleton
===================================================================
(Binary files differ)

Copied: modules/common/models/tie_wolf_01_mesh.skeleton (from rev 3853, modules/aitest/models/tie_wolf_01_mesh.skeleton)



From blakharaz at mail.berlios.de  Tue Sep 18 00:56:58 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 18 Sep 2007 00:56:58 +0200
Subject: [Dsa-hl-svn] r3855 - in modules: aitest/materials common/materials
Message-ID: <200709172256.l8HMuwV7018731@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-18 00:56:53 +0200 (Tue, 18 Sep 2007)
New Revision: 3855

Added:
   modules/common/materials/tie_wolf_01.material
Removed:
   modules/aitest/materials/tie_wolf_01.material
Log:
Moved wolf to common

Deleted: modules/aitest/materials/tie_wolf_01.material
===================================================================
--- modules/aitest/materials/tie_wolf_01.material	2007-09-17 22:54:10 UTC (rev 3854)
+++ modules/aitest/materials/tie_wolf_01.material	2007-09-17 22:56:53 UTC (rev 3855)
@@ -1,15 +0,0 @@
-material 02_-_Default
-{
-	technique
-	{
-		pass
-		{
-			alpha_rejection greater 128
-
-			texture_unit
-			{
-				texture wolf1.dds
-			}
-		}
-	}
-}
\ No newline at end of file

Copied: modules/common/materials/tie_wolf_01.material (from rev 3854, modules/aitest/materials/tie_wolf_01.material)



From blakharaz at mail.berlios.de  Tue Sep 18 00:58:37 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 18 Sep 2007 00:58:37 +0200
Subject: [Dsa-hl-svn] r3856 - in modules: aitest/materials/textures
	common/materials/model
Message-ID: <200709172258.l8HMwbXx019945@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-18 00:58:26 +0200 (Tue, 18 Sep 2007)
New Revision: 3856

Added:
   modules/common/materials/model/wolf1.dds
Removed:
   modules/aitest/materials/textures/wolf1.dds
Log:
Moved wolf to common

Deleted: modules/aitest/materials/textures/wolf1.dds
===================================================================
(Binary files differ)

Copied: modules/common/materials/model/wolf1.dds (from rev 3855, modules/aitest/materials/textures/wolf1.dds)



From pnyx at mail.berlios.de  Tue Sep 18 18:34:01 2007
From: pnyx at mail.berlios.de (pnyx at mail.berlios.de)
Date: Tue, 18 Sep 2007 18:34:01 +0200
Subject: [Dsa-hl-svn] r3857 - in modules: common/materials/programs
	common/materials/programs/Normalmapping ruchin/maps
	ruchin/models techdemo2/materials techdemo2/models
Message-ID: <200709181634.l8IGY1MG002731@sheep.berlios.de>

Author: pnyx
Date: 2007-09-18 18:32:57 +0200 (Tue, 18 Sep 2007)
New Revision: 3857

Added:
   modules/ruchin/models/Ruchin_Hesi_innen.mesh
   modules/ruchin/models/Ruchin_Hesi_lightzone.mesh
Removed:
   modules/ruchin/models/Ruchin_Hessi_innen.mesh
Modified:
   modules/common/materials/programs/Basic_Vertex_Shader.program
   modules/common/materials/programs/Basic_Vertex_Shader.source
   modules/common/materials/programs/Basic_Vertex_Shader_noDirectional.source
   modules/common/materials/programs/Normalmapping/Basic_Normalmapping.material
   modules/ruchin/maps/ruchin_lightzones.rlmap.xml
   modules/ruchin/models/Ruchin_inside.material
   modules/ruchin/models/Ruchin_l_innen.mesh
   modules/ruchin/models/Ruchin_l_innen_lightzone_laden.mesh
   modules/ruchin/models/Ruchin_l_innen_lightzone_mitte.mesh
   modules/ruchin/models/Ruchin_l_innen_lightzone_oben.mesh
   modules/ruchin/models/Ruchin_l_innen_lightzone_unten.mesh
   modules/ruchin/models/temple_lightzone.mesh
   modules/techdemo2/materials/nat_TD2Fluss.material
   modules/techdemo2/models/nat_TD2Fluss.mesh
Log:
* Added Prelit VertexColors to interiors
* updated shaders to display Vertex Colors
* turned off all lights for noDirectional shader, will be adjusted later when lights can be activated for specific objects.
* Added Lightzone for Hesis house

Modified: modules/common/materials/programs/Basic_Vertex_Shader.program
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader.program	2007-09-17 22:58:26 UTC (rev 3856)
+++ modules/common/materials/programs/Basic_Vertex_Shader.program	2007-09-18 16:32:57 UTC (rev 3857)
@@ -154,11 +154,13 @@
 material Basic_Vertex_Shader_noDirectional
 {
 	receive_shadows off
+	
 	technique glsl
 	{
 		//Rendering Pass: Pass 0 (pass index: #0 )
 		pass
 		{
+		lighting off
 			alpha_rejection greater 128
 			//DirectX 9.0 HLSL Pixel Shader ps_2_0
 			fragment_program_ref Basic_Pixel_Shader_glsl
@@ -190,7 +192,7 @@
 				param_named_auto vViewPosition camera_position_object_space
 				
 				
-				param_named skycolor float4 0.5 0.5 0.5 1.0
+				param_named skycolor float4 0.2 0.2 0.2 1.0
 				param_named groundcolor float4 0.10 0.10 0.10 1.0
 			}
 			
@@ -207,6 +209,7 @@
 		//Rendering Pass: Pass 0 (pass index: #0 )
 		pass
 		{
+		lighting off
 			alpha_rejection greater 128
 			//DirectX 9.0 HLSL Pixel Shader ps_2_0
 			fragment_program_ref Basic_Pixel_Shader
@@ -237,7 +240,7 @@
 				param_named_auto vViewPosition camera_position_object_space
 				
 				
-				param_named skycolor float4 0.5 0.5 0.5 1.0
+				param_named skycolor float4 0.2 0.2 0.2 1.0
 				param_named groundcolor float4 0.10 0.10 0.10 1.0
 			}
 			

Modified: modules/common/materials/programs/Basic_Vertex_Shader.source
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader.source	2007-09-17 22:58:26 UTC (rev 3856)
+++ modules/common/materials/programs/Basic_Vertex_Shader.source	2007-09-18 16:32:57 UTC (rev 3857)
@@ -25,6 +25,7 @@
    float2 Texcoord1 : TEXCOORD1;
    float2 Texcoord2: TEXCOORD2;
    float3 Normal   : NORMAL;
+   float4 vColor : COLOR0;
    
 };
 
@@ -106,7 +107,7 @@
                         ,0,1);
    
    Output.Color += (Light2_color * AngleAttn + SpecAttn) * DistAttn ;
-   
+   Output.Color *= Input.vColor;
    Output.Texcoord = Input.Texcoord;
    Output.Texcoord1 = Input.Texcoord1;
    Output.Texcoord2 = Input.Texcoord2;

Modified: modules/common/materials/programs/Basic_Vertex_Shader_noDirectional.source
===================================================================
--- modules/common/materials/programs/Basic_Vertex_Shader_noDirectional.source	2007-09-17 22:58:26 UTC (rev 3856)
+++ modules/common/materials/programs/Basic_Vertex_Shader_noDirectional.source	2007-09-18 16:32:57 UTC (rev 3857)
@@ -25,6 +25,7 @@
    float2 Texcoord1 : TEXCOORD1;
    float2 Texcoord2: TEXCOORD2;
    float3 Normal   : NORMAL;
+   float4 vColor : COLOR0;
    
 };
 
@@ -41,7 +42,8 @@
 VS_OUTPUT vs_main( VS_INPUT Input )
 {
    VS_OUTPUT Output;
-   Output.Color = lerp(skycolor,groundcolor,(dot(Input.Normal, float3(0,-1,0))+1)/2 );
+   Output.Color = saturate(Input.vColor+0.1);
+   Output.Color += lerp(skycolor,groundcolor,(dot(Input.Normal, float3(0,-1,0))+1)/2 );
    Output.Position = mul( matViewProjection, Input.Position );
    
    
@@ -64,7 +66,7 @@
                               Light1_attenuation.w * Dist * Dist)
                           ,0,1);
    
-   Output.Color += (Light1_color * AngleAttn + SpecAttn) * DistAttn * Light1_position.w;
+   //Output.Color += (Light1_color * AngleAttn + SpecAttn) * DistAttn * Light1_position.w;
    
    
    // Light3
@@ -85,7 +87,7 @@
                               Light3_attenuation.w * Dist * Dist)
                           ,0,1);
    
-   Output.Color += (Light3_color * AngleAttn + SpecAttn) * DistAttn * Light3_position.w;
+   //Output.Color += (Light3_color * AngleAttn + SpecAttn) * DistAttn * Light3_position.w;
    
    
    // Light2
@@ -105,8 +107,9 @@
                         Light2_attenuation.w * Dist * Dist)
                         ,0,1);
    
-   Output.Color += (Light2_color * AngleAttn + SpecAttn) * DistAttn * Light2_position.w;
+   //Output.Color += (Light2_color * AngleAttn + SpecAttn) * DistAttn * Light2_position.w;
    
+   
    Output.Texcoord = Input.Texcoord;
    Output.Texcoord1 = Input.Texcoord1;
    Output.Texcoord2 = Input.Texcoord2;

Modified: modules/common/materials/programs/Normalmapping/Basic_Normalmapping.material
===================================================================
--- modules/common/materials/programs/Normalmapping/Basic_Normalmapping.material	2007-09-17 22:58:26 UTC (rev 3856)
+++ modules/common/materials/programs/Normalmapping/Basic_Normalmapping.material	2007-09-18 16:32:57 UTC (rev 3857)
@@ -264,7 +264,7 @@
                 param_named_auto LightColor_2  light_diffuse_colour  2
                 
                 param_named groundcolor float4 0.1 0.1 0.1 1.0
-                param_named skycolor float4 0.5 0.5 0.5 1.0
+                param_named skycolor float4 0.3 0.3 0.3 1.0
                 param_named SpecColor float4 0.2 0.2 0.2 1.0
                 param_named SpecExp float 16.0
             }
@@ -319,7 +319,7 @@
 				param_named_auto vViewPosition camera_position_object_space
 				
 				
-				param_named skycolor float4 0.5 0.5 0.5 1.0
+				param_named skycolor float4 0.3 0.3 0.3 1.0
 				param_named groundcolor float4 0.10 0.10 0.10 1.0
 			}
 			

Modified: modules/ruchin/maps/ruchin_lightzones.rlmap.xml
===================================================================
--- modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-17 22:58:26 UTC (rev 3856)
+++ modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-18 16:32:57 UTC (rev 3857)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <rastullahmap formatVersion="0.4.0">
 	<nodes>
-		<entity name="Ruchin_Hessi_innen" meshfile="Ruchin_Hessi_innen.mesh" visible="true" receivesShadow="true">
+		<entity name="Ruchin_Hesi_innen" meshfile="Ruchin_Hesi_innen.mesh" visible="true" receivesShadow="true">
 			<position x="130.0" y="0.0" z="-50.0" />
 			<rotation qx="0.0" qy="0.0" qz="0.0" qw="1.0" />
 			<scale x="1.0" y="1.0" z="1.0" />
@@ -227,7 +227,7 @@
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
 			<lightAttenuation range="10" constant="1.0" linear="0.1"
-				quadratic="0.2" />
+				quadratic="0.1" />
 		</light>
 		<light name="Ruchin_l_Light2" type="point" visible="false"
 			castShadows="false">
@@ -278,6 +278,40 @@
 				quadratic="0.4" />
 		</light>
 		
+		<light name="Ruchin_l_Light8" type="point" visible="false"
+			castShadows="false">
+			<position x="70.347" y="2.148" z="-58.631" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.2" />
+		</light>
+		
+		<light name="Ruchin_Hesi_Light1" type="point" visible="false"
+			castShadows="false">
+			<position x="125.827" y="2.104" z="-45.192" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.2" />
+		</light>
+		<light name="Ruchin_Hesi_Light2" type="point" visible="false"
+			castShadows="false">
+			<position x="132.648" y="2.015" z="-47.21" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.2" />
+		</light>
+		<light name="Ruchin_Hesi_Light3" type="point" visible="false"
+			castShadows="false">
+			<position x="132.154" y="2.18" z="-53.317" />
+			<colourDiffuse r="0.8" g="0.8" b="0.5" />
+			<colourSpecular r="0.8" g="0.8" b="0.5" />
+			<lightAttenuation range="10" constant="1.0" linear="0.2"
+				quadratic="0.2" />
+		</light>
+		
 		<light name="sun" type="directional" visible="true" castShadows="true">
 			<colourDiffuse r="0.8" g="0.8" b="0.8" />
 			<colourDiffuse r="0.8" g="0.8" b="0.8" />
@@ -304,6 +338,7 @@
 				<position x="73.014" y="0" z="-57.7"/>
 			</area>
 			<light name="Ruchin_l_Light1"/>
+			<light name="Ruchin_l_Light8"/>
 		</zone>
 		
 		<zone name="Ruchin_l_unten">
@@ -330,5 +365,13 @@
 			<light name="Ruchin_l_Light6"/>
 			<light name="Ruchin_l_Light7"/>
 		</zone>
+		<zone name="Ruchin_Hesi">
+			<area type="mesh" meshfile="Ruchin_Hesi_lightzone.mesh">
+				<position x="130.0" y="0" z="-50.0"/>
+			</area>
+			<light name="Ruchin_Hesi_Light1"/>
+			<light name="Ruchin_Hesi_Light2"/>
+			<light name="Ruchin_Hesi_Light3"/>
+		</zone>
 	</zones>
 </rastullahmap>

Added: modules/ruchin/models/Ruchin_Hesi_innen.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_Hesi_innen.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/ruchin/models/Ruchin_Hesi_lightzone.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_Hesi_lightzone.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: modules/ruchin/models/Ruchin_Hessi_innen.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_inside.material
===================================================================
--- modules/ruchin/models/Ruchin_inside.material	2007-09-17 22:58:26 UTC (rev 3856)
+++ modules/ruchin/models/Ruchin_inside.material	2007-09-18 16:32:57 UTC (rev 3857)
@@ -1,12 +1,12 @@
 
-material Ruchin_inside/base : Basic_Vertex_Shader_noDirectional
+material Ruchin_inside_base : Basic_Vertex_Shader_noDirectional
 {
 set_texture_alias diffuse ruchin_atlasmap.png
 
 }
 
 
-material Ruchin_inside/windows : Basic_Vertex_Shader_Alpha
+material Ruchin_inside_windows : Basic_Vertex_Shader_Alpha
 {
 set_texture_alias diffuse ruchin_atlasmap.dds
 

Modified: modules/ruchin/models/Ruchin_l_innen.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_l_innen_lightzone_laden.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_l_innen_lightzone_mitte.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_l_innen_lightzone_oben.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_l_innen_lightzone_unten.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/temple_lightzone.mesh
===================================================================
(Binary files differ)

Modified: modules/techdemo2/materials/nat_TD2Fluss.material
===================================================================
--- modules/techdemo2/materials/nat_TD2Fluss.material	2007-09-17 22:58:26 UTC (rev 3856)
+++ modules/techdemo2/materials/nat_TD2Fluss.material	2007-09-18 16:32:57 UTC (rev 3857)
@@ -1,39 +1,5 @@
-material nat_TD2Fluss : nat_wasser_see
+material nat_TD2Fluss : Wassershader
 {
-    technique hlsl
-    {
-        pass
-        {
-            texture_unit wellen_map
-            {
-                texture nat_wellen.dds
-            }
-
-            texture_unit evn_map
-            {
-                cubic_texture desert07.dds separateUV
-                tex_address_mode clamp
-            }
-
-        }
-
-    }
-
-    technique glsl
-    {
-        pass
-        {
-            texture_unit wellen_map
-            {
-                texture nat_wellen.dds
-            }
-
-            texture_unit evn_map
-            {
-                cubic_texture desert07.dds separateUV
-                tex_address_mode clamp
-            }
-        }
-    }
+set_texture_alias Cubemap desert07.dds
 }
 

Modified: modules/techdemo2/models/nat_TD2Fluss.mesh
===================================================================
(Binary files differ)



From no22 at mail.berlios.de  Wed Sep 19 23:18:52 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Wed, 19 Sep 2007 23:18:52 +0200
Subject: [Dsa-hl-svn] r3858 - rl/trunk/engine/ai/src
Message-ID: <200709192118.l8JLIqhi019945@sheep.berlios.de>

Author: no22
Date: 2007-09-19 23:18:50 +0200 (Wed, 19 Sep 2007)
New Revision: 3858

Modified:
   rl/trunk/engine/ai/src/AimlNodeImplRl.cpp
Log:
fixed crashing of dialogues (added initializeXml and shutdownXml)

Modified: rl/trunk/engine/ai/src/AimlNodeImplRl.cpp
===================================================================
--- rl/trunk/engine/ai/src/AimlNodeImplRl.cpp	2007-09-18 16:32:57 UTC (rev 3857)
+++ rl/trunk/engine/ai/src/AimlNodeImplRl.cpp	2007-09-19 21:18:50 UTC (rev 3858)
@@ -27,6 +27,7 @@
 
 AimlNodeImplRl::AimlNodeImplRl(DOMNode* pNode)
 {
+    initializeXml();
 	mNodeName  = transcodeToString(pNode->getLocalName());
 	// #text or #comment have no local name, use NodeName for them
 	if(mNodeName.empty())
@@ -98,6 +99,7 @@
 
 AimlNodeImplRl::~AimlNodeImplRl(void)
 {
+    shutdownXml();
 }
 
 }



From no22 at mail.berlios.de  Thu Sep 20 10:13:06 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Thu, 20 Sep 2007 10:13:06 +0200
Subject: [Dsa-hl-svn] r3859 - modules/regressiontest/scripts
Message-ID: <200709200813.l8K8D61E014315@sheep.berlios.de>

Author: no22
Date: 2007-09-20 10:13:04 +0200 (Thu, 20 Sep 2007)
New Revision: 3859

Modified:
   modules/regressiontest/scripts/effecttest.rb
Log:
reduced paralyizing durateion to a KR (ingame time now seems to be equal to real time)

Modified: modules/regressiontest/scripts/effecttest.rb
===================================================================
--- modules/regressiontest/scripts/effecttest.rb	2007-09-19 21:18:50 UTC (rev 3858)
+++ modules/regressiontest/scripts/effecttest.rb	2007-09-20 08:13:04 UTC (rev 3859)
@@ -18,7 +18,7 @@
   
   def doAction(go, user, target)
      p "Du wirst versteinert.";
-     $hero.addEffectWithCheckTime($paralueseffect, 1 * Date::ONE_SPIELRUNDE);
+     $hero.addEffectWithCheckTime($paralueseffect, 1 * Date::ONE_KAMPFRUNDE);
      p "Du solltest dich jetzt eine Weile nicht mehr bewegen k?nnen.";
   end
 end



From no22 at mail.berlios.de  Thu Sep 20 22:19:10 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Thu, 20 Sep 2007 22:19:10 +0200
Subject: [Dsa-hl-svn] r3860 - in modules/ruchin: dialogs dsa scripts/maps
Message-ID: <200709202019.l8KKJAvE007018@sheep.berlios.de>

Author: no22
Date: 2007-09-20 22:19:05 +0200 (Thu, 20 Sep 2007)
New Revision: 3860

Added:
   modules/ruchin/dialogs/hesindiane.aiml
   modules/ruchin/dialogs/nscs.xml
   modules/ruchin/dsa/gameobjectdefinitions.gof
   modules/ruchin/scripts/maps/ruchin.rb
Log:
* saving WIP: some first steps in the td3 story (if you want to see it, you have to edit the moduleconfig)

Added: modules/ruchin/dialogs/hesindiane.aiml
===================================================================
--- modules/ruchin/dialogs/hesindiane.aiml	2007-09-20 08:13:04 UTC (rev 3859)
+++ modules/ruchin/dialogs/hesindiane.aiml	2007-09-20 20:19:05 UTC (rev 3860)
@@ -0,0 +1,100 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<!-- !DOCTYPE aiml SYSTEM "includes.dtd" -->
+
+<aiml  version="1.0.1"
+            xmlns="http://alicebot.org/2001/AIML"
+			xmlns:rldialog="http://team-pantheon.de/projekt/rl/dialog">
+
+
+	<category>
+		<pattern>1</pattern>
+		<template>
+			<gossip rldialog:type="response">
+				<li>Alrike? Was machst du denn hier?!</li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef="2">Ich hab dich auch lieb, Schwesterherz.</li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef="3">Praios zum Gru?e!</li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef="4">Hm? Sollte ich dich kennen?</li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef ="EXIT">Dann geh ich halt wieder.</li>
+			</gossip>
+		</template>
+	</category>
+	<category>
+		<pattern>2</pattern>
+		<template>
+			<gossip rldialog:type="response">
+				<li>Hm? Ach so. Ich war einfach nur ?berrascht, Ari. Aber, bei Nandus, was *tust* du hier?</li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef="5">Hauptmann Albenhuser hat mich ausgeschickt, um in den umliegenden D?rfern von Wandleth mal nach dem rechten zu sehen. Ehrlich gesagt, glaube ich, dass er mich nur f?r eine Weile los werden wollte. Aber war trotzdem gut so, war ne Menge los. Naja, jedenfalls hat er mir auch ein paar Tage frei gegeben, un da dachte ich mir, ich schau mal bei meiner geliebten Schwester vorbei. Wie geht es dir denn so?</li>
+			</gossip>
+		</template>
+	</category>
+
+	<category>
+		<pattern>3</pattern>
+		<template>
+			<gossip rldialog:type="response">
+				<li>Hm? Jaja, Nandus zum Gru?e und so. Nicht, dass ich mich nicht freuen w?rde, aber was *tust* du hier? </li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef="5">Hauptmann Albenhuser hat mich ausgeschickt, um in den umliegenden D?rfern von Wandleth mal nach dem rechten zu sehen. Ehrlich gesagt glaube ich, dass er mich nur f?r eine Weile los werden wollte. Aber war trotzdem gut so, war ne Menge los. Naja, jedenfalls hat er mir auch ein paar Tage frei gegeben, un da dachte ich mir, ich schau mal bei meiner geliebten Schwester vorbei. Wie geht es dir denn so?</li>
+			</gossip>
+		</template>
+	</category>
+
+	<category>
+		<pattern>4</pattern>
+		<template>
+			<gossip rldialog:type="response">
+				<li>Lass die Sp??e, Ari. Ich bins Hesi, deins Schwester. So lange ist es nun auch wieder nicht her.</li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef="5">Schon gut, schon gut. Wie geht es dir?</li>
+			</gossip>
+		</template>
+	</category>
+
+	<category>
+		<pattern>5</pattern>
+		<template>
+			<gossip rldialog:type="response">
+				<li>Schlecht. Ich meine, k?rperlich gut, Peraine bewahre. Aber irgendso ein Dieb hat mir wertvolle Unterlagen gestohlen, und die faulen Hunde von der Stadtwache r?hren keinen Finger! ?h, nichts gegen dich.</li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef="6">Schon gut. Erz?hl mir mehr ?ber diesen Diebstahl, ich hab gerade eh nix zu tun.</li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef="EXIT">Erspar mir deine Problemchen. Ich hab jetzt schon keine Lust mehr, au?erdem schreibt Steele eh viel bessere Dialoge. Ich bin raus hier.</li>
+			</gossip>
+		</template>
+	</category>
+
+	<category>
+		<pattern>6</pattern>
+		<template>
+			<gossip rldialog:type="response">
+				<li>Es geht um ein paar alte Akten. Sie sind eher von Sammlerwert, als von tats?chlicher Relevanz. Du musst wissen, das der feine Herr von Ruchin andere Interessen als ein ordentliches Stadtarchiv hat, und der Magistrat k?mmert sich eher um gut gef?llte Geldbeutel. So geraten verschiedene Dokumente schon mal in Umlauf. Ich hab sie eher zuf?llig und recht g?nstig erstanden. Hatte gehofft sie mit etwas Gewinn an einen Interessenten zu verkaufen. Hat sich wohl erledigt. Aber wenn du dem wirklich nachgehen willst, 3-Zehen-Ungolf hat sich mal die Dokumente zeigen lassen. Dabei kann der nicht mal gescheit lesen! Ich pers?nlich hab ihn ja im Verdacht, was ich auch der hiesigen Stadtwache gesagt habe.</li>
+			</gossip>
+			<gossip rldialog:type="option">
+				<li rldialog:patternRef="EXIT">Ich schau es mir gleich mal an. Bis sp?ter!</li>
+			</gossip>
+		</template>
+	</category>
+
+<!-- ================Standardoptionen ================ -->
+	<category>
+	<pattern>EXIT</pattern> 
+		<template>
+			<system cmd="exit"/>
+		</template>
+	</category>	
+
+</aiml>

Added: modules/ruchin/dialogs/nscs.xml
===================================================================
--- modules/ruchin/dialogs/nscs.xml	2007-09-20 08:13:04 UTC (rev 3859)
+++ modules/ruchin/dialogs/nscs.xml	2007-09-20 20:19:05 UTC (rev 3860)
@@ -0,0 +1,9 @@
+<?xml version="1.0" encoding="utf-8"?>
+
+<aiml-startup version='1.0'>
+	<bot name='Hesindiane' voice=''>
+		<learn src='hesindiane.aiml'/>
+		<!-- script src='dialog.rb' class='DialogCharTest'/ -->
+	</bot>
+
+</aiml-startup>

Added: modules/ruchin/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/ruchin/dsa/gameobjectdefinitions.gof	2007-09-20 08:13:04 UTC (rev 3859)
+++ modules/ruchin/dsa/gameobjectdefinitions.gof	2007-09-20 20:19:05 UTC (rev 3860)
@@ -0,0 +1,42 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<GameObjectDefinitions>
+
+
+	<gameobjectclass classid="Hesindiane" baseclass="NPC">
+		<property name="name" type="STRING" data="Hesindiane"/>
+		<property name="description" type="STRING" data="Deine ?ltere Schwester. Sie hat sich lieber aufs lernen konzentriert, w?hrend du in den Strassen herumgetollt bist. Daf?r bist du Humorvoller."/>
+		<property name="geometrytype" type="STRING" data="ellipsoid"/>
+		<property name="meshfile" type="STRING" data="men_alrike.mesh"/>
+		<property name="mass" type="REAL" data="65"/>
+		<property name="dialogfile" type="STRING" data="testperson.xml"/>
+		<property name="behaviours" type="ARRAY">
+			<property type="STRING" data="DefaultIdleBehaviour"/>
+			<property type="STRING" data="DialogBehaviour"/>
+		</property>
+		<property name="eigenschaften" type="MAP">
+			<property name="MU" type="INT" data="12"/>
+			<property name="KL" type="INT" data="14"/>
+			<property name="IN" type="INT" data="11"/>
+			<property name="CH" type="INT" data="8"/>
+			<property name="FF" type="INT" data="13"/>
+			<property name="GE" type="INT" data="11"/>
+			<property name="KO" type="INT" data="11"/>
+			<property name="KK" type="INT" data="10"/>
+		</property>
+		<property name="werte" type="MAP">
+			<property name="ModLE" type="INT" data="10"/>
+			<property name="ModAU" type="INT" data="10"/>
+			<property name="GS" type="INT" data="7" />
+			<property name="SO" type="INT" data="6" />
+		</property>
+		<property name="current_le" type="INT" data="20"/>
+		<property name="current_au" type="INT" data="20"/>
+		<!-- todo auf das echte maximum setzen -->
+		<property name="talente" type="MAP">
+			<property name="Selbstbeherrschung" type="INT" data="8"/>
+			<property name="Lehren" type="INT" data="5"/>
+		</property>
+	</gameobjectclass>
+
+
+</GameObjectDefinitions>

Added: modules/ruchin/scripts/maps/ruchin.rb
===================================================================
--- modules/ruchin/scripts/maps/ruchin.rb	2007-09-20 08:13:04 UTC (rev 3859)
+++ modules/ruchin/scripts/maps/ruchin.rb	2007-09-20 20:19:05 UTC (rev 3860)
@@ -0,0 +1,31 @@
+load "embed.rb"
+$World = $CORE.getWorld()
+require 'player.rb'
+require 'mckhero.rb'
+require 'npc.rb'
+
+
+$SCRIPT.log("Initialize world");
+loader = MapLoader.new("ruchin");
+loader.loadMap("ruchin_lightzones.rlmap.xml");
+$PM.setEnabled(true);
+$CORE.getWorld().setSkyBox(true, "rl/dsa07", 100.0);
+$World.setFog( World::FOG_EXP, [0.658,0.7568,0.9137,1.0], 0.00049, 0.8, 4.0);
+
+$SCRIPT.log("Initialize hero");
+$hero = $GOM.createGameObject("mckhero", 1);
+$hero.placeIntoScene();
+$hero.setPosition([ -35.3738746643066, -5.64282417297363, -64.6520767211914]);
+$hero.setOrientation([ [ -4.43614335381426e-005, -0.999999940395355, -3.53998184436932e-005 ] , 67.3891525268555]);
+PlayerSettings.preparePlayer($hero);
+$UI.setActiveCharacter($hero)
+
+$SCRIPT.log("Initialize NPCs");
+$SCRIPT.log("Hesindiane...");
+Hesindiane = $GOM.createGameObject("Hesindiane", 2);
+Hesindiane.placeIntoScene();
+Hesindiane.setPosition([ 123.848808288574, 0.264747649431229, -46.4587249755859]);
+Hesindiane.setOrientation([ [ -1.40737538458779e-005, 1.0, -0.000235967105254531 ] , 230.07991027832]);
+HesindianeBot = $AI.loadBot("Hesindiane", "nscs.xml");
+HesindianeBot.setNonPlayerCharacter(Hesindiane);
+#Hesindiane.addAction(TalkAction.new("Hesindiane", "nscs.xml");



From no22 at mail.berlios.de  Thu Sep 20 22:20:49 2007
From: no22 at mail.berlios.de (no22 at mail.berlios.de)
Date: Thu, 20 Sep 2007 22:20:49 +0200
Subject: [Dsa-hl-svn] r3861 - rl/trunk/engine/rules/src
Message-ID: <200709202020.l8KKKnp3007140@sheep.berlios.de>

Author: no22
Date: 2007-09-20 22:20:46 +0200 (Thu, 20 Sep 2007)
New Revision: 3861

Modified:
   rl/trunk/engine/rules/src/Creature.cpp
Log:
Wiki says we shouldn't throw exceptions if possible

Modified: rl/trunk/engine/rules/src/Creature.cpp
===================================================================
--- rl/trunk/engine/rules/src/Creature.cpp	2007-09-20 20:19:05 UTC (rev 3860)
+++ rl/trunk/engine/rules/src/Creature.cpp	2007-09-20 20:20:46 UTC (rev 3861)
@@ -205,7 +205,8 @@
 		WertMap::const_iterator it = mWerte.find(wertId);
         if (it == mWerte.end())
         {
-            Throw(IllegalArgumentException, "Wert nicht gefunden.");
+            LOG_ERROR(Logger::RULES, (string(mName.c_str()) + ": Wert " + wertId.c_str() + " nicht gefunden.").c_str());
+            return 0;
         }
         int rval = it->second;
         if (!getUnmodified)



From timm at mail.berlios.de  Sat Sep 22 14:39:05 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sat, 22 Sep 2007 14:39:05 +0200
Subject: [Dsa-hl-svn] r3862 - in rl/trunk/engine/rules: include src
Message-ID: <200709221239.l8MCd5Hu026936@sheep.berlios.de>

Author: timm
Date: 2007-09-22 14:38:33 +0200 (Sat, 22 Sep 2007)
New Revision: 3862

Modified:
   rl/trunk/engine/rules/include/SaveGameFile.h
   rl/trunk/engine/rules/include/SaveGameManager.h
   rl/trunk/engine/rules/src/RulesSubsystem.cpp
   rl/trunk/engine/rules/src/SaveGameFile.cpp
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
   rl/trunk/engine/rules/src/SaveGameManager.cpp
Log:
- got rid of the save game index
- every header of the save games is parsed on startup
- added a save game resource group

Modified: rl/trunk/engine/rules/include/SaveGameFile.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-20 20:20:46 UTC (rev 3861)
+++ rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-22 12:38:33 UTC (rev 3862)
@@ -38,8 +38,10 @@
         CeGuiString getName();
         bool saveGameExists();
 
-        Ogre::DataStreamPtr getDataStream();
+        void setDataStream(const Ogre::DataStreamPtr &stream);
+        Ogre::DataStreamPtr getDataStream() const;
         XERCES_CPP_NAMESPACE::XMLFormatTarget* getFormatTarget();
+        void deleteFileFromStorage();
 
         virtual const Property getProperty(const Ogre::String& key) const;
         virtual void setProperty(const Ogre::String& key, const Property& value);
@@ -48,6 +50,8 @@
         CeGuiString mName;
         CeGuiString mModuleID;
         CeGuiString mLocalTime;
+
+        Ogre::DataStreamPtr mStream;
     };
 }
 

Modified: rl/trunk/engine/rules/include/SaveGameManager.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-20 20:20:46 UTC (rev 3861)
+++ rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-22 12:38:33 UTC (rev 3862)
@@ -27,7 +27,7 @@
 {
     typedef std::map<CeGuiString, SaveGameFile*> SaveGameEntryMap;
 
-    class SaveGameIndexWriter : public XmlPropertyWriter
+    /*class SaveGameIndexWriter : public XmlPropertyWriter
     {
     public: 
         SaveGameIndexWriter();
@@ -38,21 +38,34 @@
     {
     public:
         SaveGameIndexReader();
-        SaveGameEntryMap parseIndexFile() const;
+        SaveGameEntryMap parseIndexFile(Ogre::DataStreamPtr &stream, const Ogre::String &groupName);
+    };*/
+
+    class SaveGameHeaderReader : public XmlPropertyReader
+    {
+    public:
+        SaveGameHeaderReader();
+        void parseHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file);
     };
 
-    class _RlRulesExport SaveGameManager : public Ogre::Singleton<SaveGameManager>
+    class _RlRulesExport SaveGameManager : public Ogre::Singleton<SaveGameManager>, public Ogre::ScriptLoader
     {
     public:
-        SaveGameManager();
-        virtual ~SaveGameManager();    
+        SaveGameManager(void);
+        virtual ~SaveGameManager(void);    
 
-        SaveGameEntryMap listSaveGames();
+        SaveGameEntryMap listSaveGames(void);
         void saveSaveGameFile(const CeGuiString &name);
         void loadSaveGameFile(const CeGuiString &name);
+        void deleteSaveGameFile(const CeGuiString &name);
+        bool SaveGameFileExists(const CeGuiString &name);
+
+        virtual const Ogre::StringVector&  getScriptPatterns(void) const;
+        virtual void parseScript(Ogre::DataStreamPtr &stream, const Ogre::String &groupName);
+        virtual Ogre::Real getLoadingOrder(void) const;
     protected:
-        SaveGameIndexReader* mReader;
-        SaveGameIndexWriter* mWriter;
+        Ogre::StringVector mScriptPatterns;
+        SaveGameEntryMap mSaveGames;
     };
 }
 

Modified: rl/trunk/engine/rules/src/RulesSubsystem.cpp
===================================================================
--- rl/trunk/engine/rules/src/RulesSubsystem.cpp	2007-09-20 20:20:46 UTC (rev 3861)
+++ rl/trunk/engine/rules/src/RulesSubsystem.cpp	2007-09-22 12:38:33 UTC (rev 3862)
@@ -28,6 +28,7 @@
 #include "GameObjectManager.h"
 #include "QuestBook.h"
 #include "GameTimeSource.h"
+#include <ConfigurationManager.h>
 
 template <>
 rl::RulesSubsystem* Singleton<rl::RulesSubsystem>::ms_Singleton = 0;

Modified: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-20 20:20:46 UTC (rev 3861)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-22 12:38:33 UTC (rev 3862)
@@ -47,10 +47,15 @@
         return mName;
     }
 
-    Ogre::DataStreamPtr SaveGameFile::getDataStream()
+    void SaveGameFile::setDataStream(const Ogre::DataStreamPtr &stream)
     {
+        mStream = stream;
+    }
+
+    Ogre::DataStreamPtr SaveGameFile::getDataStream() const
+    {
         ///@todo: decryption
-        return Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r")));
+        return mStream;
     }
 
     XERCES_CPP_NAMESPACE::XMLFormatTarget* SaveGameFile::getFormatTarget()
@@ -59,6 +64,14 @@
         return new XERCES_CPP_NAMESPACE::LocalFileFormatTarget(this->buildFilename().c_str());
     }
 
+    void SaveGameFile::deleteFileFromStorage()
+    {
+        if(remove(buildFilename().c_str()))
+            LOG_ERROR(Logger::RULES, "SaveGameFile is not removed from filesystem. The file doesn't exists!");
+        else 
+            LOG_MESSAGE(Logger::RULES,"SaveGameFile successfully removed from filesystem");
+    }
+
     bool SaveGameFile::saveGameExists()
     {
         return !Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r"))).isNull();

Modified: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-20 20:20:46 UTC (rev 3861)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-22 12:38:33 UTC (rev 3862)
@@ -66,9 +66,16 @@
 
         //Write modul of save game
         DOMElement* header = appendChildElement(mDocument, mDocument->getDocumentElement(), "header");
-        setAttributeValueAsString(header, "ModuleID", CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
+        
+        PropertySet* headerSet = file->getAllProperties();
+        for(PropertySetMap::const_iterator it_header = headerSet->begin(); it_header != headerSet->end(); it_header++)
+        {
+            this->processProperty(header, PropertyEntry(it_header->first.c_str(), it_header->second));
+        }
+
+        /*setAttributeValueAsString(header, "ModuleID", CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
         setAttributeValueAsInteger(header, "EngineVersion", CoreSubsystem::getSingleton().getEngineBuildNumber());
-        setAttributeValueAsString(header, "LocalTime", file->getProperty("Time").toString());
+        setAttributeValueAsString(header, "LocalTime", file->getProperty("Time").toString());*/
 
         //Write date and time
         //DOMElement* timeNode = appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
@@ -93,8 +100,7 @@
         DOMElement* quests = appendChildElement(mDocument, mDocument->getDocumentElement(), "quests");
         QuestBook* questBook = RulesSubsystem::getSingleton().getQuestBook();
         PropertySet* set = questBook->getAllProperties();
-        PropertySetMap::const_iterator it_quests;
-        for(it_quests = set->begin(); it_quests != set->end(); it_quests++)
+        for(PropertySetMap::const_iterator it_quests = set->begin(); it_quests != set->end(); it_quests++)
         {
             this->processProperty(quests, PropertyEntry(it_quests->first.c_str(), it_quests->second));
         }
@@ -102,11 +108,10 @@
         //Write game objects
         DOMElement* gameobjects = appendChildElement(mDocument, mDocument->getDocumentElement(), "gameobjects");
         
-        std::list<const GameObject*>::const_iterator it_gameobjects;
-        std::list<const GameObject*> gos;
-        gos = GameObjectManager::getSingleton().getAllGameObjects();
 
-        for(it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
+        std::list<const GameObject*> gos = GameObjectManager::getSingleton().getAllGameObjects();
+
+        for(std::list<const GameObject*>::const_iterator it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
         {
             DOMElement* gameobject = appendChildElement(mDocument, gameobjects, "gameobject");
             setAttributeValueAsInteger(gameobject, "ID", (*it_gameobjects)->getId());

Modified: rl/trunk/engine/rules/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-20 20:20:46 UTC (rev 3861)
+++ rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-22 12:38:33 UTC (rev 3862)
@@ -22,6 +22,9 @@
 #include <ContentModule.h>
 #include <ConfigurationManager.h>
 
+#include <XmlProcessor.h>
+
+#include <xercesc/dom/DOM.hpp>
 #include <xercesc/framework/LocalFileFormatTarget.hpp>
 
 template<> rl::SaveGameManager* Ogre::Singleton<rl::SaveGameManager>::ms_Singleton = 0;
@@ -41,87 +44,181 @@
         return string;
     }
 
-    SaveGameIndexWriter::SaveGameIndexWriter()
-    {
-    }
+    //SaveGameIndexWriter::SaveGameIndexWriter()
+    //{
+    //}
 
-    void SaveGameIndexWriter::buildIndexFile(const SaveGameEntryMap &map)
-    {
-        initializeXml();
+    //void SaveGameIndexWriter::buildIndexFile(const SaveGameEntryMap &map)
+    //{
+    //    initializeXml();
 
-        XMLCh tempStr[256];
-        XMLString::transcode("LS", tempStr, 255);
-        mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
-        mWriter = static_cast<DOMImplementationLS*>(mImplementation)->createDOMWriter();
-        XMLString::transcode(((Ogre::String)(ConfigurationManager::getSingleton().getModulesRootDirectory() + "/saves/index.saves")).c_str(), tempStr, 255);
-        mTarget = new LocalFileFormatTarget(tempStr);
-        mDocument = static_cast<DOMImplementation*>(mImplementation)->createDocument(0, XMLString::transcode("SaveGameIndexFile"), 0);
-        
-        if (mWriter->canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
-            mWriter->setFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true);
+    //    XMLCh tempStr[256];
+    //    XMLString::transcode("LS", tempStr, 255);
+    //    mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
+    //    mWriter = static_cast<DOMImplementationLS*>(mImplementation)->createDOMWriter();
+    //    XMLString::transcode(((Ogre::String)(ConfigurationManager::getSingleton().getModulesRootDirectory() + "/saves/index.saves")).c_str(), tempStr, 255);
+    //    mTarget = new LocalFileFormatTarget(tempStr);
+    //    mDocument = static_cast<DOMImplementation*>(mImplementation)->createDocument(0, XMLString::transcode("SaveGameIndexFile"), 0);
+    //    
+    //    if (mWriter->canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
+    //        mWriter->setFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true);
 
-        if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
-             mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
+    //    if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
+    //         mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
 
-        mDocument->setNodeValue(XMLString::transcode("SaveGameIndexFile")); //Set name of document root node
+    //    mWriter->setEncoding(XMLUni::fgISO88591EncodingString);
 
-         //Write SaveGameIndexVersion
-        setAttributeValueAsString(mDocument->getDocumentElement(), "Version", "0.1");
+    //    mDocument->setNodeValue(XMLString::transcode("SaveGameIndexFile")); //Set name of document root node
 
+    //     //Write SaveGameIndexVersion
+    //    setAttributeValueAsString(mDocument->getDocumentElement(), "Version", "0.1");
 
-        //write save games
-        SaveGameEntryMap::const_iterator it_saves;
 
-        for(it_saves = map.begin(); it_saves != map.end(); it_saves++)
-        {
-            DOMElement* saveGame = appendChildElement(mDocument, mDocument->getDocumentElement(), "savegame");
-            setAttributeValueAsString(saveGame, "Name", it_saves->second->getName());
+    //    //write save games
+    //    SaveGameEntryMap::const_iterator it_saves;
 
-            PropertyMap map = it_saves->second->getAllProperties()->toPropertyMap();
-            PropertyMap::iterator it_properties;
-            for(it_properties = map.begin(); it_properties != map.end(); it_properties++)
-            {
-                this->processProperty(saveGame, PropertyEntry(it_properties->first.c_str(), it_properties->second));
-            }
-        }        
+    //    for(it_saves = map.begin(); it_saves != map.end(); it_saves++)
+    //    {
+    //        DOMElement* saveGame = appendChildElement(mDocument, mDocument->getDocumentElement(), "savegame");
+    //        setAttributeValueAsString(saveGame, "Name", it_saves->second->getName());
 
+    //        PropertyMap map = it_saves->second->getAllProperties()->toPropertyMap();
+    //        PropertyMap::iterator it_properties;
+    //        for(it_properties = map.begin(); it_properties != map.end(); it_properties++)
+    //        {
+    //            this->processProperty(saveGame, PropertyEntry(it_properties->first.c_str(), it_properties->second));
+    //        }
+    //    }        
 
-        mWriter->writeNode(mTarget, *mDocument);
 
+    //    mWriter->writeNode(mTarget, *mDocument);
 
-        mWriter->release();
 
-        delete mDocument;
-        delete mTarget;
+    //    mWriter->release();
 
-        shutdownXml();
-    }
+    //    delete mDocument;
+    //    delete mTarget;
 
-    SaveGameIndexReader::SaveGameIndexReader()
+    //    shutdownXml();
+    //}
+
+    //SaveGameIndexReader::SaveGameIndexReader()
+    //{
+    //}
+
+    //SaveGameEntryMap SaveGameIndexReader::parseIndexFile(Ogre::DataStreamPtr &stream, const Ogre::String &groupName)
+    //{
+    //    SaveGameEntryMap entries;
+
+    //    initializeXml();
+
+    //    /*Ogre::String fileName = ConfigurationManager::getSingleton().getModulesRootDirectory() + "/saves/index.saves";
+
+    //    FILE* fileHandle = fopen(fileName.c_str(), "r");
+
+    //    if(fileHandle)
+    //    {
+    //        Ogre::DataStreamPtr stream = Ogre::DataStreamPtr(new Ogre::FileHandleDataStream(fileHandle));*/
+
+    //        /*char* temp = new char[1024];
+
+    //        stream->read(temp, 1022);
+
+    //        LOG_MESSAGE(Logger::RULES, temp);
+
+    //        delete[] temp;*/
+
+    //        if(stream->size())
+    //        {
+    //            DOMDocument* doc = loadDocument( stream);
+
+    //            ///@todo: Right version of save game file index?
+
+    //            DOMNodeList* saveGameDefsXml = doc->getDocumentElement()->getElementsByTagName(AutoXMLCh("savegame").data());
+    //            for(unsigned int i = 0; i < saveGameDefsXml->getLength(); i++)
+    //            {
+    //                DOMElement* curNode = static_cast<DOMElement*>(saveGameDefsXml->item(i));
+    //                SaveGameFile * file = new SaveGameFile(this->getAttributeValueAsString(curNode, "Name"));
+    //                
+    //                DOMNodeList* saveGameDefChildren = curNode->getChildNodes();
+    //                for (XMLSize_t childIdx = 0; childIdx < saveGameDefChildren->getLength(); childIdx++)
+    //                {
+    //                    DOMNode* curChild = saveGameDefChildren->item(childIdx);
+    //                    if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
+    //                    {
+    //                        PropertyEntry entry = processProperty(static_cast<DOMElement*>(curChild));
+    //                        if (entry.first != "")
+    //                        {
+    //                            file->setProperty(entry.first, entry.second);
+    //                        }
+    //                    }
+    //                }
+    //                entries[this->getAttributeValueAsString(curNode, "Name").c_str()] = file;
+    //            }
+
+    //            doc->release();
+    //        }
+    //    /*}*/
+
+    //    shutdownXml();
+
+    //    return entries;
+    //}
+
+    SaveGameHeaderReader::SaveGameHeaderReader()
     {
     }
 
-    SaveGameEntryMap SaveGameIndexReader::parseIndexFile() const
+    void SaveGameHeaderReader::parseHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file)
     {
-        SaveGameEntryMap entries;
-        return entries;
+        initializeXml();
+
+        if(stream->size())
+        {
+            DOMDocument* doc = loadDocument(stream);
+
+             DOMNodeList* headerDefsXml = doc->getDocumentElement()->getElementsByTagName(AutoXMLCh("header").data());
+             if(headerDefsXml->getLength())
+             {
+                 DOMElement* elem = static_cast<DOMElement*>(headerDefsXml->item(0));
+                 DOMNodeList* headerDefChildren = elem->getChildNodes();
+                 for(XMLSize_t childIdx = 0; childIdx < headerDefChildren->getLength(); childIdx++)
+                 {
+                     DOMNode* curChild = headerDefChildren->item(childIdx);
+                     if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
+                     {
+                         PropertyEntry entry = processProperty(static_cast<DOMElement*>(curChild));
+                         if(entry.first != "")
+                         {
+                            file->setProperty(entry.first, entry.second);
+                         }
+                     }
+                 }
+             }
+        }
+
+        shutdownXml();
     }
 
     SaveGameManager::SaveGameManager()
-    {
-        mReader = new SaveGameIndexReader();
-        mWriter = new SaveGameIndexWriter();
+    { 
+        Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
+
+        mScriptPatterns.push_back("*.save");
+        Ogre::ResourceGroupManager::getSingleton()._registerScriptLoader(this);
+
+        Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() 
+            + "/saves", "FileSystem", "SaveGames");
+        Ogre::ResourceGroupManager::getSingleton().initialiseResourceGroup("SaveGames");
     }
 
     SaveGameManager::~SaveGameManager()
     {
-        delete mReader;
-        delete mWriter;
     }
 
     SaveGameEntryMap SaveGameManager::listSaveGames()
     {
-        return mReader->parseIndexFile();
+        return mSaveGames;
     }
 
     void SaveGameManager::saveSaveGameFile(const CeGuiString &name)
@@ -130,21 +227,63 @@
         tm* localTime; 
         time(&rawTime);
         localTime = localtime(&rawTime); 
-        SaveGameFile file(name);
-        file.setProperty("Time", Property(printTimeAsString(localTime)));
-        file.setProperty("ModuleID", Property(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName()));
+        SaveGameFile* file = new SaveGameFile(name);
+        file->setProperty("Time", Property(printTimeAsString(localTime)));
+        file->setProperty("ModuleID", Property(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName()));
 
-        SaveGameEntryMap map = listSaveGames();
-        map[name] = &file;
+        mSaveGames[name] = file;
 
-        mWriter->buildIndexFile(map);
-
         SaveGameFileWriter writer;
-        writer.buildSaveGameFile(&file);
+        writer.buildSaveGameFile(file);
     }
 
     void SaveGameManager::loadSaveGameFile(const CeGuiString &name)
     {
-        ///@todo: SaveGameReader
+        if(SaveGameFileExists(name))
+        {
+            SaveGameFile file(name);
+            ///@todo: SaveGameReader
+        }
     }
+
+    void SaveGameManager::deleteSaveGameFile(const CeGuiString &name)
+    {
+        if(SaveGameFileExists(name))
+        {
+            static_cast<SaveGameFile*>(mSaveGames[name])->deleteFileFromStorage();
+            delete mSaveGames[name];
+            mSaveGames.erase(name);
+        }
+    }
+
+    bool SaveGameManager::SaveGameFileExists(const CeGuiString &name)
+    {
+        if(mSaveGames.find(name) != mSaveGames.end())
+            return true;
+        return false;
+    }
+    
+    const Ogre::StringVector& SaveGameManager::getScriptPatterns() const
+    {
+        return mScriptPatterns;
+    }
+
+    Ogre::Real SaveGameManager::getLoadingOrder() const
+    {
+        return 2000.0f;
+    }
+
+    void SaveGameManager::parseScript(Ogre::DataStreamPtr &stream, const Ogre::String &groupName)
+    {
+        Ogre::String name = stream->getName();
+        name = name.substr(0, name.length()-5); //delete ".save" at the and of the name
+
+        SaveGameFile* file = new SaveGameFile(name);
+        file->setDataStream(stream);
+        LOG_MESSAGE(Logger::RULES, "Parsing header of save game: " + name);
+        SaveGameHeaderReader reader;
+        reader.parseHeader(stream, groupName, file);
+        
+        mSaveGames[name] = file;
+    }
 }



From pnyx at mail.berlios.de  Sun Sep 23 21:18:36 2007
From: pnyx at mail.berlios.de (pnyx at mail.berlios.de)
Date: Sun, 23 Sep 2007 21:18:36 +0200
Subject: [Dsa-hl-svn] r3863 - in modules: common/materials common/models
	regressiontest/maps ruchin/maps ruchin/models
Message-ID: <200709231918.l8NJIaH2005202@sheep.berlios.de>

Author: pnyx
Date: 2007-09-23 21:18:04 +0200 (Sun, 23 Sep 2007)
New Revision: 3863

Added:
   modules/common/models/ver_truhe_gross01.mesh.skeleton
   modules/ruchin/models/Ruchin_plateau.mesh
Modified:
   modules/common/materials/arc_bett_01.material
   modules/common/materials/arc_nachtkasten_schrank.material
   modules/common/materials/arc_regal_01.material
   modules/common/materials/arc_schreibtisch_01.material
   modules/common/materials/arc_stuhl_01.material
   modules/common/materials/arc_tisch_01.material
   modules/common/materials/arc_tisch_02.material
   modules/common/materials/arg_tisch_01.material
   modules/common/materials/schreibtisch.material
   modules/common/materials/stuhl.material
   modules/common/materials/ver_truhe_gross01.material
   modules/common/models/ver_truhe_gross01.mesh
   modules/regressiontest/maps/regressiontest_lights.rlmap.xml
   modules/ruchin/maps/ruchin.scene
   modules/ruchin/maps/ruchin_lightzones.rlmap.xml
   modules/ruchin/models/Ruchin_Hesi_lightzone.mesh
   modules/ruchin/models/Ruchin_l_innen.mesh
Log:
- updated hesi interior
- added plateau wall test

Modified: modules/common/materials/arc_bett_01.material
===================================================================
--- modules/common/materials/arc_bett_01.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/arc_bett_01.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,21 +1,7 @@
 
-material arc_bett_01
+material arc_bett_01: Basic_Vertex_Shader
 {
-receive_shadows off
-	technique
-	{
-		pass
-		{
-
-			alpha_rejection greater 100
-
-			texture_unit
-			{
-				filtering linear linear linear 
-				texture bauernbett.dds
-			}
-		}
-	}
+set_texture_alias diffuse bauernbett.dds
 }
 
 

Modified: modules/common/materials/arc_nachtkasten_schrank.material
===================================================================
--- modules/common/materials/arc_nachtkasten_schrank.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/arc_nachtkasten_schrank.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,14 +1,5 @@
 
-material nachtkasten
+material nachtkasten: Basic_Vertex_Shader
 {
-	technique
-	{
-		pass
-		{
-			texture_unit
-			{
-				texture ver_moebel_04.dds
-			}
-		}
-	}
+set_texture_alias diffuse ver_moebel_04.dds
 }
\ No newline at end of file

Modified: modules/common/materials/arc_regal_01.material
===================================================================
--- modules/common/materials/arc_regal_01.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/arc_regal_01.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,17 +1,5 @@
 
-material arc_regal_essen
+material arc_regal_essen: Basic_Vertex_Shader
 {
-	technique
-	{
-		pass
-		{
-			alpha_rejection greater 128
-
-			texture_unit
-			{
-				filtering linear linear linear 
-				texture arc_regal_essen.dds
-			}
-		}
-	}
+set_texture_alias diffuse arc_regal_essen.dds
 }
\ No newline at end of file

Modified: modules/common/materials/arc_schreibtisch_01.material
===================================================================
--- modules/common/materials/arc_schreibtisch_01.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/arc_schreibtisch_01.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,16 +1,5 @@
 
-material arc_schreibtisch_01
+material arc_schreibtisch_01: Basic_Vertex_Shader
 {
-	technique
-	{
-		pass
-		{
-			
-
-			texture_unit
-			{
-				texture zeugs_02_schreibtisch01_tischkleinrund.dds
-			}
-		}
-	}
+set_texture_alias diffuse zeugs_02_schreibtisch01_tischkleinrund.dds
 }
\ No newline at end of file

Modified: modules/common/materials/arc_stuhl_01.material
===================================================================
--- modules/common/materials/arc_stuhl_01.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/arc_stuhl_01.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,19 +1,6 @@
 
-material arc_stuhl_01
+material arc_stuhl_01: Basic_Vertex_Shader
 {
-receive_shadows off
-	technique
-	{
-		pass
-		{
+set_texture_alias diffuse ver_moebel_03.dds
 
-			alpha_rejection greater 100
-
-			texture_unit
-			{
-				filtering linear linear linear 
-				texture ver_moebel_03.dds
-			}
-		}
-	}
 }
\ No newline at end of file

Modified: modules/common/materials/arc_tisch_01.material
===================================================================
--- modules/common/materials/arc_tisch_01.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/arc_tisch_01.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,14 +1,4 @@
-material arc_tisch_01
+material arc_tisch_01: Basic_Vertex_Shader
 {
-    technique
-    {
-        pass
-        {
-          
-            texture_unit
-            {
-                texture zeugs_02_schreibtisch01_tischkleinrund.dds 
-            }
-        }
-    }
+set_texture_alias diffuse zeugs_02_schreibtisch01_tischkleinrund.dds 
 }

Modified: modules/common/materials/arc_tisch_02.material
===================================================================
--- modules/common/materials/arc_tisch_02.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/arc_tisch_02.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,16 +1,5 @@
 
-material arc_tisch_02
+material arc_tisch_02: Basic_Vertex_Shader
 {
-	technique
-	{
-		pass
-		{
-			
-
-			texture_unit
-			{
-				texture zeugs_02_schreibtisch01_tischkleinrund.dds
-			}
-		}
-	}
+set_texture_alias diffuse zeugs_02_schreibtisch01_tischkleinrund.dds
 }
\ No newline at end of file

Modified: modules/common/materials/arg_tisch_01.material
===================================================================
--- modules/common/materials/arg_tisch_01.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/arg_tisch_01.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,16 +1,5 @@
 
-material arg_tisch_01
+material arg_tisch_01: Basic_Vertex_Shader
 {
-	technique
-	{
-		pass
-		{
-			
-
-			texture_unit
-			{
-				texture arc_tisch_01.dds
-			}
-		}
-	}
+set_texture_alias diffuse arc_tisch_01.dds
 }
\ No newline at end of file

Modified: modules/common/materials/schreibtisch.material
===================================================================
--- modules/common/materials/schreibtisch.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/schreibtisch.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,17 +1,4 @@
-material schreibtisch
+material schreibtisch: Basic_Vertex_Shader
 {
-    technique
-    {
-        pass
-        {
-            ambient 0.588235 0.588235 0.588235
-            diffuse 0.588235 0.588235 0.588235
-            specular 0.9 0.9 0.9 0.0
-            emissive 0.0 0.0 0.0
-            texture_unit
-            {
-                texture schreibtisch.dds 
-            }
-        }
-    }
+set_texture_alias diffuse schreibtisch.dds 
 }

Modified: modules/common/materials/stuhl.material
===================================================================
--- modules/common/materials/stuhl.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/stuhl.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,17 +1,4 @@
-material stuhl
+material stuhl: Basic_Vertex_Shader
 {
-    technique
-    {
-        pass
-        {
-            ambient 0.588235 0.588235 0.588235
-            diffuse 0.588235 0.588235 0.588235
-            specular 0.9 0.9 0.9 0.0
-            emissive 0.0 0.0 0.0
-            texture_unit
-            {
-                texture stuhl.dds 
-            }
-        }
-    }
+set_texture_alias diffuse stuhl.dds 
 }

Modified: modules/common/materials/ver_truhe_gross01.material
===================================================================
--- modules/common/materials/ver_truhe_gross01.material	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/common/materials/ver_truhe_gross01.material	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,45 +1,4 @@
-material ver_truhe_gross01
+material ver_truhe_gross01: Basic_Vertex_Shader
 {
-    // hardware blending vs_1_1
-    technique
-    {
-        pass
-        {
-            vertex_program_ref HardwareSkinningOneWeight24Bones
-            {
-                param_named_auto worldMatrix3x4Array[0] world_matrix_array_3x4
-                param_named_auto viewProjectionMatrix viewproj_matrix
-                param_named_auto lightPos[0] light_position 0
-                param_named_auto lightPos[1] light_position 1
-                param_named_auto lightDiffuseColour[0] light_diffuse_colour 0
-                param_named_auto lightDiffuseColour[1] light_diffuse_colour 1
-                param_named_auto ambient ambient_light_colour
-            
-            }
-            // alternate shadow caster program
-            shadow_caster_vertex_program_ref HardwareSkinningOneWeight24BonesShadowCaster
-            {
-                param_named_auto worldMatrix3x4Array[0] world_matrix_array_3x4
-                param_named_auto viewProjectionMatrix viewproj_matrix
-                param_named_auto ambient ambient_light_colour
-            
-            }
-
-            texture_unit
-            {
-                texture ver_truhe_gross.dds 
-            }
-        }
-    }
-
-    technique
-    {
-        pass
-        {
-            texture_unit
-            {
-                texture ver_truhe_gross.dds 
-            }
-        }
-    }
+set_texture_alias diffuse ver_truhe_gross.dds 
 }

Modified: modules/common/models/ver_truhe_gross01.mesh
===================================================================
(Binary files differ)

Added: modules/common/models/ver_truhe_gross01.mesh.skeleton
===================================================================
(Binary files differ)


Property changes on: modules/common/models/ver_truhe_gross01.mesh.skeleton
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/regressiontest/maps/regressiontest_lights.rlmap.xml
===================================================================
--- modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-23 19:18:04 UTC (rev 3863)
@@ -21,7 +21,7 @@
 		</light>
 		<light name="blue sun" type="directional" visible="true" castShadows="false">
 			<colourDiffuse r="0.8" g="0.8" b="0.8" />
-			<colourSpecular r="0" g="0" b="1" />
+			<colourSpecular r="0.8" g="0.8" b="0.8" />
 			<direction x="1" y="-1" z="0" />
 		</light>
 	</nodes>

Modified: modules/ruchin/maps/ruchin.scene
===================================================================
--- modules/ruchin/maps/ruchin.scene	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/ruchin/maps/ruchin.scene	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1005,5 +1005,230 @@
   
 
 		</node>
+		<node name="arc_bett_01" id="135" >
+			<position x="134.263" y="0.934719" z="-53.9135" />
+			<rotation qx="0.0" qy="0.0425641" qz="0.0" qw="0.999094" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="arc_bett_01"
+				id="136"
+				meshFile ="arc_bett_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_nachtkasten_01" id="137" >
+			<position x="135.07" y="0.267212" z="-55.1786" />
+			<rotation qx="0.0" qy="0.0572424" qz="0.0" qw="0.99836" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="arc_nachtkasten_01"
+				id="138"
+				meshFile ="arc_nachtkasten_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_schrank_01" id="139" >
+			<position x="130.133" y="0.281674" z="-55.1734" />
+			<rotation qx="0.0" qy="-0.663858" qz="0.0" qw="0.747859" />
+			<scale x="1.18383" y="1.18383" z="1.18383" />
+			<entity
+				name="arc_schrank_01"
+				id="140"
+				meshFile ="arc_schrank_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_kommode_01" id="141" >
+			<position x="129.777" y="0.2579" z="-51.0604" />
+			<rotation qx="0.0" qy="-0.999015" qz="0.0" qw="0.0443831" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="arc_kommode_01"
+				id="142"
+				meshFile ="arc_kommode_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="ver_schmuckkasten_01" id="143" >
+			<position x="134.996" y="0.967981" z="-55.255" />
+			<rotation qx="0.0" qy="-0.536424" qz="0.0" qw="0.843949" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="ver_schmuckkasten_01"
+				id="144"
+				meshFile ="ver_schmuckkasten_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_schreibtisch_01" id="145" >
+			<position x="123.896" y="0.309096" z="-42.7752" />
+			<rotation qx="0.0" qy="0.735499" qz="0.0" qw="0.677526" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="arc_schreibtisch_01"
+				id="146"
+				meshFile ="arc_schreibtisch_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_regal_01" id="147" >
+			<position x="122.468" y="0.280477" z="-44.1331" />
+			<rotation qx="0.0" qy="0.728787" qz="0.0" qw="0.684741" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="arc_regal_01"
+				id="148"
+				meshFile ="arc_regal_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_stuhl_01" id="149" >
+			<position x="123.753" y="0.272011" z="-43.5796" />
+			<rotation qx="0.0" qy="0.315478" qz="0.0" qw="0.948933" />
+			<scale x="1.1" y="1.1" z="1.1" />
+			<entity
+				name="arc_stuhl_01"
+				id="150"
+				meshFile ="arc_stuhl_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_stuhl_01" id="151" >
+			<position x="125.458" y="0.272011" z="-43.0115" />
+			<rotation qx="0.0" qy="-0.99256" qz="0.0" qw="0.121756" />
+			<scale x="1.1" y="1.1" z="1.1" />
+			<entity
+				name="arc_stuhl_01"
+				id="152"
+				meshFile ="arc_stuhl_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_stuhl_01" id="153" >
+			<position x="129.048" y="0.272011" z="-52.2729" />
+			<rotation qx="0.0" qy="0.729892" qz="0.0" qw="0.683563" />
+			<scale x="1.1" y="1.1" z="1.1" />
+			<entity
+				name="arc_stuhl_01"
+				id="154"
+				meshFile ="arc_stuhl_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="ver_truhe_gross01" id="155" >
+			<position x="132.728" y="0.266345" z="-53.7544" />
+			<rotation qx="0.0" qy="-0.67559" qz="0.0" qw="0.737277" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="ver_truhe_gross01"
+				id="156"
+				meshFile ="ver_truhe_gross01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_regal_01" id="157" >
+			<position x="124.772" y="0.280477" z="-47.3561" />
+			<rotation qx="0.0" qy="0.0535975" qz="0.0" qw="0.998563" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="arc_regal_01"
+				id="158"
+				meshFile ="arc_regal_01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="ver_truhe_gross01" id="159" >
+			<position x="126.605" y="0.266345" z="-42.9335" />
+			<rotation qx="0.0" qy="-0.99891" qz="0.0" qw="0.0466802" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="ver_truhe_gross01"
+				id="160"
+				meshFile ="ver_truhe_gross01.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_regal_02" id="161" >
+			<position x="126.407" y="0.292587" z="-47.6606" />
+			<rotation qx="0.0" qy="0.0499097" qz="0.0" qw="0.998754" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="arc_regal_02"
+				id="162"
+				meshFile ="arc_regal_02.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
+		<node name="arc_regal_02" id="163" >
+			<position x="123.181" y="0.292586" z="-47.3374" />
+			<rotation qx="0.0" qy="0.0499097" qz="0.0" qw="0.998754" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<entity
+				name="arc_regal_02"
+				id="164"
+				meshFile ="arc_regal_02.mesh"
+				materialFile="ruchin.material"
+				castsShadow="false"
+			/>
+
+  
+
+		</node>
 	</nodes>
 </scene>
\ No newline at end of file

Modified: modules/ruchin/maps/ruchin_lightzones.rlmap.xml
===================================================================
--- modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-22 12:38:33 UTC (rev 3862)
+++ modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-23 19:18:04 UTC (rev 3863)
@@ -1,6 +1,15 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <rastullahmap formatVersion="0.4.0">
 	<nodes>
+	
+		<entity name="Ruchin_plateau" meshfile="Ruchin_plateau.mesh" visible="true" receivesShadow="true">
+			<position x="100.0" y="0.0" z="-80.0" />
+			<rotation qx="0.0" qy="0.0" qz="0.0" qw="1.0" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<staticgeometrygroup id="0"/>
+			<renderingdistance data="100" /> 
+		</entity>
+		
 		<entity name="Ruchin_Hesi_innen" meshfile="Ruchin_Hesi_innen.mesh" visible="true" receivesShadow="true">
 			<position x="130.0" y="0.0" z="-50.0" />
 			<rotation qx="0.0" qy="0.0" qz="0.0" qw="1.0" />
@@ -209,16 +218,16 @@
 			<position x="123.291" y="3.02" z="-22.166" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="5" constant="1.0" linear="0.1"
-				quadratic="0.1" />
+			<lightAttenuation range="5" constant="1.0" linear="0.001"
+				quadratic="0.2" />
 		</light>
 		<light name="templeLight2" type="point" visible="false"
 			castShadows="false">
 			<position x="123.291" y="3.02" z="-18.952" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="5" constant="1.0" linear="0.1"
-				quadratic="0.1" />
+			<lightAttenuation range="5" constant="1.0" linear="0.001"
+				quadratic="0.2" />
 		</light>		
 		
 		<light name="Ruchin_l_Light1" type="point" visible="false"
@@ -226,56 +235,56 @@
 			<position x="77.001" y="2.353" z="-57.601" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.1"
-				quadratic="0.1" />
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
+				quadratic="0.2" />
 		</light>
 		<light name="Ruchin_l_Light2" type="point" visible="false"
 			castShadows="false">
 			<position x="69.205" y="2.304" z="-41.19" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
-				quadratic="0.4" />
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
+				quadratic="0.2" />
 		</light>
 		<light name="Ruchin_l_Light3" type="point" visible="false"
 			castShadows="false">
 			<position x="67.586" y="2.304" z="-48.682" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
-				quadratic="0.4" />
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
+				quadratic="0.2" />
 		</light>
 		<light name="Ruchin_l_Light4" type="point" visible="false"
 			castShadows="false">
 			<position x="59.405" y="4.778" z="-54.343" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
-				quadratic="0.4" />
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
+				quadratic="0.2" />
 		</light>
 		<light name="Ruchin_l_Light5" type="point" visible="false"
 			castShadows="false">
 			<position x="64.84" y="6.133" z="-53.722" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
-				quadratic="0.4" />
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
+				quadratic="0.2" />
 		</light>
 		<light name="Ruchin_l_Light6" type="point" visible="false"
 			castShadows="false">
 			<position x="59.654" y="6.135" z="-49.188" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
-				quadratic="0.4" />
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
+				quadratic="0.2" />
 		</light>
 		<light name="Ruchin_l_Light7" type="point" visible="false"
 			castShadows="false">
 			<position x="72.564" y="6.133" z="-42.606" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
-				quadratic="0.4" />
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
+				quadratic="0.2" />
 		</light>
 		
 		<light name="Ruchin_l_Light8" type="point" visible="false"
@@ -283,7 +292,7 @@
 			<position x="70.347" y="2.148" z="-58.631" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
 				quadratic="0.2" />
 		</light>
 		
@@ -292,7 +301,7 @@
 			<position x="125.827" y="2.104" z="-45.192" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
 				quadratic="0.2" />
 		</light>
 		<light name="Ruchin_Hesi_Light2" type="point" visible="false"
@@ -300,7 +309,7 @@
 			<position x="132.648" y="2.015" z="-47.21" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
 				quadratic="0.2" />
 		</light>
 		<light name="Ruchin_Hesi_Light3" type="point" visible="false"
@@ -308,7 +317,7 @@
 			<position x="132.154" y="2.18" z="-53.317" />
 			<colourDiffuse r="0.8" g="0.8" b="0.5" />
 			<colourSpecular r="0.8" g="0.8" b="0.5" />
-			<lightAttenuation range="10" constant="1.0" linear="0.2"
+			<lightAttenuation range="10" constant="1.0" linear="0.001"
 				quadratic="0.2" />
 		</light>
 		

Modified: modules/ruchin/models/Ruchin_Hesi_lightzone.mesh
===================================================================
(Binary files differ)

Modified: modules/ruchin/models/Ruchin_l_innen.mesh
===================================================================
(Binary files differ)

Added: modules/ruchin/models/Ruchin_plateau.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_plateau.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From melven at mail.berlios.de  Sun Sep 23 21:36:02 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sun, 23 Sep 2007 21:36:02 +0200
Subject: [Dsa-hl-svn] r3864 - in modules: common/scripts
	common/scripts/triggers regressiontest/maps
Message-ID: <200709231936.l8NJa2il006221@sheep.berlios.de>

Author: melven
Date: 2007-09-23 21:35:37 +0200 (Sun, 23 Sep 2007)
New Revision: 3864

Added:
   modules/common/scripts/triggers/
   modules/common/scripts/triggers/test.rb
Modified:
   modules/common/scripts/initialize_factories.rb
   modules/regressiontest/maps/regressiontest_lights.rlmap.xml
Log:
added a test for a simple trigger script

Modified: modules/common/scripts/initialize_factories.rb
===================================================================
--- modules/common/scripts/initialize_factories.rb	2007-09-23 19:18:04 UTC (rev 3863)
+++ modules/common/scripts/initialize_factories.rb	2007-09-23 19:35:37 UTC (rev 3864)
@@ -1,4 +1,6 @@
 load "effects/ruestung.rb"
+load "triggers/test.rb"
+
 class RubyClassFactory < UnifiedFactory
   def initialize()
     super();
@@ -12,8 +14,8 @@
     return Module.const_get(classname).new();
   end
 
-  def createTrigger(classname)
-    return Module.const_get(classname).new();
+  def createTrigger(classname, name)
+    return Module.const_get(classname).new(name);
   end
 
   def createEffect(classname, stufe)

Added: modules/common/scripts/triggers/test.rb
===================================================================
--- modules/common/scripts/triggers/test.rb	2007-09-23 19:18:04 UTC (rev 3863)
+++ modules/common/scripts/triggers/test.rb	2007-09-23 19:35:37 UTC (rev 3864)
@@ -0,0 +1,35 @@
+class TestTrigger < Trigger
+  def initialize(name)
+    super(name);
+    @_prop_text = "<See your ad here!>";
+  end
+
+  def activate()
+    print "activated trigger " + getName() + ", message: " + @_prop_text
+    return false
+  end
+  def deactivate()
+    print "deactivated trigger " + getName() + ", message: " + @_prop_text
+    return false
+  end
+  def setProperty(name, value)
+    if (name == "message")
+      @_prop_text = value;
+    else
+      super(name, value)
+    end
+  end
+  def getProperty(name)
+    if (name == "message")
+      return @_prop_text
+    else
+      super(name)
+    end
+  end
+  def getAllProperties()
+    ps = super();
+    ps.setProperty("message", @_prop_text)
+    return ps
+  end
+end
+

Modified: modules/regressiontest/maps/regressiontest_lights.rlmap.xml
===================================================================
--- modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-23 19:18:04 UTC (rev 3863)
+++ modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-09-23 19:35:37 UTC (rev 3864)
@@ -42,6 +42,9 @@
 			<light name="red pointlight"/>
 			<light name="green spotlight"/>
 			<sound name="ruchin001.ogg"/>
+			<trigger name="test" classname="TestTrigger">
+				<property name="message" type="STRING" data="You triggered the dooms day device!" />
+			</trigger>
 		</zone>
 		<zone name="Underwater">
 			<area type="sphere">



From melven at mail.berlios.de  Sun Sep 23 21:38:45 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sun, 23 Sep 2007 21:38:45 +0200
Subject: [Dsa-hl-svn] r3865 - in rl/trunk/engine: core core/include core/src
	script/include script/src script/swig
Message-ID: <200709231938.l8NJcjt2006318@sheep.berlios.de>

Author: melven
Date: 2007-09-23 21:38:22 +0200 (Sun, 23 Sep 2007)
New Revision: 3865

Added:
   rl/trunk/engine/core/src/Trigger.cpp
Modified:
   rl/trunk/engine/core/RlCore2005.vcproj
   rl/trunk/engine/core/include/Trigger.h
   rl/trunk/engine/core/include/ZoneManager.h
   rl/trunk/engine/core/src/CoreSubsystem.cpp
   rl/trunk/engine/core/src/ZoneManager.cpp
   rl/trunk/engine/script/include/TriggerFactory.h
   rl/trunk/engine/script/include/UnifiedFactory.h
   rl/trunk/engine/script/src/ZoneProcessor.cpp
   rl/trunk/engine/script/swig/RlCore.swig
   rl/trunk/engine/script/swig/RlScript.swig
Log:
implemented triggers

Modified: rl/trunk/engine/core/RlCore2005.vcproj
===================================================================
--- rl/trunk/engine/core/RlCore2005.vcproj	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/core/RlCore2005.vcproj	2007-09-23 19:38:22 UTC (rev 3865)
@@ -901,6 +901,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\Trigger.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\World.cpp"
 				>
 			</File>

Modified: rl/trunk/engine/core/include/Trigger.h
===================================================================
--- rl/trunk/engine/core/include/Trigger.h	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/core/include/Trigger.h	2007-09-23 19:38:22 UTC (rev 3865)
@@ -25,8 +25,33 @@
 	class _RlCoreExport Trigger : public PropertyHolder
 	{
 	public:
+        Trigger(const Ogre::String &name);
+        virtual ~Trigger() {}
+        /**
+         * return true, if the trigger can be deleted after execution. 
+         * Using ZoneManager::destroyZone in this function is explicitly allowed 
+         * (and intended); the ZoneManager cares for deleted zones, while executing triggers!
+        */
 		virtual bool activate() = 0;
+        /**
+         * return true, if the trigger can be deleted after execution. 
+         * Using ZoneManager::destroyZone in this function is explicitly allowed 
+         * (and intended); the ZoneManager cares for deleted zones, while executing triggers!
+        */
 		virtual bool deactivate() = 0;
+        /**
+         * if the trigger should also be removed, if the corresponding zone is destroyd, return true
+         * 
+        */
+        virtual bool deleteIfZoneDestroyed() const {return true;}
+
+        const Ogre::String& getName() const {return mName;}
+
+        virtual const Property getProperty(const Ogre::String& key) const;
+        virtual void setProperty(const Ogre::String& key, const Property& value);
+        virtual PropertySet* getAllProperties() const;
+    protected:
+        Ogre::String mName;
 	};
 }
 

Modified: rl/trunk/engine/core/include/ZoneManager.h
===================================================================
--- rl/trunk/engine/core/include/ZoneManager.h	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/core/include/ZoneManager.h	2007-09-23 19:38:22 UTC (rev 3865)
@@ -19,6 +19,7 @@
 #include "CorePrerequisites.h"
 #include "CoreDefines.h"
 #include "GameAreaListener.h"
+#include "GameTask.h"
 
 namespace rl
 {
@@ -27,13 +28,15 @@
 
     class _RlCoreExport ZoneManager : 
         public Ogre::Singleton<ZoneManager>,
-        public GameAreaListener
+        public GameAreaListener,
+        public GameTask // for deferred deletion of zones
 	{
 	public:
 		ZoneManager();
 		~ZoneManager();
 
         Zone* createZone(const Ogre::String& name);
+        /// only marks the zone for deferred deletion
         void destroyZone(const Ogre::String& name);
         /// Adds a new area to the zone
         void addAreaToZone(const Ogre::String& name, 
@@ -65,12 +68,19 @@
 		Zone* getZone(const Ogre::String& name);
         Zone* getZone(long id);
 
+        /// asks wether this zone is currently activated
+        bool isZoneActive(const Zone* zone) const;
+
 		void areaLeft(GameAreaEvent* gae);
 	    void areaEntered(GameAreaEvent* gae);
 
         /// only needed if the lights/etc of the active zone changed
         void update();
-		
+
+        /// inherited from gametask, deletes zones marked for deletion
+        void run(Ogre::Real elapsedTime);
+        /// inherited from gametask
+        const Ogre::String& getName() const;
 	private:
 		std::map<const Ogre::String, Zone*> mZones;
         std::map<long, Zone*> mZonesIdMap;
@@ -79,10 +89,15 @@
         SoundMap mActiveSounds;
 		Zone* mDefaultZone;
         long mNextZoneId;
+        std::list<Zone*> mZonesToDelete;
 
 		void switchLights();
 		void switchSounds();
         void switchEaxSettings();
+        void zoneEntered(Zone * zone);
+        void zoneLeft(Zone * zone);
+        
+        void doDestroyZone(Zone *zone);
 	};
 }
 

Modified: rl/trunk/engine/core/src/CoreSubsystem.cpp
===================================================================
--- rl/trunk/engine/core/src/CoreSubsystem.cpp	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/core/src/CoreSubsystem.cpp	2007-09-23 19:38:22 UTC (rev 3865)
@@ -295,6 +295,7 @@
         LOG_MESSAGE(Logger::CORE,"JobScheduler erzeugt");
 
 		mZoneManager = new ZoneManager();
+        GameLoop::getSingleton().addTask(mZoneManager, GameLoop::TG_LOGIC);
         LOG_MESSAGE(Logger::CORE,"ZoneManager erzeugt");
 
 		new meshmagick::OgreEnvironment();

Added: rl/trunk/engine/core/src/Trigger.cpp
===================================================================

Modified: rl/trunk/engine/core/src/ZoneManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-23 19:38:22 UTC (rev 3865)
@@ -26,6 +26,7 @@
 #include "Sound.h"
 #include "SoundManager.h"
 #include "SoundDriver.h"
+#include "Trigger.h"
 
 
 using namespace Ogre;
@@ -36,7 +37,8 @@
 namespace rl
 {
 	ZoneManager::ZoneManager()
-		: Ogre::Singleton<ZoneManager>()
+		: Ogre::Singleton<ZoneManager>(),
+        GameTask(false)
 	{
 		// the default zone is active when no other Zone is active
 		mDefaultZone = new Zone(0);
@@ -103,6 +105,23 @@
         if(zone == NULL)
             return;
 
+        // remove from active zones
+        if( isZoneActive(zone) )
+            mActiveZones.remove(zone);
+
+        std::map<const Ogre::String, Zone*>::iterator it = mZones.find(name);
+        if( it != mZones.end() )
+            mZones.erase(it);
+
+        std::map<long, Zone*>::iterator it_ = mZonesIdMap.find(zone->getId());
+        if( it_ != mZonesIdMap.end() )
+            mZonesIdMap.erase(it_);
+
+        mZonesToDelete.push_back(zone);
+    }
+
+    void ZoneManager::doDestroyZone(Zone *zone)
+    {
         //destroy all areas
         GameAreaEventSourceList::iterator iter = zone->getEventSources().begin();
         for( ; iter != zone->getEventSources().end(); iter++ )
@@ -113,17 +132,42 @@
                 (*iter));
         }
 
-        std::map<const Ogre::String, Zone*>::iterator it = mZones.find(name);
-        if( it != mZones.end() )
-            mZones.erase(it);
+        // ask all triggers if they want to be deleted
+        std::list<Trigger*> triggerList = zone->getTriggers();
+        std::list<Trigger*>::iterator trig = triggerList.begin();
+        for( ; trig != triggerList.end(); trig++ )
+        {
+            if( (*trig)->deleteIfZoneDestroyed() )
+                delete (*trig);
+        }
 
-        std::map<long, Zone*>::iterator it_ = mZonesIdMap.find(zone->getId());
-        if( it_ != mZonesIdMap.end() )
-            mZonesIdMap.erase(it_);
-
         delete zone;
     }
 
+    const Ogre::String& ZoneManager::getName() const
+    {
+        static Ogre::String NAME = "ZoneManager";
+
+        return NAME;
+    }
+
+    void ZoneManager::run(Ogre::Real elapsedTime)
+    {
+        std::list<Zone*>::iterator it = mZonesToDelete.begin();
+        for( ; it != mZonesToDelete.end(); it++)
+            doDestroyZone(*it);
+        mZonesToDelete.clear();
+    }
+
+    bool ZoneManager::isZoneActive(const Zone *zone) const
+    {
+        if( zone == NULL )
+            return false;
+
+        std::list<Zone*>::const_iterator iter = std::find(mActiveZones.begin(), mActiveZones.end(), zone);
+        return iter != mActiveZones.end();
+    }
+
     void ZoneManager::addAreaToZone(const Ogre::String& name, 
         AxisAlignedBox aabb, GeometryType geom,
         Vector3 position, Vector3 offset, Quaternion orientation,
@@ -225,13 +269,13 @@
             {
                 Zone *zone = getZone(id);
                 if( zone )
-                    mActiveZones.remove(zone);
+                    zoneLeft(zone);
             }
             else
             {
                 Zone *zone = getZone(-id); // means we have to subtract this area from the zone
                 if( zone )
-                    mActiveZones.push_front(zone);
+                    zoneEntered(zone);
             }
 
 		    update();
@@ -247,19 +291,55 @@
             {
                 Zone *zone = getZone(id);
                 if( zone )
-                    mActiveZones.push_front(zone);
+                    zoneEntered(zone);
             }
             else
             {
                 Zone *zone = getZone(-id); // means we have to subtract this area from the zone
                 if( zone )
-                    mActiveZones.remove(zone);
+                    zoneLeft(zone);
             }
 
 		    update();
         }
 	}
 
+    void ZoneManager::zoneEntered(Zone *zone)
+    {
+        // perhaps the trigger destroys the zone, so we should put the zone in the list, before the triggers does so
+        mActiveZones.push_front(zone);
+
+        std::list<Trigger*> triggerList = zone->getTriggers();
+        std::list<Trigger*>::iterator iter = triggerList.begin();
+
+        for( ; iter != triggerList.end(); iter++)
+        {
+            if( (*iter)->activate() )
+            {
+                zone->removeTrigger(*iter);
+                delete (*iter);                
+            }
+        }
+    }
+
+    void ZoneManager::zoneLeft(Zone *zone)
+    {
+        // perhaps the trigger destroys the zone, so we should put the zone in the list, before the triggers does so
+        mActiveZones.remove(zone);
+
+        std::list<Trigger*> triggerList = zone->getTriggers();
+        std::list<Trigger*>::iterator iter = triggerList.begin();
+
+        for( ; iter != triggerList.end(); iter++)
+        {
+            if( (*iter)->deactivate() )
+            {
+                zone->removeTrigger(*iter);
+                delete (*iter);                
+            }
+        }
+    }
+
     void ZoneManager::update()
     {
         switchLights();

Modified: rl/trunk/engine/script/include/TriggerFactory.h
===================================================================
--- rl/trunk/engine/script/include/TriggerFactory.h	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/script/include/TriggerFactory.h	2007-09-23 19:38:22 UTC (rev 3865)
@@ -26,7 +26,7 @@
 	{
 	public:
 		virtual ~TriggerFactory() {}
-		virtual Trigger* createTrigger(const Ogre::String& classname) = 0;
+        virtual Trigger* createTrigger(const Ogre::String& classname, const Ogre::String& triggername) = 0;
 	};
 }
 

Modified: rl/trunk/engine/script/include/UnifiedFactory.h
===================================================================
--- rl/trunk/engine/script/include/UnifiedFactory.h	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/script/include/UnifiedFactory.h	2007-09-23 19:38:22 UTC (rev 3865)
@@ -33,7 +33,7 @@
     public:
         virtual ~UnifiedFactory() {}
 
-		virtual Trigger* createTrigger(const Ogre::String& classname) = 0;
+        virtual Trigger* createTrigger(const Ogre::String& classname, const Ogre::String& name) = 0;
         virtual Effect* createEffect(const Ogre::String& name, int stufe) = 0;
         virtual GameObject* createRubyGameObject(const Ogre::String& classname, unsigned int id) = 0;
         virtual SteeringBehaviour* createBehaviour(const Ogre::String& classname) = 0;

Modified: rl/trunk/engine/script/src/ZoneProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/script/src/ZoneProcessor.cpp	2007-09-23 19:38:22 UTC (rev 3865)
@@ -182,10 +182,26 @@
 									Ogre::String classname =
 										getAttributeValueAsStdString(curElem, "classname");
 
+									Ogre::String name =
+										getAttributeValueAsStdString(curElem, "name");
+
 									Trigger* trigger = ScriptSubsystem::getSingleton().getTriggerFactory()
-										->createTrigger(classname);
+										->createTrigger(classname, name);
 
-									///@todo trigger properties
+                                    // add trigger properties
+                                    for( DOMNode* curProperty = cur->getFirstChild(); curProperty != NULL; curProperty = curProperty->getNextSibling() )
+                                    {
+                                        if( hasNodeName(curProperty, "property") )
+                                        {
+                                            PropertyEntry propEntry = processProperty(static_cast<DOMElement*>(curProperty));
+                                            if (propEntry.first != "")
+                                            {
+                                                trigger->setProperty(propEntry.first, propEntry.second);
+                                            }
+                                        }
+                                    }
+
+                                    zone->addTrigger(trigger);
 								}
                                 else if (hasNodeName(curElem, "eaxpreset"))
                                 {

Modified: rl/trunk/engine/script/swig/RlCore.swig
===================================================================
--- rl/trunk/engine/script/swig/RlCore.swig	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/script/swig/RlCore.swig	2007-09-23 19:38:22 UTC (rev 3865)
@@ -893,13 +893,13 @@
 public:
 	void addLight(Actor* light);
     void addSound(const Ogre::String& name);
-	//void addTrigger(Trigger* trigger);
+	void addTrigger(rl::Trigger* trigger);
 	std::list<Actor*> getLights() const;
     std::list<Ogre::String> getSounds() const;
-	//std::list<Trigger*> getTriggers() const;
+	std::list<rl::Trigger*> getTriggers() const;
     void removeLight(Actor* light);
     void removeSound(const Ogre::String& name);
-    //void removeTrigger(Trigger* trigger);
+    void removeTrigger(rl::Trigger* trigger);
 protected:
     Zone(long id);
 private:
@@ -943,17 +943,22 @@
 	rl::Zone* getDefaultZone();
 	rl::Zone* getZone(const Ogre::String& name);
     rl::Zone* getZone(long id);
+    bool isZoneActive(const rl::Zone *zone) const;
 };
 
+%feature("director") Trigger;
 class  Trigger
 {
 public:
+    Trigger(const Ogre::String &name);
+    virtual ~Trigger();
 	virtual bool activate() = 0;
 	virtual bool deactivate() = 0;
-	virtual const rl::Property getProperty(const Ogre::String& key) const = 0;
-    virtual void setProperty(const Ogre::String& key, const rl::Property& value) = 0;
-    virtual rl::PropertySet* getAllProperties() const = 0;
-    virtual void setProperties(const rl::PropertySet* props);
+	virtual bool deleteIfZoneDestroyed() const;
+	const Ogre::String& getName() const;
+    virtual const rl::Property getProperty(const Ogre::String& key) const;
+    virtual void setProperty(const Ogre::String& key, const rl::Property& value);
+    virtual rl::PropertySet* getAllProperties() const;
 };
 
 class SoundFadeJob : public rl::Job

Modified: rl/trunk/engine/script/swig/RlScript.swig
===================================================================
--- rl/trunk/engine/script/swig/RlScript.swig	2007-09-23 19:35:37 UTC (rev 3864)
+++ rl/trunk/engine/script/swig/RlScript.swig	2007-09-23 19:38:22 UTC (rev 3865)
@@ -38,7 +38,7 @@
 	{
 	public:
 		virtual ~TriggerFactory();
-		virtual rl::Trigger* createTrigger(const Ogre::String& classname) = 0;
+		virtual rl::Trigger* createTrigger(const Ogre::String& classname, const Ogre::String& triggername) = 0;
 	};
 
 	%feature("director") UnifiedFactory;    
@@ -51,7 +51,7 @@
     public:
         virtual ~UnifiedFactory() {}
 
-		virtual rl::Trigger* createTrigger(const Ogre::String& classname) = 0;
+		virtual rl::Trigger* createTrigger(const Ogre::String& classname, const Ogre::String& triggername) = 0;
         virtual rl::Effect* createEffect(const Ogre::String& name, int stufe) = 0;
         virtual rl::GameObject* createRubyGameObject(const Ogre::String& classname, unsigned int id) = 0;
         virtual rl::SteeringBehaviour* createBehaviour(const Ogre::String& classname) = 0;



From melven at mail.berlios.de  Sun Sep 23 21:39:54 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sun, 23 Sep 2007 21:39:54 +0200
Subject: [Dsa-hl-svn] r3866 - rl/trunk/engine/core/src
Message-ID: <200709231939.l8NJds92006393@sheep.berlios.de>

Author: melven
Date: 2007-09-23 21:39:33 +0200 (Sun, 23 Sep 2007)
New Revision: 3866

Modified:
   rl/trunk/engine/core/src/Makefile.am
Log:
added Trigger.cpp to makefile

Modified: rl/trunk/engine/core/src/Makefile.am
===================================================================
--- rl/trunk/engine/core/src/Makefile.am	2007-09-23 19:38:22 UTC (rev 3865)
+++ rl/trunk/engine/core/src/Makefile.am	2007-09-23 19:39:33 UTC (rev 3866)
@@ -63,6 +63,7 @@
 	SoundFadeJob.cpp \
 	SoundFadeFunctor.cpp \
 	TimeSource.cpp \
+	Trigger.cpp \
 	TrackAnimation.cpp \
 	World.cpp \
 	Zone.cpp \



From melven at mail.berlios.de  Sun Sep 23 21:45:01 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Sun, 23 Sep 2007 21:45:01 +0200
Subject: [Dsa-hl-svn] r3867 - in rl/trunk/engine/core: . src
Message-ID: <200709231945.l8NJj105006604@sheep.berlios.de>

Author: melven
Date: 2007-09-23 21:44:47 +0200 (Sun, 23 Sep 2007)
New Revision: 3867

Modified:
   rl/trunk/engine/core/RlCore2005.vcproj
   rl/trunk/engine/core/src/Trigger.cpp
Log:
corrected folder of Trigger.cpp in vc and added new line at end of file for gcc-users

Modified: rl/trunk/engine/core/RlCore2005.vcproj
===================================================================
--- rl/trunk/engine/core/RlCore2005.vcproj	2007-09-23 19:39:33 UTC (rev 3866)
+++ rl/trunk/engine/core/RlCore2005.vcproj	2007-09-23 19:44:47 UTC (rev 3867)
@@ -901,7 +901,7 @@
 				>
 			</File>
 			<File
-				RelativePath=".\Trigger.cpp"
+				RelativePath=".\src\Trigger.cpp"
 				>
 			</File>
 			<File

Modified: rl/trunk/engine/core/src/Trigger.cpp
===================================================================
--- rl/trunk/engine/core/src/Trigger.cpp	2007-09-23 19:39:33 UTC (rev 3866)
+++ rl/trunk/engine/core/src/Trigger.cpp	2007-09-23 19:44:47 UTC (rev 3867)
@@ -0,0 +1,68 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+#include "stdinc.h" //precompiled header
+
+#include "Trigger.h"
+
+namespace rl
+{
+    Trigger::Trigger(const Ogre::String &name) : mName(name)
+    {
+    }
+
+    const Property Trigger::getProperty(const Ogre::String& key) const
+    {
+        Property prop;
+        if( key == "name" )
+            prop.setValue(mName);
+        else
+        {
+            Throw(IllegalArgumentException, key + " is not a property of this Trigger (" + mName +").");
+        }
+
+        return prop;
+    }
+
+    void Trigger::setProperty(const Ogre::String& key, const Property& value)
+    {
+        try
+        {
+            if( key == "name" )
+                mName = value.toString().c_str();
+            else
+            {
+                LOG_WARNING(
+                    Logger::CORE,
+                    key + " is not a property of this Trigger ("+mName+").");
+            }
+        }
+        catch (WrongFormatException ex)
+        {
+            LOG_ERROR(
+                Logger::CORE,
+                "property " + key + " has the wrong format");
+        }
+    }
+
+    PropertySet* Trigger::getAllProperties() const
+    {
+        PropertySet* ps = new PropertySet();
+        ps->setProperty("name", Property(mName));
+
+        return ps;
+    }
+
+}



From timm at mail.berlios.de  Mon Sep 24 21:21:21 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 24 Sep 2007 21:21:21 +0200
Subject: [Dsa-hl-svn] r3868 - in rl/trunk/engine/rules: include src
Message-ID: <200709241921.l8OJLL1l024749@sheep.berlios.de>

Author: timm
Date: 2007-09-24 21:20:35 +0200 (Mon, 24 Sep 2007)
New Revision: 3868

Modified:
   rl/trunk/engine/rules/include/SaveGameManager.h
   rl/trunk/engine/rules/src/SaveGameFile.cpp
   rl/trunk/engine/rules/src/SaveGameManager.cpp
Log:
Now possible to overwrite existing save games

Modified: rl/trunk/engine/rules/include/SaveGameManager.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-23 19:44:47 UTC (rev 3867)
+++ rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-24 19:20:35 UTC (rev 3868)
@@ -27,20 +27,6 @@
 {
     typedef std::map<CeGuiString, SaveGameFile*> SaveGameEntryMap;
 
-    /*class SaveGameIndexWriter : public XmlPropertyWriter
-    {
-    public: 
-        SaveGameIndexWriter();
-        void buildIndexFile(const SaveGameEntryMap &map);
-    };
-
-    class SaveGameIndexReader : public XmlPropertyReader
-    {
-    public:
-        SaveGameIndexReader();
-        SaveGameEntryMap parseIndexFile(Ogre::DataStreamPtr &stream, const Ogre::String &groupName);
-    };*/
-
     class SaveGameHeaderReader : public XmlPropertyReader
     {
     public:
@@ -64,6 +50,8 @@
         virtual void parseScript(Ogre::DataStreamPtr &stream, const Ogre::String &groupName);
         virtual Ogre::Real getLoadingOrder(void) const;
     protected:
+        void freeSaveGameMap();
+
         Ogre::StringVector mScriptPatterns;
         SaveGameEntryMap mSaveGames;
     };

Modified: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-23 19:44:47 UTC (rev 3867)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-24 19:20:35 UTC (rev 3868)
@@ -27,13 +27,15 @@
 namespace rl
 {
 
-    SaveGameFile::SaveGameFile(const CeGuiString &name)
+    SaveGameFile::SaveGameFile(const CeGuiString &name) : mStream((Ogre::DataStream*)NULL)
     {
         mName = name;
     }
 
     SaveGameFile::~SaveGameFile()
     {
+        if(mStream.isNull())
+            delete mStream.get();
     }
 
     CeGuiString SaveGameFile::buildFilename()

Modified: rl/trunk/engine/rules/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-23 19:44:47 UTC (rev 3867)
+++ rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-24 19:20:35 UTC (rev 3868)
@@ -44,127 +44,6 @@
         return string;
     }
 
-    //SaveGameIndexWriter::SaveGameIndexWriter()
-    //{
-    //}
-
-    //void SaveGameIndexWriter::buildIndexFile(const SaveGameEntryMap &map)
-    //{
-    //    initializeXml();
-
-    //    XMLCh tempStr[256];
-    //    XMLString::transcode("LS", tempStr, 255);
-    //    mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
-    //    mWriter = static_cast<DOMImplementationLS*>(mImplementation)->createDOMWriter();
-    //    XMLString::transcode(((Ogre::String)(ConfigurationManager::getSingleton().getModulesRootDirectory() + "/saves/index.saves")).c_str(), tempStr, 255);
-    //    mTarget = new LocalFileFormatTarget(tempStr);
-    //    mDocument = static_cast<DOMImplementation*>(mImplementation)->createDocument(0, XMLString::transcode("SaveGameIndexFile"), 0);
-    //    
-    //    if (mWriter->canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
-    //        mWriter->setFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true);
-
-    //    if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
-    //         mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
-
-    //    mWriter->setEncoding(XMLUni::fgISO88591EncodingString);
-
-    //    mDocument->setNodeValue(XMLString::transcode("SaveGameIndexFile")); //Set name of document root node
-
-    //     //Write SaveGameIndexVersion
-    //    setAttributeValueAsString(mDocument->getDocumentElement(), "Version", "0.1");
-
-
-    //    //write save games
-    //    SaveGameEntryMap::const_iterator it_saves;
-
-    //    for(it_saves = map.begin(); it_saves != map.end(); it_saves++)
-    //    {
-    //        DOMElement* saveGame = appendChildElement(mDocument, mDocument->getDocumentElement(), "savegame");
-    //        setAttributeValueAsString(saveGame, "Name", it_saves->second->getName());
-
-    //        PropertyMap map = it_saves->second->getAllProperties()->toPropertyMap();
-    //        PropertyMap::iterator it_properties;
-    //        for(it_properties = map.begin(); it_properties != map.end(); it_properties++)
-    //        {
-    //            this->processProperty(saveGame, PropertyEntry(it_properties->first.c_str(), it_properties->second));
-    //        }
-    //    }        
-
-
-    //    mWriter->writeNode(mTarget, *mDocument);
-
-
-    //    mWriter->release();
-
-    //    delete mDocument;
-    //    delete mTarget;
-
-    //    shutdownXml();
-    //}
-
-    //SaveGameIndexReader::SaveGameIndexReader()
-    //{
-    //}
-
-    //SaveGameEntryMap SaveGameIndexReader::parseIndexFile(Ogre::DataStreamPtr &stream, const Ogre::String &groupName)
-    //{
-    //    SaveGameEntryMap entries;
-
-    //    initializeXml();
-
-    //    /*Ogre::String fileName = ConfigurationManager::getSingleton().getModulesRootDirectory() + "/saves/index.saves";
-
-    //    FILE* fileHandle = fopen(fileName.c_str(), "r");
-
-    //    if(fileHandle)
-    //    {
-    //        Ogre::DataStreamPtr stream = Ogre::DataStreamPtr(new Ogre::FileHandleDataStream(fileHandle));*/
-
-    //        /*char* temp = new char[1024];
-
-    //        stream->read(temp, 1022);
-
-    //        LOG_MESSAGE(Logger::RULES, temp);
-
-    //        delete[] temp;*/
-
-    //        if(stream->size())
-    //        {
-    //            DOMDocument* doc = loadDocument( stream);
-
-    //            ///@todo: Right version of save game file index?
-
-    //            DOMNodeList* saveGameDefsXml = doc->getDocumentElement()->getElementsByTagName(AutoXMLCh("savegame").data());
-    //            for(unsigned int i = 0; i < saveGameDefsXml->getLength(); i++)
-    //            {
-    //                DOMElement* curNode = static_cast<DOMElement*>(saveGameDefsXml->item(i));
-    //                SaveGameFile * file = new SaveGameFile(this->getAttributeValueAsString(curNode, "Name"));
-    //                
-    //                DOMNodeList* saveGameDefChildren = curNode->getChildNodes();
-    //                for (XMLSize_t childIdx = 0; childIdx < saveGameDefChildren->getLength(); childIdx++)
-    //                {
-    //                    DOMNode* curChild = saveGameDefChildren->item(childIdx);
-    //                    if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
-    //                    {
-    //                        PropertyEntry entry = processProperty(static_cast<DOMElement*>(curChild));
-    //                        if (entry.first != "")
-    //                        {
-    //                            file->setProperty(entry.first, entry.second);
-    //                        }
-    //                    }
-    //                }
-    //                entries[this->getAttributeValueAsString(curNode, "Name").c_str()] = file;
-    //            }
-
-    //            doc->release();
-    //        }
-    //    /*}*/
-
-    //    shutdownXml();
-
-    //    return entries;
-    //}
-
     SaveGameHeaderReader::SaveGameHeaderReader()
     {
     }
@@ -210,6 +89,7 @@
         Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() 
             + "/saves", "FileSystem", "SaveGames");
         Ogre::ResourceGroupManager::getSingleton().initialiseResourceGroup("SaveGames");
+        Ogre::ResourceGroupManager::getSingleton().clearResourceGroup("SaveGames"); //close all resource files -> make them writable
     }
 
     SaveGameManager::~SaveGameManager()
@@ -235,6 +115,11 @@
 
         SaveGameFileWriter writer;
         writer.buildSaveGameFile(file);
+
+        freeSaveGameMap();
+
+        Ogre::ResourceGroupManager::getSingleton().initialiseResourceGroup("SaveGames");
+        Ogre::ResourceGroupManager::getSingleton().clearResourceGroup("SaveGames"); //close all resource files -> make them writable
     }
 
     void SaveGameManager::loadSaveGameFile(const CeGuiString &name)
@@ -279,11 +164,23 @@
         name = name.substr(0, name.length()-5); //delete ".save" at the and of the name
 
         SaveGameFile* file = new SaveGameFile(name);
-        file->setDataStream(stream);
+        
         LOG_MESSAGE(Logger::RULES, "Parsing header of save game: " + name);
         SaveGameHeaderReader reader;
         reader.parseHeader(stream, groupName, file);
+
+        Ogre::DataStream* _stream = new Ogre::MemoryDataStream(*stream, false); //making a copy of the data stream. searching for a better alternative
+        file->setDataStream(Ogre::DataStreamPtr(_stream));
         
         mSaveGames[name] = file;
     }
+
+    void SaveGameManager::freeSaveGameMap()
+    {
+        for(SaveGameEntryMap::const_iterator iter = mSaveGames.begin(); iter != mSaveGames.end(); iter++)
+        {
+            delete iter->second;
+        }
+        mSaveGames.clear();
+    }
 }



From melven at mail.berlios.de  Mon Sep 24 21:25:14 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Mon, 24 Sep 2007 21:25:14 +0200
Subject: [Dsa-hl-svn] r3869 - in rl/trunk/engine: core/include core/src
	script/swig
Message-ID: <200709241925.l8OJPEiZ025096@sheep.berlios.de>

Author: melven
Date: 2007-09-24 21:25:03 +0200 (Mon, 24 Sep 2007)
New Revision: 3869

Modified:
   rl/trunk/engine/core/include/GameAreaEventSource.h
   rl/trunk/engine/core/include/ZoneManager.h
   rl/trunk/engine/core/src/GameEventManager.cpp
   rl/trunk/engine/core/src/ZoneManager.cpp
   rl/trunk/engine/script/swig/RlCore.swig
   rl/trunk/engine/script/swig/RlScript.swig
Log:
-zones can now be destroyed correctly (deferred deletion, used gameareas are deleted too)
-added overloaded function for ZoneManager::addAreaToZone with size as vector (not aab) for scripting

Modified: rl/trunk/engine/core/include/GameAreaEventSource.h
===================================================================
--- rl/trunk/engine/core/include/GameAreaEventSource.h	2007-09-24 19:20:35 UTC (rev 3868)
+++ rl/trunk/engine/core/include/GameAreaEventSource.h	2007-09-24 19:25:03 UTC (rev 3869)
@@ -76,6 +76,8 @@
     const ActorMap& getInsideAreaList() const { return mInsideAreaList; };
     /// Gibt den Actor zur?ck, den das Areal umgibt
     Actor* getActor() const { return mActor; };
+    /// gibt an ob die ga gel?scht werden kann, wenn die dazugeh?rige zone gel?scht wird
+    virtual bool destroyIfZoneDestroyed() const {return true;}
 protected:
     /// helps the zonemanager to associate zones with areas
     friend class ZoneManager;

Modified: rl/trunk/engine/core/include/ZoneManager.h
===================================================================
--- rl/trunk/engine/core/include/ZoneManager.h	2007-09-24 19:20:35 UTC (rev 3868)
+++ rl/trunk/engine/core/include/ZoneManager.h	2007-09-24 19:25:03 UTC (rev 3869)
@@ -44,12 +44,32 @@
             Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
             Ogre::Real transitionDistance,
             unsigned long queryflags);
+        void addAreaToZone(const Ogre::String& name, 
+            Ogre::Vector3 size, GeometryType geom,
+            Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+            Ogre::Real transitionDistance,
+            unsigned long queryflags)
+        {
+            addAreaToZone(
+                name, Ogre::AxisAlignedBox(- 0.5 * size, 0.5 *size ), geom, position, offset, orientation,
+                transitionDistance, queryflags);
+        }
         /// subtracts an area from the zone (it must ly in another area in this zone, else the beaviour is not defined)
         void subtractAreaFromZone(const Ogre::String& name, 
             Ogre::AxisAlignedBox aabb, GeometryType geom,
             Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
             Ogre::Real transitionDistance,
             unsigned long queryflags);
+        void subtractAreaFromZone(const Ogre::String& name, 
+            Ogre::Vector3 size, GeometryType geom,
+            Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
+            Ogre::Real transitionDistance,
+            unsigned long queryflags)
+        {
+            subtractAreaFromZone(
+                name, Ogre::AxisAlignedBox(- 0.5 * size, 0.5 *size ), geom, position, offset, orientation,
+                transitionDistance, queryflags);
+        }
         /// Adds a new mesh area to the zone
         void addMeshAreaToZone(const Ogre::String& name,
             const Ogre::String& meshname, GeometryType geom,

Modified: rl/trunk/engine/core/src/GameEventManager.cpp
===================================================================
--- rl/trunk/engine/core/src/GameEventManager.cpp	2007-09-24 19:20:35 UTC (rev 3868)
+++ rl/trunk/engine/core/src/GameEventManager.cpp	2007-09-24 19:25:03 UTC (rev 3869)
@@ -248,7 +248,6 @@
                     mBodyGameAreaMap.erase(it);
             }
 
-			ScriptWrapper::getSingleton().deleted( gam );
 			// Die Area-Art l?schen
 			delete gam->getGameAreaType();
 			// Das Objekt l?schen

Modified: rl/trunk/engine/core/src/ZoneManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-24 19:20:35 UTC (rev 3868)
+++ rl/trunk/engine/core/src/ZoneManager.cpp	2007-09-24 19:25:03 UTC (rev 3869)
@@ -117,6 +117,7 @@
         if( it_ != mZonesIdMap.end() )
             mZonesIdMap.erase(it_);
 
+
         mZonesToDelete.push_back(zone);
     }
 
@@ -126,10 +127,12 @@
         GameAreaEventSourceList::iterator iter = zone->getEventSources().begin();
         for( ; iter != zone->getEventSources().end(); iter++ )
         {
-            // we have our own actors, remove them
-            ActorManager::getSingleton().destroyActor( (*iter)->getActor() );
-		    GameEventManager::getSingleton().removeAreaEventSource(
-                (*iter));
+            // if we have our own actors, remove them
+            if( (*iter)->getActor() )
+                ActorManager::getSingleton().destroyActor( (*iter)->getActor() ); // this also removes all areaeventsources
+            else
+		        GameEventManager::getSingleton().removeAreaEventSource(
+                    (*iter));
         }
 
         // ask all triggers if they want to be deleted
@@ -185,6 +188,7 @@
 
         gam->getGameAreaType()->setTransitionDistance(transitionDistance);
         gam->setId(zone->getId());
+        zone->addEventSource(gam);
     }
     
     void ZoneManager::subtractAreaFromZone(const Ogre::String& name, 
@@ -203,6 +207,7 @@
 
         gam->getGameAreaType()->setTransitionDistance(transitionDistance);
         gam->setId( - (zone->getId())); // a negative id indicates to subtract this area from the zone
+        zone->addEventSource(gam);
     }
 
     void ZoneManager::addMeshAreaToZone(const Ogre::String& name,
@@ -230,6 +235,7 @@
 
         CoreSubsystem::getSingletonPtr()->getWorld()
             ->getSceneManager()->destroyEntity(entity);
+        zone->addEventSource(gam);
     }
 
     void ZoneManager::subtractMeshAreaFromZone(const Ogre::String& name,
@@ -258,6 +264,7 @@
 
         CoreSubsystem::getSingletonPtr()->getWorld()
             ->getSceneManager()->destroyEntity(entity);
+        zone->addEventSource(gam);
     }
 
 	void ZoneManager::areaLeft(GameAreaEvent* gae)

Modified: rl/trunk/engine/script/swig/RlCore.swig
===================================================================
--- rl/trunk/engine/script/swig/RlCore.swig	2007-09-24 19:20:35 UTC (rev 3868)
+++ rl/trunk/engine/script/swig/RlCore.swig	2007-09-24 19:25:03 UTC (rev 3869)
@@ -915,13 +915,13 @@
     void destroyZone(const Ogre::String& name);
 
     void addAreaToZone(const Ogre::String& name, 
-        Ogre::AxisAlignedBox aabb, rl::GeometryType geom,
+        Ogre::Vector3 size, rl::GeometryType geom,
         Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
         Ogre::Real transitionDistance,
         unsigned long queryflags);
 
     void subtractAreaFromZone(const Ogre::String& name, 
-        Ogre::AxisAlignedBox aabb, rl::GeometryType geom,
+        Ogre::Vector3 size, rl::GeometryType geom,
         Ogre::Vector3 position, Ogre::Vector3 offset, Ogre::Quaternion orientation,
         Ogre::Real transitionDistance,
         unsigned long queryflags);

Modified: rl/trunk/engine/script/swig/RlScript.swig
===================================================================
--- rl/trunk/engine/script/swig/RlScript.swig	2007-09-24 19:20:35 UTC (rev 3868)
+++ rl/trunk/engine/script/swig/RlScript.swig	2007-09-24 19:25:03 UTC (rev 3869)
@@ -24,6 +24,7 @@
 		void log(const rl::CeGuiString& message);
         void logError(const rl::CeGuiString& message);
 		void setTriggerFactory(rl::TriggerFactory* factory);
+		rl::TriggerFactory* getTriggerFactory() const;
 	};
 	  
     class MapLoader



From timm at mail.berlios.de  Mon Sep 24 21:25:25 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 24 Sep 2007 21:25:25 +0200
Subject: [Dsa-hl-svn] r3870 - rl/trunk/engine/rules/src
Message-ID: <200709241925.l8OJPPFG025107@sheep.berlios.de>

Author: timm
Date: 2007-09-24 21:25:20 +0200 (Mon, 24 Sep 2007)
New Revision: 3870

Modified:
   rl/trunk/engine/rules/src/SaveGameManager.cpp
Log:
freeing the save game map in the destructor

Modified: rl/trunk/engine/rules/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-24 19:25:03 UTC (rev 3869)
+++ rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-24 19:25:20 UTC (rev 3870)
@@ -94,6 +94,7 @@
 
     SaveGameManager::~SaveGameManager()
     {
+        freeSaveGameMap();
     }
 
     SaveGameEntryMap SaveGameManager::listSaveGames()



From melven at mail.berlios.de  Mon Sep 24 21:29:03 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Mon, 24 Sep 2007 21:29:03 +0200
Subject: [Dsa-hl-svn] r3871 - modules/common/scripts
Message-ID: <200709241929.l8OJT3EU025293@sheep.berlios.de>

Author: melven
Date: 2007-09-24 21:28:45 +0200 (Mon, 24 Sep 2007)
New Revision: 3871

Modified:
   modules/common/scripts/areahelper.rb
Log:
-added new helper-functions for triggers (_CreateLimitedTimesTrigger, _CreateTrigger, _CreateOneTimeTrigger)

Modified: modules/common/scripts/areahelper.rb
===================================================================
--- modules/common/scripts/areahelper.rb	2007-09-24 19:25:20 UTC (rev 3870)
+++ modules/common/scripts/areahelper.rb	2007-09-24 19:28:45 UTC (rev 3871)
@@ -1,3 +1,118 @@
+
+# a trigger, that saves an command the appropriate zone and deletes it when finished
+class LimitedTimesTrigger < Trigger
+  def initialize(name)
+    super(name);
+    @_prop_enter_command = nil;
+    @_prop_leave_command = nil;
+    @_prop_zone = "";
+    @_prop_number = 0; # 0 infty, -1 once, -2 deactivated
+  end
+  def setEnterCode(&code)
+    @_prop_enter_command = code
+  end
+  def setLeaveCode(&code)
+    @_prop_leave_command = code
+  end
+
+  def activate()
+    if ( @_prop_number > 0 )
+      @_prop_number = @_prop_number - 1;
+      if (@_prop_number == 0 )
+        @_prop_number = -1;
+      end
+    end
+    
+    if( @_prop_number >= -1 )
+      unless ( @_prop_enter_command == nil )
+        begin
+          @_prop_enter_command.call
+        rescue StandardError => se
+          $SCRIPT.logError(se.to_s)
+        end
+      end
+    end
+    return false
+  end
+  def deactivate()
+    if( @_prop_number >= -1 )
+      unless ( @_prop_leave_command == nil )
+        begin
+          @_prop_leave_command.call
+        rescue StandardError => se
+          $SCRIPT.logError(se.to_s)
+        end
+      end
+    end
+
+    if ( @_prop_number == -1 )
+      @_prop_number = -2
+      unless ( @_prop_zone == "" )
+        ZoneManager.getSingleton().destroyZone(@_prop_zone)
+      end
+      return true
+    end
+    return false
+  end
+  def setProperty(name, value)
+    if (name == "number")
+      @_prop_number = value;
+    elsif (name == "zone")
+      @_prop_zone = value
+    else
+      super(name, value)
+    end
+  end
+  def getProperty(name)
+    if (name == "zone")
+      return @_prop_zone
+    elsif (name == "number")
+      return @_prop_number
+    else
+      super(name)
+    end
+  end
+  def getAllProperties()
+    ps = super();
+    ps.setProperty("zone", @_prop_zone)
+    ps.setProperty("number", @_prop_number)
+    return ps
+  end
+end
+
+# creates a zone with a trigger, that is destroyed if actived 'times' of times
+# Example: _CreateLimitedTimesTrigger("uniquename", PhysicsManager::GT_SPHERE, [-20,0,5], [1,0,0,0], [2,2,2], 5, Proc.new{print "entered"}, Proc.new{print "left"})
+def _CreateLimitedTimesTrigger(name, geom_type, pos, orientation, size, times, enter_proc, leave_proc = nil)
+  unless ( ZoneManager.getSingleton().getZone("limitedTimesTriggerZone_" + name) == nil )
+    raise ArgumentError, "A limitedTimesTrigger with name " + name + " already exists!", caller
+  end
+
+  trigger = $SCRIPT.getTriggerFactory().createTrigger("LimitedTimesTrigger", "limitedTimeTrigger_" + name);
+  zone = ZoneManager.getSingleton().createZone("limitedTimesTriggerZone_" + name);
+  ZoneManager.getSingleton().addAreaToZone(
+    "limitedTimesTriggerZone_" + name, 
+    size, geom_type, pos, [0,0,0], orientation, 0.5, RlScript::QUERYFLAG_PLAYER);
+  trigger.setProperty("number", times);
+  trigger.setEnterCode( &enter_proc );
+  trigger.setLeaveCode( &leave_proc );
+  trigger.setProperty("zone", "limitedTimesTriggerZone_" + name )
+  zone.addTrigger(trigger)
+  return trigger
+end
+
+# one time trigger
+def _CreateOneTimeTrigger(name, geom_type, pos, orientation, size, enter_proc, leave_proc = nil)
+  return _CreateLimitedTimesTrigger(name, geom_type, pos, orientation, size, 1, enter_proc, leave_proc)
+end
+
+# infinite times trigger
+def _CreateTrigger(name, geom_type, pos, orientation, size, enter_proc, leave_proc = nil)
+  return _CreateLimitedTimesTrigger(name, geom_type, pos, orientation, size, 0, enter_proc, leave_proc)
+end
+
+
+
+# CODE DEPRECATED
 # A simple GameAreaListener which will call predefined procedures upon entering
 # or leaving the Area.
 class SimpleAreaListener < GameAreaListener



From timm at mail.berlios.de  Mon Sep 24 21:42:12 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 24 Sep 2007 21:42:12 +0200
Subject: [Dsa-hl-svn] r3872 - in modules: aitest combattest minidemo
	regressiontest ruchin techdemo techdemo2 tutorial
Message-ID: <200709241942.l8OJgCkA026222@sheep.berlios.de>

Author: timm
Date: 2007-09-24 21:41:49 +0200 (Mon, 24 Sep 2007)
New Revision: 3872

Removed:
   modules/aitest/saves/
   modules/combattest/saves/
   modules/minidemo/saves/
   modules/regressiontest/saves/
   modules/ruchin/saves/
   modules/techdemo/saves/
   modules/techdemo2/saves/
   modules/tutorial/saves/
Log:
deleted unnecessary directories



From timm at mail.berlios.de  Mon Sep 24 22:34:44 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Mon, 24 Sep 2007 22:34:44 +0200
Subject: [Dsa-hl-svn] r3873 - rl/trunk/engine/ui/src
Message-ID: <200709242034.l8OKYiw9030706@sheep.berlios.de>

Author: timm
Date: 2007-09-24 22:34:42 +0200 (Mon, 24 Sep 2007)
New Revision: 3873

Modified:
   rl/trunk/engine/ui/src/SaveLoadWindow.cpp
Log:
list save games in the window

Modified: rl/trunk/engine/ui/src/SaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-24 19:41:49 UTC (rev 3872)
+++ rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-24 20:34:42 UTC (rev 3873)
@@ -149,26 +149,21 @@
 
     void SaveLoadWindow::listSaveGames()
     {
-        /*Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
-        Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() + "/"
-            + Ogre::String(CoreSubsystem::getSingleton().getActiveAdventureModule()->getId().c_str()) + "/saves", "FileSystem", "SaveGames");
-        Ogre::StringVectorPtr saveGames = Ogre::ResourceGroupManager::getSingleton().listResourceNames("SaveGames");
-        Ogre::StringVector::iterator it;
-        
-        while(mSaveGameTable->getRowCount() > saveGames->size())
+        SaveGameEntryMap saveGames = SaveGameManager::getSingleton().listSaveGames();
+    
+        while(mSaveGameTable->getRowCount() > saveGames.size())
 		    mSaveGameTable->removeRow(mSaveGameTable->getRowCount()-1);
-        while(mSaveGameTable->getRowCount() < saveGames->size())
+        while(mSaveGameTable->getRowCount() < saveGames.size())
 		    mSaveGameTable->addRow();
         
         int saveGameNum = 0;
 
-        for(it = saveGames->begin(); it != saveGames->end(); it++)
+        for(SaveGameEntryMap::iterator it = saveGames.begin(); it != saveGames.end(); it++)
         {
-            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->data()), 0, saveGameNum);
+            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->first), 0, saveGameNum);
+            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->second->getProperty("Time")), 1, saveGameNum);
             saveGameNum++;
         }
-
-        Ogre::ResourceGroupManager::getSingleton().destroyResourceGroup("SaveGames");*/
     }
 
 } // namespace rl



From blakharaz at mail.berlios.de  Mon Sep 24 23:02:04 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Mon, 24 Sep 2007 23:02:04 +0200
Subject: [Dsa-hl-svn] r3874 - in rl/trunk/engine: ai/src core/src
Message-ID: <200709242102.l8OL24dV032022@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-24 23:01:57 +0200 (Mon, 24 Sep 2007)
New Revision: 3874

Modified:
   rl/trunk/engine/ai/src/SteeringVehicle.cpp
   rl/trunk/engine/core/src/GameLoop.cpp
Log:
changed some log messages from MESSAGE to DEBUG

Modified: rl/trunk/engine/ai/src/SteeringVehicle.cpp
===================================================================
--- rl/trunk/engine/ai/src/SteeringVehicle.cpp	2007-09-24 20:34:42 UTC (rev 3873)
+++ rl/trunk/engine/ai/src/SteeringVehicle.cpp	2007-09-24 21:01:57 UTC (rev 3874)
@@ -158,9 +158,8 @@
         movement = CreatureController::MT_GEHEN;
     }
 
-
     mController->setMovement(movement, direction, rotation);
-    LOG_MESSAGE("mController->setMovement",
+    LOG_DEBUG(Logger::AI, "SteeringVehicle: mController->setMovement " + 
         Ogre::StringConverter::toString(movement) + ", "
         + Ogre::StringConverter::toString(direction) + ", "
         + Ogre::StringConverter::toString(rotation));

Modified: rl/trunk/engine/core/src/GameLoop.cpp
===================================================================
--- rl/trunk/engine/core/src/GameLoop.cpp	2007-09-24 20:34:42 UTC (rev 3873)
+++ rl/trunk/engine/core/src/GameLoop.cpp	2007-09-24 21:01:57 UTC (rev 3874)
@@ -131,7 +131,7 @@
 
         if( unsmoothedFrameTime > mMaxFrameTime*1000 )
         {
-            LOG_MESSAGE(Logger::CORE, "Die aktuelle Frame wurde auf den festgelegten Maximalwert gek?rzt");
+            LOG_DEBUG(Logger::CORE, "The current frame time was truncated at maximum.");
             unsmoothedFrameTime = mMaxFrameTime*1000;
         }
         Real frameTime = 0.001f * (Real) smoothFrameTime(unsmoothedFrameTime);



From blakharaz at mail.berlios.de  Mon Sep 24 23:07:14 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Mon, 24 Sep 2007 23:07:14 +0200
Subject: [Dsa-hl-svn] r3875 - modules/aitest/dsa modules/aitest/maps
	modules/aitest/scripts modules/aitest/scripts/maps
	modules/regressiontest/maps modules/regressiontest/scripts
	modules/regressiontest/scripts/maps
	rl/trunk/engine/ai/include rl/trunk/engine/ai/src
	rl/trunk/engine/script/swig
Message-ID: <200709242107.l8OL7EIW032599@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-24 23:06:51 +0200 (Mon, 24 Sep 2007)
New Revision: 3875

Added:
   modules/aitest/maps/astargrid.wpg.xml
   modules/aitest/maps/graphtest.wpg.xml
   modules/aitest/scripts/AStarTest2.rb
   modules/regressiontest/maps/astargrid.wpg.xml
Modified:
   modules/aitest/dsa/gameobjectdefinitions.gof
   modules/aitest/scripts/DebugKeys.rb
   modules/aitest/scripts/maps/aitest.rb
   modules/regressiontest/scripts/SoundTest.rb
   modules/regressiontest/scripts/WalkJobTest.rb
   modules/regressiontest/scripts/maps/regressiontest.rb
   rl/trunk/engine/ai/include/AStar.h
   rl/trunk/engine/ai/include/CreatureWalkPathJob.h
   rl/trunk/engine/ai/include/LandmarkPath.h
   rl/trunk/engine/ai/src/AStar.cpp
   rl/trunk/engine/ai/src/CreatureWalkPathJob.cpp
   rl/trunk/engine/ai/src/LandmarkPath.cpp
   rl/trunk/engine/script/swig/RlAi.swig
   rl/trunk/engine/script/swig/RlRules.swig
Log:
* Changed WayPointGraph file format to XML
* Integrated A* algorithm into CreatureWalkPathJob
   + tests in regressiontest and aitest

Modified: modules/aitest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/aitest/dsa/gameobjectdefinitions.gof	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/aitest/dsa/gameobjectdefinitions.gof	2007-09-24 21:06:51 UTC (rev 3875)
@@ -1,25 +1,7 @@
 <?xml version="1.0" encoding="UTF-8" standalone="no" ?>
 <GameObjectDefinitions>
 
-    <gameobjectclass>
-        <property name="classid" type="STRING" data="Holzscheit"/>
-        <property name="baseclass" type="STRING" data="GameObject" />
-        <property name="description" type="STRING" data="Greater log of time check. (Very rare)"/>
-        <property name="meshfile" type="STRING" data="ver_holzscheit_01.mesh"/>
-    </gameobjectclass>
-
-    <gameobjectclass>
-        <property name="classid" type="STRING" data="apple"/>
-        <property name="baseclass" type="STRING" data="GameObject" />
-        <property name="description" type="STRING" data="Ein Apfel?"/>
-        <property name="meshfile" type="STRING" data="sphere.1m.mesh"/>
-        <property name="geometrytype" type="STRING" data="ellipsoid"/>
-        <property name="mass" type="REAL" data="65"/>
-    </gameobjectclass>
-
-    <gameobjectclass>
-        <property name="classid" type="STRING" data="TestPerson"/>
-        <property name="baseclass" type="STRING" data="NPC"/>
+    <gameobjectclass classid="TestPerson" baseclass="NPC">
         <property name="name" type="STRING" data="TestPerson"/>
         <property name="description" type="STRING" data="Wenn man mal jemanden zum Reden braucht..."/>
         <property name="geometrytype" type="STRING" data="capsule"/>
@@ -34,21 +16,31 @@
         </property>
     </gameobjectclass>
 
-    <gameobjectclass classid="TestPersonCapsule" baseclass="Create">
-        <property name="classid" type="STRING" data="TestPersonCapsule"/>
-        <property name="baseclass" type="STRING" data="Creature"/>
+    <gameobjectclass classid="TestWalkPerson" baseclass="Creature">
         <property name="name" type="STRING" data="TestPerson"/>
         <property name="description" type="STRING" data="Wenn man mal jemanden zum Reden braucht..."/>
-        <property name="geometrytype" type="STRING" data="capsule"/>
+        <property name="geometrytype" type="STRING" data="ellipsoid"/>
         <property name="meshfile" type="STRING" data="men_alrike.mesh"/>
         <property name="mass" type="REAL" data="65"/>
         <property name="dialogfile" type="STRING" data="testperson.xml"/>
-        <property name="ai" type="MAP">
-            <property name="behaviours" type="ARRAY">
-    	        <property type="STRING" data="DefaultWanderBehaviour"/>
-    	        <property type="STRING" data="AvoidObstaclesBehaviour"/>
-            </property>
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+            <property type="STRING" data="DialogBehaviour"/>
         </property>
+		<property name="eigenschaften" type="MAP">
+			<property name="MU" type="INT" data="12"/>
+			<property name="KL" type="INT" data="8"/>
+			<property name="IN" type="INT" data="9"/>
+			<property name="CH" type="INT" data="10"/>
+			<property name="FF" type="INT" data="11"/>
+			<property name="GE" type="INT" data="12"/>
+			<property name="KO" type="INT" data="13"/>
+			<property name="KK" type="INT" data="14"/>
+		</property>
+		<property name="talente" type="MAP">
+			<property name="Athletik" type="INT" data="3"/>
+<!--			<property name="K?rperbeherrschung" type="INT" data="3"/>-->
+		</property>
     </gameobjectclass>
 
   <gameobjectclass classid="Wolf" baseclass="Creature">
@@ -68,42 +60,4 @@
     </property>
   </gameobjectclass>
 
-    <gameobjectclass>
-        <property name="classid" type="STRING" data="switch3way"/>
-        <property name="baseclass" type="STRING" data="Switch3Way"/>
-        <property name="description" type="STRING" data="Ein Hebel"/>
-        <property name="meshfile" type="STRING" data="arc_hebel_01.mesh"/>
-        <property name="geometrytype" type="STRING" data="sphere"/>
-    </gameobjectclass>
-
-    <gameobjectclass>
-        <property name="classid" type="STRING" data="shortsword"/>
-        <property name="baseclass" type="STRING" data="Weapon" />
-        <property name="description" type="STRING" data="Ein ordin?res Kurzschwert - scharf, aber langweilig"/>
-        <property name="meshfile" type="STRING" data="waf_kurzschwert_01.mesh"/>
-    </gameobjectclass>
-
-    <gameobjectclass>
-        <property name="classid" type="STRING" data="leather backpack"/>
-        <property name="baseclass" type="STRING" data="Container"/> 
-        <property name="description" type="STRING" data="Ein Lederrucksack (oder so)"/>
-        <property name="meshfile" type="STRING" data="ins_rucksack.mesh"/>
-    </gameobjectclass>
-
-    <gameobjectclass>
-        <property name="classid" type="STRING" data="ErrorHandling"/>
-        <property name="baseclass" type="STRING" data="GameObject" />
-        <property name="description" type="STRING" data="The ErrorHandling TestCase"/>
-        <property name="meshfile" type="STRING" data="arc_hebel_01.mesh"/>
-    </gameobjectclass>
-
-    <!-- JobSequenceTest -->
-    <gameobjectclass>
-        <property name="classid" type="STRING" data="JobSequenceTestChest"/>
-        <property name="baseclass" type="STRING" data="GameObject" />
-        <property name="description" type="STRING" data="Eine Truhe zum Test der JobSequence"/>
-        <property name="meshfile" type="STRING" data="ver_truhe_gross01.mesh"/>
-        <property name="geometrytype" type="STRING" data="box"/>
-    </gameobjectclass>
-
 </GameObjectDefinitions>

Added: modules/aitest/maps/astargrid.wpg.xml
===================================================================
--- modules/aitest/maps/astargrid.wpg.xml	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/aitest/maps/astargrid.wpg.xml	2007-09-24 21:06:51 UTC (rev 3875)
@@ -0,0 +1,1736 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<waypointgraph>
+  <waypointnodes>
+    <node id="0" type="ext" x="-9" y="0.0" z="-9"/>
+    <node id="1" type="ext" x="-9" y="0.0" z="-8"/>
+    <node id="2" type="ext" x="-9" y="0.0" z="-7"/>
+    <node id="3" type="ext" x="-9" y="0.0" z="-6"/>
+    <node id="4" type="ext" x="-9" y="0.0" z="-5"/>
+    <node id="5" type="ext" x="-9" y="0.0" z="-4"/>
+    <node id="6" type="ext" x="-9" y="0.0" z="-3"/>
+    <node id="7" type="ext" x="-9" y="0.0" z="-2"/>
+    <node id="8" type="ext" x="-9" y="0.0" z="-1"/>
+    <node id="9" type="ext" x="-9" y="0.0" z="0"/>
+    <node id="10" type="ext" x="-9" y="0.0" z="1"/>
+    <node id="11" type="ext" x="-9" y="0.0" z="2"/>
+    <node id="12" type="ext" x="-9" y="0.0" z="3"/>
+    <node id="13" type="ext" x="-9" y="0.0" z="4"/>
+    <node id="14" type="ext" x="-9" y="0.0" z="5"/>
+    <node id="15" type="ext" x="-9" y="0.0" z="6"/>
+    <node id="16" type="ext" x="-9" y="0.0" z="7"/>
+    <node id="17" type="ext" x="-9" y="0.0" z="8"/>
+    <node id="18" type="ext" x="-9" y="0.0" z="9"/>
+    <node id="19" type="ext" x="-8" y="0.0" z="-9"/>
+    <node id="20" type="ext" x="-8" y="0.0" z="-8"/>
+    <node id="21" type="ext" x="-8" y="0.0" z="-7"/>
+    <node id="22" type="ext" x="-8" y="0.0" z="-6"/>
+    <node id="23" type="ext" x="-8" y="0.0" z="-5"/>
+    <node id="24" type="ext" x="-8" y="0.0" z="-4"/>
+    <node id="25" type="ext" x="-8" y="0.0" z="-3"/>
+    <node id="26" type="ext" x="-8" y="0.0" z="-2"/>
+    <node id="27" type="ext" x="-8" y="0.0" z="-1"/>
+    <node id="28" type="ext" x="-8" y="0.0" z="0"/>
+    <node id="29" type="ext" x="-8" y="0.0" z="1"/>
+    <node id="30" type="ext" x="-8" y="0.0" z="2"/>
+    <node id="31" type="ext" x="-8" y="0.0" z="3"/>
+    <node id="32" type="ext" x="-8" y="0.0" z="4"/>
+    <node id="33" type="ext" x="-8" y="0.0" z="5"/>
+    <node id="34" type="ext" x="-8" y="0.0" z="6"/>
+    <node id="35" type="ext" x="-8" y="0.0" z="7"/>
+    <node id="36" type="ext" x="-8" y="0.0" z="8"/>
+    <node id="37" type="ext" x="-8" y="0.0" z="9"/>
+    <node id="38" type="ext" x="-7" y="0.0" z="-9"/>
+    <node id="39" type="ext" x="-7" y="0.0" z="-8"/>
+    <node id="40" type="ext" x="-7" y="0.0" z="-7"/>
+    <node id="41" type="ext" x="-7" y="0.0" z="-6"/>
+    <node id="42" type="ext" x="-7" y="0.0" z="-5"/>
+    <node id="43" type="ext" x="-7" y="0.0" z="-4"/>
+    <node id="44" type="ext" x="-7" y="0.0" z="-3"/>
+    <node id="45" type="ext" x="-7" y="0.0" z="-2"/>
+    <node id="46" type="ext" x="-7" y="0.0" z="-1"/>
+    <node id="47" type="ext" x="-7" y="0.0" z="0"/>
+    <node id="48" type="ext" x="-7" y="0.0" z="1"/>
+    <node id="49" type="ext" x="-7" y="0.0" z="2"/>
+    <node id="50" type="ext" x="-7" y="0.0" z="3"/>
+    <node id="51" type="ext" x="-7" y="0.0" z="4"/>
+    <node id="52" type="ext" x="-7" y="0.0" z="5"/>
+    <node id="53" type="ext" x="-7" y="0.0" z="6"/>
+    <node id="54" type="ext" x="-7" y="0.0" z="7"/>
+    <node id="55" type="ext" x="-7" y="0.0" z="8"/>
+    <node id="56" type="ext" x="-7" y="0.0" z="9"/>
+    <node id="57" type="ext" x="-6" y="0.0" z="-9"/>
+    <node id="58" type="ext" x="-6" y="0.0" z="-8"/>
+    <node id="59" type="ext" x="-6" y="0.0" z="-7"/>
+    <node id="60" type="ext" x="-6" y="0.0" z="-6"/>
+    <node id="61" type="ext" x="-6" y="0.0" z="-5"/>
+    <node id="62" type="ext" x="-6" y="0.0" z="-4"/>
+    <node id="63" type="ext" x="-6" y="0.0" z="-3"/>
+    <node id="64" type="ext" x="-6" y="0.0" z="-2"/>
+    <node id="65" type="ext" x="-6" y="0.0" z="-1"/>
+    <node id="66" type="ext" x="-6" y="0.0" z="0"/>
+    <node id="67" type="ext" x="-6" y="0.0" z="1"/>
+    <node id="68" type="ext" x="-6" y="0.0" z="2"/>
+    <node id="69" type="ext" x="-6" y="0.0" z="3"/>
+    <node id="70" type="ext" x="-6" y="0.0" z="4"/>
+    <node id="71" type="ext" x="-6" y="0.0" z="5"/>
+    <node id="72" type="ext" x="-6" y="0.0" z="6"/>
+    <node id="73" type="ext" x="-6" y="0.0" z="7"/>
+    <node id="74" type="ext" x="-6" y="0.0" z="8"/>
+    <node id="75" type="ext" x="-6" y="0.0" z="9"/>
+    <node id="76" type="ext" x="-5" y="0.0" z="-9"/>
+    <node id="77" type="ext" x="-5" y="0.0" z="-8"/>
+    <node id="78" type="ext" x="-5" y="0.0" z="-7"/>
+    <node id="79" type="ext" x="-5" y="0.0" z="-6"/>
+    <node id="80" type="ext" x="-5" y="0.0" z="-5"/>
+    <node id="81" type="ext" x="-5" y="0.0" z="-4"/>
+    <node id="82" type="ext" x="-5" y="0.0" z="-3"/>
+    <node id="83" type="ext" x="-5" y="0.0" z="-2"/>
+    <node id="84" type="ext" x="-5" y="0.0" z="-1"/>
+    <node id="85" type="ext" x="-5" y="0.0" z="0"/>
+    <node id="86" type="ext" x="-5" y="0.0" z="1"/>
+    <node id="87" type="ext" x="-5" y="0.0" z="2"/>
+    <node id="88" type="ext" x="-5" y="0.0" z="3"/>
+    <node id="89" type="ext" x="-5" y="0.0" z="4"/>
+    <node id="90" type="ext" x="-5" y="0.0" z="5"/>
+    <node id="91" type="ext" x="-5" y="0.0" z="6"/>
+    <node id="92" type="ext" x="-5" y="0.0" z="7"/>
+    <node id="93" type="ext" x="-5" y="0.0" z="8"/>
+    <node id="94" type="ext" x="-5" y="0.0" z="9"/>
+    <node id="95" type="ext" x="-4" y="0.0" z="-9"/>
+    <node id="96" type="ext" x="-4" y="0.0" z="-8"/>
+    <node id="97" type="ext" x="-4" y="0.0" z="-7"/>
+    <node id="98" type="ext" x="-4" y="0.0" z="-6"/>
+    <node id="99" type="ext" x="-4" y="0.0" z="-5"/>
+    <node id="100" type="ext" x="-4" y="0.0" z="-4"/>
+    <node id="101" type="ext" x="-4" y="0.0" z="-3"/>
+    <node id="102" type="ext" x="-4" y="0.0" z="-2"/>
+    <node id="103" type="ext" x="-4" y="0.0" z="-1"/>
+    <node id="104" type="ext" x="-4" y="0.0" z="0"/>
+    <node id="105" type="ext" x="-4" y="0.0" z="1"/>
+    <node id="106" type="ext" x="-4" y="0.0" z="2"/>
+    <node id="107" type="ext" x="-4" y="0.0" z="3"/>
+    <node id="108" type="ext" x="-4" y="0.0" z="4"/>
+    <node id="109" type="ext" x="-4" y="0.0" z="5"/>
+    <node id="110" type="ext" x="-4" y="0.0" z="6"/>
+    <node id="111" type="ext" x="-4" y="0.0" z="7"/>
+    <node id="112" type="ext" x="-4" y="0.0" z="8"/>
+    <node id="113" type="ext" x="-4" y="0.0" z="9"/>
+    <node id="114" type="ext" x="-3" y="0.0" z="-9"/>
+    <node id="115" type="ext" x="-3" y="0.0" z="-8"/>
+    <node id="116" type="ext" x="-3" y="0.0" z="-7"/>
+    <node id="117" type="ext" x="-3" y="0.0" z="-6"/>
+    <node id="118" type="ext" x="-3" y="0.0" z="-5"/>
+    <node id="119" type="ext" x="-3" y="0.0" z="-4"/>
+    <node id="120" type="ext" x="-3" y="0.0" z="-3"/>
+    <node id="121" type="ext" x="-3" y="0.0" z="-2"/>
+    <node id="122" type="ext" x="-3" y="0.0" z="-1"/>
+    <node id="123" type="ext" x="-3" y="0.0" z="0"/>
+    <node id="124" type="ext" x="-3" y="0.0" z="1"/>
+    <node id="125" type="ext" x="-3" y="0.0" z="2"/>
+    <node id="126" type="ext" x="-3" y="0.0" z="3"/>
+    <node id="127" type="ext" x="-3" y="0.0" z="4"/>
+    <node id="128" type="ext" x="-3" y="0.0" z="5"/>
+    <node id="129" type="ext" x="-3" y="0.0" z="6"/>
+    <node id="130" type="ext" x="-3" y="0.0" z="7"/>
+    <node id="131" type="ext" x="-3" y="0.0" z="8"/>
+    <node id="132" type="ext" x="-3" y="0.0" z="9"/>
+    <node id="133" type="ext" x="-2" y="0.0" z="-9"/>
+    <node id="134" type="ext" x="-2" y="0.0" z="-8"/>
+    <node id="135" type="ext" x="-2" y="0.0" z="-7"/>
+    <node id="136" type="ext" x="-2" y="0.0" z="-6"/>
+    <node id="137" type="ext" x="-2" y="0.0" z="-5"/>
+    <node id="138" type="ext" x="-2" y="0.0" z="-4"/>
+    <node id="139" type="ext" x="-2" y="0.0" z="-3"/>
+    <node id="140" type="ext" x="-2" y="0.0" z="-2"/>
+    <node id="141" type="ext" x="-2" y="0.0" z="-1"/>
+    <node id="142" type="ext" x="-2" y="0.0" z="0"/>
+    <node id="143" type="ext" x="-2" y="0.0" z="1"/>
+    <node id="144" type="ext" x="-2" y="0.0" z="2"/>
+    <node id="145" type="ext" x="-2" y="0.0" z="3"/>
+    <node id="146" type="ext" x="-2" y="0.0" z="4"/>
+    <node id="147" type="ext" x="-2" y="0.0" z="5"/>
+    <node id="148" type="ext" x="-2" y="0.0" z="6"/>
+    <node id="149" type="ext" x="-2" y="0.0" z="7"/>
+    <node id="150" type="ext" x="-2" y="0.0" z="8"/>
+    <node id="151" type="ext" x="-2" y="0.0" z="9"/>
+    <node id="152" type="ext" x="-1" y="0.0" z="-9"/>
+    <node id="153" type="ext" x="-1" y="0.0" z="-8"/>
+    <node id="154" type="ext" x="-1" y="0.0" z="-7"/>
+    <node id="155" type="ext" x="-1" y="0.0" z="-6"/>
+    <node id="156" type="ext" x="-1" y="0.0" z="-5"/>
+    <node id="157" type="ext" x="-1" y="0.0" z="-4"/>
+    <node id="158" type="ext" x="-1" y="0.0" z="-3"/>
+    <node id="159" type="ext" x="-1" y="0.0" z="-2"/>
+    <node id="160" type="ext" x="-1" y="0.0" z="-1"/>
+    <node id="161" type="ext" x="-1" y="0.0" z="0"/>
+    <node id="162" type="ext" x="-1" y="0.0" z="1"/>
+    <node id="163" type="ext" x="-1" y="0.0" z="2"/>
+    <node id="164" type="ext" x="-1" y="0.0" z="3"/>
+    <node id="165" type="ext" x="-1" y="0.0" z="4"/>
+    <node id="166" type="ext" x="-1" y="0.0" z="5"/>
+    <node id="167" type="ext" x="-1" y="0.0" z="6"/>
+    <node id="168" type="ext" x="-1" y="0.0" z="7"/>
+    <node id="169" type="ext" x="-1" y="0.0" z="8"/>
+    <node id="170" type="ext" x="-1" y="0.0" z="9"/>
+    <node id="171" type="ext" x="0" y="0.0" z="-9"/>
+    <node id="172" type="ext" x="0" y="0.0" z="-8"/>
+    <node id="173" type="ext" x="0" y="0.0" z="-7"/>
+    <node id="174" type="ext" x="0" y="0.0" z="-6"/>
+    <node id="175" type="ext" x="0" y="0.0" z="-5"/>
+    <node id="176" type="ext" x="0" y="0.0" z="-4"/>
+    <node id="177" type="ext" x="0" y="0.0" z="-3"/>
+    <node id="178" type="ext" x="0" y="0.0" z="-2"/>
+    <node id="179" type="ext" x="0" y="0.0" z="-1"/>
+    <node id="180" type="ext" x="0" y="0.0" z="0"/>
+    <node id="181" type="ext" x="0" y="0.0" z="1"/>
+    <node id="182" type="ext" x="0" y="0.0" z="2"/>
+    <node id="183" type="ext" x="0" y="0.0" z="3"/>
+    <node id="184" type="ext" x="0" y="0.0" z="4"/>
+    <node id="185" type="ext" x="0" y="0.0" z="5"/>
+    <node id="186" type="ext" x="0" y="0.0" z="6"/>
+    <node id="187" type="ext" x="0" y="0.0" z="7"/>
+    <node id="188" type="ext" x="0" y="0.0" z="8"/>
+    <node id="189" type="ext" x="0" y="0.0" z="9"/>
+    <node id="190" type="ext" x="1" y="0.0" z="-9"/>
+    <node id="191" type="ext" x="1" y="0.0" z="-8"/>
+    <node id="192" type="ext" x="1" y="0.0" z="-7"/>
+    <node id="193" type="ext" x="1" y="0.0" z="-6"/>
+    <node id="194" type="ext" x="1" y="0.0" z="-5"/>
+    <node id="195" type="ext" x="1" y="0.0" z="-4"/>
+    <node id="196" type="ext" x="1" y="0.0" z="-3"/>
+    <node id="197" type="ext" x="1" y="0.0" z="-2"/>
+    <node id="198" type="ext" x="1" y="0.0" z="-1"/>
+    <node id="199" type="ext" x="1" y="0.0" z="0"/>
+    <node id="200" type="ext" x="1" y="0.0" z="1"/>
+    <node id="201" type="ext" x="1" y="0.0" z="2"/>
+    <node id="202" type="ext" x="1" y="0.0" z="3"/>
+    <node id="203" type="ext" x="1" y="0.0" z="4"/>
+    <node id="204" type="ext" x="1" y="0.0" z="5"/>
+    <node id="205" type="ext" x="1" y="0.0" z="6"/>
+    <node id="206" type="ext" x="1" y="0.0" z="7"/>
+    <node id="207" type="ext" x="1" y="0.0" z="8"/>
+    <node id="208" type="ext" x="1" y="0.0" z="9"/>
+    <node id="209" type="ext" x="2" y="0.0" z="-9"/>
+    <node id="210" type="ext" x="2" y="0.0" z="-8"/>
+    <node id="211" type="ext" x="2" y="0.0" z="-7"/>
+    <node id="212" type="ext" x="2" y="0.0" z="-6"/>
+    <node id="213" type="ext" x="2" y="0.0" z="-5"/>
+    <node id="214" type="ext" x="2" y="0.0" z="-4"/>
+    <node id="215" type="ext" x="2" y="0.0" z="-3"/>
+    <node id="216" type="ext" x="2" y="0.0" z="-2"/>
+    <node id="217" type="ext" x="2" y="0.0" z="-1"/>
+    <node id="218" type="ext" x="2" y="0.0" z="0"/>
+    <node id="219" type="ext" x="2" y="0.0" z="1"/>
+    <node id="220" type="ext" x="2" y="0.0" z="2"/>
+    <node id="221" type="ext" x="2" y="0.0" z="3"/>
+    <node id="222" type="ext" x="2" y="0.0" z="4"/>
+    <node id="223" type="ext" x="2" y="0.0" z="5"/>
+    <node id="224" type="ext" x="2" y="0.0" z="6"/>
+    <node id="225" type="ext" x="2" y="0.0" z="7"/>
+    <node id="226" type="ext" x="2" y="0.0" z="8"/>
+    <node id="227" type="ext" x="2" y="0.0" z="9"/>
+    <node id="228" type="ext" x="3" y="0.0" z="-9"/>
+    <node id="229" type="ext" x="3" y="0.0" z="-8"/>
+    <node id="230" type="ext" x="3" y="0.0" z="-7"/>
+    <node id="231" type="ext" x="3" y="0.0" z="-6"/>
+    <node id="232" type="ext" x="3" y="0.0" z="-5"/>
+    <node id="233" type="ext" x="3" y="0.0" z="-4"/>
+    <node id="234" type="ext" x="3" y="0.0" z="-3"/>
+    <node id="235" type="ext" x="3" y="0.0" z="-2"/>
+    <node id="236" type="ext" x="3" y="0.0" z="-1"/>
+    <node id="237" type="ext" x="3" y="0.0" z="0"/>
+    <node id="238" type="ext" x="3" y="0.0" z="1"/>
+    <node id="239" type="ext" x="3" y="0.0" z="2"/>
+    <node id="240" type="ext" x="3" y="0.0" z="3"/>
+    <node id="241" type="ext" x="3" y="0.0" z="4"/>
+    <node id="242" type="ext" x="3" y="0.0" z="5"/>
+    <node id="243" type="ext" x="3" y="0.0" z="6"/>
+    <node id="244" type="ext" x="3" y="0.0" z="7"/>
+    <node id="245" type="ext" x="3" y="0.0" z="8"/>
+    <node id="246" type="ext" x="3" y="0.0" z="9"/>
+    <node id="247" type="ext" x="4" y="0.0" z="-9"/>
+    <node id="248" type="ext" x="4" y="0.0" z="-8"/>
+    <node id="249" type="ext" x="4" y="0.0" z="-7"/>
+    <node id="250" type="ext" x="4" y="0.0" z="-6"/>
+    <node id="251" type="ext" x="4" y="0.0" z="-5"/>
+    <node id="252" type="ext" x="4" y="0.0" z="-4"/>
+    <node id="253" type="ext" x="4" y="0.0" z="-3"/>
+    <node id="254" type="ext" x="4" y="0.0" z="-2"/>
+    <node id="255" type="ext" x="4" y="0.0" z="-1"/>
+    <node id="256" type="ext" x="4" y="0.0" z="0"/>
+    <node id="257" type="ext" x="4" y="0.0" z="1"/>
+    <node id="258" type="ext" x="4" y="0.0" z="2"/>
+    <node id="259" type="ext" x="4" y="0.0" z="3"/>
+    <node id="260" type="ext" x="4" y="0.0" z="4"/>
+    <node id="261" type="ext" x="4" y="0.0" z="5"/>
+    <node id="262" type="ext" x="4" y="0.0" z="6"/>
+    <node id="263" type="ext" x="4" y="0.0" z="7"/>
+    <node id="264" type="ext" x="4" y="0.0" z="8"/>
+    <node id="265" type="ext" x="4" y="0.0" z="9"/>
+    <node id="266" type="ext" x="5" y="0.0" z="-9"/>
+    <node id="267" type="ext" x="5" y="0.0" z="-8"/>
+    <node id="268" type="ext" x="5" y="0.0" z="-7"/>
+    <node id="269" type="ext" x="5" y="0.0" z="-6"/>
+    <node id="270" type="ext" x="5" y="0.0" z="-5"/>
+    <node id="271" type="ext" x="5" y="0.0" z="-4"/>
+    <node id="272" type="ext" x="5" y="0.0" z="-3"/>
+    <node id="273" type="ext" x="5" y="0.0" z="-2"/>
+    <node id="274" type="ext" x="5" y="0.0" z="-1"/>
+    <node id="275" type="ext" x="5" y="0.0" z="0"/>
+    <node id="276" type="ext" x="5" y="0.0" z="1"/>
+    <node id="277" type="ext" x="5" y="0.0" z="2"/>
+    <node id="278" type="ext" x="5" y="0.0" z="3"/>
+    <node id="279" type="ext" x="5" y="0.0" z="4"/>
+    <node id="280" type="ext" x="5" y="0.0" z="5"/>
+    <node id="281" type="ext" x="5" y="0.0" z="6"/>
+    <node id="282" type="ext" x="5" y="0.0" z="7"/>
+    <node id="283" type="ext" x="5" y="0.0" z="8"/>
+    <node id="284" type="ext" x="5" y="0.0" z="9"/>
+    <node id="285" type="ext" x="6" y="0.0" z="-9"/>
+    <node id="286" type="ext" x="6" y="0.0" z="-8"/>
+    <node id="287" type="ext" x="6" y="0.0" z="-7"/>
+    <node id="288" type="ext" x="6" y="0.0" z="-6"/>
+    <node id="289" type="ext" x="6" y="0.0" z="-5"/>
+    <node id="290" type="ext" x="6" y="0.0" z="-4"/>
+    <node id="291" type="ext" x="6" y="0.0" z="-3"/>
+    <node id="292" type="ext" x="6" y="0.0" z="-2"/>
+    <node id="293" type="ext" x="6" y="0.0" z="-1"/>
+    <node id="294" type="ext" x="6" y="0.0" z="0"/>
+    <node id="295" type="ext" x="6" y="0.0" z="1"/>
+    <node id="296" type="ext" x="6" y="0.0" z="2"/>
+    <node id="297" type="ext" x="6" y="0.0" z="3"/>
+    <node id="298" type="ext" x="6" y="0.0" z="4"/>
+    <node id="299" type="ext" x="6" y="0.0" z="5"/>
+    <node id="300" type="ext" x="6" y="0.0" z="6"/>
+    <node id="301" type="ext" x="6" y="0.0" z="7"/>
+    <node id="302" type="ext" x="6" y="0.0" z="8"/>
+    <node id="303" type="ext" x="6" y="0.0" z="9"/>
+    <node id="304" type="ext" x="7" y="0.0" z="-9"/>
+    <node id="305" type="ext" x="7" y="0.0" z="-8"/>
+    <node id="306" type="ext" x="7" y="0.0" z="-7"/>
+    <node id="307" type="ext" x="7" y="0.0" z="-6"/>
+    <node id="308" type="ext" x="7" y="0.0" z="-5"/>
+    <node id="309" type="ext" x="7" y="0.0" z="-4"/>
+    <node id="310" type="ext" x="7" y="0.0" z="-3"/>
+    <node id="311" type="ext" x="7" y="0.0" z="-2"/>
+    <node id="312" type="ext" x="7" y="0.0" z="-1"/>
+    <node id="313" type="ext" x="7" y="0.0" z="0"/>
+    <node id="314" type="ext" x="7" y="0.0" z="1"/>
+    <node id="315" type="ext" x="7" y="0.0" z="2"/>
+    <node id="316" type="ext" x="7" y="0.0" z="3"/>
+    <node id="317" type="ext" x="7" y="0.0" z="4"/>
+    <node id="318" type="ext" x="7" y="0.0" z="5"/>
+    <node id="319" type="ext" x="7" y="0.0" z="6"/>
+    <node id="320" type="ext" x="7" y="0.0" z="7"/>
+    <node id="321" type="ext" x="7" y="0.0" z="8"/>
+    <node id="322" type="ext" x="7" y="0.0" z="9"/>
+    <node id="323" type="ext" x="8" y="0.0" z="-9"/>
+    <node id="324" type="ext" x="8" y="0.0" z="-8"/>
+    <node id="325" type="ext" x="8" y="0.0" z="-7"/>
+    <node id="326" type="ext" x="8" y="0.0" z="-6"/>
+    <node id="327" type="ext" x="8" y="0.0" z="-5"/>
+    <node id="328" type="ext" x="8" y="0.0" z="-4"/>
+    <node id="329" type="ext" x="8" y="0.0" z="-3"/>
+    <node id="330" type="ext" x="8" y="0.0" z="-2"/>
+    <node id="331" type="ext" x="8" y="0.0" z="-1"/>
+    <node id="332" type="ext" x="8" y="0.0" z="0"/>
+    <node id="333" type="ext" x="8" y="0.0" z="1"/>
+    <node id="334" type="ext" x="8" y="0.0" z="2"/>
+    <node id="335" type="ext" x="8" y="0.0" z="3"/>
+    <node id="336" type="ext" x="8" y="0.0" z="4"/>
+    <node id="337" type="ext" x="8" y="0.0" z="5"/>
+    <node id="338" type="ext" x="8" y="0.0" z="6"/>
+    <node id="339" type="ext" x="8" y="0.0" z="7"/>
+    <node id="340" type="ext" x="8" y="0.0" z="8"/>
+    <node id="341" type="ext" x="8" y="0.0" z="9"/>
+    <node id="342" type="ext" x="9" y="0.0" z="-9"/>
+    <node id="343" type="ext" x="9" y="0.0" z="-8"/>
+    <node id="344" type="ext" x="9" y="0.0" z="-7"/>
+    <node id="345" type="ext" x="9" y="0.0" z="-6"/>
+    <node id="346" type="ext" x="9" y="0.0" z="-5"/>
+    <node id="347" type="ext" x="9" y="0.0" z="-4"/>
+    <node id="348" type="ext" x="9" y="0.0" z="-3"/>
+    <node id="349" type="ext" x="9" y="0.0" z="-2"/>
+    <node id="350" type="ext" x="9" y="0.0" z="-1"/>
+    <node id="351" type="ext" x="9" y="0.0" z="0"/>
+    <node id="352" type="ext" x="9" y="0.0" z="1"/>
+    <node id="353" type="ext" x="9" y="0.0" z="2"/>
+    <node id="354" type="ext" x="9" y="0.0" z="3"/>
+    <node id="355" type="ext" x="9" y="0.0" z="4"/>
+    <node id="356" type="ext" x="9" y="0.0" z="5"/>
+    <node id="357" type="ext" x="9" y="0.0" z="6"/>
+    <node id="358" type="ext" x="9" y="0.0" z="7"/>
+    <node id="359" type="ext" x="9" y="0.0" z="8"/>
+    <node id="360" type="ext" x="9" y="0.0" z="9"/>
+  </waypointnodes>
+  <waypointedges>
+    <edge source="0" destination="1"/>
+    <edge source="0" destination="19"/>
+    <edge source="1" destination="0"/>
+    <edge source="1" destination="2"/>
+    <edge source="1" destination="20"/>
+    <edge source="2" destination="1"/>
+    <edge source="2" destination="3"/>
+    <edge source="2" destination="21"/>
+    <edge source="3" destination="2"/>
+    <edge source="3" destination="4"/>
+    <edge source="3" destination="22"/>
+    <edge source="4" destination="3"/>
+    <edge source="4" destination="5"/>
+    <edge source="4" destination="23"/>
+    <edge source="5" destination="4"/>
+    <edge source="5" destination="6"/>
+    <edge source="5" destination="24"/>
+    <edge source="6" destination="5"/>
+    <edge source="6" destination="7"/>
+    <edge source="6" destination="25"/>
+    <edge source="7" destination="6"/>
+    <edge source="7" destination="8"/>
+    <edge source="7" destination="26"/>
+    <edge source="8" destination="7"/>
+    <edge source="8" destination="9"/>
+    <edge source="8" destination="27"/>
+    <edge source="9" destination="8"/>
+    <edge source="9" destination="10"/>
+    <edge source="9" destination="28"/>
+    <edge source="10" destination="9"/>
+    <edge source="10" destination="11"/>
+    <edge source="10" destination="29"/>
+    <edge source="11" destination="10"/>
+    <edge source="11" destination="12"/>
+    <edge source="11" destination="30"/>
+    <edge source="12" destination="11"/>
+    <edge source="12" destination="13"/>
+    <edge source="12" destination="31"/>
+    <edge source="13" destination="12"/>
+    <edge source="13" destination="14"/>
+    <edge source="13" destination="32"/>
+    <edge source="14" destination="13"/>
+    <edge source="14" destination="15"/>
+    <edge source="14" destination="33"/>
+    <edge source="15" destination="14"/>
+    <edge source="15" destination="16"/>
+    <edge source="15" destination="34"/>
+    <edge source="16" destination="15"/>
+    <edge source="16" destination="17"/>
+    <edge source="16" destination="35"/>
+    <edge source="17" destination="16"/>
+    <edge source="17" destination="18"/>
+    <edge source="17" destination="36"/>
+    <edge source="18" destination="17"/>
+    <edge source="18" destination="37"/>
+    <edge source="19" destination="20"/>
+    <edge source="19" destination="0"/>
+    <edge source="19" destination="38"/>
+    <edge source="20" destination="19"/>
+    <edge source="20" destination="21"/>
+    <edge source="20" destination="1"/>
+    <edge source="20" destination="39"/>
+    <edge source="21" destination="20"/>
+    <edge source="21" destination="22"/>
+    <edge source="21" destination="2"/>
+    <edge source="21" destination="40"/>
+    <edge source="22" destination="21"/>
+    <edge source="22" destination="23"/>
+    <edge source="22" destination="3"/>
+    <edge source="22" destination="41"/>
+    <edge source="23" destination="22"/>
+    <edge source="23" destination="24"/>
+    <edge source="23" destination="4"/>
+    <edge source="23" destination="42"/>
+    <edge source="24" destination="23"/>
+    <edge source="24" destination="25"/>
+    <edge source="24" destination="5"/>
+    <edge source="24" destination="43"/>
+    <edge source="25" destination="24"/>
+    <edge source="25" destination="26"/>
+    <edge source="25" destination="6"/>
+    <edge source="25" destination="44"/>
+    <edge source="26" destination="25"/>
+    <edge source="26" destination="27"/>
+    <edge source="26" destination="7"/>
+    <edge source="26" destination="45"/>
+    <edge source="27" destination="26"/>
+    <edge source="27" destination="28"/>
+    <edge source="27" destination="8"/>
+    <edge source="27" destination="46"/>
+    <edge source="28" destination="27"/>
+    <edge source="28" destination="29"/>
+    <edge source="28" destination="9"/>
+    <edge source="28" destination="47"/>
+    <edge source="29" destination="28"/>
+    <edge source="29" destination="30"/>
+    <edge source="29" destination="10"/>
+    <edge source="29" destination="48"/>
+    <edge source="30" destination="29"/>
+    <edge source="30" destination="31"/>
+    <edge source="30" destination="11"/>
+    <edge source="30" destination="49"/>
+    <edge source="31" destination="30"/>
+    <edge source="31" destination="32"/>
+    <edge source="31" destination="12"/>
+    <edge source="31" destination="50"/>
+    <edge source="32" destination="31"/>
+    <edge source="32" destination="33"/>
+    <edge source="32" destination="13"/>
+    <edge source="32" destination="51"/>
+    <edge source="33" destination="32"/>
+    <edge source="33" destination="34"/>
+    <edge source="33" destination="14"/>
+    <edge source="33" destination="52"/>
+    <edge source="34" destination="33"/>
+    <edge source="34" destination="35"/>
+    <edge source="34" destination="15"/>
+    <edge source="34" destination="53"/>
+    <edge source="35" destination="34"/>
+    <edge source="35" destination="36"/>
+    <edge source="35" destination="16"/>
+    <edge source="35" destination="54"/>
+    <edge source="36" destination="35"/>
+    <edge source="36" destination="37"/>
+    <edge source="36" destination="17"/>
+    <edge source="36" destination="55"/>
+    <edge source="37" destination="36"/>
+    <edge source="37" destination="18"/>
+    <edge source="37" destination="56"/>
+    <edge source="38" destination="39"/>
+    <edge source="38" destination="19"/>
+    <edge source="38" destination="57"/>
+    <edge source="39" destination="38"/>
+    <edge source="39" destination="40"/>
+    <edge source="39" destination="20"/>
+    <edge source="39" destination="58"/>
+    <edge source="40" destination="39"/>
+    <edge source="40" destination="41"/>
+    <edge source="40" destination="21"/>
+    <edge source="40" destination="59"/>
+    <edge source="41" destination="40"/>
+    <edge source="41" destination="42"/>
+    <edge source="41" destination="22"/>
+    <edge source="41" destination="60"/>
+    <edge source="42" destination="41"/>
+    <edge source="42" destination="43"/>
+    <edge source="42" destination="23"/>
+    <edge source="42" destination="61"/>
+    <edge source="43" destination="42"/>
+    <edge source="43" destination="44"/>
+    <edge source="43" destination="24"/>
+    <edge source="43" destination="62"/>
+    <edge source="44" destination="43"/>
+    <edge source="44" destination="45"/>
+    <edge source="44" destination="25"/>
+    <edge source="44" destination="63"/>
+    <edge source="45" destination="44"/>
+    <edge source="45" destination="46"/>
+    <edge source="45" destination="26"/>
+    <edge source="45" destination="64"/>
+    <edge source="46" destination="45"/>
+    <edge source="46" destination="47"/>
+    <edge source="46" destination="27"/>
+    <edge source="46" destination="65"/>
+    <edge source="47" destination="46"/>
+    <edge source="47" destination="48"/>
+    <edge source="47" destination="28"/>
+    <edge source="47" destination="66"/>
+    <edge source="48" destination="47"/>
+    <edge source="48" destination="49"/>
+    <edge source="48" destination="29"/>
+    <edge source="48" destination="67"/>
+    <edge source="49" destination="48"/>
+    <edge source="49" destination="50"/>
+    <edge source="49" destination="30"/>
+    <edge source="49" destination="68"/>
+    <edge source="50" destination="49"/>
+    <edge source="50" destination="51"/>
+    <edge source="50" destination="31"/>
+    <edge source="50" destination="69"/>
+    <edge source="51" destination="50"/>
+    <edge source="51" destination="52"/>
+    <edge source="51" destination="32"/>
+    <edge source="51" destination="70"/>
+    <edge source="52" destination="51"/>
+    <edge source="52" destination="53"/>
+    <edge source="52" destination="33"/>
+    <edge source="52" destination="71"/>
+    <edge source="53" destination="52"/>
+    <edge source="53" destination="54"/>
+    <edge source="53" destination="34"/>
+    <edge source="53" destination="72"/>
+    <edge source="54" destination="53"/>
+    <edge source="54" destination="55"/>
+    <edge source="54" destination="35"/>
+    <edge source="54" destination="73"/>
+    <edge source="55" destination="54"/>
+    <edge source="55" destination="56"/>
+    <edge source="55" destination="36"/>
+    <edge source="55" destination="74"/>
+    <edge source="56" destination="55"/>
+    <edge source="56" destination="37"/>
+    <edge source="56" destination="75"/>
+    <edge source="57" destination="58"/>
+    <edge source="57" destination="38"/>
+    <edge source="57" destination="76"/>
+    <edge source="58" destination="57"/>
+    <edge source="58" destination="59"/>
+    <edge source="58" destination="39"/>
+    <edge source="58" destination="77"/>
+    <edge source="59" destination="58"/>
+    <edge source="59" destination="60"/>
+    <edge source="59" destination="40"/>
+    <edge source="59" destination="78"/>
+    <edge source="60" destination="59"/>
+    <edge source="60" destination="61"/>
+    <edge source="60" destination="41"/>
+    <edge source="60" destination="79"/>
+    <edge source="61" destination="60"/>
+    <edge source="61" destination="62"/>
+    <edge source="61" destination="42"/>
+    <edge source="61" destination="80"/>
+    <edge source="62" destination="61"/>
+    <edge source="62" destination="63"/>
+    <edge source="62" destination="43"/>
+    <edge source="62" destination="81"/>
+    <edge source="63" destination="62"/>
+    <edge source="63" destination="64"/>
+    <edge source="63" destination="44"/>
+    <edge source="63" destination="82"/>
+    <edge source="64" destination="63"/>
+    <edge source="64" destination="65"/>
+    <edge source="64" destination="45"/>
+    <edge source="64" destination="83"/>
+    <edge source="65" destination="64"/>
+    <edge source="65" destination="66"/>
+    <edge source="65" destination="46"/>
+    <edge source="65" destination="84"/>
+    <edge source="66" destination="65"/>
+    <edge source="66" destination="67"/>
+    <edge source="66" destination="47"/>
+    <edge source="66" destination="85"/>
+    <edge source="67" destination="66"/>
+    <edge source="67" destination="68"/>
+    <edge source="67" destination="48"/>
+    <edge source="67" destination="86"/>
+    <edge source="68" destination="67"/>
+    <edge source="68" destination="69"/>
+    <edge source="68" destination="49"/>
+    <edge source="68" destination="87"/>
+    <edge source="69" destination="68"/>
+    <edge source="69" destination="70"/>
+    <edge source="69" destination="50"/>
+    <edge source="69" destination="88"/>
+    <edge source="70" destination="69"/>
+    <edge source="70" destination="71"/>
+    <edge source="70" destination="51"/>
+    <edge source="70" destination="89"/>
+    <edge source="71" destination="70"/>
+    <edge source="71" destination="72"/>
+    <edge source="71" destination="52"/>
+    <edge source="71" destination="90"/>
+    <edge source="72" destination="71"/>
+    <edge source="72" destination="73"/>
+    <edge source="72" destination="53"/>
+    <edge source="72" destination="91"/>
+    <edge source="73" destination="72"/>
+    <edge source="73" destination="74"/>
+    <edge source="73" destination="54"/>
+    <edge source="73" destination="92"/>
+    <edge source="74" destination="73"/>
+    <edge source="74" destination="75"/>
+    <edge source="74" destination="55"/>
+    <edge source="74" destination="93"/>
+    <edge source="75" destination="74"/>
+    <edge source="75" destination="56"/>
+    <edge source="75" destination="94"/>
+    <edge source="76" destination="77"/>
+    <edge source="76" destination="57"/>
+    <edge source="76" destination="95"/>
+    <edge source="77" destination="76"/>
+    <edge source="77" destination="78"/>
+    <edge source="77" destination="58"/>
+    <edge source="77" destination="96"/>
+    <edge source="78" destination="77"/>
+    <edge source="78" destination="79"/>
+    <edge source="78" destination="59"/>
+    <edge source="78" destination="97"/>
+    <edge source="79" destination="78"/>
+    <edge source="79" destination="80"/>
+    <edge source="79" destination="60"/>
+    <edge source="79" destination="98"/>
+    <edge source="80" destination="79"/>
+    <edge source="80" destination="81"/>
+    <edge source="80" destination="61"/>
+    <edge source="80" destination="99"/>
+    <edge source="81" destination="80"/>
+    <edge source="81" destination="82"/>
+    <edge source="81" destination="62"/>
+    <edge source="81" destination="100"/>
+    <edge source="82" destination="81"/>
+    <edge source="82" destination="83"/>
+    <edge source="82" destination="63"/>
+    <edge source="82" destination="101"/>
+    <edge source="83" destination="82"/>
+    <edge source="83" destination="84"/>
+    <edge source="83" destination="64"/>
+    <edge source="83" destination="102"/>
+    <edge source="84" destination="83"/>
+    <edge source="84" destination="85"/>
+    <edge source="84" destination="65"/>
+    <edge source="84" destination="103"/>
+    <edge source="85" destination="84"/>
+    <edge source="85" destination="86"/>
+    <edge source="85" destination="66"/>
+    <edge source="85" destination="104"/>
+    <edge source="86" destination="85"/>
+    <edge source="86" destination="87"/>
+    <edge source="86" destination="67"/>
+    <edge source="86" destination="105"/>
+    <edge source="87" destination="86"/>
+    <edge source="87" destination="88"/>
+    <edge source="87" destination="68"/>
+    <edge source="87" destination="106"/>
+    <edge source="88" destination="87"/>
+    <edge source="88" destination="89"/>
+    <edge source="88" destination="69"/>
+    <edge source="88" destination="107"/>
+    <edge source="89" destination="88"/>
+    <edge source="89" destination="90"/>
+    <edge source="89" destination="70"/>
+    <edge source="89" destination="108"/>
+    <edge source="90" destination="89"/>
+    <edge source="90" destination="91"/>
+    <edge source="90" destination="71"/>
+    <edge source="90" destination="109"/>
+    <edge source="91" destination="90"/>
+    <edge source="91" destination="92"/>
+    <edge source="91" destination="72"/>
+    <edge source="91" destination="110"/>
+    <edge source="92" destination="91"/>
+    <edge source="92" destination="93"/>
+    <edge source="92" destination="73"/>
+    <edge source="92" destination="111"/>
+    <edge source="93" destination="92"/>
+    <edge source="93" destination="94"/>
+    <edge source="93" destination="74"/>
+    <edge source="93" destination="112"/>
+    <edge source="94" destination="93"/>
+    <edge source="94" destination="75"/>
+    <edge source="94" destination="113"/>
+    <edge source="95" destination="96"/>
+    <edge source="95" destination="76"/>
+    <edge source="95" destination="114"/>
+    <edge source="96" destination="95"/>
+    <edge source="96" destination="97"/>
+    <edge source="96" destination="77"/>
+    <edge source="96" destination="115"/>
+    <edge source="97" destination="96"/>
+    <edge source="97" destination="98"/>
+    <edge source="97" destination="78"/>
+    <edge source="97" destination="116"/>
+    <edge source="98" destination="97"/>
+    <edge source="98" destination="99"/>
+    <edge source="98" destination="79"/>
+    <edge source="98" destination="117"/>
+    <edge source="99" destination="98"/>
+    <edge source="99" destination="100"/>
+    <edge source="99" destination="80"/>
+    <edge source="99" destination="118"/>
+    <edge source="100" destination="99"/>
+    <edge source="100" destination="101"/>
+    <edge source="100" destination="81"/>
+    <edge source="100" destination="119"/>
+    <edge source="101" destination="100"/>
+    <edge source="101" destination="102"/>
+    <edge source="101" destination="82"/>
+    <edge source="101" destination="120"/>
+    <edge source="102" destination="101"/>
+    <edge source="102" destination="103"/>
+    <edge source="102" destination="83"/>
+    <edge source="102" destination="121"/>
+    <edge source="103" destination="102"/>
+    <edge source="103" destination="104"/>
+    <edge source="103" destination="84"/>
+    <edge source="103" destination="122"/>
+    <edge source="104" destination="103"/>
+    <edge source="104" destination="105"/>
+    <edge source="104" destination="85"/>
+    <edge source="104" destination="123"/>
+    <edge source="105" destination="104"/>
+    <edge source="105" destination="106"/>
+    <edge source="105" destination="86"/>
+    <edge source="105" destination="124"/>
+    <edge source="106" destination="105"/>
+    <edge source="106" destination="107"/>
+    <edge source="106" destination="87"/>
+    <edge source="106" destination="125"/>
+    <edge source="107" destination="106"/>
+    <edge source="107" destination="108"/>
+    <edge source="107" destination="88"/>
+    <edge source="107" destination="126"/>
+    <edge source="108" destination="107"/>
+    <edge source="108" destination="109"/>
+    <edge source="108" destination="89"/>
+    <edge source="108" destination="127"/>
+    <edge source="109" destination="108"/>
+    <edge source="109" destination="110"/>
+    <edge source="109" destination="90"/>
+    <edge source="109" destination="128"/>
+    <edge source="110" destination="109"/>
+    <edge source="110" destination="111"/>
+    <edge source="110" destination="91"/>
+    <edge source="110" destination="129"/>
+    <edge source="111" destination="110"/>
+    <edge source="111" destination="112"/>
+    <edge source="111" destination="92"/>
+    <edge source="111" destination="130"/>
+    <edge source="112" destination="111"/>
+    <edge source="112" destination="113"/>
+    <edge source="112" destination="93"/>
+    <edge source="112" destination="131"/>
+    <edge source="113" destination="112"/>
+    <edge source="113" destination="94"/>
+    <edge source="113" destination="132"/>
+    <edge source="114" destination="115"/>
+    <edge source="114" destination="95"/>
+    <edge source="114" destination="133"/>
+    <edge source="115" destination="114"/>
+    <edge source="115" destination="116"/>
+    <edge source="115" destination="96"/>
+    <edge source="115" destination="134"/>
+    <edge source="116" destination="115"/>
+    <edge source="116" destination="117"/>
+    <edge source="116" destination="97"/>
+    <edge source="116" destination="135"/>
+    <edge source="117" destination="116"/>
+    <edge source="117" destination="118"/>
+    <edge source="117" destination="98"/>
+    <edge source="117" destination="136"/>
+    <edge source="118" destination="117"/>
+    <edge source="118" destination="119"/>
+    <edge source="118" destination="99"/>
+    <edge source="118" destination="137"/>
+    <edge source="119" destination="118"/>
+    <edge source="119" destination="120"/>
+    <edge source="119" destination="100"/>
+    <edge source="119" destination="138"/>
+    <edge source="120" destination="119"/>
+    <edge source="120" destination="121"/>
+    <edge source="120" destination="101"/>
+    <edge source="120" destination="139"/>
+    <edge source="121" destination="120"/>
+    <edge source="121" destination="122"/>
+    <edge source="121" destination="102"/>
+    <edge source="121" destination="140"/>
+    <edge source="122" destination="121"/>
+    <edge source="122" destination="123"/>
+    <edge source="122" destination="103"/>
+    <edge source="122" destination="141"/>
+    <edge source="123" destination="122"/>
+    <edge source="123" destination="124"/>
+    <edge source="123" destination="104"/>
+    <edge source="123" destination="142"/>
+    <edge source="124" destination="123"/>
+    <edge source="124" destination="125"/>
+    <edge source="124" destination="105"/>
+    <edge source="124" destination="143"/>
+    <edge source="125" destination="124"/>
+    <edge source="125" destination="126"/>
+    <edge source="125" destination="106"/>
+    <edge source="125" destination="144"/>
+    <edge source="126" destination="125"/>
+    <edge source="126" destination="127"/>
+    <edge source="126" destination="107"/>
+    <edge source="126" destination="145"/>
+    <edge source="127" destination="126"/>
+    <edge source="127" destination="128"/>
+    <edge source="127" destination="108"/>
+    <edge source="127" destination="146"/>
+    <edge source="128" destination="127"/>
+    <edge source="128" destination="129"/>
+    <edge source="128" destination="109"/>
+    <edge source="128" destination="147"/>
+    <edge source="129" destination="128"/>
+    <edge source="129" destination="130"/>
+    <edge source="129" destination="110"/>
+    <edge source="129" destination="148"/>
+    <edge source="130" destination="129"/>
+    <edge source="130" destination="131"/>
+    <edge source="130" destination="111"/>
+    <edge source="130" destination="149"/>
+    <edge source="131" destination="130"/>
+    <edge source="131" destination="132"/>
+    <edge source="131" destination="112"/>
+    <edge source="131" destination="150"/>
+    <edge source="132" destination="131"/>
+    <edge source="132" destination="113"/>
+    <edge source="132" destination="151"/>
+    <edge source="133" destination="134"/>
+    <edge source="133" destination="114"/>
+    <edge source="133" destination="152"/>
+    <edge source="134" destination="133"/>
+    <edge source="134" destination="135"/>
+    <edge source="134" destination="115"/>
+    <edge source="134" destination="153"/>
+    <edge source="135" destination="134"/>
+    <edge source="135" destination="136"/>
+    <edge source="135" destination="116"/>
+    <edge source="135" destination="154"/>
+    <edge source="136" destination="135"/>
+    <edge source="136" destination="137"/>
+    <edge source="136" destination="117"/>
+    <edge source="136" destination="155"/>
+    <edge source="137" destination="136"/>
+    <edge source="137" destination="138"/>
+    <edge source="137" destination="118"/>
+    <edge source="137" destination="156"/>
+    <edge source="138" destination="137"/>
+    <edge source="138" destination="139"/>
+    <edge source="138" destination="119"/>
+    <edge source="138" destination="157"/>
+    <edge source="139" destination="138"/>
+    <edge source="139" destination="140"/>
+    <edge source="139" destination="120"/>
+    <edge source="139" destination="158"/>
+    <edge source="140" destination="139"/>
+    <edge source="140" destination="141"/>
+    <edge source="140" destination="121"/>
+    <edge source="140" destination="159"/>
+    <edge source="141" destination="140"/>
+    <edge source="141" destination="142"/>
+    <edge source="141" destination="122"/>
+    <edge source="141" destination="160"/>
+    <edge source="142" destination="141"/>
+    <edge source="142" destination="143"/>
+    <edge source="142" destination="123"/>
+    <edge source="142" destination="161"/>
+    <edge source="143" destination="142"/>
+    <edge source="143" destination="144"/>
+    <edge source="143" destination="124"/>
+    <edge source="143" destination="162"/>
+    <edge source="144" destination="143"/>
+    <edge source="144" destination="145"/>
+    <edge source="144" destination="125"/>
+    <edge source="144" destination="163"/>
+    <edge source="145" destination="144"/>
+    <edge source="145" destination="146"/>
+    <edge source="145" destination="126"/>
+    <edge source="145" destination="164"/>
+    <edge source="146" destination="145"/>
+    <edge source="146" destination="147"/>
+    <edge source="146" destination="127"/>
+    <edge source="146" destination="165"/>
+    <edge source="147" destination="146"/>
+    <edge source="147" destination="148"/>
+    <edge source="147" destination="128"/>
+    <edge source="147" destination="166"/>
+    <edge source="148" destination="147"/>
+    <edge source="148" destination="149"/>
+    <edge source="148" destination="129"/>
+    <edge source="148" destination="167"/>
+    <edge source="149" destination="148"/>
+    <edge source="149" destination="150"/>
+    <edge source="149" destination="130"/>
+    <edge source="149" destination="168"/>
+    <edge source="150" destination="149"/>
+    <edge source="150" destination="151"/>
+    <edge source="150" destination="131"/>
+    <edge source="150" destination="169"/>
+    <edge source="151" destination="150"/>
+    <edge source="151" destination="132"/>
+    <edge source="151" destination="170"/>
+    <edge source="152" destination="153"/>
+    <edge source="152" destination="133"/>
+    <edge source="152" destination="171"/>
+    <edge source="153" destination="152"/>
+    <edge source="153" destination="154"/>
+    <edge source="153" destination="134"/>
+    <edge source="153" destination="172"/>
+    <edge source="154" destination="153"/>
+    <edge source="154" destination="155"/>
+    <edge source="154" destination="135"/>
+    <edge source="154" destination="173"/>
+    <edge source="155" destination="154"/>
+    <edge source="155" destination="156"/>
+    <edge source="155" destination="136"/>
+    <edge source="155" destination="174"/>
+    <edge source="156" destination="155"/>
+    <edge source="156" destination="157"/>
+    <edge source="156" destination="137"/>
+    <edge source="156" destination="175"/>
+    <edge source="157" destination="156"/>
+    <edge source="157" destination="158"/>
+    <edge source="157" destination="138"/>
+    <edge source="157" destination="176"/>
+    <edge source="158" destination="157"/>
+    <edge source="158" destination="159"/>
+    <edge source="158" destination="139"/>
+    <edge source="158" destination="177"/>
+    <edge source="159" destination="158"/>
+    <edge source="159" destination="160"/>
+    <edge source="159" destination="140"/>
+    <edge source="159" destination="178"/>
+    <edge source="160" destination="159"/>
+    <edge source="160" destination="161"/>
+    <edge source="160" destination="141"/>
+    <edge source="160" destination="179"/>
+    <edge source="161" destination="160"/>
+    <edge source="161" destination="162"/>
+    <edge source="161" destination="142"/>
+    <edge source="161" destination="180"/>
+    <edge source="162" destination="161"/>
+    <edge source="162" destination="163"/>
+    <edge source="162" destination="143"/>
+    <edge source="162" destination="181"/>
+    <edge source="163" destination="162"/>
+    <edge source="163" destination="164"/>
+    <edge source="163" destination="144"/>
+    <edge source="163" destination="182"/>
+    <edge source="164" destination="163"/>
+    <edge source="164" destination="165"/>
+    <edge source="164" destination="145"/>
+    <edge source="164" destination="183"/>
+    <edge source="165" destination="164"/>
+    <edge source="165" destination="166"/>
+    <edge source="165" destination="146"/>
+    <edge source="165" destination="184"/>
+    <edge source="166" destination="165"/>
+    <edge source="166" destination="167"/>
+    <edge source="166" destination="147"/>
+    <edge source="166" destination="185"/>
+    <edge source="167" destination="166"/>
+    <edge source="167" destination="168"/>
+    <edge source="167" destination="148"/>
+    <edge source="167" destination="186"/>
+    <edge source="168" destination="167"/>
+    <edge source="168" destination="169"/>
+    <edge source="168" destination="149"/>
+    <edge source="168" destination="187"/>
+    <edge source="169" destination="168"/>
+    <edge source="169" destination="170"/>
+    <edge source="169" destination="150"/>
+    <edge source="169" destination="188"/>
+    <edge source="170" destination="169"/>
+    <edge source="170" destination="151"/>
+    <edge source="170" destination="189"/>
+    <edge source="171" destination="172"/>
+    <edge source="171" destination="152"/>
+    <edge source="171" destination="190"/>
+    <edge source="172" destination="171"/>
+    <edge source="172" destination="173"/>
+    <edge source="172" destination="153"/>
+    <edge source="172" destination="191"/>
+    <edge source="173" destination="172"/>
+    <edge source="173" destination="174"/>
+    <edge source="173" destination="154"/>
+    <edge source="173" destination="192"/>
+    <edge source="174" destination="173"/>
+    <edge source="174" destination="175"/>
+    <edge source="174" destination="155"/>
+    <edge source="174" destination="193"/>
+    <edge source="175" destination="174"/>
+    <edge source="175" destination="176"/>
+    <edge source="175" destination="156"/>
+    <edge source="175" destination="194"/>
+    <edge source="176" destination="175"/>
+    <edge source="176" destination="177"/>
+    <edge source="176" destination="157"/>
+    <edge source="176" destination="195"/>
+    <edge source="177" destination="176"/>
+    <edge source="177" destination="178"/>
+    <edge source="177" destination="158"/>
+    <edge source="177" destination="196"/>
+    <edge source="178" destination="177"/>
+    <edge source="178" destination="179"/>
+    <edge source="178" destination="159"/>
+    <edge source="178" destination="197"/>
+    <edge source="179" destination="178"/>
+    <edge source="179" destination="180"/>
+    <edge source="179" destination="160"/>
+    <edge source="179" destination="198"/>
+    <edge source="180" destination="179"/>
+    <edge source="180" destination="181"/>
+    <edge source="180" destination="161"/>
+    <edge source="180" destination="199"/>
+    <edge source="181" destination="180"/>
+    <edge source="181" destination="182"/>
+    <edge source="181" destination="162"/>
+    <edge source="181" destination="200"/>
+    <edge source="182" destination="181"/>
+    <edge source="182" destination="183"/>
+    <edge source="182" destination="163"/>
+    <edge source="182" destination="201"/>
+    <edge source="183" destination="182"/>
+    <edge source="183" destination="184"/>
+    <edge source="183" destination="164"/>
+    <edge source="183" destination="202"/>
+    <edge source="184" destination="183"/>
+    <edge source="184" destination="185"/>
+    <edge source="184" destination="165"/>
+    <edge source="184" destination="203"/>
+    <edge source="185" destination="184"/>
+    <edge source="185" destination="186"/>
+    <edge source="185" destination="166"/>
+    <edge source="185" destination="204"/>
+    <edge source="186" destination="185"/>
+    <edge source="186" destination="187"/>
+    <edge source="186" destination="167"/>
+    <edge source="186" destination="205"/>
+    <edge source="187" destination="186"/>
+    <edge source="187" destination="188"/>
+    <edge source="187" destination="168"/>
+    <edge source="187" destination="206"/>
+    <edge source="188" destination="187"/>
+    <edge source="188" destination="189"/>
+    <edge source="188" destination="169"/>
+    <edge source="188" destination="207"/>
+    <edge source="189" destination="188"/>
+    <edge source="189" destination="170"/>
+    <edge source="189" destination="208"/>
+    <edge source="190" destination="191"/>
+    <edge source="190" destination="171"/>
+    <edge source="190" destination="209"/>
+    <edge source="191" destination="190"/>
+    <edge source="191" destination="192"/>
+    <edge source="191" destination="172"/>
+    <edge source="191" destination="210"/>
+    <edge source="192" destination="191"/>
+    <edge source="192" destination="193"/>
+    <edge source="192" destination="173"/>
+    <edge source="192" destination="211"/>
+    <edge source="193" destination="192"/>
+    <edge source="193" destination="194"/>
+    <edge source="193" destination="174"/>
+    <edge source="193" destination="212"/>
+    <edge source="194" destination="193"/>
+    <edge source="194" destination="195"/>
+    <edge source="194" destination="175"/>
+    <edge source="194" destination="213"/>
+    <edge source="195" destination="194"/>
+    <edge source="195" destination="196"/>
+    <edge source="195" destination="176"/>
+    <edge source="195" destination="214"/>
+    <edge source="196" destination="195"/>
+    <edge source="196" destination="197"/>
+    <edge source="196" destination="177"/>
+    <edge source="196" destination="215"/>
+    <edge source="197" destination="196"/>
+    <edge source="197" destination="198"/>
+    <edge source="197" destination="178"/>
+    <edge source="197" destination="216"/>
+    <edge source="198" destination="197"/>
+    <edge source="198" destination="199"/>
+    <edge source="198" destination="179"/>
+    <edge source="198" destination="217"/>
+    <edge source="199" destination="198"/>
+    <edge source="199" destination="200"/>
+    <edge source="199" destination="180"/>
+    <edge source="199" destination="218"/>
+    <edge source="200" destination="199"/>
+    <edge source="200" destination="201"/>
+    <edge source="200" destination="181"/>
+    <edge source="200" destination="219"/>
+    <edge source="201" destination="200"/>
+    <edge source="201" destination="202"/>
+    <edge source="201" destination="182"/>
+    <edge source="201" destination="220"/>
+    <edge source="202" destination="201"/>
+    <edge source="202" destination="203"/>
+    <edge source="202" destination="183"/>
+    <edge source="202" destination="221"/>
+    <edge source="203" destination="202"/>
+    <edge source="203" destination="204"/>
+    <edge source="203" destination="184"/>
+    <edge source="203" destination="222"/>
+    <edge source="204" destination="203"/>
+    <edge source="204" destination="205"/>
+    <edge source="204" destination="185"/>
+    <edge source="204" destination="223"/>
+    <edge source="205" destination="204"/>
+    <edge source="205" destination="206"/>
+    <edge source="205" destination="186"/>
+    <edge source="205" destination="224"/>
+    <edge source="206" destination="205"/>
+    <edge source="206" destination="207"/>
+    <edge source="206" destination="187"/>
+    <edge source="206" destination="225"/>
+    <edge source="207" destination="206"/>
+    <edge source="207" destination="208"/>
+    <edge source="207" destination="188"/>
+    <edge source="207" destination="226"/>
+    <edge source="208" destination="207"/>
+    <edge source="208" destination="189"/>
+    <edge source="208" destination="227"/>
+    <edge source="209" destination="210"/>
+    <edge source="209" destination="190"/>
+    <edge source="209" destination="228"/>
+    <edge source="210" destination="209"/>
+    <edge source="210" destination="211"/>
+    <edge source="210" destination="191"/>
+    <edge source="210" destination="229"/>
+    <edge source="211" destination="210"/>
+    <edge source="211" destination="212"/>
+    <edge source="211" destination="192"/>
+    <edge source="211" destination="230"/>
+    <edge source="212" destination="211"/>
+    <edge source="212" destination="213"/>
+    <edge source="212" destination="193"/>
+    <edge source="212" destination="231"/>
+    <edge source="213" destination="212"/>
+    <edge source="213" destination="214"/>
+    <edge source="213" destination="194"/>
+    <edge source="213" destination="232"/>
+    <edge source="214" destination="213"/>
+    <edge source="214" destination="215"/>
+    <edge source="214" destination="195"/>
+    <edge source="214" destination="233"/>
+    <edge source="215" destination="214"/>
+    <edge source="215" destination="216"/>
+    <edge source="215" destination="196"/>
+    <edge source="215" destination="234"/>
+    <edge source="216" destination="215"/>
+    <edge source="216" destination="217"/>
+    <edge source="216" destination="197"/>
+    <edge source="216" destination="235"/>
+    <edge source="217" destination="216"/>
+    <edge source="217" destination="218"/>
+    <edge source="217" destination="198"/>
+    <edge source="217" destination="236"/>
+    <edge source="218" destination="217"/>
+    <edge source="218" destination="219"/>
+    <edge source="218" destination="199"/>
+    <edge source="218" destination="237"/>
+    <edge source="219" destination="218"/>
+    <edge source="219" destination="220"/>
+    <edge source="219" destination="200"/>
+    <edge source="219" destination="238"/>
+    <edge source="220" destination="219"/>
+    <edge source="220" destination="221"/>
+    <edge source="220" destination="201"/>
+    <edge source="220" destination="239"/>
+    <edge source="221" destination="220"/>
+    <edge source="221" destination="222"/>
+    <edge source="221" destination="202"/>
+    <edge source="221" destination="240"/>
+    <edge source="222" destination="221"/>
+    <edge source="222" destination="223"/>
+    <edge source="222" destination="203"/>
+    <edge source="222" destination="241"/>
+    <edge source="223" destination="222"/>
+    <edge source="223" destination="224"/>
+    <edge source="223" destination="204"/>
+    <edge source="223" destination="242"/>
+    <edge source="224" destination="223"/>
+    <edge source="224" destination="225"/>
+    <edge source="224" destination="205"/>
+    <edge source="224" destination="243"/>
+    <edge source="225" destination="224"/>
+    <edge source="225" destination="226"/>
+    <edge source="225" destination="206"/>
+    <edge source="225" destination="244"/>
+    <edge source="226" destination="225"/>
+    <edge source="226" destination="227"/>
+    <edge source="226" destination="207"/>
+    <edge source="226" destination="245"/>
+    <edge source="227" destination="226"/>
+    <edge source="227" destination="208"/>
+    <edge source="227" destination="246"/>
+    <edge source="228" destination="229"/>
+    <edge source="228" destination="209"/>
+    <edge source="228" destination="247"/>
+    <edge source="229" destination="228"/>
+    <edge source="229" destination="230"/>
+    <edge source="229" destination="210"/>
+    <edge source="229" destination="248"/>
+    <edge source="230" destination="229"/>
+    <edge source="230" destination="231"/>
+    <edge source="230" destination="211"/>
+    <edge source="230" destination="249"/>
+    <edge source="231" destination="230"/>
+    <edge source="231" destination="232"/>
+    <edge source="231" destination="212"/>
+    <edge source="231" destination="250"/>
+    <edge source="232" destination="231"/>
+    <edge source="232" destination="233"/>
+    <edge source="232" destination="213"/>
+    <edge source="232" destination="251"/>
+    <edge source="233" destination="232"/>
+    <edge source="233" destination="234"/>
+    <edge source="233" destination="214"/>
+    <edge source="233" destination="252"/>
+    <edge source="234" destination="233"/>
+    <edge source="234" destination="235"/>
+    <edge source="234" destination="215"/>
+    <edge source="234" destination="253"/>
+    <edge source="235" destination="234"/>
+    <edge source="235" destination="236"/>
+    <edge source="235" destination="216"/>
+    <edge source="235" destination="254"/>
+    <edge source="236" destination="235"/>
+    <edge source="236" destination="237"/>
+    <edge source="236" destination="217"/>
+    <edge source="236" destination="255"/>
+    <edge source="237" destination="236"/>
+    <edge source="237" destination="238"/>
+    <edge source="237" destination="218"/>
+    <edge source="237" destination="256"/>
+    <edge source="238" destination="237"/>
+    <edge source="238" destination="239"/>
+    <edge source="238" destination="219"/>
+    <edge source="238" destination="257"/>
+    <edge source="239" destination="238"/>
+    <edge source="239" destination="240"/>
+    <edge source="239" destination="220"/>
+    <edge source="239" destination="258"/>
+    <edge source="240" destination="239"/>
+    <edge source="240" destination="241"/>
+    <edge source="240" destination="221"/>
+    <edge source="240" destination="259"/>
+    <edge source="241" destination="240"/>
+    <edge source="241" destination="242"/>
+    <edge source="241" destination="222"/>
+    <edge source="241" destination="260"/>
+    <edge source="242" destination="241"/>
+    <edge source="242" destination="243"/>
+    <edge source="242" destination="223"/>
+    <edge source="242" destination="261"/>
+    <edge source="243" destination="242"/>
+    <edge source="243" destination="244"/>
+    <edge source="243" destination="224"/>
+    <edge source="243" destination="262"/>
+    <edge source="244" destination="243"/>
+    <edge source="244" destination="245"/>
+    <edge source="244" destination="225"/>
+    <edge source="244" destination="263"/>
+    <edge source="245" destination="244"/>
+    <edge source="245" destination="246"/>
+    <edge source="245" destination="226"/>
+    <edge source="245" destination="264"/>
+    <edge source="246" destination="245"/>
+    <edge source="246" destination="227"/>
+    <edge source="246" destination="265"/>
+    <edge source="247" destination="248"/>
+    <edge source="247" destination="228"/>
+    <edge source="247" destination="266"/>
+    <edge source="248" destination="247"/>
+    <edge source="248" destination="249"/>
+    <edge source="248" destination="229"/>
+    <edge source="248" destination="267"/>
+    <edge source="249" destination="248"/>
+    <edge source="249" destination="250"/>
+    <edge source="249" destination="230"/>
+    <edge source="249" destination="268"/>
+    <edge source="250" destination="249"/>
+    <edge source="250" destination="251"/>
+    <edge source="250" destination="231"/>
+    <edge source="250" destination="269"/>
+    <edge source="251" destination="250"/>
+    <edge source="251" destination="252"/>
+    <edge source="251" destination="232"/>
+    <edge source="251" destination="270"/>
+    <edge source="252" destination="251"/>
+    <edge source="252" destination="253"/>
+    <edge source="252" destination="233"/>
+    <edge source="252" destination="271"/>
+    <edge source="253" destination="252"/>
+    <edge source="253" destination="254"/>
+    <edge source="253" destination="234"/>
+    <edge source="253" destination="272"/>
+    <edge source="254" destination="253"/>
+    <edge source="254" destination="255"/>
+    <edge source="254" destination="235"/>
+    <edge source="254" destination="273"/>
+    <edge source="255" destination="254"/>
+    <edge source="255" destination="256"/>
+    <edge source="255" destination="236"/>
+    <edge source="255" destination="274"/>
+    <edge source="256" destination="255"/>
+    <edge source="256" destination="257"/>
+    <edge source="256" destination="237"/>
+    <edge source="256" destination="275"/>
+    <edge source="257" destination="256"/>
+    <edge source="257" destination="258"/>
+    <edge source="257" destination="238"/>
+    <edge source="257" destination="276"/>
+    <edge source="258" destination="257"/>
+    <edge source="258" destination="259"/>
+    <edge source="258" destination="239"/>
+    <edge source="258" destination="277"/>
+    <edge source="259" destination="258"/>
+    <edge source="259" destination="260"/>
+    <edge source="259" destination="240"/>
+    <edge source="259" destination="278"/>
+    <edge source="260" destination="259"/>
+    <edge source="260" destination="261"/>
+    <edge source="260" destination="241"/>
+    <edge source="260" destination="279"/>
+    <edge source="261" destination="260"/>
+    <edge source="261" destination="262"/>
+    <edge source="261" destination="242"/>
+    <edge source="261" destination="280"/>
+    <edge source="262" destination="261"/>
+    <edge source="262" destination="263"/>
+    <edge source="262" destination="243"/>
+    <edge source="262" destination="281"/>
+    <edge source="263" destination="262"/>
+    <edge source="263" destination="264"/>
+    <edge source="263" destination="244"/>
+    <edge source="263" destination="282"/>
+    <edge source="264" destination="263"/>
+    <edge source="264" destination="265"/>
+    <edge source="264" destination="245"/>
+    <edge source="264" destination="283"/>
+    <edge source="265" destination="264"/>
+    <edge source="265" destination="246"/>
+    <edge source="265" destination="284"/>
+    <edge source="266" destination="267"/>
+    <edge source="266" destination="247"/>
+    <edge source="266" destination="285"/>
+    <edge source="267" destination="266"/>
+    <edge source="267" destination="268"/>
+    <edge source="267" destination="248"/>
+    <edge source="267" destination="286"/>
+    <edge source="268" destination="267"/>
+    <edge source="268" destination="269"/>
+    <edge source="268" destination="249"/>
+    <edge source="268" destination="287"/>
+    <edge source="269" destination="268"/>
+    <edge source="269" destination="270"/>
+    <edge source="269" destination="250"/>
+    <edge source="269" destination="288"/>
+    <edge source="270" destination="269"/>
+    <edge source="270" destination="271"/>
+    <edge source="270" destination="251"/>
+    <edge source="270" destination="289"/>
+    <edge source="271" destination="270"/>
+    <edge source="271" destination="272"/>
+    <edge source="271" destination="252"/>
+    <edge source="271" destination="290"/>
+    <edge source="272" destination="271"/>
+    <edge source="272" destination="273"/>
+    <edge source="272" destination="253"/>
+    <edge source="272" destination="291"/>
+    <edge source="273" destination="272"/>
+    <edge source="273" destination="274"/>
+    <edge source="273" destination="254"/>
+    <edge source="273" destination="292"/>
+    <edge source="274" destination="273"/>
+    <edge source="274" destination="275"/>
+    <edge source="274" destination="255"/>
+    <edge source="274" destination="293"/>
+    <edge source="275" destination="274"/>
+    <edge source="275" destination="276"/>
+    <edge source="275" destination="256"/>
+    <edge source="275" destination="294"/>
+    <edge source="276" destination="275"/>
+    <edge source="276" destination="277"/>
+    <edge source="276" destination="257"/>
+    <edge source="276" destination="295"/>
+    <edge source="277" destination="276"/>
+    <edge source="277" destination="278"/>
+    <edge source="277" destination="258"/>
+    <edge source="277" destination="296"/>
+    <edge source="278" destination="277"/>
+    <edge source="278" destination="279"/>
+    <edge source="278" destination="259"/>
+    <edge source="278" destination="297"/>
+    <edge source="279" destination="278"/>
+    <edge source="279" destination="280"/>
+    <edge source="279" destination="260"/>
+    <edge source="279" destination="298"/>
+    <edge source="280" destination="279"/>
+    <edge source="280" destination="281"/>
+    <edge source="280" destination="261"/>
+    <edge source="280" destination="299"/>
+    <edge source="281" destination="280"/>
+    <edge source="281" destination="282"/>
+    <edge source="281" destination="262"/>
+    <edge source="281" destination="300"/>
+    <edge source="282" destination="281"/>
+    <edge source="282" destination="283"/>
+    <edge source="282" destination="263"/>
+    <edge source="282" destination="301"/>
+    <edge source="283" destination="282"/>
+    <edge source="283" destination="284"/>
+    <edge source="283" destination="264"/>
+    <edge source="283" destination="302"/>
+    <edge source="284" destination="283"/>
+    <edge source="284" destination="265"/>
+    <edge source="284" destination="303"/>
+    <edge source="285" destination="286"/>
+    <edge source="285" destination="266"/>
+    <edge source="285" destination="304"/>
+    <edge source="286" destination="285"/>
+    <edge source="286" destination="287"/>
+    <edge source="286" destination="267"/>
+    <edge source="286" destination="305"/>
+    <edge source="287" destination="286"/>
+    <edge source="287" destination="288"/>
+    <edge source="287" destination="268"/>
+    <edge source="287" destination="306"/>
+    <edge source="288" destination="287"/>
+    <edge source="288" destination="289"/>
+    <edge source="288" destination="269"/>
+    <edge source="288" destination="307"/>
+    <edge source="289" destination="288"/>
+    <edge source="289" destination="290"/>
+    <edge source="289" destination="270"/>
+    <edge source="289" destination="308"/>
+    <edge source="290" destination="289"/>
+    <edge source="290" destination="291"/>
+    <edge source="290" destination="271"/>
+    <edge source="290" destination="309"/>
+    <edge source="291" destination="290"/>
+    <edge source="291" destination="292"/>
+    <edge source="291" destination="272"/>
+    <edge source="291" destination="310"/>
+    <edge source="292" destination="291"/>
+    <edge source="292" destination="293"/>
+    <edge source="292" destination="273"/>
+    <edge source="292" destination="311"/>
+    <edge source="293" destination="292"/>
+    <edge source="293" destination="294"/>
+    <edge source="293" destination="274"/>
+    <edge source="293" destination="312"/>
+    <edge source="294" destination="293"/>
+    <edge source="294" destination="295"/>
+    <edge source="294" destination="275"/>
+    <edge source="294" destination="313"/>
+    <edge source="295" destination="294"/>
+    <edge source="295" destination="296"/>
+    <edge source="295" destination="276"/>
+    <edge source="295" destination="314"/>
+    <edge source="296" destination="295"/>
+    <edge source="296" destination="297"/>
+    <edge source="296" destination="277"/>
+    <edge source="296" destination="315"/>
+    <edge source="297" destination="296"/>
+    <edge source="297" destination="298"/>
+    <edge source="297" destination="278"/>
+    <edge source="297" destination="316"/>
+    <edge source="298" destination="297"/>
+    <edge source="298" destination="299"/>
+    <edge source="298" destination="279"/>
+    <edge source="298" destination="317"/>
+    <edge source="299" destination="298"/>
+    <edge source="299" destination="300"/>
+    <edge source="299" destination="280"/>
+    <edge source="299" destination="318"/>
+    <edge source="300" destination="299"/>
+    <edge source="300" destination="301"/>
+    <edge source="300" destination="281"/>
+    <edge source="300" destination="319"/>
+    <edge source="301" destination="300"/>
+    <edge source="301" destination="302"/>
+    <edge source="301" destination="282"/>
+    <edge source="301" destination="320"/>
+    <edge source="302" destination="301"/>
+    <edge source="302" destination="303"/>
+    <edge source="302" destination="283"/>
+    <edge source="302" destination="321"/>
+    <edge source="303" destination="302"/>
+    <edge source="303" destination="284"/>
+    <edge source="303" destination="322"/>
+    <edge source="304" destination="305"/>
+    <edge source="304" destination="285"/>
+    <edge source="304" destination="323"/>
+    <edge source="305" destination="304"/>
+    <edge source="305" destination="306"/>
+    <edge source="305" destination="286"/>
+    <edge source="305" destination="324"/>
+    <edge source="306" destination="305"/>
+    <edge source="306" destination="307"/>
+    <edge source="306" destination="287"/>
+    <edge source="306" destination="325"/>
+    <edge source="307" destination="306"/>
+    <edge source="307" destination="308"/>
+    <edge source="307" destination="288"/>
+    <edge source="307" destination="326"/>
+    <edge source="308" destination="307"/>
+    <edge source="308" destination="309"/>
+    <edge source="308" destination="289"/>
+    <edge source="308" destination="327"/>
+    <edge source="309" destination="308"/>
+    <edge source="309" destination="310"/>
+    <edge source="309" destination="290"/>
+    <edge source="309" destination="328"/>
+    <edge source="310" destination="309"/>
+    <edge source="310" destination="311"/>
+    <edge source="310" destination="291"/>
+    <edge source="310" destination="329"/>
+    <edge source="311" destination="310"/>
+    <edge source="311" destination="312"/>
+    <edge source="311" destination="292"/>
+    <edge source="311" destination="330"/>
+    <edge source="312" destination="311"/>
+    <edge source="312" destination="313"/>
+    <edge source="312" destination="293"/>
+    <edge source="312" destination="331"/>
+    <edge source="313" destination="312"/>
+    <edge source="313" destination="314"/>
+    <edge source="313" destination="294"/>
+    <edge source="313" destination="332"/>
+    <edge source="314" destination="313"/>
+    <edge source="314" destination="315"/>
+    <edge source="314" destination="295"/>
+    <edge source="314" destination="333"/>
+    <edge source="315" destination="314"/>
+    <edge source="315" destination="316"/>
+    <edge source="315" destination="296"/>
+    <edge source="315" destination="334"/>
+    <edge source="316" destination="315"/>
+    <edge source="316" destination="317"/>
+    <edge source="316" destination="297"/>
+    <edge source="316" destination="335"/>
+    <edge source="317" destination="316"/>
+    <edge source="317" destination="318"/>
+    <edge source="317" destination="298"/>
+    <edge source="317" destination="336"/>
+    <edge source="318" destination="317"/>
+    <edge source="318" destination="319"/>
+    <edge source="318" destination="299"/>
+    <edge source="318" destination="337"/>
+    <edge source="319" destination="318"/>
+    <edge source="319" destination="320"/>
+    <edge source="319" destination="300"/>
+    <edge source="319" destination="338"/>
+    <edge source="320" destination="319"/>
+    <edge source="320" destination="321"/>
+    <edge source="320" destination="301"/>
+    <edge source="320" destination="339"/>
+    <edge source="321" destination="320"/>
+    <edge source="321" destination="322"/>
+    <edge source="321" destination="302"/>
+    <edge source="321" destination="340"/>
+    <edge source="322" destination="321"/>
+    <edge source="322" destination="303"/>
+    <edge source="322" destination="341"/>
+    <edge source="323" destination="324"/>
+    <edge source="323" destination="304"/>
+    <edge source="323" destination="342"/>
+    <edge source="324" destination="323"/>
+    <edge source="324" destination="325"/>
+    <edge source="324" destination="305"/>
+    <edge source="324" destination="343"/>
+    <edge source="325" destination="324"/>
+    <edge source="325" destination="326"/>
+    <edge source="325" destination="306"/>
+    <edge source="325" destination="344"/>
+    <edge source="326" destination="325"/>
+    <edge source="326" destination="327"/>
+    <edge source="326" destination="307"/>
+    <edge source="326" destination="345"/>
+    <edge source="327" destination="326"/>
+    <edge source="327" destination="328"/>
+    <edge source="327" destination="308"/>
+    <edge source="327" destination="346"/>
+    <edge source="328" destination="327"/>
+    <edge source="328" destination="329"/>
+    <edge source="328" destination="309"/>
+    <edge source="328" destination="347"/>
+    <edge source="329" destination="328"/>
+    <edge source="329" destination="330"/>
+    <edge source="329" destination="310"/>
+    <edge source="329" destination="348"/>
+    <edge source="330" destination="329"/>
+    <edge source="330" destination="331"/>
+    <edge source="330" destination="311"/>
+    <edge source="330" destination="349"/>
+    <edge source="331" destination="330"/>
+    <edge source="331" destination="332"/>
+    <edge source="331" destination="312"/>
+    <edge source="331" destination="350"/>
+    <edge source="332" destination="331"/>
+    <edge source="332" destination="333"/>
+    <edge source="332" destination="313"/>
+    <edge source="332" destination="351"/>
+    <edge source="333" destination="332"/>
+    <edge source="333" destination="334"/>
+    <edge source="333" destination="314"/>
+    <edge source="333" destination="352"/>
+    <edge source="334" destination="333"/>
+    <edge source="334" destination="335"/>
+    <edge source="334" destination="315"/>
+    <edge source="334" destination="353"/>
+    <edge source="335" destination="334"/>
+    <edge source="335" destination="336"/>
+    <edge source="335" destination="316"/>
+    <edge source="335" destination="354"/>
+    <edge source="336" destination="335"/>
+    <edge source="336" destination="337"/>
+    <edge source="336" destination="317"/>
+    <edge source="336" destination="355"/>
+    <edge source="337" destination="336"/>
+    <edge source="337" destination="338"/>
+    <edge source="337" destination="318"/>
+    <edge source="337" destination="356"/>
+    <edge source="338" destination="337"/>
+    <edge source="338" destination="339"/>
+    <edge source="338" destination="319"/>
+    <edge source="338" destination="357"/>
+    <edge source="339" destination="338"/>
+    <edge source="339" destination="340"/>
+    <edge source="339" destination="320"/>
+    <edge source="339" destination="358"/>
+    <edge source="340" destination="339"/>
+    <edge source="340" destination="341"/>
+    <edge source="340" destination="321"/>
+    <edge source="340" destination="359"/>
+    <edge source="341" destination="340"/>
+    <edge source="341" destination="322"/>
+    <edge source="341" destination="360"/>
+    <edge source="342" destination="343"/>
+    <edge source="342" destination="323"/>
+    <edge source="343" destination="342"/>
+    <edge source="343" destination="344"/>
+    <edge source="343" destination="324"/>
+    <edge source="344" destination="343"/>
+    <edge source="344" destination="345"/>
+    <edge source="344" destination="325"/>
+    <edge source="345" destination="344"/>
+    <edge source="345" destination="346"/>
+    <edge source="345" destination="326"/>
+    <edge source="346" destination="345"/>
+    <edge source="346" destination="347"/>
+    <edge source="346" destination="327"/>
+    <edge source="347" destination="346"/>
+    <edge source="347" destination="348"/>
+    <edge source="347" destination="328"/>
+    <edge source="348" destination="347"/>
+    <edge source="348" destination="349"/>
+    <edge source="348" destination="329"/>
+    <edge source="349" destination="348"/>
+    <edge source="349" destination="350"/>
+    <edge source="349" destination="330"/>
+    <edge source="350" destination="349"/>
+    <edge source="350" destination="351"/>
+    <edge source="350" destination="331"/>
+    <edge source="351" destination="350"/>
+    <edge source="351" destination="352"/>
+    <edge source="351" destination="332"/>
+    <edge source="352" destination="351"/>
+    <edge source="352" destination="353"/>
+    <edge source="352" destination="333"/>
+    <edge source="353" destination="352"/>
+    <edge source="353" destination="354"/>
+    <edge source="353" destination="334"/>
+    <edge source="354" destination="353"/>
+    <edge source="354" destination="355"/>
+    <edge source="354" destination="335"/>
+    <edge source="355" destination="354"/>
+    <edge source="355" destination="356"/>
+    <edge source="355" destination="336"/>
+    <edge source="356" destination="355"/>
+    <edge source="356" destination="357"/>
+    <edge source="356" destination="337"/>
+    <edge source="357" destination="356"/>
+    <edge source="357" destination="358"/>
+    <edge source="357" destination="338"/>
+    <edge source="358" destination="357"/>
+    <edge source="358" destination="359"/>
+    <edge source="358" destination="339"/>
+    <edge source="359" destination="358"/>
+    <edge source="359" destination="360"/>
+    <edge source="359" destination="340"/>
+    <edge source="360" destination="359"/>
+    <edge source="360" destination="341"/>
+  </waypointedges>
+</waypointgraph>
\ No newline at end of file

Added: modules/aitest/maps/graphtest.wpg.xml
===================================================================
--- modules/aitest/maps/graphtest.wpg.xml	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/aitest/maps/graphtest.wpg.xml	2007-09-24 21:06:51 UTC (rev 3875)
@@ -0,0 +1,109 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<waypointgraph>
+  <waypointnodes>
+    <node id="0" type="ext" x="3" y="0.5" z="-8.5"/>
+    <node id="1" type="ext" x="3" y="0.5" z="-4"/>
+    <node id="2" type="ext" x="3" y="0.5" z="0"/>
+    <node id="3" type="ext" x="3" y="0.5" z="1"/>
+    <node id="4" type="ext" x="3" y="0.5" z="5"/>
+    <node id="5" type="ext" x="3" y="0.5" z="9.5"/>
+    <node id="6" type="ext" x="4" y="0.5" z="-10"/>
+    <node id="7" type="ext" x="4" y="0.5" z="-7"/>
+    <node id="8" type="ext" x="4" y="0.5" z="-1"/>
+    <node id="9" type="ext" x="4" y="0.5" z="2"/>
+    <node id="10" type="ext" x="4" y="0.5" z="4"/>
+    <node id="11" type="ext" x="4" y="0.5" z="7"/>
+    <node id="12" type="ext" x="5" y="0.5" z="-6"/>
+    <node id="13" type="ext" x="5" y="0.5" z="-3"/>
+    <node id="14" type="ext" x="5" y="0.5" z="1"/>
+    <node id="15" type="ext" x="5" y="0.5" z="5"/>
+    <node id="16" type="ext" x="5" y="0.5" z="6"/>
+    <node id="17" type="ext" x="5" y="0.5" z="9.5"/>
+    <node id="18" type="ext" x="6" y="0.5" z="-9"/>
+    <node id="19" type="ext" x="6" y="0.5" z="-2"/>
+    <node id="20" type="ext" x="6" y="0.5" z="-1"/>
+    <node id="21" type="ext" x="6" y="0.5" z="4"/>
+    <node id="22" type="ext" x="6" y="0.5" z="8"/>
+    <node id="23" type="ext" x="6" y="0.5" z="9.5"/>
+    <node id="24" type="ext" x="7" y="0.5" z="-8"/>
+    <node id="25" type="ext" x="7" y="0.5" z="-4"/>
+  </waypointnodes>
+  <waypointedges>
+    <edge source="0" destination="1"/>
+    <edge source="0" destination="6"/>
+    <edge source="1" destination="0"/>
+    <edge source="1" destination="2"/>
+    <edge source="1" destination="7"/>
+    <edge source="2" destination="1"/>
+    <edge source="2" destination="3"/>
+    <edge source="2" destination="8"/>
+    <edge source="3" destination="2"/>
+    <edge source="3" destination="4"/>
+    <edge source="3" destination="9"/>
+    <edge source="4" destination="3"/>
+    <edge source="4" destination="5"/>
+    <edge source="4" destination="10"/>
+    <edge source="5" destination="4"/>
+    <edge source="5" destination="11"/>
+    <edge source="6" destination="7"/>
+    <edge source="6" destination="0"/>
+    <edge source="6" destination="12"/>
+    <edge source="7" destination="6"/>
+    <edge source="7" destination="8"/>
+    <edge source="7" destination="1"/>
+    <edge source="7" destination="13"/>
+    <edge source="8" destination="7"/>
+    <edge source="8" destination="9"/>
+    <edge source="8" destination="2"/>
+    <edge source="8" destination="14"/>
+    <edge source="9" destination="8"/>
+    <edge source="9" destination="10"/>
+    <edge source="9" destination="3"/>
+    <edge source="9" destination="15"/>
+    <edge source="10" destination="9"/>
+    <edge source="10" destination="11"/>
+    <edge source="10" destination="4"/>
+    <edge source="10" destination="16"/>
+    <edge source="11" destination="10"/>
+    <edge source="11" destination="5"/>
+    <edge source="11" destination="17"/>
+    <edge source="12" destination="13"/>
+    <edge source="12" destination="6"/>
+    <edge source="12" destination="18"/>
+    <edge source="13" destination="12"/>
+    <edge source="13" destination="14"/>
+    <edge source="13" destination="7"/>
+    <edge source="13" destination="19"/>
+    <edge source="14" destination="13"/>
+    <edge source="14" destination="15"/>
+    <edge source="14" destination="8"/>
+    <edge source="14" destination="20"/>
+    <edge source="15" destination="14"/>
+    <edge source="15" destination="16"/>
+    <edge source="15" destination="9"/>
+    <edge source="15" destination="21"/>
+    <edge source="16" destination="15"/>
+    <edge source="16" destination="17"/>
+    <edge source="16" destination="10"/>
+    <edge source="16" destination="22"/>
+    <edge source="17" destination="16"/>
+    <edge source="17" destination="11"/>
+    <edge source="17" destination="23"/>
+    <edge source="18" destination="19"/>
+    <edge source="18" destination="12"/>
+    <edge source="19" destination="18"/>
+    <edge source="19" destination="20"/>
+    <edge source="19" destination="13"/>
+    <edge source="20" destination="19"/>
+    <edge source="20" destination="21"/>
+    <edge source="20" destination="14"/>
+    <edge source="21" destination="20"/>
+    <edge source="21" destination="22"/>
+    <edge source="21" destination="15"/>
+    <edge source="22" destination="21"/>
+    <edge source="22" destination="23"/>
+    <edge source="22" destination="16"/>
+    <edge source="23" destination="22"/>
+    <edge source="23" destination="17"/>
+  </waypointedges>
+</waypointgraph>
\ No newline at end of file

Added: modules/aitest/scripts/AStarTest2.rb
===================================================================
--- modules/aitest/scripts/AStarTest2.rb	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/aitest/scripts/AStarTest2.rb	2007-09-24 21:06:51 UTC (rev 3875)
@@ -0,0 +1,24 @@
+class AStarTest2
+    def initialize(center)
+		wpgraph = $WPGM.createWayPointGraph();
+		wpgraph.load("astargrid.wpg.xml")
+
+		walkingCreature = $GOM.createGameObject("TestWalkPerson")
+    walkingCreature.setPosition([0,0,0])
+    walkingCreature.placeIntoScene
+    walkingCreature.modifyAu(1000)
+    
+    creatureController = CreatureControllerManager.getSingleton().getCreatureController(walkingCreature)
+    
+    job = CreatureWalkPathJob.new(
+      "WalkJobAStarTest", 
+      creatureController, 
+      Landmark.new("point", [5.0, 0.0, 0.0]))
+    job.addLandmark("1",[-5.0,0.0,-5.0])
+    job.addLandmark("2",[10.0,0.0,-10.0])
+    job.setWayPoints(wpgraph)
+    $JS.addJob(job);
+
+    end
+end
+

Modified: modules/aitest/scripts/DebugKeys.rb
===================================================================
--- modules/aitest/scripts/DebugKeys.rb	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/aitest/scripts/DebugKeys.rb	2007-09-24 21:06:51 UTC (rev 3875)
@@ -5,9 +5,11 @@
 
     def toggleWP()
       if @isWPShown:
-	$DVM.hide(8)
+        $DVM.hide(8)
+        p "hide"
       else
-	$DVM.show(8)
+      	$DVM.show(8)
+        p "show"
       end
       @isWPShown = (@isWPShown == false)
     end

Modified: modules/aitest/scripts/maps/aitest.rb
===================================================================
--- modules/aitest/scripts/maps/aitest.rb	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/aitest/scripts/maps/aitest.rb	2007-09-24 21:06:51 UTC (rev 3875)
@@ -4,7 +4,7 @@
 require 'hero.rb'
 require 'DebugKeys.rb'
 
-require 'doortest.rb'
+#require 'doortest.rb'
 
 require 'WallSet1.rb'
 require 'WallSet2.rb'
@@ -16,7 +16,7 @@
 #require 'WayPointTest.rb'
 #require 'WayPointTest2.rb'
 
-require 'AStarTest1.rb'
+require 'AStarTest2.rb'
 
 # Physik aktivieren
 $PM.setEnabled(true)
@@ -43,7 +43,7 @@
 
 $SCRIPT.log("debug keys are set up");
 
-DoorTest.new([0.0, 0.0, -5.0])
+#DoorTest.new([0.0, 0.0, -5.0])
 
 #WallSet1.new([0, 0, 0])
 #WallSet2.new([0, 0, 0])
@@ -51,7 +51,7 @@
 WallSet3.new([0, 0, 0], 0.5, 10, [1,1,0,1])
 
 #NpcTest.new([-5, 0, 5])
-NpcCapsuleTest.new([0, 0, 5])
+#NpcCapsuleTest.new([0, 0, 5])
 
 #$MyWPT = WayPointTest.new([0, 0, 0])
 #$MyWPT.save()
@@ -66,4 +66,6 @@
 wolf.placeIntoScene
 wolf.setPosition [0.0,0.0,-5.0]
 
+AStarTest2.new([0.0,0.0,-5.0])
+
 $SCRIPT.log("tests initialisiert.");

Added: modules/regressiontest/maps/astargrid.wpg.xml
===================================================================
--- modules/regressiontest/maps/astargrid.wpg.xml	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/regressiontest/maps/astargrid.wpg.xml	2007-09-24 21:06:51 UTC (rev 3875)
@@ -0,0 +1,1736 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<waypointgraph>
+  <waypointnodes>
+    <node id="0" type="ext" x="-9" y="0.0" z="-9"/>
+    <node id="1" type="ext" x="-9" y="0.0" z="-8"/>
+    <node id="2" type="ext" x="-9" y="0.0" z="-7"/>
+    <node id="3" type="ext" x="-9" y="0.0" z="-6"/>
+    <node id="4" type="ext" x="-9" y="0.0" z="-5"/>
+    <node id="5" type="ext" x="-9" y="0.0" z="-4"/>
+    <node id="6" type="ext" x="-9" y="0.0" z="-3"/>
+    <node id="7" type="ext" x="-9" y="0.0" z="-2"/>
+    <node id="8" type="ext" x="-9" y="0.0" z="-1"/>
+    <node id="9" type="ext" x="-9" y="0.0" z="0"/>
+    <node id="10" type="ext" x="-9" y="0.0" z="1"/>
+    <node id="11" type="ext" x="-9" y="0.0" z="2"/>
+    <node id="12" type="ext" x="-9" y="0.0" z="3"/>
+    <node id="13" type="ext" x="-9" y="0.0" z="4"/>
+    <node id="14" type="ext" x="-9" y="0.0" z="5"/>
+    <node id="15" type="ext" x="-9" y="0.0" z="6"/>
+    <node id="16" type="ext" x="-9" y="0.0" z="7"/>
+    <node id="17" type="ext" x="-9" y="0.0" z="8"/>
+    <node id="18" type="ext" x="-9" y="0.0" z="9"/>
+    <node id="19" type="ext" x="-8" y="0.0" z="-9"/>
+    <node id="20" type="ext" x="-8" y="0.0" z="-8"/>
+    <node id="21" type="ext" x="-8" y="0.0" z="-7"/>
+    <node id="22" type="ext" x="-8" y="0.0" z="-6"/>
+    <node id="23" type="ext" x="-8" y="0.0" z="-5"/>
+    <node id="24" type="ext" x="-8" y="0.0" z="-4"/>
+    <node id="25" type="ext" x="-8" y="0.0" z="-3"/>
+    <node id="26" type="ext" x="-8" y="0.0" z="-2"/>
+    <node id="27" type="ext" x="-8" y="0.0" z="-1"/>
+    <node id="28" type="ext" x="-8" y="0.0" z="0"/>
+    <node id="29" type="ext" x="-8" y="0.0" z="1"/>
+    <node id="30" type="ext" x="-8" y="0.0" z="2"/>
+    <node id="31" type="ext" x="-8" y="0.0" z="3"/>
+    <node id="32" type="ext" x="-8" y="0.0" z="4"/>
+    <node id="33" type="ext" x="-8" y="0.0" z="5"/>
+    <node id="34" type="ext" x="-8" y="0.0" z="6"/>
+    <node id="35" type="ext" x="-8" y="0.0" z="7"/>
+    <node id="36" type="ext" x="-8" y="0.0" z="8"/>
+    <node id="37" type="ext" x="-8" y="0.0" z="9"/>
+    <node id="38" type="ext" x="-7" y="0.0" z="-9"/>
+    <node id="39" type="ext" x="-7" y="0.0" z="-8"/>
+    <node id="40" type="ext" x="-7" y="0.0" z="-7"/>
+    <node id="41" type="ext" x="-7" y="0.0" z="-6"/>
+    <node id="42" type="ext" x="-7" y="0.0" z="-5"/>
+    <node id="43" type="ext" x="-7" y="0.0" z="-4"/>
+    <node id="44" type="ext" x="-7" y="0.0" z="-3"/>
+    <node id="45" type="ext" x="-7" y="0.0" z="-2"/>
+    <node id="46" type="ext" x="-7" y="0.0" z="-1"/>
+    <node id="47" type="ext" x="-7" y="0.0" z="0"/>
+    <node id="48" type="ext" x="-7" y="0.0" z="1"/>
+    <node id="49" type="ext" x="-7" y="0.0" z="2"/>
+    <node id="50" type="ext" x="-7" y="0.0" z="3"/>
+    <node id="51" type="ext" x="-7" y="0.0" z="4"/>
+    <node id="52" type="ext" x="-7" y="0.0" z="5"/>
+    <node id="53" type="ext" x="-7" y="0.0" z="6"/>
+    <node id="54" type="ext" x="-7" y="0.0" z="7"/>
+    <node id="55" type="ext" x="-7" y="0.0" z="8"/>
+    <node id="56" type="ext" x="-7" y="0.0" z="9"/>
+    <node id="57" type="ext" x="-6" y="0.0" z="-9"/>
+    <node id="58" type="ext" x="-6" y="0.0" z="-8"/>
+    <node id="59" type="ext" x="-6" y="0.0" z="-7"/>
+    <node id="60" type="ext" x="-6" y="0.0" z="-6"/>
+    <node id="61" type="ext" x="-6" y="0.0" z="-5"/>
+    <node id="62" type="ext" x="-6" y="0.0" z="-4"/>
+    <node id="63" type="ext" x="-6" y="0.0" z="-3"/>
+    <node id="64" type="ext" x="-6" y="0.0" z="-2"/>
+    <node id="65" type="ext" x="-6" y="0.0" z="-1"/>
+    <node id="66" type="ext" x="-6" y="0.0" z="0"/>
+    <node id="67" type="ext" x="-6" y="0.0" z="1"/>
+    <node id="68" type="ext" x="-6" y="0.0" z="2"/>
+    <node id="69" type="ext" x="-6" y="0.0" z="3"/>
+    <node id="70" type="ext" x="-6" y="0.0" z="4"/>
+    <node id="71" type="ext" x="-6" y="0.0" z="5"/>
+    <node id="72" type="ext" x="-6" y="0.0" z="6"/>
+    <node id="73" type="ext" x="-6" y="0.0" z="7"/>
+    <node id="74" type="ext" x="-6" y="0.0" z="8"/>
+    <node id="75" type="ext" x="-6" y="0.0" z="9"/>
+    <node id="76" type="ext" x="-5" y="0.0" z="-9"/>
+    <node id="77" type="ext" x="-5" y="0.0" z="-8"/>
+    <node id="78" type="ext" x="-5" y="0.0" z="-7"/>
+    <node id="79" type="ext" x="-5" y="0.0" z="-6"/>
+    <node id="80" type="ext" x="-5" y="0.0" z="-5"/>
+    <node id="81" type="ext" x="-5" y="0.0" z="-4"/>
+    <node id="82" type="ext" x="-5" y="0.0" z="-3"/>
+    <node id="83" type="ext" x="-5" y="0.0" z="-2"/>
+    <node id="84" type="ext" x="-5" y="0.0" z="-1"/>
+    <node id="85" type="ext" x="-5" y="0.0" z="0"/>
+    <node id="86" type="ext" x="-5" y="0.0" z="1"/>
+    <node id="87" type="ext" x="-5" y="0.0" z="2"/>
+    <node id="88" type="ext" x="-5" y="0.0" z="3"/>
+    <node id="89" type="ext" x="-5" y="0.0" z="4"/>
+    <node id="90" type="ext" x="-5" y="0.0" z="5"/>
+    <node id="91" type="ext" x="-5" y="0.0" z="6"/>
+    <node id="92" type="ext" x="-5" y="0.0" z="7"/>
+    <node id="93" type="ext" x="-5" y="0.0" z="8"/>
+    <node id="94" type="ext" x="-5" y="0.0" z="9"/>
+    <node id="95" type="ext" x="-4" y="0.0" z="-9"/>
+    <node id="96" type="ext" x="-4" y="0.0" z="-8"/>
+    <node id="97" type="ext" x="-4" y="0.0" z="-7"/>
+    <node id="98" type="ext" x="-4" y="0.0" z="-6"/>
+    <node id="99" type="ext" x="-4" y="0.0" z="-5"/>
+    <node id="100" type="ext" x="-4" y="0.0" z="-4"/>
+    <node id="101" type="ext" x="-4" y="0.0" z="-3"/>
+    <node id="102" type="ext" x="-4" y="0.0" z="-2"/>
+    <node id="103" type="ext" x="-4" y="0.0" z="-1"/>
+    <node id="104" type="ext" x="-4" y="0.0" z="0"/>
+    <node id="105" type="ext" x="-4" y="0.0" z="1"/>
+    <node id="106" type="ext" x="-4" y="0.0" z="2"/>
+    <node id="107" type="ext" x="-4" y="0.0" z="3"/>
+    <node id="108" type="ext" x="-4" y="0.0" z="4"/>
+    <node id="109" type="ext" x="-4" y="0.0" z="5"/>
+    <node id="110" type="ext" x="-4" y="0.0" z="6"/>
+    <node id="111" type="ext" x="-4" y="0.0" z="7"/>
+    <node id="112" type="ext" x="-4" y="0.0" z="8"/>
+    <node id="113" type="ext" x="-4" y="0.0" z="9"/>
+    <node id="114" type="ext" x="-3" y="0.0" z="-9"/>
+    <node id="115" type="ext" x="-3" y="0.0" z="-8"/>
+    <node id="116" type="ext" x="-3" y="0.0" z="-7"/>
+    <node id="117" type="ext" x="-3" y="0.0" z="-6"/>
+    <node id="118" type="ext" x="-3" y="0.0" z="-5"/>
+    <node id="119" type="ext" x="-3" y="0.0" z="-4"/>
+    <node id="120" type="ext" x="-3" y="0.0" z="-3"/>
+    <node id="121" type="ext" x="-3" y="0.0" z="-2"/>
+    <node id="122" type="ext" x="-3" y="0.0" z="-1"/>
+    <node id="123" type="ext" x="-3" y="0.0" z="0"/>
+    <node id="124" type="ext" x="-3" y="0.0" z="1"/>
+    <node id="125" type="ext" x="-3" y="0.0" z="2"/>
+    <node id="126" type="ext" x="-3" y="0.0" z="3"/>
+    <node id="127" type="ext" x="-3" y="0.0" z="4"/>
+    <node id="128" type="ext" x="-3" y="0.0" z="5"/>
+    <node id="129" type="ext" x="-3" y="0.0" z="6"/>
+    <node id="130" type="ext" x="-3" y="0.0" z="7"/>
+    <node id="131" type="ext" x="-3" y="0.0" z="8"/>
+    <node id="132" type="ext" x="-3" y="0.0" z="9"/>
+    <node id="133" type="ext" x="-2" y="0.0" z="-9"/>
+    <node id="134" type="ext" x="-2" y="0.0" z="-8"/>
+    <node id="135" type="ext" x="-2" y="0.0" z="-7"/>
+    <node id="136" type="ext" x="-2" y="0.0" z="-6"/>
+    <node id="137" type="ext" x="-2" y="0.0" z="-5"/>
+    <node id="138" type="ext" x="-2" y="0.0" z="-4"/>
+    <node id="139" type="ext" x="-2" y="0.0" z="-3"/>
+    <node id="140" type="ext" x="-2" y="0.0" z="-2"/>
+    <node id="141" type="ext" x="-2" y="0.0" z="-1"/>
+    <node id="142" type="ext" x="-2" y="0.0" z="0"/>
+    <node id="143" type="ext" x="-2" y="0.0" z="1"/>
+    <node id="144" type="ext" x="-2" y="0.0" z="2"/>
+    <node id="145" type="ext" x="-2" y="0.0" z="3"/>
+    <node id="146" type="ext" x="-2" y="0.0" z="4"/>
+    <node id="147" type="ext" x="-2" y="0.0" z="5"/>
+    <node id="148" type="ext" x="-2" y="0.0" z="6"/>
+    <node id="149" type="ext" x="-2" y="0.0" z="7"/>
+    <node id="150" type="ext" x="-2" y="0.0" z="8"/>
+    <node id="151" type="ext" x="-2" y="0.0" z="9"/>
+    <node id="152" type="ext" x="-1" y="0.0" z="-9"/>
+    <node id="153" type="ext" x="-1" y="0.0" z="-8"/>
+    <node id="154" type="ext" x="-1" y="0.0" z="-7"/>
+    <node id="155" type="ext" x="-1" y="0.0" z="-6"/>
+    <node id="156" type="ext" x="-1" y="0.0" z="-5"/>
+    <node id="157" type="ext" x="-1" y="0.0" z="-4"/>
+    <node id="158" type="ext" x="-1" y="0.0" z="-3"/>
+    <node id="159" type="ext" x="-1" y="0.0" z="-2"/>
+    <node id="160" type="ext" x="-1" y="0.0" z="-1"/>
+    <node id="161" type="ext" x="-1" y="0.0" z="0"/>
+    <node id="162" type="ext" x="-1" y="0.0" z="1"/>
+    <node id="163" type="ext" x="-1" y="0.0" z="2"/>
+    <node id="164" type="ext" x="-1" y="0.0" z="3"/>
+    <node id="165" type="ext" x="-1" y="0.0" z="4"/>
+    <node id="166" type="ext" x="-1" y="0.0" z="5"/>
+    <node id="167" type="ext" x="-1" y="0.0" z="6"/>
+    <node id="168" type="ext" x="-1" y="0.0" z="7"/>
+    <node id="169" type="ext" x="-1" y="0.0" z="8"/>
+    <node id="170" type="ext" x="-1" y="0.0" z="9"/>
+    <node id="171" type="ext" x="0" y="0.0" z="-9"/>
+    <node id="172" type="ext" x="0" y="0.0" z="-8"/>
+    <node id="173" type="ext" x="0" y="0.0" z="-7"/>
+    <node id="174" type="ext" x="0" y="0.0" z="-6"/>
+    <node id="175" type="ext" x="0" y="0.0" z="-5"/>
+    <node id="176" type="ext" x="0" y="0.0" z="-4"/>
+    <node id="177" type="ext" x="0" y="0.0" z="-3"/>
+    <node id="178" type="ext" x="0" y="0.0" z="-2"/>
+    <node id="179" type="ext" x="0" y="0.0" z="-1"/>
+    <node id="180" type="ext" x="0" y="0.0" z="0"/>
+    <node id="181" type="ext" x="0" y="0.0" z="1"/>
+    <node id="182" type="ext" x="0" y="0.0" z="2"/>
+    <node id="183" type="ext" x="0" y="0.0" z="3"/>
+    <node id="184" type="ext" x="0" y="0.0" z="4"/>
+    <node id="185" type="ext" x="0" y="0.0" z="5"/>
+    <node id="186" type="ext" x="0" y="0.0" z="6"/>
+    <node id="187" type="ext" x="0" y="0.0" z="7"/>
+    <node id="188" type="ext" x="0" y="0.0" z="8"/>
+    <node id="189" type="ext" x="0" y="0.0" z="9"/>
+    <node id="190" type="ext" x="1" y="0.0" z="-9"/>
+    <node id="191" type="ext" x="1" y="0.0" z="-8"/>
+    <node id="192" type="ext" x="1" y="0.0" z="-7"/>
+    <node id="193" type="ext" x="1" y="0.0" z="-6"/>
+    <node id="194" type="ext" x="1" y="0.0" z="-5"/>
+    <node id="195" type="ext" x="1" y="0.0" z="-4"/>
+    <node id="196" type="ext" x="1" y="0.0" z="-3"/>
+    <node id="197" type="ext" x="1" y="0.0" z="-2"/>
+    <node id="198" type="ext" x="1" y="0.0" z="-1"/>
+    <node id="199" type="ext" x="1" y="0.0" z="0"/>
+    <node id="200" type="ext" x="1" y="0.0" z="1"/>
+    <node id="201" type="ext" x="1" y="0.0" z="2"/>
+    <node id="202" type="ext" x="1" y="0.0" z="3"/>
+    <node id="203" type="ext" x="1" y="0.0" z="4"/>
+    <node id="204" type="ext" x="1" y="0.0" z="5"/>
+    <node id="205" type="ext" x="1" y="0.0" z="6"/>
+    <node id="206" type="ext" x="1" y="0.0" z="7"/>
+    <node id="207" type="ext" x="1" y="0.0" z="8"/>
+    <node id="208" type="ext" x="1" y="0.0" z="9"/>
+    <node id="209" type="ext" x="2" y="0.0" z="-9"/>
+    <node id="210" type="ext" x="2" y="0.0" z="-8"/>
+    <node id="211" type="ext" x="2" y="0.0" z="-7"/>
+    <node id="212" type="ext" x="2" y="0.0" z="-6"/>
+    <node id="213" type="ext" x="2" y="0.0" z="-5"/>
+    <node id="214" type="ext" x="2" y="0.0" z="-4"/>
+    <node id="215" type="ext" x="2" y="0.0" z="-3"/>
+    <node id="216" type="ext" x="2" y="0.0" z="-2"/>
+    <node id="217" type="ext" x="2" y="0.0" z="-1"/>
+    <node id="218" type="ext" x="2" y="0.0" z="0"/>
+    <node id="219" type="ext" x="2" y="0.0" z="1"/>
+    <node id="220" type="ext" x="2" y="0.0" z="2"/>
+    <node id="221" type="ext" x="2" y="0.0" z="3"/>
+    <node id="222" type="ext" x="2" y="0.0" z="4"/>
+    <node id="223" type="ext" x="2" y="0.0" z="5"/>
+    <node id="224" type="ext" x="2" y="0.0" z="6"/>
+    <node id="225" type="ext" x="2" y="0.0" z="7"/>
+    <node id="226" type="ext" x="2" y="0.0" z="8"/>
+    <node id="227" type="ext" x="2" y="0.0" z="9"/>
+    <node id="228" type="ext" x="3" y="0.0" z="-9"/>
+    <node id="229" type="ext" x="3" y="0.0" z="-8"/>
+    <node id="230" type="ext" x="3" y="0.0" z="-7"/>
+    <node id="231" type="ext" x="3" y="0.0" z="-6"/>
+    <node id="232" type="ext" x="3" y="0.0" z="-5"/>
+    <node id="233" type="ext" x="3" y="0.0" z="-4"/>
+    <node id="234" type="ext" x="3" y="0.0" z="-3"/>
+    <node id="235" type="ext" x="3" y="0.0" z="-2"/>
+    <node id="236" type="ext" x="3" y="0.0" z="-1"/>
+    <node id="237" type="ext" x="3" y="0.0" z="0"/>
+    <node id="238" type="ext" x="3" y="0.0" z="1"/>
+    <node id="239" type="ext" x="3" y="0.0" z="2"/>
+    <node id="240" type="ext" x="3" y="0.0" z="3"/>
+    <node id="241" type="ext" x="3" y="0.0" z="4"/>
+    <node id="242" type="ext" x="3" y="0.0" z="5"/>
+    <node id="243" type="ext" x="3" y="0.0" z="6"/>
+    <node id="244" type="ext" x="3" y="0.0" z="7"/>
+    <node id="245" type="ext" x="3" y="0.0" z="8"/>
+    <node id="246" type="ext" x="3" y="0.0" z="9"/>
+    <node id="247" type="ext" x="4" y="0.0" z="-9"/>
+    <node id="248" type="ext" x="4" y="0.0" z="-8"/>
+    <node id="249" type="ext" x="4" y="0.0" z="-7"/>
+    <node id="250" type="ext" x="4" y="0.0" z="-6"/>
+    <node id="251" type="ext" x="4" y="0.0" z="-5"/>
+    <node id="252" type="ext" x="4" y="0.0" z="-4"/>
+    <node id="253" type="ext" x="4" y="0.0" z="-3"/>
+    <node id="254" type="ext" x="4" y="0.0" z="-2"/>
+    <node id="255" type="ext" x="4" y="0.0" z="-1"/>
+    <node id="256" type="ext" x="4" y="0.0" z="0"/>
+    <node id="257" type="ext" x="4" y="0.0" z="1"/>
+    <node id="258" type="ext" x="4" y="0.0" z="2"/>
+    <node id="259" type="ext" x="4" y="0.0" z="3"/>
+    <node id="260" type="ext" x="4" y="0.0" z="4"/>
+    <node id="261" type="ext" x="4" y="0.0" z="5"/>
+    <node id="262" type="ext" x="4" y="0.0" z="6"/>
+    <node id="263" type="ext" x="4" y="0.0" z="7"/>
+    <node id="264" type="ext" x="4" y="0.0" z="8"/>
+    <node id="265" type="ext" x="4" y="0.0" z="9"/>
+    <node id="266" type="ext" x="5" y="0.0" z="-9"/>
+    <node id="267" type="ext" x="5" y="0.0" z="-8"/>
+    <node id="268" type="ext" x="5" y="0.0" z="-7"/>
+    <node id="269" type="ext" x="5" y="0.0" z="-6"/>
+    <node id="270" type="ext" x="5" y="0.0" z="-5"/>
+    <node id="271" type="ext" x="5" y="0.0" z="-4"/>
+    <node id="272" type="ext" x="5" y="0.0" z="-3"/>
+    <node id="273" type="ext" x="5" y="0.0" z="-2"/>
+    <node id="274" type="ext" x="5" y="0.0" z="-1"/>
+    <node id="275" type="ext" x="5" y="0.0" z="0"/>
+    <node id="276" type="ext" x="5" y="0.0" z="1"/>
+    <node id="277" type="ext" x="5" y="0.0" z="2"/>
+    <node id="278" type="ext" x="5" y="0.0" z="3"/>
+    <node id="279" type="ext" x="5" y="0.0" z="4"/>
+    <node id="280" type="ext" x="5" y="0.0" z="5"/>
+    <node id="281" type="ext" x="5" y="0.0" z="6"/>
+    <node id="282" type="ext" x="5" y="0.0" z="7"/>
+    <node id="283" type="ext" x="5" y="0.0" z="8"/>
+    <node id="284" type="ext" x="5" y="0.0" z="9"/>
+    <node id="285" type="ext" x="6" y="0.0" z="-9"/>
+    <node id="286" type="ext" x="6" y="0.0" z="-8"/>
+    <node id="287" type="ext" x="6" y="0.0" z="-7"/>
+    <node id="288" type="ext" x="6" y="0.0" z="-6"/>
+    <node id="289" type="ext" x="6" y="0.0" z="-5"/>
+    <node id="290" type="ext" x="6" y="0.0" z="-4"/>
+    <node id="291" type="ext" x="6" y="0.0" z="-3"/>
+    <node id="292" type="ext" x="6" y="0.0" z="-2"/>
+    <node id="293" type="ext" x="6" y="0.0" z="-1"/>
+    <node id="294" type="ext" x="6" y="0.0" z="0"/>
+    <node id="295" type="ext" x="6" y="0.0" z="1"/>
+    <node id="296" type="ext" x="6" y="0.0" z="2"/>
+    <node id="297" type="ext" x="6" y="0.0" z="3"/>
+    <node id="298" type="ext" x="6" y="0.0" z="4"/>
+    <node id="299" type="ext" x="6" y="0.0" z="5"/>
+    <node id="300" type="ext" x="6" y="0.0" z="6"/>
+    <node id="301" type="ext" x="6" y="0.0" z="7"/>
+    <node id="302" type="ext" x="6" y="0.0" z="8"/>
+    <node id="303" type="ext" x="6" y="0.0" z="9"/>
+    <node id="304" type="ext" x="7" y="0.0" z="-9"/>
+    <node id="305" type="ext" x="7" y="0.0" z="-8"/>
+    <node id="306" type="ext" x="7" y="0.0" z="-7"/>
+    <node id="307" type="ext" x="7" y="0.0" z="-6"/>
+    <node id="308" type="ext" x="7" y="0.0" z="-5"/>
+    <node id="309" type="ext" x="7" y="0.0" z="-4"/>
+    <node id="310" type="ext" x="7" y="0.0" z="-3"/>
+    <node id="311" type="ext" x="7" y="0.0" z="-2"/>
+    <node id="312" type="ext" x="7" y="0.0" z="-1"/>
+    <node id="313" type="ext" x="7" y="0.0" z="0"/>
+    <node id="314" type="ext" x="7" y="0.0" z="1"/>
+    <node id="315" type="ext" x="7" y="0.0" z="2"/>
+    <node id="316" type="ext" x="7" y="0.0" z="3"/>
+    <node id="317" type="ext" x="7" y="0.0" z="4"/>
+    <node id="318" type="ext" x="7" y="0.0" z="5"/>
+    <node id="319" type="ext" x="7" y="0.0" z="6"/>
+    <node id="320" type="ext" x="7" y="0.0" z="7"/>
+    <node id="321" type="ext" x="7" y="0.0" z="8"/>
+    <node id="322" type="ext" x="7" y="0.0" z="9"/>
+    <node id="323" type="ext" x="8" y="0.0" z="-9"/>
+    <node id="324" type="ext" x="8" y="0.0" z="-8"/>
+    <node id="325" type="ext" x="8" y="0.0" z="-7"/>
+    <node id="326" type="ext" x="8" y="0.0" z="-6"/>
+    <node id="327" type="ext" x="8" y="0.0" z="-5"/>
+    <node id="328" type="ext" x="8" y="0.0" z="-4"/>
+    <node id="329" type="ext" x="8" y="0.0" z="-3"/>
+    <node id="330" type="ext" x="8" y="0.0" z="-2"/>
+    <node id="331" type="ext" x="8" y="0.0" z="-1"/>
+    <node id="332" type="ext" x="8" y="0.0" z="0"/>
+    <node id="333" type="ext" x="8" y="0.0" z="1"/>
+    <node id="334" type="ext" x="8" y="0.0" z="2"/>
+    <node id="335" type="ext" x="8" y="0.0" z="3"/>
+    <node id="336" type="ext" x="8" y="0.0" z="4"/>
+    <node id="337" type="ext" x="8" y="0.0" z="5"/>
+    <node id="338" type="ext" x="8" y="0.0" z="6"/>
+    <node id="339" type="ext" x="8" y="0.0" z="7"/>
+    <node id="340" type="ext" x="8" y="0.0" z="8"/>
+    <node id="341" type="ext" x="8" y="0.0" z="9"/>
+    <node id="342" type="ext" x="9" y="0.0" z="-9"/>
+    <node id="343" type="ext" x="9" y="0.0" z="-8"/>
+    <node id="344" type="ext" x="9" y="0.0" z="-7"/>
+    <node id="345" type="ext" x="9" y="0.0" z="-6"/>
+    <node id="346" type="ext" x="9" y="0.0" z="-5"/>
+    <node id="347" type="ext" x="9" y="0.0" z="-4"/>
+    <node id="348" type="ext" x="9" y="0.0" z="-3"/>
+    <node id="349" type="ext" x="9" y="0.0" z="-2"/>
+    <node id="350" type="ext" x="9" y="0.0" z="-1"/>
+    <node id="351" type="ext" x="9" y="0.0" z="0"/>
+    <node id="352" type="ext" x="9" y="0.0" z="1"/>
+    <node id="353" type="ext" x="9" y="0.0" z="2"/>
+    <node id="354" type="ext" x="9" y="0.0" z="3"/>
+    <node id="355" type="ext" x="9" y="0.0" z="4"/>
+    <node id="356" type="ext" x="9" y="0.0" z="5"/>
+    <node id="357" type="ext" x="9" y="0.0" z="6"/>
+    <node id="358" type="ext" x="9" y="0.0" z="7"/>
+    <node id="359" type="ext" x="9" y="0.0" z="8"/>
+    <node id="360" type="ext" x="9" y="0.0" z="9"/>
+  </waypointnodes>
+  <waypointedges>
+    <edge source="0" destination="1"/>
+    <edge source="0" destination="19"/>
+    <edge source="1" destination="0"/>
+    <edge source="1" destination="2"/>
+    <edge source="1" destination="20"/>
+    <edge source="2" destination="1"/>
+    <edge source="2" destination="3"/>
+    <edge source="2" destination="21"/>
+    <edge source="3" destination="2"/>
+    <edge source="3" destination="4"/>
+    <edge source="3" destination="22"/>
+    <edge source="4" destination="3"/>
+    <edge source="4" destination="5"/>
+    <edge source="4" destination="23"/>
+    <edge source="5" destination="4"/>
+    <edge source="5" destination="6"/>
+    <edge source="5" destination="24"/>
+    <edge source="6" destination="5"/>
+    <edge source="6" destination="7"/>
+    <edge source="6" destination="25"/>
+    <edge source="7" destination="6"/>
+    <edge source="7" destination="8"/>
+    <edge source="7" destination="26"/>
+    <edge source="8" destination="7"/>
+    <edge source="8" destination="9"/>
+    <edge source="8" destination="27"/>
+    <edge source="9" destination="8"/>
+    <edge source="9" destination="10"/>
+    <edge source="9" destination="28"/>
+    <edge source="10" destination="9"/>
+    <edge source="10" destination="11"/>
+    <edge source="10" destination="29"/>
+    <edge source="11" destination="10"/>
+    <edge source="11" destination="12"/>
+    <edge source="11" destination="30"/>
+    <edge source="12" destination="11"/>
+    <edge source="12" destination="13"/>
+    <edge source="12" destination="31"/>
+    <edge source="13" destination="12"/>
+    <edge source="13" destination="14"/>
+    <edge source="13" destination="32"/>
+    <edge source="14" destination="13"/>
+    <edge source="14" destination="15"/>
+    <edge source="14" destination="33"/>
+    <edge source="15" destination="14"/>
+    <edge source="15" destination="16"/>
+    <edge source="15" destination="34"/>
+    <edge source="16" destination="15"/>
+    <edge source="16" destination="17"/>
+    <edge source="16" destination="35"/>
+    <edge source="17" destination="16"/>
+    <edge source="17" destination="18"/>
+    <edge source="17" destination="36"/>
+    <edge source="18" destination="17"/>
+    <edge source="18" destination="37"/>
+    <edge source="19" destination="20"/>
+    <edge source="19" destination="0"/>
+    <edge source="19" destination="38"/>
+    <edge source="20" destination="19"/>
+    <edge source="20" destination="21"/>
+    <edge source="20" destination="1"/>
+    <edge source="20" destination="39"/>
+    <edge source="21" destination="20"/>
+    <edge source="21" destination="22"/>
+    <edge source="21" destination="2"/>
+    <edge source="21" destination="40"/>
+    <edge source="22" destination="21"/>
+    <edge source="22" destination="23"/>
+    <edge source="22" destination="3"/>
+    <edge source="22" destination="41"/>
+    <edge source="23" destination="22"/>
+    <edge source="23" destination="24"/>
+    <edge source="23" destination="4"/>
+    <edge source="23" destination="42"/>
+    <edge source="24" destination="23"/>
+    <edge source="24" destination="25"/>
+    <edge source="24" destination="5"/>
+    <edge source="24" destination="43"/>
+    <edge source="25" destination="24"/>
+    <edge source="25" destination="26"/>
+    <edge source="25" destination="6"/>
+    <edge source="25" destination="44"/>
+    <edge source="26" destination="25"/>
+    <edge source="26" destination="27"/>
+    <edge source="26" destination="7"/>
+    <edge source="26" destination="45"/>
+    <edge source="27" destination="26"/>
+    <edge source="27" destination="28"/>
+    <edge source="27" destination="8"/>
+    <edge source="27" destination="46"/>
+    <edge source="28" destination="27"/>
+    <edge source="28" destination="29"/>
+    <edge source="28" destination="9"/>
+    <edge source="28" destination="47"/>
+    <edge source="29" destination="28"/>
+    <edge source="29" destination="30"/>
+    <edge source="29" destination="10"/>
+    <edge source="29" destination="48"/>
+    <edge source="30" destination="29"/>
+    <edge source="30" destination="31"/>
+    <edge source="30" destination="11"/>
+    <edge source="30" destination="49"/>
+    <edge source="31" destination="30"/>
+    <edge source="31" destination="32"/>
+    <edge source="31" destination="12"/>
+    <edge source="31" destination="50"/>
+    <edge source="32" destination="31"/>
+    <edge source="32" destination="33"/>
+    <edge source="32" destination="13"/>
+    <edge source="32" destination="51"/>
+    <edge source="33" destination="32"/>
+    <edge source="33" destination="34"/>
+    <edge source="33" destination="14"/>
+    <edge source="33" destination="52"/>
+    <edge source="34" destination="33"/>
+    <edge source="34" destination="35"/>
+    <edge source="34" destination="15"/>
+    <edge source="34" destination="53"/>
+    <edge source="35" destination="34"/>
+    <edge source="35" destination="36"/>
+    <edge source="35" destination="16"/>
+    <edge source="35" destination="54"/>
+    <edge source="36" destination="35"/>
+    <edge source="36" destination="37"/>
+    <edge source="36" destination="17"/>
+    <edge source="36" destination="55"/>
+    <edge source="37" destination="36"/>
+    <edge source="37" destination="18"/>
+    <edge source="37" destination="56"/>
+    <edge source="38" destination="39"/>
+    <edge source="38" destination="19"/>
+    <edge source="38" destination="57"/>
+    <edge source="39" destination="38"/>
+    <edge source="39" destination="40"/>
+    <edge source="39" destination="20"/>
+    <edge source="39" destination="58"/>
+    <edge source="40" destination="39"/>
+    <edge source="40" destination="41"/>
+    <edge source="40" destination="21"/>
+    <edge source="40" destination="59"/>
+    <edge source="41" destination="40"/>
+    <edge source="41" destination="42"/>
+    <edge source="41" destination="22"/>
+    <edge source="41" destination="60"/>
+    <edge source="42" destination="41"/>
+    <edge source="42" destination="43"/>
+    <edge source="42" destination="23"/>
+    <edge source="42" destination="61"/>
+    <edge source="43" destination="42"/>
+    <edge source="43" destination="44"/>
+    <edge source="43" destination="24"/>
+    <edge source="43" destination="62"/>
+    <edge source="44" destination="43"/>
+    <edge source="44" destination="45"/>
+    <edge source="44" destination="25"/>
+    <edge source="44" destination="63"/>
+    <edge source="45" destination="44"/>
+    <edge source="45" destination="46"/>
+    <edge source="45" destination="26"/>
+    <edge source="45" destination="64"/>
+    <edge source="46" destination="45"/>
+    <edge source="46" destination="47"/>
+    <edge source="46" destination="27"/>
+    <edge source="46" destination="65"/>
+    <edge source="47" destination="46"/>
+    <edge source="47" destination="48"/>
+    <edge source="47" destination="28"/>
+    <edge source="47" destination="66"/>
+    <edge source="48" destination="47"/>
+    <edge source="48" destination="49"/>
+    <edge source="48" destination="29"/>
+    <edge source="48" destination="67"/>
+    <edge source="49" destination="48"/>
+    <edge source="49" destination="50"/>
+    <edge source="49" destination="30"/>
+    <edge source="49" destination="68"/>
+    <edge source="50" destination="49"/>
+    <edge source="50" destination="51"/>
+    <edge source="50" destination="31"/>
+    <edge source="50" destination="69"/>
+    <edge source="51" destination="50"/>
+    <edge source="51" destination="52"/>
+    <edge source="51" destination="32"/>
+    <edge source="51" destination="70"/>
+    <edge source="52" destination="51"/>
+    <edge source="52" destination="53"/>
+    <edge source="52" destination="33"/>
+    <edge source="52" destination="71"/>
+    <edge source="53" destination="52"/>
+    <edge source="53" destination="54"/>
+    <edge source="53" destination="34"/>
+    <edge source="53" destination="72"/>
+    <edge source="54" destination="53"/>
+    <edge source="54" destination="55"/>
+    <edge source="54" destination="35"/>
+    <edge source="54" destination="73"/>
+    <edge source="55" destination="54"/>
+    <edge source="55" destination="56"/>
+    <edge source="55" destination="36"/>
+    <edge source="55" destination="74"/>
+    <edge source="56" destination="55"/>
+    <edge source="56" destination="37"/>
+    <edge source="56" destination="75"/>
+    <edge source="57" destination="58"/>
+    <edge source="57" destination="38"/>
+    <edge source="57" destination="76"/>
+    <edge source="58" destination="57"/>
+    <edge source="58" destination="59"/>
+    <edge source="58" destination="39"/>
+    <edge source="58" destination="77"/>
+    <edge source="59" destination="58"/>
+    <edge source="59" destination="60"/>
+    <edge source="59" destination="40"/>
+    <edge source="59" destination="78"/>
+    <edge source="60" destination="59"/>
+    <edge source="60" destination="61"/>
+    <edge source="60" destination="41"/>
+    <edge source="60" destination="79"/>
+    <edge source="61" destination="60"/>
+    <edge source="61" destination="62"/>
+    <edge source="61" destination="42"/>
+    <edge source="61" destination="80"/>
+    <edge source="62" destination="61"/>
+    <edge source="62" destination="63"/>
+    <edge source="62" destination="43"/>
+    <edge source="62" destination="81"/>
+    <edge source="63" destination="62"/>
+    <edge source="63" destination="64"/>
+    <edge source="63" destination="44"/>
+    <edge source="63" destination="82"/>
+    <edge source="64" destination="63"/>
+    <edge source="64" destination="65"/>
+    <edge source="64" destination="45"/>
+    <edge source="64" destination="83"/>
+    <edge source="65" destination="64"/>
+    <edge source="65" destination="66"/>
+    <edge source="65" destination="46"/>
+    <edge source="65" destination="84"/>
+    <edge source="66" destination="65"/>
+    <edge source="66" destination="67"/>
+    <edge source="66" destination="47"/>
+    <edge source="66" destination="85"/>
+    <edge source="67" destination="66"/>
+    <edge source="67" destination="68"/>
+    <edge source="67" destination="48"/>
+    <edge source="67" destination="86"/>
+    <edge source="68" destination="67"/>
+    <edge source="68" destination="69"/>
+    <edge source="68" destination="49"/>
+    <edge source="68" destination="87"/>
+    <edge source="69" destination="68"/>
+    <edge source="69" destination="70"/>
+    <edge source="69" destination="50"/>
+    <edge source="69" destination="88"/>
+    <edge source="70" destination="69"/>
+    <edge source="70" destination="71"/>
+    <edge source="70" destination="51"/>
+    <edge source="70" destination="89"/>
+    <edge source="71" destination="70"/>
+    <edge source="71" destination="72"/>
+    <edge source="71" destination="52"/>
+    <edge source="71" destination="90"/>
+    <edge source="72" destination="71"/>
+    <edge source="72" destination="73"/>
+    <edge source="72" destination="53"/>
+    <edge source="72" destination="91"/>
+    <edge source="73" destination="72"/>
+    <edge source="73" destination="74"/>
+    <edge source="73" destination="54"/>
+    <edge source="73" destination="92"/>
+    <edge source="74" destination="73"/>
+    <edge source="74" destination="75"/>
+    <edge source="74" destination="55"/>
+    <edge source="74" destination="93"/>
+    <edge source="75" destination="74"/>
+    <edge source="75" destination="56"/>
+    <edge source="75" destination="94"/>
+    <edge source="76" destination="77"/>
+    <edge source="76" destination="57"/>
+    <edge source="76" destination="95"/>
+    <edge source="77" destination="76"/>
+    <edge source="77" destination="78"/>
+    <edge source="77" destination="58"/>
+    <edge source="77" destination="96"/>
+    <edge source="78" destination="77"/>
+    <edge source="78" destination="79"/>
+    <edge source="78" destination="59"/>
+    <edge source="78" destination="97"/>
+    <edge source="79" destination="78"/>
+    <edge source="79" destination="80"/>
+    <edge source="79" destination="60"/>
+    <edge source="79" destination="98"/>
+    <edge source="80" destination="79"/>
+    <edge source="80" destination="81"/>
+    <edge source="80" destination="61"/>
+    <edge source="80" destination="99"/>
+    <edge source="81" destination="80"/>
+    <edge source="81" destination="82"/>
+    <edge source="81" destination="62"/>
+    <edge source="81" destination="100"/>
+    <edge source="82" destination="81"/>
+    <edge source="82" destination="83"/>
+    <edge source="82" destination="63"/>
+    <edge source="82" destination="101"/>
+    <edge source="83" destination="82"/>
+    <edge source="83" destination="84"/>
+    <edge source="83" destination="64"/>
+    <edge source="83" destination="102"/>
+    <edge source="84" destination="83"/>
+    <edge source="84" destination="85"/>
+    <edge source="84" destination="65"/>
+    <edge source="84" destination="103"/>
+    <edge source="85" destination="84"/>
+    <edge source="85" destination="86"/>
+    <edge source="85" destination="66"/>
+    <edge source="85" destination="104"/>
+    <edge source="86" destination="85"/>
+    <edge source="86" destination="87"/>
+    <edge source="86" destination="67"/>
+    <edge source="86" destination="105"/>
+    <edge source="87" destination="86"/>
+    <edge source="87" destination="88"/>
+    <edge source="87" destination="68"/>
+    <edge source="87" destination="106"/>
+    <edge source="88" destination="87"/>
+    <edge source="88" destination="89"/>
+    <edge source="88" destination="69"/>
+    <edge source="88" destination="107"/>
+    <edge source="89" destination="88"/>
+    <edge source="89" destination="90"/>
+    <edge source="89" destination="70"/>
+    <edge source="89" destination="108"/>
+    <edge source="90" destination="89"/>
+    <edge source="90" destination="91"/>
+    <edge source="90" destination="71"/>
+    <edge source="90" destination="109"/>
+    <edge source="91" destination="90"/>
+    <edge source="91" destination="92"/>
+    <edge source="91" destination="72"/>
+    <edge source="91" destination="110"/>
+    <edge source="92" destination="91"/>
+    <edge source="92" destination="93"/>
+    <edge source="92" destination="73"/>
+    <edge source="92" destination="111"/>
+    <edge source="93" destination="92"/>
+    <edge source="93" destination="94"/>
+    <edge source="93" destination="74"/>
+    <edge source="93" destination="112"/>
+    <edge source="94" destination="93"/>
+    <edge source="94" destination="75"/>
+    <edge source="94" destination="113"/>
+    <edge source="95" destination="96"/>
+    <edge source="95" destination="76"/>
+    <edge source="95" destination="114"/>
+    <edge source="96" destination="95"/>
+    <edge source="96" destination="97"/>
+    <edge source="96" destination="77"/>
+    <edge source="96" destination="115"/>
+    <edge source="97" destination="96"/>
+    <edge source="97" destination="98"/>
+    <edge source="97" destination="78"/>
+    <edge source="97" destination="116"/>
+    <edge source="98" destination="97"/>
+    <edge source="98" destination="99"/>
+    <edge source="98" destination="79"/>
+    <edge source="98" destination="117"/>
+    <edge source="99" destination="98"/>
+    <edge source="99" destination="100"/>
+    <edge source="99" destination="80"/>
+    <edge source="99" destination="118"/>
+    <edge source="100" destination="99"/>
+    <edge source="100" destination="101"/>
+    <edge source="100" destination="81"/>
+    <edge source="100" destination="119"/>
+    <edge source="101" destination="100"/>
+    <edge source="101" destination="102"/>
+    <edge source="101" destination="82"/>
+    <edge source="101" destination="120"/>
+    <edge source="102" destination="101"/>
+    <edge source="102" destination="103"/>
+    <edge source="102" destination="83"/>
+    <edge source="102" destination="121"/>
+    <edge source="103" destination="102"/>
+    <edge source="103" destination="104"/>
+    <edge source="103" destination="84"/>
+    <edge source="103" destination="122"/>
+    <edge source="104" destination="103"/>
+    <edge source="104" destination="105"/>
+    <edge source="104" destination="85"/>
+    <edge source="104" destination="123"/>
+    <edge source="105" destination="104"/>
+    <edge source="105" destination="106"/>
+    <edge source="105" destination="86"/>
+    <edge source="105" destination="124"/>
+    <edge source="106" destination="105"/>
+    <edge source="106" destination="107"/>
+    <edge source="106" destination="87"/>
+    <edge source="106" destination="125"/>
+    <edge source="107" destination="106"/>
+    <edge source="107" destination="108"/>
+    <edge source="107" destination="88"/>
+    <edge source="107" destination="126"/>
+    <edge source="108" destination="107"/>
+    <edge source="108" destination="109"/>
+    <edge source="108" destination="89"/>
+    <edge source="108" destination="127"/>
+    <edge source="109" destination="108"/>
+    <edge source="109" destination="110"/>
+    <edge source="109" destination="90"/>
+    <edge source="109" destination="128"/>
+    <edge source="110" destination="109"/>
+    <edge source="110" destination="111"/>
+    <edge source="110" destination="91"/>
+    <edge source="110" destination="129"/>
+    <edge source="111" destination="110"/>
+    <edge source="111" destination="112"/>
+    <edge source="111" destination="92"/>
+    <edge source="111" destination="130"/>
+    <edge source="112" destination="111"/>
+    <edge source="112" destination="113"/>
+    <edge source="112" destination="93"/>
+    <edge source="112" destination="131"/>
+    <edge source="113" destination="112"/>
+    <edge source="113" destination="94"/>
+    <edge source="113" destination="132"/>
+    <edge source="114" destination="115"/>
+    <edge source="114" destination="95"/>
+    <edge source="114" destination="133"/>
+    <edge source="115" destination="114"/>
+    <edge source="115" destination="116"/>
+    <edge source="115" destination="96"/>
+    <edge source="115" destination="134"/>
+    <edge source="116" destination="115"/>
+    <edge source="116" destination="117"/>
+    <edge source="116" destination="97"/>
+    <edge source="116" destination="135"/>
+    <edge source="117" destination="116"/>
+    <edge source="117" destination="118"/>
+    <edge source="117" destination="98"/>
+    <edge source="117" destination="136"/>
+    <edge source="118" destination="117"/>
+    <edge source="118" destination="119"/>
+    <edge source="118" destination="99"/>
+    <edge source="118" destination="137"/>
+    <edge source="119" destination="118"/>
+    <edge source="119" destination="120"/>
+    <edge source="119" destination="100"/>
+    <edge source="119" destination="138"/>
+    <edge source="120" destination="119"/>
+    <edge source="120" destination="121"/>
+    <edge source="120" destination="101"/>
+    <edge source="120" destination="139"/>
+    <edge source="121" destination="120"/>
+    <edge source="121" destination="122"/>
+    <edge source="121" destination="102"/>
+    <edge source="121" destination="140"/>
+    <edge source="122" destination="121"/>
+    <edge source="122" destination="123"/>
+    <edge source="122" destination="103"/>
+    <edge source="122" destination="141"/>
+    <edge source="123" destination="122"/>
+    <edge source="123" destination="124"/>
+    <edge source="123" destination="104"/>
+    <edge source="123" destination="142"/>
+    <edge source="124" destination="123"/>
+    <edge source="124" destination="125"/>
+    <edge source="124" destination="105"/>
+    <edge source="124" destination="143"/>
+    <edge source="125" destination="124"/>
+    <edge source="125" destination="126"/>
+    <edge source="125" destination="106"/>
+    <edge source="125" destination="144"/>
+    <edge source="126" destination="125"/>
+    <edge source="126" destination="127"/>
+    <edge source="126" destination="107"/>
+    <edge source="126" destination="145"/>
+    <edge source="127" destination="126"/>
+    <edge source="127" destination="128"/>
+    <edge source="127" destination="108"/>
+    <edge source="127" destination="146"/>
+    <edge source="128" destination="127"/>
+    <edge source="128" destination="129"/>
+    <edge source="128" destination="109"/>
+    <edge source="128" destination="147"/>
+    <edge source="129" destination="128"/>
+    <edge source="129" destination="130"/>
+    <edge source="129" destination="110"/>
+    <edge source="129" destination="148"/>
+    <edge source="130" destination="129"/>
+    <edge source="130" destination="131"/>
+    <edge source="130" destination="111"/>
+    <edge source="130" destination="149"/>
+    <edge source="131" destination="130"/>
+    <edge source="131" destination="132"/>
+    <edge source="131" destination="112"/>
+    <edge source="131" destination="150"/>
+    <edge source="132" destination="131"/>
+    <edge source="132" destination="113"/>
+    <edge source="132" destination="151"/>
+    <edge source="133" destination="134"/>
+    <edge source="133" destination="114"/>
+    <edge source="133" destination="152"/>
+    <edge source="134" destination="133"/>
+    <edge source="134" destination="135"/>
+    <edge source="134" destination="115"/>
+    <edge source="134" destination="153"/>
+    <edge source="135" destination="134"/>
+    <edge source="135" destination="136"/>
+    <edge source="135" destination="116"/>
+    <edge source="135" destination="154"/>
+    <edge source="136" destination="135"/>
+    <edge source="136" destination="137"/>
+    <edge source="136" destination="117"/>
+    <edge source="136" destination="155"/>
+    <edge source="137" destination="136"/>
+    <edge source="137" destination="138"/>
+    <edge source="137" destination="118"/>
+    <edge source="137" destination="156"/>
+    <edge source="138" destination="137"/>
+    <edge source="138" destination="139"/>
+    <edge source="138" destination="119"/>
+    <edge source="138" destination="157"/>
+    <edge source="139" destination="138"/>
+    <edge source="139" destination="140"/>
+    <edge source="139" destination="120"/>
+    <edge source="139" destination="158"/>
+    <edge source="140" destination="139"/>
+    <edge source="140" destination="141"/>
+    <edge source="140" destination="121"/>
+    <edge source="140" destination="159"/>
+    <edge source="141" destination="140"/>
+    <edge source="141" destination="142"/>
+    <edge source="141" destination="122"/>
+    <edge source="141" destination="160"/>
+    <edge source="142" destination="141"/>
+    <edge source="142" destination="143"/>
+    <edge source="142" destination="123"/>
+    <edge source="142" destination="161"/>
+    <edge source="143" destination="142"/>
+    <edge source="143" destination="144"/>
+    <edge source="143" destination="124"/>
+    <edge source="143" destination="162"/>
+    <edge source="144" destination="143"/>
+    <edge source="144" destination="145"/>
+    <edge source="144" destination="125"/>
+    <edge source="144" destination="163"/>
+    <edge source="145" destination="144"/>
+    <edge source="145" destination="146"/>
+    <edge source="145" destination="126"/>
+    <edge source="145" destination="164"/>
+    <edge source="146" destination="145"/>
+    <edge source="146" destination="147"/>
+    <edge source="146" destination="127"/>
+    <edge source="146" destination="165"/>
+    <edge source="147" destination="146"/>
+    <edge source="147" destination="148"/>
+    <edge source="147" destination="128"/>
+    <edge source="147" destination="166"/>
+    <edge source="148" destination="147"/>
+    <edge source="148" destination="149"/>
+    <edge source="148" destination="129"/>
+    <edge source="148" destination="167"/>
+    <edge source="149" destination="148"/>
+    <edge source="149" destination="150"/>
+    <edge source="149" destination="130"/>
+    <edge source="149" destination="168"/>
+    <edge source="150" destination="149"/>
+    <edge source="150" destination="151"/>
+    <edge source="150" destination="131"/>
+    <edge source="150" destination="169"/>
+    <edge source="151" destination="150"/>
+    <edge source="151" destination="132"/>
+    <edge source="151" destination="170"/>
+    <edge source="152" destination="153"/>
+    <edge source="152" destination="133"/>
+    <edge source="152" destination="171"/>
+    <edge source="153" destination="152"/>
+    <edge source="153" destination="154"/>
+    <edge source="153" destination="134"/>
+    <edge source="153" destination="172"/>
+    <edge source="154" destination="153"/>
+    <edge source="154" destination="155"/>
+    <edge source="154" destination="135"/>
+    <edge source="154" destination="173"/>
+    <edge source="155" destination="154"/>
+    <edge source="155" destination="156"/>
+    <edge source="155" destination="136"/>
+    <edge source="155" destination="174"/>
+    <edge source="156" destination="155"/>
+    <edge source="156" destination="157"/>
+    <edge source="156" destination="137"/>
+    <edge source="156" destination="175"/>
+    <edge source="157" destination="156"/>
+    <edge source="157" destination="158"/>
+    <edge source="157" destination="138"/>
+    <edge source="157" destination="176"/>
+    <edge source="158" destination="157"/>
+    <edge source="158" destination="159"/>
+    <edge source="158" destination="139"/>
+    <edge source="158" destination="177"/>
+    <edge source="159" destination="158"/>
+    <edge source="159" destination="160"/>
+    <edge source="159" destination="140"/>
+    <edge source="159" destination="178"/>
+    <edge source="160" destination="159"/>
+    <edge source="160" destination="161"/>
+    <edge source="160" destination="141"/>
+    <edge source="160" destination="179"/>
+    <edge source="161" destination="160"/>
+    <edge source="161" destination="162"/>
+    <edge source="161" destination="142"/>
+    <edge source="161" destination="180"/>
+    <edge source="162" destination="161"/>
+    <edge source="162" destination="163"/>
+    <edge source="162" destination="143"/>
+    <edge source="162" destination="181"/>
+    <edge source="163" destination="162"/>
+    <edge source="163" destination="164"/>
+    <edge source="163" destination="144"/>
+    <edge source="163" destination="182"/>
+    <edge source="164" destination="163"/>
+    <edge source="164" destination="165"/>
+    <edge source="164" destination="145"/>
+    <edge source="164" destination="183"/>
+    <edge source="165" destination="164"/>
+    <edge source="165" destination="166"/>
+    <edge source="165" destination="146"/>
+    <edge source="165" destination="184"/>
+    <edge source="166" destination="165"/>
+    <edge source="166" destination="167"/>
+    <edge source="166" destination="147"/>
+    <edge source="166" destination="185"/>
+    <edge source="167" destination="166"/>
+    <edge source="167" destination="168"/>
+    <edge source="167" destination="148"/>
+    <edge source="167" destination="186"/>
+    <edge source="168" destination="167"/>
+    <edge source="168" destination="169"/>
+    <edge source="168" destination="149"/>
+    <edge source="168" destination="187"/>
+    <edge source="169" destination="168"/>
+    <edge source="169" destination="170"/>
+    <edge source="169" destination="150"/>
+    <edge source="169" destination="188"/>
+    <edge source="170" destination="169"/>
+    <edge source="170" destination="151"/>
+    <edge source="170" destination="189"/>
+    <edge source="171" destination="172"/>
+    <edge source="171" destination="152"/>
+    <edge source="171" destination="190"/>
+    <edge source="172" destination="171"/>
+    <edge source="172" destination="173"/>
+    <edge source="172" destination="153"/>
+    <edge source="172" destination="191"/>
+    <edge source="173" destination="172"/>
+    <edge source="173" destination="174"/>
+    <edge source="173" destination="154"/>
+    <edge source="173" destination="192"/>
+    <edge source="174" destination="173"/>
+    <edge source="174" destination="175"/>
+    <edge source="174" destination="155"/>
+    <edge source="174" destination="193"/>
+    <edge source="175" destination="174"/>
+    <edge source="175" destination="176"/>
+    <edge source="175" destination="156"/>
+    <edge source="175" destination="194"/>
+    <edge source="176" destination="175"/>
+    <edge source="176" destination="177"/>
+    <edge source="176" destination="157"/>
+    <edge source="176" destination="195"/>
+    <edge source="177" destination="176"/>
+    <edge source="177" destination="178"/>
+    <edge source="177" destination="158"/>
+    <edge source="177" destination="196"/>
+    <edge source="178" destination="177"/>
+    <edge source="178" destination="179"/>
+    <edge source="178" destination="159"/>
+    <edge source="178" destination="197"/>
+    <edge source="179" destination="178"/>
+    <edge source="179" destination="180"/>
+    <edge source="179" destination="160"/>
+    <edge source="179" destination="198"/>
+    <edge source="180" destination="179"/>
+    <edge source="180" destination="181"/>
+    <edge source="180" destination="161"/>
+    <edge source="180" destination="199"/>
+    <edge source="181" destination="180"/>
+    <edge source="181" destination="182"/>
+    <edge source="181" destination="162"/>
+    <edge source="181" destination="200"/>
+    <edge source="182" destination="181"/>
+    <edge source="182" destination="183"/>
+    <edge source="182" destination="163"/>
+    <edge source="182" destination="201"/>
+    <edge source="183" destination="182"/>
+    <edge source="183" destination="184"/>
+    <edge source="183" destination="164"/>
+    <edge source="183" destination="202"/>
+    <edge source="184" destination="183"/>
+    <edge source="184" destination="185"/>
+    <edge source="184" destination="165"/>
+    <edge source="184" destination="203"/>
+    <edge source="185" destination="184"/>
+    <edge source="185" destination="186"/>
+    <edge source="185" destination="166"/>
+    <edge source="185" destination="204"/>
+    <edge source="186" destination="185"/>
+    <edge source="186" destination="187"/>
+    <edge source="186" destination="167"/>
+    <edge source="186" destination="205"/>
+    <edge source="187" destination="186"/>
+    <edge source="187" destination="188"/>
+    <edge source="187" destination="168"/>
+    <edge source="187" destination="206"/>
+    <edge source="188" destination="187"/>
+    <edge source="188" destination="189"/>
+    <edge source="188" destination="169"/>
+    <edge source="188" destination="207"/>
+    <edge source="189" destination="188"/>
+    <edge source="189" destination="170"/>
+    <edge source="189" destination="208"/>
+    <edge source="190" destination="191"/>
+    <edge source="190" destination="171"/>
+    <edge source="190" destination="209"/>
+    <edge source="191" destination="190"/>
+    <edge source="191" destination="192"/>
+    <edge source="191" destination="172"/>
+    <edge source="191" destination="210"/>
+    <edge source="192" destination="191"/>
+    <edge source="192" destination="193"/>
+    <edge source="192" destination="173"/>
+    <edge source="192" destination="211"/>
+    <edge source="193" destination="192"/>
+    <edge source="193" destination="194"/>
+    <edge source="193" destination="174"/>
+    <edge source="193" destination="212"/>
+    <edge source="194" destination="193"/>
+    <edge source="194" destination="195"/>
+    <edge source="194" destination="175"/>
+    <edge source="194" destination="213"/>
+    <edge source="195" destination="194"/>
+    <edge source="195" destination="196"/>
+    <edge source="195" destination="176"/>
+    <edge source="195" destination="214"/>
+    <edge source="196" destination="195"/>
+    <edge source="196" destination="197"/>
+    <edge source="196" destination="177"/>
+    <edge source="196" destination="215"/>
+    <edge source="197" destination="196"/>
+    <edge source="197" destination="198"/>
+    <edge source="197" destination="178"/>
+    <edge source="197" destination="216"/>
+    <edge source="198" destination="197"/>
+    <edge source="198" destination="199"/>
+    <edge source="198" destination="179"/>
+    <edge source="198" destination="217"/>
+    <edge source="199" destination="198"/>
+    <edge source="199" destination="200"/>
+    <edge source="199" destination="180"/>
+    <edge source="199" destination="218"/>
+    <edge source="200" destination="199"/>
+    <edge source="200" destination="201"/>
+    <edge source="200" destination="181"/>
+    <edge source="200" destination="219"/>
+    <edge source="201" destination="200"/>
+    <edge source="201" destination="202"/>
+    <edge source="201" destination="182"/>
+    <edge source="201" destination="220"/>
+    <edge source="202" destination="201"/>
+    <edge source="202" destination="203"/>
+    <edge source="202" destination="183"/>
+    <edge source="202" destination="221"/>
+    <edge source="203" destination="202"/>
+    <edge source="203" destination="204"/>
+    <edge source="203" destination="184"/>
+    <edge source="203" destination="222"/>
+    <edge source="204" destination="203"/>
+    <edge source="204" destination="205"/>
+    <edge source="204" destination="185"/>
+    <edge source="204" destination="223"/>
+    <edge source="205" destination="204"/>
+    <edge source="205" destination="206"/>
+    <edge source="205" destination="186"/>
+    <edge source="205" destination="224"/>
+    <edge source="206" destination="205"/>
+    <edge source="206" destination="207"/>
+    <edge source="206" destination="187"/>
+    <edge source="206" destination="225"/>
+    <edge source="207" destination="206"/>
+    <edge source="207" destination="208"/>
+    <edge source="207" destination="188"/>
+    <edge source="207" destination="226"/>
+    <edge source="208" destination="207"/>
+    <edge source="208" destination="189"/>
+    <edge source="208" destination="227"/>
+    <edge source="209" destination="210"/>
+    <edge source="209" destination="190"/>
+    <edge source="209" destination="228"/>
+    <edge source="210" destination="209"/>
+    <edge source="210" destination="211"/>
+    <edge source="210" destination="191"/>
+    <edge source="210" destination="229"/>
+    <edge source="211" destination="210"/>
+    <edge source="211" destination="212"/>
+    <edge source="211" destination="192"/>
+    <edge source="211" destination="230"/>
+    <edge source="212" destination="211"/>
+    <edge source="212" destination="213"/>
+    <edge source="212" destination="193"/>
+    <edge source="212" destination="231"/>
+    <edge source="213" destination="212"/>
+    <edge source="213" destination="214"/>
+    <edge source="213" destination="194"/>
+    <edge source="213" destination="232"/>
+    <edge source="214" destination="213"/>
+    <edge source="214" destination="215"/>
+    <edge source="214" destination="195"/>
+    <edge source="214" destination="233"/>
+    <edge source="215" destination="214"/>
+    <edge source="215" destination="216"/>
+    <edge source="215" destination="196"/>
+    <edge source="215" destination="234"/>
+    <edge source="216" destination="215"/>
+    <edge source="216" destination="217"/>
+    <edge source="216" destination="197"/>
+    <edge source="216" destination="235"/>
+    <edge source="217" destination="216"/>
+    <edge source="217" destination="218"/>
+    <edge source="217" destination="198"/>
+    <edge source="217" destination="236"/>
+    <edge source="218" destination="217"/>
+    <edge source="218" destination="219"/>
+    <edge source="218" destination="199"/>
+    <edge source="218" destination="237"/>
+    <edge source="219" destination="218"/>
+    <edge source="219" destination="220"/>
+    <edge source="219" destination="200"/>
+    <edge source="219" destination="238"/>
+    <edge source="220" destination="219"/>
+    <edge source="220" destination="221"/>
+    <edge source="220" destination="201"/>
+    <edge source="220" destination="239"/>
+    <edge source="221" destination="220"/>
+    <edge source="221" destination="222"/>
+    <edge source="221" destination="202"/>
+    <edge source="221" destination="240"/>
+    <edge source="222" destination="221"/>
+    <edge source="222" destination="223"/>
+    <edge source="222" destination="203"/>
+    <edge source="222" destination="241"/>
+    <edge source="223" destination="222"/>
+    <edge source="223" destination="224"/>
+    <edge source="223" destination="204"/>
+    <edge source="223" destination="242"/>
+    <edge source="224" destination="223"/>
+    <edge source="224" destination="225"/>
+    <edge source="224" destination="205"/>
+    <edge source="224" destination="243"/>
+    <edge source="225" destination="224"/>
+    <edge source="225" destination="226"/>
+    <edge source="225" destination="206"/>
+    <edge source="225" destination="244"/>
+    <edge source="226" destination="225"/>
+    <edge source="226" destination="227"/>
+    <edge source="226" destination="207"/>
+    <edge source="226" destination="245"/>
+    <edge source="227" destination="226"/>
+    <edge source="227" destination="208"/>
+    <edge source="227" destination="246"/>
+    <edge source="228" destination="229"/>
+    <edge source="228" destination="209"/>
+    <edge source="228" destination="247"/>
+    <edge source="229" destination="228"/>
+    <edge source="229" destination="230"/>
+    <edge source="229" destination="210"/>
+    <edge source="229" destination="248"/>
+    <edge source="230" destination="229"/>
+    <edge source="230" destination="231"/>
+    <edge source="230" destination="211"/>
+    <edge source="230" destination="249"/>
+    <edge source="231" destination="230"/>
+    <edge source="231" destination="232"/>
+    <edge source="231" destination="212"/>
+    <edge source="231" destination="250"/>
+    <edge source="232" destination="231"/>
+    <edge source="232" destination="233"/>
+    <edge source="232" destination="213"/>
+    <edge source="232" destination="251"/>
+    <edge source="233" destination="232"/>
+    <edge source="233" destination="234"/>
+    <edge source="233" destination="214"/>
+    <edge source="233" destination="252"/>
+    <edge source="234" destination="233"/>
+    <edge source="234" destination="235"/>
+    <edge source="234" destination="215"/>
+    <edge source="234" destination="253"/>
+    <edge source="235" destination="234"/>
+    <edge source="235" destination="236"/>
+    <edge source="235" destination="216"/>
+    <edge source="235" destination="254"/>
+    <edge source="236" destination="235"/>
+    <edge source="236" destination="237"/>
+    <edge source="236" destination="217"/>
+    <edge source="236" destination="255"/>
+    <edge source="237" destination="236"/>
+    <edge source="237" destination="238"/>
+    <edge source="237" destination="218"/>
+    <edge source="237" destination="256"/>
+    <edge source="238" destination="237"/>
+    <edge source="238" destination="239"/>
+    <edge source="238" destination="219"/>
+    <edge source="238" destination="257"/>
+    <edge source="239" destination="238"/>
+    <edge source="239" destination="240"/>
+    <edge source="239" destination="220"/>
+    <edge source="239" destination="258"/>
+    <edge source="240" destination="239"/>
+    <edge source="240" destination="241"/>
+    <edge source="240" destination="221"/>
+    <edge source="240" destination="259"/>
+    <edge source="241" destination="240"/>
+    <edge source="241" destination="242"/>
+    <edge source="241" destination="222"/>
+    <edge source="241" destination="260"/>
+    <edge source="242" destination="241"/>
+    <edge source="242" destination="243"/>
+    <edge source="242" destination="223"/>
+    <edge source="242" destination="261"/>
+    <edge source="243" destination="242"/>
+    <edge source="243" destination="244"/>
+    <edge source="243" destination="224"/>
+    <edge source="243" destination="262"/>
+    <edge source="244" destination="243"/>
+    <edge source="244" destination="245"/>
+    <edge source="244" destination="225"/>
+    <edge source="244" destination="263"/>
+    <edge source="245" destination="244"/>
+    <edge source="245" destination="246"/>
+    <edge source="245" destination="226"/>
+    <edge source="245" destination="264"/>
+    <edge source="246" destination="245"/>
+    <edge source="246" destination="227"/>
+    <edge source="246" destination="265"/>
+    <edge source="247" destination="248"/>
+    <edge source="247" destination="228"/>
+    <edge source="247" destination="266"/>
+    <edge source="248" destination="247"/>
+    <edge source="248" destination="249"/>
+    <edge source="248" destination="229"/>
+    <edge source="248" destination="267"/>
+    <edge source="249" destination="248"/>
+    <edge source="249" destination="250"/>
+    <edge source="249" destination="230"/>
+    <edge source="249" destination="268"/>
+    <edge source="250" destination="249"/>
+    <edge source="250" destination="251"/>
+    <edge source="250" destination="231"/>
+    <edge source="250" destination="269"/>
+    <edge source="251" destination="250"/>
+    <edge source="251" destination="252"/>
+    <edge source="251" destination="232"/>
+    <edge source="251" destination="270"/>
+    <edge source="252" destination="251"/>
+    <edge source="252" destination="253"/>
+    <edge source="252" destination="233"/>
+    <edge source="252" destination="271"/>
+    <edge source="253" destination="252"/>
+    <edge source="253" destination="254"/>
+    <edge source="253" destination="234"/>
+    <edge source="253" destination="272"/>
+    <edge source="254" destination="253"/>
+    <edge source="254" destination="255"/>
+    <edge source="254" destination="235"/>
+    <edge source="254" destination="273"/>
+    <edge source="255" destination="254"/>
+    <edge source="255" destination="256"/>
+    <edge source="255" destination="236"/>
+    <edge source="255" destination="274"/>
+    <edge source="256" destination="255"/>
+    <edge source="256" destination="257"/>
+    <edge source="256" destination="237"/>
+    <edge source="256" destination="275"/>
+    <edge source="257" destination="256"/>
+    <edge source="257" destination="258"/>
+    <edge source="257" destination="238"/>
+    <edge source="257" destination="276"/>
+    <edge source="258" destination="257"/>
+    <edge source="258" destination="259"/>
+    <edge source="258" destination="239"/>
+    <edge source="258" destination="277"/>
+    <edge source="259" destination="258"/>
+    <edge source="259" destination="260"/>
+    <edge source="259" destination="240"/>
+    <edge source="259" destination="278"/>
+    <edge source="260" destination="259"/>
+    <edge source="260" destination="261"/>
+    <edge source="260" destination="241"/>
+    <edge source="260" destination="279"/>
+    <edge source="261" destination="260"/>
+    <edge source="261" destination="262"/>
+    <edge source="261" destination="242"/>
+    <edge source="261" destination="280"/>
+    <edge source="262" destination="261"/>
+    <edge source="262" destination="263"/>
+    <edge source="262" destination="243"/>
+    <edge source="262" destination="281"/>
+    <edge source="263" destination="262"/>
+    <edge source="263" destination="264"/>
+    <edge source="263" destination="244"/>
+    <edge source="263" destination="282"/>
+    <edge source="264" destination="263"/>
+    <edge source="264" destination="265"/>
+    <edge source="264" destination="245"/>
+    <edge source="264" destination="283"/>
+    <edge source="265" destination="264"/>
+    <edge source="265" destination="246"/>
+    <edge source="265" destination="284"/>
+    <edge source="266" destination="267"/>
+    <edge source="266" destination="247"/>
+    <edge source="266" destination="285"/>
+    <edge source="267" destination="266"/>
+    <edge source="267" destination="268"/>
+    <edge source="267" destination="248"/>
+    <edge source="267" destination="286"/>
+    <edge source="268" destination="267"/>
+    <edge source="268" destination="269"/>
+    <edge source="268" destination="249"/>
+    <edge source="268" destination="287"/>
+    <edge source="269" destination="268"/>
+    <edge source="269" destination="270"/>
+    <edge source="269" destination="250"/>
+    <edge source="269" destination="288"/>
+    <edge source="270" destination="269"/>
+    <edge source="270" destination="271"/>
+    <edge source="270" destination="251"/>
+    <edge source="270" destination="289"/>
+    <edge source="271" destination="270"/>
+    <edge source="271" destination="272"/>
+    <edge source="271" destination="252"/>
+    <edge source="271" destination="290"/>
+    <edge source="272" destination="271"/>
+    <edge source="272" destination="273"/>
+    <edge source="272" destination="253"/>
+    <edge source="272" destination="291"/>
+    <edge source="273" destination="272"/>
+    <edge source="273" destination="274"/>
+    <edge source="273" destination="254"/>
+    <edge source="273" destination="292"/>
+    <edge source="274" destination="273"/>
+    <edge source="274" destination="275"/>
+    <edge source="274" destination="255"/>
+    <edge source="274" destination="293"/>
+    <edge source="275" destination="274"/>
+    <edge source="275" destination="276"/>
+    <edge source="275" destination="256"/>
+    <edge source="275" destination="294"/>
+    <edge source="276" destination="275"/>
+    <edge source="276" destination="277"/>
+    <edge source="276" destination="257"/>
+    <edge source="276" destination="295"/>
+    <edge source="277" destination="276"/>
+    <edge source="277" destination="278"/>
+    <edge source="277" destination="258"/>
+    <edge source="277" destination="296"/>
+    <edge source="278" destination="277"/>
+    <edge source="278" destination="279"/>
+    <edge source="278" destination="259"/>
+    <edge source="278" destination="297"/>
+    <edge source="279" destination="278"/>
+    <edge source="279" destination="280"/>
+    <edge source="279" destination="260"/>
+    <edge source="279" destination="298"/>
+    <edge source="280" destination="279"/>
+    <edge source="280" destination="281"/>
+    <edge source="280" destination="261"/>
+    <edge source="280" destination="299"/>
+    <edge source="281" destination="280"/>
+    <edge source="281" destination="282"/>
+    <edge source="281" destination="262"/>
+    <edge source="281" destination="300"/>
+    <edge source="282" destination="281"/>
+    <edge source="282" destination="283"/>
+    <edge source="282" destination="263"/>
+    <edge source="282" destination="301"/>
+    <edge source="283" destination="282"/>
+    <edge source="283" destination="284"/>
+    <edge source="283" destination="264"/>
+    <edge source="283" destination="302"/>
+    <edge source="284" destination="283"/>
+    <edge source="284" destination="265"/>
+    <edge source="284" destination="303"/>
+    <edge source="285" destination="286"/>
+    <edge source="285" destination="266"/>
+    <edge source="285" destination="304"/>
+    <edge source="286" destination="285"/>
+    <edge source="286" destination="287"/>
+    <edge source="286" destination="267"/>
+    <edge source="286" destination="305"/>
+    <edge source="287" destination="286"/>
+    <edge source="287" destination="288"/>
+    <edge source="287" destination="268"/>
+    <edge source="287" destination="306"/>
+    <edge source="288" destination="287"/>
+    <edge source="288" destination="289"/>
+    <edge source="288" destination="269"/>
+    <edge source="288" destination="307"/>
+    <edge source="289" destination="288"/>
+    <edge source="289" destination="290"/>
+    <edge source="289" destination="270"/>
+    <edge source="289" destination="308"/>
+    <edge source="290" destination="289"/>
+    <edge source="290" destination="291"/>
+    <edge source="290" destination="271"/>
+    <edge source="290" destination="309"/>
+    <edge source="291" destination="290"/>
+    <edge source="291" destination="292"/>
+    <edge source="291" destination="272"/>
+    <edge source="291" destination="310"/>
+    <edge source="292" destination="291"/>
+    <edge source="292" destination="293"/>
+    <edge source="292" destination="273"/>
+    <edge source="292" destination="311"/>
+    <edge source="293" destination="292"/>
+    <edge source="293" destination="294"/>
+    <edge source="293" destination="274"/>
+    <edge source="293" destination="312"/>
+    <edge source="294" destination="293"/>
+    <edge source="294" destination="295"/>
+    <edge source="294" destination="275"/>
+    <edge source="294" destination="313"/>
+    <edge source="295" destination="294"/>
+    <edge source="295" destination="296"/>
+    <edge source="295" destination="276"/>
+    <edge source="295" destination="314"/>
+    <edge source="296" destination="295"/>
+    <edge source="296" destination="297"/>
+    <edge source="296" destination="277"/>
+    <edge source="296" destination="315"/>
+    <edge source="297" destination="296"/>
+    <edge source="297" destination="298"/>
+    <edge source="297" destination="278"/>
+    <edge source="297" destination="316"/>
+    <edge source="298" destination="297"/>
+    <edge source="298" destination="299"/>
+    <edge source="298" destination="279"/>
+    <edge source="298" destination="317"/>
+    <edge source="299" destination="298"/>
+    <edge source="299" destination="300"/>
+    <edge source="299" destination="280"/>
+    <edge source="299" destination="318"/>
+    <edge source="300" destination="299"/>
+    <edge source="300" destination="301"/>
+    <edge source="300" destination="281"/>
+    <edge source="300" destination="319"/>
+    <edge source="301" destination="300"/>
+    <edge source="301" destination="302"/>
+    <edge source="301" destination="282"/>
+    <edge source="301" destination="320"/>
+    <edge source="302" destination="301"/>
+    <edge source="302" destination="303"/>
+    <edge source="302" destination="283"/>
+    <edge source="302" destination="321"/>
+    <edge source="303" destination="302"/>
+    <edge source="303" destination="284"/>
+    <edge source="303" destination="322"/>
+    <edge source="304" destination="305"/>
+    <edge source="304" destination="285"/>
+    <edge source="304" destination="323"/>
+    <edge source="305" destination="304"/>
+    <edge source="305" destination="306"/>
+    <edge source="305" destination="286"/>
+    <edge source="305" destination="324"/>
+    <edge source="306" destination="305"/>
+    <edge source="306" destination="307"/>
+    <edge source="306" destination="287"/>
+    <edge source="306" destination="325"/>
+    <edge source="307" destination="306"/>
+    <edge source="307" destination="308"/>
+    <edge source="307" destination="288"/>
+    <edge source="307" destination="326"/>
+    <edge source="308" destination="307"/>
+    <edge source="308" destination="309"/>
+    <edge source="308" destination="289"/>
+    <edge source="308" destination="327"/>
+    <edge source="309" destination="308"/>
+    <edge source="309" destination="310"/>
+    <edge source="309" destination="290"/>
+    <edge source="309" destination="328"/>
+    <edge source="310" destination="309"/>
+    <edge source="310" destination="311"/>
+    <edge source="310" destination="291"/>
+    <edge source="310" destination="329"/>
+    <edge source="311" destination="310"/>
+    <edge source="311" destination="312"/>
+    <edge source="311" destination="292"/>
+    <edge source="311" destination="330"/>
+    <edge source="312" destination="311"/>
+    <edge source="312" destination="313"/>
+    <edge source="312" destination="293"/>
+    <edge source="312" destination="331"/>
+    <edge source="313" destination="312"/>
+    <edge source="313" destination="314"/>
+    <edge source="313" destination="294"/>
+    <edge source="313" destination="332"/>
+    <edge source="314" destination="313"/>
+    <edge source="314" destination="315"/>
+    <edge source="314" destination="295"/>
+    <edge source="314" destination="333"/>
+    <edge source="315" destination="314"/>
+    <edge source="315" destination="316"/>
+    <edge source="315" destination="296"/>
+    <edge source="315" destination="334"/>
+    <edge source="316" destination="315"/>
+    <edge source="316" destination="317"/>
+    <edge source="316" destination="297"/>
+    <edge source="316" destination="335"/>
+    <edge source="317" destination="316"/>
+    <edge source="317" destination="318"/>
+    <edge source="317" destination="298"/>
+    <edge source="317" destination="336"/>
+    <edge source="318" destination="317"/>
+    <edge source="318" destination="319"/>
+    <edge source="318" destination="299"/>
+    <edge source="318" destination="337"/>
+    <edge source="319" destination="318"/>
+    <edge source="319" destination="320"/>
+    <edge source="319" destination="300"/>
+    <edge source="319" destination="338"/>
+    <edge source="320" destination="319"/>
+    <edge source="320" destination="321"/>
+    <edge source="320" destination="301"/>
+    <edge source="320" destination="339"/>
+    <edge source="321" destination="320"/>
+    <edge source="321" destination="322"/>
+    <edge source="321" destination="302"/>
+    <edge source="321" destination="340"/>
+    <edge source="322" destination="321"/>
+    <edge source="322" destination="303"/>
+    <edge source="322" destination="341"/>
+    <edge source="323" destination="324"/>
+    <edge source="323" destination="304"/>
+    <edge source="323" destination="342"/>
+    <edge source="324" destination="323"/>
+    <edge source="324" destination="325"/>
+    <edge source="324" destination="305"/>
+    <edge source="324" destination="343"/>
+    <edge source="325" destination="324"/>
+    <edge source="325" destination="326"/>
+    <edge source="325" destination="306"/>
+    <edge source="325" destination="344"/>
+    <edge source="326" destination="325"/>
+    <edge source="326" destination="327"/>
+    <edge source="326" destination="307"/>
+    <edge source="326" destination="345"/>
+    <edge source="327" destination="326"/>
+    <edge source="327" destination="328"/>
+    <edge source="327" destination="308"/>
+    <edge source="327" destination="346"/>
+    <edge source="328" destination="327"/>
+    <edge source="328" destination="329"/>
+    <edge source="328" destination="309"/>
+    <edge source="328" destination="347"/>
+    <edge source="329" destination="328"/>
+    <edge source="329" destination="330"/>
+    <edge source="329" destination="310"/>
+    <edge source="329" destination="348"/>
+    <edge source="330" destination="329"/>
+    <edge source="330" destination="331"/>
+    <edge source="330" destination="311"/>
+    <edge source="330" destination="349"/>
+    <edge source="331" destination="330"/>
+    <edge source="331" destination="332"/>
+    <edge source="331" destination="312"/>
+    <edge source="331" destination="350"/>
+    <edge source="332" destination="331"/>
+    <edge source="332" destination="333"/>
+    <edge source="332" destination="313"/>
+    <edge source="332" destination="351"/>
+    <edge source="333" destination="332"/>
+    <edge source="333" destination="334"/>
+    <edge source="333" destination="314"/>
+    <edge source="333" destination="352"/>
+    <edge source="334" destination="333"/>
+    <edge source="334" destination="335"/>
+    <edge source="334" destination="315"/>
+    <edge source="334" destination="353"/>
+    <edge source="335" destination="334"/>
+    <edge source="335" destination="336"/>
+    <edge source="335" destination="316"/>
+    <edge source="335" destination="354"/>
+    <edge source="336" destination="335"/>
+    <edge source="336" destination="337"/>
+    <edge source="336" destination="317"/>
+    <edge source="336" destination="355"/>
+    <edge source="337" destination="336"/>
+    <edge source="337" destination="338"/>
+    <edge source="337" destination="318"/>
+    <edge source="337" destination="356"/>
+    <edge source="338" destination="337"/>
+    <edge source="338" destination="339"/>
+    <edge source="338" destination="319"/>
+    <edge source="338" destination="357"/>
+    <edge source="339" destination="338"/>
+    <edge source="339" destination="340"/>
+    <edge source="339" destination="320"/>
+    <edge source="339" destination="358"/>
+    <edge source="340" destination="339"/>
+    <edge source="340" destination="341"/>
+    <edge source="340" destination="321"/>
+    <edge source="340" destination="359"/>
+    <edge source="341" destination="340"/>
+    <edge source="341" destination="322"/>
+    <edge source="341" destination="360"/>
+    <edge source="342" destination="343"/>
+    <edge source="342" destination="323"/>
+    <edge source="343" destination="342"/>
+    <edge source="343" destination="344"/>
+    <edge source="343" destination="324"/>
+    <edge source="344" destination="343"/>
+    <edge source="344" destination="345"/>
+    <edge source="344" destination="325"/>
+    <edge source="345" destination="344"/>
+    <edge source="345" destination="346"/>
+    <edge source="345" destination="326"/>
+    <edge source="346" destination="345"/>
+    <edge source="346" destination="347"/>
+    <edge source="346" destination="327"/>
+    <edge source="347" destination="346"/>
+    <edge source="347" destination="348"/>
+    <edge source="347" destination="328"/>
+    <edge source="348" destination="347"/>
+    <edge source="348" destination="349"/>
+    <edge source="348" destination="329"/>
+    <edge source="349" destination="348"/>
+    <edge source="349" destination="350"/>
+    <edge source="349" destination="330"/>
+    <edge source="350" destination="349"/>
+    <edge source="350" destination="351"/>
+    <edge source="350" destination="331"/>
+    <edge source="351" destination="350"/>
+    <edge source="351" destination="352"/>
+    <edge source="351" destination="332"/>
+    <edge source="352" destination="351"/>
+    <edge source="352" destination="353"/>
+    <edge source="352" destination="333"/>
+    <edge source="353" destination="352"/>
+    <edge source="353" destination="354"/>
+    <edge source="353" destination="334"/>
+    <edge source="354" destination="353"/>
+    <edge source="354" destination="355"/>
+    <edge source="354" destination="335"/>
+    <edge source="355" destination="354"/>
+    <edge source="355" destination="356"/>
+    <edge source="355" destination="336"/>
+    <edge source="356" destination="355"/>
+    <edge source="356" destination="357"/>
+    <edge source="356" destination="337"/>
+    <edge source="357" destination="356"/>
+    <edge source="357" destination="358"/>
+    <edge source="357" destination="338"/>
+    <edge source="358" destination="357"/>
+    <edge source="358" destination="359"/>
+    <edge source="358" destination="339"/>
+    <edge source="359" destination="358"/>
+    <edge source="359" destination="360"/>
+    <edge source="359" destination="340"/>
+    <edge source="360" destination="359"/>
+    <edge source="360" destination="341"/>
+  </waypointedges>
+</waypointgraph>
\ No newline at end of file

Modified: modules/regressiontest/scripts/SoundTest.rb
===================================================================
--- modules/regressiontest/scripts/SoundTest.rb	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/regressiontest/scripts/SoundTest.rb	2007-09-24 21:06:51 UTC (rev 3875)
@@ -17,7 +17,7 @@
     sound = $SM.createSound("ruchin001.ogg")
     @sound = SoundObject.new(sound, "SoundFadeTest")
     @functor = LinearSoundFadeFunctor.new(120, false)
-    @job = SoundFadeJob.new (@sound, @functor, true)
+    @job = SoundFadeJob.new(@sound, @functor, true)
   end
   
 end

Modified: modules/regressiontest/scripts/WalkJobTest.rb
===================================================================
--- modules/regressiontest/scripts/WalkJobTest.rb	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/regressiontest/scripts/WalkJobTest.rb	2007-09-24 21:06:51 UTC (rev 3875)
@@ -3,17 +3,24 @@
 class WalkJobTest < TestCase
   def execute()
     walkingCreature = $GOM.createGameObject("TestPerson")
-	walkingCreature.placeIntoScene
-	walkingCreature.setPosition(getCenter())
-	walkingCreature.modifyAu(1000)
+	  walkingCreature.placeIntoScene
+	  walkingCreature.setPosition(getCenter())
+	  walkingCreature.modifyAu(1000)
 
+    wpgraph = $WPGM.createWayPointGraph();
+    wpgraph.load("astargrid.wpg.xml")
+
     creatureController = CreatureControllerManager.getSingleton().getCreatureController(walkingCreature)
 
-    job = CreatureWalkPathJob.new("WalkJobTest", creatureController, Landmark.new("point", [5.0, 0.0, -10.0]))
+    job = CreatureWalkPathJob.new(
+      "WalkJobTest", 
+      creatureController, 
+      Landmark.new("point", [5.0, 0.0, -10.0]))
     job.addLandmark("1",[5.0,0.0,-20.0])
     job.addLandmark("2",[5.0,0.0,-15.0])
-	$JS.addJob(job);
+    job.setWayPoints(wpgraph);
+	  $JS.addJob(job);
 	
-	$SCRIPT.log("WalkJobTest initialisiert")
+	  $SCRIPT.log("WalkJobTest initialisiert")
   end
 end

Modified: modules/regressiontest/scripts/maps/regressiontest.rb
===================================================================
--- modules/regressiontest/scripts/maps/regressiontest.rb	2007-09-24 21:01:57 UTC (rev 3874)
+++ modules/regressiontest/scripts/maps/regressiontest.rb	2007-09-24 21:06:51 UTC (rev 3875)
@@ -9,8 +9,7 @@
 $SCRIPT.log("init map 'regressiontest'...")
 
 $SCRIPT.log("Prepare hero for being the active character")
-#$hero = $GOM.getGameObject(1); # single mesh hero
-$hero = $GOM.getGameObject(10); # construction kit hero
+$hero = $GOM.getGameObject(10);
 PlayerSettings.preparePlayer($hero)
 
 $SCRIPT.log("Set hero as active character")
@@ -40,21 +39,21 @@
 require 'MeshAreaTest.rb'
 
 
- MaterialSlotTest.new([-15, 0, -5]).run()
-    LightzoneTest.new([-10, 0, -5]).run()
-ErrorHandlingTest.new([-10, 0, 5]).run()
-         TimeTest.new([ -5, 0, -5]).run()
-   MapLoadingTest.new([ -5, 0, -10]).run()
+# MaterialSlotTest.new([-15, 0, -5]).run()
+#    LightzoneTest.new([-10, 0, -5]).run()
+#ErrorHandlingTest.new([-10, 0, 5]).run()
+#         TimeTest.new([ -5, 0, -5]).run()
+#   MapLoadingTest.new([ -5, 0, -10]).run()
           NpcTest.new([ -5, 0, 5]).run()
-         DoorTest.new([  0, 0, -5]).run()
+#         DoorTest.new([  0, 0, -5]).run()
 	  WalkJobTest.new([  0, 0, -3]).run()
-   NpcCapsuleTest.new([  0, 0, 5]).run()
-    InventoryTest.new([  0, 0, 10]).run()
-  JobSequenceTest.new([  5, 0, -5]).run()
-     SelectorTest.new([  5, 0, 0]).run()
-       EffectTest.new([  5, 0, 5]).run()
-MergeableMeshTest.new([ 10, 0, 0]).run()
-        SoundTest.new([ 10, 0, 10]).run()
+#   NpcCapsuleTest.new([  0, 0, 5]).run()
+#    InventoryTest.new([  0, 0, 10]).run()
+#  JobSequenceTest.new([  5, 0, -5]).run()
+#     SelectorTest.new([  5, 0, 0]).run()
+#       EffectTest.new([  5, 0, 5]).run()
+#MergeableMeshTest.new([ 10, 0, 0]).run()
+#        SoundTest.new([ 10, 0, 10]).run()
      MeshAreaTest.new([-50, 0,-55]).run()
 
 $SCRIPT.log("tests initialisiert.");

Modified: rl/trunk/engine/ai/include/AStar.h
===================================================================
--- rl/trunk/engine/ai/include/AStar.h	2007-09-24 21:01:57 UTC (rev 3874)
+++ rl/trunk/engine/ai/include/AStar.h	2007-09-24 21:06:51 UTC (rev 3875)
@@ -72,23 +72,23 @@
 		 * A start and and end point.
          * This is a convenience constructor so that there is no need to do
          * a search right from the start, but can be done sometime later.
-		 * @param Costs encapsulates cost and heuristic for distance calculations.
-		 * @param WPGraph contains the map of WayPoints to examine for a path.
+		 * @param costs encapsulates cost and heuristic for distance calculations.
+		 * @param wpGraph contains the map of WayPoints to examine for a path.
          */
-        AStar( const AStarCosts* Costs, const WayPointGraph* WPGraph );
+        AStar(const AStarCosts* costs, const WayPointGraph* wpGraph);
 
 		/** The constructor of AStar
 		 * AStar needs several things to find a path: 
 		 * a heuristic to calculate the cost for the still not travelled part of the path.
 		 * some sort of map to travel in.
 		 * A start and and end point.
-		 * @param Costs encapsulates cost and heuristic for distance calculations.
-		 * @param WPGraph contains the map of WayPoints to examine for a path.
-		 * @param StartPos is the start point in world space.
-		 * @param StartPos is the end point in world space.
+		 * @param costs encapsulates cost and heuristic for distance calculations.
+		 * @param wpGraph contains the map of WayPoints to examine for a path.
+		 * @param startPos is the start point in world space.
+		 * @param startPos is the end point in world space.
 		 */
-		AStar( const AStarCosts* Costs, const WayPointGraph* WPGraph,
-			const Ogre::Vector3& StartPos, const Ogre::Vector3& EndPos );
+		AStar(const AStarCosts* costs, const WayPointGraph* wpGraph,
+			const Ogre::Vector3& startPos, const Ogre::Vector3& endPos);
 		/** explicit virtual destructor
 		 */
 		~AStar();
@@ -104,11 +104,11 @@
 
 		/** starts the search for the given start and end positions
          * @param resultPath contains the researched path in reverse order.
-		 * @param StartPos gives the startpoint for the search
-		 * @param EndPos gives the endposition for the search
+		 * @param startPos gives the startpoint for the search
+		 * @param endPos gives the endPosition for the search
 		 */
-		void searchFromTo(AStarPath& resultPath, const Ogre::Vector3& StartPos,
-			const Ogre::Vector3& EndPos );
+		void searchFromTo(AStarPath& resultPath, const Ogre::Vector3& startPos,
+			const Ogre::Vector3& endPos);
 
 		/* retrieve a list of WayPoints (=the solution)
 		 * This generates a path from the solution created by search
@@ -130,6 +130,11 @@
 		 */
         virtual void updatePrimitive();
 
+        static AStarPath search(
+            const WayPointGraph* wpGraph,
+            const Ogre::Vector3& startPos,
+			const Ogre::Vector3& endPos);
+
 	protected:
 		// Overrides from DebugVisualisable
 		/** actualy creates the debug primitive.
@@ -151,7 +156,7 @@
 		 * @param Set to search through
 		 * @param Node to search for
 		 */
-		AStarSet::iterator searchSet(AStarSet& Set, AStarWayPointNode* Node);
+		AStarSet::iterator searchSet(AStarSet& set, AStarWayPointNode* node);
 
 		// static data
 		//! heuristic function

Modified: rl/trunk/engine/ai/include/CreatureWalkPathJob.h
===================================================================
--- rl/trunk/engine/ai/include/CreatureWalkPathJob.h	2007-09-24 21:01:57 UTC (rev 3874)
+++ rl/trunk/engine/ai/include/CreatureWalkPathJob.h	2007-09-24 21:06:51 UTC (rev 3875)
@@ -22,11 +22,14 @@
 #include "Landmark.h"
 #include "LandmarkPath.h"
 
+#include "AStar.h"
+#include "CreatureController.h"
 #include "Job.h"
-#include "CreatureController.h"
 
 namespace rl
 {
+    class WayPointGraph;
+
     class _RlAiExport CreatureWalkPathJob : public Job
     {
     public:
@@ -42,6 +45,7 @@
         //adds an additional landmark the moving creature has to go to
         void addLandmark(const Ogre::String& name, const Ogre::Vector3& position);
         void addLandmark(Landmark* lm);
+        void setWayPoints(const WayPointGraph* wps);
 
        /**
         * This function is not intented to be called directly
@@ -52,7 +56,6 @@
         // @retval the moving creature controlled by this object
         CreatureController* getMovingCreature();
     private:
-        void updateCreature(Ogre::Real time);
 
         LandmarkPath mLandmarkPath;
         Ogre::String mName;
@@ -60,6 +63,8 @@
 
         Landmark* mCurrentLandmark;
         Landmark* mNextLandmark;
+        const WayPointGraph* mWayPoints;
+        AStar::AStarPath mCurrentWayPath;
 
         bool mNextLandmarkRequested;
     };

Modified: rl/trunk/engine/ai/include/LandmarkPath.h
===================================================================
--- rl/trunk/engine/ai/include/LandmarkPath.h	2007-09-24 21:01:57 UTC (rev 3874)
+++ rl/trunk/engine/ai/include/LandmarkPath.h	2007-09-24 21:06:51 UTC (rev 3875)
@@ -32,8 +32,11 @@
 
 		void addPoint(const Ogre::String& name, const Ogre::Vector3& position);
 		void addPoint(Landmark* lm);
+        void removePoint(const Ogre::String& name);
+        void removePoint(Landmark* lm);
         
-        LandmarkList getPoints();
+        LandmarkList getPoints() const;
+        bool isEmpty() const;
 	private:
 		LandmarkList mPoints;
 		Ogre::String mName;

Modified: rl/trunk/engine/ai/src/AStar.cpp
===================================================================
--- rl/trunk/engine/ai/src/AStar.cpp	2007-09-24 21:01:57 UTC (rev 3874)
+++ rl/trunk/engine/ai/src/AStar.cpp	2007-09-24 21:06:51 UTC (rev 3875)
@@ -53,9 +53,9 @@
   mPathCost = 0;
 }
 
-AStar::AStar( const AStarCosts* Costs, const WayPointGraph* WPGraph )
-    : mCosts(Costs),
-	mWPGraph(WPGraph),
+AStar::AStar(const AStarCosts* costs, const WayPointGraph* wpGraph)
+    : mCosts(costs),
+	mWPGraph(wpGraph),
 	mStartPos(0,0,0),
 	mEndPos(0,0,0),
 	mANStart(NULL),
@@ -64,12 +64,12 @@
 {
 }
 
-AStar::AStar( const AStarCosts* Costs, const WayPointGraph* WPGraph,
-			const Ogre::Vector3& StartPos, const Ogre::Vector3& EndPos )
-	: mCosts(Costs),
-	mWPGraph(WPGraph),
-	mStartPos(StartPos),
-	mEndPos(EndPos),
+AStar::AStar(const AStarCosts* costs, const WayPointGraph* wpGraph,
+			const Ogre::Vector3& startPos, const Ogre::Vector3& endPos)
+	: mCosts(costs),
+	mWPGraph(wpGraph),
+	mStartPos(startPos),
+	mEndPos(endPos),
 	mANStart(NULL),
 	mANEnd(NULL),
     mDebugAstar(false)
@@ -88,11 +88,11 @@
 	mANEnd = NULL;
 
 	AStarSet::iterator it;
-	for (it = mOpen.begin(); it != mOpen.end(); it++)
+	for (it = mOpen.begin(); it != mOpen.end(); ++it)
 	{
 		delete (*it);
 	}
-	for (it = mClosed.begin(); it != mClosed.end(); it++)
+	for (it = mClosed.begin(); it != mClosed.end(); ++it)
 	{
 		delete (*it);
 	}
@@ -108,15 +108,15 @@
 	reset();
 
 	// first find 'real' start and end positions by searching for the corresponding waypoints
-	mANStart = new AStarWayPointNode( mWPGraph->getNearestWayPoint(mStartPos) );
-	mANEnd = new AStarWayPointNode( mWPGraph->getNearestWayPoint(mEndPos) );
+	mANStart = new AStarWayPointNode(mWPGraph->getNearestWayPoint(mStartPos));
+	mANEnd = new AStarWayPointNode(mWPGraph->getNearestWayPoint(mEndPos));
 }
 
-void AStar::searchFromTo(AStarPath& resultPath, const Ogre::Vector3& StartPos,
-						 const Ogre::Vector3& EndPos )
+void AStar::searchFromTo(AStarPath& resultPath, const Ogre::Vector3& startPos,
+						 const Ogre::Vector3& endPos)
 {
-	mStartPos = StartPos;
-	mEndPos = EndPos;
+	mStartPos = startPos;
+	mEndPos = endPos;
 	search(resultPath);
 }
 
@@ -149,29 +149,30 @@
 	mANStart->setH(mCosts->calcHeuristic(mWPGraph,mANStart,mANEnd));
     mANStart->setG(0);
 
-	AStarWayPointNode* Node;
+	AStarWayPointNode* node;
 
 	// While there are still unvisited nodes
-    while( !mOpen.empty() )
+    while (!mOpen.empty())
 	{
-        Node = mOpen.front();
+        node = mOpen.front();
 		pop_heap(mOpen.begin(), mOpen.end(), AStarWayPointNode::SortMethod);
 		mOpen.pop_back();
 
-		mClosed.push_back(Node);
+		mClosed.push_back(node);
 
 		// check if goal reached
-        if ( Node->EqualPosition(mANEnd) ) {
+        if (node->EqualPosition(mANEnd)) 
+        {
 			// remember new 'end'
             delete mANEnd;
-            mANEnd = Node;
+            mANEnd = node;
             // create result path (start and enpoint might not be on path!)
-            if (Node->getWP()->getPosition() != mEndPos)
+            if (node->getWP()->getPosition() != mEndPos)
                 resultPath.push_back(mEndPos);  // push endpos
 
-            for (; Node; Node = Node->getParent())
+            for (; node; node = node->getParent())
 			{
-				resultPath.push_back(Node->getWP()->getPosition());
+				resultPath.push_back(node->getWP()->getPosition());
 			}
 
             // save startpos, if waypoint is not the startpos
@@ -186,50 +187,50 @@
 		}
 
 		// now look through the neighbours
-		WayPointNode::WayPointWeightNodeList WPList = Node->getWP()->getNeighbours();
+		WayPointNode::WayPointWeightNodeList WPList = node->getWP()->getNeighbours();
 		WayPointNode::WayPointWeightNodeList::iterator it;
 
-		for (it = WPList.begin(); it != WPList.end(); it++)
+		for (it = WPList.begin(); it != WPList.end(); ++it)
 		{
 			AStarWayPointNode* ASubNode = new AStarWayPointNode((*it).second);
-			float cost = mCosts->calcCost(mWPGraph,ASubNode,Node);
+			float cost = mCosts->calcCost(mWPGraph,ASubNode,node);
 
-			ASubNode->setG( Node->getG() + cost );
-			ASubNode->setH( mCosts->calcHeuristic(mWPGraph,ASubNode,mANEnd) );
+			ASubNode->setG(node->getG() + cost);
+			ASubNode->setH(mCosts->calcHeuristic(mWPGraph,ASubNode,mANEnd));
 
 			AStarSet::iterator ASit;
 			// now check if the node is already in Open
 
-			if ( (ASit = searchSet(mOpen, ASubNode)) != mOpen.end() )
+			if ((ASit = searchSet(mOpen, ASubNode)) != mOpen.end())
 			{
 				AStarWayPointNode* ASfound = (*ASit);
 				// check if current g is better
 				if (ASfound->getG() > ASubNode->getG()) {
 					ASfound->setG(ASubNode->getG());
 					ASfound->setH(ASubNode->getH());
-					ASfound->setParent(Node);
+					ASfound->setParent(node);
 					// dark magic ... for resorting the heap from the top
 					// down to the changed element
-					push_heap( mOpen.begin(), ASit+1, AStarWayPointNode::SortMethod );
+					push_heap(mOpen.begin(), ASit+1, AStarWayPointNode::SortMethod);
 				}
 				// anyway the newly created node isn't needed
 				delete ASubNode;
 
 			}  // now check if the node is already in Closed
-			else if ( (ASit = searchSet(mClosed, ASubNode)) != mClosed.end())
+			else if ((ASit = searchSet(mClosed, ASubNode)) != mClosed.end())
 			{
 				AStarWayPointNode* ASfound = (*ASit);
 				// (check if current g is better, then reopen)
 				if (ASfound->getG() > ASubNode->getG()) {
 					ASfound->setG(ASubNode->getG());
 					ASfound->setH(ASubNode->getH());
-					ASfound->setParent(Node);
+					ASfound->setParent(node);
 					// remove the node from the closed list
 					mClosed.erase(ASit);
 
 					// dark magic ... for resorting the heap from the top
 					// down to the changed element
-					push_heap( mOpen.begin(), mOpen.end(), AStarWayPointNode::SortMethod );
+					push_heap(mOpen.begin(), mOpen.end(), AStarWayPointNode::SortMethod);
 				}
 				// anyway the newly created node isn't needed
 				delete ASubNode;
@@ -237,16 +238,16 @@
 			else
 			{
 				// neither in Open nor Closed, so add it to Open
-				mOpen.push_back( ASubNode );
-                push_heap( mOpen.begin(), mOpen.end(), AStarWayPointNode::SortMethod );
-				ASubNode->setParent(Node);
+				mOpen.push_back(ASubNode);
+                push_heap(mOpen.begin(), mOpen.end(), AStarWayPointNode::SortMethod);
+				ASubNode->setParent(node);
 			}
 		}
 	}
 
 }
 
-AStar::AStarSet::iterator AStar::searchSet(AStarSet& Set, AStarWayPointNode* Node)
+AStar::AStarSet::iterator AStar::searchSet(AStarSet& set, AStarWayPointNode* node)
 {
 	AStarSet::iterator it;
 
@@ -255,19 +256,19 @@
      */
 
     //AStarWayPointNode* help = NULL;
-    //bool found = std::binary_search(Set.begin(), Set.end(), Node, AStarWayPointNode::SortMethod);
+    //bool found = std::binary_search(Set.begin(), Set.end(), node, AStarWayPointNode::SortMethod);
     //while (it != Set.end())
     //{
-    //    if ( (*it)->Equal(Node) ) // if equal, then Node was 'found'
+    //    if ((*it)->Equal(node)) // if equal, then node was 'found'
     //        break;
         // otherwise continue binary search
-        //it = std::binary_search(it, Set.end(), Node, AStarWayPointNode::SortMethod);
+        //it = std::binary_search(it, Set.end(), node, AStarWayPointNode::SortMethod);
     //}
 
 
-	for (it = Set.begin(); it != Set.end(); it++)
+	for (it = set.begin(); it != set.end(); ++it)
 	{
-        if ( (*it)->EqualPosition(Node) )
+        if ((*it)->EqualPosition(node))
 			return it;
 	}
 
@@ -288,15 +289,15 @@
     if (it == searchPath.end())
         return;
 
-    Ogre::Vector3 From;
-    Ogre::Vector3 To;
-    for (it++ ; it != searchPath.end(); it++)
+    Ogre::Vector3 from;
+    Ogre::Vector3 to;
+    for (++it ; it != searchPath.end(); ++it)
     {
         pit = it - 1;
-        From = (*pit) + Ogre::Vector3(0,0.5,0);
-        To = (*it) + Ogre::Vector3(0,0.5,0);
+        from = (*pit) + Ogre::Vector3(0,0.5,0);
+        to = (*it) + Ogre::Vector3(0,0.5,0);
 
-        lineSet->addLine(From, To, Ogre::ColourValue::Green);
+        lineSet->addLine(from, to, Ogre::ColourValue::Green);
     }
 }
 
@@ -322,4 +323,19 @@
 	mPrimitive = new LineSetPrimitive();
 }
 
+AStar::AStarPath AStar::search(
+    const rl::WayPointGraph *wpGraph, const Ogre::Vector3 &startPos, const Ogre::Vector3 &endPos)
+{
+    AStarHeuristic* heur = new EuclideanDistanceSquared();
+    AStarCosts* costs = new AStarCostsDefault(heur);
+    AStar* search = new AStar(costs, wpGraph, startPos, endPos);
+    AStar::AStarPath path;
+    search->search(path);
+    delete search;
+    delete costs;
+    delete heur;
+
+    return path;
+}
+
 };

Modified: rl/trunk/engine/ai/src/CreatureWalkPathJob.cpp
===================================================================
--- rl/trunk/engine/ai/src/CreatureWalkPathJob.cpp	2007-09-24 21:01:57 UTC (rev 3874)
+++ rl/trunk/engine/ai/src/CreatureWalkPathJob.cpp	2007-09-24 21:06:51 UTC (rev 3875)
@@ -17,11 +17,15 @@
 
 
 #include "CreatureWalkPathJob.h"
+#include "AStar.h"
 
 namespace rl
 {
     CreatureWalkPathJob::CreatureWalkPathJob(const Ogre::String& name, CreatureController* movingCreature, Landmark* startLandmark)
-        : Job(true, true), mLandmarkPath("LandmarkPath" + name), mNextLandmarkRequested(false)
+        : Job(true, true), 
+        mLandmarkPath("LandmarkPath" + name), 
+        mNextLandmarkRequested(false),
+        mWayPoints(NULL)
     {
         //the moving creature moves from the current position to the landmark
         mMovingCreature = movingCreature;
@@ -35,24 +39,107 @@
 
     bool CreatureWalkPathJob::execute(Ogre::Real time)
     {
-        if(mNextLandmarkRequested)
+        static bool updatedDirection(false);
+        static Ogre::Real timeSinceLastRotation = 0;
+
+        timeSinceLastRotation += time;
+
+        Ogre::Vector3 direction = mCurrentLandmark->getPosition() - mMovingCreature->getCreature()->getActor()->getPosition();
+        direction.y = 0;
+        if (direction.squaredLength() < 0.04 )
         {
-            if (mLandmarkPath.getPoints().size())
+            mMovingCreature->setMovement(CreatureController::MT_STEHEN, Ogre::Vector3::ZERO, Ogre::Vector3::ZERO);
+
+            if (!mLandmarkPath.isEmpty())
             {
                 mCurrentLandmark = mNextLandmark;
                 mNextLandmark = mLandmarkPath.getPoints().front();
-                mLandmarkPath.getPoints().pop_front();
+                mLandmarkPath.removePoint(mNextLandmark);
                 mNextLandmarkRequested = false;
+                if (mWayPoints)
+                {
+                    mCurrentWayPath = AStar::search(
+                        mWayPoints,
+                        mMovingCreature->getCreature()->getPosition(), 
+                        mCurrentLandmark->getPosition());
+                    std::ostringstream ss;
+                    ss << "Current Position: " << mMovingCreature->getCreature()->getPosition() << "\n";
+                    for (AStar::AStarPath::const_iterator it = mCurrentWayPath.begin();
+                        it != mCurrentWayPath.end(); ++it)
+                    {
+                        ss << *it << " ";
+                    }
+                    LOG_MESSAGE2("WalkPathJob", ss.str(), "Next Path");
+                }
             }
-            else
+            else if (mNextLandmark)
             {
                 mCurrentLandmark = mNextLandmark;
-                ///@todo
+                mNextLandmark = NULL;
             }
+            else
+            {
+                return true;
+            }
+
+            updatedDirection = false;
+            return false;
         }
 
-        updateCreature(true);
+        if (mWayPoints)
+        {
 
+            if (mCurrentWayPath.empty())
+            {
+                mCurrentWayPath = AStar::search(
+                        mWayPoints,
+                        mMovingCreature->getCreature()->getPosition(), 
+                        mCurrentLandmark->getPosition());
+                std::ostringstream ss;
+                ss << "Current Position: " << mMovingCreature->getCreature()->getPosition() << "\n";
+                for (AStar::AStarPath::const_iterator it = mCurrentWayPath.begin();
+                    it != mCurrentWayPath.end(); ++it)
+                {
+                    ss << *it << " ";
+                }
+                LOG_MESSAGE2("WalkPathJob", ss.str(), "Next Path");
+            }
+
+            direction = mCurrentWayPath.back() - mMovingCreature->getCreature()->getPosition();
+            while (direction.squaredLength() < 0.04)
+            {
+                mCurrentWayPath.pop_back();
+                if (mCurrentWayPath.empty())
+                {
+                    break;
+                }
+                direction = mCurrentWayPath.back() - mMovingCreature->getCreature()->getPosition();
+            }
+            updatedDirection = true;
+        }
+
+        LOG_MESSAGE("WalkPathJob", 
+            "Going to " + Ogre::StringConverter::toString(direction + mMovingCreature->getCreature()->getPosition()) 
+            + ", current position "  + Ogre::StringConverter::toString(mMovingCreature->getCreature()->getPosition()));
+
+        Ogre::Vector3 creatureViewVector = mMovingCreature->getCreature()->getActor()->getOrientation() * Ogre::Vector3::NEGATIVE_UNIT_Z;
+        creatureViewVector.y = 0;
+        Ogre::Quaternion rotation = creatureViewVector.getRotationTo(direction, Ogre::Vector3::UNIT_Y);
+        Ogre::Radian yaw = rotation.getYaw();
+        Ogre::Vector3 usedRotation(Ogre::Vector3::ZERO);
+
+        if (!updatedDirection 
+            || (direction.squaredLength() > 0.04 
+                && timeSinceLastRotation > 0.2 
+                && direction.normalisedCopy().dotProduct(
+                    creatureViewVector.normalisedCopy()) < 0.9))
+        {
+            usedRotation.y = yaw.valueRadians();
+            updatedDirection = true;
+            timeSinceLastRotation = 0;
+        }
+
+        mMovingCreature->setMovement(CreatureController::MT_GEHEN, Ogre::Vector3::NEGATIVE_UNIT_Z, usedRotation);
         return false;
     }
 
@@ -71,37 +158,8 @@
         return mMovingCreature;
     }
 
-    void CreatureWalkPathJob::updateCreature(Ogre::Real time)
+    void CreatureWalkPathJob::setWayPoints(const rl::WayPointGraph *wps)
     {
-        static bool updatedDirection(false);
-        static Ogre::Real timeSinceLastRotation = 0;
-
-        timeSinceLastRotation += time;
-
-        Ogre::Vector3 direction = mNextLandmark->getPosition() - mMovingCreature->getCreature()->getActor()->getPosition();
-        direction.y = 0;
-        if( direction.squaredLength() < 0.04 )
-        {
-            mMovingCreature->setMovement(CreatureController::MT_STEHEN, Ogre::Vector3::ZERO, Ogre::Vector3::ZERO);
-            mNextLandmarkRequested = true;
-            updatedDirection = false;
-            return;
-        }
-
-        Ogre::Vector3 creatureViewVector = mMovingCreature->getCreature()->getActor()->getOrientation() * Ogre::Vector3::NEGATIVE_UNIT_Z;
-        creatureViewVector.y = 0;
-        Ogre::Quaternion rotation = creatureViewVector.getRotationTo(direction, Ogre::Vector3::UNIT_Y);
-        Ogre::Radian yaw = rotation.getYaw();
-        Ogre::Vector3 usedRotation(Ogre::Vector3::ZERO);
-
-        if(!updatedDirection || (direction.squaredLength() > 0.04 && timeSinceLastRotation > 1 &&
-            direction.normalisedCopy().dotProduct(creatureViewVector.normalisedCopy()) < 0.9))
-        {
-            usedRotation.y = yaw.valueRadians();
-            updatedDirection = true;
-            timeSinceLastRotation = 0;
-        }
-
-        mMovingCreature->setMovement(CreatureController::MT_GEHEN, Ogre::Vector3::NEGATIVE_UNIT_Z, usedRotation);
+        mWayPoints = wps;
     }
 }

Modified: rl/trunk/engine/ai/src/LandmarkPath.cpp
===================================================================
--- rl/trunk/engine/ai/src/LandmarkPath.cpp	2007-09-24 21:01:57 UTC (rev 3874)
+++ rl/trunk/engine/ai/src/LandmarkPath.cpp	2007-09-24 21:06:51 UTC (rev 3875)
@@ -18,6 +18,7 @@
 #include "LandmarkPath.h"
 
 #include "AiSubsystem.h"
+#include "Landmark.h"
 
 namespace rl
 {
@@ -41,8 +42,49 @@
 		mPoints.push_back(lm);
 	}
 
-    LandmarkPath::LandmarkList LandmarkPath::getPoints()
+    void LandmarkPath::removePoint(const Ogre::String& name)
     {
+        Landmark* lm = NULL;
+        for (LandmarkList::iterator it = mPoints.begin(); it != mPoints.end(); ++it)
+        {
+            Landmark* cur = *it;
+            if (cur->getName() == name)
+            {
+                lm = cur;
+                break;
+            }
+        }
+
+        if (lm)
+        {
+            removePoint(lm);
+        }
+        else
+        {
+            LOG_ERROR(Logger::AI, "Could not delete landmark '"+name+"'. Landmark with this name not found.");
+        }
+    }
+
+    void LandmarkPath::removePoint(Landmark* lm)
+    {
+        for (LandmarkList::iterator it = mPoints.begin(); it != mPoints.end(); ++it)
+        {
+            if (*it == lm)
+            {
+                mPoints.erase(it);
+                break;
+            }
+        }
+    }
+
+    LandmarkPath::LandmarkList LandmarkPath::getPoints() const
+    {
         return mPoints;
     }
+
+    bool LandmarkPath::isEmpty() const
+    {
+        return mPoints.empty();
+    }
+
 }

Modified: rl/trunk/engine/script/swig/RlAi.swig
===================================================================
--- rl/trunk/engine/script/swig/RlAi.swig	2007-09-24 21:01:57 UTC (rev 3874)
+++ rl/trunk/engine/script/swig/RlAi.swig	2007-09-24 21:06:51 UTC (rev 3875)
@@ -292,6 +292,7 @@
 
         void addLandmark(const Ogre::String& name, const Ogre::Vector3& position);
         void addLandmark(Landmark* lm);
+        void setWayPoints(const WayPointGraph* wps);
     };
 } // Namespace
 

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2007-09-24 21:01:57 UTC (rev 3874)
+++ rl/trunk/engine/script/swig/RlRules.swig	2007-09-24 21:06:51 UTC (rev 3875)
@@ -816,7 +816,7 @@
 	// Before first use of Selector or subclasses!
     %apply SWIGTYPE *DYNAMIC { rl::Selector* };
 
-	class Selector : public DebugVisualisable
+	class Selector
     {
     public:
         Selector(unsigned long mask = 0xffffffff);



From blakharaz at mail.berlios.de  Mon Sep 24 23:08:13 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Mon, 24 Sep 2007 23:08:13 +0200
Subject: [Dsa-hl-svn] r3876 - modules/common/models
Message-ID: <200709242108.l8OL8Dvh032644@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-24 23:08:06 +0200 (Mon, 24 Sep 2007)
New Revision: 3876

Modified:
   modules/common/models/tie_wolf_01_mesh.skeleton
Log:
Renamed animations to the ones of CreatureController

Modified: modules/common/models/tie_wolf_01_mesh.skeleton
===================================================================
(Binary files differ)



From blakharaz at mail.berlios.de  Tue Sep 25 23:29:43 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 25 Sep 2007 23:29:43 +0200
Subject: [Dsa-hl-svn] r3877 - modules/regressiontest/scripts/maps
Message-ID: <200709252129.l8PLTh8x031451@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-25 23:29:38 +0200 (Tue, 25 Sep 2007)
New Revision: 3877

Modified:
   modules/regressiontest/scripts/maps/regressiontest.rb
Log:
revert

Modified: modules/regressiontest/scripts/maps/regressiontest.rb
===================================================================
--- modules/regressiontest/scripts/maps/regressiontest.rb	2007-09-24 21:08:06 UTC (rev 3876)
+++ modules/regressiontest/scripts/maps/regressiontest.rb	2007-09-25 21:29:38 UTC (rev 3877)
@@ -39,21 +39,21 @@
 require 'MeshAreaTest.rb'
 
 
-# MaterialSlotTest.new([-15, 0, -5]).run()
-#    LightzoneTest.new([-10, 0, -5]).run()
-#ErrorHandlingTest.new([-10, 0, 5]).run()
-#         TimeTest.new([ -5, 0, -5]).run()
-#   MapLoadingTest.new([ -5, 0, -10]).run()
+ MaterialSlotTest.new([-15, 0, -5]).run()
+    LightzoneTest.new([-10, 0, -5]).run()
+ErrorHandlingTest.new([-10, 0, 5]).run()
+         TimeTest.new([ -5, 0, -5]).run()
+   MapLoadingTest.new([ -5, 0, -10]).run()
           NpcTest.new([ -5, 0, 5]).run()
-#         DoorTest.new([  0, 0, -5]).run()
+         DoorTest.new([  0, 0, -5]).run()
 	  WalkJobTest.new([  0, 0, -3]).run()
-#   NpcCapsuleTest.new([  0, 0, 5]).run()
-#    InventoryTest.new([  0, 0, 10]).run()
-#  JobSequenceTest.new([  5, 0, -5]).run()
-#     SelectorTest.new([  5, 0, 0]).run()
-#       EffectTest.new([  5, 0, 5]).run()
-#MergeableMeshTest.new([ 10, 0, 0]).run()
-#        SoundTest.new([ 10, 0, 10]).run()
+   NpcCapsuleTest.new([  0, 0, 5]).run()
+    InventoryTest.new([  0, 0, 10]).run()
+  JobSequenceTest.new([  5, 0, -5]).run()
+     SelectorTest.new([  5, 0, 0]).run()
+       EffectTest.new([  5, 0, 5]).run()
+MergeableMeshTest.new([ 10, 0, 0]).run()
+        SoundTest.new([ 10, 0, 10]).run()
      MeshAreaTest.new([-50, 0,-55]).run()
 
 $SCRIPT.log("tests initialisiert.");



From blakharaz at mail.berlios.de  Wed Sep 26 00:24:01 2007
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Wed, 26 Sep 2007 00:24:01 +0200
Subject: [Dsa-hl-svn] r3878 - modules/regressiontest/dsa
	modules/regressiontest/maps modules/regressiontest/scripts
	modules/regressiontest/scripts/maps
	rl/trunk/engine/common/include rl/trunk/engine/common/src
	rl/trunk/engine/rules/include rl/trunk/engine/rules/src
Message-ID: <200709252224.l8PMO15d001759@sheep.berlios.de>

Author: blakharaz
Date: 2007-09-26 00:23:52 +0200 (Wed, 26 Sep 2007)
New Revision: 3878

Modified:
   modules/regressiontest/dsa/gameobjectdefinitions.gof
   modules/regressiontest/maps/regressiontest.scene
   modules/regressiontest/scripts/GameObjectCreationTest.rb
   modules/regressiontest/scripts/maps/regressiontest.rb
   rl/trunk/engine/common/include/Properties.h
   rl/trunk/engine/common/src/Properties.cpp
   rl/trunk/engine/rules/include/GameObject.h
   rl/trunk/engine/rules/include/GameObjectManager.h
   rl/trunk/engine/rules/src/GameObject.cpp
   rl/trunk/engine/rules/src/GameObjectManager.cpp
Log:
Added inheritance for GO property sets
+ test in GameObjectCreationTest in module regressiontest

Modified: modules/regressiontest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-09-25 21:29:38 UTC (rev 3877)
+++ modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-09-25 22:23:52 UTC (rev 3878)
@@ -15,6 +15,12 @@
         <property name="mass" type="REAL" data="65"/>
     </gameobjectclass>
 
+    <gameobjectclass classid="apple2" baseclass="GameObject" inherits="apple">
+        <property name="name" type="STRING" data="Apfel 2.0"/>
+        <property name="description" type="STRING" data="Ein Apfel. Definitiv."/>
+        <property name="mass" type="REAL" data="75"/>
+    </gameobjectclass>
+
     <gameobjectclass classid="TestPerson" baseclass="NPC">
         <property name="name" type="STRING" data="TestPerson"/>
         <property name="description" type="STRING" data="Wenn man mal jemanden zum Reden braucht..."/>

Modified: modules/regressiontest/maps/regressiontest.scene
===================================================================
--- modules/regressiontest/maps/regressiontest.scene	2007-09-25 21:29:38 UTC (rev 3877)
+++ modules/regressiontest/maps/regressiontest.scene	2007-09-25 22:23:52 UTC (rev 3878)
@@ -4,9 +4,6 @@
             <position x="0.0" y="0.0" z="0.0" />
             <scale x="1.0" y="1.0" z="1.0" />
         </entity>
-        <gameobject class="hero" id="1" state="IN_SCENE">
-            <position x="0" y="0.0" z="0"/>
-        </gameobject>
         <gameobject class="mckhero" id="10" state="IN_SCENE">
             <position x="2" y="0.0" z="0"/>
         </gameobject>

Modified: modules/regressiontest/scripts/GameObjectCreationTest.rb
===================================================================
--- modules/regressiontest/scripts/GameObjectCreationTest.rb	2007-09-25 21:29:38 UTC (rev 3877)
+++ modules/regressiontest/scripts/GameObjectCreationTest.rb	2007-09-25 22:23:52 UTC (rev 3878)
@@ -1,11 +1,24 @@
 require 'testcase.rb'
 
 class GameObjectCreationTest < TestCase
-  def execure()
-    appl = $GOM.createGameObject("apple");
-    appl.setPosition(rel_pos[0,0,0]);
+  def execute()
+	$SCRIPT.log("GameObjectCreationTest start");
+    
+	appl = $GOM.createGameObject("apple");
+    appl.setPosition(rel_pos([0,0,0]));
+	appl.placeIntoScene()
 
     appl2 = $GOM.createGameObject("apple", 15);
-    appl2.setPosition(rel_pos[0,1,0]);
+    appl2.setPosition(rel_pos([0,1,0]));
+	appl2.placeIntoScene()
+	
+	appl3 = $GOM.createGameObject("apple2");
+    appl3.setPosition(rel_pos([0,0,1]));
+	appl3.placeIntoScene()
+	assertEquals(appl3.getProperty("meshfile"), "sphere.1m.mesh", "mesh file")
+	assertEquals(appl3.getProperty("description"), "Ein Apfel. Definitiv.", "description")
+	assertEquals(appl3.getProperty("mass"), 75, "property mass")
+	
+	$SCRIPT.log("GameObjectCreationTest finished");
   end
 end
\ No newline at end of file

Modified: modules/regressiontest/scripts/maps/regressiontest.rb
===================================================================
--- modules/regressiontest/scripts/maps/regressiontest.rb	2007-09-25 21:29:38 UTC (rev 3877)
+++ modules/regressiontest/scripts/maps/regressiontest.rb	2007-09-25 22:23:52 UTC (rev 3878)
@@ -45,6 +45,7 @@
          TimeTest.new([ -5, 0, -5]).run()
    MapLoadingTest.new([ -5, 0, -10]).run()
           NpcTest.new([ -5, 0, 5]).run()
+GameObjectCreationTest.new([0, 0, -10]).run()
          DoorTest.new([  0, 0, -5]).run()
 	  WalkJobTest.new([  0, 0, -3]).run()
    NpcCapsuleTest.new([  0, 0, 5]).run()

Modified: rl/trunk/engine/common/include/Properties.h
===================================================================
--- rl/trunk/engine/common/include/Properties.h	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/common/include/Properties.h	2007-09-25 22:23:52 UTC (rev 3878)
@@ -45,6 +45,7 @@
 
         virtual const Property getProperty(const Ogre::String& key) const;
         virtual void setProperty(const Ogre::String& key, const Property& value);
+        bool hasProperty(const Ogre::String& key) const;
         virtual PropertySet* getAllProperties() const;
         const PropertySetMap::const_iterator begin() const;
         const PropertySetMap::const_iterator end() const;

Modified: rl/trunk/engine/common/src/Properties.cpp
===================================================================
--- rl/trunk/engine/common/src/Properties.cpp	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/common/src/Properties.cpp	2007-09-25 22:23:52 UTC (rev 3878)
@@ -74,6 +74,11 @@
         return (*it).second;
     }
 
+    bool PropertySet::hasProperty(const Ogre::String& key) const
+    {
+        return mProperties.find(key) != mProperties.end();
+    }
+
     void PropertySet::setProperty(const Ogre::String& key, const Property& value)
     {
         mProperties[key] = value;

Modified: rl/trunk/engine/rules/include/GameObject.h
===================================================================
--- rl/trunk/engine/rules/include/GameObject.h	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/rules/include/GameObject.h	2007-09-25 22:23:52 UTC (rev 3878)
@@ -54,6 +54,7 @@
 
         static const Ogre::String PROPERTY_CLASS_ID;
         static const Ogre::String PROPERTY_OBJECT_ID;
+        static const Ogre::String PROPERTY_INHERITS;
         static const Ogre::String PROPERTY_BASE_CLASS;
         static const Ogre::String PROPERTY_POSITION; 
         static const Ogre::String PROPERTY_ORIENTATION; 

Modified: rl/trunk/engine/rules/include/GameObjectManager.h
===================================================================
--- rl/trunk/engine/rules/include/GameObjectManager.h	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/rules/include/GameObjectManager.h	2007-09-25 22:23:52 UTC (rev 3878)
@@ -81,7 +81,8 @@
         GameObjectStateListenerSet mGameObjectStateListeners;
 
         unsigned int generateId();
-        PropertySet* getClassProperties(const Ogre::String& classId);
+        PropertySet* getClassProperties(const Ogre::String& classId) const;
+        void applyProperties(GameObject* go, PropertySet* ps) const;
     };
 }
 

Modified: rl/trunk/engine/rules/src/GameObject.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObject.cpp	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/rules/src/GameObject.cpp	2007-09-25 22:23:52 UTC (rev 3878)
@@ -42,6 +42,7 @@
     const Ogre::String GameObject::PROPERTY_CLASS_ID = "classid";
     const Ogre::String GameObject::PROPERTY_BASE_CLASS = "baseclass";
     const Ogre::String GameObject::PROPERTY_POSITION = "position";
+    const Ogre::String GameObject::PROPERTY_INHERITS = "inherits";
     const Ogre::String GameObject::PROPERTY_ORIENTATION = "orientation";
     const Ogre::String GameObject::PROPERTY_NAME = "name";
     const Ogre::String GameObject::PROPERTY_DESCRIPTION = "description";

Modified: rl/trunk/engine/rules/src/GameObjectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObjectManager.cpp	2007-09-25 21:29:38 UTC (rev 3877)
+++ rl/trunk/engine/rules/src/GameObjectManager.cpp	2007-09-25 22:23:52 UTC (rev 3878)
@@ -144,11 +144,22 @@
                 goId);
 
         go->setClassId(classId);
-        go->setProperties(ps);
+        applyProperties(go, ps);
         mGameObjects[goId] = go;
         return go;
     }
 
+    void GameObjectManager::applyProperties(GameObject* go, PropertySet* ps) const
+    {
+        if (ps->hasProperty(GameObject::PROPERTY_INHERITS))
+        {
+            PropertySet* superClassProps = 
+                getClassProperties(ps->getProperty(GameObject::PROPERTY_INHERITS).toString().c_str());
+            applyProperties(go, superClassProps);
+        }
+        go->setProperties(ps);
+    }
+
 	GameObject* GameObjectManager::createGameObjectFromProperty(const Property& goProp)
 	{
 		CeGuiString serializedString = goProp.toString();
@@ -170,7 +181,7 @@
 		return Property(go->getClassId() + "|" + CEGUI::PropertyHelper::uintToString(go->getId()));
 	}
 
-    PropertySet* GameObjectManager::getClassProperties(const Ogre::String& classId)
+    PropertySet* GameObjectManager::getClassProperties(const Ogre::String& classId) const
     {
         ClassPropertyMap::const_iterator it = mClassProperties.find(classId);
         if (it == mClassProperties.end())



From melven at mail.berlios.de  Wed Sep 26 11:36:38 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Wed, 26 Sep 2007 11:36:38 +0200
Subject: [Dsa-hl-svn] r3879 - modules/common/scripts
Message-ID: <200709260936.l8Q9aclp001749@sheep.berlios.de>

Author: melven
Date: 2007-09-26 11:36:33 +0200 (Wed, 26 Sep 2007)
New Revision: 3879

Modified:
   modules/common/scripts/areahelper.rb
Log:
changed transition-distance of Zones created by _Create*Trigger

Modified: modules/common/scripts/areahelper.rb
===================================================================
--- modules/common/scripts/areahelper.rb	2007-09-25 22:23:52 UTC (rev 3878)
+++ modules/common/scripts/areahelper.rb	2007-09-26 09:36:33 UTC (rev 3879)
@@ -91,7 +91,7 @@
   zone = ZoneManager.getSingleton().createZone("limitedTimesTriggerZone_" + name);
   ZoneManager.getSingleton().addAreaToZone(
     "limitedTimesTriggerZone_" + name, 
-    size, geom_type, pos, [0,0,0], orientation, 0.5, RlScript::QUERYFLAG_PLAYER);
+    size, geom_type, pos, [0,0,0], orientation, 0.2, RlScript::QUERYFLAG_PLAYER);
   trigger.setProperty("number", times);
   trigger.setEnterCode( &enter_proc );
   trigger.setLeaveCode( &leave_proc );



From pnyx at mail.berlios.de  Wed Sep 26 15:59:48 2007
From: pnyx at mail.berlios.de (pnyx at mail.berlios.de)
Date: Wed, 26 Sep 2007 15:59:48 +0200
Subject: [Dsa-hl-svn] r3880 - in modules/ruchin: maps models
Message-ID: <200709261359.l8QDxmBb005384@sheep.berlios.de>

Author: pnyx
Date: 2007-09-26 15:59:06 +0200 (Wed, 26 Sep 2007)
New Revision: 3880

Added:
   modules/ruchin/models/Ruchin_Hexe_innen.mesh
   modules/ruchin/models/Ruchin_t.mesh
   modules/ruchin/models/arc_regal_02.mesh
Modified:
   modules/ruchin/maps/ruchin_lightzones.rlmap.xml
   modules/ruchin/models/House_dummies.mesh
   modules/ruchin/models/Ruchin_map.mesh
Log:
added part t

Modified: modules/ruchin/maps/ruchin_lightzones.rlmap.xml
===================================================================
--- modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-26 09:36:33 UTC (rev 3879)
+++ modules/ruchin/maps/ruchin_lightzones.rlmap.xml	2007-09-26 13:59:06 UTC (rev 3880)
@@ -18,6 +18,21 @@
 			<renderingdistance data="100" /> 
 		</entity>
 		
+		<entity name="Ruchin_Hexe_innen" meshfile="Ruchin_Hexe_innen.mesh" visible="true" receivesShadow="true">
+			<position x="30.0" y="0.0" z="30.0" />
+			<rotation qx="0.0" qy="0.0" qz="0.0" qw="1.0" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<staticgeometrygroup id="0"/>
+			<renderingdistance data="100" /> 
+		</entity>
+		<entity name="Ruchin_t" meshfile="Ruchin_t.mesh" visible="true" receivesShadow="true">
+			<position x="30.0" y="0.0" z="30.0" />
+			<rotation qx="0.0" qy="0.0" qz="0.0" qw="1.0" />
+			<scale x="1.0" y="1.0" z="1.0" />
+			<staticgeometrygroup id="0"/>
+			<renderingdistance data="100" /> 
+		</entity>
+		
 		<entity name="Ruchin_g" meshfile="Ruchin_g.mesh" visible="true" receivesShadow="true">
 			<position x="120.0" y="0.0" z="-50.0" />
 			<rotation qx="0.0" qy="0.0" qz="0.0" qw="1.0" />

Modified: modules/ruchin/models/House_dummies.mesh
===================================================================
(Binary files differ)

Added: modules/ruchin/models/Ruchin_Hexe_innen.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_Hexe_innen.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/ruchin/models/Ruchin_map.mesh
===================================================================
(Binary files differ)

Added: modules/ruchin/models/Ruchin_t.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/Ruchin_t.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/ruchin/models/arc_regal_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/ruchin/models/arc_regal_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From melven at mail.berlios.de  Wed Sep 26 18:13:37 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Wed, 26 Sep 2007 18:13:37 +0200
Subject: [Dsa-hl-svn] r3881 - in rl/trunk/engine: core/include core/src ui
	ui/include ui/src
Message-ID: <200709261613.l8QGDbWf016578@sheep.berlios.de>

Author: melven
Date: 2007-09-26 18:13:18 +0200 (Wed, 26 Sep 2007)
New Revision: 3881

Modified:
   rl/trunk/engine/core/include/GameEventManager.h
   rl/trunk/engine/core/src/ConfigurationManager.cpp
   rl/trunk/engine/ui/RlUI2005.vcproj
   rl/trunk/engine/ui/include/AbstractWindow.h
   rl/trunk/engine/ui/include/Console.h
   rl/trunk/engine/ui/include/ControlState.h
   rl/trunk/engine/ui/include/DialogControlState.h
   rl/trunk/engine/ui/include/FreeflightControlState.h
   rl/trunk/engine/ui/include/InputManager.h
   rl/trunk/engine/ui/include/MovementControlState.h
   rl/trunk/engine/ui/include/WindowManager.h
   rl/trunk/engine/ui/src/Console.cpp
   rl/trunk/engine/ui/src/ControlState.cpp
   rl/trunk/engine/ui/src/DialogControlState.cpp
   rl/trunk/engine/ui/src/FreeflightControlState.cpp
   rl/trunk/engine/ui/src/GameSettings.cpp
   rl/trunk/engine/ui/src/InputManager.cpp
   rl/trunk/engine/ui/src/MovementControlState.cpp
   rl/trunk/engine/ui/src/WindowFactory.cpp
   rl/trunk/engine/ui/src/WindowManager.cpp
Log:
-Added possibility to save the history of the console
-Now using the InputManager as Listener for Keyboard- and Mouse-Events, so the input-handling is easier (the contol-states don't need to care about input to cegui)
 ControlStates now get all input (even if already handled by cegui)
-The InputManager implements a Job for KeyRepeating, AbstractWindows can specify keys, that should be repeated (at the moment the console uses this feature)
-If a Window does not use mouseinput, the controlstates can use it (you could look around while putting text in the console)
-opening a window while turning around doesn't create strange camera-positions any more

Modified: rl/trunk/engine/core/include/GameEventManager.h
===================================================================
--- rl/trunk/engine/core/include/GameEventManager.h	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/core/include/GameEventManager.h	2007-09-26 16:13:18 UTC (rev 3881)
@@ -57,7 +57,7 @@
      */
     virtual void run( Ogre::Real elapsedTime );
 
-    /** F?gt eine Sphere Area hinzu, und h?ngt einen Listener an
+    /** DEPRECATED! F?gt eine Sphere Area hinzu, und h?ngt einen Listener an
     *
     * @param actor Der Actor um den herum die Kugel aufgespannt werden soll
     * @param queryMask Die Maske um die SzenenAnfrage zu beschleunigen

Modified: rl/trunk/engine/core/src/ConfigurationManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ConfigurationManager.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/core/src/ConfigurationManager.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -60,6 +60,7 @@
         // Setup general default values
         addSetting("General", "Log Level", "2");
         addSetting("General", "Subtitle Speed", "0.0");
+        addSetting("General", "Save Console History", "50");
 
         // Setup sound default values
         addSetting("Sound", "DefaultMusicVolume", "0.4");

Modified: rl/trunk/engine/ui/RlUI2005.vcproj
===================================================================
--- rl/trunk/engine/ui/RlUI2005.vcproj	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/RlUI2005.vcproj	2007-09-26 16:13:18 UTC (rev 3881)
@@ -373,10 +373,6 @@
 				>
 			</File>
 			<File
-				RelativePath=".\include\GameSettings.h"
-				>
-			</File>
-			<File
 				RelativePath=".\include\InputManager.h"
 				>
 			</File>
@@ -468,6 +464,10 @@
 					>
 				</File>
 				<File
+					RelativePath=".\include\GameSettings.h"
+					>
+				</File>
+				<File
 					RelativePath=".\include\InfoPopup.h"
 					>
 				</File>
@@ -582,10 +582,6 @@
 				>
 			</File>
 			<File
-				RelativePath=".\src\GameSettings.cpp"
-				>
-			</File>
-			<File
 				RelativePath=".\src\InputManager.cpp"
 				>
 			</File>
@@ -697,6 +693,10 @@
 					>
 				</File>
 				<File
+					RelativePath=".\src\GameSettings.cpp"
+					>
+				</File>
+				<File
 					RelativePath=".\src\InfoPopup.cpp"
 					>
 				</File>

Modified: rl/trunk/engine/ui/include/AbstractWindow.h
===================================================================
--- rl/trunk/engine/ui/include/AbstractWindow.h	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/include/AbstractWindow.h	2007-09-26 16:13:18 UTC (rev 3881)
@@ -95,6 +95,9 @@
 
 		virtual void windowHid();
 
+        // return true, if the specified key should be repeated if pressed down
+        virtual bool wantsKeyToRepeat(const int &key) {return false;}
+
 	protected:
 		AbstractWindow(
 			const CeGuiString& xmlfile, 

Modified: rl/trunk/engine/ui/include/Console.h
===================================================================
--- rl/trunk/engine/ui/include/Console.h	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/include/Console.h	2007-09-26 16:13:18 UTC (rev 3881)
@@ -36,12 +36,15 @@
 	{
 		public:
 			Console();
+            ~Console();
 			
 			void setRubyInterpreter(RubyInterpreter* interpreter);
 			void write(const CeGuiString& output);
 				
 			void setVisible(bool visible, bool destroyAfterHide = false);
 
+            bool wantsKeyToRepeat(const int &key);
+
 		private:
 			CEGUI::Editbox* mCommandLine;
 			CEGUI::Listbox* mDisplay;
@@ -50,6 +53,7 @@
 			bool mPrompt;
 
 			bool handleKeyDown(const CEGUI::EventArgs& e);
+            bool handleKeyUp(const CEGUI::EventArgs& e);
 			void appendTextRow(const CeGuiString& text, const CEGUI::colour color);
 
 			std::vector<CeGuiString> mHistory;

Modified: rl/trunk/engine/ui/include/ControlState.h
===================================================================
--- rl/trunk/engine/ui/include/ControlState.h	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/include/ControlState.h	2007-09-26 16:13:18 UTC (rev 3881)
@@ -35,7 +35,7 @@
     /**
      * This class handles character control via user input.
      */
-    class _RlUiExport ControlState : public OIS::KeyListener, public OIS::MouseListener
+    class _RlUiExport ControlState// : public OIS::KeyListener, public OIS::MouseListener
     {
 	public:
 
@@ -52,11 +52,11 @@
 
         virtual void run(Ogre::Real elapsedTime) = 0;
 
-        virtual bool mousePressed(const OIS::MouseEvent& evt, OIS::MouseButtonID id);
-        virtual bool mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id);
-        virtual bool mouseMoved(const OIS::MouseEvent& evt);
-        virtual bool keyPressed(const OIS::KeyEvent& evt);
-        virtual bool keyReleased(const OIS::KeyEvent& evt);
+        virtual bool mousePressed(const OIS::MouseEvent& evt, OIS::MouseButtonID id, bool handled); // if handled is true, we should not handle the event!
+        virtual bool mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id, bool handled);
+        virtual bool mouseMoved(const OIS::MouseEvent& evt, bool handled);
+        virtual bool keyPressed(const OIS::KeyEvent& evt, bool handled);
+        virtual bool keyReleased(const OIS::KeyEvent& evt, bool handled);
 
         const CommandMapper* getCommandMapper() const {return mCommandMapper;}
         ControlStateType getType() const { return mType;}
@@ -64,14 +64,9 @@
         static bool startAction(const CeGuiString& actionName, Creature* character = NULL);
 
 	protected:
-        /// Returns true, if there is at least one window open,
-        /// that requires keyboard and/or mouse input. 
-        bool isCeguiActive() const;
 
-        /// Returns true, if the key event should be injected into CEGUI
-        /// This is the case, if an open window requests key input and it is
-        /// an input or navigation key.
-        //bool sendKeyToCeGui(const OIS::KeyEvent& evt) const;
+        /// returns wether cegui currently uses the mouse
+        bool isMouseUsedByCegui() const;
 
         Person* mCharacter;
 

Modified: rl/trunk/engine/ui/include/DialogControlState.h
===================================================================
--- rl/trunk/engine/ui/include/DialogControlState.h	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/include/DialogControlState.h	2007-09-26 16:13:18 UTC (rev 3881)
@@ -66,7 +66,7 @@
 		/// Antwort eines der Dialogf?hrenden
 		void response(Actor* actor, const CeGuiString& text, const Ogre::String& soundFile = "");
 
-        virtual bool mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id);
+        virtual bool mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id, bool handled);
 
 		bool handleDialogSelectOption();	
 		bool handleDialogClose();

Modified: rl/trunk/engine/ui/include/FreeflightControlState.h
===================================================================
--- rl/trunk/engine/ui/include/FreeflightControlState.h	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/include/FreeflightControlState.h	2007-09-26 16:13:18 UTC (rev 3881)
@@ -46,8 +46,8 @@
 
 		virtual void run(Ogre::Real elapsedTime);
 
-        virtual bool keyPressed(const OIS::KeyEvent& evt);
-        virtual bool keyReleased(const OIS::KeyEvent& evt);
+        virtual bool keyPressed(const OIS::KeyEvent& evt, bool handled);
+        virtual bool keyReleased(const OIS::KeyEvent& evt, bool handled);
 
 	    void toggleCameraCollision();
 	    void resetCamera();

Modified: rl/trunk/engine/ui/include/InputManager.h
===================================================================
--- rl/trunk/engine/ui/include/InputManager.h	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/include/InputManager.h	2007-09-26 16:13:18 UTC (rev 3881)
@@ -41,7 +41,8 @@
     class _RlUiExport InputManager
         :    public Ogre::Singleton<InputManager>,
             public GameTask,
-            private XmlProcessor
+            private XmlProcessor,
+            public OIS::KeyListener, public OIS::MouseListener
     {
     public:
 
@@ -49,6 +50,7 @@
         ~InputManager();
 
         bool isMouseButtonDown( OIS::MouseButtonID buttonID );
+        bool isKeyDown( OIS::KeyCode key );
 
         Ogre::Real getMouseRelativeX(void) const;
         Ogre::Real getMouseRelativeY(void) const;
@@ -85,6 +87,12 @@
         int getModifierCode() const;
         const CEGUI::utf8& getKeyChar(int keycode, int modifiers) const;
 
+        virtual bool mousePressed(const OIS::MouseEvent& evt, OIS::MouseButtonID id);
+        virtual bool mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id);
+        virtual bool mouseMoved(const OIS::MouseEvent& evt);
+        virtual bool keyPressed(const OIS::KeyEvent& evt);
+        virtual bool keyReleased(const OIS::KeyEvent& evt);
+
     private:
         enum { NUM_MOUSE_BUTTON=4, NUM_KEYS=256 };
         enum Modifiers {ALT_MASK = 1, CTRL_MASK = 2, SHIFT_MASK = 4, SUPER_MASK = 8};

Modified: rl/trunk/engine/ui/include/MovementControlState.h
===================================================================
--- rl/trunk/engine/ui/include/MovementControlState.h	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/include/MovementControlState.h	2007-09-26 16:13:18 UTC (rev 3881)
@@ -75,9 +75,9 @@
         */
         void resetCamera();
 
-        virtual bool mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id);
-        virtual bool keyPressed(const OIS::KeyEvent& evt);
-        virtual bool keyReleased(const OIS::KeyEvent& evt);
+        virtual bool mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id, bool handled);
+        virtual bool keyPressed(const OIS::KeyEvent& evt, bool handled);
+        virtual bool keyReleased(const OIS::KeyEvent& evt, bool handled);
 
         // Overrides from DebugVisualisable
         virtual DebugVisualisableFlag getFlag() const;

Modified: rl/trunk/engine/ui/include/WindowManager.h
===================================================================
--- rl/trunk/engine/ui/include/WindowManager.h	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/include/WindowManager.h	2007-09-26 16:13:18 UTC (rev 3881)
@@ -52,6 +52,8 @@
         /// Callback for Windows, called when there visibility is changed.
         void _visiblityChanged(AbstractWindow* window, bool isVisible);
 
+        AbstractWindow* getActiveWindow();
+
 	private:
 		std::list<AbstractWindow*> mWindowList;
 

Modified: rl/trunk/engine/ui/src/Console.cpp
===================================================================
--- rl/trunk/engine/ui/src/Console.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/src/Console.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -16,6 +16,7 @@
 #include "stdinc.h" //precompiled header
 
 #include "Console.h"
+#include "ConfigurationManager.h"
 
 #include <boost/bind.hpp>
 #include <elements/CEGUIFrameWindow.h>
@@ -24,6 +25,8 @@
 #include "ListboxWrappedTextItem.h"
 #include "InputManager.h"
 #include "CoreSubsystem.h"
+#include "JobScheduler.h"
+#include "Job.h"
 
 using namespace Ogre;
 
@@ -39,6 +42,7 @@
 		using namespace CEGUI;
 
 		mDisplay = getListbox("Console/Display");
+        mDisplay->setShowVertScrollbar(true);
 		mCommandLine = getEditbox("Console/Inputbox");
 
 		mWindow->subscribeEvent(
@@ -47,15 +51,82 @@
 		mCommandLine->subscribeEvent(
 			Editbox::EventKeyDown,
 			boost::bind(&Console::handleKeyDown, this, _1));
-		mDisplay->moveToFront();
-
+		mWindow->subscribeEvent(
+			FrameWindow::EventKeyUp,
+			boost::bind(&Console::handleKeyUp, this, _1));
+		mCommandLine->subscribeEvent(
+			Editbox::EventKeyUp,
+			boost::bind(&Console::handleKeyUp, this, _1));
 		mWindow->subscribeEvent(FrameWindow::EventCloseClicked,
             boost::bind(&Console::hideWindow, this));
 
-		mHistory.clear();
+		// load history from file
+        if( ConfigurationManager::getSingleton().getIntSetting("General", "Save Console History") > 0 )
+        {
+            // load file
+            std::ifstream historyFile;
+            std::string filename;
+            // compare with ConfigurationManager
+#if OGRE_PLATFORM == OGRE_PLATFORM_LINUX
+            filename = Ogre::String(::getenv("HOME")) + "/.rastullah/console_history";
+#else
+            filename = "./modules/config/console_history";
+#endif
+            historyFile.open(filename.c_str());
+            if( !historyFile.good() )
+            {
+                LOG_MESSAGE(Logger::UI, "could not open history file");
+            }
+            else
+            {
+                // parse history file
+                while( !historyFile.eof() )
+                {
+                    std::string str;
+                    std::getline(historyFile, str);
+                    if( str != "" )
+                        mHistory.push_back(str);
+                }
+            }
+        }
         setVisible(false);
 	}
 
+
+    Console::~Console()
+    {
+		// save history to file
+        int lines = ConfigurationManager::getSingleton().getIntSetting("General", "Save Console History");
+        if( lines > 0 )
+        {
+            // file
+            std::ofstream historyFile;
+            std::string filename;
+            // compare with ConfigurationManager
+#if OGRE_PLATFORM == OGRE_PLATFORM_LINUX
+            filename = Ogre::String(::getenv("HOME")) + "/.rastullah/console_history";
+#else
+            filename = "./modules/config/console_history";
+#endif
+            historyFile.open(filename.c_str());
+            if( !historyFile.good() )
+            {
+                LOG_MESSAGE(Logger::UI, "could not open history file for writing");
+            }
+            else
+            {
+                std::vector<CeGuiString>::reverse_iterator it = mHistory.rbegin();
+                while( lines > 0 && it != mHistory.rend() )
+                {
+                    lines--;
+                    if( (*it) != "" )
+                        historyFile << (*it) << std::endl;
+                    it++;
+                }
+            }
+        }
+    }
+
 	void Console::setVisible(bool visible, bool destroy)
 	{
 		if (visible)
@@ -67,7 +138,9 @@
 	}
 
 	bool Console::handleKeyDown(const CEGUI::EventArgs& e)
-	{
+    {
+        InputManager* im = InputManager::getSingletonPtr();
+        static const CEGUI::utf8 NO_CHAR = 0;
 		KeyEventArgs ke = static_cast<const KeyEventArgs&>(e);
         if (ke.scancode == Key::ArrowDown)
 		{
@@ -92,14 +165,52 @@
 			mCommandLine->setText((utf8*)"");
 			return true;
 		}
+        else
+        {
+            if( im->getKeyChar(ke.scancode, im->getModifierCode()) != NO_CHAR )
+            {
+                InputManager* im = InputManager::getSingletonPtr();
+                CEGUI::System& cegui = CEGUI::System::getSingleton();
+                cegui.injectChar(im->getKeyChar(ke.scancode, im->getModifierCode()));
+                return true;
+            }
+        }
+
+		return false;
+	}
+
+    bool Console::wantsKeyToRepeat(const int &key)
+    {
         InputManager* im = InputManager::getSingletonPtr();
         static const CEGUI::utf8 NO_CHAR = 0;
-        if( im->getKeyChar(ke.scancode, im->getModifierCode()) != NO_CHAR )
+        if( im->getKeyChar(key, im->getModifierCode()) != NO_CHAR || // keys that should be repeated
+            key == CEGUI::Key::ArrowDown ||
+            key == CEGUI::Key::ArrowUp ||
+            key == CEGUI::Key::Return ||
+            key == CEGUI::Key::ArrowLeft ||
+            key == CEGUI::Key::ArrowRight ||
+            key == CEGUI::Key::Backspace ||
+            key == CEGUI::Key::Delete )
             return true;
 
-		return false;
-	}
+        return false;
+    }
 
+    bool Console::handleKeyUp(const CEGUI::EventArgs& e)
+    {
+        // return true for keys handled in keyup
+        InputManager* im = InputManager::getSingletonPtr();
+        static const CEGUI::utf8 NO_CHAR = 0;
+        KeyEventArgs ke = static_cast<const KeyEventArgs&>(e);
+        if( im->getKeyChar(ke.scancode, im->getModifierCode()) != NO_CHAR ||
+            ke.scancode == CEGUI::Key::ArrowDown ||
+            ke.scancode == CEGUI::Key::ArrowUp ||
+            ke.scancode == CEGUI::Key::Return )
+            return true;
+        else
+            return false;
+    }
+
 	void Console::write(const CeGuiString& output)
 	{
 		CeGuiString temp;

Modified: rl/trunk/engine/ui/src/ControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/ControlState.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/src/ControlState.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -130,77 +130,25 @@
 		return true;
 	}
 
-    bool ControlState::mousePressed(const OIS::MouseEvent& evt, OIS::MouseButtonID id)
+    bool ControlState::mousePressed(const OIS::MouseEvent& evt, OIS::MouseButtonID id, bool handled)
     {
-        if (WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT)
-        {
-            bool retval = CEGUI::System::getSingleton().injectMouseButtonDown(
-                static_cast<CEGUI::MouseButton>(id));
-            return retval;
-        }
-        
         return false;
     }
 
-    bool ControlState::mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id)
+    bool ControlState::mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id, bool handled)
     {
-        if (WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT)
-        {
-            bool retval = CEGUI::System::getSingleton().injectMouseButtonUp(static_cast<CEGUI::MouseButton>(id));
-            return retval;
-        }
-
         return false;
     }
 
-    bool ControlState::mouseMoved(const OIS::MouseEvent& evt)
+    bool ControlState::mouseMoved(const OIS::MouseEvent& evt, bool handled)
     {
-        if (WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT)
-        {
-            bool retval;
-            //CEGUI::Renderer* renderer = CEGUI::System::getSingleton().getRenderer();
-            retval = CEGUI::System::getSingleton().injectMouseMove(evt.state.X.rel, evt.state.Y.rel);
-            return true;
-        }
-
         return false;
     }
 
-    bool ControlState::keyPressed(const OIS::KeyEvent& evt)
+    bool ControlState::keyPressed(const OIS::KeyEvent& evt, bool handled)
     {
-        InputManager* im = InputManager::getSingletonPtr();
+        int code = CommandMapper::encodeKey(evt.key, InputManager::getSingleton().getModifierCode());
 
-        if ( WindowManager::getSingleton().getWindowInputMask()
-            & AbstractWindow::WIT_KEYBOARD_INPUT )
-        {
-            bool retval;
-            CEGUI::System& cegui = CEGUI::System::getSingleton();
-            retval = cegui.injectKeyDown(evt.key);
-            return retval;
-        }
-
-        return false;
-    }
-
-    bool ControlState::keyReleased(const OIS::KeyEvent& evt)
-    {
-        InputManager* im = InputManager::getSingletonPtr();
-
-        if ( WindowManager::getSingleton().getWindowInputMask()
-            & AbstractWindow::WIT_KEYBOARD_INPUT )
-        {
-            bool retval;
-            CEGUI::System& cegui = CEGUI::System::getSingleton();
-            retval = cegui.injectKeyUp(evt.key);
-            if( !retval )
-                retval = cegui.injectChar(im->getKeyChar(evt.key, im->getModifierCode()));
-            
-            if( retval )
-                return true;
-        }
-
-        int code = CommandMapper::encodeKey(evt.key, im->getModifierCode());
-
         // First see, if a control state action is defined
 	    CeGuiString action = mCommandMapper->getControlStateAction(code, mType);
         if (action == "")
@@ -208,48 +156,23 @@
             // No. So try global actions.
             action = mCommandMapper->getGlobalAction(code);
         }
-        return startAction(action, mCharacter);
+        if( !handled )
+            return startAction(action, mCharacter);
 
+        // hack to enable tab to hide the console-window if opened
+        if( action == "toggleconsole" ) // we start toggleconsole always, even if handled, because cegui handles tab
+            return startAction(action, mCharacter);
+
+        return false;
     }
 
-    bool ControlState::isCeguiActive() const
+    bool ControlState::keyReleased(const OIS::KeyEvent& evt, bool handled)
     {
-        return WindowManager::getSingleton().getWindowInputMask() != 0;
+        return false;
     }
-/*
-    bool ControlState::sendKeyToCeGui(const OIS::KeyEvent& evt) const
-    {
-        InputManager* im = InputManager::getSingletonPtr();
 
-        // Wenn kein Fenster mit Tastatureingabe aktiv ist, kriegt CEGUI keine KeyEvents
-        if ((WindowManager::getSingleton().getWindowInputMask()
-            & AbstractWindow::WIT_KEYBOARD_INPUT) )
-        {
-            return true;
-        }
-
-        return false;
-
-        // ---- Tastatureingabe gefordert ----
-
-        // Tasten, die Zeichen liefern sollen an CEGUI gesendet werden
-        if (im->getKeyChar(evt.key, im->getModifierCode()) != 0)
-        {
-            return true;
-        }
-
-        if (evt.key == OIS::KC_RETURN
-            || evt.key == OIS::KC_HOME || evt.key == OIS::KC_END
-            || evt.key == OIS::KC_LEFT || evt.key == OIS::KC_RIGHT
-            || evt.key == OIS::KC_BACK || evt.key == OIS::KC_DELETE
-            || evt.key == OIS::KC_UP   || evt.key == OIS::KC_DOWN
-            || evt.key == OIS::KC_RMENU
-            || evt.key == OIS::KC_LCONTROL)
-        {
-            return true;
-        }
-
-        return false;
+    bool ControlState::isMouseUsedByCegui() const
+    {
+        return WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT;
     }
-*/
 }

Modified: rl/trunk/engine/ui/src/DialogControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/DialogControlState.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/src/DialogControlState.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -317,21 +317,22 @@
     }
 
     bool DialogControlState::mouseReleased(const OIS::MouseEvent& evt,
-        OIS::MouseButtonID id)
+        OIS::MouseButtonID id, bool handled)
     {
-        if( ControlState::mouseReleased(evt, id) )
-            return true;
+        bool retval = false;
+        if( ControlState::mouseReleased(evt, id, handled) )
+            retval = true;
 
-        if (mTextShown && (mCurrFadeTextTime + 0.25) < mTotalFadeTextTime)
+        if( !handled && !retval )
         {
-            mCurrFadeTextTime = -1;
+            if (mTextShown && (mCurrFadeTextTime + 0.25) < mTotalFadeTextTime)
+            {
+                mCurrFadeTextTime = -1;
+                retval = true;
+            }
+        }
 
-            return true;
-        }
-        else
-        {
-            return false;
-        }
+        return retval;
     }
 
 	void DialogControlState::start()

Modified: rl/trunk/engine/ui/src/FreeflightControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/FreeflightControlState.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/src/FreeflightControlState.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -103,10 +103,8 @@
 
 	void FreeflightControlState::run(Real elapsedTime)
 	{
-        if (isCeguiActive()) return;
+        InputManager* im = InputManager::getSingletonPtr();
 
-		InputManager* im = InputManager::getSingletonPtr();
-
 		// Fetch current movement state
 		mDesiredVelocity = Vector3::ZERO;
 
@@ -150,7 +148,10 @@
             }
         }
 
-		mMovementSpeed += im->getMouseRelativeZ() * mSpeedIncrement;
+        bool useMouseInput = !isMouseUsedByCegui();
+
+        if( useMouseInput )
+		    mMovementSpeed += im->getMouseRelativeZ() * mSpeedIncrement;
 		if (mMovementSpeed < mSpeedRange.first)
 		{
 			mMovementSpeed = mSpeedRange.first;
@@ -169,16 +170,20 @@
         // mouse
         if( !(movement & TURN_LEFT || movement & TURN_RIGHT) )
         {
-            mYaw -= mMouseSensitivity * Degree(im->getMouseRelativeX() / 10);
+            if( useMouseInput )
+                mYaw -= mMouseSensitivity * Degree(im->getMouseRelativeX() / 10);
         }
         while (mYaw.valueDegrees() > 360.0f) mYaw -= Degree(360.0f);
         while (mYaw.valueDegrees() < -360.0f) mYaw += Degree(360.0f);
 
 
-        if (mInvertedMouse)
-            mPitch += mMouseSensitivity * Degree(im->getMouseRelativeY() / 4);
-        else
-            mPitch -= mMouseSensitivity * Degree(im->getMouseRelativeY() / 4);
+        if (useMouseInput )
+        {
+            if (mInvertedMouse)
+                mPitch += mMouseSensitivity * Degree(im->getMouseRelativeY() / 4);
+            else
+                mPitch -= mMouseSensitivity * Degree(im->getMouseRelativeY() / 4);
+        }
 
         while (mPitch.valueDegrees() > 360.0f) mPitch -= Degree(360.0f);
         while (mPitch.valueDegrees() < -360.0f) mPitch += Degree(360.0f);
@@ -220,72 +225,36 @@
         mPitch = Degree(0);
 	}
 
-    bool FreeflightControlState::keyPressed(const OIS::KeyEvent& evt)
+    bool FreeflightControlState::keyPressed(const OIS::KeyEvent& evt, bool handled)
 	{
-        if( ControlState::keyPressed(evt) )
-            return true;
-
-        int movement = mCommandMapper->getMovement(evt.key);
-
-		if (movement != MOVE_NONE)
-		{
-			mCurrentMovementState |= movement;
-			return true;
-		}
-
-		return false;
-	}
-
-    bool FreeflightControlState::keyReleased(const OIS::KeyEvent& evt)
-	{
-        // this should be the same as in ControlState::keyReleased!
-        InputManager* im = InputManager::getSingletonPtr();
-        if ( WindowManager::getSingleton().getWindowInputMask()
-            & AbstractWindow::WIT_KEYBOARD_INPUT )
+        bool retval = false;
+        if( !handled )
         {
-            bool retval;
-            CEGUI::System& cegui = CEGUI::System::getSingleton();
-            retval = cegui.injectKeyUp(evt.key);
-            if( !retval )
-                retval = cegui.injectChar(im->getKeyChar(evt.key, im->getModifierCode()));
-            
-            if( retval )
-                return true;
-        }
+            int movement = mCommandMapper->getMovement(evt.key);
 
-
-        int code = CommandMapper::encodeKey(evt.key, im->getModifierCode());
-        // First see, if a control state action is defined
-	    CeGuiString command = mCommandMapper->getControlStateAction(code, mType);
-        if (command == "")
-        {
-            // No. So try global actions.
-            command = mCommandMapper->getGlobalAction(code);
+		    if (movement != MOVE_NONE)
+		    {
+			    mCurrentMovementState |= movement;
+			    retval = true;
+		    }
         }
-        if (command == "back_to_character_movement")
-        {
-            InputManager::getSingleton().popControlState();
-            return true;
-        }
-        if (command == "toggle_camera_collision")
-        {
-            toggleCameraCollision();
-            return true;
-        }
-        if( startAction(command, mCharacter) )
-            return true;
 
+        retval = retval || ControlState::keyPressed(evt, retval || handled);
+        return retval;
+	}
 
-
-
+    bool FreeflightControlState::keyReleased(const OIS::KeyEvent& evt, bool handled)
+	{
+        bool retval = false;
         int movement = mCommandMapper->getMovement(evt.key);
 		if (movement != MOVE_NONE)
 		{
 			mCurrentMovementState &= ~movement;
-			return true;
+			retval = true;
 		}
 
-        return false;
+        retval = retval || ControlState::keyReleased(evt, handled || retval);
+        return retval;
 	}
 
     int FreeflightControlState::userProcess()

Modified: rl/trunk/engine/ui/src/GameSettings.cpp
===================================================================
--- rl/trunk/engine/ui/src/GameSettings.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/src/GameSettings.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -47,6 +47,7 @@
                                     boost::bind(&GameSettings::onCancel, this));
 
         centerWindow();
+        setVisible(false);
     }
 
     GameSettings::~GameSettings()
@@ -112,11 +113,13 @@
 
     bool GameSettings::onApply()
     {
+        hideWindow();
         return true;
     }
 
     bool GameSettings::onCancel()
     {
+        hideWindow();
         return true;
     }
 

Modified: rl/trunk/engine/ui/src/InputManager.cpp
===================================================================
--- rl/trunk/engine/ui/src/InputManager.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/src/InputManager.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -43,10 +43,13 @@
 #include "FreeflightControlState.h"
 #include "GameLoop.h"
 #include "GameObject.h"
+#include "Job.h"
+#include "JobScheduler.h"
 #include "MovementControlState.h"
 #include "RubyInterpreter.h"
 #include "UiSubsystem.h"
 #include "WindowFactory.h"
+#include "WindowManager.h"
 
 using namespace Ogre;
 using namespace OIS;
@@ -116,8 +119,10 @@
         LOG_DEBUG(Logger::UI, "Initializing input manager: Create Keyboard input.");
         mKeyboard = static_cast<OIS::Keyboard*>(mInputManager->createInputObject(OIS::OISKeyboard, true));
         mKeyboard->setTextTranslation(OIS::Keyboard::Unicode);
+        mKeyboard->setEventCallback(this);
         LOG_DEBUG(Logger::UI, "Initializing input manager: Create Mouse Input.");
         mMouse = static_cast<OIS::Mouse*>(mInputManager->createInputObject(OIS::OISMouse, true));
+        mMouse->setEventCallback(this);
 
         LOG_DEBUG(Logger::UI, "Initializing input manager: Set mouse paremeters.");
         unsigned int width, height, depth;
@@ -159,6 +164,11 @@
         return ms.buttonDown( buttonID );
     }
 
+    bool InputManager::isKeyDown( OIS::KeyCode key )
+    {
+        return mKeyboard->isKeyDown(key);
+    }
+
     Ogre::Real InputManager::getMouseRelativeX() const
     {
         return (float)mMouse->getMouseState().X.rel;
@@ -399,8 +409,8 @@
             mControlStates.top()->pause();
         }
 
-        mKeyboard->setEventCallback(controller);
-        mMouse->setEventCallback(controller);
+        //mKeyboard->setEventCallback(controller);
+        //mMouse->setEventCallback(controller);
 
         mControlStates.push(controller);
         mControlStates.top()->resume();
@@ -416,14 +426,14 @@
         if (!mControlStates.empty())
         {
             ControlState* newController = mControlStates.top();
-            mKeyboard->setEventCallback(newController);
-            mMouse->setEventCallback(newController);
+            //mKeyboard->setEventCallback(newController);
+            //mMouse->setEventCallback(newController);
             newController->resume();
         }
         else
         {
-            mKeyboard->setEventCallback(NULL);
-            mMouse->setEventCallback(NULL);
+            //mKeyboard->setEventCallback(NULL);
+            //mMouse->setEventCallback(NULL);
         }
     }
 
@@ -452,4 +462,132 @@
         pushControlState(CST_DIALOG);
         return true;
     }
+
+    bool InputManager::mousePressed(const OIS::MouseEvent& evt, OIS::MouseButtonID id)
+    {
+        bool retval = false;
+        if( WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT )
+        {
+            if( CEGUI::System::getSingleton().injectMouseButtonDown(
+                static_cast<CEGUI::MouseButton>(id)) )
+                retval = true;
+        }
+
+        if( !mControlStates.empty() )
+            retval = retval || mControlStates.top()->mousePressed(evt, id, retval);
+        return retval;
+    }
+
+    bool InputManager::mouseReleased(const OIS::MouseEvent& evt, OIS::MouseButtonID id)
+    {
+        bool retval = false;
+        if( WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT )
+        {
+            if( CEGUI::System::getSingleton().injectMouseButtonUp(
+                static_cast<CEGUI::MouseButton>(id)) )
+                retval = true;
+        }
+
+        if( !mControlStates.empty() )
+            if( mControlStates.top()->mouseReleased(evt, id, retval) )
+                retval = true;
+        return retval;
+    }
+
+    bool InputManager::mouseMoved(const OIS::MouseEvent& evt)
+    {
+        bool retval = false;
+        if( WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_MOUSE_INPUT )
+        {
+            if( CEGUI::System::getSingleton().injectMouseMove(
+                evt.state.X.rel, evt.state.Y.rel ) )
+                retval = true;
+        }
+
+        if( !mControlStates.empty() )
+            if( mControlStates.top()->mouseMoved(evt, retval) )
+                retval = true;
+        return retval;
+    }
+
+    // job definition for key repeating
+    // this job is created when a key was pressed and the processing window wants the key to be repeated
+    class KeyRepeatJob : public Job
+    {
+    public:
+        KeyRepeatJob(AbstractWindow* window, OIS::KeyCode key) : 
+          Job(false, true),
+          mWindow(window),
+          mKey(key),
+          mLastTime(0)
+        {
+        }
+        bool execute(Ogre::Real t)
+        {
+            rl::Time time = TimeSourceManager::getSingleton().getTimeSource(TimeSource::REALTIME_CONTINUOUS)->getClock();
+            if ( WindowManager::getSingleton().getActiveWindow() == mWindow && // perhaps window was deleted!!
+                InputManager::getSingleton().isKeyDown(OIS::KeyCode(mKey)) )
+            {
+                if ( time - mLastTime > 50 )
+                {
+                    bool handled = false;
+                    handled = handled || CEGUI::System::getSingleton().injectKeyDown(mKey);
+                    handled = handled || CEGUI::System::getSingleton().injectKeyUp(mKey);
+                    
+                    mLastTime = time;
+
+                    if( !handled )  // we don't need a job for keys, that are not handled!
+                        return true;
+                }
+                return false;
+            }
+            else
+                return true; // delete this job
+        }
+    private:
+        rl::Time mLastTime;
+        AbstractWindow* mWindow;
+        OIS::KeyCode mKey;
+    };
+
+    bool InputManager::keyPressed(const OIS::KeyEvent& evt)
+    {
+        bool retval = false;
+        if( WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_KEYBOARD_INPUT )
+        {
+            AbstractWindow *activeWin = WindowManager::getSingleton().getActiveWindow();
+            if( activeWin != NULL )
+            {
+                if( activeWin->wantsKeyToRepeat(evt.key) )
+                {
+                    KeyRepeatJob *job = new KeyRepeatJob(activeWin, evt.key);
+                    JobScheduler::getSingleton().addJob(job, JobScheduler::JP_NORMAL, 0.5);
+                }
+            }
+
+            if( CEGUI::System::getSingleton().injectKeyDown( evt.key ) )
+                retval = true;
+        }
+
+        if( !mControlStates.empty() )
+            if( mControlStates.top()->keyPressed(evt, retval) )
+                retval = true;
+        return retval;
+    }
+
+    bool InputManager::keyReleased(const OIS::KeyEvent& evt)
+    {
+        bool retval = false;
+        if( WindowManager::getSingleton().getWindowInputMask() & AbstractWindow::WIT_KEYBOARD_INPUT )
+        {
+            if( CEGUI::System::getSingleton().injectKeyUp( evt.key ) )
+                retval = true;
+        }
+
+        if( !mControlStates.empty() )
+            if( mControlStates.top()->keyReleased(evt, retval) )
+                retval = true;
+        return false;
+    }
+
 }

Modified: rl/trunk/engine/ui/src/MovementControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/MovementControlState.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/src/MovementControlState.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -231,8 +231,6 @@
     //------------------------------------------------------------------------
     void MovementControlState::run(Real elapsedTime)
     {
-        if (isCeguiActive()) return;
-
         InputManager* im = InputManager::getSingletonPtr();
 
         updateCharacter(elapsedTime);
@@ -242,12 +240,15 @@
 
 
         // camera pitch
-        if (mInvertedMouse)
-            mPitch -= 0.5 * mMouseSensitivity * Degree(im->getMouseRelativeY() / 10);
-        else
-            mPitch += 0.5 * mMouseSensitivity * Degree(im->getMouseRelativeY() / 10);
-        if (mPitch < mPitchRange.first) mPitch = mPitchRange.first;
-        if (mPitch > mPitchRange.second) mPitch = mPitchRange.second;
+        if (!isMouseUsedByCegui() )
+        {
+            if (mInvertedMouse)
+                mPitch -= 0.5 * mMouseSensitivity * Degree(im->getMouseRelativeY() / 10);
+            else
+                mPitch += 0.5 * mMouseSensitivity * Degree(im->getMouseRelativeY() / 10);
+            if (mPitch < mPitchRange.first) mPitch = mPitchRange.first;
+            if (mPitch > mPitchRange.second) mPitch = mPitchRange.second;
+        }
 
 
 
@@ -319,11 +320,14 @@
                     }
 
                     // mouse
-                    if( !isCeguiActive() && mViewMode == VM_FIRST_PERSON || mViewMode == VM_THIRD_PERSON )
+                    if( !isMouseUsedByCegui() )
                     {
-                        if( !(movement & TURN_LEFT || movement & TURN_RIGHT) )
+                        if (mViewMode == VM_FIRST_PERSON || mViewMode == VM_THIRD_PERSON )
                         {
-                            rotation = -mMouseSensitivity/3.0f * Degree(im->getMouseRelativeX())/200.0 * baseVel;
+                            if( !(movement & TURN_LEFT || movement & TURN_RIGHT) )
+                            {
+                                rotation = -mMouseSensitivity/3.0f * Degree(im->getMouseRelativeX())/200.0 * baseVel;
+                            }
                         }
                     }
                 }
@@ -532,22 +536,25 @@
         InputManager* im = InputManager::getSingletonPtr();
 
         // camera position (distance)
-        mDesiredDistance -= im->getMouseRelativeZ() * 0.002;
-        if (mDesiredDistance < mDistanceRange.first)
+        if ( !isMouseUsedByCegui() )
         {
-            mDesiredDistance = mDistanceRange.first;
-        }
-        if (mDesiredDistance > mDistanceRange.second)
-        {
-            mDesiredDistance = mDistanceRange.second;
-        }
+            mDesiredDistance -= im->getMouseRelativeZ() * 0.002;
+            if (mDesiredDistance < mDistanceRange.first)
+            {
+                mDesiredDistance = mDistanceRange.first;
+            }
+            if (mDesiredDistance > mDistanceRange.second)
+            {
+                mDesiredDistance = mDistanceRange.second;
+            }
 
-        if( !isCeguiActive() && mViewMode == VM_FREE_CAMERA || mViewMode == VM_PNYX_MODE )
-        {
-            mCamYaw -= 2 * mMouseSensitivity / 4.0 * mRotationSpeed * Degree(im->getMouseRelativeX() / 15);
+            if( mViewMode == VM_FREE_CAMERA || mViewMode == VM_PNYX_MODE )
+            {
+                mCamYaw -= 2 * mMouseSensitivity / 4.0 * mRotationSpeed * Degree(im->getMouseRelativeX() / 15);
 
-            while (mCamYaw.valueDegrees() > 360.0f) mCamYaw -= Degree(360.0f);
-            while (mCamYaw.valueDegrees() < -360.0f) mCamYaw += Degree(360.0f);
+                while (mCamYaw.valueDegrees() > 360.0f) mCamYaw -= Degree(360.0f);
+                while (mCamYaw.valueDegrees() < -360.0f) mCamYaw += Degree(360.0f);
+            }
         }
 
         SceneNode* cameraNode = mCameraActor->_getSceneNode();
@@ -1089,7 +1096,8 @@
     //------------------------------------------------------------------------
     void MovementControlState::updateSelection()
     {
-        if (isCeguiActive()) return;
+        if ( isMouseUsedByCegui() )
+            return;
 
         InputManager* im = InputManager::getSingletonPtr();
 
@@ -1266,97 +1274,93 @@
     }
 
     //------------------------------------------------------------------------
-    bool MovementControlState::keyPressed(const OIS::KeyEvent& evt)
+    bool MovementControlState::keyPressed(const OIS::KeyEvent& evt, bool handled)
     {
-        if( ControlState::keyPressed(evt) )
-            return true;
-
-        int movement = mCommandMapper->getMovement(evt.key);
-
         bool retval = false;
-        if (movement & MOVE_RUN_LOCK) // dieses einrasten lassen
+        if( !handled )
         {
-            mCharacterState.mCurrentMovementState ^= MOVE_RUN_LOCK;
-            movement &= ~MOVE_RUN_LOCK;
-            retval = true;
-        }
+            int code = CommandMapper::encodeKey(evt.key, InputManager::getSingleton().getModifierCode());
+            // First see, if a control state action is defined
+	        CeGuiString command = mCommandMapper->getControlStateAction(code, mType);
+            if (command == "")
+            {
+                // No. So try global actions.
+                command = mCommandMapper->getGlobalAction(code);
+            }
+            else if (command == "freeflight_mode")
+            {
+                InputManager::getSingleton().pushControlState(CST_FREEFLIGHT);
+                retval = true;
+            }
+            else if (command == "reset_camera")
+            {
+                resetCamera();
+                retval = true;
+            }
+            else if (command == "toggle_view_mode")
+            {
+                toggleViewMode();
+                retval = true;
+            }
+            else if( startAction(command, mCharacter) )
+                retval = true;
 
-        if (movement != MOVE_NONE)
-        {
-            mCharacterState.mCurrentMovementState |= movement;
-            retval = true;
-        }
-        return retval;
-    }
 
-    //------------------------------------------------------------------------
-    bool MovementControlState::keyReleased(const OIS::KeyEvent& evt)
-    {
-        // this should be the same as in ControlState::keyReleased!
-        InputManager* im = InputManager::getSingletonPtr();
-        if ( WindowManager::getSingleton().getWindowInputMask()
-            & AbstractWindow::WIT_KEYBOARD_INPUT )
-        {
-            bool retval;
-            CEGUI::System& cegui = CEGUI::System::getSingleton();
-            retval = cegui.injectKeyUp(evt.key);
+
             if( !retval )
-                retval = cegui.injectChar(im->getKeyChar(evt.key, im->getModifierCode()));
-            
-            if( retval )
-                return true;
-        }
+            {
+                int movement = mCommandMapper->getMovement(evt.key);
 
+                if (movement & MOVE_RUN_LOCK) // dieses einrasten lassen
+                {
+                    mCharacterState.mCurrentMovementState ^= MOVE_RUN_LOCK;
+                    movement &= ~MOVE_RUN_LOCK;
+                    retval = true;
+                }
 
-        int code = CommandMapper::encodeKey(evt.key, im->getModifierCode());
-        // First see, if a control state action is defined
-	    CeGuiString command = mCommandMapper->getControlStateAction(code, mType);
-        if (command == "")
-        {
-            // No. So try global actions.
-            command = mCommandMapper->getGlobalAction(code);
+                if (movement != MOVE_NONE)
+                {
+                    mCharacterState.mCurrentMovementState |= movement;
+                    retval = true;
+                }
+            }
         }
-        if (command == "freeflight_mode")
-        {
-            InputManager::getSingleton().pushControlState(CST_FREEFLIGHT);
-            return true;
-        }
-        if (command == "reset_camera")
-        {
-            resetCamera();
-            return true;
-        }
-        if (command == "toggle_view_mode")
-        {
-            toggleViewMode();
-            return true;
-        }
-        if( startAction(command, mCharacter) )
-            return true;
 
 
+        retval = retval || ControlState::keyPressed(evt, handled || retval );
+        return retval;
+    }
+
+    //------------------------------------------------------------------------
+    bool MovementControlState::keyReleased(const OIS::KeyEvent& evt, bool handled)
+    {
+        bool retval = false;
         int movement = mCommandMapper->getMovement(evt.key);
         if (movement != MOVE_NONE)
         {
             mCharacterState.mCurrentMovementState &= (~movement | MOVE_RUN_LOCK);
-            return true;
+            retval = true;
         }
 
-        return false;
+        retval = retval || ControlState::keyReleased(evt, retval);
+        return retval;
     }
 
     //------------------------------------------------------------------------
     bool MovementControlState::mouseReleased(const OIS::MouseEvent& evt,
-        OIS::MouseButtonID id)
+        OIS::MouseButtonID id, bool handled)
     {
-        if( ControlState::mouseReleased(evt, id) )
-            return true;
+        handled = handled || ControlState::mouseReleased(evt, id, handled);
 
 
-        InputManager* im = InputManager::getSingletonPtr();
-        int mouseButtonMask = CommandMapper::encodeKey(id, im->getModifierCode());
-        return startAction(mCommandMapper->getControlStateAction(mouseButtonMask,
-            CST_MOVEMENT), mCharacter);
+        if( !handled )
+        {
+            InputManager* im = InputManager::getSingletonPtr();
+            int mouseButtonMask = CommandMapper::encodeKey(id, im->getModifierCode());
+            return startAction(mCommandMapper->getControlStateAction(mouseButtonMask,
+                CST_MOVEMENT), mCharacter);
+        }
+        return false;
     }
 
     //------------------------------------------------------------------------

Modified: rl/trunk/engine/ui/src/WindowFactory.cpp
===================================================================
--- rl/trunk/engine/ui/src/WindowFactory.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/src/WindowFactory.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -103,6 +103,7 @@
         mJournalWindow = new JournalWindow();
         mInfoPopup = new InfoPopup();
         mObjectDescriptionWindow = new ObjectDescriptionWindow();
+        mGameSettings = new GameSettings();
 
         RulesSubsystem::getSingleton().getQuestBook()->addQuestListener(mJournalWindow);
         RulesSubsystem::getSingleton().getQuestBook()->addQuestListener(mInfoPopup);
@@ -383,7 +384,6 @@
     void WindowFactory::showGameSettings()
     {
         // Create the game settings window and show it
-        mGameSettings = new GameSettings();
         mGameSettings->setVisible(true);
     }
 

Modified: rl/trunk/engine/ui/src/WindowManager.cpp
===================================================================
--- rl/trunk/engine/ui/src/WindowManager.cpp	2007-09-26 13:59:06 UTC (rev 3880)
+++ rl/trunk/engine/ui/src/WindowManager.cpp	2007-09-26 16:13:18 UTC (rev 3881)
@@ -119,4 +119,19 @@
         mask |= mNumActiveWindowsKeyboardInput > 0 ? AbstractWindow::WIT_KEYBOARD_INPUT : 0;
         return mask;
     }
+
+    AbstractWindow* WindowManager::getActiveWindow()
+    {
+        // iterate through windows
+        std::list<AbstractWindow*>::iterator it;
+        for( it = mWindowList.begin(); it != mWindowList.end(); it++ )
+        {
+            if( (*it)->getWindow()->isActive() )
+            {
+                return *it;
+            }
+        }
+
+        return NULL;
+    }
 }



From melven at mail.berlios.de  Wed Sep 26 21:00:16 2007
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Wed, 26 Sep 2007 21:00:16 +0200
Subject: [Dsa-hl-svn] r3882 - rl/trunk/engine/ui/src
Message-ID: <200709261900.l8QJ0GAa009051@sheep.berlios.de>

Author: melven
Date: 2007-09-26 21:00:05 +0200 (Wed, 26 Sep 2007)
New Revision: 3882

Modified:
   rl/trunk/engine/ui/src/FreeflightControlState.cpp
   rl/trunk/engine/ui/src/InputManager.cpp
   rl/trunk/engine/ui/src/MovementControlState.cpp
Log:
corrected some errors from last commit (i accidentally removed freeflight-movement-actions etc)

Modified: rl/trunk/engine/ui/src/FreeflightControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/FreeflightControlState.cpp	2007-09-26 16:13:18 UTC (rev 3881)
+++ rl/trunk/engine/ui/src/FreeflightControlState.cpp	2007-09-26 19:00:05 UTC (rev 3882)
@@ -89,16 +89,27 @@
         // so let the PM prepare it accordingly
         mCameraActor->getPhysicalThing()->setPhysicsController(this);
         mCameraActor->getPhysicalThing()->setUpConstraint(Vector3::ZERO);
-        // We also handle char<->level, char<->default collision from now on (camera=char!)
-        PhysicsManager::getSingleton().getMaterialPair(
-            PhysicsManager::getSingleton().getMaterialID("camera"),
-            PhysicsManager::getSingleton().getMaterialID("default"))->setContactCallback(this);
-        PhysicsManager::getSingleton().getMaterialPair(
-            PhysicsManager::getSingleton().getMaterialID("camera"),
-            PhysicsManager::getSingleton().getMaterialID("level"))->setContactCallback(this);
-        PhysicsManager::getSingleton().getMaterialPair(
-            PhysicsManager::getSingleton().getMaterialID("camera"),
-            PhysicsManager::getSingleton().getMaterialID("character"))->setContactCallback(this);
+        // We also handle camera<->level, camera<->default and camera<->char collision from now on!
+        // we need continous collision mode for fast people :-P
+        OgreNewt::MaterialPair *mat_pair;
+        mat_pair = PhysicsManager::getSingleton().createMaterialPair(
+                    PhysicsManager::getSingleton().getMaterialID("camera"),
+                    PhysicsManager::getSingleton().getMaterialID("default"));
+        mat_pair->setContactCallback(this);
+        mat_pair->setContinuousCollisionMode(1);
+        mat_pair->setDefaultCollidable(1);
+        mat_pair = PhysicsManager::getSingleton().createMaterialPair(
+                    PhysicsManager::getSingleton().getMaterialID("camera"),
+                    PhysicsManager::getSingleton().getMaterialID("level"));
+        mat_pair->setContactCallback(this);
+        mat_pair->setContinuousCollisionMode(1);
+        mat_pair->setDefaultCollidable(1);
+        mat_pair = PhysicsManager::getSingleton().createMaterialPair(
+                    PhysicsManager::getSingleton().getMaterialID("camera"),
+                    PhysicsManager::getSingleton().getMaterialID("character"));
+        mat_pair->setContactCallback(this);
+        mat_pair->setContinuousCollisionMode(1);
+        mat_pair->setDefaultCollidable(1);
     }
 
 	void FreeflightControlState::run(Real elapsedTime)
@@ -237,9 +248,29 @@
 			    mCurrentMovementState |= movement;
 			    retval = true;
 		    }
+
+            int code = CommandMapper::encodeKey(evt.key, InputManager::getSingleton().getModifierCode());
+            // First see, if a control state action is defined
+	        CeGuiString command = mCommandMapper->getControlStateAction(code, mType);
+            if (command == "")
+            {
+                // No. So try global actions.
+                command = mCommandMapper->getGlobalAction(code);
+            }
+            else if (command == "back_to_character_movement")
+            {
+                InputManager::getSingleton().popControlState();
+                retval = true;
+            }
+            else if (command == "toggle_camera_collision" )
+            {
+                mCollisionsEnabled = !mCollisionsEnabled;
+                retval = true;
+            }
         }
 
-        retval = retval || ControlState::keyPressed(evt, retval || handled);
+        if( ControlState::keyPressed(evt, retval || handled) )
+            retval = true;
         return retval;
 	}
 
@@ -253,7 +284,8 @@
 			retval = true;
 		}
 
-        retval = retval || ControlState::keyReleased(evt, handled || retval);
+        if( ControlState::keyReleased(evt, handled || retval) )
+            retval = true;
         return retval;
 	}
 

Modified: rl/trunk/engine/ui/src/InputManager.cpp
===================================================================
--- rl/trunk/engine/ui/src/InputManager.cpp	2007-09-26 16:13:18 UTC (rev 3881)
+++ rl/trunk/engine/ui/src/InputManager.cpp	2007-09-26 19:00:05 UTC (rev 3882)
@@ -474,7 +474,8 @@
         }
 
         if( !mControlStates.empty() )
-            retval = retval || mControlStates.top()->mousePressed(evt, id, retval);
+            if( mControlStates.top()->mousePressed(evt, id, retval) )
+                retval = true;
         return retval;
     }
 

Modified: rl/trunk/engine/ui/src/MovementControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/MovementControlState.cpp	2007-09-26 16:13:18 UTC (rev 3881)
+++ rl/trunk/engine/ui/src/MovementControlState.cpp	2007-09-26 19:00:05 UTC (rev 3882)
@@ -1327,7 +1327,8 @@
         }
 
 
-        retval = retval || ControlState::keyPressed(evt, handled || retval );
+        if( ControlState::keyPressed(evt, handled || retval ) )
+            retval = true;
         return retval;
     }
 
@@ -1342,7 +1343,8 @@
             retval = true;
         }
 
-        retval = retval || ControlState::keyReleased(evt, retval);
+        if( ControlState::keyReleased(evt, retval) )
+            retval = true;
         return retval;
     }
 



From chrber at mail.berlios.de  Thu Sep 27 23:26:32 2007
From: chrber at mail.berlios.de (chrber at mail.berlios.de)
Date: Thu, 27 Sep 2007 23:26:32 +0200
Subject: [Dsa-hl-svn] r3883 - rl/trunk/engine/common/include
Message-ID: <200709272126.l8RLQWcc000178@sheep.berlios.de>

Author: chrber
Date: 2007-09-27 23:26:30 +0200 (Thu, 27 Sep 2007)
New Revision: 3883

Modified:
   rl/trunk/engine/common/include/RastullahPrerequisites.h
Log:
Applied patch provided by hogan to fix compile problems with gcc (thanks)


Modified: rl/trunk/engine/common/include/RastullahPrerequisites.h
===================================================================
--- rl/trunk/engine/common/include/RastullahPrerequisites.h	2007-09-26 19:00:05 UTC (rev 3882)
+++ rl/trunk/engine/common/include/RastullahPrerequisites.h	2007-09-27 21:26:30 UTC (rev 3883)
@@ -25,6 +25,8 @@
 #include <OgreString.h>
 #include <OgreStringConverter.h>
 #include <OgreVector3.h>
+#include <OgreAxisAlignedBox.h>
+#include <OgreScriptLoader.h>
 
 #if OGRE_PLATFORM != OGRE_PLATFORM_WIN32
 #   define _snprintf snprintf



From timm at mail.berlios.de  Sun Sep 30 12:50:30 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 30 Sep 2007 12:50:30 +0200
Subject: [Dsa-hl-svn] r3884 - in rl/trunk/engine: ai/src common/include
	common/src core core/include core/src rules rules/include
	rules/src ui/src
Message-ID: <200709301050.l8UAoUVc012502@sheep.berlios.de>

Author: timm
Date: 2007-09-30 12:49:35 +0200 (Sun, 30 Sep 2007)
New Revision: 3884

Added:
   rl/trunk/engine/core/include/SaveGameFile.h
   rl/trunk/engine/core/include/SaveGameFileReader.h
   rl/trunk/engine/core/include/SaveGameFileWriter.h
   rl/trunk/engine/core/include/SaveGameManager.h
   rl/trunk/engine/core/src/SaveGameFile.cpp
   rl/trunk/engine/core/src/SaveGameFileReader.cpp
   rl/trunk/engine/core/src/SaveGameFileWriter.cpp
   rl/trunk/engine/core/src/SaveGameManager.cpp
Removed:
   rl/trunk/engine/rules/include/SaveGameFile.h
   rl/trunk/engine/rules/include/SaveGameFileWriter.h
   rl/trunk/engine/rules/include/SaveGameManager.h
   rl/trunk/engine/rules/src/SaveGameFile.cpp
   rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
   rl/trunk/engine/rules/src/SaveGameManager.cpp
Modified:
   rl/trunk/engine/ai/src/AgentManager.cpp
   rl/trunk/engine/common/include/XmlPropertyWriter.h
   rl/trunk/engine/common/src/XmlPropertyWriter.cpp
   rl/trunk/engine/core/RlCore2005.vcproj
   rl/trunk/engine/core/include/CoreSubsystem.h
   rl/trunk/engine/core/src/CoreSubsystem.cpp
   rl/trunk/engine/rules/RlRules2005.vcproj
   rl/trunk/engine/rules/include/GameObjectManager.h
   rl/trunk/engine/rules/include/QuestBook.h
   rl/trunk/engine/rules/include/RulesSubsystem.h
   rl/trunk/engine/rules/src/GameObjectManager.cpp
   rl/trunk/engine/rules/src/QuestBook.cpp
   rl/trunk/engine/rules/src/RulesSubsystem.cpp
   rl/trunk/engine/ui/src/SaveLoadWindow.cpp
Log:
- moved game saving from rules to core
- saving/loading data from the save game file is the task of the managers (GameObjectManager, QuestBook etc.) now
- beginning of the save game file loader

Modified: rl/trunk/engine/ai/src/AgentManager.cpp
===================================================================
--- rl/trunk/engine/ai/src/AgentManager.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/ai/src/AgentManager.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -103,7 +103,7 @@
 
 const Ogre::String& AgentManager::getName() const
 {
-    static String NAME = "AgentManager";
+    static Ogre::String NAME = "AgentManager";
 
     return NAME;
 }

Modified: rl/trunk/engine/common/include/XmlPropertyWriter.h
===================================================================
--- rl/trunk/engine/common/include/XmlPropertyWriter.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/common/include/XmlPropertyWriter.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -35,12 +35,14 @@
     typedef std::pair<Ogre::String, Property> PropertyEntry;
 
     class _RlCommonExport XmlPropertyWriter
-        : protected XmlProcessor
+        : public XmlProcessor
     {
     public:
         XmlPropertyWriter();
         virtual ~XmlPropertyWriter();
 
+        XERCES_CPP_NAMESPACE::DOMDocument* getDocument();
+
         std::vector<PropertySet*> getPropertySets();
         void setPropertySets(std::vector<PropertySet*> sets);
         void addPropertySet(PropertySet* set);
@@ -49,6 +51,8 @@
         XERCES_CPP_NAMESPACE::DOMElement* processPropertySet(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertySet set);
         XERCES_CPP_NAMESPACE::DOMElement* processPropertyArray(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyVector vector);
         XERCES_CPP_NAMESPACE::DOMElement* processPropertyMap(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyMap map);
+
+        void writeEachProperty(XERCES_CPP_NAMESPACE::DOMElement* parent, const PropertyMap &map);
     protected:
         std::vector<PropertySet*> mPropertySets;
 

Modified: rl/trunk/engine/common/src/XmlPropertyWriter.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlPropertyWriter.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/common/src/XmlPropertyWriter.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -38,6 +38,11 @@
     {
     }
 
+    DOMDocument* XmlPropertyWriter::getDocument()
+    {
+        return mDocument;
+    }
+
     void XmlPropertyWriter::setPropertySets(std::vector<PropertySet*> sets)
     {
         mPropertySets = sets;
@@ -127,4 +132,13 @@
         }
         return element;
     }
+
+    void XmlPropertyWriter::writeEachProperty(DOMElement* parent, const rl::PropertyMap &map)
+    {
+        PropertyMap::const_iterator it_properties;
+        for(it_properties = map.begin(); it_properties != map.end(); it_properties++)
+        {
+            this->processProperty(parent, PropertyEntry(it_properties->first.c_str(), it_properties->second));
+        }
+    }
 }

Modified: rl/trunk/engine/core/RlCore2005.vcproj
===================================================================
--- rl/trunk/engine/core/RlCore2005.vcproj	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/RlCore2005.vcproj	2007-09-30 10:49:35 UTC (rev 3884)
@@ -564,6 +564,22 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\SaveGameFile.h"
+				>
+			</File>
+			<File
+				RelativePath=".\include\SaveGameFileReader.h"
+				>
+			</File>
+			<File
+				RelativePath=".\include\SaveGameFileWriter.h"
+				>
+			</File>
+			<File
+				RelativePath=".\include\SaveGameManager.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\SceneQuery.h"
 				>
 			</File>
@@ -829,6 +845,22 @@
 				>
 			</File>
 			<File
+				RelativePath=".\src\SaveGameFile.cpp"
+				>
+			</File>
+			<File
+				RelativePath=".\src\SaveGameFileReader.cpp"
+				>
+			</File>
+			<File
+				RelativePath=".\src\SaveGameFileWriter.cpp"
+				>
+			</File>
+			<File
+				RelativePath=".\src\SaveGameManager.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\SceneQuery.cpp"
 				>
 			</File>

Modified: rl/trunk/engine/core/include/CoreSubsystem.h
===================================================================
--- rl/trunk/engine/core/include/CoreSubsystem.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/include/CoreSubsystem.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -46,6 +46,7 @@
 class XmlResourceManager;
 class SoundManager;
 class DebugVisualsManager;
+class SaveGameManager;
 class JobScheduler;
 class ZoneManager;
 class TimeSourceManager;
@@ -138,6 +139,7 @@
     GameEventManager* mGameEventManager;
     SoundManager* mSoundManager;
     DebugVisualsManager* mDebugVisualsManager;
+    SaveGameManager* mSaveGameManager;
     JobScheduler* mJobScheduler;
 	ZoneManager* mZoneManager;
     TimeSourceManager* mTimeSourceManager;

Added: rl/trunk/engine/core/include/SaveGameFile.h
===================================================================
--- rl/trunk/engine/core/include/SaveGameFile.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/include/SaveGameFile.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -0,0 +1,58 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#ifndef __SaveGameFile_H__
+#define __SaveGameFile_H__
+
+#include "CorePrerequisites.h"
+#include <OgreDataStream.h>
+
+#include <Property.h>
+#include <Properties.h>
+
+#include <xercesc/framework/XMLFormatter.hpp>
+
+#include <ctime>
+
+namespace rl
+{
+    class _RlCoreExport SaveGameFile : public PropertyHolder
+    {
+    public:
+        SaveGameFile(const CeGuiString &name);
+        ~SaveGameFile();
+        CeGuiString buildFilename();
+        CeGuiString getName();
+        bool saveGameExists();
+
+        void setDataStream(const Ogre::DataStreamPtr &stream);
+        Ogre::DataStreamPtr getDataStream() const;
+        XERCES_CPP_NAMESPACE::XMLFormatTarget* getFormatTarget();
+        void deleteFileFromStorage();
+
+        virtual const Property getProperty(const Ogre::String& key) const;
+        virtual void setProperty(const Ogre::String& key, const Property& value);
+        virtual PropertySet* getAllProperties() const;
+    protected:
+        CeGuiString mName;
+        CeGuiString mModuleID;
+        CeGuiString mLocalTime;
+
+        Ogre::DataStreamPtr mStream;
+    };
+}
+
+#endif

Added: rl/trunk/engine/core/include/SaveGameFileReader.h
===================================================================
--- rl/trunk/engine/core/include/SaveGameFileReader.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/include/SaveGameFileReader.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -0,0 +1,36 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+
+#ifndef _SaveGameFileReader_H_
+#define _SaveGameFileReader_H_
+
+#include "SaveGameFile.h"
+#include <XmlPropertyReader.h>
+
+namespace rl
+{
+    class SaveGameData;
+    typedef std::set<SaveGameData*> SaveGameDataSet;
+
+    class _RlCoreExport SaveGameFileReader : public XmlPropertyReader
+    {
+    public:
+        SaveGameFileReader();
+        void parseSaveGameFile(SaveGameFile* file, const SaveGameDataSet &set);
+    };
+}
+
+#endif //#ifndef _SaveGameFileReader_H_
\ No newline at end of file

Added: rl/trunk/engine/core/include/SaveGameFileWriter.h
===================================================================
--- rl/trunk/engine/core/include/SaveGameFileWriter.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/include/SaveGameFileWriter.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -0,0 +1,40 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#ifndef _SaveGameFileWriter_H_
+#define _SaveGameFileWriter_H_
+
+#include "CorePrerequisites.h"
+
+#include <XmlPropertyWriter.h>
+
+#include "SaveGameFile.h"
+
+namespace rl
+{
+    class SaveGameData;
+    typedef std::set<SaveGameData*> SaveGameDataSet;
+
+    class _RlCoreExport SaveGameFileWriter 
+        : public XmlPropertyWriter
+    {
+    public:
+        void buildSaveGameFile(SaveGameFile *file, const SaveGameDataSet &set);
+    };
+}
+
+#endif
+

Added: rl/trunk/engine/core/include/SaveGameManager.h
===================================================================
--- rl/trunk/engine/core/include/SaveGameManager.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/include/SaveGameManager.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -0,0 +1,78 @@
+/* 
+ * (C) 2003-2007. Team Pantheon. www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here:
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm
+ */
+#ifndef _SaveGameManager_H_
+#define _SaveGameManager_H_
+
+#include "CorePrerequisites.h"
+#include "SaveGameFileWriter.h"
+#include "SaveGameFileReader.h"
+#include "SaveGameFile.h"
+
+#include <XmlPropertyWriter.h>
+#include <XmlPropertyReader.h>
+
+namespace rl
+{
+    class _RlCoreExport SaveGameData
+    {
+    public:
+        SaveGameData();
+        virtual ~SaveGameData();
+        virtual CeGuiString getXmlNodeIdentifier() const = 0;
+        virtual void writeData(SaveGameFileWriter* writer) = 0;
+        virtual void readData(SaveGameFileReader* reader) = 0; //no reader yet
+    };
+
+    typedef std::set<SaveGameData*> SaveGameDataSet;
+
+    typedef std::map<CeGuiString, SaveGameFile*> SaveGameEntryMap;
+
+    class SaveGameHeaderReader : public XmlPropertyReader
+    {
+    public:
+        SaveGameHeaderReader();
+        void parseHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file);
+    };
+
+    class _RlCoreExport SaveGameManager : public Ogre::Singleton<SaveGameManager>, public Ogre::ScriptLoader
+    {
+    public:
+        SaveGameManager(void);
+        virtual ~SaveGameManager(void);    
+
+        SaveGameEntryMap listSaveGames(void);
+        void saveSaveGameFile(const CeGuiString &name);
+        void loadSaveGameFile(const CeGuiString &name);
+        void deleteSaveGameFile(const CeGuiString &name);
+        bool SaveGameFileExists(const CeGuiString &name);
+
+        virtual const Ogre::StringVector&  getScriptPatterns(void) const;
+        virtual void parseScript(Ogre::DataStreamPtr &stream, const Ogre::String &groupName);
+        virtual Ogre::Real getLoadingOrder(void) const;
+
+        void registerSaveGameData(SaveGameData* data);
+        void unregisterSaveGameData(SaveGameData* data);
+    protected:
+        void freeSaveGameMap();
+
+        Ogre::StringVector mScriptPatterns;
+        SaveGameEntryMap mSaveGames;
+
+        SaveGameDataSet mSaveGameDataSet;
+    };
+}
+
+#endif

Modified: rl/trunk/engine/core/src/CoreSubsystem.cpp
===================================================================
--- rl/trunk/engine/core/src/CoreSubsystem.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/src/CoreSubsystem.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -40,6 +40,7 @@
 #include "MessagePump.h"
 #include "PhysicsManager.h"
 #include "RubyInterpreter.h"
+#include "SaveGameManager.h"
 #include "ScriptWrapper.h"
 #include "SoundManager.h"
 #include "TimeSource.h"
@@ -91,6 +92,7 @@
         delete mGameLoop;
         delete mMessagePump;
         delete mJobScheduler;
+        delete mSaveGameManager;
         delete mAnimationManager;
         delete mActorManager;
         delete mPhysicsManager;
@@ -290,6 +292,9 @@
         GameLoop::getSingleton().addTask(mDebugVisualsManager, GameLoop::TG_GRAPHICS);
         LOG_MESSAGE(Logger::CORE,"DebugVisualsManager erzeugt");
 
+        mSaveGameManager = new SaveGameManager();
+        LOG_MESSAGE(Logger::RULES, "SaveGameManager erzeugt");
+
         mJobScheduler = new JobScheduler();
         GameLoop::getSingleton().addTask(mJobScheduler, GameLoop::TG_GRAPHICS);
         LOG_MESSAGE(Logger::CORE,"JobScheduler erzeugt");

Added: rl/trunk/engine/core/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveGameFile.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/src/SaveGameFile.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -0,0 +1,113 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h" //precompiled header
+
+#include "SaveGameFile.h"
+#include "OgreString.h"
+#include <xercesc/framework/LocalFileFormatTarget.hpp>
+
+#include <ConfigurationManager.h>
+#include <CoreSubsystem.h>
+#include <ContentModule.h>
+
+namespace rl
+{
+
+    SaveGameFile::SaveGameFile(const CeGuiString &name) : mStream((Ogre::DataStream*)NULL)
+    {
+        mName = name;
+    }
+
+    SaveGameFile::~SaveGameFile()
+    {
+        if(mStream.isNull())
+            delete mStream.get();
+    }
+
+    CeGuiString SaveGameFile::buildFilename()
+    {
+        return ConfigurationManager::getSingleton().getModulesRootDirectory() + /*"/" 
+            + CoreSubsystem::getSingleton().getActiveAdventureModule()->getId()*/ + "/saves/" + mName + ".save";
+    }
+
+    CeGuiString SaveGameFile::getName()
+    {
+        return mName;
+    }
+
+    void SaveGameFile::setDataStream(const Ogre::DataStreamPtr &stream)
+    {
+        mStream = stream;
+    }
+
+    Ogre::DataStreamPtr SaveGameFile::getDataStream() const
+    {
+        ///@todo: decryption
+        return mStream;
+    }
+
+    XERCES_CPP_NAMESPACE::XMLFormatTarget* SaveGameFile::getFormatTarget()
+    {
+        ///@todo: encryption
+        return new XERCES_CPP_NAMESPACE::LocalFileFormatTarget(this->buildFilename().c_str());
+    }
+
+    void SaveGameFile::deleteFileFromStorage()
+    {
+        if(remove(buildFilename().c_str()))
+            LOG_ERROR(Logger::RULES, "SaveGameFile is not removed from filesystem. The file doesn't exists!");
+        else 
+            LOG_MESSAGE(Logger::RULES,"SaveGameFile successfully removed from filesystem");
+    }
+
+    bool SaveGameFile::saveGameExists()
+    {
+        return !Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r"))).isNull();
+    }
+
+    const Property SaveGameFile::getProperty(const Ogre::String& key) const
+    {
+        if(key == "ModuleID")
+            return Property(mModuleID);
+        else if(key == "Time")
+            return Property(mLocalTime);
+        else
+            return Property();
+    }
+
+    void SaveGameFile::setProperty(const Ogre::String& key, const Property& value)
+    {
+        if(key == "ModuleID")
+        {
+            if(value.isString())
+                mModuleID = value.toString();
+        }
+        else if(key == "Time")
+        {
+            if(value.isString())
+                mLocalTime = value.toString();
+        }
+    }
+
+    PropertySet* SaveGameFile::getAllProperties() const
+    {
+        PropertySet* set = new PropertySet();
+        set->setProperty("ModuleID", getProperty("ModuleID"));
+        set->setProperty("Time", getProperty("Time"));
+        return set;
+    }
+}

Added: rl/trunk/engine/core/src/SaveGameFileReader.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveGameFileReader.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/src/SaveGameFileReader.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -0,0 +1,43 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+
+#include "stdinc.h"
+
+#include <xercesc/dom/DOM.hpp>
+
+#include "SaveGameFileReader.h"
+
+#include "SaveGameManager.h"
+
+using namespace XERCES_CPP_NAMESPACE;
+
+namespace rl
+{
+    SaveGameFileReader::SaveGameFileReader()
+    {
+    }
+
+    void SaveGameFileReader::parseSaveGameFile(SaveGameFile* file, const SaveGameDataSet &set)
+    {
+        initializeXml();
+
+        DOMDocument* doc = loadDocument(file->getDataStream());
+
+        doc->release();
+
+        shutdownXml();
+    }
+}
\ No newline at end of file

Added: rl/trunk/engine/core/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveGameFileWriter.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/src/SaveGameFileWriter.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -0,0 +1,146 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h"
+
+#include "SaveGameFileWriter.h"
+
+#include "SaveGameManager.h"
+
+#include <XmlProcessor.h>
+#include <xercesc/dom/DOM.hpp>
+#include <xercesc/dom/DOMAttr.hpp>
+#include <xercesc/dom/DOMElement.hpp>
+#include <Properties.h>
+
+#include <OgreResourceManager.h>
+#include <CEGUIPropertyHelper.h>
+#include <CoreSubsystem.h>
+#include <ContentModule.h>
+#include <TimeSource.h>
+
+#include <ctime>
+
+using namespace XERCES_CPP_NAMESPACE;
+using namespace Ogre;
+
+namespace rl
+{
+    void SaveGameFileWriter::buildSaveGameFile(SaveGameFile *file, const SaveGameDataSet &set)
+    {
+        //@toto: build
+        initializeXml();
+
+        XMLCh tempStr[100];
+        XMLString::transcode("LS", tempStr, 99);
+        mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
+        mWriter = static_cast<DOMImplementationLS*>(mImplementation)->createDOMWriter();
+        mTarget = file->getFormatTarget();
+        mDocument = static_cast<DOMImplementation*>(mImplementation)->createDocument(0, XMLString::transcode("SaveGameFile"), 0);
+
+        if (mWriter->canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
+            mWriter->setFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true);
+
+        if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
+             mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
+
+        mDocument->setNodeValue(XMLString::transcode("SaveGameFile")); //Set name of document root node
+
+        //Write SaveGameVersion
+        setAttributeValueAsString(mDocument->getDocumentElement(), "Version", "0.1");
+
+        //Write modul of save game
+        DOMElement* header = appendChildElement(mDocument, mDocument->getDocumentElement(), "header");
+        
+        PropertySet* headerSet = file->getAllProperties();
+        for(PropertySetMap::const_iterator it_header = headerSet->begin(); it_header != headerSet->end(); it_header++)
+        {
+            this->processProperty(header, PropertyEntry(it_header->first.c_str(), it_header->second));
+        }
+
+        /*setAttributeValueAsString(header, "ModuleID", CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
+        setAttributeValueAsInteger(header, "EngineVersion", CoreSubsystem::getSingleton().getEngineBuildNumber());
+        setAttributeValueAsString(header, "LocalTime", file->getProperty("Time").toString());*/
+
+        //Write date and time
+        //DOMElement* timeNode = appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
+        
+        /*tm* timeinfo = file->getLocalTime();
+
+        setAttributeValueAsInteger(timeNode, "day", timeinfo->tm_mday);
+        setAttributeValueAsInteger(timeNode, "month", timeinfo->tm_mon);
+        setAttributeValueAsInteger(timeNode, "year", timeinfo->tm_year+1900);
+
+        setAttributeValueAsInteger(timeNode, "hour", timeinfo->tm_hour);
+        setAttributeValueAsInteger(timeNode, "minute", timeinfo->tm_min);
+        setAttributeValueAsInteger(timeNode, "second", timeinfo->tm_sec);*/
+
+        //Write globals
+        DOMElement* globals = appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
+        DOMElement* gameTime = appendChildElement(mDocument, globals, "gametime");
+        TimeSource* gameTimeSource = TimeSourceManager::getSingleton().getTimeSource(TimeSource::GAMETIME);
+        setAttributeValueAsInteger(gameTime, "milliseconds", gameTimeSource->getClock());
+
+        ////Write Quests
+        //DOMElement* quests = appendChildElement(mDocument, mDocument->getDocumentElement(), "quests");
+        //QuestBook* questBook = RulesSubsystem::getSingleton().getQuestBook();
+        //PropertySet* set = questBook->getAllProperties();
+        //for(PropertySetMap::const_iterator it_quests = set->begin(); it_quests != set->end(); it_quests++)
+        //{
+        //    this->processProperty(quests, PropertyEntry(it_quests->first.c_str(), it_quests->second));
+        //}
+
+        ////Write game objects
+        //DOMElement* gameobjects = appendChildElement(mDocument, mDocument->getDocumentElement(), "gameobjects");
+        //
+
+        //std::list<const GameObject*> gos = GameObjectManager::getSingleton().getAllGameObjects();
+
+        //for(std::list<const GameObject*>::const_iterator it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
+        //{
+        //    DOMElement* gameobject = appendChildElement(mDocument, gameobjects, "gameobject");
+        //    setAttributeValueAsInteger(gameobject, "ID", (*it_gameobjects)->getId());
+        //    setAttributeValueAsString(gameobject, "ClassID", (*it_gameobjects)->getClassId());
+
+        //    PropertyMap map = (*it_gameobjects)->getAllProperties()->toPropertyMap();
+        //    PropertyMap::iterator it_properties;
+        //    for(it_properties = map.begin(); it_properties != map.end(); it_properties++)
+        //    {
+        //        this->processProperty(gameobject, PropertyEntry(it_properties->first.c_str(), it_properties->second));
+        //    }
+        //}        
+
+        ////Write Zones?
+
+        ////Write scripts
+        //DOMElement* scripts = appendChildElement(mDocument, mDocument->getDocumentElement(), "scripts");
+
+        for(SaveGameDataSet::const_iterator data_iter = set.begin(); data_iter != set.end(); data_iter++)
+        {
+            (*data_iter)->writeData(this);
+        }
+
+        mWriter->writeNode(mTarget, *mDocument);
+
+
+        mWriter->release();
+
+        delete mDocument;
+        delete mTarget;
+
+        shutdownXml();
+    }
+}

Added: rl/trunk/engine/core/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveGameManager.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/core/src/SaveGameManager.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -0,0 +1,207 @@
+/* 
+ * (C) 2003-2007. Team Pantheon. www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here:
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm
+ */
+
+#include "stdinc.h"
+
+#include "SaveGameManager.h"
+
+#include <CoreSubsystem.h>
+#include <ContentModule.h>
+#include <ConfigurationManager.h>
+
+#include <XmlProcessor.h>
+
+#include <xercesc/dom/DOM.hpp>
+#include <xercesc/framework/LocalFileFormatTarget.hpp>
+
+template<> rl::SaveGameManager* Ogre::Singleton<rl::SaveGameManager>::ms_Singleton = 0;
+
+using namespace XERCES_CPP_NAMESPACE;
+
+namespace rl
+{
+    SaveGameData::SaveGameData()
+    {
+        SaveGameManager::getSingleton().registerSaveGameData(this);
+    }
+
+    SaveGameData::~SaveGameData()
+    {
+        SaveGameManager::getSingleton().unregisterSaveGameData(this);
+    }
+
+    CeGuiString printTimeAsString(tm* time)
+    {
+        CeGuiString string = ((Ogre::String)(Ogre::StringConverter::toString(time->tm_mday) + "." 
+            + Ogre::StringConverter::toString(time->tm_mon) + "."
+            + Ogre::StringConverter::toString(time->tm_year + 1900) + " - " 
+            + Ogre::StringConverter::toString(time->tm_hour) + ":"
+            + Ogre::StringConverter::toString(time->tm_min) + ":" 
+            + Ogre::StringConverter::toString(time->tm_sec))).c_str();
+        return string;
+    }
+
+    SaveGameHeaderReader::SaveGameHeaderReader()
+    {
+    }
+
+    void SaveGameHeaderReader::parseHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file)
+    {
+        initializeXml();
+
+        if(stream->size())
+        {
+            DOMDocument* doc = loadDocument(stream);
+
+             DOMNodeList* headerDefsXml = doc->getDocumentElement()->getElementsByTagName(AutoXMLCh("header").data());
+             if(headerDefsXml->getLength())
+             {
+                 DOMElement* elem = static_cast<DOMElement*>(headerDefsXml->item(0));
+                 DOMNodeList* headerDefChildren = elem->getChildNodes();
+                 for(XMLSize_t childIdx = 0; childIdx < headerDefChildren->getLength(); childIdx++)
+                 {
+                     DOMNode* curChild = headerDefChildren->item(childIdx);
+                     if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
+                     {
+                         PropertyEntry entry = processProperty(static_cast<DOMElement*>(curChild));
+                         if(entry.first != "")
+                         {
+                            file->setProperty(entry.first, entry.second);
+                         }
+                     }
+                 }
+             }
+        }
+
+        shutdownXml();
+    }
+
+    SaveGameManager::SaveGameManager()
+    { 
+        Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
+
+        mScriptPatterns.push_back("*.save");
+        Ogre::ResourceGroupManager::getSingleton()._registerScriptLoader(this);
+
+        Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() 
+            + "/saves", "FileSystem", "SaveGames");
+        Ogre::ResourceGroupManager::getSingleton().initialiseResourceGroup("SaveGames");
+        Ogre::ResourceGroupManager::getSingleton().clearResourceGroup("SaveGames"); //close all resource files -> make them writable
+    }
+
+    SaveGameManager::~SaveGameManager()
+    {
+        freeSaveGameMap();
+    }
+
+    SaveGameEntryMap SaveGameManager::listSaveGames()
+    {
+        return mSaveGames;
+    }
+
+    void SaveGameManager::saveSaveGameFile(const CeGuiString &name)
+    {
+        time_t rawTime;
+        tm* localTime; 
+        time(&rawTime);
+        localTime = localtime(&rawTime); 
+        SaveGameFile* file = new SaveGameFile(name);
+        file->setProperty("Time", Property(printTimeAsString(localTime)));
+        file->setProperty("ModuleID", Property(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName()));
+
+        mSaveGames[name] = file;
+
+        SaveGameFileWriter writer;
+        writer.buildSaveGameFile(file, mSaveGameDataSet);
+
+        freeSaveGameMap();
+
+        Ogre::ResourceGroupManager::getSingleton().initialiseResourceGroup("SaveGames");
+        Ogre::ResourceGroupManager::getSingleton().clearResourceGroup("SaveGames"); //close all resource files -> make them writable
+    }
+
+    void SaveGameManager::loadSaveGameFile(const CeGuiString &name)
+    {
+        if(SaveGameFileExists(name))
+        {
+            SaveGameFile file(name);
+            ///@todo: SaveGameReader
+        }
+    }
+
+    void SaveGameManager::deleteSaveGameFile(const CeGuiString &name)
+    {
+        if(SaveGameFileExists(name))
+        {
+            static_cast<SaveGameFile*>(mSaveGames[name])->deleteFileFromStorage();
+            delete mSaveGames[name];
+            mSaveGames.erase(name);
+        }
+    }
+
+    bool SaveGameManager::SaveGameFileExists(const CeGuiString &name)
+    {
+        if(mSaveGames.find(name) != mSaveGames.end())
+            return true;
+        return false;
+    }
+    
+    const Ogre::StringVector& SaveGameManager::getScriptPatterns() const
+    {
+        return mScriptPatterns;
+    }
+
+    Ogre::Real SaveGameManager::getLoadingOrder() const
+    {
+        return 2000.0f;
+    }
+
+    void SaveGameManager::parseScript(Ogre::DataStreamPtr &stream, const Ogre::String &groupName)
+    {
+        Ogre::String name = stream->getName();
+        name = name.substr(0, name.length()-5); //delete ".save" at the and of the name
+
+        SaveGameFile* file = new SaveGameFile(name);
+        
+        LOG_MESSAGE(Logger::RULES, "Parsing header of save game: " + name);
+        SaveGameHeaderReader reader;
+        reader.parseHeader(stream, groupName, file);
+
+        Ogre::DataStream* _stream = new Ogre::MemoryDataStream(*stream, false); //making a copy of the data stream. searching for a better alternative
+        file->setDataStream(Ogre::DataStreamPtr(_stream));
+        
+        mSaveGames[name] = file;
+    }
+
+    void SaveGameManager::registerSaveGameData(SaveGameData* data)
+    {
+        mSaveGameDataSet.insert(data);
+    }
+
+    void SaveGameManager::unregisterSaveGameData(SaveGameData* data)
+    {
+        mSaveGameDataSet.erase(data);
+    }
+
+    void SaveGameManager::freeSaveGameMap()
+    {
+        for(SaveGameEntryMap::const_iterator iter = mSaveGames.begin(); iter != mSaveGames.end(); iter++)
+        {
+            delete iter->second;
+        }
+        mSaveGames.clear();
+    }
+}

Modified: rl/trunk/engine/rules/RlRules2005.vcproj
===================================================================
--- rl/trunk/engine/rules/RlRules2005.vcproj	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/RlRules2005.vcproj	2007-09-30 10:49:35 UTC (rev 3884)
@@ -403,18 +403,6 @@
 				>
 			</File>
 			<File
-				RelativePath=".\src\SaveGameFile.cpp"
-				>
-			</File>
-			<File
-				RelativePath=".\src\SaveGameFileWriter.cpp"
-				>
-			</File>
-			<File
-				RelativePath=".\src\SaveGameManager.cpp"
-				>
-			</File>
-			<File
 				RelativePath=".\src\SelectionHelper.cpp"
 				>
 			</File>
@@ -641,18 +629,6 @@
 				>
 			</File>
 			<File
-				RelativePath=".\include\SaveGameFile.h"
-				>
-			</File>
-			<File
-				RelativePath=".\include\SaveGameFileWriter.h"
-				>
-			</File>
-			<File
-				RelativePath=".\include\SaveGameManager.h"
-				>
-			</File>
-			<File
 				RelativePath=".\include\SelectionHelper.h"
 				>
 			</File>

Modified: rl/trunk/engine/rules/include/GameObjectManager.h
===================================================================
--- rl/trunk/engine/rules/include/GameObjectManager.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/include/GameObjectManager.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -20,6 +20,8 @@
 #include "RulesPrerequisites.h"
 #include "GameObjectStateListener.h"
 
+#include <SaveGameManager.h>
+
 #include <OgreScriptLoader.h>
 #include <OgreSingleton.h>
 #include <map>
@@ -42,7 +44,8 @@
     class _RlRulesExport GameObjectManager : 
         public Ogre::Singleton<GameObjectManager>,
         public GameObjectStateListener,
-        public Ogre::ScriptLoader
+        public Ogre::ScriptLoader,
+        public SaveGameData
     {
     public:
         GameObjectManager();
@@ -68,6 +71,13 @@
         void registerGameObjectStateListener(GameObjectStateListener* listener);
         void unregisterGameObjectStateListener(GameObjectStateListener* listener);
 
+        /// Override from SaveGameData
+        /// Manages saving and loading from the SaveGameFile
+
+        virtual CeGuiString getXmlNodeIdentifier() const;
+        virtual void writeData(SaveGameFileWriter* writer);
+        virtual void readData(SaveGameFileReader* reader);
+
     private:
         typedef std::map<const Ogre::String, PropertySet*> ClassPropertyMap;
         typedef std::set<GameObjectStateListener*> GameObjectStateListenerSet;

Modified: rl/trunk/engine/rules/include/QuestBook.h
===================================================================
--- rl/trunk/engine/rules/include/QuestBook.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/include/QuestBook.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -28,12 +28,17 @@
 #include "QuestEvent.h"
 #include "QuestListener.h"
 
+#include <SaveGameManager.h>
+
 #include <vector>
 
 namespace rl {
 
 ///@todo Rename this class to reflect scope changes.
-class _RlRulesExport QuestBook : public EventSource, public PropertyHolder
+class _RlRulesExport QuestBook : 
+    public EventSource, 
+    public PropertyHolder, 
+    public SaveGameData
 {
 public:
     static const Ogre::String PROPERTY_QUESTS;
@@ -75,6 +80,13 @@
     virtual void setProperty(const Ogre::String& key, const Property& value);
     virtual PropertySet* getAllProperties() const;
 
+    /// Override from SaveGameData
+    /// Manages saving and loading from the SaveGameFile
+
+    virtual CeGuiString getXmlNodeIdentifier() const;
+    virtual void writeData(SaveGameFileWriter* writer);
+    virtual void readData(SaveGameFileReader* reader);
+
 private:
 	Quest* getQuest(Quest* parent, const CeGuiString id) const;
     void clear();

Modified: rl/trunk/engine/rules/include/RulesSubsystem.h
===================================================================
--- rl/trunk/engine/rules/include/RulesSubsystem.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/include/RulesSubsystem.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -28,7 +28,6 @@
     class CombatManager;
     class DsaManager;
     class CreatureControllerManager;
-    class SaveGameManager;
     class XdimlLoader;
 
 	class _RlRulesExport RulesSubsystem : public Ogre::Singleton<RulesSubsystem>
@@ -46,7 +45,6 @@
         CombatManager* mCombatManager;
         DsaManager* mDsaManager;
         CreatureControllerManager *mMovingCreatureManager;
-        SaveGameManager* mSaveGameManager;
         XdimlLoader* mXdimlLoader;
     };
 }

Deleted: rl/trunk/engine/rules/include/SaveGameFile.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/include/SaveGameFile.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -1,58 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#ifndef __SaveGameFile_H__
-#define __SaveGameFile_H__
-
-#include "RulesPrerequisites.h"
-#include <OgreDataStream.h>
-
-#include <Property.h>
-#include <Properties.h>
-
-#include <xercesc/framework/XMLFormatter.hpp>
-
-#include <ctime>
-
-namespace rl
-{
-    class _RlRulesExport SaveGameFile : public PropertyHolder
-    {
-    public:
-        SaveGameFile(const CeGuiString &name);
-        ~SaveGameFile();
-        CeGuiString buildFilename();
-        CeGuiString getName();
-        bool saveGameExists();
-
-        void setDataStream(const Ogre::DataStreamPtr &stream);
-        Ogre::DataStreamPtr getDataStream() const;
-        XERCES_CPP_NAMESPACE::XMLFormatTarget* getFormatTarget();
-        void deleteFileFromStorage();
-
-        virtual const Property getProperty(const Ogre::String& key) const;
-        virtual void setProperty(const Ogre::String& key, const Property& value);
-        virtual PropertySet* getAllProperties() const;
-    protected:
-        CeGuiString mName;
-        CeGuiString mModuleID;
-        CeGuiString mLocalTime;
-
-        Ogre::DataStreamPtr mStream;
-    };
-}
-
-#endif

Deleted: rl/trunk/engine/rules/include/SaveGameFileWriter.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/include/SaveGameFileWriter.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -1,38 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#ifndef _SaveGameFileWriter_H_
-#define _SaveGameFileWriter_H_
-
-#include "RulesPrerequisites.h"
-
-#include <XmlPropertyWriter.h>
-
-#include "GameObject.h"
-#include "SaveGameFile.h"
-
-namespace rl
-{
-    class _RlRulesExport SaveGameFileWriter 
-        : protected XmlPropertyWriter
-    {
-    public:
-        void buildSaveGameFile(SaveGameFile *file);
-    };
-}
-
-#endif
-

Deleted: rl/trunk/engine/rules/include/SaveGameManager.h
===================================================================
--- rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/include/SaveGameManager.h	2007-09-30 10:49:35 UTC (rev 3884)
@@ -1,60 +0,0 @@
-/* 
- * (C) 2003-2007. Team Pantheon. www.team-pantheon.de
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here:
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm
- */
-#ifndef _SaveGameManager_H_
-#define _SaveGameManager_H_
-
-#include "RulesPrerequisites.h"
-#include "SaveGameFileWriter.h"
-#include "SaveGameFile.h"
-
-#include <XmlPropertyWriter.h>
-#include <XmlPropertyReader.h>
-
-namespace rl
-{
-    typedef std::map<CeGuiString, SaveGameFile*> SaveGameEntryMap;
-
-    class SaveGameHeaderReader : public XmlPropertyReader
-    {
-    public:
-        SaveGameHeaderReader();
-        void parseHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file);
-    };
-
-    class _RlRulesExport SaveGameManager : public Ogre::Singleton<SaveGameManager>, public Ogre::ScriptLoader
-    {
-    public:
-        SaveGameManager(void);
-        virtual ~SaveGameManager(void);    
-
-        SaveGameEntryMap listSaveGames(void);
-        void saveSaveGameFile(const CeGuiString &name);
-        void loadSaveGameFile(const CeGuiString &name);
-        void deleteSaveGameFile(const CeGuiString &name);
-        bool SaveGameFileExists(const CeGuiString &name);
-
-        virtual const Ogre::StringVector&  getScriptPatterns(void) const;
-        virtual void parseScript(Ogre::DataStreamPtr &stream, const Ogre::String &groupName);
-        virtual Ogre::Real getLoadingOrder(void) const;
-    protected:
-        void freeSaveGameMap();
-
-        Ogre::StringVector mScriptPatterns;
-        SaveGameEntryMap mSaveGames;
-    };
-}
-
-#endif

Modified: rl/trunk/engine/rules/src/GameObjectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObjectManager.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/src/GameObjectManager.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -253,4 +253,30 @@
 
         return createRubyGameObject(classname, id);
     }
+
+    CeGuiString GameObjectManager::getXmlNodeIdentifier() const
+    {
+        return "gameobjects";
+    }
+    
+    void GameObjectManager::writeData(SaveGameFileWriter *writer)
+    {
+        XERCES_CPP_NAMESPACE::DOMElement* gameobjects = writer->appendChildElement(writer->getDocument(), writer->getDocument()->getDocumentElement(), "gameobjects");
+
+        std::list<const GameObject*> gos = GameObjectManager::getSingleton().getAllGameObjects();
+
+        for(std::list<const GameObject*>::const_iterator it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
+        {
+            XERCES_CPP_NAMESPACE::DOMElement* gameobject = writer->appendChildElement(writer->getDocument(), gameobjects, "gameobject");
+            writer->setAttributeValueAsInteger(gameobject, "ID", (*it_gameobjects)->getId());
+            writer->setAttributeValueAsString(gameobject, "ClassID", (*it_gameobjects)->getClassId());
+
+            PropertyMap map = (*it_gameobjects)->getAllProperties()->toPropertyMap();
+            writer->writeEachProperty(gameobject, map);
+        } 
+    }
+
+    void GameObjectManager::readData(rl::SaveGameFileReader *reader)
+    {
+    }
 }

Modified: rl/trunk/engine/rules/src/QuestBook.cpp
===================================================================
--- rl/trunk/engine/rules/src/QuestBook.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/src/QuestBook.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -241,4 +241,21 @@
         }
         return quests;
     }
+
+    CeGuiString QuestBook::getXmlNodeIdentifier() const
+    {
+        return "questbook";
+    }
+
+    void QuestBook::writeData(SaveGameFileWriter *writer)
+    {
+        XERCES_CPP_NAMESPACE::DOMElement* quests = writer->appendChildElement(writer->getDocument(), writer->getDocument()->getDocumentElement(), "quests");
+
+        PropertySet* set = getAllProperties();
+        writer->writeEachProperty(quests, set->toPropertyMap());
+    }
+
+    void QuestBook::readData(SaveGameFileReader* reader)
+    {
+    }
 }

Modified: rl/trunk/engine/rules/src/RulesSubsystem.cpp
===================================================================
--- rl/trunk/engine/rules/src/RulesSubsystem.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/src/RulesSubsystem.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -24,7 +24,6 @@
 #include "EffectFactory.h"
 #include "Logger.h"
 #include "CreatureControllerManager.h"
-#include "SaveGameManager.h"
 #include "GameObjectManager.h"
 #include "QuestBook.h"
 #include "GameTimeSource.h"
@@ -58,8 +57,6 @@
 		LOG_MESSAGE(Logger::RULES, "DsaManager erzeugt");
         mMovingCreatureManager = new CreatureControllerManager();
 		LOG_MESSAGE(Logger::RULES, "CreatureControllerManager erzeugt");
-        mSaveGameManager = new SaveGameManager();
-        LOG_MESSAGE(Logger::RULES, "SaveGameManager erzeugt");
 		resetQuestBook();
 		LOG_MESSAGE(Logger::RULES, "Questverwaltung erzeugt");
 
@@ -76,7 +73,6 @@
     {
         delete mQuestBook;
         delete mDsaManager;
-        delete mSaveGameManager;
         delete mMovingCreatureManager;
         delete mCombatManager;
         delete mActionManager;

Deleted: rl/trunk/engine/rules/src/SaveGameFile.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/src/SaveGameFile.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -1,113 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#include "stdinc.h" //precompiled header
-
-#include "SaveGameFile.h"
-#include "OgreString.h"
-#include <xercesc/framework/LocalFileFormatTarget.hpp>
-
-#include <ConfigurationManager.h>
-#include <CoreSubsystem.h>
-#include <ContentModule.h>
-
-namespace rl
-{
-
-    SaveGameFile::SaveGameFile(const CeGuiString &name) : mStream((Ogre::DataStream*)NULL)
-    {
-        mName = name;
-    }
-
-    SaveGameFile::~SaveGameFile()
-    {
-        if(mStream.isNull())
-            delete mStream.get();
-    }
-
-    CeGuiString SaveGameFile::buildFilename()
-    {
-        return ConfigurationManager::getSingleton().getModulesRootDirectory() + /*"/" 
-            + CoreSubsystem::getSingleton().getActiveAdventureModule()->getId()*/ + "/saves/" + mName + ".save";
-    }
-
-    CeGuiString SaveGameFile::getName()
-    {
-        return mName;
-    }
-
-    void SaveGameFile::setDataStream(const Ogre::DataStreamPtr &stream)
-    {
-        mStream = stream;
-    }
-
-    Ogre::DataStreamPtr SaveGameFile::getDataStream() const
-    {
-        ///@todo: decryption
-        return mStream;
-    }
-
-    XERCES_CPP_NAMESPACE::XMLFormatTarget* SaveGameFile::getFormatTarget()
-    {
-        ///@todo: encryption
-        return new XERCES_CPP_NAMESPACE::LocalFileFormatTarget(this->buildFilename().c_str());
-    }
-
-    void SaveGameFile::deleteFileFromStorage()
-    {
-        if(remove(buildFilename().c_str()))
-            LOG_ERROR(Logger::RULES, "SaveGameFile is not removed from filesystem. The file doesn't exists!");
-        else 
-            LOG_MESSAGE(Logger::RULES,"SaveGameFile successfully removed from filesystem");
-    }
-
-    bool SaveGameFile::saveGameExists()
-    {
-        return !Ogre::DataStreamPtr( new Ogre::FileHandleDataStream(fopen(this->buildFilename().c_str(), "r"))).isNull();
-    }
-
-    const Property SaveGameFile::getProperty(const Ogre::String& key) const
-    {
-        if(key == "ModuleID")
-            return Property(mModuleID);
-        else if(key == "Time")
-            return Property(mLocalTime);
-        else
-            return Property();
-    }
-
-    void SaveGameFile::setProperty(const Ogre::String& key, const Property& value)
-    {
-        if(key == "ModuleID")
-        {
-            if(value.isString())
-                mModuleID = value.toString();
-        }
-        else if(key == "Time")
-        {
-            if(value.isString())
-                mLocalTime = value.toString();
-        }
-    }
-
-    PropertySet* SaveGameFile::getAllProperties() const
-    {
-        PropertySet* set = new PropertySet();
-        set->setProperty("ModuleID", getProperty("ModuleID"));
-        set->setProperty("Time", getProperty("Time"));
-        return set;
-    }
-}

Deleted: rl/trunk/engine/rules/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/src/SaveGameFileWriter.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -1,143 +0,0 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#include "stdinc.h"
-
-#include "SaveGameFileWriter.h"
-
-#include <XmlProcessor.h>
-#include <xercesc/dom/DOM.hpp>
-#include <xercesc/dom/DOMAttr.hpp>
-#include <xercesc/dom/DOMElement.hpp>
-#include <Properties.h>
-
-#include "GameObjectManager.h"
-#include "QuestBook.h"
-#include "RulesSubsystem.h"
-
-#include <OgreResourceManager.h>
-#include <CEGUIPropertyHelper.h>
-#include <CoreSubsystem.h>
-#include <ContentModule.h>
-#include <TimeSource.h>
-
-#include <ctime>
-
-using namespace XERCES_CPP_NAMESPACE;
-using namespace Ogre;
-
-namespace rl
-{
-    void SaveGameFileWriter::buildSaveGameFile(SaveGameFile *file)
-    {
-        //@toto: build
-        initializeXml();
-
-        XMLCh tempStr[100];
-        XMLString::transcode("LS", tempStr, 99);
-        mImplementation = DOMImplementationRegistry::getDOMImplementation(tempStr);
-        mWriter = static_cast<DOMImplementationLS*>(mImplementation)->createDOMWriter();
-        mTarget = file->getFormatTarget();
-        mDocument = static_cast<DOMImplementation*>(mImplementation)->createDocument(0, XMLString::transcode("SaveGameFile"), 0);
-
-        if (mWriter->canSetFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true))
-            mWriter->setFeature(XMLUni::fgDOMWRTDiscardDefaultContent, true);
-
-        if (mWriter->canSetFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true))
-             mWriter->setFeature(XMLUni::fgDOMWRTFormatPrettyPrint, true);
-
-        mDocument->setNodeValue(XMLString::transcode("SaveGameFile")); //Set name of document root node
-
-        //Write SaveGameVersion
-        setAttributeValueAsString(mDocument->getDocumentElement(), "Version", "0.1");
-
-        //Write modul of save game
-        DOMElement* header = appendChildElement(mDocument, mDocument->getDocumentElement(), "header");
-        
-        PropertySet* headerSet = file->getAllProperties();
-        for(PropertySetMap::const_iterator it_header = headerSet->begin(); it_header != headerSet->end(); it_header++)
-        {
-            this->processProperty(header, PropertyEntry(it_header->first.c_str(), it_header->second));
-        }
-
-        /*setAttributeValueAsString(header, "ModuleID", CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
-        setAttributeValueAsInteger(header, "EngineVersion", CoreSubsystem::getSingleton().getEngineBuildNumber());
-        setAttributeValueAsString(header, "LocalTime", file->getProperty("Time").toString());*/
-
-        //Write date and time
-        //DOMElement* timeNode = appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
-        
-        /*tm* timeinfo = file->getLocalTime();
-
-        setAttributeValueAsInteger(timeNode, "day", timeinfo->tm_mday);
-        setAttributeValueAsInteger(timeNode, "month", timeinfo->tm_mon);
-        setAttributeValueAsInteger(timeNode, "year", timeinfo->tm_year+1900);
-
-        setAttributeValueAsInteger(timeNode, "hour", timeinfo->tm_hour);
-        setAttributeValueAsInteger(timeNode, "minute", timeinfo->tm_min);
-        setAttributeValueAsInteger(timeNode, "second", timeinfo->tm_sec);*/
-
-        //Write globals
-        DOMElement* globals = appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
-        DOMElement* gameTime = appendChildElement(mDocument, globals, "gametime");
-        TimeSource* gameTimeSource = TimeSourceManager::getSingleton().getTimeSource(TimeSource::GAMETIME);
-        setAttributeValueAsInteger(gameTime, "milliseconds", gameTimeSource->getClock());
-
-        //Write Quests
-        DOMElement* quests = appendChildElement(mDocument, mDocument->getDocumentElement(), "quests");
-        QuestBook* questBook = RulesSubsystem::getSingleton().getQuestBook();
-        PropertySet* set = questBook->getAllProperties();
-        for(PropertySetMap::const_iterator it_quests = set->begin(); it_quests != set->end(); it_quests++)
-        {
-            this->processProperty(quests, PropertyEntry(it_quests->first.c_str(), it_quests->second));
-        }
-
-        //Write game objects
-        DOMElement* gameobjects = appendChildElement(mDocument, mDocument->getDocumentElement(), "gameobjects");
-        
-
-        std::list<const GameObject*> gos = GameObjectManager::getSingleton().getAllGameObjects();
-
-        for(std::list<const GameObject*>::const_iterator it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
-        {
-            DOMElement* gameobject = appendChildElement(mDocument, gameobjects, "gameobject");
-            setAttributeValueAsInteger(gameobject, "ID", (*it_gameobjects)->getId());
-            setAttributeValueAsString(gameobject, "ClassID", (*it_gameobjects)->getClassId());
-
-            PropertyMap map = (*it_gameobjects)->getAllProperties()->toPropertyMap();
-            PropertyMap::iterator it_properties;
-            for(it_properties = map.begin(); it_properties != map.end(); it_properties++)
-            {
-                this->processProperty(gameobject, PropertyEntry(it_properties->first.c_str(), it_properties->second));
-            }
-        }        
-
-        //Write Zones?
-
-        //Write scripts
-        DOMElement* scripts = appendChildElement(mDocument, mDocument->getDocumentElement(), "scripts");
-
-        mWriter->writeNode(mTarget, *mDocument);
-
-
-        mWriter->release();
-
-        delete mDocument;
-        delete mTarget;
-
-        shutdownXml();
-    }
-}

Deleted: rl/trunk/engine/rules/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/rules/src/SaveGameManager.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -1,187 +0,0 @@
-/* 
- * (C) 2003-2007. Team Pantheon. www.team-pantheon.de
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here:
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm
- */
-
-#include "stdinc.h"
-
-#include "SaveGameManager.h"
-
-#include <CoreSubsystem.h>
-#include <ContentModule.h>
-#include <ConfigurationManager.h>
-
-#include <XmlProcessor.h>
-
-#include <xercesc/dom/DOM.hpp>
-#include <xercesc/framework/LocalFileFormatTarget.hpp>
-
-template<> rl::SaveGameManager* Ogre::Singleton<rl::SaveGameManager>::ms_Singleton = 0;
-
-using namespace XERCES_CPP_NAMESPACE;
-
-namespace rl
-{
-    CeGuiString printTimeAsString(tm* time)
-    {
-        CeGuiString string = ((Ogre::String)(Ogre::StringConverter::toString(time->tm_mday) + "." 
-            + Ogre::StringConverter::toString(time->tm_mon) + "."
-            + Ogre::StringConverter::toString(time->tm_year + 1900) + " - " 
-            + Ogre::StringConverter::toString(time->tm_hour) + ":"
-            + Ogre::StringConverter::toString(time->tm_min) + ":" 
-            + Ogre::StringConverter::toString(time->tm_sec))).c_str();
-        return string;
-    }
-
-    SaveGameHeaderReader::SaveGameHeaderReader()
-    {
-    }
-
-    void SaveGameHeaderReader::parseHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file)
-    {
-        initializeXml();
-
-        if(stream->size())
-        {
-            DOMDocument* doc = loadDocument(stream);
-
-             DOMNodeList* headerDefsXml = doc->getDocumentElement()->getElementsByTagName(AutoXMLCh("header").data());
-             if(headerDefsXml->getLength())
-             {
-                 DOMElement* elem = static_cast<DOMElement*>(headerDefsXml->item(0));
-                 DOMNodeList* headerDefChildren = elem->getChildNodes();
-                 for(XMLSize_t childIdx = 0; childIdx < headerDefChildren->getLength(); childIdx++)
-                 {
-                     DOMNode* curChild = headerDefChildren->item(childIdx);
-                     if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
-                     {
-                         PropertyEntry entry = processProperty(static_cast<DOMElement*>(curChild));
-                         if(entry.first != "")
-                         {
-                            file->setProperty(entry.first, entry.second);
-                         }
-                     }
-                 }
-             }
-        }
-
-        shutdownXml();
-    }
-
-    SaveGameManager::SaveGameManager()
-    { 
-        Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
-
-        mScriptPatterns.push_back("*.save");
-        Ogre::ResourceGroupManager::getSingleton()._registerScriptLoader(this);
-
-        Ogre::ResourceGroupManager::getSingleton().addResourceLocation(ConfigurationManager::getSingleton().getModulesRootDirectory() 
-            + "/saves", "FileSystem", "SaveGames");
-        Ogre::ResourceGroupManager::getSingleton().initialiseResourceGroup("SaveGames");
-        Ogre::ResourceGroupManager::getSingleton().clearResourceGroup("SaveGames"); //close all resource files -> make them writable
-    }
-
-    SaveGameManager::~SaveGameManager()
-    {
-        freeSaveGameMap();
-    }
-
-    SaveGameEntryMap SaveGameManager::listSaveGames()
-    {
-        return mSaveGames;
-    }
-
-    void SaveGameManager::saveSaveGameFile(const CeGuiString &name)
-    {
-        time_t rawTime;
-        tm* localTime; 
-        time(&rawTime);
-        localTime = localtime(&rawTime); 
-        SaveGameFile* file = new SaveGameFile(name);
-        file->setProperty("Time", Property(printTimeAsString(localTime)));
-        file->setProperty("ModuleID", Property(CoreSubsystem::getSingleton().getActiveAdventureModule()->getName()));
-
-        mSaveGames[name] = file;
-
-        SaveGameFileWriter writer;
-        writer.buildSaveGameFile(file);
-
-        freeSaveGameMap();
-
-        Ogre::ResourceGroupManager::getSingleton().initialiseResourceGroup("SaveGames");
-        Ogre::ResourceGroupManager::getSingleton().clearResourceGroup("SaveGames"); //close all resource files -> make them writable
-    }
-
-    void SaveGameManager::loadSaveGameFile(const CeGuiString &name)
-    {
-        if(SaveGameFileExists(name))
-        {
-            SaveGameFile file(name);
-            ///@todo: SaveGameReader
-        }
-    }
-
-    void SaveGameManager::deleteSaveGameFile(const CeGuiString &name)
-    {
-        if(SaveGameFileExists(name))
-        {
-            static_cast<SaveGameFile*>(mSaveGames[name])->deleteFileFromStorage();
-            delete mSaveGames[name];
-            mSaveGames.erase(name);
-        }
-    }
-
-    bool SaveGameManager::SaveGameFileExists(const CeGuiString &name)
-    {
-        if(mSaveGames.find(name) != mSaveGames.end())
-            return true;
-        return false;
-    }
-    
-    const Ogre::StringVector& SaveGameManager::getScriptPatterns() const
-    {
-        return mScriptPatterns;
-    }
-
-    Ogre::Real SaveGameManager::getLoadingOrder() const
-    {
-        return 2000.0f;
-    }
-
-    void SaveGameManager::parseScript(Ogre::DataStreamPtr &stream, const Ogre::String &groupName)
-    {
-        Ogre::String name = stream->getName();
-        name = name.substr(0, name.length()-5); //delete ".save" at the and of the name
-
-        SaveGameFile* file = new SaveGameFile(name);
-        
-        LOG_MESSAGE(Logger::RULES, "Parsing header of save game: " + name);
-        SaveGameHeaderReader reader;
-        reader.parseHeader(stream, groupName, file);
-
-        Ogre::DataStream* _stream = new Ogre::MemoryDataStream(*stream, false); //making a copy of the data stream. searching for a better alternative
-        file->setDataStream(Ogre::DataStreamPtr(_stream));
-        
-        mSaveGames[name] = file;
-    }
-
-    void SaveGameManager::freeSaveGameMap()
-    {
-        for(SaveGameEntryMap::const_iterator iter = mSaveGames.begin(); iter != mSaveGames.end(); iter++)
-        {
-            delete iter->second;
-        }
-        mSaveGames.clear();
-    }
-}

Modified: rl/trunk/engine/ui/src/SaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-27 21:26:30 UTC (rev 3883)
+++ rl/trunk/engine/ui/src/SaveLoadWindow.cpp	2007-09-30 10:49:35 UTC (rev 3884)
@@ -31,6 +31,8 @@
 #include <OgreResourceGroupManager.h>
 
 #include "SaveLoadWindow.h"
+#include "MessageWindow.h"
+#include "WindowFactory.h"
 #include "ConfigurationManager.h"
 #include "SaveGameManager.h"
 
@@ -104,6 +106,18 @@
     bool SaveLoadWindow::handleLoadEvent()
     {
         LOG_MESSAGE(Logger::UI, "Load Button pressed");
+
+        CeGuiString filename = mFilename->getText();
+
+        if(filename != "")
+        {
+
+            if(SaveGameManager::getSingleton().SaveGameFileExists(filename))
+                SaveGameManager::getSingleton().loadSaveGameFile(filename);
+            else
+                LOG_ERROR(Logger::UI, "Save Game " + filename + " doesn't exist!");
+        }
+
         return true;
     }
 
@@ -113,27 +127,21 @@
     {
         LOG_MESSAGE(Logger::UI, "Save Button pressed");
 
-        LOG_MESSAGE(Logger::UI, "Create a SaveGameFile");
+        CeGuiString filename = mFilename->getText();
 
-        //SaveGameFile saveGameFile(mFilename->getText());
+        if(filename != "")
+        {
+            LOG_MESSAGE(Logger::UI, "Create a SaveGameFile");
 
-        /*std::list<const GameObject*>::const_iterator it;
-        std::list<const GameObject*> gos;
-        gos = GameObjectManager::getSingleton().getAllGameObjects();
+            SaveGameManager::getSingleton().saveSaveGameFile(filename);
 
-        std::vector<PropertySet*> sets;
-        for( it=gos.begin(); it!=gos.end(); ++it )
+            LOG_MESSAGE(Logger::UI, "Created save game");
+        }
+        else
         {
-            sets.push_back((*it)->getAllProperties());
-        }*/
-        //SaveGameFileWriter saveGameFileWriter;
-        //saveGameFileWriter.setPropertySets(sets);
-        //saveGameFileWriter.buildSaveGameFile(&saveGameFile);
+            WindowFactory::getSingleton().showMessageWindow("Bitte einen Namen f?r den Spielstand eingeben");
+        }
 
-        SaveGameManager::getSingleton().saveSaveGameFile(mFilename->getText());
-
-        LOG_MESSAGE(Logger::UI, "Created save game");
-
         listSaveGames();
 
         return true;
@@ -164,6 +172,8 @@
             mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->second->getProperty("Time")), 1, saveGameNum);
             saveGameNum++;
         }
+        mSaveGameTable->autoSizeColumnHeader(0);
+        mSaveGameTable->autoSizeColumnHeader(1);
     }
 
 } // namespace rl



From timm at mail.berlios.de  Sun Sep 30 12:54:10 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 30 Sep 2007 12:54:10 +0200
Subject: [Dsa-hl-svn] r3885 - in rl/trunk/engine: core/include core/src
	rules/include rules/src
Message-ID: <200709301054.l8UAsAcS014885@sheep.berlios.de>

Author: timm
Date: 2007-09-30 12:53:57 +0200 (Sun, 30 Sep 2007)
New Revision: 3885

Modified:
   rl/trunk/engine/core/include/Makefile.am
   rl/trunk/engine/core/src/Makefile.am
   rl/trunk/engine/rules/include/Makefile.am
   rl/trunk/engine/rules/src/Makefile.am
Log:
making the linux guys happy ;)

Modified: rl/trunk/engine/core/include/Makefile.am
===================================================================
--- rl/trunk/engine/core/include/Makefile.am	2007-09-30 10:49:35 UTC (rev 3884)
+++ rl/trunk/engine/core/include/Makefile.am	2007-09-30 10:53:57 UTC (rev 3885)
@@ -54,6 +54,10 @@
 	PrimitiveObject.h \
 	QuadTree.h \
 	RubyInterpreter.h \
+	SaveGameFile.h \
+	SaveGameFileReader.h \
+	SaveGameFileWriter.h \
+	SaveGameManager.h \
 	SceneQuery.h \
 	Sound.h \
 	SoundDriver.h \

Modified: rl/trunk/engine/core/src/Makefile.am
===================================================================
--- rl/trunk/engine/core/src/Makefile.am	2007-09-30 10:49:35 UTC (rev 3884)
+++ rl/trunk/engine/core/src/Makefile.am	2007-09-30 10:53:57 UTC (rev 3885)
@@ -53,6 +53,10 @@
 	PolynomicSoundFadeFunctor.cpp \
 	PrimitiveObject.cpp \
 	RubyInterpreter.cpp \
+	SaveGameFile.cpp \
+	SaveGameFileReader.cpp \
+	SaveGameFileWriter.cpp \
+	SaveGameManager.cpp \
 	SceneQuery.cpp \
 	SoundManager.cpp \
 	SoundObject.cpp \

Modified: rl/trunk/engine/rules/include/Makefile.am
===================================================================
--- rl/trunk/engine/rules/include/Makefile.am	2007-09-30 10:49:35 UTC (rev 3884)
+++ rl/trunk/engine/rules/include/Makefile.am	2007-09-30 10:53:57 UTC (rev 3885)
@@ -34,9 +34,6 @@
 	QuestListener.h \
 	RulesPrerequisites.h \
 	RulesSubsystem.h \
-	SaveGameFile.h \
-	SaveGameFileWriter.h \
-	SaveGameManager.h \
 	SelectionHelper.h \
 	Selector.h \
 	Slot.h \

Modified: rl/trunk/engine/rules/src/Makefile.am
===================================================================
--- rl/trunk/engine/rules/src/Makefile.am	2007-09-30 10:49:35 UTC (rev 3884)
+++ rl/trunk/engine/rules/src/Makefile.am	2007-09-30 10:53:57 UTC (rev 3885)
@@ -37,9 +37,6 @@
 	QuestEvent.cpp \
 	QuestListener.cpp \
 	RulesSubsystem.cpp \
-	SaveGameFile.cpp \
-	SaveGameFileWriter.cpp \
-	SaveGameManager.cpp \
 	SelectionHelper.cpp \
 	Selector.cpp \
 	Slot.cpp \



From timm at mail.berlios.de  Sun Sep 30 14:37:45 2007
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 30 Sep 2007 14:37:45 +0200
Subject: [Dsa-hl-svn] r3886 - in rl/trunk/engine/core: include src
Message-ID: <200709301237.l8UCbjP0029251@sheep.berlios.de>

Author: timm
Date: 2007-09-30 14:37:34 +0200 (Sun, 30 Sep 2007)
New Revision: 3886

Modified:
   rl/trunk/engine/core/include/SaveGameFileReader.h
   rl/trunk/engine/core/include/SaveGameManager.h
   rl/trunk/engine/core/src/SaveGameFileReader.cpp
   rl/trunk/engine/core/src/SaveGameFileWriter.cpp
   rl/trunk/engine/core/src/SaveGameManager.cpp
Log:
Get lost damn SaveGameHeaderReader!

Modified: rl/trunk/engine/core/include/SaveGameFileReader.h
===================================================================
--- rl/trunk/engine/core/include/SaveGameFileReader.h	2007-09-30 10:53:57 UTC (rev 3885)
+++ rl/trunk/engine/core/include/SaveGameFileReader.h	2007-09-30 12:37:34 UTC (rev 3886)
@@ -30,6 +30,7 @@
     public:
         SaveGameFileReader();
         void parseSaveGameFile(SaveGameFile* file, const SaveGameDataSet &set);
+        void parseSaveGameFileHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file);
     };
 }
 

Modified: rl/trunk/engine/core/include/SaveGameManager.h
===================================================================
--- rl/trunk/engine/core/include/SaveGameManager.h	2007-09-30 10:53:57 UTC (rev 3885)
+++ rl/trunk/engine/core/include/SaveGameManager.h	2007-09-30 12:37:34 UTC (rev 3886)
@@ -40,13 +40,6 @@
 
     typedef std::map<CeGuiString, SaveGameFile*> SaveGameEntryMap;
 
-    class SaveGameHeaderReader : public XmlPropertyReader
-    {
-    public:
-        SaveGameHeaderReader();
-        void parseHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file);
-    };
-
     class _RlCoreExport SaveGameManager : public Ogre::Singleton<SaveGameManager>, public Ogre::ScriptLoader
     {
     public:

Modified: rl/trunk/engine/core/src/SaveGameFileReader.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveGameFileReader.cpp	2007-09-30 10:53:57 UTC (rev 3885)
+++ rl/trunk/engine/core/src/SaveGameFileReader.cpp	2007-09-30 12:37:34 UTC (rev 3886)
@@ -36,8 +36,45 @@
 
         DOMDocument* doc = loadDocument(file->getDataStream());
 
+        for(SaveGameDataSet::const_iterator data_iter = set.begin(); data_iter != set.end(); data_iter++)
+        {
+            (*data_iter)->readData(this);
+        }
+
+
         doc->release();
 
         shutdownXml();
     }
+
+    void SaveGameFileReader::parseSaveGameFileHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file)
+    {
+        initializeXml();
+
+        if(stream->size())
+        {
+            DOMDocument* doc = loadDocument(stream);
+
+             DOMNodeList* headerDefsXml = doc->getDocumentElement()->getElementsByTagName(AutoXMLCh("header").data());
+             if(headerDefsXml->getLength())
+             {
+                 DOMElement* elem = static_cast<DOMElement*>(headerDefsXml->item(0));
+                 DOMNodeList* headerDefChildren = elem->getChildNodes();
+                 for(XMLSize_t childIdx = 0; childIdx < headerDefChildren->getLength(); childIdx++)
+                 {
+                     DOMNode* curChild = headerDefChildren->item(childIdx);
+                     if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
+                     {
+                         PropertyEntry entry = processProperty(static_cast<DOMElement*>(curChild));
+                         if(entry.first != "")
+                         {
+                            file->setProperty(entry.first, entry.second);
+                         }
+                     }
+                 }
+             }
+        }
+
+        shutdownXml();
+    }
 }
\ No newline at end of file

Modified: rl/trunk/engine/core/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveGameFileWriter.cpp	2007-09-30 10:53:57 UTC (rev 3885)
+++ rl/trunk/engine/core/src/SaveGameFileWriter.cpp	2007-09-30 12:37:34 UTC (rev 3886)
@@ -71,63 +71,12 @@
             this->processProperty(header, PropertyEntry(it_header->first.c_str(), it_header->second));
         }
 
-        /*setAttributeValueAsString(header, "ModuleID", CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
-        setAttributeValueAsInteger(header, "EngineVersion", CoreSubsystem::getSingleton().getEngineBuildNumber());
-        setAttributeValueAsString(header, "LocalTime", file->getProperty("Time").toString());*/
-
-        //Write date and time
-        //DOMElement* timeNode = appendChildElement(mDocument, mDocument->getDocumentElement(), "time");
-        
-        /*tm* timeinfo = file->getLocalTime();
-
-        setAttributeValueAsInteger(timeNode, "day", timeinfo->tm_mday);
-        setAttributeValueAsInteger(timeNode, "month", timeinfo->tm_mon);
-        setAttributeValueAsInteger(timeNode, "year", timeinfo->tm_year+1900);
-
-        setAttributeValueAsInteger(timeNode, "hour", timeinfo->tm_hour);
-        setAttributeValueAsInteger(timeNode, "minute", timeinfo->tm_min);
-        setAttributeValueAsInteger(timeNode, "second", timeinfo->tm_sec);*/
-
         //Write globals
         DOMElement* globals = appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
         DOMElement* gameTime = appendChildElement(mDocument, globals, "gametime");
         TimeSource* gameTimeSource = TimeSourceManager::getSingleton().getTimeSource(TimeSource::GAMETIME);
         setAttributeValueAsInteger(gameTime, "milliseconds", gameTimeSource->getClock());
 
-        ////Write Quests
-        //DOMElement* quests = appendChildElement(mDocument, mDocument->getDocumentElement(), "quests");
-        //QuestBook* questBook = RulesSubsystem::getSingleton().getQuestBook();
-        //PropertySet* set = questBook->getAllProperties();
-        //for(PropertySetMap::const_iterator it_quests = set->begin(); it_quests != set->end(); it_quests++)
-        //{
-        //    this->processProperty(quests, PropertyEntry(it_quests->first.c_str(), it_quests->second));
-        //}
-
-        ////Write game objects
-        //DOMElement* gameobjects = appendChildElement(mDocument, mDocument->getDocumentElement(), "gameobjects");
-        //
-
-        //std::list<const GameObject*> gos = GameObjectManager::getSingleton().getAllGameObjects();
-
-        //for(std::list<const GameObject*>::const_iterator it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
-        //{
-        //    DOMElement* gameobject = appendChildElement(mDocument, gameobjects, "gameobject");
-        //    setAttributeValueAsInteger(gameobject, "ID", (*it_gameobjects)->getId());
-        //    setAttributeValueAsString(gameobject, "ClassID", (*it_gameobjects)->getClassId());
-
-        //    PropertyMap map = (*it_gameobjects)->getAllProperties()->toPropertyMap();
-        //    PropertyMap::iterator it_properties;
-        //    for(it_properties = map.begin(); it_properties != map.end(); it_properties++)
-        //    {
-        //        this->processProperty(gameobject, PropertyEntry(it_properties->first.c_str(), it_properties->second));
-        //    }
-        //}        
-
-        ////Write Zones?
-
-        ////Write scripts
-        //DOMElement* scripts = appendChildElement(mDocument, mDocument->getDocumentElement(), "scripts");
-
         for(SaveGameDataSet::const_iterator data_iter = set.begin(); data_iter != set.end(); data_iter++)
         {
             (*data_iter)->writeData(this);

Modified: rl/trunk/engine/core/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveGameManager.cpp	2007-09-30 10:53:57 UTC (rev 3885)
+++ rl/trunk/engine/core/src/SaveGameManager.cpp	2007-09-30 12:37:34 UTC (rev 3886)
@@ -54,41 +54,6 @@
         return string;
     }
 
-    SaveGameHeaderReader::SaveGameHeaderReader()
-    {
-    }
-
-    void SaveGameHeaderReader::parseHeader(Ogre::DataStreamPtr &stream, const Ogre::String &groupName, SaveGameFile* file)
-    {
-        initializeXml();
-
-        if(stream->size())
-        {
-            DOMDocument* doc = loadDocument(stream);
-
-             DOMNodeList* headerDefsXml = doc->getDocumentElement()->getElementsByTagName(AutoXMLCh("header").data());
-             if(headerDefsXml->getLength())
-             {
-                 DOMElement* elem = static_cast<DOMElement*>(headerDefsXml->item(0));
-                 DOMNodeList* headerDefChildren = elem->getChildNodes();
-                 for(XMLSize_t childIdx = 0; childIdx < headerDefChildren->getLength(); childIdx++)
-                 {
-                     DOMNode* curChild = headerDefChildren->item(childIdx);
-                     if (curChild->getNodeType() == DOMNode::ELEMENT_NODE)
-                     {
-                         PropertyEntry entry = processProperty(static_cast<DOMElement*>(curChild));
-                         if(entry.first != "")
-                         {
-                            file->setProperty(entry.first, entry.second);
-                         }
-                     }
-                 }
-             }
-        }
-
-        shutdownXml();
-    }
-
     SaveGameManager::SaveGameManager()
     { 
         Ogre::ResourceGroupManager::getSingleton().createResourceGroup("SaveGames");
@@ -177,8 +142,8 @@
         SaveGameFile* file = new SaveGameFile(name);
         
         LOG_MESSAGE(Logger::RULES, "Parsing header of save game: " + name);
-        SaveGameHeaderReader reader;
-        reader.parseHeader(stream, groupName, file);
+        SaveGameFileReader reader;
+        reader.parseSaveGameFileHeader(stream, groupName, file);
 
         Ogre::DataStream* _stream = new Ogre::MemoryDataStream(*stream, false); //making a copy of the data stream. searching for a better alternative
         file->setDataStream(Ogre::DataStreamPtr(_stream));



