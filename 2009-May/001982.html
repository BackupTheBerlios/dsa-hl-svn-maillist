<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4926 - in dependencies/OgreNewt:	demos/Demo01_TheBasics demos/Demo02_Joints	demos/Demo03_CollisionCallbacks demos/Demo04_Raycasting	demos/Demo06_SimpleBuoyancy demos/Demo07_CustomJoints	demos/Demo08_RagdollExample inc src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4926%20-%20in%20dependencies/OgreNewt%3A%0A%09demos/Demo01_TheBasics%20demos/Demo02_Joints%0A%09demos/Demo03_CollisionCallbacks%20demos/Demo04_Raycasting%0A%09demos/Demo06_SimpleBuoyancy%20demos/Demo07_CustomJoints%0A%09demos/Demo08_RagdollExample%20inc%20src&In-Reply-To=%3C200905181642.n4IGg8i9008734%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001981.html">
   <LINK REL="Next"  HREF="001983.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4926 - in dependencies/OgreNewt:	demos/Demo01_TheBasics demos/Demo02_Joints	demos/Demo03_CollisionCallbacks demos/Demo04_Raycasting	demos/Demo06_SimpleBuoyancy demos/Demo07_CustomJoints	demos/Demo08_RagdollExample inc src</H1>
    <B>melven at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4926%20-%20in%20dependencies/OgreNewt%3A%0A%09demos/Demo01_TheBasics%20demos/Demo02_Joints%0A%09demos/Demo03_CollisionCallbacks%20demos/Demo04_Raycasting%0A%09demos/Demo06_SimpleBuoyancy%20demos/Demo07_CustomJoints%0A%09demos/Demo08_RagdollExample%20inc%20src&In-Reply-To=%3C200905181642.n4IGg8i9008734%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4926 - in dependencies/OgreNewt:	demos/Demo01_TheBasics demos/Demo02_Joints	demos/Demo03_CollisionCallbacks demos/Demo04_Raycasting	demos/Demo06_SimpleBuoyancy demos/Demo07_CustomJoints	demos/Demo08_RagdollExample inc src">melven at mail.berlios.de
       </A><BR>
    <I>Mon May 18 18:42:08 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001981.html">[Dsa-hl-svn] r4925 - rl/trunk/engine/ui/src
</A></li>
        <LI>Next message: <A HREF="001983.html">[Dsa-hl-svn] r4927 - in rl/trunk/engine: core/include core/src	rules/src ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1982">[ date ]</a>
              <a href="thread.html#1982">[ thread ]</a>
              <a href="subject.html#1982">[ subject ]</a>
              <a href="author.html#1982">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: melven
Date: 2009-05-18 18:41:56 +0200 (Mon, 18 May 2009)
New Revision: 4926

Modified:
   dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorBelt.cpp
   dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorMatCallback.cpp
   dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.cpp
   dependencies/OgreNewt/inc/OgreNewt.h
   dependencies/OgreNewt/inc/OgreNewt_Body.h
   dependencies/OgreNewt/inc/OgreNewt_Collision.h
   dependencies/OgreNewt/inc/OgreNewt_CollisionPrimitives.h
   dependencies/OgreNewt/inc/OgreNewt_Debugger.h
   dependencies/OgreNewt/inc/OgreNewt_Joint.h
   dependencies/OgreNewt/inc/OgreNewt_MaterialID.h
   dependencies/OgreNewt/inc/OgreNewt_Prerequisites.h
   dependencies/OgreNewt/inc/OgreNewt_Tools.h
   dependencies/OgreNewt/src/OgreNewt_Body.cpp
   dependencies/OgreNewt/src/OgreNewt_Collision.cpp
   dependencies/OgreNewt/src/OgreNewt_PlayerController.cpp
Log:
-use sharedptrs for collision as default
-use Ogre::Any for userdata values as default
-set position and orientation of a node attached to a body correctly, when the the node derives position/orientation from its parent
-make OgreNewt export the (internally used) MovableText-class
-updated the demos


Modified: dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonApplication.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonApplication.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -60,7 +60,7 @@
 	// now we make a new rigid body based on this collision shape.
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
 
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	// we`re done with the collision shape, we can delete it now.
 	delete col;
 #endif

Modified: dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonFrameListener.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonFrameListener.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -87,7 +87,7 @@
 
 			Ogre::Vector3 inertia, offset;
             col-&gt;calculateInertialMatrix(inertia, offset);
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 			//no longer need the collision shape object
 			delete col;
 #endif

Modified: dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonApplication.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonApplication.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -75,7 +75,7 @@
 	OgreNewt::CollisionPrimitives::TreeCollisionSceneParser* stat_col = new OgreNewt::CollisionPrimitives::TreeCollisionSceneParser( m_World );
 	stat_col-&gt;parseScene( floornode, true );
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, OgreNewt::CollisionPtr(stat_col) );
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete stat_col;
 #endif
 	
@@ -173,7 +173,7 @@
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
 
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete col;
 #endif
 				

Modified: dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonFrameListener.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonFrameListener.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -77,7 +77,7 @@
 			OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Ellipsoid( m_World, Ogre::Vector3(1,1,1) ));
 			OgreNewt::Body* body = new OgreNewt::Body( m_World, col );
 
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
             delete col;
 #endif
 

Modified: dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorBelt.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorBelt.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorBelt.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -16,7 +16,7 @@
 {
 	// build a conveyor belt object.  first create the basic visual object.
 	mSceneMgr = mgr;
-	mDir = dir;
+	mDir = dir.normalisedCopy();
 	mSpeed = speed;
 
 	mNode = mgr-&gt;getRootSceneNode()-&gt;createChildSceneNode();
@@ -29,7 +29,7 @@
 	// create the collision object for the conveyor belt.
 	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::Box( world, size ));
 	mBody = new OgreNewt::Body( world, col, conveyorType );
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete col;
 #endif
 
@@ -37,7 +37,7 @@
 	mBody-&gt;attachNode( mNode );
 	mBody-&gt;setMaterialGroupID( conveyorMat );
 
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
 	mBody-&gt;setUserData( Ogre::Any(this) );
 #else
 	mBody-&gt;setUserData( this );

Modified: dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorMatCallback.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorMatCallback.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorMatCallback.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -29,7 +29,7 @@
 
 	if (body0-&gt;getType() == mConveyorID)
 	{
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
 		belt = Ogre::any_cast&lt;ConveyorBelt*&gt;(body0-&gt;getUserData());
 #else
 		belt = (ConveyorBelt*)body0-&gt;getUserData();
@@ -39,7 +39,7 @@
 
 	if (body1-&gt;getType() == mConveyorID)
 	{
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
 		belt = Ogre::any_cast&lt;ConveyorBelt*&gt;(body1-&gt;getUserData());
 #else
 		belt = (ConveyorBelt*)body1-&gt;getUserData();
@@ -55,8 +55,15 @@
         for( OgreNewt::Contact contact = contactJoint.getFirstContact(); contact; contact = contact.getNext() )
         {
 	        contact.rotateTangentDirections( thedir );
-    	    Ogre::Vector3 result_accel = (thedir * belt-&gt;getSpeed()) - object-&gt;getVelocity();
-	        contact.setTangentAcceleration( result_accel.length(), 0 );
+            Ogre::Vector3 contactPos, contactNorm;
+            contact.getPositionAndNormal(contactPos, contactNorm);
+            Ogre::Vector3 objectPos;
+            Ogre::Quaternion objectOri;
+            object-&gt;getPositionOrientation(objectPos, objectOri);
+            Ogre::Vector3 objectContactPointVel = object-&gt;getVelocity() + (contactPos - objectPos)*object-&gt;getOmega();
+    	    Ogre::Real result_accel = belt-&gt;getSpeed() - thedir.dotProduct(objectContactPointVel);
+            result_accel *= 10; // looks nicer
+	        contact.setTangentAcceleration( result_accel, 0 );
         }
     }
 }

Modified: dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonApplication.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonApplication.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -82,7 +82,7 @@
 	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
 	
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
     delete col;
 #endif
 
@@ -113,7 +113,9 @@
 	mMatPairDefaultConveyor = new OgreNewt::MaterialPair( m_World, mMatDefault, mMatConveyor );
 	mConveyorCallback = new ConveyorMatCallback( BT_CONVEYOR );
 	mMatPairDefaultConveyor-&gt;setContactCallback( mConveyorCallback );
-	mMatPairDefaultConveyor-&gt;setDefaultFriction( 1.5, 1.4 );
+	mMatPairDefaultConveyor-&gt;setDefaultSoftness( 0.8 );
+    mMatPairDefaultConveyor-&gt;setDefaultElasticity( 0.05 );
+    mMatPairDefaultConveyor-&gt;setDefaultFriction( 0.9, 0.8 );
 
 }
 

Modified: dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonFrameListener.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonFrameListener.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -74,7 +74,7 @@
         Ogre::Vector3 inertia, offset;
         col-&gt;calculateInertialMatrix(inertia, offset);
 
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 		delete col;
 #endif
 

Modified: dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonApplication.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonApplication.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -77,7 +77,7 @@
 	//Ogre::Vector3 siz(100.0, 10.0, 100.0);
 	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete col;
 #endif
 	
@@ -186,7 +186,7 @@
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
 
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete col;
 #endif
 				

Modified: dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonFrameListener.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonFrameListener.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -115,7 +115,7 @@
 
 				// now we need to save this point to apply the spring force, I'm using the userData of the bodies in this example.
                 // (where is it used? probably not needed here...)
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
                 info.mBody-&gt;setUserData( Ogre::Any(this) );
 #else
 				info.mBody-&gt;setUserData( this );

Modified: dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonApplication.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonApplication.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -77,7 +77,7 @@
 	//Ogre::Vector3 siz(100.0, 10.0, 100.0);
 	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete col;
 #endif
 	
@@ -202,7 +202,7 @@
 	// calculate the inertia based on box formula and mass
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete col;
 #endif
 				

Modified: dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonFrameListener.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonFrameListener.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -115,7 +115,7 @@
 
 				// now we need to save this point to apply the spring force, I'm using the userData of the bodies in this example.
                 // (where is it used? probably not needed here...)
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
                 info.mBody-&gt;setUserData( Ogre::Any(this) );
 #else
 				info.mBody-&gt;setUserData( this );

Modified: dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonApplication.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonApplication.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -76,7 +76,7 @@
 	OgreNewt::CollisionPrimitives::TreeCollisionSceneParser* stat_col = new OgreNewt::CollisionPrimitives::TreeCollisionSceneParser( m_World );
 	stat_col-&gt;parseScene( floornode, true );
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, OgreNewt::CollisionPtr(stat_col) );
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete stat_col;
 #endif
 	
@@ -172,7 +172,7 @@
 	// calculate the inertia based on box formula and mass
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete col;
 #endif
 				

Modified: dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonFrameListener.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonFrameListener.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -87,7 +87,7 @@
 
 			timer = 0.2;
 
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
             delete col;
 #endif
 		}

Modified: dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonApplication.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonApplication.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -51,7 +51,7 @@
 	//Ogre::Vector3 siz(100.0, 10.0, 100.0);
 	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete col;
 #endif
 	
@@ -110,7 +110,7 @@
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
 
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
 	delete col;
 #endif
 				

Modified: dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonFrameListener.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonFrameListener.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -101,7 +101,7 @@
 
 			timer = 0.2;
 
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
             delete col;
 #endif
 		}

Modified: dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -8,7 +8,7 @@
 	mParent = parent;
 	mOgreBone = ogreBone;
 
-#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifndef OGRENEWT_NO_COLLISION_SHAREDPTR
 	OgreNewt::ConvexCollisionPtr col;
 #else
 	OgreNewt::ConvexCollisionPtr col = NULL;
@@ -65,7 +65,7 @@
 	}
 
 	mBody = new OgreNewt::Body( world, col );
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
 	mBody-&gt;setUserData( Ogre::Any(this) );
 #else
     mBody-&gt;setUserData( this );
@@ -82,7 +82,7 @@
 	mBody-&gt;setCustomTransformCallback( RagDoll::_placementCallback );
 
 
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
     delete col;
 #endif
 }
@@ -97,7 +97,7 @@
 
 void RagDoll::RagBone::_hingeCallback( OgreNewt::BasicJoints::Hinge* me )
 {
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
 	RagDoll::RagBone* bone = Ogre::any_cast&lt;RagDoll::RagBone*&gt;(me-&gt;getUserData());
 #else
 	RagDoll::RagBone* bone = (RagDoll::RagBone*)me-&gt;getUserData();
@@ -405,7 +405,7 @@
 	case RagDoll::JT_HINGE:
 		joint = new OgreNewt::BasicJoints::Hinge( child-&gt;getBody()-&gt;getWorld(), child-&gt;getBody(), parent-&gt;getBody(), pos, pin );
 		((OgreNewt::BasicJoints::Hinge*)joint)-&gt;setCallback( RagBone::_hingeCallback );
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
 	joint-&gt;setUserData( Ogre::Any(child) );
 #else
 	joint-&gt;setUserData( child );
@@ -419,7 +419,7 @@
 
 void RagDoll::_placementCallback( OgreNewt::Body* me, const Ogre::Quaternion&amp; orient, const Ogre::Vector3&amp; pos, int threadindex )
 {
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
 	RagDoll::RagBone* bone = Ogre::any_cast&lt;RagDoll::RagBone*&gt;(me-&gt;getUserData());
 #else
 	RagDoll::RagBone* bone = (RagDoll::RagBone*)me-&gt;getUserData();

Modified: dependencies/OgreNewt/inc/OgreNewt.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt.h	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/inc/OgreNewt.h	2009-05-18 16:41:56 UTC (rev 4926)
@@ -70,8 +70,8 @@
 
     New in this version
         - this version uses cmake &gt; 2.6.2!
-        - shared pointers for collisions, in order to use shared pointers define OGRENEWT_COLLISION_USE_SHAREDPTR
-        - support for Ogre::Any instead of void* as userdata, in order to use it, define OGRENEWT_USE_OGRE_ANY
+        - shared pointers for collisions, if you don't want to use shared pointers define OGRENEWT_NO_COLLISION_SHAREDPTR
+        - uses Ogre::Any instead of void* as userdata, if you want to use void* define OGRENEWT_NO_OGRE_ANY
         - several interface-breaking changes:
             - the ContactCallback passes a ContactJoint as argument that can be used to iterate through all contacts
               (the callback is not called for each contact any more, but for each pair of colliding bodies!)

Modified: dependencies/OgreNewt/inc/OgreNewt_Body.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Body.h	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/inc/OgreNewt_Body.h	2009-05-18 16:41:56 UTC (rev 4926)
@@ -87,14 +87,14 @@
         you can use this to store a pointer to a parent class, etc.  then inside one of the many callbacks, you can get the pointer
         using this &quot;userData&quot; system.
     */
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
     void setUserData( const Ogre::Any&amp; data ) { m_userdata = data; }
 #else
     void setUserData( void* data ) { m_userdata = data; }
 #endif
 
     //! retrieve pointer to previously set user data.
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
     const Ogre::Any&amp; getUserData() const { return m_userdata; }
 #else
     void* getUserData() const { return m_userdata; }
@@ -416,7 +416,7 @@
     const MaterialID*               m_matid;
     const World*                    m_world;
     
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
     Ogre::Any                       m_userdata;
 #else
     void*                           m_userdata;

Modified: dependencies/OgreNewt/inc/OgreNewt_Collision.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Collision.h	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/inc/OgreNewt_Collision.h	2009-05-18 16:41:56 UTC (rev 4926)
@@ -133,12 +133,12 @@
 };
 
 
-#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
+typedef Collision* CollisionPtr;
+typedef ConvexCollision* ConvexCollisionPtr;
+#else
 typedef boost::shared_ptr&lt;Collision&gt; CollisionPtr;
 typedef boost::shared_ptr&lt;ConvexCollision&gt; ConvexCollisionPtr;
-#else
-typedef Collision* CollisionPtr;
-typedef ConvexCollision* ConvexCollisionPtr;
 #endif
 
 

Modified: dependencies/OgreNewt/inc/OgreNewt_CollisionPrimitives.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_CollisionPrimitives.h	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/inc/OgreNewt_CollisionPrimitives.h	2009-05-18 16:41:56 UTC (rev 4926)
@@ -264,7 +264,7 @@
             /*!
                 Create a tree collision object.
                 \param world pointer to the OgreNewt::World
-                \param node pointer to an Ogre::SceneNode with a single entity attached.
+                \param ent pointer to an Ogre::Entitiy, if it is attached to a node, the scale of the parent node is used
                 \param optimize bool whether you want to optimize the collision or not.
             */
             TreeCollision( const World* world, Ogre::Entity* ent, bool optimize, FaceWinding fw = FW_DEFAULT );

Modified: dependencies/OgreNewt/inc/OgreNewt_Debugger.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Debugger.h	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/inc/OgreNewt_Debugger.h	2009-05-18 16:41:56 UTC (rev 4926)
@@ -114,7 +114,7 @@
         struct BodyDebugData
         {
             BodyDebugData() :
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
                 m_lastcol(NULL),
 #endif
                 m_node(NULL), m_lines(NULL), m_text(NULL), m_updated(false) {}

Modified: dependencies/OgreNewt/inc/OgreNewt_Joint.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Joint.h	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/inc/OgreNewt_Joint.h	2009-05-18 16:41:56 UTC (rev 4926)
@@ -69,7 +69,7 @@
     /*!
         user data can be used to connect this class to other user classes through the use of this general pointer.
     */
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
     void setUserData( const Ogre::Any&amp; data ) { m_userdata = data; }
 #else
     void setUserData( void* data ) { m_userdata = data; }
@@ -79,7 +79,7 @@
     /*!
         user data can be used to connect this class to other user classes through the use of this general pointer.
     */
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
     const Ogre::Any&amp; getUserData() const { return m_userdata; }
 #else
     void* getUserData() const { return m_userdata; }
@@ -92,7 +92,7 @@
     const OgreNewt::World* m_world;
 
 
-#ifdef OGRENEWT_USE_OGRE_ANY
+#ifndef OGRENEWT_NO_OGRE_ANY
     Ogre::Any                       m_userdata;
 #else
     void*                           m_userdata;

Modified: dependencies/OgreNewt/inc/OgreNewt_MaterialID.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_MaterialID.h	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/inc/OgreNewt_MaterialID.h	2009-05-18 16:41:56 UTC (rev 4926)
@@ -31,11 +31,6 @@
     */
     MaterialID( const World* world );
 
-    /*!
-        Overloaded constructor, sets the internal ID manually.  should not be used by the end-user.
-    */
-    MaterialID( const World* world, int ID );
-
     //! destructor
     ~MaterialID();
 
@@ -44,6 +39,14 @@
 
 protected:
 
+    friend class OgreNewt::World;
+
+    /*!
+        Overloaded constructor, sets the internal ID manually.  should not be used by the end-user.
+    */
+    MaterialID( const World* world, int ID );
+
+private:
     int id;
     const OgreNewt::World* m_world;
 

Modified: dependencies/OgreNewt/inc/OgreNewt_Prerequisites.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Prerequisites.h	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/inc/OgreNewt_Prerequisites.h	2009-05-18 16:41:56 UTC (rev 4926)
@@ -22,10 +22,7 @@
 #   include &lt;Ogre/OgreRenderable.h&gt;
 #   include &lt;Ogre/OgreNode.h&gt;
 #   include &lt;Ogre/OgreFrameListener.h&gt;
-#   ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
-//#       include &lt;Ogre/OgreSharedPtr.h&gt;
-#   endif
-#   ifdef OGRENEWT_USE_OGRE_ANY
+#   ifndef OGRENEWT_NO_OGRE_ANY
 #       include &lt;Ogre/OgreAny.h&gt;
 #   endif
 #else
@@ -35,10 +32,7 @@
 #include &lt;OgreRenderable.h&gt;
 #include &lt;OgreNode.h&gt;
 #include &lt;OgreFrameListener.h&gt;
-#   ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
-//#       include &lt;OgreSharedPtr.h&gt;
-#   endif
-#   ifdef OGRENEWT_USE_OGRE_ANY
+#   ifndef OGRENEWT_NO_OGRE_ANY
 #       include &lt;OgreAny.h&gt;
 #   endif
 #endif
@@ -46,7 +40,7 @@
 #include &lt;Newton.h&gt;
 #include &lt;boost/function.hpp&gt;
 #include &lt;boost/bind.hpp&gt;
-#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifndef OGRENEWT_NO_COLLISION_SHAREDPTR
 #   include &lt;boost/shared_ptr.hpp&gt;
 #endif
 
@@ -65,12 +59,12 @@
 #endif
 
 
-#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
-#warning &quot;the option OGRENEWT_COLLISION_USE_SHAREDPTR is set&quot;
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
+#warning &quot;the option OGRENEWT_NO_COLLISION_SHAREDPTR is set&quot;
 #endif
 
-#ifdef OGRENEWT_USE_OGRE_ANY
-#warning &quot;the option OGRENEWT_USE_OGRE_ANY is set&quot;
+#ifdef OGRENEWT_NO_OGRE_ANY
+#warning &quot;the option OGRENEWT_NO_OGRE_ANY is set&quot;
 #endif
 
 namespace OgreNewt

Modified: dependencies/OgreNewt/inc/OgreNewt_Tools.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Tools.h	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/inc/OgreNewt_Tools.h	2009-05-18 16:41:56 UTC (rev 4926)
@@ -187,9 +187,7 @@
             */
 
 
-            using namespace Ogre;
-
-            class MovableText : public MovableObject, public Renderable
+            class _OgreNewtExport MovableText : public Ogre::MovableObject, public Ogre::Renderable
             {
                 /******************************** MovableText data ****************************/
             public:
@@ -197,64 +195,64 @@
                 enum VerticalAlignment      {V_BELOW, V_ABOVE, V_CENTER};
             
             protected:
-                String          mFontName;
-                String          mType;
-                String          mName;
-                String          mCaption;
+                Ogre::String          mFontName;
+                Ogre::String          mType;
+                Ogre::String          mName;
+                Ogre::String          mCaption;
                 HorizontalAlignment mHorizontalAlignment;
                 VerticalAlignment   mVerticalAlignment;
             
-                ColourValue     mColor;
-                RenderOperation mRenderOp;
-                AxisAlignedBox  mAABB;
-                LightList       mLList;
+                Ogre::ColourValue     mColor;
+                Ogre::RenderOperation mRenderOp;
+                Ogre::AxisAlignedBox  mAABB;
+                Ogre::LightList       mLList;
             
-                Real            mCharHeight;
-                Real            mSpaceWidth;
+                Ogre::Real            mCharHeight;
+                Ogre::Real            mSpaceWidth;
             
                 bool            mNeedUpdate;
                 bool            mUpdateColors;
                 bool            mOnTop;
             
-                Real            mTimeUntilNextToggle;
-                Real            mRadius;
+                Ogre::Real            mTimeUntilNextToggle;
+                Ogre::Real            mRadius;
             
-                Vector3            mGlobalTranslation;
-                Vector3            mLocalTranslation;
+                Ogre::Vector3            mGlobalTranslation;
+                Ogre::Vector3            mLocalTranslation;
             
-                Camera          *mpCam;
-                RenderWindow    *mpWin;
-                Font            *mpFont;
-                MaterialPtr     mpMaterial;
-                MaterialPtr     mpBackgroundMaterial;
+                Ogre::Camera          *mpCam;
+                Ogre::RenderWindow    *mpWin;
+                Ogre::Font            *mpFont;
+                Ogre::MaterialPtr     mpMaterial;
+                Ogre::MaterialPtr     mpBackgroundMaterial;
             
                 /******************************** public methods ******************************/
             public:
-                MovableText(const String &amp;name, const String &amp;caption, const String &amp;fontName, Real charHeight, const ColourValue &amp;color = ColourValue::White);
+                MovableText(const Ogre::String &amp;name, const Ogre::String &amp;caption, const Ogre::String &amp;fontName, Ogre::Real charHeight, const Ogre::ColourValue &amp;color = Ogre::ColourValue::White);
                 virtual ~MovableText();
             
                 // Set settings
-                void    setFontName(const String &amp;fontName);
-                void    setCaption(const String &amp;caption);
-                void    setColor(const ColourValue &amp;color);
-                void    setCharacterHeight(Real height);
-                void    setSpaceWidth(Real width);
+                void    setFontName(const Ogre::String &amp;fontName);
+                void    setCaption(const Ogre::String &amp;caption);
+                void    setColor(const Ogre::ColourValue &amp;color);
+                void    setCharacterHeight(Ogre::Real height);
+                void    setSpaceWidth(Ogre::Real width);
                 void    setTextAlignment(const HorizontalAlignment&amp; horizontalAlignment, const VerticalAlignment&amp; verticalAlignment);
-                void    setGlobalTranslation( Vector3 trans );
-                void    setLocalTranslation( Vector3 trans );
+                void    setGlobalTranslation( Ogre::Vector3 trans );
+                void    setLocalTranslation( Ogre::Vector3 trans );
                 void    showOnTop(bool show=true);
             
                 // Get settings
-                const   String          &amp;getFontName() const {return mFontName;}
-                const   String          &amp;getCaption() const {return mCaption;}
-                const   ColourValue     &amp;getColor() const {return mColor;}
+                const   Ogre::String          &amp;getFontName() const {return mFontName;}
+                const   Ogre::String          &amp;getCaption() const {return mCaption;}
+                const   Ogre::ColourValue     &amp;getColor() const {return mColor;}
                 
-                Real    getCharacterHeight() const {return mCharHeight;}
-                Real    getSpaceWidth() const {return mSpaceWidth;}
-                Vector3    getGlobalTranslation() const {return mGlobalTranslation;}
-                Vector3    getLocalTranslation() const {return mLocalTranslation;}
+                Ogre::Real    getCharacterHeight() const {return mCharHeight;}
+                Ogre::Real    getSpaceWidth() const {return mSpaceWidth;}
+                Ogre::Vector3    getGlobalTranslation() const {return mGlobalTranslation;}
+                Ogre::Vector3    getLocalTranslation() const {return mLocalTranslation;}
                 bool    getShowOnTop() const {return mOnTop;}
-                AxisAlignedBox          GetAABB(void) { return mAABB; }
+                Ogre::AxisAlignedBox          GetAABB(void) { return mAABB; }
             
                 /******************************** protected methods and overload **************/
             protected:
@@ -264,23 +262,23 @@
                 void    _updateColors();
             
                 // from MovableObject
-                void    getWorldTransforms(Matrix4 *xform) const;
-                Real    getBoundingRadius(void) const {return mRadius;};
-                Real    getSquaredViewDepth(const Camera *cam) const {return 0;};
+                void    getWorldTransforms(Ogre::Matrix4 *xform) const;
+                Ogre::Real    getBoundingRadius(void) const {return mRadius;};
+                Ogre::Real    getSquaredViewDepth(const Ogre::Camera *cam) const {return 0;};
                 void visitRenderables(Ogre::Renderable::Visitor* visitor,  bool debugRenderables = false);
-                const   Quaternion        &amp;getWorldOrientation(void) const;
-                const   Vector3           &amp;getWorldPosition(void) const;
-                const   AxisAlignedBox    &amp;getBoundingBox(void) const {return mAABB;};
-                const   String            &amp;getName(void) const {return mName;};
-                const   String            &amp;getMovableType(void) const {static Ogre::String movType = &quot;MovableText&quot;; return movType;};
+                const   Ogre::Quaternion        &amp;getWorldOrientation(void) const;
+                const   Ogre::Vector3           &amp;getWorldPosition(void) const;
+                const   Ogre::AxisAlignedBox    &amp;getBoundingBox(void) const {return mAABB;};
+                const   Ogre::String            &amp;getName(void) const {return mName;};
+                const   Ogre::String            &amp;getMovableType(void) const {static Ogre::String movType = &quot;MovableText&quot;; return movType;};
             
-                void    _notifyCurrentCamera(Camera *cam);
-                void    _updateRenderQueue(RenderQueue* queue);
+                void    _notifyCurrentCamera(Ogre::Camera *cam);
+                void    _updateRenderQueue(Ogre::RenderQueue* queue);
             
                 // from renderable
-                void    getRenderOperation(RenderOperation &amp;op);
-                const   MaterialPtr       &amp;getMaterial(void) const {assert(!mpMaterial.isNull());return mpMaterial;};
-                const   LightList         &amp;getLights(void) const {return mLList;};
+                void    getRenderOperation(Ogre::RenderOperation &amp;op);
+                const   Ogre::MaterialPtr       &amp;getMaterial(void) const {assert(!mpMaterial.isNull());return mpMaterial;};
+                const   Ogre::LightList         &amp;getLights(void) const {return mLList;};
             };
 
         }

Modified: dependencies/OgreNewt/src/OgreNewt_Body.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_Body.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/src/OgreNewt_Body.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -4,6 +4,7 @@
 #include &quot;OgreNewt_Tools.h&quot;
 
 
+
 namespace OgreNewt
 {
 
@@ -99,8 +100,19 @@
 
 void Body::standardTransformCallback( OgreNewt::Body* me, const Ogre::Quaternion&amp; orient, const Ogre::Vector3&amp; pos, int threadIndex )
 {
-    me-&gt;m_node-&gt;setOrientation( orient );
-    me-&gt;m_node-&gt;setPosition( pos );
+    if( me-&gt;m_node-&gt;getParent() )
+    {
+        Ogre::Quaternion invParentOri = me-&gt;m_node-&gt;getParent()-&gt;_getDerivedOrientation().Inverse();
+        Ogre::Vector3 parentPos = me-&gt;m_node-&gt;getParent()-&gt;_getDerivedPosition();
+
+        me-&gt;m_node-&gt;setOrientation( invParentOri*orient );
+        me-&gt;m_node-&gt;setPosition( invParentOri*(pos - parentPos) );
+    }
+    else
+    {
+        me-&gt;m_node-&gt;setOrientation( orient );
+        me-&gt;m_node-&gt;setPosition( pos );
+    }
 }
 
 
@@ -154,8 +166,19 @@
 
         if (m_node)
         {
-            m_node-&gt;setOrientation( orient );
-            m_node-&gt;setPosition( pos );
+            if( me-&gt;m_node-&gt;getParent() )
+            {
+                Ogre::Quaternion invParentOri = me-&gt;m_node-&gt;getParent()-&gt;_getDerivedOrientation().Inverse();
+                Ogre::Vector3 parentPos = me-&gt;m_node-&gt;getParent()-&gt;_getDerivedPosition();
+
+                me-&gt;m_node-&gt;setOrientation( invParentOri*orient );
+                me-&gt;m_node-&gt;setPosition( invParentOri*(pos - parentPos) );
+            }
+            else
+            {
+                me-&gt;m_node-&gt;setOrientation( orient );
+                me-&gt;m_node-&gt;setPosition( pos );
+            }
         }
     }
 }

Modified: dependencies/OgreNewt/src/OgreNewt_Collision.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_Collision.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/src/OgreNewt_Collision.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -3,6 +3,7 @@
 #include &quot;OgreNewt_Tools.h&quot;
 
 
+
 namespace OgreNewt
 {
 
@@ -14,8 +15,10 @@
 
 Collision::~Collision()
 {
-    if (m_world-&gt;getNewtonWorld())
+    if (m_world-&gt;getNewtonWorld() &amp;&amp; m_col)
+    {
         NewtonReleaseCollision( m_world-&gt;getNewtonWorld(), m_col );
+    }
 }
 
 

Modified: dependencies/OgreNewt/src/OgreNewt_PlayerController.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_PlayerController.cpp	2009-05-17 18:19:36 UTC (rev 4925)
+++ dependencies/OgreNewt/src/OgreNewt_PlayerController.cpp	2009-05-18 16:41:56 UTC (rev 4926)
@@ -40,7 +40,7 @@
     m_floorFinderRadiusFactor = 1.0f;
     m_maxPlayerHeightPaddFactor = 0.01f;
     m_sensorShapeSegments = 32;
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
     m_verticalSensorShape = NULL;
     m_horizontalSensorShape = NULL;
     m_dynamicsSensorShape = NULL;
@@ -52,7 +52,7 @@
 
 PlayerController::~PlayerController()
 {
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
     if( m_verticalSensorShape )
         delete m_verticalSensorShape;
     if( m_horizontalSensorShape )
@@ -86,7 +86,7 @@
         abs( newSensorHeight - m_lastSensorHeight ) &gt; 0.04f ||
         abs( newPlayerRadius - m_lastPlayerRadius ) &gt; 0.04f )
     {
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+#ifdef OGRENEWT_NO_COLLISION_SHAREDPTR
         // delete old ones
         if( m_verticalSensorShape )
             delete m_verticalSensorShape;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001981.html">[Dsa-hl-svn] r4925 - rl/trunk/engine/ui/src
</A></li>
	<LI>Next message: <A HREF="001983.html">[Dsa-hl-svn] r4927 - in rl/trunk/engine: core/include core/src	rules/src ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1982">[ date ]</a>
              <a href="thread.html#1982">[ thread ]</a>
              <a href="subject.html#1982">[ subject ]</a>
              <a href="author.html#1982">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
