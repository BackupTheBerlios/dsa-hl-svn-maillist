<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4940 - in rl/branches/persistence2:	editors/Lockenwickler editors/Lockenwickler/src	editors/Lockenwickler/src/media editors/Lockenwickler/src/media/help	editors/Lockenwickler/src/media/icons	editors/Lockenwickler/src/media/terrain	editors/Lockenwickler/src/media/terrain/brushes	editors/Lockenwickler/ui files engine/ai/include	engine/ai/src engine/core engine/core/include engine/core/src	engine/rules/include engine/rules/src engine/script/src	engine/script/swig engine/ui/include engine/ui/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2009-May/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4940%20-%20in%20rl/branches/persistence2%3A%0A%09editors/Lockenwickler%20editors/Lockenwickler/src%0A%09editors/Lockenwickler/src/media%20editors/Lockenwickler/src/media/help%0A%09editors/Lockenwickler/src/media/icons%0A%09editors/Lockenwickler/src/media/terrain%0A%09editors/Lockenwickler/src/media/terrain/brushes%0A%09editors/Lockenwickler/ui%20files%20engine/ai/include%0A%09engine/ai/src%20engine/core%20engine/core/include%20engine/core/src%0A%09engine/rules/include%20engine/rules/src%20engine/script/src%0A%09engine/script/swig%20engine/ui/include%20engine/ui/src&In-Reply-To=%3C200905222219.n4MMJCPq032693%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001995.html">
   <LINK REL="Next"  HREF="001997.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4940 - in rl/branches/persistence2:	editors/Lockenwickler editors/Lockenwickler/src	editors/Lockenwickler/src/media editors/Lockenwickler/src/media/help	editors/Lockenwickler/src/media/icons	editors/Lockenwickler/src/media/terrain	editors/Lockenwickler/src/media/terrain/brushes	editors/Lockenwickler/ui files engine/ai/include	engine/ai/src engine/core engine/core/include engine/core/src	engine/rules/include engine/rules/src engine/script/src	engine/script/swig engine/ui/include engine/ui/src</H1>
    <B>timm at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4940%20-%20in%20rl/branches/persistence2%3A%0A%09editors/Lockenwickler%20editors/Lockenwickler/src%0A%09editors/Lockenwickler/src/media%20editors/Lockenwickler/src/media/help%0A%09editors/Lockenwickler/src/media/icons%0A%09editors/Lockenwickler/src/media/terrain%0A%09editors/Lockenwickler/src/media/terrain/brushes%0A%09editors/Lockenwickler/ui%20files%20engine/ai/include%0A%09engine/ai/src%20engine/core%20engine/core/include%20engine/core/src%0A%09engine/rules/include%20engine/rules/src%20engine/script/src%0A%09engine/script/swig%20engine/ui/include%20engine/ui/src&In-Reply-To=%3C200905222219.n4MMJCPq032693%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4940 - in rl/branches/persistence2:	editors/Lockenwickler editors/Lockenwickler/src	editors/Lockenwickler/src/media editors/Lockenwickler/src/media/help	editors/Lockenwickler/src/media/icons	editors/Lockenwickler/src/media/terrain	editors/Lockenwickler/src/media/terrain/brushes	editors/Lockenwickler/ui files engine/ai/include	engine/ai/src engine/core engine/core/include engine/core/src	engine/rules/include engine/rules/src engine/script/src	engine/script/swig engine/ui/include engine/ui/src">timm at mail.berlios.de
       </A><BR>
    <I>Sat May 23 00:19:12 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001995.html">[Dsa-hl-svn] r4939 - rl/trunk/engine/core
</A></li>
        <LI>Next message: <A HREF="001997.html">[Dsa-hl-svn] r4941 - in rl/trunk: Mac/Rastullah.xcodeproj	engine/core/include engine/core/src engine/ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1996">[ date ]</a>
              <a href="thread.html#1996">[ thread ]</a>
              <a href="subject.html#1996">[ subject ]</a>
              <a href="author.html#1996">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: timm
Date: 2009-05-23 00:18:33 +0200 (Sat, 23 May 2009)
New Revision: 4940

Added:
   rl/branches/persistence2/editors/Lockenwickler/src/AddTriggerDialog.py
   rl/branches/persistence2/editors/Lockenwickler/src/GlobDirectoryWalker.py
   rl/branches/persistence2/editors/Lockenwickler/src/MyTerrainManager.py
   rl/branches/persistence2/editors/Lockenwickler/src/TriggerManager.py
   rl/branches/persistence2/editors/Lockenwickler/src/Ui_AddTriggerDialog.py
   rl/branches/persistence2/editors/Lockenwickler/src/Ui_MyTerrainManagerDock.py
   rl/branches/persistence2/editors/Lockenwickler/src/help_rc.py
   rl/branches/persistence2/editors/Lockenwickler/src/icons_rc.py
   rl/branches/persistence2/editors/Lockenwickler/src/media/help/
   rl/branches/persistence2/editors/Lockenwickler/src/media/help/TerrainExtends1.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/help/help.qrc
   rl/branches/persistence2/editors/Lockenwickler/src/media/help/help_rc.py
   rl/branches/persistence2/editors/Lockenwickler/src/media/icons/icons.qrc
   rl/branches/persistence2/editors/Lockenwickler/src/media/icons/terrain.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/icons/terrain_small.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETShader.program
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETTerrain.material
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETcoverage.0.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETcoverage.1.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETlightmap.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETterrain.cfg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETterrain.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSLighting.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat2.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph2.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/brushes/
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/brushes/brush.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting0.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting1.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting2.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting3.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting4.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting5.png
   rl/branches/persistence2/editors/Lockenwickler/ui files/AddTriggerDialog.ui
   rl/branches/persistence2/editors/Lockenwickler/ui files/BrushDialog.ui
   rl/branches/persistence2/editors/Lockenwickler/ui files/MyTerrainManagerDock.ui
   rl/branches/persistence2/engine/core/include/PhysicsCollisionFactory.h
   rl/branches/persistence2/engine/core/src/PhysicsCollisionFactory.cpp
Removed:
   rl/branches/persistence2/editors/Lockenwickler/src/media/help/TerrainExtends1.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/help/help.qrc
   rl/branches/persistence2/editors/Lockenwickler/src/media/help/help_rc.py
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETShader.program
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETTerrain.material
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETcoverage.0.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETcoverage.1.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETlightmap.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETterrain.cfg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETterrain.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSLighting.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat2.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph2.cg
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/brushes/
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/brushes/brush.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting0.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting1.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting2.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting3.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting4.png
   rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting5.png
Modified:
   rl/branches/persistence2/editors/Lockenwickler/Lockenwickler.e4p
   rl/branches/persistence2/editors/Lockenwickler/src/
   rl/branches/persistence2/editors/Lockenwickler/src/GOGenericEditor.py
   rl/branches/persistence2/editors/Lockenwickler/src/GameObjectClass.py
   rl/branches/persistence2/editors/Lockenwickler/src/Lockenwickler.py
   rl/branches/persistence2/editors/Lockenwickler/src/ModuleExplorer.py
   rl/branches/persistence2/editors/Lockenwickler/src/ModuleManager.py
   rl/branches/persistence2/editors/Lockenwickler/src/MovePivot.py
   rl/branches/persistence2/editors/Lockenwickler/src/OgreMainWindow.py
   rl/branches/persistence2/editors/Lockenwickler/src/PreferencesDialog.py
   rl/branches/persistence2/editors/Lockenwickler/src/SelectionBuffer.py
   rl/branches/persistence2/editors/Lockenwickler/src/ZoneManager.py
   rl/branches/persistence2/editors/Lockenwickler/src/media/
   rl/branches/persistence2/engine/ai/include/Dialog.h
   rl/branches/persistence2/engine/ai/include/DialogLoader.h
   rl/branches/persistence2/engine/ai/include/DialogLoaderImpl.h
   rl/branches/persistence2/engine/ai/include/DialogManager.h
   rl/branches/persistence2/engine/ai/include/DialogParagraph.h
   rl/branches/persistence2/engine/ai/src/Dialog.cpp
   rl/branches/persistence2/engine/ai/src/DialogLoader.cpp
   rl/branches/persistence2/engine/ai/src/DialogLoaderImpl.cpp
   rl/branches/persistence2/engine/ai/src/DialogManager.cpp
   rl/branches/persistence2/engine/ai/src/DialogParagraph.cpp
   rl/branches/persistence2/engine/core/CMakeLists.txt
   rl/branches/persistence2/engine/core/RlCore2005.vcproj
   rl/branches/persistence2/engine/core/RlCore2008.vcproj
   rl/branches/persistence2/engine/core/include/PhysicsManager.h
   rl/branches/persistence2/engine/core/src/ConfigurationManager.cpp
   rl/branches/persistence2/engine/core/src/GameAreaTypes.cpp
   rl/branches/persistence2/engine/core/src/GameEventManager.cpp
   rl/branches/persistence2/engine/core/src/PhysicalThing.cpp
   rl/branches/persistence2/engine/core/src/PhysicsGenericContactCallback.cpp
   rl/branches/persistence2/engine/core/src/PhysicsManager.cpp
   rl/branches/persistence2/engine/core/src/PhysicsRagDoll.cpp
   rl/branches/persistence2/engine/core/src/PlayAnimationJob.cpp
   rl/branches/persistence2/engine/core/src/SceneQuery.cpp
   rl/branches/persistence2/engine/rules/include/GoToJob.h
   rl/branches/persistence2/engine/rules/src/CreatureControllerManager.cpp
   rl/branches/persistence2/engine/rules/src/GoToJob.cpp
   rl/branches/persistence2/engine/rules/src/SelectionHelper.cpp
   rl/branches/persistence2/engine/script/src/EntityNodeProcessor.cpp
   rl/branches/persistence2/engine/script/src/PlaneNodeProcessor.cpp
   rl/branches/persistence2/engine/script/swig/RlAi.swig
   rl/branches/persistence2/engine/script/swig/RlCore.swig
   rl/branches/persistence2/engine/script/swig/RlRules.swig
   rl/branches/persistence2/engine/ui/include/CommandMapper.h
   rl/branches/persistence2/engine/ui/include/DialogControlState.h
   rl/branches/persistence2/engine/ui/include/DialogController.h
   rl/branches/persistence2/engine/ui/include/MovementControlState.h
   rl/branches/persistence2/engine/ui/src/CommandMapper.cpp
   rl/branches/persistence2/engine/ui/src/DialogControlState.cpp
   rl/branches/persistence2/engine/ui/src/ItemDragContainer.cpp
   rl/branches/persistence2/engine/ui/src/MovementControlState.cpp
Log:
merged from trunk and made it compile

Modified: rl/branches/persistence2/editors/Lockenwickler/Lockenwickler.e4p
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/Lockenwickler.e4p	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/Lockenwickler.e4p	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,7 +1,7 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
 &lt;!DOCTYPE Project SYSTEM &quot;Project-4.6.dtd&quot;&gt;
 &lt;!-- eric4 project file for project Lockenwickler --&gt;
-&lt;!-- Saved: 2009-04-10, 16:03:00 --&gt;
+&lt;!-- Saved: 2009-05-09, 21:08:47 --&gt;
 &lt;!-- Copyright (C) 2009 Stefan Stammberger, <A HREF="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">sstammberger at web.de</A> --&gt;
 &lt;Project version=&quot;4.6&quot;&gt;
   &lt;Language&gt;en&lt;/Language&gt;
@@ -41,15 +41,33 @@
     &lt;Source&gt;src/DepthBuffer.py&lt;/Source&gt;
     &lt;Source&gt;src/ZoneManager.py&lt;/Source&gt;
     &lt;Source&gt;src/GOGenericEditor.py&lt;/Source&gt;
+    &lt;Source&gt;src/ModuleDirectoryView.py&lt;/Source&gt;
+    &lt;Source&gt;src/TriggerManager.py&lt;/Source&gt;
+    &lt;Source&gt;src/GlobDirectoryWalker.py&lt;/Source&gt;
+    &lt;Source&gt;ui files/Ui_GOPropertyEditorDialogINT.py&lt;/Source&gt;
+    &lt;Source&gt;ui files/Ui_GOPropertyEditorDialogSTRING.py&lt;/Source&gt;
+    &lt;Source&gt;ui files/Ui_NewModuleWizard.py&lt;/Source&gt;
+    &lt;Source&gt;src/AddTriggerDialog.py&lt;/Source&gt;
+    &lt;Source&gt;src/Ui_AddTriggerDialog.py&lt;/Source&gt;
+    &lt;Source&gt;src/MyTerrainManager.py&lt;/Source&gt;
+    &lt;Source&gt;src/Ui_MyTerrainManagerDock.py&lt;/Source&gt;
+    &lt;Source&gt;src/media/help/help_rc.py&lt;/Source&gt;
+    &lt;Source&gt;ui files/Ui_BrushDialog.py&lt;/Source&gt;
+    &lt;Source&gt;ui files/Ui_MyTerrainManagerDock.py&lt;/Source&gt;
   &lt;/Sources&gt;
   &lt;Forms&gt;
     &lt;Form&gt;ui files/GOPropertyEditorDialogINT.ui&lt;/Form&gt;
     &lt;Form&gt;ui files/GOPropertyEditorDialogSTRING.ui&lt;/Form&gt;
     &lt;Form&gt;ui files/NewModuleWizard.ui&lt;/Form&gt;
+    &lt;Form&gt;ui files/AddTriggerDialog.ui&lt;/Form&gt;
+    &lt;Form&gt;ui files/MyTerrainManagerDock.ui&lt;/Form&gt;
+    &lt;Form&gt;ui files/BrushDialog.ui&lt;/Form&gt;
   &lt;/Forms&gt;
   &lt;Translations&gt;
   &lt;/Translations&gt;
   &lt;Resources&gt;
+    &lt;Resource&gt;src/media/help/help.qrc&lt;/Resource&gt;
+    &lt;Resource&gt;src/media/icons/icons.qrc&lt;/Resource&gt;
   &lt;/Resources&gt;
   &lt;Interfaces&gt;
   &lt;/Interfaces&gt;


Property changes on: rl/branches/persistence2/editors/Lockenwickler/src
___________________________________________________________________
Name: svn:ignore
   - ogre.cfg
SelectionBuffer - Kopie.py

   + ogre.cfg
SelectionBuffer - Kopie.py
ogre.log
depthbuffer.png


Copied: rl/branches/persistence2/editors/Lockenwickler/src/AddTriggerDialog.py (from rev 4939, rl/trunk/editors/Lockenwickler/src/AddTriggerDialog.py)

Modified: rl/branches/persistence2/editors/Lockenwickler/src/GOGenericEditor.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/GOGenericEditor.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/GOGenericEditor.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -84,7 +84,7 @@
             
         self.layout.addWidget(self.typeDropBox)
         
-        self.connect(self, SIGNAL(&quot;currentIndexChanged ( const QString &amp; text )&quot;), self.onTypeChanged)
+        self.connect(self, SIGNAL(&quot;currentIndexChanged ( const QString &amp;)&quot;), self.onTypeChanged)
 
     def onTypeChanged(self, type):
         print str(type)

Modified: rl/branches/persistence2/editors/Lockenwickler/src/GameObjectClass.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/GameObjectClass.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/GameObjectClass.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,4 +1,4 @@
- #################################################
+#################################################
 # This source file is part of Rastullahs Lockenwickler.
 # Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
 #
@@ -15,7 +15,7 @@
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
+#################################################
 
 #from elementtree.ElementTree import *
 from xml.etree.cElementTree import *
@@ -147,9 +147,44 @@
             rep.name = str(self.editor.nameEditBox.text())
             rep.type = str(self.editor.typeDropBox.currentText())
             
-            if rep.type == &quot;STRING&quot; or rep.type == &quot;BOOL&quot; or rep.type == &quot;REAL&quot; or rep.type == &quot;INT&quot;:
+            if rep.type == &quot;STRING&quot;:
                 rep.data = str(self.editor.dataEditBox.text())
-            
+            elif rep.type == &quot;BOOL&quot;:
+                text = str(self.editor.dataEditBox.text())
+                if text == &quot;True&quot; or text == &quot;1&quot; or text == &quot;true&quot;:
+                    rep.data = &quot;True&quot;
+                elif text == &quot;False&quot; or text == &quot;0&quot; or text == &quot;false&quot;:
+                    rep.data = &quot;False&quot;
+                else:
+                    reply = QMessageBox.question(QApplication.focusWidget(), &quot;Try again?&quot;, &quot;Data is not a BOOL&quot; , QMessageBox.Yes|QMessageBox.No)
+                    if reply == QMessageBox.Yes:
+                        self.addProperty(True)
+                        return
+                    elif reply == QMessageBox.No:
+                        return
+            elif rep.type == &quot;REAL&quot;:
+                try:
+                     rep.data = str(float(self.editor.dataEditBox.text()))
+                except ValueError, e:
+                    reply = QMessageBox.question(QApplication.focusWidget(), &quot;Try again?&quot;, &quot;Data is not a REAL&quot; , QMessageBox.Yes|QMessageBox.No)
+                    if reply == QMessageBox.Yes:
+                        self.addProperty(True)
+                        print &quot;ValueError: &quot; + str(e)
+                        return
+                    elif reply == QMessageBox.No:
+                        return
+            elif rep.type == &quot;INT&quot;:
+                try:
+                     rep.data = str(int(self.editor.dataEditBox.text()))
+                except ValueError, e:
+                    reply = QMessageBox.question(QApplication.focusWidget(), &quot;Try again?&quot;, &quot;Data is not a INT&quot; , QMessageBox.Yes|QMessageBox.No)
+                    if reply == QMessageBox.Yes:
+                        self.addProperty(True)
+                        print &quot;ValueError: &quot; + str(e)
+                        return
+                    elif reply == QMessageBox.No:
+                        return
+                
             if rep.name in self.propertieDict:
                 reply = QMessageBox.question(QApplication.focusWidget(), &quot;Warning...&quot;, &quot;Replace the existing property?&quot; , QMessageBox.Yes|QMessageBox.No|QMessageBox.Cancel)
                 if reply == QMessageBox.Cancel:

Copied: rl/branches/persistence2/editors/Lockenwickler/src/GlobDirectoryWalker.py (from rev 4939, rl/trunk/editors/Lockenwickler/src/GlobDirectoryWalker.py)

Modified: rl/branches/persistence2/editors/Lockenwickler/src/Lockenwickler.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/Lockenwickler.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/Lockenwickler.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,551 +1,597 @@
-#################################################
-# This source file is part of Rastullahs Lockenwickler.
-# Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
-#
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
-# (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-#  but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
-
-import os
-import sys
-import platform
-import subprocess
-
-sys.path.insert(0,'..')
-import PythonOgreConfig
-
-from random import randint
-
-from PyQt4 import QtGui, QtCore
-from PreferencesDialog import *
-from ObjectPropertyWin import *
-from ModelSelectionDialog import *
-from MaterialSelectionDialog import *
-from GameObjectClassView import *
-from ConsoleWindow import *
-from ModuleManager import ModuleManager
-from ModuleExplorer import *
-from NewModuleWizard import *
-from MovePivot import *
-from PivotRenderQueueListener import *
-
-import OgreMainWindow
-import ogre.renderer.OGRE as og
-
-class Lockenwickler(QtGui.QMainWindow):
-    def __init__(self, parent=None):
-        QtGui.QWidget.__init__(self, parent)
-
-#        pixmap = QPixmap(&quot;media/icons/lockenwickler_provisorium.png&quot;)
-#        splash = QSplashScreen(pixmap, Qt.WindowStaysOnTopHint)
-#        splash.setMask(pixmap.mask())
-#        splash.showMessage(&quot;Starting...&quot;)
-#        splash.show() 
-
-        self.setupUi()
-
-        self.consoleWindow = ConsoleWindow(False,  self)
-
-        self.setupOgre()
-
-        self.prefDialog = PreferencesDialog(self)
-        self.objectPropertyWin = ObjectPropertyWin(self.OgreMainWinSceneMgr, self.gocManager, self)
-        self.moduleExplorerWin = ModuleExplorer(self)
-        self.modelSelectionDialog = ModelSelectionDialog(self.ogreRoot, self)
-        self.materialSelectionDialog = MaterialSelectionDialog(self.ogreRoot, self)
-        self.moduleManager.modelSelectionDialog = self.modelSelectionDialog
-        self.moduleManager.materialSelectionDialog = self.materialSelectionDialog
-
-        self.gameObjectClassView = GameObjectClassView(self.moduleManager.gocManager)
-
-        self.createDockWindows()
-
-        self.mainTimer = QtCore.QTimer(self)
-        self.mainTimer.connect(self.mainTimer, QtCore.SIGNAL(&quot;timeout()&quot;), self.update)
-        self.mainTimer.start(5)
-
-        settings = QtCore.QSettings()
-        self.restoreGeometry(settings.value(&quot;MainWindow/Geometry&quot;).toByteArray())
-        self.restoreState(settings.value(&quot;MainWindow/DockWindows&quot;).toByteArray())
-        if not self.prefDialog.setCfgPath(settings.value(&quot;Preferences/moduleCfgPath&quot;).toString()):
-            self.prefDialog.show()
-            self.moduleManager.moduleCfgPath = self.prefDialog.moduleCfgPath
-        else:
-            self.moduleManager.moduleCfgPath = self.prefDialog.moduleCfgPath
-        
-        self.moduleManager.setModuleExplorer(self.moduleExplorerWin)
-        self.moduleManager.setPropertyWindow(self.objectPropertyWin)
-        self.moduleManager.setContextMenuCallback(self.onContextMenuCallback)
-        
-        self.setWindowIcon(QIcon(&quot;media/icons/lockenwickler_provisorium_small.png&quot;))
-        self.setWindowTitle(&quot;Rastullahs Lockenwickler&quot;)
-        
-        self.editorSetupFinished = False
-        
-#        splash.finish(self)
-
-    def createAction(self, text, slot=None, shortcut=None, icon=None, tip=None, checkable=False, signal=&quot;triggered()&quot;):
-        action = QtGui.QAction(text, self)
-        if icon is not None:
-            action.setIcon(QtGui.QIcon(&quot;media/icons/%s&quot; % icon))
-        if shortcut is not None:
-            action.setShortcut(shortcut)
-        if tip is not None:
-            action.setToolTip(tip)
-            action.setStatusTip(tip)
-        if slot is not None:
-            self.connect(action, QtCore.SIGNAL(signal), slot)
-
-        action.setCheckable(checkable)
-
-        return action
-
-    def addActions(self, target, actions):
-        for act in actions:
-            if act is None:
-               target.addSeparator()
-            else:
-                target.addAction(act)
-
-    def setupUi(self):
-        self.setObjectName(&quot;MainWindow&quot;)
-
-        self.centralwidget = QtGui.QWidget(self)
-        self.centralwidget.setObjectName(&quot;centralwidget&quot;)
-
-        self.hboxlayout = QtGui.QHBoxLayout(self.centralwidget)
-        self.hboxlayout.setContentsMargins(0, 0, 0, 0)
-        self.hboxlayout.setObjectName(&quot;hboxlayout&quot;)
-
-        self.gridlayout = QtGui.QGridLayout()
-        self.gridlayout.setObjectName(&quot;gridlayout&quot;)
-        self.gridlayout.setContentsMargins(0, 0, 0, 0)
-        
-        self.menubar = QtGui.QMenuBar(self)
-        self.menubar.setObjectName(&quot;menubar&quot;)
-
-        self.menuFile = QtGui.QMenu(self.menubar)
-        self.menuFile.setObjectName(&quot;menuFile&quot;)
-
-        self.menuEdit = QtGui.QMenu(self.menubar)
-        self.menuEdit.setObjectName(&quot;menuEdit&quot;)
-
-        self.menuView = QtGui.QMenu(self.menubar)
-        self.menuView.setObjectName(&quot;menuView&quot;)
-        self.setMenuBar(self.menubar)
-
-
-        self.statusbar = QtGui.QStatusBar(self)
-        self.statusbar.setObjectName(&quot;statusbar&quot;)
-        self.setStatusBar(self.statusbar)
-
-#####################################
-        self.actionNeu =self.createAction(&quot;&amp;New Module&quot;,  self.actionNewSlot,  QKeySequence.New,  &quot;filenew.png&quot;,  &quot;New Module&quot;)
-        self.actionNeu.setObjectName(&quot;actionNeu&quot;)
-
-        self.actionOpen = self.createAction(&quot;&amp;Open Module&quot;,  self.actionOpenSlot,  QKeySequence.Open,  &quot;fileopen.png&quot;,  &quot;Open Module&quot;)
-        self.actionOpen.setObjectName(&quot;actionOpen&quot;)
-        
-        self.actionSave = self.createAction(&quot;&amp;Save&quot;,  self.actionSaveSlot,  QKeySequence.Save,  &quot;filesave.png&quot;,  &quot;Save Module&quot;)
-        self.actionSave.setObjectName(&quot;actionSave&quot;)
-        
-        self.actionRunModule = self.createAction(&quot;&amp;Save and Run&quot;,  self.actionRunModuleSlot,  &quot;Alt+R&quot;,  &quot;fileexport.png&quot;,  &quot;Save And Run Module&quot;)
-        self.actionRunModule.setObjectName(&quot;actionRunModule&quot;)
-
-        self.actionClose = self.createAction(&quot;Quit&quot;,  self.actionQuitSlot,  &quot;Alt+Q&quot;,  &quot;exit.png&quot;,  &quot;Quit&quot;)
-        self.actionClose.setObjectName(&quot;actionQuit&quot;)
-#####################################
-
-
-#####################################
-        self.actionDelete = self.createAction(&quot;Delete&quot;,  self.actionDeleteSlot,  QKeySequence.Delete,  &quot;editdelete.png&quot;,  &quot;Delete&quot;)
-        self.actionDelete.setObjectName(&quot;actionDelete&quot;)
-
-        self.actionCopy = self.createAction(&quot;Copy&quot;,  self.actionCopySlot,  QKeySequence.Copy,  &quot;editcopy.png&quot;,  &quot;Copy&quot;)
-        self.actionCopy.setObjectName(&quot;actionCopy&quot;)
-
-        self.actionCut = self.createAction(&quot;Cut&quot;,  self.actionCutSlot,  QKeySequence.Cut,  &quot;editcut.png&quot;,  &quot;Cut&quot;)
-        self.actionCut.setObjectName(&quot;actionCut&quot;)
-
-        self.actionPaste = self.createAction(&quot;Paste&quot;,  self.actionPasteSlot,  QKeySequence.Paste,  &quot;editpaste.png&quot;,  &quot;Paste&quot;)
-        self.actionPaste.setObjectName(&quot;actionPaste&quot;)
-
-        self.actionSelect = self.createAction(&quot;&amp;Select&quot;,  self.actionSelectSlot,  &quot;Space&quot;,  &quot;cursor.png&quot;,  &quot;Move selected object&quot;)
-        self.actionSelect.setObjectName(&quot;actionSelect&quot;)
-
-        self.actionMove = self.createAction(&quot;&amp;Move&quot;,  self.actionMoveSlot,  &quot;g&quot;,  &quot;move.png&quot;,  &quot;Move selected object&quot;)
-        self.actionMove.setObjectName(&quot;actionMove&quot;)
-
-        self.actionRotate = self.createAction(&quot;&amp;Rotate&quot;,  self.actionRotateSlot,  &quot;r&quot;,  &quot;rotate.png&quot;,  &quot;Rotate selected object&quot;)
-        self.actionRotate.setObjectName(&quot;actionRotate&quot;)
-
-        self.actionScale = self.createAction(&quot;&amp;Scale&quot;,  self.actionScaleSlot,  &quot;x&quot;,  &quot;resizecol.png&quot;,  &quot;Scale selected object&quot;)
-        self.actionScale.setObjectName(&quot;actionScale&quot;)
-
-        self.actionOneClickEntityPlacement = self.createAction(&quot;&amp;OneClickEntityPlacement&quot;,  self.actionOneClickEntityPlacementSlot,  &quot;&quot;,  &quot;resizecol.png&quot;,  &quot;Add an Entity just by a click&quot;)
-        self.actionOneClickEntityPlacement.setObjectName(&quot;actionOneClickEntityPlacement&quot;)
-        self.actionOneClickEntityPlacement.setCheckable(True)
-
-#####################################
-#####################################
-        self.actionSceneExplorer = self.createAction(&quot;&amp;Scene Exlporer&quot;,  self.toggleModuleExplorer,  &quot;Alt+E&quot;,  &quot;view_tree.png&quot;,  &quot;Module Explorer&quot;,  False)
-        self.actionSceneExplorer.setObjectName(&quot;actionSceneExplorer&quot;)
-        
-        self.actionPreferences = self.createAction(&quot;&amp;Preferences&quot;,  self.togglePreferencesWindow,  &quot;Alt+P&quot;,  &quot;configure.png&quot;,  &quot;Lockenwickler Preferences&quot;,  False)
-        self.actionPreferences.setObjectName(&quot;actionPreferences&quot;)
-
-        self.actionProperty_Window = self.createAction(&quot;Pr&amp;operty Window&quot;,  self.togglePropertyWindow,  &quot;Alt+P&quot;,  &quot;unsortedlist1.png&quot;,  &quot;Property Window&quot;)
-        self.actionProperty_Window.setObjectName(&quot;actionProperty_Window&quot;)
-
-        self.actionObject_Selection = self.createAction(&quot;&amp;Model Preview Window&quot;,  self.toggleModelPreviewWindow,  &quot;Alt+O&quot;,  &quot;tux.png&quot;,  &quot;Model Preview&quot;)
-        self.actionObject_Selection.setObjectName(&quot;actionObject_Selection&quot;)
-        
-        self.actionMaterial_Selection = self.createAction(&quot;Material &amp;Preview Window&quot;,  self.toggleMaterialPreviewWindow,  &quot;Alt+M&quot;,  &quot;colors.png&quot;,  &quot;Material Preview&quot;)
-        self.actionMaterial_Selection.setObjectName(&quot;actionMaterial_Selection&quot;)
-
-        self.actionGameObjectClass_Selection = self.createAction(&quot;&amp;Game Object Class Preview Window&quot;,  self.toggleGameObjectViewWindow,  &quot;Ctrl+G&quot;,  &quot;multirow.png&quot;,  &quot;GameObjectClass Preview&quot;)
-        self.actionGameObjectClass_Selection.setObjectName(&quot;actionObject_Selection&quot;)
-
-        self.actionConsole_Window = self.createAction(&quot;&amp;Console Window&quot;,  self.toggleConsoleWindow,  &quot;Alt+C&quot;,  &quot;console.png&quot;,  &quot;Console Window&quot;)
-        self.actionConsole_Window.setObjectName(&quot;actionConsole_Window&quot;)
-        
-        self.actionToggleViewportGrid = self.createAction(&quot;&amp;Toggle Grid&quot;,  self.toggleViewportGrid,  &quot;Alt+G&quot;,  &quot;console.png&quot;,  &quot;Toggle Viewport Grid&quot;)
-        self.actionToggleViewportGrid.setObjectName(&quot;actionToggleViewportGrid&quot;)
-
-#####################################
-#####################################
-
-
-        self.menuFile.addAction(self.actionNeu)
-        self.menuFile.addAction(self.actionOpen)
-        self.menuFile.addAction(self.actionSave)
-        self.menuFile.addAction(self.actionRunModule)
-        self.menuFile.addAction(self.actionClose)
-
-        self.menuEdit.addAction(self.actionSelect)
-        self.menuEdit.addAction(self.actionMove)
-        self.menuEdit.addAction(self.actionRotate)
-        self.menuEdit.addAction(self.actionScale)
-        self.menuEdit.addSeparator()
-        self.menuEdit.addAction(self.actionDelete)
-        self.menuEdit.addAction(self.actionCopy)
-        self.menuEdit.addAction(self.actionCut)
-        self.menuEdit.addAction(self.actionPaste)
-        self.menuEdit.addSeparator()
-        self.menuEdit.addAction(self.actionOneClickEntityPlacement)
-        
-
-        self.menuView.addAction(self.actionSceneExplorer)
-        self.menuView.addAction(self.actionPreferences)
-        self.menuView.addAction(self.actionProperty_Window)
-        self.menuView.addAction(self.actionObject_Selection)
-        self.menuView.addAction(self.actionMaterial_Selection)
-        self.menuView.addAction(self.actionGameObjectClass_Selection)
-        self.menuView.addAction(self.actionConsole_Window)
-        self.menuView.addAction(self.actionToggleViewportGrid)
-        
-        self.menubar.addAction(self.menuFile.menuAction())
-        self.menubar.addAction(self.menuEdit.menuAction())
-        self.menubar.addAction(self.menuView.menuAction())
-
-        self.retranslateUi()
-        QtCore.QMetaObject.connectSlotsByName(self)
-
-    def retranslateUi(self):
-        self.setWindowTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;MainWindow&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.menuFile.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;File&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.menuEdit.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Edit&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.menuView.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;View&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionNeu.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;New Module&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionMove.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Move&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionRotate.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Rotate&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionSceneExplorer.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Module Explorer&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionPreferences.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Preferences&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionProperty_Window.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Property Window&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionObject_Selection.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Object Selection&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionClose.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Quit&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionConsole_Window.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Console Window&quot;, None, QtGui.QApplication.UnicodeUTF8))
-
-    def setupOgre(self, pluginCfgPath=&quot;./Plugins.cfg&quot;, ogreCfgPath=&quot;./ogre.cfg&quot;, logPath=&quot;./ogre.log&quot;):
-        if platform.system() == &quot;Windows&quot;:
-            pluginCfgPath=&quot;./Plugins-windows.cfg&quot;
-        else:
-            pluginCfgPath=&quot;./Plugins-linux.cfg&quot;
-
-        root = og.Root(pluginCfgPath, ogreCfgPath, logPath)
-        self.ogreRoot = root
-
-        if  not self.ogreRoot.restoreConfig() and not self.ogreRoot.showConfigDialog():
-            sys.exit('Quit from Config Dialog')
-
-        root.initialise(False)
-
-        self.pivotRenderQueueListener = PivotRenderQueueListener()
-        self.OgreMainWinSceneMgr = self.ogreRoot.createSceneManager(og.ST_GENERIC, &quot;OgreMainWinSceneMgr&quot;)
-        self.OgreMainWinSceneMgr.ambientLight = og.ColourValue(4, 4, 4)
-        self.OgreMainWinSceneMgr.addRenderQueueListener(self.pivotRenderQueueListener)
-        
-        self.moduleName = &quot;&quot;
-        self.moduleManager = ModuleManager(self.ogreRoot,  self.OgreMainWinSceneMgr)
-        self.gocManager = self.moduleManager.gocManager
-        
-        self.ogreMainWindow = OgreMainWindow.OgreMainWindow(self.moduleManager,  root,  self.OgreMainWinSceneMgr,  self)
-        self.gridlayout.addWidget(self.ogreMainWindow,0,0,1,1)
-        self.hboxlayout.addLayout(self.gridlayout)
-        self.setCentralWidget(self.centralwidget)
-        
-        oglog = og.LogManager.getSingleton().getDefaultLog()
-        oglog.addListener(self.consoleWindow.lockenLog)
-
-    def finishEditorSetup(self):
-        if not self.editorSetupFinished:
-            og.ResourceGroupManager.getSingleton().addResourceLocation(&quot;./media&quot;, &quot;FileSystem&quot;, &quot;General&quot;, False)
-            og.ResourceGroupManager.getSingleton().initialiseAllResourceGroups()
-
-            self.moduleManager.pivot = Pivot(self.OgreMainWinSceneMgr)
-            self.moduleManager.pivot.hide()
-            self.editorSetupFinished = True
-        
-    def update(self):
-        self.ogreRoot.renderOneFrame()
-        if platform.system() == &quot;Linux&quot;:
-            self.ogreMainWindow.updateRenderWindow()
-            self.modelSelectionDialog.updateRenderWindow()
-            self.materialSelectionDialog.updateRenderWindow()
-
-    def actionOpenSlot(self):
-        self.finishEditorSetup()
-        self.moduleManager.openLoadModuleDialog()
-
-    def actionNewSlot(self):
-        newModuleWiz = NewModuleWizard(self.moduleManager, self)
-        newModuleWiz.exec_()
-        return
-        
-    def actionSaveSlot(self):
-        self.moduleManager.save()
-        
-    def actionRunModuleSlot(self):
-        self.moduleManager.save()
-        if platform.system() == &quot;Windows&quot;:
-            workingDir = self.prefDialog.moduleCfgPath.replace(&quot;/modules/modules.cfg&quot;, &quot;&quot;)
-            executable = os.path.join(workingDir, &quot;Rastullah.exe&quot;)
-            executable = executable.replace(&quot;/&quot;,  &quot;\\&quot;)
-            if os.path.isfile(executable):
-                subprocess.Popen([executable, &quot;--module&quot;, self.moduleManager.mainModule.name], 0, None, None, None, None, None, False, False, workingDir)
-
-        
-    def actionQuitSlot(self):
-        self.close()
-
-    def actionDeleteSlot(self):
-        self.moduleManager.deleteObjects()
-
-    def actionCopySlot(self):
-        self.moduleManager.copyObjects()
-
-    def actionCutSlot(self):
-        self.moduleManager.cutObjects()
-
-    def actionPasteSlot(self):
-        self.moduleManager.pasteObjects(self.ogreMainWindow.getCameraToViewportRay())
-
-    def actionSelectSlot(self):
-        self.moduleManager.pivot.hide()
-
-    def actionMoveSlot(self):
-        self.moduleManager.pivot.setMoveMode()
-
-    def actionRotateSlot(self):
-        self.moduleManager.pivot.setRotateMode()
-
-    def actionScaleSlot(self):
-        self.moduleManager.pivot.setScaleMode()
-
-    def actionOneClickEntityPlacementSlot(self):
-        self.moduleManager.setOneClickEntityPlacement(self.actionOneClickEntityPlacement.isChecked())
-
-    def togglePreferencesWindow(self):
-        if self.prefDialog.isHidden():
-            self.prefDialog.show()
-        else:
-            self.prefDialog.hide()
-
-    def toggleModelPreviewWindow(self):
-        if self.modelSelectionDock.isHidden():
-            self.modelSelectionDock.show()
-        else:
-            self.modelSelectionDock.hide()
-    
-    def toggleMaterialPreviewWindow(self):
-        if self.materialSelectionDock.isHidden():
-            self.materialSelectionDock.show()
-        else:
-            self.materialSelectionDock.hide()
-
-    def toggleGameObjectViewWindow(self):
-        if self.gameObjectClassViewDock.isHidden():
-            self.gameObjectClassViewDock.show()
-        else:
-            self.gameObjectClassViewDock.hide()
-
-    def toggleModuleExplorer(self):
-        if self.moduleExplorerDock.isHidden():
-            self.moduleExplorerDock.show()
-        else:
-            self.moduleExplorerDock.hide()
-
-    def togglePropertyWindow(self):
-        if self.propertyDock.isHidden():
-            self.propertyDock.show()
-        else:
-            self.propertyDock.hide()
-
-    def toggleConsoleWindow(self):
-        if self.consoleDock.isHidden():
-            self.consoleDock.show()
-        else:
-            self.consoleDock.hide()
-
-    def toggleViewportGrid(self):
-        self.ogreMainWindow.toggleViewportGrid()
-
-    def createDockWindows(self):
-        self.modelSelectionDock = QtGui.QDockWidget(self.tr(&quot;Models&quot;), self)
-        self.modelSelectionDock.setObjectName(&quot;ModelSelectionDockWindow&quot;)
-        self.modelSelectionDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
-        self.modelSelectionDock.setWidget(self.modelSelectionDialog)
-        self.addDockWidget(QtCore.Qt.RightDockWidgetArea, self.modelSelectionDock)
-        
-        self.materialSelectionDock = QtGui.QDockWidget(self.tr(&quot;Materials&quot;), self)
-        self.materialSelectionDock.setObjectName(&quot;MaterialSelectionDockWindow&quot;)
-        self.materialSelectionDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
-        self.materialSelectionDock.setWidget(self.materialSelectionDialog)
-        self.addDockWidget(QtCore.Qt.RightDockWidgetArea, self.materialSelectionDock)
-        self.tabifyDockWidget(self.modelSelectionDock, self.materialSelectionDock)
-        
-        self.gameObjectClassViewDock = QtGui.QDockWidget(self.tr(&quot;GameObjectClasses&quot;), self)
-        self.gameObjectClassViewDock.setObjectName(&quot;GameObjectClassView&quot;)
-        self.gameObjectClassViewDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
-        self.gameObjectClassViewDock.setWidget(self.gameObjectClassView)
-        self.addDockWidget(QtCore.Qt.RightDockWidgetArea, self.gameObjectClassViewDock)        
-        self.tabifyDockWidget(self.modelSelectionDock, self.gameObjectClassViewDock)
-        
-        self.propertyDock = QtGui.QDockWidget(self.tr(&quot;Properties&quot;), self)
-        self.propertyDock.setObjectName(&quot;PropertyDockWindow&quot;)
-        self.propertyDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
-        self.propertyDock.setWidget(self.objectPropertyWin)
-        self.addDockWidget(QtCore.Qt.LeftDockWidgetArea, self.propertyDock)
-
-        self.moduleExplorerDock = QtGui.QDockWidget(self.tr(&quot;Module Explorer&quot;), self)
-        self.moduleExplorerDock.setObjectName(&quot;ModuleExplorerDockWindow&quot;)
-        self.moduleExplorerDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
-        self.moduleExplorerDock.setWidget(self.moduleExplorerWin)
-        self.addDockWidget(QtCore.Qt.LeftDockWidgetArea, self.moduleExplorerDock)
-        self.tabifyDockWidget(self.moduleExplorerDock, self.propertyDock)
-        
-        self.consoleDock = QtGui.QDockWidget(self.tr(&quot;Console&quot;), self)
-        self.consoleDock.setObjectName(&quot;ConsoleDockWindow&quot;)
-        self.consoleDock.setAllowedAreas(QtCore.Qt.BottomDockWidgetArea | QtCore.Qt.TopDockWidgetArea)
-        self.consoleDock.setWidget(self.consoleWindow)
-        self.addDockWidget(QtCore.Qt.BottomDockWidgetArea, self.consoleDock)
-
-        self.fileToolBar = self.addToolBar(&quot;File Toolbar&quot;)
-        self.fileToolBar.setObjectName(&quot;FileToolBar&quot;)
-        self.fileToolBar.setAllowedAreas(QtCore.Qt.TopToolBarArea | QtCore.Qt.BottomToolBarArea)
-        self.fileToolBar.addAction(self.actionNeu)
-        self.fileToolBar.addAction(self.actionOpen)
-        self.fileToolBar.addAction(self.actionSave)
-        self.fileToolBar.addAction(self.actionRunModule)
-        self.fileToolBar.addAction(self.actionClose)
-        self.addToolBar(QtCore.Qt.TopToolBarArea, self.fileToolBar)
-
-        self.moveToolBar = self.addToolBar(&quot;Transformation Bar&quot;)
-        self.moveToolBar.setObjectName(&quot;TransformationBar&quot;)
-        self.moveToolBar.setAllowedAreas(QtCore.Qt.TopToolBarArea | QtCore.Qt.BottomToolBarArea)
-        self.moveToolBar.addAction(self.actionSelect)
-        self.moveToolBar.addAction(self.actionMove)
-        self.moveToolBar.addAction(self.actionRotate)
-        self.moveToolBar.addAction(self.actionScale)
-        self.addToolBar(QtCore.Qt.TopToolBarArea, self.moveToolBar)
-
-    def keyPressEvent(self,  event):
-        if not event.isAutoRepeat():
-            self.ogreMainWindow.keyPressEvent(event)
-
-    def keyReleaseEvent(self,  event):
-        if not event.isAutoRepeat():
-            self.ogreMainWindow.keyReleaseEvent(event)
-        pass
-
-    def onContextMenuCallback(self, actions, menus):
-        menu = QMenu(&quot;My Menu!!&quot;)
-        menu.addAction(self.actionDelete)
-        menu.addAction(self.actionCopy)
-        menu.addAction(self.actionCut)
-        menu.addAction(self.actionPaste)
-        menu.addSeparator()
-        
-        for m in menus:
-            menu.addMenu(m)
-        for a in actions:
-            menu.addAction(a)
-
-        menu.exec_(QCursor.pos())
-
-    def connectActionButtons(self):
-        pass
-
-    def saveOnClose(self):
-#        reply = QtGui.QMessageBox.question(self,  &quot;Rastullahs Lockenwickler - Unsaved Chages&quot;,  &quot;Save unsaved changes?&quot;,  QtGui.QMessageBox.Yes|QtGui.QMessageBox.No|QtGui.QMessageBox.Cancel)
-#        if reply == QtGui.QMessageBox.Cancel:
-#            return False
-#        if reply == QtGui.QMessageBox.Yes:
-#            print&quot;&quot;
-#            #TODO: implement save here
-        return True
-
-    def closeEvent(self,  event):
-        if self.saveOnClose():
-            settings = QtCore.QSettings()
-            settings.setValue(&quot;Preferences/moduleCfgPath&quot;, QtCore.QVariant(self.prefDialog.lineEdit.text()))
-            settings.setValue(&quot;MainWindow/Geometry&quot;,  QtCore.QVariant(self.saveGeometry()))
-            settings.setValue(&quot;MainWIndow/DockWindows&quot;,  QtCore.QVariant(self.saveState()))
-            
-            #self.ogreRoot.shutdown()
-        else:
-            event.ignore()
-
-if __name__ == &quot;__main__&quot;:
-#    # Import Psyco if available
-#    try:
-#        import psyco
-#        psyco.full(0.02)
-#        #psyco.log()
-#        #psyco.profile()
-#    except ImportError:
-#        pass
-    
-    app = QtGui.QApplication(sys.argv)
-    app.setOrganizationName(&quot;Team Pantheon&quot;)
-    app.setOrganizationDomain(&quot;rastullahs-lockenpracht.de/team&quot;)
-    app.setApplicationName(&quot;Lockenwickler&quot;)
-
-    form = Lockenwickler()
-    form.show()
-
-    app.exec_()
-    
-    sys.exit(0)
-
+#################################################
+# This source file is part of Rastullahs Lockenwickler.
+# Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+#  but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
+#################################################
+
+import os
+import sys
+import platform
+import subprocess
+
+sys.path.insert(0,'..')
+import PythonOgreConfig
+
+from random import randint
+
+from PyQt4 import QtGui, QtCore
+from PreferencesDialog import *
+from ObjectPropertyWin import *
+from ModelSelectionDialog import *
+from MaterialSelectionDialog import *
+from GameObjectClassView import *
+from ConsoleWindow import *
+from ModuleManager import ModuleManager
+from ModuleExplorer import *
+from NewModuleWizard import *
+from MovePivot import *
+from PivotRenderQueueListener import *
+from ModuleDirectoryView import *
+from TriggerManager import *
+from MyTerrainManager import MyTerrainManager
+
+import OgreMainWindow
+import ogre.renderer.OGRE as og
+
+class Lockenwickler(QtGui.QMainWindow):
+    def __init__(self, parent=None):
+        QtGui.QWidget.__init__(self, parent)
+
+#        pixmap = QPixmap(&quot;media/icons/lockenwickler_provisorium.png&quot;)
+#        splash = QSplashScreen(pixmap, Qt.WindowStaysOnTopHint)
+#        splash.setMask(pixmap.mask())
+#        splash.showMessage(&quot;Starting...&quot;)
+#        splash.show() 
+
+        self.setupUi()
+
+        self.consoleWindow = ConsoleWindow(False,  self)
+
+        self.setupOgre()
+
+        self.prefDialog = PreferencesDialog(self)
+        self.objectPropertyWin = ObjectPropertyWin(self.OgreMainWinSceneMgr, self.gocManager, self)
+        self.moduleExplorerWin = ModuleExplorer(self)
+        self.modelSelectionDialog = ModelSelectionDialog(self.ogreRoot, self)
+        self.materialSelectionDialog = MaterialSelectionDialog(self.ogreRoot, self)
+        self.moduleManager.modelSelectionDialog = self.modelSelectionDialog
+        self.moduleManager.materialSelectionDialog = self.materialSelectionDialog
+        self.moduleDirectoryViewWin = ModuleDirectoryView(self)
+        
+        triggerManager = TriggerManager()
+        
+        self.gameObjectClassView = GameObjectClassView(self.moduleManager.gocManager)
+
+        self.createDockWindows()
+
+        self.mainTimer = QtCore.QTimer(self)
+        self.mainTimer.connect(self.mainTimer, QtCore.SIGNAL(&quot;timeout()&quot;), self.update)
+        self.mainTimer.start(5)
+
+        settings = QtCore.QSettings()
+        self.restoreGeometry(settings.value(&quot;MainWindow/Geometry&quot;).toByteArray())
+        self.restoreState(settings.value(&quot;MainWindow/DockWindows&quot;).toByteArray())
+        if not self.prefDialog.setCfgPath(settings.value(&quot;Preferences/moduleCfgPath&quot;).toString()):
+            self.prefDialog.show()
+            self.moduleManager.moduleCfgPath = self.prefDialog.moduleCfgPath
+
+        else:
+            self.moduleManager.moduleCfgPath = self.prefDialog.moduleCfgPath
+            
+        self.prefDialog.setExternalEditorPath(str(settings.value(&quot;Preferences/externalEditorPath&quot;).toString()))
+        
+        if self.prefDialog.moduleCfgPath is not None:
+            self.moduleDirectoryViewWin.modulesPath = self.prefDialog.moduleCfgPath.replace(&quot;modules.cfg&quot;, &quot;&quot;)
+
+        
+        self.moduleManager.setModuleExplorer(self.moduleExplorerWin)
+        self.moduleManager.setModuleDirView(self.moduleDirectoryViewWin)
+        self.moduleManager.setPropertyWindow(self.objectPropertyWin)
+        self.moduleManager.setContextMenuCallback(self.onContextMenuCallback)
+        
+        self.setWindowIcon(QIcon(&quot;media/icons/lockenwickler_provisorium_small.png&quot;))
+        self.setWindowTitle(&quot;Rastullahs Lockenwickler&quot;)
+        
+        self.editorSetupFinished = False
+        
+#        splash.finish(self)
+
+    def createAction(self, text, slot=None, shortcut=None, icon=None, tip=None, checkable=False, signal=&quot;triggered()&quot;):
+        action = QtGui.QAction(text, self)
+        if icon is not None:
+            action.setIcon(QtGui.QIcon(&quot;media/icons/%s&quot; % icon))
+        if shortcut is not None:
+            action.setShortcut(shortcut)
+        if tip is not None:
+            action.setToolTip(tip)
+            action.setStatusTip(tip)
+        if slot is not None:
+            self.connect(action, QtCore.SIGNAL(signal), slot)
+
+        action.setCheckable(checkable)
+
+        return action
+
+    def addActions(self, target, actions):
+        for act in actions:
+            if act is None:
+               target.addSeparator()
+            else:
+                target.addAction(act)
+
+    def setupUi(self):
+        self.setObjectName(&quot;MainWindow&quot;)
+
+        self.centralwidget = QtGui.QWidget(self)
+        self.centralwidget.setObjectName(&quot;centralwidget&quot;)
+
+        self.hboxlayout = QtGui.QHBoxLayout(self.centralwidget)
+        self.hboxlayout.setContentsMargins(0, 0, 0, 0)
+        self.hboxlayout.setObjectName(&quot;hboxlayout&quot;)
+
+        self.gridlayout = QtGui.QGridLayout()
+        self.gridlayout.setObjectName(&quot;gridlayout&quot;)
+        self.gridlayout.setContentsMargins(0, 0, 0, 0)
+        
+        self.menubar = QtGui.QMenuBar(self)
+        self.menubar.setObjectName(&quot;menubar&quot;)
+
+        self.menuFile = QtGui.QMenu(self.menubar)
+        self.menuFile.setObjectName(&quot;menuFile&quot;)
+
+        self.menuEdit = QtGui.QMenu(self.menubar)
+        self.menuEdit.setObjectName(&quot;menuEdit&quot;)
+
+        self.menuView = QtGui.QMenu(self.menubar)
+        self.menuView.setObjectName(&quot;menuView&quot;)
+        self.setMenuBar(self.menubar)
+
+
+        self.statusbar = QtGui.QStatusBar(self)
+        self.statusbar.setObjectName(&quot;statusbar&quot;)
+        self.setStatusBar(self.statusbar)
+
+#####################################
+        self.actionNeu =self.createAction(&quot;&amp;New Module&quot;,  self.actionNewSlot,  QKeySequence.New,  &quot;filenew.png&quot;,  &quot;New Module&quot;)
+        self.actionNeu.setObjectName(&quot;actionNeu&quot;)
+
+        self.actionOpen = self.createAction(&quot;&amp;Open Module&quot;,  self.actionOpenSlot,  QKeySequence.Open,  &quot;fileopen.png&quot;,  &quot;Open Module&quot;)
+        self.actionOpen.setObjectName(&quot;actionOpen&quot;)
+        
+        self.actionSave = self.createAction(&quot;&amp;Save&quot;,  self.actionSaveSlot,  QKeySequence.Save,  &quot;filesave.png&quot;,  &quot;Save Module&quot;)
+        self.actionSave.setObjectName(&quot;actionSave&quot;)
+        
+        self.actionRunModule = self.createAction(&quot;&amp;Save and Run&quot;,  self.actionRunModuleSlot,  &quot;Alt+R&quot;,  &quot;fileexport.png&quot;,  &quot;Save And Run Module&quot;)
+        self.actionRunModule.setObjectName(&quot;actionRunModule&quot;)
+
+        self.actionClose = self.createAction(&quot;Quit&quot;,  self.actionQuitSlot,  &quot;Alt+Q&quot;,  &quot;exit.png&quot;,  &quot;Quit&quot;)
+        self.actionClose.setObjectName(&quot;actionQuit&quot;)
+#####################################
+
+
+#####################################
+        self.actionDelete = self.createAction(&quot;Delete&quot;,  self.actionDeleteSlot,  QKeySequence.Delete,  &quot;editdelete.png&quot;,  &quot;Delete&quot;)
+        self.actionDelete.setObjectName(&quot;actionDelete&quot;)
+
+        self.actionCopy = self.createAction(&quot;Copy&quot;,  self.actionCopySlot,  QKeySequence.Copy,  &quot;editcopy.png&quot;,  &quot;Copy&quot;)
+        self.actionCopy.setObjectName(&quot;actionCopy&quot;)
+
+        self.actionCut = self.createAction(&quot;Cut&quot;,  self.actionCutSlot,  QKeySequence.Cut,  &quot;editcut.png&quot;,  &quot;Cut&quot;)
+        self.actionCut.setObjectName(&quot;actionCut&quot;)
+
+        self.actionPaste = self.createAction(&quot;Paste&quot;,  self.actionPasteSlot,  QKeySequence.Paste,  &quot;editpaste.png&quot;,  &quot;Paste&quot;)
+        self.actionPaste.setObjectName(&quot;actionPaste&quot;)
+
+        self.actionSelect = self.createAction(&quot;&amp;Select&quot;,  self.actionSelectSlot,  &quot;Space&quot;,  &quot;cursor.png&quot;,  &quot;Move selected object&quot;)
+        self.actionSelect.setObjectName(&quot;actionSelect&quot;)
+
+        self.actionMove = self.createAction(&quot;&amp;Move&quot;,  self.actionMoveSlot,  &quot;g&quot;,  &quot;move.png&quot;,  &quot;Move selected object&quot;)
+        self.actionMove.setObjectName(&quot;actionMove&quot;)
+
+        self.actionRotate = self.createAction(&quot;&amp;Rotate&quot;,  self.actionRotateSlot,  &quot;r&quot;,  &quot;rotate.png&quot;,  &quot;Rotate selected object&quot;)
+        self.actionRotate.setObjectName(&quot;actionRotate&quot;)
+
+        self.actionScale = self.createAction(&quot;&amp;Scale&quot;,  self.actionScaleSlot,  &quot;x&quot;,  &quot;resizecol.png&quot;,  &quot;Scale selected object&quot;)
+        self.actionScale.setObjectName(&quot;actionScale&quot;)
+
+        self.actionOneClickEntityPlacement = self.createAction(&quot;&amp;OneClickEntityPlacement&quot;,  self.actionOneClickEntityPlacementSlot,  &quot;&quot;,  &quot;resizecol.png&quot;,  &quot;Add an Entity just by a click&quot;)
+        self.actionOneClickEntityPlacement.setObjectName(&quot;actionOneClickEntityPlacement&quot;)
+        self.actionOneClickEntityPlacement.setCheckable(True)
+
+#####################################
+#####################################
+        self.actionSceneExplorer = self.createAction(&quot;&amp;Scene Exlporer&quot;,  self.toggleModuleExplorer,  &quot;Alt+E&quot;,  &quot;view_tree.png&quot;,  &quot;Module Explorer&quot;,  False)
+        self.actionSceneExplorer.setObjectName(&quot;actionSceneExplorer&quot;)
+        
+        self.actionModuleDirView = self.createAction(&quot;&amp;Directory Explorer&quot;,  self.toggleModuleDirView,  &quot;Alt+D&quot;,  &quot;view_tree.png&quot;,  &quot;Module Directory Explorer&quot;,  False)
+        self.actionModuleDirView.setObjectName(&quot;actionDirectoryExplorer&quot;)
+        
+        self.actionPreferences = self.createAction(&quot;&amp;Preferences&quot;,  self.togglePreferencesWindow,  None,  &quot;configure.png&quot;,  &quot;Lockenwickler Preferences&quot;,  False)
+        self.actionPreferences.setObjectName(&quot;actionPreferences&quot;)
+
+        self.actionProperty_Window = self.createAction(&quot;Pr&amp;operty Window&quot;,  self.togglePropertyWindow,  &quot;Alt+P&quot;,  &quot;unsortedlist1.png&quot;,  &quot;Property Window&quot;)
+        self.actionProperty_Window.setObjectName(&quot;actionProperty_Window&quot;)
+
+        self.actionObject_Selection = self.createAction(&quot;&amp;Model Preview Window&quot;,  self.toggleModelPreviewWindow,  &quot;Alt+O&quot;,  &quot;tux.png&quot;,  &quot;Model Preview&quot;)
+        self.actionObject_Selection.setObjectName(&quot;actionObject_Selection&quot;)
+        
+        self.actionMaterial_Selection = self.createAction(&quot;Material &amp;Preview Window&quot;,  self.toggleMaterialPreviewWindow,  &quot;Alt+M&quot;,  &quot;colors.png&quot;,  &quot;Material Preview&quot;)
+        self.actionMaterial_Selection.setObjectName(&quot;actionMaterial_Selection&quot;)
+
+        self.actionGameObjectClass_Selection = self.createAction(&quot;&amp;Game Object Class Preview Window&quot;,  self.toggleGameObjectViewWindow,  &quot;Ctrl+G&quot;,  &quot;multirow.png&quot;,  &quot;GameObjectClass Preview&quot;)
+        self.actionGameObjectClass_Selection.setObjectName(&quot;actionObject_Selection&quot;)
+
+        self.actionConsole_Window = self.createAction(&quot;&amp;Console Window&quot;,  self.toggleConsoleWindow,  &quot;Alt+C&quot;,  &quot;console.png&quot;,  &quot;Console Window&quot;)
+        self.actionConsole_Window.setObjectName(&quot;actionConsole_Window&quot;)
+        
+        self.actionTerrainTools_Window = self.createAction(&quot;&amp;Terrain Tools&quot;,  self.toggleTerrainToolsWindow,  &quot;Alt+T&quot;,  &quot;terrain_small.png&quot;,  &quot;Console Window&quot;)
+        self.actionTerrainTools_Window.setObjectName(&quot;actionTerrainTools_Window&quot;)
+        
+        self.actionToggleViewportGrid = self.createAction(&quot;&amp;Toggle Grid&quot;,  self.toggleViewportGrid,  &quot;Alt+G&quot;,  &quot;console.png&quot;,  &quot;Toggle Viewport Grid&quot;)
+        self.actionToggleViewportGrid.setObjectName(&quot;actionToggleViewportGrid&quot;)
+
+#####################################
+#####################################
+
+
+        self.menuFile.addAction(self.actionNeu)
+        self.menuFile.addAction(self.actionOpen)
+        self.menuFile.addAction(self.actionSave)
+        self.menuFile.addAction(self.actionRunModule)
+        self.menuFile.addAction(self.actionClose)
+
+        self.menuEdit.addAction(self.actionSelect)
+        self.menuEdit.addAction(self.actionMove)
+        self.menuEdit.addAction(self.actionRotate)
+        self.menuEdit.addAction(self.actionScale)
+        self.menuEdit.addSeparator()
+        self.menuEdit.addAction(self.actionDelete)
+        self.menuEdit.addAction(self.actionCopy)
+        self.menuEdit.addAction(self.actionCut)
+        self.menuEdit.addAction(self.actionPaste)
+        self.menuEdit.addSeparator()
+        self.menuEdit.addAction(self.actionOneClickEntityPlacement)
+        
+
+        self.menuView.addAction(self.actionSceneExplorer)
+        self.menuView.addAction(self.actionModuleDirView)
+        self.menuView.addAction(self.actionPreferences)
+        self.menuView.addAction(self.actionProperty_Window)
+        self.menuView.addAction(self.actionObject_Selection)
+        self.menuView.addAction(self.actionMaterial_Selection)
+        self.menuView.addAction(self.actionGameObjectClass_Selection)
+        self.menuView.addAction(self.actionConsole_Window)
+        self.menuView.addAction(self.actionTerrainTools_Window)
+        self.menuView.addAction(self.actionToggleViewportGrid)
+        
+        self.menubar.addAction(self.menuFile.menuAction())
+        self.menubar.addAction(self.menuEdit.menuAction())
+        self.menubar.addAction(self.menuView.menuAction())
+
+        self.retranslateUi()
+        QtCore.QMetaObject.connectSlotsByName(self)
+
+    def retranslateUi(self):
+        self.setWindowTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;MainWindow&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.menuFile.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;File&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.menuEdit.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Edit&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.menuView.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;View&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionNeu.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;New Module&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionMove.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Move&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionRotate.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Rotate&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionSceneExplorer.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Module Explorer&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionPreferences.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Preferences&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionProperty_Window.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Property Window&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionObject_Selection.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Object Selection&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionClose.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Quit&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionConsole_Window.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Console Window&quot;, None, QtGui.QApplication.UnicodeUTF8))
+
+    def setupOgre(self, pluginCfgPath=&quot;./Plugins.cfg&quot;, ogreCfgPath=&quot;./ogre.cfg&quot;, logPath=&quot;./ogre.log&quot;):
+        if platform.system() == &quot;Windows&quot;:
+            pluginCfgPath=&quot;./Plugins-windows.cfg&quot;
+        else:
+            pluginCfgPath=&quot;./Plugins-linux.cfg&quot;
+
+        root = og.Root(pluginCfgPath, ogreCfgPath, logPath)
+        self.ogreRoot = root
+
+        if  not self.ogreRoot.restoreConfig() and not self.ogreRoot.showConfigDialog():
+            sys.exit('Quit from Config Dialog')
+
+        root.initialise(False)
+
+        self.pivotRenderQueueListener = PivotRenderQueueListener()
+        self.OgreMainWinSceneMgr = self.ogreRoot.createSceneManager(og.ST_GENERIC, &quot;OgreMainWinSceneMgr&quot;)
+        self.OgreMainWinSceneMgr.ambientLight = og.ColourValue(4, 4, 4)
+        self.OgreMainWinSceneMgr.addRenderQueueListener(self.pivotRenderQueueListener)
+        
+        self.moduleName = &quot;&quot;
+        self.myTerrainManager = MyTerrainManager(self.OgreMainWinSceneMgr)
+        self.moduleManager = ModuleManager(self.ogreRoot,  self.OgreMainWinSceneMgr)
+        self.moduleManager.myTerrainManager = self.myTerrainManager
+        self.gocManager = self.moduleManager.gocManager
+        
+        self.ogreMainWindow = OgreMainWindow.OgreMainWindow(self.moduleManager,  root,  self.OgreMainWinSceneMgr,  self)
+        self.gridlayout.addWidget(self.ogreMainWindow,0,0,1,1)
+        self.hboxlayout.addLayout(self.gridlayout)
+        self.setCentralWidget(self.centralwidget)
+        
+        self.myTerrainManager.ogreMainWindow = self.ogreMainWindow
+        
+        oglog = og.LogManager.getSingleton().getDefaultLog()
+        oglog.addListener(self.consoleWindow.lockenLog)
+
+    def finishEditorSetup(self):
+        if not self.editorSetupFinished:
+            og.ResourceGroupManager.getSingleton().addResourceLocation(&quot;./media&quot;, &quot;FileSystem&quot;, &quot;General&quot;, False)
+            og.ResourceGroupManager.getSingleton().initialiseAllResourceGroups()
+
+            self.moduleManager.pivot = Pivot(self.OgreMainWinSceneMgr)
+            self.moduleManager.pivot.hide()
+            self.editorSetupFinished = True
+        
+    def update(self):
+        self.ogreRoot.renderOneFrame()
+        if platform.system() == &quot;Linux&quot;:
+            self.ogreMainWindow.updateRenderWindow()
+            self.modelSelectionDialog.updateRenderWindow()
+            self.materialSelectionDialog.updateRenderWindow()
+
+    def actionOpenSlot(self):
+        self.finishEditorSetup()
+        self.moduleManager.openLoadModuleDialog()
+
+    def actionNewSlot(self):
+        newModuleWiz = NewModuleWizard(self.moduleManager, self)
+        newModuleWiz.exec_()
+        return
+        
+    def actionSaveSlot(self):
+        self.moduleManager.save()
+        
+    def actionRunModuleSlot(self):
+        self.moduleManager.save()
+        if platform.system() == &quot;Windows&quot;:
+            workingDir = self.prefDialog.moduleCfgPath.replace(&quot;/modules/modules.cfg&quot;, &quot;&quot;)
+            executable = os.path.join(workingDir, &quot;Rastullah.exe&quot;)
+            executable = executable.replace(&quot;/&quot;,  &quot;\\&quot;)
+            if os.path.isfile(executable):
+                subprocess.Popen([executable, &quot;--module&quot;, self.moduleManager.mainModule.name], 0, None, None, None, None, None, False, False, workingDir)
+
+        
+    def actionQuitSlot(self):
+        self.close()
+
+    def actionDeleteSlot(self):
+        self.moduleManager.deleteObjects()
+
+    def actionCopySlot(self):
+        self.moduleManager.copyObjects()
+
+    def actionCutSlot(self):
+        self.moduleManager.cutObjects()
+
+    def actionPasteSlot(self):
+        self.moduleManager.pasteObjects(self.ogreMainWindow.getCameraToViewportRay())
+
+    def actionSelectSlot(self):
+        self.moduleManager.pivot.hide()
+
+    def actionMoveSlot(self):
+        self.moduleManager.pivot.setMoveMode()
+
+    def actionRotateSlot(self):
+        self.moduleManager.pivot.setRotateMode()
+
+    def actionScaleSlot(self):
+        self.moduleManager.pivot.setScaleMode()
+
+    def actionOneClickEntityPlacementSlot(self):
+        self.moduleManager.setOneClickEntityPlacement(self.actionOneClickEntityPlacement.isChecked())
+
+    def togglePreferencesWindow(self):
+        if self.prefDialog.isHidden():
+            self.prefDialog.show()
+        else:
+            self.prefDialog.hide()
+
+    def toggleModelPreviewWindow(self):
+        if self.modelSelectionDock.isHidden():
+            self.modelSelectionDock.show()
+        else:
+            self.modelSelectionDock.hide()
+    
+    def toggleMaterialPreviewWindow(self):
+        if self.materialSelectionDock.isHidden():
+            self.materialSelectionDock.show()
+        else:
+            self.materialSelectionDock.hide()
+
+    def toggleGameObjectViewWindow(self):
+        if self.gameObjectClassViewDock.isHidden():
+            self.gameObjectClassViewDock.show()
+        else:
+            self.gameObjectClassViewDock.hide()
+
+    def toggleModuleExplorer(self):
+        if self.moduleExplorerDock.isHidden():
+            self.moduleExplorerDock.show()
+        else:
+            self.moduleExplorerDock.hide()
+            
+    def toggleModuleDirView(self):
+        if self.moduleDirectoryViewDock.isHidden():
+            self.moduleDirectoryViewDock.show()
+        else:
+            self.moduleDirectoryViewDock.hide()
+
+    def togglePropertyWindow(self):
+        if self.propertyDock.isHidden():
+            self.propertyDock.show()
+        else:
+            self.propertyDock.hide()
+
+    def toggleConsoleWindow(self):
+        if self.consoleDock.isHidden():
+            self.consoleDock.show()
+        else:
+            self.consoleDock.hide()
+            
+    def toggleTerrainToolsWindow(self):
+        if self.myTerrainManagerDock.isHidden():
+            self.myTerrainManagerDock.show()
+        else:
+            self.myTerrainManagerDock.hide()
+
+    def toggleViewportGrid(self):
+        self.ogreMainWindow.toggleViewportGrid()
+
+    def createDockWindows(self):
+        self.modelSelectionDock = QtGui.QDockWidget(self.tr(&quot;Models&quot;), self)
+        self.modelSelectionDock.setObjectName(&quot;ModelSelectionDockWindow&quot;)
+        self.modelSelectionDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
+        self.modelSelectionDock.setWidget(self.modelSelectionDialog)
+        self.addDockWidget(QtCore.Qt.RightDockWidgetArea, self.modelSelectionDock)
+        
+        self.materialSelectionDock = QtGui.QDockWidget(self.tr(&quot;Materials&quot;), self)
+        self.materialSelectionDock.setObjectName(&quot;MaterialSelectionDockWindow&quot;)
+        self.materialSelectionDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
+        self.materialSelectionDock.setWidget(self.materialSelectionDialog)
+        self.addDockWidget(QtCore.Qt.RightDockWidgetArea, self.materialSelectionDock)
+        self.tabifyDockWidget(self.modelSelectionDock, self.materialSelectionDock)
+        
+        self.gameObjectClassViewDock = QtGui.QDockWidget(self.tr(&quot;GameObjectClasses&quot;), self)
+        self.gameObjectClassViewDock.setObjectName(&quot;GameObjectClassView&quot;)
+        self.gameObjectClassViewDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
+        self.gameObjectClassViewDock.setWidget(self.gameObjectClassView)
+        self.addDockWidget(QtCore.Qt.RightDockWidgetArea, self.gameObjectClassViewDock)        
+        self.tabifyDockWidget(self.modelSelectionDock, self.gameObjectClassViewDock)
+        
+        self.propertyDock = QtGui.QDockWidget(self.tr(&quot;Properties&quot;), self)
+        self.propertyDock.setObjectName(&quot;PropertyDockWindow&quot;)
+        self.propertyDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
+        self.propertyDock.setWidget(self.objectPropertyWin)
+        self.addDockWidget(QtCore.Qt.LeftDockWidgetArea, self.propertyDock)
+
+        self.moduleExplorerDock = QtGui.QDockWidget(self.tr(&quot;Module Explorer&quot;), self)
+        self.moduleExplorerDock.setObjectName(&quot;ModuleExplorerDockWindow&quot;)
+        self.moduleExplorerDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
+        self.moduleExplorerDock.setWidget(self.moduleExplorerWin)
+        self.addDockWidget(QtCore.Qt.LeftDockWidgetArea, self.moduleExplorerDock)
+        self.tabifyDockWidget(self.moduleExplorerDock, self.propertyDock)
+        
+        self.moduleDirectoryViewDock = QtGui.QDockWidget(self.tr(&quot;Module Directory View&quot;), self)
+        self.moduleDirectoryViewDock.setObjectName(&quot;ModuleDirectoryViewDockWindow&quot;)
+        self.moduleDirectoryViewDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea | QtCore.Qt.TopDockWidgetArea | QtCore.Qt.BottomDockWidgetArea)
+        self.moduleDirectoryViewDock.setWidget(self.moduleDirectoryViewWin)
+        self.addDockWidget(QtCore.Qt.LeftDockWidgetArea, self.moduleDirectoryViewDock)
+        
+        self.myTerrainManagerDock = self.myTerrainManager.getDockWidget(self)
+        
+        self.consoleDock = QtGui.QDockWidget(self.tr(&quot;Console&quot;), self)
+        self.consoleDock.setObjectName(&quot;ConsoleDockWindow&quot;)
+        self.consoleDock.setAllowedAreas(QtCore.Qt.BottomDockWidgetArea | QtCore.Qt.TopDockWidgetArea)
+        self.consoleDock.setWidget(self.consoleWindow)
+        self.addDockWidget(QtCore.Qt.BottomDockWidgetArea, self.consoleDock)
+
+        self.fileToolBar = self.addToolBar(&quot;File Toolbar&quot;)
+        self.fileToolBar.setObjectName(&quot;FileToolBar&quot;)
+        self.fileToolBar.setAllowedAreas(QtCore.Qt.TopToolBarArea | QtCore.Qt.BottomToolBarArea)
+        self.fileToolBar.addAction(self.actionNeu)
+        self.fileToolBar.addAction(self.actionOpen)
+        self.fileToolBar.addAction(self.actionSave)
+        self.fileToolBar.addAction(self.actionRunModule)
+        self.fileToolBar.addAction(self.actionClose)
+        self.addToolBar(QtCore.Qt.TopToolBarArea, self.fileToolBar)
+
+        self.moveToolBar = self.addToolBar(&quot;Transformation Bar&quot;)
+        self.moveToolBar.setObjectName(&quot;TransformationBar&quot;)
+        self.moveToolBar.setAllowedAreas(QtCore.Qt.TopToolBarArea | QtCore.Qt.BottomToolBarArea)
+        self.moveToolBar.addAction(self.actionSelect)
+        self.moveToolBar.addAction(self.actionMove)
+        self.moveToolBar.addAction(self.actionRotate)
+        self.moveToolBar.addAction(self.actionScale)
+        self.addToolBar(QtCore.Qt.TopToolBarArea, self.moveToolBar)
+
+    def keyPressEvent(self,  event):
+        if not event.isAutoRepeat():
+            self.ogreMainWindow.keyPressEvent(event)
+
+    def keyReleaseEvent(self,  event):
+        if not event.isAutoRepeat():
+            self.ogreMainWindow.keyReleaseEvent(event)
+        pass
+
+    def onContextMenuCallback(self, actions, menus):
+        menu = QMenu(&quot;My Menu!!&quot;)
+        menu.addAction(self.actionDelete)
+        menu.addAction(self.actionCopy)
+        menu.addAction(self.actionCut)
+        menu.addAction(self.actionPaste)
+        menu.addSeparator()
+        
+        for m in menus:
+            menu.addMenu(m)
+        for a in actions:
+            menu.addAction(a)
+
+        menu.exec_(QCursor.pos())
+
+    def connectActionButtons(self):
+        pass
+
+    def saveOnClose(self):
+#        reply = QtGui.QMessageBox.question(self,  &quot;Rastullahs Lockenwickler - Unsaved Chages&quot;,  &quot;Save unsaved changes?&quot;,  QtGui.QMessageBox.Yes|QtGui.QMessageBox.No|QtGui.QMessageBox.Cancel)
+#        if reply == QtGui.QMessageBox.Cancel:
+#            return False
+#        if reply == QtGui.QMessageBox.Yes:
+#            print&quot;&quot;
+#            #TODO: implement save here
+        return True
+
+    def closeEvent(self,  event):
+        if self.saveOnClose():
+            settings = QtCore.QSettings()
+            settings.setValue(&quot;Preferences/moduleCfgPath&quot;, QtCore.QVariant(self.prefDialog.lineEdit.text()))
+            settings.setValue(&quot;MainWindow/Geometry&quot;,  QtCore.QVariant(self.saveGeometry()))
+            settings.setValue(&quot;MainWIndow/DockWindows&quot;,  QtCore.QVariant(self.saveState()))
+            settings.setValue(&quot;Preferences/externalEditorPath&quot;,  QtCore.QVariant(self.prefDialog.externalTextAppLineEdit.text()))
+            #self.ogreRoot.shutdown()
+        else:
+            event.ignore()
+
+if __name__ == &quot;__main__&quot;:
+#    # Import Psyco if available
+#    try:
+#        import psyco
+#        psyco.full(0.02)
+#        #psyco.log()
+#        #psyco.profile()
+#    except ImportError:
+#        pass
+    
+    app = QtGui.QApplication(sys.argv)
+    app.setOrganizationName(&quot;Team Pantheon&quot;)
+    app.setOrganizationDomain(&quot;rastullahs-lockenpracht.de/team&quot;)
+    app.setApplicationName(&quot;Lockenwickler&quot;)
+
+    form = Lockenwickler()
+    form.show()
+
+    app.exec_()
+    
+    sys.exit(0)
+

Modified: rl/branches/persistence2/editors/Lockenwickler/src/ModuleExplorer.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/ModuleExplorer.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/ModuleExplorer.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,4 +1,4 @@
- #################################################
+#################################################
 # This source file is part of Rastullahs Lockenwickler.
 # Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
 #
@@ -15,13 +15,15 @@
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
+#################################################
 
 import sys
 from PyQt4.QtCore import *
 from PyQt4.QtGui import *
 import ogre.renderer.OGRE as og
 
+from ZoneManager import *
+
 # get the light out of a light node
 def extractLight(node):
         i = 0
@@ -35,7 +37,7 @@
             i += 1
 
 class ExplorerOptionsDlg(QDialog):
-    def __init__(self, lights, gameObjects, entities, zones, zonelights, parent = None):
+    def __init__(self, lights, gameObjects, entities, zones, zonelights, zonetriggers, parent = None):
         super(ExplorerOptionsDlg, self).__init__(parent)
         
         buttonBox = QDialogButtonBox(QDialogButtonBox.Ok | QDialogButtonBox.Cancel)
@@ -61,6 +63,10 @@
         self.zoneslightsCheckBox.setChecked(zonelights)        
         layout.addWidget(self.zoneslightsCheckBox)
         
+        self.zonesTriggersCheckBox = QCheckBox(&quot;Show Zonetriggers&quot;)
+        self.zonesTriggersCheckBox.setChecked(zonetriggers)        
+        layout.addWidget(self.zonesTriggersCheckBox)
+        
         layout.addWidget(buttonBox)
         layout.setContentsMargins(2, 2, 2, 2)
         self.setLayout(layout)
@@ -122,7 +128,7 @@
         drag.start(Qt.CopyAction)
 
     def dragEnterEvent(self, event):
-        print &quot;enter&quot;
+#        print &quot;enter&quot;
         if event.mimeData().hasFormat(&quot;application/light&quot;):
             event.accept()
             
@@ -155,7 +161,7 @@
         
             relMousePos = self.mapFromGlobal(QPoint(QCursor.pos().x(), QCursor.pos().y() - self.header().height()))
             item = self.itemAt(relMousePos)
-            str(item.data(0, Qt.UserRole).toString())
+            #str(item.data(0, Qt.UserRole).toString())
             
             items = self.findItems(&quot;Lights&quot;, Qt.MatchFixedString | Qt.MatchRecursive)
             for iitem in items:
@@ -173,10 +179,9 @@
                     child.setText(0, text)
                     child.setData(0, Qt.UserRole, QVariant(ModuleExplorer.LIGHT_IN_ZONE))
 
-
-
 class ModuleExplorer(QWidget):
     LIGHT_IN_ZONE = 99
+    TRIGGER_IN_ZONE = 100
     
     def __init__(self, parent=None):
         QWidget.__init__(self, parent)
@@ -205,6 +210,7 @@
         
         self.showLights = True
         self.showZoneLights = True
+        self.showZoneTriggers = True
         self.showGameObjects = True
         self.showEntities = True
         self.showZones = True
@@ -254,10 +260,12 @@
         if self.selectionChangedCallback is None:
             return
 
+        
+
         #get all selected items
         selItems = self.sceneTreeView.selectedItems()
         if len(selItems) == 1:
-            if str(selItems[0].parent().text(0)) == &quot;Lights&quot; and str(selItems[0].parent().parent().text(0)).startswith(&quot;Zone: &quot;):
+            if str(selItems[0]).startswith(&quot;Scene: &quot;) and str(selItems[0].parent().text(0)) == &quot;Lights&quot; and str(selItems[0].parent().parent().text(0)).startswith(&quot;Zone: &quot;):
                 return
         
         
@@ -279,17 +287,32 @@
         
         #end remove all the things from the list we actually don't want to be selected
         for item in selItems:
-            if str(item.text(0)).startswith(&quot;Scene: &quot;) or str(item.text(0)).startswith(&quot;Map: &quot;) or str(item.text(0)).startswith(&quot;Zone: &quot;):
+            itemText = str(item.text(0))
+            if item.parent() is None:
+                continue
+            
+            parentText = str(item.parent().text(0))
+            
+            if itemText.startswith(&quot;Map: &quot;) or itemText.startswith(&quot;Zone: &quot;):
                 selItems.remove(item)
+            elif item.data(0, Qt.UserRole).toInt()[0] == ModuleExplorer.LIGHT_IN_ZONE or item.data(0, Qt.UserRole).toInt()[0] == ModuleExplorer.TRIGGER_IN_ZONE:
+                selItems.remove(item)
+            elif itemText == &quot;Lights&quot; or itemText == &quot;Triggers&quot;:
+                if parentText.startswith(&quot;Zone: &quot;):
+                    selItems.remove(item)
         
         for item in selItems:
+            if item.parent() is None:
+                continue
+            
             parentName =  str(item.text(0))
                         
             name = str(item.data(0, Qt.UserRole).toString())
             if len &gt; 0:
                 nodeNames[str(item.parent().text(0))].append(name)
                 
-        self.selectionChangedCallback(nodeNames)
+        if len(nodeNames) &gt; 0:
+            self.selectionChangedCallback(nodeNames)
 
     def deselectAll(self):
         self.disconnect(self.sceneTreeView, SIGNAL(&quot;itemSelectionChanged ()&quot;), self.onSelectionChanged)
@@ -352,6 +375,11 @@
                 setActiveMapAction = QAction(&quot;Set Active&quot;,  self)
                 menu.addAction(setActiveMapAction)
                 self.connect(setActiveMapAction, SIGNAL(&quot;triggered()&quot;), self.onSetActiveMap)
+            elif self.sceneTreeView.currentItem() is not None and str(self.sceneTreeView.currentItem().text(0)).startswith(&quot;Zone:&quot;):
+                item = self.sceneTreeView.itemAt(point)
+                addTriggerAction = QAction(&quot;Add Trigger&quot;,  self)
+                menu.addAction(addTriggerAction)
+                self.connect(addTriggerAction, SIGNAL(&quot;triggered()&quot;), self.onAddTriggerToZone)
                 
             deleteAction= QAction(&quot;Delete&quot;,  self)
             menu.addAction(deleteAction)
@@ -371,8 +399,13 @@
             
             menu.exec_(QCursor().pos())
     
+    def onAddTriggerToZone(self):
+        zoneName = str(self.sceneTreeView.currentItem().text(0)).replace(&quot;Zone: &quot;, &quot;&quot;)
+        self.moduleManager.zoneManager.getZone(zoneName).manualAddTrigger()
+        self.updateView()
+        
     def onOptions(self):
-        dlg = ExplorerOptionsDlg(self.showLights, self.showGameObjects, self.showEntities, self.showZones, self.showZoneLights, self)
+        dlg = ExplorerOptionsDlg(self.showLights, self.showGameObjects, self.showEntities, self.showZones, self.showZoneLights, self.showZoneTriggers, self)
         if dlg.exec_():
             self.showLights = dlg.lightCheckBox.isChecked()
             self.showGameObjects = dlg.gameObjectsCheckBox.isChecked()
@@ -413,13 +446,34 @@
             self.updateView()
     
     def onDelete(self):
-        print &quot;delete&quot;
+        item = self.sceneTreeView.itemAt(self.onMenuPoint)
+        
+        if item.data(0, Qt.UserRole).toString() == str(ModuleExplorer.LIGHT_IN_ZONE):
+            zoneName = str(item.parent().parent().text(0)).replace(&quot;Zone: &quot;,  &quot;&quot;)
+            lightName = str(item.text(0))
+            if self.sceneTreeView.zoneManager.removeLightFromZone(zoneName, lightName):
+                item.parent().removeChild(item)     
+        elif item.data(0, Qt.UserRole).toString() == str(ModuleExplorer.TRIGGER_IN_ZONE):
+            zoneName = str(item.parent().parent().text(0)).replace(&quot;Zone: &quot;,  &quot;&quot;)
+            triggerNameName = str(item.text(0))
+            if self.sceneTreeView.zoneManager.removeTriggerFromZone(zoneName, triggerNameName):
+                item.parent().removeChild(item)
+        elif str(item.text(0)).startswith(&quot;Zone: &quot;):
+            zoneName = str(item.text(0)).replace(&quot;Zone: &quot;,  &quot;&quot;)
+            reply = QMessageBox.warning(QApplication.focusWidget(), &quot;Undoable Action!&quot;, &quot;Delete zone &quot; +  zoneName + &quot;?&quot;, QMessageBox.Yes|QMessageBox.Cancel)
+            if reply == QMessageBox.Cancel:
+                return
+            elif reply == QMessageBox.Yes:
+                if self.sceneTreeView.zoneManager.deleteZone(zoneName):
+                    item.parent().removeChild(item)
+                    
+#        print &quot;delete &quot; + str(item.data(0, Qt.UserRole).toString())
 
     def keyPressEvent(self, event):
         print &quot;key!!!!!!!!!!!!!!&quot;
     
     def paintLastSelectedMapBlue(self):
-        print self.lastSelectedMap
+#        print self.lastSelectedMap
         for item in self.mapItems:
             if str(item.text(0)) == self.lastSelectedMap:
                 brush = item.foreground(0)
@@ -535,6 +589,15 @@
                     childItem2.setText(0, lightName)
                     childItem2.setData(0, Qt.UserRole, QVariant(ModuleExplorer.LIGHT_IN_ZONE))
                     
+            if self.showZoneTriggers:
+                triggersItem = QTreeWidgetItem(childItem)
+                triggersItem.setText(0, &quot;Triggers&quot;)
+                
+                for trigger in zone.triggerList:
+                    childItem2 = QTreeWidgetItem(triggersItem)
+                    childItem2.setText(0, trigger.name)
+                    childItem2.setData(0, Qt.UserRole, QVariant(ModuleExplorer.TRIGGER_IN_ZONE))
+                    
     def setCurrentModule(self, module):
         self.module = module
         self.updateView()

Modified: rl/branches/persistence2/editors/Lockenwickler/src/ModuleManager.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/ModuleManager.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/ModuleManager.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,4 +1,4 @@
- #################################################
+#################################################
 # This source file is part of Rastullahs Lockenwickler.
 # Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
 #
@@ -15,7 +15,7 @@
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
+#################################################
 
 import sys
 import codecs
@@ -37,6 +37,7 @@
 from GameObjectClassManager import *
 from MyRaySceneQueryListener import *
 from ZoneManager import ZoneManager
+from TriggerManager import TriggerManager 
 
 
 # get the light out of a light node
@@ -764,6 +765,7 @@
         self.cutListPreviousNodes = [] # contains the nodes they where copnnected to before the cut
         self.currentMap = None
         self.moduleExplorer = None
+        self.moduleDirView = None
 
         self.lastRay = None
         self.rayLine = None
@@ -784,6 +786,7 @@
         self.moduleConfigIsParsed = False
 
         self.selectionBuffer = None
+        self.myTerrainManager = None
         self.depthBuffer = None
         self.propertyWindow = None
     
@@ -800,6 +803,7 @@
         self.raySceneQueryListener = MyRaySceneQueryListener()
         
         self.zoneManager = ZoneManager(self.sceneManager)
+
         
     def resetParsedModuleConfig(self):
         self.moduleConfigIsParsed = False
@@ -862,6 +866,8 @@
 #        self.progress = ProgressBarThread(0, 8, moduleName)
 #        self.progress.start()
         
+        directories = []
+        
         for m in self.moduleList:
             if m.name == moduleName:
                 if m.hasDependencies: # load modules on wich the main module depends before the main module is loaded
@@ -872,20 +878,27 @@
                                 m2.load()
                                 self.modelSelectionDialog.scanDirForModels(m2.moduleRoot)
                                 self.materialSelectionDialog.scanDirForMaterials(m2.moduleRoot)
+                                TriggerManager.instance.addDirectory(m2.moduleRoot)
                                 self.mainModuledependencieList.append(m2)
-
+                                directories.append(m2.moduleRoot)
 #                self.progress.setProgress(4, &quot;Loading &quot; + moduleName)
                 m.load()
 #                self.progress.setProgress(6, &quot;Scan for models...&quot;)
                 self.modelSelectionDialog.scanDirForModels(m.moduleRoot)
 #                self.progress.setProgress(8, &quot;Scan for materials&quot;)
                 self.materialSelectionDialog.scanDirForMaterials(m.moduleRoot)
+                TriggerManager.instance.addDirectory(m.moduleRoot)
+                directories.append(m.moduleRoot)
                 self.mainModule = m
                 self.moduleExplorer.setCurrentModule(m)
-
+                self.moduleDirView.parseDirectory(directories)
+        
+        TriggerManager.instance.update()
+                
         if self.selectionBuffer is None:
             self.selectionBuffer = SelectionBuffer(self.sceneManager, self.ogreRoot.getRenderTarget(&quot;OgreMainWin&quot;), self, self.zoneManager)
 
+            
 #        if self.depthBuffer is None:
 #            self.depthBuffer = DepthBuffer(self.sceneManager, self.ogreRoot.getRenderTarget(&quot;OgreMainWin&quot;))
 
@@ -908,6 +921,9 @@
         self.moduleExplorer.setSelectionChangedCallback(self.selectionChangedCallback)
         self.moduleExplorer.setModuleManager(self)
     
+    def setModuleDirView(self, dirView):
+        self.moduleDirView = dirView
+    
     def setPropertyWindow(self, propertyWin):
         self.propertyWindow = propertyWin
     
@@ -915,8 +931,6 @@
         self.resetSelection()
         self.userSelectionList = self.selectionBuffer.manualSelectObjects(items)
         
-        print len(self.userSelectionList)
-        
         if len(self.userSelectionList) &gt; 1:
             self.propertyWindow.clear()
         elif len(self.userSelectionList) &gt; 0 and len(self.userSelectionList) &lt; 2:
@@ -963,7 +977,7 @@
                     self.updatePivots()
                 elif controlDown and not shiftDown:
                     so.setSelected(True)
-
+                    
                     for soFromList in self.userSelectionList:
                         if soFromList == so:
                             return # object already selected
@@ -1128,11 +1142,21 @@
         self.cutList = []
         self.moduleExplorer.updateView()
         
-    def leftMouseUp(self):
+    def setLeftMouseDown(self):
+        self.leftMouseDown = True
+        
+        if self.pivot is not None and not self.pivot.isTransforming:
+            self.myTerrainManager.leftMouseDown = True
+        
+    def setLeftMouseUp(self):
+        self.leftMouseDown = False
+        
         if self.pivot is not None and self.pivot.isTransforming:
             self.propertyWindow.updateProperties()
             self.pivot.stopTransforming()
-
+        else:
+            self.myTerrainManager.leftMouseDown = False
+            
     def resetSelection(self):
         if self.userSelectionList is not None:
             for so in self.userSelectionList:
@@ -1367,8 +1391,6 @@
             actions.append(self.createAction(&quot;Add Property&quot;, so.entity.getUserObject().addProperty))
             self.playerStartGameObjectId = so.entity.getUserObject().inWorldId
             
-                
-            
         if self.onContextMenuCallback is not None:
             self.onContextMenuCallback(actions,  menus)
 

Modified: rl/branches/persistence2/editors/Lockenwickler/src/MovePivot.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/MovePivot.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/MovePivot.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -232,7 +232,7 @@
                 if self.moveDirection == &quot;UniScaler&quot;:
                     for so in self.selectionList:
                         val = incY / 6.0
-                        print val
+#                        print val
                         scale = so.entity.getParentNode().getScale() + og.Vector3(val * scaleFactor, val * scaleFactor, val * scaleFactor)
                         so.entity.getParentNode().setScale(scale)
         

Copied: rl/branches/persistence2/editors/Lockenwickler/src/MyTerrainManager.py (from rev 4939, rl/trunk/editors/Lockenwickler/src/MyTerrainManager.py)

Modified: rl/branches/persistence2/editors/Lockenwickler/src/OgreMainWindow.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/OgreMainWindow.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/OgreMainWindow.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -36,6 +36,7 @@
     def __init__(self, moduleManager,  ogreRoot, OgreMainWinSceneMgr,  parent):
         QWidget.__init__(self, parent)
         self.moduleManager = moduleManager
+
         self.ogreRoot = ogreRoot
         self.OgreMainWinSceneMgr = OgreMainWinSceneMgr
 
@@ -136,12 +137,14 @@
             self.strafeCamRight= False
 
     def eventFilter(self, obj, event):
+#        print event.type()
+        
         if event.type() == 2:
             self.ogreWidget.setFocus()
             if event.button() == 1: # left mouse button is pressed
                 self.leftMouseDown = True
-                self.moduleManager.leftMouseDown = True
-
+                self.moduleManager.setLeftMouseDown()
+                
                 if self.rightMouseDown: #if right mouse button is already pressed dolly the camera
                     self.mDollyCamera = True
                 else:
@@ -161,9 +164,9 @@
         elif event.type() == 3:
             if event.button() == 1: # left mouse button is released
                 self.leftMouseDown = False
-                self.moduleManager.leftMouseDown = False
-                self.moduleManager.leftMouseUp()
-
+                self.moduleManager.setLeftMouseUp()
+                self.moduleManager.myTerrainManager.leftMouseUp()
+                
                 if self.mDollyCamera == True: #if we dolly the camera set it to false
                     self.mDollyCamera = False
 
@@ -193,7 +196,12 @@
 
             if self.moduleManager.pivot is not None and  self.leftMouseDown and not self.middleMouseDown and not self.rightMouseDown:
                 self.moduleManager.pivot.onMouseMoved(event.globalX,  event.globalY,  incX,  incY)
-
+                
+            if self.leftMouseDown is True and not self.rightMouseDown and not self.middleMouseDown:
+                self.moduleManager.myTerrainManager.isEditing = True
+            else:
+                self.moduleManager.myTerrainManager.isEditing = False 
+            
             rotX = incX * 0.01
             rotY = incY * 0.01
 
@@ -205,6 +213,7 @@
             self.lastMousePosX = event.globalX()
             self.lastMousePosY = event.globalY()
 
+
         if event.type() == 60: #drag enter
             self.dragEnterEvent(event)
         if event.type() == 61: #drag move

Modified: rl/branches/persistence2/editors/Lockenwickler/src/PreferencesDialog.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/PreferencesDialog.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/PreferencesDialog.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -26,6 +26,9 @@
 from PyQt4.QtGui import *
 
 class PreferencesDialog(QDialog):
+    pathToModuleConfig = None
+    externalTextAppCmd = None
+    
     def __init__(self, parent=None):
         QDialog.__init__(self, parent)
 
@@ -39,22 +42,50 @@
         layout.addWidget(self.label, 0, 0, 1, 2)
         layout.addWidget(self.lineEdit, 1, 0)
         layout.addWidget(self.modulConfigSelector, 1, 1)
+        QObject.connect(self.modulConfigSelector, SIGNAL(&quot;clicked()&quot;),
+                               self.openModulConfigSelector)
 
+        self.externalTextApplabel = QLabel()
+        self.externalTextApplabel.setText(&quot;Please select the Texteditor to use.&quot;)
+        self.externalTextAppSelector = QPushButton()
+        self.externalTextAppSelector.setText(&quot;...&quot;)
+        self.externalTextAppLineEdit = QLineEdit()
+
+        layout.addWidget(self.externalTextApplabel, 2, 0, 1, 2)
+        layout.addWidget(self.externalTextAppLineEdit, 3, 0)
+        layout.addWidget(self.externalTextAppSelector, 3, 1)
+        QObject.connect(self.externalTextAppSelector, SIGNAL(&quot;clicked()&quot;),
+                               self.openExternalTextEditorSelector)
+
+    
+
         self.setLayout(layout)
-        
+        self.setMinimumSize(600, 100)
         self.moduleCfgPath = None
-        
-        QObject.connect(self.modulConfigSelector, SIGNAL(&quot;clicked()&quot;),
-                               self.openModulConfigSelector)
+        self.externalEditorPath = None
 
+
         self.setModal(True)
 
+        buttonBox = QDialogButtonBox(QDialogButtonBox.Ok)
+        layout.addWidget(buttonBox)
+        self.connect(buttonBox, SIGNAL(&quot;accepted()&quot;), self.onOk)       
+        
+    def onOk(self):
+        PreferencesDialog.externalTextAppCmd = str(self.externalTextAppLineEdit.text())
+        self.accept()
+        
+    def setExternalEditorPath(self, path):
+        PreferencesDialog.externalTextAppCmd = path
+        self.externalTextAppLineEdit.setText(path)
+        
     def setCfgPath(self, inPath):
         path = str(inPath)
 
         from os.path import isfile
 
         if isfile(path):
+            PreferencesDialog.pathToModuleConfig = path
             self.moduleCfgPath = path
             self.modulePath = self.moduleCfgPath.replace(&quot;modules.cfg&quot;, &quot;&quot;)
             self.lineEdit.setText(self.moduleCfgPath)
@@ -62,11 +93,22 @@
         else:
             return False
 
+    def openExternalTextEditorSelector(self):
+        dialog = QFileDialog(self)
+        self.externalEditorPath = str(dialog.getOpenFileName(self, &quot;Select the executable&quot;, &quot;/home/melven/rastullah/rl_dist/modules/&quot;))
+
+        from os.path import isfile
+
+        if isfile(self.externalEditorPath):
+            self.externalTextAppLineEdit.setText(self.externalEditorPath)
+            PreferencesDialog.externalTextAppCmd = str(self.externalTextAppLineEdit.text())
+            
     def openModulConfigSelector(self):
         dialog = QFileDialog(self)
         self.moduleCfgPath = str(dialog.getOpenFileName(self, &quot;Select modules.cfg&quot;, &quot;/home/melven/rastullah/rl_dist/modules/&quot;, &quot;modules.cfg (*.cfg)&quot;))
         self.modulePath = self.moduleCfgPath.replace(&quot;modules.cfg&quot;, &quot;&quot;)
-
+        PreferencesDialog.pathToModuleConfig = self.moduleCfgPath
+        
         from os.path import isfile
 
         if isfile(self.moduleCfgPath):

Modified: rl/branches/persistence2/editors/Lockenwickler/src/SelectionBuffer.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/SelectionBuffer.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/SelectionBuffer.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -52,8 +52,8 @@
         self.entity = entity #the selected entity
         self.isPivot = False
 
+#        print self.entity.getParentNode().getName()
 
-
     #if True this instance will show its bounding box else it will hide it
     def setSelected(self,  selected):
         if selected == True:
@@ -102,7 +102,6 @@
                 self.lastEntity = subEntity.getParent().getName()
                 self.colorDict[self.lastEntity] = self.currentColorAsVector3
                 return self.lastTechnique
-        
 
     def randomizeColor(self):
         r = random.randrange(1, 255)
@@ -187,7 +186,8 @@
 
         self.pBox = og.PixelBox(pixelBuffer.getWidth(), pixelBuffer.getHeight(),pixelBuffer.getDepth(), pixelBuffer.getFormat(), VoidPointer)
         self.renderTexture.copyContentsToMemory(self.pBox, og.RenderTarget.FrameBuffer.FB_FRONT)
-
+        
+#        self.renderTexture.writeContentsToFile(&quot;selectionbuffer.png&quot;)
 #        i = 0
 #        
 #        while i &lt; len(self.buffer):
@@ -240,6 +240,8 @@
                     return None
                 elif key == &quot;rayLine&quot;:
                     return None
+                elif key == &quot;TerrainManagerEditingCircle&quot; or  key == &quot;TerrainManagerPointerNodeMesh&quot;:
+                    return None
                 elif key == &quot;EditorXArrow&quot;:
                     so = SelectionObject(self.sceneMgr.getEntity(key))
                     so.isPivot = True
@@ -281,7 +283,11 @@
                     so.setSelected(True)
                     items.append(so)
             elif key.startswith(&quot;Zone: &quot;):
-                parentNode = self.zoneManager.getZone(key.replace(&quot;Zone: &quot;, &quot;&quot;)).zoneNode
+                zone = self.zoneManager.getZone(key.replace(&quot;Zone: &quot;, &quot;&quot;))
+                if zone is None:
+                    continue
+                    
+                parentNode = zone.zoneNode
                 for nodeName in itemNodes[key]:
                     obj = parentNode.getChild(nodeName).getAttachedObject(0)
                     so = SelectionObject(obj)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/TriggerManager.py (from rev 4939, rl/trunk/editors/Lockenwickler/src/TriggerManager.py)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/Ui_AddTriggerDialog.py (from rev 4939, rl/trunk/editors/Lockenwickler/src/Ui_AddTriggerDialog.py)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/Ui_MyTerrainManagerDock.py (from rev 4939, rl/trunk/editors/Lockenwickler/src/Ui_MyTerrainManagerDock.py)

Modified: rl/branches/persistence2/editors/Lockenwickler/src/ZoneManager.py
===================================================================
--- rl/branches/persistence2/editors/Lockenwickler/src/ZoneManager.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/ZoneManager.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -15,7 +15,7 @@
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
+#################################################
 
 import functools
 import xml.etree.cElementTree as xml
@@ -26,7 +26,9 @@
 import ogre.renderer.OGRE as og
  
 from ModuleExplorer import NameInputDlg
- 
+from TriggerManager import TriggerManager
+
+
 #                &lt;zone name=&quot;Testzone&quot;&gt;
 #                        &lt;area type=&quot;sphere&quot;&gt;
 #                                &lt;position x=&quot;-10&quot; y=&quot;0&quot; z=&quot;-5&quot;/&gt;
@@ -49,6 +51,7 @@
 #                        &lt;/trigger&gt;
 #                &lt;/zone&gt;
  
+       
 class Area(og.UserDefinedObject):
     def __init__(self,sceneManager, type, parentZone, id, position, orientation, scale, meshFile = None, transitiondistance = &quot;0.5&quot;, subtract = False):
         og.UserDefinedObject.__init__(self)
@@ -98,7 +101,8 @@
         self.areaNode.detachAllObjects()
         self.areaNode.getParent().removeAndDestroyChild(self.areaNode.getName())
         self.sceneManager.destroyEntity(self.areaEntity.getName())
-    
+        print &quot;area&quot; + str(self.id) + &quot; deleted&quot;
+        
     def getsubtract(self):
         return self.__subtract
         
@@ -125,18 +129,37 @@
         self.isHidden = False
         
         self.zoneNode =  self.sceneManager.getRootSceneNode().createChildSceneNode(&quot;zone_&quot; + name + &quot;_node&quot;)
+    
+    def __del__(self):
+        print &quot;Zone &quot; + self.name + &quot; is garbage collected&quot;
         
     def addArea(self, type, position, orientation, scale, meshFile = None):
         area = Area(self.sceneManager, type, self, self.areaCounter, position, orientation, scale, meshFile)
         if area is not None:
             self.areaList.append(area)
             self.areaCounter = self.areaCounter + 1
-    
+            
+    def addTrigger(self, trigger):
+        if trigger is not None:
+            self.triggerList.append(trigger)
+        
+    def deleteSelf(self):    
+        del self.areaList[:]
+        
+        self.zoneNode.detachAllObjects()
+        parent = self.zoneNode.getParent()
+        parent.removeAndDestroyChild(self.zoneNode.getName())
+        
     def deleteArea(self, area):
         for a in self.areaList:
             if a.id == area.id:
                 self.areaList.remove(a)
                 del a
+            
+    def manualAddTrigger(self):
+        trigger = TriggerManager.instance.manualCreateTrigger()
+        if trigger is not False and trigger is not None:
+            self.triggerList.append(trigger)
     
     def hide(self):
         self.sceneManager.getRootSceneNode().removeChild(self.zoneNode)
@@ -148,14 +171,21 @@
         
         
 class ZoneManager():
+    instance = None
+    
     def __init__(self, sceneManager):
-        self.currentMap = None
-        self.zoneList = []
-        self.menuList = []
-        self.entityUnderMouse = None
-        self.newAreaPosition = None
-        self.sceneManager = sceneManager
+        if ZoneManager.instance == None:
+            ZoneManager.instance = self
         
+            self.currentMap = None
+            self.zoneList = []
+            self.menuList = []
+            self.entityUnderMouse = None
+            self.newAreaPosition = None
+            self.sceneManager = sceneManager
+        
+        
+        
     def createZone(self, name):
         if self.currentMap == None:
             print &quot;No map selected!&quot;
@@ -166,6 +196,15 @@
         self.currentMap.zoneList.append(z)
         return z
         
+    def deleteZone(self, zoneName):
+        for zone in self.zoneList:
+            if zone.name == zoneName:
+                self.zoneList.remove(zone)
+                zone.deleteSelf()
+                del zone
+                return True
+        return False
+        
     def parseZonesFromXml(self, zoneXmlNode, map):
         if zoneXmlNode is None:
             return
@@ -225,11 +264,38 @@
                 name = light.attrib[&quot;name&quot;]
                 z.lightList.append(name)
                 
+            triggerNodes = zone.getiterator(&quot;trigger&quot;)
+            for trigger in triggerNodes:
+                name = trigger.attrib[&quot;name&quot;]
+                classname = trigger.attrib[&quot;classname&quot;]
+                properties = trigger.getiterator(&quot;property&quot;)
+                
+                trigger = TriggerManager.instance.createTrigger(name, classname, properties)
+                
+                z.addTrigger(trigger)
+                
             soundNodes = zone.getiterator(&quot;sound&quot;)
             for sound in soundNodes:
                 name = sound.attrib[&quot;name&quot;]
                 z.soundList.append(name)
-            
+    
+    def removeLightFromZone(self, zoneName, lightName):
+        for zone in self.zoneList:
+            if zone.name == zoneName:
+                for light in zone.lightList:
+                    if light == lightName:
+                        zone.lightList.remove(light)
+                        return True
+        return False
+        
+    def removeTriggerFromZone(self, zoneName, triggerName):
+        for zone in self.zoneList:
+            if zone.name == zoneName:
+                for trigger in zone.triggerList:
+                    if trigger.name == triggerName:
+                        zone.triggerList.remove(trigger)
+                        return True
+        return False
 
     def saveZonesToXml(self, root, map):
         if len(map.zoneList) == 0:
@@ -270,18 +336,29 @@
                 
             for lightName in zone.lightList:
                 lightElem = xml.SubElement(zoneElem, &quot;light&quot;)
-                lightElem.attrib[&quot;name&quot;] = lightName
+                lightElem.attrib[&quot;name&quot;] = str(lightName)
+                
+            for trigger in zone.triggerList:
+                triggerElem = xml.SubElement(zoneElem, &quot;trigger&quot;)
+                triggerElem.attrib[&quot;name&quot;] = str(trigger.name)
+                triggerElem.attrib[&quot;classname&quot;] = str(trigger.name)
+                
+                for prop in trigger.properties:
+                    propElem = xml.SubElement(triggerElem, &quot;property&quot;)
+                    propElem.attrib[&quot;name&quot;] = str(prop.name)
+                    propElem.attrib[&quot;type&quot;] = str(prop.type)
+                    propElem.attrib[&quot;data&quot;] = str(prop.data)
             
             for soundName in zone.soundList:
                 soundElem = xml.SubElement(zoneElem, &quot;sound&quot;)
-                soundElem.attrib[&quot;name&quot;] = soundName
+                soundElem.attrib[&quot;name&quot;] = str(soundName)
                 
     def deleteArea(self, area):
         for z in self.zoneList:
             for a in z.areaList:
                 if a.id == area.id:
                     z.deleteArea(area)
-    
+
     def getZoneMenu(self):
         self.menuList = []
         menu = QMenu(&quot;Add Area&quot;)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/help_rc.py (from rev 4939, rl/trunk/editors/Lockenwickler/src/help_rc.py)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/icons_rc.py (from rev 4939, rl/trunk/editors/Lockenwickler/src/icons_rc.py)


Property changes on: rl/branches/persistence2/editors/Lockenwickler/src/media
___________________________________________________________________
Name: svn:ignore
   - .Bpib
skelett.blend
skelett_merged.blend

   + .Bpib
skelett.blend
skelett_merged.blend
pivots.blend1


Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/help (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/help)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/help/TerrainExtends1.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/help/TerrainExtends1.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/help/TerrainExtends1.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/help/help.qrc
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/help/help.qrc	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/help/help.qrc	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,5 +0,0 @@
-&lt;RCC&gt;
-  &lt;qresource prefix=&quot;helpPref&quot; &gt;
-    &lt;file&gt;TerrainExtends1.png&lt;/file&gt;
-  &lt;/qresource&gt;
-&lt;/RCC&gt;

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/help/help.qrc (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/help/help.qrc)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/help/help_rc.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/help/help_rc.py	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/help/help_rc.py	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,550 +0,0 @@
-# -*- coding: utf-8 -*-
-
-# Resource object code
-#
-# Created: So Mai 3 16:15:12 2009
-#      by: The Resource Compiler for PyQt (Qt v4.4.1)
-#
-# WARNING! All changes made in this file will be lost!
-
-from PyQt4 import QtCore
-
-qt_resource_data = &quot;\
-\x00\x00\x1f\xcf\
-\x89\
-\x50\x4e\x47\x0d\x0a\x1a\x0a\x00\x00\x00\x0d\x49\x48\x44\x52\x00\
-\x00\x01\x2c\x00\x00\x01\x2c\x08\x06\x00\x00\x00\x79\x7d\x8e\x75\
-\x00\x00\x00\x01\x73\x52\x47\x42\x00\xae\xce\x1c\xe9\x00\x00\x00\
-\x06\x62\x4b\x47\x44\x00\xff\x00\xff\x00\xff\xa0\xbd\xa7\x93\x00\
-\x00\x00\x09\x70\x48\x59\x73\x00\x00\x0b\x13\x00\x00\x0b\x13\x01\
-\x00\x9a\x9c\x18\x00\x00\x00\x07\x74\x49\x4d\x45\x07\xd9\x05\x03\
-\x0e\x07\x1d\x05\x69\x10\xcd\x00\x00\x00\x19\x74\x45\x58\x74\x43\
-\x6f\x6d\x6d\x65\x6e\x74\x00\x43\x72\x65\x61\x74\x65\x64\x20\x77\
-\x69\x74\x68\x20\x47\x49\x4d\x50\x57\x81\x0e\x17\x00\x00\x1f\x2a\
-\x49\x44\x41\x54\x78\xda\xed\xdd\x7b\x54\x54\xd5\xe2\x07\xf0\xef\
-\x9e\x07\x33\x03\x08\x08\xa2\x80\x8a\x82\x8f\x2b\x3d\x88\x04\xd3\
-\x82\x34\xd1\xf4\x8a\x21\x6a\xa9\xf9\xae\x44\xcb\x5c\xb6\x6e\x4f\
-\x5c\xf9\x08\xb3\x5c\x5e\xb3\xd2\x5b\x5e\xcb\x52\xcb\x65\xbe\x53\
-\x54\x0c\xf2\x91\x52\x5e\xee\x8f\x92\x5a\x1a\x3e\x4b\xe0\x9a\x1a\
-\x82\x0a\x2a\x8c\x03\xf3\xd8\xbf\x3f\xa6\x99\x44\x50\x87\x60\x9c\
-\x19\xfd\x7e\xd6\x9a\xe5\x30\x33\xe7\xcc\xb8\xcf\x99\xef\xec\xb3\
-\xcf\x3e\x7b\x0b\x29\x25\x88\x88\x3c\x81\x82\x45\x40\x44\x0c\x2c\
-\x22\x22\x06\x16\x11\x31\xb0\x88\x88\x18\x58\x44\x44\x0c\x2c\x22\
-\x62\x60\x11\x11\x31\xb0\x88\x88\x18\x58\x44\xc4\xc0\x22\x22\x62\
-\x60\x11\x11\x31\xb0\x88\x88\x81\x45\x44\xc4\xc0\x22\x22\x62\x60\
-\x11\x11\x03\x8b\x88\x88\x81\x45\x44\xc4\xc0\x22\x22\x06\x16\x11\
-\x11\x03\x8b\x88\x88\x81\x45\x44\x0c\x2c\x22\x22\x06\x16\x11\x11\
-\x03\x8b\x88\x18\x58\x44\x44\x0c\x2c\x22\x22\x06\x16\x11\x31\xb0\
-\x88\x88\x18\x58\x44\xc4\xc0\x22\x22\x62\x60\x11\x11\x31\xb0\x88\
-\x88\x81\x45\x44\xc4\xc0\x22\x22\x62\x60\x11\x11\x03\x8b\x88\x88\
-\x81\x45\x44\xc4\xc0\x22\x22\x06\x16\x11\x11\x03\x8b\x88\xe8\x56\
-\x07\x96\x94\x92\x25\x48\x44\xb7\x8c\x68\x6c\xe8\x64\x66\x66\xca\
-\xb9\x73\xe7\xe2\xd2\xa5\x4b\x2c\x4d\x22\x57\x7e\x99\x85\x80\xc1\
-\x60\x40\x79\x79\x39\x1e\x7e\xf8\x61\xcc\x9b\x37\x0f\xbe\xbe\xbe\
-\x4e\x7d\xcf\xea\xea\x6a\x28\x14\x0a\xa8\xd5\xea\x5a\x8f\x5b\x2c\
-\x16\xb4\x6d\xdb\x56\x34\xf5\xfb\xa9\x1a\xbb\x82\x75\xeb\xd6\xe1\
-\xbf\xff\xfd\x2f\xf7\x16\x22\x37\x92\x91\x91\x81\xc0\xc0\x40\xf8\
-\xf9\xf9\x39\xef\xf0\x4c\xa1\xc0\xc9\x93\x27\xa1\xd3\xe9\xd0\xa2\
-\x45\x8b\x5a\x47\x5c\x57\xae\x5c\xc1\x47\x1f\x7d\xd4\xe4\xef\xd9\
-\xe8\xc0\xaa\xae\xae\x06\x00\x68\xb5\x5a\x74\xe9\xd2\xa5\x4e\xd2\
-\x12\xd1\xad\xa1\x50\x28\xf0\xeb\xaf\xbf\xe2\xfc\xf9\xf3\x08\x0c\
-\x0c\x44\x5a\x5a\x1a\x5a\xb5\x6a\x25\x9c\xf5\x7e\x1a\x8d\x06\xb3\
-\x67\xcf\x96\x51\x51\x51\x78\xfc\xf1\xc7\x85\xc9\x64\xb2\x3f\x27\
-\xa5\x8c\x74\xc6\x7b\x36\x3a\xb0\x6c\xa9\x1a\x10\x10\x80\xec\xec\
-\x6c\xa7\x16\x10\x11\xdd\xd8\x90\x21\x43\x64\x46\x46\x06\x74\x3a\
-\x1d\xfc\xfd\xfd\xe1\xef\xef\xef\xd4\xf7\x53\x2a\x95\xd0\x6a\xb5\
-\xf0\xf1\xf1\xb9\xf6\xa9\x42\xa7\x84\x72\x53\xad\x48\x4a\x69\xaf\
-\x6d\x11\x91\x6b\x98\xcd\xe6\xdb\xbb\x16\xc9\x4d\x4c\x44\x0c\x2c\
-\x22\x22\x06\x16\x11\x31\xb0\x88\x88\x18\x58\x44\x44\x0c\x2c\x22\
-\x62\x60\x11\x11\x31\xb0\x88\x88\x18\x58\x44\xc4\xc0\x22\x22\x62\
-\x60\x11\x11\x31\xb0\x88\x88\x81\x45\x44\xc4\xc0\x22\x22\x62\x60\
-\x11\x11\x03\x8b\x88\x88\x81\x45\x44\xc4\xc0\x22\x22\x06\x16\x11\
-\x11\x03\x8b\x88\x88\x81\x45\x44\x0c\x2c\x22\x22\x06\x16\x11\x11\
-\x03\x8b\x88\x18\x58\x44\x44\x0c\x2c\x22\x22\x06\x16\x11\x31\xb0\
-\x88\x88\x18\x58\x44\xc4\xc0\x22\x22\x62\x60\x11\x11\x31\xb0\x88\
-\x88\x81\x45\x44\xc4\xc0\x22\x22\x62\x60\x11\x91\xfb\xaa\xa8\xa8\
-\x88\x64\x60\x11\x91\x47\xe8\xde\xbd\xfb\x89\x6f\xbe\xf9\x46\x32\
-\xb0\x88\xc8\xed\x9d\x3b\x77\x0e\xfd\xfa\xf5\xc3\xac\x59\xb3\x9a\
-\x2c\xb4\x18\x58\x44\xe4\x14\x67\xcf\x9e\x15\xe3\xc7\x8f\xc7\x9c\
-\x39\x73\x10\x1f\x1f\x2f\x2b\x2b\x2b\x1b\xbd\x4e\x15\x8b\x95\x88\
-\x9c\x41\xa5\x52\x61\xd9\xb2\x65\x22\x39\x39\x59\xce\x9a\x35\x0b\
-\xe1\xe1\xe1\xf2\x83\x0f\x3e\x40\x68\x68\x28\x2c\x16\x0b\x00\xc0\
-\x64\x32\xe1\x81\x07\x1e\x78\x36\x30\x30\x70\x29\x03\x8b\x88\x5c\
-\x6e\xf0\xe0\xc1\xa2\x79\xf3\xe6\xb2\x6f\xdf\xbe\x18\x33\x66\x4c\
-\x9d\xe7\xb7\x6c\xd9\xf2\xf1\xa0\x41\x83\x18\x58\x44\xe4\x7a\x1f\
-\x7c\xf0\x81\x9c\x39\x73\x26\x42\x43\x43\xb1\x6d\xdb\x36\xb4\x6b\
-\xd7\xae\x83\xc5\x62\xe9\x0b\x00\x52\xca\x48\x3f\x3f\xbf\x69\x3c\
-\x24\x24\x22\x97\x2a\x2e\x2e\x96\x93\x27\x4f\x46\x76\x76\x36\x46\
-\x8c\x18\x81\xb5\x6b\xd7\x8a\xab\x9e\x5e\xfa\x57\xd6\xc9\xc0\x22\
-\x22\xa7\xe8\xd4\xa9\x13\xfc\xfc\xfc\xf0\xf9\xe7\x9f\x63\xdc\xb8\
-\x71\xa2\x29\xd6\xc9\xc0\x22\x22\xa7\x78\xe8\xa1\x87\xb0\x6a\xd5\
-\x2a\xb4\x6d\xdb\x56\x34\xd5\x3a\x19\x58\x44\xe4\x14\x39\x39\x39\
-\xa2\xa9\xd7\xc9\x7e\x58\x44\xe4\x31\x18\x58\x44\xc4\xc0\x22\x22\
-\x62\x60\x11\xd1\x1d\x8b\x8d\xee\x44\xe4\x74\x85\x85\x85\x72\xef\
-\xde\xbd\x28\x2d\x2d\x85\xd9\x6c\xb6\x3f\x5e\x53\x53\x83\xa7\x9e\
-\x7a\x0a\x11\x11\x11\x0e\x35\xd0\x33\xb0\x88\xc8\xa9\xbe\xff\xfe\
-\x7b\x39\x6e\xdc\x38\x1c\x3b\x76\xac\xde\xe7\xbb\x75\xeb\x86\x88\
-\x88\x08\x1e\x12\x12\x91\xeb\xad\x5d\xbb\x16\xc7\x8e\x1d\xc3\x9c\
-\x39\x73\x20\xa5\x14\xd7\xde\x1e\x7b\xec\x31\x87\xbb\x3f\x30\xb0\
-\x88\xc8\xa9\xbc\xbd\xbd\x01\x00\x33\x66\xcc\x68\x74\xbf\x2c\x06\
-\x16\x11\x39\x55\x5a\x5a\x9a\x48\x4a\x4a\xc2\x8c\x19\x33\x1a\x3d\
-\x90\x1f\x03\x8b\x88\x9c\x6a\xc6\x8c\x19\x32\x3b\x3b\x1b\xf3\xe6\
-\xcd\x83\x8f\x8f\x8f\xf4\xf5\xf5\xb5\xdf\x84\x10\x72\xf7\xee\xdd\
-\x0e\x07\x19\x1b\xdd\x89\xc8\xa9\x82\x82\x82\xd0\xa5\x4b\x17\x28\
-\x14\x75\xeb\x47\x55\x55\x55\xd0\xe9\x74\x0e\xaf\x8b\x81\x45\x44\
-\x4e\x35\x6b\xd6\x2c\x31\x6b\xd6\xac\x26\x59\x17\x0f\x09\x89\xa8\
-\x49\x49\x29\xeb\xbd\xcf\xc0\x22\x22\xb7\x23\x84\x40\x87\x0e\x1d\
-\xa4\x10\x42\x0a\x21\xf0\xcc\x33\xcf\xd8\xee\xd7\x7b\xcb\xca\xca\
-\x62\x1b\x16\x11\xb9\xce\x90\x21\x43\x50\x5a\x5a\x0a\xc0\x3a\x2e\
-\x56\x55\x55\x55\xbd\x6d\x58\x06\x83\x01\xad\x5b\xb7\x76\x78\xbd\
-\x0c\x2c\x22\x6a\x72\x0b\x16\x2c\x10\xb6\x43\xc2\xd4\xd4\x54\x91\
-\x9a\x9a\xca\x43\x42\x22\x72\xff\xc3\xc3\xa6\xc4\xc0\x22\x22\x8f\
-\xc1\xc0\x22\x22\x06\x16\x11\x11\x03\x8b\x88\xee\x58\x3c\x4b\x48\
-\x44\x4e\x65\x30\x18\xb0\x65\xcb\x16\x19\x12\x12\x82\x5e\xbd\x7a\
-\x89\x9f\x7e\xfa\x49\x1e\x3a\x74\x08\x6a\xb5\x1a\x0f\x3e\xf8\x20\
-\xc2\xc3\xc3\x1d\x6e\x99\x67\x60\x11\x91\x53\x65\x66\x66\xca\x27\
-\x9f\x7c\x12\x9b\x36\x6d\x42\x41\x41\x81\x4c\x4e\x4e\xc6\xe9\xd3\
-\xa7\x01\x00\x03\x07\x0e\xc4\x8a\x15\x2b\xf6\x07\x07\x07\xc7\xf1\
-\x90\x90\x88\x5c\x2e\x37\x37\x17\x80\xb5\x33\xe9\xfa\xf5\xeb\x71\
-\xfa\xf4\x69\x1c\x3b\x76\x0c\xb3\x67\xcf\xc6\xf6\xed\xdb\x71\xfc\
-\xf8\xf1\x58\x47\xd7\xc5\xc0\x22\x22\xa7\x32\x99\x4c\x00\x80\x53\
-\xa7\x4e\x21\x27\x27\x07\x03\x06\x0c\x40\x44\x44\x84\x18\x37\x6e\
-\x1c\x00\x40\xaf\xd7\x3b\xbc\x2e\x06\x16\x11\x39\xd5\x5d\x77\xdd\
-\x05\x00\x18\x39\x72\x24\xf2\xf2\xf2\xd0\xa7\x4f\x1f\xa8\xd5\x6a\
-\x9c\x3c\x79\x12\x00\xe0\xe7\xe7\xc7\xc0\x22\x22\xf7\x90\x9a\x9a\
-\x2a\x9e\x7c\xf2\x49\xec\xdb\xb7\x0f\xdd\xba\x75\xc3\xc8\x91\x23\
-\x01\x00\xaf\xbc\xf2\x0a\xe2\xe2\xe2\xd0\xa5\x4b\x17\x36\xba\x13\
-\x91\x7b\x50\xa9\x54\x58\xb3\x66\x8d\x58\xb3\x66\x4d\xad\xc7\xbf\
-\xff\xfe\xfb\x06\x5f\xb7\xc3\xc0\x22\xa2\x26\xb7\x71\xe3\x46\x59\
-\x51\x51\x71\xd3\xd7\x19\x8d\x46\x0c\x1a\x34\x08\xad\x5b\xb7\xe6\
-\xbc\x84\x44\xe4\x1a\x93\x27\x4f\xc6\xb9\x73\xe7\x1c\x7a\x6d\x9b\
-\x36\x6d\x1c\x1e\x62\x86\x6d\x58\x44\xd4\xe4\xca\xca\xca\x6a\xcd\
-\x3d\x38\x61\xc2\x04\x44\x45\x45\xe1\xc8\x91\x23\x30\x99\x4c\xc8\
-\xc9\xc9\x41\x9b\x36\x6d\xf0\xc1\x07\x1f\x20\x39\x39\x99\x6d\x58\
-\x44\xe4\x1e\xfe\xfd\xef\x7f\xcb\x65\xcb\x96\xe1\xfc\xf9\xf3\x08\
-\x0c\x0c\x04\x00\xf4\xec\xd9\x13\xeb\xd6\xad\x43\x7c\x7c\x3c\x12\
-\x12\x12\x64\x4c\x4c\x8c\x43\xa1\xc5\x1a\x16\x11\x39\x55\x41\x41\
-\x01\x80\x3f\x27\x54\xb5\xf1\xf1\xf1\x01\x00\x87\x0f\x1d\x19\x58\
-\x44\xe4\x74\x51\x51\x51\x10\x42\x20\x29\x29\xc9\x3e\x6c\xf2\xa1\
-\x43\x87\x30\x62\xc4\x08\xf8\xfa\xfa\xda\x6b\x5d\x3c\x24\x24\x22\
-\x97\x9b\x3a\x75\xaa\xc8\xce\xce\x96\xbb\x77\xef\x46\xab\x56\xad\
-\xec\x8f\x37\x6b\xd6\x0c\x2f\xbd\xf4\x12\xba\x76\xed\xca\x36\x2c\
-\x22\x72\x1f\xdb\xb7\x6f\x17\xdb\xb6\x6d\x93\x79\x79\x79\xb8\x7c\
-\xf9\x32\x5a\xb4\x68\x81\xc4\xc4\x44\xc4\xc7\xc7\x37\xa8\x2f\x16\
-\x03\x8b\x88\x6e\x89\xe4\xe4\x64\x91\x9c\x9c\xdc\xa8\x75\xb0\x0d\
-\x8b\x88\x9c\x6e\xd5\xaa\x55\xf2\xde\x7b\xef\x95\x2a\x95\xaa\xce\
-\xbc\x84\x3b\x76\xec\xe0\xbc\x84\x44\xe4\x1e\x3e\xfb\xec\x33\xf9\
-\xf4\xd3\x4f\x23\x34\x34\x14\x3d\x7b\xf6\xac\x35\x3f\xa1\x5e\xaf\
-\x47\x50\x50\x10\x0f\x09\x89\xc8\x3d\x7c\xff\xfd\xf7\x00\x80\x5d\
-\xbb\x76\xe1\xae\xbb\xee\x6a\xd4\xbc\x5f\x3c\x24\x24\x22\xa7\x8a\
-\x8d\xb5\x8e\xcf\xd7\xb6\x6d\xdb\x46\x4f\x52\xc8\x1a\x16\x11\x39\
-\xd5\xa8\x51\xa3\x44\x4e\x4e\x8e\x7c\xf8\xe1\x87\xe5\xb2\x65\xcb\
-\x10\x1c\x1c\x0c\x29\xad\xcd\x56\x52\x4a\x84\x84\x84\x08\xad\x56\
-\xcb\xc0\x22\x22\xd7\x1b\x37\x6e\x9c\xdc\xb8\x71\x23\x00\x20\x2e\
-\xae\xee\xd0\xed\x19\x19\x19\x32\x25\x25\x85\xa3\x35\x10\x91\xeb\
-\x2d\x58\xb0\x00\xaf\xbd\xf6\x5a\xbd\xd3\xd6\x9b\xcd\x66\x44\x45\
-\x45\xb1\xe3\x28\x11\xb9\x87\x76\xed\xda\x89\x76\xed\xda\xc1\x62\
-\xb1\xc0\x62\xb1\x40\x4a\x09\xb5\x5a\x0d\x93\xc9\x04\x21\x04\x94\
-\x4a\xa5\xc3\xeb\x62\xa3\x3b\x11\x39\x5d\x5e\x5e\x9e\xec\xd3\xa7\
-\x8f\x54\xab\xd5\xd2\xcb\xcb\x4b\xea\xf5\x7a\xc4\xc6\xc6\xca\xb8\
-\xb8\x38\x59\x51\x51\x11\xc9\xc0\x22\x22\xb7\x70\xe4\xc8\x11\x99\
-\x92\x92\x82\xe2\xe2\x62\x3c\xfb\xec\xb3\x00\xac\x33\xe9\xcc\x9c\
-\x39\x13\x07\x0f\x1e\x44\x61\x61\xe1\x09\x06\x16\x11\xb9\x85\x8d\
-\x1b\x37\xe2\xec\xd9\xb3\xd8\xbc\x79\x33\xfa\xf5\xeb\x07\x00\xb0\
-\x58\x2c\x91\xf7\xdd\x77\x1f\x2c\x16\x0b\x1c\x19\x4a\x99\x81\x45\
-\x44\xb7\x44\x49\x49\x09\x00\x20\x26\x26\x06\x66\xb3\x19\x00\x20\
-\xa5\x8c\xb4\xb5\x5d\x59\x2c\x16\x06\x16\x11\xb9\x07\xdb\xa5\x37\
-\x25\x25\x25\x50\xa9\xac\xe7\xf9\xd4\x6a\xf5\xae\x9f\x7f\xfe\x19\
-\x80\x75\x98\x19\x06\x16\x11\xb9\x85\xbf\xff\xfd\xef\xf0\xf2\xf2\
-\xc2\xc4\x89\x13\x51\x59\x59\x09\x00\x28\x2f\x2f\x97\xaf\xbe\xfa\
-\x2a\xba\x75\xeb\x86\x4e\x9d\x3a\x3d\xcb\xc0\x22\x22\xb7\xf0\xd0\
-\x43\x0f\x89\x97\x5f\x7e\x19\x99\x99\x99\x18\x37\x6e\x1c\x84\x10\
-\x08\x0f\x0f\x47\x59\x59\x19\xd2\xd3\xd3\x11\x18\x18\xb8\xd4\xd1\
-\x75\x39\xde\x0f\x4b\x4a\xa0\x9e\x8e\x5f\xc6\x3f\x8e\x43\xab\x85\
-\x80\xd4\x68\x1a\xb4\xec\x5f\x7d\x4f\x87\x97\x69\xe8\xf2\xb6\xd7\
-\x37\xe6\xf3\x02\xb7\x66\xd9\xbf\xfa\x19\xdd\x65\xfb\x78\xe2\xb6\
-\x6d\xcc\xe7\xbd\x45\xdb\xd4\xf6\x7d\x34\x00\x75\xbf\x8f\x4d\xb9\
-\xcf\x34\xd0\xdc\xb9\x73\xc5\xa3\x8f\x3e\x2a\xd7\xaf\x5f\x8f\xb2\
-\xb2\x32\xb4\x6b\xd7\x0e\x13\x26\x4c\x68\xf0\xc5\xd0\x8e\x07\x96\
-\x10\xc0\xff\xfe\x27\x51\x54\x04\xec\xd8\x61\xfd\x5b\xa3\xc1\xd8\
-\x03\x07\xd0\x15\x80\xdf\xe5\xcb\x08\x78\xeb\x2d\xc0\xcf\xaf\xf6\
-\xd8\x36\x21\x21\xc0\xd4\xa9\x02\xb9\xb9\x12\x97\x2f\x03\xbb\x77\
-\x03\x6a\xf5\xcd\xdf\xaf\x7d\x7b\x60\xe2\x44\xeb\x7f\xc6\x60\x00\
-\xf6\xed\x93\xf8\xf1\x47\xe0\xe2\xc5\x1b\xfc\x6f\x54\xc0\xec\xd9\
-\xa2\xd6\x67\x2e\x2c\x94\x38\x79\x12\xf8\xfa\x6b\x40\xa1\xb8\xfe\
-\x8e\xd2\xb5\x2b\xf0\xc4\x13\xc2\xbe\xdc\xf1\xe3\x12\x67\xce\x00\
-\xd9\xd9\x80\x23\x1d\xdb\x14\x0a\x60\xce\x1c\xeb\xf2\x39\x39\xd6\
-\xff\xeb\x77\xdf\x01\x2a\x15\x24\x00\x93\xc5\x02\xa5\x42\x51\x7f\
-\x95\x36\x3a\x1a\x18\x31\xc2\xba\xec\x8e\x1d\xd6\x32\xfe\xdf\xff\
-\xae\xbf\x73\x55\x57\x03\x0b\x16\x88\x5a\x9f\x7f\xe7\x4e\x89\x5f\
-\x7e\x01\xce\x9c\xb9\xf9\x67\x35\x18\x80\x57\x5f\x05\x42\x42\xfe\
-\xfc\xff\xee\xd9\x23\x71\xe9\x12\x90\x9b\x6b\x2d\xc7\x9b\x7d\xb1\
-\xba\x75\x03\x86\x0c\xb1\x2e\x5f\x51\x11\x89\x1f\x7f\x3c\x81\x7d\
-\xfb\xac\x9f\xed\x7a\x9a\x37\x07\x5e\x79\xe5\xcf\xf7\x3c\x77\x6e\
-\x3d\x7e\xfe\x79\x18\xf6\xee\x05\x4c\xa6\xeb\x2f\x67\x36\x03\x03\
-\x06\x00\xbd\x7a\xd5\xde\xb6\xdf\x7c\x23\x71\xf1\x22\xf0\x7f\xff\
-\x77\xe3\xcf\x7c\x75\x79\x09\x01\xec\xda\x25\x51\x5e\x0e\xe4\xe7\
-\x5f\x7f\xdb\xea\xf5\xc0\xbc\x79\x02\xb6\x2f\xbd\x10\xd6\x32\x2e\
-\x2b\x03\x7e\xfe\xf9\xfa\xfb\x92\x4d\xdb\xb6\xc0\x73\xcf\x09\xec\
-\xdb\x67\xdd\x17\xf6\xee\xbd\xf1\x67\xbc\x72\x05\x78\xef\xbd\xda\
-\x1b\xfc\xfc\xf9\x79\x98\x34\x29\x0d\xa7\x4e\x59\xdf\xdf\x68\x04\
-\x2e\x5f\x06\x02\x02\x80\xa4\x24\xeb\xfd\x19\x33\x1e\xc5\xfe\xfd\
-\x3b\x51\x56\x06\x1c\x3b\x86\xa7\x0f\x1d\xc2\x83\x00\x02\x2e\x5e\
-\x44\xb3\xb7\xde\xb2\xee\x8b\x2d\x5b\x02\x1f\x7e\x08\x44\x44\xb8\
-\x24\xad\x3e\xf9\xe4\x13\x99\x91\x91\x81\xed\xdb\xb7\xa3\x77\xef\
-\xde\xf6\xc7\x2f\x5e\xbc\x88\xc4\xc4\x44\xb9\x70\xe1\x42\x44\x47\
-\x47\x3b\xe1\xd2\x1c\x5f\xdf\x7f\x22\x24\x24\x0d\xb1\xb1\xd6\x02\
-\xd4\xe9\x50\x94\x9d\x8d\xfd\x00\x82\xd5\x6a\xd4\xdc\x73\x0f\x10\
-\x1c\x5c\x7b\x19\x3f\x3f\xeb\xbf\x2d\x5b\x5a\xef\x77\xeb\xe6\x58\
-\x00\x5c\x3d\x46\x8e\x52\x09\x84\x85\x59\x37\xd8\x95\x2b\x37\x0e\
-\x8d\x6b\x35\x6b\x96\x8f\x90\x90\x58\xc4\xc6\xde\x38\xb0\xda\xb5\
-\xab\xfb\xb9\x2d\x16\x20\x2e\xee\xe6\x3b\xe7\xb5\x35\xa3\x90\x10\
-\xc0\xdf\xdf\xba\xac\x52\x09\x8b\xc5\x82\x9d\x07\x0f\x22\x2e\x22\
-\x02\x2d\xfd\xfd\xeb\xbe\x77\xdb\xb6\x7f\xfe\x1d\x16\x06\x78\x79\
-\x01\x2d\x5a\x5c\x3f\xb0\x8c\xc6\xba\x8f\x85\x85\x59\xcb\x29\x24\
-\xe4\xe6\xbf\xa2\x46\x23\xa0\xd3\xd5\x7e\x51\x68\xa8\xf5\x8b\x50\
-\x53\x73\xf3\xed\x23\x25\x10\x1e\xfe\xe7\xdf\x5e\x5e\x85\x08\x0d\
-\x05\x62\x62\x6e\x1c\x3c\xd7\xcc\x9a\x02\x8d\x66\x38\x42\x42\x24\
-\xee\xbf\xdf\x5a\xd6\xd7\x63\xb1\x58\xff\x5f\xd7\xb2\x7d\x66\x93\
-\xe9\xc6\x9f\xf9\xda\xcf\x14\x16\x66\xdd\x3e\x42\x5c\x7f\xdb\xd6\
-\x57\x0e\x61\x61\x40\xb3\x66\xd6\xed\x73\xb3\x7d\xc2\x36\xb1\x42\
-\xab\x56\xd6\x7d\xe9\x8f\x7d\xe1\xba\x6a\x6a\xea\x3e\xa6\xd1\x4c\
-\x43\x62\x62\x1a\xca\xcb\xff\x0c\x6e\x83\xc1\x5a\x8e\xf7\xde\x6b\
-\xbd\xaf\xd1\xec\xb2\x7f\x2e\x7f\x7f\x9c\xf8\xea\x2b\xec\x07\xd0\
-\xca\xcb\x0b\xc6\x7b\xef\xb5\xbe\xb7\x9f\x1f\xe0\xeb\x9b\xef\xaa\
-\x43\xc2\xfc\xfc\x7c\x7c\xf5\xd5\x57\x75\x1e\xaf\xac\xac\xc4\x9e\
-\x3d\x7b\x50\x52\x52\x82\xe8\xe8\x68\x47\x6b\xa1\xd2\xb1\xdb\x1f\
-\x5d\xea\xaf\xbd\x0d\x19\x3e\x5c\x02\x90\x41\x21\x21\xb2\xf8\xf4\
-\x69\xd9\x90\x65\xff\xea\x7b\x3a\xbc\x4c\x43\x97\xb7\xbd\xbe\x31\
-\x9f\xb7\x9e\x65\x8d\x52\xe2\xed\x7f\xfe\x53\xfe\x52\x54\x24\x1b\
-\xba\x6c\x93\x96\x4d\x53\xaf\xab\x31\xdb\xc7\x13\xb7\xad\xb3\x97\
-\x69\x82\x6d\x9a\x94\x92\x22\x01\xc8\x96\xad\x5b\xcb\x92\x73\xe7\
-\xa4\xd3\xf6\x99\x3f\x6e\xd3\xa7\x4f\x97\xeb\xd6\xad\xab\x77\xbf\
-\x3e\x74\xe8\x90\x3c\x71\xe2\x84\x1c\xfe\x47\x46\x14\x15\x15\xc9\
-\xc3\x87\x0f\xcb\xc3\x87\x0f\xcb\x23\x47\x8e\xc8\xb9\x73\xe7\x4a\
-\x00\xf2\xdb\x6f\xbf\x95\x8e\xbe\x5f\xc3\x0e\x09\xeb\xa1\xfc\xe3\
-\x97\x51\x25\x25\xc4\xf5\x7e\x5d\xff\xea\x71\xf3\x5f\x59\xee\xea\
-\x65\x1a\xba\xbc\xed\xf5\x4d\xfc\x79\xa5\xd1\x88\x73\x25\x25\xa8\
-\xae\xaa\x6a\xba\xff\x6b\x53\xb6\x45\xb8\x62\xfb\xdc\x26\xdb\xb6\
-\x49\x97\x69\x82\x6d\x6a\xfb\x3e\xaa\xeb\xab\x59\xde\xe2\xf6\xab\
-\xbb\xef\xbe\xfb\xaa\x83\x24\x25\x22\x22\x22\xea\xbc\x66\xc8\x90\
-\x21\xf8\xdb\xdf\xfe\x56\xde\xf4\x6d\x58\x44\x44\x0d\x70\xe8\xd0\
-\x21\xe8\x74\x3a\xbc\xf0\xc2\x0b\xc8\xcc\xcc\x44\x71\x71\x31\xf4\
-\x7a\xbd\xfd\x79\xb5\x5a\x8d\xe0\xe0\x60\xe1\x7f\x6d\x33\x09\x03\
-\x8b\x88\x6e\x35\xdb\x19\xc0\x6d\xdb\xb6\x5d\xf7\x35\x66\xb3\x19\
-\x16\x8b\xa5\xd6\x38\xef\x37\xc2\x7e\x58\x44\xe4\x54\xd3\xa7\x4f\
-\x97\x4b\x96\x2c\x91\xd5\xd7\x9c\x41\x3e\x75\xea\x94\x7c\xf6\xd9\
-\x67\xe5\xbe\x7d\xfb\x1c\x9e\x35\x87\x81\x45\x44\x4e\x55\x55\x55\
-\x85\xe7\x9f\x7f\x1e\x03\x07\x0e\x94\x47\x8e\x1c\x91\x00\xb0\x62\
-\xc5\x0a\xd9\xbb\x77\x6f\x2c\x5b\xb6\xac\x41\xd7\x12\xf2\x90\x90\
-\x88\x9c\x6a\xe1\xc2\x85\x22\x31\x31\x51\x3e\xf7\xdc\x73\x48\x48\
-\x48\x40\x68\x68\xa8\x3c\x7c\xf8\x30\x3a\x77\xee\x8c\x1f\x7e\xf8\
-\x01\x71\x71\x71\x0e\x9f\x0d\x60\x0d\x8b\x88\x9c\x6e\xd0\xa0\x41\
-\xe2\xcc\x99\x33\xe2\xb9\xe7\x9e\xc3\xaf\xbf\xfe\x8a\xf9\xf3\xe7\
-\xe3\xe8\xd1\xa3\xa2\x21\x61\xc5\x1a\x16\x11\xdd\x12\xbf\xff\xfe\
-\xbb\x5c\xb9\x72\x25\xb2\xb2\xb2\x00\x00\x59\x59\x59\x68\xd1\xa2\
-\x85\x1c\x3d\x7a\xb4\x50\x3b\x72\xe5\x0b\x6b\x58\x44\x74\x2b\x2c\
-\x5d\xba\x54\x3e\xf0\xc0\x03\x98\x36\x6d\x1a\x1e\x7f\xfc\x71\x1c\
-\x3e\x7c\x18\x42\x08\x3c\xfd\xf4\xd3\xe8\xda\xb5\xab\x3c\x74\xe8\
-\x10\x1b\xdd\x3d\x4d\x41\x41\x81\xdc\xbd\x7b\xb7\xbc\xba\x9f\x8a\
-\x4d\x4e\x4e\x8e\xdc\xbf\x7f\xbf\xb4\x0d\x7e\x46\xe4\x49\xf2\xf3\
-\xf3\x61\x36\x9b\xf1\xe3\x8f\x3f\x62\xfa\xf4\xe9\x22\x32\x32\x52\
-\xec\xda\xb5\x4b\x2c\x5f\xbe\x1c\x05\x05\x05\x38\x7d\xfa\x34\x6b\
-\x58\x9e\xe6\x9d\x77\xde\xc1\x84\x09\x13\x70\xea\xd4\xa9\x3a\xbf\
-\x36\xa3\x46\x8d\xc2\x9c\x39\x73\x60\x30\x18\x58\x50\xe4\x71\x86\
-\x0f\x1f\x8e\x13\x27\x4e\x88\xfb\xef\xbf\xbf\x56\x7b\xd5\xd3\x4f\
-\x3f\x2d\x0e\x1c\x38\x80\xce\x9d\x3b\x3b\xbc\x2e\xb6\x61\xb9\x89\
-\xea\xea\x6a\x18\x0c\x86\x3a\xa7\x78\x8f\x1d\x3b\x26\x2f\x5c\xb8\
-\x00\xb3\xd9\x5c\xef\xbc\x6e\x44\xee\x48\x4a\x69\xdf\x5f\xfb\xf4\
-\xe9\x73\xdd\x1d\xd7\xd1\x51\x1a\x58\xc3\x72\x03\x45\x45\x45\x52\
-\x08\x21\x85\x10\x72\xdd\xba\x75\x38\x7b\xf6\x2c\xa2\xa2\xa2\x60\
-\x7b\x4c\x08\x21\xa3\xa2\xa2\x10\x1e\x1e\x8e\xf1\xe3\xc7\x43\x73\
-\xbd\xf1\xc6\x88\xdc\x8c\x10\x02\x42\x08\x39\x70\xe0\x40\x79\xd5\
-\x63\x72\xf4\xe8\xd1\xf6\xbf\x4f\x9d\x3a\x25\x85\x10\x72\xe7\xce\
-\x9d\x0e\xb7\x61\xb1\x86\xe5\x42\x61\x61\x61\x62\xf7\xee\xdd\x52\
-\xab\xd5\x62\xfd\xfa\xf5\x38\x7e\xfc\x38\x26\x4e\x9c\x88\xab\xaf\
-\xad\x52\xab\xd5\x08\x09\x09\x41\xa7\x4e\x9d\x58\xbd\x22\x8f\x73\
-\x6d\xbb\x6b\x7d\xed\xb0\x52\x3a\x9c\x57\x0c\x2c\x57\xd2\x68\x34\
-\x48\x4c\x4c\x14\x00\xd0\xad\x5b\x37\x48\x29\xe1\xe5\xe5\xc5\x82\
-\x21\xe2\x21\xa1\x7b\x33\x1a\x8d\xd8\xb0\x61\x83\xec\xd1\xa3\x87\
-\xf4\xf7\xf7\x97\x3a\x9d\xce\x7e\xf3\xf2\xf2\x92\xfd\xfb\xf7\xaf\
-\xf7\x0c\x22\xd1\x9d\x84\x35\x2c\x37\xf1\xee\xbb\xef\xca\xf4\xf4\
-\x74\xc4\xc6\xc6\x62\xe2\xc4\x89\xb5\x1a\xd8\xa5\x94\x88\x8a\x8a\
-\xb2\x4f\x91\x44\xe4\x29\x6a\x6a\x6a\x60\x30\x18\xec\xfb\x73\x75\
-\x75\x35\xf4\x7a\x3d\xf4\x7a\xfd\xfa\x0b\x17\x2e\x30\xb0\x3c\xd5\
-\x89\x13\x27\xe0\xed\xed\x8d\xa5\x4b\x97\x22\x26\x26\x86\xed\x55\
-\x74\x5b\xd8\xb3\x67\x0f\x74\x3a\x9d\xbd\x91\x2a\x23\x23\x03\x3e\
-\x3e\x3e\xb5\x1a\xad\x1a\xd2\xbf\x90\x81\xe5\xe2\xc3\x40\x00\x50\
-\x28\x14\x98\x33\x67\x0e\x2e\x5d\xba\x84\x6d\xdb\xb6\x21\x2a\x2a\
-\xaa\xce\xf8\x40\x0a\x85\x02\x0a\x85\x82\x5d\x1b\xc8\x63\xec\xdc\
-\xb9\xf3\xa6\xe3\x5c\x99\x4c\x26\xc4\xc5\xc5\x39\x3c\x2f\x21\x03\
-\xcb\x85\x82\x82\x82\xa4\x4e\xa7\x03\x60\x3d\x1b\x58\x5e\x5e\x8e\
-\xcd\x9b\x37\xe3\xbd\xf7\xde\x93\x57\x77\x61\x30\x9b\xcd\xe8\xd5\
-\xab\x17\x56\xae\x5c\x29\xbc\xaf\x9d\xc8\x81\xc8\x4d\xf5\xed\xdb\
-\xb7\xc9\x7f\x5d\x19\x58\x2e\xb4\x78\xf1\x62\x5c\x7d\xe1\xa7\xad\
-\x06\x65\xf9\x63\xb2\x80\xab\x85\x86\x86\xf2\x0c\x22\xdd\xf1\x18\
-\x58\x2e\x34\x76\xec\x58\x1e\xdf\x11\x31\xb0\x3c\xcf\xba\x75\xeb\
-\x64\x41\x41\x01\xb4\x5a\x2d\xcc\x66\xb3\xfd\xd2\x06\x5b\xad\xcb\
-\xcb\xcb\x0b\x6d\xdb\xb6\x45\xf7\xee\xdd\x11\x1e\x1e\x2e\x94\x8e\
-\xcc\xed\x48\xc4\xc0\x22\x67\x38\x73\xe6\x0c\xd6\xac\x59\x83\x13\
-\x27\x4e\xa0\x67\xcf\x9e\x68\xd5\xaa\x15\x2e\x5e\xbc\x88\x1d\x3b\
-\x76\x20\x2c\x2c\x0c\x5d\xbb\x76\xc5\x0f\x3f\xfc\x80\x66\xcd\x9a\
-\x61\xe6\xcc\x99\x72\xd4\xa8\x51\x82\xdd\x1c\xe8\x4e\xc3\x8e\xa3\
-\x6e\xa2\x4b\x97\x2e\xd0\x6a\xb5\xf8\xe8\xa3\x8f\x90\x99\x99\x89\
-\x55\xab\x56\x21\x23\x23\x03\xd9\xd9\xd9\xb0\x58\x2c\x48\x4e\x4e\
-\xc6\x96\x2d\x5b\xe0\xe7\xe7\x87\x37\xde\x78\x03\xbf\xfc\xf2\x8b\
-\x64\xa9\x11\x6b\x58\xe4\x12\xab\x57\xaf\xc6\xd9\xb3\x67\xf1\xf0\
-\xc3\x0f\xa3\x59\xb3\x66\xf6\xc7\xfb\xf7\xef\x8f\xca\xca\x4a\x6c\
-\xda\xb4\x09\x93\x26\x4d\x42\xbf\x7e\xfd\xb0\x70\xe1\x42\x54\x54\
-\x54\xb0\xd0\xc8\x63\xe4\xe6\xe6\xca\xe5\xcb\x97\xa3\xb0\xb0\x10\
-\xa6\xab\x26\x78\xd5\xeb\xf5\x58\xb2\x64\x09\xba\x75\xeb\xe6\x50\
-\x7b\x2e\x03\xcb\x4d\x74\xe8\xd0\x01\x97\x2f\x5f\xc6\x87\x1f\x7e\
-\x88\x29\x53\xa6\x20\x20\x20\x00\x7a\xbd\x1e\xab\x57\xaf\x46\x65\
-\x65\x25\x22\x22\x22\x50\x55\x55\x85\xa2\xa2\x22\xf8\xf9\xf9\xa1\
-\x21\x93\x4f\x12\xb9\x52\x56\x56\x96\x1c\x3e\x7c\x38\xaa\xea\x99\
-\xf9\x5c\x4a\x89\xf2\x72\x87\x27\x7e\x66\x60\xb9\x8b\xa9\x53\xa7\
-\xfe\xd3\x6c\x36\xa7\x2d\x5f\xbe\x1c\x6b\xd6\xac\x81\x8f\x8f\x0f\
-\xaa\xaa\xaa\x20\x84\xc0\x84\x09\x13\x30\x63\xc6\x0c\x94\x96\x96\
-\x22\x2c\x2c\x0c\x73\xe7\xce\x45\x87\x0e\x1d\x78\x86\x91\x3c\xc2\
-\x57\x5f\x7d\x85\xca\xca\x4a\xac\x5e\xbd\x1a\x23\x47\x8e\x6c\xd4\
-\x7e\xcb\xc0\x72\x13\x41\x41\x41\xd3\xd2\xd3\xd3\xa7\x4d\x9a\x34\
-\x49\x96\x96\x96\xa2\xa6\xa6\x06\x2a\x95\x0a\x41\x41\x41\x88\x88\
-\x88\x10\xb6\x1e\xee\xef\xbe\xfb\x2e\x7b\xbb\x93\x47\x69\xd3\xa6\
-\x0d\x00\x34\x3a\xac\x18\x58\x2e\xf6\xed\xb7\xdf\xca\xb0\xb0\x30\
-\x74\xec\xd8\x51\x1c\x3b\x76\x4c\x9e\x3b\x77\x0e\x4a\xa5\x12\x0a\
-\x85\x02\x4a\xa5\x12\x52\x4a\x94\x95\x95\xa1\xa4\xa4\x44\x36\x6f\
-\xde\x1c\x9d\x3b\x77\x66\x77\x06\xf2\x38\x69\x69\x69\xe2\xe8\xd1\
-\xa3\xf2\xf1\xc7\x1f\x97\x5f\x7c\xf1\x85\xd0\x6a\xb5\x0c\x2c\x4f\
-\xd4\xab\x57\x2f\x8c\x1d\x3b\x16\x2b\x57\xae\xc4\xcc\x99\x33\xb1\
-\x61\xc3\x86\x7a\xaf\xbd\xb2\x58\x2c\xe8\xdb\xb7\xaf\xed\xc2\x51\
-\x16\x1c\x79\x94\xb1\x63\xc7\xca\x55\xab\x56\x01\x40\xad\x0b\xa1\
-\x6d\x32\x33\x33\x31\x70\xe0\x40\x36\xba\xbb\xbb\xd2\xd2\xd2\x7c\
-\xad\x56\x1b\x27\xa5\xc4\xb2\x65\xcb\xc4\xe2\xc5\x8b\xf7\xab\xd5\
-\xea\xe1\x4a\xa5\xb2\x50\x08\x01\xa3\xd1\xd8\x57\xa9\x54\xee\x52\
-\x28\x14\xb0\x58\x2c\xe0\x75\x84\xe4\x89\x06\x0d\x1a\x84\xa0\xa0\
-\xa0\x7a\x9b\x32\xaa\xab\xab\xd1\xb1\x63\x47\xd6\xb0\x3c\x41\x70\
-\x70\x70\x9c\xed\x7e\xb3\x66\xcd\x60\x32\x99\xa6\x6d\xdd\xba\xf5\
-\x44\x4e\x4e\x0e\x2e\x5c\xb8\x80\x97\x5e\x7a\x09\x07\x0e\x1c\xc0\
-\xb7\xdf\x7e\x8b\x79\xf3\xe6\xc1\xcf\xcf\x8f\x8d\x57\xe4\x71\x86\
-\x0d\x1b\x26\x86\x0d\x1b\xd6\x24\xeb\x62\xc7\x51\x37\x51\x5c\x5c\
-\x2c\x47\x8d\x1a\xb5\xf3\xe5\x97\x5f\xc6\x6f\xbf\xfd\x86\x8c\x8c\
-\x0c\x1c\x3d\x7a\x14\xd1\xd1\xd1\xd8\xb0\x61\x03\x3e\xfd\xf4\x53\
-\xfb\x70\x34\x44\xee\xce\x6c\x36\xdb\xc7\xb9\xb2\x58\x2c\xf6\xbf\
-\xaf\xbd\x99\x4c\xa6\x06\x8d\xe9\xce\xc0\x72\x13\x9f\x7e\xfa\x29\
-\xf6\xed\xdb\x87\xcf\x3f\xff\x1c\xef\xbe\xfb\x2e\x00\x6b\x1f\x95\
-\x9e\x3d\x7b\xc2\xd7\xd7\x17\x07\x0f\x1e\x64\x60\x91\xc7\x68\xd5\
-\xaa\x95\x54\xa9\x54\x12\x00\x46\x8e\x1c\x29\x55\x2a\x55\xbd\x37\
-\xb5\x5a\x2d\x33\x33\x33\x39\x6b\x8e\x07\xd6\xb0\xe0\xed\xed\x8d\
-\xce\x9d\x3b\xe3\xf2\xe5\xcb\xb5\x7f\x55\xfe\x68\xc3\x22\xf2\x14\
-\xcb\x97\x2f\xb7\xef\xc7\x2f\xbe\xf8\x22\x92\x92\x92\xea\x6d\xc3\
-\xfa\x63\x00\x3f\x87\xd7\xcb\xc0\x72\x13\x91\x91\x91\xd0\xeb\xf5\
-\x28\x2a\x2a\xb2\xf7\x5b\xd1\x6a\xb5\xc8\xcb\xcb\x83\xc1\x60\x40\
-\xe7\xce\x9d\x39\xa6\x3b\x79\x8c\x41\x83\x06\xd9\xd3\xa9\x47\x8f\
-\x1e\xa2\x47\x8f\x1e\x4d\xb2\x5e\x7e\x03\xdc\xc4\xc4\x89\x13\xb1\
-\x67\xcf\x1e\x8c\x1d\x3b\x16\x89\x89\x89\x00\xac\xd7\x17\x16\x14\
-\x14\x20\x32\x32\x12\xcf\x3f\xff\x3c\x07\xf0\xa3\x3b\x1e\x03\xcb\
-\x4d\xb4\x6d\xdb\x56\x64\x64\x64\xcc\xfb\xe8\xa3\x8f\xd2\x16\x2f\
-\x5e\x0c\x00\xf8\xcf\x7f\xfe\x83\x49\x93\x26\x61\xfa\xf4\xe9\xcf\
-\x06\x06\x06\x2e\x65\x29\x91\xa7\xaa\xa9\xa9\xc1\xd7\x5f\x7f\x2d\
-\x8b\x8b\x8b\x61\x30\x18\xec\x0d\xed\x35\x35\x35\x18\x33\x66\x0c\
-\xda\xb7\x6f\xcf\x7e\x58\x9e\x26\x28\x28\x68\xda\xf4\xe9\xd3\xa7\
-\x4d\x9f\x3e\x9d\x85\x41\xb7\x8d\x8b\x17\x2f\x22\x25\x25\x45\xe6\
-\xe6\xe6\xd6\x7b\xe2\x28\x26\x26\x06\xed\xdb\xb7\x67\x0d\xcb\xdd\
-\x19\x8d\x46\x1c\x3d\x7a\x54\xda\x46\x17\xbd\x1e\x29\x25\x7c\x7c\
-\x7c\x10\x19\x19\x29\x78\x1d\x21\x79\x9a\xa5\x4b\x97\xca\x9c\x9c\
-\x1c\xbc\xf0\xc2\x0b\x78\xe4\x91\x47\x30\x74\xe8\x50\x9c\x3f\x7f\
-\x1e\xa9\xa9\xa9\x48\x48\x48\xc0\x63\x8f\x3d\xe6\xf0\x4e\xcd\xc0\
-\x72\xa1\x53\xa7\x4e\xc9\xe8\xe8\x68\x68\xb5\x5a\x08\x21\x20\x84\
-\x80\x8f\x8f\x0f\xa4\x94\xb8\x7c\xf9\xb2\xfd\x32\x1d\x8b\xc5\x82\
-\x3e\x7d\xfa\x60\xed\xda\xb5\xb5\xc6\xca\x22\xf2\x04\xc5\xc5\xc5\
-\x00\x80\x45\x8b\x16\xe1\xcb\x2f\xbf\xb4\x3f\xfe\xd6\x5b\x6f\xe1\
-\xee\xbb\xef\x46\xaf\x5e\xbd\x64\x6c\x6c\x2c\x0f\x09\xdd\x5d\x78\
-\x78\xb8\x28\x2a\x2a\x92\x00\x20\x84\x40\x45\x45\x05\x06\x0f\x1e\
-\x0c\x5f\x5f\x5f\x9c\x3c\x79\x52\x94\x94\x94\x48\x5b\x8d\x4a\xab\
-\xd5\xc2\xd7\xd7\x97\x85\x46\x1e\xc7\x76\xd6\xbb\xb2\xb2\xd2\x7e\
-\x79\xd9\x81\x03\x07\xec\x3f\xc8\x0d\x99\x01\x9a\x81\xe5\x42\x4a\
-\xa5\xb2\x56\x63\xe3\x1f\x1d\xe9\xa0\xd1\x68\xa0\xd3\xe9\x10\x11\
-\x11\xc1\xe3\x3f\xf2\x78\x23\x47\x8e\x44\x7a\x7a\x3a\x5e\x7a\xe9\
-\x25\xcc\x99\x33\x07\x1d\x3b\x76\xc4\x80\x01\x03\x00\x00\x81\x81\
-\x81\x68\xd9\xb2\x25\x03\xcb\x13\xb1\x73\x28\xdd\x8e\x7c\x7c\x7c\
-\xf2\x8b\x8a\x8a\x62\xc3\xc2\xc2\x04\x00\x7c\xfc\xf1\xc7\x72\xf6\
-\xec\xd9\x30\x18\x0c\x78\xed\xb5\xd7\x70\xdf\x7d\xf7\xb1\x0d\xcb\
-\x13\x69\x34\x9a\x72\xa5\x52\xd9\x9c\x1d\x44\xe9\x76\x92\x96\x96\
-\x16\xbb\x62\xc5\x0a\x7b\x57\x86\xc4\xc4\x44\x61\xeb\x6b\xd8\x50\
-\xfc\x66\xb8\xd0\xef\xbf\xff\x2e\xfb\xf7\xef\x0f\x95\x4a\x05\x21\
-\x04\x4c\x26\x13\x8e\x1f\x3f\x0e\xa5\x52\x89\x07\x1f\x7c\x50\x56\
-\x57\x57\x43\x08\x01\xb3\xd9\x8c\xee\xdd\xbb\x63\xe1\xc2\x85\xc2\
-\x36\xb5\x3d\x91\xa7\x88\x8f\x8f\xc7\x8a\x15\x2b\x50\x5c\x5c\x2c\
-\x1d\xed\x6f\xc5\xc0\x72\x43\x3a\x9d\xae\xc3\xd0\xa1\x43\x4f\x5c\
-\xdd\x83\x7d\xf4\xe8\xd1\x00\x50\x6b\x66\x11\x29\x25\x3a\x74\xe8\
-\x00\x8e\x36\x4a\x9e\x68\xc2\x84\x09\x22\x37\x37\x57\xf6\xee\xdd\
-\x1b\x1b\x37\x6e\x94\x5d\xba\x74\xb1\x77\xcf\x91\x52\x42\xa7\xd3\
-\xd5\x3b\x70\x25\x03\xcb\xcd\x04\x04\x04\x14\xa6\xa7\xa7\xb3\x61\
-\x9d\x6e\x6b\xc3\x87\x0f\x97\x1b\x36\x6c\x00\x00\xdb\x85\xce\xb5\
-\x46\x67\xd8\xb2\x65\x4b\xad\x6b\x0f\x19\x58\x44\xe4\x32\x6f\xbf\
-\xfd\x36\xa6\x4e\x9d\x8a\x73\xe7\xce\xd5\x79\xce\x64\x32\xa1\x47\
-\x8f\x1e\x0e\xcf\xf3\xc5\xc0\x22\x22\xa7\x5a\xbc\x78\x31\x16\x2d\
-\x5a\x04\x29\x65\xa3\x8f\x26\x38\x80\x1f\x11\x39\x95\xed\xea\x8c\
-\xa6\xe8\xb6\xc3\xc0\x22\x22\xa7\x9a\x32\x65\x0a\xe2\xe3\xe3\x91\
-\x96\x96\x26\xaf\x3e\x99\xf4\x57\xf0\x90\xd0\x4d\x48\x29\xf1\xeb\
-\xaf\xbf\xca\x82\x82\x02\x54\x55\x55\xd5\x1a\xe7\x5a\x4a\x89\xd0\
-\xd0\x50\xf4\xee\xdd\x5b\xb0\x8f\x16\x79\x9a\x8f\x3f\xfe\x18\x05\
-\x05\x05\xc8\xcb\xcb\xc3\xc6\x8d\x1b\xa5\x97\x97\x97\xfd\x62\xff\
-\xca\xca\x4a\xac\x5b\xb7\x0e\xf1\xf1\xf1\x6c\x74\xf7\x24\x19\x19\
-\x19\x32\x2d\x2d\x0d\xbf\xff\xfe\x3b\xee\xb9\xe7\x9e\x5a\xa3\x8b\
-\x5a\x2c\x16\xc4\xc5\xc5\x21\x21\x21\x81\xa3\x8e\x92\xc7\xa9\xa8\
-\xa8\x80\xc5\x62\x81\x8f\x8f\x0f\xca\xcb\x6b\xb7\xaf\x57\x56\x56\
-\xa2\xba\xba\x9a\x35\x2c\x4f\xb3\x61\xc3\x06\x94\x94\x94\x60\xd3\
-\xa6\x4d\x48\x48\x48\xa8\xf3\x6b\xa3\x50\x28\xa0\xd1\x68\x58\x50\
-\xe4\x71\xde\x7f\xff\x7d\xf1\xfe\xfb\xef\x37\xc9\xba\xd8\x86\xe5\
-\x26\xfa\xf5\xeb\x87\xc0\xc0\x40\x68\x34\x1a\x68\xb5\x5a\xe8\x74\
-\xba\x5a\x37\x86\x15\x79\xba\xcf\x3f\xff\x5c\x8e\x19\x33\x46\xf6\
-\xea\xd5\x4b\xd6\xd4\xd4\xe0\xa9\xa7\x9e\x92\x6f\xbd\xf5\x96\xb4\
-\x4d\x07\xc6\x1a\x96\x07\x09\x08\x08\x40\x78\x78\x38\x46\x8c\x18\
-\x81\xd1\xa3\x47\xcb\xa0\xa0\x20\x7b\x3b\x96\xad\xa7\xfb\xd0\xa1\
-\x43\x05\xc7\x75\x27\x4f\x94\x94\x94\x24\xb3\xb2\xb2\xec\x7f\xd7\
-\xd4\xd4\xa0\x7d\xfb\xf6\x58\xb2\x64\x09\x9e\x7c\xf2\x49\xd9\xb1\
-\x63\x47\xb6\x61\x79\x92\xdc\xdc\x5c\x9c\x3b\x77\x0e\xe1\xe1\xe1\
-\xd8\xb3\x67\x0f\xae\x1e\x85\xd4\x76\x2d\x61\x4a\x4a\x0a\x0b\x8a\
-\x3c\xce\xea\xd5\xab\x65\x76\x76\x36\xa6\x4c\x99\x82\x7e\xfd\xfa\
-\x21\x25\x25\x05\x26\x93\x29\x32\x29\x29\x09\xb3\x67\xcf\x46\x49\
-\x49\x89\xc3\xd3\xd5\x33\xb0\xdc\x80\x94\x12\xf3\xe7\xcf\x17\xf3\
-\xe7\xcf\x67\x61\xd0\x6d\xe7\x87\x1f\x7e\x80\x94\x12\x0b\x17\x2e\
-\xc4\x96\x2d\x5b\x6c\xfb\x7c\x64\x48\x48\x08\x00\xe0\xca\x95\x2b\
-\x3c\x24\xf4\x04\x59\x59\x59\xb2\x75\xeb\xd6\x88\x8e\x8e\x16\x07\
-\x0f\x1e\x94\xbf\xfd\xf6\x1b\xd4\x6a\x75\xbd\x81\x16\x18\x18\x88\
-\xae\x5d\xbb\x0a\x5e\x00\x4d\x9e\xc6\xd6\x61\x54\xa5\x52\xd9\xef\
-\x0b\x21\x0a\xcf\x9f\x3f\x0f\x00\x0d\x9a\xbe\x8e\x81\xe5\xda\xe3\
-\x7a\x0c\x19\x32\x04\x9b\x36\x6d\xc2\xeb\xaf\xbf\x8e\xed\xdb\xb7\
-\x5f\xf7\xb5\xdd\xbb\x77\xc7\xae\x5d\xbb\x38\x4c\x32\x79\x8c\xf3\
-\xe7\xcf\xcf\xf3\xf5\xf5\x9d\x76\xd7\x5d\x77\x01\x00\xb6\x6e\xdd\
-\x6a\xef\x96\xa3\x50\x28\x0a\x37\x6f\xde\x8c\xa0\xa0\x20\x8e\x38\
-\xea\x29\x2a\x2b\x2b\x85\x5a\xad\x86\x94\x12\x5f\x7e\xf9\xa5\xb8\
-\x51\x2f\x60\x95\x4a\xc5\x89\x54\xc9\xa3\xb4\x68\xd1\x22\x2d\x3e\
-\x3e\x3e\x2d\x27\x27\x47\x2c\x59\xb2\x44\x8e\x1a\x35\x0a\xc9\xc9\
-\xc9\x00\x80\xf9\xf3\xe7\xcb\xb7\xdf\x7e\x1b\x2f\xbc\xf0\x02\x3a\
-\x77\xee\xcc\x11\x47\x3d\x81\x8f\x8f\x8f\xfd\xbe\x46\xa3\x61\xd7\
-\x05\xba\xed\xf8\xfa\xfa\x42\xa9\x54\x62\xcb\x96\x2d\x78\xe3\x8d\
-\x37\xb0\x6a\xd5\x2a\x00\xc0\xc2\x85\x0b\x31\x73\xe6\x4c\xbc\xf6\
-\xda\x6b\x0d\x6a\xe6\x60\x60\xb9\x99\xfc\xfc\x7c\x59\x58\x58\x08\
-\xbd\x5e\x5f\xab\x5b\x43\x48\x48\x08\x1e\x7d\xf4\x51\x5e\x9a\x43\
-\x1e\xa9\x5d\xbb\x76\x62\xc5\x8a\x15\x58\xbe\x7c\xb9\xfd\x31\x47\
-\x07\xed\x63\x60\xb9\xa1\xf2\xf2\xf2\xbe\x53\xa6\x4c\xd9\xb9\x79\
-\xf3\x66\x18\x0c\x06\x68\xb5\x5a\x18\x0c\x06\xfb\xf3\x8f\x3c\xf2\
-\x08\x12\x12\x12\x38\x2f\x21\x79\x94\x8a\x8a\x0a\x1c\x3c\x78\x50\
-\xea\xf5\xfa\x7a\x9f\x37\x9b\xcd\xb8\xe7\x9e\x7b\x84\xbf\xbf\x3f\
-\x03\xcb\x93\xcc\x9b\x37\x6f\xe7\x9a\x35\x6b\x90\x9e\x9e\x8e\x11\
-\x23\x46\x20\x2a\x2a\x0a\xab\x57\xaf\xc6\xc9\x93\x27\x91\x9b\x9b\
-\x8b\x15\x2b\x56\x3c\xcb\xb0\x22\x4f\x93\x97\x97\x87\xfb\xee\xbb\
-\xef\x86\xaf\xc9\xc8\xc8\x90\x29\x29\x29\xec\x38\xea\x49\xce\x9c\
-\x39\x83\xe0\xe0\x60\xa4\xa6\xa6\xc2\x76\xba\xb7\xbc\xbc\x1c\x69\
-\x69\x69\xf0\xf2\xf2\xc2\xe4\xc9\x93\x3f\xfe\xec\xb3\xcf\x96\x72\
-\x12\x0a\xf2\x24\xbd\x7a\xf5\x42\x46\x46\x46\x87\xaa\xaa\xaa\x13\
-\xf5\x3d\x6f\xb1\x58\xd0\xb2\x65\x4b\x36\xba\x7b\x9a\xbe\x7d\xfb\
-\xe2\x8b\x2f\xbe\xc0\xa6\x4d\x9b\x30\x64\xc8\x10\x04\x06\x06\x62\
-\xed\xda\xb5\x38\x7f\xfe\x3c\x8c\x46\x63\x9d\x21\x67\x88\x3c\x81\
-\x56\xab\x45\x40\x40\x40\x61\x40\x40\x40\x93\xcc\x5d\xc0\xc0\x72\
-\x13\xe3\xc7\x8f\x17\x7d\xfb\xf6\x95\x57\xae\x5c\x41\x9b\x36\x6d\
-\xc4\xf2\xe5\xcb\x65\x6a\x6a\x2a\xbe\xfb\xee\x3b\xc4\xc4\xc4\x60\
-\xee\xdc\xb9\xf6\x69\xbe\x89\xee\x54\x1c\xad\xc1\x4d\x0c\x1f\x3e\
-\x5c\x76\xea\xd4\xc9\xfe\x77\x4a\x4a\x8a\x28\x2b\x2b\x13\x52\x4a\
-\xf1\xd3\x4f\x3f\x89\xe8\xe8\x68\xce\xae\x43\x77\x3c\xd6\xb0\xdc\
-\x44\x62\x62\x22\xf2\xf3\xf3\x51\x58\x58\xe8\xf0\x85\xa0\x44\xee\
-\xac\x29\x26\x9d\x60\x60\xb9\xa9\xd8\xd8\x58\x44\x46\x46\x62\xf2\
-\xe4\xc9\x78\xfe\xf9\xe7\x65\x64\x64\x64\xad\x7e\x58\xc1\xc1\xc1\
-\x88\x8f\x8f\xe7\xb5\x84\xc4\x1a\x16\xb9\xde\xdb\x6f\xbf\x8d\xfd\
-\xfb\xf7\x43\xa5\x52\xe1\xcd\x37\xdf\xac\xd5\xc0\x6e\xb1\x58\xd0\
-\xa7\x4f\x1f\xdc\x7f\xff\xfd\xec\x87\x45\x0c\x2c\x72\xbd\x29\x53\
-\xa6\x20\x29\x29\x09\x03\x06\x0c\x80\x9f\x9f\x5f\x9d\xaa\xb4\x4a\
-\xa5\xaa\x75\x29\x0f\x11\x03\x8b\x5c\x66\xe5\xca\x95\xd8\xba\x75\
-\x2b\x12\x13\x13\xe1\x68\xaf\x5f\xa2\x3b\x0d\xcf\x12\xba\x89\x67\
-\x9e\x79\x06\x1d\x3b\x76\xc4\xf6\xed\xdb\x61\x34\x1a\x21\xa5\xac\
-\x73\x23\x62\x0d\x8b\xdc\xc2\xf1\xe3\xc7\x51\x59\x59\x89\x7f\xfc\
-\xe3\x1f\xd8\xba\x75\xab\x6c\xdd\xba\x75\xad\x46\xf7\xbb\xef\xbe\
-\x1b\x2f\xbe\xf8\xa2\xd0\x6a\xb5\x2c\x2c\x62\x60\x91\x6b\xe9\x74\
-\x3a\x0c\x1b\x36\x0c\x5e\x5e\x5e\x30\x99\x4c\xb5\xa6\xf5\xb6\x8d\
-\xd6\xf0\x57\xae\x6e\x27\x62\x60\x51\x93\x1b\x3b\x76\xac\x00\x60\
-\x9f\x78\x82\x88\xea\xe2\x4f\xb6\x1b\xc9\xcf\xcf\x97\x83\x07\x0f\
-\x96\x0a\x85\x42\x0a\x21\xe4\x27\x9f\x7c\x22\x53\x53\x53\xa5\x10\
-\x42\x66\x67\x67\xb3\x11\x8b\x18\x58\x2c\x02\xf7\xb0\x77\xef\x5e\
-\x39\x68\xd0\x20\x5c\xb8\x70\x01\xe9\xe9\xe9\xd6\x8d\xa3\x50\xe0\
-\x9d\x77\xde\x81\xb7\xb7\x37\x56\xaf\x5e\x5d\x6b\x7c\x2c\x22\x06\
-\x16\xb9\xcc\x9a\x35\x6b\x60\x30\x18\xb0\x68\xd1\x22\x3c\xf1\xc4\
-\x13\x00\xac\x83\x9b\x35\x6f\xde\x1c\x4a\xa5\x12\xa5\xa5\xa5\x68\
-\xc8\x0c\xb9\x44\x0c\x2c\x72\x1a\xa3\xd1\x08\xa5\x52\x09\x6f\x6f\
-\x6f\xd4\xd4\xd4\x00\xf8\xb3\x3d\xcb\x62\xb1\xc0\xcb\xcb\x8b\x8d\
-\xee\xc4\xc0\x62\x11\xb8\x4e\x55\x55\x15\xbe\xf8\xe2\x0b\xf9\xdb\
-\x6f\xbf\xc9\x3e\x7d\xfa\xc0\x68\x34\x22\x23\x23\xc3\x1e\x58\xb6\
-\xc9\x27\x6b\x6a\x6a\xd0\xbf\x7f\x7f\xce\x9a\x43\x77\x3c\x9e\x25\
-\x74\xa1\xb2\xb2\x32\x39\x66\xcc\x18\x2c\x5a\xb4\x08\x93\x27\x4f\
-\xc6\xd1\xa3\x47\xb1\x60\xc1\x02\x7c\xf2\xc9\x27\x00\x80\xd9\xb3\
-\x67\xe3\xe2\xc5\x8b\x78\xe6\x99\x67\xf0\xd4\x53\x4f\xf1\xc2\x67\
-\x62\x60\xb1\x08\x5c\xc7\x76\xc8\xa7\x54\x2a\xa1\x56\xab\xf1\xe6\
-\x9b\x6f\x62\xe8\xd0\xa1\xd8\xb5\x6b\x17\xca\xca\xca\xd0\xac\x59\
-\x33\x24\x26\x26\x22\x21\x21\x81\x7d\x1d\x88\x18\x58\xee\xe1\xd2\
-\xa5\x4b\x38\x7a\xf4\x28\x2c\x16\x0b\x7c\x7c\x7c\xf0\xc4\x13\x4f\
-\x40\xa1\x50\x40\x4a\x09\xa3\xd1\x88\x43\x87\x0e\x49\x1f\x1f\x1f\
-\x84\x87\x87\x0b\xb6\x63\x11\x03\x8b\x5c\xea\xf5\xd7\x5f\xc7\xeb\
-\xaf\xbf\x7e\xc3\xd7\xc4\xc7\xc7\x23\x3b\x3b\x9b\x53\xd5\x13\x03\
-\x8b\x5c\x6b\xfe\xfc\xf9\x18\x31\x62\x44\xad\xcb\x71\xae\xe5\xed\
-\xed\x5d\xce\x31\xdd\x89\x81\x45\x2e\xe7\xed\xed\x8d\xf0\xf0\x70\
-\xb6\x53\x11\xdd\x04\x1b\x44\x5c\xc8\x56\xa3\xb2\x75\x63\x20\x22\
-\xd6\xb0\xdc\x56\xcb\x96\x2d\xc5\x67\x9f\x7d\x26\x1f\x7c\xf0\x41\
-\x16\x06\x11\x03\xcb\xbd\xf9\xf8\xf8\x60\xfc\xf8\xf1\x3c\x14\x24\
-\xe2\x21\x21\x11\x31\xb0\x88\x88\x18\x58\x44\x44\x0c\x2c\x22\x62\
-\x60\x59\xd9\xae\x87\x13\x42\x70\x34\x81\xeb\x50\xab\xd5\x50\x2a\
-\x95\xd0\x68\x34\x2c\x0c\x72\xaa\xdb\xfd\x02\xf9\x46\x9f\x25\x34\
-\x1a\x8d\x00\x00\xbd\x5e\x8f\x7f\xfd\xeb\x5f\x08\x08\x08\xe0\x50\
-\xbe\xd7\xb0\x58\x2c\xc8\xcb\xcb\x83\xc5\x62\x41\xab\x56\xad\x58\
-\x3e\xe4\x14\x1a\x8d\x06\xc7\x8e\x1d\x03\x60\xed\xdb\xa7\xd1\x68\
-\x3a\xdc\x8a\x1f\xe3\xeb\x55\x54\xa4\x94\x4d\x3e\x47\x81\x68\xec\
-\x7c\x77\xf1\xf1\xf1\x32\x37\x37\xd7\x5a\x5d\xe3\x85\xb9\xd7\xe5\
-\x8c\x8d\x47\x54\xdf\x8f\xa3\xcd\xab\xaf\xbe\x8a\x80\x80\x00\xe7\
-\xd5\x76\x54\x2a\x64\x65\x65\x21\x24\x24\x04\x31\x31\x31\xb5\x46\
-\xc4\x35\x18\x0c\x78\xf3\xcd\x37\x9b\x7c\x87\x6f\x74\x0d\xab\x7d\
-\xfb\xf6\xc8\xcd\xcd\xb5\x0f\x91\x42\x44\xae\x21\x84\x80\xc9\x64\
-\x82\xd1\x68\x84\x4e\xa7\x43\x60\x60\x20\xfc\xfc\xfc\x9c\x1a\x58\
-\xe1\xe1\xe1\x08\x0a\x0a\x82\xbf\xbf\x7f\xad\xb0\x74\xd6\xd5\x1b\
-\x8d\xae\x61\x15\x15\x15\xc9\xcc\xcc\x4c\xe8\x74\x3a\xa7\x16\x0e\
-\x11\xdd\x3c\xb0\xf4\x7a\x3d\x4a\x4b\x4b\xd1\xa9\x53\x27\x0c\x1e\
-\x3c\xd8\xa5\x55\x7a\xb7\x3b\x24\xe4\x61\x0e\x11\xdd\xd2\x50\x6e\
-\x6c\x0d\x8b\x88\xe8\x56\x61\x2b\x39\x11\x31\xb0\x88\x88\x18\x58\
-\x44\xc4\xc0\x22\x22\x62\x60\x11\x11\x31\xb0\x88\x88\x81\x45\x44\
-\xc4\xc0\x22\x22\x62\x60\x11\x11\x03\x8b\x88\x88\x81\x45\x44\xc4\
-\xc0\x22\x22\x06\x16\x11\x11\x03\x8b\x88\x88\x81\x45\x44\x0c\x2c\
-\x22\x22\x06\x16\x11\x11\x03\x8b\x88\x18\x58\x44\x44\x0c\x2c\x22\
-\x22\x06\x16\x11\x31\xb0\x88\x88\x18\x58\x44\x44\x0c\x2c\x22\x62\
-\x60\x11\x11\x31\xb0\x88\x88\x18\x58\x44\xc4\xc0\x22\x22\x62\x60\
-\x11\x11\x03\x8b\x45\x40\x44\x0c\x2c\x22\x22\x06\x16\x11\x31\xb0\
-\x88\x88\x18\x58\x44\x44\x0c\x2c\x22\x62\x60\x11\x11\x31\xb0\x88\
-\x88\x18\x58\x44\xc4\xc0\x22\x22\x62\x60\x11\x11\x31\xb0\x88\x88\
-\x81\x45\x44\xc4\xc0\x22\x22\x62\x60\x11\x11\x03\x8b\x88\x88\x81\
-\x45\x44\xc4\xc0\x22\xa2\xdb\xc8\xff\x03\x94\x2f\xf5\x90\x11\xa7\
-\x53\x72\x00\x00\x00\x00\x49\x45\x4e\x44\xae\x42\x60\x82\
-&quot;
-
-qt_resource_name = &quot;\
-\x00\x08\
-\x0c\x35\x75\x76\
-\x00\x68\
-\x00\x65\x00\x6c\x00\x70\x00\x50\x00\x72\x00\x65\x00\x66\
-\x00\x13\
-\x05\xdd\x1a\x07\
-\x00\x54\
-\x00\x65\x00\x72\x00\x72\x00\x61\x00\x69\x00\x6e\x00\x45\x00\x78\x00\x74\x00\x65\x00\x6e\x00\x64\x00\x73\x00\x31\x00\x2e\x00\x70\
-\x00\x6e\x00\x67\
-&quot;
-
-qt_resource_struct = &quot;\
-\x00\x00\x00\x00\x00\x02\x00\x00\x00\x01\x00\x00\x00\x01\
-\x00\x00\x00\x00\x00\x02\x00\x00\x00\x01\x00\x00\x00\x02\
-\x00\x00\x00\x16\x00\x00\x00\x00\x00\x01\x00\x00\x00\x00\
-&quot;
-
-def qInitResources():
-    QtCore.qRegisterResourceData(0x01, qt_resource_struct, qt_resource_name, qt_resource_data)
-
-def qCleanupResources():
-    QtCore.qUnregisterResourceData(0x01, qt_resource_struct, qt_resource_name, qt_resource_data)
-
-qInitResources()

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/help/help_rc.py (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/help/help_rc.py)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/icons/icons.qrc (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/icons/icons.qrc)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/icons/terrain.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/icons/terrain.png)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/icons/terrain_small.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/icons/terrain_small.png)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETShader.program
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/terrain/ETShader.program	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETShader.program	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,46 +0,0 @@
-fragment_program ET/Programs/PSSplat cg
-{
-  source PSSplat.cg
-  entry_point main
-  profiles ps_1_1 arbfp1
-}
-
-fragment_program ET/Programs/PSSplat2 cg
-{
-  source PSSplat2.cg
-  entry_point main
-  profiles ps_2_0 arbfp1
-}
-
-fragment_program ET/Programs/PSLighting cg
-{
-  source PSLighting.cg
-  entry_point main
-  profiles ps_1_1 arbfp1
-}
-
-vertex_program ET/Programs/VSLodMorph cg
-{
-  source VSLodMorph.cg
-  entry_point terrain_vp
-  profiles vs_1_1 arbvp1
-  
-  default_params
-  {
-    param_named_auto morphFactor custom 77
-    param_named_auto worldViewProj worldviewproj_matrix
-  }
-}
-
-vertex_program ET/Programs/VSLodMorph2 cg
-{
-  source VSLodMorph.cg
-  entry_point terrain_vp
-  profiles vs_1_1 arbvp1
-  
-  default_params
-  {
-    param_named_auto morphFactor custom 77
-    param_named_auto worldViewProj worldviewproj_matrix
-  }
-}

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETShader.program (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/ETShader.program)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETTerrain.material
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/terrain/ETTerrain.material	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETTerrain.material	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,199 +0,0 @@
-material ETTerrainMaterial
-{
-  technique
-  {
-    // primary splatting technique, requires PS 2.0
-    // has issues with OpenGL rendering, though...
-    pass
-    {
-      // splatting pass
-      
-      lighting off
-      
-      vertex_program_ref ET/Programs/VSLodMorph2
-      {
-      }
-      
-      fragment_program_ref ET/Programs/PSSplat2
-      {
-        param_named splatScaleX float 20
-	param_named splatScaleZ float 20
-      }
-      
-      texture_unit
-      {
-        // first coverage map, dynamically managed
-	texture ETSplatting0
-      }
-      texture_unit
-      {
-        // second coverage map, dynamically managed
-	texture ETSplatting1
-      }
-
-      // splatting textures
-      texture_unit
-      {
-        texture splatting0.png
-      }
-      texture_unit
-      {
-        texture splatting1.png
-      }
-      texture_unit
-      {
-        texture splatting2.png
-      }
-      texture_unit
-      {
-        texture splatting3.png
-      }
-      texture_unit
-      {
-        texture splatting4.png
-      }
-      texture_unit
-      {
-        texture splatting5.png
-      }
-    }
-    
-    pass
-    {
-      // lightmap texture pass
-      
-      scene_blend modulate
-
-      vertex_program_ref ET/Programs/VSLodMorph2
-      {
-      }
-      
-      fragment_program_ref ET/Programs/PSLighting
-      {
-      }
-
-      texture_unit
-      {
-        // dynamically created
-        texture ETLightmap
-      }
-      
-    }
-  }
-  
-
-
-  technique
-  {
-    // fallback technique for ps 1.1
-
-    pass
-    {
-      // first splatting pass
-      
-      lighting off
-	
-      vertex_program_ref ET/Programs/VSLodMorph
-      {
-        param_named splatScaleX float 20
-	param_named splatScaleZ float 20
-      }
-      
-      fragment_program_ref ET/Programs/PSSplat
-      {
-      }
-      
-      texture_unit
-      {
-        // will be dynamically generated by the splatting manager
-        texture ETSplatting0
-      }
-
-      texture_unit
-      {
-        texture splatting0.png
-      }
-     
-
-      texture_unit
-      {
-        texture splatting1.png
-      }
-     
-      texture_unit
-      {
-        texture splatting2.png
-      }
-
-    }
-    
-    pass
-    {
-      // second splatting pass
-      
-      lighting off
-      
-      scene_blend add
-	
-      vertex_program_ref ET/Programs/VSLodMorph
-      {
-        param_named splatScaleX float 20
-	param_named splatScaleZ float 20
-      }
-      
-      fragment_program_ref ET/Programs/PSSplat
-      {
-      }
-      
-      texture_unit
-      {
-        // will be dynamically generated by the splatting manager
-        texture ETSplatting1
-      }
-
-      texture_unit
-      {
-        texture splatting3.png
-      }
-
-      texture_unit
-      {
-        texture splatting4.png
-      }
-     
-
-      texture_unit
-      {
-        texture splatting5.png
-      }
-     
-    }
-    
-    pass 
-    {
-      // lightmap texture pass
-      
-      scene_blend modulate
-
-      vertex_program_ref ET/Programs/VSLodMorph
-      {
-        param_named splatScaleX float 20
-	param_named splatScaleZ float 20
-        param_named_auto morphFactor custom 77
-      }
-      
-      fragment_program_ref ET/Programs/PSLighting
-      {
-      }
-
-      texture_unit
-      {
-        // dynamically created
-        texture ETLightmap
-      }
-    }
-
-
- 
-  }
-}
\ No newline at end of file

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETTerrain.material (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/ETTerrain.material)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETcoverage.0.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETcoverage.0.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/ETcoverage.0.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETcoverage.1.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETcoverage.1.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/ETcoverage.1.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETlightmap.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETlightmap.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/ETlightmap.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETterrain.cfg
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/terrain/ETterrain.cfg	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETterrain.cfg	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,41 +0,0 @@
-# Specify the heightmap data type and source
-DataType=Image
-DataSource=terrain.png
-
-# Specify the size of the terrain
-Width=513
-Height=513
-TileSize=513
-
-# Scale factor for terrain rendering
-ScaleX=1500
-ScaleY=100
-ScaleZ=1500
-
-# Adjust LOD settings
-MaxMipMapLevel=4
-MaxPixelError=2
-LODMorphing=no
-
-# Specify the splatting textures to use
-# You can use as many as you want (and your hardware supports)
-Texture0=splatting0.png
-Texture1=splatting1.png
-Texture2=splatting2.png
-Texture3=splatting3.png
-
-# If you intend to load a terrain texturing done before,
-# then specify the coverage maps' extension and their base name
-# (excluding extension and the .## at the end)
-#CoverageExtension=png
-#CoverageBasename=ETterrain.Tex
-
-# Calculate a lightmap for the terrain upon loading?
-UseLightmap=yes
-# From where does the light for the lightmap come?
-LightDirection=1 -1 1
-LightmapDetail=1
-
-# How often should the splatting textures be tiled over the terrain?
-TextureRepeatX=20
-TextureRepeatZ=20

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETterrain.cfg (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/ETterrain.cfg)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETterrain.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/ETterrain.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/ETterrain.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSLighting.cg
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/terrain/PSLighting.cg	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSLighting.cg	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,10 +0,0 @@
-void main
-(
-  float2 iTexCoord0 : TEXCOORD0, 
-  out float4 oColor : COLOR, 
-  uniform sampler2D lightMap
-) 
-{
-  oColor = tex2D(lightMap, iTexCoord0);
-}
-

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSLighting.cg (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/PSLighting.cg)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat.cg
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/terrain/PSSplat.cg	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat.cg	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,22 +0,0 @@
-void main
-(
-  float2 iTexCoord0 : TEXCOORD0,
-  float2 iTexCoord1 : TEXCOORD1,
-  float2 iTexCoord2 : TEXCOORD2,
-  float2 iTexCoord3 : TEXCOORD3,
- 
-  out float4 oColor : COLOR,
- 
-  uniform sampler2D covMap,
-  uniform sampler2D splat1,
-  uniform sampler2D splat2,
-  uniform sampler2D splat3  
-) 
-{
-  float3 cov = tex2D(covMap, iTexCoord0).rgb;
-  
-  oColor = tex2D(splat1, iTexCoord1) * cov.x
-          + tex2D(splat2, iTexCoord2) * cov.y
-          + tex2D(splat3, iTexCoord3) * cov.z;
-}
-

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat.cg (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/PSSplat.cg)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat2.cg
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/terrain/PSSplat2.cg	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat2.cg	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,34 +0,0 @@
-void main
-(
-  float2 iTexCoord0 : TEXCOORD0,
- 
-  out float4 oColor : COLOR,
- 
-  uniform sampler2D covMap1,
-  uniform sampler2D covMap2,
-  uniform sampler2D splat1,
-  uniform sampler2D splat2,
-  uniform sampler2D splat3,
-  uniform sampler2D splat4,
-  uniform sampler2D splat5,
-  uniform sampler2D splat6,
-
-  uniform float splatScaleX,
-  uniform float splatScaleZ
-) 
-{
-  float3 cov1 = tex2D(covMap1, iTexCoord0).rgb;
-  float3 cov2 = tex2D(covMap2, iTexCoord0).rgb;
-  
-  iTexCoord0.x *= splatScaleX;
-  iTexCoord0.y *= splatScaleZ;
-  
-  oColor = tex2D(splat1, iTexCoord0) * cov1.x
-           + tex2D(splat2, iTexCoord0) * cov1.y
-           + tex2D(splat3, iTexCoord0) * cov1.z
-           + tex2D(splat4, iTexCoord0) * cov2.x
-           + tex2D(splat5, iTexCoord0) * cov2.y
-           + tex2D(splat6, iTexCoord0) * cov2.z;
-
-}
-

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/PSSplat2.cg (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/PSSplat2.cg)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph.cg
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/terrain/VSLodMorph.cg	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph.cg	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,32 +0,0 @@
-    void terrain_vp(
-	    float4 position : POSITION,
-	    float2 uv1   	: TEXCOORD0,
-	    /*float2 uv2   	: TEXCOORD1,
-	    float2 uv3   	: TEXCOORD2,
-	    float2 uv4   	: TEXCOORD3,*/
-	    float delta     : BLENDWEIGHT,
-
-	    out float4 oPosition : POSITION,
-	    out float2 oUv1		 : TEXCOORD0,
-	    out float2 oUv2		 : TEXCOORD1,
-	    out float2 oUv3		 : TEXCOORD2,
-	    out float2 oUv4		 : TEXCOORD3,
-	    uniform float splatScaleX,
-	    uniform float splatScaleZ,
-	    uniform float4x4 worldViewProj,
-	    uniform float morphFactor
-	    )
-    {
-	    position.y = position.y + (delta.x * morphFactor);
-	    oPosition = mul(worldViewProj, position);
-	    oUv1 = uv1;
-	    oUv2 = uv1;
-	    oUv3 = uv1;
-	    oUv4 = uv1;
-	    oUv2.x *= splatScaleX;
-	    oUv2.y *= splatScaleZ;
-	    oUv3.x *= splatScaleX;
-	    oUv3.y *= splatScaleZ;
-	    oUv4.x *= splatScaleX;
-	    oUv4.y *= splatScaleZ;
-    }

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph.cg (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/VSLodMorph.cg)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph2.cg
===================================================================
--- rl/trunk/editors/Lockenwickler/src/media/terrain/VSLodMorph2.cg	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph2.cg	2009-05-22 22:18:33 UTC (rev 4940)
@@ -1,15 +0,0 @@
-    void terrain_vp(
-	    float4 position : POSITION,
-	    float2 uv1   	: TEXCOORD0,
-	    float delta     : BLENDWEIGHT,
-
-	    out float4 oPosition : POSITION,
-	    out float2 oUv1		 : TEXCOORD0,
-	    uniform float4x4 worldViewProj,
-	    uniform float morphFactor
-	    )
-    {
-	    position.y = position.y + (delta.x * morphFactor);
-	    oPosition = mul(worldViewProj, position);
-	    oUv1 = uv1;
-    }

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/VSLodMorph2.cg (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/VSLodMorph2.cg)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/brushes (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/brushes)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/brushes/brush.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/brushes/brush.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/brushes/brush.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting0.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting0.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/splatting0.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting1.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting1.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/splatting1.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting2.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting2.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/splatting2.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting3.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting3.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/splatting3.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting4.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting4.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/splatting4.png)

Deleted: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting5.png
===================================================================
(Binary files differ)

Copied: rl/branches/persistence2/editors/Lockenwickler/src/media/terrain/splatting5.png (from rev 4939, rl/trunk/editors/Lockenwickler/src/media/terrain/splatting5.png)

Copied: rl/branches/persistence2/editors/Lockenwickler/ui files/AddTriggerDialog.ui (from rev 4939, rl/trunk/editors/Lockenwickler/ui files/AddTriggerDialog.ui)

Copied: rl/branches/persistence2/editors/Lockenwickler/ui files/BrushDialog.ui (from rev 4939, rl/trunk/editors/Lockenwickler/ui files/BrushDialog.ui)

Copied: rl/branches/persistence2/editors/Lockenwickler/ui files/MyTerrainManagerDock.ui (from rev 4939, rl/trunk/editors/Lockenwickler/ui files/MyTerrainManagerDock.ui)

Modified: rl/branches/persistence2/engine/ai/include/Dialog.h
===================================================================
--- rl/branches/persistence2/engine/ai/include/Dialog.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/include/Dialog.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -19,10 +19,10 @@
 #include &quot;AiPrerequisites.h&quot;
 
 #include &quot;Properties.h&quot;
+#include &quot;Creature.h&quot;
 
 namespace rl
 {
-    class Creature;
     class DialogOption;
     class DialogResponse;
     class DialogVariable;
@@ -47,12 +47,12 @@
         virtual PropertyKeys getAllPropertyKeys() const;
 
         void addParticipant(const CeGuiString&amp; personId, Creature* person);
-        std::list&lt;Creature*&gt; getParticipants() const;
+        const CreatureList&amp; getParticipants() const;
         Creature* getParticipant(const CeGuiString&amp; id) const;
 
     private:
         DialogResponse* mDialogStart;
-        std::list&lt;Creature*&gt; mAllParticipants;
+        CreatureList mAllParticipants;
         std::map&lt;CeGuiString, Creature*&gt; mParticipantMap;
         std::map&lt;Ogre::String, DialogVariable*&gt; mVariables;
         PropertyRecord mPropertyVariables;

Modified: rl/branches/persistence2/engine/ai/include/DialogLoader.h
===================================================================
--- rl/branches/persistence2/engine/ai/include/DialogLoader.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/include/DialogLoader.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -17,12 +17,11 @@
 #define __DialogLoader_H__
 
 #include &quot;AiPrerequisites.h&quot;
+#include &quot;Creature.h&quot;
 
-#include &lt;list&gt;
 
 namespace rl
 {
-	class Creature;
     class Dialog;
     class DialogLoaderImpl;
 
@@ -36,7 +35,7 @@
         virtual void parseScript(Ogre::DataStreamPtr&amp; stream, const Ogre::String&amp; groupName);
 		virtual Ogre::Real getLoadingOrder() const;
 
-		Dialog* createDialog(const Ogre::String&amp; name, const std::list&lt;Creature*&gt;&amp; participants) const;
+		Dialog* createDialog(const Ogre::String&amp; name, const CreatureList&amp; participants) const;
 
 	private:
         Ogre::StringVector mScriptPatterns;

Modified: rl/branches/persistence2/engine/ai/include/DialogLoaderImpl.h
===================================================================
--- rl/branches/persistence2/engine/ai/include/DialogLoaderImpl.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/include/DialogLoaderImpl.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -19,10 +19,10 @@
 
 #include &quot;Properties.h&quot;
 #include &quot;XmlProcessor.h&quot;
+#include &quot;Creature.h&quot;
 
 namespace rl
 {
-    class Creature;
     class Dialog;
     class DialogCondition;
     class DialogElement;
@@ -39,7 +39,7 @@
         DialogLoaderImpl();
         ~DialogLoaderImpl();
 
-        Dialog* createDialog(const Ogre::String&amp; name, const std::list&lt;Creature*&gt;&amp; participants) const;
+        Dialog* createDialog(const Ogre::String&amp; name, const CreatureList&amp; participants) const;
         void parseDialog(Ogre::DataStreamPtr&amp; stream, const Ogre::String&amp; groupName);
 
     private:
@@ -70,7 +70,7 @@
             DialogResponse* getResponse(const CeGuiString&amp; id) const;
 
             void setStartResponse(DialogResponse* response);
-            Dialog* createDialog(const std::list&lt;Creature*&gt;&amp; participants);
+            Dialog* createDialog(const CreatureList&amp; participants);
             void setProperty(const CeGuiString&amp; key, const Property&amp; value);
 
             void addParticipant(DialogParticipant* participant);

Modified: rl/branches/persistence2/engine/ai/include/DialogManager.h
===================================================================
--- rl/branches/persistence2/engine/ai/include/DialogManager.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/include/DialogManager.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -21,12 +21,12 @@
 #include &lt;list&gt;
 
 #include &quot;Properties.h&quot;
+#include &quot;Creature.h&quot;
 #include &quot;SaveGameData.h&quot;
 #include &quot;XmlProcessor.h&quot;
 
 namespace rl
 {
-    class Creature;
 	class Dialog;
 	class DialogLoader;
 
@@ -45,7 +45,7 @@
         ~DialogManager();
 
         Dialog* createDialog(const Ogre::String&amp; name, Creature* npc);
-        Dialog* createDialog(const Ogre::String&amp; name, const std::list&lt;Creature*&gt;&amp; npcs);
+        Dialog* createDialog(const Ogre::String&amp; name, const CreatureList&amp; npcs);
 
         virtual const Property getProperty(const CeGuiString&amp; key) const;
         virtual void setProperty(const CeGuiString&amp; key, const Property&amp; value);
@@ -60,16 +60,16 @@
         class DialogConfiguration
         {
         public:
-            DialogConfiguration(const Ogre::String&amp; name, const std::list&lt;Creature*&gt;&amp; participants);
+            DialogConfiguration(const Ogre::String&amp; name, const CreatureList&amp; participants);
 
             const Ogre::String&amp; getName() const;
-            const std::list&lt;Creature*&gt;&amp; getParticipants() const;
+            const CreatureList&amp; getParticipants() const;
 
             bool operator==(const DialogConfiguration&amp;) const;
             bool operator&lt;(const DialogConfiguration&amp;) const;
         private:
             Ogre::String mDialogName;
-            std::list&lt;Creature*&gt; mParticipants;
+            CreatureList mParticipants;
         };
 
 

Modified: rl/branches/persistence2/engine/ai/include/DialogParagraph.h
===================================================================
--- rl/branches/persistence2/engine/ai/include/DialogParagraph.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/include/DialogParagraph.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -18,10 +18,10 @@
 #define __DialogParagraph_H__
 
 #include &quot;AiPrerequisites.h&quot;
+#include &quot;Creature.h&quot;
 
 namespace rl
 {
-    class Creature;
     class Dialog;
     class DialogElement;
     class DialogResponse;
@@ -39,7 +39,7 @@
         void _setParent(DialogElement* parent);
         virtual DialogResponse* getResponse() const;
         Creature* getSpeaker(Dialog* dialog) const;
-        std::list&lt;Creature*&gt; getListeners(Dialog* dialog) const;
+        CreatureList getListeners(Dialog* dialog) const;
 
     private:
         CeGuiString mText;

Modified: rl/branches/persistence2/engine/ai/src/Dialog.cpp
===================================================================
--- rl/branches/persistence2/engine/ai/src/Dialog.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/src/Dialog.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -100,7 +100,7 @@
         mAllParticipants.push_back(person);
     }
 
-    list&lt;Creature*&gt; Dialog::getParticipants() const
+    const CreatureList&amp; Dialog::getParticipants() const
     {
         return mAllParticipants;
     }

Modified: rl/branches/persistence2/engine/ai/src/DialogLoader.cpp
===================================================================
--- rl/branches/persistence2/engine/ai/src/DialogLoader.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/src/DialogLoader.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -50,7 +50,7 @@
         mLoaderImplementation-&gt;parseDialog(stream, groupName);
     }
 
-    Dialog* DialogLoader::createDialog(const Ogre::String&amp; name, const std::list&lt;Creature*&gt;&amp; participants) const
+    Dialog* DialogLoader::createDialog(const Ogre::String&amp; name, const CreatureList&amp; participants) const
     {
         return mLoaderImplementation-&gt;createDialog(name, participants);
     }

Modified: rl/branches/persistence2/engine/ai/src/DialogLoaderImpl.cpp
===================================================================
--- rl/branches/persistence2/engine/ai/src/DialogLoaderImpl.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/src/DialogLoaderImpl.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -81,7 +81,7 @@
         shutdownXml();
     }
 
-    Dialog* DialogLoaderImpl::createDialog(const String&amp; name, const std::list&lt;Creature*&gt;&amp; participants) const
+    Dialog* DialogLoaderImpl::createDialog(const String&amp; name, const CreatureList&amp; participants) const
     {
         std::map&lt;Ogre::String, DialogPrototype*&gt;::const_iterator it =
         mDialogs.find(name);
@@ -607,7 +607,7 @@
         return it-&gt;second;
     }
 
-    Dialog* DialogLoaderImpl::DialogPrototype::createDialog(const list&lt;Creature*&gt;&amp; participants)
+    Dialog* DialogLoaderImpl::DialogPrototype::createDialog(const CreatureList&amp; participants)
     {
         Dialog* dialog = new Dialog();
 
@@ -618,7 +618,7 @@
         bool found1stNpc = false;
         Party playerChars = PartyManager::getSingleton().getCharacters();
 
-        for (list&lt;Creature*&gt;::const_iterator itPart = participants.begin(); itPart != participants.end(); ++itPart)
+        for (CreatureList::const_iterator itPart = participants.begin(); itPart != participants.end(); ++itPart)
         {
             Creature* curCr = *itPart;
 

Modified: rl/branches/persistence2/engine/ai/src/DialogManager.cpp
===================================================================
--- rl/branches/persistence2/engine/ai/src/DialogManager.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/src/DialogManager.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -78,7 +78,7 @@
 
                 PropertyArray npcs;
 
-                for (list&lt;Creature*&gt;::const_iterator itNpc = it-&gt;first.getParticipants().begin();
+                for (CreatureList::const_iterator itNpc = it-&gt;first.getParticipants().begin();
                     itNpc != it-&gt;first.getParticipants().end(); ++itNpc)
                 {
                     npcs.push_back(GameObjectManager::getSingleton().toProperty(*itNpc));
@@ -133,15 +133,15 @@
 
     Dialog* DialogManager::createDialog(const Ogre::String&amp; name, Creature* npc)
     {
-        list&lt;Creature*&gt; npcs;
+        CreatureList npcs;
         npcs.push_back(npc);
 
         return createDialog(name, npcs);
     }
 
-    Dialog* DialogManager::createDialog(const Ogre::String&amp; name, const list&lt;Creature*&gt;&amp; npcs)
+    Dialog* DialogManager::createDialog(const Ogre::String&amp; name, const CreatureList&amp; npcs)
     {
-        list&lt;Creature*&gt; participants;
+        CreatureList participants;
 
         Party party = PartyManager::getSingleton().getCharacters();
         for (Party::const_iterator it = party.begin(); it != party.end(); ++it)
@@ -149,7 +149,7 @@
             participants.push_back(*it);
         }
 
-        for (list&lt;Creature*&gt;::const_iterator it = npcs.begin(); it != npcs.end(); ++it)
+        for (CreatureList::const_iterator it = npcs.begin(); it != npcs.end(); ++it)
         {
             participants.push_back(*it);
         }
@@ -178,7 +178,7 @@
     }
 
     DialogManager::DialogConfiguration::DialogConfiguration(const Ogre::String&amp; name,
-            const list&lt;Creature*&gt;&amp; participants)
+            const CreatureList&amp; participants)
         : mDialogName(name), mParticipants(participants)
     {
     }
@@ -188,7 +188,7 @@
         return mDialogName;
     }
 
-    const list&lt;Creature*&gt;&amp; DialogManager::DialogConfiguration::getParticipants() const
+    const CreatureList&amp; DialogManager::DialogConfiguration::getParticipants() const
     {
         return mParticipants;
     }

Modified: rl/branches/persistence2/engine/ai/src/DialogParagraph.cpp
===================================================================
--- rl/branches/persistence2/engine/ai/src/DialogParagraph.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ai/src/DialogParagraph.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -76,14 +76,14 @@
         return dialog-&gt;getParticipant(getPerson());
     }
 
-    list&lt;Creature*&gt; DialogParagraph::getListeners(Dialog* dialog) const
+    CreatureList DialogParagraph::getListeners(Dialog* dialog) const
     {
         Creature* speaker = getSpeaker(dialog);
 
-        list&lt;Creature*&gt; listeners;
+        CreatureList listeners;
 
-        list&lt;Creature*&gt; participants = dialog-&gt;getParticipants();
-        for (list&lt;Creature*&gt;::iterator it = participants.begin(), end = participants.end(); it != end; ++it)
+        CreatureList participants = dialog-&gt;getParticipants();
+        for (CreatureList::iterator it = participants.begin(), end = participants.end(); it != end; ++it)
         {
             if (*it != speaker)
             {

Modified: rl/branches/persistence2/engine/core/CMakeLists.txt
===================================================================
--- rl/branches/persistence2/engine/core/CMakeLists.txt	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/CMakeLists.txt	2009-05-22 22:18:33 UTC (rev 4940)
@@ -49,6 +49,7 @@
 src/MovableText.cpp
 src/ParticleSystemObject.cpp
 src/PhysicsContactListener.cpp
+src/PhysicsCollisionFactory.cpp
 src/PhysicalThing.cpp
 src/PhysicsGenericContactCallback.cpp
 src/PhysicsManager.cpp

Modified: rl/branches/persistence2/engine/core/RlCore2005.vcproj
===================================================================
--- rl/branches/persistence2/engine/core/RlCore2005.vcproj	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/RlCore2005.vcproj	2009-05-22 22:18:33 UTC (rev 4940)
@@ -524,6 +524,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\PhysicsCollisionFactory.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\PhysicsContactListener.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -881,6 +885,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\PhysicsCollisionFactory.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\PhysicsContactListener.cpp&quot;
 				&gt;
 			&lt;/File&gt;

Modified: rl/branches/persistence2/engine/core/RlCore2008.vcproj
===================================================================
--- rl/branches/persistence2/engine/core/RlCore2008.vcproj	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/RlCore2008.vcproj	2009-05-22 22:18:33 UTC (rev 4940)
@@ -414,14 +414,6 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
-				RelativePath=&quot;.\include\DotSceneLoader.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\include\DotSceneOctreeWorld.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
 				RelativePath=&quot;.\include\FadeAnimation.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -450,6 +442,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\GenericWorld.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\Job.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -526,6 +522,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\PhysicsCollisionFactory.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\PhysicsContactListener.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -546,6 +546,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\PhysicsRagDoll.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\PlayAnimationJob.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -775,14 +779,6 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
-				RelativePath=&quot;.\src\DotSceneLoader.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\DotSceneOctreeWorld.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
 				RelativePath=&quot;.\src\FadeAnimation.cpp&quot;
 				&gt;
 			&lt;/File&gt;
@@ -811,6 +807,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\GenericWorld.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\Job.cpp&quot;
 				&gt;
 			&lt;/File&gt;
@@ -871,6 +871,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\PhysicsCollisionFactory.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\PhysicsContactListener.cpp&quot;
 				&gt;
 			&lt;/File&gt;
@@ -887,6 +891,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\PhysicsRagDoll.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\PlayAnimationJob.cpp&quot;
 				&gt;
 			&lt;/File&gt;

Copied: rl/branches/persistence2/engine/core/include/PhysicsCollisionFactory.h (from rev 4939, rl/trunk/engine/core/include/PhysicsCollisionFactory.h)

Modified: rl/branches/persistence2/engine/core/include/PhysicsManager.h
===================================================================
--- rl/branches/persistence2/engine/core/include/PhysicsManager.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/include/PhysicsManager.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -28,12 +28,6 @@
 #   include &lt;OgreNewt.h&gt;
 #endif
 
-namespace OgreNewt {
-    class Body;
-    class MaterialID;
-    class MaterialPair;
-    class World;
-}
 
 #include &quot;CorePrerequisites.h&quot;
 #include &quot;CoreDefines.h&quot;
@@ -212,8 +206,8 @@
 			Ogre::Entity* entity,
             const GeometryType&amp; geomType = GT_NONE,
             const Ogre::String&amp; animName = &quot;&quot;,
-			const Ogre::Vector3* offset = NULL,
-			const Ogre::Quaternion* orientation = NULL,
+			const Ogre::Vector3 &amp;offset = Ogre::Vector3::ZERO,
+			const Ogre::Quaternion &amp;orientation = Ogre::Quaternion::IDENTITY,
             const Ogre::Real mass = 0,
             Ogre::Vector3* inertia = NULL,
             Ogre::Vector3* centerOfMass = NULL,
@@ -224,8 +218,8 @@
             const Ogre::String&amp; name,
             const Ogre::AxisAlignedBox&amp; aabb,
             const GeometryType&amp; geomType = GT_NONE,
-            const Ogre::Vector3* offset = NULL,
-			const Ogre::Quaternion* orientation = NULL,
+			const Ogre::Vector3 &amp;offset = Ogre::Vector3::ZERO,
+			const Ogre::Quaternion &amp;orientation = Ogre::Quaternion::IDENTITY,
             const Ogre::Real mass = 0,
             Ogre::Vector3* inertia = NULL,
             Ogre::Vector3* centerOfMass = NULL,
@@ -316,253 +310,7 @@
 #endif
 
     };
-
-    class PhysicsCollisionFactory
-    {
-    public:
-        //! destructor, releases the collisions from the collision cache
-        ~PhysicsCollisionFactory();
-
-        /** creates a collision primitive for OgreNewt from an Ogre::Entity.
-		 * The collision primitive created has got a basic orientation which can be influenced by
-		 * offset and orientation parameters. Additionally an initial inertiaCoefficents vector is
-		 * calculated according to the size and type of collision primitiv.
-         * Whenever any of the parameters is a null pointer, it is ignored.
-         * The created collision primitive gets cached for the given mesh,
-         * so whenever an other entity with the same mesh tries to fetch
-         * a collision primitive here, then it gets back the already existing
-         * one (no need to duplicate).
-         * 
-         * Scaling should be implemented through attaching to a scene node.
-         * if that is not the case, we'll have to fix OgreNewt ...
-		 * @param entity gives the mesh entity that needs a collision primitive
-		 * @param geomType specifies the type of collision primitiv to create.
-		 * @param offset gives the offset of the coordinate system of the coll. primitiv
-		 * @param orientation Quaternion gives an euler rotation for the coordinate system of the coll. primitiv
-         * @param mass gives the mass of the collision primitive used for calculating the inertia
-		 * @param inertia Vector3 returns the inertia coefficients for the created collision primitiv
-		 * @param centerOfMass Vector3 returns the centerOfMass coefficients for the created collision primitiv
-         * @param nocache if set to true a new collision will be created (without looking for an existing one in the cache);
-         *                the new collision is not added to the cache
-		*/
-        OgreNewt::CollisionPtr createCollisionFromEntity(
-            Ogre::Entity* entity,
-            const GeometryType&amp; geomType,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation,
-            const Ogre::Real Mass,
-            Ogre::Vector3* inertia,
-            Ogre::Vector3* centerOfMass,
-            bool nocache);
-
-        /** creates a collision primitive for OgreNewt.
-		 * The collision primitive created has got a basic orientation which can be influenced by
-		 * offset and orientation parameters. Additionally an initial inertiaCoefficents vector is
-		 * calculated according to the size and type of collision primitiv.
-         * Whenever any of the parameters is a null pointer, it is ignored.
-         * The created collision primitive gets cached for the given aabb,
-         * so whenever an other aabb with the same name tries to fetch
-         * a collision primitive here, then it gets back the already existing
-         * one (no need to duplicate). There's no difference between Collisions created through an aabb or through
-         * the entity in the cache. In order to supply a support for 'scaling' the size of the cached collision is
-         * checked.
-         * Since no entity is given several physical collision primitives are not
-         * possible (convexhull, tree, etc.)
-         * // no scaling at the moment, the correct scale must be given (OgreNewt cannot scale a collision, this is a limitation
-         * // of newton. It is only possible to 'scale' a convex collision by created a ConvexHullModifier (a new collision,
-         * // that uses the old one and applies transformation through a matrix), so for aabbs (-&gt; convex collisions) a scale
-         * // that udpates with the scale of the node could be implemented, but as this would be different for treecollisions,
-         * // it is better to create a collision with the correct scale...
-         * // &quot;Scaling should be implemented through attaching to a scene node.
-         * // if that is not the case, we'll have to fix OgreNewt ...&quot;
-         * @param name gives the name of the AxisAlignedBox
-		 * @param aabb AxisAlignedBox that contains the extents for the collision primitive to be created
-		 * @param geomType specifies the type of collision primitiv to create.
-		 * @param offset gives the offset of the coordinate system of the coll. primitiv
-		 * @param orientation Quaternion gives an euler rotation for the coordinate system of the coll. primitiv
-         * @param mass gives the mass of the collision primitive used for calculating the inertia
-		 * @param inertia Vector3 returns the inertia coefficients for the created collision primitiv
-		 * @param centerOfMass Vector3 returns the centerOfMass coefficients for the created collision primitiv
-         * @param nocache if set to true a new collision will be created (without looking for an existing one in the cache);
-         *                the new collision is not added to the cache
-		*/
-        OgreNewt::CollisionPtr createCollisionFromAABB(
-            const Ogre::String&amp; name,
-            const Ogre::AxisAlignedBox&amp; aabb,
-            const GeometryType&amp; geomType,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation,
-            const Ogre::Real Mass,
-            Ogre::Vector3* inertia,
-            Ogre::Vector3* centerOfMass,
-            bool nocache);
-
-        /// clear the collision cache
-        void clearCollisionCache();
-
-    protected:
-        /** checks if the specified size is ok for OgreNewt
-         * @param aabb check the aabb's size
-         */
-        bool checkSize(const Ogre::AxisAlignedBox&amp; aabb) const;
-
-        /** corrects the specified size if it is not ok for OgreNewt
-         * @param aabb correct the aabb's size
-         */
-        void correctSize(Ogre::AxisAlignedBox&amp; aabb);
-
-        /** creates a box collision primitive with offset at middle of bottom layer.
-         * It's actually a convenience function used by both createCollision functions.
-         * @param aabb gives the axis aligned dimension to create the primitive for.
-         * @param offset when not null, specifies a different offset than the standard.
-         * @param orientation when not null, specifies the euler angle of orientation.
-         */
-        OgreNewt::ConvexCollisionPtr createBox(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation);
-
-        /** creates a pyramid collision primitive with offset at middle of bottom layer.
-         * It's actually a convenience function used by both createCollision functions.
-         * @param aabb gives the axis aligned dimension to create the primitive for.
-         * @param offset when not null, specifies a different offset than the standard.
-         * @param orientation when not null, specifies the euler angle of orientation.
-         */
-        OgreNewt::ConvexCollisionPtr createPyramid(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation);
-
-        /** creates a sphere collision primitive with offset at middle of bottom layer.
-         * It's actually a convenience function used by both createCollision functions.
-         * @param aabb gives the axis aligned dimension to create the primitive for.
-         * @param offset when not null, specifies a different offset than the standard.
-         * @param orientation when not null, specifies the euler angle of orientation.
-         */
-        OgreNewt::ConvexCollisionPtr createSphere(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation);
-
-        /** creates a ellipsoid collision primitive with offset at middle of bottom layer.
-         * It's actually a convenience function used by both createCollision functions.
-         * @param aabb gives the axis aligned dimension to create the primitive for.
-         * @param offset when not null, specifies a different offset than the standard.
-         * @param orientation when not null, specifies the euler angle of orientation.
-         */
-        OgreNewt::ConvexCollisionPtr createEllipsoid(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation);
-
-        /** creates a capsule collision primitive with offset at middle of bottom layer.
-         * It's actually a convenience function used by both createCollision functions.
-         * @param aabb gives the axis aligned dimension to create the primitive for.
-         * @param offset when not null, specifies a different offset than the standard.
-         * @param orientation when not null, specifies the euler angle of orientation.
-         */
-        OgreNewt::ConvexCollisionPtr createCapsule(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation);
-
-        /** creates a convex-hull collision primitive with offset at middle of bottom layer.
-         * It's actually a convenience function used by createCollisionFromEntity
-         * @param entity the entity for which a convexhull should be created, if it is attached to
-         *               a node the scale of the node is used (see OgreNewt)
-         * @param offset when not null, specifies a different offset than the standard.
-         * @param orientation when not null, specifies the euler angle of orientation.
-         */
-        OgreNewt::ConvexCollisionPtr createConvexHull(
-            Ogre::Entity* entity,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation);
-
-
-        //! class for caching convex collisions (box...convexhull), saves additionally the scale, so it can be rescaled if necessary
-        class ConvexCollisionCacheObject
-        {
-            public:
-                ConvexCollisionCacheObject() :
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
-                    col(NULL),
-#endif
-                    scale(Ogre::Vector3::ZERO),
-                    type(GT_NONE)
-                    {}
-                OgreNewt::ConvexCollisionPtr col;
-                Ogre::Vector3 scale;
-                GeometryType type;
-        };
-
-        typedef std::map&lt;Ogre::String, ConvexCollisionCacheObject&gt; ConvexCollisionCacheMap;
-
-        //! cache for convex collisions
-        ConvexCollisionCacheMap mConvexCollisionsCache;
-
-        //! for using a string and a vector as key in a map... we should implement here a hash-function
-        class StringVector
-        {
-            public:
-                StringVector(const Ogre::String&amp; str, const Ogre::Vector3&amp; vec) : mStr(str)
-                {
-                    setVector(vec);
-                }
-                void setString(const Ogre::String&amp; str) {mStr = str;}
-                void setVector(const Ogre::Vector3&amp; vec)
-                {
-                    mVec = vec;
-                }
-                const Ogre::String&amp; getString() const {return mStr;}
-                const Ogre::Vector3&amp; getVector() const {return mVec;}
-
-                bool operator==(const StringVector&amp; strVec) const
-                {
-                    if( mStr != strVec.mStr )
-                        return false;
-
-                    Ogre::Vector3 diff = mVec - strVec.mVec;
-                    if( abs(diff.x) &gt; 0.01 )
-                        return false;
-                    if( abs(diff.y) &gt; 0.01 )
-                        return false;
-                    if( abs(diff.z) &gt; 0.01 )
-                        return false;
-
-                    return true;
-                }
-
-                bool operator&lt;(const StringVector&amp; strVec) const
-                {
-                    int strCompare = mStr.compare(strVec.mStr);
-                    if( strCompare == 0 ) // strings are the same
-                    {
-                        // compare vectors
-                        Ogre::Vector3 diff = mVec - strVec.mVec;
-                        if( diff.x &lt; -0.01 )
-                            return true;
-                        if( diff.x &gt; 0.01 )
-                            return false;
-                        if( diff.y &lt; -0.01 )
-                            return true;
-                        if( diff.y &gt; 0.01 )
-                            return false;
-                        if( diff.y &lt; -0.01 )
-                            return true;
-
-                        return false;
-                    }
-                    
-                    return strCompare &lt; 0;
-                }
-            private:
-                Ogre::String mStr;
-                Ogre::Vector3 mVec;
-        };
-
-        typedef std::map&lt;StringVector, OgreNewt::CollisionPtr&gt; MeshCollisionCacheMap;
-
-        //! cache for mesh collisions
-        MeshCollisionCacheMap mMeshCollisionsCache;
-
-
-
-    };
 }
 
 #endif
+

Modified: rl/branches/persistence2/engine/core/src/ConfigurationManager.cpp
===================================================================
--- rl/branches/persistence2/engine/core/src/ConfigurationManager.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/src/ConfigurationManager.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -97,6 +97,7 @@
         addSetting(&quot;Movement keys&quot;, &quot;run&quot;, &quot;Umschalt links&quot;);
         addSetting(&quot;Movement keys&quot;, &quot;sneak&quot;, &quot;Strg links&quot;);
         addSetting(&quot;Movement keys&quot;, &quot;run_lock&quot;, &quot;&lt; | &gt;&quot;);
+        addSetting(&quot;Movement keys&quot;, &quot;rear_view&quot;, &quot;T&quot;);
 
         addSetting(&quot;Action keys&quot;, &quot;quitgame&quot;, &quot;Ctrl+X&quot;);
         addSetting(&quot;Action keys&quot;, &quot;closecurrentwindow&quot;, &quot;Escape&quot;);

Modified: rl/branches/persistence2/engine/core/src/GameAreaTypes.cpp
===================================================================
--- rl/branches/persistence2/engine/core/src/GameAreaTypes.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/src/GameAreaTypes.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -238,21 +238,14 @@
         }
         OgreNewt::CollisionPtr col =
             PhysicsManager::getSingleton().createCollision(entity,
-            geomType, &quot;&quot;, &amp;offset, &amp;orientation);
+            geomType, &quot;&quot;, offset, orientation);
         mBody = new OgreNewt::Body(
             PhysicsManager::getSingleton()._getNewtonWorld(),
             col);
         mBody-&gt;setMaterialGroupID(
             PhysicsManager::getSingleton().getMaterialID(&quot;gamearea&quot;));
-#ifndef OGRENEWT_USE_OGRE_ANY
-        mBody-&gt;setUserData(NULL);
-#endif
 
-#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
         boost::dynamic_pointer_cast&lt;OgreNewt::ConvexCollision&gt;(col)-&gt;setAsTriggerVolume(true);
-#else
-        dynamic_cast&lt;OgreNewt::ConvexCollisionPtr&gt;(col)-&gt;setAsTriggerVolume(true);
-#endif
     }
 
     GameSimpleCollisionAreaType::GameSimpleCollisionAreaType(
@@ -263,21 +256,14 @@
     {
         OgreNewt::CollisionPtr col =
             PhysicsManager::getSingleton().createCollision(
-            &quot;&quot;, aabb, geomType, &amp;offset, &amp;orientation, 0, NULL, NULL, true);
+            &quot;&quot;, aabb, geomType, offset, orientation, 0, NULL, NULL, true);
         mBody = new OgreNewt::Body(
             PhysicsManager::getSingleton()._getNewtonWorld(),
             col);
         mBody-&gt;setMaterialGroupID(
             PhysicsManager::getSingleton().getMaterialID(&quot;gamearea&quot;));
-#ifndef OGRENEWT_USE_OGRE_ANY
-        mBody-&gt;setUserData(NULL);
-#endif
 
-#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
         boost::dynamic_pointer_cast&lt;OgreNewt::ConvexCollision&gt;(col)-&gt;setAsTriggerVolume(true);
-#else
-        dynamic_cast&lt;OgreNewt::ConvexCollisionPtr&gt;(col)-&gt;setAsTriggerVolume(true);
-#endif
     }
 
 }

Modified: rl/branches/persistence2/engine/core/src/GameEventManager.cpp
===================================================================
--- rl/branches/persistence2/engine/core/src/GameEventManager.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/src/GameEventManager.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -308,13 +308,9 @@
 
     Actor* GameEventManager::bodyToActor(OgreNewt::Body* body)
     {
-#ifdef OGRENEWT_USE_OGRE_ANY
         if( body-&gt;getUserData().getType() == typeid(Actor*) )
             return Ogre::any_cast&lt;Actor*&gt;(body-&gt;getUserData());
         else
             return NULL;
-#else
-        return static_cast&lt;Actor*&gt;(body-&gt;getUserData());
-#endif
     }
 }

Modified: rl/branches/persistence2/engine/core/src/PhysicalThing.cpp
===================================================================
--- rl/branches/persistence2/engine/core/src/PhysicalThing.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/src/PhysicalThing.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -127,11 +127,7 @@
 	void PhysicalThing::setBody(OgreNewt::Body* body)
     {
         mBody = body;
-#ifdef OGRENEWT_USE_OGRE_ANY
 		mBody-&gt;setUserData( Ogre::Any(mActor) );
-#else
-        mBody-&gt;setUserData( mActor );
-#endif
     }
 
     void PhysicalThing::_update()
@@ -159,11 +155,7 @@
         mActor = actor;
 		if (mBody != NULL)
         {
-#ifdef OGRENEWT_USE_OGRE_ANY
     		mBody-&gt;setUserData( Ogre::Any(mActor) );
-#else
-            mBody-&gt;setUserData( mActor );
-#endif
         }
     }
 
@@ -289,8 +281,8 @@
                 entity,
                 mGeometryType,
                 &quot;&quot;,
-                NULL,
-                NULL,
+                Vector3::ZERO,
+                Quaternion::IDENTITY,
                 0, NULL, NULL,
                 true); // don't cache
         if( collision )
@@ -515,8 +507,8 @@
                 entity,
                 mGeometryType,
                 &quot;&quot;,
-                NULL,
-                NULL,
+                Vector3::ZERO,
+                Quaternion::IDENTITY,
                 mMass,
                 &amp;inertia,
                 &amp;centerOfMass);
@@ -528,8 +520,8 @@
                 &quot;&quot;, // @todo: can we use a name here?
                 aabb,
                 mGeometryType,
-                NULL,
-                NULL,
+                Vector3::ZERO,
+                Quaternion::IDENTITY,
                 mMass,
                 &amp;inertia,
                 &amp;centerOfMass);

Copied: rl/branches/persistence2/engine/core/src/PhysicsCollisionFactory.cpp (from rev 4939, rl/trunk/engine/core/src/PhysicsCollisionFactory.cpp)

Modified: rl/branches/persistence2/engine/core/src/PhysicsGenericContactCallback.cpp
===================================================================
--- rl/branches/persistence2/engine/core/src/PhysicsGenericContactCallback.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/src/PhysicsGenericContactCallback.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -32,7 +32,6 @@
         Actor* a1 = NULL;
         Actor* a2 = NULL;
 
-#ifdef OGRENEWT_USE_OGRE_ANY
         try
         {
             a1 = Ogre::any_cast&lt;Actor*&gt;(contactJoint.getBody0()-&gt;getUserData());
@@ -49,10 +48,7 @@
         {
             LOG_WARNING(Logger::CORE, &quot;Found collision with a OgreNewt::Body that doesn't have an Actor as UserData in PhysicsGenericContactCallback::contactsProcess&quot;);
         }
-#else
-        a1 = static_cast&lt;Actor*&gt;(contactJoint.getBody0()-&gt;getUserData());
-        a2 = static_cast&lt;Actor*&gt;(contactJoint.getBody1()-&gt;getUserData());
-#endif
+
         if (a1 &amp;&amp; a1-&gt;getPhysicalThing()-&gt;getContactListener())
         {
             a1-&gt;getPhysicalThing()-&gt;getContactListener()-&gt;

Modified: rl/branches/persistence2/engine/core/src/PhysicsManager.cpp
===================================================================
--- rl/branches/persistence2/engine/core/src/PhysicsManager.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/src/PhysicsManager.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -23,6 +23,7 @@
 #include &quot;Exception.h&quot;
 #include &quot;GameEventManager.h&quot;
 #include &quot;PhysicsController.h&quot;
+#include &quot;PhysicsCollisionFactory.h&quot;
 #include &quot;PhysicsGenericContactCallback.h&quot;
 #include &quot;PhysicalObject.h&quot;
 #include &quot;PhysicalThing.h&quot;
@@ -113,6 +114,16 @@
 
     PhysicsManager::~PhysicsManager()
     {
+        // remove all bodies
+        clearLevelGeometry();
+
+        // remove all physical things
+        for( vector&lt;PhysicalThing*&gt;::iterator it = mPhysicalThings.begin(); it != mPhysicalThings.end(); it++ )
+        {
+            delete (*it);
+        }
+
+
         // remove all material-pairs
         for (MaterialPairMap::iterator it = mMaterialPairs.begin(); it != mMaterialPairs.end(); it++)
         {
@@ -324,9 +335,6 @@
 
         // try one compound collision for the entity if there are several collisions
         OgreNewt::CollisionPtr collision;
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
-        collision = NULL;
-#endif
         switch( collisions.size() )
         {
             case 0:
@@ -405,11 +413,7 @@
         // apply saved forces in the PhysicalThing
         PhysicalThing* thing;
 
-#ifdef OGRENEWT_USE_OGRE_ANY
         thing = Ogre::any_cast&lt;Actor*&gt;(body-&gt;getUserData())-&gt;getPhysicalThing();
-#else
-        thing = static_cast&lt;Actor*&gt;(body-&gt;getUserData())-&gt;getPhysicalThing();
-#endif
 
         thing-&gt;onApplyForceAndTorque(timestep);
     }
@@ -418,11 +422,7 @@
     {
         PhysicalThing* thing;
 
-#ifdef OGRENEWT_USE_OGRE_ANY
         thing = Ogre::any_cast&lt;Actor*&gt;(body-&gt;getUserData())-&gt;getPhysicalThing();
-#else
-        thing = static_cast&lt;Actor*&gt;(body-&gt;getUserData())-&gt;getPhysicalThing();
-#endif
 
 
         if (thing-&gt;getPhysicsController())
@@ -517,12 +517,12 @@
 
     OgreNewt::CollisionPtr PhysicsManager::createCollision(
         Ogre::Entity* entity, const GeometryType&amp; geomType,
-		const Ogre::String&amp; animName, const Ogre::Vector3* offset,
-        const Ogre::Quaternion* orientation, const Ogre::Real mass, Ogre::Vector3* inertia,
+		const Ogre::String&amp; animName, const Ogre::Vector3 &amp;offset,
+        const Ogre::Quaternion &amp;orientation, const Ogre::Real mass, Ogre::Vector3* inertia,
         Ogre::Vector3* centerOfMass, bool nocache)
     {
         return mPhysicsCollisionFactory-&gt;createCollisionFromEntity(
-                entity, geomType, offset, orientation, mass, inertia, centerOfMass, nocache );
+                entity, geomType, animName, offset, orientation, mass, inertia, centerOfMass, nocache );
 /*
         // problem here is that a mesh can have different animations with
         // different extents. Therefore we add the animName to the meshname
@@ -531,9 +531,6 @@
 
         // result value
         CollisionPtr rval;
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
-        rval = NULL;
-#endif
 
         // check if there is a collision primitiv for the specified mesh object
         CollisionInUse &amp;usedcol (mCollisionPrimitives[collisionName]);
@@ -571,8 +568,8 @@
 
     OgreNewt::CollisionPtr PhysicsManager::createCollision(
         const Ogre::String&amp; name, const Ogre::AxisAlignedBox&amp; aabb,
-        const GeometryType&amp; geomType, const Ogre::Vector3* offset,
-        const Ogre::Quaternion* orientation, const Ogre::Real mass, Ogre::Vector3* inertia,
+        const GeometryType&amp; geomType, const Ogre::Vector3 &amp;offset,
+        const Ogre::Quaternion &amp;orientation, const Ogre::Real mass, Ogre::Vector3* inertia,
         Ogre::Vector3* centerOfMass, bool nocache)
     {
         return mPhysicsCollisionFactory-&gt;createCollisionFromAABB(
@@ -580,9 +577,6 @@
 /*
         // result value
         CollisionPtr rval;
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
-        rval = NULL;
-#endif
 
         // check if there is a collision primitiv for the specified mesh object
         CollisionInUse &amp;usedcol (mCollisionPrimitives[name]);
@@ -656,413 +650,5 @@
 			typestr = &quot;convexhull&quot;;
 		return typestr;
 	}
-
-    PhysicsCollisionFactory::~PhysicsCollisionFactory()
-    {
-        clearCollisionCache();
-    }
-
-    void PhysicsCollisionFactory::clearCollisionCache()
-    {
-        mMeshCollisionsCache.clear();
-        mConvexCollisionsCache.clear();
-    }
-
-    bool PhysicsCollisionFactory::checkSize(const Ogre::AxisAlignedBox&amp; aabb) const
-    {
-        Ogre::Vector3 size = aabb.getSize();
-        if( size.x &lt; PhysicsManager::NEWTON_GRID_WIDTH ||
-            size.y &lt; PhysicsManager::NEWTON_GRID_WIDTH ||
-            size.z &lt; PhysicsManager::NEWTON_GRID_WIDTH )
-            return false;
-        return true;
-    }
-
-    void PhysicsCollisionFactory::correctSize(Ogre::AxisAlignedBox&amp; aabb)
-    {
-        Ogre::Vector3 size = aabb.getSize();
-        // correct size, log warning and fail back to box
-        if (size.x &lt; PhysicsManager::NEWTON_GRID_WIDTH)
-            size.x = PhysicsManager::NEWTON_GRID_WIDTH;
-        if (size.y &lt; PhysicsManager::NEWTON_GRID_WIDTH)
-            size.y = PhysicsManager::NEWTON_GRID_WIDTH;
-        if (size.z &lt; PhysicsManager::NEWTON_GRID_WIDTH)
-            size.z = PhysicsManager::NEWTON_GRID_WIDTH;
-        LOG_MESSAGE(Logger::CORE, &quot;Correcting collision primitiv size&quot;);
-        Ogre::Vector3 center = aabb.getCenter();
-        aabb.setMaximum(center + 0.5*size);
-        aabb.setMinimum(center - 0.5*size);
-    }
-
-    /*
-    Ogre::Vector3 PhysicsCollisionFactory::calculateIntertia(const Ogre::Real&amp; Mass, Ogre::Vector3* inertiaCoefficients)
-    {
-        return Ogre::Vector3(0,0,0);
-    }
-    */
-
-    OgreNewt::CollisionPtr PhysicsCollisionFactory::createCollisionFromAABB(
-        const Ogre::String&amp; name,
-        const Ogre::AxisAlignedBox&amp; passedAabb,
-        const GeometryType&amp; geomType,
-        const Ogre::Vector3* offset,
-        const Ogre::Quaternion* orientation,
-        const Ogre::Real mass,
-        Ogre::Vector3* inertia,
-        Ogre::Vector3* centerOfMass,
-        bool nocache)
-    {
-        Ogre::AxisAlignedBox aabb(passedAabb);
-        // type for the collision primitiv (can change internally here)
-        bool forceBox (false);
-
-        // result value
-        ConvexCollisionPtr rval;
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
-        rval = NULL;
-#endif
-
-        // size check (if object is too small, it falls back to a box primitiv
-        if (checkSize(aabb) == false )
-        {
-            correctSize(aabb);
-            LOG_MESSAGE(Logger::CORE,
-                &quot; AABB is too small, using 'box' instead of primitiv '&quot; +
-                PhysicsManager::convertGeometryTypeToString(geomType));
-            forceBox = true;
-        }
-
-        // check if the geometry type is supported for aabb
-        if (geomType == GT_CONVEXHULL ||
-            geomType == GT_MESH)
-        {
-            LOG_MESSAGE(Logger::CORE,
-                &quot; the geometry type '&quot;+
-                PhysicsManager::convertGeometryTypeToString(geomType)+
-                &quot;' is not supported for aabb, fail back to box&quot;);
-            forceBox = true;
-        }
-
-        /* differentiate between the different collision primitives, because they all
-		   need different offset and probably different orientation values.
-		   Newton SDK is really nifty and helps here, because we can shift the origin
-		   of the coordinate system of the primitiv we create into any position we
-		   desire. Actually this is the bottom middle of our mesh - as the meshes are
-		   always constructed like that.
-	    */
-		if (geomType == GT_BOX || forceBox == true)
-        {
-			rval = createBox(aabb, offset, orientation);
-        }
-        else if (geomType == GT_PYRAMID)
-        {
-            rval = createPyramid(aabb, offset, orientation);
-        }
-        else if (geomType == GT_SPHERE)
-        {
-			rval = createSphere(aabb, offset, orientation);
-        }
-        else if (geomType == GT_ELLIPSOID)
-        {
-            rval = createEllipsoid(aabb, offset, orientation);
-        }
-		else if (geomType == GT_CAPSULE)
-		{
-			rval = createCapsule(aabb, offset, orientation);
-		}
-
-        // calculate inertia / centerOfMass if needed
-        if (inertia != NULL || centerOfMass != NULL )
-        {
-            Vector3 temp_inertia, temp_centerOfMass;
-            rval-&gt;calculateInertialMatrix(temp_inertia, temp_centerOfMass);
-            if( inertia != NULL )
-                *inertia = temp_inertia*mass;
-            if( centerOfMass != NULL )
-                *centerOfMass = temp_centerOfMass;
-        }
-
-        return rval;
-    }
-
-    OgreNewt::CollisionPtr PhysicsCollisionFactory::createCollisionFromEntity(Ogre::Entity* entity,
-        const GeometryType&amp; geomType,
-        const Ogre::Vector3* offset,
-        const Ogre::Quaternion* orientation,
-        const Ogre::Real mass,
-        Ogre::Vector3* inertia,
-        Ogre::Vector3* centerOfMass,
-        bool nocache)
-    {
-        // bounding box of the mesh
-        Ogre::AxisAlignedBox aabb(entity-&gt;getBoundingBox());
-        // apply scale if attached to a node (like in OgreNewt for convexhull)
-        if( entity-&gt;getParentNode() )
-            aabb.scale(entity-&gt;getParentNode()-&gt;getScale());
-
-        // type for the collision primitiv (can change internally here)
-        bool forceBox (false);
-
-        // result value
-        CollisionPtr rval;
-        ConvexCollisionPtr rvalAsConvexCollision; // store pointer to ConvexCollision, so we don't need to cast
-                                                  // this also indicates, that it is possible to calculate inertia/centerOfMass
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
-        rval = NULL;
-        rvalAsConvexCollision = NULL;
-#endif
-
-        // size check (if object is too small, it falls back to a box primitiv
-        if (checkSize(aabb) == false )
-        {
-            correctSize(aabb);
-            LOG_MESSAGE(Logger::CORE, &quot; Entity '&quot;+entity-&gt;getName()+
-                &quot;' is too small, using 'box' instead of primitiv '&quot;+
-                PhysicsManager::convertGeometryTypeToString(geomType));
-            forceBox = true;
-        }
-
-		/* differentiate between the different collision primitives, because they all
-		   need different offset and probably different orientation values.
-		   Newton SDK is really nifty and helps here, because we can shift the origin
-		   of the coordinate system of the primitiv we create into any position we
-		   desire. Actually this is the bottom middle of our mesh - as the meshes are
-		   always constructed like that.
-	    */
-		if (geomType == GT_BOX || forceBox == true)
-        {
-            rvalAsConvexCollision = createBox(aabb, offset, orientation);
-            rval = rvalAsConvexCollision;
-        }
-        else if (geomType == GT_PYRAMID)
-        {
-            rvalAsConvexCollision = createPyramid(aabb, offset, orientation);
-            rval = rvalAsConvexCollision;
-        }
-        else if (geomType == GT_SPHERE)
-        {
-            rvalAsConvexCollision = createSphere(aabb, offset, orientation);
-            rval = rvalAsConvexCollision;
-        }
-        else if (geomType == GT_ELLIPSOID)
-        {
-            rvalAsConvexCollision = createEllipsoid(aabb, offset, orientation);
-            rval = rvalAsConvexCollision;
-        }
-		else if (geomType == GT_CAPSULE)
-		{
-            rvalAsConvexCollision = createCapsule(aabb, offset, orientation);
-            rval = rvalAsConvexCollision;
-		}
-        else if (geomType == GT_CONVEXHULL)
-        {
-            rvalAsConvexCollision = createConvexHull(entity, offset, orientation);
-            rval = rvalAsConvexCollision;
-        }
-        else if (geomType == GT_MESH)
-        {
-            if (inertia != NULL)
-                *inertia = Ogre::Vector3::ZERO;
-            if (centerOfMass != NULL)
-                *centerOfMass = Ogre::Vector3::ZERO;
-
-            rval = CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision(
-                PhysicsManager::getSingleton()._getNewtonWorld(),
-                entity, true ));
-        }
-        else
-        {
-            Throw(IllegalArgumentException, &quot;unknown geometry type.&quot;);
-        }
-
-        if ( rval == NULL )
-        {
-            LOG_DEBUG(Logger::CORE, &quot; creating collision primitiv '&quot;+
-                PhysicsManager::convertGeometryTypeToString(geomType)+&quot;' for Entity '&quot;+
-                entity-&gt;getName()+&quot;' failed.&quot;);
-        }
-        else
-        {
-            LOG_DEBUG(Logger::CORE, &quot; collision primitiv '&quot;+
-                PhysicsManager::convertGeometryTypeToString(geomType)+&quot;' created for Entity '&quot;+
-                entity-&gt;getName()+&quot;'&quot;);
-        }
-
-        // calculate inertia / centerOfMass if requested
-        if( rvalAsConvexCollision )
-        {
-            if (inertia != NULL || centerOfMass != NULL )
-            {
-                Vector3 temp_inertia, temp_centerOfMass;
-                rvalAsConvexCollision-&gt;calculateInertialMatrix(temp_inertia, temp_centerOfMass);
-                if( inertia != NULL )
-                    *inertia = temp_inertia*mass;
-                if( centerOfMass != NULL )
-                    *centerOfMass = temp_centerOfMass;
-            }
-        }
-
-        return rval;
-    }
-
-    OgreNewt::ConvexCollisionPtr PhysicsCollisionFactory::createBox(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation)
-    {
-        // offset of the collision primitiv
-        Ogre::Vector3 object_offset( aabb.getCenter() );
-        // orientation of the collision primitiv
-		Ogre::Quaternion object_orientation = Ogre::Quaternion::IDENTITY;
-
-        // set offset/orientation when they are null
-		if (! offset)
-			offset = &amp;object_offset;
-		if (! orientation)
-			orientation = &amp;object_orientation;
-
-        // a box collision primitiv has got it's coordinate system at it's center, so we need to shift it
-        OgreNewt::ConvexCollisionPtr rval(new OgreNewt::CollisionPrimitives::Box(
-            PhysicsManager::getSingleton()._getNewtonWorld(),
-            aabb.getSize(), *orientation, *offset));
-
-       return rval;
-    }
-
-    OgreNewt::ConvexCollisionPtr PhysicsCollisionFactory::createPyramid(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation)
-    {
-        Ogre::Vector3 size = aabb.getSize();
-        // positional offset of the collision primitiv
-        Ogre::Vector3 object_offset(aabb.getCenter());
-        // orientation of the collision primitiv
-		Ogre::Quaternion object_orientation = Ogre::Quaternion::IDENTITY;
-
-        // set offset/orientation when they are null
-		if (! offset)
-			offset = &amp;object_offset;
-		if (! orientation)
-			orientation = &amp;object_orientation;
-
-        OgreNewt::ConvexCollisionPtr rval(new OgreNewt::CollisionPrimitives::Pyramid(
-            PhysicsManager::getSingleton()._getNewtonWorld(),
-            size, *orientation, *offset));
-
-       return rval;
-    }
-
-    OgreNewt::ConvexCollisionPtr PhysicsCollisionFactory::createSphere(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation)
-    {
-        Ogre::Vector3 size = aabb.getSize();
-        // calculate the maximum radius needed to include 'everything'
-        double radius = std::max(size.x, std::max(size.y, size.z)) / 2.0;
-        // positional offset of the collision primitiv
-        Ogre::Vector3 object_offset(aabb.getCenter());
-        //object_offset.y = aabb.getMinimum().y;
-        // orientation of the collision primitiv
-		Ogre::Quaternion object_orientation = Ogre::Quaternion::IDENTITY;
-
-		// set offset/orientation when they are null
-		if (! offset)
-			offset = &amp;object_offset;
-		if (! orientation)
-			orientation = &amp;object_orientation;
- 
-        // a sphere primitiv has got its coordinate system at its center, so shift it with radius
-        OgreNewt::ConvexCollisionPtr rval(new OgreNewt::CollisionPrimitives::Ellipsoid(
-            PhysicsManager::getSingleton()._getNewtonWorld(),
-            Vector3(radius, radius, radius), *orientation, *offset));
- 
-       return rval;
-    }
-
-    OgreNewt::ConvexCollisionPtr PhysicsCollisionFactory::createEllipsoid(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation)
-    {
-        Ogre::Vector3 size = aabb.getSize();
-        // set the size x/z values to the maximum
-        Vector3 s(size/2.0);
-        s.x = std::max(s.x, s.z);
-        s.z = s.x;
-        // positional offset of the collision primitiv
-		Ogre::Vector3 object_offset(aabb.getCenter());
-        // orientation of the collision primitiv
-		Ogre::Quaternion object_orientation = Ogre::Quaternion::IDENTITY;
-
-		// set offset/orientation when they are null
-		if (! offset)
-			offset = &amp;object_offset;
-		if (! orientation)
-			orientation = &amp;object_orientation;
-
-        // an ellipsoid primitiv has got its coordinate system at its center, so shift it with radius
-        OgreNewt::ConvexCollisionPtr rval(new OgreNewt::CollisionPrimitives::Ellipsoid(
-            PhysicsManager::getSingleton()._getNewtonWorld(),
-            s, *orientation, *offset));
-
-       return rval;
-    }
-
-    OgreNewt::ConvexCollisionPtr PhysicsCollisionFactory::createCapsule(const Ogre::AxisAlignedBox&amp; aabb,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation)
-    {
-        Ogre::Vector3 size = aabb.getSize();
-        // positional offset of the collision primitiv
-		Ogre::Vector3 object_offset(aabb.getCenter());
-        // orientation of the collision primitiv
-		Ogre::Quaternion object_orientation = Ogre::Quaternion::IDENTITY;
-        double radius = std::max(size.x, size.z) / 2.0;
-		double height = size.y;
-        // @todo: fixme: this is a semi ugly fix - because the orientation should be set by the loader
-        object_orientation.FromAngleAxis(Degree(90), Vector3::UNIT_Z);
-
-		// set offset/orientation when they are null
-		if (! offset)
-    		offset = &amp;object_offset;
-		if (! orientation)
-			orientation = &amp;object_orientation;
-
-
-        // an capsule primitiv has got its coordinate system at its center, so shift it with radius
-        // additionally it is x axis aligned, so rotate it 90 degrees around z axis
-        OgreNewt::ConvexCollisionPtr rval(new OgreNewt::CollisionPrimitives::Capsule(
-            PhysicsManager::getSingleton()._getNewtonWorld(),
-            radius, height, *orientation, *offset));
-
-
-        return rval;
-    }
-
-
-
-    OgreNewt::ConvexCollisionPtr PhysicsCollisionFactory::createConvexHull(
-            Ogre::Entity* entity,
-            const Ogre::Vector3* offset,
-            const Ogre::Quaternion* orientation)
-    {
-        // offset of the collision primitiv
-        Ogre::Vector3 object_offset( Ogre::Vector3::ZERO );
-        // orientation of the collision primitiv
-        Ogre::Quaternion object_orientation = Ogre::Quaternion::IDENTITY;
-
-        // set offset/orientation when they are null
-        if (! offset)
-            offset = &amp;object_offset;
-        if (! orientation)
-            orientation = &amp;object_orientation;
-
-        // calculate the convex hull of the animated mesh
-        OgreNewt::ConvexCollisionPtr rval(new OgreNewt::CollisionPrimitives::ConvexHull(
-                    PhysicsManager::getSingleton()._getNewtonWorld(),
-                    entity, *orientation, *offset));
-
-        return rval;
-    }
-
-
 }
 

Modified: rl/branches/persistence2/engine/core/src/PhysicsRagDoll.cpp
===================================================================
--- rl/branches/persistence2/engine/core/src/PhysicsRagDoll.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/src/PhysicsRagDoll.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -35,11 +35,7 @@
 	mParent = parent;
 	mOgreBone = ogreBone;
 
-#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
 	OgreNewt::ConvexCollisionPtr col;
-#else
-	OgreNewt::ConvexCollisionPtr col = NULL;
-#endif
 
 	// in the case of the cylindrical primitives, they need to be rotated to align the main axis with the direction vector.
 	Ogre::Quaternion orient = Ogre::Quaternion::IDENTITY;
@@ -95,12 +91,7 @@
     {
         if( col-&gt;getNewtonCollision() == NULL )
         {
-#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
             col.reset();
-#else
-            delete col;
-            col = NULL;
-#endif
         }
     }
 
@@ -112,11 +103,7 @@
     else
     {
     	mBody = new OgreNewt::Body( world, col );
-#ifdef OGRENEWT_USE_OGRE_ANY
         mBody-&gt;setUserData( Ogre::Any(parentActor) );
-#else
-	    mBody-&gt;setUserData( parentActor );
-#endif
     	mBody-&gt;setStandardForceCallback();
         const OgreNewt::MaterialID* ragdollMat = PhysicsManager::getSingleton().createMaterialID(&quot;default&quot;);
         mBody-&gt;setMaterialGroupID(ragdollMat);
@@ -146,11 +133,7 @@
 
 void PhysicsRagDoll::RagBone::_hingeCallback( OgreNewt::BasicJoints::Hinge* me )
 {
-#ifdef OGRENEWT_USE_OGRE_ANY
     PhysicsRagDoll::RagBone* bone = Ogre::any_cast&lt;PhysicsRagDoll::RagBone*&gt;(me-&gt;getUserData());
-#else
-    PhysicsRagDoll::RagBone* bone = static_cast&lt;PhysicsRagDoll::RagBone*&gt;(me-&gt;getUserData());
-#endif
 
 	Ogre::Degree angle = me-&gt;getJointAngle();
 	Ogre::Degree lim1( bone-&gt;getLimit1() );
@@ -261,11 +244,7 @@
 	}
 
 	//////////////////////////////////////////////////////////////////////////////////
-#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
     OgreNewt::ConvexCollisionPtr col;
-#else
-    OgreNewt::ConvexCollisionPtr col = NULL;
-#endif
     if( numVerts &gt; 0 )
     	col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::ConvexHull( world, verts, numVerts ));
 
@@ -464,11 +443,7 @@
 	case PhysicsRagDoll::JT_HINGE:
 		joint = new OgreNewt::BasicJoints::Hinge( world, child-&gt;getBody(), parent-&gt;getBody(), pos, pin );
 		((OgreNewt::BasicJoints::Hinge*)joint)-&gt;setCallback( RagBone::_hingeCallback );
-#ifdef OGRENEWT_USE_OGRE_ANY
 		joint-&gt;setUserData( Ogre::Any(child) );
-#else
-		joint-&gt;setUserData( child );
-#endif
 		child-&gt;setLimits( limit1, limit2 );
 		break;
 	}
@@ -478,11 +453,7 @@
 
 void PhysicsRagDoll::_placementCallback( OgreNewt::Body* me, const Ogre::Quaternion&amp; orient, const Ogre::Vector3&amp; pos, int threadindex )
 {
-#ifdef OGRENEWT_USE_OGRE_ANY
     Actor* parentActor = Ogre::any_cast&lt;Actor*&gt;(me-&gt;getUserData());
-#else
-    Actor* parentActor = static_cast&lt;Actor*&gt;(me-&gt;getUserData());
-#endif
 	PhysicsRagDoll* doll = parentActor-&gt;getPhysicalThing()-&gt;getRagDoll();
     PhysicsRagDoll::RagBoneMapIterator it = doll-&gt;mRagBonesMap.find(me);
     if( it == doll-&gt;mRagBonesMap.end() )

Modified: rl/branches/persistence2/engine/core/src/PlayAnimationJob.cpp
===================================================================
--- rl/branches/persistence2/engine/core/src/PlayAnimationJob.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/src/PlayAnimationJob.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -103,15 +103,22 @@
             if (mAnimationRunning &amp;&amp; mAnimation) 
             {
                 mAnimationRunning = false;
-                if (mHoldOnEnd) 
+                    
+                mAnimation-&gt;pause();
+                
+                if (!mHoldOnEnd) 
                 {
-                    mAnimation-&gt;pause();
+                    if( mActor )
+                    {
+                        MeshObject* mo = dynamic_cast&lt;MeshObject*&gt;(mActor-&gt;getControlledObject());
+                        mo-&gt;stopAnimation(mAnimName);
+                    }
+                    else
+                    {
+                        //! TODO: what to do here?
+                    }
                 }
-                else
-                {
-                    mAnimation-&gt;stop();
-                    delete mAnimation;
-                }
+
                 mAnimation = NULL;
             }
             return true;
@@ -119,4 +126,4 @@
 
         return false;
     }
-}
\ No newline at end of file
+}

Modified: rl/branches/persistence2/engine/core/src/SceneQuery.cpp
===================================================================
--- rl/branches/persistence2/engine/core/src/SceneQuery.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/core/src/SceneQuery.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -116,15 +116,11 @@
                 if (mLevelOcclusion &amp;&amp; (body-&gt;getMaterialGroupID() == levelId)) break;
 
                 // Add actor to this body to the result
-#ifdef OGRENEWT_USE_OGRE_ANY
                 Actor* actor = NULL;
                 if( body-&gt;getUserData().getType() == typeid(Actor*) )
                 {
                     actor = Ogre::any_cast&lt;Actor*&gt;(body-&gt;getUserData());
                 }
-#else
-                Actor* actor = static_cast&lt;Actor*&gt;(body-&gt;getUserData());
-#endif
                 if (actor != NULL) mResult.push_back(actor);
             }
         }

Modified: rl/branches/persistence2/engine/rules/include/GoToJob.h
===================================================================
--- rl/branches/persistence2/engine/rules/include/GoToJob.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/rules/include/GoToJob.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -37,6 +37,7 @@
             CreatureController::MovementType movementType_moving = CreatureController::MT_RENNEN,
             CreatureController::MovementType movementType_idle = CreatureController::MT_STEHEN);
 		GoToJob(const CeGuiString &amp;id, Creature* actor, GameObject* target, Ogre::Real maxDistance, Ogre::Real duration,
+            bool followTarget = false,
             CreatureController::MovementType movementType_moving = CreatureController::MT_RENNEN,
             CreatureController::MovementType movementType_idle = CreatureController::MT_STEHEN);
         virtual ~GoToJob();
@@ -46,6 +47,7 @@
     private:
 		CreatureController* mActor;
 		GameObject* mTarget;
+        bool mFollowTarget;
 		Ogre::Vector3 mTargetPos;
 		Ogre::Real mMaxDistance;
 		Ogre::Real mTimeLeft;

Modified: rl/branches/persistence2/engine/rules/src/CreatureControllerManager.cpp
===================================================================
--- rl/branches/persistence2/engine/rules/src/CreatureControllerManager.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/rules/src/CreatureControllerManager.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -166,13 +166,9 @@
 
     void CreatureControllerManager::userProcess(OgreNewt::ContactJoint &amp;contactJoint, Real timestep, int threadid)
     {
-#ifdef OGRENEWT_USE_OGRE_ANY
         Actor *actor = NULL;
         if( contactJoint.getBody0()-&gt;getUserData().getType() == typeid(Actor*) )
             actor = Ogre::any_cast&lt;Actor*&gt;(contactJoint.getBody0()-&gt;getUserData());
-#else
-        Actor *actor = static_cast&lt;Actor*&gt;(contactJoint.getBody0()-&gt;getUserData());
-#endif
         if( actor != NULL )
         {
             ControllerMap::const_iterator it = mControllers.find(static_cast&lt;Creature*&gt;(actor-&gt;getGameObject()));
@@ -184,12 +180,8 @@
         }
 
         // if the controlled body is the second body...
-#ifdef OGRENEWT_USE_OGRE_ANY
         if( contactJoint.getBody1()-&gt;getUserData().getType() == typeid(Actor*) )
             actor = Ogre::any_cast&lt;Actor*&gt;(contactJoint.getBody1()-&gt;getUserData());
-#else
-        actor = static_cast&lt;Actor*&gt;(contactJoint.getBody1()-&gt;getUserData());
-#endif
         if( actor != NULL )
         {
             ControllerMap::const_iterator it = mControllers.find(static_cast&lt;Creature*&gt;(actor-&gt;getGameObject()));

Modified: rl/branches/persistence2/engine/rules/src/GoToJob.cpp
===================================================================
--- rl/branches/persistence2/engine/rules/src/GoToJob.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/rules/src/GoToJob.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -31,6 +31,7 @@
 		: Job(id, false, true, TimeSource::REALTIME_INTERRUPTABLE),
 		  mActor(NULL),
 		  mTarget(NULL),
+          mFollowTarget(false),
 		  mTargetPos(targetPos),
 		  mMaxDistance(maxDistance),
 		  mTimeLeft(duration),
@@ -40,11 +41,12 @@
 		mActor = CreatureControllerManager::getSingleton().getCreatureController(actor);
 	}
 
-	GoToJob::GoToJob(const CeGuiString&amp; id, Creature* actor, GameObject* target, Real maxDistance, Real duration, CreatureController::MovementType movementType_moving,
-            CreatureController::MovementType movementType_idle)
+	GoToJob::GoToJob(const CeGuiString&amp; id, Creature* actor, GameObject* target, Real maxDistance, Real duration, bool followTarget,
+			CreatureController::MovementType movementType_moving, CreatureController::MovementType movementType_idle)
 		: Job(id, false, true, TimeSource::REALTIME_INTERRUPTABLE),
 		  mActor(NULL),
 		  mTarget(target),
+          mFollowTarget(followTarget),
 		  mTargetPos(Vector3::ZERO),
 		  mMaxDistance(maxDistance),
 		  mTimeLeft(duration),
@@ -83,34 +85,43 @@
         }
         
 		// Are we there now?
-		if (distance &lt; mMaxDistance)
-		{
-			// Stay put where ever we are.
-			mActor-&gt;setMovement(mMovementType_idle, Vector3::ZERO, Vector3::ZERO);
-			return true;
-		}
-
-
-		Vector3 pos = mActor-&gt;getCreature()-&gt;getPosition();
-		pos.y = 0;
-		Vector3 targetPos = mTargetPos;
-		targetPos.y = 0;
+        Vector3 pos = mActor-&gt;getCreature()-&gt;getPosition();
+        pos.y = 0;
+        Vector3 targetPos = mTargetPos;
+        targetPos.y = 0;
         Degree realYawDiff = (mActor-&gt;getCreature()-&gt;getOrientation()*Vector3::NEGATIVE_UNIT_Z).getRotationTo(targetPos - pos).getYaw();
         Vector3 rotation = Vector3::ZERO;
         Quaternion currentOri(mActor-&gt;getYaw(), Vector3::UNIT_Y);
         rotation.y = (currentOri*Vector3::NEGATIVE_UNIT_Z).getRotationTo(targetPos - pos).getYaw().valueRadians();
 
         // old code for rotation:
-		//mActor-&gt;getCreature()-&gt;setOrientation(Vector3::NEGATIVE_UNIT_Z.getRotationTo(targetPos - pos));
-        
-        // first rotate, then move, is this the &quot;desired&quot; behaviour?
-        if( realYawDiff &gt; Degree(5) || realYawDiff &lt; Degree(-5) )
+        //mActor-&gt;getCreature()-&gt;setOrientation(Vector3::NEGATIVE_UNIT_Z.getRotationTo(targetPos - pos));
+
+        // in order to prevent fast switching between moving and idle, use a larger maxDistance if idle
+        Real maxDistance = mMaxDistance;
+        if( mFollowTarget &amp;&amp; mActor-&gt;getMovementId() == mMovementType_idle)
+            maxDistance += 0.5;
+
+        if( distance &lt; maxDistance )
+        {
+            // turn to object
             mActor-&gt;setMovement(mMovementType_idle, Vector3::ZERO, rotation);
+        }
         else
-    		mActor-&gt;setMovement(mMovementType_moving, Vector3::NEGATIVE_UNIT_Z, rotation);
+        {
+            // first rotate, then move, is this the &quot;desired&quot; behaviour?
+            if( realYawDiff &gt; Degree(5) || realYawDiff &lt; Degree(-5) )
+                mActor-&gt;setMovement(mMovementType_idle, Vector3::ZERO, rotation);
+            else
+                mActor-&gt;setMovement(mMovementType_moving, Vector3::NEGATIVE_UNIT_Z, rotation);
+        }
 
-		mTimeLeft  -= time;
-		return false;
+        mTimeLeft  -= time;
+
+        if( !mFollowTarget &amp;&amp; distance &lt; mMaxDistance )
+            return true;
+        else
+            return false;
 	}
 }
 

Modified: rl/branches/persistence2/engine/rules/src/SelectionHelper.cpp
===================================================================
--- rl/branches/persistence2/engine/rules/src/SelectionHelper.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/rules/src/SelectionHelper.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -84,13 +84,9 @@
             OgreNewt::Body* body = info.mBody;
             if (body != NULL)
             {
-#ifdef OGRENEWT_USE_OGRE_ANY
                 Actor* hitActor = NULL;
                 if( body-&gt;getUserData().getType() == typeid(Actor*) )
                     hitActor = Ogre::any_cast&lt;Actor*&gt;(body-&gt;getUserData());
-#else
-                Actor* hitActor = static_cast&lt;Actor*&gt;(body-&gt;getUserData());
-#endif
                 isVisible = hitActor == actor2 || hitActor == actor1;
                 if (!isVisible) break;
             }

Modified: rl/branches/persistence2/engine/script/src/EntityNodeProcessor.cpp
===================================================================
--- rl/branches/persistence2/engine/script/src/EntityNodeProcessor.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/script/src/EntityNodeProcessor.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -117,7 +117,6 @@
         }
 
         parentNode-&gt;attachObject(newEnt);
-        createCollision(newEnt, meshFile, getChildNamed(nodeElem, &quot;physicsproxy&quot;));
 
         DOMElement* scaleElem = getChildNamed(nodeElem, &quot;scale&quot;);
         if (scaleElem != NULL)
@@ -125,6 +124,9 @@
             parentNode-&gt;scale(processVector3(scaleElem));
         }
 
+        // in order for the scale to work correctly the collision needs to be created after the scale was applied
+        createCollision(newEnt, meshFile, getChildNamed(nodeElem, &quot;physicsproxy&quot;));
+
 		AutoXMLCh animation(&quot;animation&quot;);
 		DOMNodeList* list = nodeElem-&gt;getElementsByTagName(animation.data());
 		for (XMLSize_t idx = 0; idx &lt; list-&gt;getLength(); idx++)
@@ -173,26 +175,28 @@
                 if (physicsProxyTypeAsString == &quot;custom&quot;)
                 {
                     ///@todo create physics proxy from custom collision primitives which are defined in children elements of &lt;code&gt;physicsProxyElem&lt;code&gt;
-                    LOG_WARNING(Logger::SCRIPT, &quot;Physics proxy type 'custom' is not yet implemented.&quot;);
+                    LOG_WARNING(Logger::SCRIPT, &quot;Physics proxy type 'custom' is not yet implemented, using mesh instead&quot;);
+                    physicsProxyType = GT_MESH;
                 }
-                else if ( physicsProxyType != GT_NONE )
+            }
+
+            if ( physicsProxyType != GT_NONE )
+            {
+                OgreNewt::CollisionPtr collision = PhysicsManager::getSingleton().createCollision(entity, physicsProxyType);
+                if (collision)
                 {
-                    OgreNewt::CollisionPtr collision = PhysicsManager::getSingleton().createCollision(entity, physicsProxyType);
-                    if (collision)
-                    {
-                        LOG_DEBUG(Logger::SCRIPT, &quot;Created physics proxy type '&quot; + physicsProxyTypeAsString + &quot;' for entity '&quot;+entity-&gt;getName()+&quot;'.&quot;);
-                        std::vector&lt;OgreNewt::CollisionPtr&gt; collisionVector;
-                        collisionVector.push_back(collision);
-                        PhysicsManager::getSingleton().addLevelGeometry(entity, collisionVector);
-                    }
+                    LOG_DEBUG(Logger::SCRIPT, &quot;Created physics proxy type '&quot; + physicsProxyTypeAsString + &quot;' for entity '&quot;+entity-&gt;getName()+&quot;'.&quot;);
+                    std::vector&lt;OgreNewt::CollisionPtr&gt; collisionVector;
+                    collisionVector.push_back(collision);
+                    PhysicsManager::getSingleton().addLevelGeometry(entity, collisionVector);
                 }
-                else
-                {
-                    LOG_ERROR(Logger::SCRIPT,
-                            &quot;Physics proxy type '&quot; + physicsProxyTypeAsString + &quot;' of entity '&quot;+entity-&gt;getName()+&quot;' is unknown.&quot;);
-                    return;
-                }
             }
+            else
+            {
+                LOG_ERROR(Logger::SCRIPT,
+                        &quot;Physics proxy type '&quot; + physicsProxyTypeAsString + &quot;' of entity '&quot;+entity-&gt;getName()+&quot;' is unknown.&quot;);
+                return;
+            }
 
                 
         }

Modified: rl/branches/persistence2/engine/script/src/PlaneNodeProcessor.cpp
===================================================================
--- rl/branches/persistence2/engine/script/src/PlaneNodeProcessor.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/script/src/PlaneNodeProcessor.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -148,7 +148,7 @@
 			const Quaternion orientation(0,0,0,0);// = parentNode-&gt;getOrientation();
 			const Ogre::Vector3 pos = aab.getMinimum() * parentNode-&gt;getScale() + (size/2.0);
 
-            collision = PhysicsManager::getSingleton().createCollision(entity, GT_BOX, &quot;&quot;, NULL, NULL, 0, NULL, NULL, true);
+            collision = PhysicsManager::getSingleton().createCollision(entity, GT_BOX, &quot;&quot;, Vector3::ZERO, Quaternion::IDENTITY, 0, NULL, NULL, true);
 
 			if ( collision != NULL )
 			{

Modified: rl/branches/persistence2/engine/script/swig/RlAi.swig
===================================================================
--- rl/branches/persistence2/engine/script/swig/RlAi.swig	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/script/swig/RlAi.swig	2009-05-22 22:18:33 UTC (rev 4940)
@@ -301,8 +301,8 @@
     {
     public:
         static rl::DialogManager&amp; getSingleton();
-        rl::Dialog* createDialog(const Ogre::String&amp; name, rl::Creature* npc);
-        rl::Dialog* createDialog(const Ogre::String&amp; name, rl::CreatureList&amp; npcs);
+        // rl::Dialog* createDialog(const Ogre::String&amp; name, rl::Creature* npc); // function overloading is not working correctly here in swig
+        rl::Dialog* createDialog(const Ogre::String&amp; name, const rl::CreatureList&amp; npcs);
     private:
         DialogManager();
     };

Modified: rl/branches/persistence2/engine/script/swig/RlCore.swig
===================================================================
--- rl/branches/persistence2/engine/script/swig/RlCore.swig	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/script/swig/RlCore.swig	2009-05-22 22:18:33 UTC (rev 4940)
@@ -184,8 +184,8 @@
     virtual void setAmbientLight(Ogre::Real r, Ogre::Real g, Ogre::Real b);
     virtual Ogre::Vector3 getStartPoint() const;
     virtual void setCastShadows(bool);
-    virtual void clearScene() = 0;
-    virtual void initializeDefaultCamera() = 0;
+    virtual void clearScene() = 0;
+    virtual void initializeDefaultCamera() = 0;
 
     void setShowBoundingBoxes( bool dis );
 };
@@ -207,11 +207,19 @@
 private:
 	GameAreaType();
 public:
-	unsigned long getQueryMask() const;
-    void setQueryMask( unsigned long mask );
+	virtual unsigned long getQueryMask() const = 0;
+    virtual void setQueryMask( unsigned long mask = 0xFFFFFFFF ) = 0;
     void addQueryFlag( unsigned long flag  );
     void removeQueryFlag( unsigned long flag );
-    const Ogre::Vector3&amp; getQueryPosition() const;
+    virtual void setQueryPosition( const Ogre::Vector3&amp; vec ) = 0;
+    virtual Ogre::Vector3 getQueryPosition() const = 0;
+    virtual void setQueryOrientation( const Ogre::Quaternion&amp; ori ) = 0;
+    virtual Ogre::Quaternion getQueryOrientation() const = 0;
+    virtual OgreNewt::Body* getBody() { return NULL;}
+    virtual Ogre::Real getDistance(rl::Actor* actor) = 0;
+    virtual Ogre::Real getTransitionDistance() const = 0;
+    virtual void setTransitionDistance(Ogre::Real dist) = 0;
+    virtual bool isInside(rl::Actor *actor) = 0;
 };
 
 /*
@@ -1063,6 +1071,7 @@
     PlayAnimationJob(const rl::CeGuiString &amp;id, Actor* actor, const Ogre::String&amp; anim, int loops = 1,
 		bool replaceAllAnims=true);
     virtual ~PlayAnimationJob();
+    virtual void setHoldOnEnd(bool hold);
     
 private:
     bool execute(Ogre::Real time);

Modified: rl/branches/persistence2/engine/script/swig/RlRules.swig
===================================================================
--- rl/branches/persistence2/engine/script/swig/RlRules.swig	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/script/swig/RlRules.swig	2009-05-22 22:18:33 UTC (rev 4940)
@@ -302,7 +302,7 @@
         virtual int getTargetClass() const;
         virtual void doAction(rl::GameObject *object, rl::Creature *actor,
             rl::GameObject *target);
-        virtual bool canDo(rl::GameObject* object, rl::Creature* actor) const;
+        virtual bool canDo(rl::GameObject* object, rl::Creature* actor, rl::GameObject* target = NULL) const;
             
         void setGroup(rl::ActionGroup* group);
         rl::ActionGroup* getGroup() const;
@@ -449,9 +449,12 @@
     public:
 
 		GoToJob(const rl::CeGuiString &amp;id, rl::Creature* actor, const Ogre::Vector3&amp; targetPos,
-			Ogre::Real maxDistance, Ogre::Real duration);
-		// Unclear what version is called from ruby, so uncomment second ctor.
-		//GoToJob(rl::Creature* actor, rl::GameObject* target, Ogre::Real maxDistance, Ogre::Real duration);
+			Ogre::Real maxDistance, Ogre::Real duration,
+            rl::CreatureController::MovementType movementType_moving = rl::CreatureController::MT_RENNEN,
+            rl::CreatureController::MovementType movementType_idle = rl::CreatureController::MT_STEHEN);
+		GoToJob(const rl::CeGuiString &amp;id, rl::Creature* actor, rl::GameObject* target, Ogre::Real maxDistance, Ogre::Real duration, bool followTarget = false,
+            rl::CreatureController::MovementType movementType_moving = rl::CreatureController::MT_RENNEN,
+            rl::CreatureController::MovementType movementType_idle = rl::CreatureController::MT_STEHEN);
     };
     
     /// A rl#Job to fetch an item

Modified: rl/branches/persistence2/engine/ui/include/CommandMapper.h
===================================================================
--- rl/branches/persistence2/engine/ui/include/CommandMapper.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ui/include/CommandMapper.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -35,7 +35,8 @@
         MOVE_RUN = 1&lt;&lt;6,
         MOVE_SNEAK = 1&lt;&lt;7,
         MOVE_JUMP = 1&lt;&lt;8,
-        MOVE_RUN_LOCK = 1&lt;&lt;9
+        MOVE_RUN_LOCK = 1&lt;&lt;9,
+        REAR_VIEW = 1&lt;&lt;10
     };
 
     const int CMDMAP_NO_MAPPING = -9999999;

Modified: rl/branches/persistence2/engine/ui/include/DialogControlState.h
===================================================================
--- rl/branches/persistence2/engine/ui/include/DialogControlState.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ui/include/DialogControlState.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -19,11 +19,11 @@
 
 #include &quot;UiPrerequisites.h&quot;
 #include &quot;DialogController.h&quot;
+#include &quot;Creature.h&quot;
 
 namespace rl {
 
 	class Actor;
-    class Creature;
 	class Dialog;
     class DialogElement;
 	class DialogWindow;
@@ -83,7 +83,7 @@
 
 		DialogWindow* mDialogWindow;
 
-        virtual void recalculateDialogCamera(Creature* speaker, std::list&lt;Creature*&gt; listeners);
+        virtual void recalculateDialogCamera(Creature* speaker, const CreatureList&amp; listeners);
 
         void showOptions(const std::list&lt;DialogOption*&gt;&amp; options);
 	};

Modified: rl/branches/persistence2/engine/ui/include/DialogController.h
===================================================================
--- rl/branches/persistence2/engine/ui/include/DialogController.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ui/include/DialogController.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -9,15 +9,12 @@
 #define DIALOGCONTROLLER_H_
 
 #include &quot;AiPrerequisites.h&quot;
-
-#include &lt;list&gt;
-
 #include &quot;ControlState.h&quot;
+#include &quot;Creature.h&quot;
 
 namespace rl
 {
     class Actor;
-    class Creature;
     class Dialog;
     class DialogOption;
     class DialogParagraph;
@@ -52,7 +49,7 @@
         void doTalk(DialogParagraph* paragraph, DialogWindow* window = NULL);
         Ogre::Vector3 getParticipantPosition(Creature* participant);
         virtual bool textFinished();
-        virtual void recalculateDialogCamera(Creature* speaker, std::list&lt;Creature*&gt; listeners) = 0;
+        virtual void recalculateDialogCamera(Creature* speaker, const CreatureList&amp; listeners) = 0;
         virtual void handleDialogEnd() = 0;
         void setDialogWindow(DialogWindow* window);
         void setSubtitleWindow(SubtitleWindow* window);
@@ -68,7 +65,7 @@
         Ogre::Real mTotalFadeTextTime;
         Ogre::Real mSubtitleSpeed;
         Creature* mCurrentSpeaker;
-        std::list&lt;Creature*&gt; mCurrentListeners;
+        CreatureList mCurrentListeners;
         /// Der Untertitel-Text
         CeGuiString mText;
         /// Es wird gerade Text angezeigt

Modified: rl/branches/persistence2/engine/ui/include/MovementControlState.h
===================================================================
--- rl/branches/persistence2/engine/ui/include/MovementControlState.h	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ui/include/MovementControlState.h	2009-05-22 22:18:33 UTC (rev 4940)
@@ -112,6 +112,7 @@
         std::pair&lt;Ogre::Real, Ogre::Real&gt; mDistanceRange;
         Ogre::Degree mCamYaw; // f&#252;r VM_FREE_CAMERA
         Ogre::Degree mCamVirtualYaw; // helps to simulate strafe+forward/backward movement
+        Ogre::Degree mCamRearViewYaw; // helps to create smooth rear view effect
         Ogre::Degree mNewCamVirtualYaw; // s.o.
         Ogre::Degree mPitch;
         Ogre::Degree mRoll;

Modified: rl/branches/persistence2/engine/ui/src/CommandMapper.cpp
===================================================================
--- rl/branches/persistence2/engine/ui/src/CommandMapper.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ui/src/CommandMapper.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -252,6 +252,10 @@
         {
             return MOVE_RUN_LOCK;
         }
+        else if (movementDescription == &quot;rear_view&quot;)
+        {
+            return REAR_VIEW;
+        }
 
         return MOVE_NONE;
     }

Modified: rl/branches/persistence2/engine/ui/src/DialogControlState.cpp
===================================================================
--- rl/branches/persistence2/engine/ui/src/DialogControlState.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ui/src/DialogControlState.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -196,7 +196,7 @@
                 + StringConverter::toString(mCurrFadeTextTime));
     }
 
-    void DialogControlState::recalculateDialogCamera(Creature* speaker, std::list&lt;Creature*&gt; listeners)
+    void DialogControlState::recalculateDialogCamera(Creature* speaker, const CreatureList&amp; listeners)
     {
         // Position camera at position between char and dialog partner
         Vector3 speakerEyes = getParticipantPosition(speaker);
@@ -221,8 +221,8 @@
         mSubtitleWindow = NULL;
         if (mDialog != NULL)
         {
-            const list&lt;Creature*&gt; list = mDialog-&gt;getParticipants();
-            for (std::list&lt;Creature*&gt;::const_iterator it = list.begin(); it != list.end(); ++it)
+            const CreatureList list = mDialog-&gt;getParticipants();
+            for (CreatureList::const_iterator it = list.begin(); it != list.end(); ++it)
             {
                 Actor* actor = (*it)-&gt;getActor();
                 if (actor != NULL)

Modified: rl/branches/persistence2/engine/ui/src/ItemDragContainer.cpp
===================================================================
--- rl/branches/persistence2/engine/ui/src/ItemDragContainer.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ui/src/ItemDragContainer.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -55,6 +55,8 @@
             if(mDestroyListener)
                 mDestroyListener-&gt;notifyItemDragContainerDestroyed(this);
             setDestroyListener(NULL);
+
+            stopFadeOut();
         }
 
 	void ItemDragContainer::destroy()
@@ -62,21 +64,25 @@
             if(mDestroyListener)
                 mDestroyListener-&gt;notifyItemDragContainerDestroyed(this);
             setDestroyListener(NULL);
+            stopFadeOut();
 
             CEGUI::DragContainer::destroy();
-/*        
-        stopFadeOut();
 
-        hide();
-		if (getParent())
-		{
-			getParent()-&gt;removeChildWindow(this);
-		}
-		removeAllEvents();
-		mContentWindow-&gt;removeAllEvents();
-		removeChildWindow(mContentWindow);
-		CEGUI::WindowManager::getSingleton().destroyWindow(mContentWindow);
-        CEGUI::WindowManager::getSingleton().destroyWindow(this);
+
+/*
+            hide();
+		
+            if (getParent())
+            {
+                getParent()-&gt;removeChildWindow(this);
+            }
+
+            removeAllEvents();
+            if( mContentWindow )
+            mContentWindow-&gt;removeAllEvents();
+            removeChildWindow(mContentWindow);
+            CEGUI::WindowManager::getSingleton().destroyWindow(mContentWindow);
+            CEGUI::WindowManager::getSingleton().destroyWindow(this);
 */
 	}
 /*

Modified: rl/branches/persistence2/engine/ui/src/MovementControlState.cpp
===================================================================
--- rl/branches/persistence2/engine/ui/src/MovementControlState.cpp	2009-05-22 20:34:43 UTC (rev 4939)
+++ rl/branches/persistence2/engine/ui/src/MovementControlState.cpp	2009-05-22 22:18:33 UTC (rev 4940)
@@ -73,6 +73,7 @@
         mCamYaw(0),
         mCamVirtualYaw(0),
         mNewCamVirtualYaw(0),
+        mCamRearViewYaw(0),
         mPitch(20),
         mRoll(0),
         mPitchRange(Degree(-75), Degree(85)),
@@ -87,9 +88,6 @@
         mViewMode(VM_THIRD_PERSON),
         mRaycast(new PhysicsMaterialRaycast()),
         mConvexcast(new PhysicsMaterialConvexcast()),
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
-        mCameraCastCollision(NULL),
-#endif
         mSelector(CoreSubsystem::getSingleton().getWorld()-&gt;getSceneManager()),
         mCombatSelector(CoreSubsystem::getSingleton().getWorld()-&gt;getSceneManager(),
             QUERYFLAG_CREATURE),
@@ -174,9 +172,6 @@
         mSelector.setFilter(NULL);
         delete mRaycast;
         delete mConvexcast;
-#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
-        delete mCameraCastCollision;
-#endif
 
         if (DebugWindow::getSingletonPtr())
         {
@@ -313,9 +308,9 @@
     void MovementControlState::updateCharacter(Ogre::Real elapsedTime)
     {
         InputManager* im = InputManager::getSingletonPtr();
+        int movement = mCharacterState.mCurrentMovementState;
         if( mController != NULL )
         {
-            int movement = mCharacterState.mCurrentMovementState;
             Degree rotation(0);
 
             AbstractMovement *drehen = mController-&gt;getMovementFromId(CreatureController::MT_DREHEN);
@@ -347,7 +342,7 @@
                 }
 
 
-                if( mViewMode != VM_PNYX_MODE  &amp;&amp; mViewMode != VM_FIRST_PERSON )
+                if( mViewMode != VM_PNYX_MODE  )//&amp;&amp; mViewMode != VM_FIRST_PERSON )
                 {
                     // virtual yaw
                     if( mCamVirtualYaw != mNewCamVirtualYaw )
@@ -366,14 +361,14 @@
                     }
                     else
                     {
-                        mNewCamVirtualYaw =Degree(0);
+                        mNewCamVirtualYaw = Degree(0);
                     }
                     if( mCamVirtualYaw != mNewCamVirtualYaw )
                     {
                         rotation += mCamVirtualYaw - mNewCamVirtualYaw;
                     }
                 }
-
+/*
                 if( mViewMode == VM_FIRST_PERSON )
                 {
                     if( ((movement &amp; MOVE_FORWARD) &amp;&amp; (movement &amp; MOVE_RIGHT) &amp;&amp; !(movement &amp; MOVE_LEFT)) ||
@@ -406,6 +401,7 @@
                         }
                     }
                 }
+*/
             }
 
 
@@ -589,6 +585,23 @@
                 }
             }
         }
+
+
+        if ( movement &amp; REAR_VIEW )
+        {
+            if( mCamRearViewYaw &lt; Degree(180) )
+                mCamRearViewYaw += elapsedTime*Degree(2*360);
+            if( mCamRearViewYaw &gt; Degree(180) )
+                mCamRearViewYaw = Degree(180);
+        }
+        else
+        {
+            if( mCamRearViewYaw &gt; Degree(0) )
+                mCamRearViewYaw -= elapsedTime*Degree(2*360);
+            if( mCamRearViewYaw &lt; Degree(0) )
+                mCamRearViewYaw = Degree(0);
+        }
+
     }
 
     // ------------------------------------------------------------------------
@@ -624,7 +637,7 @@
         charPos = mCharacter-&gt;getActor()-&gt;getWorldPosition();
         Quaternion charOri = mCharacter-&gt;getActor()-&gt;getWorldOrientation();
         Quaternion virtualCamOri;
-        virtualCamOri.FromAngleAxis(mCamVirtualYaw, Vector3::UNIT_Y);
+        virtualCamOri.FromAngleAxis(mCamVirtualYaw+mCamRearViewYaw, Vector3::UNIT_Y);
 
 
         // Kamera-Gr&#239;&#191;&#189;e beziehen
@@ -649,8 +662,8 @@
         {
            cameraNode-&gt;lookAt(
                 charPos
-                + charOri * /* virtualCamOri * */  mLookAtOffset
-                + charOri * /* virtualCamOri * */ (-Vector3::UNIT_Z*radius),   // doesn't work smoothly with strafe+forward
+                + charOri * virtualCamOri *  mLookAtOffset
+                + charOri * virtualCamOri *  (-Vector3::UNIT_Z*radius),   // doesn't work smoothly with strafe+forward
                 Node::TS_WORLD);
 
         }
@@ -756,7 +769,7 @@
         Vector3 charPos = mCharacter-&gt;getActor()-&gt;getWorldPosition();
         Quaternion charOri = mCharacter-&gt;getActor()-&gt;getWorldOrientation();
         Quaternion virtualCamOri;
-        virtualCamOri.FromAngleAxis(mCamVirtualYaw, Vector3::UNIT_Y);
+        virtualCamOri.FromAngleAxis(mCamVirtualYaw+mCamRearViewYaw, Vector3::UNIT_Y);
 
 
         Vector3 camPos;
@@ -985,7 +998,7 @@
         //Quaternion charOri = mCharacter-&gt;getActor()-&gt;getWorldOrientation();
         Quaternion charOri (mController-&gt;getYaw(), Vector3::UNIT_Y);
         Quaternion virtualCamOri;
-        virtualCamOri.FromAngleAxis(mCamVirtualYaw, Vector3::UNIT_Y);
+        virtualCamOri.FromAngleAxis(mCamVirtualYaw+mCamRearViewYaw, Vector3::UNIT_Y);
         // get camera size
         CameraObject* ogreCam = static_cast&lt;CameraObject*&gt;(
                 mCameraActor-&gt;getControlledObject());
@@ -1311,6 +1324,7 @@
         mCamBody-&gt;setPositionOrientation(calculateOptimalCameraPosition(false, 0.0f), camOri);
         mCamVirtualYaw = Degree(0);
         mNewCamVirtualYaw = Degree(0);
+        mCamRearViewYaw = Degree(0);
         mLastCameraCollision = 0;
         if(mViewMode == VM_FIRST_PERSON)
             mCharacterActor-&gt;setVisible(false);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001995.html">[Dsa-hl-svn] r4939 - rl/trunk/engine/core
</A></li>
	<LI>Next message: <A HREF="001997.html">[Dsa-hl-svn] r4941 - in rl/trunk: Mac/Rastullah.xcodeproj	engine/core/include engine/core/src engine/ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1996">[ date ]</a>
              <a href="thread.html#1996">[ thread ]</a>
              <a href="subject.html#1996">[ subject ]</a>
              <a href="author.html#1996">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
