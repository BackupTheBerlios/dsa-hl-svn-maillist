<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4734 - in dependencies/OgreNewt_ngt: . inc src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2009-February/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4734%20-%20in%20dependencies/OgreNewt_ngt%3A%20.%20inc%20src&In-Reply-To=%3C200902041657.n14GvGhY027406%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001790.html">
   <LINK REL="Next"  HREF="001792.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4734 - in dependencies/OgreNewt_ngt: . inc src</H1>
    <B>melven at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4734%20-%20in%20dependencies/OgreNewt_ngt%3A%20.%20inc%20src&In-Reply-To=%3C200902041657.n14GvGhY027406%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4734 - in dependencies/OgreNewt_ngt: . inc src">melven at mail.berlios.de
       </A><BR>
    <I>Wed Feb  4 17:57:16 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001790.html">[Dsa-hl-svn] r4733 - in rl/branches/persistence: common/include	common/src core/include core/src
</A></li>
        <LI>Next message: <A HREF="001792.html">[Dsa-hl-svn] r4735 - dependencies/OgreNewt_ngt/inc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1791">[ date ]</a>
              <a href="thread.html#1791">[ thread ]</a>
              <a href="subject.html#1791">[ subject ]</a>
              <a href="author.html#1791">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: melven
Date: 2009-02-04 17:57:13 +0100 (Wed, 04 Feb 2009)
New Revision: 4734

Added:
   dependencies/OgreNewt_ngt/INSTALL.TXT
Removed:
   dependencies/OgreNewt_ngt/OgreNewt_Main_vc9.vcproj
   dependencies/OgreNewt_ngt/OgreNewt_vc9.sln
Modified:
   dependencies/OgreNewt_ngt/inc/OgreNewt_Body.h
   dependencies/OgreNewt_ngt/inc/OgreNewt_CollisionPrimitives.h
   dependencies/OgreNewt_ngt/inc/OgreNewt_RayCast.h
   dependencies/OgreNewt_ngt/src/OgreNewt_Collision.cpp
   dependencies/OgreNewt_ngt/src/OgreNewt_CollisionPrimitives.cpp
   dependencies/OgreNewt_ngt/src/OgreNewt_CollisionSerializer.cpp
   dependencies/OgreNewt_ngt/src/OgreNewt_RayCast.cpp
Log:
-removed some bugs
-added the possibility to get each intersection of a raycast with a treecollision
 (you can hit the same collision several times!)
-removed VC project files, you need to create them with cmake
-added a simple &quot;INSTALL.TXT&quot; file


Added: dependencies/OgreNewt_ngt/INSTALL.TXT
===================================================================
--- dependencies/OgreNewt_ngt/INSTALL.TXT	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/INSTALL.TXT	2009-02-04 16:57:13 UTC (rev 4734)
@@ -0,0 +1,21 @@
+To compile and install this library you need cmake &gt; 2.6.2 (<A HREF="http://www.cmake.org/">http://www.cmake.org/</A>)
+
+On Windows:
+    install cmake and then use cmake to create project files for Visual Studio
+
+On *nix:
+    if you have installed cmake, you can do:
+    
+    mkdir build
+    cd build
+    cmake ..
+    make
+    
+    To install the library type (as root)
+
+    make install
+
+    or
+
+    sudo make install
+

Deleted: dependencies/OgreNewt_ngt/OgreNewt_Main_vc9.vcproj
===================================================================
--- dependencies/OgreNewt_ngt/OgreNewt_Main_vc9.vcproj	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/OgreNewt_Main_vc9.vcproj	2009-02-04 16:57:13 UTC (rev 4734)
@@ -1,336 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;Windows-1252&quot;?&gt;
-&lt;VisualStudioProject
-	ProjectType=&quot;Visual C++&quot;
-	Version=&quot;9,00&quot;
-	Name=&quot;OgreNewt_Main&quot;
-	ProjectGUID=&quot;{DCC3C838-9803-497D-8C32-A5985644CCE9}&quot;
-	RootNamespace=&quot;OgreNewt_Main&quot;
-	Keyword=&quot;Win32Proj&quot;
-	TargetFrameworkVersion=&quot;131072&quot;
-	&gt;
-	&lt;Platforms&gt;
-		&lt;Platform
-			Name=&quot;Win32&quot;
-		/&gt;
-	&lt;/Platforms&gt;
-	&lt;ToolFiles&gt;
-	&lt;/ToolFiles&gt;
-	&lt;Configurations&gt;
-		&lt;Configuration
-			Name=&quot;Debug|Win32&quot;
-			OutputDirectory=&quot;./lib/$(ConfigurationName)&quot;
-			IntermediateDirectory=&quot;./obj/$(ConfigurationName)&quot;
-			ConfigurationType=&quot;2&quot;
-			InheritedPropertySheets=&quot;$(VCInstallDir)VCProjectDefaults\UpgradeFromVC71.vsprops&quot;
-			UseOfMFC=&quot;0&quot;
-			UseOfATL=&quot;0&quot;
-			CharacterSet=&quot;2&quot;
-			&gt;
-			&lt;Tool
-				Name=&quot;VCPreBuildEventTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCCustomBuildTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCXMLDataGeneratorTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCWebServiceProxyGeneratorTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCMIDLTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCCLCompilerTool&quot;
-				Optimization=&quot;0&quot;
-				AdditionalIncludeDirectories=&quot;.\inc;..\NewtonSDK\sdk;..\OgreSDK\include;..\boost\include&quot;
-				PreprocessorDefinitions=&quot;_WINDOWS;WIN32;_DEBUG;_OGRENEWT_EXPORTS;_OGRENEWT_DYNAMIC&quot;
-				MinimalRebuild=&quot;true&quot;
-				BasicRuntimeChecks=&quot;3&quot;
-				RuntimeLibrary=&quot;3&quot;
-				UsePrecompiledHeader=&quot;0&quot;
-				WarningLevel=&quot;3&quot;
-				Detect64BitPortabilityProblems=&quot;true&quot;
-				DebugInformationFormat=&quot;4&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCManagedResourceCompilerTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCResourceCompilerTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCPreLinkEventTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCLinkerTool&quot;
-				AdditionalDependencies=&quot;Newton.lib OgreMain_d.lib&quot;
-				OutputFile=&quot;$(OutDir)/OgreNewt_d.dll&quot;
-				AdditionalLibraryDirectories=&quot;..\NewtonSDK\sdk\dll_vs9;..\ogresdk\lib&quot;
-				GenerateDebugInformation=&quot;true&quot;
-				ProgramDatabaseFile=&quot;$(OutDir)/OgreNewt_d.pdb&quot;
-				SubSystem=&quot;2&quot;
-				RandomizedBaseAddress=&quot;1&quot;
-				DataExecutionPrevention=&quot;0&quot;
-				ImportLibrary=&quot;$(OutDir)/OgreNewt_d.lib&quot;
-				TargetMachine=&quot;1&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCALinkTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCManifestTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCXDCMakeTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCBscMakeTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCFxCopTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCAppVerifierTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCPostBuildEventTool&quot;
-			/&gt;
-		&lt;/Configuration&gt;
-		&lt;Configuration
-			Name=&quot;Release|Win32&quot;
-			OutputDirectory=&quot;./lib/$(ConfigurationName)&quot;
-			IntermediateDirectory=&quot;./obj/$(ConfigurationName)&quot;
-			ConfigurationType=&quot;2&quot;
-			InheritedPropertySheets=&quot;$(VCInstallDir)VCProjectDefaults\UpgradeFromVC71.vsprops&quot;
-			CharacterSet=&quot;2&quot;
-			&gt;
-			&lt;Tool
-				Name=&quot;VCPreBuildEventTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCCustomBuildTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCXMLDataGeneratorTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCWebServiceProxyGeneratorTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCMIDLTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCCLCompilerTool&quot;
-				AdditionalIncludeDirectories=&quot;.\inc;..\NewtonSDK\sdk;..\OgreSDK\include;..\boost\include&quot;
-				PreprocessorDefinitions=&quot;_WINDOWS;WIN32;NDEBUG;_OGRENEWT_EXPORTS;_OGRENEWT_DYNAMIC&quot;
-				BasicRuntimeChecks=&quot;0&quot;
-				RuntimeLibrary=&quot;2&quot;
-				UsePrecompiledHeader=&quot;0&quot;
-				WarningLevel=&quot;3&quot;
-				Detect64BitPortabilityProblems=&quot;true&quot;
-				DebugInformationFormat=&quot;3&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCManagedResourceCompilerTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCResourceCompilerTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCPreLinkEventTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCLinkerTool&quot;
-				AdditionalDependencies=&quot;Newton.lib OgreMain.lib&quot;
-				OutputFile=&quot;$(OutDir)/OgreNewt.dll&quot;
-				AdditionalLibraryDirectories=&quot;..\NewtonSDK\sdk\dll_vs9;..\ogresdk\lib&quot;
-				RandomizedBaseAddress=&quot;1&quot;
-				DataExecutionPrevention=&quot;0&quot;
-				ImportLibrary=&quot;$(OutDir)/OgreNewt.lib&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCALinkTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCManifestTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCXDCMakeTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCBscMakeTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCFxCopTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCAppVerifierTool&quot;
-			/&gt;
-			&lt;Tool
-				Name=&quot;VCPostBuildEventTool&quot;
-			/&gt;
-		&lt;/Configuration&gt;
-	&lt;/Configurations&gt;
-	&lt;References&gt;
-	&lt;/References&gt;
-	&lt;Files&gt;
-		&lt;Filter
-			Name=&quot;src&quot;
-			Filter=&quot;cpp;c;cxx;def;odl;idl;hpj;bat;asm;asmx&quot;
-			UniqueIdentifier=&quot;{4FC737F1-C7A5-4376-A066-2A32D752A2FF}&quot;
-			&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_BasicJoints.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_Body.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_Collision.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_CollisionPrimitives.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_CollisionSerializer.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_ContactCallback.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_Debugger.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_Joint.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_MaterialID.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_MaterialPair.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_RayCast.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_Tools.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_Vehicle.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\src\OgreNewt_World.cpp&quot;
-				&gt;
-			&lt;/File&gt;
-		&lt;/Filter&gt;
-		&lt;Filter
-			Name=&quot;header&quot;
-			Filter=&quot;h;hpp;hxx;hm;inl;inc;xsd&quot;
-			UniqueIdentifier=&quot;{93995380-89BD-4b04-88EB-625FBE52EBFB}&quot;
-			&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_BasicJoints.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_Body.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_BodyIterator.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_Collision.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_CollisionPrimitives.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_CollisionSerializer.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_ContactCallback.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_Debugger.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_Joint.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_MaterialID.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_MaterialPair.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_Prerequisites.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_RayCast.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_Tools.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_Vehicle.h&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\inc\OgreNewt_World.h&quot;
-				&gt;
-			&lt;/File&gt;
-		&lt;/Filter&gt;
-		&lt;Filter
-			Name=&quot;Resource Files&quot;
-			Filter=&quot;rc;ico;cur;bmp;dlg;rc2;rct;bin;rgs;gif;jpg;jpeg;jpe;resx&quot;
-			UniqueIdentifier=&quot;{67DA6AB6-F800-4c08-8B7A-83BB121AAD01}&quot;
-			&gt;
-		&lt;/Filter&gt;
-		&lt;Filter
-			Name=&quot;doc&quot;
-			&gt;
-			&lt;File
-				RelativePath=&quot;.\DifferencesToOgreCVS.txt&quot;
-				&gt;
-			&lt;/File&gt;
-			&lt;File
-				RelativePath=&quot;.\README&quot;
-				&gt;
-			&lt;/File&gt;
-		&lt;/Filter&gt;
-	&lt;/Files&gt;
-	&lt;Globals&gt;
-	&lt;/Globals&gt;
-&lt;/VisualStudioProject&gt;

Deleted: dependencies/OgreNewt_ngt/OgreNewt_vc9.sln
===================================================================
--- dependencies/OgreNewt_ngt/OgreNewt_vc9.sln	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/OgreNewt_vc9.sln	2009-02-04 16:57:13 UTC (rev 4734)
@@ -1,19 +0,0 @@
-Microsoft Visual Studio Solution File, Format Version 10.00
-# Visual C++ Express 2008
-Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;OgreNewt_Main&quot;, &quot;OgreNewt_Main_vc9.vcproj&quot;, &quot;{DCC3C838-9803-497D-8C32-A5985644CCE9}&quot;
-EndProject
-Global
-	GlobalSection(SolutionConfigurationPlatforms) = preSolution
-		Debug|Win32 = Debug|Win32
-		Release|Win32 = Release|Win32
-	EndGlobalSection
-	GlobalSection(ProjectConfigurationPlatforms) = postSolution
-		{DCC3C838-9803-497D-8C32-A5985644CCE9}.Debug|Win32.ActiveCfg = Debug|Win32
-		{DCC3C838-9803-497D-8C32-A5985644CCE9}.Debug|Win32.Build.0 = Debug|Win32
-		{DCC3C838-9803-497D-8C32-A5985644CCE9}.Release|Win32.ActiveCfg = Release|Win32
-		{DCC3C838-9803-497D-8C32-A5985644CCE9}.Release|Win32.Build.0 = Release|Win32
-	EndGlobalSection
-	GlobalSection(SolutionProperties) = preSolution
-		HideSolutionNode = FALSE
-	EndGlobalSection
-EndGlobal

Modified: dependencies/OgreNewt_ngt/inc/OgreNewt_Body.h
===================================================================
--- dependencies/OgreNewt_ngt/inc/OgreNewt_Body.h	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/inc/OgreNewt_Body.h	2009-02-04 16:57:13 UTC (rev 4734)
@@ -18,6 +18,7 @@
 
 #include &quot;OgreNewt_Prerequisites.h&quot;
 #include &quot;OgreNewt_MaterialID.h&quot;
+#include &quot;OgreNewt_Collision.h&quot;
 #include &lt;boost/function.hpp&gt;
 #include &lt;boost/bind.hpp&gt;
 
@@ -28,7 +29,6 @@
 
 class World;
 class MaterialID;
-class Collision;
 
 /*
 	CLASS DEFINITION:
@@ -393,10 +393,20 @@
 	*/
 	void addLocalForce( const Ogre::Vector3&amp; force, const Ogre::Vector3&amp; pos );
 
-	
+    //! Returns the Collisiontype for the Collision from this Body
+    /*!
+     * usually it is also possible to get this via: body-&gt;getCollision()-&gt;getCollisionPrimitiveType()
+    */
+    CollisionPrimitive getCollisionPrimitiveType() const { return Collision::getCollisionPrimitiveType(getNewtonCollision()); }
 
- protected:
+    //! Returns the Newton Collision for this Body
+    /*!
+     * usually it is also possible to get this via: body-&gt;getCollision()
+    */
+    NewtonCollision *getNewtonCollision() const { return NewtonBodyGetCollision( m_body ); }
 
+protected:
+
 	NewtonBody*			m_body;
 	const Collision*	m_collision;
 	const MaterialID*	m_matid;

Modified: dependencies/OgreNewt_ngt/inc/OgreNewt_CollisionPrimitives.h
===================================================================
--- dependencies/OgreNewt_ngt/inc/OgreNewt_CollisionPrimitives.h	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/inc/OgreNewt_CollisionPrimitives.h	2009-02-04 16:57:13 UTC (rev 4734)
@@ -308,10 +308,6 @@
 
 			//! set RayCastCallback active/disabled
 			/*!
-                THIS IS NOT WORKING AT THE MOMENT:
-                the code is based on an assumption about the order newton processes bodies in a raycast, I want to check this first,
-                so I commented the necessary code out.
-				If this Callback is active and a Ray hit this TreeCollision, the data of the hits will be given to the OgreNewt::RayCast function usercallback
 				\param active true = Callback active; false = Callback disabled 
 			*/
 			void setRayCastCallbackactive(bool active = true)
@@ -319,11 +315,12 @@
 				setRayCastCallbackactive( active, m_col );
 			}
 
+            //! used internally
+			static float _CDECL newtonRayCastCallback(float distance, float* normal, int faceId, void* userData);
+
         private:
 			static void setRayCastCallbackactive( bool active , const NewtonCollision *col );
 
-			static float _CDECL newtonRayCastCallback(float distance, float* normal, int faceId, void* userData);
-
         };
 
 		////////////////////////////////////////////////////////

Modified: dependencies/OgreNewt_ngt/inc/OgreNewt_RayCast.h
===================================================================
--- dependencies/OgreNewt_ngt/inc/OgreNewt_RayCast.h	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/inc/OgreNewt_RayCast.h	2009-02-04 16:57:13 UTC (rev 4734)
@@ -14,6 +14,7 @@
 
 
 #include &quot;OgreNewt_Prerequisites.h&quot;
+#include &quot;OgreNewt_CollisionPrimitives.h&quot;
 
 // OgreNewt namespace.  all functions and classes use this namespace.
 namespace OgreNewt
@@ -21,7 +22,6 @@
 
 class World;
 class Body;
-class Collision;
 
 //! general raycast
 /*!
@@ -62,15 +62,15 @@
 		return false and the callback will call for any other bodies, even those farther than the current one.
 	*/
 	virtual bool userCallback( OgreNewt::Body* body, Ogre::Real distance, const Ogre::Vector3&amp; normal, int collisionID ) = 0;
-/*
+
 	friend float CollisionPrimitives::TreeCollision::newtonRayCastCallback(float distance, float *normal, int faceId, void *userData);
 protected:
 	//! save the last OgreNewt::Body from the newtonRaycastPreFilter to use this for example the TreeCollisionRayCallback
-	OgreNewt::Body *m_treecollisionhack_lastbody;
+	OgreNewt::Body *m_treecollisioncallback_lastbody;
 
 	//! save if this body was already added by RayCastCallback from TreeCollision
-	bool m_treecollisionhack_bodyalreadyadded;
-*/
+	bool m_treecollisioncallback_bodyalreadyadded;
+
 private:
 
 	//! callback used for running the raycast itself... used internally

Modified: dependencies/OgreNewt_ngt/src/OgreNewt_Collision.cpp
===================================================================
--- dependencies/OgreNewt_ngt/src/OgreNewt_Collision.cpp	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/src/OgreNewt_Collision.cpp	2009-02-04 16:57:13 UTC (rev 4734)
@@ -58,7 +58,6 @@
 ConvexModifierCollision::ConvexModifierCollision(const World* world, const Collision* col) : Collision(world)
 {
 	m_col = NewtonCreateConvexHullModifier( world-&gt;getNewtonWorld(), col-&gt;getNewtonCollision() );
-    NewtonAddCollisionReference(m_col);
 }
 
 ConvexModifierCollision::~ConvexModifierCollision()

Modified: dependencies/OgreNewt_ngt/src/OgreNewt_CollisionPrimitives.cpp
===================================================================
--- dependencies/OgreNewt_ngt/src/OgreNewt_CollisionPrimitives.cpp	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/src/OgreNewt_CollisionPrimitives.cpp	2009-02-04 16:57:13 UTC (rev 4734)
@@ -1,5 +1,6 @@
 #include &quot;OgreNewt_CollisionPrimitives.h&quot;
 #include &quot;OgreNewt_Tools.h&quot;
+#include &quot;OgreNewt_RayCast.h&quot;
 
 #include &quot;Ogre.h&quot;
 
@@ -13,8 +14,6 @@
 		Null::Null(const OgreNewt::World *world) : Collision( world )
 		{
 			m_col = NewtonCreateNull( m_world-&gt;getNewtonWorld() );
-
-            NewtonAddCollisionReference(m_col);
 		}
 
 
@@ -29,8 +28,6 @@
 			OgreNewt::Converters::QuatPosToMatrix( orient, pos, &amp;matrix[0] );
 
 			m_col = NewtonCreateBox( m_world-&gt;getNewtonWorld(), (float)size.x, (float)size.y, (float)size.z, &amp;matrix[0] );
-
-            NewtonAddCollisionReference(m_col);
 		}
 
 
@@ -46,8 +43,6 @@
 			OgreNewt::Converters::QuatPosToMatrix( orient, pos, &amp;matrix[0] );
 
 			m_col = NewtonCreateSphere( m_world-&gt;getNewtonWorld(), (float)size.x, (float)size.y, (float)size.z, &amp;matrix[0] );
-
-            NewtonAddCollisionReference(m_col);
 		}
 
 
@@ -63,8 +58,6 @@
 			OgreNewt::Converters::QuatPosToMatrix( orient, pos, &amp;matrix[0] );
 
 			m_col = NewtonCreateCylinder( m_world-&gt;getNewtonWorld(), (float)radius, (float)height, &amp;matrix[0] );
-
-            NewtonAddCollisionReference(m_col);
 		}
 
 
@@ -80,8 +73,6 @@
 			OgreNewt::Converters::QuatPosToMatrix( orient, pos, &amp;matrix[0] );
 
 			m_col = NewtonCreateCapsule( m_world-&gt;getNewtonWorld(), (float)radius, (float)height, &amp;matrix[0] );
-
-            NewtonAddCollisionReference(m_col);
 		}
 
 
@@ -97,8 +88,6 @@
 			OgreNewt::Converters::QuatPosToMatrix( orient, pos, &amp;matrix[0] );
 
 			m_col = NewtonCreateCone( m_world-&gt;getNewtonWorld(), (float)radius, (float)height, &amp;matrix[0] );
-
-            NewtonAddCollisionReference(m_col);
 		}
 
 		// OgreNewt::CollisionPrimitives::ChamferCylinder
@@ -113,8 +102,6 @@
 			OgreNewt::Converters::QuatPosToMatrix( orient, pos, &amp;matrix[0] );
 
 			m_col = NewtonCreateChamferCylinder( m_world-&gt;getNewtonWorld(), (float)radius, (float)height, &amp;matrix[0] );
-
-            NewtonAddCollisionReference(m_col);
 		}
 
 
@@ -239,8 +226,6 @@
 			//okay, let's try making the ConvexHull!
 			m_col = NewtonCreateConvexHull( m_world-&gt;getNewtonWorld(), (int)total_verts, (float*)&amp;vertices[0].x, sizeof(Ogre::Vector3), 0.001f, &amp;matrix[0] );
 
-            NewtonAddCollisionReference(m_col);
-
 			delete []vertices;
 
 		}
@@ -254,9 +239,6 @@
 
 			//make the collision primitive.
 			m_col = NewtonCreateConvexHull( m_world-&gt;getNewtonWorld(), vertcount, (float*)&amp;verts[0].x, sizeof(Ogre::Vector3), 0.001f, &amp;matrix[0]);
-
-            NewtonAddCollisionReference(m_col);
-
 		}
 
 
@@ -520,29 +502,22 @@
 		void TreeCollision::finish( bool optimize )
 		{
 			NewtonTreeCollisionEndBuild( m_col, optimize );
-
-            NewtonAddCollisionReference(m_col);
         }
 
 
         float _CDECL TreeCollision::newtonRayCastCallback(float interception, float *normal, int faceId, void *userData)
         {
-            return interception;
-
-            // the following code is only based on the assumption about the order newton processes bodies in a raycast!
-            /*
-			Body* bod = ((Raycast*)userData)-&gt;m_lastbody;
+			Body* bod = ((Raycast*)userData)-&gt;m_treecollisioncallback_lastbody;
 			
             //! TODO: what do we need to return here?
 			if(!bod)
 				return 0;
 
-			((Raycast*)userData)-&gt;userCallback( bod, distance, Ogre::Vector3(normal[0], normal[1], normal[2]), faceId );
+			((Raycast*)userData)-&gt;userCallback( bod, interception, Ogre::Vector3(normal[0], normal[1], normal[2]), faceId );
 
-			((Raycast*)userData)-&gt;bodyalreadyadded = true;
+			((Raycast*)userData)-&gt;m_treecollisioncallback_bodyalreadyadded = true;
 
-			return distance;
-            */
+			return interception;
         }
 
 		void TreeCollision::setRayCastCallbackactive(bool active, const NewtonCollision *col )
@@ -749,10 +724,8 @@
 
 			m_col = NewtonCreateCompoundCollision( world-&gt;getNewtonWorld(), num, array );
 
-            NewtonAddCollisionReference(m_col);
 
 			delete[] array;
-
 		}
 
 		
@@ -791,10 +764,8 @@
 			//make the collision primitive.
 			m_col = NewtonCreateConvexHull( m_world-&gt;getNewtonWorld(), 5, vertices, sizeof(float)*3, 0.001f, &amp;matrix[0]);
 
-            NewtonAddCollisionReference(m_col);
 
 			delete []vertices;
-
 		}
 
 

Modified: dependencies/OgreNewt_ngt/src/OgreNewt_CollisionSerializer.cpp
===================================================================
--- dependencies/OgreNewt_ngt/src/OgreNewt_CollisionSerializer.cpp	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/src/OgreNewt_CollisionSerializer.cpp	2009-02-04 16:57:13 UTC (rev 4734)
@@ -46,9 +46,6 @@
         NewtonCollision* col = NewtonCreateCollisionFromSerialization(pDest-&gt;getWorld()-&gt;getNewtonWorld(), &amp;CollisionSerializer::_newtonDeserializeCallback, &amp;stream);
 
         pDest-&gt;m_col = col;
-        // this is a bit nasty, but we need to add a reference for the collision, there should be no problems,
-        // if the OgreNewt-functions are used and the newton-collisions are not accessed directly in any way
-        NewtonAddCollisionReference(pDest-&gt;m_col);
     }
   }
 

Modified: dependencies/OgreNewt_ngt/src/OgreNewt_RayCast.cpp
===================================================================
--- dependencies/OgreNewt_ngt/src/OgreNewt_RayCast.cpp	2009-02-03 21:50:57 UTC (rev 4733)
+++ dependencies/OgreNewt_ngt/src/OgreNewt_RayCast.cpp	2009-02-04 16:57:13 UTC (rev 4734)
@@ -19,8 +19,14 @@
         {
             Debugger::getSingleton().addRay(startpt, endpt);
         }
+
+        m_treecollisioncallback_lastbody = NULL;
+
 		// perform the raycast!
 		NewtonWorldRayCast( world-&gt;getNewtonWorld(), (float*)&amp;startpt, (float*)&amp;endpt, OgreNewt::Raycast::newtonRaycastFilter, this, OgreNewt::Raycast::newtonRaycastPreFilter );
+
+        m_treecollisioncallback_lastbody = NULL;
+
 	}
 
 	float _CDECL Raycast::newtonRaycastFilter(const NewtonBody* body, const float* hitNormal, int collisionID, void* userData, float intersectParam)
@@ -32,6 +38,10 @@
 		Ogre::Vector3 normal = Ogre::Vector3( hitNormal[0], hitNormal[1], hitNormal[2] );
 
 
+        if( me-&gt;m_treecollisioncallback_bodyalreadyadded )
+            return intersectParam;
+
+
         if( Debugger::getSingleton().isRaycastRecording() &amp;&amp; Debugger::getSingleton().isRaycastRecordingHitBodies() )
         {
             Debugger::getSingleton().addHitBody(bod);
@@ -52,6 +62,10 @@
 
 		Body* bod = (Body*)NewtonBodyGetUserData( body );
 
+
+        me-&gt;m_treecollisioncallback_bodyalreadyadded = false;
+        me-&gt;m_treecollisioncallback_lastbody = bod;
+
 		if (me-&gt;userPreFilterCallback( bod ))
 			return 1;
 		else


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001790.html">[Dsa-hl-svn] r4733 - in rl/branches/persistence: common/include	common/src core/include core/src
</A></li>
	<LI>Next message: <A HREF="001792.html">[Dsa-hl-svn] r4735 - dependencies/OgreNewt_ngt/inc
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1791">[ date ]</a>
              <a href="thread.html#1791">[ thread ]</a>
              <a href="subject.html#1791">[ subject ]</a>
              <a href="author.html#1791">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
