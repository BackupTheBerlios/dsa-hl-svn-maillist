From timm at mail.berlios.de  Fri Feb  1 23:56:50 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Fri, 1 Feb 2008 23:56:50 +0100
Subject: [Dsa-hl-svn] r4050 - rl/trunk/engine/rules/src
Message-ID: <200802012256.m11Muogo017733@sheep.berlios.de>

Author: timm
Date: 2008-02-01 23:56:48 +0100 (Fri, 01 Feb 2008)
New Revision: 4050

Modified:
   rl/trunk/engine/rules/src/GameObjectManager.cpp
   rl/trunk/engine/rules/src/Inventory.cpp
Log:
wrong substring converted to uint

Modified: rl/trunk/engine/rules/src/GameObjectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObjectManager.cpp	2008-01-30 22:20:39 UTC (rev 4049)
+++ rl/trunk/engine/rules/src/GameObjectManager.cpp	2008-02-01 22:56:48 UTC (rev 4050)
@@ -118,6 +118,7 @@
     GameObject* GameObjectManager::createGameObject(
         const Ogre::String& classId, unsigned int id)
     {
+		LOG_MESSAGE("GameObjectManager", "Create/Get GameObject " + Ogre::StringConverter::toString((int)id));
         unsigned int goId;
 
         if (id != GameObject::NO_OBJECT_ID)
@@ -199,7 +200,7 @@
 		if (posDivider != CeGuiString::npos)
 		{
 			Ogre::String classId(serializedString.substr(0, posDivider).c_str());
-			unsigned int goid = CEGUI::PropertyHelper::stringToUint(serializedString.substr(posDivider));
+			unsigned int goid = CEGUI::PropertyHelper::stringToUint(serializedString.substr(posDivider+1));
 			return createGameObject(classId, goid);
 		}
 

Modified: rl/trunk/engine/rules/src/Inventory.cpp
===================================================================
--- rl/trunk/engine/rules/src/Inventory.cpp	2008-01-30 22:20:39 UTC (rev 4049)
+++ rl/trunk/engine/rules/src/Inventory.cpp	2008-02-01 22:56:48 UTC (rev 4050)
@@ -345,6 +345,7 @@
 						(*it).second));
 				if (item)
 				{
+					LOG_MESSAGE("Inventory", "Add item " + it->second.toString() + " to slot "+ (*it).first);
 					hold(item, (*it).first);
 				}
 			}



From blakharaz at mail.berlios.de  Sat Feb  2 12:45:17 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sat, 2 Feb 2008 12:45:17 +0100
Subject: [Dsa-hl-svn] r4051 - in tools/meshhandle: . src/meshhandle
Message-ID: <200802021145.m12BjHsH003732@sheep.berlios.de>

Author: blakharaz
Date: 2008-02-02 12:45:01 +0100 (Sat, 02 Feb 2008)
New Revision: 4051

Modified:
   tools/meshhandle/build.xml
   tools/meshhandle/src/meshhandle/SceneConverter.java
Log:
Ant task for scene converter

Modified: tools/meshhandle/build.xml
===================================================================
--- tools/meshhandle/build.xml	2008-02-01 22:56:48 UTC (rev 4050)
+++ tools/meshhandle/build.xml	2008-02-02 11:45:01 UTC (rev 4051)
@@ -12,7 +12,7 @@
 	<path id="compile.classpath">
 	</path>
 	
-	<target name="all" depends="clean,compile,deploy" 
+	<target name="all" depends="clean,compile,deploy-dataeditor,deploy-sceneconverter" 
 		description="Clean build and dist directories, then compiles and deploys" />
 
 	<target name="clean" description="Delete old build and dist directories">
@@ -37,7 +37,7 @@
 		</copy>
 	</target>	
 	
-	<target name="deploy" description="Creates deployable version">
+	<target name="deploy-dataeditor" description="Creates Dataeditor deployable version">
 		<mkdir dir="${deploy.home}/"/>
 		<manifest file="${deploy.home}/MANIFEST.MF">
 			<attribute name="Built-By" value="${user.name}"/>
@@ -45,13 +45,30 @@
 		</manifest>
 		<jar 
 			basedir="${build.home}" 
-			destfile="${deploy.home}/meshhandle.jar" 
+			destfile="${deploy.home}/rastullahdataeditor.jar" 
 			manifest="${deploy.home}/MANIFEST.MF" />		
 
-		<echo>Loading JSmooth Ant tasks. Make sure you have installed http://jsmooth.sourceforge.net</echo>
+<!--		<echo>Loading JSmooth Ant tasks. Make sure you have installed http://jsmooth.sourceforge.net</echo>
 		<taskdef name="jsmoothgen" classname="net.charabia.jsmoothgen.ant.JSmoothGen" 
 			classpath="${jsmooth.home}/lib/jsmoothgen-ant.jar"  />
-		<jsmoothgen project="${basedir}/meshhandle.jsmooth" skeletonroot="${jsmooth.home}/skeletons/" />
+		<jsmoothgen project="${basedir}/meshhandle.jsmooth" skeletonroot="${jsmooth.home}/skeletons/" />-->
 	</target>
+
+	<target name="deploy-sceneconverter" description="Creates Scene converter deployable version">
+		<mkdir dir="${deploy.home}/"/>
+		<manifest file="${deploy.home}/MANIFEST-CONVERTER.MF">
+			<attribute name="Built-By" value="${user.name}"/>
+			<attribute name="Main-Class" value="meshhandle.SceneConverter"/>
+		</manifest>
+		<jar 
+			basedir="${build.home}" 
+			destfile="${deploy.home}/sceneconverter.jar" 
+			manifest="${deploy.home}/MANIFEST-CONVERTER.MF" />		
+
+<!--		<echo>Loading JSmooth Ant tasks. Make sure you have installed http://jsmooth.sourceforge.net</echo>
+		<taskdef name="jsmoothgen" classname="net.charabia.jsmoothgen.ant.JSmoothGen" 
+			classpath="${jsmooth.home}/lib/jsmoothgen-ant.jar"  />
+		<jsmoothgen project="${basedir}/meshhandle.jsmooth" skeletonroot="${jsmooth.home}/skeletons/" />-->
+	</target>
 	
 </project>
\ No newline at end of file

Modified: tools/meshhandle/src/meshhandle/SceneConverter.java
===================================================================
--- tools/meshhandle/src/meshhandle/SceneConverter.java	2008-02-01 22:56:48 UTC (rev 4050)
+++ tools/meshhandle/src/meshhandle/SceneConverter.java	2008-02-02 11:45:01 UTC (rev 4051)
@@ -3,14 +3,16 @@
 import java.io.File;
 import java.io.FileWriter;
 import java.io.IOException;
+
 import javax.xml.parsers.ParserConfigurationException;
-import org.xml.sax.SAXException;
+
 import meshhandle.io.xml.scene.AbstractSceneWriter;
 import meshhandle.io.xml.scene.ISceneLoader;
-import meshhandle.io.xml.scene.SceneFormat2Loader;
 import meshhandle.io.xml.scene.SceneFormat3Loader;
 import meshhandle.model.scene.Scene;
 
+import org.xml.sax.SAXException;
+
 public class SceneConverter
 {
 	/**



From timm at mail.berlios.de  Sun Feb  3 13:44:01 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Sun, 3 Feb 2008 13:44:01 +0100
Subject: [Dsa-hl-svn] r4052 - in rl/trunk/engine/ui: include src
Message-ID: <200802031244.m13Ci1Tp017069@sheep.berlios.de>

Author: timm
Date: 2008-02-03 13:43:58 +0100 (Sun, 03 Feb 2008)
New Revision: 4052

Modified:
   rl/trunk/engine/ui/include/WindowFactory.h
   rl/trunk/engine/ui/src/GameSaveLoadWindow.cpp
   rl/trunk/engine/ui/src/WindowFactory.cpp
Log:
close inventory window when loading to avoid crash

Modified: rl/trunk/engine/ui/include/WindowFactory.h
===================================================================
--- rl/trunk/engine/ui/include/WindowFactory.h	2008-02-02 11:45:01 UTC (rev 4051)
+++ rl/trunk/engine/ui/include/WindowFactory.h	2008-02-03 12:43:58 UTC (rev 4052)
@@ -105,6 +105,7 @@
         void toggleInGameGlobalMenu();
         void toggleInventoryWindow();
         void notifyInventoryWindowDestroyed();
+		bool isInventoryWindowDestroyed();
 
         CombatWindow* getCombatWindow();
 

Modified: rl/trunk/engine/ui/src/GameSaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/GameSaveLoadWindow.cpp	2008-02-02 11:45:01 UTC (rev 4051)
+++ rl/trunk/engine/ui/src/GameSaveLoadWindow.cpp	2008-02-03 12:43:58 UTC (rev 4052)
@@ -112,6 +112,9 @@
     {
         LOG_MESSAGE(Logger::UI, "Load Button pressed");
 
+		if(!WindowFactory::getSingleton().isInventoryWindowDestroyed())
+			WindowFactory::getSingleton().toggleInventoryWindow();
+	
         CeGuiString filename = mFilename->getText();
 
         if(filename != "")

Modified: rl/trunk/engine/ui/src/WindowFactory.cpp
===================================================================
--- rl/trunk/engine/ui/src/WindowFactory.cpp	2008-02-02 11:45:01 UTC (rev 4051)
+++ rl/trunk/engine/ui/src/WindowFactory.cpp	2008-02-03 12:43:58 UTC (rev 4052)
@@ -235,7 +235,12 @@
         mInventoryWindow = NULL;
     }
 
+	bool WindowFactory::isInventoryWindowDestroyed()
+	{
+		return mInventoryWindow == NULL;
+	}
 
+
     void WindowFactory::showCharacterSheet()
     {
         if (mCharacterSheet->isVisible())



From blakharaz at mail.berlios.de  Sun Feb  3 15:29:19 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sun, 3 Feb 2008 15:29:19 +0100
Subject: [Dsa-hl-svn] r4053 - in rl/trunk/engine: ai/src common/include
	common/src rules/src script/swig ui/include ui/src
Message-ID: <200802031429.m13ETJGu028782@sheep.berlios.de>

Author: blakharaz
Date: 2008-02-03 15:29:05 +0100 (Sun, 03 Feb 2008)
New Revision: 4053

Modified:
   rl/trunk/engine/ai/src/AgentManager.cpp
   rl/trunk/engine/ai/src/DialogManager.cpp
   rl/trunk/engine/common/include/Property.h
   rl/trunk/engine/common/include/XmlPropertyWriter.h
   rl/trunk/engine/common/src/XmlPropertyWriter.cpp
   rl/trunk/engine/rules/src/Container.cpp
   rl/trunk/engine/rules/src/GameObject.cpp
   rl/trunk/engine/rules/src/Inventory.cpp
   rl/trunk/engine/rules/src/QuestBook.cpp
   rl/trunk/engine/script/swig/TypeRlProperty.swig
   rl/trunk/engine/ui/include/PropertiesWindow.h
   rl/trunk/engine/ui/src/PropertiesWindow.cpp
Log:
Renamed PropertyVector to PropertyArray (to be consistent with toArray())

Modified: rl/trunk/engine/ai/src/AgentManager.cpp
===================================================================
--- rl/trunk/engine/ai/src/AgentManager.cpp	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/ai/src/AgentManager.cpp	2008-02-03 14:29:05 UTC (rev 4053)
@@ -136,7 +136,7 @@
             Property behaviorsProperty = aiProps["behaviours"];
             if (behaviorsProperty.isArray())
             {
-                PropertyVector behaviours = behaviorsProperty.toArray();
+                PropertyArray behaviours = behaviorsProperty.toArray();
                 if (!behaviours.empty())
                 {
                     Agent* agent = createAgent(creature);
@@ -145,7 +145,7 @@
                     // Nevertheless see above comment for how to improve this situation.
                     AgentSteeringState* ass =
                         dynamic_cast<AgentSteeringState*>(agent->getCurrentState());
-                    for (PropertyVector::const_iterator it = behaviours.begin(),
+                    for (PropertyArray::const_iterator it = behaviours.begin(),
                         end = behaviours.end(); it != end; ++it)
                     {
                         if (it->isString())

Modified: rl/trunk/engine/ai/src/DialogManager.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogManager.cpp	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/ai/src/DialogManager.cpp	2008-02-03 14:29:05 UTC (rev 4053)
@@ -89,7 +89,7 @@
     {
         if (key == DialogManager::PROPERTY_DIALOGS)
         {
-            PropertyVector vec;
+            PropertyArray vec;
             for (std::map<DialogConfiguration, Dialog*>::const_iterator it
                 = mDialogStates.begin(); it != mDialogStates.end(); ++it)
             {
@@ -98,7 +98,7 @@
                 curDialogProp[DialogManager::PROPERTY_DIALOG] = dialogProps->toPropertyMap();
                 curDialogProp[DialogManager::PROPERTY_DIALOG_NAME] = Property(it->first.getName());
 
-                PropertyVector npcs;
+                PropertyArray npcs;
 
                 for (std::vector<Creature*>::const_iterator itNpc = it->first.getNpcs().begin();
                     itNpc != it->first.getNpcs().end(); ++itNpc)

Modified: rl/trunk/engine/common/include/Property.h
===================================================================
--- rl/trunk/engine/common/include/Property.h	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/common/include/Property.h	2008-02-03 14:29:05 UTC (rev 4053)
@@ -76,7 +76,7 @@
 
 	class Property;
 
-    typedef std::vector<Property> PropertyVector;
+    typedef std::vector<Property> PropertyArray;
     typedef std::map<CeGuiString, Property> PropertyMap;
     
     class _RlCommonExport Property
@@ -92,7 +92,7 @@
         PropertyMethod(Quaternion, const Ogre::Quaternion&);
         PropertyMethod(IntTriple, const Tripel<int>);
         PropertyMethod(IntPair, const IntPair);
-		PropertyMethod(Array, const PropertyVector);
+		PropertyMethod(Array, const PropertyArray);
 		PropertyMethod(Map, const PropertyMap);
 
         Ogre::String getTypeName() const;

Modified: rl/trunk/engine/common/include/XmlPropertyWriter.h
===================================================================
--- rl/trunk/engine/common/include/XmlPropertyWriter.h	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/common/include/XmlPropertyWriter.h	2008-02-03 14:29:05 UTC (rev 4053)
@@ -49,7 +49,7 @@
 
         XERCES_CPP_NAMESPACE::DOMElement* processProperty(XERCES_CPP_NAMESPACE::DOMElement* parent, PropertyEntry entry);
         XERCES_CPP_NAMESPACE::DOMElement* processPropertyRecord(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyRecord set);
-        XERCES_CPP_NAMESPACE::DOMElement* processPropertyArray(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyVector vector);
+        XERCES_CPP_NAMESPACE::DOMElement* processPropertyArray(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyArray vector);
         XERCES_CPP_NAMESPACE::DOMElement* processPropertyMap(XERCES_CPP_NAMESPACE::DOMElement* parent, const char* const name, PropertyMap map);
 
         void writeEachPropertyToElem(XERCES_CPP_NAMESPACE::DOMElement* parent, const PropertyMap &map);

Modified: rl/trunk/engine/common/src/XmlPropertyWriter.cpp
===================================================================
--- rl/trunk/engine/common/src/XmlPropertyWriter.cpp	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/common/src/XmlPropertyWriter.cpp	2008-02-03 14:29:05 UTC (rev 4053)
@@ -105,14 +105,14 @@
         return processPropertyMap(parent, name, map);
     }
 
-    DOMElement* XmlPropertyWriter::processPropertyArray(DOMElement *parent, const char *const name, PropertyVector vector)
+    DOMElement* XmlPropertyWriter::processPropertyArray(DOMElement *parent, const char *const name, PropertyArray vector)
     {
         DOMElement* element = appendChildElement(mDocument, parent, "property");
         if(name[0] != '\0')
             setAttribute(element, "name", name);
         setAttribute(element, "type", "ARRAY");
 
-        PropertyVector::iterator iter;
+        PropertyArray::iterator iter;
         for(iter = vector.begin(); iter != vector.end(); iter++)
         {
             processProperty(element, PropertyEntry(Ogre::String(),*iter));

Modified: rl/trunk/engine/rules/src/Container.cpp
===================================================================
--- rl/trunk/engine/rules/src/Container.cpp	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/rules/src/Container.cpp	2008-02-03 14:29:05 UTC (rev 4053)
@@ -337,8 +337,8 @@
 		else if (key == Container::PROPERTY_CONTENT)
         {
 			PropertyMap contentMap = value.toMap();
-			PropertyVector objects = contentMap[Container::PROPERTY_CONTENT_OBJECTS].toArray();
-			PropertyVector positions = contentMap[Container::PROPERTY_CONTENT_POSITIONS].toArray();
+			PropertyArray objects = contentMap[Container::PROPERTY_CONTENT_OBJECTS].toArray();
+			PropertyArray positions = contentMap[Container::PROPERTY_CONTENT_POSITIONS].toArray();
 
 			for (size_t idx = 0; idx < objects.size(); ++idx)
 			{
@@ -369,8 +369,8 @@
         }
 		else if (key == Container::PROPERTY_CONTENT)
         {
-			PropertyVector positions;
-			PropertyVector objects;
+			PropertyArray positions;
+			PropertyArray objects;
 
 			for (ItemSet::const_iterator it = mItems.begin(); it != mItems.end(); ++it)
 			{

Modified: rl/trunk/engine/rules/src/GameObject.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObject.cpp	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/rules/src/GameObject.cpp	2008-02-03 14:29:05 UTC (rev 4053)
@@ -538,8 +538,8 @@
             }
             else if (key == PROPERTY_ACTIONS)
             {
-                PropertyVector vecVal = value.toArray();
-                for (PropertyVector::const_iterator it = vecVal.begin(); it != vecVal.end(); it++)
+                PropertyArray vecVal = value.toArray();
+                for (PropertyArray::const_iterator it = vecVal.begin(); it != vecVal.end(); it++)
                 {
                     Ogre::String actionName = (*it).toString().c_str();
                     Action* act = ActionManager::getSingleton().getAction(actionName);

Modified: rl/trunk/engine/rules/src/Inventory.cpp
===================================================================
--- rl/trunk/engine/rules/src/Inventory.cpp	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/rules/src/Inventory.cpp	2008-02-03 14:29:05 UTC (rev 4053)
@@ -290,9 +290,9 @@
 	{
         if (key == Inventory::PROPERTY_SLOTS)
         {
-            PropertyVector slotVec = value.toArray();
+            PropertyArray slotVec = value.toArray();
 
-            for (PropertyVector::const_iterator it = slotVec.begin(); it != slotVec.end(); ++it)
+            for (PropertyArray::const_iterator it = slotVec.begin(); it != slotVec.end(); ++it)
             {
                 PropertyMap slotProps = it->toMap();
 

Modified: rl/trunk/engine/rules/src/QuestBook.cpp
===================================================================
--- rl/trunk/engine/rules/src/QuestBook.cpp	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/rules/src/QuestBook.cpp	2008-02-03 14:29:05 UTC (rev 4053)
@@ -165,7 +165,7 @@
     {
         if (key == PROPERTY_QUESTS)
         {
-            PropertyVector quests;
+            PropertyArray quests;
             QuestVector allQuests = getAllQuests();
             for (QuestVector::const_iterator it = allQuests.begin();
                 it != allQuests.end(); ++it)
@@ -179,7 +179,7 @@
         }
         else if (key == PROPERTY_JOURNAL)
         {
-            PropertyVector journals;
+            PropertyArray journals;
             for(std::vector<JournalEntry*>::const_iterator iter = mJournalEntries.begin(); iter != mJournalEntries.end(); iter++)
             {
                 PropertyRecord journal;
@@ -199,8 +199,8 @@
     {
         if (key == PROPERTY_QUESTS)
         {
-            PropertyVector quests = value.toArray();
-            for (PropertyVector::const_iterator it = quests.begin(); 
+            PropertyArray quests = value.toArray();
+            for (PropertyArray::const_iterator it = quests.begin(); 
                 it != quests.end(); ++it)
             {
                 PropertyMap curVal = it->toMap();
@@ -218,8 +218,8 @@
         }
         else if (key == PROPERTY_JOURNAL)
         {
-            PropertyVector journals = value.toArray();
-            for(PropertyVector::const_iterator it = journals.begin(); it != journals.end(); it++)
+            PropertyArray journals = value.toArray();
+            for(PropertyArray::const_iterator it = journals.begin(); it != journals.end(); it++)
             {
                 PropertyMap curVal = it->toMap();
                 Property caption = curVal[JournalEntry::PROPERTY_CAPTION];

Modified: rl/trunk/engine/script/swig/TypeRlProperty.swig
===================================================================
--- rl/trunk/engine/script/swig/TypeRlProperty.swig	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/script/swig/TypeRlProperty.swig	2008-02-03 14:29:05 UTC (rev 4053)
@@ -145,9 +145,9 @@
     }
     else if (input.isArray())
     {
-		PropertyVector vec = input.toArray();
+		PropertyArray vec = input.toArray();
 		VALUE rval = rb_ary_new();
-		for (PropertyVector::const_iterator it = vec.begin();
+		for (PropertyArray::const_iterator it = vec.begin();
 			it != vec.end(); ++it)
 		{
 			rb_ary_push(rval, rl::convertPropertyToValue(*it));

Modified: rl/trunk/engine/ui/include/PropertiesWindow.h
===================================================================
--- rl/trunk/engine/ui/include/PropertiesWindow.h	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/ui/include/PropertiesWindow.h	2008-02-03 14:29:05 UTC (rev 4053)
@@ -133,7 +133,7 @@
          *
          * @param key The property to add.
          */
-        void addPropertyVector3(const Property& prop, 
+        void addPropertyArray3(const Property& prop, 
             CEGUI::MultiColumnList* table,
             const Ogre::String& key = "");
 

Modified: rl/trunk/engine/ui/src/PropertiesWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/PropertiesWindow.cpp	2008-02-03 12:43:58 UTC (rev 4052)
+++ rl/trunk/engine/ui/src/PropertiesWindow.cpp	2008-02-03 14:29:05 UTC (rev 4053)
@@ -126,7 +126,7 @@
             // Check for Vector3
             else if (propIter->second.isVector3() )
             {
-                addPropertyVector3(propIter->second, mMainTable, key);
+                addPropertyArray3(propIter->second, mMainTable, key);
                 int rowCount = mMainTable->getRowCount();
                 mMainTable->addRow(rowCount);
                 mMainTable->setItem(new ListboxTextItem(""), 0, rowCount);
@@ -391,9 +391,9 @@
         }
     }
 
-    //------------------------------------------------------- addPropertyVector3
+    //------------------------------------------------------- addPropertyArray3
 
-    void PropertiesWindow::addPropertyVector3(const Property& prop,
+    void PropertiesWindow::addPropertyArray3(const Property& prop,
         CEGUI::MultiColumnList* table, const Ogre::String& key)
     {
         // Check column count
@@ -535,11 +535,11 @@
         mTabPane->addTab(newTable);
 
         // Get access to the vector
-        PropertyVector vProp = prop.toArray();
+        PropertyArray vProp = prop.toArray();
 
         // Iterate through the vector entries and add them
         // to the table
-        for(PropertyVector::const_iterator it = vProp.begin(); it != vProp.end(); it++)
+        for(PropertyArray::const_iterator it = vProp.begin(); it != vProp.end(); it++)
         {
             // Check for Int
             if (it->isInt() )
@@ -580,7 +580,7 @@
             // Check for Vector3
             else if (it->isVector3() )
             {
-                addPropertyVector3(*it, newTable);
+                addPropertyArray3(*it, newTable);
                 int rowCount = newTable->getRowCount();
                 newTable->addRow(rowCount);
                 newTable->setItem(new ListboxTextItem(""), 0, rowCount);



From chrber at mail.berlios.de  Tue Feb  5 21:21:04 2008
From: chrber at mail.berlios.de (chrber at mail.berlios.de)
Date: Tue, 5 Feb 2008 21:21:04 +0100
Subject: [Dsa-hl-svn] r4054 - rl/trunk/engine/ui/src
Message-ID: <200802052021.m15KL4QD032469@sheep.berlios.de>

Author: chrber
Date: 2008-02-05 21:21:03 +0100 (Tue, 05 Feb 2008)
New Revision: 4054

Modified:
   rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp
Log:
Small fix to correct an ambiguous typedef (well, only gcc is annoyed)


Modified: rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp	2008-02-03 14:29:05 UTC (rev 4053)
+++ rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp	2008-02-05 20:21:03 UTC (rev 4054)
@@ -106,7 +106,7 @@
 
 		if(mSaveGameTable->getFirstSelectedItem())
 		{
-			uint SelectedRow = mSaveGameTable->getRowWithID(mSaveGameTable->getFirstSelectedItem()->getID());
+			CEGUI::uint SelectedRow = mSaveGameTable->getRowWithID(mSaveGameTable->getFirstSelectedItem()->getID());
 			CeGuiString moduleName = mSaveGameTable->getItemAtGridReference(CEGUI::MCLGridRef(SelectedRow,1))->getText();
 			ContentModule* module = NULL;
 			module = CoreSubsystem::getSingleton().getModule(moduleName.c_str());
@@ -136,7 +136,7 @@
 		    mSaveGameTable->removeRow(mSaveGameTable->getRowCount()-1);
         while(mSaveGameTable->getRowCount() < saveGames.size())
 		    mSaveGameTable->addRow();
-        
+
         int saveGameNum = 0;
 
         for(SaveGameEntryMap::iterator it = saveGames.begin(); it != saveGames.end(); it++)



From blakharaz at mail.berlios.de  Tue Feb  5 23:03:39 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 5 Feb 2008 23:03:39 +0100
Subject: [Dsa-hl-svn] r4055 - rl/trunk/engine/ui/src
Message-ID: <200802052203.m15M3d9v010973@sheep.berlios.de>

Author: blakharaz
Date: 2008-02-05 23:03:37 +0100 (Tue, 05 Feb 2008)
New Revision: 4055

Modified:
   rl/trunk/engine/ui/src/InventoryWindow.cpp
Log:


Modified: rl/trunk/engine/ui/src/InventoryWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/InventoryWindow.cpp	2008-02-05 20:21:03 UTC (rev 4054)
+++ rl/trunk/engine/ui/src/InventoryWindow.cpp	2008-02-05 22:03:37 UTC (rev 4055)
@@ -420,7 +420,7 @@
 				+ mInventory->getOwner()->getOrientation()
 				* targetPosWindow;
             item->removeOldState();
-			item->placeIntoScene();
+			item->setState(GOS_IN_SCENE);
 			item->setPosition(targetPosWorldSpace);
 
 			LOG_DEBUG(Logger::UI,



From blakharaz at mail.berlios.de  Tue Feb  5 23:09:04 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 5 Feb 2008 23:09:04 +0100
Subject: [Dsa-hl-svn] r4056 - rl/trunk/engine/core/src
Message-ID: <200802052209.m15M948u011327@sheep.berlios.de>

Author: blakharaz
Date: 2008-02-05 23:09:03 +0100 (Tue, 05 Feb 2008)
New Revision: 4056

Modified:
   rl/trunk/engine/core/src/Job.cpp
Log:
fix typo

Modified: rl/trunk/engine/core/src/Job.cpp
===================================================================
--- rl/trunk/engine/core/src/Job.cpp	2008-02-05 22:03:37 UTC (rev 4055)
+++ rl/trunk/engine/core/src/Job.cpp	2008-02-05 22:09:03 UTC (rev 4056)
@@ -20,11 +20,11 @@
 
 namespace rl
 {
-    Job::Job(bool isDiscardable, bool destroyWhenDone, TimeSource::TimeSourceType timesource, JobPersistenceType peristence)
+    Job::Job(bool isDiscardable, bool destroyWhenDone, TimeSource::TimeSourceType timesource, JobPersistenceType persistence)
         : mIsDiscardable(isDiscardable), 
         mDestroyWhenDone(destroyWhenDone),
         mTimeSource(timesource),
-        mPersistence(peristence)
+        mPersistence(persistence)
     {
     }
 
@@ -57,45 +57,45 @@
         return mPersistence;
     }
 
-    const Property Job::getProperty(const Ogre::String& key) const
-    {
-        Property prop;
-        if( key == "discardable" )
-        {
-            prop.setValue(mIsDiscardable);
-        }
-        else if( key == "destroywhendone" )
-        {
-            prop.setValue(mDestroyWhenDone);
-        }
-        else if( key == "timesource" )
-        {
-            prop.setValue((int)mTimeSource);
-        }
-        else
-        {
-            Throw(IllegalArgumentException, key + " is not a property of this Job!");
-        }
-
-        return prop;
-    }
-
-    void Job::setProperty(const Ogre::String& key, const Property& value)
-    {
-        try
-        {
-            if( key == "discardable" )
-            {
-                mIsDiscardable = value.toBool();
-            }
-            else if( key == "destroywhendone" )
-            {
-                mDestroyWhenDone = value.toBool();
-            }
-            else if( key == "timesource" )
-            {
-                mTimeSource = (TimeSource::TimeSourceType)value.toInt();
-            }
+    const Property Job::getProperty(const Ogre::String& key) const
+    {
+        Property prop;
+        if( key == "discardable" )
+        {
+            prop.setValue(mIsDiscardable);
+        }
+        else if( key == "destroywhendone" )
+        {
+            prop.setValue(mDestroyWhenDone);
+        }
+        else if( key == "timesource" )
+        {
+            prop.setValue((int)mTimeSource);
+        }
+        else
+        {
+            Throw(IllegalArgumentException, key + " is not a property of this Job!");
+        }
+
+        return prop;
+    }
+
+    void Job::setProperty(const Ogre::String& key, const Property& value)
+    {
+        try
+        {
+            if( key == "discardable" )
+            {
+                mIsDiscardable = value.toBool();
+            }
+            else if( key == "destroywhendone" )
+            {
+                mDestroyWhenDone = value.toBool();
+            }
+            else if( key == "timesource" )
+            {
+                mTimeSource = (TimeSource::TimeSourceType)value.toInt();
+            }
             else
             {
                 LOG_WARNING(
@@ -108,9 +108,9 @@
             LOG_ERROR(
                 Logger::RULES,
                 "property " + key + " has the wrong format");
-        }
-    }
-
+        }
+    }
+
     PropertyRecord* Job::getAllProperties() const
     {
         PropertyRecord* ps = new PropertyRecord();



From blakharaz at mail.berlios.de  Tue Feb  5 23:12:37 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 5 Feb 2008 23:12:37 +0100
Subject: [Dsa-hl-svn] r4057 - modules/common/scripts/jobs
	modules/regressiontest/scripts rl/trunk/engine/rules
	rl/trunk/engine/rules/include rl/trunk/engine/rules/src
	rl/trunk/engine/script/swig
Message-ID: <200802052212.m15MCbEq011682@sheep.berlios.de>

Author: blakharaz
Date: 2008-02-05 23:12:32 +0100 (Tue, 05 Feb 2008)
New Revision: 4057

Added:
   rl/trunk/engine/rules/include/WaitJob.h
   rl/trunk/engine/rules/src/WaitJob.cpp
Modified:
   modules/common/scripts/jobs/jobsequence.rb
   modules/regressiontest/scripts/JobSequenceTest.rb
   rl/trunk/engine/rules/RlRules2005.vcproj
   rl/trunk/engine/rules/include/Date.h
   rl/trunk/engine/rules/include/Makefile.am
   rl/trunk/engine/rules/src/Date.cpp
   rl/trunk/engine/rules/src/DsaManager.cpp
   rl/trunk/engine/rules/src/Makefile.am
   rl/trunk/engine/script/swig/RlRules.head.swig
   rl/trunk/engine/script/swig/RlRules.swig
Log:
* Added conversion Date <-> Real 
* Added WaitJob (for both game and real time) 
    - plus ruby convenience functions and test case

Modified: modules/common/scripts/jobs/jobsequence.rb
===================================================================
--- modules/common/scripts/jobs/jobsequence.rb	2008-02-05 22:09:03 UTC (rev 4056)
+++ modules/common/scripts/jobs/jobsequence.rb	2008-02-05 22:12:32 UTC (rev 4057)
@@ -33,14 +33,12 @@
 				set.add(y) 
 			}
 			queue.add(set)
-#       elsif x.is_a? Numeric:
-#            # This is a time, we add it to the start time, of jobs
-#            # later in the queue
-#            start += x
-#            p "starttime #start"
+		elsif x.is_a? Numeric:
+			queue.add(WaitJob.new(x));
         elsif x.is_a? Job
             queue.add(x)
-            p "job added"
+		elsif x.is_a? Date
+			queue.add(WaitJob.new(x))
         end
     }
 	$JS.addJob(queue, 20)

Modified: modules/regressiontest/scripts/JobSequenceTest.rb
===================================================================
--- modules/regressiontest/scripts/JobSequenceTest.rb	2008-02-05 22:09:03 UTC (rev 4056)
+++ modules/regressiontest/scripts/JobSequenceTest.rb	2008-02-05 22:12:32 UTC (rev 4057)
@@ -60,6 +60,37 @@
   end
 end
 
+class GameTimeJobQueueTestAction < Action
+  def initialize
+    super("gametqueue", "Test game time job queue");
+  end
+  
+  def canDo(go, user)
+    true
+  end
+  
+  def doAction(go, user, target)
+    jobQueue(
+            [
+                [
+					_PlayAnimation(go.getActor(), "auf"), 
+					_PlaySound3d("doorcreak.ogg", go.getPosition())
+				],
+				Date.new(Date::ONE_KAMPFRUNDE),
+				_PlaySound3d("lachen.ogg", go.getPosition()),
+				[
+					_PlayAnimation(go.getActor(), "zu"), 
+					_PlaySound3d("doorcreak.ogg", go.getPosition())
+				],
+				Date.new(Date::ONE_SPIELRUNDE),
+				_PlaySound3d("lachen.ogg", go.getPosition()),
+				_Execute {provokeEror},
+				_Execute {p "FOO"}
+            ]
+    )
+  end
+end
+
 class JobSequenceTest < TestCase
     def execute()
         # Define a base box to place everything else on.
@@ -73,8 +104,9 @@
         chest = $GOM.createGameObject(
             "JobSequenceTestChest");
         chest.addAction(JobSequenceTestAction.new());
-        chest.addAction(JobQueueTestAction.new());
-        chest.placeIntoScene();
+        chest.addAction(JobQueueTestAction.new()); 
+        chest.addAction(GameTimeJobQueueTestAction.new());
+		chest.placeIntoScene();
         chest.setPosition(rel_pos([0.0, height, 0.0]));
 
         $SCRIPT.log("JobSequenceTest initialisiert");

Modified: rl/trunk/engine/rules/RlRules2005.vcproj
===================================================================
--- rl/trunk/engine/rules/RlRules2005.vcproj	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/rules/RlRules2005.vcproj	2008-02-05 22:12:32 UTC (rev 4057)
@@ -463,6 +463,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\src\WaitJob.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\ZauberStateSet.cpp"
 				>
 			</File>
@@ -669,6 +673,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\WaitJob.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\ZauberStateSet.h"
 				>
 			</File>

Modified: rl/trunk/engine/rules/include/Date.h
===================================================================
--- rl/trunk/engine/rules/include/Date.h	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/rules/include/Date.h	2008-02-05 22:12:32 UTC (rev 4057)
@@ -21,64 +21,56 @@
 
 namespace rl
 {
-    /** Die Datumsklasse fuer den Aventurischen Kalender.
-     *  Das Datum wird auf Basis des in der Geographia Aventurica 
-     *  beschriebenen Kalenders verwaltet. Das Format basiert auf
-     *  die Millisekunden seit 00:00:00,000 1. Praios 0 BF.
-     *  Dieser Wert wird als 64Bit Timestamp gespeichert, alle
-     *  anderen Komponenten(Tag, Stunde etc.) werden daraus
-     *  berechnet.
+    /** 
+     * The date class for the Aventurian calendar
+     * The date is managed according to the calendar described
+     * in the Geographia Aventurica (see p. XXX)
+     * The format is based on milliseconds since
+     * 00:00:00,000 1. Praios 0 BF, this value is stored as a
+     * 64 bit timestamp, all other data (day, hour etc.) is
+     * calculated.
      *  @todo CReal-Umrechnung, Komfortfunktionen
+     *
+     * Caution: all Real parameters or return values mean seconds, NOT milliseconds
      */
     class _RlRulesExport Date
     {
         friend Date _RlRulesExport operator+(const RL_LONGLONG&, const Date&);
+        friend Date _RlRulesExport operator+(const Ogre::Real&, const Date&);
         friend Date _RlRulesExport operator-(const RL_LONGLONG&, const Date&);
-    private:
+        friend Date _RlRulesExport operator-(const Ogre::Real&, const Date&);
 
-        int mMilli;
-        int mSecond;
-        int mMinute;
-        int mHour;
-        int mDayOfMonth;
-        int mDayOfYear;
-        int mMonth;
-        int mYear;
-
-        RL_LONGLONG mTimestamp;
-
-        /** Berechnet den Inhalt der Felder in Abhaengigkeit von
-         *  mTimestamp neu.
-         */
-        void calculateFields();
     public:
-        /// Eine Sekunde in Millisekunden
+        /// One second in milliseconds
         static const unsigned RL_LONGLONG ONE_SECOND;
-        /// Eine Minute in Millisekunden
+        /// One minute in milliseconds
         static const unsigned RL_LONGLONG ONE_MINUTE;
-        /// Eine Stunde in Millisekunden
+        /// One hour in milliseconds
         static const unsigned RL_LONGLONG ONE_HOUR;
-        /// Ein Tag in Millisekunden
+        /// One day in milliseconds
         static const unsigned RL_LONGLONG ONE_DAY;
-        /// Eine Woche in Millisekunden
+        /// One week in milliseconds
         static const unsigned RL_LONGLONG ONE_WEEK;
-        /// Ein Monat in Millisekunden
+        /// One (dark eye) month in milliseconds
         static const unsigned RL_LONGLONG ONE_MONTH;
-        /// Ein Jahr in Millisekunden
+        /// One (dark eye) year in milliseconds
         static const unsigned RL_LONGLONG ONE_YEAR;
 
-        /// Ein Kampfrunde in Millisekunden
+        /// One combat round (Kampfrunde) in milliseconds
         static const unsigned RL_LONGLONG ONE_KAMPFRUNDE;
-        /// Ein Spielrunde in Millisekunden
+        /// One game round (Spielrunde) in milliseconds
         static const unsigned RL_LONGLONG ONE_SPIELRUNDE;
 
-        /// Standardkonstruktor erzeugt Datum mit timestamp 0
+        /** 
+         * Default constructor creates date with timestamp 0
+         * (00:00:00,000 1. Praios 0 BF)
+         */
         Date();
 
-        /// Konstruktor erzeugt Datum an uebergebener Timestamp
+        /// Create a date with given timestamp
         Date(const RL_LONGLONG& timestamp);
 
-        /// Kopierkonstruktor
+        /// Copy constructor
         Date(const Date& rhs);
 
         Date& operator=(const Date& rhs);
@@ -92,14 +84,16 @@
 		Date operator+(const Date& rhs);
 		Date operator-(const RL_LONGLONG& rhs);
         RL_LONGLONG operator-(const Date& rhs);
+        Date operator*(const Ogre::Real& rhs);
+        Date operator/(const Ogre::Real& rhs);
 
         RL_LONGLONG getTimestamp() const;
 
-        /// Millisekunden seit 00:00:00,000 des instantiierten Tages.
+        /// Milliseconds since 00:00:00,000 of the Date's day
         int getTimeFraction() const;
         int getYear() const;
         int getMonth() const;
-        /// Name des instantiierten Monats
+        /// Get the name of the Date's month
         std::string getMonthName() const;
         int getDayOfYear() const;
         int getDayOfMonth() const;
@@ -110,12 +104,35 @@
         int getSecond() const;
         int getMilliSecond() const;
 
-        /** Gibt ein Datum in der Form {Wochentag},
-         *  der {Tag}. {Monat} im Jahre {Jahr}, {Stunde}:{Minute}.
-         *  zurueck.
-         * @return Datum in ausgabefaehiger Textform.
+        /** 
+         * Get a nicely formated string representation of the date
+         * Format is 
+         * "{Day of Week}, der {Day}. {Month} im Jahre {Year}, {Hour}:{Minute}.
+         *
+         * @return The date as a printable text
          */
-        std::string toString() const;
+        const std::string toString() const;
+
+        static const Date fromReal(const Ogre::Real& time);
+        const Ogre::Real toReal() const;
+
+    private:
+
+        int mMilli;
+        int mSecond;
+        int mMinute;
+        int mHour;
+        int mDayOfMonth;
+        int mDayOfYear;
+        int mMonth;
+        int mYear;
+
+        RL_LONGLONG mTimestamp;
+
+        /** Berechnet den Inhalt der Felder in Abhaengigkeit von
+         *  mTimestamp neu.
+         */
+        void calculateFields();
     };
 
     Date _RlRulesExport operator+(const RL_LONGLONG&, const Date&);

Modified: rl/trunk/engine/rules/include/Makefile.am
===================================================================
--- rl/trunk/engine/rules/include/Makefile.am	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/rules/include/Makefile.am	2008-02-05 22:12:32 UTC (rev 4057)
@@ -43,5 +43,6 @@
 	Talentgruppe.h \
 	TalentInputIterator.h \
 	TalentStateSet.h \
+	WaitJob.h \
 	Weapon.h \
 	ZauberStateSet.h

Added: rl/trunk/engine/rules/include/WaitJob.h
===================================================================
--- rl/trunk/engine/rules/include/WaitJob.h	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/rules/include/WaitJob.h	2008-02-05 22:12:32 UTC (rev 4057)
@@ -0,0 +1,44 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+#ifndef __WaitJob_H__
+#define __WaitJob_H__
+
+#include "RulesPrerequisites.h"
+
+#include "Date.h"
+#include "Job.h"
+
+namespace rl
+{
+    class Date;
+
+    class _RlRulesExport WaitJob :
+        public Job
+    {
+    public:
+        WaitJob(const Date& dsatime);
+        WaitJob(const Ogre::Real& realtime);
+        ~WaitJob();
+
+        virtual bool execute(Ogre::Real time);
+
+    private:
+        Ogre::Real mTime;
+    };
+
+}
+
+#endif // __WaitJob_H__

Modified: rl/trunk/engine/rules/src/Date.cpp
===================================================================
--- rl/trunk/engine/rules/src/Date.cpp	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/rules/src/Date.cpp	2008-02-05 22:12:32 UTC (rev 4057)
@@ -140,9 +140,19 @@
         return mTimestamp - rhs.mTimestamp;
     }
 
+    Date Date::operator*(const Ogre::Real& rhs)
+    {
+        return Date(mTimestamp * rhs);
+    }
+
+    Date Date::operator/(const Ogre::Real& rhs)
+    {
+        return Date(mTimestamp / rhs); ///@todo throw exception if rhs == 0?
+    }
+
     void Date::calculateFields()
     {
-        //!\todo aufr?umen!
+        ///@todo aufraeumen!
         mYear = mTimestamp / ONE_YEAR;
         RL_LONGLONG timeInYear = mTimestamp % ONE_YEAR;
         mMonth = timeInYear / ONE_MONTH;
@@ -195,8 +205,7 @@
 
     int Date::getDayOfWeek() const
     {
-        int wd = ((getYear() - 993) + getDayOfMonth() + MONTH_MODIFIER[mMonth]) %
-                 7;
+        int wd = ((getYear() - 993) + getDayOfMonth() + MONTH_MODIFIER[mMonth]) % 7;
 
         if (wd < 0)
         {
@@ -231,7 +240,7 @@
         return mMilli;
     }
 
-    std::string Date::toString() const
+    const std::string Date::toString() const
     {
         char date[256];
         _snprintf(date,
@@ -246,6 +255,16 @@
         return std::string(date);
     }
 
+    const Date Date::fromReal(const Ogre::Real& time)
+    {
+        return Date(time / 1000.0);
+    }
+
+    const Ogre::Real Date::toReal() const
+    {
+        return static_cast<Ogre::Real>(mTimestamp) / 1000.0;
+    }
+
     Date operator+(const RL_LONGLONG& lhs, const Date& rhs)
     {
         return Date(rhs.mTimestamp + lhs);

Modified: rl/trunk/engine/rules/src/DsaManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/DsaManager.cpp	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/rules/src/DsaManager.cpp	2008-02-05 22:12:32 UTC (rev 4057)
@@ -157,7 +157,7 @@
         }
         else
         {
-            return Date(0); ///@todo better throw exception?
+            return Date(); ///@todo better throw exception?
         }
 	}
 

Modified: rl/trunk/engine/rules/src/Makefile.am
===================================================================
--- rl/trunk/engine/rules/src/Makefile.am	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/rules/src/Makefile.am	2008-02-05 22:12:32 UTC (rev 4057)
@@ -45,5 +45,6 @@
 	Talent.cpp \
 	Talentgruppe.cpp \
 	TalentStateSet.cpp \
+	WaitJob.cpp \
 	Weapon.cpp \
 	ZauberStateSet.cpp

Added: rl/trunk/engine/rules/src/WaitJob.cpp
===================================================================
--- rl/trunk/engine/rules/src/WaitJob.cpp	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/rules/src/WaitJob.cpp	2008-02-05 22:12:32 UTC (rev 4057)
@@ -0,0 +1,51 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+#include "stdinc.h"
+#include "WaitJob.h"
+
+#include "Date.h"
+
+namespace rl
+{
+
+    WaitJob::WaitJob(const Date& dsatime)
+        : Job(false, true, TimeSource::GAMETIME, Job::PERSISTENT),
+        mTime(dsatime.toReal())
+    {
+    }
+
+    WaitJob::WaitJob(const Ogre::Real& realtime)
+        : Job(false, true, TimeSource::REALTIME_INTERRUPTABLE, Job::PERSISTENT),
+        mTime(realtime)
+    {
+    }
+
+    WaitJob::~WaitJob()
+    {
+    }
+
+    bool WaitJob::execute(Ogre::Real time)
+    {
+        mTime -= time;
+        if (mTime <= 0)
+        {
+            return true;
+        }
+        
+        return false;
+    }
+
+}

Modified: rl/trunk/engine/script/swig/RlRules.head.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.head.swig	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/script/swig/RlRules.head.swig	2008-02-05 22:12:32 UTC (rev 4057)
@@ -51,5 +51,6 @@
 #include "Talent.h"
 #include "TalentStateSet.h"
 #include "Tripel.h"
+#include "WaitJob.h"
 #include "Weapon.h"
 %}

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2008-02-05 22:09:03 UTC (rev 4056)
+++ rl/trunk/engine/script/swig/RlRules.swig	2008-02-05 22:12:32 UTC (rev 4057)
@@ -404,6 +404,13 @@
         virtual void onStateChange(GameObjectState oldState, GameObjectState newState);
     };
     
+    class WaitJob : public rl::Job
+    {
+    public:
+        WaitJob(const rl::Date& dsatime);
+        WaitJob(const Ogre::Real& realtime);
+    };
+    
     %feature("director") Item;
     class Item : public rl::GameObject {
     public:



From blakharaz at mail.berlios.de  Tue Feb  5 23:15:54 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 5 Feb 2008 23:15:54 +0100
Subject: [Dsa-hl-svn] r4058 - in rl/trunk/engine/core: include src
Message-ID: <200802052215.m15MFsd2011909@sheep.berlios.de>

Author: blakharaz
Date: 2008-02-05 23:15:52 +0100 (Tue, 05 Feb 2008)
New Revision: 4058

Modified:
   rl/trunk/engine/core/include/ConfigurationManager.h
   rl/trunk/engine/core/src/ConfigurationManager.cpp
   rl/trunk/engine/core/src/CoreSubsystem.cpp
Log:
* Move Ogre plugin name mangling into ConfigurationManager

Modified: rl/trunk/engine/core/include/ConfigurationManager.h
===================================================================
--- rl/trunk/engine/core/include/ConfigurationManager.h	2008-02-05 22:12:32 UTC (rev 4057)
+++ rl/trunk/engine/core/include/ConfigurationManager.h	2008-02-05 22:15:52 UTC (rev 4058)
@@ -241,6 +241,15 @@
             void addToCfgPath(const std::string& cfg_dir);
 
             /**
+             * Adds a plugin to the plugin list, correctly adds _d for Windows if compiled
+             * in debug mode
+             *
+             * @param plugin the plugin to add (name without _d or file extension)
+             * @param pluginDir the directory in which the plugin dll is located
+             */
+            void addPlugin(const Ogre::String& plugin, const Ogre::String& pluginDir);
+
+            /**
              * Check if a specified file exists.
              *
              * @param filename File being checked for existence

Modified: rl/trunk/engine/core/src/ConfigurationManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ConfigurationManager.cpp	2008-02-05 22:12:32 UTC (rev 4057)
+++ rl/trunk/engine/core/src/ConfigurationManager.cpp	2008-02-05 22:15:52 UTC (rev 4058)
@@ -273,14 +273,11 @@
 
         // Plugin list for OGRE specific to operating system
 #       if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
-        Ogre::String dirSeparator = "\\";
-        mPluginList.push_back(mOgrePluginDirectory + dirSeparator + "RenderSystem_Direct3D9");
-#       else
-        Ogre::String dirSeparator = "/";
+        addPlugin("RenderSystem_Direct3D9", mOgrePluginDirectory);
 #       endif
-        mPluginList.push_back(mOgrePluginDirectory + dirSeparator + "RenderSystem_GL");
-        mPluginList.push_back(mOgrePluginDirectory + dirSeparator + "Plugin_ParticleFX");
-        mPluginList.push_back(mOgrePluginDirectory + dirSeparator + "Plugin_OctreeSceneManager");
+        addPlugin("RenderSystem_GL", mOgrePluginDirectory);
+        addPlugin("Plugin_ParticleFX", mOgrePluginDirectory);
+        addPlugin("Plugin_OctreeSceneManager", mOgrePluginDirectory);
 
         // Load the module list
         ConfigFile* configfile = new ConfigFile();
@@ -432,4 +429,22 @@
 
         return false;
     }
+
+    void ConfigurationManager::addPlugin(const Ogre::String& plugin, const Ogre::String& pluginDir)
+    {
+        // In Windows Ogre now uses a _d suffix for debug plugins. But client application is
+        // responsible for loading the proper vesion.
+        Ogre::String pluginSuffix = "";
+
+#       if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
+        Ogre::String dirSeparator = "\\";
+#          ifdef _DEBUG
+        pluginSuffix = "_d";
+#          endif
+#       else
+        Ogre::String dirSeparator = "/";
+#       endif
+
+        mPluginList.push_back(pluginDir + dirSeparator + plugin + pluginSuffix);
+    }
 }

Modified: rl/trunk/engine/core/src/CoreSubsystem.cpp
===================================================================
--- rl/trunk/engine/core/src/CoreSubsystem.cpp	2008-02-05 22:12:32 UTC (rev 4057)
+++ rl/trunk/engine/core/src/CoreSubsystem.cpp	2008-02-05 22:15:52 UTC (rev 4058)
@@ -175,19 +175,9 @@
         // Load Ogre plugins
         Ogre::StringVector pluginList = ConfigurationManager::getSingleton().getPluginList();
 
-        ///\todo In Windows Ogre now uses a _d suffix for debug plugins. But client application is
-        /// responsible for loading the proper vesion. This way to do it is kinda ugly.
-        /// We should somehow handle this in the ConfigurationManager.
-        Ogre::String pluginSuffix = "";
-#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
-#ifdef _DEBUG
-        pluginSuffix = "_d";
-#endif
-#endif
-
         for (Ogre::StringVector::const_iterator it = pluginList.begin(); it < pluginList.end(); it++)
         {
-            mOgreRoot->loadPlugin(*it + pluginSuffix);
+            mOgreRoot->loadPlugin(*it);
         }
 
         // Find out, what Renderer plugins are available
@@ -227,10 +217,11 @@
         int width = Ogre::StringConverter::parseInt(VideoMode.substr(0, temp));
         int height = Ogre::StringConverter::parseInt(VideoMode.substr(temp + 1, VideoMode.size()));
 
-        mRenderWindow = mOgreRoot->createRenderWindow(name.str(), width, height,
+        mRenderWindow = mOgreRoot->createRenderWindow(
+            name.str(), width, height,
             ConfigurationManager::getSingleton().getBoolSetting(
                 "Video", "Fullscreen"),
-                    &ConfigurationManager::getSingleton().getSettings("Video"));
+            &ConfigurationManager::getSingleton().getSettings("Video"));
 
         if (!mRenderWindow)
             return false;
@@ -245,7 +236,7 @@
 
         mScriptWrapper = new ScriptWrapper();
         LOG_MESSAGE(Logger::CORE,"Skriptwrapper erzeugt");
-        // TODO: muss l?schbar werden.
+        // TODO: muss l???schbar werden.
         mRubyInterpreter = new RubyInterpreter();
         LOG_MESSAGE(Logger::CORE,"RubyInterpreter erzeugt");
         mRubyInterpreter->initializeInterpreter();



From chrber at mail.berlios.de  Sat Feb  9 16:00:39 2008
From: chrber at mail.berlios.de (chrber at mail.berlios.de)
Date: Sat, 9 Feb 2008 16:00:39 +0100
Subject: [Dsa-hl-svn] r4059 - rl/trunk/m4
Message-ID: <200802091500.m19F0dW9018165@sheep.berlios.de>

Author: chrber
Date: 2008-02-09 16:00:37 +0100 (Sat, 09 Feb 2008)
New Revision: 4059

Modified:
   rl/trunk/m4/boost.m4
Log:
Replaced old boost m4 macros with new versions


Modified: rl/trunk/m4/boost.m4
===================================================================
--- rl/trunk/m4/boost.m4	2008-02-05 22:15:52 UTC (rev 4058)
+++ rl/trunk/m4/boost.m4	2008-02-09 15:00:37 UTC (rev 4059)
@@ -1,202 +1,234 @@
-dnl @synopsis AX_BOOST([MINIMUM-VERSION])
-dnl
-dnl Test for the Boost C++ libraries of a particular version (or newer)
-dnl
-dnl If no path to the installed boost library is given the macro
-dnl searchs under /usr, /usr/local, and /opt, and evaluates the
-dnl $BOOST_ROOT environment variable. Further documentation is
-dnl available at <http://randspringer.de/boost/index.html>.
-dnl
-dnl This macro calls:
-dnl
-dnl   AC_SUBST(BOOST_CPPFLAGS) / AC_SUBST(BOOST_LDFLAGS)
-dnl
-dnl And sets:
-dnl
-dnl   HAVE_BOOST
-dnl
-dnl @category InstalledPackages
-dnl @category Cxx
-dnl @author Thomas Porschberg <thomas at randspringer.de>
-dnl @version 2006-06-15
-dnl @license AllPermissive
+##### http://autoconf-archive.cryp.to/ax_boost_base.html
+#
+# SYNOPSIS
+#
+#   AX_BOOST_BASE([MINIMUM-VERSION])
+#
+# DESCRIPTION
+#
+#   Test for the Boost C++ libraries of a particular version (or newer)
+#
+#   If no path to the installed boost library is given the macro
+#   searchs under /usr, /usr/local, /opt and /opt/local and evaluates
+#   the $BOOST_ROOT environment variable. Further documentation is
+#   available at <http://randspringer.de/boost/index.html>.
+#
+#   This macro calls:
+#
+#     AC_SUBST(BOOST_CPPFLAGS) / AC_SUBST(BOOST_LDFLAGS)
+#
+#   And sets:
+#
+#     HAVE_BOOST
+#
+# LAST MODIFICATION
+#
+#   2007-07-28
+#
+# COPYLEFT
+#
+#   Copyright (c) 2007 Thomas Porschberg <thomas at randspringer.de>
+#
+#   Copying and distribution of this file, with or without
+#   modification, are permitted in any medium without royalty provided
+#   the copyright notice and this notice are preserved.
 
 AC_DEFUN([AX_BOOST_BASE],
 [
 AC_ARG_WITH([boost],
-	AS_HELP_STRING([--with-boost@<:@=DIR@:>@],         specify the root directory for boost),
+	AS_HELP_STRING([--with-boost@<:@=DIR@:>@], [use boost (default is yes) - it is possible to specify the root directory for boost (optional)]),
 	[
-    if test "$withval" = "yes"; then
+    if test "$withval" = "no"; then
+		want_boost="no"
+    elif test "$withval" = "yes"; then
+        want_boost="yes"
         ac_boost_path=""
     else
+	    want_boost="yes"
         ac_boost_path="$withval"
-    fi
+	fi
     ],
     [want_boost="yes"])
 
-boost_lib_version_req=ifelse([$1], ,1.20.0,$1)
-boost_lib_version_req_shorten=`expr $boost_lib_version_req : '\([[0-9]]*\.[[0-9]]*\)'`
-boost_lib_version_req_major=`expr $boost_lib_version_req : '\([[0-9]]*\)'`
-boost_lib_version_req_minor=`expr $boost_lib_version_req : '[[0-9]]*\.\([[0-9]]*\)'`
-boost_lib_version_req_sub_minor=`expr $boost_lib_version_req : '[[0-9]]*\.[[0-9]]*\.\([[0-9]]*\)'`
-if test "x$boost_lib_version_req_sub_minor" = "x" ; then
-    boost_lib_version_req_sub_minor="0"
-fi
-WANT_BOOST_VERSION=`expr $boost_lib_version_req_major \* 100000 \+  $boost_lib_version_req_minor \* 100 \+ $boost_lib_version_req_sub_minor`
-AC_MSG_CHECKING(for Boost >= $boost_lib_version_req)
-succeeded=no
+if test "x$want_boost" = "xyes"; then
+	boost_lib_version_req=ifelse([$1], ,1.20.0,$1)
+	boost_lib_version_req_shorten=`expr $boost_lib_version_req : '\([[0-9]]*\.[[0-9]]*\)'`
+	boost_lib_version_req_major=`expr $boost_lib_version_req : '\([[0-9]]*\)'`
+	boost_lib_version_req_minor=`expr $boost_lib_version_req : '[[0-9]]*\.\([[0-9]]*\)'`
+	boost_lib_version_req_sub_minor=`expr $boost_lib_version_req : '[[0-9]]*\.[[0-9]]*\.\([[0-9]]*\)'`
+	if test "x$boost_lib_version_req_sub_minor" = "x" ; then
+		boost_lib_version_req_sub_minor="0"
+    	fi
+	WANT_BOOST_VERSION=`expr $boost_lib_version_req_major \* 100000 \+  $boost_lib_version_req_minor \* 100 \+ $boost_lib_version_req_sub_minor`
+	AC_MSG_CHECKING(for boostlib >= $boost_lib_version_req)
+	succeeded=no
 
-dnl first we check the system location for boost libraries
-dnl this location ist chosen if boost libraries are installed with the --layout=system option
-dnl or if you install boost with RPM
-if test "$ac_boost_path" != ""; then
-    BOOST_LDFLAGS="-L$ac_boost_path/lib"
-    BOOST_CPPFLAGS="-I$ac_boost_path/include"
-else
-    for ac_boost_path_tmp in /usr /usr/local /opt ; do
-        if test -d "$ac_boost_path_tmp/include/boost" && test -r "$ac_boost_path_tmp/include/boost"; then
-            BOOST_LDFLAGS="-L$ac_boost_path_tmp/lib"
-            BOOST_CPPFLAGS="-I$ac_boost_path_tmp/include"
-            break;
-        fi
-    done
-fi
+	dnl first we check the system location for boost libraries
+	dnl this location ist chosen if boost libraries are installed with the --layout=system option
+	dnl or if you install boost with RPM
+	if test "$ac_boost_path" != ""; then
+		BOOST_LDFLAGS="-L$ac_boost_path/lib"
+		BOOST_CPPFLAGS="-I$ac_boost_path/include"
+	else
+		for ac_boost_path_tmp in /usr /usr/local /opt /opt/local ; do
+			if test -d "$ac_boost_path_tmp/include/boost" && test -r "$ac_boost_path_tmp/include/boost"; then
+				BOOST_LDFLAGS="-L$ac_boost_path_tmp/lib"
+				BOOST_CPPFLAGS="-I$ac_boost_path_tmp/include"
+				break;
+			fi
+		done
+	fi
 
-CPPFLAGS_SAVED="$CPPFLAGS"
-CPPFLAGS="$CPPFLAGS $BOOST_CPPFLAGS"
-export CPPFLAGS
+	CPPFLAGS_SAVED="$CPPFLAGS"
+	CPPFLAGS="$CPPFLAGS $BOOST_CPPFLAGS"
+	export CPPFLAGS
 
-LDFLAGS_SAVED="$LDFLAGS"
-LDFLAGS="$LDFLAGS $BOOST_LDFLAGS"
-export LDFLAGS
+	LDFLAGS_SAVED="$LDFLAGS"
+	LDFLAGS="$LDFLAGS $BOOST_LDFLAGS"
+	export LDFLAGS
 
-AC_LANG_PUSH(C++)
-AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-@%:@include <boost/version.hpp>
-]], [[
-#if BOOST_VERSION >= $WANT_BOOST_VERSION
-// Everything is okay
-#else
-  error Boost version is too old
-#endif
-]])],[
-AC_MSG_RESULT(yes)
-succeeded=yes
-found_system=yes
-],[
-])
-AC_LANG_POP([C++])
+	AC_LANG_PUSH(C++)
+     	AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
+	@%:@include <boost/version.hpp>
+	]], [[
+	#if BOOST_VERSION >= $WANT_BOOST_VERSION
+	// Everything is okay
+	#else
+	#  error Boost version is too old
+	#endif
+	]])],[
+        AC_MSG_RESULT(yes)
+	succeeded=yes
+	found_system=yes
+       	],[
+       	])
+	AC_LANG_POP([C++])
 
-dnl if we found no boost with system layout we search for boost libraries
-dnl built and installed without the --layout=system option or for a staged(not installed) version
-if test "x$succeeded" != "xyes"; then
-    _version=0
-    if test "$ac_boost_path" != ""; then
-        BOOST_LDFLAGS="-L$ac_boost_path/lib"
-        if test -d "$ac_boost_path" && test -r "$ac_boost_path"; then
-            for i in `ls -d $ac_boost_path/include/boost-* 2>/dev/null`; do
-                _version_tmp=`echo $i | sed "s#$ac_boost_path##" | sed 's/\/include\/boost-//' | sed 's/_/./'`
-                V_CHECK=`expr $_version_tmp \> $_version`
-                if test "$V_CHECK" = "1" ; then
-                    _version=$_version_tmp
-                fi
-                VERSION_UNDERSCORE=`echo $_version | sed 's/\./_/'`
-                BOOST_CPPFLAGS="-I$ac_boost_path/include/boost-$VERSION_UNDERSCORE"
-            done
-        fi
-    else
-        for ac_boost_path in /usr /usr/local /opt ; do
-            if test -d "$ac_boost_path" && test -r "$ac_boost_path"; then
-                for i in `ls -d $ac_boost_path/include/boost-* 2>/dev/null`; do
-                    _version_tmp=`echo $i | sed "s#$ac_boost_path##" | sed 's/\/include\/boost-//' | sed 's/_/./'`
-                    V_CHECK=`expr $_version_tmp \> $_version`
-                    if test "$V_CHECK" = "1" ; then
-                        _version=$_version_tmp
-                        best_path=$ac_boost_path
-                    fi
-                done
-            fi
-        done
 
-        VERSION_UNDERSCORE=`echo $_version | sed 's/\./_/'`
-        BOOST_CPPFLAGS="-I$best_path/include/boost-$VERSION_UNDERSCORE"
-        BOOST_LDFLAGS="-L$best_path/lib"
 
-        if test "x$BOOST_ROOT" != "x"; then
-            if test -d "$BOOST_ROOT" && test -r "$BOOST_ROOT" && test -d "$BOOST_ROOT/stage/lib" && test -r "$BOOST_ROOT/stage/lib"; then
-                version_dir=`expr //$BOOST_ROOT : '.*/\(.*\)'`
-                stage_version=`echo $version_dir | sed 's/boost_//' | sed 's/_/./g'`
-                stage_version_shorten=`expr $stage_version : '\([[0-9]]*\.[[0-9]]*\)'`
-                V_CHECK=`expr $stage_version_shorten \>\= $_version`
-                if test "$V_CHECK" = "1" ; then
-                    AC_MSG_NOTICE(We will use a staged boost library from $BOOST_ROOT)
-                    BOOST_CPPFLAGS="-I$BOOST_ROOT"
-                    BOOST_LDFLAGS="-L$BOOST_ROOT/stage/lib"
-                fi
-            fi
-        fi
-    fi
+	dnl if we found no boost with system layout we search for boost libraries
+	dnl built and installed without the --layout=system option or for a staged(not installed) version
+	if test "x$succeeded" != "xyes"; then
+		_version=0
+		if test "$ac_boost_path" != ""; then
+               		BOOST_LDFLAGS="-L$ac_boost_path/lib"
+			if test -d "$ac_boost_path" && test -r "$ac_boost_path"; then
+				for i in `ls -d $ac_boost_path/include/boost-* 2>/dev/null`; do
+					_version_tmp=`echo $i | sed "s#$ac_boost_path##" | sed 's/\/include\/boost-//' | sed 's/_/./'`
+					V_CHECK=`expr $_version_tmp \> $_version`
+					if test "$V_CHECK" = "1" ; then
+						_version=$_version_tmp
+					fi
+					VERSION_UNDERSCORE=`echo $_version | sed 's/\./_/'`
+					BOOST_CPPFLAGS="-I$ac_boost_path/include/boost-$VERSION_UNDERSCORE"
+				done
+			fi
+		else
+			for ac_boost_path in /usr /usr/local /opt /opt/local ; do
+				if test -d "$ac_boost_path" && test -r "$ac_boost_path"; then
+					for i in `ls -d $ac_boost_path/include/boost-* 2>/dev/null`; do
+						_version_tmp=`echo $i | sed "s#$ac_boost_path##" | sed 's/\/include\/boost-//' | sed 's/_/./'`
+						V_CHECK=`expr $_version_tmp \> $_version`
+						if test "$V_CHECK" = "1" ; then
+							_version=$_version_tmp
+	               					best_path=$ac_boost_path
+						fi
+					done
+				fi
+			done
 
-    CPPFLAGS="$CPPFLAGS $BOOST_CPPFLAGS"
-    export CPPFLAGS
-    LDFLAGS="$LDFLAGS $BOOST_LDFLAGS"
-    export LDFLAGS
+			VERSION_UNDERSCORE=`echo $_version | sed 's/\./_/'`
+			BOOST_CPPFLAGS="-I$best_path/include/boost-$VERSION_UNDERSCORE"
+			BOOST_LDFLAGS="-L$best_path/lib"
 
-    AC_LANG_PUSH(C++)
-    AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
-    @%:@include <boost/version.hpp>
-   ]], [[
-   #if BOOST_VERSION >= $WANT_BOOST_VERSION
-   // Everything is okay
-   #else
-   #  error Boost version is too old
-   #endif
-   ]])],[
-   AC_MSG_RESULT(yes)
-   succeeded=yes
-   found_system=yes
-   ],[
-   ])
-   AC_LANG_POP([C++])
-fi
+	    		if test "x$BOOST_ROOT" != "x"; then
+				if test -d "$BOOST_ROOT" && test -r "$BOOST_ROOT" && test -d "$BOOST_ROOT/stage/lib" && test -r "$BOOST_ROOT/stage/lib"; then
+					version_dir=`expr //$BOOST_ROOT : '.*/\(.*\)'`
+					stage_version=`echo $version_dir | sed 's/boost_//' | sed 's/_/./g'`
+			        	stage_version_shorten=`expr $stage_version : '\([[0-9]]*\.[[0-9]]*\)'`
+					V_CHECK=`expr $stage_version_shorten \>\= $_version`
+				        if test "$V_CHECK" = "1" ; then
+						AC_MSG_NOTICE(We will use a staged boost library from $BOOST_ROOT)
+						BOOST_CPPFLAGS="-I$BOOST_ROOT"
+						BOOST_LDFLAGS="-L$BOOST_ROOT/stage/lib"
+					fi
+				fi
+	    		fi
+		fi
 
-if test "$succeeded" != "yes" ; then
-    if test "$_version" = "0" ; then
-        AC_MSG_ERROR([[We could not detect the boost libraries (version $boost_lib_version_req_shorten or higher). If you have a staged boost library (still not installed) please specify \$BOOST_ROOT in your environment and do not give a PATH to --with-boost option.  If you are sure you have boost installed, then check your version number looking in <boost/version.hpp>. See http://randspringer.de/boost for more documentation.]])
-    else
-        AC_MSG_NOTICE([Your boost libraries seems to old (version $_version).])
-    fi
-else
-    AC_SUBST(BOOST_CPPFLAGS)
-    AC_SUBST(BOOST_LDFLAGS)
-    AC_DEFINE(HAVE_BOOST,,[define if the Boost library is available])
+		CPPFLAGS="$CPPFLAGS $BOOST_CPPFLAGS"
+		export CPPFLAGS
+		LDFLAGS="$LDFLAGS $BOOST_LDFLAGS"
+		export LDFLAGS
+
+		AC_LANG_PUSH(C++)
+	     	AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[
+		@%:@include <boost/version.hpp>
+		]], [[
+		#if BOOST_VERSION >= $WANT_BOOST_VERSION
+		// Everything is okay
+		#else
+		#  error Boost version is too old
+		#endif
+		]])],[
+        	AC_MSG_RESULT(yes)
+		succeeded=yes
+		found_system=yes
+       		],[
+	       	])
+		AC_LANG_POP([C++])
+	fi
+
+	if test "$succeeded" != "yes" ; then
+		if test "$_version" = "0" ; then
+			AC_MSG_ERROR([[We could not detect the boost libraries (version $boost_lib_version_req_shorten or higher). If you have a staged boost library (still not installed) please specify \$BOOST_ROOT in your environment and do not give a PATH to --with-boost option.  If you are sure you have boost installed, then check your version number looking in <boost/version.hpp>. See http://randspringer.de/boost for more documentation.]])
+		else
+			AC_MSG_NOTICE([Your boost libraries seems to old (version $_version).])
+		fi
+	else
+		AC_SUBST(BOOST_CPPFLAGS)
+		AC_SUBST(BOOST_LDFLAGS)
+		AC_DEFINE(HAVE_BOOST,,[define if the Boost library is available])
+	fi
+
+        CPPFLAGS="$CPPFLAGS_SAVED"
+       	LDFLAGS="$LDFLAGS_SAVED"
 fi
 
-CPPFLAGS="$CPPFLAGS_SAVED"
-LDFLAGS="$LDFLAGS_SAVED"
-
 ])
 
-dnl @synopsis AX_BOOST_FILESYSTEM
-dnl
-dnl Test for Filesystem library from the Boost C++ libraries. The macro
-dnl requires a preceding call to AX_BOOST_BASE. Further documentation
-dnl is available at <http://randspringer.de/boost/index.html>.
-dnl
-dnl This macro calls:
-dnl
-dnl   AC_SUBST(BOOST_FILESYSTEM_LIB)
-dnl
-dnl And sets:
-dnl
-dnl   HAVE_BOOST_FILESYSTEM
-dnl
-dnl @category InstalledPackages
-dnl @category Cxx
-dnl @author Thomas Porschberg <thomas at randspringer.de>
-dnl @author Michael Tindal <mtindal at paradoxpoint.com>
-dnl @version 2006-06-15
-dnl @license AllPermissive
+##### http://autoconf-archive.cryp.to/ax_boost_filesystem.html
+#
+# SYNOPSIS
+#
+#   AX_BOOST_FILESYSTEM
+#
+# DESCRIPTION
+#
+#   Test for Filesystem library from the Boost C++ libraries. The macro
+#   requires a preceding call to AX_BOOST_BASE. Further documentation
+#   is available at <http://randspringer.de/boost/index.html>.
+#
+#   This macro calls:
+#
+#     AC_SUBST(BOOST_FILESYSTEM_LIB)
+#
+#   And sets:
+#
+#     HAVE_BOOST_FILESYSTEM
+#
+# LAST MODIFICATION
+#
+#   2007-11-22
+#
+# COPYLEFT
+#
+#   Copyright (c) 2007 Thomas Porschberg <thomas at randspringer.de>
+#   Copyright (c) 2007 Michael Tindal
+#
+#   Copying and distribution of this file, with or without
+#   modification, are permitted in any medium without royalty provided
+#   the copyright notice and this notice are preserved.
 
 AC_DEFUN([AX_BOOST_FILESYSTEM],
 [
@@ -205,7 +237,9 @@
                    [use the Filesystem library from boost - it is possible to specify a certain library for the linker
                         e.g. --with-boost-filesystem=boost_filesystem-gcc-mt ]),
         [
-        if test "$withval" = "yes"; then
+        if test "$withval" = "no"; then
+			want_boost="no"
+        elif test "$withval" = "yes"; then
             want_boost="yes"
             ax_boost_user_filesystem_lib=""
         else
@@ -238,24 +272,31 @@
 		])
 		if test "x$ax_cv_boost_filesystem" = "xyes"; then
 			AC_DEFINE(HAVE_BOOST_FILESYSTEM,,[define if the Boost::Filesystem library is available])
-			BN=boost_filesystem
+            BOOSTLIBDIR=`echo $BOOST_LDFLAGS | sed -e 's/@<:@^\/@:>@*//'`
             if test "x$ax_boost_user_filesystem_lib" = "x"; then
-    			for ax_lib in $BN $BN-mt $BN-$CC $BN-$CC-mt $BN-$CC-mt-s $BN-$CC-s \
-                              lib$BN lib$BN-mt lib$BN-$CC lib$BN-$CC-mt lib$BN-$CC-mt-s lib$BN-$CC-s \
-                              $BN-mgw $BN-mgw $BN-mgw-mt $BN-mgw-mt-s $BN-mgw-s ; do
-				    AC_CHECK_LIB($ax_lib, main,
-                                 [BOOST_FILESYSTEM_LIB="-l$ax_lib" AC_SUBST(BOOST_FILESYSTEM_LIB) link_filesystem="yes" break],
+                for libextension in `ls $BOOSTLIBDIR/libboost_filesystem*.{so,a}* 2>/dev/null | sed 's,.*/,,' | sed -e 's;^lib\(boost_filesystem.*\)\.so.*$;\1;' -e 's;^lib\(boost_filesystem.*\)\.a*$;\1;'` ; do
+                     ax_lib=${libextension}
+				    AC_CHECK_LIB($ax_lib, exit,
+                                 [BOOST_FILESYSTEM_LIB="-l$ax_lib"; AC_SUBST(BOOST_FILESYSTEM_LIB) link_filesystem="yes"; break],
                                  [link_filesystem="no"])
   				done
+                if test "x$link_program_options" != "xyes"; then
+                for libextension in `ls $BOOSTLIBDIR/boost_filesystem*.{dll,a}* 2>/dev/null | sed 's,.*/,,' | sed -e 's;^\(boost_filesystem.*\)\.dll.*$;\1;' -e 's;^\(boost_filesystem.*\)\.a*$;\1;'` ; do
+                     ax_lib=${libextension}
+				    AC_CHECK_LIB($ax_lib, exit,
+                                 [BOOST_FILESYSTEM_LIB="-l$ax_lib"; AC_SUBST(BOOST_FILESYSTEM_LIB) link_filesystem="yes"; break],
+                                 [link_filesystem="no"])
+  				done
+	            fi
             else
-               for ax_lib in $ax_boost_user_filesystem_lib $BN-$ax_boost_user_filesystem_lib; do
-				      AC_CHECK_LIB($ax_lib, main,
-                                   [BOOST_FILESYSTEM_LIB="-l$ax_lib" AC_SUBST(BOOST_FILESYSTEM_LIB) link_filesystem="yes" break],
+               for ax_lib in $ax_boost_user_filesystem_lib boost_filesystem-$ax_boost_user_filesystem_lib; do
+				      AC_CHECK_LIB($ax_lib, exit,
+                                   [BOOST_FILESYSTEM_LIB="-l$ax_lib"; AC_SUBST(BOOST_FILESYSTEM_LIB) link_filesystem="yes"; break],
                                    [link_filesystem="no"])
                   done
 
             fi
-			if test "x$link_filesystem" = "xno"; then
+			if test "x$link_filesystem" != "xyes"; then
 				AC_MSG_ERROR(Could not link against $ax_lib !)
 			fi
 		fi
@@ -264,4 +305,3 @@
     	LDFLAGS="$LDFLAGS_SAVED"
 	fi
 ])
-



From chrber at mail.berlios.de  Sun Feb 10 13:17:31 2008
From: chrber at mail.berlios.de (chrber at mail.berlios.de)
Date: Sun, 10 Feb 2008 13:17:31 +0100
Subject: [Dsa-hl-svn] r4060 - in rl/trunk: . engine/ui/src
Message-ID: <200802101217.m1ACHVdW012641@sheep.berlios.de>

Author: chrber
Date: 2008-02-10 13:17:26 +0100 (Sun, 10 Feb 2008)
New Revision: 4060

Modified:
   rl/trunk/configure.in
   rl/trunk/engine/ui/src/InputManager.cpp
Log:
Check for rastullah version of swig (see Wiki for more info)
Activate nograb for mouse and keyboard on linux when in debug mode


Modified: rl/trunk/configure.in
===================================================================
--- rl/trunk/configure.in	2008-02-09 15:00:37 UTC (rev 4059)
+++ rl/trunk/configure.in	2008-02-10 12:17:26 UTC (rev 4060)
@@ -152,7 +152,7 @@
 AC_SUBST(RUBY_LIBS)
 
 #dnl Test for swig version
-SWIG_PROG(1.3.32)
+SWIG_PROG(1.3.31-rl)
 SWIG_ENABLE_CXX
 SWIG_RUBY
 

Modified: rl/trunk/engine/ui/src/InputManager.cpp
===================================================================
--- rl/trunk/engine/ui/src/InputManager.cpp	2008-02-09 15:00:37 UTC (rev 4059)
+++ rl/trunk/engine/ui/src/InputManager.cpp	2008-02-10 12:17:26 UTC (rev 4060)
@@ -105,9 +105,9 @@
         #if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
             pl.insert(std::make_pair(std::string("w32_keyboard"), std::string("DISCL_EXCLUSIVE")));
             pl.insert(std::make_pair(std::string("w32_keyboard"), std::string("DISCL_FOREGROUND")));
-        #elif OGRE_PLATFORM == OGRE_PLATFORM_LINUX
-        //    pl.insert(std::make_pair(std::string("x11_mouse_grab"), std::string("false")));
-        //    pl.insert(std::make_pair(std::string("x11_keyboard_grab"), std::string("false")));
+        #elif OGRE_PLATFORM == OGRE_PLATFORM_LINUX & defined DEBUG
+            pl.insert(std::make_pair(std::string("x11_mouse_grab"), std::string("false")));
+            pl.insert(std::make_pair(std::string("x11_keyboard_grab"), std::string("false")));
         #endif
 
         std::ostringstream windowHndStr;
@@ -260,7 +260,7 @@
         DOMDocument* doc = loadDocument(filename);
         DOMElement* dataDocumentContent = doc->getDocumentElement();
 
-        DOMNodeList* keymaps 
+        DOMNodeList* keymaps
             = dataDocumentContent->getElementsByTagName(AutoXMLCh("Key").data());
         for (unsigned int idx = 0; idx < keymaps->getLength(); idx++)
         {
@@ -517,7 +517,7 @@
     class KeyRepeatJob : public Job
     {
     public:
-        KeyRepeatJob(AbstractWindow* window, OIS::KeyCode key) : 
+        KeyRepeatJob(AbstractWindow* window, OIS::KeyCode key) :
           Job(false, true),
           mWindow(window),
           mKey(key),
@@ -546,7 +546,7 @@
                     }
                     if( CEGUI::System::getSingleton().injectKeyUp(mKey) )
                         handled = true;
-                    
+
                     mLastTime = time;
 
                     if( !handled )  // we don't need a job for keys, that are not handled!



From tanis at mail.berlios.de  Tue Feb 12 19:32:42 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Tue, 12 Feb 2008 19:32:42 +0100
Subject: [Dsa-hl-svn] r4061 - tools/blender_scripts
Message-ID: <200802121832.m1CIWgnM023768@sheep.berlios.de>

Author: tanis
Date: 2008-02-12 19:32:31 +0100 (Tue, 12 Feb 2008)
New Revision: 4061

Modified:
   tools/blender_scripts/rl-exporter.py
Log:
Create tangents by default. Corrected original script author name. (wtf)

Modified: tools/blender_scripts/rl-exporter.py
===================================================================
--- tools/blender_scripts/rl-exporter.py	2008-02-10 12:17:26 UTC (rev 4060)
+++ tools/blender_scripts/rl-exporter.py	2008-02-12 18:32:31 UTC (rev 4061)
@@ -21,8 +21,8 @@
 # url: http://www.team-pantheon.org
 
 # Rastullah exporter written by Julius Schulz
-# based on the OgreXML-Exporter by Michael Rampell and Jens Hoffmann
-# based also on the OgreDotScene-Exporter by Micheal Rampell
+# based on the OgreXML-Exporter by Michael Reimpell and Jens Hoffmann
+# based also on the OgreDotScene-Exporter by Micheal Reimpell
 
 # Copyright (c) 2006 Julius Schulz -- <askan at slashlife.de>
 # Copyright (C) 2004-2005 Michael Reimpell -- <M.Reimpell at tu-bs.de>
@@ -53,7 +53,7 @@
 # OGRE_XML_CONVERTER
 #  the command line used to run the OgreXMLConverter tool.
 #  Set to '' to disable automatical conversion of XML files.
-OGRE_XML_CONVERTER = 'F:\Programme\OgreTools\OgreXMLConverter.exe'
+OGRE_XML_CONVERTER = 'F:\Programme\OgreTools\OgreXMLConverter.exe -t -td tangent'
 
 # OGRE_VERTEXCOLOUR_BGRA
 #  workaround for Ogre's vertex colour conversion bug.



From alassion at mail.berlios.de  Thu Feb 14 22:39:28 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Thu, 14 Feb 2008 22:39:28 +0100
Subject: [Dsa-hl-svn] r4062 - modules/kanalisation/maps
Message-ID: <200802142139.m1ELdSVZ019271@sheep.berlios.de>

Author: alassion
Date: 2008-02-14 22:37:31 +0100 (Thu, 14 Feb 2008)
New Revision: 4062

Added:
   modules/kanalisation/maps/Cube.001.mesh
   modules/kanalisation/maps/Cube.005.mesh
   modules/kanalisation/maps/Cube.012.mesh
   modules/kanalisation/maps/Cube.013.mesh
   modules/kanalisation/maps/Cube.015.mesh
   modules/kanalisation/maps/Cube.016.mesh
   modules/kanalisation/maps/Cube.018.mesh
   modules/kanalisation/maps/Cylinder.mesh
   modules/kanalisation/maps/Plane.011.mesh
   modules/kanalisation/maps/boden_fels.mesh
   modules/kanalisation/maps/saeule_07.001.mesh
   modules/kanalisation/maps/saeule_09.002.mesh
   modules/kanalisation/maps/saeule_09.003.mesh
   modules/kanalisation/maps/saeule_09.004.mesh
   modules/kanalisation/maps/saeule_09.006.mesh
   modules/kanalisation/maps/saeule_09.007.mesh
   modules/kanalisation/maps/saeule_09.008.mesh
   modules/kanalisation/maps/saeule_09.009.mesh
   modules/kanalisation/maps/stuetzbalken.mesh
Modified:
   modules/kanalisation/maps/Cube.002.mesh
   modules/kanalisation/maps/Cube.003.mesh
   modules/kanalisation/maps/Cube.004.mesh
   modules/kanalisation/maps/Cube.006.mesh
   modules/kanalisation/maps/Cube.007.mesh
   modules/kanalisation/maps/Cube.008.mesh
   modules/kanalisation/maps/Cube.009.mesh
   modules/kanalisation/maps/Cube.010.mesh
   modules/kanalisation/maps/Cube.011.mesh
   modules/kanalisation/maps/Cube.014.mesh
   modules/kanalisation/maps/Cube.032.mesh
   modules/kanalisation/maps/Cube.mesh
   modules/kanalisation/maps/Plane.mesh
   modules/kanalisation/maps/boden_kies.mesh
   modules/kanalisation/maps/bruecke.mesh
   modules/kanalisation/maps/dagger_01.mesh
   modules/kanalisation/maps/fackeln.001.mesh
   modules/kanalisation/maps/fackeln.mesh
   modules/kanalisation/maps/farn.mesh
   modules/kanalisation/maps/gaenge.001.mesh
   modules/kanalisation/maps/gaenge.mesh
   modules/kanalisation/maps/gitter.001.mesh
   modules/kanalisation/maps/gitter.002.mesh
   modules/kanalisation/maps/gitter.mesh
   modules/kanalisation/maps/kanalisation.material
   modules/kanalisation/maps/kanalisation.scene
   modules/kanalisation/maps/pilze.001.mesh
   modules/kanalisation/maps/saeule_01.002.mesh
   modules/kanalisation/maps/saeule_01.003.mesh
   modules/kanalisation/maps/saeule_01.mesh
   modules/kanalisation/maps/saeule_02.mesh
   modules/kanalisation/maps/saeule_03.mesh
   modules/kanalisation/maps/saeule_04.mesh
   modules/kanalisation/maps/saeule_05.mesh
   modules/kanalisation/maps/saeule_06.mesh
   modules/kanalisation/maps/saeule_07.mesh
   modules/kanalisation/maps/saeule_08.mesh
   modules/kanalisation/maps/saeule_09.mesh
   modules/kanalisation/maps/saeulen.004.mesh
   modules/kanalisation/maps/schild.mesh
   modules/kanalisation/maps/treppe.mesh
   modules/kanalisation/maps/treppe_01.mesh
   modules/kanalisation/maps/tuern.mesh
   modules/kanalisation/maps/wand.mesh
   modules/kanalisation/maps/wurzeln_alle.mesh
Log:
- new rooms
- need a fix for the torch (causes errors)

Added: modules/kanalisation/maps/Cube.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/Cube.002.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.003.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.004.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/Cube.005.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.005.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/Cube.006.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.007.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.008.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.009.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.010.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.011.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/Cube.012.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.012.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.013.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.013.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/Cube.014.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/Cube.015.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.015.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.016.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.016.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.018.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.018.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/Cube.032.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/Cylinder.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cylinder.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Plane.011.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Plane.011.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/Plane.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/boden_fels.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/boden_fels.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/boden_kies.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/bruecke.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/dagger_01.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/fackeln.001.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/fackeln.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/farn.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/gaenge.001.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/gaenge.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/gitter.001.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/gitter.002.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/gitter.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/kanalisation.material
===================================================================
--- modules/kanalisation/maps/kanalisation.material	2008-02-12 18:32:31 UTC (rev 4061)
+++ modules/kanalisation/maps/kanalisation.material	2008-02-14 21:37:31 UTC (rev 4062)
@@ -1,3 +1,8 @@
+material boden_fels/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap boden_kana.png
+set_texture_alias NormalMap boden_kana_normal.png
+}
 material schild/SOLID/TEX/schild.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap schild.png
@@ -3,13 +8,18 @@
 set_texture_alias NormalMap schild_normal.png
 }
-material boden/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
 {
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material Material.020/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material chairs/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+material smuggler/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap baumstamm_kana.png
-set_texture_alias NormalMap baumstamm_kana_normal.png
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
 }
 material leiste_unten/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
@@ -23,8 +33,13 @@
 set_texture_alias DiffuseMap boden_kana.png
 set_texture_alias NormalMap boden_kana_normal.png
 }
-material wand/SOLID: Basic_Normalmapping_kana
+material smuggler/SOLID/TEX/pflaster_kana.png: Basic_Normalmapping_kana
 {
+set_texture_alias DiffuseMap pflaster_kana.png
+set_texture_alias NormalMap pflaster_kana_normal.png
+}
+material bruecke/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
@@ -33,12 +48,12 @@
 set_texture_alias DiffuseMap boden_kana.png
 set_texture_alias NormalMap boden_kana_normal.png
 }
-material bruecke/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material felswaende/SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
+set_texture_alias DiffuseMap felsen2_kana.png
+set_texture_alias NormalMap felsen2_kana_normal.png
 }
-material Material.020/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material boden/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
@@ -58,16 +73,20 @@
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material SOLID/TEX/pflaster_kana.png: Basic_Normalmapping_kana
+material Material.002/SOLID/TEX/tisch_kana.png
 {
-set_texture_alias DiffuseMap pflaster_kana.png
-set_texture_alias NormalMap pflaster_kana_normal.png
+	technique
+	{
+		pass
+		{
+			specular 0.500000 0.500000 0.500000 12.500000
+			texture_unit
+			{
+				texture tisch_kana.png
+			}
+		}
+	}
 }
-material Material.098/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap boden_kana.png
-set_texture_alias NormalMap boden_kana_normal.png
-}
 material Material.025/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
@@ -78,10 +97,19 @@
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material saeulen/SOLID/TEX/wand_06.png: Basic_Normalmapping_kana
+material Material.001/SOLID/TEX/tisch_kana.png
 {
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
+	technique
+	{
+		pass
+		{
+			specular 0.500000 0.500000 0.500000 12.500000
+			texture_unit
+			{
+				texture tisch_kana.png
+			}
+		}
+	}
 }
 material farn/SOLID/TEX/farn.png
 {
@@ -98,9 +126,9 @@
 		}
 	}
 }
-material pilze/SOLID/TEX/pilz2.png: Basic_Normalmapping_kana
+material pilze/SOLID/TEX/pilz3.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap pilz2.png
+set_texture_alias DiffuseMap pilz.png
 set_texture_alias NormalMap pilz_normal.png
 }
 material wurzeln/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
@@ -108,22 +136,22 @@
 set_texture_alias DiffuseMap baumstamm_kana.png
 set_texture_alias NormalMap baumstamm_kana_normal.png
 }
-material SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+material SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
 {
+set_texture_alias DiffuseMap felsen2_kana.png
+set_texture_alias NormalMap felsen2_kana_normal.png
+}
+material Material.098/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
 set_texture_alias DiffuseMap boden_kana.png
 set_texture_alias NormalMap boden_kana_normal.png
 }
-material bruecke.001/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material stuetzbalken/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material tisch/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
-{
 set_texture_alias DiffuseMap baumstamm_kana.png
 set_texture_alias NormalMap baumstamm_kana_normal.png
 }
-material wand/SOLID/TEX/wand_06.png: Basic_Normalmapping_kana
+material bruecke.001/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
@@ -143,6 +171,20 @@
 set_texture_alias DiffuseMap dagger.png
 set_texture_alias NormalMap dagger_normal.png
 }
+material Material.003/SOLID/TEX/tisch_kana.png
+{
+	technique
+	{
+		pass
+		{
+			specular 0.500000 0.500000 0.500000 12.500000
+			texture_unit
+			{
+				texture tisch_kana.png
+			}
+		}
+	}
+}
 material saeulen/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap saeule_kana.png
@@ -163,30 +205,11 @@
 set_texture_alias DiffuseMap fackel_kana.png
 set_texture_alias NormalMap fackel_kana_normal.png
 }
-material pilze/SOLID/TEX/pilz.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap pilz.png
-set_texture_alias NormalMap pilz_normal.png
-}
 material Material/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap boden_kana.png
 set_texture_alias NormalMap boden_kana_normal.png
 }
-material default
-{
-	technique
-	{
-		pass
-		{
-		}
-	}
-}
-material SOLID/TEX/wand_06.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
 material SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
@@ -202,4 +225,3 @@
 set_texture_alias DiffuseMap kiste_kana.png
 set_texture_alias NormalMap kiste_kana_normal.png
 }
-}

Modified: modules/kanalisation/maps/kanalisation.scene
===================================================================
--- modules/kanalisation/maps/kanalisation.scene	2008-02-12 18:32:31 UTC (rev 4061)
+++ modules/kanalisation/maps/kanalisation.scene	2008-02-14 21:37:31 UTC (rev 4062)
@@ -1,16 +1,16 @@
 <scene formatVersion="0.2.0">
   <nodes>
-    <node name="wand.001">
-      <position x="6.422711" y="2.751102" z="2.040941"/>
+    <node name="saeule_07">
+      <position x="1.174055" y="10.726652" z="6.341633"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="wand.001" meshFile="Cube.003.mesh"/>
+      <entity name="saeule_07" meshFile="saeule_07.mesh"/>
     </node>
-    <node name="bruecke">
-      <position x="2.822959" y="3.865546" z="7.881136"/>
+    <node name="gitter.001">
+      <position x="6.422711" y="2.751102" z="2.031976"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="bruecke" meshFile="bruecke.mesh"/>
+      <entity name="gitter.001" meshFile="Cube.mesh"/>
     </node>
     <node name="wand">
       <position x="-11.712984" y="2.751104" z="38.873230"/>
@@ -18,24 +18,54 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="wand" meshFile="wand.mesh"/>
     </node>
+    <node name="saeule_06">
+      <position x="4.381933" y="4.065433" z="14.409163"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_06" meshFile="saeule_06.mesh"/>
+    </node>
     <node name="dagger_01">
       <position x="9.556169" y="4.026599" z="5.851754"/>
       <rotation qx="-0.000270" qy="0.735596" qz="0.000293" qw="0.677421"/>
       <scale x="0.017321" y="0.017321" z="0.017321"/>
       <entity name="dagger_01" meshFile="dagger_01.mesh"/>
     </node>
-    <node name="Cube.011">
-      <position x="40.332405" y="27.950287" z="14.226555"/>
-      <rotation qx="-0.000398" qy="-0.002580" qz="-0.000001" qw="0.999997"/>
+    <node name="tuern">
+      <position x="12.966056" y="4.342111" z="16.671421"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.011" meshFile="tisch.mesh"/>
+      <entity name="tuern" meshFile="tuern.mesh"/>
     </node>
-    <node name="saeule_04">
+    <node name="saeule_05">
       <position x="7.897333" y="9.400856" z="3.944559"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_04" meshFile="saeule_04.mesh"/>
+      <entity name="saeule_05" meshFile="saeule_05.mesh"/>
     </node>
+    <node name="pilze_gruen">
+      <position x="6.899021" y="-0.008500" z="13.837756"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="pilze_gruen" meshFile="pilze.001.mesh"/>
+    </node>
+    <node name="stuetzbalken">
+      <position x="38.693901" y="9.522685" z="30.678297"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="stuetzbalken" meshFile="stuetzbalken.mesh"/>
+    </node>
+    <node name="Cube.002">
+      <position x="4.733883" y="6.611897" z="56.931644"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="Cube.002" meshFile="Cube.013.mesh"/>
+    </node>
+    <node name="gitter_02.001">
+      <position x="15.776218" y="2.466985" z="58.193405"/>
+      <rotation qx="-0.000393" qy="-0.162435" qz="-0.000065" qw="0.986719"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gitter_02.001" meshFile="gitter.002.mesh"/>
+    </node>
     <node name="saeule_03">
       <position x="9.601151" y="9.400856" z="6.224481"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -48,47 +78,65 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="kisten_smuggler" meshFile="Cube.011.mesh"/>
     </node>
-    <node name="stuehle">
-      <position x="40.159901" y="27.950287" z="14.240085"/>
-      <rotation qx="-0.000398" qy="-0.003937" qz="-0.000002" qw="0.999992"/>
+    <node name="farn">
+      <position x="-2.434886" y="-1.413306" z="2.648438"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="stuehle" meshFile="chairs.mesh"/>
+      <entity name="farn" meshFile="farn.mesh"/>
     </node>
-    <node name="Cube">
-      <position x="1.517232" y="1.741509" z="4.047132"/>
+    <node name="saeule_02">
+      <position x="7.874129" y="9.400857" z="11.051473"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube" meshFile="Cube.004.mesh"/>
+      <entity name="saeule_02" meshFile="saeule_02.mesh"/>
     </node>
-    <node name="saeule_01">
-      <position x="7.874129" y="9.400857" z="16.403053"/>
+    <node name="felsen_hoehle">
+      <position x="30.294416" y="7.783535" z="26.360363"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_01" meshFile="saeule_01.mesh"/>
+      <entity name="felsen_hoehle" meshFile="Plane.011.mesh"/>
     </node>
-    <node name="gitter.001">
-      <position x="6.422711" y="2.751102" z="2.031976"/>
+    <node name="bruecke">
+      <position x="2.822959" y="3.865546" z="7.881136"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gitter.001" meshFile="Cube.mesh"/>
+      <entity name="bruecke" meshFile="bruecke.mesh"/>
     </node>
-    <node name="saeulen.002">
-      <position x="0.743736" y="4.219784" z="8.508488"/>
+    <node name="Cube">
+      <position x="28.036366" y="8.417215" z="36.681553"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeulen.002" meshFile="saeulen.004.mesh"/>
+      <entity name="Cube" meshFile="Cube.006.mesh"/>
     </node>
-    <node name="Plane">
+    <node name="tuer_eingang">
       <position x="1.517232" y="1.741509" z="4.047132"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Plane" meshFile="boden_kies.mesh"/>
+      <entity name="tuer_eingang" meshFile="Cube.004.mesh"/>
     </node>
-    <node name="Cube.001">
+    <node name="tischdecke">
+      <position x="-21.677284" y="2.216421" z="24.734226"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tischdecke" meshFile="Cube.007.mesh"/>
+    </node>
+    <node name="boden_felswand">
+      <position x="37.711838" y="5.930392" z="27.968113"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="boden_felswand" meshFile="boden_fels.mesh"/>
+    </node>
+    <node name="tisch_smuggler">
+      <position x="-21.677284" y="2.216421" z="24.734226"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tisch_smuggler" meshFile="Cube.005.mesh"/>
+    </node>
+    <node name="decke_eingang">
       <position x="1.517232" y="1.741509" z="4.047132"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.001" meshFile="Cube.032.mesh"/>
+      <entity name="decke_eingang" meshFile="Cube.032.mesh"/>
     </node>
     <node name="schild">
       <position x="10.599316" y="3.494219" z="5.872530"/>
@@ -102,83 +150,83 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeulen_smuggler" meshFile="saeule_01.002.mesh"/>
     </node>
-    <node name="gitter">
-      <position x="6.422711" y="2.751102" z="2.031976"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+    <node name="gitter_02">
+      <position x="-4.573676" y="2.466985" z="65.796661"/>
+      <rotation qx="-0.000393" qy="-0.162435" qz="-0.000065" qw="0.986719"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gitter" meshFile="gitter.mesh"/>
+      <entity name="gitter_02" meshFile="gitter.001.mesh"/>
     </node>
-    <node name="saeule_07">
-      <position x="1.174055" y="10.726652" z="6.341633"/>
+    <node name="Cube.001">
+      <position x="48.191696" y="-5.594019" z="27.380192"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_07" meshFile="saeule_07.mesh"/>
+      <entity name="Cube.001" meshFile="Cube.012.mesh"/>
     </node>
-    <node name="saeule_06">
-      <position x="4.381933" y="4.065433" z="14.409163"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+    <node name="gaenge_01">
+      <position x="-11.712984" y="2.751104" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_06" meshFile="saeule_06.mesh"/>
+      <entity name="gaenge_01" meshFile="gaenge.001.mesh"/>
     </node>
-    <node name="saeule_05">
-      <position x="7.897333" y="9.400856" z="3.944559"/>
+    <node name="Cube.003">
+      <position x="4.733883" y="6.611897" z="56.931644"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_05" meshFile="saeule_05.mesh"/>
+      <entity name="Cube.003" meshFile="Cube.015.mesh"/>
     </node>
-    <node name="farn">
-      <position x="-2.434886" y="-1.413306" z="2.648438"/>
+    <node name="brunnen">
+      <position x="140.546295" y="74.190155" z="378.740021"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="farn" meshFile="farn.mesh"/>
+      <entity name="brunnen" meshFile="Cylinder.mesh"/>
     </node>
     <node name="Cube.005">
-      <position x="0.000000" y="-0.000000" z="-0.186319"/>
+      <position x="3.867190" y="0.000001" z="51.820351"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.005" meshFile="Cube.006.mesh"/>
+      <entity name="Cube.005" meshFile="Cube.009.mesh"/>
     </node>
     <node name="Cube.004">
-      <position x="0.000000" y="-0.000000" z="-0.186319"/>
+      <position x="4.733883" y="6.611897" z="56.931644"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.004" meshFile="Cube.002.mesh"/>
+      <entity name="Cube.004" meshFile="Cube.016.mesh"/>
     </node>
-    <node name="Cube.007">
-      <position x="0.279860" y="1.563207" z="7.637593"/>
+    <node name="saeule_01">
+      <position x="7.874129" y="9.400857" z="16.403053"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.007" meshFile="Cube.008.mesh"/>
+      <entity name="saeule_01" meshFile="saeule_01.mesh"/>
     </node>
     <node name="Cube.006">
-      <position x="0.000000" y="-0.000000" z="-0.186319"/>
+      <position x="0.000000" y="0.000003" z="64.748039"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.006" meshFile="Cube.007.mesh"/>
+      <entity name="Cube.006" meshFile="Cube.018.mesh"/>
     </node>
-    <node name="Cube.009">
-      <position x="4.292805" y="-9.415191" z="25.157330"/>
+    <node name="saeulen.002">
+      <position x="0.743736" y="4.219784" z="8.508488"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.009" meshFile="Cube.010.mesh"/>
+      <entity name="saeulen.002" meshFile="saeulen.004.mesh"/>
     </node>
-    <node name="Cube.008">
-      <position x="40.332405" y="27.950287" z="14.226555"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+    <node name="saeule_07.001">
+      <position x="9.632251" y="8.709822" z="55.400223"/>
+      <rotation qx="-0.000394" qy="0.144349" qz="0.000057" qw="0.989527"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.008" meshFile="Cube.014.mesh"/>
+      <entity name="saeule_07.001" meshFile="saeule_07.001.mesh"/>
     </node>
-    <node name="brunnen">
-      <position x="33.782089" y="21.406301" z="27.269056"/>
+    <node name="randsteine_03">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="brunnen" meshFile="gitter.001.mesh"/>
+      <entity name="randsteine_03" meshFile="Cube.001.mesh"/>
     </node>
-    <node name="zierleiste_smuggler">
-      <position x="0.000000" y="0.000000" z="0.000000"/>
+    <node name="saeule_09">
+      <position x="-1.452938" y="9.400857" z="16.482481"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="zierleiste_smuggler" meshFile="Cube.009.mesh"/>
+      <entity name="saeule_09" meshFile="saeule_09.mesh"/>
     </node>
     <node name="saeule_08">
       <position x="-1.495595" y="9.400857" z="12.471745"/>
@@ -186,59 +234,107 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_08" meshFile="saeule_08.mesh"/>
     </node>
-    <node name="saeule_10">
-      <position x="14.990063" y="9.400858" z="12.870321"/>
+    <node name="randsteine_03.001">
+      <position x="0.279860" y="1.563207" z="7.637593"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_10" meshFile="saeule_01.003.mesh"/>
+      <entity name="randsteine_03.001" meshFile="Cube.008.mesh"/>
     </node>
-    <node name="tuern">
-      <position x="12.966056" y="4.342111" z="16.671421"/>
+    <node name="fackeln">
+      <position x="15.234941" y="3.107023" z="15.800744"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="tuern" meshFile="tuern.mesh"/>
+      <entity name="fackeln" meshFile="fackeln.mesh"/>
     </node>
-    <node name="brunnen.001">
-      <position x="-3.413540" y="21.406301" z="35.708401"/>
+    <node name="randsteine_02">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="brunnen.001" meshFile="gitter.002.mesh"/>
+      <entity name="randsteine_02" meshFile="Cube.002.mesh"/>
     </node>
-    <node name="saeule_09">
-      <position x="-1.452938" y="9.400857" z="16.482481"/>
+    <node name="smuggler_boden">
+      <position x="-21.569408" y="4.746182" z="26.013494"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_09" meshFile="saeule_09.mesh"/>
+      <entity name="smuggler_boden" meshFile="Cube.010.mesh"/>
     </node>
-    <node name="pilze_gruen">
-      <position x="6.899021" y="-0.008500" z="13.837756"/>
+    <node name="wand.001">
+      <position x="6.422711" y="2.751102" z="2.040941"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="pilze_gruen" meshFile="pilze.001.mesh"/>
+      <entity name="wand.001" meshFile="Cube.003.mesh"/>
     </node>
-    <node name="gaenge.002">
-      <position x="-11.712984" y="2.751104" z="38.873230"/>
-      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
+    <node name="saeule_04">
+      <position x="7.897333" y="9.400856" z="3.944559"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gaenge.002" meshFile="gaenge.002.mesh"/>
+      <entity name="saeule_04" meshFile="saeule_04.mesh"/>
     </node>
-    <node name="fackeln">
-      <position x="15.234941" y="3.107023" z="15.800744"/>
+    <node name="saeule_09.004">
+      <position x="-0.203952" y="8.280134" z="64.884682"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="fackeln" meshFile="fackeln.mesh"/>
+      <entity name="saeule_09.004" meshFile="saeule_09.006.mesh"/>
     </node>
+    <node name="saeule_09.005">
+      <position x="6.353224" y="8.280134" z="64.924850"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_09.005" meshFile="saeule_09.007.mesh"/>
+    </node>
+    <node name="saeule_09.006">
+      <position x="10.100182" y="8.280134" z="64.794533"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_09.006" meshFile="saeule_09.008.mesh"/>
+    </node>
+    <node name="saeule_09.007">
+      <position x="2.816734" y="8.280134" z="64.794533"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_09.007" meshFile="saeule_09.009.mesh"/>
+    </node>
+    <node name="saeule_09.001">
+      <position x="-0.203952" y="8.280133" z="50.980743"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_09.001" meshFile="saeule_09.002.mesh"/>
+    </node>
+    <node name="saeule_09.002">
+      <position x="6.353224" y="8.280133" z="50.980743"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_09.002" meshFile="saeule_09.003.mesh"/>
+    </node>
+    <node name="saeule_09.003">
+      <position x="10.100182" y="8.280133" z="50.980743"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_09.003" meshFile="saeule_09.004.mesh"/>
+    </node>
+    <node name="boden_kana">
+      <position x="1.517232" y="1.741509" z="4.047132"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="boden_kana" meshFile="boden_kies.mesh"/>
+    </node>
+    <node name="gaenge_01.001">
+      <position x="-11.351809" y="2.751104" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gaenge_01.001" meshFile="gaenge.mesh"/>
+    </node>
     <node name="treppe.001">
       <position x="19.946918" y="4.835266" z="9.672138"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="treppe.001" meshFile="treppe_01.mesh"/>
     </node>
-    <node name="pilze_rot">
-      <position x="6.899021" y="-0.008500" z="13.837756"/>
+    <node name="gitter">
+      <position x="6.422711" y="2.751102" z="2.031976"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="pilze_rot" meshFile="pilze.mesh"/>
+      <entity name="gitter" meshFile="gitter.mesh"/>
     </node>
     <node name="wurzeln">
       <position x="3.815631" y="3.215424" z="3.961683"/>
@@ -252,17 +348,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="treppe" meshFile="treppe.mesh"/>
     </node>
-    <node name="gaenge.001">
-      <position x="-11.712984" y="2.751104" z="38.873230"/>
-      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
-      <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gaenge.001" meshFile="gaenge.001.mesh"/>
-    </node>
-    <node name="saeule_02">
-      <position x="7.874129" y="9.400857" z="11.051473"/>
+    <node name="saeule_10">
+      <position x="14.990063" y="9.400858" z="12.870321"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_02" meshFile="saeule_02.mesh"/>
+      <entity name="saeule_10" meshFile="saeule_01.003.mesh"/>
     </node>
     <node name="erdboden">
       <position x="0.000000" y="0.000000" z="0.000000"/>
@@ -270,6 +360,12 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="erdboden" meshFile="Plane.mesh"/>
     </node>
+    <node name="smuggler_wand">
+      <position x="-21.569408" y="4.746182" z="26.013494"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="smuggler_wand" meshFile="Cube.014.mesh"/>
+    </node>
     <node name="fackeln_g2">
       <position x="15.234941" y="3.107023" z="15.800744"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>

Modified: modules/kanalisation/maps/pilze.001.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_01.002.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_01.003.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_01.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_02.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_03.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_04.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_05.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_06.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/saeule_07.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_07.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/saeule_07.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_08.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/saeule_09.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_09.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_09.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_09.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_09.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_09.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_09.006.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_09.006.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_09.007.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_09.007.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_09.008.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_09.008.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_09.009.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_09.009.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/saeule_09.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeulen.004.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/schild.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/stuetzbalken.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/stuetzbalken.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/treppe.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/treppe_01.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/tuern.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/wand.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/wurzeln_alle.mesh
===================================================================
(Binary files differ)



From alassion at mail.berlios.de  Thu Feb 14 22:45:25 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Thu, 14 Feb 2008 22:45:25 +0100
Subject: [Dsa-hl-svn] r4063 - modules/common/scripts
Message-ID: <200802142145.m1ELjPi8019745@sheep.berlios.de>

Author: alassion
Date: 2008-02-14 22:45:19 +0100 (Thu, 14 Feb 2008)
New Revision: 4063

Modified:
   modules/common/scripts/torch.rb
Log:
- fixed light values (which caused error)

Modified: modules/common/scripts/torch.rb
===================================================================
--- modules/common/scripts/torch.rb	2008-02-14 21:37:31 UTC (rev 4062)
+++ modules/common/scripts/torch.rb	2008-02-14 21:45:19 UTC (rev 4063)
@@ -80,7 +80,7 @@
     def initialize(id)
         super(id)
 		addActions()
-		@_prop_color = [1, 1, 0.5, 1];
+		@_prop_color = [0.8, 0.7, 0.5, 1];
     end
     
     def setLit(lit)



From alassion at mail.berlios.de  Thu Feb 14 23:13:35 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Thu, 14 Feb 2008 23:13:35 +0100
Subject: [Dsa-hl-svn] r4064 - modules/kanalisation/scripts/maps
Message-ID: <200802142213.m1EMDZB1022025@sheep.berlios.de>

Author: alassion
Date: 2008-02-14 23:13:34 +0100 (Thu, 14 Feb 2008)
New Revision: 4064

Modified:
   modules/kanalisation/scripts/maps/kanalisation.rb
Log:
- added backlight

Modified: modules/kanalisation/scripts/maps/kanalisation.rb
===================================================================
--- modules/kanalisation/scripts/maps/kanalisation.rb	2008-02-14 21:45:19 UTC (rev 4063)
+++ modules/kanalisation/scripts/maps/kanalisation.rb	2008-02-14 22:13:34 UTC (rev 4064)
@@ -28,10 +28,10 @@
 $SCRIPT.log("Tageslicht erstellt.");
 
 
-#backlight = $AM.createLightActor("backlight", LightObject::LT_DIRECTIONAL);
-#backlight.getControlledObject().setDirection(0.17101, 0.873647, -0.969846);
-#backlight.getControlledObject().setCastShadows(false);
-#backlight.getControlledObject().setDiffuseColour(-0.3,-0.3,-0.3);
+backlight = $AM.createLightActor("backlight", LightObject::LT_DIRECTIONAL);
+backlight.getControlledObject().setDirection(0.17101, 0.873647, -0.969846);
+backlight.getControlledObject().setCastShadows(false);
+backlight.getControlledObject().setDiffuseColour(-0.3,-0.3,-0.3);
 
 
 
@@ -66,13 +66,13 @@
 #$SCRIPT.log("Held in die Szene einfuegen.");#-22.0130577087402, -6.70670890808105, 25.1438484191895
 #$hero.getActor().placeIntoScene([0.0, 20.0, 0.0]);
 
-$SCRIPT.log("Fackellicht erstellen..");
-fackellicht = $AM.createLightActor("Das Licht der Fackel", LightObject::LT_POINT );
-fackellicht.getControlledObject().setCastShadows(false);
-fackellicht.getControlledObject().setDiffuseColour(0.8,0.7,0.6);
-fackellicht.getControlledObject().setAttenuation(5.0, 0.79,  -0.21, 0.268 );
-$hero.getActor().attachToSlot( fackellicht, "Bip01 R SlotHand" );
-$SCRIPT.log("Fackellicht erstellt.");
+#$SCRIPT.log("Fackellicht erstellen..");
+#fackellicht = $AM.createLightActor("Das Licht der Fackel", LightObject::LT_POINT );
+#fackellicht.getControlledObject().setCastShadows(false);
+#fackellicht.getControlledObject().setDiffuseColour(0.4,0.3,0.2);
+#fackellicht.getControlledObject().setAttenuation(2.0, 0.79,  -0.21, 0.268 );
+#$hero.getActor().attachToSlot( fackellicht, "Bip01 R SlotHand" );
+#$SCRIPT.log("Fackellicht erstellt.");
 
 
 $SCRIPT.log("T?ren einsetzen");



From alassion at mail.berlios.de  Fri Feb 15 13:49:27 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Fri, 15 Feb 2008 13:49:27 +0100
Subject: [Dsa-hl-svn] r4065 - modules/kanalisation/maps
Message-ID: <200802151249.m1FCnRI2032002@sheep.berlios.de>

Author: alassion
Date: 2008-02-15 13:49:03 +0100 (Fri, 15 Feb 2008)
New Revision: 4065

Modified:
   modules/kanalisation/maps/Cube.009.mesh
   modules/kanalisation/maps/Cube.015.mesh
   modules/kanalisation/maps/Cube.016.mesh
   modules/kanalisation/maps/Plane.011.mesh
   modules/kanalisation/maps/boden_kies.mesh
   modules/kanalisation/maps/bruecke.mesh
   modules/kanalisation/maps/farn.mesh
   modules/kanalisation/maps/gaenge.001.mesh
   modules/kanalisation/maps/kanalisation.scene
   modules/kanalisation/maps/treppe.mesh
   modules/kanalisation/maps/wurzeln_alle.mesh
Log:


Modified: modules/kanalisation/maps/Cube.009.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.015.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.016.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Plane.011.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/boden_kies.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/bruecke.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/farn.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/gaenge.001.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/kanalisation.scene
===================================================================
--- modules/kanalisation/maps/kanalisation.scene	2008-02-14 22:13:34 UTC (rev 4064)
+++ modules/kanalisation/maps/kanalisation.scene	2008-02-15 12:49:03 UTC (rev 4065)
@@ -36,11 +36,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="tuern" meshFile="tuern.mesh"/>
     </node>
-    <node name="saeule_05">
-      <position x="7.897333" y="9.400856" z="3.944559"/>
+    <node name="bruecke">
+      <position x="2.822959" y="3.865546" z="7.881136"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_05" meshFile="saeule_05.mesh"/>
+      <entity name="bruecke" meshFile="bruecke.mesh"/>
     </node>
     <node name="pilze_gruen">
       <position x="6.899021" y="-0.008500" z="13.837756"/>
@@ -72,6 +72,12 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_03" meshFile="saeule_03.mesh"/>
     </node>
+    <node name="randsteine_02">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_02" meshFile="Cube.002.mesh"/>
+    </node>
     <node name="kisten_smuggler">
       <position x="4.292805" y="-9.415191" z="25.157330"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -84,24 +90,12 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="farn" meshFile="farn.mesh"/>
     </node>
-    <node name="saeule_02">
-      <position x="7.874129" y="9.400857" z="11.051473"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
-      <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_02" meshFile="saeule_02.mesh"/>
-    </node>
     <node name="felsen_hoehle">
       <position x="30.294416" y="7.783535" z="26.360363"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="felsen_hoehle" meshFile="Plane.011.mesh"/>
     </node>
-    <node name="bruecke">
-      <position x="2.822959" y="3.865546" z="7.881136"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
-      <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="bruecke" meshFile="bruecke.mesh"/>
-    </node>
     <node name="Cube">
       <position x="28.036366" y="8.417215" z="36.681553"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -168,11 +162,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="gaenge_01" meshFile="gaenge.001.mesh"/>
     </node>
-    <node name="Cube.003">
-      <position x="4.733883" y="6.611897" z="56.931644"/>
+    <node name="saeule_05">
+      <position x="7.897333" y="9.400856" z="3.944559"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.003" meshFile="Cube.015.mesh"/>
+      <entity name="saeule_05" meshFile="saeule_05.mesh"/>
     </node>
     <node name="brunnen">
       <position x="140.546295" y="74.190155" z="378.740021"/>
@@ -181,16 +175,16 @@
       <entity name="brunnen" meshFile="Cylinder.mesh"/>
     </node>
     <node name="Cube.005">
-      <position x="3.867190" y="0.000001" z="51.820351"/>
+      <position x="3.867190" y="0.000002" z="51.820351"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="Cube.005" meshFile="Cube.009.mesh"/>
     </node>
-    <node name="Cube.004">
-      <position x="4.733883" y="6.611897" z="56.931644"/>
+    <node name="saeule_02">
+      <position x="7.874129" y="9.400857" z="11.051473"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.004" meshFile="Cube.016.mesh"/>
+      <entity name="saeule_02" meshFile="saeule_02.mesh"/>
     </node>
     <node name="saeule_01">
       <position x="7.874129" y="9.400857" z="16.403053"/>
@@ -216,11 +210,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_07.001" meshFile="saeule_07.001.mesh"/>
     </node>
-    <node name="randsteine_03">
-      <position x="-2.300682" y="0.000000" z="0.000000"/>
+    <node name="raum_02">
+      <position x="4.733883" y="6.611897" z="56.931644"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="randsteine_03" meshFile="Cube.001.mesh"/>
+      <entity name="raum_02" meshFile="Cube.015.mesh"/>
     </node>
     <node name="saeule_09">
       <position x="-1.452938" y="9.400857" z="16.482481"/>
@@ -246,11 +240,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="fackeln" meshFile="fackeln.mesh"/>
     </node>
-    <node name="randsteine_02">
-      <position x="-2.300682" y="0.000000" z="0.000000"/>
+    <node name="boden">
+      <position x="4.733883" y="6.611897" z="56.931644"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="randsteine_02" meshFile="Cube.002.mesh"/>
+      <entity name="boden" meshFile="Cube.016.mesh"/>
     </node>
     <node name="smuggler_boden">
       <position x="-21.569408" y="4.746182" z="26.013494"/>
@@ -366,6 +360,12 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="smuggler_wand" meshFile="Cube.014.mesh"/>
     </node>
+    <node name="randsteine_03">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_03" meshFile="Cube.001.mesh"/>
+    </node>
     <node name="fackeln_g2">
       <position x="15.234941" y="3.107023" z="15.800744"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>

Modified: modules/kanalisation/maps/treppe.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/wurzeln_alle.mesh
===================================================================
(Binary files differ)



From alassion at mail.berlios.de  Sat Feb 16 13:54:40 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Sat, 16 Feb 2008 13:54:40 +0100
Subject: [Dsa-hl-svn] r4066 - in modules/kanalisation: maps
	materials/textures
Message-ID: <200802161254.m1GCseWY032255@sheep.berlios.de>

Author: alassion
Date: 2008-02-16 13:54:14 +0100 (Sat, 16 Feb 2008)
New Revision: 4066

Added:
   modules/kanalisation/maps/fackeln.002.mesh
   modules/kanalisation/maps/fackeln.003.mesh
   modules/kanalisation/maps/fackeln.004.mesh
   modules/kanalisation/maps/fence.mesh
   modules/kanalisation/maps/randsteine_01.mesh
   modules/kanalisation/maps/randsteine_02.mesh
   modules/kanalisation/maps/randsteine_03.mesh
   modules/kanalisation/maps/randsteine_04.mesh
   modules/kanalisation/maps/stuetzbalken.001.mesh
   modules/kanalisation/materials/textures/Thumbs.db
   modules/kanalisation/materials/textures/fence_kana.png
Modified:
   modules/kanalisation/maps/Cube.009.mesh
   modules/kanalisation/maps/Cube.016.mesh
   modules/kanalisation/maps/gitter.002.mesh
   modules/kanalisation/maps/kanalisation.material
   modules/kanalisation/maps/kanalisation.scene
Log:
- added curbs
- removed smoothgroups from rocks

Modified: modules/kanalisation/maps/Cube.009.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.016.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/fackeln.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fackeln.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/fackeln.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fackeln.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/fackeln.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fackeln.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/fence.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fence.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/gitter.002.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/kanalisation.material
===================================================================
--- modules/kanalisation/maps/kanalisation.material	2008-02-15 12:49:03 UTC (rev 4065)
+++ modules/kanalisation/maps/kanalisation.material	2008-02-16 12:54:14 UTC (rev 4066)
@@ -126,6 +126,21 @@
 		}
 	}
 }
+material fence/SOLID/TEX/fence_kana.png
+{
+	technique
+	{
+		pass
+		{
+			alpha_rejection greater 215 
+
+			texture_unit
+			{
+				texture fence_kana.png  // Mit Alphakanal
+			}
+		}
+	}
+}
 material pilze/SOLID/TEX/pilz3.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap pilz.png
@@ -225,3 +240,24 @@
 set_texture_alias DiffuseMap kiste_kana.png
 set_texture_alias NormalMap kiste_kana_normal.png
 }
+material randsteine_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material randsteine_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material randsteine_03/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material randsteine_04/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+

Modified: modules/kanalisation/maps/kanalisation.scene
===================================================================
--- modules/kanalisation/maps/kanalisation.scene	2008-02-15 12:49:03 UTC (rev 4065)
+++ modules/kanalisation/maps/kanalisation.scene	2008-02-16 12:54:14 UTC (rev 4066)
@@ -6,18 +6,24 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_07" meshFile="saeule_07.mesh"/>
     </node>
-    <node name="gitter.001">
-      <position x="6.422711" y="2.751102" z="2.031976"/>
+    <node name="brunnen">
+      <position x="140.546295" y="74.190155" z="378.740021"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gitter.001" meshFile="Cube.mesh"/>
+      <entity name="brunnen" meshFile="Cylinder.mesh"/>
     </node>
-    <node name="wand">
-      <position x="-11.712984" y="2.751104" z="38.873230"/>
-      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
+    <node name="saeule_01">
+      <position x="7.874129" y="9.400857" z="16.403053"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="wand" meshFile="wand.mesh"/>
+      <entity name="saeule_01" meshFile="saeule_01.mesh"/>
     </node>
+    <node name="fence">
+      <position x="140.546295" y="74.190155" z="378.740021"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="fence" meshFile="fence.mesh"/>
+    </node>
     <node name="saeule_06">
       <position x="4.381933" y="4.065433" z="14.409163"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -54,12 +60,18 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="stuetzbalken" meshFile="stuetzbalken.mesh"/>
     </node>
-    <node name="Cube.002">
-      <position x="4.733883" y="6.611897" z="56.931644"/>
+    <node name="saeule_04">
+      <position x="7.897333" y="9.400856" z="3.944559"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.002" meshFile="Cube.013.mesh"/>
+      <entity name="saeule_04" meshFile="saeule_04.mesh"/>
     </node>
+    <node name="gitter.001">
+      <position x="6.422711" y="2.751102" z="2.031976"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gitter.001" meshFile="Cube.mesh"/>
+    </node>
     <node name="gitter_02.001">
       <position x="15.776218" y="2.466985" z="58.193405"/>
       <rotation qx="-0.000393" qy="-0.162435" qz="-0.000065" qw="0.986719"/>
@@ -76,7 +88,7 @@
       <position x="-2.300682" y="0.000000" z="0.000000"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="randsteine_02" meshFile="Cube.002.mesh"/>
+      <entity name="randsteine_02" meshFile="randsteine_02.mesh"/>
     </node>
     <node name="kisten_smuggler">
       <position x="4.292805" y="-9.415191" z="25.157330"/>
@@ -96,6 +108,12 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="felsen_hoehle" meshFile="Plane.011.mesh"/>
     </node>
+    <node name="moderholz">
+      <position x="37.592186" y="5.749560" z="32.072422"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="moderholz" meshFile="stuetzbalken.001.mesh"/>
+    </node>
     <node name="Cube">
       <position x="28.036366" y="8.417215" z="36.681553"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -132,12 +150,36 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="decke_eingang" meshFile="Cube.032.mesh"/>
     </node>
+    <node name="gaenge_01">
+      <position x="-11.712984" y="2.751104" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gaenge_01" meshFile="gaenge.001.mesh"/>
+    </node>
     <node name="schild">
       <position x="10.599316" y="3.494219" z="5.872530"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="schild" meshFile="schild.mesh"/>
     </node>
+    <node name="fackeln_g2.001">
+      <position x="2.625504" y="3.107027" z="55.503487"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="fackeln_g2.001" meshFile="fackeln.002.mesh"/>
+    </node>
+    <node name="fackeln_g2.002">
+      <position x="2.625504" y="3.107027" z="59.728394"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="fackeln_g2.002" meshFile="fackeln.003.mesh"/>
+    </node>
+    <node name="fackeln_g2.003">
+      <position x="39.974949" y="5.598745" z="29.590656"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="fackeln_g2.003" meshFile="fackeln.004.mesh"/>
+    </node>
     <node name="saeulen_smuggler">
       <position x="-27.566433" y="7.446745" z="22.737108"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -156,11 +198,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="Cube.001" meshFile="Cube.012.mesh"/>
     </node>
-    <node name="gaenge_01">
-      <position x="-11.712984" y="2.751104" z="38.873230"/>
-      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
+    <node name="saeule_09.004">
+      <position x="-0.203952" y="8.280134" z="64.884682"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gaenge_01" meshFile="gaenge.001.mesh"/>
+      <entity name="saeule_09.004" meshFile="saeule_09.006.mesh"/>
     </node>
     <node name="saeule_05">
       <position x="7.897333" y="9.400856" z="3.944559"/>
@@ -168,11 +210,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_05" meshFile="saeule_05.mesh"/>
     </node>
-    <node name="brunnen">
-      <position x="140.546295" y="74.190155" z="378.740021"/>
+    <node name="Cube.002">
+      <position x="4.733883" y="6.611897" z="56.931644"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="brunnen" meshFile="Cylinder.mesh"/>
+      <entity name="Cube.002" meshFile="Cube.013.mesh"/>
     </node>
     <node name="Cube.005">
       <position x="3.867190" y="0.000002" z="51.820351"/>
@@ -186,11 +228,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_02" meshFile="saeule_02.mesh"/>
     </node>
-    <node name="saeule_01">
-      <position x="7.874129" y="9.400857" z="16.403053"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+    <node name="wand">
+      <position x="-11.712984" y="2.751104" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_01" meshFile="saeule_01.mesh"/>
+      <entity name="wand" meshFile="wand.mesh"/>
     </node>
     <node name="Cube.006">
       <position x="0.000000" y="0.000003" z="64.748039"/>
@@ -210,11 +252,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_07.001" meshFile="saeule_07.001.mesh"/>
     </node>
-    <node name="raum_02">
-      <position x="4.733883" y="6.611897" z="56.931644"/>
+    <node name="saeule_09.006">
+      <position x="10.100182" y="8.280134" z="64.794533"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="raum_02" meshFile="Cube.015.mesh"/>
+      <entity name="saeule_09.006" meshFile="saeule_09.008.mesh"/>
     </node>
     <node name="saeule_09">
       <position x="-1.452938" y="9.400857" z="16.482481"/>
@@ -222,11 +264,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_09" meshFile="saeule_09.mesh"/>
     </node>
-    <node name="saeule_08">
-      <position x="-1.495595" y="9.400857" z="12.471745"/>
+    <node name="raum_02">
+      <position x="4.733883" y="6.611897" z="56.931644"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_08" meshFile="saeule_08.mesh"/>
+      <entity name="raum_02" meshFile="Cube.015.mesh"/>
     </node>
     <node name="randsteine_03.001">
       <position x="0.279860" y="1.563207" z="7.637593"/>
@@ -252,23 +294,29 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="smuggler_boden" meshFile="Cube.010.mesh"/>
     </node>
+    <node name="saeule_08">
+      <position x="-1.495595" y="9.400857" z="12.471745"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_08" meshFile="saeule_08.mesh"/>
+    </node>
     <node name="wand.001">
       <position x="6.422711" y="2.751102" z="2.040941"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="wand.001" meshFile="Cube.003.mesh"/>
     </node>
-    <node name="saeule_04">
-      <position x="7.897333" y="9.400856" z="3.944559"/>
+    <node name="saeule_09.001">
+      <position x="-0.203952" y="8.280133" z="50.980743"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_04" meshFile="saeule_04.mesh"/>
+      <entity name="saeule_09.001" meshFile="saeule_09.002.mesh"/>
     </node>
-    <node name="saeule_09.004">
-      <position x="-0.203952" y="8.280134" z="64.884682"/>
+    <node name="randsteine_01">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_09.004" meshFile="saeule_09.006.mesh"/>
+      <entity name="randsteine_01" meshFile="randsteine_01.mesh"/>
     </node>
     <node name="saeule_09.005">
       <position x="6.353224" y="8.280134" z="64.924850"/>
@@ -276,11 +324,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_09.005" meshFile="saeule_09.007.mesh"/>
     </node>
-    <node name="saeule_09.006">
-      <position x="10.100182" y="8.280134" z="64.794533"/>
+    <node name="randsteine_03">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_09.006" meshFile="saeule_09.008.mesh"/>
+      <entity name="randsteine_03" meshFile="randsteine_03.mesh"/>
     </node>
     <node name="saeule_09.007">
       <position x="2.816734" y="8.280134" z="64.794533"/>
@@ -288,11 +336,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_09.007" meshFile="saeule_09.009.mesh"/>
     </node>
-    <node name="saeule_09.001">
-      <position x="-0.203952" y="8.280133" z="50.980743"/>
+    <node name="randsteine_04">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_09.001" meshFile="saeule_09.002.mesh"/>
+      <entity name="randsteine_04" meshFile="randsteine_04.mesh"/>
     </node>
     <node name="saeule_09.002">
       <position x="6.353224" y="8.280133" z="50.980743"/>
@@ -360,12 +408,6 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="smuggler_wand" meshFile="Cube.014.mesh"/>
     </node>
-    <node name="randsteine_03">
-      <position x="-2.300682" y="0.000000" z="0.000000"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
-      <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="randsteine_03" meshFile="Cube.001.mesh"/>
-    </node>
     <node name="fackeln_g2">
       <position x="15.234941" y="3.107023" z="15.800744"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>

Added: modules/kanalisation/maps/randsteine_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_03.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_03.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_04.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_04.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/stuetzbalken.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/stuetzbalken.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/Thumbs.db
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/Thumbs.db
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/fence_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/fence_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From alassion at mail.berlios.de  Sat Feb 16 14:04:01 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Sat, 16 Feb 2008 14:04:01 +0100
Subject: [Dsa-hl-svn] r4067 - in modules/kanalisation: maps
	materials/textures
Message-ID: <200802161304.m1GD41R9000215@sheep.berlios.de>

Author: alassion
Date: 2008-02-16 14:03:41 +0100 (Sat, 16 Feb 2008)
New Revision: 4067

Added:
   modules/kanalisation/materials/textures/pilz3.png
   modules/kanalisation/materials/textures/tisch_kana.png
Modified:
   modules/kanalisation/maps/kanalisation.material
   modules/kanalisation/materials/textures/Thumbs.db
Log:
- fixed texture errors

Modified: modules/kanalisation/maps/kanalisation.material
===================================================================
--- modules/kanalisation/maps/kanalisation.material	2008-02-16 12:54:14 UTC (rev 4066)
+++ modules/kanalisation/maps/kanalisation.material	2008-02-16 13:03:41 UTC (rev 4067)
@@ -112,20 +112,27 @@
 	}
 }
 material farn/SOLID/TEX/farn.png
-{
-	technique
-	{
-		pass
-		{
-			alpha_rejection greater 215 
+{ 
+   technique 
+   { 
+      pass 
+      { 
+      ambient 0.609804 0.609804 0.609804 1
+			diffuse 0.631373 0.631373 0.631373 1
+			specular 0 0 0 1 10
+                         // Rendert beidseitig 
+         cull_hardware none 
+         cull_software none 
+	 alpha_rejection greater 215 
 
-			texture_unit
-			{
-				texture farn.png  // Mit Alphakanal
-			}
-		}
-	}
-}
+         texture_unit 
+         { 
+            texture farn.png             
+	    filtering linear linear linear 
+         } 
+      } 
+   } 
+} 
 material fence/SOLID/TEX/fence_kana.png
 {
 	technique
@@ -143,7 +150,7 @@
 }
 material pilze/SOLID/TEX/pilz3.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap pilz.png
+set_texture_alias DiffuseMap pilz3.png
 set_texture_alias NormalMap pilz_normal.png
 }
 material wurzeln/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana

Modified: modules/kanalisation/materials/textures/Thumbs.db
===================================================================
(Binary files differ)

Added: modules/kanalisation/materials/textures/pilz3.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/pilz3.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/tisch_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/tisch_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From alassion at mail.berlios.de  Sat Feb 16 19:20:34 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Sat, 16 Feb 2008 19:20:34 +0100
Subject: [Dsa-hl-svn] r4068 - in modules/kanalisation: maps scripts
	scripts/maps
Message-ID: <200802161820.m1GIKYrY022719@sheep.berlios.de>

Author: alassion
Date: 2008-02-16 19:20:31 +0100 (Sat, 16 Feb 2008)
New Revision: 4068

Modified:
   modules/kanalisation/maps/kana_lights.rlmap.xml
   modules/kanalisation/maps/kanalisation.material
   modules/kanalisation/scripts/maps/kanalisation.rb
   modules/kanalisation/scripts/particle.rb
Log:
- added torches + light

Modified: modules/kanalisation/maps/kana_lights.rlmap.xml
===================================================================
--- modules/kanalisation/maps/kana_lights.rlmap.xml	2008-02-16 13:03:41 UTC (rev 4067)
+++ modules/kanalisation/maps/kana_lights.rlmap.xml	2008-02-16 18:20:31 UTC (rev 4068)
@@ -22,6 +22,13 @@
 			<colourSpecular r="0.8" g="0.7" b="0.5" />
 			<lightAttenuation range="5" constant="0.79" linear="-0.21" quadratic="0.268" />
 		</light>
+		<light name="fackkellicht4" type="point" visible="true"
+			castShadows="false">
+			<position x="36.49" y="7.37" z="30.27" />
+			<colourDiffuse r="0.8" g="0.7" b="0.5" />
+			<colourSpecular r="0.8" g="0.7" b="0.5" />
+			<lightAttenuation range="5" constant="0.79" linear="-0.21" quadratic="0.268" />
+		</light>
 	</nodes>
 	<zones>
 		<zone name="default">

Modified: modules/kanalisation/maps/kanalisation.material
===================================================================
--- modules/kanalisation/maps/kanalisation.material	2008-02-16 13:03:41 UTC (rev 4067)
+++ modules/kanalisation/maps/kanalisation.material	2008-02-16 18:20:31 UTC (rev 4068)
@@ -50,8 +50,8 @@
 }
 material felswaende/SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap felsen2_kana.png
-set_texture_alias NormalMap felsen2_kana_normal.png
+set_texture_alias DiffuseMap felsen_kana.png
+set_texture_alias NormalMap felsen_kana_normal.png
 }
 material boden/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
@@ -160,8 +160,8 @@
 }
 material SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap felsen2_kana.png
-set_texture_alias NormalMap felsen2_kana_normal.png
+set_texture_alias DiffuseMap felsen_kana.png
+set_texture_alias NormalMap felsen_kana_normal.png
 }
 material Material.098/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
 {

Modified: modules/kanalisation/scripts/maps/kanalisation.rb
===================================================================
--- modules/kanalisation/scripts/maps/kanalisation.rb	2008-02-16 13:03:41 UTC (rev 4067)
+++ modules/kanalisation/scripts/maps/kanalisation.rb	2008-02-16 18:20:31 UTC (rev 4068)
@@ -20,12 +20,9 @@
 #sunlight = $AM.createLightActor("sunlight", LightObject::LT_DIRECTIONAL);
 #$hero.getActor().placeIntoScene([0.0, 0.0, 0.0]);
 #sunlight.getControlledObject().setCastShadows(true);
-
-#$hero.getActor().placeIntoScene([0.0, 0.0, 0.0]);
 #sunlight.getControlledObject().setSpecularColour(1.0,1.0,1.0);
-
 #sunlight.getControlledObject().setDiffuseColour(0.1,0.1,0.2);
-$SCRIPT.log("Tageslicht erstellt.");
+#$SCRIPT.log("Tageslicht erstellt.");
 
 
 backlight = $AM.createLightActor("backlight", LightObject::LT_DIRECTIONAL);
@@ -34,7 +31,6 @@
 backlight.getControlledObject().setDiffuseColour(-0.3,-0.3,-0.3);
 
 
-
 $World.setFog( World::FOG_EXP, [0.658,0.7568,0.9137,1.0], 0.00049, 0.8, 1.0);
 $World.setAmbientLight( 0.08, 0.06, 0.05  );
 
@@ -47,13 +43,14 @@
 kanalLied.getControlledObject().play();
 $SCRIPT.log("Sound fertig");
 
-$SCRIPT.log("Create hero")
-#$hero = $GOM.createGameObject("hero", 1);
+$SCRIPT.log("Initialize hero");
 $hero = $GOM.createGameObject("mckhero", 1);
-
-$SCRIPT.log("Place hero into scene")
 $hero.placeIntoScene();
-$hero.setPosition([9.45,4.14,9.57]);
+$hero.setPosition([ 9.45, 4.14, 9.57]);
+$hero.setOrientation([ [ -4.43614335381426e-005, -0.999999940395355, -3.53998184436932e-005 ] , 67.3891525268555]);
+PlayerSettings.preparePlayer($hero);
+$UI.setActiveCharacter($hero)
+$SCRIPT.log("Create hero")
 
 $SCRIPT.log("Prepare hero for being the active character")
 PlayerSettings.preparePlayer($hero)

Modified: modules/kanalisation/scripts/particle.rb
===================================================================
--- modules/kanalisation/scripts/particle.rb	2008-02-16 13:03:41 UTC (rev 4067)
+++ modules/kanalisation/scripts/particle.rb	2008-02-16 18:20:31 UTC (rev 4068)
@@ -12,6 +12,9 @@
 tavernfire4 = $AM.createParticleSystemActor("tavernfire1", "vlight" );
 tavernfire4.placeIntoScene( -21.85,7.10,25.13, 1.0, 0.0, 0.0, 0.0 );
 
+tavernfire5 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
+tavernfire5.placeIntoScene( 36.49,7.37,30.27, 1.0, 0.0, 0.0, 0.0 );
+
 #waber01 = $AM.createParticleSystemActor("waber01", "waber" );
 #waber01.placeIntoScene( 8.73,3.73,10.36, 1.0, 0.0, 0.0, 0.0 );
 



From tanis at mail.berlios.de  Wed Feb 20 22:28:33 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Wed, 20 Feb 2008 22:28:33 +0100
Subject: [Dsa-hl-svn] r4069 - in modules/combattest: materials models
Message-ID: <200802202128.m1KLSX0H014389@sheep.berlios.de>

Author: tanis
Date: 2008-02-20 22:28:31 +0100 (Wed, 20 Feb 2008)
New Revision: 4069

Removed:
   modules/combattest/materials/tie_wolf_01.material
   modules/combattest/models/tie_wolf_01.mesh
   modules/combattest/models/tie_wolf_01_mesh.skeleton
Log:
Those are now in common, remove to prevent duplicate resources.

Deleted: modules/combattest/materials/tie_wolf_01.material
===================================================================
--- modules/combattest/materials/tie_wolf_01.material	2008-02-16 18:20:31 UTC (rev 4068)
+++ modules/combattest/materials/tie_wolf_01.material	2008-02-20 21:28:31 UTC (rev 4069)
@@ -1,15 +0,0 @@
-material 02_-_Default
-{
-	technique
-	{
-		pass
-		{
-			alpha_rejection greater 128
-
-			texture_unit
-			{
-				texture wolf1.dds
-			}
-		}
-	}
-}
\ No newline at end of file

Deleted: modules/combattest/models/tie_wolf_01.mesh
===================================================================
(Binary files differ)

Deleted: modules/combattest/models/tie_wolf_01_mesh.skeleton
===================================================================
(Binary files differ)



From tanis at mail.berlios.de  Wed Feb 20 22:30:30 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Wed, 20 Feb 2008 22:30:30 +0100
Subject: [Dsa-hl-svn] r4070 - modules/combattest/dsa
Message-ID: <200802202130.m1KLUUrN014675@sheep.berlios.de>

Author: tanis
Date: 2008-02-20 22:30:25 +0100 (Wed, 20 Feb 2008)
New Revision: 4070

Modified:
   modules/combattest/dsa/gameobjectdefinitions.gof
Log:
Changed to fit with current gof file definition.

Modified: modules/combattest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/combattest/dsa/gameobjectdefinitions.gof	2008-02-20 21:28:31 UTC (rev 4069)
+++ modules/combattest/dsa/gameobjectdefinitions.gof	2008-02-20 21:30:25 UTC (rev 4070)
@@ -38,5 +38,12 @@
 		</property>
 		<property name="talente" type="MAP">
 			<property name="Athletik" type="INT" data="3"/>
+		</property>
+    <property name="ai" type="MAP">
+        <property name="behaviours" type="ARRAY">
+    	    <property type="STRING" data="DefaultWanderBehaviour"/>
+    	    <property type="STRING" data="AvoidObstaclesBehaviour"/>
+        </property>
+    </property>
   </gameobjectclass>
 </GameObjectDefinitions>



From tanis at mail.berlios.de  Wed Feb 20 22:34:16 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Wed, 20 Feb 2008 22:34:16 +0100
Subject: [Dsa-hl-svn] r4071 - in rl/trunk/engine: ai/include ai/src core/src
	rules rules/include rules/src script/swig ui ui/include ui/src
Message-ID: <200802202134.m1KLYGhC015188@sheep.berlios.de>

Author: tanis
Date: 2008-02-20 22:34:04 +0100 (Wed, 20 Feb 2008)
New Revision: 4071

Added:
   rl/trunk/engine/rules/include/CombatAction.h
   rl/trunk/engine/rules/include/GameEventLog.h
   rl/trunk/engine/rules/include/RulesMessages.h
   rl/trunk/engine/rules/src/GameEventLog.cpp
   rl/trunk/engine/ui/include/CombatGui.h
   rl/trunk/engine/ui/src/CombatGui.cpp
Modified:
   rl/trunk/engine/ai/include/AgentCombatState.h
   rl/trunk/engine/ai/include/AiMessages.h
   rl/trunk/engine/ai/src/AgentCombatState.cpp
   rl/trunk/engine/core/src/CameraObject.cpp
   rl/trunk/engine/rules/RlRules2005.vcproj
   rl/trunk/engine/rules/include/Combat.h
   rl/trunk/engine/rules/include/CombatManager.h
   rl/trunk/engine/rules/include/Combatant.h
   rl/trunk/engine/rules/include/RulesConstants.h
   rl/trunk/engine/rules/include/RulesSubsystem.h
   rl/trunk/engine/rules/src/Combat.cpp
   rl/trunk/engine/rules/src/CombatManager.cpp
   rl/trunk/engine/rules/src/Combatant.cpp
   rl/trunk/engine/rules/src/RulesSubsystem.cpp
   rl/trunk/engine/script/swig/RlRules.head.swig
   rl/trunk/engine/script/swig/RlRules.swig
   rl/trunk/engine/script/swig/RlUi.head.swig
   rl/trunk/engine/script/swig/RlUi.swig
   rl/trunk/engine/ui/RlUI2005.vcproj
   rl/trunk/engine/ui/include/CombatControlState.h
   rl/trunk/engine/ui/include/CombatWindow.h
   rl/trunk/engine/ui/include/GameLoggerWindow.h
   rl/trunk/engine/ui/src/CombatControlState.cpp
   rl/trunk/engine/ui/src/CombatWindow.cpp
   rl/trunk/engine/ui/src/GameLoggerWindow.cpp
   rl/trunk/engine/ui/src/InputManager.cpp
Log:
GameLoggerWindow is now a view of new class GameEventLogger. This way gae events can be logged directly in RlRules and independant of a window.
Irrelevant beginnings of the combat system. Too lazy to separate it from other changes and it does no harm. Honest.

Modified: rl/trunk/engine/ai/include/AgentCombatState.h
===================================================================
--- rl/trunk/engine/ai/include/AgentCombatState.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ai/include/AgentCombatState.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -34,6 +34,8 @@
 
         virtual ~AgentCombatState();
 
+        virtual void requestCombatantAction();
+
         virtual Ogre::String getCombatantTypeName() const;
 
 		/** Function invoked by Agents to advance the AI.

Modified: rl/trunk/engine/ai/include/AiMessages.h
===================================================================
--- rl/trunk/engine/ai/include/AiMessages.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ai/include/AiMessages.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -24,6 +24,7 @@
 {
     class Dialog;
 
+	/// 0x02xxxxxx as mask for ai messages
     enum AiMessageTypeIds
     {
         // Controllers //

Modified: rl/trunk/engine/ai/src/AgentCombatState.cpp
===================================================================
--- rl/trunk/engine/ai/src/AgentCombatState.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ai/src/AgentCombatState.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -17,6 +17,7 @@
 
 #include "Agent.h"
 #include "AgentCombatState.h"
+#include "CombatManager.h"
 #include "CreatureControllerManager.h"
 
 namespace rl
@@ -24,8 +25,9 @@
 
     AgentCombatState::AgentCombatState(Agent* agent)
         : AgentState(agent),
-        Combatant(CreatureControllerManager::getSingleton().getCreatureController(
-            agent->getControlledCreature())),
+        Combatant(CombatManager::getSingleton().getCurrentCombat(),
+            CreatureControllerManager::getSingleton().getCreatureController(
+                agent->getControlledCreature())),
         mState()
     {
     }
@@ -39,6 +41,11 @@
         return "default";
     }
 
+    void AgentCombatState::requestCombatantAction()
+    {
+        // Think!
+    }
+
 	void AgentCombatState::update(const float elapsedTime)
     {
         mAgent->updateVehicle(0, elapsedTime);

Modified: rl/trunk/engine/core/src/CameraObject.cpp
===================================================================
--- rl/trunk/engine/core/src/CameraObject.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/core/src/CameraObject.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -76,11 +76,11 @@
 	Vector3 CameraObject::getPointOnCeGuiScreen(const Ogre::Vector3& worldCoords) const
 	{
 		//see Ogre::Camera::getCameraToViewportRay(Real, Real)
-		//		Real nx = (2.0f * screenX) - 1.0f;
-		//		Real ny = 1.0f - (2.0f * screenY);
-		// -> screenX = (nx + 1.0f) / 2.0f
-		// -> screenY = (1.0f - ny) / 2.0f
-
+		//		Real nx = (2.0f * screenX) - 1.0f;
+		//		Real ny = 1.0f - (2.0f * screenY);
+		// -> screenX = (nx + 1.0f) / 2.0f
+		// -> screenY = (1.0f - ny) / 2.0f
+
 		Vector3 screenSpacePos = getPointOnScreen(worldCoords);
 		screenSpacePos.x = (screenSpacePos.x + 1.0f) / 2.0f;
 		screenSpacePos.y = (1.0f - screenSpacePos.y) / 2.0f;

Modified: rl/trunk/engine/rules/RlRules2005.vcproj
===================================================================
--- rl/trunk/engine/rules/RlRules2005.vcproj	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/RlRules2005.vcproj	2008-02-20 21:34:04 UTC (rev 4071)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="Windows-1252"?>
 <VisualStudioProject
 	ProjectType="Visual C++"
-	Version="8,00"
+	Version="8.00"
 	Name="RlRules"
 	ProjectGUID="{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}"
 	RootNamespace="RlRules"
@@ -351,6 +351,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\src\GameEventLog.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\GameObjectManager.cpp"
 				>
 			</File>
@@ -521,6 +525,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\CombatAction.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\Combatant.h"
 				>
 			</File>
@@ -569,6 +577,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\GameEventLog.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\GameObjectManager.h"
 				>
 			</File>
@@ -625,6 +637,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\RulesMessages.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\RulesPrerequisites.h"
 				>
 			</File>

Modified: rl/trunk/engine/rules/include/Combat.h
===================================================================
--- rl/trunk/engine/rules/include/Combat.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/include/Combat.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -18,9 +18,11 @@
 #define __RL_COMBAT_H__
 
 #include "RulesPrerequisites.h"
+#include "CombatAction.h"
 
 #include <set>
 #include <vector>
+#include <boost/tuple/tuple.hpp>
 
 namespace rl
 {
@@ -31,7 +33,7 @@
     public:
         typedef std::set<Combatant*> CombatantSet;
 
-        Combat(Combatant* character);
+        Combat();
         ~Combat();
 
         void addOpponent(Combatant*);
@@ -46,17 +48,28 @@
         void start();
         void stop();
 
+        // Called by combatants in response to a request by the Combat object.
+        // With calling this function combatants register their actions for this round.
+        void registerCombatantAction(Combatant*, CombatAction*, CombatAction*, CombatAction*);
+
     private:
-        Combatant* mCharacter;
+        typedef std::vector<std::pair<int, Combatant*> > CombatantQueue;
+        /// Stores the max three actions a combatant can do per round.
+        /// Probably has to be replaced with a more sophisticated container later on,
+        /// but for now it will do what it needs to.
+        typedef boost::tuples::tuple<CombatAction*, CombatAction*, CombatAction*> ActionTuple;
+        typedef std::map<Combatant*, ActionTuple> CombatantActionMap;
+
         CombatantSet mOpponents;
         CombatantSet mAllies;
-        typedef std::vector<std::pair<int, Combatant*> > CombatantQueue;
-        // Combatants in order of their initiative for the current round.
+        /// Combatants in order of their initiative for the current round.
         CombatantQueue mCombatantQueue;
-        // Combatants in order of their initiative for the next round.
-        // Will be copied to the current round after current round is done
-        // and then it will be emptied.
-        CombatantQueue mNextCombatQueue;
+        CombatantActionMap mCombatantActions;
+
+        unsigned short mCurrentRound;
+
+        void beginRound();
+        void endRound();
     };
 }
 

Added: rl/trunk/engine/rules/include/CombatAction.h
===================================================================
--- rl/trunk/engine/rules/include/CombatAction.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/include/CombatAction.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -0,0 +1,41 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+
+#ifndef __RL_COMBATACTION_H__
+#define __RL_COMBATACTION_H__
+
+#include "RulesPrerequisites.h"
+#include "Action.h"
+
+namespace rl
+{
+    class Combatant;
+
+    class _RlRulesExport CombatAction : public Action
+    {
+    public:
+        typedef enum {FREE_ACTION, ACTIVE_ACTION, REACTIVE_ACTION, LONG_TERM_ACTION} Type;
+
+        CombatAction(Type type, const CeGuiString name, const CeGuiString description);
+        virtual ~CombatAction() {}
+
+        Type getType() const;
+    protected:
+        Type mType;
+    };
+}
+
+#endif

Modified: rl/trunk/engine/rules/include/CombatManager.h
===================================================================
--- rl/trunk/engine/rules/include/CombatManager.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/include/CombatManager.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -37,10 +37,8 @@
         ~CombatManager();
 
         /// Creates a new combat object and sets it active.
-        /// @param character the player character
-        /// @param firstOpponent the opponent, that caused the combat.
         /// @throw IllegalStateException if there is already a combat running.
-        Combat* startCombat(Combatant* character, Combatant* firstOpponent);
+        Combat* startCombat();
 
         /// Return the combat currently running, NULL if there is none.
         Combat* getCurrentCombat() const;

Modified: rl/trunk/engine/rules/include/Combatant.h
===================================================================
--- rl/trunk/engine/rules/include/Combatant.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/include/Combatant.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -21,20 +21,32 @@
 
 namespace rl
 {
+    class Combat;
     class Creature;
     class CreatureController;
 
-    class _RlRulesExport Combatant
+    /// Base class of combat participiants. This defines the interface Combat uses
+	/// to communicate with Combatants. Be it AI bots or actual users.
+	class _RlRulesExport Combatant
     {
     public:
-        Combatant(CreatureController* controller);
+        Combatant(Combat* combat, CreatureController* controller);
         virtual ~Combatant();
 
-        virtual Ogre::String getCombatantTypeName() const = 0;
+        /// This function is called by the Combat the Combatantant is taking part in,
+        /// in order to request it to register actions for the next round.
+        /// In response to this call Combatant is supposed to call Combat#registerCombatantAction.
+        /// The call is not required to be done immediatly,
+        /// it can be done synchronously or asynchronously.
+        virtual void requestCombatantAction() = 0;
 
+        /// Type name used by factory
+		virtual Ogre::String getCombatantTypeName() const = 0;
+
         CreatureController* getCreatureController() const;
 
     protected:
+        Combat* mCombat;
         CreatureController* mController;
     };
 

Added: rl/trunk/engine/rules/include/GameEventLog.h
===================================================================
--- rl/trunk/engine/rules/include/GameEventLog.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/include/GameEventLog.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -0,0 +1,48 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#ifndef __GAMEEVENTLOG_H__
+#define __GAMEEVENTLOG_H__
+
+#include "RulesPrerequisites.h"
+
+#include "RulesConstants.h"
+
+namespace rl
+{
+	class _RlRulesExport GameEventLog : public Ogre::Singleton<GameEventLog>
+    {
+    public:
+        GameEventLog();
+
+		/// Set the number of event entries kept in memory.
+		/// If more events are logged, oldest message is removed.
+		void setEventQueueLength(size_t length);
+
+		/// Get the number of event entries kept in memory.
+		size_t getEventQueueLength() const;
+
+		void logEvent(const Ogre::String& eventString, GameEventType type);
+
+	private:
+		typedef std::pair<GameEventType, Ogre::String> LogEntry;
+		std::deque<LogEntry> mLog;
+		size_t mLogSize;
+    };
+
+}
+
+#endif //__GAMEEVENTLOG_H__

Modified: rl/trunk/engine/rules/include/RulesConstants.h
===================================================================
--- rl/trunk/engine/rules/include/RulesConstants.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/include/RulesConstants.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -49,6 +49,15 @@
         SLOT_SUBMESH,
         SLOT_MATERIAL
     };
+
+	/// Event type that are distinguished in the game event log
+	enum GameEventType
+	{
+		GET_DEFAULT, ///!< If nothing else fits..
+		GET_COMBAT,  ///!< Combat events ("Alrike hits Wolf for 10TP")
+		GET_DIALOG,  ///!< Dialog events ("Charisma roll succeded.")
+		GET_QUEST    ///!< Quest related events ("Quest succeded: Kill Wolf.")
+	};
 }
 
 #endif // __RULESCONSTANTS_H__

Added: rl/trunk/engine/rules/include/RulesMessages.h
===================================================================
--- rl/trunk/engine/rules/include/RulesMessages.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/include/RulesMessages.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -0,0 +1,42 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#ifndef __Rl_RulesMessages_H__
+#define __Rl_RulesMessages_H__
+
+#include "RulesPrerequisites.h"
+
+#include "MessageType.h"
+#include "RulesConstants.h"
+
+namespace rl
+{
+	/// 0x03xxxxxx as mask for rules messages
+    enum RulesMessageTypeIds
+    {
+        // Game event log //
+        // Mask
+        RLMSG_GAMEEVENTLOG_EVENTS = 0x03000100,
+        // Events
+        RLMSG_GAMEEVENTLOG_EVENT_ADDED = 0x03000101,
+    };
+
+    /// Message sent right after a new game log event has been added.
+	typedef MessageType<RLMSG_GAMEEVENTLOG_EVENT_ADDED, GameEventType, Ogre::String>
+		MessageType_GameEventLog_EventAdded;
+
+}
+#endif

Modified: rl/trunk/engine/rules/include/RulesSubsystem.h
===================================================================
--- rl/trunk/engine/rules/include/RulesSubsystem.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/include/RulesSubsystem.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -23,11 +23,12 @@
 
 namespace rl
 {
-	class QuestBook;
     class ActionManager;
     class CombatManager;
+    class CreatureControllerManager;
     class DsaManager;
-    class CreatureControllerManager;
+	class GameEventLog;
+	class QuestBook;
     class XdimlLoader;
 
 	class _RlRulesExport RulesSubsystem : public Ogre::Singleton<RulesSubsystem>
@@ -44,6 +45,7 @@
         ActionManager* mActionManager;
         CombatManager* mCombatManager;
         DsaManager* mDsaManager;
+		GameEventLog* mGameEventLog;
         CreatureControllerManager *mMovingCreatureManager;
         XdimlLoader* mXdimlLoader;
     };

Modified: rl/trunk/engine/rules/src/Combat.cpp
===================================================================
--- rl/trunk/engine/rules/src/Combat.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/src/Combat.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -19,7 +19,14 @@
 
 #include "Combatant.h"
 #include "CreatureController.h"
+#include "GameEventLog.h"
 
+#include <OgreStringConverter.h>
+
+using namespace boost;
+using namespace boost::tuples;
+using namespace Ogre;
+
 namespace rl
 {
     struct InitiativeComparator
@@ -33,7 +40,12 @@
         }
     };
 
-    Combat::Combat(Combatant* character) : mCharacter(character)
+    Combat::Combat()
+        : mOpponents(),
+          mAllies(),
+          mCombatantQueue(),
+          mCombatantActions(),
+          mCurrentRound(0)
     {
     }
 
@@ -73,7 +85,11 @@
 
     void Combat::start()
     {
-        mCombatantQueue.clear();
+		GameEventLog::getSingleton().logEvent("Kampf beginnt.", GET_COMBAT);
+
+        mCurrentRound = 0;
+		mCombatantQueue.clear();
+
         std::vector<Combatant*> combatants;
         combatants.insert(combatants.end(), mAllies.begin(), mAllies.end());
         combatants.insert(combatants.end(), mOpponents.begin(), mOpponents.end());
@@ -85,9 +101,56 @@
                 (*it)->getCreatureController()->getCreature()->getInitiativeBasis(), *it));
         }
         std::sort(mCombatantQueue.begin(), mCombatantQueue.end(), InitiativeComparator());
+
+        beginRound();
     }
 
     void Combat::stop()
     {
     }
+
+    void Combat::beginRound()
+    {
+        // Increment round counter
+        mCurrentRound++;
+        mCombatantActions.clear();
+
+		GameEventLog::getSingleton().logEvent("Runde " + StringConverter::toString(mCurrentRound),
+			GET_COMBAT);
+		// Show ini for this round.
+        for (CombatantQueue::iterator it = mCombatantQueue.begin();
+			it != mCombatantQueue.end(); ++it)
+        {
+			String evt = it->second->getCreatureController()->getCreature()->getName().c_str();
+			evt += " - Initiative: " + StringConverter::toString(it->first);
+			GameEventLog::getSingleton().logEvent(evt, GET_COMBAT);
+        }
+
+
+        // Request actions from combatants
+        for (CombatantQueue::iterator it = mCombatantQueue.begin();
+            it != mCombatantQueue.end(); ++it)
+        {
+            it->second->requestCombatantAction();
+        }
+    }
+
+    void Combat::registerCombatantAction(Combatant* combatant,
+        CombatAction* action1, CombatAction* action2, CombatAction* action3)
+    {
+        mCombatantActions[combatant] = ActionTuple(action1, action2, action3);
+        // Are all combatants registered now?
+        if (mCombatantActions.size() == mCombatantQueue.size())
+        {
+            endRound();
+        }
+    }
+
+    void Combat::endRound()
+    {
+        // All actions are registered. Now we can calculate the combat.
+        // 
+
+        // Refill combatant queue with combatants that are still alive.
+    }
 }

Modified: rl/trunk/engine/rules/src/CombatManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/CombatManager.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/src/CombatManager.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -36,15 +36,14 @@
     {
     }
 
-    Combat* CombatManager::startCombat(Combatant* character, Combatant* firstOpponent)
+    Combat* CombatManager::startCombat()
     {
         if (mCurrentCombat != NULL)
         {
             Throw(IllegalStateException, "There already is a combat running.");
         }
 
-        mCurrentCombat = new Combat(character);
-        mCurrentCombat->addOpponent(firstOpponent);
+        mCurrentCombat = new Combat();
 
         return mCurrentCombat;
     }

Modified: rl/trunk/engine/rules/src/Combatant.cpp
===================================================================
--- rl/trunk/engine/rules/src/Combatant.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/src/Combatant.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -16,10 +16,12 @@
 #include "stdinc.h"
 
 #include "Combatant.h"
+#include "Combat.h"
 
 namespace rl
 {
-    Combatant::Combatant(CreatureController* controller) : mController(controller)
+    Combatant::Combatant(Combat* combat, CreatureController* controller)
+        : mCombat(combat), mController(controller)
     {
     }
 

Added: rl/trunk/engine/rules/src/GameEventLog.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameEventLog.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/src/GameEventLog.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -0,0 +1,49 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+#include "stdinc.h" //precompiled header
+
+#include "GameEventLog.h"
+#include "MessagePump.h"
+#include "RulesMessages.h"
+
+using namespace Ogre;
+
+template<> rl::GameEventLog* Singleton<rl::GameEventLog>::ms_Singleton = 0;
+
+namespace rl {
+
+	GameEventLog::GameEventLog() : mLog(), mLogSize(100)
+	{
+	}
+
+	void GameEventLog::setEventQueueLength(size_t length)
+	{
+		mLogSize = length;
+		while (mLog.size() > mLogSize) mLog.pop_front();
+	}
+
+	size_t GameEventLog::getEventQueueLength() const
+	{
+		return mLogSize;
+	}
+
+	void GameEventLog::logEvent(const String& eventString, GameEventType type)
+	{
+		mLog.push_back(std::make_pair(type, eventString));
+        MessagePump::getSingleton().sendMessage<MessageType_GameEventLog_EventAdded>(type, eventString);
+		while (mLog.size() > mLogSize) mLog.pop_front();
+	}
+}

Modified: rl/trunk/engine/rules/src/RulesSubsystem.cpp
===================================================================
--- rl/trunk/engine/rules/src/RulesSubsystem.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/rules/src/RulesSubsystem.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -19,9 +19,9 @@
 #include "ActionManager.h"
 #include "CombatManager.h"
 #include "DsaManager.h"
-//#include "XdimlLoader.h"
 #include "DsaDataLoader.h"
 #include "EffectFactory.h"
+#include "GameEventLog.h"
 #include "Logger.h"
 #include "CreatureControllerManager.h"
 #include "GameObjectManager.h"
@@ -38,6 +38,7 @@
         mActionManager(NULL),
         mCombatManager(NULL),
         mDsaManager(NULL),
+		mGameEventLog(NULL),
         mMovingCreatureManager(NULL),
         mXdimlLoader(NULL)
     {
@@ -55,6 +56,8 @@
 		LOG_MESSAGE(Logger::RULES, "CombatManager erzeugt");
         mDsaManager = new DsaManager();
 		LOG_MESSAGE(Logger::RULES, "DsaManager erzeugt");
+        mGameEventLog = new GameEventLog();
+		LOG_MESSAGE(Logger::RULES, "GameEventLog erzeugt");
         mMovingCreatureManager = new CreatureControllerManager();
 		LOG_MESSAGE(Logger::RULES, "CreatureControllerManager erzeugt");
 		resetQuestBook();
@@ -72,6 +75,7 @@
 	RulesSubsystem::~RulesSubsystem()
     {
         delete mQuestBook;
+		delete mGameEventLog;
         delete mDsaManager;
         delete mCombatManager;
         delete mActionManager;

Modified: rl/trunk/engine/script/swig/RlRules.head.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.head.swig	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/script/swig/RlRules.head.swig	2008-02-20 21:34:04 UTC (rev 4071)
@@ -31,6 +31,7 @@
 #include "Effect.h"
 #include "EffectFactory.h"
 #include "EigenschaftenStateSet.h"
+#include "GameEventLog.h"
 #include "GameObject.h"
 #include "GameObjectManager.h"
 #include "Inventory.h"

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/script/swig/RlRules.swig	2008-02-20 21:34:04 UTC (rev 4071)
@@ -130,7 +130,24 @@
         GameObjectManager();
     };
 
+	enum GameEventType
+	{
+		GET_DEFAULT,
+		GET_COMBAT,
+		GET_DIALOG,
+		GET_QUEST
+	};
+	
+    class GameEventLog
+    {
+    public:
+        static rl::GameEventLog& getSingleton();
+		void logEvent(const Ogre::String& eventString, GameEventType type);
 
+    private:
+        GameEventLog();
+    };
+
     %feature("director") QuestListener; 
     class QuestListener
     {

Modified: rl/trunk/engine/script/swig/RlUi.head.swig
===================================================================
--- rl/trunk/engine/script/swig/RlUi.head.swig	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/script/swig/RlUi.head.swig	2008-02-20 21:34:04 UTC (rev 4071)
@@ -21,10 +21,9 @@
 #include "ControlState.h"
 #include "CommandMapper.h"
 #include "CutsceneControlState.h"
-#include "GameLoggerWindow.h"
 #include "InputManager.h"
 #include "UiPrerequisites.h"
 #include "UiSubsystem.h"
 #include "WindowFactory.h"
 #include "WindowManager.h"
-%}
\ No newline at end of file
+%}

Modified: rl/trunk/engine/script/swig/RlUi.swig
===================================================================
--- rl/trunk/engine/script/swig/RlUi.swig	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/script/swig/RlUi.swig	2008-02-20 21:34:04 UTC (rev 4071)
@@ -72,15 +72,6 @@
     InputManager();
 };
 
-class GameLoggerWindow
-{
-public:
-    void logDialogEvent(const rl::CeGuiString& speaker, const rl::CeGuiString& text);
-    void logFightEvent(const rl::CeGuiString& text);
-    void logCharacterEvent(const rl::CeGuiString& text);
-    void logMiscEvent(const rl::CeGuiString& text);
-};
-
 class WindowFactory
 {
 public:

Modified: rl/trunk/engine/ui/RlUI2005.vcproj
===================================================================
--- rl/trunk/engine/ui/RlUI2005.vcproj	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/RlUI2005.vcproj	2008-02-20 21:34:04 UTC (rev 4071)
@@ -1,7 +1,7 @@
 <?xml version="1.0" encoding="Windows-1252"?>
 <VisualStudioProject
 	ProjectType="Visual C++"
-	Version="8,00"
+	Version="8.00"
 	Name="RlUI"
 	ProjectGUID="{53FE20F3-E726-44FE-BBEC-D29CAE210D25}"
 	RootNamespace="RlUI"
@@ -353,6 +353,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\CombatGui.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\CommandMapper.h"
 				>
 			</File>
@@ -566,6 +570,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\src\CombatGui.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\CommandMapper.cpp"
 				>
 			</File>

Modified: rl/trunk/engine/ui/include/CombatControlState.h
===================================================================
--- rl/trunk/engine/ui/include/CombatControlState.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/include/CombatControlState.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -29,8 +29,8 @@
 
 	class CameraObject;
     class Combat;
+    class CombatGui;
     class CombatManager;
-    class CombatWindow;
 
 	class _RlUiExport CombatControlState : public ControlState, public Combatant
 	{
@@ -38,30 +38,28 @@
 		/**
 		*  @throw NullPointerException if camera is NULL.
 		*/
-		CombatControlState(CommandMapper* cmdMapper, Actor* camera, Person* character);
+		CombatControlState(CommandMapper* cmdMapper, Actor* camera, Person* character, Combat* combat);
 		virtual ~CombatControlState();
 
+		// Control state overrides
+
         virtual void pause();
         virtual void resume();
 
 		void run(Ogre::Real elapsedTime);
 
-        // Combatant override
+        // Combatant overrides
+
         virtual Ogre::String getCombatantTypeName() const;
+        virtual void requestCombatantAction();
 
     private:
         CombatManager* mCombatManager;
-        // Current combat that is controlled.
-        Combat* mCombat;
-        CombatWindow* mCombatWindow;
+		CombatGui* mCombatGui;
         HalfSphereSelector mEnemySelector;
 
         CameraObject* mCamera;
 
-        /// Little Helper-MO for visualisation for everything that is difficult with cegui.
-        Ogre::ManualObject* mHud;
-
-        Ogre::Rectangle getScreenRectFromWorldAABB(const Ogre::AxisAlignedBox& aabb) const;
 	};
 }
 #endif

Added: rl/trunk/engine/ui/include/CombatGui.h
===================================================================
--- rl/trunk/engine/ui/include/CombatGui.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/include/CombatGui.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -0,0 +1,52 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+
+#ifndef __CombatGui_H__
+#define __CombatGui_H__
+
+#include "UiPrerequisites.h"
+
+#include "CameraObject.h"
+#include "Combat.h"
+#include "CombatWindow.h"
+
+namespace rl {
+	
+	/// GUI for user control of combat.
+	/// Handles all graphical combat visualisation.
+	class _RlUiExport CombatGui
+	{
+	public:
+		CombatGui(Combat*, CameraObject* mCamera);
+		virtual ~CombatGui();
+
+		void update();
+
+		void show();
+		void hide();
+
+	private:
+		CombatWindow* mCombatWindow;
+		Combat* mCombat;
+		CameraObject* mCamera;
+        /// Little Helper-MO for visualisation for everything that is difficult with cegui.
+        Ogre::ManualObject* mHud;
+
+        Ogre::Rectangle getScreenRectFromWorldAabb(const Ogre::AxisAlignedBox& aabb) const;
+	};
+}
+
+#endif

Modified: rl/trunk/engine/ui/include/CombatWindow.h
===================================================================
--- rl/trunk/engine/ui/include/CombatWindow.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/include/CombatWindow.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -22,6 +22,8 @@
 
 namespace rl {
 	
+	/// Wraps all cegui gui aspects of the combat gui and is
+	/// controlled by CombatGui class.
 	class _RlUiExport CombatWindow : public AbstractWindow
 	{
 	public:

Modified: rl/trunk/engine/ui/include/GameLoggerWindow.h
===================================================================
--- rl/trunk/engine/ui/include/GameLoggerWindow.h	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/include/GameLoggerWindow.h	2008-02-20 21:34:04 UTC (rev 4071)
@@ -20,6 +20,8 @@
 #include "UiPrerequisites.h"
 
 #include "AbstractWindow.h"
+#include "MessagePump.h"
+#include "RulesConstants.h"
 
 namespace rl {
 
@@ -28,23 +30,20 @@
 	public:
 		GameLoggerWindow();
 
-		void logDialogEvent(const CeGuiString& speaker, const CeGuiString& text);
-		void logFightEvent(const CeGuiString& text);
-		void logCharacterEvent(const CeGuiString& text);
-		void logMiscEvent(const CeGuiString& text);
+		/// Message handler for RLMSG_GAMEEVENTLOG_EVENT_ADDED
+		bool onLogEntryAdded(GameEventType evt, const Ogre::String& msg);
 
-		static CEGUI::colour COLOR_FIGHT;
+	private:
+		static CEGUI::colour COLOR_DEFAULT;
+		static CEGUI::colour COLOR_COMBAT;
 		static CEGUI::colour COLOR_DIALOG;
-		static CEGUI::colour COLOR_MISC;
-		static CEGUI::colour COLOR_CHARACTER;
+		static CEGUI::colour COLOR_QUEST;
 
-	private:
-		void logEvent(const CeGuiString& text, const CEGUI::colour color);
-
+	    MessagePump::ScopedConnection mLogEntryAddedConnection;
 		CEGUI::Listbox* mLog;
-	};
 
-
+		void logEvent(const CeGuiString& text, const CEGUI::colour color);
+	};
 }
 
 #endif

Modified: rl/trunk/engine/ui/src/CombatControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/CombatControlState.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/src/CombatControlState.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -20,8 +20,8 @@
 #include "Actor.h"
 #include "CameraObject.h"
 #include "Combat.h"
+#include "CombatGui.h"
 #include "CombatManager.h"
-#include "CombatWindow.h"
 #include "CoreSubsystem.h"
 #include "Creature.h"
 #include "CreatureController.h"
@@ -31,7 +31,6 @@
 #include "Person.h"
 #include "PhysicalThing.h"
 #include "Selector.h"
-#include "WindowFactory.h"
 #include "World.h"
 
 #include <OgreManualObject.h>
@@ -39,12 +38,11 @@
 
 namespace rl {
     CombatControlState::CombatControlState(CommandMapper* cmdMapper,
-        Actor* camera, Person* character)
+        Actor* camera, Person* character, Combat* combat)
         : ControlState(cmdMapper, camera, character, CST_COMBAT),
-          Combatant(CreatureControllerManager::getSingleton().getCreatureController(character)),
+          Combatant(combat, CreatureControllerManager::getSingleton().getCreatureController(character)),
           mCombatManager(CombatManager::getSingletonPtr()),
-          mCombat(NULL),
-          mCombatWindow(NULL),
+		  mCombatGui(NULL),
           mEnemySelector(CoreSubsystem::getSingleton().getWorld()->getSceneManager(),
             QUERYFLAG_CREATURE),
           mCamera(NULL)
@@ -53,23 +51,13 @@
         filter->setAlignmentMask(Creature::ALIGNMENT_ENEMY);
         mEnemySelector.setFilter(filter);
 
-        mCombatWindow = WindowFactory::getSingleton().getCombatWindow();
         mCamera = static_cast<CameraObject*>(mCameraActor->getControlledObject());
-
-        // Initialise HUD-MO. Put it into 2D mode and make sure it is always rendered.
-        SceneManager* sceneMgr = CoreSubsystem::getSingleton().getWorld()->getSceneManager();
-        mHud = sceneMgr->createManualObject("__COMBAT_HUD__");
-        mHud->setUseIdentityProjection(true);
-        mHud->setUseIdentityView(true);
-        AxisAlignedBox infiniteAabb;
-        infiniteAabb.setInfinite();
-        mHud->setBoundingBox(infiniteAabb);
-        mHud->setRenderQueueGroup(RENDER_QUEUE_OVERLAY);
-        sceneMgr->getRootSceneNode()->createChildSceneNode()->attachObject(mHud);
+		mCombatGui = new CombatGui(mCombat, mCamera);
     }
 
 	CombatControlState::~CombatControlState()
     {
+		delete mCombatGui;
         delete mEnemySelector.getFilter();
     }
 
@@ -87,45 +75,36 @@
         mEnemySelector.track(mCharacter);
         mEnemySelector.setRadius(10.0);
 
-        // Is there a combat running already?
-        if (mCombatManager->getCurrentCombat() != NULL)
+        mEnemySelector.updateSelection();
+        const Selector::GameObjectVector& enemies = mEnemySelector.getAllSelectedObjects();
+        if (!enemies.empty())
         {
-            // Yes. Set this one as active.
-            mCombat = mCombatManager->getCurrentCombat();
+            for (size_t i = 0; i < enemies.size(); ++i)
+            {
+                Combatant* opponent = mCombatManager->createCombatant(
+                    static_cast<Creature*>(enemies[i]));
+                mCombat->addOpponent(opponent);
+            }
         }
         else
         {
-            // No. Test, if we can start one.
-            mEnemySelector.updateSelection();
-            const Selector::GameObjectVector& enemies = mEnemySelector.getAllSelectedObjects();
-            if (!enemies.empty())
-            {
-                Combatant* firstOpponent = mCombatManager->createCombatant(
-                    static_cast<Creature*>(enemies[0]));
-                // There are enemies in vicinity, so start a new combat and set it up properly.
-                mCombat = mCombatManager->startCombat(this, firstOpponent);
-                for (size_t i = 1; i < enemies.size(); ++i)
-                {
-                    Combatant* opponent = mCombatManager->createCombatant(
-                        static_cast<Creature*>(enemies[i]));
-                    mCombat->addOpponent(opponent);
-                }
-            }
-            else
-            {
-                // Oops. Nothing to fight. Pop self.
-                InputManager::getSingleton().popControlState();
-                return;
-            }
+            // Oops. Nothing to fight. Pop self.
+            InputManager::getSingleton().popControlState();
+            return;
         }
-        mCombatWindow->setVisible(true);
 
+		mCombatGui->show();
+
+
+        // We want to play too..
+        mCombat->addAlly(this);
+
         mCombat->start();
     }
 
     void CombatControlState::pause()
     {
-        mCombatWindow->setVisible(false);
+		mCombatGui->hide();
 
         mCameraActor->getPhysicalThing()->unfreeze();
         mCharacterActor->getPhysicalThing()->unfreeze();
@@ -138,56 +117,15 @@
 
 	void CombatControlState::run(Ogre::Real elapsedTime)
     {
-        // HUD aktualisieren.
-        mHud->clear();
-
-        mHud->begin("BaseWhiteNoLighting", RenderOperation::OT_LINE_STRIP);
-        const Combat::CombatantSet& opponents = mCombat->getAllOpponents();
-        for (Combat::CombatantSet::const_iterator it = opponents.begin(), end = opponents.end();
-            it != end; ++it)
-        {
-            Ogre::Rectangle rec = getScreenRectFromWorldAABB(
-                (*it)->getCreatureController()->getCreature()->getActor()
-                    ->_getSceneNode()->_getWorldAABB());
-            mHud->position(rec.left,  rec.top,    0.0f);
-            mHud->position(rec.left,  rec.bottom, 0.0f);
-            mHud->position(rec.right, rec.top,    0.0f);
-            mHud->position(rec.right, rec.bottom, 0.0f);
-
-            mHud->index(0);
-            mHud->index(1);
-            mHud->index(3);
-            mHud->index(2);
-            mHud->index(0);
-        }
-        mHud->end();
     }
 
-    Ogre::Rectangle CombatControlState::getScreenRectFromWorldAABB(
-        const AxisAlignedBox& aabb) const
+    Ogre::String CombatControlState::getCombatantTypeName() const
     {
-        // Initialise each to the value of the opposite side, so that min/max work smoothly.
-        Real left = 1.0f, bottom = 1.0f, right = -1.0f, top = -1.0f;
-
-        // Determine screen pos of all corners and widen the rect if needed
-        const Vector3* corners = aabb.getAllCorners();
-        for (size_t i = 0; i < 8; ++i)
-        {
-			Vector3 screenSpacePos = mCamera->getPointOnScreen(corners[i]);
-            if (screenSpacePos.z > 0) continue; // Behind camera
-
-            left   = std::min(left,   screenSpacePos.x);
-            right  = std::max(right,  screenSpacePos.x);
-            bottom = std::min(bottom, screenSpacePos.y);
-            top    = std::max(top,    screenSpacePos.y);
-        }
-
-        Ogre::Rectangle rval = {left,top, right, bottom};
-        return rval;
+        return "CombatControlState";
     }
 
-    Ogre::String CombatControlState::getCombatantTypeName() const
+    void CombatControlState::requestCombatantAction()
     {
-        return "CombatControlState";
+        // Change state to allow user to choose actions for next round.
     }
 }

Added: rl/trunk/engine/ui/src/CombatGui.cpp
===================================================================
--- rl/trunk/engine/ui/src/CombatGui.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/src/CombatGui.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -0,0 +1,116 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+#include "stdinc.h" //precompiled header
+
+#include "CombatGui.h"
+
+#include "Combatant.h"
+#include "CoreSubsystem.h"
+#include "CreatureController.h"
+#include "CreatureControllerManager.h"
+#include "WindowFactory.h"
+#include "World.h"
+
+using namespace Ogre;
+
+namespace rl {
+
+	CombatGui::CombatGui(Combat* combat, CameraObject* camera)
+		: mCombatWindow(NULL),
+		  mCombat(combat),
+		  mCamera(camera)
+    {
+        mCombatWindow = WindowFactory::getSingleton().getCombatWindow();
+
+        // Initialise HUD-MO. Put it into 2D mode and make sure it is always rendered.
+        SceneManager* sceneMgr = CoreSubsystem::getSingleton().getWorld()->getSceneManager();
+        mHud = sceneMgr->createManualObject("__COMBAT_HUD__");
+        mHud->setUseIdentityProjection(true);
+        mHud->setUseIdentityView(true);
+        AxisAlignedBox infiniteAabb;
+        infiniteAabb.setInfinite();
+        mHud->setBoundingBox(infiniteAabb);
+        mHud->setRenderQueueGroup(RENDER_QUEUE_OVERLAY);
+        sceneMgr->getRootSceneNode()->createChildSceneNode()->attachObject(mHud);
+	}
+
+	CombatGui::~CombatGui()
+	{
+		hide();
+        SceneManager* sceneMgr = CoreSubsystem::getSingleton().getWorld()->getSceneManager();
+		sceneMgr->destroyManualObject(mHud);
+	}
+
+	void CombatGui::update()
+	{
+        // update HUD
+        mHud->clear();
+
+        mHud->begin("BaseWhiteNoLighting", RenderOperation::OT_LINE_STRIP);
+        const Combat::CombatantSet& opponents = mCombat->getAllOpponents();
+        for (Combat::CombatantSet::const_iterator it = opponents.begin(), end = opponents.end();
+            it != end; ++it)
+        {
+            Ogre::Rectangle rec = getScreenRectFromWorldAabb(
+                (*it)->getCreatureController()->getCreature()->getActor()
+                    ->_getSceneNode()->_getWorldAABB());
+            mHud->position(rec.left,  rec.top,    0.0f);
+            mHud->position(rec.left,  rec.bottom, 0.0f);
+            mHud->position(rec.right, rec.top,    0.0f);
+            mHud->position(rec.right, rec.bottom, 0.0f);
+
+            mHud->index(0);
+            mHud->index(1);
+            mHud->index(3);
+            mHud->index(2);
+            mHud->index(0);
+        }
+        mHud->end();
+	}
+
+	void CombatGui::show()
+	{
+        mCombatWindow->setVisible(true);
+	}
+
+	void CombatGui::hide()
+	{
+        mCombatWindow->setVisible(false);
+	}
+
+    Ogre::Rectangle CombatGui::getScreenRectFromWorldAabb(
+        const AxisAlignedBox& aabb) const
+    {
+        // Initialise each to the value of the opposite side, so that min/max work smoothly.
+        Real left = 1.0f, bottom = 1.0f, right = -1.0f, top = -1.0f;
+
+        // Determine screen pos of all corners and widen the rect if needed
+        const Vector3* corners = aabb.getAllCorners();
+        for (size_t i = 0; i < 8; ++i)
+        {
+			Vector3 screenSpacePos = mCamera->getPointOnScreen(corners[i]);
+            if (screenSpacePos.z > 0) continue; // Behind camera
+
+            left   = std::min(left,   screenSpacePos.x);
+            right  = std::max(right,  screenSpacePos.x);
+            bottom = std::min(bottom, screenSpacePos.y);
+            top    = std::max(top,    screenSpacePos.y);
+        }
+
+        Ogre::Rectangle rval = {left, top, right, bottom};
+        return rval;
+    }
+}

Modified: rl/trunk/engine/ui/src/CombatWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/CombatWindow.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/src/CombatWindow.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -23,7 +23,7 @@
 
 namespace rl {
 
-    CombatWindow::CombatWindow() : AbstractWindow("combatwindow.xml", WIT_NONE)
+    CombatWindow::CombatWindow() : AbstractWindow("combatwindow.xml", WIT_NONE, false)
     {
     }
 

Modified: rl/trunk/engine/ui/src/GameLoggerWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/GameLoggerWindow.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/src/GameLoggerWindow.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -1,65 +1,58 @@
 /* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
- */
+* Copyright (C) 2003-2007 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
 #include "stdinc.h" //precompiled header
 
-#include "UiPrerequisites.h"
+#include "GameLoggerWindow.h"
 
 #include "Creature.h"
-#include "GameLoggerWindow.h"
+#include "GameEventLog.h"
 #include "ListboxWrappedTextItem.h"
+#include "RulesMessages.h"
 
 namespace rl {
 
-CEGUI::colour GameLoggerWindow::COLOR_CHARACTER( 0xFFFF7F7F);
-CEGUI::colour GameLoggerWindow::COLOR_DIALOG(    0xFFFF7FFF);
-CEGUI::colour GameLoggerWindow::COLOR_FIGHT(     0xFFFFFF7F);
-CEGUI::colour GameLoggerWindow::COLOR_MISC(      0xFFFFFFFF);
+	CEGUI::colour GameLoggerWindow::COLOR_QUEST(     0xFFFF7F7F);
+	CEGUI::colour GameLoggerWindow::COLOR_COMBAT(    0xFFFFFF7F);
+	CEGUI::colour GameLoggerWindow::COLOR_DIALOG(    0xFFFF7FFF);
+	CEGUI::colour GameLoggerWindow::COLOR_DEFAULT(   0xFFFFFFFF);
 
-GameLoggerWindow::GameLoggerWindow() :
-	AbstractWindow("gameloggerwindow.xml", WIT_NONE)
-{
-	mLog = getListbox ("GameLogger/Log");
-	bindDestroyWindowToXButton();
-}
+	GameLoggerWindow::GameLoggerWindow()
+		: AbstractWindow("gameloggerwindow.xml", WIT_NONE),
+		  mLogEntryAddedConnection(),
+		  mLog(NULL)
+	{
+		mLog = getListbox ("GameLogger/Log");
+		mLogEntryAddedConnection = 
+            MessagePump::getSingleton().addMessageHandler<MessageType_GameEventLog_EventAdded>(
+			    boost::bind(&GameLoggerWindow::onLogEntryAdded, this, _1, _2));
+	}
 
-void GameLoggerWindow::logEvent(const CeGuiString& text, const CEGUI::colour color)
-{
-	CEGUI::ListboxWrappedTextItem* item = new CEGUI::ListboxWrappedTextItem(text);
-	item->setTextColours(color);
-	mLog->insertItem(item, NULL);
-}
+	bool GameLoggerWindow::onLogEntryAdded(GameEventType evt, const Ogre::String& text)
+	{
+		CEGUI::colour col = evt == GET_QUEST ? COLOR_QUEST :
+			evt == GET_COMBAT ? COLOR_COMBAT :
+			evt == GET_DIALOG ? COLOR_DIALOG : COLOR_DEFAULT;
+		logEvent(text, col);
+		return true;
+	}
 
-void GameLoggerWindow::logDialogEvent(const CeGuiString& speaker, const CeGuiString& text)
-{
-	logEvent(speaker+": '"+text+"'", COLOR_DIALOG);
+	void GameLoggerWindow::logEvent(const CeGuiString& text, const CEGUI::colour color)
+	{
+		CEGUI::ListboxWrappedTextItem* item = new CEGUI::ListboxWrappedTextItem(text);
+		item->setTextColours(color);
+		mLog->addItem(item);
+	}
 }
-
-void GameLoggerWindow::logFightEvent(const CeGuiString& text)
-{
-	logEvent(text, COLOR_FIGHT);
-}
-
-void GameLoggerWindow::logCharacterEvent(const CeGuiString& text)
-{
-	logEvent(text, COLOR_CHARACTER);
-}
-
-void GameLoggerWindow::logMiscEvent(const CeGuiString& text)
-{
-	logEvent(text, COLOR_MISC);
-}
-
-}

Modified: rl/trunk/engine/ui/src/InputManager.cpp
===================================================================
--- rl/trunk/engine/ui/src/InputManager.cpp	2008-02-20 21:30:25 UTC (rev 4070)
+++ rl/trunk/engine/ui/src/InputManager.cpp	2008-02-20 21:34:04 UTC (rev 4071)
@@ -33,6 +33,7 @@
 #include "AiMessages.h"
 #include "ControlState.h"
 #include "CombatControlState.h"
+#include "CombatManager.h"
 #include "CommandMapper.h"
 #include "ConfigurationManager.h"
 #include "Console.h"
@@ -398,7 +399,10 @@
             controller = new DialogControlState(mCommandMapper, camera, character);
             break;
         case CST_COMBAT:
-            controller = new CombatControlState(mCommandMapper, camera, character);
+            {
+                Combat* combat = CombatManager::getSingleton().startCombat();
+                controller = new CombatControlState(mCommandMapper, camera, character, combat);
+            }
             break;
         default:
             Throw(IllegalStateException, "Unknown controller type.");



From tanis at mail.berlios.de  Wed Feb 20 22:35:02 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Wed, 20 Feb 2008 22:35:02 +0100
Subject: [Dsa-hl-svn] r4072 - in modules: regressiontest/dsa techdemo2/dsa
Message-ID: <200802202135.m1KLZ2SP015308@sheep.berlios.de>

Author: tanis
Date: 2008-02-20 22:35:00 +0100 (Wed, 20 Feb 2008)
New Revision: 4072

Modified:
   modules/regressiontest/dsa/gameobjectdefinitions.gof
   modules/techdemo2/dsa/td2objects.gof
Log:
Changed to fit with current gof file definition.


Modified: modules/regressiontest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/regressiontest/dsa/gameobjectdefinitions.gof	2008-02-20 21:34:04 UTC (rev 4071)
+++ modules/regressiontest/dsa/gameobjectdefinitions.gof	2008-02-20 21:35:00 UTC (rev 4072)
@@ -28,9 +28,11 @@
         <property name="meshfile" type="STRING" data="men_alrike.mesh"/>
         <property name="mass" type="REAL" data="65"/>
         <property name="dialog" type="STRING" data="testdialog"/>
-        <property name="behaviours" type="ARRAY">
-            <property type="STRING" data="DefaultIdleBehaviour"/>
-            <property type="STRING" data="DialogBehaviour"/>
+        <property name="ai" type="MAP">
+            <property name="behaviours" type="ARRAY">
+                <property type="STRING" data="DefaultIdleBehaviour"/>
+                <property type="STRING" data="DialogBehaviour"/>
+            </property>
         </property>
 		<property name="eigenschaften" type="MAP">
 			<property name="MU" type="INT" data="12"/>
@@ -55,9 +57,11 @@
         <property name="meshfile" type="STRING" data="men_alrike.mesh"/>
         <property name="mass" type="REAL" data="65"/>
         <property name="dialogfile" type="STRING" data="testperson.xml"/>
-        <property name="behaviours" type="ARRAY">
-            <property type="STRING" data="DefaultIdleBehaviour"/>
-            <property type="STRING" data="DialogBehaviour"/>
+        <property name="ai" type="MAP">
+            <property name="behaviours" type="ARRAY">
+                <property type="STRING" data="DefaultIdleBehaviour"/>
+                <property type="STRING" data="DialogBehaviour"/>
+            </property>
         </property>
     </gameobjectclass>
 

Modified: modules/techdemo2/dsa/td2objects.gof
===================================================================
--- modules/techdemo2/dsa/td2objects.gof	2008-02-20 21:34:04 UTC (rev 4071)
+++ modules/techdemo2/dsa/td2objects.gof	2008-02-20 21:35:00 UTC (rev 4072)
@@ -15,9 +15,11 @@
     <property name="position" type="VECTOR3" data="-20.99, -6.5, 1.55"/>
     <property name="orientation" type="QUATERNION" data="0.0, 180.0, 0.0"/>
     <property name="dialogfile" type="STRING" data="wolfram.xml"/>
-    <property name="behaviours" type="ARRAY">
-    	<property type="STRING" data="DefaultIdleBehaviour"/>
-    	<property type="STRING" data="dialog_behaviour"/>
+    <property name="ai" type="MAP">
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+            <property type="STRING" data="DialogBehaviour"/>
+        </property>
     </property>
   </gameobjectclass>
 
@@ -32,9 +34,11 @@
     <property name="position" type="VECTOR3" data="-32.40, -6.46, 4.03"/>
     <property name="orientation" type="QUATERNION" data="0.0, 120.94, 0.0"/>
     <property name="dialogfile" type="STRING" data="sonja.xml"/>
-    <property name="behaviours" type="ARRAY">
-    	<property type="STRING" data="DefaultIdleBehaviour"/>
-    	<property type="STRING" data="DialogBehaviour"/>
+    <property name="ai" type="MAP">
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+            <property type="STRING" data="DialogBehaviour"/>
+        </property>
     </property>
   </gameobjectclass>
   
@@ -49,9 +53,11 @@
     <property name="position" type="VECTOR3" data="2.70, -37.79, -23.48"/>
     <property name="orientation" type="QUATERNION" data="0.0, 120.94, 0.0"/>
     <property name="dialogfile" type="STRING" data="sonja2.xml"/>
-    <property name="behaviours" type="ARRAY">
-    	<property type="STRING" data="DefaultIdleBehaviour"/>
-    	<property type="STRING" data="DialogBehaviour"/>
+    <property name="ai" type="MAP">
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+            <property type="STRING" data="DialogBehaviour"/>
+        </property>
     </property>
   </gameobjectclass>
   
@@ -66,9 +72,11 @@
     <property name="position" type="VECTOR3" data="-36.16, -6.25, 18.12"/>
     <property name="orientation" type="QUATERNION" data="0.0, -23.40, 0.0"/>
     <property name="dialogfile" type="STRING" data="jarn.xml"/>
-    <property name="behaviours" type="ARRAY">
-    	<property type="STRING" data="DefaultIdleBehaviour"/>
-    	<property type="STRING" data="DialogBehaviour"/>
+    <property name="ai" type="MAP">
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+            <property type="STRING" data="DialogBehaviour"/>
+        </property>
     </property>
   </gameobjectclass>
   
@@ -83,9 +91,11 @@
     <property name="position" type="VECTOR3" data="11.46, -8.88, 39.43"/>
     <property name="orientation" type="QUATERNION" data="0.0, 50.0, 0.0"/>
     <property name="dialogfile" type="STRING" data="wolfram.xml"/>
-    <property name="behaviours" type="ARRAY">
-    	<property type="STRING" data="DefaultIdleBehaviour"/>
-    	<property type="STRING" data="DialogBehaviour"/>
+    <property name="ai" type="MAP">
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+            <property type="STRING" data="DialogBehaviour"/>
+        </property>
     </property>
   </gameobjectclass>
   
@@ -99,10 +109,12 @@
     <property name="geometrytype" type="STRING" data="sphere"/>
     <property name="position" type="VECTOR3" data="-20.83, -6.70, 19.46"/>
     <property name="dialogfile" type="STRING" data="forrest.xml"/>
-    <property name="behaviours" type="ARRAY">
-    	<property type="STRING" data="DefaultIdleBehaviour"/>
-    	<property type="STRING" data="AvoidObstaclesBehaviour"/>
-    	<property type="STRING" data="DialogBehaviour"/>
+    <property name="ai" type="MAP">
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+            <property type="STRING" data="DialogBehaviour"/>
+        	<property type="STRING" data="AvoidObstaclesBehaviour"/>
+        </property>
     </property>
   </gameobjectclass>
   
@@ -141,9 +153,11 @@
     <property name="meshfile" type="STRING" data="tie_wolf_01.mesh"/>
     <property name="mass" type="REAL" data="0"/>
     <property name="geometrytype" type="STRING" data="sphere"/>
-    <property name="behaviours" type="ARRAY">
-    	<property type="STRING" data="DefaultIdleBehaviour"/>
-    	<property type="STRING" data="AvoidObstaclesBehaviour"/>
+    <property name="ai" type="MAP">
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+        	<property type="STRING" data="AvoidObstaclesBehaviour"/>
+        </property>
     </property>
   </gameobjectclass>
   



From tanis at mail.berlios.de  Wed Feb 20 22:35:27 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Wed, 20 Feb 2008 22:35:27 +0100
Subject: [Dsa-hl-svn] r4073 - in modules/common: gui/windows scripts
Message-ID: <200802202135.m1KLZR0N015348@sheep.berlios.de>

Author: tanis
Date: 2008-02-20 22:35:25 +0100 (Wed, 20 Feb 2008)
New Revision: 4073

Modified:
   modules/common/gui/windows/combatwindow.xml
   modules/common/gui/windows/gameloggerwindow.xml
   modules/common/scripts/globals.rb
Log:
GameLoggerWindow is now a view of new class GameEventLogger. This way gae events can be logged directly in RlRules and independant of a window.
Irrelevant beginnings of the combat system. Too lazy to separate it from other changes and it does no harm. Honest.

Modified: modules/common/gui/windows/combatwindow.xml
===================================================================
--- modules/common/gui/windows/combatwindow.xml	2008-02-20 21:35:00 UTC (rev 4072)
+++ modules/common/gui/windows/combatwindow.xml	2008-02-20 21:35:25 UTC (rev 4073)
@@ -4,8 +4,8 @@
 		<Property Name="UnifiedSize" Value="{{1.0,0.0},{1.0,0}}" />
 
 		<Window Type="RastullahLook/MultiLineEditbox" Name="CombatGui/Info">
-    		<Property Name="UnifiedPosition" Value="{{0.05,0},{0.75,0}}" />	
-	    	<Property Name="UnifiedSize" Value="{{0.9,0},{0.2,0}}" />
+    		<Property Name="UnifiedPosition" Value="{{0.05,0},{0.05,0}}" />	
+	    	<Property Name="UnifiedSize" Value="{{0.9,0},{0.1,0}}" />
 			<Property Name="Font" Value="Vera Serif-10" />
 			<Property Name="Text" Value="Here there be important message." />
 		</Window>

Modified: modules/common/gui/windows/gameloggerwindow.xml
===================================================================
--- modules/common/gui/windows/gameloggerwindow.xml	2008-02-20 21:35:00 UTC (rev 4072)
+++ modules/common/gui/windows/gameloggerwindow.xml	2008-02-20 21:35:25 UTC (rev 4073)
@@ -4,8 +4,8 @@
         <Property Name="UnifiedSize" Value="{{0,700},{0,200}}" />
         <Property Name="Text" Value="Game Log" />
         <Window Type="RastullahLook/Listbox" Name="GameLogger/Log">
-            <Property Name="UnifiedPosition" Value="{{0.01,0},{0.05,0}}" />
-            <Property Name="UnifiedSize" Value="{{0.9,0},{0.9,0}}" />
+            <Property Name="UnifiedPosition" Value="{{0.02,0},{0.1,0}}" />
+            <Property Name="UnifiedSize" Value="{{0.96,0},{0.9,0}}" />
             <Property Name="Font" Value="Vera Serif-8"/>
         </Window>
     </Window>

Modified: modules/common/scripts/globals.rb
===================================================================
--- modules/common/scripts/globals.rb	2008-02-20 21:35:00 UTC (rev 4072)
+++ modules/common/scripts/globals.rb	2008-02-20 21:35:25 UTC (rev 4073)
@@ -21,6 +21,7 @@
 
 $GameEveMgr = GameEventManager.getSingleton();
 $AnimMgr = AnimationManager.getSingleton();
+$GEL = GameEventLog.getSingleton();
 $GOM = GameObjectManager.getSingleton();
 $SM = SoundManager.getSingleton();
 



From timm at mail.berlios.de  Thu Feb 21 00:57:35 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Thu, 21 Feb 2008 00:57:35 +0100
Subject: [Dsa-hl-svn] r4074 - in rl/trunk/engine: core/include core/src
	rules/src
Message-ID: <200802202357.m1KNvZPA009003@sheep.berlios.de>

Author: timm
Date: 2008-02-21 00:57:22 +0100 (Thu, 21 Feb 2008)
New Revision: 4074

Modified:
   rl/trunk/engine/core/include/TimeSource.h
   rl/trunk/engine/core/src/CoreSubsystem.cpp
   rl/trunk/engine/core/src/PlayAnimationJob.cpp
   rl/trunk/engine/core/src/PlaySoundJob.cpp
   rl/trunk/engine/core/src/SaveGameFileWriter.cpp
   rl/trunk/engine/core/src/TimeSource.cpp
   rl/trunk/engine/rules/src/GameObjectManager.cpp
Log:
saving/loading TimeSources

Modified: rl/trunk/engine/core/include/TimeSource.h
===================================================================
--- rl/trunk/engine/core/include/TimeSource.h	2008-02-20 21:35:25 UTC (rev 4073)
+++ rl/trunk/engine/core/include/TimeSource.h	2008-02-20 23:57:22 UTC (rev 4074)
@@ -23,6 +23,8 @@
 
 #include "GameTask.h"
 
+#include "SaveGameManager.h"
+
 namespace rl
 {
     class _RlCoreExport TimeSource : public GameTask
@@ -82,14 +84,20 @@
     };
 
     class _RlCoreExport TimeSourceManager 
-        : public Ogre::Singleton<TimeSourceManager>
+        : public Ogre::Singleton<TimeSourceManager>, public SaveGameData
     {
     public:
         TimeSourceManager();
+		virtual ~TimeSourceManager();
 
         void registerTimeSource(TimeSource* ts);
         TimeSource* getTimeSource(const TimeSource::TimeSourceType& type) const;
 
+		virtual CeGuiString getXmlNodeIdentifier() const;
+        virtual void writeData(SaveGameFileWriter* writer);
+        virtual void readData(SaveGameFileReader* reader);
+        /// defines the loading/saving order higher priority are saved last and loaded first
+        virtual int getPriority() const;
     private:
         std::map<TimeSource::TimeSourceType, TimeSource*> mTimeSources;
     };

Modified: rl/trunk/engine/core/src/CoreSubsystem.cpp
===================================================================
--- rl/trunk/engine/core/src/CoreSubsystem.cpp	2008-02-20 21:35:25 UTC (rev 4073)
+++ rl/trunk/engine/core/src/CoreSubsystem.cpp	2008-02-20 23:57:22 UTC (rev 4074)
@@ -92,7 +92,6 @@
         delete mGameLoop;
         delete mMessagePump;
         delete mJobScheduler;
-        delete mSaveGameManager;
         delete mAnimationManager;
         delete mActorManager;
         delete mPhysicsManager;
@@ -104,6 +103,7 @@
         delete mOgreRoot;
         delete mRubyInterpreter;
         delete mTimeSourceManager;
+		delete mSaveGameManager;
     }
 
     void CoreSubsystem::startCore()
@@ -229,7 +229,10 @@
         mGameLoop = new GameLoop();
         LOG_MESSAGE(Logger::CORE,"GameLoopmanager erzeugt");
 
-        mTimeSourceManager = new TimeSourceManager();
+        mSaveGameManager = new SaveGameManager();
+        LOG_MESSAGE(Logger::RULES, "SaveGameManager erzeugt");
+		
+		mTimeSourceManager = new TimeSourceManager();
         mTimeSourceManager->registerTimeSource(new RealTimeContinuous());
         mTimeSourceManager->registerTimeSource(new RealTimeInterruptable());
         LOG_MESSAGE(Logger::CORE,"Time sources (realtime) created");
@@ -283,9 +286,6 @@
         GameLoop::getSingleton().addTask(mDebugVisualsManager, GameLoop::TG_GRAPHICS);
         LOG_MESSAGE(Logger::CORE,"DebugVisualsManager erzeugt");
 
-        mSaveGameManager = new SaveGameManager();
-        LOG_MESSAGE(Logger::RULES, "SaveGameManager erzeugt");
-
         mJobScheduler = new JobScheduler();
         GameLoop::getSingleton().addTask(mJobScheduler, GameLoop::TG_GRAPHICS);
         LOG_MESSAGE(Logger::CORE,"JobScheduler erzeugt");

Modified: rl/trunk/engine/core/src/PlayAnimationJob.cpp
===================================================================
--- rl/trunk/engine/core/src/PlayAnimationJob.cpp	2008-02-20 21:35:25 UTC (rev 4073)
+++ rl/trunk/engine/core/src/PlayAnimationJob.cpp	2008-02-20 23:57:22 UTC (rev 4074)
@@ -23,7 +23,7 @@
 namespace rl
 {
 
-    PlayAnimationJob::PlayAnimationJob(Actor* actor, const String& anim, bool doLoop,
+	PlayAnimationJob::PlayAnimationJob(Actor* actor, const Ogre::String& anim, bool doLoop,
         bool replaceAllAnims)
         : Job(false, true),
           mActor(actor),

Modified: rl/trunk/engine/core/src/PlaySoundJob.cpp
===================================================================
--- rl/trunk/engine/core/src/PlaySoundJob.cpp	2008-02-20 21:35:25 UTC (rev 4073)
+++ rl/trunk/engine/core/src/PlaySoundJob.cpp	2008-02-20 23:57:22 UTC (rev 4074)
@@ -25,7 +25,7 @@
 namespace rl
 {
 
-    PlaySound2dJob::PlaySound2dJob(const String& sound, Real volume, int priority)
+	PlaySound2dJob::PlaySound2dJob(const Ogre::String& sound, Real volume, int priority)
         : Job(false, true), mSound(NULL), mExecuted(false)
     {
         mSound = SoundManager::getSingleton().createSound(sound, ST_SAMPLE);
@@ -52,7 +52,7 @@
         return true;
     }
 
-    PlaySound3dJob::PlaySound3dJob(const String& sound, const Ogre::Vector3& pos, Real volume, int priority)
+	PlaySound3dJob::PlaySound3dJob(const Ogre::String& sound, const Ogre::Vector3& pos, Real volume, int priority)
         : Job(false, true), mSound(NULL), mExecuted(false)
     {
         mSound = SoundManager::getSingleton().createSound(sound, ST_SAMPLE);

Modified: rl/trunk/engine/core/src/SaveGameFileWriter.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveGameFileWriter.cpp	2008-02-20 21:35:25 UTC (rev 4073)
+++ rl/trunk/engine/core/src/SaveGameFileWriter.cpp	2008-02-20 23:57:22 UTC (rev 4074)
@@ -71,11 +71,11 @@
             this->processProperty(header, PropertyEntry(it_header->first.c_str(), it_header->second));
         }
 
-        //Write globals
-        DOMElement* globals = appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
-        DOMElement* gameTime = appendChildElement(mDocument, globals, "gametime");
-        TimeSource* gameTimeSource = TimeSourceManager::getSingleton().getTimeSource(TimeSource::GAMETIME);
-        setAttributeValueAsInteger(gameTime, "milliseconds", gameTimeSource->getClock());
+        ////Write globals
+        //DOMElement* globals = appendChildElement(mDocument, mDocument->getDocumentElement(), "globals");
+        //DOMElement* gameTime = appendChildElement(mDocument, globals, "gametime");
+        //TimeSource* gameTimeSource = TimeSourceManager::getSingleton().getTimeSource(TimeSource::GAMETIME);
+        //setAttributeValueAsInteger(gameTime, "milliseconds", gameTimeSource->getClock());
 
         for(SaveGameDataOrderMap::const_iterator data_iter = map.begin(); data_iter != map.end(); data_iter++)
         {

Modified: rl/trunk/engine/core/src/TimeSource.cpp
===================================================================
--- rl/trunk/engine/core/src/TimeSource.cpp	2008-02-20 21:35:25 UTC (rev 4073)
+++ rl/trunk/engine/core/src/TimeSource.cpp	2008-02-20 23:57:22 UTC (rev 4074)
@@ -120,8 +120,14 @@
 
     TimeSourceManager::TimeSourceManager()
     {
+		SaveGameManager::getSingleton().registerSaveGameData(this);
     }
 
+	TimeSourceManager::~TimeSourceManager()
+	{
+		SaveGameManager::getSingleton().unregisterSaveGameData(this);
+	}
+
     void TimeSourceManager::registerTimeSource(TimeSource* ts)
     {
         mTimeSources[ts->getType()] = ts;
@@ -141,4 +147,65 @@
         return it->second;
     }
 
+
+	CeGuiString TimeSourceManager::getXmlNodeIdentifier() const
+	{
+		return "time_sources";
+	}
+
+	using namespace XERCES_CPP_NAMESPACE;
+
+    void TimeSourceManager::writeData(SaveGameFileWriter* writer)
+	{
+		DOMElement* timesources = writer->appendChildElement(writer->getDocument(), 
+			writer->getDocument()->getDocumentElement(), getXmlNodeIdentifier().c_str());
+
+		for(std::map<TimeSource::TimeSourceType, TimeSource*>::const_iterator it_time_sources = mTimeSources.begin(); 
+			it_time_sources != mTimeSources.end(); it_time_sources++)
+        {
+            DOMElement* timesource = writer->appendChildElement(writer->getDocument(), timesources, "time_source");
+			writer->setAttributeValueAsInteger(timesource, "ID", it_time_sources->first);
+			Property time((int)it_time_sources->second->getClock());
+
+            PropertyMap map;
+			map["time"] = time;
+            writer->writeEachPropertyToElem(timesource, map);
+        } 
+	}
+
+	void TimeSourceManager::readData(SaveGameFileReader* reader)
+	{
+		reader->initializeXml();
+
+		DOMNodeList* rootNodeList = reader->getDocument()->getDocumentElement()->getElementsByTagName(AutoXMLCh(getXmlNodeIdentifier().c_str()).data());
+
+		if(rootNodeList->getLength())
+        {
+			DOMNodeList* xmlTimeSources = static_cast<DOMElement*>(rootNodeList->item(0))->getElementsByTagName(AutoXMLCh("gameobject").data()); //there should be only one "gameobjects" node
+            if(xmlTimeSources->getLength())
+            {
+				for(XMLSize_t childIdx = 0; childIdx < xmlTimeSources->getLength(); childIdx++)
+				{
+					DOMNode* xmlTimeSource = xmlTimeSources->item(childIdx);
+					if(xmlTimeSource->getNodeType() == DOMNode::ELEMENT_NODE)
+                    {
+						TimeSource::TimeSourceType ID = (TimeSource::TimeSourceType)reader->getAttributeValueAsInteger(
+							static_cast<DOMElement*>(xmlTimeSource), "ID");
+                        PropertyRecord properties = reader->getPropertiesAsRecord(static_cast<DOMElement*>(xmlTimeSource));
+	
+						std::map<TimeSource::TimeSourceType, TimeSource*>::const_iterator it_time_sources = mTimeSources.find(ID);
+						if(it_time_sources != mTimeSources.end())
+							it_time_sources->second->setClock(properties.toPropertyMap()["time"].toInt());
+                    }
+				}
+			}
+		}
+
+		reader->shutdownXml();
+	}
+    
+    int TimeSourceManager::getPriority() const
+	{
+		return 10000;
+	}
 }

Modified: rl/trunk/engine/rules/src/GameObjectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObjectManager.cpp	2008-02-20 21:35:25 UTC (rev 4073)
+++ rl/trunk/engine/rules/src/GameObjectManager.cpp	2008-02-20 23:57:22 UTC (rev 4074)
@@ -333,9 +333,9 @@
             DOMNodeList* xmlGameObjects = static_cast<DOMElement*>(rootNodeList->item(0))->getElementsByTagName(AutoXMLCh("gameobject").data()); //there should be only one "gameobjects" node
             if(xmlGameObjects->getLength())
             {
-                for(XMLSize_t childIdx1 = 0; childIdx1 < xmlGameObjects->getLength(); childIdx1++)
+                for(XMLSize_t childIdx = 0; childIdx < xmlGameObjects->getLength(); childIdx++)
                 {
-                    DOMNode* xmlGameObject = xmlGameObjects->item(childIdx1);
+                    DOMNode* xmlGameObject = xmlGameObjects->item(childIdx);
                     if(xmlGameObject->getNodeType() == DOMNode::ELEMENT_NODE)
                     {
                         int ID = reader->getAttributeValueAsInteger(static_cast<DOMElement*>(xmlGameObject), "ID");
@@ -343,17 +343,17 @@
                         GameObjectState state = (GameObjectState)reader->getAttributeValueAsInteger(static_cast<DOMElement*>(xmlGameObject), "State");
                         PropertyRecord properties = reader->getPropertiesAsRecord(static_cast<DOMElement*>(xmlGameObject));
 
-						GameObject* object = NULL;
-						if(getGameObject(ID) == NULL)
-							object = createGameObject(classID, ID);
-						else
-							object = getGameObject(ID);
+                        GameObject* object = NULL;
+                        if(getGameObject(ID) == NULL)
+                            object = createGameObject(classID, ID);
+                        else
+                            object = getGameObject(ID);
                         
                         applyProperties(object, &properties);
                         // Placing the actor a a little bit higher in the scene. The actor will fall onto ground.
                         // Avoiding problems with the physics, because the character the creature is transfixed to ground
                         object->setProperty(GameObject::PROPERTY_POSITION, 
-                            Property(object->getProperty(GameObject::PROPERTY_POSITION).toVector3() + Ogre::Vector3(0.0f,0.01f,0.0f)));
+	                        Property(object->getProperty(GameObject::PROPERTY_POSITION).toVector3() + Ogre::Vector3(0.0f,0.01f,0.0f)));
                         object->setState(state);
                     }
                 }



From timm at mail.berlios.de  Thu Feb 21 22:52:02 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Thu, 21 Feb 2008 22:52:02 +0100
Subject: [Dsa-hl-svn] r4075 - in rl/trunk/engine: core/include core/src
	ui/src
Message-ID: <200802212152.m1LLq2dV009708@sheep.berlios.de>

Author: timm
Date: 2008-02-21 22:51:56 +0100 (Thu, 21 Feb 2008)
New Revision: 4075

Modified:
   rl/trunk/engine/core/include/SaveGameManager.h
   rl/trunk/engine/core/src/SaveGameManager.cpp
   rl/trunk/engine/ui/src/GameSaveLoadWindow.cpp
   rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp
Log:
keying save games by name and module id

Modified: rl/trunk/engine/core/include/SaveGameManager.h
===================================================================
--- rl/trunk/engine/core/include/SaveGameManager.h	2008-02-20 23:57:22 UTC (rev 4074)
+++ rl/trunk/engine/core/include/SaveGameManager.h	2008-02-21 21:51:56 UTC (rev 4075)
@@ -63,7 +63,7 @@
 
     typedef std::multimap<int,SaveGameData*> SaveGameDataOrderMap;
 
-    typedef std::map<CeGuiString, SaveGameFile*> SaveGameEntryMap;
+    typedef std::map<std::pair<CeGuiString,CeGuiString>, SaveGameFile*> SaveGameEntryMap; //pair: save game name, module id
 
     class _RlCoreExport SaveGameManager : public Ogre::Singleton<SaveGameManager>, public Ogre::ScriptLoader
     {
@@ -75,9 +75,9 @@
         SaveGameEntryMap listSaveGames(const CeGuiString &moduleId);
         void saveSaveGameFile(const CeGuiString &name);
         void loadSaveGameFile(const CeGuiString &name, const CeGuiString& moduleID);
-        void deleteSaveGameFile(const CeGuiString &name);
-        bool SaveGameFileExists(const CeGuiString &name);
-        SaveGameFile* getSaveGameFile(const CeGuiString &name);
+        void deleteSaveGameFile(const CeGuiString &name, const CeGuiString &moduleId);
+        bool SaveGameFileExists(const CeGuiString &name, const CeGuiString &moduleId);
+        SaveGameFile* getSaveGameFile(const CeGuiString &name, const CeGuiString &moduleId);
 
         virtual const Ogre::StringVector&  getScriptPatterns(void) const;
         virtual void parseScript(Ogre::DataStreamPtr &stream, const Ogre::String &groupName);

Modified: rl/trunk/engine/core/src/SaveGameManager.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveGameManager.cpp	2008-02-20 23:57:22 UTC (rev 4074)
+++ rl/trunk/engine/core/src/SaveGameManager.cpp	2008-02-21 21:51:56 UTC (rev 4075)
@@ -82,7 +82,7 @@
         SaveGameEntryMap entries;
         for(SaveGameEntryMap::const_iterator iter = mSaveGames.begin(); iter != mSaveGames.end(); iter++)
         {
-            if(iter->second->getProperty(SaveGameFile::PROPERTY_MODULEID).toString() == moduleId)
+            if(iter->first.second == moduleId)
             {
                 entries[iter->first] = iter->second;
             }
@@ -102,7 +102,7 @@
         file->setProperty(SaveGameFile::PROPERTY_TIME, Property(printTimeAsString(localTime)));
         file->setProperty(SaveGameFile::PROPERTY_MODULEID, Property(CoreSubsystem::getSingleton().getActiveAdventureModule()->getId()));
 
-        mSaveGames[name] = file;
+        mSaveGames[std::pair<CeGuiString,CeGuiString>(name, file->getProperty(SaveGameFile::PROPERTY_MODULEID).toString())] = file;
 
         SaveGameFileWriter writer;
         writer.buildSaveGameFile(file, mSaveGameDataOrderMap);
@@ -115,14 +115,14 @@
         MessagePump::getSingleton().sendMessage<MessageType_SaveGameSaved>();
     }
 
-    void SaveGameManager::loadSaveGameFile(const CeGuiString &name, const CeGuiString &moduleID)
+    void SaveGameManager::loadSaveGameFile(const CeGuiString &name, const CeGuiString &moduleId)
     {
-        if(SaveGameFileExists(name))
+        if(SaveGameFileExists(name, moduleId))
         {
             MessagePump::getSingleton().sendMessage<MessageType_SaveGameLoading>();
 
             SaveGameFile file(name);
-            file.setProperty(SaveGameFile::PROPERTY_MODULEID, Property(moduleID));
+            file.setProperty(SaveGameFile::PROPERTY_MODULEID, Property(moduleId));
             SaveGameFileReader reader;
             reader.parseSaveGameFile(&file, mSaveGameDataOrderMap);
             ///@todo: SaveGameReader
@@ -131,26 +131,26 @@
         }
     }
 
-    void SaveGameManager::deleteSaveGameFile(const CeGuiString &name)
+    void SaveGameManager::deleteSaveGameFile(const CeGuiString &name, const CeGuiString &moduleId)
     {
-        if(SaveGameFileExists(name))
+        if(SaveGameFileExists(name, moduleId))
         {
-            static_cast<SaveGameFile*>(mSaveGames[name])->deleteFileFromStorage();
-            delete mSaveGames[name];
-            mSaveGames.erase(name);
+            static_cast<SaveGameFile*>(mSaveGames[std::pair<CeGuiString,CeGuiString>(name, moduleId)])->deleteFileFromStorage();
+            delete mSaveGames[std::pair<CeGuiString,CeGuiString>(name, moduleId)];
+            mSaveGames.erase(std::pair<CeGuiString,CeGuiString>(name, moduleId));
         }
     }
 
-    bool SaveGameManager::SaveGameFileExists(const CeGuiString &name)
+    bool SaveGameManager::SaveGameFileExists(const CeGuiString &name, const CeGuiString &moduleId)
     {
-        if(mSaveGames.find(name) != mSaveGames.end())
+        if(mSaveGames.find(std::pair<CeGuiString,CeGuiString>(name, moduleId)) != mSaveGames.end())
             return true;
         return false;
     }
 
-    SaveGameFile* SaveGameManager::getSaveGameFile(const CeGuiString &name)
+    SaveGameFile* SaveGameManager::getSaveGameFile(const CeGuiString &name, const CeGuiString &moduleId)
     {
-        SaveGameEntryMap::const_iterator it = mSaveGames.find(name);
+        SaveGameEntryMap::const_iterator it = mSaveGames.find(std::pair<CeGuiString,CeGuiString>(name, moduleId));
         if(it != mSaveGames.end())
             return it->second;
         return NULL;
@@ -179,7 +179,7 @@
         SaveGameFileReader reader;
         reader.parseSaveGameFileHeader(stream, groupName, file);
         
-        mSaveGames[name] = file;
+        mSaveGames[std::pair<CeGuiString,CeGuiString>(name, file->getProperty(SaveGameFile::PROPERTY_MODULEID).toString())] = file;
     }
 
     void SaveGameManager::registerSaveGameData(SaveGameData* data)

Modified: rl/trunk/engine/ui/src/GameSaveLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/GameSaveLoadWindow.cpp	2008-02-20 23:57:22 UTC (rev 4074)
+++ rl/trunk/engine/ui/src/GameSaveLoadWindow.cpp	2008-02-21 21:51:56 UTC (rev 4075)
@@ -120,7 +120,7 @@
         if(filename != "")
         {
 
-            if(SaveGameManager::getSingleton().SaveGameFileExists(filename))
+            if(SaveGameManager::getSingleton().SaveGameFileExists(filename, CoreSubsystem::getSingleton().getActiveAdventureModule()->getId()))
                 SaveGameManager::getSingleton().loadSaveGameFile(filename, CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
             else
             {
@@ -163,9 +163,9 @@
     bool GameSaveLoadWindow::handleDeleteEvent()
     {
         LOG_MESSAGE(Logger::UI, "Delete Button pressed");
-        if(SaveGameManager::getSingleton().SaveGameFileExists(mFilename->getText()))
+        if(SaveGameManager::getSingleton().SaveGameFileExists(mFilename->getText(), CoreSubsystem::getSingleton().getActiveAdventureModule()->getId()))
         {
-            SaveGameManager::getSingleton().deleteSaveGameFile(mFilename->getText());
+            SaveGameManager::getSingleton().deleteSaveGameFile(mFilename->getText(), CoreSubsystem::getSingleton().getActiveAdventureModule()->getId());
             listSaveGames();
         }
         return true;
@@ -184,7 +184,7 @@
 
         for(SaveGameEntryMap::iterator it = saveGames.begin(); it != saveGames.end(); it++)
         {
-            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->first), 0, saveGameNum);
+            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->first.first), 0, saveGameNum);
             mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->second->getProperty(SaveGameFile::PROPERTY_TIME)), 1, saveGameNum);
             saveGameNum++;
         }

Modified: rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp	2008-02-20 23:57:22 UTC (rev 4074)
+++ rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp	2008-02-21 21:51:56 UTC (rev 4075)
@@ -141,7 +141,7 @@
 
         for(SaveGameEntryMap::iterator it = saveGames.begin(); it != saveGames.end(); it++)
         {
-            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->first), 0, saveGameNum);
+            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->first.first), 0, saveGameNum);
             mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->second->getProperty(SaveGameFile::PROPERTY_MODULEID).toString()), 1, saveGameNum);
             LOG_MESSAGE(Logger::UI, "Module ID: " + it->second->getProperty(SaveGameFile::PROPERTY_MODULEID).toString());
             mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->second->getProperty(SaveGameFile::PROPERTY_TIME).toString()), 2, saveGameNum);



From timm at mail.berlios.de  Fri Feb 22 00:23:14 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Fri, 22 Feb 2008 00:23:14 +0100
Subject: [Dsa-hl-svn] r4076 - rl/trunk/engine/ui/src
Message-ID: <200802212323.m1LNNEAL019159@sheep.berlios.de>

Author: timm
Date: 2008-02-22 00:23:12 +0100 (Fri, 22 Feb 2008)
New Revision: 4076

Modified:
   rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp
Log:
handle delete save games in main menu load window

Modified: rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp	2008-02-21 21:51:56 UTC (rev 4075)
+++ rl/trunk/engine/ui/src/MainMenuLoadWindow.cpp	2008-02-21 23:23:12 UTC (rev 4076)
@@ -125,6 +125,14 @@
     {
         LOG_MESSAGE(Logger::UI, "Delete Button pressed");
 
+        if(mSaveGameTable->getFirstSelectedItem())
+		{
+            CEGUI::uint SelectedRow = mSaveGameTable->getRowWithID(mSaveGameTable->getFirstSelectedItem()->getID());
+            CeGuiString moduleName = mSaveGameTable->getItemAtGridReference(CEGUI::MCLGridRef(SelectedRow,1))->getText();
+            CeGuiString saveGameName = mSaveGameTable->getItemAtGridReference(CEGUI::MCLGridRef(SelectedRow,0))->getText();
+            SaveGameManager::getSingleton().deleteSaveGameFile(saveGameName, moduleName);
+        }
+
         return true;
     }
 
@@ -142,7 +150,7 @@
         for(SaveGameEntryMap::iterator it = saveGames.begin(); it != saveGames.end(); it++)
         {
             mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->first.first), 0, saveGameNum);
-            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->second->getProperty(SaveGameFile::PROPERTY_MODULEID).toString()), 1, saveGameNum);
+            mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->first.second), 1, saveGameNum);
             LOG_MESSAGE(Logger::UI, "Module ID: " + it->second->getProperty(SaveGameFile::PROPERTY_MODULEID).toString());
             mSaveGameTable->setItem(new CEGUI::ListboxTextItem(it->second->getProperty(SaveGameFile::PROPERTY_TIME).toString()), 2, saveGameNum);
             saveGameNum++;



From alassion at mail.berlios.de  Fri Feb 22 16:39:12 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Fri, 22 Feb 2008 16:39:12 +0100
Subject: [Dsa-hl-svn] r4077 - in modules/kanalisation: . maps
	materials/textures scripts/maps
Message-ID: <200802221539.m1MFdCVL019837@sheep.berlios.de>

Author: alassion
Date: 2008-02-22 16:37:29 +0100 (Fri, 22 Feb 2008)
New Revision: 4077

Added:
   modules/kanalisation/kanalisation.material
   modules/kanalisation/maps/boden_01.mesh
   modules/kanalisation/maps/boden_eingang.mesh
   modules/kanalisation/maps/boden_kana.mesh
   modules/kanalisation/maps/brunnen.mesh
   modules/kanalisation/maps/felswand_eingestuerzt.mesh
   modules/kanalisation/maps/fence.001.mesh
   modules/kanalisation/maps/fence_02.mesh
   modules/kanalisation/maps/gaenge_komplett.mesh
   modules/kanalisation/maps/gitter_01.mesh
   modules/kanalisation/maps/gitter_02.mesh
   modules/kanalisation/maps/gitter_03.mesh
   modules/kanalisation/maps/grasbueschel.001.mesh
   modules/kanalisation/maps/grasbueschel.mesh
   modules/kanalisation/maps/kisten_01.mesh
   modules/kanalisation/maps/moderbalken_01.mesh
   modules/kanalisation/maps/moderbalken_02.mesh
   modules/kanalisation/maps/raum_01.mesh
   modules/kanalisation/maps/saeule_04.001.mesh
   modules/kanalisation/maps/smuggler.mesh
   modules/kanalisation/maps/stuetzpfeiler_quer.mesh
   modules/kanalisation/maps/stuetzwand.mesh
   modules/kanalisation/maps/torboegen.mesh
   modules/kanalisation/maps/treppe_02.mesh
   modules/kanalisation/maps/wand_03.mesh
   modules/kanalisation/maps/wand_04.mesh
   modules/kanalisation/maps/wasser.mesh
   modules/kanalisation/maps/wasser_raum_02.mesh
   modules/kanalisation/maps/wurzeln_02.mesh
   modules/kanalisation/maps/wurzeln_03.mesh
   modules/kanalisation/maps/wurzeln_alle.001.mesh
   modules/kanalisation/maps/wurzeln_klein.mesh
   modules/kanalisation/materials/textures/grasbueschel_kana.png
   modules/kanalisation/materials/textures/nat_wellen.dds
Modified:
   modules/kanalisation/maps/Cube.010.mesh
   modules/kanalisation/maps/Cube.013.mesh
   modules/kanalisation/maps/Plane.011.mesh
   modules/kanalisation/maps/boden_fels.mesh
   modules/kanalisation/maps/boden_kies.mesh
   modules/kanalisation/maps/fence.mesh
   modules/kanalisation/maps/kana_lights.rlmap.xml
   modules/kanalisation/maps/kanalisation.material
   modules/kanalisation/maps/kanalisation.scene
   modules/kanalisation/maps/pilze.001.mesh
   modules/kanalisation/maps/randsteine_01.mesh
   modules/kanalisation/maps/randsteine_02.mesh
   modules/kanalisation/maps/randsteine_03.mesh
   modules/kanalisation/maps/randsteine_04.mesh
   modules/kanalisation/maps/saeule_01.002.mesh
   modules/kanalisation/maps/saeule_01.003.mesh
   modules/kanalisation/maps/saeule_01.mesh
   modules/kanalisation/maps/saeule_02.mesh
   modules/kanalisation/maps/saeule_03.mesh
   modules/kanalisation/maps/saeule_04.mesh
   modules/kanalisation/maps/saeule_05.mesh
   modules/kanalisation/maps/saeule_06.mesh
   modules/kanalisation/maps/saeule_07.001.mesh
   modules/kanalisation/maps/saeule_07.mesh
   modules/kanalisation/maps/saeule_08.mesh
   modules/kanalisation/maps/saeule_09.002.mesh
   modules/kanalisation/maps/saeule_09.004.mesh
   modules/kanalisation/maps/saeule_09.006.mesh
   modules/kanalisation/maps/saeule_09.007.mesh
   modules/kanalisation/maps/saeule_09.008.mesh
   modules/kanalisation/maps/saeule_09.009.mesh
   modules/kanalisation/maps/saeule_09.mesh
   modules/kanalisation/maps/saeulen.004.mesh
   modules/kanalisation/maps/treppe_01.mesh
   modules/kanalisation/maps/tuern.mesh
   modules/kanalisation/maps/wurzeln_alle.mesh
   modules/kanalisation/materials/textures/Thumbs.db
   modules/kanalisation/scripts/maps/kanalisation.rb
Log:
bugged version - messed up materials

Added: modules/kanalisation/kanalisation.material
===================================================================
--- modules/kanalisation/kanalisation.material	2008-02-21 23:23:12 UTC (rev 4076)
+++ modules/kanalisation/kanalisation.material	2008-02-22 15:37:29 UTC (rev 4077)
@@ -0,0 +1,459 @@
+material grasbueschel/SOLID
+{ 
+   technique 
+   { 
+      pass 
+      { 
+      ambient 0.609804 0.609804 0.609804 1
+			diffuse 0.631373 0.631373 0.631373 1
+			specular 0 0 0 1 10
+                         // Rendert beidseitig 
+         cull_hardware none 
+         cull_software none 
+	 alpha_rejection greater 215 
+
+         texture_unit 
+         { 
+            texture grasbueschel_kana.png             
+	    filtering linear linear linear 
+         } 
+      } 
+   } 
+material treppe_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material wand_03/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.020/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.021/SOLID/TEX/boden_kana.png/VertCol: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material smuggler/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material grasbueschel/SOLID/TEX/grasbueschel_kana.png
+{ 
+   technique 
+   { 
+      pass 
+      { 
+      ambient 0.609804 0.609804 0.609804 1
+			diffuse 0.631373 0.631373 0.631373 1
+			specular 0 0 0 1 10
+                         // Rendert beidseitig 
+         cull_hardware none 
+         cull_software none 
+	 alpha_rejection greater 215 
+
+         texture_unit 
+         { 
+            texture grasbueschel_kana.png             
+	    filtering linear linear linear 
+         } 
+      } 
+   } 
+material wasser/SOLID: nat_wasser_see
+{
+    technique hlsl
+    {
+        pass
+        {
+            texture_unit wellen_map
+            {
+                texture nat_wellen.dds
+            }
+
+            texture_unit evn_map
+            {
+                cubic_texture desert07.dds separateUV
+                tex_address_mode clamp
+            }
+
+        }
+
+    }
+
+    technique glsl
+    {
+        pass
+        {
+            texture_unit wellen_map
+            {
+                texture nat_wellen.dds
+            }
+
+            texture_unit evn_map
+            {
+                cubic_texture desert07.dds separateUV
+                tex_address_mode clamp
+            }
+        }
+    }
+}
+material smuggler/SOLID/TEX/pflaster_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap pflaster_kana.png
+set_texture_alias NormalMap pflaster_kana_normal.png
+}
+material bruecke/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material randsteine_03/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material randsteine_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material boden/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.025/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material boden_eingang/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material saeulen/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material gaenge_komplett/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material fence/SOLID/TEX/fence_kana.png
+{ 
+   technique 
+   { 
+      pass 
+      { 
+      ambient 0.609804 0.609804 0.609804 1
+			diffuse 0.631373 0.631373 0.631373 1
+			specular 0 0 0 1 10
+                         // Rendert beidseitig 
+         cull_hardware none 
+         cull_software none 
+	 alpha_rejection greater 215 
+
+         texture_unit 
+         { 
+            texture fence_kana.png             
+	    filtering linear linear linear 
+         } 
+      } 
+   } 
+} 
+material gitter_01/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material fence/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material boden_kies/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.001/SOLID/TEX/tisch_kana.png
+{
+	technique
+	{
+		pass
+		{
+			specular 0.500000 0.500000 0.500000 12.500000
+			texture_unit
+			{
+				texture tisch_kana.png
+			}
+		}
+	}
+}
+material randsteine_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material farn/SOLID/TEX/farn.png
+{ 
+   technique 
+   { 
+      pass 
+      { 
+      ambient 0.609804 0.609804 0.609804 1
+			diffuse 0.631373 0.631373 0.631373 1
+			specular 0 0 0 1 10
+                         // Rendert beidseitig 
+         cull_hardware none 
+         cull_software none 
+	 alpha_rejection greater 215 
+
+         texture_unit 
+         { 
+            texture farn.png             
+	    filtering linear linear linear 
+         } 
+      } 
+   } 
+material leiste_unten/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material felswand_eingestuerzt/SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap felsen_kana.png
+set_texture_alias NormalMap felsen_kana_normal.png
+}
+material pilze/SOLID/TEX/pilz3.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap pilz3.png
+set_texture_alias NormalMap pilz_normal.png
+}
+material gaenge_komplett/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material saeulen/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material wurzeln_02/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material fackeln/SOLID
+{
+	technique
+	{
+		pass
+		{
+			diffuse 0.800000 0.800000 0.800000
+			specular 0.500000 0.500000 0.500000 12.500000
+		}
+	}
+}
+material wurzeln/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material randsteine_04/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material wasser_raum_02/SOLID: nat_wasser_see
+{
+    technique hlsl
+    {
+        pass
+        {
+            texture_unit wellen_map
+            {
+                texture nat_wellen.dds
+            }
+
+            texture_unit evn_map
+            {
+                cubic_texture desert07.dds separateUV
+                tex_address_mode clamp
+            }
+
+        }
+
+    }
+
+    technique glsl
+    {
+        pass
+        {
+            texture_unit wellen_map
+            {
+                texture nat_wellen.dds
+            }
+
+            texture_unit evn_map
+            {
+                cubic_texture desert07.dds separateUV
+                tex_address_mode clamp
+            }
+        }
+    }
+}
+material wurzeln_alle/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material gitter_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material SOLID/TEX/kiste_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap kiste_kana.png
+set_texture_alias NormalMap kiste_kana_normal.png
+}
+material felswaende/SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap felsen_kana.png
+set_texture_alias NormalMap felsen_kana_normal.png
+}
+material bruecke.001/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material stuetzpfeiler_quer/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material treppe_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.098/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material wurzeln_03/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material Material.098/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.003/SOLID/TEX/tisch_kana.png
+{
+	technique
+	{
+		pass
+		{
+			specular 0.500000 0.500000 0.500000 12.500000
+			texture_unit
+			{
+				texture tisch_kana.png
+			}
+		}
+	}
+}
+material saeulen/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material wand/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.220/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material fackeln/SOLID/TEX/fackel_kana.png
+{
+	technique
+	{
+		pass
+		{
+			diffuse 0.800000 0.800000 0.800000
+			specular 0.500000 0.500000 0.500000 12.500000
+			texture_unit
+			{
+				texture fackel_kana.png
+			}
+		}
+	}
+}
+material Material/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.002/SOLID/TEX/tisch_kana.png
+{
+	technique
+	{
+		pass
+		{
+			specular 0.500000 0.500000 0.500000 12.500000
+			texture_unit
+			{
+				texture tisch_kana.png
+			}
+		}
+	}
+}
+material SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.026/SOLID/TEX/boden_kana.png/VertCol: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material gitter_02/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material stuetzbalken_02/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material boden_01/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material boden_felsen/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
\ No newline at end of file

Modified: modules/kanalisation/maps/Cube.010.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Cube.013.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/Plane.011.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/boden_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/boden_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/boden_eingang.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/boden_eingang.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/boden_fels.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/boden_kana.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/boden_kana.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/boden_kies.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/brunnen.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/brunnen.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/felswand_eingestuerzt.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/felswand_eingestuerzt.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/fence.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fence.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/fence.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/fence_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fence_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/gaenge_komplett.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/gaenge_komplett.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/gitter_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/gitter_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/gitter_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/gitter_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/gitter_03.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/gitter_03.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/grasbueschel.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/grasbueschel.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/grasbueschel.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/grasbueschel.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/kana_lights.rlmap.xml
===================================================================
--- modules/kanalisation/maps/kana_lights.rlmap.xml	2008-02-21 23:23:12 UTC (rev 4076)
+++ modules/kanalisation/maps/kana_lights.rlmap.xml	2008-02-22 15:37:29 UTC (rev 4077)
@@ -6,28 +6,28 @@
 			<position x="-1.39" y="6.06" z="12.84" />
 			<colourDiffuse r="0.8" g="0.7" b="0.5" />
 			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="5" constant="0.79" linear="-0.21" quadratic="0.268" />
+			<lightAttenuation range="8" constant="0.79" linear="-0.21" quadratic="0.268" />
 		</light>
 		<light name="fackkellicht2" type="point" visible="true"
 			castShadows="false">
 			<position x="11.39" y="6.06" z="9.75" />
 			<colourDiffuse r="0.8" g="0.7" b="0.5" />
 			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="5" constant="0.79" linear="-0.21" quadratic="0.268" />
+			<lightAttenuation range="8" constant="0.79" linear="-0.21" quadratic="0.268" />
 		</light>
 		<light name="fackkellicht3" type="point" visible="true"
 			castShadows="false">
 			<position x="-22.48" y="4.60" z="23.10" />
 			<colourDiffuse r="0.8" g="0.7" b="0.5" />
 			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="5" constant="0.79" linear="-0.21" quadratic="0.268" />
+			<lightAttenuation range="8" constant="0.79" linear="-0.21" quadratic="0.268" />
 		</light>
 		<light name="fackkellicht4" type="point" visible="true"
 			castShadows="false">
 			<position x="36.49" y="7.37" z="30.27" />
 			<colourDiffuse r="0.8" g="0.7" b="0.5" />
 			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="5" constant="0.79" linear="-0.21" quadratic="0.268" />
+			<lightAttenuation range="8" constant="0.79" linear="-0.21" quadratic="0.268" />
 		</light>
 	</nodes>
 	<zones>

Modified: modules/kanalisation/maps/kanalisation.material
===================================================================
--- modules/kanalisation/maps/kanalisation.material	2008-02-21 23:23:12 UTC (rev 4076)
+++ modules/kanalisation/maps/kanalisation.material	2008-02-22 15:37:29 UTC (rev 4077)
@@ -1,20 +1,36 @@
-material boden_fels/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+material grasbueschel/SOLID
+{ 
+   technique 
+   { 
+      pass 
+      { 
+      ambient 0.609804 0.609804 0.609804 1
+			diffuse 0.631373 0.631373 0.631373 1
+			specular 0 0 0 1 10
+                         // Rendert beidseitig 
+         cull_hardware none 
+         cull_software none 
+	 alpha_rejection greater 215 
+
+         texture_unit 
+         { 
+            texture grasbueschel_kana.png             
+	    filtering linear linear linear 
+         } 
+      } 
+   } 
+material treppe_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap boden_kana.png
-set_texture_alias NormalMap boden_kana_normal.png
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
 }
-material schild/SOLID/TEX/schild.png: Basic_Normalmapping_kana
+material wand_03/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap schild.png
-set_texture_alias NormalMap schild_normal.png
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
 }
-material SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+material stuetzwand/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap baumstamm_kana.png
-set_texture_alias NormalMap baumstamm_kana_normal.png
-}
-material Material.020/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
@@ -23,15 +39,69 @@
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material leiste_unten/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material grasbueschel/SOLID/TEX/grasbueschel_kana.png
+{ 
+   technique 
+   { 
+      pass 
+      { 
+      ambient 0.609804 0.609804 0.609804 1
+			diffuse 0.631373 0.631373 0.631373 1
+			specular 0 0 0 1 10
+                         // Rendert beidseitig 
+         cull_hardware none 
+         cull_software none 
+	 alpha_rejection greater 215 
+
+         texture_unit 
+         { 
+            texture grasbueschel_kana.png             
+	    filtering linear linear linear 
+         } 
+      } 
+   } 
+material wasser/SOLID : nat_wasser_see
 {
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
+    technique hlsl
+    {
+        pass
+        {
+            texture_unit wellen_map
+            {
+                texture nat_wellen.dds
+            }
+
+            texture_unit evn_map
+            {
+                cubic_texture desert07.dds separateUV
+                tex_address_mode clamp
+            }
+
+        }
+
+    }
+
+    technique glsl
+    {
+        pass
+        {
+            texture_unit wellen_map
+            {
+                texture nat_wellen.dds
+            }
+
+            texture_unit evn_map
+            {
+                cubic_texture desert07.dds separateUV
+                tex_address_mode clamp
+            }
+        }
+    }
 }
-material Material.021/SOLID/TEX/boden_kana.png/VertCol: Basic_Normalmapping_kana
+material boden_07/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap boden_kana.png
-set_texture_alias NormalMap boden_kana_normal.png
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
 }
 material smuggler/SOLID/TEX/pflaster_kana.png: Basic_Normalmapping_kana
 {
@@ -43,74 +113,127 @@
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material wand/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+material saeulen_10/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap boden_kana.png
-set_texture_alias NormalMap boden_kana_normal.png
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
 }
-material felswaende/SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
+material Material.021/SOLID/TEX/boden_kana.png/VertCol: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap felsen_kana.png
-set_texture_alias NormalMap felsen_kana_normal.png
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
 }
-material boden/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material randsteine_03/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material treppe.001/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material boden_06/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material wand/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+material randsteine_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material saeulen_08/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material boden_01.001/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap boden_kana.png
+set_texture_alias NormalMap boden_kana_normal.png
+}
+material saeulen_04/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material boden_eingang/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material saeulen_15/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material saeulen_07/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material fence/SOLID/TEX/fence_kana.png
+{ 
+   technique 
+   { 
+      pass 
+      { 
+      ambient 0.609804 0.609804 0.609804 1
+			diffuse 0.631373 0.631373 0.631373 1
+			specular 0 0 0 1 10
+                         // Rendert beidseitig 
+         cull_hardware none 
+         cull_software none 
+	 alpha_rejection greater 215 
+
+         texture_unit 
+         { 
+            texture fence_kana.png             
+	    filtering linear linear linear 
+         } 
+      } 
+   } 
+material saeulen_14/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material gitter_01/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
 set_texture_alias DiffuseMap baumstamm_kana.png
 set_texture_alias NormalMap baumstamm_kana_normal.png
 }
-material saeulen/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material boden_04/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material Material.002/SOLID/TEX/tisch_kana.png
+material fence/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
-	technique
-	{
-		pass
-		{
-			specular 0.500000 0.500000 0.500000 12.500000
-			texture_unit
-			{
-				texture tisch_kana.png
-			}
-		}
-	}
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
 }
-material Material.025/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material treppe_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material boden_kies/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material boden_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material Material.001/SOLID/TEX/tisch_kana.png
+material saeulen_03/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
-	technique
-	{
-		pass
-		{
-			specular 0.500000 0.500000 0.500000 12.500000
-			texture_unit
-			{
-				texture tisch_kana.png
-			}
-		}
-	}
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
 }
+material randsteine_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material boden_kana/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
 material farn/SOLID/TEX/farn.png
 { 
    technique 
@@ -132,66 +255,168 @@
          } 
       } 
    } 
-} 
-material fence/SOLID/TEX/fence_kana.png
+material saeulen_06/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
-	technique
-	{
-		pass
-		{
-			alpha_rejection greater 215 
-
-			texture_unit
-			{
-				texture fence_kana.png  // Mit Alphakanal
-			}
-		}
-	}
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
 }
 material pilze/SOLID/TEX/pilz3.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap pilz3.png
 set_texture_alias NormalMap pilz_normal.png
 }
-material wurzeln/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+material gaenge_komplett/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material boden_05/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material wurzeln_02/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
 set_texture_alias DiffuseMap baumstamm_kana.png
 set_texture_alias NormalMap baumstamm_kana_normal.png
 }
-material SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
+material fackeln/SOLID: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap felsen_kana.png
-set_texture_alias NormalMap felsen_kana_normal.png
+set_texture_alias DiffuseMap fackel_kana.png
+set_texture_alias NormalMap fackel_kana_normal.png
 }
-material Material.098/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+material boden_13/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap boden_kana.png
-set_texture_alias NormalMap boden_kana_normal.png
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
 }
-material stuetzbalken/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+material randsteine_04/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material wasser_raum_02/SOLID : nat_wasser_see
+{
+    technique hlsl
+    {
+        pass
+        {
+            texture_unit wellen_map
+            {
+                texture nat_wellen.dds
+            }
+
+            texture_unit evn_map
+            {
+                cubic_texture desert07.dds separateUV
+                tex_address_mode clamp
+            }
+
+        }
+
+    }
+
+    technique glsl
+    {
+        pass
+        {
+            texture_unit wellen_map
+            {
+                texture nat_wellen.dds
+            }
+
+            texture_unit evn_map
+            {
+                cubic_texture desert07.dds separateUV
+                tex_address_mode clamp
+            }
+        }
+    }
+}
+material brunnen/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material wurzeln_alle/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
 set_texture_alias DiffuseMap baumstamm_kana.png
 set_texture_alias NormalMap baumstamm_kana_normal.png
 }
+material kisten_01/SOLID/TEX/kiste_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap kiste_kana.png
+set_texture_alias NormalMap kiste_kana_normal.png
+}
+material gitter_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material felswaende/SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap felsen_kana.png
+set_texture_alias NormalMap felsen_kana_normal.png
+}
 material bruecke.001/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material Material.098/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material boden_07/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material wurzeln_klein/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material stuetzbalken/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material felswand_eingestuerzt/SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap felsen_kana.png
+set_texture_alias NormalMap felsen_kana_normal.png
+}
+material gitter_03/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material wurzeln_03/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material saeulen_09/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material wand/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material treppe/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material sauelen_13/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material boden_07/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material dagger_01/SOLID/TEX/dagger.png: Basic_Normalmapping_kana
+material saeulen_02/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap dagger.png
-set_texture_alias NormalMap dagger_normal.png
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
 }
 material Material.003/SOLID/TEX/tisch_kana.png
 {
@@ -207,17 +432,17 @@
 		}
 	}
 }
-material saeulen/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+material saeulen_12/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap saeule_kana.png
 set_texture_alias NormalMap saeule_kana_normal.png
 }
-material wand/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material boden_03/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
 }
-material Material.220/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+material saeulen_05/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap saeule_kana.png
 set_texture_alias NormalMap saeule_kana_normal.png
@@ -227,11 +452,49 @@
 set_texture_alias DiffuseMap fackel_kana.png
 set_texture_alias NormalMap fackel_kana_normal.png
 }
+material boden_03/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material stuetzpfeiler_quer/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material Material.001/SOLID/TEX/tisch_kana.png
+{
+	technique
+	{
+		pass
+		{
+			specular 0.500000 0.500000 0.500000 12.500000
+			texture_unit
+			{
+				texture tisch_kana.png
+			}
+		}
+	}
+}
 material Material/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap boden_kana.png
-set_texture_alias NormalMap boden_kana_normal.png
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
 }
+material Material.002/SOLID/TEX/tisch_kana.png
+{
+	technique
+	{
+		pass
+		{
+			specular 0.500000 0.500000 0.500000 12.500000
+			texture_unit
+			{
+				texture tisch_kana.png
+			}
+		}
+	}
+}
 material SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
 {
 set_texture_alias DiffuseMap wand_kana.png
@@ -242,29 +505,28 @@
 set_texture_alias DiffuseMap boden_kana.png
 set_texture_alias NormalMap boden_kana_normal.png
 }
-material SOLID/TEX/kiste_kana.png: Basic_Normalmapping_kana
+material gitter_02/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap kiste_kana.png
-set_texture_alias NormalMap kiste_kana_normal.png
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
 }
-material randsteine_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material saeulen_11/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
 }
-material randsteine_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material moderbalken_01/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
 }
-material randsteine_03/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material boden_felsen/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
+set_texture_alias DiffuseMap boden_kana.png
+set_texture_alias NormalMap boden_kana_normal.png
 }
-material randsteine_04/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+material gaenge_komplett/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
 {
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
+set_texture_alias DiffuseMap boden_kana.png
+set_texture_alias NormalMap boden_kana_normal.png
 }
-

Modified: modules/kanalisation/maps/kanalisation.scene
===================================================================
--- modules/kanalisation/maps/kanalisation.scene	2008-02-21 23:23:12 UTC (rev 4076)
+++ modules/kanalisation/maps/kanalisation.scene	2008-02-22 15:37:29 UTC (rev 4077)
@@ -1,16 +1,16 @@
 <scene formatVersion="0.2.0">
   <nodes>
-    <node name="saeule_07">
-      <position x="1.174055" y="10.726652" z="6.341633"/>
+    <node name="boden_kana">
+      <position x="1.517232" y="1.741509" z="4.047132"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_07" meshFile="saeule_07.mesh"/>
+      <entity name="boden_kana" meshFile="boden_kana.mesh"/>
     </node>
-    <node name="brunnen">
-      <position x="140.546295" y="74.190155" z="378.740021"/>
+    <node name="gitter.001">
+      <position x="6.422711" y="2.751102" z="2.031976"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="brunnen" meshFile="Cylinder.mesh"/>
+      <entity name="gitter.001" meshFile="boden_eingang.mesh"/>
     </node>
     <node name="saeule_01">
       <position x="7.874129" y="9.400857" z="16.403053"/>
@@ -30,30 +30,36 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_06" meshFile="saeule_06.mesh"/>
     </node>
-    <node name="dagger_01">
-      <position x="9.556169" y="4.026599" z="5.851754"/>
-      <rotation qx="-0.000270" qy="0.735596" qz="0.000293" qw="0.677421"/>
-      <scale x="0.017321" y="0.017321" z="0.017321"/>
-      <entity name="dagger_01" meshFile="dagger_01.mesh"/>
+    <node name="weg2_raum_02">
+      <position x="0.000000" y="-0.112965" z="64.748039"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="weg2_raum_02" meshFile="stuetzwand.mesh"/>
     </node>
-    <node name="tuern">
-      <position x="12.966056" y="4.342111" z="16.671421"/>
+    <node name="wurzeln_02.001">
+      <position x="2.790514" y="4.442500" z="12.894696"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="tuern" meshFile="tuern.mesh"/>
+      <entity name="wurzeln_02.001" meshFile="wurzeln_alle_02.mesh"/>
     </node>
-    <node name="bruecke">
-      <position x="2.822959" y="3.865546" z="7.881136"/>
+    <node name="saeule_04.001">
+      <position x="6.377748" y="8.456436" z="50.994389"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="bruecke" meshFile="bruecke.mesh"/>
+      <entity name="saeule_04.001" meshFile="saeule_04.001.mesh"/>
     </node>
-    <node name="pilze_gruen">
-      <position x="6.899021" y="-0.008500" z="13.837756"/>
+    <node name="saeule_05">
+      <position x="7.897333" y="9.400856" z="3.944559"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="pilze_gruen" meshFile="pilze.001.mesh"/>
+      <entity name="saeule_05" meshFile="saeule_05.mesh"/>
     </node>
+    <node name="torboegen">
+      <position x="-11.712984" y="2.751104" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="torboegen" meshFile="torboegen.mesh"/>
+    </node>
     <node name="stuetzbalken">
       <position x="38.693901" y="9.522685" z="30.678297"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -66,23 +72,23 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_04" meshFile="saeule_04.mesh"/>
     </node>
-    <node name="gitter.001">
-      <position x="6.422711" y="2.751102" z="2.031976"/>
+    <node name="grasbueschel_decke">
+      <position x="-5.965245" y="4.171327" z="35.959496"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gitter.001" meshFile="Cube.mesh"/>
+      <entity name="grasbueschel_decke" meshFile="grasbueschel.001.mesh"/>
     </node>
     <node name="gitter_02.001">
       <position x="15.776218" y="2.466985" z="58.193405"/>
       <rotation qx="-0.000393" qy="-0.162435" qz="-0.000065" qw="0.986719"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gitter_02.001" meshFile="gitter.002.mesh"/>
+      <entity name="gitter_02.001" meshFile="gitter_03.mesh"/>
     </node>
-    <node name="saeule_03">
-      <position x="9.601151" y="9.400856" z="6.224481"/>
+    <node name="farn">
+      <position x="-2.434886" y="-1.413306" z="2.648438"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_03" meshFile="saeule_03.mesh"/>
+      <entity name="farn" meshFile="farn.mesh"/>
     </node>
     <node name="randsteine_02">
       <position x="-2.300682" y="0.000000" z="0.000000"/>
@@ -94,38 +100,38 @@
       <position x="4.292805" y="-9.415191" z="25.157330"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="kisten_smuggler" meshFile="Cube.011.mesh"/>
+      <entity name="kisten_smuggler" meshFile="kisten_01.mesh"/>
     </node>
-    <node name="farn">
-      <position x="-2.434886" y="-1.413306" z="2.648438"/>
+    <node name="wurzeln_02">
+      <position x="3.317402" y="3.192856" z="3.838075"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="farn" meshFile="farn.mesh"/>
+      <entity name="wurzeln_02" meshFile="wurzeln_alle_02.mesh"/>
     </node>
+    <node name="wurzeln_03">
+      <position x="3.815631" y="3.215424" z="3.961683"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="wurzeln_03" meshFile="wurzeln_klein.mesh"/>
+    </node>
     <node name="felsen_hoehle">
       <position x="30.294416" y="7.783535" z="26.360363"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="felsen_hoehle" meshFile="Plane.011.mesh"/>
     </node>
-    <node name="moderholz">
-      <position x="37.592186" y="5.749560" z="32.072422"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
-      <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="moderholz" meshFile="stuetzbalken.001.mesh"/>
+    <node name="abfluss">
+      <position x="-4.812940" y="56.416122" z="38.646969"/>
+      <rotation qx="0.575073" qy="-0.396856" qz="0.410965" qw="0.585580"/>
+      <scale x="0.753700" y="0.753700" z="0.753700"/>
+      <entity name="abfluss" meshFile="fence.001.mesh"/>
     </node>
-    <node name="Cube">
-      <position x="28.036366" y="8.417215" z="36.681553"/>
+    <node name="bruecke">
+      <position x="2.822959" y="3.865546" z="7.881136"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube" meshFile="Cube.006.mesh"/>
+      <entity name="bruecke" meshFile="bruecke.mesh"/>
     </node>
-    <node name="tuer_eingang">
-      <position x="1.517232" y="1.741509" z="4.047132"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
-      <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="tuer_eingang" meshFile="Cube.004.mesh"/>
-    </node>
     <node name="tischdecke">
       <position x="-21.677284" y="2.216421" z="24.734226"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -144,6 +150,12 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="tisch_smuggler" meshFile="Cube.005.mesh"/>
     </node>
+    <node name="pilze">
+      <position x="6.899021" y="-0.008500" z="13.837756"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="pilze" meshFile="pilze.001.mesh"/>
+    </node>
     <node name="decke_eingang">
       <position x="1.517232" y="1.741509" z="4.047132"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -152,15 +164,15 @@
     </node>
     <node name="gaenge_01">
       <position x="-11.712984" y="2.751104" z="38.873230"/>
-      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gaenge_01" meshFile="gaenge.001.mesh"/>
+      <entity name="gaenge_01" meshFile="gaenge_komplett.mesh"/>
     </node>
-    <node name="schild">
-      <position x="10.599316" y="3.494219" z="5.872530"/>
+    <node name="saeule_09">
+      <position x="-1.452938" y="9.400857" z="16.482481"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="schild" meshFile="schild.mesh"/>
+      <entity name="saeule_09" meshFile="saeule_09.mesh"/>
     </node>
     <node name="fackeln_g2.001">
       <position x="2.625504" y="3.107027" z="55.503487"/>
@@ -180,6 +192,12 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="fackeln_g2.003" meshFile="fackeln.004.mesh"/>
     </node>
+    <node name="gitter_01">
+      <position x="-11.714610" y="2.751104" z="38.344952"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gitter_01" meshFile="gitter_01.mesh"/>
+    </node>
     <node name="saeulen_smuggler">
       <position x="-27.566433" y="7.446745" z="22.737108"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -187,16 +205,16 @@
       <entity name="saeulen_smuggler" meshFile="saeule_01.002.mesh"/>
     </node>
     <node name="gitter_02">
-      <position x="-4.573676" y="2.466985" z="65.796661"/>
-      <rotation qx="-0.000393" qy="-0.162435" qz="-0.000065" qw="0.986719"/>
+      <position x="-23.249357" y="2.751107" z="102.979912"/>
+      <rotation qx="-0.000389" qy="-0.208480" qz="-0.000083" qw="0.978027"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gitter_02" meshFile="gitter.001.mesh"/>
+      <entity name="gitter_02" meshFile="gitter_02.mesh"/>
     </node>
-    <node name="Cube.001">
-      <position x="48.191696" y="-5.594019" z="27.380192"/>
+    <node name="saeule_07">
+      <position x="1.174055" y="10.726652" z="6.341633"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.001" meshFile="Cube.012.mesh"/>
+      <entity name="saeule_07" meshFile="saeule_07.mesh"/>
     </node>
     <node name="saeule_09.004">
       <position x="-0.203952" y="8.280134" z="64.884682"/>
@@ -204,23 +222,23 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_09.004" meshFile="saeule_09.006.mesh"/>
     </node>
-    <node name="saeule_05">
-      <position x="7.897333" y="9.400856" z="3.944559"/>
+    <node name="wasser_raum_02">
+      <position x="5.182011" y="3.397130" z="57.059341"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_05" meshFile="saeule_05.mesh"/>
+      <entity name="wasser_raum_02" meshFile="wasser_raum_02.mesh"/>
     </node>
-    <node name="Cube.002">
-      <position x="4.733883" y="6.611897" z="56.931644"/>
+    <node name="brunnen">
+      <position x="140.546295" y="74.190155" z="378.740021"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.002" meshFile="Cube.013.mesh"/>
+      <entity name="brunnen" meshFile="brunnen.mesh"/>
     </node>
-    <node name="Cube.005">
-      <position x="3.867190" y="0.000002" z="51.820351"/>
+    <node name="saeule_03">
+      <position x="9.601151" y="9.400856" z="6.224481"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.005" meshFile="Cube.009.mesh"/>
+      <entity name="saeule_03" meshFile="saeule_03.mesh"/>
     </node>
     <node name="saeule_02">
       <position x="7.874129" y="9.400857" z="11.051473"/>
@@ -228,17 +246,17 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_02" meshFile="saeule_02.mesh"/>
     </node>
-    <node name="wand">
-      <position x="-11.712984" y="2.751104" z="38.873230"/>
-      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
+    <node name="decke_raum_02">
+      <position x="4.733883" y="6.611897" z="56.931644"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="wand" meshFile="wand.mesh"/>
+      <entity name="decke_raum_02" meshFile="Cube.013.mesh"/>
     </node>
-    <node name="Cube.006">
-      <position x="0.000000" y="0.000003" z="64.748039"/>
+    <node name="moderholz">
+      <position x="37.592186" y="5.749560" z="32.072422"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="Cube.006" meshFile="Cube.018.mesh"/>
+      <entity name="moderholz" meshFile="moderbalken_01.mesh"/>
     </node>
     <node name="saeulen.002">
       <position x="0.743736" y="4.219784" z="8.508488"/>
@@ -258,17 +276,17 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_09.006" meshFile="saeule_09.008.mesh"/>
     </node>
-    <node name="saeule_09">
-      <position x="-1.452938" y="9.400857" z="16.482481"/>
+    <node name="grasbueschel">
+      <position x="-6.029057" y="3.397130" z="36.149834"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_09" meshFile="saeule_09.mesh"/>
+      <entity name="grasbueschel" meshFile="grasbueschel.mesh"/>
     </node>
     <node name="raum_02">
       <position x="4.733883" y="6.611897" z="56.931644"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="raum_02" meshFile="Cube.015.mesh"/>
+      <entity name="raum_02" meshFile="wand_03.mesh"/>
     </node>
     <node name="randsteine_03.001">
       <position x="0.279860" y="1.563207" z="7.637593"/>
@@ -282,11 +300,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="fackeln" meshFile="fackeln.mesh"/>
     </node>
-    <node name="boden">
-      <position x="4.733883" y="6.611897" z="56.931644"/>
+    <node name="saeule_09.007">
+      <position x="2.816734" y="8.280134" z="64.794533"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="boden" meshFile="Cube.016.mesh"/>
+      <entity name="saeule_09.007" meshFile="saeule_09.009.mesh"/>
     </node>
     <node name="smuggler_boden">
       <position x="-21.569408" y="4.746182" z="26.013494"/>
@@ -294,18 +312,30 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="smuggler_boden" meshFile="Cube.010.mesh"/>
     </node>
+    <node name="raum_01">
+      <position x="-11.712984" y="2.751104" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="raum_01" meshFile="raum_01.mesh"/>
+    </node>
+    <node name="wasser">
+      <position x="-4.597392" y="3.397130" z="35.853691"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="wasser" meshFile="wasser.mesh"/>
+    </node>
+    <node name="wurzeln_02.002">
+      <position x="2.693319" y="4.398726" z="13.058824"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="wurzeln_02.002" meshFile="wurzeln_02.mesh"/>
+    </node>
     <node name="saeule_08">
       <position x="-1.495595" y="9.400857" z="12.471745"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_08" meshFile="saeule_08.mesh"/>
     </node>
-    <node name="wand.001">
-      <position x="6.422711" y="2.751102" z="2.040941"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
-      <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="wand.001" meshFile="Cube.003.mesh"/>
-    </node>
     <node name="saeule_09.001">
       <position x="-0.203952" y="8.280133" z="50.980743"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
@@ -330,11 +360,11 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="randsteine_03" meshFile="randsteine_03.mesh"/>
     </node>
-    <node name="saeule_09.007">
-      <position x="2.816734" y="8.280134" z="64.794533"/>
+    <node name="boden">
+      <position x="-3.738640" y="5.078989" z="26.520832"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_09.007" meshFile="saeule_09.009.mesh"/>
+      <entity name="boden" meshFile="boden_01.mesh"/>
     </node>
     <node name="randsteine_04">
       <position x="-2.300682" y="0.000000" z="0.000000"/>
@@ -342,41 +372,47 @@
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="randsteine_04" meshFile="randsteine_04.mesh"/>
     </node>
-    <node name="saeule_09.002">
-      <position x="6.353224" y="8.280133" z="50.980743"/>
-      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
-      <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="saeule_09.002" meshFile="saeule_09.003.mesh"/>
-    </node>
     <node name="saeule_09.003">
       <position x="10.100182" y="8.280133" z="50.980743"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="saeule_09.003" meshFile="saeule_09.004.mesh"/>
     </node>
-    <node name="boden_kana">
-      <position x="1.517232" y="1.741509" z="4.047132"/>
+    <node name="stuetzpfeiler_quer">
+      <position x="28.036366" y="8.417215" z="36.681553"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="boden_kana" meshFile="boden_kies.mesh"/>
+      <entity name="stuetzpfeiler_quer" meshFile="stuetzpfeiler_quer.mesh"/>
     </node>
+    <node name="felswand_eingestuerzt">
+      <position x="48.191696" y="-5.594019" z="27.380192"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="felswand_eingestuerzt" meshFile="felswand_eingestuerzt.mesh"/>
+    </node>
     <node name="gaenge_01.001">
       <position x="-11.351809" y="2.751104" z="38.873230"/>
-      <rotation qx="-0.000389" qy="-0.208818" qz="-0.000083" qw="0.977954"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gaenge_01.001" meshFile="gaenge.mesh"/>
+      <entity name="gaenge_01.001" meshFile="wand_04.mesh"/>
     </node>
+    <node name="fence_02">
+      <position x="-4.812940" y="56.416122" z="38.646969"/>
+      <rotation qx="0.575073" qy="-0.396856" qz="0.410965" qw="0.585580"/>
+      <scale x="0.753700" y="0.753700" z="0.753700"/>
+      <entity name="fence_02" meshFile="fence_02.mesh"/>
+    </node>
     <node name="treppe.001">
       <position x="19.946918" y="4.835266" z="9.672138"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
       <entity name="treppe.001" meshFile="treppe_01.mesh"/>
     </node>
-    <node name="gitter">
-      <position x="6.422711" y="2.751102" z="2.031976"/>
+    <node name="tuern">
+      <position x="12.966056" y="4.342111" z="16.671421"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="gitter" meshFile="gitter.mesh"/>
+      <entity name="tuern" meshFile="tuern.mesh"/>
     </node>
     <node name="wurzeln">
       <position x="3.815631" y="3.215424" z="3.961683"/>
@@ -388,7 +424,7 @@
       <position x="3.062176" y="3.107023" z="6.686421"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="treppe" meshFile="treppe.mesh"/>
+      <entity name="treppe" meshFile="treppe_02.mesh"/>
     </node>
     <node name="saeule_10">
       <position x="14.990063" y="9.400858" z="12.870321"/>
@@ -406,7 +442,7 @@
       <position x="-21.569408" y="4.746182" z="26.013494"/>
       <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
       <scale x="1.000000" y="1.000000" z="1.000000"/>
-      <entity name="smuggler_wand" meshFile="Cube.014.mesh"/>
+      <entity name="smuggler_wand" meshFile="smuggler.mesh"/>
     </node>
     <node name="fackeln_g2">
       <position x="15.234941" y="3.107023" z="15.800744"/>

Added: modules/kanalisation/maps/kisten_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/kisten_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/moderbalken_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/moderbalken_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/moderbalken_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/moderbalken_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/pilze.001.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/randsteine_01.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/randsteine_02.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/randsteine_03.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/randsteine_04.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/raum_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/raum_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/saeule_01.002.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_01.003.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_01.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_02.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_03.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/saeule_04.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_04.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/saeule_04.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_05.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_06.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_07.001.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_07.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_08.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_09.002.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_09.004.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_09.006.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_09.007.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_09.008.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_09.009.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeule_09.mesh
===================================================================
(Binary files differ)

Modified: modules/kanalisation/maps/saeulen.004.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/smuggler.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/smuggler.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/stuetzpfeiler_quer.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/stuetzpfeiler_quer.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/stuetzwand.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/stuetzwand.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/torboegen.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/torboegen.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/treppe_01.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/treppe_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/treppe_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/tuern.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/wand_03.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wand_03.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wand_04.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wand_04.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wasser.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wasser.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wasser_raum_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wasser_raum_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wurzeln_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wurzeln_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wurzeln_03.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wurzeln_03.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wurzeln_alle.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wurzeln_alle.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/maps/wurzeln_alle.mesh
===================================================================
(Binary files differ)

Added: modules/kanalisation/maps/wurzeln_klein.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wurzeln_klein.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/materials/textures/Thumbs.db
===================================================================
(Binary files differ)

Added: modules/kanalisation/materials/textures/grasbueschel_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/grasbueschel_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/nat_wellen.dds
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/nat_wellen.dds
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/scripts/maps/kanalisation.rb
===================================================================
--- modules/kanalisation/scripts/maps/kanalisation.rb	2008-02-21 23:23:12 UTC (rev 4076)
+++ modules/kanalisation/scripts/maps/kanalisation.rb	2008-02-22 15:37:29 UTC (rev 4077)
@@ -3,8 +3,7 @@
 require 'player.rb'
 require 'hero.rb'
 require 'mckhero.rb'
-require 'door.rb'
-require 'torch.rb'
+#require 'torch.rb'
 
 
 loader = MapLoader.new("kanalisation");
@@ -13,24 +12,19 @@
 # Physik aktivieren
 $PM.setEnabled(true);
 
-$SCRIPT.log("rauschendesWasser geladen");
 
-#$hero.getActor().placeIntoScene([0.0, 0.0, 0.0]);
 #$SCRIPT.log("Tageslicht erstellen..");
 #sunlight = $AM.createLightActor("sunlight", LightObject::LT_DIRECTIONAL);
-#$hero.getActor().placeIntoScene([0.0, 0.0, 0.0]);
 #sunlight.getControlledObject().setCastShadows(true);
 #sunlight.getControlledObject().setSpecularColour(1.0,1.0,1.0);
 #sunlight.getControlledObject().setDiffuseColour(0.1,0.1,0.2);
 #$SCRIPT.log("Tageslicht erstellt.");
 
+#backlight = $AM.createLightActor("backlight", LightObject::LT_DIRECTIONAL);
+#backlight.getControlledObject().setDirection(0.17101, 0.873647, -0.969846);
+#backlight.getControlledObject().setCastShadows(false);
+#backlight.getControlledObject().setDiffuseColour(-0.3,-0.3,-0.3);
 
-backlight = $AM.createLightActor("backlight", LightObject::LT_DIRECTIONAL);
-backlight.getControlledObject().setDirection(0.17101, 0.873647, -0.969846);
-backlight.getControlledObject().setCastShadows(false);
-backlight.getControlledObject().setDiffuseColour(-0.3,-0.3,-0.3);
-
-
 $World.setFog( World::FOG_EXP, [0.658,0.7568,0.9137,1.0], 0.00049, 0.8, 1.0);
 $World.setAmbientLight( 0.08, 0.06, 0.05  );
 
@@ -60,9 +54,6 @@
 
 $SCRIPT.log("Hero ready")
 
-#$SCRIPT.log("Held in die Szene einfuegen.");#-22.0130577087402, -6.70670890808105, 25.1438484191895
-#$hero.getActor().placeIntoScene([0.0, 20.0, 0.0]);
-
 #$SCRIPT.log("Fackellicht erstellen..");
 #fackellicht = $AM.createLightActor("Das Licht der Fackel", LightObject::LT_POINT );
 #fackellicht.getControlledObject().setCastShadows(false);
@@ -71,27 +62,5 @@
 #$hero.getActor().attachToSlot( fackellicht, "Bip01 R SlotHand" );
 #$SCRIPT.log("Fackellicht erstellt.");
 
-
-$SCRIPT.log("T?ren einsetzen");
-#door1 = Door.new("Haustuer", "Eine Holzt?r", [-12.9124, -6.86492, 13.7133], [0, -120, 0], "arc_door_02.mesh");
-#door1.addActions(false, true)
-
-#door2 = Door.new("Tavernent?r", "Die Eingangst?r zur Taverne", [52.461, 1.28902, -26.323], [-0.462671,0.0, 0.88653, 0.0], "arc_door_tavern.mesh");
-#door2.addActions(false, true)
-
-$SCRIPT.log("T?ren gesetzt");
-
-#####################
-
-#BoxActor = $AM.createMeshActor("Box", "facial.mesh" );
-#$SCRIPT.log("actor erstellt");
- 
-#BoxActor.placeIntoScene(0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0);
-#$SCRIPT.log("actor in scene gesetzt");
-#BoxAnim = BoxActor.getControlledObject().startAnimation("Speak");
-#$SCRIPT.log("animation abgespielt.");
-
-##########################
-
 load "particle.rb"
 load "equip.rb"
\ No newline at end of file



From tanis at mail.berlios.de  Fri Feb 22 19:23:26 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Fri, 22 Feb 2008 19:23:26 +0100
Subject: [Dsa-hl-svn] r4078 - in modules: combattest/dsa regressiontest/dsa
	techdemo2/dsa
Message-ID: <200802221823.m1MINQCQ022987@sheep.berlios.de>

Author: tanis
Date: 2008-02-22 19:23:23 +0100 (Fri, 22 Feb 2008)
New Revision: 4078

Modified:
   modules/combattest/dsa/gameobjectdefinitions.gof
   modules/regressiontest/dsa/gameobjectdefinitions.gof
   modules/techdemo2/dsa/td2objects.gof
Log:
Revert recent gof file changes. They don't fit current data model.

Modified: modules/combattest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/combattest/dsa/gameobjectdefinitions.gof	2008-02-22 15:37:29 UTC (rev 4077)
+++ modules/combattest/dsa/gameobjectdefinitions.gof	2008-02-22 18:23:23 UTC (rev 4078)
@@ -9,12 +9,10 @@
     <property name="meshfile" type="STRING" data="tie_wolf_01.mesh"/>
     <property name="mass" type="REAL" data="30"/>
     <property name="geometrytype" type="STRING" data="sphere"/>
-    <property name="ai" type="MAP">
         <property name="behaviours" type="ARRAY">
     	    <property type="STRING" data="DefaultWanderBehaviour"/>
     	    <property type="STRING" data="AvoidObstaclesBehaviour"/>
         </property>
-    </property>
   </gameobjectclass>
   
   <gameobjectclass classid="Wolf2" baseclass="Creature">
@@ -39,11 +37,9 @@
 		<property name="talente" type="MAP">
 			<property name="Athletik" type="INT" data="3"/>
 		</property>
-    <property name="ai" type="MAP">
         <property name="behaviours" type="ARRAY">
     	    <property type="STRING" data="DefaultWanderBehaviour"/>
     	    <property type="STRING" data="AvoidObstaclesBehaviour"/>
         </property>
-    </property>
   </gameobjectclass>
 </GameObjectDefinitions>

Modified: modules/regressiontest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/regressiontest/dsa/gameobjectdefinitions.gof	2008-02-22 15:37:29 UTC (rev 4077)
+++ modules/regressiontest/dsa/gameobjectdefinitions.gof	2008-02-22 18:23:23 UTC (rev 4078)
@@ -28,11 +28,9 @@
         <property name="meshfile" type="STRING" data="men_alrike.mesh"/>
         <property name="mass" type="REAL" data="65"/>
         <property name="dialog" type="STRING" data="testdialog"/>
-        <property name="ai" type="MAP">
-            <property name="behaviours" type="ARRAY">
-                <property type="STRING" data="DefaultIdleBehaviour"/>
-                <property type="STRING" data="DialogBehaviour"/>
-            </property>
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+            <property type="STRING" data="DialogBehaviour"/>
         </property>
 		<property name="eigenschaften" type="MAP">
 			<property name="MU" type="INT" data="12"/>
@@ -57,11 +55,9 @@
         <property name="meshfile" type="STRING" data="men_alrike.mesh"/>
         <property name="mass" type="REAL" data="65"/>
         <property name="dialogfile" type="STRING" data="testperson.xml"/>
-        <property name="ai" type="MAP">
-            <property name="behaviours" type="ARRAY">
-                <property type="STRING" data="DefaultIdleBehaviour"/>
-                <property type="STRING" data="DialogBehaviour"/>
-            </property>
+        <property name="behaviours" type="ARRAY">
+            <property type="STRING" data="DefaultIdleBehaviour"/>
+            <property type="STRING" data="DialogBehaviour"/>
         </property>
     </gameobjectclass>
 

Modified: modules/techdemo2/dsa/td2objects.gof
===================================================================
--- modules/techdemo2/dsa/td2objects.gof	2008-02-22 15:37:29 UTC (rev 4077)
+++ modules/techdemo2/dsa/td2objects.gof	2008-02-22 18:23:23 UTC (rev 4078)
@@ -15,11 +15,9 @@
     <property name="position" type="VECTOR3" data="-20.99, -6.5, 1.55"/>
     <property name="orientation" type="QUATERNION" data="0.0, 180.0, 0.0"/>
     <property name="dialogfile" type="STRING" data="wolfram.xml"/>
-    <property name="ai" type="MAP">
-        <property name="behaviours" type="ARRAY">
-            <property type="STRING" data="DefaultIdleBehaviour"/>
-            <property type="STRING" data="DialogBehaviour"/>
-        </property>
+    <property name="behaviours" type="ARRAY">
+    	<property type="STRING" data="DefaultIdleBehaviour"/>
+    	<property type="STRING" data="dialog_behaviour"/>
     </property>
   </gameobjectclass>
 
@@ -34,11 +32,9 @@
     <property name="position" type="VECTOR3" data="-32.40, -6.46, 4.03"/>
     <property name="orientation" type="QUATERNION" data="0.0, 120.94, 0.0"/>
     <property name="dialogfile" type="STRING" data="sonja.xml"/>
-    <property name="ai" type="MAP">
-        <property name="behaviours" type="ARRAY">
-            <property type="STRING" data="DefaultIdleBehaviour"/>
-            <property type="STRING" data="DialogBehaviour"/>
-        </property>
+    <property name="behaviours" type="ARRAY">
+    	<property type="STRING" data="DefaultIdleBehaviour"/>
+    	<property type="STRING" data="DialogBehaviour"/>
     </property>
   </gameobjectclass>
   
@@ -53,11 +49,9 @@
     <property name="position" type="VECTOR3" data="2.70, -37.79, -23.48"/>
     <property name="orientation" type="QUATERNION" data="0.0, 120.94, 0.0"/>
     <property name="dialogfile" type="STRING" data="sonja2.xml"/>
-    <property name="ai" type="MAP">
-        <property name="behaviours" type="ARRAY">
-            <property type="STRING" data="DefaultIdleBehaviour"/>
-            <property type="STRING" data="DialogBehaviour"/>
-        </property>
+    <property name="behaviours" type="ARRAY">
+    	<property type="STRING" data="DefaultIdleBehaviour"/>
+    	<property type="STRING" data="DialogBehaviour"/>
     </property>
   </gameobjectclass>
   
@@ -72,11 +66,9 @@
     <property name="position" type="VECTOR3" data="-36.16, -6.25, 18.12"/>
     <property name="orientation" type="QUATERNION" data="0.0, -23.40, 0.0"/>
     <property name="dialogfile" type="STRING" data="jarn.xml"/>
-    <property name="ai" type="MAP">
-        <property name="behaviours" type="ARRAY">
-            <property type="STRING" data="DefaultIdleBehaviour"/>
-            <property type="STRING" data="DialogBehaviour"/>
-        </property>
+    <property name="behaviours" type="ARRAY">
+    	<property type="STRING" data="DefaultIdleBehaviour"/>
+    	<property type="STRING" data="DialogBehaviour"/>
     </property>
   </gameobjectclass>
   
@@ -91,11 +83,9 @@
     <property name="position" type="VECTOR3" data="11.46, -8.88, 39.43"/>
     <property name="orientation" type="QUATERNION" data="0.0, 50.0, 0.0"/>
     <property name="dialogfile" type="STRING" data="wolfram.xml"/>
-    <property name="ai" type="MAP">
-        <property name="behaviours" type="ARRAY">
-            <property type="STRING" data="DefaultIdleBehaviour"/>
-            <property type="STRING" data="DialogBehaviour"/>
-        </property>
+    <property name="behaviours" type="ARRAY">
+    	<property type="STRING" data="DefaultIdleBehaviour"/>
+    	<property type="STRING" data="DialogBehaviour"/>
     </property>
   </gameobjectclass>
   
@@ -109,12 +99,10 @@
     <property name="geometrytype" type="STRING" data="sphere"/>
     <property name="position" type="VECTOR3" data="-20.83, -6.70, 19.46"/>
     <property name="dialogfile" type="STRING" data="forrest.xml"/>
-    <property name="ai" type="MAP">
-        <property name="behaviours" type="ARRAY">
-            <property type="STRING" data="DefaultIdleBehaviour"/>
-            <property type="STRING" data="DialogBehaviour"/>
-        	<property type="STRING" data="AvoidObstaclesBehaviour"/>
-        </property>
+    <property name="behaviours" type="ARRAY">
+    	<property type="STRING" data="DefaultIdleBehaviour"/>
+    	<property type="STRING" data="AvoidObstaclesBehaviour"/>
+    	<property type="STRING" data="DialogBehaviour"/>
     </property>
   </gameobjectclass>
   
@@ -153,11 +141,9 @@
     <property name="meshfile" type="STRING" data="tie_wolf_01.mesh"/>
     <property name="mass" type="REAL" data="0"/>
     <property name="geometrytype" type="STRING" data="sphere"/>
-    <property name="ai" type="MAP">
-        <property name="behaviours" type="ARRAY">
-            <property type="STRING" data="DefaultIdleBehaviour"/>
-        	<property type="STRING" data="AvoidObstaclesBehaviour"/>
-        </property>
+    <property name="behaviours" type="ARRAY">
+    	<property type="STRING" data="DefaultIdleBehaviour"/>
+    	<property type="STRING" data="AvoidObstaclesBehaviour"/>
     </property>
   </gameobjectclass>
   
@@ -191,7 +177,7 @@
     <property name="description" type="STRING" data="Ein Wirt. Er ist im Gespr?ch vertieft und l?sst sich nicht st?ren."/>
     <property name="meshfile" type="STRING" data="men_wirt.mesh"/>
     <property name="position" type="VECTOR3" data="-27.10, -6.48, -1.40"/>
--   <property name="orientation" type="QUATERNION" data="0, 180, 0"/>
+    <property name="orientation" type="QUATERNION" data="0, 180, 0"/>
   </gameobjectclass>
   
   <gameobjectclass classid="Buch der Kultur" baseclass="BuchDerKultur">



From melven at mail.berlios.de  Fri Feb 22 22:23:14 2008
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Fri, 22 Feb 2008 22:23:14 +0100
Subject: [Dsa-hl-svn] r4079 - in rl/trunk/engine/rules: include src
Message-ID: <200802222123.m1MLNE0Q010073@sheep.berlios.de>

Author: melven
Date: 2008-02-22 22:23:07 +0100 (Fri, 22 Feb 2008)
New Revision: 4079

Modified:
   rl/trunk/engine/rules/include/Creature.h
   rl/trunk/engine/rules/src/Creature.cpp
   rl/trunk/engine/rules/src/CreatureController.cpp
Log:
-the name of animations (and their speed) used by the CreatureController can now be specified in gof-files
-animation sounds can probably be implemented similarly later (forum thread "NSC Format")

Modified: rl/trunk/engine/rules/include/Creature.h
===================================================================
--- rl/trunk/engine/rules/include/Creature.h	2008-02-22 18:23:23 UTC (rev 4078)
+++ rl/trunk/engine/rules/include/Creature.h	2008-02-22 21:23:07 UTC (rev 4079)
@@ -124,6 +124,8 @@
             static const Ogre::String PROPERTY_WERTE;
             static const Ogre::String PROPERTY_AP;
             static const Ogre::String PROPERTY_INVENTORY;
+            static const Ogre::String PROPERTY_ANIMATIONS;
+            static const Ogre::String PROPERTY_ANIMATIONSPEEDS;
 
             typedef Ogre::String Wert;
 
@@ -697,6 +699,18 @@
             **/
             virtual bool canReachItem(const Item* item);
 
+            /**
+             * Animations-Name und relative/absolute Abspielgeschwindigkeit fuer
+             * den CreatureController
+            **/
+            typedef std::pair<Ogre::String, Ogre::Real> AnimationSpeedPair;
+            /**
+             * Gibt die Animation aus der AnimationsMap f?r den CreatureController zur?ck
+             * @return Wenn kein spezieller Wert gefunden wurde, wird als Animationsname
+             * der Schl?sse name und eine Geschwindigkeit von 1 zurueckgegeben
+            **/
+            AnimationSpeedPair getAnimation(const CeGuiString& name) const;
+
         protected:
            /**
              *  Berechnet den Basiswert von der @ref abbdea "Astralenergie".
@@ -762,7 +776,20 @@
                    *  Sonderfertigkeit als Schluessel und ihrem Status.
              */
             typedef std::map<const CeGuiString , SonderfertigkeitenStateSet*> SonderfertigkeitMap;
-
+            /**
+                    * Die Animationen, die der CreatureController bei einer Bewegung der Kreatur
+                    * abspielt. Der Schl?ssel ist Bezeichner der von einer Bewegungsart des
+                    * CreatureControllers verwendet wird, der Wert gibt den echten Namen der Animation
+                    * an.
+            **/
+            typedef std::map<const CeGuiString, CeGuiString> AnimationsMap;
+            /**
+                    * Die (relative oder absolute) Geschwindigkeit einer Animationen, die der
+                    * CreatureController bei einer Bewegung der Kreatur
+                    * abspielt. Der Schl?ssel ist Bezeichner, der von einer Bewegungsart des
+                    * CreatureControllers verwendet wird.
+            **/
+            typedef std::map<const CeGuiString, Ogre::Real> AnimationSpeedsMap;
             struct Ap
             {
                 int total;
@@ -790,6 +817,8 @@
             NachteilMap mNachteile;
             SonderfertigkeitMap mSonderfertigkeiten;
             WertMap mWerte;
+            AnimationsMap mAnimations;
+            AnimationSpeedsMap mAnimationSpeeds;
             Ap mAp;
             /// Zeigt auf das Inventar der Kreatur.
             Inventory* mInventory;

Modified: rl/trunk/engine/rules/src/Creature.cpp
===================================================================
--- rl/trunk/engine/rules/src/Creature.cpp	2008-02-22 18:23:23 UTC (rev 4078)
+++ rl/trunk/engine/rules/src/Creature.cpp	2008-02-22 21:23:07 UTC (rev 4079)
@@ -58,6 +58,8 @@
     const Ogre::String Creature::PROPERTY_WERTE = "werte";
     const Ogre::String Creature::PROPERTY_AP = "ap";
     const Ogre::String Creature::PROPERTY_INVENTORY = "inventory";
+    const Ogre::String Creature::PROPERTY_ANIMATIONS = "animations";
+    const Ogre::String Creature::PROPERTY_ANIMATIONSPEEDS = "animationspeeds";
 
     // some targets
 	const std::string Creature::ALL_EIGENSCHAFTEN = "alle Eigenschaften";
@@ -1054,6 +1056,16 @@
         {
             mInventory->setProperties(value.toMap());
         }
+        else if (key == Creature::PROPERTY_ANIMATIONS)
+        {
+            mAnimations.clear();
+            convertToMap(value.toMap(), mAnimations);
+        }
+        else if (key == Creature::PROPERTY_ANIMATIONSPEEDS)
+        {
+            mAnimationSpeeds.clear();
+            convertToMap(value.toMap(), mAnimationSpeeds);
+        }
         else
         {
             GameObject::setProperty(key, value);
@@ -1132,6 +1144,16 @@
         {
 			return mInventory->getAllProperties()->toPropertyMap();
         }
+        else if (key == Creature::PROPERTY_ANIMATIONS)
+        {
+            PropertyMap map = rl::convertToPropertyMap(mAnimations);
+            return Property(map);
+        }
+        else if (key == Creature::PROPERTY_ANIMATIONSPEEDS)
+        {
+            PropertyMap map = rl::convertToPropertyMap(mAnimationSpeeds);
+            return Property(map);
+        }
         else
         {
             return GameObject::getProperty(key);
@@ -1157,10 +1179,30 @@
         ps->setProperty(Creature::PROPERTY_WERTE, getProperty(Creature::PROPERTY_WERTE));
         ps->setProperty(Creature::PROPERTY_AP, getProperty(Creature::PROPERTY_AP));
         ps->setProperty(Creature::PROPERTY_INVENTORY, getProperty(Creature::PROPERTY_INVENTORY));
+        ps->setProperty(Creature::PROPERTY_ANIMATIONS, getProperty(Creature::PROPERTY_ANIMATIONS));
+        ps->setProperty(Creature::PROPERTY_ANIMATIONSPEEDS, getProperty(Creature::PROPERTY_ANIMATIONSPEEDS));
 
         return ps;
     }
 
+    Creature::AnimationSpeedPair Creature::getAnimation(const CeGuiString& name) const
+    {
+        AnimationSpeedPair ret;
+        AnimationsMap::const_iterator itName = mAnimations.find(name);
+        if( itName != mAnimations.end() )
+            ret.first = itName->second.c_str();
+        else
+            ret.first = name.c_str();
+
+        AnimationSpeedsMap::const_iterator itSpeed = mAnimationSpeeds.find(name);
+        if( itSpeed != mAnimationSpeeds.end() )
+            ret.second = itSpeed->second;
+        else
+            ret.second = 1;
+
+        return ret;
+    }
+
     bool Creature::canReachItem(const Item* item)
     {
         return (item->getPosition() - getPosition()).length() <= 3.0f;

Modified: rl/trunk/engine/rules/src/CreatureController.cpp
===================================================================
--- rl/trunk/engine/rules/src/CreatureController.cpp	2008-02-22 18:23:23 UTC (rev 4078)
+++ rl/trunk/engine/rules/src/CreatureController.cpp	2008-02-22 21:23:07 UTC (rev 4079)
@@ -47,7 +47,11 @@
             mVelocity(Vector3::ZERO), 
             mRotationMovement(NULL), 
             mStepRecognitionMovement(NULL)
-            {}
+            {
+                mAnim1 = creature->getCreature()->getAnimation("stehen");
+                mAnim2 = creature->getCreature()->getAnimation("stehen_rechts");
+                mAnim3 = creature->getCreature()->getAnimation("stehen_links");
+            }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_STEHEN;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_NONE;}
         virtual void activate()
@@ -118,13 +122,13 @@
         {
             Real omegaY = mMovingCreature->getCreature()->getActor()->getPhysicalThing()->_getBody()->getOmega().y;
             if( omegaY > Degree(20).valueRadians() )
-                mMovingCreature->setAnimation("drehen_links");
+                mMovingCreature->setAnimation(mAnim3.first, mAnim3.second);
             else
             {
                 if( omegaY < Degree(-20).valueRadians() )
-                    mMovingCreature->setAnimation("drehen_rechts");
+                    mMovingCreature->setAnimation(mAnim2.first, mAnim2.second);
                 else
-                    mMovingCreature->setAnimation("Idle");
+                    mMovingCreature->setAnimation(mAnim1.first, mAnim1.second);
             }
         }
         virtual void applyAuChanges(Ogre::Real elapsedTime)
@@ -143,6 +147,9 @@
         }
     protected:
         Ogre::Vector3 mVelocity;
+        Creature::AnimationSpeedPair mAnim1;
+        Creature::AnimationSpeedPair mAnim2;
+        Creature::AnimationSpeedPair mAnim3;
         mutable AbstractMovement *mRotationMovement;
         mutable AbstractMovement *mStepRecognitionMovement;
         virtual AbstractMovement* getRotationMovement() const
@@ -265,7 +272,10 @@
     class Gehen : public Stehen
     {
     public:
-        Gehen(CreatureController *creature) : Stehen(creature) {}
+        Gehen(CreatureController *creature) : Stehen(creature)
+        {
+            mAnim1 = creature->getCreature()->getAnimation("gehen");
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_GEHEN;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_STEHEN;}
         virtual bool calculateBaseVelocity(Real &velocity)
@@ -299,10 +309,10 @@
         }
         virtual void setAnimation(Ogre::Real elapsedTime)
         {
-            Real step = 1.49; // the width of a step
+            //Real step = 1.49; // the width of a step
             //MeshObject* charMesh = dynamic_cast<MeshObject*>(mMovingCreature->getCreature()->getActor()->getControlledObject());
             //Real length = charMesh->getAnimation("Run")->getLength();
-            Real length = 5./3.;
+            // Real length = 5./3.;
             Real weight = 1;
             Real relTimeOffset = 0;
 
@@ -329,8 +339,8 @@
             if( mMovingCreature->getLastMovementChange() > elapsedTime )
                 relTimeOffset = 0;
 
-            MeshAnimation *meshAnim = mMovingCreature->setAnimation("Walk", -mMovingCreature->getVelocity().z / (step / length), 0, "Walk", weight );
-            if( meshAnim != NULL )
+            MeshAnimation *meshAnim = mMovingCreature->setAnimation(mAnim1.first, -mMovingCreature->getVelocity().z * mAnim1.second, 0, mAnim1.first, weight );
+            if( meshAnim != NULL && relTimeOffset != 0 )
                 meshAnim->doAddTime(relTimeOffset*meshAnim->getLength());
         }
     };
@@ -338,7 +348,10 @@
     class Joggen : public Gehen
     {
     public:
-        Joggen(CreatureController *creature) : Gehen(creature) {}
+        Joggen(CreatureController *creature) : Gehen(creature)
+        {
+            mAnim1 = creature->getCreature()->getAnimation("joggen");
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_JOGGEN;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_GEHEN;}
         virtual bool calculateBaseVelocity(Real &velocity)
@@ -354,10 +367,10 @@
         virtual void applyAuChanges(Ogre::Real elapsedTime) {} // empty
         virtual void setAnimation(Ogre::Real elapsedTime)
         {
-            Real step = 3.20; // the width of a step
+            //Real step = 3.20; // the width of a step
             // if the persons runs, the feet don't touch always the ground, so this value must be bigger
             // trynerror:
-            step -= 0.5;
+            //step -= 0.5;
             //MeshObject* charMesh = dynamic_cast<MeshObject*>(mMovingCreature->getCreature()->getActor()->getControlledObject());
             //Real length = charMesh->getAnimation("Run")->getLength();
             Real length = 5./3.;
@@ -385,8 +398,8 @@
             if( mMovingCreature->getLastMovementChange() > elapsedTime )
                 relTimeOffset = 0;
 
-            MeshAnimation *meshAnim = mMovingCreature->setAnimation("Run", -mMovingCreature->getVelocity().z / (step / length), 0, "Run", weight );
-            if( meshAnim != NULL )
+            MeshAnimation *meshAnim = mMovingCreature->setAnimation(mAnim1.first, -mMovingCreature->getVelocity().z * mAnim1.second, 0, mAnim1.first, weight );
+            if( meshAnim != NULL && relTimeOffset != 0)
                 meshAnim->doAddTime(relTimeOffset*meshAnim->getLength());
         }
     };
@@ -394,7 +407,10 @@
     class Laufen : public Gehen
     {
     public:
-        Laufen(CreatureController *creature) : Gehen(creature), mTimePerAu(1), mLastProbe(0) {}
+        Laufen(CreatureController *creature) : Gehen(creature), mTimePerAu(1), mLastProbe(0)
+        {
+            mAnim1 = creature->getCreature()->getAnimation("laufen");
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_LAUFEN;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_JOGGEN;}
         virtual bool calculateBaseVelocity(Real &velocity)
@@ -422,10 +438,10 @@
         }
         virtual void setAnimation(Ogre::Real elapsedTime)
         {
-            Real step = 3.20; // the width of a step
+            //Real step = 3.20; // the width of a step
             // if the persons runs, the feet don't touch always the ground, so this value must be bigger
             // trynerror:
-            step -= 0.5;
+            //step -= 0.5;
             //MeshObject* charMesh = dynamic_cast<MeshObject*>(mMovingCreature->getCreature()->getActor()->getControlledObject());
             //Real length = charMesh->getAnimation("Run")->getLength();
             Real length = 5./3.;
@@ -453,8 +469,8 @@
             if( mMovingCreature->getLastMovementChange() > elapsedTime )
                 relTimeOffset = 0;
 
-            MeshAnimation *meshAnim = mMovingCreature->setAnimation("Run", -mMovingCreature->getVelocity().z / (step / length), 0, "Run", weight );
-            if( meshAnim != NULL )
+            MeshAnimation *meshAnim = mMovingCreature->setAnimation(mAnim1.first, -mMovingCreature->getVelocity().z * mAnim1.second, 0, mAnim1.first, weight );
+            if( meshAnim != NULL && relTimeOffset != 0)
                 meshAnim->doAddTime(relTimeOffset*meshAnim->getLength());
         }
         virtual void activate()
@@ -500,7 +516,10 @@
     class Rennen : public Gehen
     {
     public:
-        Rennen(CreatureController *creature) : Gehen(creature), mVelocityImprovement(0), mLastProbe(0) {}
+        Rennen(CreatureController *creature) : Gehen(creature), mVelocityImprovement(0), mLastProbe(0)
+        {
+            mAnim1 = creature->getCreature()->getAnimation("rennen");
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_RENNEN;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_LAUFEN;}
         virtual bool calculateBaseVelocity(Real &velocity)
@@ -532,10 +551,10 @@
         }
         virtual void setAnimation(Ogre::Real elapsedTime)
         {
-            Real step = 2.835; // the width of a step
+            //Real step = 2.835; // the width of a step
             // if the persons runs, the feet don't touch always the ground, so this value must be bigger
             // trynerror:
-            step += 1.5;
+            //step += 1.5;
             //MeshObject* charMesh = dynamic_cast<MeshObject*>(mMovingCreature->getCreature()->getActor()->getControlledObject());
             //Real length = charMesh->getAnimation("Run")->getLength();
             Real length = 5./3.;
@@ -563,8 +582,8 @@
             if( mMovingCreature->getLastMovementChange() > elapsedTime )
                 relTimeOffset = 0;
 
-            MeshAnimation *meshAnim = mMovingCreature->setAnimation("Run", -mMovingCreature->getVelocity().z / (step / length), 0, "Run", weight );
-            if( meshAnim != NULL )
+            MeshAnimation *meshAnim = mMovingCreature->setAnimation(mAnim1.first, -mMovingCreature->getVelocity().z *mAnim1.second, 0, mAnim1.first, weight );
+            if( meshAnim != NULL && relTimeOffset )
                 meshAnim->doAddTime(relTimeOffset*meshAnim->getLength());
         }
         virtual void activate()
@@ -609,7 +628,10 @@
     class RueckwaertsGehen : public Gehen
     {
     public:
-        RueckwaertsGehen(CreatureController *creature) : Gehen(creature) {}
+        RueckwaertsGehen(CreatureController *creature) : Gehen(creature)
+        {
+            mAnim1 = creature->getCreature()->getAnimation("gehen_rueckwaerts");
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_RUECKWAERTS_GEHEN;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_STEHEN;}
         virtual bool calculateBaseVelocity(Real &velocity)
@@ -619,14 +641,17 @@
         }
         virtual void setAnimation(Ogre::Real elapsedTime)
         {
-            mMovingCreature->setAnimation("gehen_rueckwaerts");
+            mMovingCreature->setAnimation(mAnim1.first, mMovingCreature->getVelocity().z * mAnim1.second);
         }
     };
 
     class RueckwaertsJoggen : public Joggen
     {
     public:
-        RueckwaertsJoggen(CreatureController *creature) : Joggen(creature) {}
+        RueckwaertsJoggen(CreatureController *creature) : Joggen(creature)
+        {
+            mAnim1 = creature->getCreature()->getAnimation("joggen_rueckwaerts");
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_RUECKWAERTS_JOGGEN;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_RUECKWAERTS_GEHEN;}
         virtual bool calculateBaseVelocity(Real &velocity)
@@ -636,7 +661,7 @@
         }
         virtual void setAnimation(Ogre::Real elapsedTime)
         {
-            mMovingCreature->setAnimation("Run");
+            mMovingCreature->setAnimation(mAnim1.first, mMovingCreature->getVelocity().z * mAnim1.second);
         }
     };
 
@@ -644,7 +669,11 @@
     class SeitwaertsGehen : public Gehen
     {
     public:
-        SeitwaertsGehen(CreatureController *creature) : Gehen(creature), mLeft(true) {}
+        SeitwaertsGehen(CreatureController *creature) : Gehen(creature), mLeft(true)
+        {
+            mAnim1 = creature->getCreature()->getAnimation("seitwaerts_rechts");
+            mAnim2 = creature->getCreature()->getAnimation("seitwaerts_links");
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_SEITWAERTS_GEHEN;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_STEHEN;}
         virtual bool calculateBaseVelocity(Real &velocity)
@@ -666,9 +695,9 @@
         virtual void setAnimation(Ogre::Real elapsedTime)
         {
             if( mLeft )
-                mMovingCreature->setAnimation("seitwaerts_links");
+                mMovingCreature->setAnimation(mAnim1.first, mAnim1.second * -mMovingCreature->getVelocity().x);
             else
-                mMovingCreature->setAnimation("seitwaerts_rechts");
+                mMovingCreature->setAnimation(mAnim2.first, mAnim2.second * -mMovingCreature->getVelocity().x);
         }
     protected:
         bool mLeft;
@@ -677,7 +706,14 @@
     class Schleichen : public Gehen
     {
     public:
-        Schleichen(CreatureController *creature) : Gehen(creature), mState(UP), mTimer(0) {}
+        Schleichen(CreatureController *creature) : Gehen(creature), mState(UP), mTimer(0)
+        {
+            mAnim1 = creature->getCreature()->getAnimation("schleichen");
+            mAnim2= creature->getCreature()->getAnimation("schleiche_vorwaerts");
+            mAnim3 = creature->getCreature()->getAnimation("stehen_zu_schleichen");
+            mAnim4= creature->getCreature()->getAnimation("schleichen_zu_stehen");
+            mAnim5= creature->getCreature()->getAnimation("stehen");
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_SCHLEICHEN;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_STEHEN;}
         virtual bool calculateBaseVelocity(Real &velocity)
@@ -711,9 +747,9 @@
                 calculateBaseVelocity(velocity);
                 mVelocity = direction * velocity;
                 if( direction == Vector3::ZERO )
-                    mMovingCreature->setAnimation("hocke_idle");
+                    mMovingCreature->setAnimation(mAnim1.first, mAnim1.second);
                 else
-                    mMovingCreature->setAnimation("hocke_gehen");
+                    mMovingCreature->setAnimation(mAnim2.first, mAnim2.second * -mMovingCreature->getVelocity().z);
                 applyAuChanges(elapsedTime);
                 if( getRotationMovement()->isPossible() )
                     getRotationMovement()->run(elapsedTime, direction, rotation);
@@ -728,7 +764,7 @@
         {
             Gehen::activate();
             mState = UPTODOWN;
-            mMovingCreature->setAnimation("idle_zu_hocke",1,1,"Idle");
+            mMovingCreature->setAnimation(mAnim3.first,mAnim3.second,1,mAnim5.first);
             mTimer = 0;
         }
         virtual bool canChangeToMovement(CreatureController::MovementType id)
@@ -740,27 +776,35 @@
             if( mState == DOWN )
             {
                 mState = DOWNTOUP;
-                mMovingCreature->setAnimation("hocke_zu_stehen",1,1,"Idle");
+                mMovingCreature->setAnimation(mAnim4.first,mAnim4.second,1,mAnim5.first);
                 mTimer = 0;
             }
         }
     protected:
         enum {UP, DOWN, UPTODOWN, DOWNTOUP} mState;
         Real mTimer;
+        Creature::AnimationSpeedPair mAnim4;
+        Creature::AnimationSpeedPair mAnim5;
     };
 
 
     class Hochsprung : public AbstractMovement
     {
     public:
-        Hochsprung(CreatureController *creature) : AbstractMovement(creature), mState(DOWN), mHeight(0), mJumpNow(false), mTimer(0), mMoveForward(0) {}
+        Hochsprung(CreatureController *creature) : AbstractMovement(creature), mState(DOWN), mHeight(0), mJumpNow(false), mTimer(0), mMoveForward(0)
+        {
+            mAnimation = creature->getCreature()->getAnimation("hochsprung");
+            mAnimationAbsprung = creature->getCreature()->getAnimation("hochsprung_absprung");
+            mAnimationLandung = creature->getCreature()->getAnimation("hochsprung_landung");
+            mAnimationForCollision = creature->getCreature()->getAnimation("stehen");  // wird das hier gebraucht?
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_HOCHSPRUNG;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_STEHEN;}
         virtual void activate()
         {
             AbstractMovement::activate();
             mState = DOWNTOUP;
-            mMovingCreature->setAnimation("idle_absprung",1,1,"Idle");
+            mMovingCreature->setAnimation(mAnimationAbsprung.first,mAnimationAbsprung.second,1,mAnimationForCollision.first);
             mTimer = 0;
             calculateBaseVelocity(mHeight);
 
@@ -893,7 +937,7 @@
                 else if( mMovingCreature->getAbstractLocation() != CreatureController::AL_AIRBORNE )
                 {
                     mState = UPTODOWN;
-                    mMovingCreature->setAnimation("idle_sprung_landung", 1, 1, "Idle");
+                    mMovingCreature->setAnimation(mAnimationLandung.first, mAnimationLandung.second, 1, mAnimationForCollision.first);
                     mTimer = 0;
                 }
             }
@@ -904,7 +948,7 @@
                 {
                     mState = UP;
                     mMovingCreature->setAbstractLocation(CreatureController::AL_AIRBORNE);
-                    //mMovingCreature->setAnimation("idle_sprung"); // we also don't need this animation!
+                    mMovingCreature->setAnimation(mAnimation.first, mAnimation.second);
                     mJumpNow = true;
                     mTimer = 0;
                 }
@@ -934,6 +978,10 @@
         bool mJumpNow;
         Ogre::Real mTimer;
         Ogre::Real mMoveForward;
+        Creature::AnimationSpeedPair mAnimation;
+        Creature::AnimationSpeedPair mAnimationAbsprung;
+        Creature::AnimationSpeedPair mAnimationLandung;
+        Creature::AnimationSpeedPair mAnimationForCollision;
     };
 
 
@@ -944,14 +992,20 @@
           AbstractMovement(creature), mState(DOWN), mWidth(0),
               mJumpNow(false), mTimer(0), mApplyForceTime(0.12),
               mApplyForceTimer(0), mLastForce(Vector3::ZERO),
-              mVelocityBeforeJump(0), mTanJumpAngle(Math::Tan(Degree(17))) {}
+              mVelocityBeforeJump(0), mTanJumpAngle(Math::Tan(Degree(17)))
+        {
+            mAnimation = creature->getCreature()->getAnimation("weitsprung");
+            mAnimationAbsprung = creature->getCreature()->getAnimation("weitsprung_absprung");
+            mAnimationLandung = creature->getCreature()->getAnimation("weitsprung_landung");
+            mAnimationForCollision = creature->getCreature()->getAnimation("rennen"); // wird das hier gebraucht?
+        }
         virtual CreatureController::MovementType getId() const {return CreatureController::MT_WEITSPRUNG;}
         virtual CreatureController::MovementType getFallBackMovement() const {return CreatureController::MT_STEHEN;}
         virtual void activate()
         {
             AbstractMovement::activate();
             mState = DOWNTOUP;
-            mMovingCreature->setAnimation("rennen_absprung",1,1,"Run");
+            mMovingCreature->setAnimation(mAnimationAbsprung.first,mAnimationAbsprung.second,1,mAnimationForCollision.first);
             mTimer = 0;
             calculateBaseVelocity(mWidth);
 
@@ -1118,7 +1172,7 @@
                 else if( mMovingCreature->getAbstractLocation() != CreatureController::AL_AIRBORNE )
                 {
                     mState = UPTODOWN;
-                    mMovingCreature->setAnimation("rennen_sprung_landung", 1, 1, "Run");
+                    mMovingCreature->setAnimation(mAnimationLandung.first, mAnimationLandung.second, 1, mAnimationForCollision.first);
                     mTimer = 0;
                 }
             }
@@ -1129,7 +1183,7 @@
                 {
                     mState = UP;
                     mMovingCreature->setAbstractLocation(CreatureController::AL_AIRBORNE);
-                    //mMovingCreature->setAnimation("rennen_sprung");
+                    mMovingCreature->setAnimation(mAnimation.first, mAnimation.second);
                     mJumpNow = true;
                     mApplyForceTimer = 0;
                     mVelocityBeforeJump = -mMovingCreature->getVelocity().z;
@@ -1165,6 +1219,10 @@
         Ogre::Vector3 mLastForce;
         Ogre::Real mVelocityBeforeJump;
         Ogre::Real mTanJumpAngle;
+        Creature::AnimationSpeedPair mAnimation;
+        Creature::AnimationSpeedPair mAnimationAbsprung;
+        Creature::AnimationSpeedPair mAnimationLandung;
+        Creature::AnimationSpeedPair mAnimationForCollision;
     };
 
 



From josch at mail.berlios.de  Sat Feb 23 12:09:59 2008
From: josch at mail.berlios.de (josch at mail.berlios.de)
Date: Sat, 23 Feb 2008 12:09:59 +0100
Subject: [Dsa-hl-svn] r4080 - in rl/trunk/engine: rules/include rules/src
	ui/include ui/src
Message-ID: <200802231109.m1NB9xFe008250@sheep.berlios.de>

Author: josch
Date: 2008-02-23 12:08:34 +0100 (Sat, 23 Feb 2008)
New Revision: 4080

Modified:
   rl/trunk/engine/rules/include/Makefile.am
   rl/trunk/engine/rules/src/Makefile.am
   rl/trunk/engine/ui/include/CombatGui.h
   rl/trunk/engine/ui/include/Makefile.am
   rl/trunk/engine/ui/src/Makefile.am
Log:
Integrated CombatGui and GameEventLog into autoconf


Modified: rl/trunk/engine/rules/include/Makefile.am
===================================================================
--- rl/trunk/engine/rules/include/Makefile.am	2008-02-22 21:23:07 UTC (rev 4079)
+++ rl/trunk/engine/rules/include/Makefile.am	2008-02-23 11:08:34 UTC (rev 4080)
@@ -17,6 +17,7 @@
 	EffectManager.h \
 	Eigenschaft.h \
 	EigenschaftenStateSet.h \
+	GameEventLog.h \
 	GameObject.h \
 	GameObjectStateListener.h \
 	GameTimeSource.h \

Modified: rl/trunk/engine/rules/src/Makefile.am
===================================================================
--- rl/trunk/engine/rules/src/Makefile.am	2008-02-22 21:23:07 UTC (rev 4079)
+++ rl/trunk/engine/rules/src/Makefile.am	2008-02-23 11:08:34 UTC (rev 4080)
@@ -21,6 +21,7 @@
 	EffectManager.cpp \
 	Eigenschaft.cpp \
 	EigenschaftenStateSet.cpp \
+	GameEventLog.cpp \
 	GameObject.cpp \
 	GameObjectManager.cpp \
 	GameTimeSource.cpp \

Modified: rl/trunk/engine/ui/include/CombatGui.h
===================================================================
--- rl/trunk/engine/ui/include/CombatGui.h	2008-02-22 21:23:07 UTC (rev 4079)
+++ rl/trunk/engine/ui/include/CombatGui.h	2008-02-23 11:08:34 UTC (rev 4080)
@@ -20,6 +20,7 @@
 #include "UiPrerequisites.h"
 
 #include "CameraObject.h"
+#include "OgreRectangle.h"
 #include "Combat.h"
 #include "CombatWindow.h"
 

Modified: rl/trunk/engine/ui/include/Makefile.am
===================================================================
--- rl/trunk/engine/ui/include/Makefile.am	2008-02-22 21:23:07 UTC (rev 4079)
+++ rl/trunk/engine/ui/include/Makefile.am	2008-02-23 11:08:34 UTC (rev 4080)
@@ -7,6 +7,7 @@
     CharacterStateWindow.h \
     CloseConfirmationWindow.h \
     CombatControlState.h \
+    CombatGui.h \
 	CombatWindow.h \
     CommandMapper.h \
     ConfigComponent.h \

Modified: rl/trunk/engine/ui/src/Makefile.am
===================================================================
--- rl/trunk/engine/ui/src/Makefile.am	2008-02-22 21:23:07 UTC (rev 4079)
+++ rl/trunk/engine/ui/src/Makefile.am	2008-02-23 11:08:34 UTC (rev 4080)
@@ -15,6 +15,7 @@
     CharacterStateWindow.cpp \
     CloseConfirmationWindow.cpp \
     CombatControlState.cpp \
+    CombatGui.cpp \
     CombatWindow.cpp \
     CommandMapper.cpp \
     ConfigComponent.cpp \



From tanis at mail.berlios.de  Tue Feb 26 00:19:51 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Tue, 26 Feb 2008 00:19:51 +0100
Subject: [Dsa-hl-svn] r4081 - modules/common/gui/windows/buttons
Message-ID: <200802252319.m1PNJpkj019832@sheep.berlios.de>

Author: tanis
Date: 2008-02-26 00:19:49 +0100 (Tue, 26 Feb 2008)
New Revision: 4081

Added:
   modules/common/gui/windows/buttons/attack.xml
   modules/common/gui/windows/buttons/evade.xml
   modules/common/gui/windows/buttons/parry.xml
Log:
New buttons needed by combat gui.

Added: modules/common/gui/windows/buttons/attack.xml
===================================================================
--- modules/common/gui/windows/buttons/attack.xml	2008-02-23 11:08:34 UTC (rev 4080)
+++ modules/common/gui/windows/buttons/attack.xml	2008-02-25 23:19:49 UTC (rev 4081)
@@ -0,0 +1,7 @@
+<GUILayout xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="GUILayout.xsd">
+    <Window Type="RastullahLook/StaticImage" Name="TalkButton">
+        <Property Name="UnifiedSize" Value="{{0,45},{0,45}}"/>
+        <Property Name="Image" Value="set:RastullahButtons image:Buttons/Attack" />
+        <Property Name="FrameEnabled" Value="False"/>
+    </Window>
+</GUILayout>

Added: modules/common/gui/windows/buttons/evade.xml
===================================================================
--- modules/common/gui/windows/buttons/evade.xml	2008-02-23 11:08:34 UTC (rev 4080)
+++ modules/common/gui/windows/buttons/evade.xml	2008-02-25 23:19:49 UTC (rev 4081)
@@ -0,0 +1,7 @@
+<GUILayout xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="GUILayout.xsd">
+    <Window Type="RastullahLook/StaticImage" Name="TalkButton">
+        <Property Name="UnifiedSize" Value="{{0,45},{0,45}}"/>
+        <Property Name="Image" Value="set:RastullahButtons image:Buttons/Default" />
+        <Property Name="FrameEnabled" Value="False"/>
+    </Window>
+</GUILayout>

Added: modules/common/gui/windows/buttons/parry.xml
===================================================================
--- modules/common/gui/windows/buttons/parry.xml	2008-02-23 11:08:34 UTC (rev 4080)
+++ modules/common/gui/windows/buttons/parry.xml	2008-02-25 23:19:49 UTC (rev 4081)
@@ -0,0 +1,7 @@
+<GUILayout xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="GUILayout.xsd">
+    <Window Type="RastullahLook/StaticImage" Name="TalkButton">
+        <Property Name="UnifiedSize" Value="{{0,45},{0,45}}"/>
+        <Property Name="Image" Value="set:RastullahButtons image:Buttons/Parry" />
+        <Property Name="FrameEnabled" Value="False"/>
+    </Window>
+</GUILayout>



From tanis at mail.berlios.de  Tue Feb 26 00:21:18 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Tue, 26 Feb 2008 00:21:18 +0100
Subject: [Dsa-hl-svn] r4082 - modules/regressiontest/scripts
Message-ID: <200802252321.m1PNLIfv020020@sheep.berlios.de>

Author: tanis
Date: 2008-02-26 00:21:17 +0100 (Tue, 26 Feb 2008)
New Revision: 4082

Removed:
   modules/regressiontest/scripts/GameObjectStatesTest.rb
Log:
Removed obsolete GameObjectStateTest, it is replaced by more complex GameObjectCreationTest.

Deleted: modules/regressiontest/scripts/GameObjectStatesTest.rb
===================================================================
--- modules/regressiontest/scripts/GameObjectStatesTest.rb	2008-02-25 23:19:49 UTC (rev 4081)
+++ modules/regressiontest/scripts/GameObjectStatesTest.rb	2008-02-25 23:21:17 UTC (rev 4082)
@@ -1,12 +0,0 @@
-require 'testcase.rb'
-
-class GameObjectStatesTest < TestCase
-  def execute()
-    appl2 = $GOM.createGameObject("apple", 15);
-    p "appl2 created"
-    appl2.placeIntoScene();
-    p "set appl2 into scene"
-    appl2.setPosition(rel_pos([1, 1, 1]));
-    p appl2.getPosition()
-  end
-end
\ No newline at end of file



From tanis at mail.berlios.de  Tue Feb 26 00:22:33 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Tue, 26 Feb 2008 00:22:33 +0100
Subject: [Dsa-hl-svn] r4083 - modules/regressiontest/scripts/maps
Message-ID: <200802252322.m1PNMX7T020193@sheep.berlios.de>

Author: tanis
Date: 2008-02-26 00:22:32 +0100 (Tue, 26 Feb 2008)
New Revision: 4083

Modified:
   modules/regressiontest/scripts/maps/regressiontest.rb
Log:
Commented broken tests that prevent regressiontest module from working at all. Seems to be mckhero-related.

Modified: modules/regressiontest/scripts/maps/regressiontest.rb
===================================================================
--- modules/regressiontest/scripts/maps/regressiontest.rb	2008-02-25 23:21:17 UTC (rev 4082)
+++ modules/regressiontest/scripts/maps/regressiontest.rb	2008-02-25 23:22:32 UTC (rev 4083)
@@ -17,46 +17,47 @@
 
 $SCRIPT.log("Hero ready")
 
-$SCRIPT.log("begin tests.");
+$SCRIPT.log("begin tests.")
 
 require 'doortest.rb'
+require 'effecttest.rb'
+require 'ErrorHandlingTest.rb'
 require 'GameObjectCreationTest.rb'
-require 'GameObjectStatesTest.rb'
-require 'NpcTest.rb'
-require 'NpcCapsuleTest.rb'
-require 'TimeTest.rb'
-require 'InventoryTest.rb'
-require 'ErrorHandlingTest.rb'
+#require 'InventoryTest.rb'
 require 'JobSequenceTest.rb'
-require 'SoundTest.rb'
-require 'effecttest.rb'
 require 'LightzoneTest.rb'
 require 'MapLoadingTest.rb'
 require 'MaterialSlotTest.rb'
-require 'MergeableMeshTest.rb'
-require 'WalkJobTest.rb'
+#require 'MergeableMeshTest.rb'
+require 'MeshAreaTest.rb'
+require 'NpcCapsuleTest.rb'
+require 'NpcTest.rb'
 require 'SelectorTest.rb'
-require 'MeshAreaTest.rb'
+require 'SoundTest.rb'
+require 'TimeTest.rb'
 
+require 'WalkJobTest.rb'
 
- MaterialSlotTest.new([-15, 0, -5]).run()
-    LightzoneTest.new([-10, 0, -5]).run()
+
+DoorTest.new([  0, 0, -5]).run()
+EffectTest.new([  5, 0, 5]).run()
 ErrorHandlingTest.new([-10, 0, 5]).run()
-         TimeTest.new([ -5, 0, -5]).run()
-   MapLoadingTest.new([ -5, 0, -10]).run()
-          NpcTest.new([ -5, 0, 5]).run()
 GameObjectCreationTest.new([0, 0, -10]).run()
-         DoorTest.new([  0, 0, -5]).run()
-	  WalkJobTest.new([  0, 0, -3]).run()
-   NpcCapsuleTest.new([  0, 0, 5]).run()
-    InventoryTest.new([  0, 0, 10]).run()
-  JobSequenceTest.new([  5, 0, -5]).run()
-     SelectorTest.new([  5, 0, 0]).run()
-       EffectTest.new([  5, 0, 5]).run()
-MergeableMeshTest.new([ 10, 0, 0]).run()
-        SoundTest.new([ 10, 0, 10]).run()
-     MeshAreaTest.new([-50, 0,-55]).run()
+#InventoryTest.new([  0, 0, 10]).run() # Geht nicht, keine Steuerung m?glich
+JobSequenceTest.new([  5, 0, -5]).run()
+LightzoneTest.new([-10, 0, -5]).run()
+MapLoadingTest.new([ -5, 0, -10]).run()
+MaterialSlotTest.new([-15, 0, -5]).run()
+#MergeableMeshTest.new([ 10, 0, 0]).run()
+MeshAreaTest.new([-50, 0,-55]).run()
+NpcCapsuleTest.new([  0, 0, 5]).run()
+NpcTest.new([ -5, 0, 5]).run()
+SelectorTest.new([  5, 0, 0]).run()
+SoundTest.new([ 10, 0, 10]).run()
+TimeTest.new([ -5, 0, -5]).run()
 
-$SCRIPT.log("tests initialisiert.");
+WalkJobTest.new([  0, 0, -3]).run()
 
-$SCRIPT.log("map 'regressiontest' initialisiert.");
+$SCRIPT.log("tests initialisiert.")
+
+$SCRIPT.log("map 'regressiontest' initialisiert.")



From melven at mail.berlios.de  Fri Feb 29 12:46:18 2008
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Fri, 29 Feb 2008 12:46:18 +0100
Subject: [Dsa-hl-svn] r4084 - in rl/trunk/engine: core/include core/src
	ui/src
Message-ID: <200802291146.m1TBkI26011110@sheep.berlios.de>

Author: melven
Date: 2008-02-29 12:46:06 +0100 (Fri, 29 Feb 2008)
New Revision: 4084

Modified:
   rl/trunk/engine/core/include/Zone.h
   rl/trunk/engine/core/src/Zone.cpp
   rl/trunk/engine/core/src/ZoneManager.cpp
   rl/trunk/engine/ui/src/UiSubsystem.cpp
Log:
-multiple persons ins zone are now handled correctly
 (zone activated when first person enters and deactivated
 when last person leaves)
-QUERYFLAG_PLAYER now set by UiSubsystem::setActiveCharacter,
 so only one person has this flag
=> correct activation of zones (bug FS#30 ?\226?\128?\148 regressiontest: LightzoneTest - Zone zu fr?\195?\188h aktiv )

Modified: rl/trunk/engine/core/include/Zone.h
===================================================================
--- rl/trunk/engine/core/include/Zone.h	2008-02-25 23:22:32 UTC (rev 4083)
+++ rl/trunk/engine/core/include/Zone.h	2008-02-29 11:46:06 UTC (rev 4084)
@@ -59,7 +59,10 @@
         void addEventSource(GameAreaEventSource* gam);
         void removeEventSource(GameAreaEventSource* gam);
         GameAreaEventSourceList& getEventSources();
-	private:
+        void personEntered();
+        void personLeft();
+        bool isActive() const; // only for the ZoneManager, in order to ask if a zone is active use ZoneManager::isZoneActive
+    private:
         bool mNeedsToBeSaved;
         long mId;
         Zone();
@@ -68,6 +71,7 @@
 		std::list<Trigger*> mTriggers;
         GameAreaEventSourceList mEventSources;
         Ogre::String mEaxPreset;
+        int mPersonsInside;
 	};
 
 }

Modified: rl/trunk/engine/core/src/Zone.cpp
===================================================================
--- rl/trunk/engine/core/src/Zone.cpp	2008-02-25 23:22:32 UTC (rev 4083)
+++ rl/trunk/engine/core/src/Zone.cpp	2008-02-29 11:46:06 UTC (rev 4084)
@@ -27,7 +27,7 @@
 {
 
 
-    Zone::Zone(long id, bool needsToBeSaved) : mId(id), mEaxPreset(""), mNeedsToBeSaved(needsToBeSaved)
+    Zone::Zone(long id, bool needsToBeSaved) : mId(id), mEaxPreset(""), mNeedsToBeSaved(needsToBeSaved), mPersonsInside(0)
     {
     }
 
@@ -143,4 +143,19 @@
 	{
 		return mEventSources;
 	}
+
+    bool Zone::isActive() const
+    {
+        return mPersonsInside > 0;
+    }
+
+    void Zone::personEntered()
+    {
+        mPersonsInside++;
+    }
+
+    void Zone::personLeft()
+    {
+        mPersonsInside--;
+    }
 }

Modified: rl/trunk/engine/core/src/ZoneManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ZoneManager.cpp	2008-02-25 23:22:32 UTC (rev 4083)
+++ rl/trunk/engine/core/src/ZoneManager.cpp	2008-02-29 11:46:06 UTC (rev 4084)
@@ -321,13 +321,21 @@
             {
                 Zone *zone = getZone(id);
                 if( zone )
-                    zoneLeft(zone);
+                {
+                    zone->personLeft();
+                    if( !zone->isActive() )
+                        zoneLeft(zone);
+                }
             }
             else
             {
                 Zone *zone = getZone(-id); // means we have to subtract this area from the zone
                 if( zone )
-                    zoneEntered(zone);
+                {
+                    if( !zone->isActive() )
+                        zoneEntered(zone);
+                    zone->personEntered();
+                }
             }
 
 		    update();
@@ -343,13 +351,21 @@
             {
                 Zone *zone = getZone(id);
                 if( zone )
-                    zoneEntered(zone);
+                {
+                    if( !zone->isActive() )
+                        zoneEntered(zone);
+                    zone->personEntered();
+                }
             }
             else
             {
                 Zone *zone = getZone(-id); // means we have to subtract this area from the zone
                 if( zone )
-                    zoneLeft(zone);
+                {
+                    zone->personLeft();
+                    if( !zone->isActive() )
+                        zoneLeft(zone);
+                }
             }
 
 		    update();
@@ -358,6 +374,8 @@
 
     void ZoneManager::zoneEntered(Zone *zone)
     {
+        if( isZoneActive(zone) )
+            return;
         // perhaps the trigger destroys the zone, so we should put the zone in the list, before the triggers does so
         mActiveZones.push_front(zone);
 
@@ -376,6 +394,8 @@
 
     void ZoneManager::zoneLeft(Zone *zone)
     {
+        if( !isZoneActive(zone) )
+            return;
         // perhaps the trigger destroys the zone, so we should put the zone in the list, before the triggers does so
         mActiveZones.remove(zone);
 

Modified: rl/trunk/engine/ui/src/UiSubsystem.cpp
===================================================================
--- rl/trunk/engine/ui/src/UiSubsystem.cpp	2008-02-25 23:22:32 UTC (rev 4083)
+++ rl/trunk/engine/ui/src/UiSubsystem.cpp	2008-02-29 11:46:06 UTC (rev 4084)
@@ -162,6 +162,7 @@
             {
                 ScriptWrapper::getSingleton().disowned( mCharacter );
                 mCharacter->getActor()->detach(SoundManager::getSingleton().getListenerActor());
+                mCharacter->setQueryFlags(mCharacter->getQueryFlags() & (~QUERYFLAG_PLAYER));
             }
 
             if (person == NULL)
@@ -173,6 +174,7 @@
             {
                 ScriptWrapper::getSingleton().owned( person );
                 mCharacter = person;
+                mCharacter->addQueryFlag(QUERYFLAG_PLAYER);
 
                 mWindowFactory->setActiveCharacter(person);
 



From melven at mail.berlios.de  Fri Feb 29 12:48:31 2008
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Fri, 29 Feb 2008 12:48:31 +0100
Subject: [Dsa-hl-svn] r4085 - in modules: common/dsa common/scripts
	regressiontest/maps
Message-ID: <200802291148.m1TBmVDP013109@sheep.berlios.de>

Author: melven
Date: 2008-02-29 12:48:14 +0100 (Fri, 29 Feb 2008)
New Revision: 4085

Modified:
   modules/common/dsa/gameobjectdefinitions.gof
   modules/common/scripts/hero.rb
   modules/common/scripts/mckhero.rb
   modules/regressiontest/maps/regressiontest_lights.rlmap.xml
Log:
-QUERYFLAG_PLAYER now set by UiSubsystem::setActiveCharacter,
 so only one person has this flag
-added some zones for testing in regressiontest
-animation-names to gameobjectdefinitions

Modified: modules/common/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/common/dsa/gameobjectdefinitions.gof	2008-02-29 11:46:06 UTC (rev 4084)
+++ modules/common/dsa/gameobjectdefinitions.gof	2008-02-29 11:48:14 UTC (rev 4085)
@@ -157,6 +157,54 @@
 				</property>				
 			</property>
 		</property>
+		<!-- Animationen und Animationsgeschwindigkeiten fuer den CreatureController -->
+		<property name="animations" type="MAP">
+			<property name="stehen" type="STRING" data="Idle"/>
+			<property name="stehen_rechts" type="STRING" data="drehen_rechts"/>
+			<property name="stehen_links" type="STRING" data="drehen_links"/>
+			<!-- property name="seitwaerts_links" type="STRING" data="seitwaerts_links"/ -->
+			<!-- property name="seitwaerts_rechts" type="STRING" data="seitwaerts_rechts"/ -->
+			<property name="gehen" type="STRING" data="Walk"/>
+			<property name="gehen_rueckwaerts" type="STRING" data="Walk"/>
+			<property name="joggen_rueckwaerts" type="STRING" data="Run"/>
+			<property name="joggen" type="STRING" data="Run"/>
+			<property name="laufen" type="STRING" data="Run"/>
+			<property name="rennen" type="STRING" data="Run"/>
+			<property name="stehen_zu_schleichen" type="STRING" data="idle_zu_hocke"/>
+			<property name="schleichen_zu_stehen" type="STRING" data="hocke_zu_stehen"/>
+			<property name="schleichen" type="STRING" data="hocke_idle"/>
+			<property name="schleichen_vorwaerts" type="STRING" data="hocke_gehen"/>
+			<property name="hochsprung_absprung" type="STRING" data="idle_absprung"/>
+			<property name="hochsprung" type="STRING" data="idle_sprung"/>
+			<property name="hochsprung_landung" type="STRING" data="idle_sprung_landung"/>
+			<property name="weitsprung_absprung" type="STRING" data="rennen_absprung"/>
+			<property name="weitsprung" type="STRING" data="rennen_sprung"/>
+			<property name="weitsprung_landung" type="STRING" data="rennen_sprung_landung"/>
+		</property>
+		<!-- Je nach key ist die Value ein absoluter oder ein relativer Wert! -->
+		<property name="animationspeeds" type="MAP">
+			<!-- property name="stehen" type="REAL" data="1"/ -->
+			<!-- property name="stehen_rechts" type="REAL" data="drehen_rechts"/ -->
+			<!-- property name="stehen_links" type="REAL" data="drehen_links"/ -->
+			<!-- property name="seitwaerts_links" type="REAL" data="1"/ -->
+			<!-- property name="seitwaerts_rechts" type="REAL" data="1"/ -->
+			<property name="gehen" type="REAL" data="1.1"/>
+			<!-- property name="gehen_rueckwaerts" type="REAL" data="1"/ -->
+			<!-- property name="joggen_rueckwaerts" type="REAL" data="1"/ -->
+			<property name="joggen" type="REAL" data="0.6"/>
+			<property name="laufen" type="REAL" data="0.5"/>
+			<property name="rennen" type="REAL" data="0.4"/>
+			<!-- property name="stehen_zu_schleichen" type="REAL" data="1"/ -->
+			<!-- property name="schleichen_zu_stehen" type="REAL" data="1"/ -->
+			<!-- property name="schleichen" type="REAL" data="1"/ -->
+			<!-- property name="schleichen_vorwaerts" type="REAL" data="1"/ -->
+			<!-- property name="hochsprung_absprung" type="REAL" data="1"/ -->
+			<!-- property name="hochsprung" type="REAL" data="1"/ -->
+			<!-- property name="hochsprung_landung" type="REAL" data="1"/ -->
+			<!-- property name="weitsprung_absprung" type="REAL" data="1"/ -->
+			<!-- property name="weitsprung" type="REAL" data="1"/ -->
+			<!-- property name="weitsprung_landung" type="REAL" data="1"/ -->
+		</property>
     </gameobjectclass>
 
 </GameObjectDefinitions>

Modified: modules/common/scripts/hero.rb
===================================================================
--- modules/common/scripts/hero.rb	2008-02-29 11:46:06 UTC (rev 4084)
+++ modules/common/scripts/hero.rb	2008-02-29 11:48:14 UTC (rev 4085)
@@ -3,7 +3,7 @@
 class Hero < Person
     def initialize(id)
         super(id);
-        addQueryFlag(RlScript::QUERYFLAG_PLAYER)
+        #addQueryFlag(RlScript::QUERYFLAG_PLAYER) #this is done now by setActiveCharacter
 		    
 		setWert(Creature::WERT_MOD_LE, 10); # LE-Mod
 

Modified: modules/common/scripts/mckhero.rb
===================================================================
--- modules/common/scripts/mckhero.rb	2008-02-29 11:46:06 UTC (rev 4084)
+++ modules/common/scripts/mckhero.rb	2008-02-29 11:48:14 UTC (rev 4085)
@@ -3,7 +3,7 @@
 class MCKHero < Person
     def initialize(id)
         super(id);
-        addQueryFlag(RlScript::QUERYFLAG_PLAYER)
+        #addQueryFlag(RlScript::QUERYFLAG_PLAYER) #this is done now by setActiveCharacter
 	setName("Alrike");
 	setDescription("Heldin von Berufung");
 	$SCRIPT.log("Rasse, Kultur und Profession...");

Modified: modules/regressiontest/maps/regressiontest_lights.rlmap.xml
===================================================================
--- modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2008-02-29 11:46:06 UTC (rev 4084)
+++ modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2008-02-29 11:48:14 UTC (rev 4085)
@@ -39,6 +39,10 @@
 				<position x="25" y="0" z="-50"/>
 				<transition_distance>0.5</transition_distance>
 			</area>
+			<area type="sphere" subtract="true">
+				<position x="-11" y="0" z="-4"/>
+				<scale x="2" y="2" z="2"/>
+			</area>
 			<light name="red pointlight"/>
 			<light name="green spotlight"/>
 			<sound name="ruchin001.ogg"/>



From melven at mail.berlios.de  Fri Feb 29 14:34:46 2008
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Fri, 29 Feb 2008 14:34:46 +0100
Subject: [Dsa-hl-svn] r4086 - in modules: common/dsa
	regressiontest/scripts/maps
Message-ID: <200802291334.m1TDYk8o023307@sheep.berlios.de>

Author: melven
Date: 2008-02-29 14:34:38 +0100 (Fri, 29 Feb 2008)
New Revision: 4086

Modified:
   modules/common/dsa/gameobjectdefinitions.gof
   modules/regressiontest/scripts/maps/regressiontest.rb
Log:
using existing female meshes in mckhero, so inventoryTest works again

Modified: modules/common/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/common/dsa/gameobjectdefinitions.gof	2008-02-29 11:48:14 UTC (rev 4085)
+++ modules/common/dsa/gameobjectdefinitions.gof	2008-02-29 13:34:38 UTC (rev 4086)
@@ -60,12 +60,12 @@
         <property name="meshfile" type="STRING" data="men_human_female_torso.mesh"/>
         <property name="geometrytype" type="STRING" data="ellipsoid"/>
 		<property name="meshparts" type="MAP">
-            <property name="torso" type="STRING" data="men_human_male_torso.mesh"/>
-            <property name="hand" type="STRING" data="men_human_male_hand_nude.mesh"/>
-            <property name="head" type="STRING" data="men_human_male_head_01.mesh"/>
+            <property name="torso" type="STRING" data="men_human_female_torso.mesh"/>
+            <property name="hand" type="STRING" data="men_human_female_hand_nude.mesh"/>
+            <property name="head" type="STRING" data="men_human_female_head_02.mesh"/>
             <property name="hair" type="STRING" data="men_human_female_hair_long_01_normal.mesh"/>
-            <property name="trousers" type="STRING" data="men_human_male_leg_pants_01_short.mesh"/>
-            <property name="boots" type="STRING" data="men_human_male_feet_boots_01.mesh"/>
+            <property name="trousers" type="STRING" data="men_human_female_legs_underpants.mesh"/>
+            <property name="boots" type="STRING" data="men_human_female_feet_nude.mesh"/>
         </property>
 		<property name="inventory" type="MAP">
 			<property name="slots" type="ARRAY">

Modified: modules/regressiontest/scripts/maps/regressiontest.rb
===================================================================
--- modules/regressiontest/scripts/maps/regressiontest.rb	2008-02-29 11:48:14 UTC (rev 4085)
+++ modules/regressiontest/scripts/maps/regressiontest.rb	2008-02-29 13:34:38 UTC (rev 4086)
@@ -23,7 +23,7 @@
 require 'effecttest.rb'
 require 'ErrorHandlingTest.rb'
 require 'GameObjectCreationTest.rb'
-#require 'InventoryTest.rb'
+require 'InventoryTest.rb'
 require 'JobSequenceTest.rb'
 require 'LightzoneTest.rb'
 require 'MapLoadingTest.rb'
@@ -43,7 +43,7 @@
 EffectTest.new([  5, 0, 5]).run()
 ErrorHandlingTest.new([-10, 0, 5]).run()
 GameObjectCreationTest.new([0, 0, -10]).run()
-#InventoryTest.new([  0, 0, 10]).run() # Geht nicht, keine Steuerung m?glich
+InventoryTest.new([  0, 0, 10]).run()
 JobSequenceTest.new([  5, 0, -5]).run()
 LightzoneTest.new([-10, 0, -5]).run()
 MapLoadingTest.new([ -5, 0, -10]).run()



From melven at mail.berlios.de  Fri Feb 29 18:41:53 2008
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Fri, 29 Feb 2008 18:41:53 +0100
Subject: [Dsa-hl-svn] r4087 - in rl/trunk/engine: rules/include rules/src
	ui/src
Message-ID: <200802291741.m1THfrA6003710@sheep.berlios.de>

Author: melven
Date: 2008-02-29 18:41:31 +0100 (Fri, 29 Feb 2008)
New Revision: 4087

Modified:
   rl/trunk/engine/rules/include/GameObject.h
   rl/trunk/engine/rules/include/Item.h
   rl/trunk/engine/rules/src/GameObject.cpp
   rl/trunk/engine/rules/src/Item.cpp
   rl/trunk/engine/rules/src/Slot.cpp
   rl/trunk/engine/ui/src/ContainerContentWindow.cpp
Log:
the same items can now be used for female and male heroes
(the first part ("men_human_female_") is specified by owner gameobject)

Modified: rl/trunk/engine/rules/include/GameObject.h
===================================================================
--- rl/trunk/engine/rules/include/GameObject.h	2008-02-29 13:34:38 UTC (rev 4086)
+++ rl/trunk/engine/rules/include/GameObject.h	2008-02-29 17:41:31 UTC (rev 4087)
@@ -61,7 +61,8 @@
         static const Ogre::String PROPERTY_NAME;
         static const Ogre::String PROPERTY_DESCRIPTION; 
         static const Ogre::String PROPERTY_MESHFILE; 
-  		static const Ogre::String PROPERTY_MESHPARTS; 
+  		static const Ogre::String PROPERTY_MESHPARTS;
+        static const Ogre::String PROPERTY_SUBMESHPRENAME;
 		static const Ogre::String PROPERTY_GEOMETRY_TYPE; 
         static const Ogre::String PROPERTY_MASS; 
         static const Ogre::String PROPERTY_ACTIONS; 
@@ -87,6 +88,9 @@
         const CeGuiString getMeshfile() const;
         void setMeshfile(CeGuiString meshfile);
 
+        const CeGuiString getSubmeshPreName() const;
+        void setSubmeshPreName(CeGuiString name);
+
 		const MeshPartMap& getMeshParts() const;
 
         const GeometryType getGeometryType() const;
@@ -187,6 +191,7 @@
         CeGuiString mDescription;
         CeGuiString mMeshfile;
 		MeshPartMap mMeshParts;
+        CeGuiString mSubmeshPreName;
         Ogre::String mClassId;
         
         Actor* mActor;

Modified: rl/trunk/engine/rules/include/Item.h
===================================================================
--- rl/trunk/engine/rules/include/Item.h	2008-02-29 13:34:38 UTC (rev 4086)
+++ rl/trunk/engine/rules/include/Item.h	2008-02-29 17:41:31 UTC (rev 4087)
@@ -60,6 +60,7 @@
         static const Ogre::String PROPERTY_ITEMTYPE;
         static const Ogre::String PROPERTY_IMAGENAME;
         static const Ogre::String PROPERTY_SIZE;
+        static const Ogre::String PROPERTY_SUBMESHNAME;
 
 		Item(unsigned int id);
         virtual ~Item(void);
@@ -70,6 +71,9 @@
 		const CeGuiString getImageName() const;
 		void setImageName(const CeGuiString name);
 
+        const CeGuiString getSubmeshName() const;
+        void setSubmeshName(const CeGuiString &name);
+
 		/**
 		 * @return ob es sich um ein Item handelt,
 		 * in dem andere gespeichert werden koennen
@@ -107,6 +111,7 @@
     protected:
 		ItemType mItemType;
 		CeGuiString mImageName;
+        CeGuiString mSubmeshName;
 		std::pair<int,int> mSize;
         GameObject* mOwner;
         Slot* mParentSlot;

Modified: rl/trunk/engine/rules/src/GameObject.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObject.cpp	2008-02-29 13:34:38 UTC (rev 4086)
+++ rl/trunk/engine/rules/src/GameObject.cpp	2008-02-29 17:41:31 UTC (rev 4087)
@@ -48,6 +48,7 @@
     const Ogre::String GameObject::PROPERTY_DESCRIPTION = "description";
     const Ogre::String GameObject::PROPERTY_MESHFILE = "meshfile";
 	const Ogre::String GameObject::PROPERTY_MESHPARTS = "meshparts";
+    const Ogre::String GameObject::PROPERTY_SUBMESHPRENAME = "submeshprename";
     const Ogre::String GameObject::PROPERTY_GEOMETRY_TYPE = "geometrytype";
     const Ogre::String GameObject::PROPERTY_MASS = "mass";
     const Ogre::String GameObject::PROPERTY_ACTIONS = "actions";
@@ -150,6 +151,16 @@
 		return mMeshParts;
 	}
 
+    const CeGuiString GameObject::getSubmeshPreName() const
+    {
+        return mSubmeshPreName;
+    }
+
+    void GameObject::setSubmeshPreName(CeGuiString name)
+    {
+        mSubmeshPreName = name;
+    }
+
     void GameObject::addAction(Action* action, int option)
     {
         if (action == NULL)
@@ -478,6 +489,10 @@
 			}
 			prop.setValue(map);
 		}
+        else if (key == PROPERTY_SUBMESHPRENAME)
+        {
+            prop.setValue(mSubmeshPreName);
+        }
         else
         {
             Throw(IllegalArgumentException, key + " is not a property of this gameobject ("+mName.c_str()+")");
@@ -558,11 +573,19 @@
             {
                 mDefaultAction = value.toString().c_str();
             }
+            else if (key == PROPERTY_SUBMESHPRENAME)
+            {
+                mSubmeshPreName = value.toString();
+            }
             else
             {
-                LOG_WARNING(
-                    Logger::RULES,
-                    key + " is not a property of this GameObject ("+mName+")");
+                if( key != PROPERTY_BASE_CLASS && key != PROPERTY_CLASS_ID && key != PROPERTY_INHERITS)
+                    // these two keys can be ignored, they are only given to the GameObjectFactory when creating a GOF
+                {
+                    LOG_WARNING(
+                        Logger::RULES,
+                        key + " is not a property of this GameObject ("+mName+")");
+                }
             }
         }
         catch (WrongFormatException ex)

Modified: rl/trunk/engine/rules/src/Item.cpp
===================================================================
--- rl/trunk/engine/rules/src/Item.cpp	2008-02-29 13:34:38 UTC (rev 4086)
+++ rl/trunk/engine/rules/src/Item.cpp	2008-02-29 17:41:31 UTC (rev 4087)
@@ -32,6 +32,7 @@
     const Ogre::String Item::PROPERTY_IMAGENAME = "imagename";
     const Ogre::String Item::PROPERTY_ITEMTYPE = "itemtype";
     const Ogre::String Item::PROPERTY_SIZE = "size";
+    const Ogre::String Item::PROPERTY_SUBMESHNAME = "submeshfile";
 
     Item::Item(unsigned int id)
         : GameObject(id),
@@ -40,7 +41,8 @@
 		mSize(pair<int,int>(1,1)),
         mOwner(NULL),
         mParentSlot(NULL),
-        mParentContainer(NULL)
+        mParentContainer(NULL),
+        mSubmeshName("")
     {
         mQueryFlags |= QUERYFLAG_ITEM;
     }
@@ -173,6 +175,10 @@
         {
             mItemType = static_cast<Item::ItemType>(value.toInt());
         }
+        else if (key == Item::PROPERTY_SUBMESHNAME)
+        {
+            mSubmeshName = value.toString();
+        }
         else
         {
             GameObject::setProperty(key, value);
@@ -193,6 +199,10 @@
         {
             return Property(mItemType);
         }
+        else if (key == Item::PROPERTY_SUBMESHNAME)
+        {
+            return Property(mSubmeshName);
+        }
         else
         {
             return GameObject::getProperty(key);
@@ -243,4 +253,14 @@
     {
         return mParentContainer;
     }
+
+    const CeGuiString Item::getSubmeshName() const
+    {
+        return mSubmeshName;
+    }
+
+    void Item::setSubmeshName(const CeGuiString &name)
+    {
+        mSubmeshName = name;
+    }
 }

Modified: rl/trunk/engine/rules/src/Slot.cpp
===================================================================
--- rl/trunk/engine/rules/src/Slot.cpp	2008-02-29 13:34:38 UTC (rev 4086)
+++ rl/trunk/engine/rules/src/Slot.cpp	2008-02-29 17:41:31 UTC (rev 4087)
@@ -165,9 +165,15 @@
 			    if (item)
 			    {
                     item->doCreateActor();
+                    CeGuiString file = item->getSubmeshName();
+                    if( file == "" )
+                        file = item->getMeshfile();
+                    else
+                        file = mOwner->getSubmeshPreName()+file;
+
 				    mmo->replaceSubmesh(
 					    mSubmesh,
-					    item->getMeshfile().c_str());
+					    file.c_str());
 			    }
 		    }
 

Modified: rl/trunk/engine/ui/src/ContainerContentWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/ContainerContentWindow.cpp	2008-02-29 13:34:38 UTC (rev 4086)
+++ rl/trunk/engine/ui/src/ContainerContentWindow.cpp	2008-02-29 17:41:31 UTC (rev 4087)
@@ -200,25 +200,6 @@
 
 	ItemDragContainer* ContainerContentWindow::createItemWindow(Item* item)
 	{
-        CeGuiString icon = item->getImageName();
-
-		if (icon == "")
-		{
-			icon = ItemDragContainer::ICON_UNKNOWN_ITEM;
-		}
-
-        
-
-   //     LOG_MESSAGE("IW", icon);
-   //     Window* itemWindow =
-	  //      CEGUI::WindowManager::getSingletonPtr()->createWindow(
-		 //   "RastullahLook/StaticImage",
-			//mWindow->getName() + "/" + icon
-			//+ "/" + CEGUI::PropertyHelper::intToString(sItemCount++));
-   //     itemWindow->setProperty("Image", icon);
-   //     itemWindow->setPosition(UVector2(cegui_reldim(0), cegui_reldim(0)));
-   //     itemWindow->setSize(UVector2(cegui_reldim(1), cegui_reldim(1)));
-
         ItemDragContainer* itemhandler = getItemWindow(item);
         if( itemhandler )
             return itemhandler;



From melven at mail.berlios.de  Fri Feb 29 18:42:29 2008
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Fri, 29 Feb 2008 18:42:29 +0100
Subject: [Dsa-hl-svn] r4088 - in modules: common/dsa regressiontest/dsa
Message-ID: <200802291742.m1THgTdB004596@sheep.berlios.de>

Author: melven
Date: 2008-02-29 18:42:16 +0100 (Fri, 29 Feb 2008)
New Revision: 4088

Modified:
   modules/common/dsa/Clothing.gof
   modules/common/dsa/gameobjectdefinitions.gof
   modules/regressiontest/dsa/gameobjectdefinitions.gof
   modules/regressiontest/dsa/mapmeshparttest.gof
Log:
the same items can now be used for female and male heroes
(the first part ("men_human_female_") is specified by owner gameobject)

Modified: modules/common/dsa/Clothing.gof
===================================================================
--- modules/common/dsa/Clothing.gof	2008-02-29 17:41:31 UTC (rev 4087)
+++ modules/common/dsa/Clothing.gof	2008-02-29 17:42:16 UTC (rev 4088)
@@ -6,6 +6,7 @@
         <property name="name" type="STRING" data="Lederhose"/>
         <property name="description" type="STRING" data="Eine lange Hose aus geschmeidigem Leder"/>
         <property name="meshfile" type="STRING" data="men_human_female_leg_pants_01_long.mesh"/>
+        <property name="submeshfile" type="STRING" data="leg_pants_01_long.mesh"/>
         <property name="imagename" type="STRING" data="set:ModelThumbnails image:Rucksack"/>
         <property name="mass" type="REAL" data="3.0"/>
         <property name="size" type="INTPAIR" data="2,3"/>
@@ -17,6 +18,7 @@
         <property name="name" type="STRING" data="Ledergewand"/>
         <property name="description" type="STRING" data="Blah, Ledergewand, dingsbums"/>
         <property name="meshfile" type="STRING" data="men_human_female_cloth_short.mesh"/>
+        <property name="submeshfile" type="STRING" data="cloth_short.mesh"/>
         <property name="imagename" type="STRING" data="set:ModelThumbnails image:Rucksack"/>
         <property name="mass" type="REAL" data="3.0"/>
         <property name="size" type="INTPAIR" data="2,3"/>
@@ -28,6 +30,7 @@
         <property name="name" type="STRING" data="Lederstiefel"/>
         <property name="description" type="STRING" data="Hohe Stiefel aus weichem Leder"/>
         <property name="meshfile" type="STRING" data="men_human_female_feet_boots_01.mesh"/>
+        <property name="submeshfile" type="STRING" data="feet_boots_01.mesh"/>
         <property name="imagename" type="STRING" data="set:ModelThumbnails image:Rucksack"/>
         <property name="mass" type="REAL" data="3.0"/>
 	<property name="size" type="INTPAIR" data="2,2"/>

Modified: modules/common/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/common/dsa/gameobjectdefinitions.gof	2008-02-29 17:41:31 UTC (rev 4087)
+++ modules/common/dsa/gameobjectdefinitions.gof	2008-02-29 17:42:16 UTC (rev 4088)
@@ -58,6 +58,7 @@
         <property name="mass" type="REAL" data="75"/>
         <property name="inventorywindowtype" type="STRING" data="inventory_human.xml"/>
         <property name="meshfile" type="STRING" data="men_human_female_torso.mesh"/>
+	<property name="submeshprename" type="STRING" data="men_human_female_"/>
         <property name="geometrytype" type="STRING" data="ellipsoid"/>
 		<property name="meshparts" type="MAP">
             <property name="torso" type="STRING" data="men_human_female_torso.mesh"/>

Modified: modules/regressiontest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/regressiontest/dsa/gameobjectdefinitions.gof	2008-02-29 17:41:31 UTC (rev 4087)
+++ modules/regressiontest/dsa/gameobjectdefinitions.gof	2008-02-29 17:42:16 UTC (rev 4088)
@@ -82,6 +82,7 @@
         <property name="name" type="STRING" data="Rucksack"/>
         <property name="description" type="STRING" data="Ein Lederrucksack (oder so)"/>
         <property name="meshfile" type="STRING" data="men_human_female_backpack_leather_01.mesh"/>
+        <property name="submeshfile" type="STRING" data="backpack_leather_01.mesh"/>
         <property name="imagename" type="STRING" data="set:ModelThumbnails image:Rucksack"/>
         <property name="capacity" type="REAL" data="20.0"/>
         <property name="volume" type="INTPAIR" data="8,6"/>

Modified: modules/regressiontest/dsa/mapmeshparttest.gof
===================================================================
--- modules/regressiontest/dsa/mapmeshparttest.gof	2008-02-29 17:41:31 UTC (rev 4087)
+++ modules/regressiontest/dsa/mapmeshparttest.gof	2008-02-29 17:42:16 UTC (rev 4088)
@@ -4,7 +4,8 @@
     <gameobjectclass classid="mesh construction kit test object" baseclass="GameObject">
         <property name="name" type="STRING" data="M.C.K. Test object"/>
         <property name="description" type="STRING" data="This is the testing object for the M.C.K."/>
-        <property name="meshfile" type="STRING" data="men_human_female_torso.mesh"/>
+	<property name="meshfile" type="STRING" data="men_human_female_torso.mesh"/>
+        <property name="submeshprename" type="STRING" data="men_human_female_"/>
         <property name="geometrytype" type="STRING" data="ellipsoid"/>
         <property name="meshparts" type="MAP">
             <property name="torso" type="STRING" data="men_human_female_torso.mesh"/>
@@ -20,6 +21,7 @@
         <property name="name" type="STRING" data="M.C.K. Test creature"/>
         <property name="description" type="STRING" data="This is the testing creature for the M.C.K."/>
         <property name="meshfile" type="STRING" data="men_human_female_torso.mesh"/>
+        <property name="submeshprename" type="STRING" data="men_human_female_"/>
         <property name="geometrytype" type="STRING" data="ellipsoid"/>
         <property name="meshparts" type="MAP">
             <property name="torso" type="STRING" data="men_human_female_torso.mesh"/>



