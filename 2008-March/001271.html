<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4200 - in rl/trunk/engine/rules: . include src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4200%20-%20in%20rl/trunk/engine/rules%3A%20.%20include%20src&In-Reply-To=%3C200803070036.m270afdG007801%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001270.html">
   <LINK REL="Next"  HREF="001272.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4200 - in rl/trunk/engine/rules: . include src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4200%20-%20in%20rl/trunk/engine/rules%3A%20.%20include%20src&In-Reply-To=%3C200803070036.m270afdG007801%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4200 - in rl/trunk/engine/rules: . include src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Fri Mar  7 01:36:41 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001270.html">[Dsa-hl-svn] r4199 - in rl/trunk/engine: common/include common/src	core/include core/src
</A></li>
        <LI>Next message: <A HREF="001272.html">[Dsa-hl-svn] r4201 - rl/trunk/engine/rules/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1271">[ date ]</a>
              <a href="thread.html#1271">[ thread ]</a>
              <a href="subject.html#1271">[ subject ]</a>
              <a href="author.html#1271">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2008-03-07 01:36:31 +0100 (Fri, 07 Mar 2008)
New Revision: 4200

Added:
   rl/trunk/engine/rules/include/EffectManagementTask.h
   rl/trunk/engine/rules/src/EffectManagementTask.cpp
Modified:
   rl/trunk/engine/rules/RlRules2005.vcproj
   rl/trunk/engine/rules/include/Armor.h
   rl/trunk/engine/rules/include/Container.h
   rl/trunk/engine/rules/include/Creature.h
   rl/trunk/engine/rules/include/Date.h
   rl/trunk/engine/rules/include/Effect.h
   rl/trunk/engine/rules/include/GameObject.h
   rl/trunk/engine/rules/include/GameObjectManager.h
   rl/trunk/engine/rules/include/Item.h
   rl/trunk/engine/rules/include/Makefile.am
   rl/trunk/engine/rules/include/Person.h
   rl/trunk/engine/rules/include/RulesSubsystem.h
   rl/trunk/engine/rules/include/Weapon.h
   rl/trunk/engine/rules/src/Armor.cpp
   rl/trunk/engine/rules/src/Container.cpp
   rl/trunk/engine/rules/src/Creature.cpp
   rl/trunk/engine/rules/src/Date.cpp
   rl/trunk/engine/rules/src/Effect.cpp
   rl/trunk/engine/rules/src/GameObject.cpp
   rl/trunk/engine/rules/src/GameObjectManager.cpp
   rl/trunk/engine/rules/src/Item.cpp
   rl/trunk/engine/rules/src/Makefile.am
   rl/trunk/engine/rules/src/Person.cpp
   rl/trunk/engine/rules/src/RulesSubsystem.cpp
   rl/trunk/engine/rules/src/Weapon.cpp
Log:
Some const correctness fixes
put GameObject effect checking into GameTask

Modified: rl/trunk/engine/rules/RlRules2005.vcproj
===================================================================
--- rl/trunk/engine/rules/RlRules2005.vcproj	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/RlRules2005.vcproj	2008-03-07 00:36:31 UTC (rev 4200)
@@ -339,6 +339,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\EffectManagementTask.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\EffectManager.cpp&quot;
 				&gt;
 			&lt;/File&gt;
@@ -569,6 +573,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\EffectManagementTask.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\EffectManager.h&quot;
 				&gt;
 			&lt;/File&gt;

Modified: rl/trunk/engine/rules/include/Armor.h
===================================================================
--- rl/trunk/engine/rules/include/Armor.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/Armor.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -45,17 +45,17 @@
 		const CeGuiString getDescription() const;
 
 		// Getter 
-		int getKo();
-		int getBr();
-		int getRue();
-		int getBa();
-		int getLA();
-		int getRA();
-		int getLB();
-		int getRB();
-		int getGes();
-		int getGRS();
-		int getGBE();
+		int getKo() const;
+		int getBr() const;
+		int getRue() const;
+		int getBa() const;
+		int getLA() const;
+		int getRA() const;
+		int getLB() const;
+		int getRB() const;
+		int getGes() const;
+		int getGRS() const;
+		int getGBE() const;
 		// und Setter
 		void setKo(int ko);
 		void setBr(int br);

Modified: rl/trunk/engine/rules/include/Container.h
===================================================================
--- rl/trunk/engine/rules/include/Container.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/Container.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -88,7 +88,7 @@
         virtual void setProperty(const CeGuiString&amp; key, const Property&amp; value);
         virtual PropertyKeys getAllPropertyKeys() const;
 
-        bool canHold(Item* item);
+        bool canHold(Item* item) const;
 
         // in order to set the owner of the items in this container correctly override this function
         void setOwner(GameObject *go);
@@ -118,7 +118,7 @@
          * @param cont a container
          * @return true, if cont is this container or any of his parents
         */
-        bool isParent(Container* cont);
+        bool isParent(Container* cont) const;
     };
 }
 

Modified: rl/trunk/engine/rules/include/Creature.h
===================================================================
--- rl/trunk/engine/rules/include/Creature.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/Creature.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -193,11 +193,11 @@
             /**
              *  Returns the current @ref abbdel &quot;LE&quot; of the creature.
              **/
-            virtual int getLe();
+            virtual int getLe() const;
             /**
              *  Returns the maximum @ref abbdel &quot;LE&quot; the creature can have.
              **/
-            virtual int getLeMax();
+            virtual int getLeMax() const;
 
             /**
              *  Veraendert die aktuelle @ref abbdea &quot;AE&quot; der Kreatur.
@@ -211,11 +211,11 @@
             /**
              *  Gibt die aktuelle @ref abbdea &quot;AE&quot; der Kreatur zurueck.
              **/
-            virtual int getAe();
+            virtual int getAe() const;
             /**
              *  Gibt die maximale Anzahl an @ref abbdea &quot;AE&quot; zurueck, die die Kreatur haben kann.
              **/
-            virtual int getAeMax();
+            virtual int getAeMax() const;
 
             /**
              *  Veraendert die aktuelle @ref abbdea &quot;AU&quot; der Kreatur.
@@ -229,28 +229,28 @@
             /**
              *  Gibt die aktuelle @ref abbdea &quot;AU&quot; der Kreatur zurueck.
              **/
-            virtual float getAu();
+            virtual float getAu() const;
             /**
              *  Gibt die maximale Anzahl an @ref abbdea &quot;AE&quot; zurueck, die die Kreatur haben kann.
              **/
-            virtual int getAuMax();
+            virtual int getAuMax() const;
 
             /**
              *  Berechnet den @ref abbdea &quot;AT&quot;-Basiswert der Kreatur.
              **/
-            virtual int getAttackeBasis();
+            virtual int getAttackeBasis() const;
             /**
              *  Berechnet den @ref abbdep &quot;PA&quot;-Basiswert der Kreatur.
              **/
-            virtual int getParadeBasis();
+            virtual int getParadeBasis() const;
             /**
              *  Berechnet den @ref abbdef &quot;FK&quot;-Basiswert der Kreatur.
              **/
-            virtual int getFernkampfBasis();
+            virtual int getFernkampfBasis() const;
             /**
              *  Berechnet den @ref abbdei &quot;INI&quot;-Basiswert der Kreatur.
              **/
-            virtual int getInitiativeBasis();
+            virtual int getInitiativeBasis() const;
 
             /**
              *  Setzt den Basiswert \a wertId auf \a value.
@@ -269,7 +269,7 @@
              *  @throws InvalidArgumentException wertId konnte in mWerte nicht
              *    gefunden werden.
              **/
-            virtual int getWert(Wert wertId, bool getUnmodified = false);
+            virtual int getWert(Wert wertId, bool getUnmodified = false) const;
 
             /**
              *  Gibt der Kreatur @ref abbddea &quot;AP&quot;.
@@ -279,7 +279,7 @@
             /**
              *  Liefert die Gesamtzahl der @ref abbdea &quot;AP&quot; zurueck.
              **/
-            int getAp();
+            int getAp() const;
             /**
              *  Veraendert die verbrauchten @ref abbdea &quot;AP&quot;, wird beim Steigern
              *  aufgerufen.
@@ -289,7 +289,7 @@
             /**
              *  Liefert die verbrauchten @refabbdea &quot;AP&quot; zurueck.
              **/
-            int getUsedAp();
+            int getUsedAp() const;
 
 
 ///////////////////////////////////////////////////////////////////////////////
@@ -305,7 +305,7 @@
              *   Gross/Kleinschreibung beachtet?).
                    *  @ingroup CreatureRubyExports
              **/
-			virtual int getEigenschaft(const CeGuiString eigenschaftName, Effect::ModTag tag = Effect::MODTAG_NONE);
+			virtual int getEigenschaft(const CeGuiString eigenschaftName, Effect::ModTag tag = Effect::MODTAG_NONE) const;
             /**
              *  Setzt den Wert der Eigenschaft \a eigenschaftName auf \a value.
              *  @param eigenschaftName Der Name als Abkuerzung (z.B. @ref abbdem &quot;MU&quot;, 
@@ -355,9 +355,9 @@
               * @param talentName Bezeichnet das Talent
               * @param checkAusweichTalente Gibt an, ob ebenfalls nach Ausweichtalenten gesucht werden soll
             */
-            bool hasTalent(const CeGuiString talentName, bool checkAusweichTalente = true);
+            bool hasTalent(const CeGuiString talentName, bool checkAusweichTalente = true) const;
 
-            virtual int getTalent(const CeGuiString talentName);
+            virtual int getTalent(const CeGuiString talentName) const;
             /**
                    *  Setzt den Wert des Talents \a talentName.
              *  @param talentName Bezeichnet das zu veraendernde Talent.
@@ -442,7 +442,7 @@
              *  Ueberprueft ob die Kreatur einen bestimmten Vorteil hat.
              *  @param vorteilName Der Name des zu ueberpruefenden Vorteils.
              **/
-            virtual bool hasVorteil(const CeGuiString vorteilName);
+            virtual bool hasVorteil(const CeGuiString vorteilName) const;
  
 ///////////////////////////////////////////////////////////////////////////////
 // Nachteile
@@ -458,7 +458,7 @@
              *  Ueberprueft ob die Kreatur einen bestimmten Nachteil hat.
              *  @param nachteilName Der Name des zu ueberpruefenden Nachteils.
              **/
-            virtual bool hasNachteil(const CeGuiString nachteilName);
+            virtual bool hasNachteil(const CeGuiString nachteilName) const;
             /**
              *  Liefert das StateSet des Nachteils zurueck.
              *  Gedacht um die erforderlichen Daten von Schlechten Eigenschaften
@@ -468,7 +468,7 @@
              *  @throws InvalidArgumentException Der Nachteil \a nachteilName konnte
              *   nicht gefunden werden.
              **/
-            virtual int getSchlechteEigenschaft(const CeGuiString nachteilName);
+            virtual int getSchlechteEigenschaft(const CeGuiString nachteilName) const;
 
 ///////////////////////////////////////////////////////////////////////////////
 // Sonderfertigkeiten
@@ -489,7 +489,7 @@
              *   \c mSonderfertigkeiten gefunden werden.
              *  @see SonderfertigkeitMap
              */
-            virtual int getSf(const CeGuiString sfName);
+            virtual int getSf(const CeGuiString sfName) const;
             /**
                    *  Setzt den Wert der @ref abbdes &quot;SF&quot;.
              *  @param sfName Bezeichnet die Sonderfertigkeit deren Wert gesetzt
@@ -509,17 +509,17 @@
             *   \c mSonderfertigkeiten gefunden werden.
              *  @ingroup CreatureRubyExports
              **/
-            virtual SonderfertigkeitenStateSet* getSonderfertigkeitenStateSet(const CeGuiString sfName);
+            virtual SonderfertigkeitenStateSet* getSonderfertigkeitenStateSet(const CeGuiString sfName) const;
 
 ///////////////////////////////////////////////////////////////////////////////
 // Status
             /**
              * Gets the status of a creature.
              **/
-			Effect::Status getStatus();
+			Effect::Status getStatus() const;
 
 
-            bool isMagic();
+            bool isMagic() const;
 
 
 ///////////////////////////////////////////////////////////////////////////////
@@ -705,7 +705,7 @@
              * Gibt an, ob die Creature mit den H&#195;&#164;nden an den Gegenstand herankommt,
              * ihn also ber&#195;&#188;hren kann, mit ihm interagieren etc
             **/
-            virtual bool canReachItem(const Item* item);
+            virtual bool canReachItem(const Item* item) const;
 
             /**
              * Animations-Name und relative/absolute Abspielgeschwindigkeit fuer
@@ -723,24 +723,24 @@
            /**
              *  Berechnet den Basiswert von der @ref abbdea &quot;Astralenergie&quot;.
              **/
-            virtual int getAeBasis();
+            virtual int getAeBasis() const;
             /**
              *  Berechnet den Basiswert von der @ref abbdea &quot;Ausdauer&quot;.
              **/
-            virtual int getAuBasis();
+            virtual int getAuBasis() const;
             /**
              *  Berechnet den Basiswert von der @ref abbdel &quot;Lebensenergie&quot;.
              **/
-            virtual int getLeBasis();
+            virtual int getLeBasis() const;
             /**
              *  Berechnet den Basiswert von der @ref abbdem &quot;Magieresistenz&quot;.
              **/
-            virtual int getMrBasis();
+            virtual int getMrBasis() const;
             /**
              *  Liefert die derzeitge @ref abbdeb &quot;BE&quot; der Kreatur zurueck.
              *  Eventuelle Ruestungsgewoehnung schon beruecksichtigt
              **/
-            virtual int getCurrentBe();
+            virtual int getCurrentBe() const;
 
             /// inherited from GameObject
             virtual void doPlaceIntoScene();

Modified: rl/trunk/engine/rules/include/Date.h
===================================================================
--- rl/trunk/engine/rules/include/Date.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/Date.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -56,6 +56,8 @@
         /// One (dark eye) year in milliseconds
         static const unsigned RL_LONGLONG ONE_YEAR;
 
+        /// One action (Aktion) in milliseconds
+        static const unsigned RL_LONGLONG ONE_AKTION;
         /// One combat round (Kampfrunde) in milliseconds
         static const unsigned RL_LONGLONG ONE_KAMPFRUNDE;
         /// One game round (Spielrunde) in milliseconds

Modified: rl/trunk/engine/rules/include/Effect.h
===================================================================
--- rl/trunk/engine/rules/include/Effect.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/Effect.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -126,9 +126,9 @@
         /// Returns the modificator applied on the value specified by the parameters.
         virtual int getMod(CeGuiString target, ModType type, ModTag tag);
 
-        virtual const Property getProperty(const CeGuiString&amp; key) const;
-        virtual void setProperty(const CeGuiString&amp; key, const Property&amp; value);
-        virtual PropertyKeys getAllPropertyKeys() const;
+        virtual const Property getProperty(const CeGuiString&amp; key) const;
+        virtual void setProperty(const CeGuiString&amp; key, const Property&amp; value);
+        virtual PropertyKeys getAllPropertyKeys() const;
 	protected:
 		CeGuiString mName;
 		CeGuiString mDescription;
@@ -140,7 +140,7 @@
 		bool mEnabled;
 		/// Gibt an, wie oft ein Effekt dieses Namens auf einer Kreatur wirken kann.
 		Quantifier mQuantifier;
-	};
+    };
 }
 
 #endif //__EFFECT_H__

Added: rl/trunk/engine/rules/include/EffectManagementTask.h
===================================================================
--- rl/trunk/engine/rules/include/EffectManagementTask.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/EffectManagementTask.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -0,0 +1,26 @@
+#ifndef __EffectManagementTask__
+#define __EffectManagementTask__
+
+#include &quot;GameTask.h&quot;
+
+namespace rl
+{
+    class EffectManagementTask :
+        public GameTask
+    {
+    public:
+        EffectManagementTask();
+        ~EffectManagementTask();
+
+        virtual void run(Ogre::Real elapsedTime);
+        virtual const Ogre::String&amp; getName() const;
+        virtual void setTimeFactor(Ogre::Real timeFactor);
+
+    private:
+        Ogre::Real mElapsedTime;
+        Ogre::Real mTimeFactor;
+    };
+
+}
+
+#endif

Modified: rl/trunk/engine/rules/include/GameObject.h
===================================================================
--- rl/trunk/engine/rules/include/GameObject.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/GameObject.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -33,13 +33,9 @@
     class EffectManager;
 
     /**
-    * \brief Basisklasse aller spielrelevanten Objekte in RL.
-    * Stellt im Wesentlichen Methoden zur Identifikation von
-    * Objekten innerhalb der Spielwelt bereit.
-    * Hierbei handelt es sich um konkrete Objekte.
-    * Abstrakte Konzepte, wie Date und Action erben nicht von dieser Klasse.
-    *
-    * @todo Ueberlegen, wie man Aktionen situativ aktivierbar macht.
+    * \brief Base class for all game relevant objects in RL
+    * Provides methods for identification of objects within the world
+    * Abstract concepts do not inherit this class
     */
     class _RlRulesExport GameObject 
         : public ActorNotifiedObject, 
@@ -79,17 +75,17 @@
         const Ogre::String getClassId() const;
         void setClassId(Ogre::String classId);
         
-        const CeGuiString getName() const;
-        void setName(CeGuiString name);
+        const CeGuiString&amp; getName() const;
+        void setName(const CeGuiString&amp; name);
 
-        const CeGuiString getDescription() const;
-        void setDescription(CeGuiString description);
+        const CeGuiString&amp; getDescription() const;
+        void setDescription(const CeGuiString&amp; description);
 
-        const CeGuiString getMeshfile() const;
-        void setMeshfile(CeGuiString meshfile);
+        const CeGuiString&amp; getMeshfile() const;
+        void setMeshfile(const CeGuiString&amp; meshfile);
 
-        const CeGuiString getSubmeshPreName() const;
-        void setSubmeshPreName(CeGuiString name);
+        const CeGuiString&amp; getSubmeshPreName() const;
+        void setSubmeshPreName(const CeGuiString&amp; name);
 
 		const MeshPartMap&amp; getMeshParts() const;
 
@@ -170,19 +166,25 @@
         virtual void onStateChange(GameObjectState oldState, GameObjectState newState);
 
         /**
-         * Laesst einen Effekt auf der Kreatur wirken.
-         * @param effect Zeiger auf den Effekt.
+         * Lets an effect affect the game object
+         * @param effect the effect
          * @ingroup CreatureRubyExports
          **/
         void addEffect(Effect* effect);
         void addEffectWithCheckTime(Effect* effect, RL_LONGLONG time);
         void addEffectWithCheckDate(Effect* effect, RL_LONGLONG date);
         void removeEffect(Effect* effect);
+
         /**
-         * Returns a printable list of all Effects app
+         * Returns a printable list of all effects
          */
         CeGuiString getEffects();
 
+        /**
+         * Checks all effects for end-of-life
+         **/
+        void _checkEffects();
+
     protected:
         int mId;
         GameObjectState mState;
@@ -196,13 +198,13 @@
         
         Actor* mActor;
         
-        // Query flags to be set to the actor, when placed into scene.
+        /// Query flags to be set to the actor, when placed into scene.
         unsigned long mQueryFlags;
 
-        /// Soll das GameObject &#252;berhaupt leuchten?
+        /// Shall the game object be selectable
         bool mHighlightingEnabled;
 
-        /// Verwaltet die Effekte die auf die Kreatur wirken.
+        /// Manages the effects affecting this game object
         EffectManager* mEffectManager;
 
         Actor* createActor();
@@ -211,10 +213,6 @@
         virtual void doPlaceIntoScene();
         virtual void doRemoveFromScene();
 
-        /**
-         * Ueberprueft die wirkenden Effekte auf Lebendigkeit
-         **/
-        void checkEffects();
 
     private:
         static int sNextGameObjectId;    

Modified: rl/trunk/engine/rules/include/GameObjectManager.h
===================================================================
--- rl/trunk/engine/rules/include/GameObjectManager.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/GameObjectManager.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -60,7 +60,7 @@
 
         GameObject* createGameObjectFromProperty(const Property&amp; goProp);
 		Property toProperty(const GameObject* const co) const;
-        std::list&lt;const GameObject*&gt; getAllGameObjects() const;
+        std::list&lt;GameObject*&gt; getAllGameObjects() const;
         void setGameObjectFactory(GameObjectFactory* gof);
         void loadProperties(const Ogre::String&amp; module);
 

Modified: rl/trunk/engine/rules/include/Item.h
===================================================================
--- rl/trunk/engine/rules/include/Item.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/Item.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -68,11 +68,11 @@
 		void setItemType(ItemType itemType);
 		ItemType getItemType() const;
 
-		const CeGuiString getImageName() const;
-		void setImageName(const CeGuiString name);
+		const CeGuiString&amp; getImageName() const;
+		void setImageName(const CeGuiString&amp; name);
 
-        const CeGuiString getSubmeshName() const;
-        void setSubmeshName(const CeGuiString &amp;name);
+        const CeGuiString&amp; getSubmeshName() const;
+        void setSubmeshName(const CeGuiString&amp; name);
 
 		/**
 		 * @return ob es sich um ein Item handelt,

Modified: rl/trunk/engine/rules/include/Makefile.am
===================================================================
--- rl/trunk/engine/rules/include/Makefile.am	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/Makefile.am	2008-03-07 00:36:31 UTC (rev 4200)
@@ -14,6 +14,7 @@
 	DsaManager.h \
 	Effect.h \
 	EffectFactory.h \
+	EffectManagementTask.h \
 	EffectManager.h \
 	Eigenschaft.h \
 	EigenschaftenStateSet.h \

Modified: rl/trunk/engine/rules/include/Person.h
===================================================================
--- rl/trunk/engine/rules/include/Person.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/Person.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -30,12 +30,12 @@
 
         Person(unsigned int id);
 
-        CeGuiString getRasse();
-        void setRasse(CeGuiString rasse);
-        CeGuiString getKultur();
-        void setKultur(CeGuiString kultur);
-        CeGuiString getProfession();
-        void setProfession(CeGuiString profession);
+        const CeGuiString&amp; getRasse() const;
+        void setRasse(const CeGuiString&amp; rasse);
+        const CeGuiString&amp; getKultur() const;
+        void setKultur(const CeGuiString&amp; kultur);
+        const CeGuiString&amp; getProfession() const;
+        void setProfession(const CeGuiString&amp; profession);
 
     private:
         CeGuiString mRasse;

Modified: rl/trunk/engine/rules/include/RulesSubsystem.h
===================================================================
--- rl/trunk/engine/rules/include/RulesSubsystem.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/RulesSubsystem.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -27,10 +27,11 @@
     class CombatManager;
     class CreatureControllerManager;
     class DsaManager;
+    class EffectManagementTask;
 	class GameEventLog;
+    class GlobalProperties;
 	class QuestBook;
     class XdimlLoader;
-    class GlobalProperties;
 
 	class _RlRulesExport RulesSubsystem : public Ogre::Singleton&lt;RulesSubsystem&gt;
     {
@@ -50,6 +51,7 @@
         CreatureControllerManager *mMovingCreatureManager;
         XdimlLoader* mXdimlLoader;
         GlobalProperties* mGlobalProperties;
+        EffectManagementTask* mEffectManagementTask;
     };
 }
 

Modified: rl/trunk/engine/rules/include/Weapon.h
===================================================================
--- rl/trunk/engine/rules/include/Weapon.h	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/include/Weapon.h	2008-03-07 00:36:31 UTC (rev 4200)
@@ -65,8 +65,8 @@
 		void setDk(int newDk);
 		int getDk() const;
         bool hasDk(Distanzklasse dk) const;
-		void setKampftechnik(const CeGuiString newKampftechnik);
-		const CeGuiString getKampftechnik() const;
+		void setKampftechnik(const CeGuiString&amp; newKampftechnik);
+		const CeGuiString&amp; getKampftechnik() const;
 
 		/// Return minimum distance in meters where weapon can be used without penalty.
 		Ogre::Real getMinimumDistance() const;

Modified: rl/trunk/engine/rules/src/Armor.cpp
===================================================================
--- rl/trunk/engine/rules/src/Armor.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/Armor.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -44,47 +44,47 @@
 	{
 	}
 
-	int Armor::getKo()
+	int Armor::getKo() const
 	{
 		return mKo;
 	}
-	int Armor::getBr()
+	int Armor::getBr() const
 	{
 		return mBr;
 	}
-	int Armor::getRue()
+	int Armor::getRue() const
 	{
 		return mRue;
 	}
-	int Armor::getBa()
+	int Armor::getBa() const
 	{
 		return mBa;
 	}
-	int Armor::getLA()
+	int Armor::getLA() const
 	{
 		return mLA;
 	}
-	int Armor::getRA()
+	int Armor::getRA() const
 	{
 		return mRA;
 	}
-	int Armor::getLB()
+	int Armor::getLB() const
 	{
 		return mLB;
 	}
-	int Armor::getRB()
+	int Armor::getRB() const
 	{
 		return mRB;
 	}
-	int Armor::getGes()
+	int Armor::getGes() const
 	{
 		return mGes;
 	}
-	int Armor::getGRS()
+	int Armor::getGRS() const
 	{
 		return mGRS;
 	}
-	int Armor::getGBE()
+	int Armor::getGBE() const
 	{
 		return mGBE;
 	}

Modified: rl/trunk/engine/rules/src/Container.cpp
===================================================================
--- rl/trunk/engine/rules/src/Container.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/Container.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -95,7 +95,7 @@
         return mItems;
     }
 
-    bool Container::isParent(Container* cont)
+    bool Container::isParent(Container* cont) const
     {
         if (cont == this)
             return true;
@@ -197,7 +197,7 @@
 
 		bool free = true;
 
-        // Es wird versucht, das Item au&#239;&#191;&#189;erhalb des Containers zu platzieren
+        // Es wird versucht, das Item ausserhalb des Containers zu platzieren
         if (xPos + xSize &gt; mVolume.first
             || yPos + ySize &gt; mVolume.second)
         {
@@ -267,7 +267,7 @@
 
     bool Container::checkSpace(int xStart, int yStart, pair&lt;int,int&gt; space) const
     {
-		// Falls K&#239;&#191;&#189;stchen nicht mehr im Rucksack, ist auch kein Platz mehr :)
+		// Falls Kaestchen nicht mehr im Rucksack, ist auch kein Platz mehr :)
         if ((xStart+space.first) &gt; mVolume.first
             || (yStart+space.second) &gt; mVolume.second)
         {
@@ -401,7 +401,7 @@
         return keys;
     }
 
-    bool Container::canHold(Item* item)
+    bool Container::canHold(Item* item) const
     {
         return findPositionWithEnoughSpace(item-&gt;getSize()) != NO_SPACE_FOR_ITEM;
     }

Modified: rl/trunk/engine/rules/src/Creature.cpp
===================================================================
--- rl/trunk/engine/rules/src/Creature.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/Creature.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -135,7 +135,7 @@
         CreatureControllerManager::getSingleton().detachController(this);
     }
 
-    int Creature::getAttackeBasis()
+    int Creature::getAttackeBasis() const
     {
 		double es = getEigenschaft(E_MUT, Effect::MODTAG_RECALCULATE) +
             getEigenschaft(E_GEWANDTHEIT, Effect::MODTAG_RECALCULATE) +
@@ -144,7 +144,7 @@
         return static_cast&lt;int&gt;(es / 5.0 + 0.5);
     }
 
-    int Creature::getParadeBasis()
+    int Creature::getParadeBasis() const
     {
       double es = getEigenschaft(E_INTUITION, Effect::MODTAG_RECALCULATE) +
             getEigenschaft(E_GEWANDTHEIT, Effect::MODTAG_RECALCULATE) +
@@ -153,7 +153,7 @@
         return static_cast&lt;int&gt;(es / 5.0 + 0.5);
     }
 
-    int Creature::getFernkampfBasis()
+    int Creature::getFernkampfBasis() const
     {
       double es = getEigenschaft(E_INTUITION, Effect::MODTAG_RECALCULATE) +
             getEigenschaft(E_FINGERFERTIGKEIT, Effect::MODTAG_RECALCULATE) +
@@ -162,7 +162,7 @@
         return static_cast&lt;int&gt;(es / 5.0 + 0.5);
     }
 
-    int Creature::getInitiativeBasis()
+    int Creature::getInitiativeBasis() const
     {
       int es = 2 * getEigenschaft(E_MUT, Effect::MODTAG_RECALCULATE) +
           getEigenschaft(E_INTUITION, Effect::MODTAG_RECALCULATE) +
@@ -171,7 +171,7 @@
         return static_cast&lt;int&gt;(es / 5.0 + 0.5);
     }
 
-    int Creature::getMrBasis()
+    int Creature::getMrBasis() const
     {
       int es = getEigenschaft(E_MUT, Effect::MODTAG_RECALCULATE) +
           getEigenschaft(E_KLUGHEIT, Effect::MODTAG_RECALCULATE) +
@@ -180,7 +180,7 @@
         return static_cast&lt;int&gt;(es / 5.0 + 0.5);
     }
 
-    int Creature::getLeBasis()
+    int Creature::getLeBasis() const
     {
       int es =  2 * getEigenschaft(E_KONSTITUTION, Effect::MODTAG_RECALCULATE) +
           getEigenschaft(E_KOERPERKRAFT, Effect::MODTAG_RECALCULATE);
@@ -188,7 +188,7 @@
         return static_cast&lt;int&gt;(es / 2.0 + 0.5);
     }
 
-    int Creature::getAuBasis()
+    int Creature::getAuBasis() const
     {
       int es = getEigenschaft(E_MUT, Effect::MODTAG_RECALCULATE) +
           getEigenschaft(E_KONSTITUTION, Effect::MODTAG_RECALCULATE) +
@@ -197,7 +197,7 @@
         return static_cast&lt;int&gt;(es / 2.0 + 0.5);
     }
 
-	int Creature::getAeBasis()
+	int Creature::getAeBasis() const
 	{
       int es = getEigenschaft(E_MUT, Effect::MODTAG_RECALCULATE) +
           getEigenschaft(E_INTUITION, Effect::MODTAG_RECALCULATE) +
@@ -206,9 +206,8 @@
         return static_cast&lt;int&gt;(es / 2.0 + 0.5);
     }
 
-	int Creature::getWert(Wert wertId, bool getUnmodified)
+	int Creature::getWert(Wert wertId, bool getUnmodified) const
 	{
-		checkEffects();
 		WertMap::const_iterator it = mWerte.find(wertId);
         if (it == mWerte.end())
         {
@@ -224,7 +223,7 @@
 		return rval;
 	}
 
-	int Creature::getCurrentBe()
+	int Creature::getCurrentBe() const
 	{
 		pair&lt;int,int&gt; be = mInventory-&gt;getOverallBe();
         ///@todo Ruestungsgewoehnung?
@@ -272,12 +271,12 @@
 		fireObjectStateChangeEvent();
     }
 
-    int Creature::getLe()
+    int Creature::getLe() const
     {
         return mCurrentLe;
     }
 
-    int Creature::getLeMax()
+    int Creature::getLeMax() const
     {
 		return getLeBasis() + getWert(WERT_MOD_LE);
     }
@@ -290,12 +289,12 @@
 		fireObjectStateChangeEvent();
     }
 
-    int Creature::getAe()
+    int Creature::getAe() const
     {
         return mCurrentAe;
     }
 
-    int Creature::getAeMax()
+    int Creature::getAeMax() const
     {
 		return isMagic()?getAeBasis() + getWert(WERT_MOD_AE):0;
     }
@@ -312,12 +311,12 @@
 		fireObjectStateChangeEvent();
     }
 
-    float Creature::getAu()
+    float Creature::getAu() const
     {
         return mCurrentAu;
     }
 
-    int Creature::getAuMax()
+    int Creature::getAuMax() const
     {
 		return getAuBasis() + getWert(WERT_MOD_AU);
     }
@@ -327,7 +326,7 @@
         mAp.total += modifier;
     }
 
-    int Creature::getAp()
+    int Creature::getAp() const
     {
         return mAp.total;
     }
@@ -337,14 +336,13 @@
         mAp.used += modifier;
     }
 
-    int Creature::getUsedAp()
+    int Creature::getUsedAp() const
     {
         return mAp.used;
     }
 
-    int Creature::getEigenschaft(const CeGuiString eigenschaftName, Effect::ModTag tag)
+    int Creature::getEigenschaft(const CeGuiString eigenschaftName, Effect::ModTag tag) const
     {
-		checkEffects();
 		EigenschaftMap::const_iterator it = mEigenschaften.find(eigenschaftName);
 		if (it == mEigenschaften.end())
 		{
@@ -372,9 +370,8 @@
 		fireObjectStateChangeEvent();
     }
 
-    bool Creature::hasTalent(const CeGuiString talentName, bool ausweich)
+    bool Creature::hasTalent(const CeGuiString talentName, bool ausweich) const
     {
-		checkEffects();
         TalentMap::const_iterator it = mTalente.find(talentName);
         if (it != mTalente.end())
             return true;
@@ -395,7 +392,7 @@
         return false;
     }
 
-    int Creature::getTalent(const CeGuiString talentName)
+    int Creature::getTalent(const CeGuiString talentName) const
     {
         LOG_DEBUG(Logger::RULES, &quot;Using talent &quot; + talentName);
         TalentMap::const_iterator it = mTalente.find(talentName);
@@ -531,7 +528,7 @@
         mVorteile[vorteilName] = value;
     }
 
-    bool Creature::hasVorteil(const CeGuiString vorteilName)
+    bool Creature::hasVorteil(const CeGuiString vorteilName) const
     {
         VorteilMap::const_iterator it = mVorteile.find(vorteilName);
         if (it != mVorteile.end())
@@ -551,7 +548,7 @@
         mNachteile[nachteilName] = value;
     }
 
-    bool Creature::hasNachteil(const CeGuiString nachteilName)
+    bool Creature::hasNachteil(const CeGuiString nachteilName) const
     {
         NachteilMap::const_iterator it = mNachteile.find(nachteilName);
         if (it != mNachteile.end())
@@ -561,9 +558,8 @@
         else return false;
     }
 
-    int Creature::getSchlechteEigenschaft(const CeGuiString nachteilName)
+    int Creature::getSchlechteEigenschaft(const CeGuiString nachteilName) const
     {
-		checkEffects();
         NachteilMap::const_iterator it = mNachteile.find(nachteilName);
         if (it == mNachteile.end())
         {
@@ -572,9 +568,8 @@
 		else return it-&gt;second + mEffectManager-&gt;getMod(nachteilName, Effect::MODTYPE_SUM);
     }
 
-    int Creature::getSf(const CeGuiString sfName)
+    int Creature::getSf(const CeGuiString sfName) const
     {
-		checkEffects();
         SonderfertigkeitMap::const_iterator it = mSonderfertigkeiten.find(sfName);
         if (it == mSonderfertigkeiten.end())
         {
@@ -609,9 +604,8 @@
 		fireObjectStateChangeEvent();
     }
 
-	SonderfertigkeitenStateSet* Creature::getSonderfertigkeitenStateSet(const CeGuiString sfName)
+	SonderfertigkeitenStateSet* Creature::getSonderfertigkeitenStateSet(const CeGuiString sfName) const
 	{
-		checkEffects();
         SonderfertigkeitMap::const_iterator it = mSonderfertigkeiten.find(sfName);
         if (it == mSonderfertigkeiten.end())
         {
@@ -620,12 +614,12 @@
 		return it-&gt;second;
 	}
 
-    Effect::Status Creature::getStatus()
+    Effect::Status Creature::getStatus() const
     {
       return mEffectManager-&gt;getStatus();
     }
 
-	bool Creature::isMagic()
+	bool Creature::isMagic() const
 	{
 		return getWert(WERT_MOD_AE) &gt; 0;
 	}
@@ -1231,7 +1225,7 @@
         return ret;
     }
 
-    bool Creature::canReachItem(const Item* item)
+    bool Creature::canReachItem(const Item* item) const
     {
         return (item-&gt;getPosition() - getPosition()).length() &lt;= 3.0f;
     }

Modified: rl/trunk/engine/rules/src/Date.cpp
===================================================================
--- rl/trunk/engine/rules/src/Date.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/Date.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -64,6 +64,7 @@
     const unsigned RL_LONGLONG Date::ONE_WEEK = 604800000UL;
     const unsigned RL_LONGLONG Date::ONE_MONTH = 2592000000UL;
     const unsigned RL_LONGLONG Date::ONE_YEAR = 31536000000ULL;
+    const unsigned RL_LONGLONG Date::ONE_AKTION = 1500UL;
     const unsigned RL_LONGLONG Date::ONE_KAMPFRUNDE = 3 * Date::ONE_SECOND;
     const unsigned RL_LONGLONG Date::ONE_SPIELRUNDE = 5 * Date::ONE_MINUTE;
 

Modified: rl/trunk/engine/rules/src/Effect.cpp
===================================================================
--- rl/trunk/engine/rules/src/Effect.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/Effect.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -103,30 +103,30 @@
       return 0;
     }
 
-    const Property Effect::getProperty(const CeGuiString&amp; key) const
-    {
+    const Property Effect::getProperty(const CeGuiString&amp; key) const
+    {
         //else
         //{
             Throw(
                 IllegalArgumentException, 
                 key + &quot; is not a property of this effect (&quot; + mName + &quot;)&quot;);
-        //}
-    }
-
-    void Effect::setProperty(const CeGuiString&amp; key, const Property&amp; value)
-    {
-        // else
-        //{
+        //}
+    }
+
+    void Effect::setProperty(const CeGuiString&amp; key, const Property&amp; value)
+    {
+        // else
+        //{
             LOG_WARNING(
                 Logger::RULES,
-                key + &quot; is not a property of this GameObject (&quot;+mName+&quot;)&quot;);
-        //}
-    }
-
-    PropertyKeys Effect::getAllPropertyKeys() const
-    {
-        PropertyKeys keys;
-        return keys;
-    }
+                key + &quot; is not a property of this GameObject (&quot;+mName+&quot;)&quot;);
+        //}
+    }
 
+    PropertyKeys Effect::getAllPropertyKeys() const
+    {
+        PropertyKeys keys;
+        return keys;
+    }
+
 }

Added: rl/trunk/engine/rules/src/EffectManagementTask.cpp
===================================================================
--- rl/trunk/engine/rules/src/EffectManagementTask.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/EffectManagementTask.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -0,0 +1,64 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#include &quot;stdinc.h&quot; //precompiled header
+
+#include &quot;EffectManagementTask.h&quot;
+
+#include &quot;Date.h&quot;
+#include &quot;GameObject.h&quot;
+#include &quot;GameObjectManager.h&quot;
+
+
+namespace rl
+{
+
+EffectManagementTask::EffectManagementTask()
+: GameTask(true),
+  mElapsedTime(0.0F)
+{
+}
+
+EffectManagementTask::~EffectManagementTask()
+{
+}
+
+void EffectManagementTask::run(Ogre::Real elapsedTime)
+{
+    mElapsedTime += elapsedTime * mTimeFactor;
+    while (mElapsedTime &gt; Date::ONE_AKTION)
+    {
+        std::list&lt;GameObject*&gt; golist = GameObjectManager::getSingleton().getAllGameObjects();
+        for (std::list&lt;GameObject*&gt;::iterator it = golist.begin(); it != golist.end(); ++it)
+        {
+            (*it)-&gt;_checkEffects();
+        }
+
+        mElapsedTime -= Date::ONE_AKTION;
+    }
+}
+
+void EffectManagementTask::setTimeFactor(Ogre::Real timeFactor)
+{
+    mTimeFactor = timeFactor;
+}
+
+const Ogre::String&amp; EffectManagementTask::getName() const
+{
+    static Ogre::String NAME(&quot;EffectManagementTask&quot;);
+    return NAME;
+}
+
+}

Modified: rl/trunk/engine/rules/src/GameObject.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObject.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/GameObject.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -116,32 +116,32 @@
         mClassId = classId;
     }
 
-    const CeGuiString GameObject::getName() const
+    const CeGuiString&amp; GameObject::getName() const
     {
         return mName;
     }
 
-    void GameObject::setName(CeGuiString name)
+    void GameObject::setName(const CeGuiString&amp; name)
     {
         mName = name;
     }
 
-    const CeGuiString GameObject::getDescription() const
+    const CeGuiString&amp; GameObject::getDescription() const
     {
         return mDescription;
     }
 
-    void GameObject::setDescription(CeGuiString description)
+    void GameObject::setDescription(const CeGuiString&amp; description)
     {
         mDescription = description;
     }
 
-    const CeGuiString GameObject::getMeshfile() const
+    const CeGuiString&amp; GameObject::getMeshfile() const
     {
         return mMeshfile;
     }
 
-    void GameObject::setMeshfile(CeGuiString meshfile)
+    void GameObject::setMeshfile(const CeGuiString&amp; meshfile)
     {
         mMeshfile = meshfile;
     }
@@ -151,12 +151,12 @@
 		return mMeshParts;
 	}
 
-    const CeGuiString GameObject::getSubmeshPreName() const
+    const CeGuiString&amp; GameObject::getSubmeshPreName() const
     {
         return mSubmeshPreName;
     }
 
-    void GameObject::setSubmeshPreName(CeGuiString name)
+    void GameObject::setSubmeshPreName(const CeGuiString&amp; name)
     {
         mSubmeshPreName = name;
     }
@@ -432,7 +432,7 @@
       mEffectManager-&gt;addDateCheck(date, effect);
     }
 
-	void GameObject::checkEffects()
+	void GameObject::_checkEffects()
 	{
 		/// @todo Nur einmal pro Aktion ausfuehren
 		mEffectManager-&gt;checkEffects();

Modified: rl/trunk/engine/rules/src/GameObjectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObjectManager.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/GameObjectManager.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -94,9 +94,9 @@
         return NULL;
     }
 
-    std::list&lt;const GameObject*&gt; GameObjectManager::getAllGameObjects() const
+    std::list&lt;GameObject*&gt; GameObjectManager::getAllGameObjects() const
     {
-        std::list&lt;const GameObject*&gt; gos;
+        std::list&lt;GameObject*&gt; gos;
         std::map&lt;unsigned int, GameObject*&gt;::const_iterator it;
 
         //
@@ -307,9 +307,9 @@
         LOG_MESSAGE(Logger::RULES, &quot;Saving Game Objects&quot;);
         DOMElement* gameobjects = writer-&gt;appendChildElement(writer-&gt;getDocument(), writer-&gt;getDocument()-&gt;getDocumentElement(), getXmlNodeIdentifier().c_str());
 
-        std::list&lt;const GameObject*&gt; gos = getAllGameObjects();
+        std::list&lt;GameObject*&gt; gos = getAllGameObjects();
 
-		for(std::list&lt;const GameObject*&gt;::const_iterator it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
+		for(std::list&lt;GameObject*&gt;::const_iterator it_gameobjects = gos.begin(); it_gameobjects != gos.end(); it_gameobjects++)
         {
             DOMElement* gameobject = writer-&gt;appendChildElement(writer-&gt;getDocument(), gameobjects, &quot;gameobject&quot;);
             writer-&gt;setAttributeValueAsInteger(gameobject, &quot;ID&quot;, (*it_gameobjects)-&gt;getId());

Modified: rl/trunk/engine/rules/src/Item.cpp
===================================================================
--- rl/trunk/engine/rules/src/Item.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/Item.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -62,12 +62,12 @@
 		return mItemType;
 	}
 
-	void Item::setImageName(const CeGuiString name)
+	void Item::setImageName(const CeGuiString&amp; name)
 	{
 		mImageName = name;
 	}
 
-	const CeGuiString Item::getImageName() const
+	const CeGuiString&amp; Item::getImageName() const
 	{
 		return mImageName;
 	}
@@ -253,12 +253,12 @@
         return mParentContainer;
     }
 
-    const CeGuiString Item::getSubmeshName() const
+    const CeGuiString&amp; Item::getSubmeshName() const
     {
         return mSubmeshName;
     }
 
-    void Item::setSubmeshName(const CeGuiString &amp;name)
+    void Item::setSubmeshName(const CeGuiString&amp; name)
     {
         mSubmeshName = name;
     }

Modified: rl/trunk/engine/rules/src/Makefile.am
===================================================================
--- rl/trunk/engine/rules/src/Makefile.am	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/Makefile.am	2008-03-07 00:36:31 UTC (rev 4200)
@@ -18,6 +18,7 @@
 	DsaManager.cpp \
 	Effect.cpp \
 	EffectFactory.cpp \
+	EffectManagementTask.cpp \
 	EffectManager.cpp \
 	Eigenschaft.cpp \
 	EigenschaftenStateSet.cpp \

Modified: rl/trunk/engine/rules/src/Person.cpp
===================================================================
--- rl/trunk/engine/rules/src/Person.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/Person.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -29,32 +29,32 @@
         setWert(WERT_KAMPFUNFAEHIGKEITSSCHWELLE, 5);
     }
 
-    CeGuiString Person::getRasse()
+    const CeGuiString&amp; Person::getRasse() const
     {
         return mRasse;
     }
 
-    void Person::setRasse(CeGuiString rasse)
+    void Person::setRasse(const CeGuiString&amp; rasse)
     {
         mRasse = rasse;
     }
 
-    CeGuiString Person::getKultur()
+    const CeGuiString&amp; Person::getKultur() const
     {
         return mKultur;
     }
 
-    void Person::setKultur(CeGuiString kultur)
+    void Person::setKultur(const CeGuiString&amp; kultur)
     {
         mKultur = kultur;
     }
 
-    CeGuiString Person::getProfession()
+    const CeGuiString&amp; Person::getProfession() const
     {
         return mProfession;
     }
 
-    void Person::setProfession(CeGuiString profession)
+    void Person::setProfession(const CeGuiString&amp; profession)
     {
         mProfession = profession;
     }

Modified: rl/trunk/engine/rules/src/RulesSubsystem.cpp
===================================================================
--- rl/trunk/engine/rules/src/RulesSubsystem.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/RulesSubsystem.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -21,6 +21,7 @@
 #include &quot;DsaManager.h&quot;
 #include &quot;DsaDataLoader.h&quot;
 #include &quot;EffectFactory.h&quot;
+#include &quot;EffectManagementTask.h&quot;
 #include &quot;GameEventLog.h&quot;
 #include &quot;Logger.h&quot;
 #include &quot;CreatureControllerManager.h&quot;
@@ -42,7 +43,8 @@
 		mGameEventLog(NULL),
         mMovingCreatureManager(NULL),
         mXdimlLoader(NULL),
-        mGlobalProperties(NULL)
+        mGlobalProperties(NULL),
+        mEffectManagementTask(NULL)
     {
 		LOG_MESSAGE(Logger::RULES, &quot;Start&quot;);
         //Zufallsgenerator initialisieren
@@ -66,6 +68,8 @@
 		LOG_MESSAGE(Logger::RULES, &quot;Questverwaltung erzeugt&quot;);
         mGlobalProperties = new GlobalProperties();
 
+        mEffectManagementTask = new EffectManagementTask();
+
 		//Daten laden
 		mXdimlLoader = new XdimlLoader();
 		LOG_MESSAGE(Logger::RULES, &quot;Basisdaten geladen&quot;);

Modified: rl/trunk/engine/rules/src/Weapon.cpp
===================================================================
--- rl/trunk/engine/rules/src/Weapon.cpp	2008-03-07 00:34:41 UTC (rev 4199)
+++ rl/trunk/engine/rules/src/Weapon.cpp	2008-03-07 00:36:31 UTC (rev 4200)
@@ -162,12 +162,12 @@
 		}
 	}
 
-	void Weapon::setKampftechnik(const CeGuiString newKampftechnik)
+	void Weapon::setKampftechnik(const CeGuiString&amp; newKampftechnik)
 	{
 		mKampftechnik = newKampftechnik;
 	}
 
-	const CeGuiString Weapon::getKampftechnik() const
+	const CeGuiString&amp; Weapon::getKampftechnik() const
 	{
 		return mKampftechnik;
 	}


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001270.html">[Dsa-hl-svn] r4199 - in rl/trunk/engine: common/include common/src	core/include core/src
</A></li>
	<LI>Next message: <A HREF="001272.html">[Dsa-hl-svn] r4201 - rl/trunk/engine/rules/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1271">[ date ]</a>
              <a href="thread.html#1271">[ thread ]</a>
              <a href="subject.html#1271">[ subject ]</a>
              <a href="author.html#1271">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
