<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4277 - in rl/trunk: engine/core engine/core/include	engine/core/include/nulldriver engine/core/src	engine/core/src/nulldriver engine/script/swig	plugins/fmod4driver plugins/fmod4driver/include	plugins/fmod4driver/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4277%20-%20in%20rl/trunk%3A%20engine/core%20engine/core/include%0A%09engine/core/include/nulldriver%20engine/core/src%0A%09engine/core/src/nulldriver%20engine/script/swig%0A%09plugins/fmod4driver%20plugins/fmod4driver/include%0A%09plugins/fmod4driver/src&In-Reply-To=%3C200803082321.m28NLMbT006531%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001347.html">
   <LINK REL="Next"  HREF="001349.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4277 - in rl/trunk: engine/core engine/core/include	engine/core/include/nulldriver engine/core/src	engine/core/src/nulldriver engine/script/swig	plugins/fmod4driver plugins/fmod4driver/include	plugins/fmod4driver/src</H1>
    <B>josch at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4277%20-%20in%20rl/trunk%3A%20engine/core%20engine/core/include%0A%09engine/core/include/nulldriver%20engine/core/src%0A%09engine/core/src/nulldriver%20engine/script/swig%0A%09plugins/fmod4driver%20plugins/fmod4driver/include%0A%09plugins/fmod4driver/src&In-Reply-To=%3C200803082321.m28NLMbT006531%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4277 - in rl/trunk: engine/core engine/core/include	engine/core/include/nulldriver engine/core/src	engine/core/src/nulldriver engine/script/swig	plugins/fmod4driver plugins/fmod4driver/include	plugins/fmod4driver/src">josch at mail.berlios.de
       </A><BR>
    <I>Sun Mar  9 00:21:22 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001347.html">[Dsa-hl-svn] r4276 - in modules/ruchin: maps models
</A></li>
        <LI>Next message: <A HREF="001349.html">[Dsa-hl-svn] r4278 - modules/common/materials/particle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1348">[ date ]</a>
              <a href="thread.html#1348">[ thread ]</a>
              <a href="subject.html#1348">[ subject ]</a>
              <a href="author.html#1348">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: josch
Date: 2008-03-09 00:21:17 +0100 (Sun, 09 Mar 2008)
New Revision: 4277

Added:
   rl/trunk/engine/core/include/SoundStitching.h
   rl/trunk/engine/core/include/nulldriver/NullSoundStitching.h
   rl/trunk/engine/core/src/SoundStitching.cpp
   rl/trunk/engine/core/src/nulldriver/NullSoundStitching.cpp
   rl/trunk/plugins/fmod4driver/include/Fmod4SoundStitching.h
   rl/trunk/plugins/fmod4driver/src/Fmod4SoundStitching.cpp
Modified:
   rl/trunk/engine/core/RlCore2005.vcproj
   rl/trunk/engine/script/swig/RlCore.head.swig
   rl/trunk/engine/script/swig/RlCore.swig
   rl/trunk/plugins/fmod4driver/RlFmod4Driver.vcproj
   rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp
Log:
Introduced sound stitching, which is a means for creating sound sequences on the fly

Modified: rl/trunk/engine/core/RlCore2005.vcproj
===================================================================
--- rl/trunk/engine/core/RlCore2005.vcproj	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/engine/core/RlCore2005.vcproj	2008-03-08 23:21:17 UTC (rev 4277)
@@ -620,6 +620,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\include\SoundStitching.h&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\include\StartAnimationJob.h&quot;
 				&gt;
 			&lt;/File&gt;
@@ -666,6 +670,10 @@
 					RelativePath=&quot;.\include\nulldriver\NullSound.h&quot;
 					&gt;
 				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\nulldriver\NullSoundStitching.h&quot;
+					&gt;
+				&lt;/File&gt;
 			&lt;/Filter&gt;
 		&lt;/Filter&gt;
 		&lt;Filter
@@ -909,6 +917,10 @@
 				&gt;
 			&lt;/File&gt;
 			&lt;File
+				RelativePath=&quot;.\src\SoundStitching.cpp&quot;
+				&gt;
+			&lt;/File&gt;
+			&lt;File
 				RelativePath=&quot;.\src\StartAnimationJob.cpp&quot;
 				&gt;
 			&lt;/File&gt;
@@ -979,6 +991,10 @@
 					RelativePath=&quot;.\src\nulldriver\NullSound.cpp&quot;
 					&gt;
 				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\nulldriver\NullSoundStitching.cpp&quot;
+					&gt;
+				&lt;/File&gt;
 			&lt;/Filter&gt;
 		&lt;/Filter&gt;
 		&lt;Filter

Added: rl/trunk/engine/core/include/SoundStitching.h
===================================================================
--- rl/trunk/engine/core/include/SoundStitching.h	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/engine/core/include/SoundStitching.h	2008-03-08 23:21:17 UTC (rev 4277)
@@ -0,0 +1,177 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+
+#ifndef __SoundStitching_H__
+#define __SoundStitching_H__
+
+#include &quot;CorePrerequisites.h&quot;
+#include &lt;set&gt;
+
+#include &quot;Exception.h&quot;
+#include &quot;EventCaster.h&quot;
+#include &quot;SoundEvents.h&quot;
+#include &quot;SoundResource.h&quot;
+
+namespace rl {
+
+    class SoundDriver;
+
+    typedef std::map&lt;CeGuiString, SoundResourcePtr&gt; SoundCache;
+
+   /** Diese Klasse dient der Interaktion mit dem jeweiligen Soundsystem
+    * ein Objekt stellt eine einzelne Sounddatei oder einen Stream dar
+    * @author Josch
+    * @date 06-29-2005
+    * @version 1.0
+    * @version 2.0
+    */
+    class _RlCoreExport SoundStitching : public Ogre::MovableObject, 
+        public EventCaster&lt;SoundEvent&gt;, public EventSource
+    {
+    public:
+        // Einige Standardwerte f&#195;&#188;r Soundpriorit&#195;&#164;ten.
+        enum SOUND_PRIORITY {
+            PRIO_SPEECH = 30,
+            PRIO_MUSIC = 75,
+            PRIO_SFX_ENVIRONMENT = 128,
+            PRIO_SFX_OTHER = 175,
+            PRIO_OTHER = 220
+        };
+
+        /// Konstruktor
+        SoundStitching(unsigned int numSlots, CeGuiString name, SoundDriver* creator);
+        /// Destruktor
+        virtual ~SoundStitching();
+          
+        /// Laedt den Sound.
+        virtual void load() throw (RuntimeException) = 0;
+        /// Entlaedt den Sound.
+        virtual void unload() throw (RuntimeException) = 0;
+
+        // SoundResource zurueckgeben.
+        const SoundResourcePtr&amp; getSoundResource() const;
+        // Wollen wir 3D?
+        bool is3d() const;
+        // Setzen des 3D-Flags.
+        void set3d(bool is3d);
+        // Sind wir gueltig
+        virtual bool isValid() const throw (RuntimeException) = 0;
+        
+        // Sollen der Sound wiederholt werden?
+        bool isLooping() const;
+        // Setzen des Loop-Flags.
+        void setLooping(bool looping);
+
+        virtual float getLength() const = 0;
+
+        /// Unsere Bounding-Box
+        virtual const Ogre::AxisAlignedBox&amp; getBoundingBox(void) const;
+        /// Bound-Radius
+        virtual Ogre::Real getBoundingRadius() const;
+        /// Rendern
+        virtual void _updateRenderQueue(Ogre::RenderQueue *queue);
+
+        /// Count of configured slots.
+        unsigned int getNumSlots();
+        /// Add a sound resource to the cache overwritting existing sound resource.
+        virtual void addSoundToCache(CeGuiString label, SoundResourcePtr sound);
+        /// Assign a sound recource to a slot.
+        virtual void putSoundIntoSlot(unsigned int, CeGuiString label) = 0;
+        /// Get the slot of the plaing sound.
+        virtual unsigned int getPlayingSlot() = 0;
+
+        /// Gibt die eingestellte Position der Soundquelle zurueck
+        virtual const Ogre::Vector3 getPosition() const = 0;
+        /// Setzt die Position der Soundquelle.
+        virtual void setPosition(const Ogre::Vector3&amp; direction) = 0;
+        /// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck (0.0 ... 1.0)
+	    virtual const Ogre::Real getVolume() const = 0; 
+        /// Setzt die relative Lautstaerke der Soundquelle (0.0 .. 1.0).
+	    virtual void setVolume(const Ogre::Real gain) = 0;
+        /// Gibt die Richtung der Soundquelle zurueck.
+        virtual const Ogre::Quaternion getDirection() const = 0;
+        /// Gibt die Geschwindigkeit der Soundquelle zurueck.
+        virtual const Ogre::Vector3 getVelocity() const = 0;
+        /// Setzt die Richtung der Soundquelle.
+        virtual void setDirection(const Ogre::Quaternion&amp;) = 0;
+        /// Setzt die Geschwindigkeit der Soundquelle.
+        virtual void setVelocity(const Ogre::Vector3&amp;) = 0;
+	    /// Setzt die Entfernung, ab der ein 3D-Sound leiser wird
+	    virtual void setRolloffStartDistance(const Ogre::Real&amp;);
+	    virtual const Ogre::Real getRolloffStartDistance() const;
+	    /// Setzt die Entfernung, ab der ein 3D-Sound nicht mehr leiser wird
+	    virtual void setRolloffEndDistance(const Ogre::Real&amp;);
+	    virtual const Ogre::Real getRolloffEndDistance() const;
+        // Sets the priority of this sound
+        virtual void setPriority(const int priority) = 0;
+        // Gets the priority of this sound
+        virtual const int getPriority() const = 0;
+
+        /// Spielt den Sound ab.
+        virtual void play(bool destroyWhenDone=false) = 0;
+        /// Pausiert den Sound.
+        virtual void pause(bool pausing) = 0;
+        /// Ist der Sound pausiert?
+        virtual bool isPaused() = 0;
+        /// Stoppt den Sound.
+        virtual void stop() = 0;
+        /// Laeuft der Sound noch
+        virtual const bool isPlaying() const = 0;
+
+    protected:
+        SoundDriver* mCreator;
+
+        /// Die Lautstaerke
+	    Ogre::Real mVolume;
+        /// Die Position
+        Ogre::Vector3 mPosition;
+        /// Die Richtung
+        Ogre::Quaternion mDirection;
+        /// Die Geschwindigkeit
+        Ogre::Vector3 mVelocity;
+        /// The priority of this sound
+        int mPriority;
+
+	    Ogre::Real mRolloffStartDistance;
+	    Ogre::Real mRolloffEndDistance;
+
+        // Sound-Cache
+        SoundCache mSoundCache;
+
+    private:
+        /// Shared class-level name for Movable type
+        static Ogre::AxisAlignedBox msAABox;
+
+        /// Der Soundresource, auf den wir verweisen.
+        SoundResourcePtr mSoundResource;
+
+        // Damit die Timings alle 0.5 sek. abgeschickt werden.
+        int mTicks;
+        // Ob dieser Sound 3D sein soll.
+        bool mIs3d;
+        // Ob dieser Sound loopen soll.
+        bool mIsLooping;
+
+        // Anzahl der Soundslots
+        unsigned int mNumSlots;
+
+        // Name
+        CeGuiString mName;
+        
+    }; 
+
+}
+#endif

Added: rl/trunk/engine/core/include/nulldriver/NullSoundStitching.h
===================================================================
--- rl/trunk/engine/core/include/nulldriver/NullSoundStitching.h	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/engine/core/include/nulldriver/NullSoundStitching.h	2008-03-08 23:21:17 UTC (rev 4277)
@@ -0,0 +1,113 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+
+#ifndef __NULLSOUNDSTITCHING_H__
+#define __NULLSOUNDSTITCHING_H__
+
+#include &quot;CorePrerequisites.h&quot;
+#include &quot;SoundResource.h&quot;
+#include &quot;SoundStitching.h&quot;
+
+namespace rl {
+
+   /** Diese Klasse dient der Interaktion mit Ogre3D
+    * @author Josch
+    * @date 07-03-2005
+    * @version 1.0
+    */
+    class _RlCoreExport NullSoundStitching : public SoundStitching
+    {
+    public:
+        /// Konstruktor
+        NullSoundStitching(unsigned int numSlots, CeGuiString name, SoundDriver* creator);
+        /// Destruktor
+        virtual ~NullSoundStitching();
+
+        /// Laedt den Sound.
+        virtual void load() throw (RuntimeException);
+        /// Entlaedt den Sound.
+        virtual void unload() throw (RuntimeException);
+ 
+        // Wir geben zur&#252;ck, wie lange der Sound ist.
+		virtual float getLength() const;
+    
+        /// Moveable-Typ
+        virtual const Ogre::String&amp; getMovableType() const;
+
+        /// Gibt die eingestellte Position der Soundquelle zurueck
+        virtual const Ogre::Vector3 getPosition() const;
+        /// Setzt die Position der Soundquelle.
+        virtual void setPosition(const Ogre::Vector3&amp; direction);
+        /// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck
+       virtual  const Ogre::Real getVolume() const; 
+        /// Setzt die relative Lautstaerke der Soundquelle.
+         void setVolume(const Ogre::Real gain);
+        /// Gibt die Richtung der Soundquelle zurueck.
+         const Ogre::Quaternion getDirection() const;
+        /// Gibt die Geschwindigkeit der Soundquelle zurueck.
+         const Ogre::Vector3 getVelocity() const;
+        /// Setzt die Richtung der Soundquelle.
+         void setDirection(const Ogre::Quaternion&amp;);
+        /// Setzt die Geschwindigkeit der Soundquelle.
+         void setVelocity(const Ogre::Vector3&amp;);
+
+         /// Spielt den Sound ab.
+         void play(bool destroyWhenDone=false);
+        /// Pausiert den Sound.
+         void pause(bool pausing);
+        /// Ist der Sound pausiert?
+         bool isPaused();
+        /// Stoppt den Sound.
+         void stop();
+        /// Zurueck auf Anfang.
+    //         void rewind() throw (RuntimeException);
+        /// Laeuft der Sound noch
+         const bool isPlaying() const;
+        
+        // Sets the priority of this sound
+        virtual void setPriority(const int priority);
+        // Gets the priority of this sound
+        virtual const int getPriority() const;
+
+        /// Assign a sound recource to a slot.
+        virtual void putSoundIntoSlot(unsigned int, CeGuiString label);
+        /// Get the slot of the plaing sound.
+        virtual unsigned int getPlayingSlot();
+
+
+    protected:
+        // Sind wir gueltig?
+        virtual bool isValid() const throw (RuntimeException);
+
+    private:
+        // Shared class-level name for Movable type
+        static Ogre::String msMovableType;
+
+    }; 
+
+    class _RlCoreExport NullSoundStitchingPtr :
+        public Ogre::SharedPtr&lt;NullSoundStitching&gt;
+    {
+    public:
+        NullSoundStitchingPtr() : Ogre::SharedPtr&lt;NullSoundStitching&gt;() {}
+        explicit NullSoundStitchingPtr(NullSoundStitching* rep) : Ogre::SharedPtr&lt;NullSoundStitching&gt;(rep) {}
+        NullSoundStitchingPtr(const NullSoundStitchingPtr&amp; res) : Ogre::SharedPtr&lt;NullSoundStitching&gt;(res) {}
+    protected:
+        void destroy();
+    };
+
+}
+#endif

Added: rl/trunk/engine/core/src/SoundStitching.cpp
===================================================================
--- rl/trunk/engine/core/src/SoundStitching.cpp	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/engine/core/src/SoundStitching.cpp	2008-03-08 23:21:17 UTC (rev 4277)
@@ -0,0 +1,160 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#include &quot;stdinc.h&quot; //precompiled header
+
+#include &quot;SoundStitching.h&quot;
+#include &quot;SoundDriver.h&quot;
+
+using namespace Ogre;
+
+namespace rl
+{
+
+AxisAlignedBox SoundStitching::msAABox = Ogre::AxisAlignedBox(0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
+
+SoundStitching::SoundStitching(unsigned int numSlots, CeGuiString name, SoundDriver* creator)
+:  MovableObject(name.c_str()),
+   EventSource(),
+   EventCaster&lt;SoundEvent&gt;(),
+   mCreator(creator),
+   mVolume(1.0),
+   mName(name),
+   mIsLooping(true),
+   mIs3d(false),
+   mTicks(0),
+   mPosition(Vector3::ZERO),
+   mDirection(Quaternion::IDENTITY),
+   mVelocity(Vector3::ZERO),
+   mPriority(128),
+   mRolloffStartDistance(1.0),
+   mRolloffEndDistance(10000.0),
+   mNumSlots(numSlots)
+{
+}
+
+SoundStitching::~SoundStitching()
+{
+}
+
+/**
+ * @return Ob der Sound wiederholt werden soll
+ * @author JoSch
+ * @date 08-08-2005
+ */
+bool SoundStitching::isLooping() const
+{
+    return mIsLooping;
+}
+
+/**
+ * @param looping Ob der Sound wiederholt werden soll
+ * @author JoSch
+ * @date 08-08-2005
+ */
+void SoundStitching::setLooping(bool looping)
+{
+    mIsLooping = looping;
+}
+
+/**
+ * @return Ob der Sound ein 3D-Sound ist.
+ * @author JoSch
+ * @date 08-08-2005
+ */
+bool SoundStitching::is3d() const
+{
+    return mIs3d;
+}
+
+/**
+ * @param is3d Ob der Sound ein 3D-Sound ist.
+ * @author JoSch
+ * @date 08-08-2005
+ */
+void SoundStitching::set3d(bool is3d)
+{
+    mIs3d = is3d;
+}
+
+/** SoundResource zur&#252;ckgeben.
+ * @return Der Pointer auf die zugeh&#246;rige Soundresource.
+ * @author JoSch
+ * @date 08-08-2005
+ */
+const SoundResourcePtr &amp;SoundStitching::getSoundResource() const
+{
+    return mSoundResource;
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ */
+const AxisAlignedBox&amp; SoundStitching::getBoundingBox() const
+{
+    return msAABox;
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ */
+Real SoundStitching::getBoundingRadius (void) const
+{
+    return 0.0f; // SQRT(3*SQR(0.0)) to fit with AABB
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ */
+void SoundStitching::_updateRenderQueue(RenderQueue *queue)
+{
+    // Brauchen wir nicht
+}
+
+void SoundStitching::setRolloffStartDistance(const Ogre::Real&amp; distance)
+{
+	mRolloffStartDistance = distance;
+}
+
+const Ogre::Real SoundStitching::getRolloffStartDistance() const
+{
+	return mRolloffStartDistance;
+}
+
+void SoundStitching::setRolloffEndDistance(const Ogre::Real&amp; distance)
+{
+	mRolloffEndDistance = distance;
+}
+
+const Ogre::Real SoundStitching::getRolloffEndDistance() const
+{
+	return mRolloffEndDistance;
+}
+
+
+void SoundStitching::addSoundToCache(CeGuiString label, SoundResourcePtr sound)
+{
+    mSoundCache[label] = sound;
+}
+
+unsigned int SoundStitching::getNumSlots()
+{
+    return mNumSlots;
+}
+
+};
\ No newline at end of file

Added: rl/trunk/engine/core/src/nulldriver/NullSoundStitching.cpp
===================================================================
--- rl/trunk/engine/core/src/nulldriver/NullSoundStitching.cpp	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/engine/core/src/nulldriver/NullSoundStitching.cpp	2008-03-08 23:21:17 UTC (rev 4277)
@@ -0,0 +1,273 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#include &quot;stdinc.h&quot;
+
+#include &quot;NullSoundStitching.h&quot;
+#include &quot;NullDriver.h&quot;
+
+#include &quot;SoundManager.h&quot;
+#include &quot;SoundResource.h&quot;
+
+using namespace Ogre;
+using namespace boost;
+
+Ogre::String rl::NullSoundStitching::msMovableType = &quot;NullSoundStitching&quot;;
+
+namespace rl {
+ 
+/**
+ * @param name Der Name des Sounds.
+ * @author JoSch
+ * @date 07-04-2005
+ */
+NullSoundStitching::NullSoundStitching(unsigned int numSlots, CeGuiString name, SoundDriver* creator):
+    SoundStitching(numSlots, name, creator)
+{
+}
+
+/**
+ * @author JoSch
+ * @date 07-04-2005
+ */
+NullSoundStitching::~NullSoundStitching()
+{
+    unload();
+}
+
+
+/**
+ * @author JoSch
+ * @date 07-12-2005
+ */
+void NullSoundStitching::load() throw (RuntimeException)
+{
+}
+
+/**
+ * @author JoSch
+ * @date 07-22-2005
+ */
+void NullSoundStitching::unload() throw (RuntimeException)
+{
+}
+
+/**
+ * @return TRUE wenn der Sound gueltig ist.
+ * @author JoSch
+ * @date 07-12-2005
+ */
+bool NullSoundStitching::isValid() const throw (RuntimeException)
+{
+    return true;
+}
+
+/**
+ * @return Die gesamte Spiell&#228;nge des Sounds
+ * @author JoSch
+ * @date 03-18-2005
+ */
+float NullSoundStitching::getLength() const
+{
+    return 0.0;
+}
+
+void NullSoundStitchingPtr::destroy()
+{
+    SharedPtr&lt;NullSoundStitching&gt;::destroy();
+}
+
+/**
+ * @author JoSch
+ * @date 07-23-2005
+ */
+void NullSoundStitching::play(bool destroyWhenDone)
+{
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ * @return Den Objekttypen
+ */
+const String&amp; NullSoundStitching::getMovableType() const
+{
+    return msMovableType;
+}
+
+
+/**
+ * @return Die aktuelle Richtung der Soundquelle
+ * @author JoSch
+ * @date 07-23-2004
+ */
+const Quaternion NullSoundStitching::getDirection() const
+{
+    return mDirection;
+}
+
+/**
+ * @param direction Die neue Richtung der Soundquelle.
+ * @author JoSch
+ * @date 07-23-2004
+ */
+void NullSoundStitching::setDirection (const Quaternion&amp; direction)
+{
+    mDirection = direction;
+}
+
+/**
+ * @return Spielt die Soundquelle noch?
+ * @author JoSch
+ * @date 07-04-2005
+ */
+const bool NullSoundStitching::isPlaying() const
+{
+    return false;
+}
+
+
+/**
+ * @return Die aktuelle Position der Soundquelle
+ * @author JoSch
+ * @date 07-04-2005
+ */
+const Vector3 NullSoundStitching::getPosition() const
+{
+    return mPosition;
+}
+
+/**
+ * @param position Die neue Position der Soundquelle.
+ * @author JoSch
+ * @date 07-04-2005
+ */
+void NullSoundStitching::setPosition(const Vector3&amp; position)
+{
+    mPosition = position;
+}
+
+/**
+ * @return Die aktuelle Geschwindigkeit der Soundquelle
+ * @author JoSch
+ * @date 07-04-2005
+ */
+const Vector3 NullSoundStitching::getVelocity() const
+{
+    return mVelocity;
+}
+
+/**
+ * @param velocity Die neue Geschwindigkeit der Soundquelle.
+ * @author JoSch
+ * @date 07-04-2005
+ */
+void NullSoundStitching::setVelocity(const Vector3&amp; velocity)
+{
+    mVelocity = velocity;
+}
+
+/**
+ * @return Die aktuelle Lautstaerke der Soundquelle
+ * @author JoSch
+ * @date 07-04-2005
+ */
+const Ogre::Real NullSoundStitching::getVolume() const
+{
+    return mVolume;
+}
+
+/**
+ * @param gain Die neue Lautstarke der Soundquelle.
+ * @author JoSch
+ * @date 07-04-2005
+ */
+void NullSoundStitching::setVolume(const Ogre::Real gain)
+{
+    mVolume = gain;
+}
+
+/**
+ * @param pausing TRUE laesst den Sound unterbrechen.
+ * @author JoSch
+ * @date 07-04-2005
+ */
+void NullSoundStitching::pause(bool pausing)
+{
+}
+
+/**
+ * @author JoSch
+ * @date 07-23-2004
+ */
+void NullSoundStitching::stop()
+{
+}
+
+/**
+ * @return TRUE wenn der Sound unterbrochen wurde.
+ * @author JoSch
+ * @date 07-04-2005
+ */
+bool NullSoundStitching::isPaused()
+{
+    return true;
+}
+
+/**
+ * @author JoSch
+ * @date 14-03-2007
+ * @version 1.0
+ * @param priority The new priority of this sound
+ */ 
+void NullSoundStitching::setPriority(const int priority)
+{
+    mPriority = priority;
+}
+
+/**
+ * @author JoSch
+ * @date 14-03-2007
+ * @version 1.0
+ * @return The new priority of this sound
+ */ 
+const int NullSoundStitching::getPriority() const
+{
+    return mPriority;
+}
+
+/**
+ * @author JoSch
+ * @date 08-03-2008
+ * @version 1.0
+ * @return Assign a sound recource to a slot.
+ */
+void NullSoundStitching::putSoundIntoSlot(unsigned int, CeGuiString label)
+{
+    // Do nothing
+}
+
+/**
+ * @author JoSch
+ * @date 08-03-2008
+ * @version 1.0
+ * @return Get the slot of the plaing sound.
+ */
+unsigned int NullSoundStitching::getPlayingSlot()
+{
+    return 0;
+}
+
+} // Namespace

Modified: rl/trunk/engine/script/swig/RlCore.head.swig
===================================================================
--- rl/trunk/engine/script/swig/RlCore.head.swig	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/engine/script/swig/RlCore.head.swig	2008-03-08 23:21:17 UTC (rev 4277)
@@ -23,6 +23,7 @@
 #include &quot;MeshObject.h&quot;
 #include &quot;MergeableMeshObject.h&quot;
 #include &quot;SoundObject.h&quot;
+#include &quot;SoundStitching.h&quot;
 #include &quot;SoundManager.h&quot;
 #include &quot;ListenerObject.h&quot;
 #include &quot;ListenerMovable.h&quot;

Modified: rl/trunk/engine/script/swig/RlCore.swig
===================================================================
--- rl/trunk/engine/script/swig/RlCore.swig	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/engine/script/swig/RlCore.swig	2008-03-08 23:21:17 UTC (rev 4277)
@@ -763,7 +763,98 @@
     
     bool is3d();
     void set3d(bool is3d);
-};
+};
+
+typedef std::map&lt;CeGuiString, SoundResourcePtr&gt; SoundCache;
+
+class SoundStitching
+{
+public:
+    // Einige Standardwerte f&#252;r Soundpriorit&#228;ten.
+    enum SOUND_PRIORITY {
+        PRIO_SPEECH = 30,
+        PRIO_MUSIC = 75,
+        PRIO_SFX_ENVIRONMENT = 128,
+        PRIO_SFX_OTHER = 175,
+        PRIO_OTHER = 220
+    };
+
+    /// Konstruktor
+    SoundStitching(unsigned int numSlots, rl::CeGuiString name, rl::SoundDriver* creator);
+    /// Destruktor
+    virtual ~SoundStitching();
+      
+    // SoundResource zurueckgeben.
+    const rl::SoundResourcePtr&amp; getSoundResource() const;
+    // Wollen wir 3D?
+    bool is3d() const;
+    // Setzen des 3D-Flags.
+    void set3d(bool is3d);
+    // Sind wir gueltig
+    virtual bool isValid() const;
+    
+    // Sollen der Sound wiederholt werden?
+    bool isLooping() const;
+    // Setzen des Loop-Flags.
+    void setLooping(bool looping);
+
+    virtual float getLength() const = 0;
+
+    /// Unsere Bounding-Box
+    virtual const Ogre::AxisAlignedBox&amp; getBoundingBox(void) const;
+    /// Bound-Radius
+    virtual Ogre::Real getBoundingRadius() const;
+    /// Rendern
+    virtual void _updateRenderQueue(Ogre::RenderQueue *queue);
+
+    /// Count of configured slots.
+    unsigned int getNumSlots();
+    /// Add a sound resource to the cache overwritting existing sound resource.
+    virtual void addSoundToCache(rl::CeGuiString label, rl::SoundResourcePtr sound);
+    /// Assign a sound recource to a slot.
+    virtual void putSoundIntoSlot(unsigned int, rl::CeGuiString label) = 0;
+    /// Get the slot of the plaing sound.
+    virtual unsigned int getPlayingSlot() = 0;
+
+    /// Gibt die eingestellte Position der Soundquelle zurueck
+    virtual const Ogre::Vector3 getPosition() const = 0;
+    /// Setzt die Position der Soundquelle.
+    virtual void setPosition(const Ogre::Vector3&amp; direction) = 0;
+    /// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck (0.0 ... 1.0)
+    virtual const Ogre::Real getVolume() const = 0; 
+    /// Setzt die relative Lautstaerke der Soundquelle (0.0 .. 1.0).
+    virtual void setVolume(const Ogre::Real gain) = 0;
+    /// Gibt die Richtung der Soundquelle zurueck.
+    virtual const Ogre::Quaternion getDirection() const = 0;
+    /// Gibt die Geschwindigkeit der Soundquelle zurueck.
+    virtual const Ogre::Vector3 getVelocity() const = 0;
+    /// Setzt die Richtung der Soundquelle.
+    virtual void setDirection(const Ogre::Quaternion&amp;) = 0;
+    /// Setzt die Geschwindigkeit der Soundquelle.
+    virtual void setVelocity(const Ogre::Vector3&amp;) = 0;
+    /// Setzt die Entfernung, ab der ein 3D-Sound leiser wird
+    virtual void setRolloffStartDistance(const Ogre::Real&amp;);
+    virtual const Ogre::Real getRolloffStartDistance() const;
+    /// Setzt die Entfernung, ab der ein 3D-Sound nicht mehr leiser wird
+    virtual void setRolloffEndDistance(const Ogre::Real&amp;);
+    virtual const Ogre::Real getRolloffEndDistance() const;
+    // Sets the priority of this sound
+    virtual void setPriority(const int priority) = 0;
+    // Gets the priority of this sound
+    virtual const int getPriority() const = 0;
+
+    /// Spielt den Sound ab.
+    virtual void play(bool destroyWhenDone=false) = 0;
+    /// Pausiert den Sound.
+    virtual void pause(bool pausing) = 0;
+    /// Ist der Sound pausiert?
+    virtual bool isPaused() = 0;
+    /// Stoppt den Sound.
+    virtual void stop() = 0;
+    /// Laeuft der Sound noch
+    virtual const bool isPlaying() const = 0;
+   
+}; 
 
 class SoundManager
 {

Modified: rl/trunk/plugins/fmod4driver/RlFmod4Driver.vcproj
===================================================================
--- rl/trunk/plugins/fmod4driver/RlFmod4Driver.vcproj	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/plugins/fmod4driver/RlFmod4Driver.vcproj	2008-03-08 23:21:17 UTC (rev 4277)
@@ -275,6 +275,10 @@
 				RelativePath=&quot;.\src\Fmod4Sound.cpp&quot;
 				&gt;
 			&lt;/File&gt;
+			&lt;File
+				RelativePath=&quot;.\src\Fmod4SoundStitching.cpp&quot;
+				&gt;
+			&lt;/File&gt;
 		&lt;/Filter&gt;
 		&lt;Filter
 			Name=&quot;Header Files&quot;

Added: rl/trunk/plugins/fmod4driver/include/Fmod4SoundStitching.h
===================================================================
--- rl/trunk/plugins/fmod4driver/include/Fmod4SoundStitching.h	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/plugins/fmod4driver/include/Fmod4SoundStitching.h	2008-03-08 23:21:17 UTC (rev 4277)
@@ -0,0 +1,120 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#ifndef _FMOD4SOUNDSTITCHING_H_
+#define _FMOD4SOUNDSTITCHING_H_
+
+#include &quot;Fmod4DriverPrerequisites.h&quot;
+
+#include &quot;SoundStitching.h&quot;
+#include &quot;SoundDriver.h&quot;
+
+#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
+    #include &lt;fmod.hpp&gt;
+#else
+    #include &lt;fmodex/fmod.hpp&gt;
+#endif
+
+namespace rl {
+
+    class Fmod4Driver;
+    typedef std::vector&lt;FMOD::Sound*&gt; SubsoundVector;
+
+    class _RlFmod4DriverExport Fmod4SoundStitching : public SoundStitching
+    {
+    public:
+        /// Konstruktor
+        Fmod4SoundStitching(unsigned int numSlots, CeGuiString name, SoundDriver* creator);
+
+        /// Laedt den Sound.
+        virtual void load() throw (RuntimeException);
+        /// Entlaedt den Sound.
+        virtual void unload() throw (RuntimeException);
+
+		// Sind wir gueltig
+		bool isValid() const throw (RuntimeException);
+
+	    /// Moveable-Typ
+		virtual const Ogre::String&amp; getMovableType() const;
+        /// Gibt die eingestellte Position der Soundquelle zurueck
+		virtual const Ogre::Vector3 getPosition() const;
+		/// Setzt die Position der Soundquelle.
+		virtual void setPosition(const Ogre::Vector3&amp; direction);
+		/// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck (0..1)
+		virtual const float getVolume() const; 
+		/// Setzt die relative Lautstaerke der Soundquelle (0..1)
+		virtual void setVolume(const float gain);
+		/// Gibt die Richtung der Soundquelle zurueck.
+		virtual const Ogre::Quaternion getDirection() const;
+		/// Gibt die Geschwindigkeit der Soundquelle zurueck.
+		virtual const Ogre::Vector3 getVelocity() const;
+		/// Setzt die Richtung der Soundquelle.
+		virtual void setDirection(const Ogre::Quaternion&amp;);
+		/// Setzt die Geschwindigkeit der Soundquelle.
+		virtual void setVelocity(const Ogre::Vector3&amp;);
+        
+        /// Gibt den FMOD Channel zur&#252;ck.
+        FMOD::Channel* getFmodChannel() const;
+        /// Gibt den FMOD Sound zur&#252;ck.
+        FMOD::Sound* getFmodSound() const;
+
+        virtual void play(bool destroyWhenDone=false);
+		/// Pausiert den Sound.
+		virtual void pause(bool pausing);
+		/// Ist der Sound pausiert?
+		virtual bool isPaused();
+		/// Stoppt den Sound.
+		virtual void stop();
+		/// Laeuft der Sound noch
+		virtual const bool isPlaying() const;
+        
+        // Sets the priority of this sound
+        virtual void setPriority(const int priority);
+        // Gets the priority of this sound
+        virtual const int getPriority() const;
+        
+        
+        /// Should the sound be autodestructed when playing is done.
+        bool isAutoDestroying() const;
+
+        /// Assign a sound recource to a slot.
+        virtual void putSoundIntoSlot(unsigned int, CeGuiString label);
+        /// Get the slot of the plaing sound.
+        virtual unsigned int getPlayingSlot();
+
+    private:
+		/// Shared class-level name for Movable type
+		static Ogre::String msMovableType;
+        FMOD::Channel* mChannel;
+        FMOD::Sound *mSound;
+        Fmod4Driver* mDriver;
+        bool mAutoDestroy;
+        SubsoundVector mSoundSlots;
+    };
+
+    class _RlFmod4DriverExport Fmod4SoundStitchingPtr :
+        public Ogre::SharedPtr&lt;Fmod4SoundStitching&gt;
+    {
+    public:
+        Fmod4SoundStitchingPtr() : Ogre::SharedPtr&lt;Fmod4SoundStitching&gt;() {}
+        explicit Fmod4SoundStitchingPtr(Fmod4SoundStitching* rep) : Ogre::SharedPtr&lt;Fmod4SoundStitching&gt;(rep) {}
+        Fmod4SoundStitchingPtr(const Fmod4SoundStitchingPtr&amp; res) : Ogre::SharedPtr&lt;Fmod4SoundStitching&gt;(res) {}
+    protected:
+        void destroy();
+    };
+
+}
+
+#endif /* FMOD3SOUNDSTITCHING_H_ */

Modified: rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp
===================================================================
--- rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp	2008-03-08 23:21:17 UTC (rev 4277)
@@ -480,4 +480,5 @@
         CHECK_FMOD4_ERRORS(res);
         mChannelSoundMap.insert(std::make_pair(channel, sound));
     }
+
 }

Added: rl/trunk/plugins/fmod4driver/src/Fmod4SoundStitching.cpp
===================================================================
--- rl/trunk/plugins/fmod4driver/src/Fmod4SoundStitching.cpp	2008-03-08 22:43:29 UTC (rev 4276)
+++ rl/trunk/plugins/fmod4driver/src/Fmod4SoundStitching.cpp	2008-03-08 23:21:17 UTC (rev 4277)
@@ -0,0 +1,424 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#include &quot;Fmod4SoundStitching.h&quot;
+
+#include &quot;Fmod4Driver.h&quot;
+#include &quot;SoundManager.h&quot;
+#include &quot;SoundResource.h&quot;
+
+using namespace Ogre;
+using namespace boost;
+
+namespace rl {
+
+String Fmod4SoundStitching::msMovableType = &quot;Fmod4SoundStitching&quot;;
+ 
+Fmod4SoundStitching::Fmod4SoundStitching(unsigned int numSlots, CeGuiString name, SoundDriver* creator)
+  : SoundStitching(numSlots, name, creator),
+    mSound(NULL),
+    mChannel(NULL)	
+{
+    setPriority(128);
+}
+
+void Fmod4SoundStitching::load() throw (RuntimeException)
+{
+    FMOD_CREATESOUNDEXINFO exinfo;
+    FMOD_MODE mode = FMOD_OPENUSER;
+
+    if (is3d())
+    {
+        mode |= FMOD_3D;
+    }
+    else
+    {
+        mode |= FMOD_2D;
+    }
+
+    if (isLooping())
+    {
+        mode |= FMOD_LOOP_NORMAL;
+    }
+    else
+    {
+        mode |= FMOD_LOOP_OFF;
+    }
+
+    memset(&amp;exinfo, 0, sizeof(FMOD_CREATESOUNDEXINFO));
+    
+    exinfo.cbsize = sizeof(FMOD_CREATESOUNDEXINFO);
+    exinfo.defaultfrequency = 44100;
+    exinfo.numsubsounds = getNumSlots();
+    exinfo.numchannels = is3d() ? 1 : 2;
+    exinfo.format = FMOD_SOUND_FORMAT_PCM16;
+
+    FMOD_RESULT res = mDriver-&gt;_getFmodSystem()-&gt;createStream(
+        getSoundResource()-&gt;getName().c_str(), 
+        mode, 
+        &amp;exinfo, 
+        &amp;mSound);
+
+    CHECK_FMOD4_ERRORS(res);
+
+    int *sentence = new int[getNumSlots()];
+    for(unsigned int i = 0; i &lt; getNumSlots(); i++)
+    {
+        sentence[i] = i;
+    }
+    res = mSound-&gt;setSubSoundSentence(sentence, getNumSlots());
+    CHECK_FMOD4_ERRORS(res);
+}
+
+void Fmod4SoundStitching::unload() throw (RuntimeException)
+{
+    mSound-&gt;release();
+}
+
+bool Fmod4SoundStitching::isValid() const throw (RuntimeException)
+{
+    return mSound != NULL &amp;&amp; mChannel != NULL;
+}
+
+void Fmod4SoundStitchingPtr::destroy()
+{
+    SharedPtr&lt;Fmod4SoundStitching&gt;::destroy();
+}
+
+const String&amp; Fmod4SoundStitching::getMovableType() const
+{
+    return msMovableType;
+}
+
+void Fmod4SoundStitching::play(bool destroyWhenDone)
+{
+    if (!isValid())
+    {
+        load();
+    }
+
+    FMOD_RESULT res = mDriver-&gt;_getFmodSystem()-&gt;playSound(
+        FMOD_CHANNEL_FREE, 
+        mSound, 
+        true,
+        &amp;mChannel);
+
+    CHECK_FMOD4_ERRORS(res);
+
+    RlAssert1(mChannel != NULL);
+    mAutoDestroy = destroyWhenDone;
+//    mDriver-&gt;_registerChannel(mChannel, this);
+
+    float vol;
+	if (is3d())
+	{
+		vol = mDriver-&gt;getDefaultSoundVolume();
+	}
+	else
+	{
+		vol = mDriver-&gt;getDefaultMusicVolume();
+	}
+	setVolume(vol);
+
+    setPriority(mPriority);
+    setPosition(mPosition);
+    setDirection(mDirection);
+	setVelocity(mVelocity); 
+    pause(false);
+    SoundPlayEvent event = SoundPlayEvent(this, SoundPlayEvent::STARTEVENT);
+    dispatchEvent(&amp;event);
+}
+
+void Fmod4SoundStitching::stop()
+{
+    mChannel-&gt;stop();
+}
+
+void Fmod4SoundStitching::setPosition(const Ogre::Vector3&amp; position)
+{
+	mPosition = position;
+
+	if (isValid())
+	{
+		FMOD_VECTOR pos;
+		pos.x = position.x;
+		pos.y = position.y;
+		pos.z = -position.z;
+		mChannel-&gt;set3DAttributes(&amp;pos, NULL);
+	}
+}
+
+const Ogre::Vector3 Fmod4SoundStitching::getPosition() const
+{
+	if (isValid())
+	{
+		FMOD_VECTOR pos;
+		mChannel-&gt;get3DAttributes(&amp;pos, NULL);
+
+		Vector3 rval;
+		rval.x = pos.x;
+		rval.y = pos.y;
+		rval.z = -pos.z;
+
+		return rval;
+	}
+
+	return mPosition;
+}
+
+const Ogre::Vector3 Fmod4SoundStitching::getVelocity() const
+{
+	if (isValid())
+	{
+		FMOD_VECTOR vel;
+		mChannel-&gt;get3DAttributes(NULL, &amp;vel);
+
+		Vector3 rval;
+		rval.x = vel.x;
+		rval.y = vel.y;
+		rval.z = -vel.z;
+
+		return rval;
+	}
+
+	return mVelocity;
+}
+
+void Fmod4SoundStitching::setVelocity(const Ogre::Vector3&amp; velocity)
+{
+	mVelocity = velocity;
+
+	if (isValid())
+	{
+		FMOD_VECTOR vel;
+		vel.x = velocity.x;
+		vel.y = velocity.y;
+		vel.z = -velocity.z;
+		mChannel-&gt;set3DAttributes(NULL, &amp;vel);
+	}
+}
+
+void Fmod4SoundStitching::setDirection(const Ogre::Quaternion &amp;orientation)
+{
+	mDirection = orientation;
+
+	if (isValid())
+	{
+		FMOD_VECTOR to;
+
+		Vector3 toVec = orientation * Vector3::NEGATIVE_UNIT_Z;
+		to.x = toVec.x;
+		to.y = toVec.y;
+		to.z = -toVec.z;
+
+		mChannel-&gt;set3DConeOrientation(&amp;to);
+	}
+}
+
+const Ogre::Quaternion Fmod4SoundStitching::getDirection() const
+{
+	if (isValid())
+	{
+		FMOD_VECTOR to;
+		mChannel-&gt;get3DConeOrientation(&amp;to);
+
+		Vector3 toVec;
+		toVec.x = to.x;
+		toVec.y = to.y;
+		toVec.z = -to.z;
+
+		return Vector3::NEGATIVE_UNIT_Z.getRotationTo(toVec);
+	}
+
+	return mDirection;
+}
+
+bool Fmod4SoundStitching::isPaused()
+{
+    bool paused;
+    FMOD_RESULT error = mChannel-&gt;getPaused(&amp;paused);
+    return !paused;
+}
+
+const bool Fmod4SoundStitching::isPlaying() const
+{
+    bool playing;
+    FMOD_RESULT error = mChannel-&gt;isPlaying(&amp;playing);
+    return playing;
+}
+
+void Fmod4SoundStitching::pause(bool pause)
+{
+    mChannel-&gt;setPaused(pause);
+}
+
+void Fmod4SoundStitching::setVolume(float vol)
+{
+	mVolume = vol;
+	if (isValid())
+	{
+	    mChannel-&gt;setVolume(vol);
+	}
+}
+
+const float Fmod4SoundStitching::getVolume() const
+{
+	if (isValid())
+	{
+		float vol;
+		mChannel-&gt;getVolume(&amp;vol);
+		return vol;
+	}
+	return mVolume;
+}
+
+/**
+ * @author JoSch
+ * @date 14-03-2007
+ * @version 1.0
+ * @param priority The new priority of this sound
+ */ 
+void Fmod4SoundStitching::setPriority(const int priority)
+{
+    mPriority = priority;
+    if (mPriority &lt; 0)
+    {
+        mPriority = 0;
+    }
+    if (mPriority &gt; 256)
+    {
+        mPriority = 256;
+    }
+    if (isValid())
+    {
+        mChannel-&gt;setPriority(mPriority);
+    }
+}
+
+/**
+ * @author JoSch
+ * @date 14-03-2007
+ * @version 1.0
+ * @return The new priority of this sound
+ */ 
+const int Fmod4SoundStitching::getPriority() const
+{
+    int priority = mPriority;
+    if (isValid())
+    {
+        mChannel-&gt;getPriority(&amp;priority);
+    }
+    return priority;
+}
+
+
+/**
+ * @author JoSch
+ * @date 15-03-2007
+ * @version 1.0
+ * @return The Fmod4 Channel object
+ */ 
+FMOD::Channel *Fmod4SoundStitching::getFmodChannel() const
+{
+    return mChannel;
+}
+
+/**
+ * @author JoSch
+ * @date 15-03-2007
+ * @version 1.0
+ * @return The Fmod4 Sound object
+ */ 
+FMOD::Sound *Fmod4SoundStitching::getFmodSound() const
+{
+    return mSound;
+}
+
+/**
+ * @author JoSch
+ * @date 15-03-2007
+ * @version 1.0
+ * @return TRUE, if the sound should autodestroy when playing ended.
+ */ 
+bool Fmod4SoundStitching::isAutoDestroying() const
+{
+    return mAutoDestroy;
+}
+
+/**
+ * @author JoSch
+ * @date 08-03-2008
+ * @version 1.0
+ */ 
+void Fmod4SoundStitching::putSoundIntoSlot(unsigned int slot, CeGuiString label)
+{
+    if (isValid())
+    {
+        FMOD_MODE mode = FMOD_DEFAULT;
+
+        if (is3d())
+        {
+            mode |= FMOD_3D;
+        }
+        else
+        {
+            mode |= FMOD_2D;
+        }
+
+        if (isLooping())
+        {
+            mode |= FMOD_LOOP_NORMAL;
+        }
+        else
+        {
+            mode |= FMOD_LOOP_OFF;
+        }
+        FMOD::Sound *sound;
+        FMOD_RESULT result = mDriver-&gt;_getFmodSystem()-&gt;createStream(
+            mSoundCache[label]-&gt;getName().c_str(), 
+            mode, 
+            NULL, 
+            &amp;sound);
+        CHECK_FMOD4_ERRORS(result);
+        if (mSoundSlots[slot] != NULL)
+        {
+            mSoundSlots[slot]-&gt;release();
+        }
+        mSoundSlots[slot] = sound;
+
+        result = sound-&gt;setSubSound(slot, sound);
+        CHECK_FMOD4_ERRORS(result);
+    }
+}
+
+/**
+ * @author JoSch
+ * @date 08-03-2008
+ * @version 1.0
+ * @return TRUE, if the sound should autodestroy when playing ended.
+ */ 
+unsigned int Fmod4SoundStitching::getPlayingSlot()
+{
+    if (isValid())
+    {
+        unsigned int currentslot = -1;
+        FMOD_RESULT result = mChannel-&gt;getPosition(&amp;currentslot, (FMOD_TIMEUNIT)(FMOD_TIMEUNIT_SENTENCE_SUBSOUND | FMOD_TIMEUNIT_BUFFERED));
+        CHECK_FMOD4_ERRORS(result);
+        return currentslot;
+    }
+    return -1;
+}
+
+} // Namespace


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001347.html">[Dsa-hl-svn] r4276 - in modules/ruchin: maps models
</A></li>
	<LI>Next message: <A HREF="001349.html">[Dsa-hl-svn] r4278 - modules/common/materials/particle
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1348">[ date ]</a>
              <a href="thread.html#1348">[ thread ]</a>
              <a href="subject.html#1348">[ subject ]</a>
              <a href="author.html#1348">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
