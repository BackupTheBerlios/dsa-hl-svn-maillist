<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4118 - modules/common/dsa modules/common/models	modules/regressiontest/dsa modules/regressiontest/scripts	rl/trunk/engine/core/include rl/trunk/engine/rules/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2008-March/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4118%20-%20modules/common/dsa%20modules/common/models%0A%09modules/regressiontest/dsa%20modules/regressiontest/scripts%0A%09rl/trunk/engine/core/include%20rl/trunk/engine/rules/src&In-Reply-To=%3C200803040031.m240V4lc003879%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001188.html">
   <LINK REL="Next"  HREF="001190.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4118 - modules/common/dsa modules/common/models	modules/regressiontest/dsa modules/regressiontest/scripts	rl/trunk/engine/core/include rl/trunk/engine/rules/src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4118%20-%20modules/common/dsa%20modules/common/models%0A%09modules/regressiontest/dsa%20modules/regressiontest/scripts%0A%09rl/trunk/engine/core/include%20rl/trunk/engine/rules/src&In-Reply-To=%3C200803040031.m240V4lc003879%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4118 - modules/common/dsa modules/common/models	modules/regressiontest/dsa modules/regressiontest/scripts	rl/trunk/engine/core/include rl/trunk/engine/rules/src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Tue Mar  4 01:31:04 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001188.html">[Dsa-hl-svn] r4117 - in rl/trunk/engine/ai: include src
</A></li>
        <LI>Next message: <A HREF="001190.html">[Dsa-hl-svn] r4119 - rl/trunk/engine/common/include
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1189">[ date ]</a>
              <a href="thread.html#1189">[ thread ]</a>
              <a href="subject.html#1189">[ subject ]</a>
              <a href="author.html#1189">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2008-03-04 01:30:59 +0100 (Tue, 04 Mar 2008)
New Revision: 4118

Modified:
   modules/common/dsa/Clothing.gof
   modules/common/dsa/gameobjectdefinitions.gof
   modules/common/models/men_human_female_feet_nude.mesh
   modules/common/models/men_human_female_hair_long_01_normal.mesh
   modules/common/models/men_human_female_head_02.mesh
   modules/common/models/men_human_female_legs_underpants.mesh
   modules/regressiontest/dsa/gameobjectdefinitions.gof
   modules/regressiontest/scripts/MaterialSlotTest.rb
   rl/trunk/engine/core/include/MeshObject.h
   rl/trunk/engine/rules/src/Slot.cpp
Log:
Fix MaterialSlotTest (a bit)

Modified: modules/common/dsa/Clothing.gof
===================================================================
--- modules/common/dsa/Clothing.gof	2008-03-03 21:10:05 UTC (rev 4117)
+++ modules/common/dsa/Clothing.gof	2008-03-04 00:30:59 UTC (rev 4118)
@@ -14,12 +14,13 @@
         &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;box&quot;/&gt;
     &lt;/gameobjectclass&gt;
     
-    &lt;gameobjectclass classid=&quot;men_human_female_cloth_short&quot; baseclass=&quot;Armor&quot;&gt;
+    &lt;gameobjectclass classid=&quot;men_human_female_cloth_short&quot; baseclass=&quot;Clothing&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Ledergewand&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Blah, Ledergewand, dingsbums&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve.mesh&quot;/&gt;
-        &lt;property name=&quot;submeshfile&quot; type=&quot;STRING&quot; data=&quot;cloth_short.mesh&quot;/&gt;
-        &lt;property name=&quot;imagename&quot; type=&quot;STRING&quot; data=&quot;set:ModelThumbnails image:Rucksack&quot;/&gt;
+        &lt;property name=&quot;submeshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve.mesh&quot;/&gt;
+		&lt;property name=&quot;material&quot; type=&quot;STRING&quot; data=&quot;obj_Shortsleeve&quot;/&gt;
+		&lt;property name=&quot;imagename&quot; type=&quot;STRING&quot; data=&quot;set:ModelThumbnails image:Rucksack&quot;/&gt;
         &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;3.0&quot;/&gt;
         &lt;property name=&quot;size&quot; type=&quot;INTPAIR&quot; data=&quot;2,3&quot;/&gt;
         &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;box&quot;/&gt;

Modified: modules/common/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/common/dsa/gameobjectdefinitions.gof	2008-03-03 21:10:05 UTC (rev 4117)
+++ modules/common/dsa/gameobjectdefinitions.gof	2008-03-04 00:30:59 UTC (rev 4118)
@@ -58,7 +58,7 @@
         &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;75&quot;/&gt;
         &lt;property name=&quot;inventorywindowtype&quot; type=&quot;STRING&quot; data=&quot;inventory_human.xml&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
-	&lt;property name=&quot;submeshprename&quot; type=&quot;STRING&quot; data=&quot;men_human_female_&quot;/&gt;
+		&lt;property name=&quot;submeshprename&quot; type=&quot;STRING&quot; data=&quot;men_human_female_&quot;/&gt;
         &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot;/&gt;
 		&lt;property name=&quot;meshparts&quot; type=&quot;MAP&quot;&gt;
             &lt;property name=&quot;torso&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso.mesh&quot;/&gt;
@@ -127,16 +127,16 @@
 				&lt;!-- Torso --&gt;
 				&lt;property type=&quot;MAP&quot;&gt; 
 					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Torso&quot;/&gt;
-					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;material&quot;/&gt;
-					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;submesh&quot;/&gt;
+					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;torso&quot;/&gt;
 					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;32800&quot;/&gt; &lt;!-- Armor | Clothes --&gt;
 					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;32800&quot;/&gt; &lt;!-- Armor | Clothes --&gt;
 				&lt;/property&gt;
 				&lt;!-- Clothes --&gt;
 				&lt;property type=&quot;MAP&quot;&gt; 
 					&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Clothes&quot;/&gt;
-					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;submesh&quot;/&gt;
-					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;clothes&quot;/&gt;
+					&lt;property name=&quot;type&quot; type=&quot;STRING&quot; data=&quot;material&quot;/&gt;
+					&lt;property name=&quot;submesh&quot; type=&quot;STRING&quot; data=&quot;men_human_female_torso&quot;/&gt;
 					&lt;property name=&quot;readies&quot; type=&quot;INT&quot; data=&quot;32768&quot;/&gt; &lt;!-- Clothes --&gt;
 					&lt;property name=&quot;holds&quot; type=&quot;INT&quot; data=&quot;32768&quot;/&gt; &lt;!-- Clothes --&gt;
 				&lt;/property&gt;

Modified: modules/common/models/men_human_female_feet_nude.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_hair_long_01_normal.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_head_02.mesh
===================================================================
(Binary files differ)

Modified: modules/common/models/men_human_female_legs_underpants.mesh
===================================================================
(Binary files differ)

Modified: modules/regressiontest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/regressiontest/dsa/gameobjectdefinitions.gof	2008-03-03 21:10:05 UTC (rev 4117)
+++ modules/regressiontest/dsa/gameobjectdefinitions.gof	2008-03-04 00:30:59 UTC (rev 4118)
@@ -138,16 +138,20 @@
     &lt;gameobjectclass classid=&quot;Clothes #1&quot; baseclass=&quot;Clothing&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Kleidung #1&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Kleidung, Variante 1&quot;/&gt;
-        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve.mesh&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve.mesh&quot;/&gt; &lt;!-- the mesh for when the item is placed in the world --&gt;
+		&lt;property name=&quot;submeshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve.mesh&quot;/&gt; &lt;!-- the mesh for when the item is worn by a creature --&gt;
         &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;box&quot;/&gt;
         &lt;property name=&quot;material&quot; type=&quot;STRING&quot; data=&quot;obj_Shortsleeve&quot;/&gt;
+		&lt;property name=&quot;itemtype&quot; type=&quot;INT&quot; data=&quot;32768&quot;/&gt; &lt;!-- Clothes --&gt;
     &lt;/gameobjectclass&gt;
     &lt;gameobjectclass classid=&quot;Clothes #2&quot; baseclass=&quot;Clothing&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Kleidung #2&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Kleidung, Variante 2&quot;/&gt;
-        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve_2.mesh&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve.mesh&quot;/&gt; &lt;!-- the mesh for when the item is placed in the world --&gt;
+		&lt;property name=&quot;submeshfile&quot; type=&quot;STRING&quot; data=&quot;obj_shortsleeve.mesh&quot;/&gt; &lt;!-- the mesh for when the item is worn by a creature --&gt;
         &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;box&quot;/&gt;
         &lt;property name=&quot;material&quot; type=&quot;STRING&quot; data=&quot;obj_Shortsleeve_2&quot;/&gt;
+		&lt;property name=&quot;itemtype&quot; type=&quot;INT&quot; data=&quot;32768&quot;/&gt; &lt;!-- Clothes --&gt;
     &lt;/gameobjectclass&gt;
 
     &lt;gameobjectclass classid=&quot;MeshAreaTestHouse&quot; baseclass=&quot;GameObject&quot;&gt;

Modified: modules/regressiontest/scripts/MaterialSlotTest.rb
===================================================================
--- modules/regressiontest/scripts/MaterialSlotTest.rb	2008-03-03 21:10:05 UTC (rev 4117)
+++ modules/regressiontest/scripts/MaterialSlotTest.rb	2008-03-04 00:30:59 UTC (rev 4118)
@@ -29,12 +29,12 @@
         test_obj1.setPosition(rel_pos([0, 0, 0]))
         test_obj1.placeIntoScene();
         test_item1 = $GOM.createGameObject(&quot;Clothes #1&quot;)
-        test_obj1.getInventory().hold(test_item1, &quot;Torso&quot;)
+        test_obj1.getInventory().hold(test_item1, &quot;Clothes&quot;)
 
         test_obj2 = $GOM.createGameObject(&quot;mckhero&quot;)
         test_obj2.setPosition(rel_pos([2, 0, 0]))
         test_obj2.placeIntoScene();
         test_item2 = $GOM.createGameObject(&quot;Clothes #2&quot;)
-        test_obj2.getInventory().hold(test_item2, &quot;Torso&quot;)
+        test_obj2.getInventory().hold(test_item2, &quot;Clothes&quot;)
     end
 end

Modified: rl/trunk/engine/core/include/MeshObject.h
===================================================================
--- rl/trunk/engine/core/include/MeshObject.h	2008-03-03 21:10:05 UTC (rev 4117)
+++ rl/trunk/engine/core/include/MeshObject.h	2008-03-04 00:30:59 UTC (rev 4118)
@@ -105,7 +105,7 @@
          * @param material the name of the new material
          * @param submesh (optional) the name of the submesh
          */
-        void setMaterial(const Ogre::String&amp; material, const Ogre::String&amp; submesh);
+        void setMaterial(const Ogre::String&amp; material, const Ogre::String&amp; submesh = &quot;&quot;);
     private:
 		Ogre::String mMeshName;
         Ogre::AxisAlignedBox mSize;

Modified: rl/trunk/engine/rules/src/Slot.cpp
===================================================================
--- rl/trunk/engine/rules/src/Slot.cpp	2008-03-03 21:10:05 UTC (rev 4117)
+++ rl/trunk/engine/rules/src/Slot.cpp	2008-03-04 00:30:59 UTC (rev 4118)
@@ -81,7 +81,7 @@
                 LOG_ERROR(Logger::RULES,
                     &quot;Item '&quot; + item-&gt;getName() + &quot;' konnte nicht in den Slot '&quot; + mName
                     + &quot;' gelegt werden: &quot; + (isAllowed(item) ? &quot;'falscher Typ' &quot; : &quot;&quot;)
-                    + (isEmpty() ? &quot;'Slot schon belegt&quot; : &quot;&quot;) + &quot;!&quot;);
+                    + (isEmpty() ? &quot;'Slot schon belegt'&quot; : &quot;&quot;) + &quot;!&quot;);
                 return false;
             }
         }
@@ -205,6 +205,7 @@
             try
             {
                 CeGuiString mat = item-&gt;getProperty(&quot;material&quot;).toString();
+                CeGuiString mesh = item-&gt;getSubmeshName();
 
                 ///@todo: what to do if actor is null?, think about changing the inventory of an gameobject not in scene
 		        if (mOwner-&gt;getActor())
@@ -212,8 +213,16 @@
 			        MeshObject* mo = dynamic_cast&lt;MeshObject*&gt;(
 				        mOwner-&gt;getActor()-&gt;getControlledObject());
 
+                    MergeableMeshObject* mmo = dynamic_cast&lt;MergeableMeshObject*&gt;(
+				        mo);
+
+                    if (mmo &amp;&amp; !mesh.empty())
+                    {
+                        mmo-&gt;replaceSubmesh(mSubmesh, mesh.c_str());
+                    }
+
 			        if (mo)
-			        {
+			        {                        
                         mo-&gt;setMaterial(mat.c_str(), mSubmesh);
                     }
                 }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001188.html">[Dsa-hl-svn] r4117 - in rl/trunk/engine/ai: include src
</A></li>
	<LI>Next message: <A HREF="001190.html">[Dsa-hl-svn] r4119 - rl/trunk/engine/common/include
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1189">[ date ]</a>
              <a href="thread.html#1189">[ thread ]</a>
              <a href="subject.html#1189">[ subject ]</a>
              <a href="author.html#1189">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
