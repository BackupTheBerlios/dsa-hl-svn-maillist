<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4716 - in rl/trunk: . engine/ai engine/core	engine/core/include engine/core/include/fmod4driver	engine/core/src engine/core/src/fmod4driver engine/ui/include	engine/ui/src tools
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2009-January/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4716%20-%20in%20rl/trunk%3A%20.%20engine/ai%20engine/core%0A%09engine/core/include%20engine/core/include/fmod4driver%0A%09engine/core/src%20engine/core/src/fmod4driver%20engine/ui/include%0A%09engine/ui/src%20tools&In-Reply-To=%3C200901222153.n0MLrDQI014131%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001772.html">
   <LINK REL="Next"  HREF="001774.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4716 - in rl/trunk: . engine/ai engine/core	engine/core/include engine/core/include/fmod4driver	engine/core/src engine/core/src/fmod4driver engine/ui/include	engine/ui/src tools</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4716%20-%20in%20rl/trunk%3A%20.%20engine/ai%20engine/core%0A%09engine/core/include%20engine/core/include/fmod4driver%0A%09engine/core/src%20engine/core/src/fmod4driver%20engine/ui/include%0A%09engine/ui/src%20tools&In-Reply-To=%3C200901222153.n0MLrDQI014131%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4716 - in rl/trunk: . engine/ai engine/core	engine/core/include engine/core/include/fmod4driver	engine/core/src engine/core/src/fmod4driver engine/ui/include	engine/ui/src tools">blakharaz at mail.berlios.de
       </A><BR>
    <I>Thu Jan 22 22:53:13 CET 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001772.html">[Dsa-hl-svn] r4715 - in dependencies/OgreNewt_ngt: inc src
</A></li>
        <LI>Next message: <A HREF="001774.html">[Dsa-hl-svn] r4717 - rl/trunk/Mac/Rastullah.xcodeproj
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1773">[ date ]</a>
              <a href="thread.html#1773">[ thread ]</a>
              <a href="subject.html#1773">[ subject ]</a>
              <a href="author.html#1773">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2009-01-22 22:53:04 +0100 (Thu, 22 Jan 2009)
New Revision: 4716

Added:
   rl/trunk/engine/core/include/fmod4driver/
   rl/trunk/engine/core/include/fmod4driver/Fmod4Driver.h
   rl/trunk/engine/core/include/fmod4driver/Fmod4Listener.h
   rl/trunk/engine/core/include/fmod4driver/Fmod4Sound.h
   rl/trunk/engine/core/include/fmod4driver/Fmod4SoundStitching.h
   rl/trunk/engine/core/src/fmod4driver/
   rl/trunk/engine/core/src/fmod4driver/Fmod4Driver.cpp
   rl/trunk/engine/core/src/fmod4driver/Fmod4Listener.cpp
   rl/trunk/engine/core/src/fmod4driver/Fmod4Sound.cpp
   rl/trunk/engine/core/src/fmod4driver/Fmod4SoundStitching.cpp
   rl/trunk/engine/ui/include/Fmod4ConfigComponent.h
   rl/trunk/engine/ui/src/Fmod4ConfigComponent.cpp
Removed:
   rl/trunk/plugins/
Modified:
   rl/trunk/Rastullah2005.sln
   rl/trunk/engine/ai/
   rl/trunk/engine/core/CMakeLists.txt
   rl/trunk/engine/core/RlCore2005.vcproj
   rl/trunk/engine/core/src/SoundManager.cpp
   rl/trunk/engine/ui/src/GameSettings.cpp
   rl/trunk/tools/copy_dependencies.bat
   rl/trunk/tools/copy_dlls.bat
Log:
Removed sound driver plugins, Fmod 4 is now linked with RlCore

Modified: rl/trunk/Rastullah2005.sln
===================================================================
--- rl/trunk/Rastullah2005.sln	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/Rastullah2005.sln	2009-01-22 21:53:04 UTC (rev 4716)
@@ -1,19 +1,35 @@
 Microsoft Visual Studio Solution File, Format Version 9.00
 # Visual Studio 2005
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlCommon&quot;, &quot;engine\common\RlCommon2005.vcproj&quot;, &quot;{D3185FC6-9384-431A-A237-80284F859B21}&quot;
+	ProjectSection(WebsiteProperties) = preProject
+		Debug.AspNetCompiler.Debug = &quot;True&quot;
+		Release.AspNetCompiler.Debug = &quot;False&quot;
+	EndProjectSection
 EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlCore&quot;, &quot;engine\core\RlCore2005.vcproj&quot;, &quot;{0935F495-4540-40E3-AC8F-AA54C85DC5B2}&quot;
+	ProjectSection(WebsiteProperties) = preProject
+		Debug.AspNetCompiler.Debug = &quot;True&quot;
+		Release.AspNetCompiler.Debug = &quot;False&quot;
+	EndProjectSection
 	ProjectSection(ProjectDependencies) = postProject
 		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
 	EndProjectSection
 EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlRules&quot;, &quot;engine\rules\RlRules2005.vcproj&quot;, &quot;{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}&quot;
+	ProjectSection(WebsiteProperties) = preProject
+		Debug.AspNetCompiler.Debug = &quot;True&quot;
+		Release.AspNetCompiler.Debug = &quot;False&quot;
+	EndProjectSection
 	ProjectSection(ProjectDependencies) = postProject
 		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
 		{0935F495-4540-40E3-AC8F-AA54C85DC5B2} = {0935F495-4540-40E3-AC8F-AA54C85DC5B2}
 	EndProjectSection
 EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlScript&quot;, &quot;engine\script\RlScript2005.vcproj&quot;, &quot;{9A41EAE4-302A-4823-8F20-FA1AD58189A1}&quot;
+	ProjectSection(WebsiteProperties) = preProject
+		Debug.AspNetCompiler.Debug = &quot;True&quot;
+		Release.AspNetCompiler.Debug = &quot;False&quot;
+	EndProjectSection
 	ProjectSection(ProjectDependencies) = postProject
 		{53FE20F3-E726-44FE-BBEC-D29CAE210D25} = {53FE20F3-E726-44FE-BBEC-D29CAE210D25}
 		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
@@ -23,6 +39,10 @@
 	EndProjectSection
 EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlStartup&quot;, &quot;engine\startup\RlStartup2005.vcproj&quot;, &quot;{B78AEF70-E618-4E9D-BD67-E17995ECF714}&quot;
+	ProjectSection(WebsiteProperties) = preProject
+		Debug.AspNetCompiler.Debug = &quot;True&quot;
+		Release.AspNetCompiler.Debug = &quot;False&quot;
+	EndProjectSection
 	ProjectSection(ProjectDependencies) = postProject
 		{53FE20F3-E726-44FE-BBEC-D29CAE210D25} = {53FE20F3-E726-44FE-BBEC-D29CAE210D25}
 		{9A41EAE4-302A-4823-8F20-FA1AD58189A1} = {9A41EAE4-302A-4823-8F20-FA1AD58189A1}
@@ -33,6 +53,10 @@
 	EndProjectSection
 EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlUI&quot;, &quot;engine\ui\RlUI2005.vcproj&quot;, &quot;{53FE20F3-E726-44FE-BBEC-D29CAE210D25}&quot;
+	ProjectSection(WebsiteProperties) = preProject
+		Debug.AspNetCompiler.Debug = &quot;True&quot;
+		Release.AspNetCompiler.Debug = &quot;False&quot;
+	EndProjectSection
 	ProjectSection(ProjectDependencies) = postProject
 		{C3E78B89-587B-499A-BE7D-4FE8564F0CD7} = {C3E78B89-587B-499A-BE7D-4FE8564F0CD7}
 		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
@@ -41,19 +65,16 @@
 	EndProjectSection
 EndProject
 Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlAI&quot;, &quot;engine\ai\RlAI2005.vcproj&quot;, &quot;{C3E78B89-587B-499A-BE7D-4FE8564F0CD7}&quot;
+	ProjectSection(WebsiteProperties) = preProject
+		Debug.AspNetCompiler.Debug = &quot;True&quot;
+		Release.AspNetCompiler.Debug = &quot;False&quot;
+	EndProjectSection
 	ProjectSection(ProjectDependencies) = postProject
 		{0935F495-4540-40E3-AC8F-AA54C85DC5B2} = {0935F495-4540-40E3-AC8F-AA54C85DC5B2}
 		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
 		{1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070} = {1D1D45B2-A9C3-4D10-93EC-22AE4AA5C070}
 	EndProjectSection
 EndProject
-Project(&quot;{8BC9CEB8-8B4A-11D0-8D11-00A0C91BC942}&quot;) = &quot;RlFmod4Driver&quot;, &quot;plugins\fmod4driver\RlFmod4Driver.vcproj&quot;, &quot;{A2DD1E40-4D80-44C5-B04E-1B1C4B07131C}&quot;
-	ProjectSection(ProjectDependencies) = postProject
-		{53FE20F3-E726-44FE-BBEC-D29CAE210D25} = {53FE20F3-E726-44FE-BBEC-D29CAE210D25}
-		{D3185FC6-9384-431A-A237-80284F859B21} = {D3185FC6-9384-431A-A237-80284F859B21}
-		{0935F495-4540-40E3-AC8F-AA54C85DC5B2} = {0935F495-4540-40E3-AC8F-AA54C85DC5B2}
-	EndProjectSection
-EndProject
 Global
 	GlobalSection(SolutionConfigurationPlatforms) = preSolution
 		Debug|Win32 = Debug|Win32
@@ -103,12 +124,6 @@
 		{C3E78B89-587B-499A-BE7D-4FE8564F0CD7}.Release|Win32.Build.0 = Release|Win32
 		{C3E78B89-587B-499A-BE7D-4FE8564F0CD7}.ReleaseWithSymbols|Win32.ActiveCfg = Release with Symbols|Win32
 		{C3E78B89-587B-499A-BE7D-4FE8564F0CD7}.ReleaseWithSymbols|Win32.Build.0 = Release with Symbols|Win32
-		{A2DD1E40-4D80-44C5-B04E-1B1C4B07131C}.Debug|Win32.ActiveCfg = Debug|Win32
-		{A2DD1E40-4D80-44C5-B04E-1B1C4B07131C}.Debug|Win32.Build.0 = Debug|Win32
-		{A2DD1E40-4D80-44C5-B04E-1B1C4B07131C}.Release|Win32.ActiveCfg = Release|Win32
-		{A2DD1E40-4D80-44C5-B04E-1B1C4B07131C}.Release|Win32.Build.0 = Release|Win32
-		{A2DD1E40-4D80-44C5-B04E-1B1C4B07131C}.ReleaseWithSymbols|Win32.ActiveCfg = Release with Symbols|Win32
-		{A2DD1E40-4D80-44C5-B04E-1B1C4B07131C}.ReleaseWithSymbols|Win32.Build.0 = Release with Symbols|Win32
 	EndGlobalSection
 	GlobalSection(SolutionProperties) = preSolution
 		HideSolutionNode = FALSE


Property changes on: rl/trunk/engine/ai
___________________________________________________________________
Name: svn:ignore
   - 
Makefile.in
Makefile

   + Makefile.in
Makefile
obj
lib


Modified: rl/trunk/engine/core/CMakeLists.txt
===================================================================
--- rl/trunk/engine/core/CMakeLists.txt	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/CMakeLists.txt	2009-01-22 21:53:04 UTC (rev 4716)
@@ -1,5 +1,6 @@
 INCLUDE_DIRECTORIES(
 ${CMAKE_CURRENT_SOURCE_DIR}/include
+${CMAKE_CURRENT_SOURCE_DIR}/include/fmod4driver
 ${CMAKE_CURRENT_SOURCE_DIR}/include/nulldriver
 ${RL_COMMON_INCLUDE_DIR}
 ${OGRE_INCLUDE_DIRS}
@@ -82,6 +83,10 @@
 src/World.cpp
 src/Zone.cpp
 src/ZoneManager.cpp
+src/fmod4driver/Fmod4Driver.cpp
+src/fmod4driver/Fmod4Listener.cpp
+src/fmod4driver/Fmod4Sound.cpp
+src/fmod4driver/Fmod4SoundStitching.cpp
 src/nulldriver/NullDriver.cpp
 src/nulldriver/NullListener.cpp
 src/nulldriver/NullSound.cpp

Modified: rl/trunk/engine/core/RlCore2005.vcproj
===================================================================
--- rl/trunk/engine/core/RlCore2005.vcproj	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/RlCore2005.vcproj	2009-01-22 21:53:04 UTC (rev 4716)
@@ -48,7 +48,7 @@
 				Name=&quot;VCCLCompilerTool&quot;
 				AdditionalOptions=&quot;-Zm130&quot;
 				Optimization=&quot;0&quot;
-				AdditionalIncludeDirectories=&quot;.\include;.\include\nulldriver;..\common\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\cegui_mk2\include;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\meshmagick\include&quot;
+				AdditionalIncludeDirectories=&quot;.\include;.\include\nulldriver;.\include\fmod4driver;..\common\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\cegui_mk2\include;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\meshmagick\include;..\..\dependencies\FMOD4\api\inc&quot;
 				PreprocessorDefinitions=&quot;WITH_FMOD3;_WINDOWS,_DEBUG,WIN32,RLCORE_EXPORTS;_CRT_SECURE_NO_DEPRECATE;RL_USE_PCH&quot;
 				MinimalRebuild=&quot;true&quot;
 				BasicRuntimeChecks=&quot;3&quot;
@@ -85,12 +85,12 @@
 				Name=&quot;VCLinkerTool&quot;
 				IgnoreImportLibrary=&quot;true&quot;
 				AdditionalOptions=&quot;/MACHINE:I386&quot;
-				AdditionalDependencies=&quot;RlCommon.lib msvcrt-ruby18.lib OgreNewt_d.lib OgreMain_d.lib xerces-c_2D.lib CEGUIBase_d.lib Newton.lib meshmagick_d.lib&quot;
+				AdditionalDependencies=&quot;RlCommon.lib msvcrt-ruby18.lib OgreNewt_d.lib OgreMain_d.lib xerces-c_2D.lib CEGUIBase_d.lib Newton.lib meshmagick_d.lib fmodex_vc.lib&quot;
 				ShowProgress=&quot;0&quot;
 				OutputFile=&quot;./lib/$(ConfigurationName)/RlCore.dll&quot;
 				LinkIncremental=&quot;2&quot;
 				SuppressStartupBanner=&quot;true&quot;
-				AdditionalLibraryDirectories=&quot;&quot;..\common\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;..\..\dependencies\cegui_mk2\lib;&quot;..\..\dependencies\ogrenewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll;..\..\dependencies\meshmagick\lib&quot;
+				AdditionalLibraryDirectories=&quot;&quot;..\common\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;..\..\dependencies\cegui_mk2\lib;&quot;..\..\dependencies\ogrenewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll;..\..\dependencies\meshmagick\lib;..\..\dependencies\FMOD4\api\lib&quot;
 				IgnoreDefaultLibraryNames=&quot;&quot;
 				TypeLibraryFile=&quot;$(OutDir)\RlCore.lib&quot;
 				GenerateDebugInformation=&quot;true&quot;
@@ -163,7 +163,7 @@
 				Optimization=&quot;3&quot;
 				EnableIntrinsicFunctions=&quot;true&quot;
 				FavorSizeOrSpeed=&quot;1&quot;
-				AdditionalIncludeDirectories=&quot;.\include;.\include\nulldriver;..\common\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\cegui_mk2\include;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\meshmagick\include&quot;
+				AdditionalIncludeDirectories=&quot;.\include;.\include\nulldriver;.\include\fmod4driver;..\common\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\cegui_mk2\include;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\meshmagick\include;..\..\dependencies\FMOD4\api\inc&quot;
 				PreprocessorDefinitions=&quot;WITH_FMOD3;NDEBUG,_WINDOWS,WIN32,RLCORE_EXPORTS;_CRT_SECURE_NO_DEPRECATE;RL_USE_PCH&quot;
 				StringPooling=&quot;false&quot;
 				ExceptionHandling=&quot;1&quot;
@@ -198,11 +198,11 @@
 				Name=&quot;VCLinkerTool&quot;
 				IgnoreImportLibrary=&quot;true&quot;
 				AdditionalOptions=&quot;/MACHINE:I386&quot;
-				AdditionalDependencies=&quot;RlCommon.lib msvcrt-ruby18.lib OgreNewt.lib xerces-c_2.lib CEGUIBase.lib OgreMain.lib Newton.lib meshmagick.lib&quot;
+				AdditionalDependencies=&quot;RlCommon.lib msvcrt-ruby18.lib OgreNewt.lib xerces-c_2.lib CEGUIBase.lib OgreMain.lib Newton.lib meshmagick.lib fmodex_vc.lib&quot;
 				OutputFile=&quot;./lib/$(ConfigurationName)/RlCore.dll&quot;
 				LinkIncremental=&quot;1&quot;
 				SuppressStartupBanner=&quot;true&quot;
-				AdditionalLibraryDirectories=&quot;&quot;..\common\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;..\..\dependencies\cegui_mk2\lib;&quot;..\..\dependencies\ogrenewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll;..\..\dependencies\meshmagick\lib&quot;
+				AdditionalLibraryDirectories=&quot;&quot;..\common\lib\$(ConfigurationName)&quot;;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;..\..\dependencies\cegui_mk2\lib;&quot;..\..\dependencies\ogrenewt\lib\$(ConfigurationName)&quot;;..\..\dependencies\NewtonSDK\sdk\dll;..\..\dependencies\meshmagick\lib;..\..\dependencies\FMOD4\api\lib&quot;
 				TypeLibraryFile=&quot;$(OutDir)\RlCore.lib&quot;
 				ProgramDatabaseFile=&quot;&quot;
 				SubSystem=&quot;2&quot;
@@ -270,7 +270,7 @@
 				Optimization=&quot;3&quot;
 				EnableIntrinsicFunctions=&quot;true&quot;
 				FavorSizeOrSpeed=&quot;1&quot;
-				AdditionalIncludeDirectories=&quot;.\include;.\include\nulldriver;..\common\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\cegui_mk2\include;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\meshmagick\include&quot;
+				AdditionalIncludeDirectories=&quot;.\include;.\include\nulldriver;.\include\fmod4driver;..\common\include;..\..\dependencies\ogrenew\OgreMain\include;..\..\dependencies\OgreNewt\include\OgreNewt;&quot;..\..\dependencies\ruby\lib\ruby\1.8\i386-mswin32&quot;;..\..\dependencies\boost\include;..\..\dependencies\xerces\include;..\..\dependencies\cegui_mk2\include;..\..\dependencies\NewtonSDK\sdk\;..\..\dependencies\ogrenew\Dependencies\include;..\..\dependencies\meshmagick\include;..\..\dependencies\FMOD4\api\inc&quot;
 				PreprocessorDefinitions=&quot;WITH_FMOD3;NDEBUG,_WINDOWS,WIN32,RLCORE_EXPORTS;_CRT_SECURE_NO_DEPRECATE;RL_USE_PCH&quot;
 				StringPooling=&quot;false&quot;
 				ExceptionHandling=&quot;1&quot;
@@ -305,11 +305,11 @@
 				Name=&quot;VCLinkerTool&quot;
 				IgnoreImportLibrary=&quot;true&quot;
 				AdditionalOptions=&quot;/MACHINE:I386&quot;
-				AdditionalDependencies=&quot;RlCommon.lib msvcrt-ruby18.lib OgreNewt.lib xerces-c_2.lib CEGUIBase.lib OgreMain.lib Newton.lib meshmagick.lib&quot;
+				AdditionalDependencies=&quot;RlCommon.lib msvcrt-ruby18.lib OgreNewt.lib xerces-c_2.lib CEGUIBase.lib OgreMain.lib Newton.lib meshmagick.lib fmodex_vc.lib&quot;
 				OutputFile=&quot;$(OutDir)/RlCore.dll&quot;
 				LinkIncremental=&quot;1&quot;
 				SuppressStartupBanner=&quot;true&quot;
-				AdditionalLibraryDirectories=&quot;..\common\lib\Release;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\ogrenewt\lib\release;..\..\dependencies\NewtonSDK\sdk\dll;..\..\dependencies\meshmagick\lib&quot;
+				AdditionalLibraryDirectories=&quot;..\common\lib\Release;..\..\dependencies\ogrenew\lib;..\..\dependencies\ruby\lib;..\..\dependencies\boost\lib;..\..\dependencies\xerces\lib;..\..\dependencies\cegui_mk2\lib;..\..\dependencies\ogrenewt\lib\release;..\..\dependencies\NewtonSDK\sdk\dll;..\..\dependencies\meshmagick\lib;..\..\dependencies\FMOD4\api\lib&quot;
 				TypeLibraryFile=&quot;$(OutDir)\RlCore.lib&quot;
 				GenerateDebugInformation=&quot;true&quot;
 				ProgramDatabaseFile=&quot;$(TargetDir)$(TargetName).pdb&quot;
@@ -699,6 +699,26 @@
 					&gt;
 				&lt;/File&gt;
 			&lt;/Filter&gt;
+			&lt;Filter
+				Name=&quot;fmod4driver&quot;
+				&gt;
+				&lt;File
+					RelativePath=&quot;.\include\fmod4driver\Fmod4Driver.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\fmod4driver\Fmod4Listener.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\fmod4driver\Fmod4Sound.h&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\include\fmod4driver\Fmod4SoundStitching.h&quot;
+					&gt;
+				&lt;/File&gt;
+			&lt;/Filter&gt;
 		&lt;/Filter&gt;
 		&lt;Filter
 			Name=&quot;Source Files&quot;
@@ -1044,6 +1064,26 @@
 					&gt;
 				&lt;/File&gt;
 			&lt;/Filter&gt;
+			&lt;Filter
+				Name=&quot;fmod4driver&quot;
+				&gt;
+				&lt;File
+					RelativePath=&quot;.\src\fmod4driver\Fmod4Driver.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\fmod4driver\Fmod4Listener.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\fmod4driver\Fmod4Sound.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+				&lt;File
+					RelativePath=&quot;.\src\fmod4driver\Fmod4SoundStitching.cpp&quot;
+					&gt;
+				&lt;/File&gt;
+			&lt;/Filter&gt;
 		&lt;/Filter&gt;
 		&lt;Filter
 			Name=&quot;Resource Files&quot;

Copied: rl/trunk/engine/core/include/fmod4driver/Fmod4Driver.h (from rev 4715, rl/trunk/plugins/fmod4driver/include/Fmod4Driver.h)
===================================================================
--- rl/trunk/plugins/fmod4driver/include/Fmod4Driver.h	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/include/fmod4driver/Fmod4Driver.h	2009-01-22 21:53:04 UTC (rev 4716)
@@ -0,0 +1,165 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+ */
+#ifndef _FMODDRIVER_H_
+#define _FMODDRIVER_H_
+
+#include &quot;CorePrerequisites.h&quot;
+
+#include &lt;fmod.hpp&gt;
+
+#include &quot;SoundDriver.h&quot;
+
+namespace rl
+{
+
+    typedef std::map&lt;Ogre::String, StringList&gt; DriverMap;
+
+    #define CHECK_FMOD4_ERRORS(fmod4_errorcode)\
+    {\
+        if (fmod4_errorcode != FMOD_OK)\
+        {\
+            Throw(rl::RuntimeException,\
+                &quot;FMOD error #&quot;\
+                + StringConverter::toString(fmod4_errorcode)\
+                + &quot; &quot;\
+                + FMOD_ErrorString(fmod4_errorcode));\
+        }\
+    }
+
+    class Fmod4Sound;
+
+    /** Diese Klasse ist der Treiber, der OpenAL zur
+     * Ausgabe benutzt.
+     */
+    class Fmod4Driver : public rl::SoundDriver
+    {
+    public:
+        /// Der Treibername
+        static Ogre::String NAME;
+        /// Der Konstruktor
+        Fmod4Driver(Ogre::ResourceManager* soundResourceManager);
+        /// Der Destruktor
+        virtual ~Fmod4Driver();
+        /// Ist der Treiber angeschaltet?
+        virtual bool isDriverAvailable();
+        /// Initialisiere den Treiber.
+        virtual bool initialize();
+        /// Deinitialisiere den Treiber.
+        virtual void shutdown();
+        /// Der Name des Treibers
+        virtual Ogre::String getName() const;
+        /// Ist ein Ogre plugin
+        virtual bool isDriverPlugin() { return true; }
+        /// Update-Aufgaben erledigen
+        virtual void update();
+        /// Einen Soundlistener erzeugen
+        virtual ListenerMovable *createListener(const Ogre::String &amp;name);
+
+        virtual void setMasterVolume(const Ogre::Real&amp; vol);
+
+        /**
+         * Returns the current sound driver settings as a key-value list
+         *
+         * @return key-value list of sound options
+         */
+        virtual Ogre::NameValuePairList getSettings() const;
+
+        /**
+         * Sets certain options for the sound driver, like volume settings for
+         * sound effects and music.
+         *
+         * @param settings key-value list of settings
+         */
+        virtual void applySettings(const Ogre::NameValuePairList&amp; settings);
+
+        /**
+         * Sets an eax preset, the preset is defined by a string
+         * @retval true if successfull
+        */
+        virtual bool setEaxPreset(const Ogre::String&amp; name);
+
+        /// Setzt den Faktor f, mit der die Lautstaerke nach der Formel 1/(f*Entfernung) abnimmt
+        virtual void setRolloffFactor(const Ogre::Real&amp;);
+        virtual const Ogre::Real getRolloffFactor();
+
+        /// Datensammlung zurueckgeben
+        const DriverMap&amp; getDriverData() const;
+
+        FMOD::System* _getFmodSystem();
+        void _registerChannel(FMOD::Channel* channel, Fmod4Sound* sound);
+        
+    protected:
+        virtual Sound* createSoundImpl(SoundResourcePtr res, SoundType type);
+        virtual SoundStitching* createSoundStitchingImpl(unsigned int numSlots, const CeGuiString&amp; name);
+
+    private:
+
+        typedef std::map&lt;FMOD::Channel*, Fmod4Sound*&gt; ChannelSoundMap;
+
+        static FMOD_RESULT F_CALLBACK open(
+            const char *  name,
+            int  unicode,
+            unsigned int *  filesize,
+            void **  handle,
+            void **  userdata
+        );
+
+        static FMOD_RESULT F_CALLBACK close(
+            void *  handle,
+            void *  userdata
+        );
+
+        static FMOD_RESULT F_CALLBACK read(
+            void *  handle,
+            void *  buffer,
+            unsigned int  sizebytes,
+            unsigned int *  bytesread,
+            void *  userdata
+        );
+
+        static FMOD_RESULT F_CALLBACK seek(
+            void *  handle,
+            unsigned int  pos,
+            void *  userdata
+        );
+
+        static FMOD_RESULT F_CALLBACK channelCallback(
+            FMOD_CHANNEL* channel,
+            FMOD_CHANNEL_CALLBACKTYPE type,
+            void* commanddata1,
+            void* commanddata2
+        );
+
+        typedef std::map&lt;const Ogre::String, FMOD_REVERB_PROPERTIES&gt; EaxPresetMap;
+        EaxPresetMap mEaxPresetMap;
+
+        void initializeEaxPresetMap();
+
+        /// Log driver config data
+        virtual void printData() const;
+        void printDriverInfo(int driver) const;
+
+        // Wir merken uns die Konfiguration von Fmod4
+        DriverMap mDriverData;
+        /// Stores sounds that are automatically destroyed after having been played.
+        ChannelSoundMap mChannelSoundMap;
+        FMOD::System* mFmod4System;
+        FMOD::ChannelGroup* mMasterChannelGroup;
+
+    };
+}
+
+#endif /*FMODDRIVER_H_*/

Copied: rl/trunk/engine/core/include/fmod4driver/Fmod4Listener.h (from rev 4715, rl/trunk/plugins/fmod4driver/include/Fmod4Listener.h)
===================================================================
--- rl/trunk/plugins/fmod4driver/include/Fmod4Listener.h	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/include/fmod4driver/Fmod4Listener.h	2009-01-22 21:53:04 UTC (rev 4716)
@@ -0,0 +1,61 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#ifndef __Fmod4Listener_H__
+#define __Fmod4Listener_H__
+
+#include &quot;CorePrerequisites.h&quot;
+
+#include &lt;fmod.hpp&gt;
+
+#include &quot;ListenerMovable.h&quot;
+
+namespace rl {
+    
+   /** Diese Klasse dient der Interkation mit Ogre3d und Fmod4
+    * und kapselt den Hoerer.
+    * @author Josch
+    * @date 06-29-2005
+    * @version 1.0
+    * @version 2.0
+    */
+    class Fmod4Listener : public ListenerMovable
+    {
+    public:
+        /// Konstruktor
+        Fmod4Listener(const Ogre::String&amp; name, FMOD::System* fmod4system, int listenerId = 0);
+        /// Destruktor
+        virtual ~Fmod4Listener();
+        /// Moveable-Typ
+        virtual const Ogre::String&amp; getMovableType() const;
+    
+        /// Setzt die Position der Soundquelle.
+        virtual void setPosition(const Ogre::Vector3&amp; direction);
+        /// Setzt die Richtung der Soundquelle.
+        virtual void setOrientation(const Ogre::Quaternion &amp;orientation);
+        /// Setzt die Geschwindigkeit der Soundquelle.
+        virtual void setVelocity(const Ogre::Vector3&amp;);
+   
+    protected:
+         /// Shared class-level name for Movable type
+        static Ogre::String msMovableType;
+
+    private:
+        FMOD::System* mFmod4System;
+        int mListenerId;
+    };
+
+}
+#endif

Copied: rl/trunk/engine/core/include/fmod4driver/Fmod4Sound.h (from rev 4715, rl/trunk/plugins/fmod4driver/include/Fmod4Sound.h)
===================================================================
--- rl/trunk/plugins/fmod4driver/include/Fmod4Sound.h	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/include/fmod4driver/Fmod4Sound.h	2009-01-22 21:53:04 UTC (rev 4716)
@@ -0,0 +1,112 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#ifndef _FMOD4SOUND_H_
+#define _FMOD4SOUND_H_
+
+#include &quot;CorePrerequisites.h&quot;
+
+#include &lt;fmod.hpp&gt;
+
+#include &quot;Sound.h&quot;
+#include &quot;SoundDriver.h&quot;
+
+namespace rl {
+
+    class Fmod4Driver;
+
+    class Fmod4Sound : public Sound
+    {
+    public:
+        /// Konstruktor
+        Fmod4Sound(Fmod4Driver* driver, SoundResourcePtr soundres, SoundType type = ST_SAMPLE);
+
+        /// Laedt den Sound.
+        virtual void load() throw (RuntimeException);
+        /// Entlaedt den Sound.
+        virtual void unload() throw (RuntimeException);
+        // Running length in seconds
+	    virtual float getLength() const;
+
+		// Sind wir gueltig
+		bool isValid() const throw (RuntimeException);
+
+	    /// Moveable-Typ
+		virtual const Ogre::String&amp; getMovableType() const;
+        /// Gibt die eingestellte Position der Soundquelle zurueck
+		virtual const Ogre::Vector3 getPosition() const;
+		/// Setzt die Position der Soundquelle.
+		virtual void setPosition(const Ogre::Vector3&amp; direction);
+		/// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck (0..1)
+		virtual const float getVolume() const; 
+		/// Setzt die relative Lautstaerke der Soundquelle (0..1)
+		virtual void setVolume(const float gain);
+		/// Gibt die Richtung der Soundquelle zurueck.
+		virtual const Ogre::Quaternion getDirection() const;
+		/// Gibt die Geschwindigkeit der Soundquelle zurueck.
+		virtual const Ogre::Vector3 getVelocity() const;
+		/// Setzt die Richtung der Soundquelle.
+		virtual void setDirection(const Ogre::Quaternion&amp;);
+		/// Setzt die Geschwindigkeit der Soundquelle.
+		virtual void setVelocity(const Ogre::Vector3&amp;);
+        
+        /// Gibt den FMOD Channel zur&#252;ck.
+        FMOD::Channel* getFmodChannel() const;
+        /// Gibt den FMOD Sound zur&#252;ck.
+        FMOD::Sound* getFmodSound() const;
+
+        virtual void play(bool destroyWhenDone=false);
+		/// Pausiert den Sound.
+		virtual void pause(bool pausing);
+		/// Ist der Sound pausiert?
+		virtual bool isPaused();
+		/// Stoppt den Sound.
+		virtual void stop();
+		/// Laeuft der Sound noch
+		virtual const bool isPlaying() const;
+        
+        // Sets the priority of this sound
+        virtual void setPriority(const int priority);
+        // Gets the priority of this sound
+        virtual const int getPriority() const;
+        
+        
+        /// Should the sound be autodestructed when playing is done.
+        bool isAutoDestroying() const;
+
+    private:
+		/// Shared class-level name for Movable type
+		static Ogre::String msMovableType;
+        FMOD::Channel* mChannel;
+        SoundType mType;
+        FMOD::Sound *mSound;
+        Fmod4Driver* mDriver;
+        bool mAutoDestroy;
+    };
+
+    class Fmod4SoundPtr :
+        public Ogre::SharedPtr&lt;Fmod4Sound&gt;
+    {
+    public:
+        Fmod4SoundPtr() : Ogre::SharedPtr&lt;Fmod4Sound&gt;() {}
+        explicit Fmod4SoundPtr(Fmod4Sound* rep) : Ogre::SharedPtr&lt;Fmod4Sound&gt;(rep) {}
+        Fmod4SoundPtr(const Fmod4SoundPtr&amp; res) : Ogre::SharedPtr&lt;Fmod4Sound&gt;(res) {}
+    protected:
+        void destroy();
+    };
+
+}
+
+#endif /* FMOD3SOUND_H_ */

Copied: rl/trunk/engine/core/include/fmod4driver/Fmod4SoundStitching.h (from rev 4715, rl/trunk/plugins/fmod4driver/include/Fmod4SoundStitching.h)
===================================================================
--- rl/trunk/plugins/fmod4driver/include/Fmod4SoundStitching.h	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/include/fmod4driver/Fmod4SoundStitching.h	2009-01-22 21:53:04 UTC (rev 4716)
@@ -0,0 +1,116 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#ifndef _FMOD4SOUNDSTITCHING_H_
+#define _FMOD4SOUNDSTITCHING_H_
+
+#include &quot;CorePrerequisites.h&quot;
+
+#include &lt;fmod.hpp&gt;
+
+#include &quot;SoundStitching.h&quot;
+#include &quot;SoundDriver.h&quot;
+
+namespace rl {
+
+    class Fmod4Driver;
+    typedef std::vector&lt;FMOD::Sound*&gt; SubsoundVector;
+
+    class Fmod4SoundStitching : public SoundStitching
+    {
+    public:
+        /// Konstruktor
+        Fmod4SoundStitching(unsigned int numSlots, const CeGuiString&amp; name, SoundDriver* creator);
+
+        /// Laedt den Sound.
+        virtual void load() throw (RuntimeException);
+        /// Entlaedt den Sound.
+        virtual void unload() throw (RuntimeException);
+
+		// Sind wir gueltig
+		bool isValid() const throw (RuntimeException);
+
+	    /// Moveable-Typ
+		virtual const Ogre::String&amp; getMovableType() const;
+        /// Gibt die eingestellte Position der Soundquelle zurueck
+		virtual const Ogre::Vector3 getPosition() const;
+		/// Setzt die Position der Soundquelle.
+		virtual void setPosition(const Ogre::Vector3&amp; direction);
+		/// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck (0..1)
+		virtual const float getVolume() const; 
+		/// Setzt die relative Lautstaerke der Soundquelle (0..1)
+		virtual void setVolume(const float gain);
+		/// Gibt die Richtung der Soundquelle zurueck.
+		virtual const Ogre::Quaternion getDirection() const;
+		/// Gibt die Geschwindigkeit der Soundquelle zurueck.
+		virtual const Ogre::Vector3 getVelocity() const;
+		/// Setzt die Richtung der Soundquelle.
+		virtual void setDirection(const Ogre::Quaternion&amp;);
+		/// Setzt die Geschwindigkeit der Soundquelle.
+		virtual void setVelocity(const Ogre::Vector3&amp;);
+        
+        /// Gibt den FMOD Channel zur&#252;ck.
+        FMOD::Channel* getFmodChannel() const;
+        /// Gibt den FMOD Sound zur&#252;ck.
+        FMOD::Sound* getFmodSound() const;
+
+        virtual void play(bool destroyWhenDone=false);
+		/// Pausiert den Sound.
+		virtual void pause(bool pausing);
+		/// Ist der Sound pausiert?
+		virtual bool isPaused();
+		/// Stoppt den Sound.
+		virtual void stop();
+		/// Laeuft der Sound noch
+		virtual const bool isPlaying() const;
+        
+        // Sets the priority of this sound
+        virtual void setPriority(const int priority);
+        // Gets the priority of this sound
+        virtual const int getPriority() const;
+        
+        
+        /// Should the sound be autodestructed when playing is done.
+        bool isAutoDestroying() const;
+
+        /// Assign a sound recource to a slot.
+        virtual void putSoundIntoSlot(unsigned int, CeGuiString label);
+        /// Get the slot of the plaing sound.
+        virtual unsigned int getPlayingSlot();
+
+    private:
+		/// Shared class-level name for Movable type
+		static Ogre::String msMovableType;
+        FMOD::Channel* mChannel;
+        FMOD::Sound *mSound;
+        Fmod4Driver* mDriver;
+        bool mAutoDestroy;
+        SubsoundVector mSoundSlots;
+    };
+
+    class Fmod4SoundStitchingPtr :
+        public Ogre::SharedPtr&lt;Fmod4SoundStitching&gt;
+    {
+    public:
+        Fmod4SoundStitchingPtr() : Ogre::SharedPtr&lt;Fmod4SoundStitching&gt;() {}
+        explicit Fmod4SoundStitchingPtr(Fmod4SoundStitching* rep) : Ogre::SharedPtr&lt;Fmod4SoundStitching&gt;(rep) {}
+        Fmod4SoundStitchingPtr(const Fmod4SoundStitchingPtr&amp; res) : Ogre::SharedPtr&lt;Fmod4SoundStitching&gt;(res) {}
+    protected:
+        void destroy();
+    };
+
+}
+
+#endif /* FMOD3SOUNDSTITCHING_H_ */

Modified: rl/trunk/engine/core/src/SoundManager.cpp
===================================================================
--- rl/trunk/engine/core/src/SoundManager.cpp	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/src/SoundManager.cpp	2009-01-22 21:53:04 UTC (rev 4716)
@@ -29,6 +29,7 @@
 #include &quot;SoundDriver.h&quot;
 #include &quot;SoundResource.h&quot;
 
+#include &quot;Fmod4Driver.h&quot;
 #include &quot;NullDriver.h&quot;
 
 using namespace std;
@@ -59,6 +60,9 @@
         registerDriver(nullDriver);
         setActiveDriver(nullDriver);
 
+		Fmod4Driver* fmod4Driver = new Fmod4Driver(this);
+		registerDriver(fmod4Driver);
+
         mResourceType = &quot;Sound&quot;;
         ResourceGroupManager::getSingleton()._registerResourceManager(mResourceType, this);
 
@@ -250,25 +254,31 @@
             drivername = it-&gt;second;
         }
 
-        try
+
+		SoundDriver *driver = getDriverByName(drivername);
+
+        if (driver == NULL)
         {
-            CoreSubsystem::getSingleton().loadPlugin(drivername);
-        }
-        catch(Ogre::Exception &amp;e)
-        {
-            LOG_MESSAGE(Logger::MULTIMEDIA,
-                CeGuiString(&quot;Soundtreiber kann nicht geladen werden: &quot;)
-                    + drivername + &quot;\n&quot;
-                    + e.getFullDescription());
-        }
-        catch(...)
-        {
-            LOG_MESSAGE(Logger::MULTIMEDIA,
-                 CeGuiString(&quot;Soundtreiber kann nicht geladen werden: &quot;)
-                    + drivername);
-        }
+			try
+			{
+				CoreSubsystem::getSingleton().loadPlugin(drivername);
+			}
+			catch(Ogre::Exception &amp;e)
+			{
+				LOG_MESSAGE(Logger::MULTIMEDIA,
+					CeGuiString(&quot;Soundtreiber kann nicht geladen werden: &quot;)
+						+ drivername + &quot;\n&quot;
+						+ e.getFullDescription());
+			}
+			catch(...)
+			{
+				LOG_MESSAGE(Logger::MULTIMEDIA,
+					 CeGuiString(&quot;Soundtreiber kann nicht geladen werden: &quot;)
+						+ drivername);
+			}
+		}
 
-        SoundDriver *driver = getDriverByName(drivername);
+        driver = getDriverByName(drivername);
 
         if (driver == NULL)
         {

Copied: rl/trunk/engine/core/src/fmod4driver/Fmod4Driver.cpp (from rev 4715, rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp)
===================================================================
--- rl/trunk/plugins/fmod4driver/src/Fmod4Driver.cpp	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/src/fmod4driver/Fmod4Driver.cpp	2009-01-22 21:53:04 UTC (rev 4716)
@@ -0,0 +1,493 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+ */
+#include &quot;stdinc.h&quot;
+
+#include &lt;fmod_errors.h&gt;
+
+#include &quot;Fmod4Driver.h&quot;
+#include &quot;Fmod4Sound.h&quot;
+#include &quot;Fmod4SoundStitching.h&quot;
+#include &quot;Fmod4Listener.h&quot;
+#include &quot;Logger.h&quot;
+#include &quot;SoundResource.h&quot;
+
+using namespace Ogre;
+using namespace std;
+
+namespace rl
+{
+    // Used by FMOD-Callbacks, which are not C++-functions, but C-functions.
+    Ogre::ResourceManager* gSoundResourceManager = NULL;
+    Fmod4Driver* gDriver = NULL;
+
+    String Fmod4Driver::NAME = &quot;RlFmod4Driver&quot;;
+
+    Fmod4Driver::Fmod4Driver(Ogre::ResourceManager *soundResourceManager)
+        : SoundDriver(soundResourceManager),
+        mMasterChannelGroup(NULL)
+    {
+        gSoundResourceManager = soundResourceManager;
+        gDriver = this;
+    }
+
+    Fmod4Driver::~Fmod4Driver()
+    {
+    }
+
+    String Fmod4Driver::getName() const
+    {
+        return NAME;
+    }
+
+    bool Fmod4Driver::initialize()
+    {
+        static int MAX_VIRTUAL_CHANNELS = 100;
+
+        CHECK_FMOD4_ERRORS(FMOD::System_Create(&amp;mFmod4System));
+
+        mFmod4System-&gt;setFileSystem(
+            Fmod4Driver::open,
+            Fmod4Driver::close,
+            Fmod4Driver::read,
+            Fmod4Driver::seek,
+            -1);
+
+        printData();
+
+        mFmod4System-&gt;setDriver(-1);
+        //CHECK_FMOD4_ERRORS(mFmod4System-&gt;setOutput(FMOD_OUTPUTTYPE_ESD));
+
+        FMOD_RESULT result = mFmod4System-&gt;init(MAX_VIRTUAL_CHANNELS, FMOD_INIT_NORMAL, NULL);
+        if (result != FMOD_OK)
+        {
+            LOG_ERROR(Logger::CORE,
+                &quot;FMOD error #&quot;
+                + StringConverter::toString(result)
+                + &quot; &quot;
+                + FMOD_ErrorString(result));
+
+            return false;
+        }
+
+        mFmod4System-&gt;getMasterChannelGroup(&amp;mMasterChannelGroup);
+
+        initializeEaxPresetMap();
+        return true;
+    }
+
+    void Fmod4Driver::shutdown()
+    {
+        CHECK_FMOD4_ERRORS(mFmod4System-&gt;close());
+        CHECK_FMOD4_ERRORS(mFmod4System-&gt;release());
+    }
+
+    bool Fmod4Driver::isDriverAvailable()
+    {
+        FMOD::System* system;
+        FMOD_RESULT result = FMOD::System_Create(&amp;system);
+        if (result != FMOD_OK)
+        {
+            return false;
+        }
+
+        system-&gt;release();
+        return true;
+    }
+
+    void Fmod4Driver::update()
+    {
+        mFmod4System-&gt;update();
+    }
+
+    Sound* Fmod4Driver::createSoundImpl(SoundResourcePtr res, SoundType type)
+    {
+        Sound* sound = new Fmod4Sound(this, res, type);
+        return sound;
+    }
+
+
+    SoundStitching *Fmod4Driver::createSoundStitchingImpl(unsigned int numSlots, const CeGuiString&amp; name)
+    {
+         SoundStitching* soundstitching = new Fmod4SoundStitching(numSlots, name, this);
+         return soundstitching;
+    }
+
+    ListenerMovable *Fmod4Driver::createListener(const Ogre::String &amp;name)
+    {
+        return new Fmod4Listener(name, mFmod4System);
+    }
+
+    FMOD::System* Fmod4Driver::_getFmodSystem()
+    {
+        return mFmod4System;
+    }
+
+    void Fmod4Driver::applySettings(const Ogre::NameValuePairList&amp; settings)
+    {
+        SoundDriver::applySettings(settings);
+        mMasterChannelGroup-&gt;setVolume(mMasterVolume);
+    }
+
+#define DEF_PRESET(NAME, DEFINITION) \
+    { \
+        FMOD_REVERB_PROPERTIES prop = DEFINITION; \
+        mEaxPresetMap.insert(make_pair(NAME, prop)); \
+    }
+
+    void Fmod4Driver::initializeEaxPresetMap()
+    {
+        DEF_PRESET(&quot;Alley&quot;, FMOD_PRESET_ALLEY);
+        DEF_PRESET(&quot;Arena&quot;, FMOD_PRESET_ARENA);
+        DEF_PRESET(&quot;Auditorium&quot;, FMOD_PRESET_AUDITORIUM);
+        DEF_PRESET(&quot;Bathroom&quot;, FMOD_PRESET_BATHROOM);
+        DEF_PRESET(&quot;Carpetted Hallway&quot;, FMOD_PRESET_CARPETTEDHALLWAY);
+        DEF_PRESET(&quot;Cave&quot;, FMOD_PRESET_CAVE);
+        DEF_PRESET(&quot;City&quot;, FMOD_PRESET_CITY);
+        DEF_PRESET(&quot;Concert Hall&quot;, FMOD_PRESET_CONCERTHALL);
+        DEF_PRESET(&quot;Dizzy&quot;, FMOD_PRESET_DIZZY);
+        DEF_PRESET(&quot;Drugged&quot;, FMOD_PRESET_DRUGGED);
+        DEF_PRESET(&quot;Forest&quot;, FMOD_PRESET_FOREST);
+        DEF_PRESET(&quot;Generic&quot;, FMOD_PRESET_GENERIC);
+        DEF_PRESET(&quot;Hallway&quot;, FMOD_PRESET_HALLWAY);
+        DEF_PRESET(&quot;Hangar&quot;, FMOD_PRESET_HANGAR);
+        DEF_PRESET(&quot;Living Room&quot;, FMOD_PRESET_LIVINGROOM);
+        DEF_PRESET(&quot;Mountains&quot;, FMOD_PRESET_MOUNTAINS);
+        DEF_PRESET(&quot;Off&quot;, FMOD_PRESET_OFF);
+        DEF_PRESET(&quot;Padded Cell&quot;, FMOD_PRESET_PADDEDCELL);
+        DEF_PRESET(&quot;Parkinglot&quot;, FMOD_PRESET_PARKINGLOT);
+        DEF_PRESET(&quot;Plain&quot;, FMOD_PRESET_PLAIN);
+        DEF_PRESET(&quot;Psychotic&quot;, FMOD_PRESET_PSYCHOTIC);
+        DEF_PRESET(&quot;Quarry&quot;, FMOD_PRESET_QUARRY);
+        DEF_PRESET(&quot;Room&quot;, FMOD_PRESET_ROOM);
+        DEF_PRESET(&quot;Sewerpipe&quot;, FMOD_PRESET_SEWERPIPE);
+        DEF_PRESET(&quot;Stone Corridor&quot;, FMOD_PRESET_STONECORRIDOR);
+        DEF_PRESET(&quot;Stone Room&quot;, FMOD_PRESET_STONEROOM);
+        DEF_PRESET(&quot;Underwater&quot;, FMOD_PRESET_UNDERWATER);
+    }
+#undef DEF_PRESET
+
+    bool Fmod4Driver::setEaxPreset(const Ogre::String&amp; name)
+    {
+        EaxPresetMap::iterator it = mEaxPresetMap.find(name);
+
+        if( it != mEaxPresetMap.end() )
+        {
+            FMOD_RESULT result;
+            result = mFmod4System-&gt;setReverbProperties(&amp;(it-&gt;second)); ///@todo seems not to work correctly
+            CHECK_FMOD4_ERRORS(result);
+        }
+
+        return false;
+    }
+
+    Ogre::NameValuePairList Fmod4Driver::getSettings() const
+    {
+        return SoundDriver::getSettings();
+    }
+
+    void Fmod4Driver::printData() const
+    {
+        int numDrivers;
+        mFmod4System-&gt;getNumDrivers(&amp;numDrivers);
+
+        for (int i = 0; i &lt; numDrivers; i++)
+        {
+            printDriverInfo(i);
+        }
+
+        int numPlugins;
+        mFmod4System-&gt;getNumPlugins(FMOD_PLUGINTYPE_CODEC, &amp;numPlugins);
+        for (int i = 0; i &lt; numPlugins; i++)
+        {
+            char pluginName[128];
+            unsigned int version;
+			FMOD_PLUGINTYPE type = FMOD_PLUGINTYPE_CODEC;
+			unsigned int handle;
+			FMOD_RESULT result = mFmod4System-&gt;getPluginHandle(FMOD_PLUGINTYPE_CODEC, i, &amp;handle);
+			CHECK_FMOD4_ERRORS(result);
+
+            result = mFmod4System-&gt;getPluginInfo(
+                handle,
+                &amp;type,
+				pluginName,
+                127,
+                &amp;version);
+			CHECK_FMOD4_ERRORS(result);
+            LOG_MESSAGE(Logger::MULTIMEDIA,
+                String(&quot;Fmod4Driver Plugin '&quot;)
+                + pluginName
+                + &quot;' Version &quot;
+                + StringConverter::toString(version));
+        }
+    }
+
+    void Fmod4Driver::printDriverInfo(int driver) const
+    {
+        int curdriver;
+        mFmod4System-&gt;getDriver(&amp;curdriver);
+
+        char name[128];
+        mFmod4System-&gt;getDriverInfo(driver, name, 127, NULL);
+
+        FMOD_CAPS caps;
+        int minfreq, maxfreq;
+        FMOD_SPEAKERMODE speakermode;
+        mFmod4System-&gt;getDriverCaps(driver, &amp;caps, &amp;minfreq, &amp;maxfreq, &amp;speakermode);
+
+        LOG_MESSAGE(Logger::MULTIMEDIA,
+            String(&quot;Fmod4Driver '&quot;)
+            + name
+            + &quot;'&quot;
+            + (driver == curdriver ? &quot;(cur)&quot; : &quot;&quot;)
+            + &quot;: \n&quot;
+            + &quot;Freq &quot; + StringConverter::toString(minfreq)
+            + &quot; - &quot; + StringConverter::toString(maxfreq));
+
+        int hard2d, hard3d, hardtotal;
+        mFmod4System-&gt;getHardwareChannels(&amp;hard2d, &amp;hard3d, &amp;hardtotal);
+        LOG_MESSAGE(Logger::MULTIMEDIA,
+            String(&quot;Fmod4Driver '&quot;)
+            + name + &quot;' Hardware Channels: &quot;
+            + &quot;2D #&quot; + StringConverter::toString(hard2d)
+            + &quot;, 3D #&quot; + StringConverter::toString(hard3d)
+            + &quot;, Total #&quot; + StringConverter::toString(hardtotal));
+
+        int softchannels;
+        mFmod4System-&gt;getSoftwareChannels(&amp;softchannels);
+        LOG_MESSAGE(Logger::MULTIMEDIA,
+            String(&quot;Fmod4Driver '&quot;)
+            + name + &quot;' Software Channels: &quot;
+            + &quot;#&quot; + StringConverter::toString(softchannels));
+
+        FMOD_OUTPUTTYPE output;
+        mFmod4System-&gt;getOutput(&amp;output);
+        String outputName;
+
+        if(output == FMOD_OUTPUTTYPE_AUTODETECT)
+            outputName = &quot;Autodetect&quot;;
+        else if(output == FMOD_OUTPUTTYPE_UNKNOWN)
+            outputName = &quot;Unknown&quot;;
+        else if(output == FMOD_OUTPUTTYPE_NOSOUND)
+            outputName = &quot;No Sound&quot;;
+        else if(output == FMOD_OUTPUTTYPE_WAVWRITER)
+            outputName = &quot;Wave Writer&quot;;
+        else if(output == FMOD_OUTPUTTYPE_NOSOUND_NRT)
+            outputName = &quot;No Sound non realtime&quot;;
+        else if(output == FMOD_OUTPUTTYPE_WAVWRITER_NRT)
+            outputName = &quot;Wave Writer non realtime&quot;;
+        else if(output == FMOD_OUTPUTTYPE_DSOUND)
+            outputName = &quot;DirectSound&quot;;
+        else if(output == FMOD_OUTPUTTYPE_WINMM)
+            outputName = &quot;Windows Multimedia&quot;;
+        else if(output == FMOD_OUTPUTTYPE_ASIO)
+            outputName = &quot;Low Latency ASIO driver&quot;;
+        else if(output == FMOD_OUTPUTTYPE_OSS)
+            outputName = &quot;Open Sound System (OSS)&quot;;
+        else if(output == FMOD_OUTPUTTYPE_ALSA)
+            outputName = &quot;Advanced Linux Sound Architecture (ALSA)&quot;;
+        else if(output == FMOD_OUTPUTTYPE_ESD)
+            outputName = &quot;Enlightment Sound Daemon (ESD)&quot;;
+        else if(output == FMOD_OUTPUTTYPE_SOUNDMANAGER)
+            outputName = &quot;Macintosh SoundManager&quot;;
+        else if(output == FMOD_OUTPUTTYPE_COREAUDIO)
+            outputName = &quot;Macintosh CoreAudio&quot;;
+
+        LOG_MESSAGE(Logger::MULTIMEDIA,
+            String(&quot;Fmod4Driver '&quot;)
+            + name + &quot;' Output: &quot; + outputName);
+    }
+
+    FMOD_RESULT F_CALLBACK Fmod4Driver::open(
+        const char *  name,
+        int  unicode,
+        unsigned int *  filesize,
+        void **  handle,
+        void **  userdata)
+    {
+        SoundResourcePtr* res = new SoundResourcePtr(gSoundResourceManager-&gt;getByName(name));
+        LOG_DEBUG(Logger::MULTIMEDIA,
+            &quot;Opened stream &quot; + (*res)-&gt;getName());
+        (*res)-&gt;load();
+        *filesize = (*res)-&gt;getSize();
+        *handle = res;
+        return FMOD_OK;
+    }
+
+    FMOD_RESULT F_CALLBACK Fmod4Driver::close(
+        void *  handle,
+        void *  userdata)
+    {
+           SoundResourcePtr *res = static_cast&lt;SoundResourcePtr*&gt;(handle);
+        LOG_DEBUG(Logger::MULTIMEDIA,
+            &quot;Closing stream &quot; + (*res)-&gt;getName());
+        (*res)-&gt;unload();
+        delete res;
+        return FMOD_OK;
+    }
+
+    FMOD_RESULT F_CALLBACK Fmod4Driver::read(
+        void*  handle,
+        void*  buffer,
+        unsigned int  sizebytes,
+        unsigned int* bytesread,
+        void*  userdata)
+    {
+        if (handle == NULL)
+        {
+            return FMOD_ERR_INVALID_PARAM;
+        }
+
+        SoundResourcePtr *sound = static_cast&lt;SoundResourcePtr*&gt;(handle);
+        if (!sound-&gt;isNull())
+        {
+            if (!(*sound)-&gt;isLoaded())
+            {
+                (*sound)-&gt;load();
+            }
+
+            DataStreamPtr ds = (*sound)-&gt;getDataStream();
+            if (!ds.isNull())
+            {
+                *bytesread = ds-&gt;read(buffer, sizebytes);
+                if (*bytesread &lt; sizebytes)
+                {
+                    return FMOD_ERR_FILE_EOF;
+                }
+                return FMOD_OK;
+            }
+        }
+
+        return FMOD_ERR_FILE_EOF;
+    }
+
+    FMOD_RESULT F_CALLBACK Fmod4Driver::seek(
+        void *  handle,
+        unsigned int  pos,
+        void *  userdata)
+    {
+        if (handle == NULL)
+        {
+            return FMOD_ERR_INVALID_PARAM;
+        }
+
+        SoundResourcePtr *sound = static_cast&lt;SoundResourcePtr*&gt;(handle);
+        if (!sound-&gt;isNull())
+        {
+            DataStreamPtr ds = (*sound)-&gt;getDataStream();
+            if (!ds.isNull())
+            {
+                ds-&gt;seek(pos);
+                return FMOD_OK;
+            }
+        }
+        return FMOD_ERR_INVALID_PARAM;
+    }
+
+/**
+ * This static method is as channel callback, so that we get callbacks
+ * from FMOD
+ * @author Blakharaz
+ * @version 1.0
+ * @author JoSch
+ * @version 1.1
+ * @date 07-03-2007
+ * @param _channel The channel for which the callback is registered.
+ * @param type Type of the event.
+ * @param command A commando
+ * @param commanddata1 Data
+ * @param commanddata2 Data
+ */
+FMOD_RESULT F_CALLBACK Fmod4Driver::channelCallback(
+    FMOD_CHANNEL *_channel,
+    FMOD_CHANNEL_CALLBACKTYPE type,
+    void* commanddata1, 
+    void* commanddata2)
+{
+    /// Extract the Fmod channel and then our Sound object.
+    FMOD::Channel* channel = (FMOD::Channel*)_channel;
+    RlAssert1(channel != NULL);
+    ChannelSoundMap::iterator it = gDriver-&gt;mChannelSoundMap.find((FMOD::Channel*)channel);
+    if (it != gDriver-&gt;mChannelSoundMap.end())
+    {
+        Fmod4Sound* sound = it-&gt;second;
+        RlAssert1(sound != NULL);
+        switch(type)
+        {
+            case FMOD_CHANNEL_CALLBACKTYPE_END:
+                {
+                    // We dispatch a stop event
+                    SoundPlayEvent event(NULL, SoundPlayEvent::STOPEVENT);
+                    sound-&gt;dispatchEvent(&amp;event);
+                    // If the sound is set for autodestruction,
+                    // we destroy it now.
+                    if (sound-&gt;isAutoDestroying())
+                    {
+                        gDriver-&gt;destroySound(sound);
+                        gDriver-&gt;mChannelSoundMap.erase(it);
+                    }
+                }
+                break;
+                
+            case FMOD_CHANNEL_CALLBACKTYPE_SYNCPOINT:
+                {
+                    FMOD::Sound *fmodsound = NULL;
+                    FMOD_SYNCPOINT* syncpoint = NULL;
+                    SoundTimingEvent event(NULL, SoundTimingEvent::TIMEEVENT);
+        
+                    // We get the time point of the sync point and put it in a timing event.
+                    sound-&gt;getFmodChannel()-&gt;getCurrentSound(&amp;fmodsound);
+                    fmodsound-&gt;getSyncPoint(*static_cast&lt;int*&gt;(commanddata1), &amp;syncpoint);
+                    fmodsound-&gt;getSyncPointInfo(syncpoint, NULL, 0, &amp;event.mTime, FMOD_TIMEUNIT_MS);
+                    sound-&gt;dispatchEvent(&amp;event);
+                }
+                break;
+             case FMOD_CHANNEL_CALLBACKTYPE_VIRTUALVOICE:
+                {
+                }
+                break;
+        }
+    }  
+    return FMOD_OK;
+}
+
+
+    void Fmod4Driver::setMasterVolume(const Ogre::Real&amp; vol)
+    {
+        SoundDriver::setMasterVolume(vol);
+    }
+
+    void Fmod4Driver::setRolloffFactor(const Ogre::Real&amp; factor)
+    {
+        float dopplerScale;
+        mFmod4System-&gt;get3DSettings(&amp;dopplerScale, NULL, NULL);
+        mFmod4System-&gt;set3DSettings(dopplerScale, 1.0, factor);
+    }
+
+    const Ogre::Real Fmod4Driver::getRolloffFactor()
+    {
+        float factor;
+        mFmod4System-&gt;get3DSettings(NULL, NULL, &amp;factor);
+        return factor;
+    }
+
+    void Fmod4Driver::_registerChannel(FMOD::Channel* channel, Fmod4Sound* sound)
+    {
+        FMOD_RESULT res = channel-&gt;setCallback(channelCallback);
+        CHECK_FMOD4_ERRORS(res);
+        mChannelSoundMap.insert(std::make_pair(channel, sound));
+    }
+
+}

Copied: rl/trunk/engine/core/src/fmod4driver/Fmod4Listener.cpp (from rev 4715, rl/trunk/plugins/fmod4driver/src/Fmod4Listener.cpp)
===================================================================
--- rl/trunk/plugins/fmod4driver/src/Fmod4Listener.cpp	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/src/fmod4driver/Fmod4Listener.cpp	2009-01-22 21:53:04 UTC (rev 4716)
@@ -0,0 +1,77 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#include &quot;stdinc.h&quot;
+
+#include &quot;Fmod4Listener.h&quot;
+
+using namespace Ogre;
+
+namespace rl {
+
+String rl::Fmod4Listener::msMovableType = &quot;Fmod4Listener&quot;; 
+
+Fmod4Listener::Fmod4Listener(const Ogre::String &amp;name, FMOD::System *fmod4system, int listenerId)
+: ListenerMovable(name),
+  mFmod4System(fmod4system),
+  mListenerId(listenerId)
+{
+}
+
+Fmod4Listener::~Fmod4Listener()
+{
+}
+
+const String&amp; Fmod4Listener::getMovableType() const
+{
+    return msMovableType;
+}
+
+void Fmod4Listener::setPosition(const Vector3&amp; position)
+{
+    FMOD_VECTOR pos;
+    pos.x = position.x;
+    pos.y = position.y;
+    pos.z = -position.z;
+    mFmod4System-&gt;set3DListenerAttributes(mListenerId, &amp;pos, NULL, NULL, NULL);
+}
+
+void Fmod4Listener::setOrientation(const Ogre::Quaternion &amp;orientation)
+{
+    FMOD_VECTOR up, to;
+
+    Vector3 upVec = orientation * Vector3::UNIT_Y;
+    up.x = upVec.x;
+    up.y = upVec.y;
+    up.z = -upVec.z;
+
+    Vector3 toVec = orientation * Vector3::NEGATIVE_UNIT_Z;
+    to.x = toVec.x;
+    to.y = toVec.y;
+    to.z = -toVec.z;
+
+    mFmod4System-&gt;set3DListenerAttributes(mListenerId, NULL, NULL, &amp;to, &amp;up);
+}
+
+void Fmod4Listener::setVelocity(const Ogre::Vector3&amp; velocity)
+{
+    FMOD_VECTOR vel;
+    vel.x = velocity.x;
+    vel.y = velocity.y;
+    vel.z = -velocity.z;
+    mFmod4System-&gt;set3DListenerAttributes(mListenerId, NULL, &amp;vel, NULL, NULL);
+}
+
+}

Copied: rl/trunk/engine/core/src/fmod4driver/Fmod4Sound.cpp (from rev 4715, rl/trunk/plugins/fmod4driver/src/Fmod4Sound.cpp)
===================================================================
--- rl/trunk/plugins/fmod4driver/src/Fmod4Sound.cpp	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/src/fmod4driver/Fmod4Sound.cpp	2009-01-22 21:53:04 UTC (rev 4716)
@@ -0,0 +1,377 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#include &quot;stdinc.h&quot;
+
+#include &quot;Fmod4Sound.h&quot;
+
+#include &lt;fmod_errors.h&gt;
+
+#include &quot;Fmod4Driver.h&quot;
+#include &quot;SoundManager.h&quot;
+#include &quot;SoundResource.h&quot;
+
+using namespace Ogre;
+
+namespace rl {
+
+String Fmod4Sound::msMovableType = &quot;Fmod4Sound&quot;;
+ 
+Fmod4Sound::Fmod4Sound(Fmod4Driver* driver, SoundResourcePtr soundres, SoundType type)
+  : Sound(soundres, driver),
+    mType(type),
+    mSound(NULL),
+    mDriver(driver),
+    mChannel(NULL)	
+{
+    setPriority(128);
+}
+
+float Fmod4Sound::getLength() const
+{
+    if (!isValid())
+    {
+        return 0.0;
+    }
+
+    unsigned int length;
+    mSound-&gt;getLength(&amp;length, FMOD_TIMEUNIT_MS);
+    return (float)length/1000.0;
+}
+
+void Fmod4Sound::load() throw (RuntimeException)
+{
+    FMOD_MODE mode = FMOD_DEFAULT;
+
+    if (is3d())
+    {
+        mode |= FMOD_3D;
+    }
+    else
+    {
+        mode |= FMOD_2D;
+    }
+
+    if (isLooping())
+    {
+        mode |= FMOD_LOOP_NORMAL;
+    }
+    else
+    {
+        mode |= FMOD_LOOP_OFF;
+    }
+
+    if (mType == ST_SAMPLE)
+    {
+        FMOD_RESULT res = mDriver-&gt;_getFmodSystem()-&gt;createSound(
+            getSoundResource()-&gt;getName().c_str(), 
+            mode, 
+            NULL, 
+            &amp;mSound);
+
+        CHECK_FMOD4_ERRORS(res);
+    }
+    else if (mType == ST_STREAM)
+    {
+        FMOD_RESULT res = mDriver-&gt;_getFmodSystem()-&gt;createStream(
+            getSoundResource()-&gt;getName().c_str(), 
+            mode, 
+            NULL, 
+            &amp;mSound);
+
+        CHECK_FMOD4_ERRORS(res);
+    }
+    else
+    {
+        RlFail(&quot;Unsupported SoundType.&quot;);
+    }
+}
+
+void Fmod4Sound::unload() throw (RuntimeException)
+{
+    mSound-&gt;release();
+}
+
+bool Fmod4Sound::isValid() const throw (RuntimeException)
+{
+    return mSound != NULL &amp;&amp; mChannel != NULL;
+}
+
+void Fmod4SoundPtr::destroy()
+{
+    SharedPtr&lt;Fmod4Sound&gt;::destroy();
+}
+
+const String&amp; Fmod4Sound::getMovableType() const
+{
+    return msMovableType;
+}
+
+void Fmod4Sound::play(bool destroyWhenDone)
+{
+    if (!isValid())
+    {
+        load();
+    }
+
+    FMOD_RESULT res = mDriver-&gt;_getFmodSystem()-&gt;playSound(
+        FMOD_CHANNEL_FREE, 
+        mSound, 
+        true,
+        &amp;mChannel);
+
+    CHECK_FMOD4_ERRORS(res);
+
+    RlAssert1(mChannel != NULL);
+    mAutoDestroy = destroyWhenDone;
+    mDriver-&gt;_registerChannel(mChannel, this);
+
+    float vol;
+	if (is3d())
+	{
+		vol = mDriver-&gt;getDefaultSoundVolume();
+	}
+	else
+	{
+		vol = mDriver-&gt;getDefaultMusicVolume();
+	}
+	setVolume(vol);
+
+    setPriority(mPriority);
+    setPosition(mPosition);
+    setDirection(mDirection);
+	setVelocity(mVelocity); 
+    pause(false);
+    SoundPlayEvent event = SoundPlayEvent(this, SoundPlayEvent::STARTEVENT);
+    dispatchEvent(&amp;event);
+}
+
+void Fmod4Sound::stop()
+{
+    mChannel-&gt;stop();
+}
+
+void Fmod4Sound::setPosition(const Ogre::Vector3&amp; position)
+{
+	mPosition = position;
+
+	if (isValid())
+	{
+		FMOD_VECTOR pos;
+		pos.x = position.x;
+		pos.y = position.y;
+		pos.z = -position.z;
+		mChannel-&gt;set3DAttributes(&amp;pos, NULL);
+	}
+}
+
+const Ogre::Vector3 Fmod4Sound::getPosition() const
+{
+	if (isValid())
+	{
+		FMOD_VECTOR pos;
+		mChannel-&gt;get3DAttributes(&amp;pos, NULL);
+
+		Vector3 rval;
+		rval.x = pos.x;
+		rval.y = pos.y;
+		rval.z = -pos.z;
+
+		return rval;
+	}
+
+	return mPosition;
+}
+
+const Ogre::Vector3 Fmod4Sound::getVelocity() const
+{
+	if (isValid())
+	{
+		FMOD_VECTOR vel;
+		mChannel-&gt;get3DAttributes(NULL, &amp;vel);
+
+		Vector3 rval;
+		rval.x = vel.x;
+		rval.y = vel.y;
+		rval.z = -vel.z;
+
+		return rval;
+	}
+
+	return mVelocity;
+}
+
+void Fmod4Sound::setVelocity(const Ogre::Vector3&amp; velocity)
+{
+	mVelocity = velocity;
+
+	if (isValid())
+	{
+		FMOD_VECTOR vel;
+		vel.x = velocity.x;
+		vel.y = velocity.y;
+		vel.z = -velocity.z;
+		mChannel-&gt;set3DAttributes(NULL, &amp;vel);
+	}
+}
+
+void Fmod4Sound::setDirection(const Ogre::Quaternion &amp;orientation)
+{
+	mDirection = orientation;
+
+	if (isValid())
+	{
+		FMOD_VECTOR to;
+
+		Vector3 toVec = orientation * Vector3::NEGATIVE_UNIT_Z;
+		to.x = toVec.x;
+		to.y = toVec.y;
+		to.z = -toVec.z;
+
+		mChannel-&gt;set3DConeOrientation(&amp;to);
+	}
+}
+
+const Ogre::Quaternion Fmod4Sound::getDirection() const
+{
+	if (isValid())
+	{
+		FMOD_VECTOR to;
+		mChannel-&gt;get3DConeOrientation(&amp;to);
+
+		Vector3 toVec;
+		toVec.x = to.x;
+		toVec.y = to.y;
+		toVec.z = -to.z;
+
+		return Vector3::NEGATIVE_UNIT_Z.getRotationTo(toVec);
+	}
+
+	return mDirection;
+}
+
+bool Fmod4Sound::isPaused()
+{
+    bool paused;
+    FMOD_RESULT error = mChannel-&gt;getPaused(&amp;paused);
+    return !paused;
+}
+
+const bool Fmod4Sound::isPlaying() const
+{
+    bool playing;
+    FMOD_RESULT error = mChannel-&gt;isPlaying(&amp;playing);
+    return playing;
+}
+
+void Fmod4Sound::pause(bool pause)
+{
+    mChannel-&gt;setPaused(pause);
+}
+
+void Fmod4Sound::setVolume(float vol)
+{
+	mVolume = vol;
+	if (isValid())
+	{
+	    mChannel-&gt;setVolume(vol);
+	}
+}
+
+const float Fmod4Sound::getVolume() const
+{
+	if (isValid())
+	{
+		float vol;
+		mChannel-&gt;getVolume(&amp;vol);
+		return vol;
+	}
+	return mVolume;
+}
+
+/**
+ * @author JoSch
+ * @date 14-03-2007
+ * @version 1.0
+ * @param priority The new priority of this sound
+ */ 
+void Fmod4Sound::setPriority(const int priority)
+{
+    mPriority = priority;
+    if (mPriority &lt; 0)
+    {
+        mPriority = 0;
+    }
+    if (mPriority &gt; 256)
+    {
+        mPriority = 256;
+    }
+    if (isValid())
+    {
+        mChannel-&gt;setPriority(mPriority);
+    }
+}
+
+/**
+ * @author JoSch
+ * @date 14-03-2007
+ * @version 1.0
+ * @return The new priority of this sound
+ */ 
+const int Fmod4Sound::getPriority() const
+{
+    int priority = mPriority;
+    if (isValid())
+    {
+        mChannel-&gt;getPriority(&amp;priority);
+    }
+    return priority;
+}
+
+
+/**
+ * @author JoSch
+ * @date 15-03-2007
+ * @version 1.0
+ * @return The Fmod4 Channel object
+ */ 
+FMOD::Channel *Fmod4Sound::getFmodChannel() const
+{
+    return mChannel;
+}
+
+/**
+ * @author JoSch
+ * @date 15-03-2007
+ * @version 1.0
+ * @return The Fmod4 Sound object
+ */ 
+FMOD::Sound *Fmod4Sound::getFmodSound() const
+{
+    return mSound;
+}
+
+/**
+ * @author JoSch
+ * @date 15-03-2007
+ * @version 1.0
+ * @return TRUE, if the sound should autodestroy when playing ended.
+ */ 
+bool Fmod4Sound::isAutoDestroying() const
+{
+    return mAutoDestroy;
+}
+
+} // Namespace

Copied: rl/trunk/engine/core/src/fmod4driver/Fmod4SoundStitching.cpp (from rev 4715, rl/trunk/plugins/fmod4driver/src/Fmod4SoundStitching.cpp)
===================================================================
--- rl/trunk/plugins/fmod4driver/src/Fmod4SoundStitching.cpp	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/core/src/fmod4driver/Fmod4SoundStitching.cpp	2009-01-22 21:53:04 UTC (rev 4716)
@@ -0,0 +1,427 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#include &quot;stdinc.h&quot;
+
+#include &quot;Fmod4SoundStitching.h&quot;
+
+#include &lt;fmod_errors.h&gt;
+
+#include &quot;Fmod4Driver.h&quot;
+#include &quot;SoundManager.h&quot;
+#include &quot;SoundResource.h&quot;
+
+using namespace Ogre;
+
+namespace rl {
+
+String Fmod4SoundStitching::msMovableType = &quot;Fmod4SoundStitching&quot;;
+ 
+Fmod4SoundStitching::Fmod4SoundStitching(unsigned int numSlots, const CeGuiString&amp; name, SoundDriver* creator)
+  : SoundStitching(numSlots, name, creator),
+    mSound(NULL),
+    mChannel(NULL)	
+{
+    setPriority(128);
+}
+
+void Fmod4SoundStitching::load() throw (RuntimeException)
+{
+    FMOD_CREATESOUNDEXINFO exinfo;
+    FMOD_MODE mode = FMOD_OPENUSER;
+
+    if (is3d())
+    {
+        mode |= FMOD_3D;
+    }
+    else
+    {
+        mode |= FMOD_2D;
+    }
+
+    if (isLooping())
+    {
+        mode |= FMOD_LOOP_NORMAL;
+    }
+    else
+    {
+        mode |= FMOD_LOOP_OFF;
+    }
+
+    memset(&amp;exinfo, 0, sizeof(FMOD_CREATESOUNDEXINFO));
+    
+    exinfo.cbsize = sizeof(FMOD_CREATESOUNDEXINFO);
+    exinfo.defaultfrequency = 44100;
+    exinfo.numsubsounds = getNumSlots();
+    exinfo.numchannels = is3d() ? 1 : 2;
+    exinfo.format = FMOD_SOUND_FORMAT_PCM16;
+
+    FMOD_RESULT res = mDriver-&gt;_getFmodSystem()-&gt;createStream(
+        getSoundResource()-&gt;getName().c_str(), 
+        mode, 
+        &amp;exinfo, 
+        &amp;mSound);
+
+    CHECK_FMOD4_ERRORS(res);
+
+    int *sentence = new int[getNumSlots()];
+    for(unsigned int i = 0; i &lt; getNumSlots(); i++)
+    {
+        sentence[i] = i;
+    }
+    res = mSound-&gt;setSubSoundSentence(sentence, getNumSlots());
+    CHECK_FMOD4_ERRORS(res);
+}
+
+void Fmod4SoundStitching::unload() throw (RuntimeException)
+{
+    mSound-&gt;release();
+}
+
+bool Fmod4SoundStitching::isValid() const throw (RuntimeException)
+{
+    return mSound != NULL &amp;&amp; mChannel != NULL;
+}
+
+void Fmod4SoundStitchingPtr::destroy()
+{
+    SharedPtr&lt;Fmod4SoundStitching&gt;::destroy();
+}
+
+const String&amp; Fmod4SoundStitching::getMovableType() const
+{
+    return msMovableType;
+}
+
+void Fmod4SoundStitching::play(bool destroyWhenDone)
+{
+    if (!isValid())
+    {
+        load();
+    }
+
+    FMOD_RESULT res = mDriver-&gt;_getFmodSystem()-&gt;playSound(
+        FMOD_CHANNEL_FREE, 
+        mSound, 
+        true,
+        &amp;mChannel);
+
+    CHECK_FMOD4_ERRORS(res);
+
+    RlAssert1(mChannel != NULL);
+    mAutoDestroy = destroyWhenDone;
+//    mDriver-&gt;_registerChannel(mChannel, this);
+
+    float vol;
+	if (is3d())
+	{
+		vol = mDriver-&gt;getDefaultSoundVolume();
+	}
+	else
+	{
+		vol = mDriver-&gt;getDefaultMusicVolume();
+	}
+	setVolume(vol);
+
+    setPriority(mPriority);
+    setPosition(mPosition);
+    setDirection(mDirection);
+	setVelocity(mVelocity); 
+    pause(false);
+    SoundPlayEvent event = SoundPlayEvent(this, SoundPlayEvent::STARTEVENT);
+    dispatchEvent(&amp;event);
+}
+
+void Fmod4SoundStitching::stop()
+{
+    mChannel-&gt;stop();
+}
+
+void Fmod4SoundStitching::setPosition(const Ogre::Vector3&amp; position)
+{
+	mPosition = position;
+
+	if (isValid())
+	{
+		FMOD_VECTOR pos;
+		pos.x = position.x;
+		pos.y = position.y;
+		pos.z = -position.z;
+		mChannel-&gt;set3DAttributes(&amp;pos, NULL);
+	}
+}
+
+const Ogre::Vector3 Fmod4SoundStitching::getPosition() const
+{
+	if (isValid())
+	{
+		FMOD_VECTOR pos;
+		mChannel-&gt;get3DAttributes(&amp;pos, NULL);
+
+		Vector3 rval;
+		rval.x = pos.x;
+		rval.y = pos.y;
+		rval.z = -pos.z;
+
+		return rval;
+	}
+
+	return mPosition;
+}
+
+const Ogre::Vector3 Fmod4SoundStitching::getVelocity() const
+{
+	if (isValid())
+	{
+		FMOD_VECTOR vel;
+		mChannel-&gt;get3DAttributes(NULL, &amp;vel);
+
+		Vector3 rval;
+		rval.x = vel.x;
+		rval.y = vel.y;
+		rval.z = -vel.z;
+
+		return rval;
+	}
+
+	return mVelocity;
+}
+
+void Fmod4SoundStitching::setVelocity(const Ogre::Vector3&amp; velocity)
+{
+	mVelocity = velocity;
+
+	if (isValid())
+	{
+		FMOD_VECTOR vel;
+		vel.x = velocity.x;
+		vel.y = velocity.y;
+		vel.z = -velocity.z;
+		mChannel-&gt;set3DAttributes(NULL, &amp;vel);
+	}
+}
+
+void Fmod4SoundStitching::setDirection(const Ogre::Quaternion &amp;orientation)
+{
+	mDirection = orientation;
+
+	if (isValid())
+	{
+		FMOD_VECTOR to;
+
+		Vector3 toVec = orientation * Vector3::NEGATIVE_UNIT_Z;
+		to.x = toVec.x;
+		to.y = toVec.y;
+		to.z = -toVec.z;
+
+		mChannel-&gt;set3DConeOrientation(&amp;to);
+	}
+}
+
+const Ogre::Quaternion Fmod4SoundStitching::getDirection() const
+{
+	if (isValid())
+	{
+		FMOD_VECTOR to;
+		mChannel-&gt;get3DConeOrientation(&amp;to);
+
+		Vector3 toVec;
+		toVec.x = to.x;
+		toVec.y = to.y;
+		toVec.z = -to.z;
+
+		return Vector3::NEGATIVE_UNIT_Z.getRotationTo(toVec);
+	}
+
+	return mDirection;
+}
+
+bool Fmod4SoundStitching::isPaused()
+{
+    bool paused;
+    FMOD_RESULT error = mChannel-&gt;getPaused(&amp;paused);
+    return !paused;
+}
+
+const bool Fmod4SoundStitching::isPlaying() const
+{
+    bool playing;
+    FMOD_RESULT error = mChannel-&gt;isPlaying(&amp;playing);
+    return playing;
+}
+
+void Fmod4SoundStitching::pause(bool pause)
+{
+    mChannel-&gt;setPaused(pause);
+}
+
+void Fmod4SoundStitching::setVolume(float vol)
+{
+	mVolume = vol;
+	if (isValid())
+	{
+	    mChannel-&gt;setVolume(vol);
+	}
+}
+
+const float Fmod4SoundStitching::getVolume() const
+{
+	if (isValid())
+	{
+		float vol;
+		mChannel-&gt;getVolume(&amp;vol);
+		return vol;
+	}
+	return mVolume;
+}
+
+/**
+ * @author JoSch
+ * @date 14-03-2007
+ * @version 1.0
+ * @param priority The new priority of this sound
+ */ 
+void Fmod4SoundStitching::setPriority(const int priority)
+{
+    mPriority = priority;
+    if (mPriority &lt; 0)
+    {
+        mPriority = 0;
+    }
+    if (mPriority &gt; 256)
+    {
+        mPriority = 256;
+    }
+    if (isValid())
+    {
+        mChannel-&gt;setPriority(mPriority);
+    }
+}
+
+/**
+ * @author JoSch
+ * @date 14-03-2007
+ * @version 1.0
+ * @return The new priority of this sound
+ */ 
+const int Fmod4SoundStitching::getPriority() const
+{
+    int priority = mPriority;
+    if (isValid())
+    {
+        mChannel-&gt;getPriority(&amp;priority);
+    }
+    return priority;
+}
+
+
+/**
+ * @author JoSch
+ * @date 15-03-2007
+ * @version 1.0
+ * @return The Fmod4 Channel object
+ */ 
+FMOD::Channel *Fmod4SoundStitching::getFmodChannel() const
+{
+    return mChannel;
+}
+
+/**
+ * @author JoSch
+ * @date 15-03-2007
+ * @version 1.0
+ * @return The Fmod4 Sound object
+ */ 
+FMOD::Sound *Fmod4SoundStitching::getFmodSound() const
+{
+    return mSound;
+}
+
+/**
+ * @author JoSch
+ * @date 15-03-2007
+ * @version 1.0
+ * @return TRUE, if the sound should autodestroy when playing ended.
+ */ 
+bool Fmod4SoundStitching::isAutoDestroying() const
+{
+    return mAutoDestroy;
+}
+
+/**
+ * @author JoSch
+ * @date 08-03-2008
+ * @version 1.0
+ */ 
+void Fmod4SoundStitching::putSoundIntoSlot(unsigned int slot, CeGuiString label)
+{
+    if (isValid())
+    {
+        FMOD_MODE mode = FMOD_DEFAULT;
+
+        if (is3d())
+        {
+            mode |= FMOD_3D;
+        }
+        else
+        {
+            mode |= FMOD_2D;
+        }
+
+        if (isLooping())
+        {
+            mode |= FMOD_LOOP_NORMAL;
+        }
+        else
+        {
+            mode |= FMOD_LOOP_OFF;
+        }
+        FMOD::Sound *sound;
+        FMOD_RESULT result = mDriver-&gt;_getFmodSystem()-&gt;createStream(
+            mSoundCache[label]-&gt;getName().c_str(), 
+            mode, 
+            NULL, 
+            &amp;sound);
+        CHECK_FMOD4_ERRORS(result);
+        if (mSoundSlots[slot] != NULL)
+        {
+            mSoundSlots[slot]-&gt;release();
+        }
+        mSoundSlots[slot] = sound;
+
+        result = sound-&gt;setSubSound(slot, sound);
+        CHECK_FMOD4_ERRORS(result);
+    }
+}
+
+/**
+ * @author JoSch
+ * @date 08-03-2008
+ * @version 1.0
+ * @return TRUE, if the sound should autodestroy when playing ended.
+ */ 
+unsigned int Fmod4SoundStitching::getPlayingSlot()
+{
+    if (isValid())
+    {
+        unsigned int currentslot = -1;
+        FMOD_RESULT result = mChannel-&gt;getPosition(&amp;currentslot, (FMOD_TIMEUNIT)(FMOD_TIMEUNIT_SENTENCE_SUBSOUND | FMOD_TIMEUNIT_BUFFERED));
+        CHECK_FMOD4_ERRORS(result);
+        return currentslot;
+    }
+    return -1;
+}
+
+} // Namespace

Copied: rl/trunk/engine/ui/include/Fmod4ConfigComponent.h (from rev 4715, rl/trunk/plugins/fmod4driver/include/Fmod4ConfigComponent.h)

Copied: rl/trunk/engine/ui/src/Fmod4ConfigComponent.cpp (from rev 4715, rl/trunk/plugins/fmod4driver/src/Fmod4ConfigComponent.cpp)

Modified: rl/trunk/engine/ui/src/GameSettings.cpp
===================================================================
--- rl/trunk/engine/ui/src/GameSettings.cpp	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/engine/ui/src/GameSettings.cpp	2009-01-22 21:53:04 UTC (rev 4716)
@@ -48,7 +48,7 @@
         {
             if ((*it)-&gt;isDriverPlugin())
             {
-                registerSoundDriverConfig((*it)-&gt;getConfigComponent());
+                //registerSoundDriverConfig((*it)-&gt;getConfigComponent());
             }
         }
 

Modified: rl/trunk/tools/copy_dependencies.bat
===================================================================
--- rl/trunk/tools/copy_dependencies.bat	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/tools/copy_dependencies.bat	2009-01-22 21:53:04 UTC (rev 4716)
@@ -51,7 +51,6 @@
 REM Die restlichen Abh&#228;ngigkeiten
 REM -----------------------------
 REM 
-copy &quot;%RL_ROOT%\dependencies\fmod\api\fmod.dll&quot; &quot;%RL_DIST%&quot;
 copy &quot;%RL_ROOT%\dependencies\FMOD4\api\fmodex.dll&quot; &quot;%RL_DIST%&quot;
 
 copy &quot;%RL_ROOT%\Dependencies\NewtonSDK\sdk\dll\Newton.dll&quot; &quot;%RL_DIST%&quot;

Modified: rl/trunk/tools/copy_dlls.bat
===================================================================
--- rl/trunk/tools/copy_dlls.bat	2009-01-21 19:56:28 UTC (rev 4715)
+++ rl/trunk/tools/copy_dlls.bat	2009-01-22 21:53:04 UTC (rev 4716)
@@ -18,7 +18,3 @@
 copy &quot;%RL_ROOT%\engine\ui\lib\%BUILD%\RlUi.dll&quot; &quot;%RL_DIST%&quot;
 copy &quot;%RL_ROOT%\engine\uicomponents\lib\%BUILD%\RlUiComponents.dll&quot; &quot;%RL_DIST%&quot;
 copy &quot;%RL_ROOT%\engine\ai\lib\%BUILD%\RlAI.dll&quot; &quot;%RL_DIST%&quot;
-
-copy &quot;%RL_ROOT%\plugins\fmod3driver\lib\%BUILD%\RlFmod3Driver.dll&quot; &quot;%RL_DIST%&quot;
-copy &quot;%RL_ROOT%\plugins\fmod4driver\lib\%BUILD%\RlFmod4Driver.dll&quot; &quot;%RL_DIST%&quot;
-copy &quot;%RL_ROOT%\plugins\openaldriver\lib\%BUILD%\RlOpenALDriver.dll&quot; &quot;%RL_DIST%&quot;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001772.html">[Dsa-hl-svn] r4715 - in dependencies/OgreNewt_ngt: inc src
</A></li>
	<LI>Next message: <A HREF="001774.html">[Dsa-hl-svn] r4717 - rl/trunk/Mac/Rastullah.xcodeproj
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1773">[ date ]</a>
              <a href="thread.html#1773">[ thread ]</a>
              <a href="subject.html#1773">[ subject ]</a>
              <a href="author.html#1773">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
