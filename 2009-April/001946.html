<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4889 - in dependencies/OgreNewt:	demos/Demo01_TheBasics demos/Demo02_Joints	demos/Demo03_CollisionCallbacks demos/Demo04_Raycasting	demos/Demo05_SimpleVehicle demos/Demo06_SimpleBuoyancy	demos/Demo07_CustomJoints demos/Demo08_RagdollExample inc src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2009-April/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4889%20-%20in%20dependencies/OgreNewt%3A%0A%09demos/Demo01_TheBasics%20demos/Demo02_Joints%0A%09demos/Demo03_CollisionCallbacks%20demos/Demo04_Raycasting%0A%09demos/Demo05_SimpleVehicle%20demos/Demo06_SimpleBuoyancy%0A%09demos/Demo07_CustomJoints%20demos/Demo08_RagdollExample%20inc%20src&In-Reply-To=%3C200904072224.n37MOiEE032255%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001945.html">
   <LINK REL="Next"  HREF="001947.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4889 - in dependencies/OgreNewt:	demos/Demo01_TheBasics demos/Demo02_Joints	demos/Demo03_CollisionCallbacks demos/Demo04_Raycasting	demos/Demo05_SimpleVehicle demos/Demo06_SimpleBuoyancy	demos/Demo07_CustomJoints demos/Demo08_RagdollExample inc src</H1>
    <B>melven at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4889%20-%20in%20dependencies/OgreNewt%3A%0A%09demos/Demo01_TheBasics%20demos/Demo02_Joints%0A%09demos/Demo03_CollisionCallbacks%20demos/Demo04_Raycasting%0A%09demos/Demo05_SimpleVehicle%20demos/Demo06_SimpleBuoyancy%0A%09demos/Demo07_CustomJoints%20demos/Demo08_RagdollExample%20inc%20src&In-Reply-To=%3C200904072224.n37MOiEE032255%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4889 - in dependencies/OgreNewt:	demos/Demo01_TheBasics demos/Demo02_Joints	demos/Demo03_CollisionCallbacks demos/Demo04_Raycasting	demos/Demo05_SimpleVehicle demos/Demo06_SimpleBuoyancy	demos/Demo07_CustomJoints demos/Demo08_RagdollExample inc src">melven at mail.berlios.de
       </A><BR>
    <I>Wed Apr  8 00:24:44 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001945.html">[Dsa-hl-svn] r4888 - rl/trunk/editors/Lockenwickler/src
</A></li>
        <LI>Next message: <A HREF="001947.html">[Dsa-hl-svn] r4890 - in rl/trunk/engine: ai/src core/include	core/src rules/src script/src ui/include ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1946">[ date ]</a>
              <a href="thread.html#1946">[ thread ]</a>
              <a href="subject.html#1946">[ subject ]</a>
              <a href="author.html#1946">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: melven
Date: 2009-04-08 00:24:33 +0200 (Wed, 08 Apr 2009)
New Revision: 4889

Modified:
   dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorBelt.cpp
   dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorMatCallback.cpp
   dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo05_SimpleVehicle/SimpleVehicle.cpp
   dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonApplication.cpp
   dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonFrameListener.cpp
   dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.cpp
   dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.h
   dependencies/OgreNewt/inc/OgreNewt.h
   dependencies/OgreNewt/inc/OgreNewt_BasicFrameListener.h
   dependencies/OgreNewt/inc/OgreNewt_Body.h
   dependencies/OgreNewt/inc/OgreNewt_BodyInAABBIterator.h
   dependencies/OgreNewt/inc/OgreNewt_Collision.h
   dependencies/OgreNewt/inc/OgreNewt_CollisionPrimitives.h
   dependencies/OgreNewt/inc/OgreNewt_CollisionSerializer.h
   dependencies/OgreNewt/inc/OgreNewt_ContactCallback.h
   dependencies/OgreNewt/inc/OgreNewt_ContactJoint.h
   dependencies/OgreNewt/inc/OgreNewt_Debugger.h
   dependencies/OgreNewt/inc/OgreNewt_Joint.h
   dependencies/OgreNewt/inc/OgreNewt_MaterialID.h
   dependencies/OgreNewt/inc/OgreNewt_PlayerController.h
   dependencies/OgreNewt/inc/OgreNewt_Prerequisites.h
   dependencies/OgreNewt/inc/OgreNewt_RayCast.h
   dependencies/OgreNewt/inc/OgreNewt_Tools.h
   dependencies/OgreNewt/inc/OgreNewt_Vehicle.h
   dependencies/OgreNewt/inc/OgreNewt_World.h
   dependencies/OgreNewt/src/OgreNewt_Body.cpp
   dependencies/OgreNewt/src/OgreNewt_Collision.cpp
   dependencies/OgreNewt/src/OgreNewt_CollisionPrimitives.cpp
   dependencies/OgreNewt/src/OgreNewt_CollisionSerializer.cpp
   dependencies/OgreNewt/src/OgreNewt_Debugger.cpp
   dependencies/OgreNewt/src/OgreNewt_PlayerController.cpp
   dependencies/OgreNewt/src/OgreNewt_RayCast.cpp
   dependencies/OgreNewt/src/OgreNewt_Tools.cpp
Log:
-added preprocessor option OGRENEWT_COLLISION_USE_SHAREDPTR (use boost::shared_ptr for Collisions)
-added preprocessor option OGRENEWT_USE_OGRE_ANY (use Ogre::Any instead of userdata-pointers)


Modified: dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonApplication.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonApplication.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -55,13 +55,15 @@
 
 	// here's where we make a collision shape for the physics.  note that we use the same size as
 	// above.
-	OgreNewt::Collision* col = new OgreNewt::CollisionPrimitives::Cylinder(m_World, 2.5, 5);
+	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::Cylinder(m_World, 2.5, 5));
 
 	// now we make a new rigid body based on this collision shape.
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
 
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	// we`re done with the collision shape, we can delete it now.
 	delete col;
+#endif
 
 	// now we &quot;attach&quot; the rigid body to the scene node that holds the visual object, and set it's
 	// original position and orientation.  all rigid bodies default to mass=0 (static, immobile), so

Modified: dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonFrameListener.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo01_TheBasics/OgreNewtonFrameListener.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -80,17 +80,20 @@
 			//ent-&gt;setNormaliseNormals(true);
 
 			// again, make the collision shape.
-			OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Cylinder(m_World, 1, 1);
+			OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Cylinder(m_World, 1, 1));
 			
 			// then make the rigid body.
 			OgreNewt::Body* body = new OgreNewt::Body( m_World, col );
 
 			Ogre::Vector3 inertia, offset;
             col-&gt;calculateInertialMatrix(inertia, offset);
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 			//no longer need the collision shape object
 			delete col;
+#endif
 
 			body-&gt;setMassMatrix( 10.0, 10.0*inertia );
+            body-&gt;setCenterOfMass(offset);
 
 			// attach to the scene node.
 			body-&gt;attachNode( node );

Modified: dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonApplication.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonApplication.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -74,8 +74,10 @@
 	// SceneNodes (parsing all children), and add collision for all meshes in the tree.
 	OgreNewt::CollisionPrimitives::TreeCollisionSceneParser* stat_col = new OgreNewt::CollisionPrimitives::TreeCollisionSceneParser( m_World );
 	stat_col-&gt;parseScene( floornode, true );
-	OgreNewt::Body* bod = new OgreNewt::Body( m_World, stat_col );
+	OgreNewt::Body* bod = new OgreNewt::Body( m_World, OgreNewt::CollisionPtr(stat_col) );
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete stat_col;
+#endif
 	
 	bod-&gt;attachNode( floornode );
 	bod-&gt;setPositionOrientation( Ogre::Vector3(0.0,-20.0,0.0), Ogre::Quaternion::IDENTITY );
@@ -160,7 +162,7 @@
 	box1node-&gt;setScale( size );
 //	box1-&gt;setNormaliseNormals(true);
 
-	OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Box( m_World, size );
+	OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Box( m_World, size ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
 
 
@@ -171,10 +173,13 @@
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
 
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete col;
+#endif
 				
 	bod-&gt;attachNode( box1node );
 	bod-&gt;setMassMatrix( mass, mass*inertia );
+    bod-&gt;setCenterOfMass(offset);
 	bod-&gt;setStandardForceCallback();
 
 	box1-&gt;setMaterialName( &quot;Simple/BumpyMetal&quot; );

Modified: dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonFrameListener.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo02_Joints/OgreNewtonFrameListener.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -74,12 +74,17 @@
 			ent-&gt;setMaterialName( &quot;Simple/dirt01&quot; );
 //			ent-&gt;setNormaliseNormals(true);
 
-			OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Ellipsoid( m_World, Ogre::Vector3(1,1,1) );
+			OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Ellipsoid( m_World, Ogre::Vector3(1,1,1) ));
 			OgreNewt::Body* body = new OgreNewt::Body( m_World, col );
 
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+            delete col;
+#endif
+
 			Ogre::Vector3 inertia, offset;
             col-&gt;calculateInertialMatrix(inertia, offset);
 			body-&gt;setMassMatrix( 10.0, 10.0*inertia );
+            body-&gt;setCenterOfMass(offset);
 			body-&gt;attachNode( node );
 			body-&gt;setStandardForceCallback();
 			body-&gt;setPositionOrientation( pos, camorient );

Modified: dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorBelt.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorBelt.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorBelt.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -27,15 +27,21 @@
 	mNode-&gt;setScale( size );
 
 	// create the collision object for the conveyor belt.
-	OgreNewt::Collision* col = new OgreNewt::CollisionPrimitives::Box( world, size );
+	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::Box( world, size ));
 	mBody = new OgreNewt::Body( world, col, conveyorType );
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete col;
+#endif
 
 	mBody-&gt;setMassMatrix( 0.0, Ogre::Vector3(0,0,0) );
 	mBody-&gt;attachNode( mNode );
 	mBody-&gt;setMaterialGroupID( conveyorMat );
 
+#ifdef OGRENEWT_USE_OGRE_ANY
+	mBody-&gt;setUserData( Ogre::Any(this) );
+#else
 	mBody-&gt;setUserData( this );
+#endif
 
 	mBody-&gt;setPositionOrientation( pos, orient );
 	mNode-&gt;setPosition( pos );

Modified: dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorMatCallback.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorMatCallback.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/ConveyorMatCallback.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -29,13 +29,21 @@
 
 	if (body0-&gt;getType() == mConveyorID)
 	{
+#ifdef OGRENEWT_USE_OGRE_ANY
+		belt = Ogre::any_cast&lt;ConveyorBelt*&gt;(body0-&gt;getUserData());
+#else
 		belt = (ConveyorBelt*)body0-&gt;getUserData();
+#endif
 		object = body1;
 	}
 
 	if (body1-&gt;getType() == mConveyorID)
 	{
+#ifdef OGRENEWT_USE_OGRE_ANY
+		belt = Ogre::any_cast&lt;ConveyorBelt*&gt;(body1-&gt;getUserData());
+#else
 		belt = (ConveyorBelt*)body1-&gt;getUserData();
+#endif
 		object = body0;
 	}
 

Modified: dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonApplication.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonApplication.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -79,9 +79,13 @@
 	floor-&gt;setCastShadows( false );
 
 	//Ogre::Vector3 siz(100.0, 10.0, 100.0);
-	OgreNewt::Collision* col = new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true );
+	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
 	
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+    delete col;
+#endif
+
 	//floornode-&gt;setScale( siz );
 	bod-&gt;attachNode( floornode );
 	bod-&gt;setPositionOrientation( Ogre::Vector3(0.0,-10.0,0.0), Ogre::Quaternion::IDENTITY );

Modified: dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonFrameListener.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo03_CollisionCallbacks/OgreNewtonFrameListener.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -68,14 +68,18 @@
 
 		ent-&gt;setMaterialName( &quot;Simple/BumpyMetal&quot; );
 
-		OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Box( m_World, size );
+		OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Box( m_World, size ));
 		OgreNewt::Body* body = new OgreNewt::Body( m_World, col );
 
         Ogre::Vector3 inertia, offset;
         col-&gt;calculateInertialMatrix(inertia, offset);
+
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 		delete col;
+#endif
 
 		body-&gt;setMassMatrix( mass, mass*inertia );
+        body-&gt;setCenterOfMass(offset);
 		body-&gt;attachNode( node );
 		body-&gt;setStandardForceCallback();
 		body-&gt;setPositionOrientation( Ogre::Vector3(-5,8,0), Ogre::Quaternion::IDENTITY );

Modified: dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonApplication.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonApplication.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -75,9 +75,11 @@
 
 
 	//Ogre::Vector3 siz(100.0, 10.0, 100.0);
-	OgreNewt::Collision* col = new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true );
+	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete col;
+#endif
 	
 	//floornode-&gt;setScale( siz );
 	bod-&gt;attachNode( floornode );
@@ -174,7 +176,7 @@
 	box1node-&gt;attachObject( box1 );
 	box1node-&gt;setScale( size );
 
-	OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Box( m_World, size );
+	OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Box( m_World, size ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
 
 
@@ -184,10 +186,13 @@
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
 
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete col;
+#endif
 				
 	bod-&gt;attachNode( box1node );
 	bod-&gt;setMassMatrix( mass, mass*inertia );
+    bod-&gt;setCenterOfMass(offset);
 	bod-&gt;setStandardForceCallback();
 
 	box1-&gt;setMaterialName( &quot;Simple/BumpyMetal&quot; );

Modified: dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonFrameListener.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo04_Raycasting/OgreNewtonFrameListener.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -114,7 +114,12 @@
 				Ogre::Vector3 localpt = bodorient.Inverse() * (globalpt - bodpos);
 
 				// now we need to save this point to apply the spring force, I'm using the userData of the bodies in this example.
+                // (where is it used? probably not needed here...)
+#ifdef OGRENEWT_USE_OGRE_ANY
+                info.mBody-&gt;setUserData( Ogre::Any(this) );
+#else
 				info.mBody-&gt;setUserData( this );
+#endif
 
 				// now change the force callback from the standard one to the one that applies the spring (drag) force.
 				// this is an example of binding a callback to a member of a specific class.  in previous versions of OgreNewt you were

Modified: dependencies/OgreNewt/demos/Demo05_SimpleVehicle/SimpleVehicle.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo05_SimpleVehicle/SimpleVehicle.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo05_SimpleVehicle/SimpleVehicle.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -172,6 +172,7 @@
 				
 	bod-&gt;attachNode( box1node );
 	bod-&gt;setMassMatrix( mass, mass*inertia );
+    bod-&gt;setCenterOfMass(offset);
 	bod-&gt;setStandardForceCallback();
 
 	box1-&gt;setMaterialName( &quot;Simple/BumpyMetal&quot; );

Modified: dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonApplication.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonApplication.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -75,9 +75,11 @@
 
 
 	//Ogre::Vector3 siz(100.0, 10.0, 100.0);
-	OgreNewt::Collision* col = new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true );
+	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete col;
+#endif
 	
 	//floornode-&gt;setScale( siz );
 	bod-&gt;attachNode( floornode );
@@ -191,7 +193,7 @@
 	box1node-&gt;attachObject( box1 );
 	box1node-&gt;setScale( size );
 
-	OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Box( m_World, size );
+	OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Box( m_World, size ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
 
 
@@ -200,11 +202,13 @@
 	// calculate the inertia based on box formula and mass
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
-
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete col;
+#endif
 				
 	bod-&gt;attachNode( box1node );
 	bod-&gt;setMassMatrix( mass, mass*inertia );
+    bod-&gt;setCenterOfMass(offset);
 	bod-&gt;setStandardForceCallback();
 
 	box1-&gt;setMaterialName( &quot;Simple/BumpyMetal&quot; );

Modified: dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonFrameListener.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo06_SimpleBuoyancy/OgreNewtonFrameListener.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -114,8 +114,14 @@
 				Ogre::Vector3 localpt = bodorient.Inverse() * (globalpt - bodpos);
 
 				// now we need to save this point to apply the spring force, I'm using the userData of the bodies in this example.
+                // (where is it used? probably not needed here...)
+#ifdef OGRENEWT_USE_OGRE_ANY
+                info.mBody-&gt;setUserData( Ogre::Any(this) );
+#else
 				info.mBody-&gt;setUserData( this );
+#endif
 
+
 				// now change the force callback from the standard one to the one that applies the spring (drag) force.
 				info.mBody-&gt;setCustomForceAndTorqueCallback&lt;OgreNewtonFrameListener&gt;( &amp;OgreNewtonFrameListener::dragCallback, this );
 

Modified: dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonApplication.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonApplication.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -75,8 +75,10 @@
 	// SceneNodes (parsing all children), and add collision for all meshes in the tree.
 	OgreNewt::CollisionPrimitives::TreeCollisionSceneParser* stat_col = new OgreNewt::CollisionPrimitives::TreeCollisionSceneParser( m_World );
 	stat_col-&gt;parseScene( floornode, true );
-	OgreNewt::Body* bod = new OgreNewt::Body( m_World, stat_col );
+	OgreNewt::Body* bod = new OgreNewt::Body( m_World, OgreNewt::CollisionPtr(stat_col) );
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete stat_col;
+#endif
 	
 	bod-&gt;attachNode( floornode );
 	bod-&gt;setPositionOrientation( Ogre::Vector3(0.0,-20.0,0.0), Ogre::Quaternion::IDENTITY );
@@ -160,7 +162,7 @@
 	box1node-&gt;attachObject( box1 );
 	box1node-&gt;setScale( size );
 
-	OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Box( m_World, size );
+	OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Box( m_World, size ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
 
 
@@ -170,11 +172,13 @@
 	// calculate the inertia based on box formula and mass
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
-
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete col;
+#endif
 				
 	bod-&gt;attachNode( box1node );
 	bod-&gt;setMassMatrix( mass, mass*inertia );
+    bod-&gt;setCenterOfMass(offset);
 	bod-&gt;setStandardForceCallback();
 
 	box1-&gt;setMaterialName( &quot;Simple/BumpyMetal&quot; );

Modified: dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonFrameListener.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo07_CustomJoints/OgreNewtonFrameListener.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -73,18 +73,23 @@
 
 			ent-&gt;setMaterialName( &quot;Simple/dirt01&quot; );
 
-			OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Ellipsoid( m_World, Ogre::Vector3(1,1,1) );
+			OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Ellipsoid( m_World, Ogre::Vector3(1,1,1) ));
 			OgreNewt::Body* body = new OgreNewt::Body( m_World, col );
 
 			Ogre::Vector3 inertia, offset;
             col-&gt;calculateInertialMatrix(inertia, offset);
 			body-&gt;setMassMatrix( 10.0, 10.0*inertia );
+            body-&gt;setCenterOfMass(offset);
 			body-&gt;attachNode( node );
 			body-&gt;setStandardForceCallback();
 			body-&gt;setPositionOrientation( pos, camorient );
 			body-&gt;setVelocity( (dir * 50.0) );
 
 			timer = 0.2;
+
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+            delete col;
+#endif
 		}
 	}
 

Modified: dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonApplication.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonApplication.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonApplication.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -49,9 +49,11 @@
 	floor-&gt;setCastShadows( false );
 
 	//Ogre::Vector3 siz(100.0, 10.0, 100.0);
-	OgreNewt::Collision* col = new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true );
+	OgreNewt::CollisionPtr col = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision( m_World, floor, true ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete col;
+#endif
 	
 	//floornode-&gt;setScale( siz );
 	bod-&gt;attachNode( floornode );
@@ -97,7 +99,7 @@
 	box1node-&gt;attachObject( box1 );
 	box1node-&gt;setScale( size );
 
-	OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Box( m_World, size );
+	OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Box( m_World, size ));
 	OgreNewt::Body* bod = new OgreNewt::Body( m_World, col );
 
 
@@ -108,10 +110,13 @@
 	Ogre::Vector3 inertia, offset;
     col-&gt;calculateInertialMatrix(inertia, offset);
 
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
 	delete col;
+#endif
 				
 	bod-&gt;attachNode( box1node );
 	bod-&gt;setMassMatrix( mass, mass*inertia );
+    bod-&gt;setCenterOfMass(offset);
 	bod-&gt;setStandardForceCallback();
 
 	box1-&gt;setMaterialName( &quot;Simple/BumpyMetal&quot; );

Modified: dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonFrameListener.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonFrameListener.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo08_RagdollExample/OgreNewtonFrameListener.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -87,18 +87,23 @@
 
 			ent-&gt;setMaterialName( &quot;Simple/dirt01&quot; );
 
-			OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::Ellipsoid( m_World, Ogre::Vector3(1,1,1) );
+			OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Ellipsoid( m_World, Ogre::Vector3(1,1,1) ));
 			OgreNewt::Body* body = new OgreNewt::Body( m_World, col );
 
 			Ogre::Vector3 inertia, offset;
             col-&gt;calculateInertialMatrix(inertia, offset);
 			body-&gt;setMassMatrix( 10.0, 10.0*inertia );
+            body-&gt;setCenterOfMass(offset);
 			body-&gt;attachNode( node );
 			body-&gt;setStandardForceCallback();
 			body-&gt;setPositionOrientation( pos, camorient );
 			body-&gt;setVelocity( (dir * 50.0) );
 
 			timer = 0.2;
+
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+            delete col;
+#endif
 		}
 	}
 	timer -= evt.timeSinceLastFrame;

Modified: dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.cpp
===================================================================
--- dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -8,7 +8,11 @@
 	mParent = parent;
 	mOgreBone = ogreBone;
 
-	OgreNewt::ConvexCollision* col = NULL;
+#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
+	OgreNewt::ConvexCollisionPtr col;
+#else
+	OgreNewt::ConvexCollisionPtr col = NULL;
+#endif
 
 	// in the case of the cylindrical primitives, they need to be rotated to align the main axis with the direction vector.
 	Ogre::Quaternion orient = Ogre::Quaternion::IDENTITY;
@@ -32,23 +36,23 @@
 	switch (shape)
 	{
 	case RagDoll::RagBone::BS_BOX:
-		col = new OgreNewt::CollisionPrimitives::Box( world, size );
+		col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Box( world, size ));
 		break;
 
 	case RagDoll::RagBone::BS_CAPSULE:
-		col = new OgreNewt::CollisionPrimitives::Capsule( world, size.y, size.x, orient, pos );
+		col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Capsule( world, size.y, size.x, orient, pos ));
 		break;
 
 	case RagDoll::RagBone::BS_CONE:
-		col = new OgreNewt::CollisionPrimitives::Cone( world, size.y, size.x, orient, pos );
+		col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Cone( world, size.y, size.x, orient, pos ));
 		break;
 
 	case RagDoll::RagBone::BS_CYLINDER:
-		col = new OgreNewt::CollisionPrimitives::Cylinder( world, size.y, size.x, orient, pos );
+		col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Cylinder( world, size.y, size.x, orient, pos ));
 		break;
 
 	case RagDoll::RagBone::BS_ELLIPSOID:
-		col = new OgreNewt::CollisionPrimitives::Ellipsoid( world, size );
+		col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Ellipsoid( world, size ));
 		break;
 
 	case RagDoll::RagBone::BS_CONVEXHULL:
@@ -56,24 +60,31 @@
 		break;
 
 	default:
-		col = new OgreNewt::CollisionPrimitives::Box( world, size );
+		col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::Box( world, size ));
 		break;
 	}
 
 	mBody = new OgreNewt::Body( world, col );
-	mBody-&gt;setUserData( this );
+#ifdef OGRENEWT_USE_OGRE_ANY
+	mBody-&gt;setUserData( Ogre::Any(this) );
+#else
+    mBody-&gt;setUserData( this );
+#endif
 	mBody-&gt;setStandardForceCallback();
 
 	Ogre::Vector3 inertia;
-	Ogre::Vector3 com;
-	col-&gt;calculateInertialMatrix( inertia, com );
+	Ogre::Vector3 offset;
+	col-&gt;calculateInertialMatrix( inertia, offset );
 	
 	mBody-&gt;setMassMatrix( mass, inertia * mass );
-	mBody-&gt;setCenterOfMass( com );
+	mBody-&gt;setCenterOfMass( offset );
 
 	mBody-&gt;setCustomTransformCallback( RagDoll::_placementCallback );
 
 
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+    delete col;
+#endif
 }
 
 
@@ -86,7 +97,11 @@
 
 void RagDoll::RagBone::_hingeCallback( OgreNewt::BasicJoints::Hinge* me )
 {
+#ifdef OGRENEWT_USE_OGRE_ANY
+	RagDoll::RagBone* bone = Ogre::any_cast&lt;RagDoll::RagBone*&gt;(me-&gt;getUserData());
+#else
 	RagDoll::RagBone* bone = (RagDoll::RagBone*)me-&gt;getUserData();
+#endif
 
 	Ogre::Degree angle = me-&gt;getJointAngle();
 	Ogre::Degree lim1( bone-&gt;getLimit1() );
@@ -107,7 +122,7 @@
 }
 
 
-OgreNewt::ConvexCollision* RagDoll::RagBone::_makeConvexHull( OgreNewt::World* world, Ogre::MeshPtr mesh, Ogre::Real minWeight )
+OgreNewt::ConvexCollisionPtr RagDoll::RagBone::_makeConvexHull( OgreNewt::World* world, Ogre::MeshPtr mesh, Ogre::Real minWeight )
 {
 	std::vector&lt; Ogre::Vector3 &gt; vertexVector;
 
@@ -197,7 +212,7 @@
 	}
 
 	//////////////////////////////////////////////////////////////////////////////////
-	OgreNewt::ConvexCollision* col = new OgreNewt::CollisionPrimitives::ConvexHull( world, verts, numVerts );
+	OgreNewt::ConvexCollisionPtr col = OgreNewt::ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::ConvexHull( world, verts, numVerts ));
 
 	delete []verts;
 
@@ -390,7 +405,11 @@
 	case RagDoll::JT_HINGE:
 		joint = new OgreNewt::BasicJoints::Hinge( child-&gt;getBody()-&gt;getWorld(), child-&gt;getBody(), parent-&gt;getBody(), pos, pin );
 		((OgreNewt::BasicJoints::Hinge*)joint)-&gt;setCallback( RagBone::_hingeCallback );
-		joint-&gt;setUserData( child );
+#ifdef OGRENEWT_USE_OGRE_ANY
+	joint-&gt;setUserData( Ogre::Any(child) );
+#else
+	joint-&gt;setUserData( child );
+#endif
 		child-&gt;setLimits( limit1, limit2 );
 		break;
 	}
@@ -400,7 +419,11 @@
 
 void RagDoll::_placementCallback( OgreNewt::Body* me, const Ogre::Quaternion&amp; orient, const Ogre::Vector3&amp; pos, int threadindex )
 {
+#ifdef OGRENEWT_USE_OGRE_ANY
+	RagDoll::RagBone* bone = Ogre::any_cast&lt;RagDoll::RagBone*&gt;(me-&gt;getUserData());
+#else
 	RagDoll::RagBone* bone = (RagDoll::RagBone*)me-&gt;getUserData();
+#endif
 	RagDoll* doll = bone-&gt;getDoll();
 
 	// is this the root bone?

Modified: dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.h
===================================================================
--- dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/demos/Demo08_RagdollExample/Ragdoll.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -63,7 +63,7 @@
 
 	private:
 
-		OgreNewt::ConvexCollision* _makeConvexHull( OgreNewt::World* world, Ogre::MeshPtr mesh, Ogre::Real minWeight );
+		OgreNewt::ConvexCollisionPtr _makeConvexHull( OgreNewt::World* world, Ogre::MeshPtr mesh, Ogre::Real minWeight );
 
 		// pointer to the doll to which this bone belongs.
 		RagDoll* mDoll;

Modified: dependencies/OgreNewt/inc/OgreNewt.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -64,13 +64,14 @@
             - joints
             - collision-serializer
             - treecollision raycastcallback 
-        - shared pointers for collisions (atm CollisionPtr := Collision*, but should be Ogre::SharedPtr&lt;Collision&gt;, but there was some problem...)
 
 
     \section new New in this version
 
     New in this version
         - this version uses cmake &gt; 2.6.2!
+        - shared pointers for collisions, in order to use shared pointers define OGRENEWT_COLLISION_USE_SHAREDPTR
+        - support for Ogre::Any instead of void* as userdata, in order to use it, define OGRENEWT_USE_OGRE_ANY
         - several interface-breaking changes:
             - the ContactCallback passes a ContactJoint as argument that can be used to iterate through all contacts
               (the callback is not called for each contact any more, but for each pair of colliding bodies!)

Modified: dependencies/OgreNewt/inc/OgreNewt_BasicFrameListener.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_BasicFrameListener.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_BasicFrameListener.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -29,9 +29,7 @@
 namespace OgreNewt
 {
 
-class World;
 
-
 //! simple frame listener to update the physics.
 /*!
     updates the Newton World at the specified rate, with time-slicing, and

Modified: dependencies/OgreNewt/inc/OgreNewt_Body.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Body.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_Body.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -20,17 +20,12 @@
 #include &quot;OgreNewt_Prerequisites.h&quot;
 #include &quot;OgreNewt_MaterialID.h&quot;
 #include &quot;OgreNewt_Collision.h&quot;
-#include &lt;boost/function.hpp&gt;
-#include &lt;boost/bind.hpp&gt;
 
 
 // OgreNewt namespace.  all functions and classes use this namespace.
 namespace OgreNewt
 {
 
-class World;
-class MaterialID;
-
 /*
     CLASS DEFINITION:
 
@@ -82,7 +77,7 @@
         \param col pointer to an OgreNewt::Collision object that represents the shape of the rigid body.
         \param bodytype simple integer value used to identify the type of rigid body, useful for determining bodies in callbacks.
     */
-    Body( const World* W, const OgreNewt::Collision* col, int bodytype = 0 );
+    Body( const World* W, const OgreNewt::CollisionPtr&amp; col, int bodytype = 0 );
 
     //! destructor
     ~Body();
@@ -92,10 +87,18 @@
         you can use this to store a pointer to a parent class, etc.  then inside one of the many callbacks, you can get the pointer
         using this &quot;userData&quot; system.
     */
+#ifdef OGRENEWT_USE_OGRE_ANY
+    void setUserData( const Ogre::Any&amp; data ) { m_userdata = data; }
+#else
     void setUserData( void* data ) { m_userdata = data; }
+#endif
 
     //! retrieve pointer to previously set user data.
+#ifdef OGRENEWT_USE_OGRE_ANY
+    const Ogre::Any&amp; getUserData() const { return m_userdata; }
+#else
     void* getUserData() const { return m_userdata; }
+#endif
 
     //! get a pointer to the NewtonBody object
     /*!
@@ -260,7 +263,7 @@
         This can be used to change the collision shape of a body mid-simulation.  for example making the collision for a character smaller when crouching, etc.
         \param col pointer to the new OgreNewt::Collision shape.
     */
-    void setCollision( const OgreNewt::Collision* col );
+    void setCollision( const OgreNewt::CollisionPtr&amp; col );
 
     //! set whether the body should &quot;sleep&quot; when equilibruim is reached.
     /*!
@@ -275,7 +278,7 @@
     //void setFreezeThreshold( Ogre::Real speed, Ogre::Real omega, int framecount ) { NewtonBodySetFreezeTreshold( m_body, (float)speed, (float)omega, framecount ); }
 
     //! get a pointer to the OgreNewt::Collision for this body
-    const OgreNewt::Collision* getCollision() const;
+    const OgreNewt::CollisionPtr&amp; getCollision() const;
 
     //! get a pointer to the Material assigned to this body.
     const OgreNewt::MaterialID* getMaterialGroupID() const;
@@ -398,7 +401,7 @@
     /*!
      * usually it is also possible to get this via: body-&gt;getCollision()-&gt;getCollisionPrimitiveType()
     */
-    CollisionPrimitive getCollisionPrimitiveType() const { return Collision::getCollisionPrimitiveType(getNewtonCollision()); }
+    CollisionPrimitiveType getCollisionPrimitiveType() const { return Collision::getCollisionPrimitiveType(getNewtonCollision()); }
 
     //! Returns the Newton Collision for this Body
     /*!
@@ -408,20 +411,23 @@
 
 protected:
 
-    NewtonBody*         m_body;
-    const Collision*    m_collision;
-    const MaterialID*   m_matid;
-    const World*        m_world;
+    NewtonBody*                     m_body;
+    OgreNewt::CollisionPtr          m_collision;
+    const MaterialID*               m_matid;
+    const World*                    m_world;
     
-
-    void*               m_userdata;
+#ifdef OGRENEWT_USE_OGRE_ANY
+    Ogre::Any                       m_userdata;
+#else
+    void*                           m_userdata;
+#endif
     
-    int                 m_type;
-    Ogre::Node*         m_node;
+    int                             m_type;
+    Ogre::Node*                     m_node;
 
-    ForceCallback           m_forcecallback;
-    TransformCallback       m_transformcallback;
-    buoyancyPlaneCallback   m_buoyancycallback;
+    ForceCallback                   m_forcecallback;
+    TransformCallback               m_transformcallback;
+    buoyancyPlaneCallback           m_buoyancycallback;
 
 private:
 

Modified: dependencies/OgreNewt/inc/OgreNewt_BodyInAABBIterator.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_BodyInAABBIterator.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_BodyInAABBIterator.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -15,17 +15,12 @@
 
 
 #include &quot;OgreNewt_Prerequisites.h&quot;
-#include &lt;boost/function.hpp&gt;
-#include &lt;boost/bind.hpp&gt;
 
 // OgreNewt namespace.  all functions and classes use this namespace.
 namespace OgreNewt
 {
 
-class World;
-class Body;
 
-
 //! Iterate through all bodies in a specific AABB in the world.
 /*!
     this class is an easy way to loop through all bodies in an AABB in the world, performing some kind of action.

Modified: dependencies/OgreNewt/inc/OgreNewt_Collision.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Collision.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_Collision.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -14,30 +14,28 @@
 
 
 #include &quot;OgreNewt_Prerequisites.h&quot;
-#include &quot;OgreNewt_World.h&quot;
-#include &quot;OgreNewt_CollisionSerializer.h&quot;
 
+
 // OgreNewt namespace.  all functions and classes use this namespace.
 namespace OgreNewt
 {
 
-class World;
 
-enum _OgreNewtExport CollisionPrimitive
+enum _OgreNewtExport CollisionPrimitiveType
 {
-    BoxPrimitive                =   SERIALIZE_ID_BOX,
-    ConePrimitive               =   SERIALIZE_ID_CONE,
-    EllipsoidPrimitive          =   SERIALIZE_ID_SPHERE,
-    CapsulePrimitive            =   SERIALIZE_ID_CAPSULE,
-    CylinderPrimitive           =   SERIALIZE_ID_CYLINDER,
-    CompoundCollisionPrimitive  =   SERIALIZE_ID_COMPOUND,
-    ConvexHullPrimitive         =   SERIALIZE_ID_CONVEXHULL,
-    ConvexHullModifierPrimitive =   SERIALIZE_ID_CONVEXMODIFIER,
-    ChamferCylinderPrimitive    =   SERIALIZE_ID_CHAMFERCYLINDER,
-    TreeCollisionPrimitive      =   SERIALIZE_ID_TREE,
-    NullPrimitive               =   SERIALIZE_ID_NULL,
-    HeighFieldPrimitive         =   SERIALIZE_ID_HEIGHTFIELD,
-    ScenePrimitive              =   SERIALIZE_ID_SCENE
+    BoxPrimitiveType                =   SERIALIZE_ID_BOX,
+    ConePrimitiveType               =   SERIALIZE_ID_CONE,
+    EllipsoidPrimitiveType          =   SERIALIZE_ID_SPHERE,
+    CapsulePrimitiveType            =   SERIALIZE_ID_CAPSULE,
+    CylinderPrimitiveType           =   SERIALIZE_ID_CYLINDER,
+    CompoundCollisionPrimitiveType  =   SERIALIZE_ID_COMPOUND,
+    ConvexHullPrimitiveType         =   SERIALIZE_ID_CONVEXHULL,
+    ConvexHullModifierPrimitiveType =   SERIALIZE_ID_CONVEXMODIFIER,
+    ChamferCylinderPrimitiveType    =   SERIALIZE_ID_CHAMFERCYLINDER,
+    TreeCollisionPrimitiveType      =   SERIALIZE_ID_TREE,
+    NullPrimitiveType               =   SERIALIZE_ID_NULL,
+    HeighFieldPrimitiveType         =   SERIALIZE_ID_HEIGHTFIELD,
+    ScenePrimitiveType              =   SERIALIZE_ID_SCENE
 };
 
 /*
@@ -82,20 +80,21 @@
     unsigned getUserID() const { return NewtonCollisionGetUserID( m_col ); }
 
     //! make unique
-    void makeUnique() { NewtonCollisionMakeUnique( m_world-&gt;getNewtonWorld(), m_col ); }
+    void makeUnique();
 
     //! get the Axis-Aligned Bounding Box for this collision shape.
     Ogre::AxisAlignedBox getAABB( const Ogre::Quaternion&amp; orient = Ogre::Quaternion::IDENTITY, const Ogre::Vector3&amp; pos = Ogre::Vector3::ZERO ) const;
 
     //! Returns the Collisiontype for this Collision
-    CollisionPrimitive getCollisionPrimitiveType() const { return getCollisionPrimitiveType( m_col ); } 
+    CollisionPrimitiveType getCollisionPrimitiveType() const { return getCollisionPrimitiveType( m_col ); } 
 
     //! Returns the Collisiontype for the given Newton-Collision
-    static CollisionPrimitive getCollisionPrimitiveType(const NewtonCollision *col);
+    static CollisionPrimitiveType getCollisionPrimitiveType(const NewtonCollision *col);
 
     //! friend functions for the Serializer
-    friend void CollisionSerializer::exportCollision(const Collision* collision, const Ogre::String&amp; filename);
-    friend void CollisionSerializer::importCollision(Ogre::DataStreamPtr&amp; stream, Collision* pDest);
+    friend class OgreNewt::CollisionSerializer;
+    //friend void CollisionSerializer::exportCollision(const CollisionPtr&amp; collision, const Ogre::String&amp; filename);
+    //friend CollisionPtr CollisionSerializer::importCollision(Ogre::DataStreamPtr&amp; stream, OgreNewt::World* world);
 
 protected:
 
@@ -104,9 +103,8 @@
 
 };
 
-//typedef Ogre::SharedPtr&lt;Collision&gt; CollisionPtr;
-typedef Collision* CollisionPtr;
 
+
 //! represents a collision shape that is explicitly convex.
 class _OgreNewtExport ConvexCollision : public Collision
 {
@@ -135,14 +133,31 @@
 };
 
 
+#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
+typedef boost::shared_ptr&lt;Collision&gt; CollisionPtr;
+typedef boost::shared_ptr&lt;ConvexCollision&gt; ConvexCollisionPtr;
+#else
+typedef Collision* CollisionPtr;
+typedef ConvexCollision* ConvexCollisionPtr;
+#endif
 
+
+
+
 //! represents a scalable collision shape.
-class _OgreNewtExport ConvexModifierCollision : public Collision
+class _OgreNewtExport ConvexModifierCollision : public ConvexCollision
 {
 public:
     //! constructor
-    ConvexModifierCollision( const OgreNewt::World* world, const OgreNewt::Collision* col );
+    /*!
+      Create a 'blank' box collision object.  Can be used for CollisionSerializer::importCollision
+      \param world pointer to the OgreNewt::World
+    */
+    ConvexModifierCollision( const OgreNewt::World* world );
 
+    //! constructor
+    ConvexModifierCollision( const OgreNewt::World* world, const OgreNewt::ConvexCollisionPtr col );
+
     //! destructor
     ~ConvexModifierCollision();
 

Modified: dependencies/OgreNewt/inc/OgreNewt_CollisionPrimitives.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_CollisionPrimitives.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_CollisionPrimitives.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -388,7 +388,7 @@
                 \param world pointer to the OgreNewt::World
                 \param col_array std::vector of pointers to existing collision objects.
             */
-            CompoundCollision( const World* world, std::vector&lt;OgreNewt::Collision*&gt; col_array );
+            CompoundCollision( const World* world, std::vector&lt;OgreNewt::CollisionPtr&gt; col_array );
 
             //! destructor
             ~CompoundCollision() {}

Modified: dependencies/OgreNewt/inc/OgreNewt_CollisionSerializer.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_CollisionSerializer.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_CollisionSerializer.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -14,12 +14,11 @@
 
 
 #include &quot;OgreNewt_Prerequisites.h&quot;
+#include &quot;OgreNewt_Collision.h&quot;
 
 // OgreNewt namespace.  all functions and classes use this namespace.
 namespace OgreNewt
 {
-    class Collision;
-
   /*!
   This class can be used to (de)serialize a Collision. Pre-building a Collision and serializing from a tool,
   then deserializing it at runtime may be more efficient than building the Collision on the fly, especially for complex objects.
@@ -37,13 +36,13 @@
     /*!
     Serialize the Collision to a file with the given name.
     */
-    void exportCollision(const Collision* collision, const Ogre::String&amp; filename);
+    void exportCollision(const OgreNewt::CollisionPtr&amp; collision, const Ogre::String&amp; filename);
 
     /*!
     Deserialize the Collision from a DataStream.
     this will create a NEW Collision object
     */
-    void importCollision(Ogre::DataStreamPtr&amp; stream, Collision* pDest);
+    OgreNewt::CollisionPtr importCollision(Ogre::DataStreamPtr&amp; stream, OgreNewt::World* world);
 
   private:
     /*!

Modified: dependencies/OgreNewt/inc/OgreNewt_ContactCallback.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_ContactCallback.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_ContactCallback.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -20,7 +20,6 @@
 namespace OgreNewt
 {
 
-class Body;
 
 //! custom contact behavior
 /*!

Modified: dependencies/OgreNewt/inc/OgreNewt_ContactJoint.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_ContactJoint.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_ContactJoint.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -20,8 +20,6 @@
 namespace OgreNewt
 {
 
-class Contact;
-class MaterialPair;
 
 //! with this class you can iterate through all contacts
 /*!

Modified: dependencies/OgreNewt/inc/OgreNewt_Debugger.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Debugger.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_Debugger.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -25,10 +25,6 @@
 namespace OgreNewt
 {
 
-    class World;
-    class Body;
-    class MaterialID;
-    class Collision;
 
     //! For viewing the Newton rigid bodies visually.
     /*!
@@ -90,7 +86,7 @@
         void addRay(const Ogre::Vector3 &amp;startpt, const Ogre::Vector3 &amp;endpt);
 
         //! this function is used internally
-        void addConvexRay(const OgreNewt::Collision* col, const Ogre::Vector3 &amp;startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3 &amp;endpt);
+        void addConvexRay(const OgreNewt::ConvexCollisionPtr&amp; col, const Ogre::Vector3 &amp;startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3 &amp;endpt);
 
         //! this function is used internally
         void addDiscardedBody(const OgreNewt::Body* body);
@@ -117,8 +113,12 @@
 
         struct BodyDebugData
         {
-            BodyDebugData() : m_lastcol(NULL), m_node(NULL), m_lines(NULL), m_text(NULL), m_updated(false) {}
-            const Collision* m_lastcol;
+            BodyDebugData() :
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
+                m_lastcol(NULL),
+#endif
+                m_node(NULL), m_lines(NULL), m_text(NULL), m_updated(false) {}
+            CollisionPtr m_lastcol;
             Ogre::SceneNode* m_node;
             Ogre::ManualObject* m_lines;
             OgreNewt::OgreAddons::MovableText* m_text;

Modified: dependencies/OgreNewt/inc/OgreNewt_Joint.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Joint.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_Joint.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -20,8 +20,6 @@
 namespace OgreNewt
 {
 
-class World;
-class Body;
 
 //! base class for all joints.
 /*!
@@ -71,22 +69,35 @@
     /*!
         user data can be used to connect this class to other user classes through the use of this general pointer.
     */
-    void setUserData( void* ptr ) { m_userdata = ptr; }
+#ifdef OGRENEWT_USE_OGRE_ANY
+    void setUserData( const Ogre::Any&amp; data ) { m_userdata = data; }
+#else
+    void setUserData( void* data ) { m_userdata = data; }
+#endif
 
     //! get user data for this joint
     /*!
         user data can be used to connect this class to other user classes through the use of this general pointer.
     */
+#ifdef OGRENEWT_USE_OGRE_ANY
+    const Ogre::Any&amp; getUserData() const { return m_userdata; }
+#else
     void* getUserData() const { return m_userdata; }
+#endif
 
-        
+ 
 protected:
 
     NewtonJoint* m_joint;
     const OgreNewt::World* m_world;
 
-    void* m_userdata;
 
+#ifdef OGRENEWT_USE_OGRE_ANY
+    Ogre::Any                       m_userdata;
+#else
+    void*                           m_userdata;
+#endif
+
     static void _CDECL destructor( const NewtonJoint* me );
 
 };

Modified: dependencies/OgreNewt/inc/OgreNewt_MaterialID.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_MaterialID.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_MaterialID.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -19,7 +19,6 @@
 namespace OgreNewt
 {
 
-class World;
 
 //! represents a material
 class _OgreNewtExport MaterialID

Modified: dependencies/OgreNewt/inc/OgreNewt_PlayerController.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_PlayerController.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_PlayerController.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -21,9 +21,6 @@
 namespace OgreNewt
 {
 
-class Collision;
-class ConvexCollision;
-
 //! PlayerController
 /*!
     this class implements a player-controller based on the code of the CustomPlayerController-class in the Newton-CustomJoints library
@@ -85,9 +82,9 @@
     Ogre::Vector3 m_upVector;
 
     bool m_isInJumpState;
-    OgreNewt::ConvexCollision* m_verticalSensorShape;
-    OgreNewt::ConvexCollision* m_horizontalSensorShape;
-    OgreNewt::ConvexCollision* m_dynamicsSensorShape;
+    OgreNewt::ConvexCollisionPtr m_verticalSensorShape;
+    OgreNewt::ConvexCollisionPtr m_horizontalSensorShape;
+    OgreNewt::ConvexCollisionPtr m_dynamicsSensorShape;
 
     virtual bool convexStaticCastPreFilter(OgreNewt::Body *body);
     virtual bool convexDynamicCastPreFilter(OgreNewt::Body *body);
@@ -133,7 +130,7 @@
         public:
             StaticConvexCast(PlayerController *pc) : m_parent(pc) {}
 
-            void go(const OgreNewt::Collision* col, const Ogre::Vector3&amp; startpt,
+            void go(const OgreNewt::ConvexCollisionPtr&amp; col, const Ogre::Vector3&amp; startpt,
                     const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int thread)
             {
                 go(m_parent-&gt;getControlledBody()-&gt;getWorld(), col, startpt, colori, endpt, maxcontactscount, thread);
@@ -150,7 +147,7 @@
         public:
             DynamicConvexCast(PlayerController *pc) : m_parent(pc) {}
 
-            void go(const OgreNewt::Collision* col, const Ogre::Vector3&amp; startpt,
+            void go(const OgreNewt::ConvexCollisionPtr&amp; col, const Ogre::Vector3&amp; startpt,
                     const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int thread)
             {
                 go(m_parent-&gt;getControlledBody()-&gt;getWorld(), col, startpt, colori, endpt, maxcontactscount, thread);
@@ -167,7 +164,7 @@
         public:
             AllBodyConvexCast(PlayerController *pc) : m_parent(pc) {}
 
-            void go(const OgreNewt::Collision* col, const Ogre::Vector3&amp; startpt,
+            void go(const OgreNewt::ConvexCollisionPtr&amp; col, const Ogre::Vector3&amp; startpt,
                     const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int thread)
             {
                 go(m_parent-&gt;getControlledBody()-&gt;getWorld(), col, startpt, colori, endpt, maxcontactscount, thread);

Modified: dependencies/OgreNewt/inc/OgreNewt_Prerequisites.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Prerequisites.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_Prerequisites.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -22,6 +22,12 @@
 #   include &lt;Ogre/OgreRenderable.h&gt;
 #   include &lt;Ogre/OgreNode.h&gt;
 #   include &lt;Ogre/OgreFrameListener.h&gt;
+#   ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
+//#       include &lt;Ogre/OgreSharedPtr.h&gt;
+#   endif
+#   ifdef OGRENEWT_USE_OGRE_ANY
+#       include &lt;Ogre/OgreAny.h&gt;
+#   endif
 #else
 #include &lt;OgreVector3.h&gt;
 #include &lt;OgreQuaternion.h&gt;
@@ -29,9 +35,20 @@
 #include &lt;OgreRenderable.h&gt;
 #include &lt;OgreNode.h&gt;
 #include &lt;OgreFrameListener.h&gt;
+#   ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
+//#       include &lt;OgreSharedPtr.h&gt;
+#   endif
+#   ifdef OGRENEWT_USE_OGRE_ANY
+#       include &lt;OgreAny.h&gt;
+#   endif
 #endif
 
 #include &lt;Newton.h&gt;
+#include &lt;boost/function.hpp&gt;
+#include &lt;boost/bind.hpp&gt;
+#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
+#   include &lt;boost/shared_ptr.hpp&gt;
+#endif
 
 #if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
 #   define _CDECL _cdecl
@@ -47,5 +64,28 @@
 #   define _CDECL
 #endif
 
+
+#ifdef OGRENEWT_COLLISION_USE_SHAREDPTR
+#warning &quot;the option OGRENEWT_COLLISION_USE_SHAREDPTR is set&quot;
+#endif
+
+#ifdef OGRENEWT_USE_OGRE_ANY
+#warning &quot;the option OGRENEWT_USE_OGRE_ANY is set&quot;
+#endif
+
+namespace OgreNewt
+{
+    class World;
+    class MaterialID;
+    class Joint;
+    class Contact;
+    class MaterialPair;
+    class Body;
+    class Collision;
+    class CollisionSerializer;
+    class ConvexCollision;
+    class Debugger;
+}
+
 #endif 
 

Modified: dependencies/OgreNewt/inc/OgreNewt_RayCast.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_RayCast.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_RayCast.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -21,8 +21,6 @@
 namespace OgreNewt
 {
 
-class World;
-class Body;
 
 //! general raycast
 /*!
@@ -186,7 +184,7 @@
         \param maxcontactscount maximum number of contacts that should be saved,
                set to 0 if you only need the distance to the first intersection
     */
-    void go( const OgreNewt::World* world, const OgreNewt::Collision* col, const Ogre::Vector3&amp; startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int threadIndex);
+    void go( const OgreNewt::World* world, const OgreNewt::ConvexCollisionPtr&amp; col, const Ogre::Vector3&amp; startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int threadIndex);
 
     //! user callback pre-filter function.
     /*!
@@ -254,7 +252,7 @@
         \param endpt ending point of ray in global space
         \param maxcontactscount maximum number of contacts that should be saved        
     */
-    BasicConvexcast( const OgreNewt::World* world, const OgreNewt::Collision* col, const Ogre::Vector3&amp; startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int threadIndex);
+    BasicConvexcast( const OgreNewt::World* world, const OgreNewt::ConvexCollisionPtr&amp; col, const Ogre::Vector3&amp; startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int threadIndex);
 
     //! destuctor.
     ~BasicConvexcast();

Modified: dependencies/OgreNewt/inc/OgreNewt_Tools.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Tools.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_Tools.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -14,12 +14,12 @@
 
 
 #include &quot;OgreNewt_Prerequisites.h&quot;
+#include &quot;OgreNewt_Collision.h&quot;
 
 namespace OgreNewt
 {
-    class World;
-    class Collision;
 
+
     //! set of handy convertors.
     namespace Converters
     {
@@ -70,7 +70,7 @@
             \param retnormal returned normal on the collision primitive in global space
         */
         _OgreNewtExport int CollisionPointDistance( const OgreNewt::World* world, const Ogre::Vector3&amp; globalpt, 
-                                    const OgreNewt::Collision* col, const Ogre::Quaternion&amp; colorient, const Ogre::Vector3&amp; colpos, 
+                                    const OgreNewt::CollisionPtr&amp; col, const Ogre::Quaternion&amp; colorient, const Ogre::Vector3&amp; colpos, 
                                     Ogre::Vector3&amp; retpt, Ogre::Vector3&amp; retnormal, int threadIndex );
                                     
 
@@ -88,8 +88,8 @@
             \param retPosB returned position on collision primitive B
             \param retNorm returned collision normal
         */
-        _OgreNewtExport int CollisionClosestPoint( const OgreNewt::World* world, const OgreNewt::Collision* colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA,
-                                                            const OgreNewt::Collision* colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB,
+        _OgreNewtExport int CollisionClosestPoint( const OgreNewt::World* world, const OgreNewt::CollisionPtr&amp; colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA,
+                                                            const OgreNewt::CollisionPtr&amp; colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB,
                                                             Ogre::Vector3&amp; retPosA, Ogre::Vector3&amp; retPosB, Ogre::Vector3&amp; retNorm, int threadIndex );
 
 
@@ -110,8 +110,8 @@
             \param retPenetrations returned penetrations for each contact.
         */
         _OgreNewtExport int CollisionCollide(  const OgreNewt::World* world, int maxSize, 
-            const OgreNewt::Collision* colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA,
-            const OgreNewt::Collision* colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB,
+            const OgreNewt::CollisionPtr&amp; colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA,
+            const OgreNewt::CollisionPtr&amp; colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB,
             Ogre::Vector3* retContactPts, Ogre::Vector3* retNormals, Ogre::Real* retPenetrations, int threadIndex );
 
 
@@ -137,8 +137,8 @@
             \param retPenetrations returned penetrations for each contact.
         */
         _OgreNewtExport int CollisionCollideContinue( const OgreNewt::World* world, int maxSize, Ogre::Real timeStep,
-            const OgreNewt::Collision* colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA, const Ogre::Vector3&amp; colVelA, const Ogre::Vector3&amp; colOmegaA,
-            const OgreNewt::Collision* colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB, const Ogre::Vector3&amp; colVelB, const Ogre::Vector3&amp; colOmegaB,
+            const OgreNewt::CollisionPtr&amp; colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA, const Ogre::Vector3&amp; colVelA, const Ogre::Vector3&amp; colOmegaA,
+            const OgreNewt::CollisionPtr&amp; colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB, const Ogre::Vector3&amp; colVelB, const Ogre::Vector3&amp; colOmegaB,
             Ogre::Real&amp; retTimeOfImpact, Ogre::Vector3* retContactPts, Ogre::Vector3* retNormals, Ogre::Real* retPenetrations, int threadIndex );
 
 
@@ -152,7 +152,7 @@
             \param normal returned normal where the ray hit the collision.
             \param colID returned ID of the collision primitive hit.
         */
-        _OgreNewtExport Ogre::Real CollisionRayCast( const OgreNewt::Collision* col, const Ogre::Vector3&amp; startPt, const Ogre::Vector3&amp; endPt, 
+        _OgreNewtExport Ogre::Real CollisionRayCast( const OgreNewt::CollisionPtr&amp; col, const Ogre::Vector3&amp; startPt, const Ogre::Vector3&amp; endPt, 
                                                         Ogre::Vector3&amp; retNorm, int&amp; retColID );
                 
 
@@ -163,7 +163,7 @@
             \param orient world orientation of the collision.
             \param pos world position of the collision.
         */
-        _OgreNewtExport Ogre::AxisAlignedBox CollisionCalculateAABB( const OgreNewt::Collision* col, const Ogre::Quaternion&amp; orient, const Ogre::Vector3&amp; pos );
+        _OgreNewtExport Ogre::AxisAlignedBox CollisionCalculateAABB( const OgreNewt::CollisionPtr&amp; col, const Ogre::Quaternion&amp; orient, const Ogre::Vector3&amp; pos );
 
     }   // end namespace &quot;ColliionTools&quot;
 

Modified: dependencies/OgreNewt/inc/OgreNewt_Vehicle.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_Vehicle.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_Vehicle.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -18,8 +18,8 @@
 
 namespace OgreNewt
 {
-    class Body;
-    class World;
+
+
 #ifdef INCLUDE_VEHICLE
 //! Represents a wheeled vehicle
 /*!

Modified: dependencies/OgreNewt/inc/OgreNewt_World.h
===================================================================
--- dependencies/OgreNewt/inc/OgreNewt_World.h	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/inc/OgreNewt_World.h	2009-04-07 22:24:33 UTC (rev 4889)
@@ -15,8 +15,6 @@
 #include &quot;OgreNewt_Prerequisites.h&quot;
 #include &quot;OgreNewt_BodyInAABBIterator.h&quot;
 #include &quot;OgreNewt_Debugger.h&quot;
-#include &lt;boost/function.hpp&gt;
-#include &lt;boost/bind.hpp&gt;
 
 //! main namespace.
 /*!
@@ -26,10 +24,6 @@
 {
 
 
-class Body;
-class MaterialID;
-
-
 //! represents a physics world.
 /*!
     this class represents a NewtonWorld, which is the basic space in which physics elements can exist.  It can have various Rigid Bodies, connected by joints, and other constraints.

Modified: dependencies/OgreNewt/src/OgreNewt_Body.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_Body.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/src/OgreNewt_Body.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -8,7 +8,7 @@
 {
 
     
-Body::Body( const World* W, const OgreNewt::Collision* col, int bodytype ) 
+Body::Body( const World* W, const OgreNewt::CollisionPtr&amp; col, int bodytype ) 
 {
     m_world = W;
     m_collision = col;
@@ -204,7 +204,7 @@
 }
 
 //set collision
-void Body::setCollision( const OgreNewt::Collision* col )
+void Body::setCollision( const OgreNewt::CollisionPtr&amp; col )
 {
     NewtonBodySetCollision( m_body, col-&gt;getNewtonCollision() );
 
@@ -212,7 +212,7 @@
 }
 
 //get collision
-const OgreNewt::Collision* Body::getCollision() const
+const OgreNewt::CollisionPtr&amp; Body::getCollision() const
 {
     return m_collision;
 }

Modified: dependencies/OgreNewt/src/OgreNewt_Collision.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_Collision.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/src/OgreNewt_Collision.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -1,4 +1,5 @@
 #include &quot;OgreNewt_Collision.h&quot;
+#include &quot;OgreNewt_World.h&quot;
 #include &quot;OgreNewt_Tools.h&quot;
 
 
@@ -18,6 +19,12 @@
 }
 
 
+void Collision::makeUnique()
+{
+    NewtonCollisionMakeUnique( m_world-&gt;getNewtonWorld(), m_col );
+}
+
+
 Ogre::AxisAlignedBox Collision::getAABB( const Ogre::Quaternion&amp; orient, const Ogre::Vector3&amp; pos ) const
 {
     Ogre::AxisAlignedBox box;
@@ -34,13 +41,13 @@
     return box;
 }
 
-CollisionPrimitive Collision::getCollisionPrimitiveType(const NewtonCollision *col)
+CollisionPrimitiveType Collision::getCollisionPrimitiveType(const NewtonCollision *col)
 {
     NewtonCollisionInfoRecord *info = new NewtonCollisionInfoRecord();
 
     NewtonCollisionGetInfo( col, info );
 
-    return static_cast&lt;CollisionPrimitive&gt;(info-&gt;m_collisionType);
+    return static_cast&lt;CollisionPrimitiveType&gt;(info-&gt;m_collisionType);
 }
 
 
@@ -55,8 +62,13 @@
 
 
 
-ConvexModifierCollision::ConvexModifierCollision(const World* world, const Collision* col) : Collision(world)
+
+ConvexModifierCollision::ConvexModifierCollision(const World* world) : ConvexCollision(world)
 {
+}
+
+ConvexModifierCollision::ConvexModifierCollision(const World* world, const ConvexCollisionPtr col) : ConvexCollision(world)
+{
     m_col = NewtonCreateConvexHullModifier( world-&gt;getNewtonWorld(), col-&gt;getNewtonCollision() );
 }
 

Modified: dependencies/OgreNewt/src/OgreNewt_CollisionPrimitives.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_CollisionPrimitives.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/src/OgreNewt_CollisionPrimitives.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -1,6 +1,7 @@
 #include &quot;OgreNewt_CollisionPrimitives.h&quot;
 #include &quot;OgreNewt_Tools.h&quot;
 #include &quot;OgreNewt_RayCast.h&quot;
+#include &quot;OgreNewt_World.h&quot;
 
 #ifdef __APPLE__
 #   include &lt;Ogre/OgreEntity.h&gt;
@@ -719,7 +720,7 @@
         CompoundCollision::CompoundCollision(const World* world) : Collision( world )
         {}
         
-        CompoundCollision::CompoundCollision( const World* world, std::vector&lt;OgreNewt::Collision*&gt; col_array ) : Collision( world )
+        CompoundCollision::CompoundCollision( const World* world, std::vector&lt;OgreNewt::CollisionPtr&gt; col_array ) : Collision( world )
         {
             //get the number of elements.
             unsigned int num = col_array.size();

Modified: dependencies/OgreNewt/src/OgreNewt_CollisionSerializer.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_CollisionSerializer.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/src/OgreNewt_CollisionSerializer.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -1,5 +1,6 @@
 #include &quot;OgreNewt_CollisionSerializer.h&quot;
-#include &quot;OgreNewt_Collision.h&quot;
+#include &quot;OgreNewt_CollisionPrimitives.h&quot;
+#include &quot;OgreNewt_World.h&quot;
 
 namespace OgreNewt
 {
@@ -13,38 +14,76 @@
   }
 
 
-  void CollisionSerializer::exportCollision(const Collision* collision, const Ogre::String&amp; filename)
+  void CollisionSerializer::exportCollision(const CollisionPtr&amp; collision, const Ogre::String&amp; filename)
   {
-    if( collision )
+    if( !collision )
+        OGRE_EXCEPT(Ogre::Exception::ERR_INVALIDPARAMS, &quot;Argument collision is NULL&quot;,&quot;CollisionSerializer::exportCollision&quot;);
+
+    mpfFile=fopen(filename.c_str(),&quot;wb&quot;);
+    
+    if (!mpfFile)
     {
-        mpfFile=fopen(filename.c_str(),&quot;wb&quot;);
-    
-        if (!mpfFile)
-        {
-          OGRE_EXCEPT(Ogre::Exception::ERR_INVALIDPARAMS, &quot;Unable to open file &quot; + filename + &quot; for writing&quot;,&quot;CollisionSerializer::exportCollision&quot;);
-        }
-    
-        NewtonCollisionSerialize(collision-&gt;getWorld()-&gt;getNewtonWorld(), collision-&gt;m_col, &amp;CollisionSerializer::_newtonSerializeCallback, this);
+        OGRE_EXCEPT(Ogre::Exception::ERR_INVALIDPARAMS, &quot;Unable to open file &quot; + filename + &quot; for writing&quot;,&quot;CollisionSerializer::exportCollision&quot;);
+    }
 
-        fclose(mpfFile);
-    }
+    NewtonCollisionSerialize(collision-&gt;getWorld()-&gt;getNewtonWorld(), collision-&gt;m_col, &amp;CollisionSerializer::_newtonSerializeCallback, this);
+
+
+    fclose(mpfFile);
   }
 
 
-  void CollisionSerializer::importCollision(Ogre::DataStreamPtr&amp; stream, Collision* pDest)
+  CollisionPtr CollisionSerializer::importCollision(Ogre::DataStreamPtr&amp; stream, OgreNewt::World* world)
   {
-    if( pDest )
-    {
-        if( pDest-&gt;m_col )
-        {
-            // we need an error here!!
-            NewtonReleaseCollision(pDest-&gt;m_world-&gt;getNewtonWorld(), pDest-&gt;m_col);
-        }
+      CollisionPtr dest;
 
-        NewtonCollision* col = NewtonCreateCollisionFromSerialization(pDest-&gt;getWorld()-&gt;getNewtonWorld(), &amp;CollisionSerializer::_newtonDeserializeCallback, &amp;stream);
+      NewtonCollision* col = NewtonCreateCollisionFromSerialization(world-&gt;getNewtonWorld(), &amp;CollisionSerializer::_newtonDeserializeCallback, &amp;stream);
 
-        pDest-&gt;m_col = col;
-    }
+      // the type doesn't really matter... but lets do it correctly
+      switch( Collision::getCollisionPrimitiveType(col) )
+      {
+          case BoxPrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::Box(world));
+              break;
+          case ConePrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::Cone(world));
+              break;
+          case EllipsoidPrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::Ellipsoid(world));
+              break;
+          case CapsulePrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::Capsule(world));
+              break;
+          case CylinderPrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::Cylinder(world));
+              break;
+          case CompoundCollisionPrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::CompoundCollision(world));
+              break;
+          case ConvexHullPrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::ConvexHull(world));
+              break;
+          case ConvexHullModifierPrimitiveType:
+              dest = CollisionPtr(new ConvexModifierCollision(world));
+              break;
+          case ChamferCylinderPrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::ChamferCylinder(world));
+              break;
+          case TreeCollisionPrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::TreeCollision(world));
+              break;
+          case NullPrimitiveType:
+              dest = CollisionPtr(new CollisionPrimitives::Null(world));
+              break;
+          case HeighFieldPrimitiveType:
+          case ScenePrimitiveType:
+          default:
+              dest = CollisionPtr(new Collision(world));
+      }
+
+      dest-&gt;m_col = col;
+
+      return dest;
   }
 
 

Modified: dependencies/OgreNewt/src/OgreNewt_Debugger.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_Debugger.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/src/OgreNewt_Debugger.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -350,7 +350,7 @@
     m_raycastsnode-&gt;attachObject(line);    
 }
 
-void Debugger::addConvexRay(const OgreNewt::Collision* col, const Ogre::Vector3 &amp;startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3 &amp;endpt)
+void Debugger::addConvexRay(const OgreNewt::ConvexCollisionPtr&amp; col, const Ogre::Vector3 &amp;startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3 &amp;endpt)
 {
     if (!m_raycastsnode)
         return;

Modified: dependencies/OgreNewt/src/OgreNewt_PlayerController.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_PlayerController.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/src/OgreNewt_PlayerController.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -40,9 +40,11 @@
     m_floorFinderRadiusFactor = 1.0f;
     m_maxPlayerHeightPaddFactor = 0.01f;
     m_sensorShapeSegments = 32;
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
     m_verticalSensorShape = NULL;
     m_horizontalSensorShape = NULL;
     m_dynamicsSensorShape = NULL;
+#endif
 
 
     updateSensorShapes();
@@ -50,13 +52,14 @@
 
 PlayerController::~PlayerController()
 {
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
     if( m_verticalSensorShape )
         delete m_verticalSensorShape;
     if( m_horizontalSensorShape )
         delete m_horizontalSensorShape;
     if( m_dynamicsSensorShape )
-        delete m_dynamicsSensorShape
-;
+        delete m_dynamicsSensorShape;
+#endif
 }
 
 void PlayerController::updateSensorShapes()
@@ -83,6 +86,7 @@
         abs( newSensorHeight - m_lastSensorHeight ) &gt; 0.04f ||
         abs( newPlayerRadius - m_lastPlayerRadius ) &gt; 0.04f )
     {
+#ifndef OGRENEWT_COLLISION_USE_SHAREDPTR
         // delete old ones
         if( m_verticalSensorShape )
             delete m_verticalSensorShape;
@@ -90,6 +94,7 @@
             delete m_horizontalSensorShape;
         if( m_dynamicsSensorShape )
             delete m_dynamicsSensorShape;
+#endif
 
         m_lastPlayerRadius = newPlayerRadius;
         m_lastSensorHeight = newSensorHeight;
@@ -126,9 +131,9 @@
             horizontalSensorPoints[i + m_sensorShapeSegments].z =  horizontalSensorPoints[i].z;
         }
 
-        m_verticalSensorShape = new OgreNewt::CollisionPrimitives::ConvexHull(m_body-&gt;getWorld(), verticalSensorPoints, 2*m_sensorShapeSegments);
-        m_horizontalSensorShape = new OgreNewt::CollisionPrimitives::ConvexHull(m_body-&gt;getWorld(), horizontalSensorPoints, 2*m_sensorShapeSegments);
-        m_dynamicsSensorShape = new OgreNewt::CollisionPrimitives::ConvexHull(m_body-&gt;getWorld(), dynamicsSensorPoints, 2*m_sensorShapeSegments);
+        m_verticalSensorShape = ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::ConvexHull(m_body-&gt;getWorld(), verticalSensorPoints, 2*m_sensorShapeSegments));
+        m_horizontalSensorShape = ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::ConvexHull(m_body-&gt;getWorld(), horizontalSensorPoints, 2*m_sensorShapeSegments));
+        m_dynamicsSensorShape = ConvexCollisionPtr(new OgreNewt::CollisionPrimitives::ConvexHull(m_body-&gt;getWorld(), dynamicsSensorPoints, 2*m_sensorShapeSegments));
 
         delete[] dynamicsSensorPoints;
         delete[] verticalSensorPoints;

Modified: dependencies/OgreNewt/src/OgreNewt_RayCast.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_RayCast.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/src/OgreNewt_RayCast.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -191,7 +191,7 @@
         }
 
 
-    void Convexcast::go(const OgreNewt::World* world, const OgreNewt::Collision *col, const Ogre::Vector3&amp; startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int threadIndex)
+    void Convexcast::go(const OgreNewt::World* world, const OgreNewt::ConvexCollisionPtr&amp; col, const Ogre::Vector3&amp; startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int threadIndex)
     {
 
         if( world-&gt;getDebugger().isRaycastRecording() )
@@ -278,7 +278,7 @@
         {
         }
 
-    BasicConvexcast::BasicConvexcast(const OgreNewt::World* world, const OgreNewt::Collision *col, const Ogre::Vector3&amp; startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int threadIndex)
+    BasicConvexcast::BasicConvexcast(const OgreNewt::World* world, const OgreNewt::ConvexCollisionPtr&amp; col, const Ogre::Vector3&amp; startpt, const Ogre::Quaternion &amp;colori, const Ogre::Vector3&amp; endpt, int maxcontactscount, int threadIndex)
     {
         go( world, col, startpt, colori, endpt, maxcontactscount, threadIndex);
     }

Modified: dependencies/OgreNewt/src/OgreNewt_Tools.cpp
===================================================================
--- dependencies/OgreNewt/src/OgreNewt_Tools.cpp	2009-04-07 17:35:36 UTC (rev 4888)
+++ dependencies/OgreNewt/src/OgreNewt_Tools.cpp	2009-04-07 22:24:33 UTC (rev 4889)
@@ -1,7 +1,6 @@
 #include &quot;OgreNewt_Tools.h&quot;
 #include &quot;OgreNewt_World.h&quot;
 #include &quot;OgreNewt_Body.h&quot;
-#include &quot;OgreNewt_Collision.h&quot;
 #include &lt;iostream&gt;
 
 #ifdef __APPLE__
@@ -116,7 +115,7 @@
         //! find the point on a collision primitive closest to a global point.
         
         int CollisionPointDistance( const OgreNewt::World* world, const Ogre::Vector3&amp; globalpt, 
-                                    const OgreNewt::Collision* col, const Ogre::Quaternion&amp; colorient, const Ogre::Vector3&amp; colpos, 
+                                    const OgreNewt::CollisionPtr&amp; col, const Ogre::Quaternion&amp; colorient, const Ogre::Vector3&amp; colpos, 
                                     Ogre::Vector3&amp; retpt, Ogre::Vector3&amp; retnormal, int threadIndex )
         {
             float matrix[16];
@@ -131,8 +130,8 @@
 
 
         
-        int CollisionClosestPoint( const OgreNewt::World* world, const OgreNewt::Collision* colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA,
-                                                            const OgreNewt::Collision* colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB,
+        int CollisionClosestPoint( const OgreNewt::World* world, const OgreNewt::CollisionPtr&amp; colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA,
+                                                            const OgreNewt::CollisionPtr&amp; colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB,
                                                             Ogre::Vector3&amp; retPosA, Ogre::Vector3&amp; retPosB, Ogre::Vector3&amp; retNorm, int threadIndex )
         {
             float matrixA[16];
@@ -152,8 +151,8 @@
 
 
         int CollisionCollide(  const OgreNewt::World* world, int maxSize, 
-            const OgreNewt::Collision* colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA,
-            const OgreNewt::Collision* colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB,
+            const OgreNewt::CollisionPtr&amp; colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA,
+            const OgreNewt::CollisionPtr&amp; colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB,
             Ogre::Vector3* retContactPts, Ogre::Vector3* retNormals, Ogre::Real* retPenetrations, int threadIndex )
         {
             float matrixA[16];
@@ -173,8 +172,8 @@
 
 
         int CollisionCollideContinue( const OgreNewt::World* world, int maxSize, Ogre::Real timeStep,
-            const OgreNewt::Collision* colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA, const Ogre::Vector3&amp; colVelA, const Ogre::Vector3&amp; colOmegaA,
-            const OgreNewt::Collision* colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB, const Ogre::Vector3&amp; colVelB, const Ogre::Vector3&amp; colOmegaB,
+            const OgreNewt::CollisionPtr&amp; colA, const Ogre::Quaternion&amp; colOrientA, const Ogre::Vector3&amp; colPosA, const Ogre::Vector3&amp; colVelA, const Ogre::Vector3&amp; colOmegaA,
+            const OgreNewt::CollisionPtr&amp; colB, const Ogre::Quaternion&amp; colOrientB, const Ogre::Vector3&amp; colPosB, const Ogre::Vector3&amp; colVelB, const Ogre::Vector3&amp; colOmegaB,
             Ogre::Real&amp; retTimeOfImpact, Ogre::Vector3* retContactPts, Ogre::Vector3* retNormals, Ogre::Real* retPenetrations, int threadIndex )
         {
             float matrixA[16];
@@ -197,13 +196,13 @@
         }
 
 
-        Ogre::Real CollisionRayCast( const OgreNewt::Collision* col, const Ogre::Vector3&amp; startPt, const Ogre::Vector3&amp; endPt, 
+        Ogre::Real CollisionRayCast( const OgreNewt::CollisionPtr&amp; col, const Ogre::Vector3&amp; startPt, const Ogre::Vector3&amp; endPt, 
             Ogre::Vector3&amp; retNorm, int&amp; retColID )
         {
             return NewtonCollisionRayCast( col-&gt;getNewtonCollision(), &amp;startPt.x, &amp;endPt.x, &amp;retNorm.x, &amp;retColID );
         }
 
-        Ogre::AxisAlignedBox CollisionCalculateAABB( const OgreNewt::Collision* col, const Ogre::Quaternion&amp; orient, const Ogre::Vector3&amp; pos )
+        Ogre::AxisAlignedBox CollisionCalculateAABB( const OgreNewt::CollisionPtr&amp; col, const Ogre::Quaternion&amp; orient, const Ogre::Vector3&amp; pos )
         {
             float matrix[16];
             Converters::QuatPosToMatrix( orient, pos, matrix );


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001945.html">[Dsa-hl-svn] r4888 - rl/trunk/editors/Lockenwickler/src
</A></li>
	<LI>Next message: <A HREF="001947.html">[Dsa-hl-svn] r4890 - in rl/trunk/engine: ai/src core/include	core/src rules/src script/src ui/include ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1946">[ date ]</a>
              <a href="thread.html#1946">[ thread ]</a>
              <a href="subject.html#1946">[ subject ]</a>
              <a href="author.html#1946">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
