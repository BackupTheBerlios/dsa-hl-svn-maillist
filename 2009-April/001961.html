<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4904 - in rl/trunk/editors/Lockenwickler: . src ui	files
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2009-April/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4904%20-%20in%20rl/trunk/editors/Lockenwickler%3A%20.%20src%20ui%0A%09files&In-Reply-To=%3C200904191455.n3JEtCXo016999%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001960.html">
   <LINK REL="Next"  HREF="001962.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4904 - in rl/trunk/editors/Lockenwickler: . src ui	files</H1>
    <B>fusion2 at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4904%20-%20in%20rl/trunk/editors/Lockenwickler%3A%20.%20src%20ui%0A%09files&In-Reply-To=%3C200904191455.n3JEtCXo016999%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4904 - in rl/trunk/editors/Lockenwickler: . src ui	files">fusion2 at mail.berlios.de
       </A><BR>
    <I>Sun Apr 19 16:55:12 CEST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="001960.html">[Dsa-hl-svn] r4903 - rl/trunk/editors/Lockenwickler/src
</A></li>
        <LI>Next message: <A HREF="001962.html">[Dsa-hl-svn] r4905 - in rl/trunk/engine: core core/include core/src	script/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1961">[ date ]</a>
              <a href="thread.html#1961">[ thread ]</a>
              <a href="subject.html#1961">[ subject ]</a>
              <a href="author.html#1961">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fusion2
Date: 2009-04-19 16:55:07 +0200 (Sun, 19 Apr 2009)
New Revision: 4904

Added:
   rl/trunk/editors/Lockenwickler/src/AddTriggerDialog.py
   rl/trunk/editors/Lockenwickler/src/GlobDirectoryWalker.py
   rl/trunk/editors/Lockenwickler/src/TriggerManager.py
   rl/trunk/editors/Lockenwickler/src/Ui_AddTriggerDialog.py
   rl/trunk/editors/Lockenwickler/ui files/AddTriggerDialog.ui
Modified:
   rl/trunk/editors/Lockenwickler/Lockenwickler.e4p
   rl/trunk/editors/Lockenwickler/src/GameObjectClass.py
   rl/trunk/editors/Lockenwickler/src/Lockenwickler.py
   rl/trunk/editors/Lockenwickler/src/ModuleExplorer.py
   rl/trunk/editors/Lockenwickler/src/ModuleManager.py
   rl/trunk/editors/Lockenwickler/src/ZoneManager.py
Log:
- startet work on adding triggers to zones
- added a generic directory walker


Modified: rl/trunk/editors/Lockenwickler/Lockenwickler.e4p
===================================================================
--- rl/trunk/editors/Lockenwickler/Lockenwickler.e4p	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/Lockenwickler.e4p	2009-04-19 14:55:07 UTC (rev 4904)
@@ -1,7 +1,7 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
 &lt;!DOCTYPE Project SYSTEM &quot;Project-4.6.dtd&quot;&gt;
 &lt;!-- eric4 project file for project Lockenwickler --&gt;
-&lt;!-- Saved: 2009-04-16, 19:30:12 --&gt;
+&lt;!-- Saved: 2009-04-19, 16:52:11 --&gt;
 &lt;!-- Copyright (C) 2009 Stefan Stammberger, <A HREF="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">sstammberger at web.de</A> --&gt;
 &lt;Project version=&quot;4.6&quot;&gt;
   &lt;Language&gt;en&lt;/Language&gt;
@@ -42,11 +42,20 @@
     &lt;Source&gt;src/ZoneManager.py&lt;/Source&gt;
     &lt;Source&gt;src/GOGenericEditor.py&lt;/Source&gt;
     &lt;Source&gt;src/ModuleDirectoryView.py&lt;/Source&gt;
+    &lt;Source&gt;src/TriggerManager.py&lt;/Source&gt;
+    &lt;Source&gt;src/GlobDirectoryWalker.py&lt;/Source&gt;
+    &lt;Source&gt;ui files/Ui_GOPropertyEditorDialogINT.py&lt;/Source&gt;
+    &lt;Source&gt;ui files/Ui_GOPropertyEditorDialogSTRING.py&lt;/Source&gt;
+    &lt;Source&gt;ui files/Ui_NewModuleWizard.py&lt;/Source&gt;
+    &lt;Source&gt;ui files/Ui_AddTriggerDialog.py&lt;/Source&gt;
+    &lt;Source&gt;src/AddTriggerDialog.py&lt;/Source&gt;
+    &lt;Source&gt;src/Ui_AddTriggerDialog.py&lt;/Source&gt;
   &lt;/Sources&gt;
   &lt;Forms&gt;
     &lt;Form&gt;ui files/GOPropertyEditorDialogINT.ui&lt;/Form&gt;
     &lt;Form&gt;ui files/GOPropertyEditorDialogSTRING.ui&lt;/Form&gt;
     &lt;Form&gt;ui files/NewModuleWizard.ui&lt;/Form&gt;
+    &lt;Form&gt;ui files/AddTriggerDialog.ui&lt;/Form&gt;
   &lt;/Forms&gt;
   &lt;Translations&gt;
   &lt;/Translations&gt;

Added: rl/trunk/editors/Lockenwickler/src/AddTriggerDialog.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/AddTriggerDialog.py	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/src/AddTriggerDialog.py	2009-04-19 14:55:07 UTC (rev 4904)
@@ -0,0 +1,32 @@
+# -*- coding: utf-8 -*-
+
+&quot;&quot;&quot;
+Module implementing AddTriggerDialog.
+&quot;&quot;&quot;
+
+from PyQt4.QtGui import QDialog
+from PyQt4.QtCore import pyqtSignature
+
+from Ui_AddTriggerDialog import Ui_Dialog
+
+class AddTriggerDialog(QDialog, Ui_Dialog):
+    def __init__(self, parent = None):
+
+        QDialog.__init__(self, parent)
+        self.setupUi(self)
+    
+    @pyqtSignature(&quot;QString&quot;)
+    def on_lineEdit_textChanged(self, p0):
+        &quot;&quot;&quot;
+        Slot documentation goes here.
+        &quot;&quot;&quot;
+        # TODO: not implemented yet
+        raise NotImplementedError
+    
+    @pyqtSignature(&quot;&quot;)
+    def on_pushButton_clicked(self):
+        &quot;&quot;&quot;
+        Slot documentation goes here.
+        &quot;&quot;&quot;
+        # TODO: not implemented yet
+        raise NotImplementedError

Modified: rl/trunk/editors/Lockenwickler/src/GameObjectClass.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/GameObjectClass.py	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/src/GameObjectClass.py	2009-04-19 14:55:07 UTC (rev 4904)
@@ -1,4 +1,4 @@
- #################################################
+#################################################
 # This source file is part of Rastullahs Lockenwickler.
 # Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
 #
@@ -15,7 +15,7 @@
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
+#################################################
 
 #from elementtree.ElementTree import *
 from xml.etree.cElementTree import *
@@ -147,9 +147,44 @@
             rep.name = str(self.editor.nameEditBox.text())
             rep.type = str(self.editor.typeDropBox.currentText())
             
-            if rep.type == &quot;STRING&quot; or rep.type == &quot;BOOL&quot; or rep.type == &quot;REAL&quot; or rep.type == &quot;INT&quot;:
+            if rep.type == &quot;STRING&quot;:
                 rep.data = str(self.editor.dataEditBox.text())
-            
+            elif rep.type == &quot;BOOL&quot;:
+                text = str(self.editor.dataEditBox.text())
+                if text == &quot;True&quot; or text == &quot;1&quot; or text == &quot;true&quot;:
+                    rep.data = &quot;True&quot;
+                elif text == &quot;False&quot; or text == &quot;0&quot; or text == &quot;false&quot;:
+                    rep.data = &quot;False&quot;
+                else:
+                    reply = QMessageBox.question(QApplication.focusWidget(), &quot;Try again?&quot;, &quot;Data is not a BOOL&quot; , QMessageBox.Yes|QMessageBox.No)
+                    if reply == QMessageBox.Yes:
+                        self.addProperty(True)
+                        return
+                    elif reply == QMessageBox.No:
+                        return
+            elif rep.type == &quot;REAL&quot;:
+                try:
+                     rep.data = str(float(self.editor.dataEditBox.text()))
+                except ValueError, e:
+                    reply = QMessageBox.question(QApplication.focusWidget(), &quot;Try again?&quot;, &quot;Data is not a REAL&quot; , QMessageBox.Yes|QMessageBox.No)
+                    if reply == QMessageBox.Yes:
+                        self.addProperty(True)
+                        print &quot;ValueError: &quot; + str(e)
+                        return
+                    elif reply == QMessageBox.No:
+                        return
+            elif rep.type == &quot;INT&quot;:
+                try:
+                     rep.data = str(int(self.editor.dataEditBox.text()))
+                except ValueError, e:
+                    reply = QMessageBox.question(QApplication.focusWidget(), &quot;Try again?&quot;, &quot;Data is not a INT&quot; , QMessageBox.Yes|QMessageBox.No)
+                    if reply == QMessageBox.Yes:
+                        self.addProperty(True)
+                        print &quot;ValueError: &quot; + str(e)
+                        return
+                    elif reply == QMessageBox.No:
+                        return
+                
             if rep.name in self.propertieDict:
                 reply = QMessageBox.question(QApplication.focusWidget(), &quot;Warning...&quot;, &quot;Replace the existing property?&quot; , QMessageBox.Yes|QMessageBox.No|QMessageBox.Cancel)
                 if reply == QMessageBox.Cancel:

Added: rl/trunk/editors/Lockenwickler/src/GlobDirectoryWalker.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/GlobDirectoryWalker.py	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/src/GlobDirectoryWalker.py	2009-04-19 14:55:07 UTC (rev 4904)
@@ -0,0 +1,35 @@
+#
+# adapted from os-path-walk-example-3.py
+
+import os
+import fnmatch
+
+class GlobDirectoryWalker:
+    # a forward iterator that traverses a directory tree
+
+    def __init__(self, directory, pattern=&quot;*&quot;):
+        self.stack = [directory]
+        self.pattern = pattern
+        self.files = []
+        self.index = 0
+
+    def __getitem__(self, index):
+        while 1:
+            try:
+                file = self.files[self.index]
+                self.index = self.index + 1
+            except IndexError:
+                # pop next directory from stack
+                self.directory = self.stack.pop()
+                self.files = os.listdir(self.directory)
+                self.index = 0
+            else:
+                # got a filename
+                fullname = os.path.join(self.directory, file)
+                if os.path.isdir(fullname) and not os.path.islink(fullname):
+                    self.stack.append(fullname)
+                if fnmatch.fnmatch(file, self.pattern):
+                    return fullname
+
+#for file in GlobDirectoryWalker(&quot;.&quot;, &quot;*.py&quot;):
+#    print file

Modified: rl/trunk/editors/Lockenwickler/src/Lockenwickler.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/Lockenwickler.py	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/src/Lockenwickler.py	2009-04-19 14:55:07 UTC (rev 4904)
@@ -1,4 +1,4 @@
- #################################################
+#################################################
 # This source file is part of Rastullahs Lockenwickler.
 # Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
 #
@@ -15,7 +15,7 @@
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
+#################################################
 
 import os
 import sys
@@ -40,7 +40,9 @@
 from MovePivot import *
 from PivotRenderQueueListener import *
 from ModuleDirectoryView import *
+from TriggerManager import *
 
+
 import OgreMainWindow
 import ogre.renderer.OGRE as og
 
@@ -69,6 +71,8 @@
         self.moduleManager.materialSelectionDialog = self.materialSelectionDialog
         self.moduleDirectoryViewWin = ModuleDirectoryView(self)
         
+        triggerManager = TriggerManager()
+        
         self.gameObjectClassView = GameObjectClassView(self.moduleManager.gocManager)
 
         self.createDockWindows()

Modified: rl/trunk/editors/Lockenwickler/src/ModuleExplorer.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/ModuleExplorer.py	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/src/ModuleExplorer.py	2009-04-19 14:55:07 UTC (rev 4904)
@@ -1,4 +1,4 @@
- #################################################
+#################################################
 # This source file is part of Rastullahs Lockenwickler.
 # Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
 #
@@ -15,13 +15,15 @@
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
+#################################################
 
 import sys
 from PyQt4.QtCore import *
 from PyQt4.QtGui import *
 import ogre.renderer.OGRE as og
 
+from ZoneManager import ZoneManager
+
 # get the light out of a light node
 def extractLight(node):
         i = 0
@@ -352,6 +354,11 @@
                 setActiveMapAction = QAction(&quot;Set Active&quot;,  self)
                 menu.addAction(setActiveMapAction)
                 self.connect(setActiveMapAction, SIGNAL(&quot;triggered()&quot;), self.onSetActiveMap)
+            elif self.sceneTreeView.currentItem() is not None and str(self.sceneTreeView.currentItem().text(0)).startswith(&quot;Zone:&quot;):
+                item = self.sceneTreeView.itemAt(point)
+                addTriggerAction = QAction(&quot;Add Trigger&quot;,  self)
+                menu.addAction(addTriggerAction)
+                self.connect(addTriggerAction, SIGNAL(&quot;triggered()&quot;), self.onAddTriggerToZone)
                 
             deleteAction= QAction(&quot;Delete&quot;,  self)
             menu.addAction(deleteAction)
@@ -371,6 +378,10 @@
             
             menu.exec_(QCursor().pos())
     
+    def onAddTriggerToZone(self):
+        zoneName = str(self.sceneTreeView.currentItem().text(0)).replace(&quot;Zone: &quot;, &quot;&quot;)
+        ZoneManager.instance.getZone(zoneName).addTrigger()
+        
     def onOptions(self):
         dlg = ExplorerOptionsDlg(self.showLights, self.showGameObjects, self.showEntities, self.showZones, self.showZoneLights, self)
         if dlg.exec_():

Modified: rl/trunk/editors/Lockenwickler/src/ModuleManager.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/ModuleManager.py	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/src/ModuleManager.py	2009-04-19 14:55:07 UTC (rev 4904)
@@ -1,4 +1,4 @@
- #################################################
+#################################################
 # This source file is part of Rastullahs Lockenwickler.
 # Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
 #
@@ -15,7 +15,7 @@
 # You should have received a copy of the GNU General Public License
 # along with this program; if not, write to the Free Software
 # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
+#################################################
 
 import sys
 import codecs
@@ -37,8 +37,8 @@
 from GameObjectClassManager import *
 from MyRaySceneQueryListener import *
 from ZoneManager import ZoneManager
+from TriggerManager import TriggerManager 
 
-
 # get the light out of a light node
 def extractLight(node):
         i = 0
@@ -875,6 +875,7 @@
                                 m2.load()
                                 self.modelSelectionDialog.scanDirForModels(m2.moduleRoot)
                                 self.materialSelectionDialog.scanDirForMaterials(m2.moduleRoot)
+                                TriggerManager.instance.addDirectory(m2.moduleRoot)
                                 self.mainModuledependencieList.append(m2)
                                 directories.append(m2.moduleRoot)
 #                self.progress.setProgress(4, &quot;Loading &quot; + moduleName)
@@ -883,10 +884,13 @@
                 self.modelSelectionDialog.scanDirForModels(m.moduleRoot)
 #                self.progress.setProgress(8, &quot;Scan for materials&quot;)
                 self.materialSelectionDialog.scanDirForMaterials(m.moduleRoot)
+                TriggerManager.instance.addDirectory(m.moduleRoot)
                 directories.append(m.moduleRoot)
                 self.mainModule = m
                 self.moduleExplorer.setCurrentModule(m)
                 self.moduleDirView.parseDirectory(directories)
+        
+        TriggerManager.instance.update()
                 
         if self.selectionBuffer is None:
             self.selectionBuffer = SelectionBuffer(self.sceneManager, self.ogreRoot.getRenderTarget(&quot;OgreMainWin&quot;), self, self.zoneManager)
@@ -1375,8 +1379,6 @@
             actions.append(self.createAction(&quot;Add Property&quot;, so.entity.getUserObject().addProperty))
             self.playerStartGameObjectId = so.entity.getUserObject().inWorldId
             
-                
-            
         if self.onContextMenuCallback is not None:
             self.onContextMenuCallback(actions,  menus)
 

Added: rl/trunk/editors/Lockenwickler/src/TriggerManager.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/TriggerManager.py	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/src/TriggerManager.py	2009-04-19 14:55:07 UTC (rev 4904)
@@ -0,0 +1,77 @@
+#################################################
+# This source file is part of Rastullahs Lockenwickler.
+# Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+#  but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
+#################################################
+
+from os.path import isfile,  join
+from GlobDirectoryWalker import GlobDirectoryWalker
+
+class TriggerProperty():
+    def __init__(self, name, type, data):
+        self.name = name
+        self.type = type
+        self.data = data
+
+class Trigger():
+    def __init__(self, className, name):
+        self.className = className
+        self.name = name
+        self.properties = []
+        
+    def addProperty(self, name, type, data):
+        prop = TriggerProperty(name,  type, data)
+        self.properties.append(prop)
+        
+    def removeProperty(self, name):
+        for prop in self.properties:
+            if prop.name == name:
+                self.properties.remove(prop)
+                return
+        
+class TriggerManager():
+    instance = None
+    availableTriggers = []
+    
+    def __init__(self):
+        self.triggerInstances = ()
+        self.directories = []
+        
+        if TriggerManager.instance == None:
+            TriggerManager.instance = self
+        
+    def addDirectory(self, dir):
+        self.directories.append(dir)
+        
+        self.update()
+    
+    def createTrigger(self, className, name):
+        trigger = Trigger(className, name)
+        self.triggerInstances.append(trigger)
+        return trigger
+    
+    def update(self):
+        TriggerManager.availableTriggers = []
+        
+        for dir in self.directories:
+            for file in GlobDirectoryWalker(dir, &quot;*.rb&quot;):
+                f = open(file, &quot;r&quot;)
+                for line in f:
+                    if line.startswith(&quot;class &quot;) and &quot;&lt; Trigger&quot; in line:
+                        split = line.split(&quot; &quot;)
+                        TriggerManager.availableTriggers.append(split[1])
+
+    

Added: rl/trunk/editors/Lockenwickler/src/Ui_AddTriggerDialog.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/Ui_AddTriggerDialog.py	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/src/Ui_AddTriggerDialog.py	2009-04-19 14:55:07 UTC (rev 4904)
@@ -0,0 +1,76 @@
+# -*- coding: utf-8 -*-
+
+# Form implementation generated from reading ui file '/home/fusion/dev/ui files/AddTriggerDialog.ui'
+#
+# Created: Sun Apr 19 16:38:41 2009
+#      by: PyQt4 UI code generator 4.4.4
+#
+# WARNING! All changes made in this file will be lost!
+
+from PyQt4 import QtCore, QtGui
+
+class Ui_Dialog(object):
+    def setupUi(self, Dialog):
+        Dialog.setObjectName(&quot;Dialog&quot;)
+        Dialog.resize(354, 500)
+        self.gridLayout = QtGui.QGridLayout(Dialog)
+        self.gridLayout.setObjectName(&quot;gridLayout&quot;)
+        self.label_2 = QtGui.QLabel(Dialog)
+        self.label_2.setAlignment(QtCore.Qt.AlignCenter)
+        self.label_2.setObjectName(&quot;label_2&quot;)
+        self.gridLayout.addWidget(self.label_2, 2, 0, 1, 1)
+        self.lineEdit = QtGui.QLineEdit(Dialog)
+        self.lineEdit.setObjectName(&quot;lineEdit&quot;)
+        self.gridLayout.addWidget(self.lineEdit, 3, 0, 1, 1)
+        self.label_3 = QtGui.QLabel(Dialog)
+        self.label_3.setAlignment(QtCore.Qt.AlignCenter)
+        self.label_3.setObjectName(&quot;label_3&quot;)
+        self.gridLayout.addWidget(self.label_3, 4, 0, 1, 1)
+        self.pushButton = QtGui.QPushButton(Dialog)
+        self.pushButton.setLayoutDirection(QtCore.Qt.LeftToRight)
+        self.pushButton.setObjectName(&quot;pushButton&quot;)
+        self.gridLayout.addWidget(self.pushButton, 5, 0, 1, 1)
+        self.listView = QtGui.QListView(Dialog)
+        self.listView.setObjectName(&quot;listView&quot;)
+        self.gridLayout.addWidget(self.listView, 6, 0, 1, 1)
+        self.buttonBox = QtGui.QDialogButtonBox(Dialog)
+        self.buttonBox.setStandardButtons(QtGui.QDialogButtonBox.Cancel|QtGui.QDialogButtonBox.Ok)
+        self.buttonBox.setObjectName(&quot;buttonBox&quot;)
+        self.gridLayout.addWidget(self.buttonBox, 7, 0, 1, 1)
+        self.comboBox = QtGui.QComboBox(Dialog)
+        self.comboBox.setObjectName(&quot;comboBox&quot;)
+        self.gridLayout.addWidget(self.comboBox, 1, 0, 1, 1)
+        self.label = QtGui.QLabel(Dialog)
+        self.label.setAlignment(QtCore.Qt.AlignCenter)
+        self.label.setObjectName(&quot;label&quot;)
+        self.gridLayout.addWidget(self.label, 0, 0, 1, 1)
+        self.label_2.setBuddy(self.lineEdit)
+        self.label_3.setBuddy(self.pushButton)
+        self.label.setBuddy(self.comboBox)
+
+        self.retranslateUi(Dialog)
+        QtCore.QObject.connect(self.buttonBox, QtCore.SIGNAL(&quot;accepted()&quot;), Dialog.accept)
+        QtCore.QObject.connect(self.buttonBox, QtCore.SIGNAL(&quot;rejected()&quot;), Dialog.reject)
+        QtCore.QMetaObject.connectSlotsByName(Dialog)
+        Dialog.setTabOrder(self.comboBox, self.lineEdit)
+        Dialog.setTabOrder(self.lineEdit, self.pushButton)
+        Dialog.setTabOrder(self.pushButton, self.listView)
+        Dialog.setTabOrder(self.listView, self.buttonBox)
+
+    def retranslateUi(self, Dialog):
+        Dialog.setWindowTitle(QtGui.QApplication.translate(&quot;Dialog&quot;, &quot;Dialog&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.label_2.setText(QtGui.QApplication.translate(&quot;Dialog&quot;, &quot;Identifier Name&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.label_3.setText(QtGui.QApplication.translate(&quot;Dialog&quot;, &quot;Properties&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.pushButton.setText(QtGui.QApplication.translate(&quot;Dialog&quot;, &quot;Add Property&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.label.setText(QtGui.QApplication.translate(&quot;Dialog&quot;, &quot;ClassName&quot;, None, QtGui.QApplication.UnicodeUTF8))
+
+
+if __name__ == &quot;__main__&quot;:
+    import sys
+    app = QtGui.QApplication(sys.argv)
+    Dialog = QtGui.QDialog()
+    ui = Ui_Dialog()
+    ui.setupUi(Dialog)
+    Dialog.show()
+    sys.exit(app.exec_())
+

Modified: rl/trunk/editors/Lockenwickler/src/ZoneManager.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/ZoneManager.py	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/src/ZoneManager.py	2009-04-19 14:55:07 UTC (rev 4904)
@@ -1,363 +1,377 @@
-#################################################
-# This source file is part of Rastullahs Lockenwickler.
-# Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
-#
-# This program is free software; you can redistribute it and/or modify
-# it under the terms of the GNU General Public License as published by
-# the Free Software Foundation; either version 2 of the License, or
-# (at your option) any later version.
-#
-# This program is distributed in the hope that it will be useful,
-#  but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-# GNU General Public License for more details.
-#
-# You should have received a copy of the GNU General Public License
-# along with this program; if not, write to the Free Software
-# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
- #################################################
-
-import functools
-import xml.etree.cElementTree as xml
-
-from PyQt4.QtCore import *
-from PyQt4.QtGui import *
- 
-import ogre.renderer.OGRE as og
- 
-from ModuleExplorer import NameInputDlg
- 
-#                &lt;zone name=&quot;Testzone&quot;&gt;
-#                        &lt;area type=&quot;sphere&quot;&gt;
-#                                &lt;position x=&quot;-10&quot; y=&quot;0&quot; z=&quot;-5&quot;/&gt;
-#                                &lt;scale x=&quot;6&quot; y=&quot;6&quot; z=&quot;6&quot;/&gt;
-#                                &lt;transition_distance&gt;0.5&lt;/transition_distance&gt;
-#                        &lt;/area&gt;
-#                        &lt;area type=&quot;mesh&quot; meshfile=&quot;arc_UnbHaus_07.mesh&quot;&gt;
-#                                &lt;position x=&quot;25&quot; y=&quot;0&quot; z=&quot;-50&quot;/&gt;
-#                                &lt;transition_distance&gt;0.5&lt;/transition_distance&gt;
-#                        &lt;/area&gt;
-#                        &lt;area type=&quot;sphere&quot; subtract=&quot;true&quot;&gt;
-#                                &lt;position x=&quot;-11&quot; y=&quot;0&quot; z=&quot;-4&quot;/&gt;
-#                                &lt;scale x=&quot;2&quot; y=&quot;2&quot; z=&quot;2&quot;/&gt;
-#                        &lt;/area&gt;
-#                        &lt;light name=&quot;red pointlight&quot;/&gt;
-#                        &lt;light name=&quot;green spotlight&quot;/&gt;
-#                        &lt;sound name=&quot;ruchin001.ogg&quot;/&gt;
-#                        &lt;trigger name=&quot;test&quot; classname=&quot;TestTrigger&quot;&gt;
-#                                &lt;property name=&quot;message&quot; type=&quot;STRING&quot; data=&quot;You triggered the dooms day device!&quot; /&gt;
-#                        &lt;/trigger&gt;
-#                &lt;/zone&gt;
- 
-class Area(og.UserDefinedObject):
-    def __init__(self,sceneManager, type, parentZone, id, position, orientation, scale, meshFile = None, transitiondistance = &quot;0.5&quot;, subtract = False):
-        og.UserDefinedObject.__init__(self)
-        self.type = type
-        self.parentZone = parentZone
-        if not parentZone:
-           raise Exception(&quot;No parentZone&quot;)
-
-        self.id = id # editor internal id for entity and node creation
-        self.areaNode = parentZone.zoneNode.createChildSceneNode(&quot;area_&quot; + parentZone.name + &quot; &quot; + str(id))
-        self.meshFile = meshFile
-        self.areaEntity = None
-        self.transitiondistance = transitiondistance
-        self.__subtract = subtract
-        self.sceneManager = sceneManager
-        
-        if type == &quot;box&quot;:
-            self.areaEntity = self.sceneManager.createEntity(&quot;area_&quot; + parentZone.name + str(id) + &quot;_entity&quot;, &quot;UniCube.mesh&quot;)
-        elif type == &quot;sphere&quot;:
-            self.areaEntity = self.sceneManager.createEntity(&quot;area_&quot; + parentZone.name + str(id) + &quot;_entity&quot;, &quot;UniSphere.mesh&quot;)        
-        elif type == &quot;ellipsoid&quot;:
-            print &quot;not yet&quot;
-        elif type == &quot;capsule&quot;:
-            print &quot;not yet&quot;
-        elif type == &quot;pyramid&quot;:
-            print &quot;not yet&quot;
-        elif type == &quot;mesh&quot;:
-            try:
-                self.areaEntity = sceneManager.createEntity(&quot;area_&quot; + parentZone.name + str(id) + &quot;_entity&quot;, self.meshFile)
-            except:
-                print &quot;Mesh &quot; + self.meshFile + &quot; not found!&quot;
-                return None
-                
-        self.areaEntity.setMaterialName(&quot;Lockenwickler_Area&quot;)
-        if self.__subtract:
-            self.areaEntity.setMaterialName(&quot;Lockenwickler_Area_Subtract&quot;)
-            
-        self.areaEntity.setUserObject(self)
-        self.areaNode.attachObject(self.areaEntity)
-        self.areaNode.setPosition(position)
-        if orientation is not None:
-            self.areaNode.setOrientation(orientation.w, orientation.x, orientation.y, orientation.z)
-        if scale is not None:
-            self.areaNode.setScale(scale)
-    
-    def __del__(self):
-        self.areaNode.detachAllObjects()
-        self.areaNode.getParent().removeAndDestroyChild(self.areaNode.getName())
-        self.sceneManager.destroyEntity(self.areaEntity.getName())
-    
-    def getsubtract(self):
-        return self.__subtract
-        
-    def setsubtract(self, val):
-        if not val:
-            self.areaEntity.setMaterialName(&quot;Lockenwickler_Area&quot;)
-        else:
-            self.areaEntity.setMaterialName(&quot;Lockenwickler_Area_Subtract&quot;)
-        
-        self.__subtract = val
-        
-    subtract = property(getsubtract, setsubtract)
-    
-class Zone():
-    def __init__(self,sceneManager, map, name):
-        self.map = map
-        self.name = name
-        self.areaList = []
-        self.lightList = []
-        self.soundList = []
-        self.triggerList = []
-        self.areaCounter = 0
-        self.sceneManager = sceneManager
-        self.isHidden = False
-        
-        self.zoneNode =  self.sceneManager.getRootSceneNode().createChildSceneNode(&quot;zone_&quot; + name + &quot;_node&quot;)
-        
-    def addArea(self, type, position, orientation, scale, meshFile = None):
-        area = Area(self.sceneManager, type, self, self.areaCounter, position, orientation, scale, meshFile)
-        if area is not None:
-            self.areaList.append(area)
-            self.areaCounter = self.areaCounter + 1
-    
-    def deleteArea(self, area):
-        for a in self.areaList:
-            if a.id == area.id:
-                self.areaList.remove(a)
-                del a
-    
-    def hide(self):
-        self.sceneManager.getRootSceneNode().removeChild(self.zoneNode)
-        self.isHidden = True
-    
-    def show(self):
-        self.sceneManager.getRootSceneNode().addChild(self.zoneNode)
-        self.isHidden = False
-        
-        
-class ZoneManager():
-    def __init__(self, sceneManager):
-        self.currentMap = None
-        self.zoneList = []
-        self.menuList = []
-        self.entityUnderMouse = None
-        self.newAreaPosition = None
-        self.sceneManager = sceneManager
-        
-    def createZone(self, name):
-        if self.currentMap == None:
-            print &quot;No map selected!&quot;
-            return
-            
-        z = Zone(self.sceneManager, self.currentMap, name)
-        self.zoneList.append(z)
-        self.currentMap.zoneList.append(z)
-        return z
-        
-    def parseZonesFromXml(self, zoneXmlNode, map):
-        if zoneXmlNode is None:
-            return
-        
-        self.currentMap = map
-        
-        zoneNodes = zoneXmlNode.getiterator(&quot;zone&quot;)
-        for zone in zoneNodes:
-            zoneName = zone.attrib[&quot;name&quot;]
-            z = self.createZone(zoneName)
-            
-            areaNodes = zone.getiterator(&quot;area&quot;)
-            for area in areaNodes:
-                type = area.attrib[&quot;type&quot;]
-                meshFile = None
-                if type == &quot;mesh&quot;:
-                    meshFile = area.attrib[&quot;meshfile&quot;]
-                
-                pos = og.Vector3()
-                qw = qx = qy = qz = 0
-                scale = None
-                hasRotation = False
-                
-                transformations = area.getiterator()
-                for t in transformations:
-                    if t.tag == &quot;position&quot;:
-                        posx = float(t.attrib[&quot;x&quot;])
-                        posy = float(t.attrib[&quot;y&quot;])
-                        posz = float(t.attrib[&quot;z&quot;])
-                        pos = og.Vector3(posx, posy, posz)
-                    elif t.tag == &quot;rotation&quot;:
-                        qw = float(t.attrib[&quot;qw&quot;])
-                        qx = float(t.attrib[&quot;qx&quot;])
-                        qy = float(t.attrib[&quot;qy&quot;])
-                        qz = float(t.attrib[&quot;qz&quot;])
-                        hasRotation = True
-                    elif type == &quot;mesh&quot; and t.tag == &quot;scale&quot;:
-                        scalex = float(t.attrib[&quot;x&quot;])
-                        scaley = float(t.attrib[&quot;y&quot;])
-                        scalez = float(t.attrib[&quot;z&quot;])
-                        scale = og.Vector3(scalex, scaley, scalez)
-                    elif t.tag == &quot;size&quot;:
-                        scalex = float(t.attrib[&quot;x&quot;])
-                        scaley = float(t.attrib[&quot;y&quot;])
-                        scalez = float(t.attrib[&quot;z&quot;])
-                        scale = og.Vector3(scalex, scaley, scalez)
-                
-                rot = None
-                if hasRotation:
-                    rot = og.Quaternion(qw, qx, qy, qz)
-                    
-                z.addArea(type, pos, rot, scale, meshFile)
-            
-            
-            lightNodes = zone.getiterator(&quot;light&quot;)
-            for light in lightNodes:
-                name = light.attrib[&quot;name&quot;]
-                z.lightList.append(name)
-                
-            soundNodes = zone.getiterator(&quot;sound&quot;)
-            for sound in soundNodes:
-                name = sound.attrib[&quot;name&quot;]
-                z.soundList.append(name)
-            
-
-    def saveZonesToXml(self, root, map):
-        if len(map.zoneList) == 0:
-            return
-        
-        rootZonesElem = xml.SubElement(root, &quot;zones&quot;)
-        for zone in map.zoneList:
-            zoneElem = xml.SubElement(rootZonesElem, &quot;zone&quot;)
-            zoneElem.attrib[&quot;name&quot;] = zone.name
-            
-            for area in zone.areaList:
-                areaElem = xml.SubElement(zoneElem, &quot;area&quot;)
-                areaElem.attrib[&quot;type&quot;] = area.type
-                #print &quot;Saving Zone: &quot; + zone.name + &quot; - Area &quot; + str(area.id)
-                if area.type == &quot;mesh&quot; and area.meshFile is not None:
-                    areaElem.attrib[&quot;meshfile&quot;] = area.meshFile
-                    
-                posElem = xml.SubElement(areaElem, &quot;position&quot;)
-                posElem.attrib[&quot;x&quot;] = str(area.areaNode.getPosition().x)
-                posElem.attrib[&quot;y&quot;] = str(area.areaNode.getPosition().y)
-                posElem.attrib[&quot;z&quot;] = str(area.areaNode.getPosition().z)
-                
-                rotElem = xml.SubElement(areaElem, &quot;rotation&quot;)
-                rotElem.attrib[&quot;qw&quot;] = str(area.areaNode.getOrientation().w)
-                rotElem.attrib[&quot;qx&quot;] = str(area.areaNode.getOrientation().x)
-                rotElem.attrib[&quot;qy&quot;] = str(area.areaNode.getOrientation().y)
-                rotElem.attrib[&quot;qz&quot;] = str(area.areaNode.getOrientation().z)
-                
-                scaleElem = None
-                if area.type == &quot;mesh&quot;:
-                    scaleElem = xml.SubElement(areaElem, &quot;scale&quot;)
-                else:
-                    scaleElem = xml.SubElement(areaElem, &quot;size&quot;)
-
-                scaleElem.attrib[&quot;x&quot;] = str(area.areaNode.getScale().x)
-                scaleElem.attrib[&quot;y&quot;] = str(area.areaNode.getScale().y)
-                scaleElem.attrib[&quot;z&quot;] = str(area.areaNode.getScale().z)
-                
-            for lightName in zone.lightList:
-                lightElem = xml.SubElement(zoneElem, &quot;light&quot;)
-                lightElem.attrib[&quot;name&quot;] = str(lightName)
-            
-            for soundName in zone.soundList:
-                soundElem = xml.SubElement(zoneElem, &quot;sound&quot;)
-                soundElem.attrib[&quot;name&quot;] = str(soundName)
-                
-    def deleteArea(self, area):
-        for z in self.zoneList:
-            for a in z.areaList:
-                if a.id == area.id:
-                    z.deleteArea(area)
-    
-    def getZoneMenu(self):
-        self.menuList = []
-        menu = QMenu(&quot;Add Area&quot;)
-        
-        for zone in self.zoneList:
-            m = QMenu(zone.name)
-            self.menuList.append(m)
-            menu.addMenu(m)
-            
-            boxAction = self.createAction(&quot;box&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;box&quot;))
-            self.menuList.append(boxAction)
-            m.addAction(boxAction)
-            
-            sphereAction = self.createAction(&quot;sphere&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;sphere&quot;))
-            self.menuList.append(sphereAction)
-            m.addAction(sphereAction)
-            
-            ellipsoidAction = self.createAction(&quot;ellipsoid&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;ellipsoid&quot;))
-            self.menuList.append(ellipsoidAction)
-            m.addAction(ellipsoidAction)
-            
-            capsuleAction = self.createAction(&quot;capsule&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;capsule&quot;))
-            self.menuList.append(capsuleAction)
-            m.addAction(capsuleAction)
-            
-            pyramidAction = self.createAction(&quot;pyramid&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;pyramid&quot;))
-            self.menuList.append(pyramidAction)
-            m.addAction(pyramidAction)
-            
-            meshAction = self.createAction(&quot;mesh&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;mesh&quot;))
-            self.menuList.append(meshAction)
-            m.addAction(meshAction)
-            
-        return menu
-        
-    def onZoneNameTriggered(self, zone, type):
-        if self.newAreaPosition is not None:
-            if type == &quot;box&quot;:
-                zone.addArea(&quot;box&quot;, self.newAreaPosition, None, None)
-            elif type == &quot;sphere&quot;:
-                zone.addArea(&quot;sphere&quot;, self.newAreaPosition, None, None)
-            elif type == &quot;mesh&quot;:
-                dlg = NameInputDlg(QApplication.focusWidget())
-                resName = &quot;&quot;
-                if dlg.exec_():
-                    resName = str(dlg.nameInput.text())
-
-                zone.addArea(&quot;mesh&quot;, self.newAreaPosition, None, None, resName)
-                
-    def getZone(self, name):
-        for zone in self.zoneList:
-            if zone.name == name:
-                return zone
-        
-    def getZoneList(self):
-        list = []
-        for zone in self.zoneList:
-            list.append(zone.name)
-            
-        return list
-        
-    def createAction(self, text, slot=None, shortcut=None, icon=None, tip=None, checkable=False, signal=&quot;triggered()&quot;):
-        action = QAction(text, None)
-        if icon is not None:
-            action.setIcon(QIcon(&quot;media/icons/%s&quot; % icon))
-        if shortcut is not None:
-            action.setShortcut(shortcut)
-        if tip is not None:
-            action.setToolTip(tip)
-            action.setStatusTip(tip)
-        if slot is not None:
-            QWidget.connect(action, SIGNAL(signal), slot)
-
-        action.setCheckable(checkable)
-
-        return action
-        
-        
-        
+#################################################
+# This source file is part of Rastullahs Lockenwickler.
+# Copyright (C) 2003-2009 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+#
+# This program is free software; you can redistribute it and/or modify
+# it under the terms of the GNU General Public License as published by
+# the Free Software Foundation; either version 2 of the License, or
+# (at your option) any later version.
+#
+# This program is distributed in the hope that it will be useful,
+#  but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+# GNU General Public License for more details.
+#
+# You should have received a copy of the GNU General Public License
+# along with this program; if not, write to the Free Software
+# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  US
+#################################################
+
+import functools
+import xml.etree.cElementTree as xml
+
+from PyQt4.QtCore import *
+from PyQt4.QtGui import *
+ 
+import ogre.renderer.OGRE as og
+ 
+from ModuleExplorer import NameInputDlg
+from TriggerManager import TriggerManager
+from AddTriggerDialog import AddTriggerDialog
+
+#                &lt;zone name=&quot;Testzone&quot;&gt;
+#                        &lt;area type=&quot;sphere&quot;&gt;
+#                                &lt;position x=&quot;-10&quot; y=&quot;0&quot; z=&quot;-5&quot;/&gt;
+#                                &lt;scale x=&quot;6&quot; y=&quot;6&quot; z=&quot;6&quot;/&gt;
+#                                &lt;transition_distance&gt;0.5&lt;/transition_distance&gt;
+#                        &lt;/area&gt;
+#                        &lt;area type=&quot;mesh&quot; meshfile=&quot;arc_UnbHaus_07.mesh&quot;&gt;
+#                                &lt;position x=&quot;25&quot; y=&quot;0&quot; z=&quot;-50&quot;/&gt;
+#                                &lt;transition_distance&gt;0.5&lt;/transition_distance&gt;
+#                        &lt;/area&gt;
+#                        &lt;area type=&quot;sphere&quot; subtract=&quot;true&quot;&gt;
+#                                &lt;position x=&quot;-11&quot; y=&quot;0&quot; z=&quot;-4&quot;/&gt;
+#                                &lt;scale x=&quot;2&quot; y=&quot;2&quot; z=&quot;2&quot;/&gt;
+#                        &lt;/area&gt;
+#                        &lt;light name=&quot;red pointlight&quot;/&gt;
+#                        &lt;light name=&quot;green spotlight&quot;/&gt;
+#                        &lt;sound name=&quot;ruchin001.ogg&quot;/&gt;
+#                        &lt;trigger name=&quot;test&quot; classname=&quot;TestTrigger&quot;&gt;
+#                                &lt;property name=&quot;message&quot; type=&quot;STRING&quot; data=&quot;You triggered the dooms day device!&quot; /&gt;
+#                        &lt;/trigger&gt;
+#                &lt;/zone&gt;
+ 
+       
+class Area(og.UserDefinedObject):
+    def __init__(self,sceneManager, type, parentZone, id, position, orientation, scale, meshFile = None, transitiondistance = &quot;0.5&quot;, subtract = False):
+        og.UserDefinedObject.__init__(self)
+        self.type = type
+        self.parentZone = parentZone
+        if not parentZone:
+           raise Exception(&quot;No parentZone&quot;)
+
+        self.id = id # editor internal id for entity and node creation
+        self.areaNode = parentZone.zoneNode.createChildSceneNode(&quot;area_&quot; + parentZone.name + &quot; &quot; + str(id))
+        self.meshFile = meshFile
+        self.areaEntity = None
+        self.transitiondistance = transitiondistance
+        self.__subtract = subtract
+        self.sceneManager = sceneManager
+        
+        if type == &quot;box&quot;:
+            self.areaEntity = self.sceneManager.createEntity(&quot;area_&quot; + parentZone.name + str(id) + &quot;_entity&quot;, &quot;UniCube.mesh&quot;)
+        elif type == &quot;sphere&quot;:
+            self.areaEntity = self.sceneManager.createEntity(&quot;area_&quot; + parentZone.name + str(id) + &quot;_entity&quot;, &quot;UniSphere.mesh&quot;)        
+        elif type == &quot;ellipsoid&quot;:
+            print &quot;not yet&quot;
+        elif type == &quot;capsule&quot;:
+            print &quot;not yet&quot;
+        elif type == &quot;pyramid&quot;:
+            print &quot;not yet&quot;
+        elif type == &quot;mesh&quot;:
+            try:
+                self.areaEntity = sceneManager.createEntity(&quot;area_&quot; + parentZone.name + str(id) + &quot;_entity&quot;, self.meshFile)
+            except:
+                print &quot;Mesh &quot; + self.meshFile + &quot; not found!&quot;
+                return None
+                
+        self.areaEntity.setMaterialName(&quot;Lockenwickler_Area&quot;)
+        if self.__subtract:
+            self.areaEntity.setMaterialName(&quot;Lockenwickler_Area_Subtract&quot;)
+            
+        self.areaEntity.setUserObject(self)
+        self.areaNode.attachObject(self.areaEntity)
+        self.areaNode.setPosition(position)
+        if orientation is not None:
+            self.areaNode.setOrientation(orientation.w, orientation.x, orientation.y, orientation.z)
+        if scale is not None:
+            self.areaNode.setScale(scale)
+    
+    def __del__(self):
+        self.areaNode.detachAllObjects()
+        self.areaNode.getParent().removeAndDestroyChild(self.areaNode.getName())
+        self.sceneManager.destroyEntity(self.areaEntity.getName())
+    
+    def getsubtract(self):
+        return self.__subtract
+        
+    def setsubtract(self, val):
+        if not val:
+            self.areaEntity.setMaterialName(&quot;Lockenwickler_Area&quot;)
+        else:
+            self.areaEntity.setMaterialName(&quot;Lockenwickler_Area_Subtract&quot;)
+        
+        self.__subtract = val
+        
+    subtract = property(getsubtract, setsubtract)
+    
+class Zone():
+    def __init__(self,sceneManager, map, name):
+        self.map = map
+        self.name = name
+        self.areaList = []
+        self.lightList = []
+        self.soundList = []
+        self.triggerList = []
+        self.areaCounter = 0
+        self.sceneManager = sceneManager
+        self.isHidden = False
+        
+        self.zoneNode =  self.sceneManager.getRootSceneNode().createChildSceneNode(&quot;zone_&quot; + name + &quot;_node&quot;)
+        
+    def addArea(self, type, position, orientation, scale, meshFile = None):
+        area = Area(self.sceneManager, type, self, self.areaCounter, position, orientation, scale, meshFile)
+        if area is not None:
+            self.areaList.append(area)
+            self.areaCounter = self.areaCounter + 1
+    
+    def deleteArea(self, area):
+        for a in self.areaList:
+            if a.id == area.id:
+                self.areaList.remove(a)
+                del a
+    
+    def addTrigger(self):
+        dlg = AddTriggerDialog()
+        dlg.exec_(QCursor.pos())
+    
+    def hide(self):
+        self.sceneManager.getRootSceneNode().removeChild(self.zoneNode)
+        self.isHidden = True
+    
+    def show(self):
+        self.sceneManager.getRootSceneNode().addChild(self.zoneNode)
+        self.isHidden = False
+        
+        
+class ZoneManager():
+    instance = None
+    
+    def __init__(self, sceneManager):
+        if ZoneManager.instance == None:
+            ZoneManager.instance = self
+        
+            self.currentMap = None
+            self.zoneList = []
+            self.menuList = []
+            self.entityUnderMouse = None
+            self.newAreaPosition = None
+            self.sceneManager = sceneManager
+        
+        
+        
+    def createZone(self, name):
+        if self.currentMap == None:
+            print &quot;No map selected!&quot;
+            return
+            
+        z = Zone(self.sceneManager, self.currentMap, name)
+        self.zoneList.append(z)
+        self.currentMap.zoneList.append(z)
+        return z
+        
+    def parseZonesFromXml(self, zoneXmlNode, map):
+        if zoneXmlNode is None:
+            return
+        
+        self.currentMap = map
+        
+        zoneNodes = zoneXmlNode.getiterator(&quot;zone&quot;)
+        for zone in zoneNodes:
+            zoneName = zone.attrib[&quot;name&quot;]
+            z = self.createZone(zoneName)
+            
+            areaNodes = zone.getiterator(&quot;area&quot;)
+            for area in areaNodes:
+                type = area.attrib[&quot;type&quot;]
+                meshFile = None
+                if type == &quot;mesh&quot;:
+                    meshFile = area.attrib[&quot;meshfile&quot;]
+                
+                pos = og.Vector3()
+                qw = qx = qy = qz = 0
+                scale = None
+                hasRotation = False
+                
+                transformations = area.getiterator()
+                for t in transformations:
+                    if t.tag == &quot;position&quot;:
+                        posx = float(t.attrib[&quot;x&quot;])
+                        posy = float(t.attrib[&quot;y&quot;])
+                        posz = float(t.attrib[&quot;z&quot;])
+                        pos = og.Vector3(posx, posy, posz)
+                    elif t.tag == &quot;rotation&quot;:
+                        qw = float(t.attrib[&quot;qw&quot;])
+                        qx = float(t.attrib[&quot;qx&quot;])
+                        qy = float(t.attrib[&quot;qy&quot;])
+                        qz = float(t.attrib[&quot;qz&quot;])
+                        hasRotation = True
+                    elif type == &quot;mesh&quot; and t.tag == &quot;scale&quot;:
+                        scalex = float(t.attrib[&quot;x&quot;])
+                        scaley = float(t.attrib[&quot;y&quot;])
+                        scalez = float(t.attrib[&quot;z&quot;])
+                        scale = og.Vector3(scalex, scaley, scalez)
+                    elif t.tag == &quot;size&quot;:
+                        scalex = float(t.attrib[&quot;x&quot;])
+                        scaley = float(t.attrib[&quot;y&quot;])
+                        scalez = float(t.attrib[&quot;z&quot;])
+                        scale = og.Vector3(scalex, scaley, scalez)
+                
+                rot = None
+                if hasRotation:
+                    rot = og.Quaternion(qw, qx, qy, qz)
+                    
+                z.addArea(type, pos, rot, scale, meshFile)
+            
+            
+            lightNodes = zone.getiterator(&quot;light&quot;)
+            for light in lightNodes:
+                name = light.attrib[&quot;name&quot;]
+                z.lightList.append(name)
+                
+            soundNodes = zone.getiterator(&quot;sound&quot;)
+            for sound in soundNodes:
+                name = sound.attrib[&quot;name&quot;]
+                z.soundList.append(name)
+            
+
+    def saveZonesToXml(self, root, map):
+        if len(map.zoneList) == 0:
+            return
+        
+        rootZonesElem = xml.SubElement(root, &quot;zones&quot;)
+        for zone in map.zoneList:
+            zoneElem = xml.SubElement(rootZonesElem, &quot;zone&quot;)
+            zoneElem.attrib[&quot;name&quot;] = zone.name
+            
+            for area in zone.areaList:
+                areaElem = xml.SubElement(zoneElem, &quot;area&quot;)
+                areaElem.attrib[&quot;type&quot;] = area.type
+                #print &quot;Saving Zone: &quot; + zone.name + &quot; - Area &quot; + str(area.id)
+                if area.type == &quot;mesh&quot; and area.meshFile is not None:
+                    areaElem.attrib[&quot;meshfile&quot;] = area.meshFile
+                    
+                posElem = xml.SubElement(areaElem, &quot;position&quot;)
+                posElem.attrib[&quot;x&quot;] = str(area.areaNode.getPosition().x)
+                posElem.attrib[&quot;y&quot;] = str(area.areaNode.getPosition().y)
+                posElem.attrib[&quot;z&quot;] = str(area.areaNode.getPosition().z)
+                
+                rotElem = xml.SubElement(areaElem, &quot;rotation&quot;)
+                rotElem.attrib[&quot;qw&quot;] = str(area.areaNode.getOrientation().w)
+                rotElem.attrib[&quot;qx&quot;] = str(area.areaNode.getOrientation().x)
+                rotElem.attrib[&quot;qy&quot;] = str(area.areaNode.getOrientation().y)
+                rotElem.attrib[&quot;qz&quot;] = str(area.areaNode.getOrientation().z)
+                
+                scaleElem = None
+                if area.type == &quot;mesh&quot;:
+                    scaleElem = xml.SubElement(areaElem, &quot;scale&quot;)
+                else:
+                    scaleElem = xml.SubElement(areaElem, &quot;size&quot;)
+
+                scaleElem.attrib[&quot;x&quot;] = str(area.areaNode.getScale().x)
+                scaleElem.attrib[&quot;y&quot;] = str(area.areaNode.getScale().y)
+                scaleElem.attrib[&quot;z&quot;] = str(area.areaNode.getScale().z)
+                
+            for lightName in zone.lightList:
+                lightElem = xml.SubElement(zoneElem, &quot;light&quot;)
+                lightElem.attrib[&quot;name&quot;] = str(lightName)
+            
+            for soundName in zone.soundList:
+                soundElem = xml.SubElement(zoneElem, &quot;sound&quot;)
+                soundElem.attrib[&quot;name&quot;] = str(soundName)
+                
+    def deleteArea(self, area):
+        for z in self.zoneList:
+            for a in z.areaList:
+                if a.id == area.id:
+                    z.deleteArea(area)
+    
+    def getZoneMenu(self):
+        self.menuList = []
+        menu = QMenu(&quot;Add Area&quot;)
+        
+        for zone in self.zoneList:
+            m = QMenu(zone.name)
+            self.menuList.append(m)
+            menu.addMenu(m)
+            
+            boxAction = self.createAction(&quot;box&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;box&quot;))
+            self.menuList.append(boxAction)
+            m.addAction(boxAction)
+            
+            sphereAction = self.createAction(&quot;sphere&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;sphere&quot;))
+            self.menuList.append(sphereAction)
+            m.addAction(sphereAction)
+            
+            ellipsoidAction = self.createAction(&quot;ellipsoid&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;ellipsoid&quot;))
+            self.menuList.append(ellipsoidAction)
+            m.addAction(ellipsoidAction)
+            
+            capsuleAction = self.createAction(&quot;capsule&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;capsule&quot;))
+            self.menuList.append(capsuleAction)
+            m.addAction(capsuleAction)
+            
+            pyramidAction = self.createAction(&quot;pyramid&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;pyramid&quot;))
+            self.menuList.append(pyramidAction)
+            m.addAction(pyramidAction)
+            
+            meshAction = self.createAction(&quot;mesh&quot;, functools.partial(self.onZoneNameTriggered, zone, &quot;mesh&quot;))
+            self.menuList.append(meshAction)
+            m.addAction(meshAction)
+            
+        return menu
+        
+    def onZoneNameTriggered(self, zone, type):
+        if self.newAreaPosition is not None:
+            if type == &quot;box&quot;:
+                zone.addArea(&quot;box&quot;, self.newAreaPosition, None, None)
+            elif type == &quot;sphere&quot;:
+                zone.addArea(&quot;sphere&quot;, self.newAreaPosition, None, None)
+            elif type == &quot;mesh&quot;:
+                dlg = NameInputDlg(QApplication.focusWidget())
+                resName = &quot;&quot;
+                if dlg.exec_():
+                    resName = str(dlg.nameInput.text())
+
+                zone.addArea(&quot;mesh&quot;, self.newAreaPosition, None, None, resName)
+                
+    def getZone(self, name):
+        for zone in self.zoneList:
+            if zone.name == name:
+                return zone
+        
+    def getZoneList(self):
+        list = []
+        for zone in self.zoneList:
+            list.append(zone.name)
+            
+        return list
+        
+    def createAction(self, text, slot=None, shortcut=None, icon=None, tip=None, checkable=False, signal=&quot;triggered()&quot;):
+        action = QAction(text, None)
+        if icon is not None:
+            action.setIcon(QIcon(&quot;media/icons/%s&quot; % icon))
+        if shortcut is not None:
+            action.setShortcut(shortcut)
+        if tip is not None:
+            action.setToolTip(tip)
+            action.setStatusTip(tip)
+        if slot is not None:
+            QWidget.connect(action, SIGNAL(signal), slot)
+
+        action.setCheckable(checkable)
+
+        return action
+        
+        
+        

Added: rl/trunk/editors/Lockenwickler/ui files/AddTriggerDialog.ui
===================================================================
--- rl/trunk/editors/Lockenwickler/ui files/AddTriggerDialog.ui	2009-04-17 19:24:20 UTC (rev 4903)
+++ rl/trunk/editors/Lockenwickler/ui files/AddTriggerDialog.ui	2009-04-19 14:55:07 UTC (rev 4904)
@@ -0,0 +1,125 @@
+&lt;ui version=&quot;4.0&quot; &gt;
+ &lt;class&gt;Dialog&lt;/class&gt;
+ &lt;widget class=&quot;QDialog&quot; name=&quot;Dialog&quot; &gt;
+  &lt;property name=&quot;geometry&quot; &gt;
+   &lt;rect&gt;
+    &lt;x&gt;0&lt;/x&gt;
+    &lt;y&gt;0&lt;/y&gt;
+    &lt;width&gt;354&lt;/width&gt;
+    &lt;height&gt;500&lt;/height&gt;
+   &lt;/rect&gt;
+  &lt;/property&gt;
+  &lt;property name=&quot;windowTitle&quot; &gt;
+   &lt;string&gt;Dialog&lt;/string&gt;
+  &lt;/property&gt;
+  &lt;layout class=&quot;QGridLayout&quot; name=&quot;gridLayout&quot; &gt;
+   &lt;item row=&quot;2&quot; column=&quot;0&quot; &gt;
+    &lt;widget class=&quot;QLabel&quot; name=&quot;label_2&quot; &gt;
+     &lt;property name=&quot;text&quot; &gt;
+      &lt;string&gt;Identifier Name&lt;/string&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;alignment&quot; &gt;
+      &lt;set&gt;Qt::AlignCenter&lt;/set&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;buddy&quot; &gt;
+      &lt;cstring&gt;lineEdit&lt;/cstring&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;3&quot; column=&quot;0&quot; &gt;
+    &lt;widget class=&quot;QLineEdit&quot; name=&quot;lineEdit&quot; /&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;4&quot; column=&quot;0&quot; &gt;
+    &lt;widget class=&quot;QLabel&quot; name=&quot;label_3&quot; &gt;
+     &lt;property name=&quot;text&quot; &gt;
+      &lt;string&gt;Properties&lt;/string&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;alignment&quot; &gt;
+      &lt;set&gt;Qt::AlignCenter&lt;/set&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;buddy&quot; &gt;
+      &lt;cstring&gt;pushButton&lt;/cstring&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;5&quot; column=&quot;0&quot; &gt;
+    &lt;widget class=&quot;QPushButton&quot; name=&quot;pushButton&quot; &gt;
+     &lt;property name=&quot;layoutDirection&quot; &gt;
+      &lt;enum&gt;Qt::LeftToRight&lt;/enum&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;text&quot; &gt;
+      &lt;string&gt;Add Property&lt;/string&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;6&quot; column=&quot;0&quot; &gt;
+    &lt;widget class=&quot;QListView&quot; name=&quot;listView&quot; /&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;7&quot; column=&quot;0&quot; &gt;
+    &lt;widget class=&quot;QDialogButtonBox&quot; name=&quot;buttonBox&quot; &gt;
+     &lt;property name=&quot;standardButtons&quot; &gt;
+      &lt;set&gt;QDialogButtonBox::Cancel|QDialogButtonBox::Ok&lt;/set&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;1&quot; column=&quot;0&quot; &gt;
+    &lt;widget class=&quot;QComboBox&quot; name=&quot;comboBox&quot; /&gt;
+   &lt;/item&gt;
+   &lt;item row=&quot;0&quot; column=&quot;0&quot; &gt;
+    &lt;widget class=&quot;QLabel&quot; name=&quot;label&quot; &gt;
+     &lt;property name=&quot;text&quot; &gt;
+      &lt;string&gt;ClassName&lt;/string&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;alignment&quot; &gt;
+      &lt;set&gt;Qt::AlignCenter&lt;/set&gt;
+     &lt;/property&gt;
+     &lt;property name=&quot;buddy&quot; &gt;
+      &lt;cstring&gt;comboBox&lt;/cstring&gt;
+     &lt;/property&gt;
+    &lt;/widget&gt;
+   &lt;/item&gt;
+  &lt;/layout&gt;
+ &lt;/widget&gt;
+ &lt;tabstops&gt;
+  &lt;tabstop&gt;comboBox&lt;/tabstop&gt;
+  &lt;tabstop&gt;lineEdit&lt;/tabstop&gt;
+  &lt;tabstop&gt;pushButton&lt;/tabstop&gt;
+  &lt;tabstop&gt;listView&lt;/tabstop&gt;
+  &lt;tabstop&gt;buttonBox&lt;/tabstop&gt;
+ &lt;/tabstops&gt;
+ &lt;resources/&gt;
+ &lt;connections&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;buttonBox&lt;/sender&gt;
+   &lt;signal&gt;accepted()&lt;/signal&gt;
+   &lt;receiver&gt;Dialog&lt;/receiver&gt;
+   &lt;slot&gt;accept()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot; &gt;
+     &lt;x&gt;301&lt;/x&gt;
+     &lt;y&gt;469&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot; &gt;
+     &lt;x&gt;329&lt;/x&gt;
+     &lt;y&gt;478&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+  &lt;connection&gt;
+   &lt;sender&gt;buttonBox&lt;/sender&gt;
+   &lt;signal&gt;rejected()&lt;/signal&gt;
+   &lt;receiver&gt;Dialog&lt;/receiver&gt;
+   &lt;slot&gt;reject()&lt;/slot&gt;
+   &lt;hints&gt;
+    &lt;hint type=&quot;sourcelabel&quot; &gt;
+     &lt;x&gt;208&lt;/x&gt;
+     &lt;y&gt;470&lt;/y&gt;
+    &lt;/hint&gt;
+    &lt;hint type=&quot;destinationlabel&quot; &gt;
+     &lt;x&gt;205&lt;/x&gt;
+     &lt;y&gt;485&lt;/y&gt;
+    &lt;/hint&gt;
+   &lt;/hints&gt;
+  &lt;/connection&gt;
+ &lt;/connections&gt;
+&lt;/ui&gt;


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001960.html">[Dsa-hl-svn] r4903 - rl/trunk/editors/Lockenwickler/src
</A></li>
	<LI>Next message: <A HREF="001962.html">[Dsa-hl-svn] r4905 - in rl/trunk/engine: core core/include core/src	script/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1961">[ date ]</a>
              <a href="thread.html#1961">[ thread ]</a>
              <a href="subject.html#1961">[ subject ]</a>
              <a href="author.html#1961">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
