<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4599 - in rl/branches/persistence: core/include	core/src script/src ui/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2008-November/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4599%20-%20in%20rl/branches/persistence%3A%20core/include%0A%09core/src%20script/src%20ui/src&In-Reply-To=%3C200811211529.mALFTDJG024872%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001655.html">
   <LINK REL="Next"  HREF="001657.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4599 - in rl/branches/persistence: core/include	core/src script/src ui/src</H1>
    <B>timm at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4599%20-%20in%20rl/branches/persistence%3A%20core/include%0A%09core/src%20script/src%20ui/src&In-Reply-To=%3C200811211529.mALFTDJG024872%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4599 - in rl/branches/persistence: core/include	core/src script/src ui/src">timm at mail.berlios.de
       </A><BR>
    <I>Fri Nov 21 16:29:13 CET 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001655.html">[Dsa-hl-svn] r4598 - modules/branch_persistenz/materials/textures
</A></li>
        <LI>Next message: <A HREF="001657.html">[Dsa-hl-svn] r4600 - in rl/trunk: . engine/rules/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1656">[ date ]</a>
              <a href="thread.html#1656">[ thread ]</a>
              <a href="subject.html#1656">[ subject ]</a>
              <a href="author.html#1656">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: timm
Date: 2008-11-21 16:28:58 +0100 (Fri, 21 Nov 2008)
New Revision: 4599

Modified:
   rl/branches/persistence/core/include/ListenerMovable.h
   rl/branches/persistence/core/include/MovableText.h
   rl/branches/persistence/core/include/Sound.h
   rl/branches/persistence/core/include/SoundResource.h
   rl/branches/persistence/core/include/SoundStitching.h
   rl/branches/persistence/core/src/Actor.cpp
   rl/branches/persistence/core/src/ListenerMovable.cpp
   rl/branches/persistence/core/src/MovableText.cpp
   rl/branches/persistence/core/src/PhysicalThing.cpp
   rl/branches/persistence/core/src/PhysicsManager.cpp
   rl/branches/persistence/core/src/Sound.cpp
   rl/branches/persistence/core/src/SoundResource.cpp
   rl/branches/persistence/core/src/SoundStitching.cpp
   rl/branches/persistence/script/src/PlaneNodeProcessor.cpp
   rl/branches/persistence/ui/src/DebugWindow.cpp
   rl/branches/persistence/ui/src/DialogControlState.cpp
   rl/branches/persistence/ui/src/InventoryWindow.cpp
Log:
merged with current trunk

Modified: rl/branches/persistence/core/include/ListenerMovable.h
===================================================================
--- rl/branches/persistence/core/include/ListenerMovable.h	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/include/ListenerMovable.h	2008-11-21 15:28:58 UTC (rev 4599)
@@ -1,94 +1,98 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
-*/
-
-#ifndef __ListenerMovable_H__
-#define __ListenerMovable_H__
-
-#include &quot;CorePrerequisites.h&quot;
-
-
-namespace rl {
-    
-   /** Diese Klasse dient der Interaktion mit Ogre3d und
-    * kapselt den H&#246;rer.
-    * @author Josch
-    * @date 06-29-2005
-    * @version 1.0
-    * @version 2.0
-    */
-    class _RlCoreExport ListenerMovable : public Ogre::MovableObject
-    {
-    public:
-        /// Konstruktor
-        ListenerMovable(const Ogre::String&amp; name);
-        /// Destruktor
-        virtual ~ListenerMovable() = 0;
-        /// Name zur&#252;ckgeben
-        virtual const Ogre::String&amp; getName() const;
-        /// Moveable-Typ
-        virtual const Ogre::String&amp; getMovableType() const;
-        /// Kamera informieren
-        virtual void _notifyCurrentCamera(Ogre::Camera *cam);
-        /// Unsere Bounding-Box
-        virtual const Ogre::AxisAlignedBox&amp; getBoundingBox(void) const;
-        /// Bound-Radius
-        virtual Ogre::Real getBoundingRadius() const;
-        /// Rendern
-        virtual void _updateRenderQueue(Ogre::RenderQueue *queue);
-    
-        /// Gibt die Hauptlautstaerke zurueck
-        virtual const int getGain() const;
-        /// Setzt die Hauptlautstaerke.
-        virtual void setGain(const int direction);
-        /// Gibt die eingestellte Position der Soundquelle zurueck
-        virtual const Ogre::Vector3 getPosition() const;
-        /// Setzt die Position der Soundquelle.
-        virtual void setPosition(const Ogre::Vector3&amp; direction);
-        /// Gibt die Richtung der Soundquelle zurueck.
-        virtual const Ogre::Quaternion getOrientation() const;
-        /// Gibt die Geschwindigkeit der Soundquelle zurueck.
-        virtual const Ogre::Vector3 getVelocity() const;
-        /// Setzt die Richtung der Soundquelle.
-        virtual void setOrientation(const Ogre::Quaternion &amp;orientation);
-        /// Setzt die Geschwindigkeit der Soundquelle.
-        virtual void setVelocity(const Ogre::Vector3&amp;);
-        
-        /// Ist dies der aktuelle Listener
-        bool isActive() const;
-		void setActive(bool active);
-        
-    protected:
-         /// Shared class-level name for Movable type
-        static Ogre::String msMovableType;
-        /// Alignment-Box: gebraucht von MovableObject.
-        static Ogre::AxisAlignedBox msAABox;
-        /// Position
-        Ogre::Vector3 mPosition;
-        /// Geschwindigkeit
-        Ogre::Vector3 mVelocity;
-        /// Orientierung
-        Ogre::Quaternion mOrientation;
-        /// Hauptlautst&#228;rke
-        int mGain;
-
-    private:
-        /// Der Name des ListenerMovable
-        Ogre::String mName;
-		bool mActive;
-    };
-
-}
-#endif
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+
+#ifndef __ListenerMovable_H__
+#define __ListenerMovable_H__
+
+#include &quot;CorePrerequisites.h&quot;
+
+
+namespace rl {
+    
+   /** Diese Klasse dient der Interaktion mit Ogre3d und
+    * kapselt den H&#246;rer.
+    * @author Josch
+    * @date 06-29-2005
+    * @version 1.0
+    * @version 2.0
+    */
+    class _RlCoreExport ListenerMovable : public Ogre::MovableObject
+    {
+    public:
+        /// Konstruktor
+        ListenerMovable(const Ogre::String&amp; name);
+        /// Destruktor
+        virtual ~ListenerMovable() = 0;
+        /// Name zur&#252;ckgeben
+        virtual const Ogre::String&amp; getName() const;
+        /// Moveable-Typ
+        virtual const Ogre::String&amp; getMovableType() const;
+        /// Kamera informieren
+        virtual void _notifyCurrentCamera(Ogre::Camera *cam);
+        /// Unsere Bounding-Box
+        virtual const Ogre::AxisAlignedBox&amp; getBoundingBox(void) const;
+        /// Bound-Radius
+        virtual Ogre::Real getBoundingRadius() const;
+        /// Rendern
+        virtual void _updateRenderQueue(Ogre::RenderQueue *queue);
+    
+        /// Gibt die Hauptlautstaerke zurueck
+        virtual const int getGain() const;
+        /// Setzt die Hauptlautstaerke.
+        virtual void setGain(const int direction);
+        /// Gibt die eingestellte Position der Soundquelle zurueck
+        virtual const Ogre::Vector3 getPosition() const;
+        /// Setzt die Position der Soundquelle.
+        virtual void setPosition(const Ogre::Vector3&amp; direction);
+        /// Gibt die Richtung der Soundquelle zurueck.
+        virtual const Ogre::Quaternion getOrientation() const;
+        /// Gibt die Geschwindigkeit der Soundquelle zurueck.
+        virtual const Ogre::Vector3 getVelocity() const;
+        /// Setzt die Richtung der Soundquelle.
+        virtual void setOrientation(const Ogre::Quaternion &amp;orientation);
+        /// Setzt die Geschwindigkeit der Soundquelle.
+        virtual void setVelocity(const Ogre::Vector3&amp;);
+        
+        /// Ist dies der aktuelle Listener
+        bool isActive() const;
+		void setActive(bool active);
+
+		/// From MovableObject
+		virtual void visitRenderables(Ogre::Renderable::Visitor* visitor, 
+			bool debugRenderables = false);
+        
+    protected:
+         /// Shared class-level name for Movable type
+        static Ogre::String msMovableType;
+        /// Alignment-Box: gebraucht von MovableObject.
+        static Ogre::AxisAlignedBox msAABox;
+        /// Position
+        Ogre::Vector3 mPosition;
+        /// Geschwindigkeit
+        Ogre::Vector3 mVelocity;
+        /// Orientierung
+        Ogre::Quaternion mOrientation;
+        /// Hauptlautst&#228;rke
+        int mGain;
+
+    private:
+        /// Der Name des ListenerMovable
+        Ogre::String mName;
+		bool mActive;
+    };
+
+}
+#endif

Modified: rl/branches/persistence/core/include/MovableText.h
===================================================================
--- rl/branches/persistence/core/include/MovableText.h	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/include/MovableText.h	2008-11-21 15:28:58 UTC (rev 4599)
@@ -63,6 +63,7 @@
         const Ogre::String&amp; getMovableType(void) const { return msType; }
         Ogre::Real getBoundingRadius(void) const {return mRadius;}
         Ogre::Real getSquaredViewDepth(const Ogre::Camera* cam) const { return 0; }
+		void visitRenderables(Ogre::Renderable::Visitor* visitor,  bool debugRenderables = false);
  
         // from renderable
         void getRenderOperation(Ogre::RenderOperation &amp;op);

Modified: rl/branches/persistence/core/include/Sound.h
===================================================================
--- rl/branches/persistence/core/include/Sound.h	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/include/Sound.h	2008-11-21 15:28:58 UTC (rev 4599)
@@ -1,163 +1,167 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
-*/
-
-#ifndef __Sound_H__
-#define __Sound_H__
-
-#include &quot;CorePrerequisites.h&quot;
-#include &lt;set&gt;
-
-#include &quot;Exception.h&quot;
-#include &quot;EventCaster.h&quot;
-#include &quot;SoundEvents.h&quot;
-#include &quot;SoundResource.h&quot;
-
-namespace rl {
-
-    class SoundDriver;
-
-   /** Diese Klasse dient der Interaktion mit dem jeweiligen Soundsystem
-    * ein Objekt stellt eine einzelne Sounddatei oder einen Stream dar
-    * @author Josch
-    * @date 06-29-2005
-    * @version 1.0
-    * @version 2.0
-    */
-    class _RlCoreExport Sound : public Ogre::MovableObject, 
-        public EventCaster&lt;SoundEvent&gt;, public EventSource
-    {
-    public:
-        // Einige Standardwerte f&#195;&#188;r Soundpriorit&#195;&#164;ten.
-        enum SOUND_PRIORITY {
-            PRIO_SPEECH = 30,
-            PRIO_MUSIC = 75,
-            PRIO_SFX_ENVIRONMENT = 128,
-            PRIO_SFX_OTHER = 175,
-            PRIO_OTHER = 220
-        };
-
-        /// Konstruktor
-        Sound(const SoundResourcePtr&amp; soundres, SoundDriver* creator);
-        /// Destruktor
-        virtual ~Sound();
-          
-        /// Laedt den Sound.
-        virtual void load() throw (RuntimeException) = 0;
-        /// Entlaedt den Sound.
-        virtual void unload() throw (RuntimeException) = 0;
-
-        // SoundResource zurueckgeben.
-        const SoundResourcePtr&amp; getSoundResource() const;
-        // Wollen wir 3D?
-        bool is3d() const;
-        // Setzen des 3D-Flags.
-        void set3d(bool is3d);
-        // Sind wir gueltig
-        virtual bool isValid() const throw (RuntimeException) = 0;
-        
-        // Sollen der Sound wiederholt werden?
-        bool isLooping() const;
-        // Setzen des Loop-Flags.
-        void setLooping(bool looping);
-
-        virtual float getLength() const = 0;
-
-        /// Unsere Bounding-Box
-        virtual const Ogre::AxisAlignedBox&amp; getBoundingBox(void) const;
-        /// Bound-Radius
-        virtual Ogre::Real getBoundingRadius() const;
-        /// Rendern
-        virtual void _updateRenderQueue(Ogre::RenderQueue *queue);
-
-
-        /// Gibt die eingestellte Position der Soundquelle zurueck
-        virtual const Ogre::Vector3 getPosition() const = 0;
-        /// Setzt die Position der Soundquelle.
-        virtual void setPosition(const Ogre::Vector3&amp; direction) = 0;
-        /// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck (0.0 ... 1.0)
-	    virtual const Ogre::Real getVolume() const = 0; 
-        /// Setzt die relative Lautstaerke der Soundquelle (0.0 .. 1.0).
-	    virtual void setVolume(const Ogre::Real gain) = 0;
-        /// Gibt die Richtung der Soundquelle zurueck.
-        virtual const Ogre::Quaternion getDirection() const = 0;
-        /// Gibt die Geschwindigkeit der Soundquelle zurueck.
-        virtual const Ogre::Vector3 getVelocity() const = 0;
-        /// Setzt die Richtung der Soundquelle.
-        virtual void setDirection(const Ogre::Quaternion&amp;) = 0;
-        /// Setzt die Geschwindigkeit der Soundquelle.
-        virtual void setVelocity(const Ogre::Vector3&amp;) = 0;
-	    /// Setzt die Entfernung, ab der ein 3D-Sound leiser wird
-	    virtual void setRolloffStartDistance(const Ogre::Real&amp;);
-	    virtual const Ogre::Real getRolloffStartDistance() const;
-	    /// Setzt die Entfernung, ab der ein 3D-Sound nicht mehr leiser wird
-	    virtual void setRolloffEndDistance(const Ogre::Real&amp;);
-	    virtual const Ogre::Real getRolloffEndDistance() const;
-        // Sets the priority of this sound
-        virtual void setPriority(const int priority) = 0;
-        // Gets the priority of this sound
-        virtual const int getPriority() const = 0;
-
-        /// Spielt den Sound ab.
-        virtual void play(bool destroyWhenDone=false) = 0;
-        /// Pausiert den Sound.
-        virtual void pause(bool pausing) = 0;
-        /// Ist der Sound pausiert?
-        virtual bool isPaused() = 0;
-        /// Stoppt den Sound.
-        virtual void stop() = 0;
-        /// Zurueck auf Anfang.
-    //        virtual void rewind() throw (RuntimeException) = 0;
-        /// Laeuft der Sound noch
-        virtual const bool isPlaying() const = 0;
-
-    protected:
-        SoundDriver* mCreator;
-
-        /// Die Lautstaerke
-	    Ogre::Real mVolume;
-        /// Die Position
-        Ogre::Vector3 mPosition;
-        /// Die Richtung
-        Ogre::Quaternion mDirection;
-        /// Die Geschwindigkeit
-        Ogre::Vector3 mVelocity;
-        /// The priority of this sound
-        int mPriority;
-
-	    Ogre::Real mRolloffStartDistance;
-	    Ogre::Real mRolloffEndDistance;
-
-    private:
-        /// Shared class-level name for Movable type
-        static Ogre::AxisAlignedBox msAABox;
-
-        /// Der Soundresource, auf den wir verweisen.
-        SoundResourcePtr mSoundResource;
-
-        // Damit die Timings alle 0.5 sek. abgeschickt werden.
-        int mTicks;
-        // Ob dieser Sound 3D sein soll.
-        bool mIs3d;
-        // Ob dieser Sound loopen soll.
-        bool mIsLooping;
-        
-    }; 
-
-
-    typedef std::set&lt;Sound*&gt; SoundSet;
-
-}
-#endif
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+
+#ifndef __Sound_H__
+#define __Sound_H__
+
+#include &quot;CorePrerequisites.h&quot;
+#include &lt;set&gt;
+
+#include &quot;Exception.h&quot;
+#include &quot;EventCaster.h&quot;
+#include &quot;SoundEvents.h&quot;
+#include &quot;SoundResource.h&quot;
+
+namespace rl {
+
+    class SoundDriver;
+
+   /** Diese Klasse dient der Interaktion mit dem jeweiligen Soundsystem
+    * ein Objekt stellt eine einzelne Sounddatei oder einen Stream dar
+    * @author Josch
+    * @date 06-29-2005
+    * @version 1.0
+    * @version 2.0
+    */
+    class _RlCoreExport Sound : public Ogre::MovableObject, 
+        public EventCaster&lt;SoundEvent&gt;, public EventSource
+    {
+    public:
+        // Einige Standardwerte f&#195;&#188;r Soundpriorit&#195;&#164;ten.
+        enum SOUND_PRIORITY {
+            PRIO_SPEECH = 30,
+            PRIO_MUSIC = 75,
+            PRIO_SFX_ENVIRONMENT = 128,
+            PRIO_SFX_OTHER = 175,
+            PRIO_OTHER = 220
+        };
+
+        /// Konstruktor
+        Sound(const SoundResourcePtr&amp; soundres, SoundDriver* creator);
+        /// Destruktor
+        virtual ~Sound();
+          
+        /// Laedt den Sound.
+        virtual void load() throw (RuntimeException) = 0;
+        /// Entlaedt den Sound.
+        virtual void unload() throw (RuntimeException) = 0;
+
+        // SoundResource zurueckgeben.
+        const SoundResourcePtr&amp; getSoundResource() const;
+        // Wollen wir 3D?
+        bool is3d() const;
+        // Setzen des 3D-Flags.
+        void set3d(bool is3d);
+        // Sind wir gueltig
+        virtual bool isValid() const throw (RuntimeException) = 0;
+        
+        // Sollen der Sound wiederholt werden?
+        bool isLooping() const;
+        // Setzen des Loop-Flags.
+        void setLooping(bool looping);
+
+        virtual float getLength() const = 0;
+
+        /// Unsere Bounding-Box
+        virtual const Ogre::AxisAlignedBox&amp; getBoundingBox(void) const;
+        /// Bound-Radius
+        virtual Ogre::Real getBoundingRadius() const;
+        /// Rendern
+        virtual void _updateRenderQueue(Ogre::RenderQueue *queue);
+
+
+        /// Gibt die eingestellte Position der Soundquelle zurueck
+        virtual const Ogre::Vector3 getPosition() const = 0;
+        /// Setzt die Position der Soundquelle.
+        virtual void setPosition(const Ogre::Vector3&amp; direction) = 0;
+        /// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck (0.0 ... 1.0)
+	    virtual const Ogre::Real getVolume() const = 0; 
+        /// Setzt die relative Lautstaerke der Soundquelle (0.0 .. 1.0).
+	    virtual void setVolume(const Ogre::Real gain) = 0;
+        /// Gibt die Richtung der Soundquelle zurueck.
+        virtual const Ogre::Quaternion getDirection() const = 0;
+        /// Gibt die Geschwindigkeit der Soundquelle zurueck.
+        virtual const Ogre::Vector3 getVelocity() const = 0;
+        /// Setzt die Richtung der Soundquelle.
+        virtual void setDirection(const Ogre::Quaternion&amp;) = 0;
+        /// Setzt die Geschwindigkeit der Soundquelle.
+        virtual void setVelocity(const Ogre::Vector3&amp;) = 0;
+	    /// Setzt die Entfernung, ab der ein 3D-Sound leiser wird
+	    virtual void setRolloffStartDistance(const Ogre::Real&amp;);
+	    virtual const Ogre::Real getRolloffStartDistance() const;
+	    /// Setzt die Entfernung, ab der ein 3D-Sound nicht mehr leiser wird
+	    virtual void setRolloffEndDistance(const Ogre::Real&amp;);
+	    virtual const Ogre::Real getRolloffEndDistance() const;
+        // Sets the priority of this sound
+        virtual void setPriority(const int priority) = 0;
+        // Gets the priority of this sound
+        virtual const int getPriority() const = 0;
+
+        /// Spielt den Sound ab.
+        virtual void play(bool destroyWhenDone=false) = 0;
+        /// Pausiert den Sound.
+        virtual void pause(bool pausing) = 0;
+        /// Ist der Sound pausiert?
+        virtual bool isPaused() = 0;
+        /// Stoppt den Sound.
+        virtual void stop() = 0;
+        /// Zurueck auf Anfang.
+    //        virtual void rewind() throw (RuntimeException) = 0;
+        /// Laeuft der Sound noch
+        virtual const bool isPlaying() const = 0;
+
+	/// From MovableObject
+		virtual void visitRenderables(Ogre::Renderable::Visitor* visitor, 
+			bool debugRenderables = false);
+	
+	protected:
+        SoundDriver* mCreator;
+
+        /// Die Lautstaerke
+	    Ogre::Real mVolume;
+        /// Die Position
+        Ogre::Vector3 mPosition;
+        /// Die Richtung
+        Ogre::Quaternion mDirection;
+        /// Die Geschwindigkeit
+        Ogre::Vector3 mVelocity;
+        /// The priority of this sound
+        int mPriority;
+
+	    Ogre::Real mRolloffStartDistance;
+	    Ogre::Real mRolloffEndDistance;
+
+    private:
+        /// Shared class-level name for Movable type
+        static Ogre::AxisAlignedBox msAABox;
+
+        /// Der Soundresource, auf den wir verweisen.
+        SoundResourcePtr mSoundResource;
+
+        // Damit die Timings alle 0.5 sek. abgeschickt werden.
+        int mTicks;
+        // Ob dieser Sound 3D sein soll.
+        bool mIs3d;
+        // Ob dieser Sound loopen soll.
+        bool mIsLooping;
+        
+    }; 
+
+
+    typedef std::set&lt;Sound*&gt; SoundSet;
+
+}
+#endif

Modified: rl/branches/persistence/core/include/SoundResource.h
===================================================================
--- rl/branches/persistence/core/include/SoundResource.h	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/include/SoundResource.h	2008-11-21 15:28:58 UTC (rev 4599)
@@ -33,10 +33,6 @@
  */
 class _RlCoreExport SoundResource: public Ogre::Resource
 {
-    private:
-        /// Unsere Daten von Ogres ResourceManager.
-        Ogre::DataStreamPtr mDataStream;
-                       
     public:
         /// Der Standardkonstruktor
         SoundResource(Ogre::ResourceManager* creator, const Ogre::String&amp; name, 
@@ -44,10 +40,8 @@
             Ogre::ManualResourceLoader* loader);
         /// Der Destruktor
         virtual ~SoundResource();
-        /// Den Datenstrom zur&#239;&#191;&#189;ckgeben
+        /// Den Datenstrom zurueckgeben
         const Ogre::DataStreamPtr &amp;getDataStream() const;
-        /// Groesse zurueckgeben.
-        int getSize() const;
 
     protected:
 		/// Laedt die Soundquelle.
@@ -57,6 +51,10 @@
 		/// Bestimmt die Groesse im Speicher (wird erst nach dem Laden aufgerufen)
 		virtual size_t calculateSize() const;        
         
+
+	private:
+        /// Unsere Daten von Ogres ResourceManager.
+        Ogre::DataStreamPtr mDataStream;
 };
 
 class _RlCoreExport SoundResourcePtr :

Modified: rl/branches/persistence/core/include/SoundStitching.h
===================================================================
--- rl/branches/persistence/core/include/SoundStitching.h	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/include/SoundStitching.h	2008-11-21 15:28:58 UTC (rev 4599)
@@ -1,178 +1,182 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
-*/
-
-#ifndef __SoundStitching_H__
-#define __SoundStitching_H__
-
-#include &quot;CorePrerequisites.h&quot;
-#include &lt;set&gt;
-
-#include &quot;Exception.h&quot;
-#include &quot;EventCaster.h&quot;
-#include &quot;SoundEvents.h&quot;
-#include &quot;SoundResource.h&quot;
-
-namespace rl {
-
-    class SoundDriver;
-
-    typedef std::map&lt;CeGuiString, SoundResourcePtr&gt; SoundCache;
-
-   /** Diese Klasse dient der Interaktion mit dem jeweiligen Soundsystem
-    * ein Objekt stellt eine einzelne Sounddatei oder einen Stream dar
-    * @author Josch
-    * @date 06-29-2005
-    * @version 1.0
-    * @version 2.0
-    */
-    class _RlCoreExport SoundStitching : public Ogre::MovableObject, 
-        public EventCaster&lt;SoundEvent&gt;, public EventSource
-    {
-    public:
-        // Einige Standardwerte f&#195;&#188;r Soundpriorit&#195;&#164;ten.
-        enum SOUND_PRIORITY {
-            PRIO_SPEECH = 30,
-            PRIO_MUSIC = 75,
-            PRIO_SFX_ENVIRONMENT = 128,
-            PRIO_SFX_OTHER = 175,
-            PRIO_OTHER = 220
-        };
-
-        /// Konstruktor
-        SoundStitching(unsigned int numSlots, const CeGuiString&amp; name, SoundDriver* creator);
-        /// Destruktor
-        virtual ~SoundStitching();
-          
-        /// Laedt den Sound.
-        virtual void load() throw (RuntimeException) = 0;
-        /// Entlaedt den Sound.
-        virtual void unload() throw (RuntimeException) = 0;
-
-        virtual float getLength() const;
-
-        // SoundResource zurueckgeben.
-        const SoundResourcePtr&amp; getSoundResource() const;
-        // Wollen wir 3D?
-        bool is3d() const;
-        // Setzen des 3D-Flags.
-        void set3d(bool is3d);
-        // Sind wir gueltig
-        virtual bool isValid() const throw (RuntimeException) = 0;
-        
-        // Sollen der Sound wiederholt werden?
-        bool isLooping() const;
-        // Setzen des Loop-Flags.
-        void setLooping(bool looping);
-
-        /// Unsere Bounding-Box
-        virtual const Ogre::AxisAlignedBox&amp; getBoundingBox(void) const;
-        /// Bound-Radius
-        virtual Ogre::Real getBoundingRadius() const;
-        /// Rendern
-        virtual void _updateRenderQueue(Ogre::RenderQueue *queue);
-
-        /// Count of configured slots.
-        unsigned int getNumSlots();
-        /// Add a sound resource to the cache overwritting existing sound resource.
-        virtual void addSoundToCache(CeGuiString label, SoundResourcePtr sound);
-        /// Assign a sound recource to a slot.
-        virtual void putSoundIntoSlot(unsigned int, CeGuiString label) = 0;
-        /// Get the slot of the plaing sound.
-        virtual unsigned int getPlayingSlot() = 0;
-
-        /// Gibt die eingestellte Position der Soundquelle zurueck
-        virtual const Ogre::Vector3 getPosition() const = 0;
-        /// Setzt die Position der Soundquelle.
-        virtual void setPosition(const Ogre::Vector3&amp; direction) = 0;
-        /// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck (0.0 ... 1.0)
-	    virtual const Ogre::Real getVolume() const = 0; 
-        /// Setzt die relative Lautstaerke der Soundquelle (0.0 .. 1.0).
-	    virtual void setVolume(const Ogre::Real gain) = 0;
-        /// Gibt die Richtung der Soundquelle zurueck.
-        virtual const Ogre::Quaternion getDirection() const = 0;
-        /// Gibt die Geschwindigkeit der Soundquelle zurueck.
-        virtual const Ogre::Vector3 getVelocity() const = 0;
-        /// Setzt die Richtung der Soundquelle.
-        virtual void setDirection(const Ogre::Quaternion&amp;) = 0;
-        /// Setzt die Geschwindigkeit der Soundquelle.
-        virtual void setVelocity(const Ogre::Vector3&amp;) = 0;
-	    /// Setzt die Entfernung, ab der ein 3D-Sound leiser wird
-	    virtual void setRolloffStartDistance(const Ogre::Real&amp;);
-	    virtual const Ogre::Real getRolloffStartDistance() const;
-	    /// Setzt die Entfernung, ab der ein 3D-Sound nicht mehr leiser wird
-	    virtual void setRolloffEndDistance(const Ogre::Real&amp;);
-	    virtual const Ogre::Real getRolloffEndDistance() const;
-        // Sets the priority of this sound
-        virtual void setPriority(const int priority) = 0;
-        // Gets the priority of this sound
-        virtual const int getPriority() const = 0;
-
-        /// Spielt den Sound ab.
-        virtual void play(bool destroyWhenDone=false) = 0;
-        /// Pausiert den Sound.
-        virtual void pause(bool pausing) = 0;
-        /// Ist der Sound pausiert?
-        virtual bool isPaused() = 0;
-        /// Stoppt den Sound.
-        virtual void stop() = 0;
-        /// Laeuft der Sound noch
-        virtual const bool isPlaying() const = 0;
-
-    protected:
-        SoundDriver* mCreator;
-
-        /// Die Lautstaerke
-	    Ogre::Real mVolume;
-        /// Die Position
-        Ogre::Vector3 mPosition;
-        /// Die Richtung
-        Ogre::Quaternion mDirection;
-        /// Die Geschwindigkeit
-        Ogre::Vector3 mVelocity;
-        /// The priority of this sound
-        int mPriority;
-
-	    Ogre::Real mRolloffStartDistance;
-	    Ogre::Real mRolloffEndDistance;
-
-        // Sound-Cache
-        SoundCache mSoundCache;
-
-    private:
-        /// Shared class-level name for Movable type
-        static Ogre::AxisAlignedBox msAABox;
-
-        /// Der Soundresource, auf den wir verweisen.
-        SoundResourcePtr mSoundResource;
-
-        // Damit die Timings alle 0.5 sek. abgeschickt werden.
-        int mTicks;
-        // Ob dieser Sound 3D sein soll.
-        bool mIs3d;
-        // Ob dieser Sound loopen soll.
-        bool mIsLooping;
-
-        // Anzahl der Soundslots
-        unsigned int mNumSlots;
-
-        // Name
-        CeGuiString mName;
-        
-    }; 
-
-}
-#endif
-
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+
+#ifndef __SoundStitching_H__
+#define __SoundStitching_H__
+
+#include &quot;CorePrerequisites.h&quot;
+#include &lt;set&gt;
+
+#include &quot;Exception.h&quot;
+#include &quot;EventCaster.h&quot;
+#include &quot;SoundEvents.h&quot;
+#include &quot;SoundResource.h&quot;
+
+namespace rl {
+
+    class SoundDriver;
+
+    typedef std::map&lt;CeGuiString, SoundResourcePtr&gt; SoundCache;
+
+   /** Diese Klasse dient der Interaktion mit dem jeweiligen Soundsystem
+    * ein Objekt stellt eine einzelne Sounddatei oder einen Stream dar
+    * @author Josch
+    * @date 06-29-2005
+    * @version 1.0
+    * @version 2.0
+    */
+    class _RlCoreExport SoundStitching : public Ogre::MovableObject, 
+        public EventCaster&lt;SoundEvent&gt;, public EventSource
+    {
+    public:
+        // Einige Standardwerte f&#195;&#188;r Soundpriorit&#195;&#164;ten.
+        enum SOUND_PRIORITY {
+            PRIO_SPEECH = 30,
+            PRIO_MUSIC = 75,
+            PRIO_SFX_ENVIRONMENT = 128,
+            PRIO_SFX_OTHER = 175,
+            PRIO_OTHER = 220
+        };
+
+        /// Konstruktor
+        SoundStitching(unsigned int numSlots, const CeGuiString&amp; name, SoundDriver* creator);
+        /// Destruktor
+        virtual ~SoundStitching();
+          
+        /// Laedt den Sound.
+        virtual void load() throw (RuntimeException) = 0;
+        /// Entlaedt den Sound.
+        virtual void unload() throw (RuntimeException) = 0;
+
+        virtual float getLength() const;
+
+        // SoundResource zurueckgeben.
+        const SoundResourcePtr&amp; getSoundResource() const;
+        // Wollen wir 3D?
+        bool is3d() const;
+        // Setzen des 3D-Flags.
+        void set3d(bool is3d);
+        // Sind wir gueltig
+        virtual bool isValid() const throw (RuntimeException) = 0;
+        
+        // Sollen der Sound wiederholt werden?
+        bool isLooping() const;
+        // Setzen des Loop-Flags.
+        void setLooping(bool looping);
+
+        /// Unsere Bounding-Box
+        virtual const Ogre::AxisAlignedBox&amp; getBoundingBox(void) const;
+        /// Bound-Radius
+        virtual Ogre::Real getBoundingRadius() const;
+        /// Rendern
+        virtual void _updateRenderQueue(Ogre::RenderQueue *queue);
+
+        /// Count of configured slots.
+        unsigned int getNumSlots();
+        /// Add a sound resource to the cache overwritting existing sound resource.
+        virtual void addSoundToCache(CeGuiString label, SoundResourcePtr sound);
+        /// Assign a sound recource to a slot.
+        virtual void putSoundIntoSlot(unsigned int, CeGuiString label) = 0;
+        /// Get the slot of the plaing sound.
+        virtual unsigned int getPlayingSlot() = 0;
+
+        /// Gibt die eingestellte Position der Soundquelle zurueck
+        virtual const Ogre::Vector3 getPosition() const = 0;
+        /// Setzt die Position der Soundquelle.
+        virtual void setPosition(const Ogre::Vector3&amp; direction) = 0;
+        /// Gibt die eingestellte relative Lautstaerke der Soundquelle zurueck (0.0 ... 1.0)
+	    virtual const Ogre::Real getVolume() const = 0; 
+        /// Setzt die relative Lautstaerke der Soundquelle (0.0 .. 1.0).
+	    virtual void setVolume(const Ogre::Real gain) = 0;
+        /// Gibt die Richtung der Soundquelle zurueck.
+        virtual const Ogre::Quaternion getDirection() const = 0;
+        /// Gibt die Geschwindigkeit der Soundquelle zurueck.
+        virtual const Ogre::Vector3 getVelocity() const = 0;
+        /// Setzt die Richtung der Soundquelle.
+        virtual void setDirection(const Ogre::Quaternion&amp;) = 0;
+        /// Setzt die Geschwindigkeit der Soundquelle.
+        virtual void setVelocity(const Ogre::Vector3&amp;) = 0;
+	    /// Setzt die Entfernung, ab der ein 3D-Sound leiser wird
+	    virtual void setRolloffStartDistance(const Ogre::Real&amp;);
+	    virtual const Ogre::Real getRolloffStartDistance() const;
+	    /// Setzt die Entfernung, ab der ein 3D-Sound nicht mehr leiser wird
+	    virtual void setRolloffEndDistance(const Ogre::Real&amp;);
+	    virtual const Ogre::Real getRolloffEndDistance() const;
+        // Sets the priority of this sound
+        virtual void setPriority(const int priority) = 0;
+        // Gets the priority of this sound
+        virtual const int getPriority() const = 0;
+
+        /// Spielt den Sound ab.
+        virtual void play(bool destroyWhenDone=false) = 0;
+        /// Pausiert den Sound.
+        virtual void pause(bool pausing) = 0;
+        /// Ist der Sound pausiert?
+        virtual bool isPaused() = 0;
+        /// Stoppt den Sound.
+        virtual void stop() = 0;
+        /// Laeuft der Sound noch
+        virtual const bool isPlaying() const = 0;
+
+		/// From MovableObject
+		virtual void visitRenderables(Ogre::Renderable::Visitor* visitor, 
+			bool debugRenderables = false);
+
+    protected:
+        SoundDriver* mCreator;
+
+        /// Die Lautstaerke
+	    Ogre::Real mVolume;
+        /// Die Position
+        Ogre::Vector3 mPosition;
+        /// Die Richtung
+        Ogre::Quaternion mDirection;
+        /// Die Geschwindigkeit
+        Ogre::Vector3 mVelocity;
+        /// The priority of this sound
+        int mPriority;
+
+	    Ogre::Real mRolloffStartDistance;
+	    Ogre::Real mRolloffEndDistance;
+
+        // Sound-Cache
+        SoundCache mSoundCache;
+
+    private:
+        /// Shared class-level name for Movable type
+        static Ogre::AxisAlignedBox msAABox;
+
+        /// Der Soundresource, auf den wir verweisen.
+        SoundResourcePtr mSoundResource;
+
+        // Damit die Timings alle 0.5 sek. abgeschickt werden.
+        int mTicks;
+        // Ob dieser Sound 3D sein soll.
+        bool mIs3d;
+        // Ob dieser Sound loopen soll.
+        bool mIsLooping;
+
+        // Anzahl der Soundslots
+        unsigned int mNumSlots;
+
+        // Name
+        CeGuiString mName;
+        
+    }; 
+
+}
+#endif
+

Modified: rl/branches/persistence/core/src/Actor.cpp
===================================================================
--- rl/branches/persistence/core/src/Actor.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/src/Actor.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -434,17 +434,17 @@
             node-&gt;setScale( vec );
 
             // Falls es sich um ein Mesh handelt ...
-            if( getControlledObject()-&gt;isMeshObject() )
+/*            if( getControlledObject()-&gt;isMeshObject() )
             {
                 MeshObject* meshObj = dynamic_cast&lt;MeshObject*&gt;( getControlledObject() );
 
                 // ... und gr&#246;&#223;er/kleiner als normal skaliert wird ...
                 if( vec != Vector3(1,1,1) )
                     // ... m&#252;ssen die Normalen neu berechnet werden.
-                    meshObj-&gt;getEntity()-&gt;setNormaliseNormals( true );
+					meshObj-&gt;getEntity()-&gt;setNormaliseNormals( true );
                 else
                     meshObj-&gt;getEntity()-&gt;setNormaliseNormals( false );
-            }
+            }*/
         }
     }
 

Modified: rl/branches/persistence/core/src/ListenerMovable.cpp
===================================================================
--- rl/branches/persistence/core/src/ListenerMovable.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/src/ListenerMovable.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -203,4 +203,9 @@
 	mActive = active;
 }
 
+void ListenerMovable::visitRenderables(Renderable::Visitor* visitor, 
+			bool debugRenderables)
+{
 }
+
+}

Modified: rl/branches/persistence/core/src/MovableText.cpp
===================================================================
--- rl/branches/persistence/core/src/MovableText.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/src/MovableText.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -554,4 +554,11 @@
     {
         return mAlignment;
     }
+
+    /************************************************************************/
+	void MovableText::visitRenderables(Renderable::Visitor* visitor, 
+			bool debugRenderables)
+	{
+		visitor-&gt;visit(this, 0, debugRenderables);
+	}
 }

Modified: rl/branches/persistence/core/src/PhysicalThing.cpp
===================================================================
--- rl/branches/persistence/core/src/PhysicalThing.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/src/PhysicalThing.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -130,8 +130,8 @@
 		if (mBody &amp;&amp; mActor)
 		{
 			mBody-&gt;setPositionOrientation(
-				mActor-&gt;_getSceneNode()-&gt;getWorldPosition(),
-				mActor-&gt;_getSceneNode()-&gt;getWorldOrientation());
+				mActor-&gt;_getSceneNode()-&gt;_getDerivedPosition(),
+				mActor-&gt;_getSceneNode()-&gt;_getDerivedOrientation());
 			mActor-&gt;_update(Actor::UF_ALL &amp; ~Actor::UF_PHYSICAL_THING);
 		}
     }

Modified: rl/branches/persistence/core/src/PhysicsManager.cpp
===================================================================
--- rl/branches/persistence/core/src/PhysicsManager.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/src/PhysicsManager.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -315,8 +315,8 @@
 
 
             body-&gt;attachToNode(node);
-            body-&gt;setPositionOrientation(node-&gt;getWorldPosition(),
-                node-&gt;getWorldOrientation());
+            body-&gt;setPositionOrientation(node-&gt;_getDerivedPosition(),
+                node-&gt;_getDerivedOrientation());
             body-&gt;setMaterialGroupID(getMaterialID(&quot;level&quot;));
 
 			mLevelBodiesQuadTree.add(body);

Modified: rl/branches/persistence/core/src/Sound.cpp
===================================================================
--- rl/branches/persistence/core/src/Sound.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/src/Sound.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -1,148 +1,153 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
-*
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
-*/
-#include &quot;stdinc.h&quot; //precompiled header
-
-#include &quot;Sound.h&quot;
-#include &quot;SoundDriver.h&quot;
-
-using namespace Ogre;
-
-namespace rl
-{
-
-AxisAlignedBox Sound::msAABox = Ogre::AxisAlignedBox(0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
-
-Sound::Sound(const SoundResourcePtr &amp;soundres, SoundDriver* creator)
-: MovableObject(soundres-&gt;getName()),
-   EventSource(),
-   EventCaster&lt;SoundEvent&gt;(),
-   mCreator(creator),
-   mVolume(1.0),
-   mSoundResource(soundres),
-   mIsLooping(false),
-   mIs3d(false),
-   mTicks(0),
-   mPosition(Vector3::ZERO),
-   mDirection(Quaternion::IDENTITY),
-   mVelocity(Vector3::ZERO),
-   mPriority(128),
-   mRolloffStartDistance(1.0),
-   mRolloffEndDistance(10000.0)
-{
-}
-
-Sound::~Sound()
-{
-}
-
-/**
- * @return Ob der Sound wiederholt werden soll
- * @author JoSch
- * @date 08-08-2005
- */
-bool Sound::isLooping() const
-{
-    return mIsLooping;
-}
-
-/**
- * @param looping Ob der Sound wiederholt werden soll
- * @author JoSch
- * @date 08-08-2005
- */
-void Sound::setLooping(bool looping)
-{
-    mIsLooping = looping;
-}
-
-/**
- * @return Ob der Sound ein 3D-Sound ist.
- * @author JoSch
- * @date 08-08-2005
- */
-bool Sound::is3d() const
-{
-    return mIs3d;
-}
-
-/**
- * @param is3d Ob der Sound ein 3D-Sound ist.
- * @author JoSch
- * @date 08-08-2005
- */
-void Sound::set3d(bool is3d)
-{
-    mIs3d = is3d;
-}
-
-/** SoundResource zur&#252;ckgeben.
- * @return Der Pointer auf die zugeh&#246;rige Soundresource.
- * @author JoSch
- * @date 08-08-2005
- */
-const SoundResourcePtr &amp;Sound::getSoundResource() const
-{
-    return mSoundResource;
-}
-
-/**
- * @author JoSch
- * @date 03-11-2005
- */
-const AxisAlignedBox&amp; Sound::getBoundingBox() const
-{
-    return msAABox;
-}
-
-/**
- * @author JoSch
- * @date 03-11-2005
- */
-Real Sound::getBoundingRadius (void) const
-{
-    return 0.0f; // SQRT(3*SQR(0.0)) to fit with AABB
-}
-
-/**
- * @author JoSch
- * @date 03-11-2005
- */
-void Sound::_updateRenderQueue(RenderQueue *queue)
-{
-    // Brauchen wir nicht
-}
-
-void Sound::setRolloffStartDistance(const Ogre::Real&amp; distance)
-{
-	mRolloffStartDistance = distance;
-}
-
-const Ogre::Real Sound::getRolloffStartDistance() const
-{
-	return mRolloffStartDistance;
-}
-
-void Sound::setRolloffEndDistance(const Ogre::Real&amp; distance)
-{
-	mRolloffEndDistance = distance;
-}
-
-const Ogre::Real Sound::getRolloffEndDistance() const
-{
-	return mRolloffEndDistance;
-}
-
-};
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#include &quot;stdinc.h&quot; //precompiled header
+
+#include &quot;Sound.h&quot;
+#include &quot;SoundDriver.h&quot;
+
+using namespace Ogre;
+
+namespace rl
+{
+
+AxisAlignedBox Sound::msAABox = Ogre::AxisAlignedBox(0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
+
+Sound::Sound(const SoundResourcePtr &amp;soundres, SoundDriver* creator)
+: MovableObject(soundres-&gt;getName()),
+   EventSource(),
+   EventCaster&lt;SoundEvent&gt;(),
+   mCreator(creator),
+   mVolume(1.0),
+   mSoundResource(soundres),
+   mIsLooping(false),
+   mIs3d(false),
+   mTicks(0),
+   mPosition(Vector3::ZERO),
+   mDirection(Quaternion::IDENTITY),
+   mVelocity(Vector3::ZERO),
+   mPriority(128),
+   mRolloffStartDistance(1.0),
+   mRolloffEndDistance(10000.0)
+{
+}
+
+Sound::~Sound()
+{
+}
+
+/**
+ * @return Ob der Sound wiederholt werden soll
+ * @author JoSch
+ * @date 08-08-2005
+ */
+bool Sound::isLooping() const
+{
+    return mIsLooping;
+}
+
+/**
+ * @param looping Ob der Sound wiederholt werden soll
+ * @author JoSch
+ * @date 08-08-2005
+ */
+void Sound::setLooping(bool looping)
+{
+    mIsLooping = looping;
+}
+
+/**
+ * @return Ob der Sound ein 3D-Sound ist.
+ * @author JoSch
+ * @date 08-08-2005
+ */
+bool Sound::is3d() const
+{
+    return mIs3d;
+}
+
+/**
+ * @param is3d Ob der Sound ein 3D-Sound ist.
+ * @author JoSch
+ * @date 08-08-2005
+ */
+void Sound::set3d(bool is3d)
+{
+    mIs3d = is3d;
+}
+
+/** SoundResource zur&#252;ckgeben.
+ * @return Der Pointer auf die zugeh&#246;rige Soundresource.
+ * @author JoSch
+ * @date 08-08-2005
+ */
+const SoundResourcePtr &amp;Sound::getSoundResource() const
+{
+    return mSoundResource;
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ */
+const AxisAlignedBox&amp; Sound::getBoundingBox() const
+{
+    return msAABox;
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ */
+Real Sound::getBoundingRadius (void) const
+{
+    return 0.0f; // SQRT(3*SQR(0.0)) to fit with AABB
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ */
+void Sound::_updateRenderQueue(RenderQueue *queue)
+{
+    // Brauchen wir nicht
+}
+
+void Sound::setRolloffStartDistance(const Ogre::Real&amp; distance)
+{
+	mRolloffStartDistance = distance;
+}
+
+const Ogre::Real Sound::getRolloffStartDistance() const
+{
+	return mRolloffStartDistance;
+}
+
+void Sound::setRolloffEndDistance(const Ogre::Real&amp; distance)
+{
+	mRolloffEndDistance = distance;
+}
+
+const Ogre::Real Sound::getRolloffEndDistance() const
+{
+	return mRolloffEndDistance;
+}
+
+void Sound::visitRenderables(Renderable::Visitor* visitor, 
+			bool debugRenderables)
+{
+}
+
+};

Modified: rl/branches/persistence/core/src/SoundResource.cpp
===================================================================
--- rl/branches/persistence/core/src/SoundResource.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/src/SoundResource.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -85,15 +85,6 @@
 }
 
 /**
- * @author JoSch
- * @date 03-14-2005
- */
-int SoundResource::getSize() const
-{
-    return calculateSize();
-}
-
-/**
  * @author Blakharaz
  * @date 03-14-2005
  */

Modified: rl/branches/persistence/core/src/SoundStitching.cpp
===================================================================
--- rl/branches/persistence/core/src/SoundStitching.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/core/src/SoundStitching.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -1,166 +1,171 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
-*
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
-*/
-#include &quot;stdinc.h&quot; //precompiled header
-
-#include &quot;SoundStitching.h&quot;
-#include &quot;SoundDriver.h&quot;
-
-using namespace Ogre;
-
-namespace rl
-{
-
-AxisAlignedBox SoundStitching::msAABox = Ogre::AxisAlignedBox(0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
-
-SoundStitching::SoundStitching(unsigned int numSlots, const CeGuiString&amp; name, SoundDriver* creator)
-:  MovableObject(name.c_str()),
-   EventSource(),
-   EventCaster&lt;SoundEvent&gt;(),
-   mCreator(creator),
-   mVolume(1.0),
-   mName(name),
-   mIsLooping(true),
-   mIs3d(false),
-   mTicks(0),
-   mPosition(Vector3::ZERO),
-   mDirection(Quaternion::IDENTITY),
-   mVelocity(Vector3::ZERO),
-   mPriority(128),
-   mRolloffStartDistance(1.0),
-   mRolloffEndDistance(10000.0),
-   mNumSlots(numSlots)
-{
-}
-
-SoundStitching::~SoundStitching()
-{
-}
-
-/**
- * @return Ob der Sound wiederholt werden soll
- * @author JoSch
- * @date 08-08-2005
- */
-bool SoundStitching::isLooping() const
-{
-    return mIsLooping;
-}
-
-/**
- * @param looping Ob der Sound wiederholt werden soll
- * @author JoSch
- * @date 08-08-2005
- */
-void SoundStitching::setLooping(bool looping)
-{
-    mIsLooping = looping;
-}
-
-/**
- * @return Ob der Sound ein 3D-Sound ist.
- * @author JoSch
- * @date 08-08-2005
- */
-bool SoundStitching::is3d() const
-{
-    return mIs3d;
-}
-
-/**
- * @param is3d Ob der Sound ein 3D-Sound ist.
- * @author JoSch
- * @date 08-08-2005
- */
-void SoundStitching::set3d(bool is3d)
-{
-    mIs3d = is3d;
-}
-
-/** SoundResource zur&#252;ckgeben.
- * @return Der Pointer auf die zugeh&#246;rige Soundresource.
- * @author JoSch
- * @date 08-08-2005
- */
-const SoundResourcePtr &amp;SoundStitching::getSoundResource() const
-{
-    return mSoundResource;
-}
-
-/**
- * @author JoSch
- * @date 03-11-2005
- */
-const AxisAlignedBox&amp; SoundStitching::getBoundingBox() const
-{
-    return msAABox;
-}
-
-/**
- * @author JoSch
- * @date 03-11-2005
- */
-Real SoundStitching::getBoundingRadius (void) const
-{
-    return 0.0f; // SQRT(3*SQR(0.0)) to fit with AABB
-}
-
-/**
- * @author JoSch
- * @date 03-11-2005
- */
-void SoundStitching::_updateRenderQueue(RenderQueue *queue)
-{
-    // Brauchen wir nicht
-}
-
-void SoundStitching::setRolloffStartDistance(const Ogre::Real&amp; distance)
-{
-	mRolloffStartDistance = distance;
-}
-
-const Ogre::Real SoundStitching::getRolloffStartDistance() const
-{
-	return mRolloffStartDistance;
-}
-
-void SoundStitching::setRolloffEndDistance(const Ogre::Real&amp; distance)
-{
-	mRolloffEndDistance = distance;
-}
-
-const Ogre::Real SoundStitching::getRolloffEndDistance() const
-{
-	return mRolloffEndDistance;
-}
-
-
-void SoundStitching::addSoundToCache(CeGuiString label, SoundResourcePtr sound)
-{
-    mSoundCache[label] = sound;
-}
-
-unsigned int SoundStitching::getNumSlots()
-{
-    return mNumSlots;
-}
-
-float SoundStitching::getLength() const
-{
-    return 0.0f;
-}
-
-};
-
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+#include &quot;stdinc.h&quot; //precompiled header
+
+#include &quot;SoundStitching.h&quot;
+#include &quot;SoundDriver.h&quot;
+
+using namespace Ogre;
+
+namespace rl
+{
+
+AxisAlignedBox SoundStitching::msAABox = Ogre::AxisAlignedBox(0.0, 0.0, 0.0, 0.0, 0.0, 0.0);
+
+SoundStitching::SoundStitching(unsigned int numSlots, const CeGuiString&amp; name, SoundDriver* creator)
+:  MovableObject(name.c_str()),
+   EventSource(),
+   EventCaster&lt;SoundEvent&gt;(),
+   mCreator(creator),
+   mVolume(1.0),
+   mName(name),
+   mIsLooping(true),
+   mIs3d(false),
+   mTicks(0),
+   mPosition(Vector3::ZERO),
+   mDirection(Quaternion::IDENTITY),
+   mVelocity(Vector3::ZERO),
+   mPriority(128),
+   mRolloffStartDistance(1.0),
+   mRolloffEndDistance(10000.0),
+   mNumSlots(numSlots)
+{
+}
+
+SoundStitching::~SoundStitching()
+{
+}
+
+/**
+ * @return Ob der Sound wiederholt werden soll
+ * @author JoSch
+ * @date 08-08-2005
+ */
+bool SoundStitching::isLooping() const
+{
+    return mIsLooping;
+}
+
+/**
+ * @param looping Ob der Sound wiederholt werden soll
+ * @author JoSch
+ * @date 08-08-2005
+ */
+void SoundStitching::setLooping(bool looping)
+{
+    mIsLooping = looping;
+}
+
+/**
+ * @return Ob der Sound ein 3D-Sound ist.
+ * @author JoSch
+ * @date 08-08-2005
+ */
+bool SoundStitching::is3d() const
+{
+    return mIs3d;
+}
+
+/**
+ * @param is3d Ob der Sound ein 3D-Sound ist.
+ * @author JoSch
+ * @date 08-08-2005
+ */
+void SoundStitching::set3d(bool is3d)
+{
+    mIs3d = is3d;
+}
+
+/** SoundResource zur&#252;ckgeben.
+ * @return Der Pointer auf die zugeh&#246;rige Soundresource.
+ * @author JoSch
+ * @date 08-08-2005
+ */
+const SoundResourcePtr &amp;SoundStitching::getSoundResource() const
+{
+    return mSoundResource;
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ */
+const AxisAlignedBox&amp; SoundStitching::getBoundingBox() const
+{
+    return msAABox;
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ */
+Real SoundStitching::getBoundingRadius (void) const
+{
+    return 0.0f; // SQRT(3*SQR(0.0)) to fit with AABB
+}
+
+/**
+ * @author JoSch
+ * @date 03-11-2005
+ */
+void SoundStitching::_updateRenderQueue(RenderQueue *queue)
+{
+    // Brauchen wir nicht
+}
+
+void SoundStitching::setRolloffStartDistance(const Ogre::Real&amp; distance)
+{
+	mRolloffStartDistance = distance;
+}
+
+const Ogre::Real SoundStitching::getRolloffStartDistance() const
+{
+	return mRolloffStartDistance;
+}
+
+void SoundStitching::setRolloffEndDistance(const Ogre::Real&amp; distance)
+{
+	mRolloffEndDistance = distance;
+}
+
+const Ogre::Real SoundStitching::getRolloffEndDistance() const
+{
+	return mRolloffEndDistance;
+}
+
+
+void SoundStitching::addSoundToCache(CeGuiString label, SoundResourcePtr sound)
+{
+    mSoundCache[label] = sound;
+}
+
+unsigned int SoundStitching::getNumSlots()
+{
+    return mNumSlots;
+}
+
+float SoundStitching::getLength() const
+{
+    return 0.0f;
+}
+
+void SoundStitching::visitRenderables(Renderable::Visitor* visitor, 
+			bool debugRenderables)
+{
+}
+
+};
+

Modified: rl/branches/persistence/script/src/PlaneNodeProcessor.cpp
===================================================================
--- rl/branches/persistence/script/src/PlaneNodeProcessor.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/script/src/PlaneNodeProcessor.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -222,8 +222,8 @@
 
 	void PlaneReflectionTextureListener::preRenderTargetUpdate(const RenderTargetEvent &amp;evt)
 	{
-		mCamera-&gt;setPosition(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getWorldPosition());
-		mCamera-&gt;setOrientation(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getWorldOrientation());
+		mCamera-&gt;setPosition(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getDerivedPosition());
+		mCamera-&gt;setOrientation(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getDerivedOrientation());
 		mEntity-&gt;setVisible(false);
 		mCamera-&gt;enableReflection((MovablePlane*)mPlane);
 	}
@@ -242,8 +242,8 @@
 
 	void PlaneRefractionTextureListener::preRenderTargetUpdate(const Ogre::RenderTargetEvent&amp; evt)
 	{
-		mCamera-&gt;setPosition(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getWorldPosition());
-		mCamera-&gt;setOrientation(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getWorldOrientation());
+		mCamera-&gt;setPosition(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getDerivedPosition());
+		mCamera-&gt;setOrientation(CoreSubsystem::getSingleton().getWorld()-&gt;getActiveCamera()-&gt;getDerivedOrientation());
 		mEntity-&gt;setVisible(false);
 	}
 

Modified: rl/branches/persistence/ui/src/DebugWindow.cpp
===================================================================
--- rl/branches/persistence/ui/src/DebugWindow.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/ui/src/DebugWindow.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -186,8 +186,8 @@
 
             if( charObj != NULL )
             {
-                Ogre::Vector3 pos = charObj-&gt;getMovableObject()-&gt;getParentNode()-&gt;getWorldPosition();
-                Ogre::Quaternion ori = charObj-&gt;getMovableObject()-&gt;getParentNode()-&gt;getWorldOrientation();
+                Ogre::Vector3 pos = charObj-&gt;getMovableObject()-&gt;getParentNode()-&gt;_getDerivedPosition();
+                Ogre::Quaternion ori = charObj-&gt;getMovableObject()-&gt;getParentNode()-&gt;_getDerivedOrientation();
 
                 textSt += &quot;\nPlayer Position [ &quot;
                     + StringConverter::toString(pos.x,2,0,32,std::ios_base::fixed)+&quot;, &quot;

Modified: rl/branches/persistence/ui/src/DialogControlState.cpp
===================================================================
--- rl/branches/persistence/ui/src/DialogControlState.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/ui/src/DialogControlState.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -220,8 +220,8 @@
 
         // Weltkoordinaten in lokale umwandeln
         mTargetCameraPosition =
-            -1*(mCameraActor-&gt;_getSceneNode()-&gt;getParentSceneNode()-&gt;getWorldOrientation().Inverse()*
-            (mCameraActor-&gt;_getSceneNode()-&gt;getParentSceneNode()-&gt;getWorldPosition() - globalCameraPosition));
+            -1*(mCameraActor-&gt;_getSceneNode()-&gt;getParentSceneNode()-&gt;_getDerivedOrientation().Inverse()*
+            (mCameraActor-&gt;_getSceneNode()-&gt;getParentSceneNode()-&gt;_getDerivedPosition() - globalCameraPosition));
 
         mTargetCameraDirection = (listenerEyes - mTargetCameraPosition).normalisedCopy();
     }

Modified: rl/branches/persistence/ui/src/InventoryWindow.cpp
===================================================================
--- rl/branches/persistence/ui/src/InventoryWindow.cpp	2008-11-21 15:26:21 UTC (rev 4598)
+++ rl/branches/persistence/ui/src/InventoryWindow.cpp	2008-11-21 15:28:58 UTC (rev 4599)
@@ -448,7 +448,7 @@
 		mousePos.d_y /= getRoot()-&gt;getPixelSize().d_height;
 		Ogre::Ray camToWorld = camera-&gt;getCameraToViewportRay(
 			mousePos.d_x, mousePos.d_y);
-		Ogre::Vector3 rayStart = camera-&gt;getCamera()-&gt;getWorldPosition();
+		Ogre::Vector3 rayStart = camera-&gt;getCamera()-&gt;getDerivedPosition();
 		Ogre::Vector3 rayDir = camera-&gt;getDirectionFromScreenPosition(
 			mousePos.d_x, mousePos.d_y);
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001655.html">[Dsa-hl-svn] r4598 - modules/branch_persistenz/materials/textures
</A></li>
	<LI>Next message: <A HREF="001657.html">[Dsa-hl-svn] r4600 - in rl/trunk: . engine/rules/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1656">[ date ]</a>
              <a href="thread.html#1656">[ thread ]</a>
              <a href="subject.html#1656">[ subject ]</a>
              <a href="author.html#1656">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
