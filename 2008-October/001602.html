<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4545 - in rl/trunk/editors/Lockenwickler: . src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4545%20-%20in%20rl/trunk/editors/Lockenwickler%3A%20.%20src&In-Reply-To=%3C200810111726.m9BHQ6Rq026888%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001601.html">
   <LINK REL="Next"  HREF="001603.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4545 - in rl/trunk/editors/Lockenwickler: . src</H1>
    <B>fusion2 at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4545%20-%20in%20rl/trunk/editors/Lockenwickler%3A%20.%20src&In-Reply-To=%3C200810111726.m9BHQ6Rq026888%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4545 - in rl/trunk/editors/Lockenwickler: . src">fusion2 at mail.berlios.de
       </A><BR>
    <I>Sat Oct 11 19:26:06 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001601.html">[Dsa-hl-svn] r4544 - rl/trunk/engine/rules/src
</A></li>
        <LI>Next message: <A HREF="001603.html">[Dsa-hl-svn] r4546 - in rl/branches/persistence: ai/include ai/src	core/include core/src rules/include rules/src script/src	script/swig ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1602">[ date ]</a>
              <a href="thread.html#1602">[ thread ]</a>
              <a href="subject.html#1602">[ subject ]</a>
              <a href="author.html#1602">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: fusion2
Date: 2008-10-11 19:25:56 +0200 (Sat, 11 Oct 2008)
New Revision: 4545

Added:
   rl/trunk/editors/Lockenwickler/.eric4project/
   rl/trunk/editors/Lockenwickler/src/Property.py
Removed:
   rl/trunk/editors/Lockenwickler/Lockenwickler.e4q
   rl/trunk/editors/Lockenwickler/Lockenwickler.e4t
   rl/trunk/editors/Lockenwickler/src/ui_FourPanelView.py
   rl/trunk/editors/Lockenwickler/src/ui_obj_prop.py
Modified:
   rl/trunk/editors/Lockenwickler/Lockenwickler.e4p
   rl/trunk/editors/Lockenwickler/src/ConsoleWindow.py
   rl/trunk/editors/Lockenwickler/src/Lockenwickler.py
   rl/trunk/editors/Lockenwickler/src/ModuleManager.py
   rl/trunk/editors/Lockenwickler/src/MovePivot.py
   rl/trunk/editors/Lockenwickler/src/ObjectPropertyWin.py
   rl/trunk/editors/Lockenwickler/src/OgreMainWindow.py
   rl/trunk/editors/Lockenwickler/src/Plugins-linux.cfg
Log:
- objects can be moved and rotated

Modified: rl/trunk/editors/Lockenwickler/Lockenwickler.e4p
===================================================================
--- rl/trunk/editors/Lockenwickler/Lockenwickler.e4p	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/Lockenwickler.e4p	2008-10-11 17:25:56 UTC (rev 4545)
@@ -1,9 +1,9 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;!DOCTYPE Project SYSTEM &quot;Project-4.4.dtd&quot;&gt;
+&lt;!DOCTYPE Project SYSTEM &quot;Project-4.5.dtd&quot;&gt;
 &lt;!-- eric4 project file for project Lockenwickler --&gt;
-&lt;!-- Saved: 2008-09-20, 20:03:11 --&gt;
+&lt;!-- Saved: 2008-10-08, 20:52:14 --&gt;
 &lt;!-- Copyright (C) 2008 Stefan Stammberger, <A HREF="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">sstammberger at web.de</A> --&gt;
-&lt;Project version=&quot;4.4&quot;&gt;
+&lt;Project version=&quot;4.5&quot;&gt;
   &lt;ProgLanguage mixed=&quot;0&quot;&gt;Python&lt;/ProgLanguage&gt;
   &lt;ProjectType&gt;Qt4&lt;/ProjectType&gt;
   &lt;Description&gt;Lockenwickler is an Editor application for the Rastulahs Lockenpracht game.&lt;/Description&gt;
@@ -23,10 +23,8 @@
     &lt;Source&gt;src/PreferencesDialog.py&lt;/Source&gt;
     &lt;Source&gt;src/PythonOgreConfig.py&lt;/Source&gt;
     &lt;Source&gt;src/ui_ConsoleWindow.py&lt;/Source&gt;
-    &lt;Source&gt;src/ui_FourPanelView.py&lt;/Source&gt;
     &lt;Source&gt;src/ui_lw.py&lt;/Source&gt;
     &lt;Source&gt;src/ui_model_prev.py&lt;/Source&gt;
-    &lt;Source&gt;src/ui_obj_prop.py&lt;/Source&gt;
     &lt;Source&gt;src/ui_pref_dialog.py&lt;/Source&gt;
     &lt;Source&gt;ui files/batch_convert_ui.py&lt;/Source&gt;
     &lt;Source&gt;ui files/ui_ConsoleWindow.py&lt;/Source&gt;
@@ -36,6 +34,7 @@
     &lt;Source&gt;ui files/ui_obj_prop.py&lt;/Source&gt;
     &lt;Source&gt;ui files/ui_pref_dialog.py&lt;/Source&gt;
     &lt;Source&gt;src/SceneExplorer.py&lt;/Source&gt;
+    &lt;Source&gt;src/Property.py&lt;/Source&gt;
   &lt;/Sources&gt;
   &lt;Forms&gt;
     &lt;Form&gt;ui files/console_window.ui&lt;/Form&gt;
@@ -170,9 +169,11 @@
   &lt;FiletypeAssociations&gt;
     &lt;FiletypeAssociation pattern=&quot;*.ui&quot; type=&quot;FORMS&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.idl&quot; type=&quot;INTERFACES&quot; /&gt;
+    &lt;FiletypeAssociation pattern=&quot;*.qm&quot; type=&quot;TRANSLATIONS&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.ptl&quot; type=&quot;SOURCES&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.pyw&quot; type=&quot;SOURCES&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.ui.h&quot; type=&quot;FORMS&quot; /&gt;
+    &lt;FiletypeAssociation pattern=&quot;*.ts&quot; type=&quot;TRANSLATIONS&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.py&quot; type=&quot;SOURCES&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.qrc&quot; type=&quot;RESOURCES&quot; /&gt;
   &lt;/FiletypeAssociations&gt;

Deleted: rl/trunk/editors/Lockenwickler/Lockenwickler.e4q
===================================================================
--- rl/trunk/editors/Lockenwickler/Lockenwickler.e4q	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/Lockenwickler.e4q	2008-10-11 17:25:56 UTC (rev 4545)
@@ -1,7 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;!DOCTYPE UserProject SYSTEM &quot;UserProject-4.0.dtd&quot;&gt;
-&lt;!-- eric4 user project file for project Lockenwickler --&gt;
-&lt;!-- Saved: 2008-06-23, 19:40:36 --&gt;
-&lt;!-- Copyright (C) 2008 Stefan Stammberger, <A HREF="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">sstammberger at web.de</A> --&gt;
-&lt;UserProject version=&quot;4.0&quot;&gt;
-&lt;/UserProject&gt;
\ No newline at end of file

Deleted: rl/trunk/editors/Lockenwickler/Lockenwickler.e4t
===================================================================
--- rl/trunk/editors/Lockenwickler/Lockenwickler.e4t	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/Lockenwickler.e4t	2008-10-11 17:25:56 UTC (rev 4545)
@@ -1,6 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;!DOCTYPE Tasks SYSTEM &quot;Tasks-4.1.dtd&quot;&gt;
-&lt;!-- eric4 tasks file for project Lockenwickler --&gt;
-&lt;!-- Saved: 2008-06-23, 19:40:36 --&gt;
-&lt;Tasks version=&quot;4.1&quot;&gt;
-&lt;/Tasks&gt;
\ No newline at end of file

Modified: rl/trunk/editors/Lockenwickler/src/ConsoleWindow.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/ConsoleWindow.py	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/ConsoleWindow.py	2008-10-11 17:25:56 UTC (rev 4545)
@@ -1,7 +1,12 @@
 import sys
+from PyQt4.QtCore import *
+from PyQt4.QtGui import *
+
 from ui_ConsoleWindow import *
 import ogre.renderer.OGRE as og
 
+
+
 class LockenLog(og.LogListener):
     def __init__(self, logFunction):
         og.LogListener.__init__(self)
@@ -24,6 +29,13 @@
         sys.stdout = self
         sys.stderr = self
 
+        clearAction= QAction(&quot;Clear Window&quot;,  self)
+        self.consoleWindow.textEdit.addAction(clearAction)
+        self.consoleWindow.textEdit.setContextMenuPolicy(Qt.ActionsContextMenu)
+        clearAction.setShortcut(&quot;Ctrl + R&quot;)
+        self.connect(clearAction, SIGNAL(&quot;triggered()&quot;), self.consoleWindow.textEdit.clear)
+
+
     def write(self, text):
         if self.filterLog:
             if text.isspace():
@@ -34,6 +46,11 @@
             elif text.startswith(&quot;OGRE EXCEPTION&quot;):
                 self.consoleWindow.textEdit.append(text)
                 return
+            elif text.startswith(&quot;dbg:&quot;):
+                self.consoleWindow.textEdit.append(text)
+                return
         else:
             self.consoleWindow.textEdit.append(text)
 
+    def clear(self):
+        self.consoleWindow.textEdit.clear()

Modified: rl/trunk/editors/Lockenwickler/src/Lockenwickler.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/Lockenwickler.py	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/Lockenwickler.py	2008-10-11 17:25:56 UTC (rev 4545)
@@ -2,8 +2,8 @@
 import sys
 import platform
 
-#sys.path.insert(0,'..')
-#import PythonOgreConfig
+sys.path.insert(0,'..')
+import PythonOgreConfig
 
 from random import randint
 from os.path import isfile
@@ -25,7 +25,7 @@
 
         self.setupUi()
 
-        self.consoleWindow = ConsoleWindow(False,  self)
+        self.consoleWindow = ConsoleWindow(True,  self)
 
         self.setupOgre()
 
@@ -106,7 +106,7 @@
         self.statusbar.setObjectName(&quot;statusbar&quot;)
         self.setStatusBar(self.statusbar)
 
-        self.actionNeu = QtGui.QAction(QtGui.QIcon(&quot;media/icons/package.png&quot;), &quot;&amp;New&quot;,  self)
+        self.actionNeu =self.createAction(&quot;&amp;New&quot;,  self.close,  &quot;Ctrl + N&quot;,  &quot;filenew.png&quot;,  &quot;New&quot;)
         self.actionNeu.setObjectName(&quot;actionNeu&quot;)
 
         self.actionClose = self.createAction(&quot;Quit&quot;,  self.close,  &quot;Alt + Q&quot;,  &quot;exit.png&quot;,  &quot;Quit&quot;)
@@ -120,7 +120,7 @@
         self.actionRotate = self.createAction(&quot;&amp;Rotate&quot;,  self.actionRotateSlot,  &quot;r&quot;,  &quot;rotate.png&quot;,  &quot;Rotate selected object&quot;)
         self.actionRotate.setObjectName(&quot;actionRotate&quot;)
 
-        self.actionScale = self.createAction(&quot;&amp;Scale&quot;,  self.actionScaleSlot,  &quot;s&quot;,  &quot;resizecol.png&quot;,  &quot;Scale selected object&quot;)
+        self.actionScale = self.createAction(&quot;&amp;Scale&quot;,  self.actionScaleSlot,  &quot;x&quot;,  &quot;resizecol.png&quot;,  &quot;Scale selected object&quot;)
         self.actionRotate.setObjectName(&quot;actionRotate&quot;)
 
 
@@ -199,16 +199,24 @@
         oglog.addListener(self.consoleWindow.lockenLog)
 
     def update(self):
+#        try:
+#            self.OgreMainWinSceneMgr.getSceneNode(&quot;saeule_076_node&quot;).yaw(0.02)
+#        except Exception,  e:
+#            pass
+
         self.ogreRoot.renderOneFrame()
 
     def actionMoveSlot(self):
-        print &quot;MOVE!!!!!!!!!!!&quot;
+        self.moduleManager.pivot.setMoveMode()
+        return
 
     def actionRotateSlot(self):
-        print &quot;ROTATE!!!!!!!!!&quot;
+        self.moduleManager.pivot.setRotateMode()
+        return
 
     def actionScaleSlot(self):
-        print &quot;Scale!!!!!!!!&quot;
+        self.moduleManager.pivot.setScaleMode()
+        return
 
     def togglePreferencesWindow(self):
         if self.prefDialog.isHidden():
@@ -362,7 +370,7 @@
         if reply == QtGui.QMessageBox.Cancel:
             return False
         if reply == QtGui.QMessageBox.Yes:
-            print &quot;SAVE!!!!&quot;
+            print&quot;&quot;
             #TODO: implement save here
         return True
 

Modified: rl/trunk/editors/Lockenwickler/src/ModuleManager.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/ModuleManager.py	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/ModuleManager.py	2008-10-11 17:25:56 UTC (rev 4545)
@@ -9,6 +9,7 @@
 # a class to store information about a object that got selected
 class SelectionObject():
     def __init__(self,  entity,  distance):
+        self.entityName = entity.getName()
         self.entity = entity #the selected entity
         self.distance = distance # the distance from camera at the time of selection
         self.isPivot = False
@@ -20,6 +21,12 @@
         else:
             self.entity.getParentNode().showBoundingBox(False)
 
+    def __eq__(self, other):
+        return self.entity.getName() == other.entity.getName()
+
+    def __ne__(self, other):
+        return self.entity.getName() != other.entity.getName()
+
 class MyRaySceneQueryListener ( og.RaySceneQueryListener ):
     def __init__( self ):
         super ( MyRaySceneQueryListener, self ).__init__()
@@ -45,7 +52,7 @@
             return -1
 
     def queryResult ( self, entity, distance ):
-        print entity.getName()
+        #print entity.getName()
         if distance == 0.0: #camera is in the bounding box, ignore this selection
             return True
         elif entity.getName() == &quot;rayLine&quot; :
@@ -84,14 +91,11 @@
         return True
 
     def reset(self):
-        for so in self.selectionList:
-            so.setSelected(False)
-
         self.previousSelected = -1
         self.currentSelected = -1
+        del self.selectionList[:]
+        #self.selectionList = []
 
-        self.selectionList = []
-
     def iterateEntityUnderMouse(self):
         self.previousSelected = self.currentSelected
         if len(self.selectionList) &gt;= self.currentSelected: # would mean we are out of bounds
@@ -120,11 +124,9 @@
         pMesh = entity.getMesh()
 
         pos =    entity.getParentNode().getWorldPosition()
+        orient = entity.getParentNode().getWorldOrientation()
         scale =  entity.getParentNode().getScale()
-        orient = entity.getParentNode().getWorldOrientation()
 
-
-
         for i in range ( pMesh.getNumSubMeshes() ):
             pSubMesh = pMesh.getSubMesh(i)
             if pSubMesh.useSharedVertices:
@@ -207,7 +209,7 @@
 
             ih = 0
             for blah in self.mVertexList:
-                print str(ih) + &quot;: &quot;  +  str(blah)
+                #print str(ih) + &quot;: &quot;  +  str(blah)
                 ih += 1
 
 #            for blah in self.mIndexList:
@@ -229,15 +231,38 @@
 
 
     def rayCastToPolygonLevelOnSingleMesh(self,  ray,  entity):
+        return True
         self.getMeshInformation(entity)
+        name = entity.getName()
+        print &quot;dbg: &quot; + name
+
+        temp = []
+        for vec in self.mVertexList:
+            temp.append(vec.x)
+            temp.append(vec.y)
+            temp.append(vec.z)
+
         globalPosition = entity.getParentNode().getWorldPosition()
+        globalOrientation = entity.getParentNode().getWorldOrientation()
 
+
         i = 0
         while i &lt;= (len(self.mIndexList) - 3):
-            result = og.Math.intersects(ray, globalPosition + self.mVertexList[self.mIndexList[i]], globalPosition + self.mVertexList[self.mIndexList[i+1]],
-                                                                                                                                                          globalPosition + self.mVertexList[self.mIndexList[i+2]], True, False)
+            verta = globalPosition + self.mVertexList[self.mIndexList[i]]
+            vertb = globalPosition + self.mVertexList[self.mIndexList[i+1]]
+            vertc = globalPosition + self.mVertexList[self.mIndexList[i+2]]
 
+            verta = globalOrientation * verta
+            vertb = globalOrientation * vertb
+            vertc = globalOrientation * vertc
+            normal = og.Math.calculateBasicFaceNormal(verta, vertb, vertc)
+
+            result = og.Math.intersects(ray, verta, vertb, vertc, True, True)
+            #result = og.Math.intersects(ray, globalPosition + self.mVertexList[self.mIndexList[i]], globalPosition + self.mVertexList[self.mIndexList[i+1]],
+            #                                                                                                                                              globalPosition + self.mVertexList[self.mIndexList[i+2]], normal,  True, True)
+
             if result.first:
+                print &quot;dbg: Treffer!!!!!!!!!&quot;
                 return True
 
             i += 3
@@ -291,6 +316,7 @@
                 self.parseSceneNodes(node)
 
         self.pivot = Pivot(self.sceneManager)
+        self.pivot.hide()
 
     def parseSceneNodes(self,  nodeList):
         for ent in nodeList:
@@ -330,16 +356,17 @@
                 print &quot;Warning: Meshfile &quot; + meshFile + &quot; could not be found.&quot;
                 return
 
-            n = self.sceneManager.getRootSceneNode().createChild()
+            n = self.sceneManager.getRootSceneNode().createChild(entityName + &quot;_node&quot;)
             n.attachObject(e)
             n.setPosition(nodePosition)
-            n.setOrientation(nodeRotation)
+            #n.setOrientation(nodeRotation)
             n.setScale(nodeScale)
 
         pass
 
     # called when a click into Main Ogre Window occurs
     def selectionClick(self,  ray,  controlDown=False,  shiftDown=False):
+        self.listenerDings.reset()
         self.lastRay = ray
         self.listenerDings.currentRay = ray
         self.raySceneQuery.Ray = ray
@@ -356,21 +383,26 @@
                     self.updatePivots()
                 elif controlDown and not shiftDown:
                     so.setSelected(True)
+
+                    for soFromList in self.userSelectionList:
+                        if soFromList == so:
+                            return # object already selected
+
                     self.userSelectionList.append(so)
                     self.updatePivots()
+
                 elif not controlDown and shiftDown:
                     for selo in self.userSelectionList:
-                        if so.entity.getName() == selo.entity.getName():
+                        if so == selo:
                             so.setSelected(False)
                             self.userSelectionList.remove(selo)
                     self.updatePivots()
             else:
-                print &quot;isPivot: &quot; + str(so.entity.getName())
                 self.pivot.startTransforming(so.entity,  self.userSelectionList)
         else:
-            print &quot;noneee&quot;
             self.resetSelection() # click in empty space, deselect everything
-            self.pivot.hide()
+            if self.pivot is not None:
+                self.pivot.hide()
 
         if self.rayLine == None:
             self.rayLine = self.sceneManager.createManualObject(&quot;rayLine&quot;)
@@ -393,7 +425,7 @@
             self.rayLine.end()
 
     def leftMouseUp(self):
-        if self.pivot.isTransforming:
+        if self.pivot is not None and self.pivot.isTransforming:
             self.pivot.stopTransforming()
 
     def iterateEntityUnderMouse(self):

Modified: rl/trunk/editors/Lockenwickler/src/MovePivot.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/MovePivot.py	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/MovePivot.py	2008-10-11 17:25:56 UTC (rev 4545)
@@ -98,6 +98,7 @@
         self.pivotNode.setPosition(pos)
 
     def startTransforming(self, dirEntity, soList):
+        print &quot;dbg: transforming.....&quot;
         self.moveDirection = dirEntity.getName()
         self.selectionList = soList
         self.isTransforming = True
@@ -108,42 +109,68 @@
         pass
 
     def hide(self):
-        self.pivotNode.setVisible(False)
+        self.pivotNode.removeAllChildren()
 
     def show(self):
+        self.hide()
         if self.mode == 1:
-            self.xMoveNode.setVisible(True)
-            self.yMoveNode.setVisible(True)
-            self.zMoveNode.setVisible(True)
-            self.freeMoveNode.setVisible(True)
+            self.pivotNode.addChild(self.xMoveNode)
+            self.pivotNode.addChild(self.yMoveNode)
+            self.pivotNode.addChild(self.zMoveNode)
         elif self.mode == 2:
-            self.xRotateNode.setVisible(True)
-            self.yRotateNode.setVisible(True)
-            self.zRotateNode.setVisible(True)
+            self.pivotNode.addChild(self.xRotateNode)
+            self.pivotNode.addChild(self.yRotateNode)
+            self.pivotNode.addChild(self.zRotateNode)
         elif self.mode == 3:
             pass
 
     def setMoveMode(self):
         self.hide()
         self.mode = 1
-        self.xMoveNode.setVisible(True)
-        self.yMoveNode.setVisible(True)
-        self.zMoveNode.setVisible(True)
-        self.freeMoveNode.setVisible(False)
-
+        self.pivotNode.addChild(self.xMoveNode)
+        self.pivotNode.addChild(self.yMoveNode)
+        self.pivotNode.addChild(self.zMoveNode)
         pass
 
     def setRotateMode(self):
         self.hide()
         self.mode = 2
-        self.xRotateNode.setVisible(True)
-        self.yRotateNode.setVisible(True)
-        self.zRotateNode.setVisible(True)
+        self.pivotNode.addChild(self.xRotateNode)
+        self.pivotNode.addChild(self.yRotateNode)
+        self.pivotNode.addChild(self.zRotateNode)
         pass
 
-    def __setScaleMode(self):
+    def settScaleMode(self):
         pass
 
     def onMouseMoved(self, globalX, globalY, incX, incY):
-        print self.moveDirection
+        # move mode
+        if self.mode == 1:
+            transVec = None
+            if self.moveDirection == &quot;EditorXArrow&quot;:
+                transVec = og.Vector3(-incX, 0.0 , 0.0)
+            elif self.moveDirection == &quot;EditorYArrow&quot;:
+                transVec = og.Vector3(0.0, -incY, 0.0)
+            elif self.moveDirection == &quot;EditorZArrow&quot;:
+                transVec = og.Vector3(0.0, 0.0, -incX)
+
+            for so in self.selectionList:
+                so.entity.getParentNode().translate(transVec)
+
+            self.pivotNode.translate(transVec)
+
+        # rotate mode
+        elif self.mode == 2:
+            rotValue = (incX + incY) * 0.05
+
+            if self.moveDirection == &quot;EditorXRotator&quot;:
+                for so in self.selectionList:
+                    so.entity.getParentNode().pitch(rotValue)
+            if self.moveDirection == &quot;EditorYRotator&quot;:
+                for so in self.selectionList:
+                    so.entity.getParentNode().yaw(rotValue)
+            if self.moveDirection == &quot;EditorZRotator&quot;:
+                for so in self.selectionList:
+                    so.entity.getParentNode().roll(rotValue)
+
         pass

Modified: rl/trunk/editors/Lockenwickler/src/ObjectPropertyWin.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/ObjectPropertyWin.py	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/ObjectPropertyWin.py	2008-10-11 17:25:56 UTC (rev 4545)
@@ -1,17 +1,51 @@
 import sys
-from ui_obj_prop import *
 
-class ObjectPropertyWin(QtGui.QDialog):
+from PyQt4.QtCore import *
+from PyQt4.QtGui import *
+
+class ObjectPropertyWin(QDialog):
     def __init__(self, parent=None):
-        QtGui.QDialog.__init__(self, parent)
-        
-        self.propWin = Ui_ObjectPropertys()
-        self.propWin.setupUi(self)
-        
-        QtCore.QObject.connect(self.propWin.treeWidget, QtCore.SIGNAL(&quot;itemDoubleClicked (QTreeWidgetItem *,int)&quot;), 
+        super(QDialog, self).__init__(parent)
+        self.setupUi()
+
+        self.connect(self.treeWidget, SIGNAL(&quot;itemDoubleClicked (QTreeWidgetItem *,int)&quot;),
                                self.onItemClicked)
-        
-        
+
+
+    def setupUi(self):
+        self.setObjectName(&quot;ObjectPropertys&quot;)
+        self.resize(QSize(QRect(0,0,761,724).size()).expandedTo(self.minimumSizeHint()))
+
+        self.treeWidget = QTreeWidget(self)
+        self.treeWidget.setGeometry(QRect(0,0,901,721))
+        self.treeWidget.setMinimumSize(QSize(400,400))
+        self.treeWidget.setObjectName(&quot;treeWidget&quot;)
+
+        self.retranslateUi()
+        QMetaObject.connectSlotsByName(self)
+
+    def retranslateUi(self):
+        self.setWindowTitle(QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Object Properties&quot;, None, QApplication.UnicodeUTF8))
+        self.treeWidget.headerItem().setText(0,QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Property&quot;, None, QApplication.UnicodeUTF8))
+        self.treeWidget.headerItem().setText(1,QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Value&quot;, None, QApplication.UnicodeUTF8))
+        self.treeWidget.clear()
+
+        item = QTreeWidgetItem(self.treeWidget)
+        item.setText(0,QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Position&quot;, None, QApplication.UnicodeUTF8))
+        item.setText(1,&quot;&quot;)
+
+        item1 = QTreeWidgetItem(item)
+        item1.setText(0,QApplication.translate(&quot;ObjectPropertys&quot;, &quot;X&quot;, None, QApplication.UnicodeUTF8))
+        item1.setText(1,&quot;&quot;)
+
+        item2 = QTreeWidgetItem(item)
+        item2.setText(0,QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Y&quot;, None, QApplication.UnicodeUTF8))
+        item2.setText(1,&quot;&quot;)
+
+        item3 = QTreeWidgetItem(item)
+        item3.setText(0,QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Z&quot;, None, QApplication.UnicodeUTF8))
+        item3.setText(1,&quot;&quot;)
+
     def onItemClicked(self, item, column):
         print item.text(0)
-        print column
\ No newline at end of file
+        print column

Modified: rl/trunk/editors/Lockenwickler/src/OgreMainWindow.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/OgreMainWindow.py	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/OgreMainWindow.py	2008-10-11 17:25:56 UTC (rev 4545)
@@ -22,7 +22,7 @@
         self.middleMouseDown = False
         self.rightMouseDown = False
 
-        self.dollyCamera = False
+        self.mDollyCamera = False
 
         self.moveCamForward = False
         self.moveCamBackward = False
@@ -130,7 +130,7 @@
                 self.moduleManager.leftMouseDown = True
 
                 if self.rightMouseDown: #if right mouse button is already pressed dolly the camera
-                    self.dollyCamera = True
+                    self.mDollyCamera = True
                 else:
                     self.calculateSelectionRay(event)
 
@@ -150,8 +150,8 @@
                 self.moduleManager.leftMouseDown = False
                 self.moduleManager.leftMouseUp()
 
-                if self.dollyCamera == True: #if we dolly the camera set it to false
-                    self.dollyCamera = False
+                if self.mDollyCamera == True: #if we dolly the camera set it to false
+                    self.mDollyCamera = False
 
             elif event.button() == 2: # right mouse button is released
                 self.rightMouseDown = False
@@ -161,37 +161,41 @@
                 self.moduleManager.middleMouseDown = False
 
             if not self.rightMouseDown:
-                self.dollyCamera = False
+                self.mDollyCamera = False
                 self.camUpdateTimer.stop()
 
+            self.lastMousePosX = 0
+            self.lastMousePosY = 0
+
         elif event.type() == 5: #mouse moved while button down
+            if self.lastMousePosX == 0: # check to avoid to huge values which may happen when the user clicks and lastMousePosX/Y is zero
+                self.lastMousePosX = event.globalX()
+            if self.lastMousePosY == 0:# check to avoid to huge values which may happen when the user clicks and lastMousePosX/Y is zero
+                self.lastMousePosY = event.globalY()
+
             incX =  (event.globalX() - self.lastMousePosX)
             incY =  (event.globalY() - self.lastMousePosY)
 
-            if self.leftMouseDown and not self.middleMouseDown and not self.rightMouseDown:
+            if self.moduleManager.pivot is not None and  self.leftMouseDown and not self.middleMouseDown and not self.rightMouseDown:
                 self.moduleManager.pivot.onMouseMoved(event.globalX,  event.globalY,  incX,  incY)
 
+
             rotX = incX * 0.01
             rotY = incY * 0.01
 
-            if (rotX &lt; 0.3 and rotY &lt; 0.3) and (rotX &gt; -0.3 and rotY &gt; -0.3): # check to avoid to huge values which may happen when the user clicks and lastMousePosX/Y is zero
-                if self.dollyCamera:
-                    self.focusedWindow.dollyCamera(og.Vector3( rotX, -rotY,  0))
-                elif self.rightMouseDown:
-                    obj.orbitCamera(-rotX,  rotY)
+            if self.mDollyCamera:
+                obj.dollyCamera(og.Vector3(rotX, -rotY,  0) * 3)
+            elif self.rightMouseDown:
+                obj.orbitCamera(-rotX,  rotY)
 
             self.lastMousePosX = event.globalX()
             self.lastMousePosY = event.globalY()
 
-        elif event.type() == 3: # mouse released
-            self.lastMousePosX = 0
-            self.lastMousePosY = 0
-
         return False
 
     #calculates the the selection ray and notifies the ModuleManager that something is about to be selected
     def calculateSelectionRay(self,  event):
-        relMousePos = self.focusedWindow.mapFromGlobal(QtCore.QPoint(event.globalX(),  event.globalY())) # get the mose position relative to the focused window
+        relMousePos = self.ogreRenderWindow.mapFromGlobal(QtCore.QPoint(event.globalX(),  event.globalY())) # get the mose position relative to the ogre window
 
         if self.lastSelectionClick != None:
             if self.lastSelectionClick.x() == relMousePos.x() and self.lastSelectionClick.y() == relMousePos.y(): # mouse didn't move
@@ -201,9 +205,11 @@
                 return
 
         self.lastSelectionClick = relMousePos
-        mouseRay = self.focusedWindow.getCamera().getCameraToViewportRay(relMousePos.x()/float(self.focusedWindow.viewport.getActualHeight()),
-                                                                                                                                           relMousePos.y()/float(self.focusedWindow.viewport.getActualWidth()))
+        screenX = relMousePos.x()/float(self.ogreRenderWindow.viewport.getActualWidth())
+        screenY = relMousePos.y()/float(self.ogreRenderWindow.viewport.getActualHeight())
 
+        mouseRay = self.ogreRenderWindow.getCamera().getCameraToViewportRay(screenX, screenY)
+
         if event.modifiers() == QtCore.Qt.ControlModifier:
             self.moduleManager.selectionClick(mouseRay,  True,  False)
         elif event.modifiers() == QtCore.Qt.ShiftModifier:

Modified: rl/trunk/editors/Lockenwickler/src/Plugins-linux.cfg
===================================================================
--- rl/trunk/editors/Lockenwickler/src/Plugins-linux.cfg	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/Plugins-linux.cfg	2008-10-11 17:25:56 UTC (rev 4545)
@@ -1,12 +1,12 @@
-# Defines plugins to load
-
-# Define plugin folder
-PluginFolder=/usr/lib/OGRE
-
-# default plugins installed with the libogre14 package
-Plugin=RenderSystem_GL.so
-Plugin=Plugin_ParticleFX.so
-Plugin=Plugin_OctreeSceneManager.so
-#Plugin=Plugin_CgProgramManager
-
-
+# Defines plugins to load
+
+# Define plugin folder
+PluginFolder=/home/stefan/development/root/usr/lib/OGRE/
+
+# default plugins installed with the libogre14 package
+Plugin=RenderSystem_GL.so
+Plugin=Plugin_ParticleFX.so
+Plugin=Plugin_OctreeSceneManager.so
+#Plugin=Plugin_CgProgramManager
+
+

Added: rl/trunk/editors/Lockenwickler/src/Property.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/Property.py	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/Property.py	2008-10-11 17:25:56 UTC (rev 4545)
@@ -0,0 +1,8 @@
+class Property():
+    def __init__(self):
+
+    def setValue(self):
+
+    def getValue(self):
+
+    def createEditor(self):

Deleted: rl/trunk/editors/Lockenwickler/src/ui_FourPanelView.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/ui_FourPanelView.py	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/ui_FourPanelView.py	2008-10-11 17:25:56 UTC (rev 4545)
@@ -1,50 +0,0 @@
-# -*- coding: utf-8 -*-
-
-# Form implementation generated from reading ui file 'FourPanelView.ui'
-#
-# Created: Mon May 12 15:09:24 2008
-#      by: PyQt4 UI code generator 4.3.3
-#
-# WARNING! All changes made in this file will be lost!
-
-from PyQt4 import QtCore, QtGui
-
-class Ui_FourPaneView(object):
-    def setupUi(self, FourPaneView):
-        FourPaneView.setObjectName(&quot;FourPaneView&quot;)
-        FourPaneView.resize(QtCore.QSize(QtCore.QRect(0,0,827,856).size()).expandedTo(FourPaneView.minimumSizeHint()))
-
-        self.gridlayout = QtGui.QGridLayout(FourPaneView)
-        self.gridlayout.setObjectName(&quot;gridlayout&quot;)
-
-        self.splitter_3 = QtGui.QSplitter(FourPaneView)
-        self.splitter_3.setOrientation(QtCore.Qt.Horizontal)
-        self.splitter_3.setObjectName(&quot;splitter_3&quot;)
-
-        self.splitter = QtGui.QSplitter(self.splitter_3)
-        self.splitter.setOrientation(QtCore.Qt.Vertical)
-        self.splitter.setObjectName(&quot;splitter&quot;)
-
-        self.widget = QtGui.QWidget(self.splitter)
-        self.widget.setObjectName(&quot;widget&quot;)
-
-        self.widget_4 = QtGui.QWidget(self.splitter)
-        self.widget_4.setObjectName(&quot;widget_4&quot;)
-
-        self.splitter_2 = QtGui.QSplitter(self.splitter_3)
-        self.splitter_2.setOrientation(QtCore.Qt.Vertical)
-        self.splitter_2.setObjectName(&quot;splitter_2&quot;)
-
-        self.widget_2 = QtGui.QWidget(self.splitter_2)
-        self.widget_2.setObjectName(&quot;widget_2&quot;)
-
-        self.widget_3 = QtGui.QWidget(self.splitter_2)
-        self.widget_3.setObjectName(&quot;widget_3&quot;)
-        self.gridlayout.addWidget(self.splitter_3,0,0,1,1)
-
-        self.retranslateUi(FourPaneView)
-        QtCore.QMetaObject.connectSlotsByName(FourPaneView)
-
-    def retranslateUi(self, FourPaneView):
-        FourPaneView.setWindowTitle(QtGui.QApplication.translate(&quot;FourPaneView&quot;, &quot;Form&quot;, None, QtGui.QApplication.UnicodeUTF8))
-

Deleted: rl/trunk/editors/Lockenwickler/src/ui_obj_prop.py
===================================================================
--- rl/trunk/editors/Lockenwickler/src/ui_obj_prop.py	2008-10-03 07:34:40 UTC (rev 4544)
+++ rl/trunk/editors/Lockenwickler/src/ui_obj_prop.py	2008-10-11 17:25:56 UTC (rev 4545)
@@ -1,46 +0,0 @@
-# -*- coding: utf-8 -*-
-
-# Form implementation generated from reading ui file 'object_property.ui'
-#
-# Created: Mon May 12 15:09:23 2008
-#      by: PyQt4 UI code generator 4.3.3
-#
-# WARNING! All changes made in this file will be lost!
-
-from PyQt4 import QtCore, QtGui
-
-class Ui_ObjectPropertys(object):
-    def setupUi(self, ObjectPropertys):
-        ObjectPropertys.setObjectName(&quot;ObjectPropertys&quot;)
-        ObjectPropertys.resize(QtCore.QSize(QtCore.QRect(0,0,761,724).size()).expandedTo(ObjectPropertys.minimumSizeHint()))
-
-        self.treeWidget = QtGui.QTreeWidget(ObjectPropertys)
-        self.treeWidget.setGeometry(QtCore.QRect(0,0,901,721))
-        self.treeWidget.setMinimumSize(QtCore.QSize(400,400))
-        self.treeWidget.setObjectName(&quot;treeWidget&quot;)
-
-        self.retranslateUi(ObjectPropertys)
-        QtCore.QMetaObject.connectSlotsByName(ObjectPropertys)
-
-    def retranslateUi(self, ObjectPropertys):
-        ObjectPropertys.setWindowTitle(QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Object Properties&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.treeWidget.headerItem().setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Property&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.treeWidget.headerItem().setText(1,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Value&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.treeWidget.clear()
-
-        item = QtGui.QTreeWidgetItem(self.treeWidget)
-        item.setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Position&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        item.setText(1,&quot;&quot;)
-
-        item1 = QtGui.QTreeWidgetItem(item)
-        item1.setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;X&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        item1.setText(1,&quot;&quot;)
-
-        item2 = QtGui.QTreeWidgetItem(item)
-        item2.setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Y&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        item2.setText(1,&quot;&quot;)
-
-        item3 = QtGui.QTreeWidgetItem(item)
-        item3.setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Z&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        item3.setText(1,&quot;&quot;)
-


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001601.html">[Dsa-hl-svn] r4544 - rl/trunk/engine/rules/src
</A></li>
	<LI>Next message: <A HREF="001603.html">[Dsa-hl-svn] r4546 - in rl/branches/persistence: ai/include ai/src	core/include core/src rules/include rules/src script/src	script/swig ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1602">[ date ]</a>
              <a href="thread.html#1602">[ thread ]</a>
              <a href="subject.html#1602">[ subject ]</a>
              <a href="author.html#1602">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
