<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4563 - in rl/branches/newton20: editors/Lockenwickler	editors/Lockenwickler/src editors/Lockenwickler/src/media	engine/core/include engine/core/src engine/rules/src engine/ui/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4563%20-%20in%20rl/branches/newton20%3A%20editors/Lockenwickler%0A%09editors/Lockenwickler/src%20editors/Lockenwickler/src/media%0A%09engine/core/include%20engine/core/src%20engine/rules/src%20engine/ui/src&In-Reply-To=%3C200810191635.m9JGZlvw004220%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001619.html">
   <LINK REL="Next"  HREF="001621.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4563 - in rl/branches/newton20: editors/Lockenwickler	editors/Lockenwickler/src editors/Lockenwickler/src/media	engine/core/include engine/core/src engine/rules/src engine/ui/src</H1>
    <B>melven at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4563%20-%20in%20rl/branches/newton20%3A%20editors/Lockenwickler%0A%09editors/Lockenwickler/src%20editors/Lockenwickler/src/media%0A%09engine/core/include%20engine/core/src%20engine/rules/src%20engine/ui/src&In-Reply-To=%3C200810191635.m9JGZlvw004220%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4563 - in rl/branches/newton20: editors/Lockenwickler	editors/Lockenwickler/src editors/Lockenwickler/src/media	engine/core/include engine/core/src engine/rules/src engine/ui/src">melven at mail.berlios.de
       </A><BR>
    <I>Sun Oct 19 18:35:47 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001619.html">[Dsa-hl-svn] r4562 - in modules: . editortest
</A></li>
        <LI>Next message: <A HREF="001621.html">[Dsa-hl-svn] r4564 - in rl/trunk/editors/Lockenwickler: . src	src/media/icons
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1620">[ date ]</a>
              <a href="thread.html#1620">[ thread ]</a>
              <a href="subject.html#1620">[ subject ]</a>
              <a href="author.html#1620">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: melven
Date: 2008-10-19 18:35:21 +0200 (Sun, 19 Oct 2008)
New Revision: 4563

Added:
   rl/branches/newton20/editors/Lockenwickler/.eric4project/
   rl/branches/newton20/editors/Lockenwickler/src/ObjectPropertyModel.py
   rl/branches/newton20/editors/Lockenwickler/src/Property.py
   rl/branches/newton20/editors/Lockenwickler/src/ViewportGrid.py
   rl/branches/newton20/editors/Lockenwickler/src/setup.py
Removed:
   rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4q
   rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4t
   rl/branches/newton20/editors/Lockenwickler/src/OdeManager.py
   rl/branches/newton20/editors/Lockenwickler/src/ui_FourPanelView.py
   rl/branches/newton20/editors/Lockenwickler/src/ui_lw.py
   rl/branches/newton20/editors/Lockenwickler/src/ui_model_prev.py
   rl/branches/newton20/editors/Lockenwickler/src/ui_obj_prop.py
Modified:
   rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4p
   rl/branches/newton20/editors/Lockenwickler/src/ConsoleWindow.py
   rl/branches/newton20/editors/Lockenwickler/src/Lockenwickler.py
   rl/branches/newton20/editors/Lockenwickler/src/ModelSelectionDialog.py
   rl/branches/newton20/editors/Lockenwickler/src/ModuleManager.py
   rl/branches/newton20/editors/Lockenwickler/src/MovePivot.py
   rl/branches/newton20/editors/Lockenwickler/src/ObjectPropertyWin.py
   rl/branches/newton20/editors/Lockenwickler/src/OgreMainWindow.py
   rl/branches/newton20/editors/Lockenwickler/src/OgreWidget.py
   rl/branches/newton20/editors/Lockenwickler/src/Plugins-linux.cfg
   rl/branches/newton20/editors/Lockenwickler/src/PreferencesDialog.py
   rl/branches/newton20/editors/Lockenwickler/src/PythonOgreConfig.py
   rl/branches/newton20/editors/Lockenwickler/src/SceneExplorer.py
   rl/branches/newton20/editors/Lockenwickler/src/media/Pivot_Point.material
   rl/branches/newton20/engine/core/include/MessagePump.h
   rl/branches/newton20/engine/core/src/MessagePump.cpp
   rl/branches/newton20/engine/rules/src/Combat.cpp
   rl/branches/newton20/engine/rules/src/FetchItemJob.cpp
   rl/branches/newton20/engine/ui/src/UiSubsystem.cpp
Log:
merged changes from trunk



Copied: rl/branches/newton20/editors/Lockenwickler/.eric4project (from rev 4561, rl/trunk/editors/Lockenwickler/.eric4project)

Modified: rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4p
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4p	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4p	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,9 +1,9 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;!DOCTYPE Project SYSTEM &quot;Project-4.4.dtd&quot;&gt;
+&lt;!DOCTYPE Project SYSTEM &quot;Project-4.5.dtd&quot;&gt;
 &lt;!-- eric4 project file for project Lockenwickler --&gt;
-&lt;!-- Saved: 2008-09-20, 20:03:11 --&gt;
+&lt;!-- Saved: 2008-10-16, 19:21:23 --&gt;
 &lt;!-- Copyright (C) 2008 Stefan Stammberger, <A HREF="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">sstammberger at web.de</A> --&gt;
-&lt;Project version=&quot;4.4&quot;&gt;
+&lt;Project version=&quot;4.5&quot;&gt;
   &lt;ProgLanguage mixed=&quot;0&quot;&gt;Python&lt;/ProgLanguage&gt;
   &lt;ProjectType&gt;Qt4&lt;/ProjectType&gt;
   &lt;Description&gt;Lockenwickler is an Editor application for the Rastulahs Lockenpracht game.&lt;/Description&gt;
@@ -17,16 +17,11 @@
     &lt;Source&gt;src/ModuleManager.py&lt;/Source&gt;
     &lt;Source&gt;src/MovePivot.py&lt;/Source&gt;
     &lt;Source&gt;src/ObjectPropertyWin.py&lt;/Source&gt;
-    &lt;Source&gt;src/OdeManager.py&lt;/Source&gt;
     &lt;Source&gt;src/OgreMainWindow.py&lt;/Source&gt;
     &lt;Source&gt;src/OgreWidget.py&lt;/Source&gt;
     &lt;Source&gt;src/PreferencesDialog.py&lt;/Source&gt;
     &lt;Source&gt;src/PythonOgreConfig.py&lt;/Source&gt;
     &lt;Source&gt;src/ui_ConsoleWindow.py&lt;/Source&gt;
-    &lt;Source&gt;src/ui_FourPanelView.py&lt;/Source&gt;
-    &lt;Source&gt;src/ui_lw.py&lt;/Source&gt;
-    &lt;Source&gt;src/ui_model_prev.py&lt;/Source&gt;
-    &lt;Source&gt;src/ui_obj_prop.py&lt;/Source&gt;
     &lt;Source&gt;src/ui_pref_dialog.py&lt;/Source&gt;
     &lt;Source&gt;ui files/batch_convert_ui.py&lt;/Source&gt;
     &lt;Source&gt;ui files/ui_ConsoleWindow.py&lt;/Source&gt;
@@ -36,6 +31,9 @@
     &lt;Source&gt;ui files/ui_obj_prop.py&lt;/Source&gt;
     &lt;Source&gt;ui files/ui_pref_dialog.py&lt;/Source&gt;
     &lt;Source&gt;src/SceneExplorer.py&lt;/Source&gt;
+    &lt;Source&gt;src/Property.py&lt;/Source&gt;
+    &lt;Source&gt;src/ViewportGrid.py&lt;/Source&gt;
+    &lt;Source&gt;src/ObjectPropertyModel.py&lt;/Source&gt;
   &lt;/Sources&gt;
   &lt;Forms&gt;
     &lt;Form&gt;ui files/console_window.ui&lt;/Form&gt;
@@ -170,9 +168,11 @@
   &lt;FiletypeAssociations&gt;
     &lt;FiletypeAssociation pattern=&quot;*.ui&quot; type=&quot;FORMS&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.idl&quot; type=&quot;INTERFACES&quot; /&gt;
+    &lt;FiletypeAssociation pattern=&quot;*.qm&quot; type=&quot;TRANSLATIONS&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.ptl&quot; type=&quot;SOURCES&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.pyw&quot; type=&quot;SOURCES&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.ui.h&quot; type=&quot;FORMS&quot; /&gt;
+    &lt;FiletypeAssociation pattern=&quot;*.ts&quot; type=&quot;TRANSLATIONS&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.py&quot; type=&quot;SOURCES&quot; /&gt;
     &lt;FiletypeAssociation pattern=&quot;*.qrc&quot; type=&quot;RESOURCES&quot; /&gt;
   &lt;/FiletypeAssociations&gt;

Deleted: rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4q
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4q	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4q	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,7 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;!DOCTYPE UserProject SYSTEM &quot;UserProject-4.0.dtd&quot;&gt;
-&lt;!-- eric4 user project file for project Lockenwickler --&gt;
-&lt;!-- Saved: 2008-06-23, 19:40:36 --&gt;
-&lt;!-- Copyright (C) 2008 Stefan Stammberger, <A HREF="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">sstammberger at web.de</A> --&gt;
-&lt;UserProject version=&quot;4.0&quot;&gt;
-&lt;/UserProject&gt;
\ No newline at end of file

Deleted: rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4t
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4t	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/Lockenwickler.e4t	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,6 +0,0 @@
-&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
-&lt;!DOCTYPE Tasks SYSTEM &quot;Tasks-4.1.dtd&quot;&gt;
-&lt;!-- eric4 tasks file for project Lockenwickler --&gt;
-&lt;!-- Saved: 2008-06-23, 19:40:36 --&gt;
-&lt;Tasks version=&quot;4.1&quot;&gt;
-&lt;/Tasks&gt;
\ No newline at end of file

Modified: rl/branches/newton20/editors/Lockenwickler/src/ConsoleWindow.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/ConsoleWindow.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/ConsoleWindow.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,7 +1,31 @@
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
 import sys
+from PyQt4.QtCore import *
+from PyQt4.QtGui import *
+
 from ui_ConsoleWindow import *
 import ogre.renderer.OGRE as og
 
+
+
 class LockenLog(og.LogListener):
     def __init__(self, logFunction):
         og.LogListener.__init__(self)
@@ -18,12 +42,18 @@
         self.consoleWindow = Ui_ConsoleWindow()
         self.consoleWindow.setupUi(self)
         self.consoleWindow.textEdit.setReadOnly(True)
-
         self.lockenLog = LockenLog(self.write)
 
         sys.stdout = self
         sys.stderr = self
 
+        clearAction= QAction(&quot;Clear Window&quot;,  self)
+        self.consoleWindow.textEdit.addAction(clearAction)
+        self.consoleWindow.textEdit.setContextMenuPolicy(Qt.ActionsContextMenu)
+        clearAction.setShortcut(&quot;Ctrl + R&quot;)
+        self.connect(clearAction, SIGNAL(&quot;triggered()&quot;), self.consoleWindow.textEdit.clear)
+
+
     def write(self, text):
         if self.filterLog:
             if text.isspace():
@@ -34,6 +64,11 @@
             elif text.startswith(&quot;OGRE EXCEPTION&quot;):
                 self.consoleWindow.textEdit.append(text)
                 return
+            elif text.startswith(&quot;dbg:&quot;):
+                self.consoleWindow.textEdit.append(text)
+                return
         else:
             self.consoleWindow.textEdit.append(text)
 
+    def clear(self):
+        self.consoleWindow.textEdit.clear()

Modified: rl/branches/newton20/editors/Lockenwickler/src/Lockenwickler.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/Lockenwickler.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/Lockenwickler.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,387 +1,464 @@
-import os
-import sys
-import platform
-
-#sys.path.insert(0,'..')
-#import PythonOgreConfig
-
-from random import randint
-from os.path import isfile
-
-from PyQt4 import QtGui, QtCore
-from PreferencesDialog import *
-from ObjectPropertyWin import *
-from ModelSelectionDialog import *
-from ConsoleWindow import *
-from ModuleManager import *
-from SceneExplorer import *
-
-import OgreMainWindow
-import ogre.renderer.OGRE as og
-
-class Lockenwickler(QtGui.QMainWindow):
-    def __init__(self, parent=None):
-        QtGui.QWidget.__init__(self, parent)
-
-        self.setupUi()
-
-        self.consoleWindow = ConsoleWindow(False,  self)
-
-        self.setupOgre()
-
-        self.prefDialog = PreferencesDialog(self.loadModule, self)
-        self.objectPropertyWin = ObjectPropertyWin(self)
-        self.sceneExplorerWin = SceneExplorer(self)
-        self.modelSelectionDialog = ModelSelectionDialog(self.ogreRoot, self)
-
-        self.createDockWindows()
-
-        self.mainTimer = QtCore.QTimer(self)
-        self.mainTimer.connect(self.mainTimer, QtCore.SIGNAL(&quot;timeout()&quot;), self.update)
-        self.mainTimer.start(5)
-
-        settings = QtCore.QSettings()
-        self.restoreGeometry(settings.value(&quot;MainWindow/Geometry&quot;).toByteArray())
-        self.restoreState(settings.value(&quot;MainWindow/DockWindows&quot;).toByteArray())
-
-        self.setWindowTitle(&quot;Rastullahs Lockenwickler&quot;)
-#        # Import Psyco if available
-#        try:
-#            import psyco
-#            psyco.full()
-#            #psyco.log()
-#            #psyco.profile()
-#        except ImportError:
-#            pass
-
-        #QtGui.QApplication.setKeyboardInputInterval(5000)
-
-    def createAction(self, text, slot=None, shortcut=None, icon=None, tip=None, checkable=False, signal=&quot;triggered()&quot;):
-        action = QtGui.QAction(text, self)
-        if icon is not None:
-            action.setIcon(QtGui.QIcon(&quot;media/icons/%s&quot; % icon))
-        if shortcut is not None:
-            action.setShortcut(shortcut)
-        if tip is not None:
-            action.setToolTip(tip)
-            action.setStatusTip(tip)
-        if slot is not None:
-            self.connect(action, QtCore.SIGNAL(signal), slot)
-
-        action.setCheckable(checkable)
-
-        return action
-
-    def addActions(self, target, actions):
-        for act in actions:
-            if act is None:
-               target.addSeparator()
-            else:
-                target.addAction(act)
-
-    def setupUi(self):
-        self.setObjectName(&quot;MainWindow&quot;)
-
-        self.centralwidget = QtGui.QWidget(self)
-        self.centralwidget.setObjectName(&quot;centralwidget&quot;)
-
-        self.hboxlayout = QtGui.QHBoxLayout(self.centralwidget)
-        self.hboxlayout.setObjectName(&quot;hboxlayout&quot;)
-
-        self.gridlayout = QtGui.QGridLayout()
-        self.gridlayout.setObjectName(&quot;gridlayout&quot;)
-
-        self.menubar = QtGui.QMenuBar(self)
-        self.menubar.setObjectName(&quot;menubar&quot;)
-
-        self.menuFile = QtGui.QMenu(self.menubar)
-        self.menuFile.setObjectName(&quot;menuFile&quot;)
-
-        self.menuView = QtGui.QMenu(self.menubar)
-        self.menuView.setObjectName(&quot;menuView&quot;)
-        self.setMenuBar(self.menubar)
-
-
-        self.statusbar = QtGui.QStatusBar(self)
-        self.statusbar.setObjectName(&quot;statusbar&quot;)
-        self.setStatusBar(self.statusbar)
-
-        self.actionNeu = QtGui.QAction(QtGui.QIcon(&quot;media/icons/package.png&quot;), &quot;&amp;New&quot;,  self)
-        self.actionNeu.setObjectName(&quot;actionNeu&quot;)
-
-        self.actionClose = self.createAction(&quot;Quit&quot;,  self.close,  &quot;Alt + Q&quot;,  &quot;exit.png&quot;,  &quot;Quit&quot;)
-        self.actionClose.setObjectName(&quot;actionClose&quot;)
-
-
-
-        self.actionMove = self.createAction(&quot;&amp;Move&quot;,  self.actionMoveSlot,  &quot;g&quot;,  &quot;move.png&quot;,  &quot;Move selected object&quot;)
-        self.actionMove.setObjectName(&quot;actionMove&quot;)
-
-        self.actionRotate = self.createAction(&quot;&amp;Rotate&quot;,  self.actionRotateSlot,  &quot;r&quot;,  &quot;rotate.png&quot;,  &quot;Rotate selected object&quot;)
-        self.actionRotate.setObjectName(&quot;actionRotate&quot;)
-
-        self.actionScale = self.createAction(&quot;&amp;Scale&quot;,  self.actionScaleSlot,  &quot;s&quot;,  &quot;resizecol.png&quot;,  &quot;Scale selected object&quot;)
-        self.actionRotate.setObjectName(&quot;actionRotate&quot;)
-
-
-        self.actionSceneExplorer = self.createAction(&quot;&amp;Scene Exlporer&quot;,  self.toggleSceneExplorer,  &quot;Alt + E&quot;,  &quot;view_tree.png&quot;,  &quot;Scene Explorer&quot;,  False)
-        self.actionSceneExplorer.setObjectName(&quot;actionSceneExplorer&quot;)
-
-        self.actionPreferences = self.createAction(&quot;&amp;Preferences&quot;,  self.togglePreferencesWindow,  &quot;Alt + P&quot;,  &quot;configure.png&quot;,  &quot;Lockenwickler Preferences&quot;,  False)
-        self.actionPreferences.setObjectName(&quot;actionPreferences&quot;)
-
-        self.actionProperty_Window = self.createAction(&quot;Pr&amp;operty Window&quot;,  self.togglePropertyWindow,  &quot;Alt + P&quot;,  &quot;unsortedlist1.png&quot;,  &quot;Property Window&quot;)
-        self.actionProperty_Window.setObjectName(&quot;actionProperty_Window&quot;)
-
-        self.actionObject_Selection = self.createAction(&quot;&amp;Model Preview Window&quot;,  self.toggleModelPreviewWindow,  &quot;Alt + O&quot;,  &quot;tux.png&quot;,  &quot;Model Preview&quot;)
-        self.actionObject_Selection.setObjectName(&quot;actionObject_Selection&quot;)
-
-        self.actionConsole_Window = self.createAction(&quot;&amp;Console Window&quot;,  self.toggleConsoleWindow,  &quot;Alt + C&quot;,  &quot;console.png&quot;,  &quot;Console Window&quot;)
-        self.actionConsole_Window.setObjectName(&quot;actionConsole_Window&quot;)
-
-
-        self.menuFile.addAction(self.actionNeu)
-        self.menuFile.addAction(self.actionClose)
-        self.menuView.addAction(self.actionSceneExplorer)
-        self.menuView.addAction(self.actionPreferences)
-        self.menuView.addAction(self.actionProperty_Window)
-        self.menuView.addAction(self.actionObject_Selection)
-        self.menuView.addAction(self.actionConsole_Window)
-        self.menubar.addAction(self.menuFile.menuAction())
-        self.menubar.addAction(self.menuView.menuAction())
-
-        self.retranslateUi()
-        QtCore.QMetaObject.connectSlotsByName(self)
-
-    def retranslateUi(self):
-        self.setWindowTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;MainWindow&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.menuFile.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;File&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.menuView.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;View&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionNeu.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;New&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionMove.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Move&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionRotate.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Rotate&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionSceneExplorer.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Scene Explorer&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionPreferences.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Preferences&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionProperty_Window.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Property Window&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionObject_Selection.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Object Selection&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionClose.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Quit&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.actionConsole_Window.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Console Window&quot;, None, QtGui.QApplication.UnicodeUTF8))
-
-    def setupOgre(self, pluginCfgPath=&quot;./Plugins.cfg&quot;, ogreCfgPath=&quot;./ogre.cfg&quot;, logPath=&quot;./ogre.log&quot;):
-        if platform.system() == &quot;Windows&quot;:
-            pluginCfgPath=&quot;./Plugins-windows.cfg&quot;
-        else:
-            pluginCfgPath=&quot;./Plugins-linux.cfg&quot;
-
-        root = og.Root(pluginCfgPath, ogreCfgPath, logPath)
-        self.ogreRoot = root
-
-        if  not self.ogreRoot.restoreConfig() and not self.ogreRoot.showConfigDialog():
-            sys.exit('Quit from Config Dialog')
-
-        root.initialise(False)
-
-        self.OgreMainWinSceneMgr = self.ogreRoot.createSceneManager(og.ST_GENERIC, &quot;OgreMainWinSceneMgr&quot;)
-        self.OgreMainWinSceneMgr.ambientLight = og.ColourValue(4, 4, 4)
-
-        self.moduleName = &quot;&quot;
-        self.moduleManager = ModuleManager(self.ogreRoot,  self.OgreMainWinSceneMgr)
-
-        self.ogreRenderWindow = OgreMainWindow.OgreMainWindow(self.moduleManager,  root,  self.OgreMainWinSceneMgr,  self)
-        self.gridlayout.addWidget(self.ogreRenderWindow,0,0,1,1)
-        self.hboxlayout.addLayout(self.gridlayout)
-        self.setCentralWidget(self.centralwidget)
-
-        og.ResourceGroupManager.getSingleton().addResourceLocation(&quot;./media&quot;, &quot;FileSystem&quot;, &quot;General&quot;, False)
-        og.ResourceGroupManager.getSingleton().initialiseAllResourceGroups()
-
-        oglog = og.LogManager.getSingleton().getDefaultLog()
-        oglog.addListener(self.consoleWindow.lockenLog)
-
-    def update(self):
-        self.ogreRoot.renderOneFrame()
-
-    def actionMoveSlot(self):
-        print &quot;MOVE!!!!!!!!!!!&quot;
-
-    def actionRotateSlot(self):
-        print &quot;ROTATE!!!!!!!!!&quot;
-
-    def actionScaleSlot(self):
-        print &quot;Scale!!!!!!!!&quot;
-
-    def togglePreferencesWindow(self):
-        if self.prefDialog.isHidden():
-            self.prefDialog.show()
-        else:
-            self.prefDialog.hide()
-
-    def toggleModelPreviewWindow(self):
-        if self.modelSelectionDock.isHidden():
-            self.modelSelectionDock.show()
-        else:
-            self.modelSelectionDock.hide()
-
-    def toggleSceneExplorer(self):
-        if self.sceneExplorerDock.isHidden():
-            self.sceneExplorerDock.show()
-        else:
-            self.sceneExplorerDock.hide()
-
-    def togglePropertyWindow(self):
-        if self.propertyDock.isHidden():
-            self.propertyDock.show()
-        else:
-            self.propertyDock.hide()
-
-    def toggleConsoleWindow(self):
-        if self.consoleDock.isHidden():
-            self.consoleDock.show()
-        else:
-            self.consoleDock.hide()
-
-    # parses the moduleconfig.rb and searches for all loader.loadmap(&quot; statements in the ruby script
-    # and parses them too
-    def loadModule(self, modulePath, moduleName):
-        if self.moduleName == moduleName:
-            return
-
-        self.moduleName = moduleName
-        self.workingDir = modulePath + moduleName # the module path
-        self.workingDirCommon = modulePath + &quot;common&quot; # the module path of the common module
-
-        import codecs
-        import glob
-
-        modConfig = self.workingDir + &quot;/scripts/moduleconfig.rb&quot;
-        if isfile(modConfig): # is the modconfig existing?
-            f = codecs.open(modConfig, 'r', 'utf-8')
-        else:
-            print (&quot;Error: couldn't find module config&quot;)
-            pass
-
-        self.mapFiles = [] # a list in case the module has more than one map file
-
-        for line in f:
-            lStripped = line.strip() #strip the whitespace away, not needed here
-
-            # get the map file(s)
-            if lStripped.startswith(&quot;loader.loadMap(&quot;): # all loadMap commands begin with loader.loadMap(
-                spl = lStripped.split('&quot;')
-                for a in spl:
-                    if a.endswith(&quot;.xml&quot;):
-                        pathToMapFile = self.workingDir + &quot;/maps/&quot; + a
-                        self.mapFiles.append(pathToMapFile)
-
-        self.setWindowTitle(moduleName)
-
-        self.modelSelectionDialog.scanDirForModels(self.workingDir, moduleName)
-        self.modelSelectionDialog.scanDirForModels(self.workingDirCommon, &quot;common&quot;)
-
-        self.setResourcePaths(self.workingDir, moduleName)
-        self.setResourcePaths(self.workingDirCommon, &quot;common&quot;)
-        og.ResourceGroupManager.getSingleton().initialiseAllResourceGroups()
-
-        command = (os.path.join(self.workingDir,  &quot;maps&quot;) + &quot;/*.xml&quot;)
-        for mf in glob.glob(command): # search for all xml files in the maps directory and add them
-            self.mapFiles.append(mf)
-
-        command = (os.path.join(self.workingDir,  &quot;maps&quot;) + &quot;/*.scene&quot;)
-        for mf in glob.glob(command): # search for all xml files in the maps directory and add them
-            self.mapFiles.append(mf)
-
-        self.moduleManager.load(moduleName,  self.mapFiles)
-
-    def setResourcePaths(self, path, moduleName):
-        for file in os.listdir(path):
-            curFile = path + &quot;/&quot; + file
-
-            if file.startswith('.'): #ignore dot files (hidden)
-                continue
-            if isdir(curFile):
-                og.ResourceGroupManager.getSingleton().addResourceLocation(curFile, &quot;FileSystem&quot;, moduleName, False)
-                self.setResourcePaths(curFile, moduleName)
-                continue
-            if isfile(curFile):
-                pass
-
-    def createDockWindows(self):
-        self.propertyDock = QtGui.QDockWidget(self.tr(&quot;Properties&quot;), self)
-        self.propertyDock.setObjectName(&quot;PropertyDockWindow&quot;)
-        self.propertyDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
-        self.propertyDock.setWidget(self.objectPropertyWin)
-        self.addDockWidget(QtCore.Qt.LeftDockWidgetArea, self.propertyDock)
-
-        self.modelSelectionDock = QtGui.QDockWidget(self.tr(&quot;Models&quot;), self)
-        self.modelSelectionDock.setObjectName(&quot;ModelSelectionDockWindow&quot;)
-        self.modelSelectionDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
-        self.modelSelectionDock.setWidget(self.modelSelectionDialog)
-        self.addDockWidget(QtCore.Qt.RightDockWidgetArea, self.modelSelectionDock)
-
-        self.sceneExplorerDock = QtGui.QDockWidget(self.tr(&quot;Scene Explorer&quot;), self)
-        self.sceneExplorerDock.setObjectName(&quot;SceneExplorerDockWindow&quot;)
-        self.sceneExplorerDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
-        self.sceneExplorerDock.setWidget(self.sceneExplorerWin)
-        self.addDockWidget(QtCore.Qt.LeftDockWidgetArea, self.sceneExplorerDock)
-
-        self.consoleDock = QtGui.QDockWidget(self.tr(&quot;Console&quot;), self)
-        self.consoleDock.setObjectName(&quot;ConsoleDockWindow&quot;)
-        self.consoleDock.setAllowedAreas(QtCore.Qt.BottomDockWidgetArea | QtCore.Qt.TopDockWidgetArea)
-        self.consoleDock.setWidget(self.consoleWindow)
-        self.addDockWidget(QtCore.Qt.BottomDockWidgetArea, self.consoleDock)
-
-        self.fileToolBar = self.addToolBar(&quot;File Toolbar&quot;)
-        self.fileToolBar.setObjectName(&quot;FileToolBar&quot;)
-        self.fileToolBar.setAllowedAreas(QtCore.Qt.TopToolBarArea | QtCore.Qt.BottomToolBarArea)
-        self.fileToolBar.addAction(self.actionNeu)
-        self.fileToolBar.addAction(self.actionClose)
-        self.addToolBar(QtCore.Qt.TopToolBarArea, self.fileToolBar)
-
-        self.moveToolBar = self.addToolBar(&quot;Transformation Bar&quot;)
-        self.moveToolBar.setObjectName(&quot;TransformationBar&quot;)
-        self.moveToolBar.setAllowedAreas(QtCore.Qt.TopToolBarArea | QtCore.Qt.BottomToolBarArea)
-        self.moveToolBar.addAction(self.actionMove)
-        self.moveToolBar.addAction(self.actionRotate)
-        self.moveToolBar.addAction(self.actionScale)
-        self.addToolBar(QtCore.Qt.TopToolBarArea, self.moveToolBar)
-
-    def keyPressEvent(self,  event):
-        if not event.isAutoRepeat():
-            self.ogreRenderWindow.keyPressEvent(event)
-
-    def keyReleaseEvent(self,  event):
-        if not event.isAutoRepeat():
-            self.ogreRenderWindow.keyReleaseEvent(event)
-        pass
-
-    def connectActionButtons(self):
-        pass
-
-    def saveOnClose(self):
-        reply = QtGui.QMessageBox.question(self,  &quot;Rastullahs Lockenwickler - Unsaved Chages&quot;,  &quot;Save unsaved changes?&quot;,  QtGui.QMessageBox.Yes|QtGui.QMessageBox.No|QtGui.QMessageBox.Cancel)
-        if reply == QtGui.QMessageBox.Cancel:
-            return False
-        if reply == QtGui.QMessageBox.Yes:
-            print &quot;SAVE!!!!&quot;
-            #TODO: implement save here
-        return True
-
-    def closeEvent(self,  event):
-        if self.saveOnClose():
-            settings = QtCore.QSettings()
-            settings.setValue(&quot;MainWindow/Geometry&quot;,  QtCore.QVariant(self.saveGeometry()))
-            settings.setValue(&quot;MainWIndow/DockWindows&quot;,  QtCore.QVariant(self.saveState()))
-        else:
-            event.ignore()
-
-if __name__ == &quot;__main__&quot;:
-    app = QtGui.QApplication(sys.argv)
-    app.setOrganizationName(&quot;Team Pantheon&quot;)
-    app.setOrganizationDomain(&quot;rastullahs-lockenpracht.de/team&quot;)
-    app.setApplicationName(&quot;Lockenwickler&quot;)
-
-    form = Lockenwickler()
-    form.show()
-
-    sys.exit(app.exec_())
-
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
+import os
+import sys
+import platform
+
+sys.path.insert(0,'..')
+import PythonOgreConfig
+
+from random import randint
+from os.path import isfile
+
+from PyQt4 import QtGui, QtCore
+from PreferencesDialog import *
+from ObjectPropertyWin import *
+from ModelSelectionDialog import *
+from ConsoleWindow import *
+from ModuleManager import *
+from SceneExplorer import *
+
+import OgreMainWindow
+import ogre.renderer.OGRE as og
+
+class Lockenwickler(QtGui.QMainWindow):
+    def __init__(self, parent=None):
+        QtGui.QWidget.__init__(self, parent)
+
+        self.setupUi()
+
+        self.consoleWindow = ConsoleWindow(True,  self)
+
+        self.setupOgre()
+
+        self.prefDialog = PreferencesDialog(self.loadModule, self)
+        self.objectPropertyWin = ObjectPropertyWin(self)
+        self.sceneExplorerWin = SceneExplorer(self)
+        self.modelSelectionDialog = ModelSelectionDialog(self.ogreRoot, self)
+
+        self.createDockWindows()
+
+        self.mainTimer = QtCore.QTimer(self)
+        self.mainTimer.connect(self.mainTimer, QtCore.SIGNAL(&quot;timeout()&quot;), self.update)
+        self.mainTimer.start(5)
+
+        settings = QtCore.QSettings()
+        self.restoreGeometry(settings.value(&quot;MainWindow/Geometry&quot;).toByteArray())
+        self.restoreState(settings.value(&quot;MainWindow/DockWindows&quot;).toByteArray())
+
+        self.setWindowTitle(&quot;Rastullahs Lockenwickler&quot;)
+#        # Import Psyco if available
+#        try:
+#            import psyco
+#            psyco.full()
+#            #psyco.log()
+#            #psyco.profile()
+#        except ImportError:
+#            pass
+
+        #QtGui.QApplication.setKeyboardInputInterval(5000)
+
+    def createAction(self, text, slot=None, shortcut=None, icon=None, tip=None, checkable=False, signal=&quot;triggered()&quot;):
+        action = QtGui.QAction(text, self)
+        if icon is not None:
+            action.setIcon(QtGui.QIcon(&quot;media/icons/%s&quot; % icon))
+        if shortcut is not None:
+            action.setShortcut(shortcut)
+        if tip is not None:
+            action.setToolTip(tip)
+            action.setStatusTip(tip)
+        if slot is not None:
+            self.connect(action, QtCore.SIGNAL(signal), slot)
+
+        action.setCheckable(checkable)
+
+        return action
+
+    def addActions(self, target, actions):
+        for act in actions:
+            if act is None:
+               target.addSeparator()
+            else:
+                target.addAction(act)
+
+    def setupUi(self):
+        self.setObjectName(&quot;MainWindow&quot;)
+
+        self.centralwidget = QtGui.QWidget(self)
+        self.centralwidget.setObjectName(&quot;centralwidget&quot;)
+
+        self.hboxlayout = QtGui.QHBoxLayout(self.centralwidget)
+        self.hboxlayout.setObjectName(&quot;hboxlayout&quot;)
+
+        self.gridlayout = QtGui.QGridLayout()
+        self.gridlayout.setObjectName(&quot;gridlayout&quot;)
+
+        self.menubar = QtGui.QMenuBar(self)
+        self.menubar.setObjectName(&quot;menubar&quot;)
+
+        self.menuFile = QtGui.QMenu(self.menubar)
+        self.menuFile.setObjectName(&quot;menuFile&quot;)
+
+        self.menuEdit = QtGui.QMenu(self.menubar)
+        self.menuEdit.setObjectName(&quot;menuEdit&quot;)
+
+        self.menuView = QtGui.QMenu(self.menubar)
+        self.menuView.setObjectName(&quot;menuView&quot;)
+        self.setMenuBar(self.menubar)
+
+
+        self.statusbar = QtGui.QStatusBar(self)
+        self.statusbar.setObjectName(&quot;statusbar&quot;)
+        self.setStatusBar(self.statusbar)
+
+#####################################
+        self.actionNeu =self.createAction(&quot;&amp;New&quot;,  self.actionNewSlot,  QKeySequence.New,  &quot;filenew.png&quot;,  &quot;New&quot;)
+        self.actionNeu.setObjectName(&quot;actionNeu&quot;)
+
+        self.actionClose = self.createAction(&quot;Quit&quot;,  self.actionQuitSlot,  &quot;Alt + Q&quot;,  &quot;exit.png&quot;,  &quot;Quit&quot;)
+        self.actionClose.setObjectName(&quot;actionQuit&quot;)
+#####################################
+
+
+#####################################
+        self.actionDelete = self.createAction(&quot;Delete&quot;,  self.actionDeleteSlot,  QKeySequence.Delete,  &quot;editdelete.png&quot;,  &quot;Delete&quot;)
+        self.actionDelete.setObjectName(&quot;actionDelete&quot;)
+
+        self.actionCopy = self.createAction(&quot;Copy&quot;,  self.actionCopySlot,  QKeySequence.Copy,  &quot;editcopy.png&quot;,  &quot;Copy&quot;)
+        self.actionCopy.setObjectName(&quot;actionCopy&quot;)
+
+        self.actionCut = self.createAction(&quot;Cut&quot;,  self.actionCutSlot,  QKeySequence.Cut,  &quot;editcut.png&quot;,  &quot;Cut&quot;)
+        self.actionCut.setObjectName(&quot;actionCut&quot;)
+
+        self.actionPaste = self.createAction(&quot;Paste&quot;,  self.actionPasteSlot,  QKeySequence.Paste,  &quot;editpaste.png&quot;,  &quot;Paste&quot;)
+        self.actionPaste.setObjectName(&quot;actionPaste&quot;)
+
+        self.actionMove = self.createAction(&quot;&amp;Move&quot;,  self.actionMoveSlot,  &quot;g&quot;,  &quot;move.png&quot;,  &quot;Move selected object&quot;)
+        self.actionMove.setObjectName(&quot;actionMove&quot;)
+
+        self.actionRotate = self.createAction(&quot;&amp;Rotate&quot;,  self.actionRotateSlot,  &quot;r&quot;,  &quot;rotate.png&quot;,  &quot;Rotate selected object&quot;)
+        self.actionRotate.setObjectName(&quot;actionRotate&quot;)
+
+        self.actionScale = self.createAction(&quot;&amp;Scale&quot;,  self.actionScaleSlot,  &quot;x&quot;,  &quot;resizecol.png&quot;,  &quot;Scale selected object&quot;)
+        self.actionRotate.setObjectName(&quot;actionRotate&quot;)
+
+
+#####################################
+#####################################
+        self.actionSceneExplorer = self.createAction(&quot;&amp;Scene Exlporer&quot;,  self.toggleSceneExplorer,  &quot;Alt + E&quot;,  &quot;view_tree.png&quot;,  &quot;Scene Explorer&quot;,  False)
+        self.actionSceneExplorer.setObjectName(&quot;actionSceneExplorer&quot;)
+
+        self.actionPreferences = self.createAction(&quot;&amp;Preferences&quot;,  self.togglePreferencesWindow,  &quot;Alt + P&quot;,  &quot;configure.png&quot;,  &quot;Lockenwickler Preferences&quot;,  False)
+        self.actionPreferences.setObjectName(&quot;actionPreferences&quot;)
+
+        self.actionProperty_Window = self.createAction(&quot;Pr&amp;operty Window&quot;,  self.togglePropertyWindow,  &quot;Alt + P&quot;,  &quot;unsortedlist1.png&quot;,  &quot;Property Window&quot;)
+        self.actionProperty_Window.setObjectName(&quot;actionProperty_Window&quot;)
+
+        self.actionObject_Selection = self.createAction(&quot;&amp;Model Preview Window&quot;,  self.toggleModelPreviewWindow,  &quot;Alt + O&quot;,  &quot;tux.png&quot;,  &quot;Model Preview&quot;)
+        self.actionObject_Selection.setObjectName(&quot;actionObject_Selection&quot;)
+
+        self.actionConsole_Window = self.createAction(&quot;&amp;Console Window&quot;,  self.toggleConsoleWindow,  &quot;Alt + C&quot;,  &quot;console.png&quot;,  &quot;Console Window&quot;)
+        self.actionConsole_Window.setObjectName(&quot;actionConsole_Window&quot;)
+
+#####################################
+#####################################
+
+
+        self.menuFile.addAction(self.actionNeu)
+        self.menuFile.addAction(self.actionClose)
+
+        self.menuEdit.addAction(self.actionMove)
+        self.menuEdit.addAction(self.actionRotate)
+        self.menuEdit.addAction(self.actionScale)
+        self.menuEdit.addSeparator()
+        self.menuEdit.addAction(self.actionDelete)
+        self.menuEdit.addAction(self.actionCopy)
+        self.menuEdit.addAction(self.actionCut)
+        self.menuEdit.addAction(self.actionPaste)
+
+        self.menuView.addAction(self.actionSceneExplorer)
+        self.menuView.addAction(self.actionPreferences)
+        self.menuView.addAction(self.actionProperty_Window)
+        self.menuView.addAction(self.actionObject_Selection)
+        self.menuView.addAction(self.actionConsole_Window)
+        self.menubar.addAction(self.menuFile.menuAction())
+        self.menubar.addAction(self.menuEdit.menuAction())
+        self.menubar.addAction(self.menuView.menuAction())
+
+        self.retranslateUi()
+        QtCore.QMetaObject.connectSlotsByName(self)
+
+    def retranslateUi(self):
+        self.setWindowTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;MainWindow&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.menuFile.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;File&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.menuEdit.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Edit&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.menuView.setTitle(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;View&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionNeu.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;New&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionMove.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Move&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionRotate.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Rotate&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionSceneExplorer.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Scene Explorer&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionPreferences.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Preferences&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionProperty_Window.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Property Window&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionObject_Selection.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Object Selection&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionClose.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Quit&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.actionConsole_Window.setText(QtGui.QApplication.translate(&quot;MainWindow&quot;, &quot;Console Window&quot;, None, QtGui.QApplication.UnicodeUTF8))
+
+    def setupOgre(self, pluginCfgPath=&quot;./Plugins.cfg&quot;, ogreCfgPath=&quot;./ogre.cfg&quot;, logPath=&quot;./ogre.log&quot;):
+        if platform.system() == &quot;Windows&quot;:
+            pluginCfgPath=&quot;./Plugins-windows.cfg&quot;
+        else:
+            pluginCfgPath=&quot;./Plugins-linux.cfg&quot;
+
+        root = og.Root(pluginCfgPath, ogreCfgPath, logPath)
+        self.ogreRoot = root
+
+        if  not self.ogreRoot.restoreConfig() and not self.ogreRoot.showConfigDialog():
+            sys.exit('Quit from Config Dialog')
+
+        root.initialise(False)
+
+        self.OgreMainWinSceneMgr = self.ogreRoot.createSceneManager(og.ST_GENERIC, &quot;OgreMainWinSceneMgr&quot;)
+        self.OgreMainWinSceneMgr.ambientLight = og.ColourValue(4, 4, 4)
+
+        self.moduleName = &quot;&quot;
+        self.moduleManager = ModuleManager(self.ogreRoot,  self.OgreMainWinSceneMgr)
+
+        self.ogreRenderWindow = OgreMainWindow.OgreMainWindow(self.moduleManager,  root,  self.OgreMainWinSceneMgr,  self)
+        self.gridlayout.addWidget(self.ogreRenderWindow,0,0,1,1)
+        self.hboxlayout.addLayout(self.gridlayout)
+        self.setCentralWidget(self.centralwidget)
+
+        og.ResourceGroupManager.getSingleton().addResourceLocation(&quot;./media&quot;, &quot;FileSystem&quot;, &quot;General&quot;, False)
+        og.ResourceGroupManager.getSingleton().initialiseAllResourceGroups()
+
+        oglog = og.LogManager.getSingleton().getDefaultLog()
+        oglog.addListener(self.consoleWindow.lockenLog)
+
+    def update(self):
+#        try:
+#            self.OgreMainWinSceneMgr.getSceneNode(&quot;saeule_076_node&quot;).yaw(0.02)
+#        except Exception,  e:
+#            pass
+
+        self.ogreRoot.renderOneFrame()
+
+    def actionNewSlot(self):
+        print &quot;dbg: new&quot;
+        return
+
+    def actionQuitSlot(self):
+        self.close()
+
+    def actionDeleteSlot(self):
+        self.moduleManager.deleteObjects()
+
+    def actionCopySlot(self):
+        self.moduleManager.copyObjects()
+
+    def actionCutSlot(self):
+        self.moduleManager.cutObjects()
+
+    def actionPasteSlot(self):
+        self.moduleManager.pasteObjects(self.ogreRenderWindow.getCameraToViewportRay())
+
+    def actionMoveSlot(self):
+        self.moduleManager.pivot.setMoveMode()
+
+    def actionRotateSlot(self):
+        self.moduleManager.pivot.setRotateMode()
+
+    def actionScaleSlot(self):
+        self.moduleManager.pivot.setScaleMode()
+
+    def togglePreferencesWindow(self):
+        if self.prefDialog.isHidden():
+            self.prefDialog.show()
+        else:
+            self.prefDialog.hide()
+
+    def toggleModelPreviewWindow(self):
+        if self.modelSelectionDock.isHidden():
+            self.modelSelectionDock.show()
+        else:
+            self.modelSelectionDock.hide()
+
+    def toggleSceneExplorer(self):
+        if self.sceneExplorerDock.isHidden():
+            self.sceneExplorerDock.show()
+        else:
+            self.sceneExplorerDock.hide()
+
+    def togglePropertyWindow(self):
+        if self.propertyDock.isHidden():
+            self.propertyDock.show()
+        else:
+            self.propertyDock.hide()
+
+    def toggleConsoleWindow(self):
+        if self.consoleDock.isHidden():
+            self.consoleDock.show()
+        else:
+            self.consoleDock.hide()
+
+    # parses the moduleconfig.rb and searches for all loader.loadmap(&quot; statements in the ruby script
+    # and parses them too
+    def loadModule(self, modulePath, moduleName):
+        if self.moduleName == moduleName:
+            return
+
+        self.moduleName = moduleName
+        self.workingDir = modulePath + moduleName # the module path
+        self.workingDirCommon = modulePath + &quot;common&quot; # the module path of the common module
+
+        import codecs
+        import glob
+
+        modConfig = self.workingDir + &quot;/scripts/moduleconfig.rb&quot;
+        if isfile(modConfig): # is the modconfig existing?
+            f = codecs.open(modConfig, 'r', 'utf-8')
+        else:
+            print (&quot;Error: couldn't find module config&quot;)
+            pass
+
+        self.mapFiles = [] # a list in case the module has more than one map file
+
+        for line in f:
+            lStripped = line.strip() #strip the whitespace away, not needed here
+
+            # get the map file(s)
+            if lStripped.startswith(&quot;loader.loadMap(&quot;): # all loadMap commands begin with loader.loadMap(
+                spl = lStripped.split('&quot;')
+                for a in spl:
+                    if a.endswith(&quot;.xml&quot;):
+                        pathToMapFile = self.workingDir + &quot;/maps/&quot; + a
+                        self.mapFiles.append(pathToMapFile)
+
+        self.setWindowTitle(moduleName)
+
+        self.modelSelectionDialog.scanDirForModels(self.workingDir, moduleName)
+        self.modelSelectionDialog.scanDirForModels(self.workingDirCommon, &quot;common&quot;)
+
+        self.setResourcePaths(self.workingDir, moduleName)
+        self.setResourcePaths(self.workingDirCommon, &quot;common&quot;)
+        og.ResourceGroupManager.getSingleton().initialiseAllResourceGroups()
+
+        command = (os.path.join(self.workingDir,  &quot;maps&quot;) + &quot;/*.xml&quot;)
+        for mf in glob.glob(command): # search for all xml files in the maps directory and add them
+            self.mapFiles.append(mf)
+
+        command = (os.path.join(self.workingDir,  &quot;maps&quot;) + &quot;/*.scene&quot;)
+        for mf in glob.glob(command): # search for all xml files in the maps directory and add them
+            self.mapFiles.append(mf)
+
+        self.moduleManager.load(moduleName,  self.mapFiles)
+
+    def setResourcePaths(self, path, moduleName):
+        for file in os.listdir(path):
+            curFile = path + &quot;/&quot; + file
+
+            if file.startswith('.'): #ignore dot files (hidden)
+                continue
+            if isdir(curFile):
+                og.ResourceGroupManager.getSingleton().addResourceLocation(curFile, &quot;FileSystem&quot;, moduleName, False)
+                self.setResourcePaths(curFile, moduleName)
+                continue
+            if isfile(curFile):
+                pass
+
+    def createDockWindows(self):
+        self.propertyDock = QtGui.QDockWidget(self.tr(&quot;Properties&quot;), self)
+        self.propertyDock.setObjectName(&quot;PropertyDockWindow&quot;)
+        self.propertyDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
+        self.propertyDock.setWidget(self.objectPropertyWin)
+        self.addDockWidget(QtCore.Qt.LeftDockWidgetArea, self.propertyDock)
+
+        self.modelSelectionDock = QtGui.QDockWidget(self.tr(&quot;Models&quot;), self)
+        self.modelSelectionDock.setObjectName(&quot;ModelSelectionDockWindow&quot;)
+        self.modelSelectionDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
+        self.modelSelectionDock.setWidget(self.modelSelectionDialog)
+        self.addDockWidget(QtCore.Qt.RightDockWidgetArea, self.modelSelectionDock)
+
+        self.sceneExplorerDock = QtGui.QDockWidget(self.tr(&quot;Scene Explorer&quot;), self)
+        self.sceneExplorerDock.setObjectName(&quot;SceneExplorerDockWindow&quot;)
+        self.sceneExplorerDock.setAllowedAreas(QtCore.Qt.LeftDockWidgetArea | QtCore.Qt.RightDockWidgetArea)
+        self.sceneExplorerDock.setWidget(self.sceneExplorerWin)
+        self.addDockWidget(QtCore.Qt.LeftDockWidgetArea, self.sceneExplorerDock)
+
+        self.consoleDock = QtGui.QDockWidget(self.tr(&quot;Console&quot;), self)
+        self.consoleDock.setObjectName(&quot;ConsoleDockWindow&quot;)
+        self.consoleDock.setAllowedAreas(QtCore.Qt.BottomDockWidgetArea | QtCore.Qt.TopDockWidgetArea)
+        self.consoleDock.setWidget(self.consoleWindow)
+        self.addDockWidget(QtCore.Qt.BottomDockWidgetArea, self.consoleDock)
+
+        self.fileToolBar = self.addToolBar(&quot;File Toolbar&quot;)
+        self.fileToolBar.setObjectName(&quot;FileToolBar&quot;)
+        self.fileToolBar.setAllowedAreas(QtCore.Qt.TopToolBarArea | QtCore.Qt.BottomToolBarArea)
+        self.fileToolBar.addAction(self.actionNeu)
+        self.fileToolBar.addAction(self.actionClose)
+        self.addToolBar(QtCore.Qt.TopToolBarArea, self.fileToolBar)
+
+        self.moveToolBar = self.addToolBar(&quot;Transformation Bar&quot;)
+        self.moveToolBar.setObjectName(&quot;TransformationBar&quot;)
+        self.moveToolBar.setAllowedAreas(QtCore.Qt.TopToolBarArea | QtCore.Qt.BottomToolBarArea)
+        self.moveToolBar.addAction(self.actionMove)
+        self.moveToolBar.addAction(self.actionRotate)
+        self.moveToolBar.addAction(self.actionScale)
+        self.addToolBar(QtCore.Qt.TopToolBarArea, self.moveToolBar)
+
+    def keyPressEvent(self,  event):
+        if not event.isAutoRepeat():
+            self.ogreRenderWindow.keyPressEvent(event)
+
+    def keyReleaseEvent(self,  event):
+        if not event.isAutoRepeat():
+            self.ogreRenderWindow.keyReleaseEvent(event)
+        pass
+
+    def connectActionButtons(self):
+        pass
+
+    def saveOnClose(self):
+        reply = QtGui.QMessageBox.question(self,  &quot;Rastullahs Lockenwickler - Unsaved Chages&quot;,  &quot;Save unsaved changes?&quot;,  QtGui.QMessageBox.Yes|QtGui.QMessageBox.No|QtGui.QMessageBox.Cancel)
+        if reply == QtGui.QMessageBox.Cancel:
+            return False
+        if reply == QtGui.QMessageBox.Yes:
+            print&quot;&quot;
+            #TODO: implement save here
+        return True
+
+    def closeEvent(self,  event):
+        if self.saveOnClose():
+            settings = QtCore.QSettings()
+            settings.setValue(&quot;MainWindow/Geometry&quot;,  QtCore.QVariant(self.saveGeometry()))
+            settings.setValue(&quot;MainWIndow/DockWindows&quot;,  QtCore.QVariant(self.saveState()))
+        else:
+            event.ignore()
+
+if __name__ == &quot;__main__&quot;:
+    app = QtGui.QApplication(sys.argv)
+    app.setOrganizationName(&quot;Team Pantheon&quot;)
+    app.setOrganizationDomain(&quot;rastullahs-lockenpracht.de/team&quot;)
+    app.setApplicationName(&quot;Lockenwickler&quot;)
+
+    form = Lockenwickler()
+    form.show()
+
+    sys.exit(app.exec_())
+

Modified: rl/branches/newton20/editors/Lockenwickler/src/ModelSelectionDialog.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/ModelSelectionDialog.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/ModelSelectionDialog.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,3 +1,22 @@
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
 import sys
 import os
 from os.path import isdir
@@ -3,19 +22,37 @@
 from os.path import isfile
 
+from PyQt4.QtGui import *
+from PyQt4.QtCore import *
+
 import OgreWidget
 import ogre.renderer.OGRE as og
-from PyQt4 import QtGui, QtCore
 
-class ModelSelectionDialog(QtGui.QDialog):
+
+class MyListWidget(QListWidget):
+    def __init__(self,  parent):
+        super(MyListWidget, self).__init__(parent)
+        self.setDragEnabled(True)
+
+    def startDrag(self,  dropActions):
+        data = QByteArray()
+        stream = QDataStream(data,  QIODevice.WriteOnly)
+        stream &lt;&lt; self.currentItem().text()
+        mimeData = QMimeData()
+        mimeData.setData(&quot;application/x-text&quot;, data)
+        drag = QDrag(self)
+        drag.setMimeData(mimeData)
+        drag.start(Qt.CopyAction)
+
+class ModelSelectionDialog(QDialog):
     def __init__(self, ogreRoot, parent=None):
-        QtGui.QDialog.__init__(self, parent)
+        QDialog.__init__(self, parent)
         self.ogreRoot = ogreRoot
 
         self.setupUi()
 
-        QtCore.QObject.connect(self.modelSearchBox, QtCore.SIGNAL(&quot;textChanged(QString)&quot;),
+        self.connect(self.modelSearchBox, SIGNAL(&quot;textChanged(QString)&quot;),
                                self.updateModelList)
 
-        QtCore.QObject.connect(self.listWidget, QtCore.SIGNAL(&quot;itemSelectionChanged ()&quot;),
+        self.connect(self.listWidget, SIGNAL(&quot;itemSelectionChanged ()&quot;),
                                self.setPreviewedModel)
 
@@ -31,37 +68,39 @@
         self.lastMousePosX = 0
         self.lastMousePosY = 0
 
+
+
     def setupUi(self):
         self.setObjectName(&quot;modelPreviewDialog&quot;)
-        self.resize(QtCore.QSize(QtCore.QRect(0,0,272,744).size()).expandedTo(self.minimumSizeHint()))
+        self.resize(QSize(QRect(0,0,272,744).size()).expandedTo(self.minimumSizeHint()))
 
-        self.gridlayout = QtGui.QGridLayout(self)
+        self.gridlayout = QGridLayout(self)
         self.gridlayout.setObjectName(&quot;gridlayout&quot;)
 
-        self.modelSearchBox = QtGui.QLineEdit(self)
+        self.modelSearchBox = QLineEdit(self)
         self.modelSearchBox.setObjectName(&quot;modelSearchBox&quot;)
         self.gridlayout.addWidget(self.modelSearchBox,0,0,1,1)
 
-        self.splitter = QtGui.QSplitter(self)
-        self.splitter.setOrientation(QtCore.Qt.Vertical)
+        self.splitter = QSplitter(self)
+        self.splitter.setOrientation(Qt.Vertical)
         self.splitter.setObjectName(&quot;splitter&quot;)
 
-        self.listWidget = QtGui.QListWidget(self.splitter)
+        self.listWidget = MyListWidget(self.splitter)
         self.listWidget.setObjectName(&quot;listWidget&quot;)
 
         self.ogreModelPrevWindowSceneMgr = self.ogreRoot.createSceneManager(og.ST_GENERIC,&quot;ogreModelPrevWindowSceneMgr&quot;)
         self.ogreModelPrevWindow = OgreWidget.OgreWidget(&quot;ModelPrevWin&quot;, self.ogreRoot, self.ogreModelPrevWindowSceneMgr, &quot;PrevCam&quot;,
                                                          self.splitter)
-        self.ogreModelPrevWindow.setMinimumSize(QtCore.QSize(200,200))
+        self.ogreModelPrevWindow.setMinimumSize(QSize(200,200))
         self.ogreModelPrevWindow.setObjectName(&quot;modelPreviewWindow&quot;)
         self.gridlayout.addWidget(self.splitter,1,0,1,1)
 
         self.retranslateUi()
-        QtCore.QObject.connect(self.modelSearchBox,QtCore.SIGNAL(&quot;textChanged(QString)&quot;),self.listWidget.clearSelection)
-        QtCore.QMetaObject.connectSlotsByName(self)
+        QObject.connect(self.modelSearchBox,SIGNAL(&quot;textChanged(QString)&quot;),self.listWidget.clearSelection)
+        QMetaObject.connectSlotsByName(self)
 
     def retranslateUi(self):
-        self.setWindowTitle(QtGui.QApplication.translate(&quot;modelPreviewDialog&quot;, &quot;Dialog&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        self.setWindowTitle(QApplication.translate(&quot;modelPreviewDialog&quot;, &quot;Dialog&quot;, None, QApplication.UnicodeUTF8))
 
     def setPreviewedModel(self):
         if self.ent != None:
@@ -99,7 +138,13 @@
 
         self.listWidget.sortItems()
 
+    def eventFilter(self, obj, event):
+        if event.type() == 5:
+            self.startDrag()
+            event.accept()
 
+        return False
+
     def event(self, event):
         if event.type() == 31: # scroll wheel turned
             if event.delta() &lt; 0:
@@ -108,17 +153,18 @@
                 self.ogreModelPrevWindow.zoomCamera( 5)
 
         if event.type() == 5: #mouse moved while button down
-           rotX = (event.globalX() - self.lastMousePosX) * 0.01
-           rotY = (event.globalY() - self.lastMousePosY) * 0.01
+            rotX = (event.globalX() - self.lastMousePosX) * 0.01
+            rotY = (event.globalY() - self.lastMousePosY) * 0.01
 
-           if rotX &lt; 0.1 and rotY &lt; 0.1: # first click, don't do anything at all here
-               self.ogreModelPrevWindow.orbitCamera(-rotX,  rotY)
+            if rotX &lt; 0.1 and rotY &lt; 0.1: # first click, don't do anything at all here
+                self.ogreModelPrevWindow.orbitCamera(-rotX,  rotY)
 
-           self.lastMousePosX = event.globalX()
-           self.lastMousePosY = event.globalY()
+            self.lastMousePosX = event.globalX()
+            self.lastMousePosY = event.globalY()
 
         if event.type() == 3: # mouse released
             self.lastMousePosX = 0
             self.lastMousePosY = 0
 
         return False
+

Modified: rl/branches/newton20/editors/Lockenwickler/src/ModuleManager.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/ModuleManager.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/ModuleManager.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,3 +1,21 @@
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
 import sys
 import xml.dom.minidom as xml
 
@@ -9,6 +27,7 @@
 # a class to store information about a object that got selected
 class SelectionObject():
     def __init__(self,  entity,  distance):
+        self.entityName = entity.getName()
         self.entity = entity #the selected entity
         self.distance = distance # the distance from camera at the time of selection
         self.isPivot = False
@@ -20,6 +39,12 @@
         else:
             self.entity.getParentNode().showBoundingBox(False)
 
+    def __eq__(self, other):
+        return self.entity.getName() == other.entity.getName()
+
+    def __ne__(self, other):
+        return self.entity.getName() != other.entity.getName()
+
 class MyRaySceneQueryListener ( og.RaySceneQueryListener ):
     def __init__( self ):
         super ( MyRaySceneQueryListener, self ).__init__()
@@ -45,10 +70,12 @@
             return -1
 
     def queryResult ( self, entity, distance ):
-        print entity.getName()
+        #print &quot;dbg: &quot; + entity.getName()
         if distance == 0.0: #camera is in the bounding box, ignore this selection
             return True
-        elif entity.getName() == &quot;rayLine&quot; :
+#        elif entity.getName() == &quot;rayLine&quot; :
+#            return True
+        elif entity.getName() == &quot;OgreMainWin::0::ViewportGrid&quot;:
             return True
         elif entity.isVisible() and entity.getName() == &quot;EditorXArrow&quot;:
             so = SelectionObject(entity,  distance)
@@ -84,31 +111,28 @@
         return True
 
     def reset(self):
-        for so in self.selectionList:
-            so.setSelected(False)
-
         self.previousSelected = -1
         self.currentSelected = -1
+        del self.selectionList[:]
+        #self.selectionList = []
 
-        self.selectionList = []
+#    def iterateEntityUnderMouse(self):
+#        self.previousSelected = self.currentSelected
+#        if len(self.selectionList) &gt;= self.currentSelected: # would mean we are out of bounds
+#            self.selectionList[self.currentSelected].setSelected(False)
+#
+#        self.currentSelected += 1
+#
+#        if len(self.selectionList) == self.currentSelected: # means we are out of bounds and reached the end of the list, reset it to zero
+#            self.currentSelected = 0
+#
+#        if len(self.selectionList) &gt;= self.currentSelected: # would mean we are out of bounds
+#            #print str(self.selectionList[self.currentSelected].distance) + &quot; &quot;  + self.selectionList[self.currentSelected].entity.getName()
+#            if self.rayCastToPolygonLevelOnCurrentSelection():
+#                self.selectionList[self.currentSelected].setSelected(True)
+#                return self.selectionList[self.currentSelected]
 
-    def iterateEntityUnderMouse(self):
-        self.previousSelected = self.currentSelected
-        if len(self.selectionList) &gt;= self.currentSelected: # would mean we are out of bounds
-            self.selectionList[self.currentSelected].setSelected(False)
 
-        self.currentSelected += 1
-
-        if len(self.selectionList) == self.currentSelected: # means we are out of bounds and reached the end of the list, reset it to zero
-            self.currentSelected = 0
-
-        if len(self.selectionList) &gt;= self.currentSelected: # would mean we are out of bounds
-            #print str(self.selectionList[self.currentSelected].distance) + &quot; &quot;  + self.selectionList[self.currentSelected].entity.getName()
-            if self.rayCastToPolygonLevelOnCurrentSelection():
-                self.selectionList[self.currentSelected].setSelected(True)
-                return self.selectionList[self.currentSelected]
-
-
     def getMeshInformation(self,  entity):
         numVertices = 0
         numIndices = 0
@@ -120,11 +144,9 @@
         pMesh = entity.getMesh()
 
         pos =    entity.getParentNode().getWorldPosition()
+        orient = entity.getParentNode().getWorldOrientation()
         scale =  entity.getParentNode().getScale()
-        orient = entity.getParentNode().getWorldOrientation()
 
-
-
         for i in range ( pMesh.getNumSubMeshes() ):
             pSubMesh = pMesh.getSubMesh(i)
             if pSubMesh.useSharedVertices:
@@ -207,7 +229,7 @@
 
             ih = 0
             for blah in self.mVertexList:
-                print str(ih) + &quot;: &quot;  +  str(blah)
+                #print str(ih) + &quot;: &quot;  +  str(blah)
                 ih += 1
 
 #            for blah in self.mIndexList:
@@ -229,15 +251,38 @@
 
 
     def rayCastToPolygonLevelOnSingleMesh(self,  ray,  entity):
+        return True
         self.getMeshInformation(entity)
+        name = entity.getName()
+        print &quot;dbg: &quot; + name
+
+        temp = []
+        for vec in self.mVertexList:
+            temp.append(vec.x)
+            temp.append(vec.y)
+            temp.append(vec.z)
+
         globalPosition = entity.getParentNode().getWorldPosition()
+        globalOrientation = entity.getParentNode().getWorldOrientation()
 
+
         i = 0
         while i &lt;= (len(self.mIndexList) - 3):
-            result = og.Math.intersects(ray, globalPosition + self.mVertexList[self.mIndexList[i]], globalPosition + self.mVertexList[self.mIndexList[i+1]],
-                                                                                                                                                          globalPosition + self.mVertexList[self.mIndexList[i+2]], True, False)
+            verta = globalPosition + self.mVertexList[self.mIndexList[i]]
+            vertb = globalPosition + self.mVertexList[self.mIndexList[i+1]]
+            vertc = globalPosition + self.mVertexList[self.mIndexList[i+2]]
 
+            verta = globalOrientation * verta
+            vertb = globalOrientation * vertb
+            vertc = globalOrientation * vertc
+            normal = og.Math.calculateBasicFaceNormal(verta, vertb, vertc)
+
+            result = og.Math.intersects(ray, verta, vertb, vertc, True, True)
+            #result = og.Math.intersects(ray, globalPosition + self.mVertexList[self.mIndexList[i]], globalPosition + self.mVertexList[self.mIndexList[i+1]],
+            #                                                                                                                                              globalPosition + self.mVertexList[self.mIndexList[i+2]], normal,  True, True)
+
             if result.first:
+                print &quot;dbg: Treffer!!!!!!!!!&quot;
                 return True
 
             i += 3
@@ -267,11 +312,13 @@
         self.raySceneQuery = self.sceneManager.createRayQuery(og.Ray())
 
         self.userSelectionList = []
+        self.cutList = [] # selection objects that has been cut out and wait to be pasted again
+        self.cutListPreviousNodes = [] # contains the nodes they where copnnected to before the cut
 
         self.listenerDings = MyRaySceneQueryListener()
 
         self.lastRay = None
-        self.rayLine = None
+#        self.rayLine = None
 
         self.pivot = None
         self.movingPivot = False
@@ -280,6 +327,13 @@
         self.middleMouseDown = False
         self.rightMouseDown = False
 
+        self.dropCount = 0
+        self.dropNode = None
+        self.dropEntity = None
+        self.dropCollisionPlane = og.Plane(og.Vector3.UNIT_Y, og.Vector3.ZERO)
+
+        self.numerOfCopys = 0 #everytime a copy is made this numer is increased to generate unique node and mesh names
+
     def load(self,  moduleName,  mapFiles):
         self.moduleName = moduleName
         self.mapFiles = mapFiles
@@ -291,6 +345,7 @@
                 self.parseSceneNodes(node)
 
         self.pivot = Pivot(self.sceneManager)
+        self.pivot.hide()
 
     def parseSceneNodes(self,  nodeList):
         for ent in nodeList:
@@ -330,16 +385,17 @@
                 print &quot;Warning: Meshfile &quot; + meshFile + &quot; could not be found.&quot;
                 return
 
-            n = self.sceneManager.getRootSceneNode().createChild()
+            n = self.sceneManager.getRootSceneNode().createChild(entityName + &quot;_node&quot;)
             n.attachObject(e)
             n.setPosition(nodePosition)
-            n.setOrientation(nodeRotation)
+            #n.setOrientation(nodeRotation)
             n.setScale(nodeScale)
 
         pass
 
     # called when a click into Main Ogre Window occurs
     def selectionClick(self,  ray,  controlDown=False,  shiftDown=False):
+        self.listenerDings.reset()
         self.lastRay = ray
         self.listenerDings.currentRay = ray
         self.raySceneQuery.Ray = ray
@@ -348,7 +404,8 @@
         so = self.listenerDings.rayCastToPolygonLevel(ray)
         if so is not None:
             if not so.isPivot:
-                self.pivot.show()
+                if self.pivot is not None:
+                    self.pivot.show()
                 if not controlDown and not shiftDown:
                     self.resetSelection()
                     so.setSelected(True)
@@ -356,51 +413,146 @@
                     self.updatePivots()
                 elif controlDown and not shiftDown:
                     so.setSelected(True)
+
+                    for soFromList in self.userSelectionList:
+                        if soFromList == so:
+                            return # object already selected
+
                     self.userSelectionList.append(so)
                     self.updatePivots()
+
+
                 elif not controlDown and shiftDown:
                     for selo in self.userSelectionList:
-                        if so.entity.getName() == selo.entity.getName():
+                        if so == selo:
                             so.setSelected(False)
                             self.userSelectionList.remove(selo)
                     self.updatePivots()
             else:
-                print &quot;isPivot: &quot; + str(so.entity.getName())
+                #so.entity is the pivot direction that was clicked
                 self.pivot.startTransforming(so.entity,  self.userSelectionList)
         else:
-            print &quot;noneee&quot;
             self.resetSelection() # click in empty space, deselect everything
-            self.pivot.hide()
+            if self.pivot is not None:
+                self.pivot.hide()
 
-        if self.rayLine == None:
-            self.rayLine = self.sceneManager.createManualObject(&quot;rayLine&quot;)
-            self.rayLine.setDynamic(True)
-            self.sceneManager.getRootSceneNode().createChildSceneNode(&quot;raynode&quot;).attachObject(self.rayLine)
+#        if self.rayLine == None:
+#            self.rayLine = self.sceneManager.createManualObject(&quot;rayLine&quot;)
+#            self.rayLine.setDynamic(True)
+#            self.sceneManager.getRootSceneNode().createChildSceneNode(&quot;raynode&quot;).attachObject(self.rayLine)
+#
+#            self.rayLine.begin(&quot;BaseWhiteNoLighting&quot;, og.RenderOperation.OT_LINE_STRIP)
+#
+#            self.rayLine.position(ray.getOrigin())
+#            self.rayLine.position( ray.getPoint(10000))
+#
+#            self.rayLine.end()
+#
+#        else:
+#            self.rayLine.beginUpdate(0)
+#
+#            self.rayLine.position(ray.getOrigin())
+#            self.rayLine.position( ray.getPoint(10000))
+#
+#            self.rayLine.end()
 
-            self.rayLine.begin(&quot;BaseWhiteNoLighting&quot;, og.RenderOperation.OT_LINE_STRIP)
+    def deleteObjects(self):
+        if len(self.userSelectionList) &lt; 1:
+            return
 
-            self.rayLine.position(ray.getOrigin())
-            self.rayLine.position( ray.getPoint(10000))
+        self.pivot.hide()
 
-            self.rayLine.end()
+        for so in self.userSelectionList:
+            self.sceneManager.destroySceneNode(so.entity.getParentNode().getName())
+            del so
 
-        else:
-            self.rayLine.beginUpdate(0)
+        self.userSelectionList = []
 
-            self.rayLine.position(ray.getOrigin())
-            self.rayLine.position( ray.getPoint(10000))
+    def incrementNameSuffixNumber(self, name):
+        newName = &quot;&quot;
+        split = name.split(&quot;_&quot;)
+        lastPart = len(split)-1
+        newName = name.rstrip(split[lastPart])
+        newName = newName + str(self.numerOfCopys)
 
-            self.rayLine.end()
+#        if split[lastPart].isdigit() and not split[lastPart].startswith(&quot;0&quot;):
+#            num = int(split[lastPart])
+#            num = num + 1
+#            newName = name.rstrip(split[lastPart])
+#            newName = newName + str(num)
+#        else:
+#            newName = name + &quot;_1&quot;
 
+        self.numerOfCopys = self.numerOfCopys + 1
+        return newName
+
+    def copyObjects(self):
+        if len(self.userSelectionList) &lt; 1:
+            return
+
+        newSelectionList = []
+        print &quot;dbg: &quot;
+        for so in self.userSelectionList:
+            nodeName = self.incrementNameSuffixNumber(so.entity.getParentNode().getName())
+            newNode = self.sceneManager.getRootSceneNode().createChild(nodeName)
+
+            entityName = self.incrementNameSuffixNumber(so.entity.getName())
+            newEntity = self.sceneManager.createEntity(entityName, so.entity.getMesh().getName())
+
+            newNode.attachObject(newEntity)
+            newNode.setPosition(so.entity.getParentNode().getPosition())
+            newNode.setOrientation(so.entity.getParentNode().getOrientation())
+            newNode.setScale(so.entity.getParentNode().getScale())
+
+            newSO = SelectionObject(newEntity, so.distance)
+            newSO.setSelected(True)
+            newSelectionList.append(newSO)
+
+        self.resetSelection()
+        self.userSelectionList = newSelectionList
+
+    def cutObjects(self):
+        if len(self.userSelectionList) &lt; 1:
+            return
+
+        self.cutList = []
+        for so in self.userSelectionList:
+            self.cutListPreviousNodes.append(so.entity.getParentNode().getParent())
+            so.entity.getParentNode().getParent().removeChild(so.entity.getParentNode())
+            # set the &quot;point of gravity&quot; of all the cutted nodes to world origin at 0,0,0
+            # so we only have to translate them to their new destination when they get pasted
+            # the position of the pivot point is considered as the center of gravity
+            so.entity.getParentNode().setPosition(so.entity.getParentNode().getPosition() - self.pivot.getPosition())
+            self.cutList.append(so)
+        self.resetSelection()
+    def pasteObjects(self,  ray):
+        if len(self.cutList) &lt; 1:
+            return
+
+        result = og.Math.intersects(ray, self.dropCollisionPlane)
+        if result.first == True:
+            i=0
+            while i &lt; len(self.cutList):
+                self.cutListPreviousNodes[i].addChild(self.cutList[i].entity.getParentNode())
+                self.cutList[i].entity.getParentNode().translate(ray.getPoint(result.second))
+                i = i+1
+        else:
+            i=0
+            while i &lt; len(self.cutList):
+                self.cutListPreviousNodes[i].addChild(self.cutList[i].entity.getParentNode())
+                self.cutList[i].entity.getParentNode().translate(ray.getPoint(100.0))
+                i = i+1
+        self.cutList = []
+
     def leftMouseUp(self):
-        if self.pivot.isTransforming:
+        if self.pivot is not None and self.pivot.isTransforming:
             self.pivot.stopTransforming()
 
-    def iterateEntityUnderMouse(self):
-        self.listenerDings.iterateEntityUnderMouse()
+#    def iterateEntityUnderMouse(self):
+#        self.listenerDings.iterateEntityUnderMouse()
+#
+#        pass
 
-        pass
-
     def resetSelection(self):
         for so in self.userSelectionList:
             so.setSelected(False)
@@ -416,14 +568,36 @@
 
         for so in self.userSelectionList:
             newPivotPosition += so.entity.getParentNode().getPosition()
+        if self.pivot is not None:
+            self.pivot.setPosition(newPivotPosition / len(self.userSelectionList))
 
-        self.pivot.setPosition(newPivotPosition / len(self.userSelectionList))
-
     def unload(self,  saveOnUnload=True):
         pass
 
     def save(self):
         pass
 
+    def startDropModelAction(self, meshFile, ray):
+        self.dropEntity = self.sceneManager.createEntity(&quot;dropMesh&quot; + str(self.dropCount), str(meshFile))
+        self.dropNode = self.sceneManager.getRootSceneNode().createChild(&quot;dropNode&quot; + str(self.dropCount))
+        self.dropNode.attachObject(self.dropEntity)
 
+        result = og.Math.intersects(ray, self.dropCollisionPlane)
+        if result.first == True:
+            self.dropNode.setPosition(ray.getPoint(result.second))
+        else:
+            self.dropNode.setPosition(ray.getPoint(50))
 
+        self.dropCount += 1
+
+    def moveDropModelAction(self, ray):
+        result = og.Math.intersects(ray, self.dropCollisionPlane)
+        if result.first == True:
+            self.dropNode.setPosition(ray.getPoint(result.second))
+        else:
+            self.dropNode.setPosition(ray.getPoint(50))
+
+
+    def stopDropModelAction(self, ray):
+        pass
+

Modified: rl/branches/newton20/editors/Lockenwickler/src/MovePivot.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/MovePivot.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/MovePivot.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,12 +1,32 @@
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
 import sys
 import ogre.renderer.OGRE as og
 
-
 class Pivot():
     def __init__(self,  sceneManager):
         self.sceneManager = sceneManager
+        self.camera = self.sceneManager.getCamera(&quot;MainCam&quot;)
 
         self.mode = None
+        self.isHidden = True
 
         self.meshManager = og.MeshManager.getSingleton ()
 
@@ -24,6 +44,9 @@
     def __createMovePivot(self):
         self.xMoveEntity = self.sceneManager.createEntity(&quot;EditorXArrow&quot;,  &quot;Pivot_Arrow.mesh&quot;)
         self.xMoveEntity.setMaterialName(&quot;Lockenwickler_Pivot_X&quot;)
+#        self.xMoveEntity.getSubEntity(0).getMaterial().setDepthCheckEnabled(False)
+#        self.xMoveEntity.getSubEntity(0).getMaterial().setDepthWriteEnabled(False)
+        self.xMoveEntity.setRenderQueueGroup(og.RENDER_QUEUE_OVERLAY)
         self.xMoveNode = self.pivotNode.createChildSceneNode()
         self.xMoveNode.attachObject(self.xMoveEntity)
         self.xMoveNode.translate(og.Vector3(2, 0, 0))
@@ -41,6 +64,7 @@
 
         self.yMoveEntity = self.sceneManager.createEntity(&quot;EditorYArrow&quot;,  &quot;Pivot_Arrow.mesh&quot;)
         self.yMoveEntity.setMaterialName(&quot;Lockenwickler_Pivot_Y&quot;)
+        self.yMoveEntity.setRenderQueueGroup(og.RENDER_QUEUE_OVERLAY)
         self.yMoveNode = self.pivotNode.createChildSceneNode()
         self.yMoveNode.attachObject(self.yMoveEntity)
         self.yMoveNode.translate(og.Vector3(0, 2, 0))
@@ -58,6 +82,7 @@
 
         self.zMoveEntity = self.sceneManager.createEntity(&quot;EditorZArrow&quot;,  &quot;Pivot_Arrow.mesh&quot;)
         self.zMoveEntity.setMaterialName(&quot;Lockenwickler_Pivot_Z&quot;)
+        self.zMoveEntity.setRenderQueueGroup(og.RENDER_QUEUE_OVERLAY)
         self.zMoveNode = self.pivotNode.createChildSceneNode()
         self.zMoveNode.attachObject(self.zMoveEntity)
         self.zMoveNode.translate(og.Vector3(0, 0, 2))
@@ -72,6 +97,7 @@
     def __createRotatePivot(self):
         self.xRotateEntity = self.sceneManager.createEntity(&quot;EditorXRotator&quot;,  &quot;Rotate_Torus.mesh&quot;)
         self.xRotateEntity.setMaterialName(&quot;Lockenwickler_Pivot_X&quot;)
+        self.xRotateEntity.setRenderQueueGroup(og.RENDER_QUEUE_OVERLAY)
         self.xRotateNode = self.pivotNode.createChildSceneNode()
         self.xRotateNode.attachObject(self.xRotateEntity)
         #self.xRotateNode.translate(0, 0, -5)
@@ -79,6 +105,7 @@
 
         self.yRotateEntity = self.sceneManager.createEntity(&quot;EditorYRotator&quot;,  &quot;Rotate_Torus.mesh&quot;)
         self.yRotateEntity.setMaterialName(&quot;Lockenwickler_Pivot_Y&quot;)
+        self.yRotateEntity.setRenderQueueGroup(og.RENDER_QUEUE_OVERLAY)
         self.yRotateNode = self.pivotNode.createChildSceneNode()
         self.yRotateNode.attachObject(self.yRotateEntity)
         #self.yRotateNode.translate(0, 0, -10)
@@ -86,10 +113,10 @@
 
         self.zRotateEntity = self.sceneManager.createEntity(&quot;EditorZRotator&quot;,  &quot;Rotate_Torus.mesh&quot;)
         self.zRotateEntity.setMaterialName(&quot;Lockenwickler_Pivot_Z&quot;)
+        self.zRotateEntity.setRenderQueueGroup(og.RENDER_QUEUE_OVERLAY)
         self.zRotateNode = self.pivotNode.createChildSceneNode()
         self.zRotateNode.attachObject(self.zRotateEntity)
 
-        pass
 
     def __createScalePivot(self):
         pass
@@ -97,7 +124,11 @@
     def setPosition(self,  pos):
         self.pivotNode.setPosition(pos)
 
+    def getPosition(self):
+        return self.pivotNode.getPosition()
+
     def startTransforming(self, dirEntity, soList):
+        print &quot;dbg: transforming.....&quot;
         self.moveDirection = dirEntity.getName()
         self.selectionList = soList
         self.isTransforming = True
@@ -108,42 +139,80 @@
         pass
 
     def hide(self):
-        self.pivotNode.setVisible(False)
+        self.pivotNode.removeAllChildren()
+        self.isHidden = True
 
     def show(self):
+        self.hide()
         if self.mode == 1:
-            self.xMoveNode.setVisible(True)
-            self.yMoveNode.setVisible(True)
-            self.zMoveNode.setVisible(True)
-            self.freeMoveNode.setVisible(True)
+            self.pivotNode.addChild(self.xMoveNode)
+            self.pivotNode.addChild(self.yMoveNode)
+            self.pivotNode.addChild(self.zMoveNode)
         elif self.mode == 2:
-            self.xRotateNode.setVisible(True)
-            self.yRotateNode.setVisible(True)
-            self.zRotateNode.setVisible(True)
+            self.pivotNode.addChild(self.xRotateNode)
+            self.pivotNode.addChild(self.yRotateNode)
+            self.pivotNode.addChild(self.zRotateNode)
         elif self.mode == 3:
-            pass
+            return
+        self.isHidden = False
 
     def setMoveMode(self):
         self.hide()
         self.mode = 1
-        self.xMoveNode.setVisible(True)
-        self.yMoveNode.setVisible(True)
-        self.zMoveNode.setVisible(True)
-        self.freeMoveNode.setVisible(False)
-
+        self.pivotNode.addChild(self.xMoveNode)
+        self.pivotNode.addChild(self.yMoveNode)
+        self.pivotNode.addChild(self.zMoveNode)
         pass
 
     def setRotateMode(self):
         self.hide()
         self.mode = 2
-        self.xRotateNode.setVisible(True)
-        self.yRotateNode.setVisible(True)
-        self.zRotateNode.setVisible(True)
+        self.pivotNode.addChild(self.xRotateNode)
+        self.pivotNode.addChild(self.yRotateNode)
+        self.pivotNode.addChild(self.zRotateNode)
         pass
 
-    def __setScaleMode(self):
+    def settScaleMode(self):
         pass
 
     def onMouseMoved(self, globalX, globalY, incX, incY):
-        print self.moveDirection
-        pass
+        # move mode
+        if self.isTransforming:
+            if self.mode == 1:
+                transFactor = 0.1
+                transVec = og.Vector3()
+                if self.moveDirection == &quot;EditorXArrow&quot;:
+                    transVec = og.Vector3(-incX, 0.0 , 0.0)
+                elif self.moveDirection == &quot;EditorYArrow&quot;:
+                    transVec = og.Vector3(0.0, -incY, 0.0)
+                elif self.moveDirection == &quot;EditorZArrow&quot;:
+                    transVec = og.Vector3(0.0, 0.0, incX)
+
+                transVec = transVec * transFactor
+                for so in self.selectionList:
+                    so.entity.getParentNode().translate(transVec)
+
+                self.pivotNode.translate(transVec)
+
+            # rotate mode
+            elif self.mode == 2:
+                rotValue = (incX + incY) * 0.05
+
+                if self.moveDirection == &quot;EditorXRotator&quot;:
+                    for so in self.selectionList:
+                        so.entity.getParentNode().pitch(rotValue)
+                if self.moveDirection == &quot;EditorYRotator&quot;:
+                    for so in self.selectionList:
+                        so.entity.getParentNode().yaw(rotValue)
+                if self.moveDirection == &quot;EditorZRotator&quot;:
+                    for so in self.selectionList:
+                        so.entity.getParentNode().roll(rotValue)
+
+        self.update()
+
+    def update(self):
+        if not self.isHidden:
+            dist = self.camera.getPosition().distance(self.pivotNode.getPosition())
+            self.pivotNode.setScale(og.Vector3(0.5,  0.5,  0.5) * (dist / 30))
+
+

Copied: rl/branches/newton20/editors/Lockenwickler/src/ObjectPropertyModel.py (from rev 4561, rl/trunk/editors/Lockenwickler/src/ObjectPropertyModel.py)

Modified: rl/branches/newton20/editors/Lockenwickler/src/ObjectPropertyWin.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/ObjectPropertyWin.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/ObjectPropertyWin.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,17 +1,54 @@
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
 import sys
-from ui_obj_prop import *
 
-class ObjectPropertyWin(QtGui.QDialog):
+from PyQt4.QtCore import *
+from PyQt4.QtGui import *
+
+from Property import *
+
+class ObjectPropertyWin(QDialog):
     def __init__(self, parent=None):
-        QtGui.QDialog.__init__(self, parent)
-        
-        self.propWin = Ui_ObjectPropertys()
-        self.propWin.setupUi(self)
-        
-        QtCore.QObject.connect(self.propWin.treeWidget, QtCore.SIGNAL(&quot;itemDoubleClicked (QTreeWidgetItem *,int)&quot;), 
+        super(QDialog, self).__init__(parent)
+        self.setupUi()
+
+        self.connect(self.treeWidget, SIGNAL(&quot;itemDoubleClicked (QTreeWidgetItem *,int)&quot;),
                                self.onItemClicked)
-        
-        
+
+    def setupUi(self):
+        self.setObjectName(&quot;ObjectPropertys&quot;)
+        self.resize(QSize(QRect(0,0,761,724).size()).expandedTo(self.minimumSizeHint()))
+
+        self.treeWidget = QTreeWidget(self)
+        self.treeWidget.setGeometry(QRect(0,0,901,721))
+        self.treeWidget.setMinimumSize(QSize(400,400))
+        self.treeWidget.setObjectName(&quot;treeWidget&quot;)
+
+        self.retranslateUi()
+        QMetaObject.connectSlotsByName(self)
+
+    def retranslateUi(self):
+        self.treeWidget.headerItem().setText(0,QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Property&quot;, None, QApplication.UnicodeUTF8))
+        self.treeWidget.headerItem().setText(1,QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Value&quot;, None, QApplication.UnicodeUTF8))
+        self.treeWidget.clear()
+
+
     def onItemClicked(self, item, column):
-        print item.text(0)
-        print column
\ No newline at end of file
+        pass

Deleted: rl/branches/newton20/editors/Lockenwickler/src/OdeManager.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/OdeManager.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/OdeManager.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1 +0,0 @@
-as

Modified: rl/branches/newton20/editors/Lockenwickler/src/OgreMainWindow.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/OgreMainWindow.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/OgreMainWindow.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,3 +1,22 @@
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
 import os
 import sys
 import platform
@@ -2,4 +21,7 @@
 
-from PyQt4 import QtGui, QtCore
+from PyQt4.QtGui import *
+from PyQt4.QtCore import *
 
+from ViewportGrid import *
+
 import OgreWidget
@@ -9,9 +31,9 @@
 
 # this class is the heart of the 3d part
 # it manages the two ogre render windows and recieves events from the windows through the event filter
-class OgreMainWindow(QtGui.QWidget):
+class OgreMainWindow(QWidget):
     def __init__(self, moduleManager,  ogreRoot, OgreMainWinSceneMgr,  parent):
-        QtGui.QWidget.__init__(self, parent)
+        QWidget.__init__(self, parent)
         self.moduleManager = moduleManager
         self.ogreRoot = ogreRoot
         self.OgreMainWinSceneMgr = OgreMainWinSceneMgr
@@ -22,45 +44,46 @@
         self.middleMouseDown = False
         self.rightMouseDown = False
 
-        self.dollyCamera = False
+        self.mDollyCamera = False
 
         self.moveCamForward = False
         self.moveCamBackward = False
         self.strafeCamLeft = False
         self.strafeCamRight = False
 
-        self.camUpdateTimer = QtCore.QTimer(self)
-        self.camUpdateTimer.connect(self.camUpdateTimer, QtCore.SIGNAL(&quot;timeout()&quot;), self.updateCamera)
+        self.camUpdateTimer = QTimer(self)
+        self.camUpdateTimer.connect(self.camUpdateTimer, SIGNAL(&quot;timeout()&quot;), self.updateCamera)
 
         self.lastSelectionClick = None # Qpoint wich saves the last selection click mouse position
 
         self.setupUi(self)
 
+
     def setupUi(self, Form):
         Form.setObjectName(&quot;Form&quot;)
-        Form.resize(QtCore.QSize(QtCore.QRect(0,0,935,843).size()).expandedTo(Form.minimumSizeHint()))
+        Form.resize(QSize(QRect(0,0,935,843).size()).expandedTo(Form.minimumSizeHint()))
 
-        self.gridlayout = QtGui.QGridLayout(Form)
+        self.gridlayout = QGridLayout(Form)
         self.gridlayout.setObjectName(&quot;gridlayout&quot;)
 
         # create the vertical splitter ( contains the preferences buttons and the horizontal splitter with the two render windows )
-        self.splitterV = QtGui.QSplitter(Form)
+        self.splitterV = QSplitter(Form)
 
-        sizePolicy = QtGui.QSizePolicy(QtGui.QSizePolicy.MinimumExpanding,QtGui.QSizePolicy.MinimumExpanding)
+        sizePolicy = QSizePolicy(QSizePolicy.MinimumExpanding,QSizePolicy.MinimumExpanding)
         sizePolicy.setHorizontalStretch(0)
         sizePolicy.setVerticalStretch(0)
         sizePolicy.setHeightForWidth(self.splitterV.sizePolicy().hasHeightForWidth())
         self.splitterV.setSizePolicy(sizePolicy)
-        self.splitterV.setOrientation(QtCore.Qt.Vertical)
+        self.splitterV.setOrientation(Qt.Vertical)
         self.splitterV.setObjectName(&quot;splitter&quot;)
 
         # create the preferences buttons and connect the signals
-        self.ogreWindowOptions = QtGui.QToolButton(self)
-        QtCore.QObject.connect(self.ogreWindowOptions, QtCore.SIGNAL(&quot;clicked()&quot;),
+        self.ogreWindowOptions = QToolButton(self)
+        QObject.connect(self.ogreWindowOptions, SIGNAL(&quot;clicked()&quot;),
                                     self.onPreferencesButton)
         self.ogreWindowOptions.hide()
 
-        sizePolicy = QtGui.QSizePolicy(QtGui.QSizePolicy.Maximum,QtGui.QSizePolicy.Minimum)
+        sizePolicy = QSizePolicy(QSizePolicy.Maximum,QSizePolicy.Minimum)
         sizePolicy.setHorizontalStretch(0)
         sizePolicy.setVerticalStretch(0)
         sizePolicy.setHeightForWidth(self.ogreWindowOptions.sizePolicy().hasHeightForWidth())
@@ -72,9 +95,9 @@
 
         ##################################
         self.ogreRenderWindow = OgreWidget.OgreWidget(&quot;OgreMainWin&quot;, self.ogreRoot, self.OgreMainWinSceneMgr, &quot;MainCam&quot;, self.splitterV,  0)
-        self.ogreRenderWindow.setMinimumSize(QtCore.QSize(250,250))
+        self.ogreRenderWindow.setMinimumSize(QSize(250,250))
 
-        sizePolicy = QtGui.QSizePolicy(QtGui.QSizePolicy.Maximum,QtGui.QSizePolicy.Maximum)
+        sizePolicy = QSizePolicy(QSizePolicy.Maximum,QSizePolicy.Maximum)
         sizePolicy.setHorizontalStretch(0)
         sizePolicy.setVerticalStretch(0)
         sizePolicy.setHeightForWidth(self.ogreRenderWindow.sizePolicy().hasHeightForWidth())
@@ -89,38 +112,40 @@
         # register the eventfilters for the render windows
         # this is needed to catch mouse enter and mouse leave events for these windows
         self.ogreRenderWindow.installEventFilter(self)
-
+        self.ogreRenderWindow.setAcceptDrops(True)
         self.lastMousePosX = 0
         self.lastMousePosY = 0
 
         self.retranslateUi(Form)
-        QtCore.QMetaObject.connectSlotsByName(Form)
+        QMetaObject.connectSlotsByName(Form)
 
+        self.viewportGrid = ViewportGrid(self.OgreMainWinSceneMgr, self.ogreRenderWindow.viewport)
+        self.viewportGrid.enable()
     def retranslateUi(self, Form):
-        Form.setWindowTitle(QtGui.QApplication.translate(&quot;Form&quot;, &quot;Form&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.ogreWindowOptions.setText(QtGui.QApplication.translate(&quot;Form&quot;, &quot;...&quot;, None, QtGui.QApplication.UnicodeUTF8))
+        Form.setWindowTitle(QApplication.translate(&quot;Form&quot;, &quot;Form&quot;, None, QApplication.UnicodeUTF8))
+        self.ogreWindowOptions.setText(QApplication.translate(&quot;Form&quot;, &quot;...&quot;, None, QApplication.UnicodeUTF8))
 
     def onPreferencesButton(self):
-        self.splitterH.setOrientation(QtCore.Qt.Vertical)
+        self.splitterH.setOrientation(Qt.Vertical)
 
     def keyPressEvent(self,  event):
-        if event.key() == QtCore.Qt.Key_W:
+        if event.key() == Qt.Key_W:
             self.moveCamForward = True
-        elif event.key() == QtCore.Qt.Key_S:
+        elif event.key() == Qt.Key_S:
             self.moveCamBackward = True
-        elif event.key() == QtCore.Qt.Key_A:
+        elif event.key() == Qt.Key_A:
             self.strafeCamLeft = True
-        elif event.key() == QtCore.Qt.Key_D:
+        elif event.key() == Qt.Key_D:
             self.strafeCamRight= True
 
     def keyReleaseEvent(self,  event):
-        if event.key() == QtCore.Qt.Key_W:
+        if event.key() == Qt.Key_W:
             self.moveCamForward = False
-        elif event.key() == QtCore.Qt.Key_S:
+        elif event.key() == Qt.Key_S:
             self.moveCamBackward = False
-        elif event.key() == QtCore.Qt.Key_A:
+        elif event.key() == Qt.Key_A:
             self.strafeCamLeft = False
-        elif event.key() == QtCore.Qt.Key_D:
+        elif event.key() == Qt.Key_D:
             self.strafeCamRight= False
 
     def eventFilter(self, obj, event):
@@ -130,7 +155,7 @@
                 self.moduleManager.leftMouseDown = True
 
                 if self.rightMouseDown: #if right mouse button is already pressed dolly the camera
-                    self.dollyCamera = True
+                    self.mDollyCamera = True
                 else:
                     self.calculateSelectionRay(event)
 
@@ -150,8 +175,8 @@
                 self.moduleManager.leftMouseDown = False
                 self.moduleManager.leftMouseUp()
 
-                if self.dollyCamera == True: #if we dolly the camera set it to false
-                    self.dollyCamera = False
+                if self.mDollyCamera == True: #if we dolly the camera set it to false
+                    self.mDollyCamera = False
 
             elif event.button() == 2: # right mouse button is released
                 self.rightMouseDown = False
@@ -161,56 +186,104 @@
                 self.moduleManager.middleMouseDown = False
 
             if not self.rightMouseDown:
-                self.dollyCamera = False
+                self.mDollyCamera = False
                 self.camUpdateTimer.stop()
 
+            self.lastMousePosX = 0
+            self.lastMousePosY = 0
+
         elif event.type() == 5: #mouse moved while button down
+            if self.lastMousePosX == 0: # check to avoid to huge values which may happen when the user clicks and lastMousePosX/Y is zero
+                self.lastMousePosX = event.globalX()
+            if self.lastMousePosY == 0:# check to avoid to huge values which may happen when the user clicks and lastMousePosX/Y is zero
+                self.lastMousePosY = event.globalY()
+
             incX =  (event.globalX() - self.lastMousePosX)
             incY =  (event.globalY() - self.lastMousePosY)
 
-            if self.leftMouseDown and not self.middleMouseDown and not self.rightMouseDown:
+            if self.moduleManager.pivot is not None and  self.leftMouseDown and not self.middleMouseDown and not self.rightMouseDown:
                 self.moduleManager.pivot.onMouseMoved(event.globalX,  event.globalY,  incX,  incY)
 
             rotX = incX * 0.01
             rotY = incY * 0.01
 
-            if (rotX &lt; 0.3 and rotY &lt; 0.3) and (rotX &gt; -0.3 and rotY &gt; -0.3): # check to avoid to huge values which may happen when the user clicks and lastMousePosX/Y is zero
-                if self.dollyCamera:
-                    self.focusedWindow.dollyCamera(og.Vector3( rotX, -rotY,  0))
-                elif self.rightMouseDown:
-                    obj.orbitCamera(-rotX,  rotY)
+            if self.mDollyCamera:
+                obj.dollyCamera(og.Vector3(rotX, -rotY,  0) * 3)
+            elif self.rightMouseDown:
+                obj.orbitCamera(-rotX,  rotY)
 
             self.lastMousePosX = event.globalX()
             self.lastMousePosY = event.globalY()
 
-        elif event.type() == 3: # mouse released
-            self.lastMousePosX = 0
-            self.lastMousePosY = 0
+        if event.type() == 60: #drag enter
+            self.dragEnterEvent(event)
+        if event.type() == 61: #drag move
+            self.dragMoveEvent(event)
+        if event.type() == 62:
+            print &quot;dbg: DragLeave&quot;
+        if event.type() == 63:
+            self.dropEvent(event)
 
         return False
 
+    def dragEnterEvent(self, event):
+        if event.mimeData().hasFormat(&quot;application/x-text&quot;):
+            data = event.mimeData().data(&quot;application/x-text&quot;)
+            stream = QDataStream(data, QIODevice.ReadOnly)
+            text = QString()
+            stream &gt;&gt; text
+
+            self.moduleManager.startDropModelAction(text, self.getCameraToViewportRay()) #start the model draging
+
+            event.setDropAction(Qt.CopyAction)
+            event.accept()
+
+        else:
+            event.ignore()
+
+
+    def dragMoveEvent(self, event):
+        self.moduleManager.moveDropModelAction(self.getCameraToViewportRay()) #move it with the mouse
+
+        event.accept()
+
+    def dropEvent(self, event):
+        self.moduleManager.stopDropModelAction(self.getCameraToViewportRay()) # place it down
+        event.accept()
+
+    def getCameraToViewportRay(self):
+        relMousePos = self.ogreRenderWindow.mapFromGlobal(QCursor.pos())
+
+        screenX = relMousePos.x()/float(self.ogreRenderWindow.viewport.getActualWidth())
+        screenY = relMousePos.y()/float(self.ogreRenderWindow.viewport.getActualHeight())
+
+        return self.ogreRenderWindow.getCamera().getCameraToViewportRay(screenX, screenY)
+
     #calculates the the selection ray and notifies the ModuleManager that something is about to be selected
     def calculateSelectionRay(self,  event):
-        relMousePos = self.focusedWindow.mapFromGlobal(QtCore.QPoint(event.globalX(),  event.globalY())) # get the mose position relative to the focused window
+        relMousePos = self.ogreRenderWindow.mapFromGlobal(QPoint(event.globalX(),  event.globalY())) # get the mose position relative to the ogre window
 
-        if self.lastSelectionClick != None:
-            if self.lastSelectionClick.x() == relMousePos.x() and self.lastSelectionClick.y() == relMousePos.y(): # mouse didn't move
-                # we don't initiate a new selection based on bounding boxes here, we just iterate through the list generated last time a selection was made
-                # this is based on how far the distance of the object is from the camera (as returned by ogre)
-                self.moduleManager.iterateEntityUnderMouse() # don't select something new, switch through the currently selected models
-                return
+#        if self.lastSelectionClick != None:
+#            if self.lastSelectionClick.x() == relMousePos.x() and self.lastSelectionClick.y() == relMousePos.y(): # mouse didn't move
+#                # we don't initiate a new selection based on bounding boxes here, we just iterate through the list generated last time a selection was made
+#                # this is based on how far the distance of the object is from the camera (as returned by ogre)
+#                self.moduleManager.iterateEntityUnderMouse() # don't select something new, switch through the currently selected models
+#                return
 
         self.lastSelectionClick = relMousePos
-        mouseRay = self.focusedWindow.getCamera().getCameraToViewportRay(relMousePos.x()/float(self.focusedWindow.viewport.getActualHeight()),
-                                                                                                                                           relMousePos.y()/float(self.focusedWindow.viewport.getActualWidth()))
+        screenX = relMousePos.x()/float(self.ogreRenderWindow.viewport.getActualWidth())
+        screenY = relMousePos.y()/float(self.ogreRenderWindow.viewport.getActualHeight())
 
-        if event.modifiers() == QtCore.Qt.ControlModifier:
+        mouseRay = self.ogreRenderWindow.getCamera().getCameraToViewportRay(screenX, screenY)
+
+        if event.modifiers() == Qt.ControlModifier:
             self.moduleManager.selectionClick(mouseRay,  True,  False)
-        elif event.modifiers() == QtCore.Qt.ShiftModifier:
+        elif event.modifiers() == Qt.ShiftModifier:
             self.moduleManager.selectionClick(mouseRay,  False,  True)
         else:
             self.moduleManager.selectionClick(mouseRay)
 
+
     def updateCamera(self):
         if self.moveCamForward:
             self.ogreRenderWindow.dollyCamera(og.Vector3( 0, 0,-0.2))

Modified: rl/branches/newton20/editors/Lockenwickler/src/OgreWidget.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/OgreWidget.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/OgreWidget.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,3 +1,22 @@
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
 import sys
 import platform
 import os
@@ -15,7 +34,6 @@
         self.camDistFromFocusNode = camDistFromFocusNode
         self.initOgreWindow(renderWindowName,cameraName)
 
-
     def initOgreWindow(self, renderWindowName, cameraName):
         self.renderParameters = og.NameValuePairList()
 

Modified: rl/branches/newton20/editors/Lockenwickler/src/Plugins-linux.cfg
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/Plugins-linux.cfg	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/Plugins-linux.cfg	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,12 +1,12 @@
-# Defines plugins to load
-
-# Define plugin folder
-PluginFolder=/usr/lib/OGRE
-
-# default plugins installed with the libogre14 package
-Plugin=RenderSystem_GL.so
-Plugin=Plugin_ParticleFX.so
-Plugin=Plugin_OctreeSceneManager.so
-#Plugin=Plugin_CgProgramManager
-
-
+# Defines plugins to load
+
+# Define plugin folder
+PluginFolder=/home/stefan/development/root/usr/lib/OGRE/
+
+# default plugins installed with the libogre14 package
+Plugin=RenderSystem_GL.so
+Plugin=Plugin_ParticleFX.so
+Plugin=Plugin_OctreeSceneManager.so
+#Plugin=Plugin_CgProgramManager
+
+

Modified: rl/branches/newton20/editors/Lockenwickler/src/PreferencesDialog.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/PreferencesDialog.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/PreferencesDialog.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,86 +1,106 @@
-import sys
-import platform
-import string
-from ui_pref_dialog import *
-
-class PreferencesDialog(QtGui.QDialog):
-    def __init__(self, loadModuleCallback, parent=None):
-        QtGui.QDialog.__init__(self, parent)
-
-        self.loadModuleCallback = loadModuleCallback
-
-        self.prefDialog = Ui_PreferencesDialog()
-        self.prefDialog.setupUi(self)
-
-        QtCore.QObject.connect(self.prefDialog.modulConfigSelector, QtCore.SIGNAL(&quot;clicked()&quot;),
-                               self.openModulConfigSelector)
-
-        QtCore.QObject.connect(self.prefDialog.loadModuleBtn, QtCore.SIGNAL(&quot;clicked()&quot;),
-                               self.onLoadSelectedModule)
-
-        QtCore.QObject.connect(self.prefDialog.listWidget, QtCore.SIGNAL(&quot;itemDoubleClicked(QListWidgetItem *)&quot;),
-                               self.onLoadSelectedModule)
-
-        if platform.system() == &quot;Windows&quot; or platform.system() == &quot;MAC&quot;:
-            # TODO: delete this when ready
-            self.prefDialog.lineEdit.setText(&quot;C:\Users\Stefan\Desktop\Lockenwickler\modules\modules.cfg&quot;)
-            self.moduleCfgPath = &quot;C:\Users\Stefan\Desktop\Lockenwickler\modules\modules.cfg&quot;
-            self.moduleCfgIsSelected = True
-            self.modulePath = self.moduleCfgPath.replace(&quot;modules.cfg&quot;, &quot;&quot;)
-            self.readInModules()
-            # end delete
-        else:
-            # TODO: delete this when ready
-            self.prefDialog.lineEdit.setText(&quot;/home/stefan/blubb/rl_modules/modules/modules.cfg&quot;)
-            self.moduleCfgPath = &quot;/home/stefan/blubb/rl_modules/modules/modules.cfg&quot;
-            self.moduleCfgIsSelected = True
-            self.modulePath = self.moduleCfgPath.replace(&quot;modules.cfg&quot;, &quot;&quot;)
-            self.readInModules()
-            # end delete
-
-        self.moduleCfgIsSelected = False
-
-        self.setModal(True)
-
-    def openModulConfigSelector(self):
-        dialog = QtGui.QFileDialog(self)
-        self.moduleCfgPath = str(dialog.getOpenFileName(self, &quot;Select modules.cfg&quot;, &quot;/home/stefan/blubb/rl_modules/modules/&quot;, &quot;modules.cfg (*.cfg)&quot;))
-        self.modulePath = self.moduleCfgPath.replace(&quot;modules.cfg&quot;, &quot;&quot;)
-
-        from os.path import isfile
-
-        if isfile(self.moduleCfgPath):
-            self.prefDialog.lineEdit.setText(self.moduleCfgPath)
-            self.moduleCfgIsSelected = True
-            self.readInModules()
-
-    def readInModules(self):
-        if self.moduleCfgIsSelected:
-            import codecs
-            f = codecs.open(self.moduleCfgPath, 'r', 'utf-8')
-
-            for line in f:
-                if line.startswith('#'):
-                    continue
-
-                if line.startswith('module='):
-                    splines = line.split('=')
-                    str = splines[1].rstrip().rstrip()
-                    if str != &quot;common&quot;:
-                        self.prefDialog.listWidget.addItem(str)
-
-    def onLoadSelectedModule(self):
-        item = self.prefDialog.listWidget.currentItem()
-
-        if item == None:
-            mbox = QtGui.QMessageBox(self)
-            mbox.setModal(True)
-            mbox.setText(&quot;Please select a module.&quot;)
-            mbox.show()
-        else:
-            tempo = str(item.text())
-            self.loadModuleCallback(self.modulePath, tempo)
-            self.hide()
-
-
-
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
+import sys
+import platform
+import string
+from ui_pref_dialog import *
+
+class PreferencesDialog(QtGui.QDialog):
+    def __init__(self, loadModuleCallback, parent=None):
+        QtGui.QDialog.__init__(self, parent)
+
+        self.loadModuleCallback = loadModuleCallback
+
+        self.prefDialog = Ui_PreferencesDialog()
+        self.prefDialog.setupUi(self)
+
+        QtCore.QObject.connect(self.prefDialog.modulConfigSelector, QtCore.SIGNAL(&quot;clicked()&quot;),
+                               self.openModulConfigSelector)
+
+        QtCore.QObject.connect(self.prefDialog.loadModuleBtn, QtCore.SIGNAL(&quot;clicked()&quot;),
+                               self.onLoadSelectedModule)
+
+        QtCore.QObject.connect(self.prefDialog.listWidget, QtCore.SIGNAL(&quot;itemDoubleClicked(QListWidgetItem *)&quot;),
+                               self.onLoadSelectedModule)
+
+        if platform.system() == &quot;Windows&quot; or platform.system() == &quot;MAC&quot;:
+            pass
+            # TODO: delete this when ready
+#            self.prefDialog.lineEdit.setText(&quot;C:\Users\Stefan\Desktop\Lockenwickler\modules\modules.cfg&quot;)
+#            self.moduleCfgPath = &quot;C:\Users\Stefan\Desktop\Lockenwickler\modules\modules.cfg&quot;
+#            self.moduleCfgIsSelected = True
+#            self.modulePath = self.moduleCfgPath.replace(&quot;modules.cfg&quot;, &quot;&quot;)
+#            self.readInModules()
+            # end delete
+        else:
+            # TODO: delete this when ready
+            self.prefDialog.lineEdit.setText(&quot;/home/stefan/blubb/rl_modules/modules/modules.cfg&quot;)
+            self.moduleCfgPath = &quot;/home/stefan/blubb/rl_modules/modules/modules.cfg&quot;
+            self.moduleCfgIsSelected = True
+            self.modulePath = self.moduleCfgPath.replace(&quot;modules.cfg&quot;, &quot;&quot;)
+            self.readInModules()
+            # end delete
+
+        self.moduleCfgIsSelected = False
+
+        self.setModal(True)
+
+    def openModulConfigSelector(self):
+        dialog = QtGui.QFileDialog(self)
+        self.moduleCfgPath = str(dialog.getOpenFileName(self, &quot;Select modules.cfg&quot;, &quot;/home/stefan/blubb/rl_modules/modules/&quot;, &quot;modules.cfg (*.cfg)&quot;))
+        self.modulePath = self.moduleCfgPath.replace(&quot;modules.cfg&quot;, &quot;&quot;)
+
+        from os.path import isfile
+
+        if isfile(self.moduleCfgPath):
+            self.prefDialog.lineEdit.setText(self.moduleCfgPath)
+            self.moduleCfgIsSelected = True
+            self.readInModules()
+
+    def readInModules(self):
+        if self.moduleCfgIsSelected:
+            import codecs
+            f = codecs.open(self.moduleCfgPath, 'r', 'utf-8')
+
+            for line in f:
+                if line.startswith('#'):
+                    continue
+
+                if line.startswith('module='):
+                    splines = line.split('=')
+                    str = splines[1].rstrip().rstrip()
+                    if str != &quot;common&quot;:
+                        self.prefDialog.listWidget.addItem(str)
+
+    def onLoadSelectedModule(self):
+        item = self.prefDialog.listWidget.currentItem()
+
+        if item == None:
+            mbox = QtGui.QMessageBox(self)
+            mbox.setModal(True)
+            mbox.setText(&quot;Please select a module.&quot;)
+            mbox.show()
+        else:
+            tempo = str(item.text())
+            self.loadModuleCallback(self.modulePath, tempo)
+            self.hide()
+
+
+

Copied: rl/branches/newton20/editors/Lockenwickler/src/Property.py (from rev 4561, rl/trunk/editors/Lockenwickler/src/Property.py)

Modified: rl/branches/newton20/editors/Lockenwickler/src/PythonOgreConfig.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/PythonOgreConfig.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/PythonOgreConfig.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,3 +1,22 @@
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
 #
 # a single config file that is imported 'first' by the Python-Ogre demos
 # this is primarly used to manage Linux demos when we have binaries in non standard (safe) locations

Modified: rl/branches/newton20/editors/Lockenwickler/src/SceneExplorer.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/SceneExplorer.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/SceneExplorer.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,3 +1,22 @@
+#################################################
+ # Copyright (C) 2008  Stefan Stammberger
+ #
+ # This library is free software; you can redistribute it and/or
+ # modify it under the terms of the GNU Lesser General Public
+ # License as published by the Free Software Foundation; either
+ # version 2.1 of the License, or (at your option) any later version.
+ #
+ # This library is distributed in the hope that it will be useful,
+ # but WITHOUT ANY WARRANTY; without even the implied warranty of
+ # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ # Lesser General Public License for more details.
+ #
+ # You should have received a copy of the GNU Lesser General Public
+ # License along with this library; if not, write to the Free Software
+ # Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
+ #################################################
+
+
 import sys
 from PyQt4.QtCore import *
 from PyQt4.QtGui import *

Copied: rl/branches/newton20/editors/Lockenwickler/src/ViewportGrid.py (from rev 4561, rl/trunk/editors/Lockenwickler/src/ViewportGrid.py)

Modified: rl/branches/newton20/editors/Lockenwickler/src/media/Pivot_Point.material
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/media/Pivot_Point.material	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/media/Pivot_Point.material	2008-10-19 16:35:21 UTC (rev 4563)
@@ -4,10 +4,12 @@
 	{
 		pass
 		{
-			ambient 1.0 0.0 0.0 1.0
-			diffuse 1.0 0.0 0.0 1.0
-			specular 1.0 0.0 0.0 1.0 12.5
-			emissive 1.0 0.0 0.0 1.0
+                        depth_check off
+                        depth_write off
+			ambient 1.0 0.0 0.0 0.5
+			diffuse 1.0 0.0 0.0 0.5
+			specular 1.0 0.0 0.0 0.5 12.5
+			emissive 1.0 0.0 0.0 0.5
 		}
 	}
 }
@@ -16,12 +18,15 @@
 {
 	technique
 	{
+
 		pass
 		{
-			ambient 0.0 0.0 1.0 1.0
-			diffuse 0.0 0.0 1.0 1.0
-			specular 0.0 0.0 1.0 1.0 12.5
-			emissive 0.0 0.0 1.0 1.0
+                        depth_check off
+                        depth_write off
+			ambient 0.0 0.0 1.0 0.5
+			diffuse 0.0 0.0 1.0 0.5
+			specular 0.0 0.0 1.0 0.5 12.5
+			emissive 0.0 0.0 1.0 0.5
 		}
 	}
 }
@@ -32,10 +37,12 @@
 	{
 		pass
 		{
-			ambient 0.0 1.0 0.0 1.0
-			diffuse 0.0 1.0 0.0 1.0
-			specular 0.0 1.0 0.0 1.0 12.5
-			emissive 0.0 1.0 0.0 1.0
+                        depth_check off
+                        depth_write off
+			ambient 0.0 1.0 0.0 0.5
+			diffuse 0.0 1.0 0.0 0.5
+			specular 0.0 1.0 0.0 0.5 12.5
+			emissive 0.0 1.0 0.0 0.5
 		}
 	}
 }
@@ -46,10 +53,10 @@
 	{
 		pass
 		{
-			ambient 0.0 0.0 0.0 1.0
-			diffuse 0.0 0.0 0.0 1.0
-			specular 0.0 0.0 0.0 1.0 12.5
-			emissive 0.0 0.0 0.0 1.0
+			ambient 0.0 0.0 0.0 0.5
+			diffuse 0.0 0.0 0.0 0.5
+			specular 0.0 0.0 0.0 0.5 12.5
+			emissive 0.0 0.0 0.0 0.5
 		}
 	}
 }

Copied: rl/branches/newton20/editors/Lockenwickler/src/setup.py (from rev 4561, rl/trunk/editors/Lockenwickler/src/setup.py)

Deleted: rl/branches/newton20/editors/Lockenwickler/src/ui_FourPanelView.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/ui_FourPanelView.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/ui_FourPanelView.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,50 +0,0 @@
-# -*- coding: utf-8 -*-
-
-# Form implementation generated from reading ui file 'FourPanelView.ui'
-#
-# Created: Mon May 12 15:09:24 2008
-#      by: PyQt4 UI code generator 4.3.3
-#
-# WARNING! All changes made in this file will be lost!
-
-from PyQt4 import QtCore, QtGui
-
-class Ui_FourPaneView(object):
-    def setupUi(self, FourPaneView):
-        FourPaneView.setObjectName(&quot;FourPaneView&quot;)
-        FourPaneView.resize(QtCore.QSize(QtCore.QRect(0,0,827,856).size()).expandedTo(FourPaneView.minimumSizeHint()))
-
-        self.gridlayout = QtGui.QGridLayout(FourPaneView)
-        self.gridlayout.setObjectName(&quot;gridlayout&quot;)
-
-        self.splitter_3 = QtGui.QSplitter(FourPaneView)
-        self.splitter_3.setOrientation(QtCore.Qt.Horizontal)
-        self.splitter_3.setObjectName(&quot;splitter_3&quot;)
-
-        self.splitter = QtGui.QSplitter(self.splitter_3)
-        self.splitter.setOrientation(QtCore.Qt.Vertical)
-        self.splitter.setObjectName(&quot;splitter&quot;)
-
-        self.widget = QtGui.QWidget(self.splitter)
-        self.widget.setObjectName(&quot;widget&quot;)
-
-        self.widget_4 = QtGui.QWidget(self.splitter)
-        self.widget_4.setObjectName(&quot;widget_4&quot;)
-
-        self.splitter_2 = QtGui.QSplitter(self.splitter_3)
-        self.splitter_2.setOrientation(QtCore.Qt.Vertical)
-        self.splitter_2.setObjectName(&quot;splitter_2&quot;)
-
-        self.widget_2 = QtGui.QWidget(self.splitter_2)
-        self.widget_2.setObjectName(&quot;widget_2&quot;)
-
-        self.widget_3 = QtGui.QWidget(self.splitter_2)
-        self.widget_3.setObjectName(&quot;widget_3&quot;)
-        self.gridlayout.addWidget(self.splitter_3,0,0,1,1)
-
-        self.retranslateUi(FourPaneView)
-        QtCore.QMetaObject.connectSlotsByName(FourPaneView)
-
-    def retranslateUi(self, FourPaneView):
-        FourPaneView.setWindowTitle(QtGui.QApplication.translate(&quot;FourPaneView&quot;, &quot;Form&quot;, None, QtGui.QApplication.UnicodeUTF8))
-

Deleted: rl/branches/newton20/editors/Lockenwickler/src/ui_lw.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/ui_lw.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/ui_lw.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1 +0,0 @@
-

Deleted: rl/branches/newton20/editors/Lockenwickler/src/ui_model_prev.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/ui_model_prev.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/ui_model_prev.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,13 +0,0 @@
-# -*- coding: utf-8 -*-
-
-# Form implementation generated from reading ui file 'model_preview.ui'
-#
-# Created: Mon May 12 15:09:24 2008
-#      by: PyQt4 UI code generator 4.3.3
-#
-# WARNING! All changes made in this file will be lost!
-
-from PyQt4 import QtCore, QtGui
-
-class Ui_modelPreviewDialog(object):
-

Deleted: rl/branches/newton20/editors/Lockenwickler/src/ui_obj_prop.py
===================================================================
--- rl/branches/newton20/editors/Lockenwickler/src/ui_obj_prop.py	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/editors/Lockenwickler/src/ui_obj_prop.py	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,46 +0,0 @@
-# -*- coding: utf-8 -*-
-
-# Form implementation generated from reading ui file 'object_property.ui'
-#
-# Created: Mon May 12 15:09:23 2008
-#      by: PyQt4 UI code generator 4.3.3
-#
-# WARNING! All changes made in this file will be lost!
-
-from PyQt4 import QtCore, QtGui
-
-class Ui_ObjectPropertys(object):
-    def setupUi(self, ObjectPropertys):
-        ObjectPropertys.setObjectName(&quot;ObjectPropertys&quot;)
-        ObjectPropertys.resize(QtCore.QSize(QtCore.QRect(0,0,761,724).size()).expandedTo(ObjectPropertys.minimumSizeHint()))
-
-        self.treeWidget = QtGui.QTreeWidget(ObjectPropertys)
-        self.treeWidget.setGeometry(QtCore.QRect(0,0,901,721))
-        self.treeWidget.setMinimumSize(QtCore.QSize(400,400))
-        self.treeWidget.setObjectName(&quot;treeWidget&quot;)
-
-        self.retranslateUi(ObjectPropertys)
-        QtCore.QMetaObject.connectSlotsByName(ObjectPropertys)
-
-    def retranslateUi(self, ObjectPropertys):
-        ObjectPropertys.setWindowTitle(QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Object Properties&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.treeWidget.headerItem().setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Property&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.treeWidget.headerItem().setText(1,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Value&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        self.treeWidget.clear()
-
-        item = QtGui.QTreeWidgetItem(self.treeWidget)
-        item.setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Position&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        item.setText(1,&quot;&quot;)
-
-        item1 = QtGui.QTreeWidgetItem(item)
-        item1.setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;X&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        item1.setText(1,&quot;&quot;)
-
-        item2 = QtGui.QTreeWidgetItem(item)
-        item2.setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Y&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        item2.setText(1,&quot;&quot;)
-
-        item3 = QtGui.QTreeWidgetItem(item)
-        item3.setText(0,QtGui.QApplication.translate(&quot;ObjectPropertys&quot;, &quot;Z&quot;, None, QtGui.QApplication.UnicodeUTF8))
-        item3.setText(1,&quot;&quot;)
-

Modified: rl/branches/newton20/engine/core/include/MessagePump.h
===================================================================
--- rl/branches/newton20/engine/core/include/MessagePump.h	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/engine/core/include/MessagePump.h	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,292 +1,234 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
-* 
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
-*/
-
-#ifndef __Rl_MessagePump_H__
-#define __Rl_MessagePump_H__
-
-#include &quot;CorePrerequisites.h&quot;
-
-#include &quot;MessageType.h&quot;
-#include &quot;GameTask.h&quot;
-
-
-#include &lt;map&gt;
-#include &lt;queue&gt;
-
-#include &lt;boost/noncopyable.hpp&gt;
-
-namespace rl
-{
-
-    class MessageHandlerWrapperBase
-    {
-    public:
-        virtual ~MessageHandlerWrapperBase() {}
-        virtual bool Invoke(MessageObjectBase* obj) = 0;
-    };
-
-    template&lt;class _MessageType&gt;
-    class MessageHandlerWrapper : public MessageHandlerWrapperBase
-    {
-    public:
-        typedef typename _MessageType::MessageObjectType MessageObjectType;
-        typedef typename _MessageType::HandlerType HandlerType;
-
-        MessageHandlerWrapper(const HandlerType&amp; handler)
-            : mHandler(handler)
-        {
-        }
-
-        virtual bool Invoke(MessageObjectBase* obj)
-        {
-            MessageObjectType* obj2 = static_cast&lt;MessageObjectType*&gt;(obj);
-            return obj2-&gt;Invoke(mHandler);
-        }
-
-    private:
-        HandlerType mHandler;
-    };
-
-    class _RlCoreExport MessagePump : public GameTask, public Ogre::Singleton&lt;MessagePump&gt;
-    {
-    public:
-        class Connection
-        {
-            friend class MessagePump;
-        public:
-            Connection()
-                : connectionId(-1), pump(NULL)
-            {}
-            void disconnect()
-            {
-                if(pump &amp;&amp; connectionId != -1)
-                    pump-&gt;disconnectHandler(connectionId);
-            }
-        private:
-            MessagePump* pump;
-            int connectionId;
-        };
-
-        class ScopedConnection : boost::noncopyable
-        {
-        public:
-            ScopedConnection()
-            {}
-            ScopedConnection(const Connection&amp; conn)
-                : mConnection(conn)
-            {}
-            ScopedConnection&amp; operator =(const Connection&amp; conn)
-            {
-                mConnection.disconnect();
-                mConnection = conn;
-                return *this;
-            }
-            ~ScopedConnection()
-            {
-                mConnection.disconnect();
-            }
-        private:
-            Connection mConnection;
-        };
-
-    private:
-        struct MessageHandlerMapEntry
-        {
-            int connectionId;
-            MessageHandlerWrapperBase* handlerWrapper;
-        };
-
-        typedef std::vector&lt;MessageHandlerMapEntry&gt; MessageHandlerMapEntries;
-        typedef std::map&lt;int, MessageHandlerMapEntries*&gt; MessageHandlerMap;
-        typedef std::queue&lt;MessageObjectBase*&gt; MessageQueue;
-
-    public:
-        MessagePump() : mNextConnectionId(0) {}
-        ~MessagePump();
-
-        template&lt;typename _MessageType&gt;
-        Connection addMessageHandler( const typename _MessageType::HandlerType&amp; handler )
-        {
-            MessageHandlerWrapper&lt;_MessageType&gt;* wrapper =
-                new MessageHandlerWrapper&lt;_MessageType&gt;(handler);
-
-            MessageHandlerMapEntries* entries = getOrCreateMapEntries(_MessageType::MessageTypeId);
-            MessageHandlerMapEntry entry = {mNextConnectionId++, wrapper};
-            entries-&gt;push_back(entry);
-
-            LOG_MESSAGE(&quot;MessagePump&quot;, 
-                &quot;Added message handler for message type &quot; 
-                + Ogre::StringConverter::toString(_MessageType::MessageTypeId));
-
-            Connection con;
-            con.pump = this;
-            con.connectionId = entry.connectionId;
-            return con;
-        }
-
-        /*
-        * sendMessage and postMessage is implemented for all possible parameter counts
-        * Thanks to the idea of SFINAE, the compiler will choose 
-        * the correct implementation for all MessageTypes at compile time
-        *
-        * sendMessage processes the message immediatly, while postMessage delays the 
-        * processing to a later frame
-        */
-        template&lt;typename _MessageType&gt;
-        bool sendMessage()
-        {
-            MessageObjectBase* obj = _MessageType::MessageObjectType::Build();
-            return doSend(obj);
-        }
-
-        template&lt;typename _MessageType&gt;
-        bool sendMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1)
-        {
-            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1);
-            return doSend(obj);
-        }
-
-        template&lt;typename _MessageType&gt;
-        bool sendMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1,
-            const typename _MessageType::MessageObjectType::Param2&amp; p2)
-        {
-            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1, p2);
-            return doSend(obj);
-        }
-
-        template&lt;typename _MessageType&gt;
-        bool sendMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1,
-            const typename _MessageType::MessageObjectType::Param2&amp; p2,
-            const typename _MessageType::MessageObjectType::Param2&amp; p3)
-        {
-            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1, p2, p3);
-            return doSend(obj);
-        }
-
-        ////////////////////////////////
-
-        template&lt;typename _MessageType&gt;
-        void postMessage()
-        {
-            MessageObjectBase* obj = _MessageType::MessageObjectType::Build();
-            doPost(obj);
-        }
-
-        template&lt;typename _MessageType&gt;
-        void postMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1)
-        {
-            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1);
-            doPost(obj);
-        }
-
-        template&lt;typename _MessageType&gt;
-        void postMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1,
-            const typename _MessageType::MessageObjectType::Param2&amp; p2)
-        {
-            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1,p2);
-            doPost(obj);
-        }
-
-        template&lt;typename _MessageType&gt;
-        void postMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1,
-            const typename _MessageType::MessageObjectType::Param2&amp; p2,
-            const typename _MessageType::MessageObjectType::Param2&amp; p3)
-        {
-            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1, p2, p3);
-            doPost(obj);
-        }
-
-        void sendPending()
-        {
-            while(!mMessageQueue.empty())
-            {
-                doSend(mMessageQueue.front());
-                mMessageQueue.pop();
-            }
-        }
-
-        // overloads from GameTask
-
-        virtual void run(Ogre::Real elapsedTime);
-
-        virtual const Ogre::String&amp; getName() const;
-
-    private:
-        MessageHandlerMapEntries* getOrCreateMapEntries(int id) 
-        {
-            LOG_MESSAGE(&quot;MessagePump&quot;, &quot;Create or get id &quot; + Ogre::StringConverter::toString(id));
-            MessageHandlerMap::iterator it = mMessageHandlerMap.find(id);
-            if(it == mMessageHandlerMap.end())
-            {
-                MessageHandlerMapEntries* entries = new MessageHandlerMapEntries();
-                mMessageHandlerMap[id] = entries;
-                return entries;
-            }
-            return it-&gt;second;
-        }
-
-        bool doSend(MessageObjectBase* msg)
-        {
-            bool msgHandled = false;
-            MessageHandlerMapEntries* entries = getOrCreateMapEntries(msg-&gt;getMessageTypeId());
-            for(MessageHandlerMapEntries::iterator it = entries-&gt;begin(); it != entries-&gt;end(); ++it)
-            {
-                if((*it).handlerWrapper-&gt;Invoke(msg))
-                {
-                    msgHandled = true;
-                }
-            }
-            delete msg;
-            return msgHandled;;
-        }
-
-        void doPost(MessageObjectBase* msg)
-        {
-            mMessageQueue.push(msg);
-        }
-
-        friend class Connection;
-        void disconnectHandler(int connectionId)
-        {
-            //not very performant...definitely needs improvement
-            for (MessageHandlerMap::iterator it = mMessageHandlerMap.begin();
-                it != mMessageHandlerMap.end(); ++it)
-            {
-                MessageHandlerMapEntries* en = it-&gt;second;
-                for (MessageHandlerMapEntries::iterator jt = en-&gt;begin(); jt != en-&gt;end(); ++jt)
-                {
-                    if (jt-&gt;connectionId == connectionId)
-                    {
-                        delete jt-&gt;handlerWrapper;
-                        en-&gt;erase(jt);
-                        if (en-&gt;empty())
-                        {
-                            delete en;
-                            mMessageHandlerMap.erase(it);
-                        }
-                        return;
-                    }
-                }
-            }
-        }
-
-    private:
-        int mNextConnectionId;
-        MessageHandlerMap mMessageHandlerMap;
-        MessageQueue mMessageQueue;
-    };
-}
-#endif
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+*/
+
+#ifndef __Rl_MessagePump_H__
+#define __Rl_MessagePump_H__
+
+#include &quot;CorePrerequisites.h&quot;
+
+#include &quot;MessageType.h&quot;
+#include &quot;GameTask.h&quot;
+
+
+#include &lt;map&gt;
+#include &lt;queue&gt;
+
+#include &lt;boost/noncopyable.hpp&gt;
+
+namespace rl
+{
+
+    class MessageHandlerWrapperBase
+    {
+    public:
+        virtual ~MessageHandlerWrapperBase() {}
+        virtual bool Invoke(MessageObjectBase* obj) = 0;
+    };
+
+    template&lt;class _MessageType&gt;
+    class MessageHandlerWrapper : public MessageHandlerWrapperBase
+    {
+    public:
+        typedef typename _MessageType::MessageObjectType MessageObjectType;
+        typedef typename _MessageType::HandlerType HandlerType;
+
+        MessageHandlerWrapper(const HandlerType&amp; handler)
+            : mHandler(handler)
+        {
+        }
+
+        virtual bool Invoke(MessageObjectBase* obj)
+        {
+            MessageObjectType* obj2 = static_cast&lt;MessageObjectType*&gt;(obj);
+            return obj2-&gt;Invoke(mHandler);
+        }
+
+    private:
+        HandlerType mHandler;
+    };
+
+    class _RlCoreExport MessagePump : public GameTask, public Ogre::Singleton&lt;MessagePump&gt;
+    {
+    public:
+        class Connection
+        {
+            friend class MessagePump;
+        public:
+            Connection()
+                : connectionId(-1), pump(NULL)
+            {}
+            void disconnect()
+            {
+                if(pump &amp;&amp; connectionId != -1)
+                    pump-&gt;disconnectHandler(connectionId);
+            }
+        private:
+            MessagePump* pump;
+            int connectionId;
+        };
+
+        class ScopedConnection : boost::noncopyable
+        {
+        public:
+            ScopedConnection()
+            {}
+            ScopedConnection(const Connection&amp; conn)
+                : mConnection(conn)
+            {}
+            ScopedConnection&amp; operator =(const Connection&amp; conn)
+            {
+                mConnection.disconnect();
+                mConnection = conn;
+                return *this;
+            }
+            ~ScopedConnection()
+            {
+                mConnection.disconnect();
+            }
+        private:
+            Connection mConnection;
+        };
+
+    private:
+        struct MessageHandlerMapEntry
+        {
+            int connectionId;
+            MessageHandlerWrapperBase* handlerWrapper;
+        };
+
+        typedef std::vector&lt;MessageHandlerMapEntry&gt; MessageHandlerMapEntries;
+        typedef std::map&lt;int, MessageHandlerMapEntries*&gt; MessageHandlerMap;
+        typedef std::queue&lt;MessageObjectBase*&gt; MessageQueue;
+
+    public:
+        MessagePump() : mNextConnectionId(0) {}
+        ~MessagePump();
+
+        template&lt;typename _MessageType&gt;
+        Connection addMessageHandler( const typename _MessageType::HandlerType&amp; handler )
+        {
+            MessageHandlerWrapper&lt;_MessageType&gt;* wrapper =
+                new MessageHandlerWrapper&lt;_MessageType&gt;(handler);
+
+            MessageHandlerMapEntries* entries = getOrCreateMapEntries(_MessageType::MessageTypeId);
+            MessageHandlerMapEntry entry = {mNextConnectionId++, wrapper};
+            entries-&gt;push_back(entry);
+
+            LOG_MESSAGE(&quot;MessagePump&quot;, 
+                &quot;Added message handler for message type &quot; 
+                + Ogre::StringConverter::toString(_MessageType::MessageTypeId));
+
+            Connection con;
+            con.pump = this;
+            con.connectionId = entry.connectionId;
+            return con;
+        }
+
+        /*
+        * sendMessage and postMessage is implemented for all possible parameter counts
+        * Thanks to the idea of SFINAE, the compiler will choose 
+        * the correct implementation for all MessageTypes at compile time
+        *
+        * sendMessage processes the message immediatly, while postMessage delays the 
+        * processing to a later frame
+        */
+        template&lt;typename _MessageType&gt;
+        bool sendMessage()
+        {
+            MessageObjectBase* obj = _MessageType::MessageObjectType::Build();
+            return doSend(obj);
+        }
+
+        template&lt;typename _MessageType&gt;
+        bool sendMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1)
+        {
+            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1);
+            return doSend(obj);
+        }
+
+        template&lt;typename _MessageType&gt;
+        bool sendMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1,
+            const typename _MessageType::MessageObjectType::Param2&amp; p2)
+        {
+            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1, p2);
+            return doSend(obj);
+        }
+
+        template&lt;typename _MessageType&gt;
+        bool sendMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1,
+            const typename _MessageType::MessageObjectType::Param2&amp; p2,
+            const typename _MessageType::MessageObjectType::Param2&amp; p3)
+        {
+            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1, p2, p3);
+            return doSend(obj);
+        }
+
+        ////////////////////////////////
+
+        template&lt;typename _MessageType&gt;
+        void postMessage()
+        {
+            MessageObjectBase* obj = _MessageType::MessageObjectType::Build();
+            doPost(obj);
+        }
+
+        template&lt;typename _MessageType&gt;
+        void postMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1)
+        {
+            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1);
+            doPost(obj);
+        }
+
+        template&lt;typename _MessageType&gt;
+        void postMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1,
+            const typename _MessageType::MessageObjectType::Param2&amp; p2)
+        {
+            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1,p2);
+            doPost(obj);
+        }
+
+        template&lt;typename _MessageType&gt;
+        void postMessage(const typename _MessageType::MessageObjectType::Param1&amp; p1,
+            const typename _MessageType::MessageObjectType::Param2&amp; p2,
+            const typename _MessageType::MessageObjectType::Param2&amp; p3)
+        {
+            MessageObjectBase* obj = _MessageType::MessageObjectType::Build(p1, p2, p3);
+            doPost(obj);
+        }
+
+        void sendPending();
+
+        // overloads from GameTask
+
+        virtual void run(Ogre::Real elapsedTime);
+
+        virtual const Ogre::String&amp; getName() const;
+
+    private:
+        MessageHandlerMapEntries* getOrCreateMapEntries(int id); 
+        bool doSend(MessageObjectBase* msg);
+        void doPost(MessageObjectBase* msg);
+
+        friend class Connection;
+        void disconnectHandler(int connectionId);
+
+    private:
+        int mNextConnectionId;
+        MessageHandlerMap mMessageHandlerMap;
+        MessageQueue mMessageQueue;
+    };
+}
+#endif

Modified: rl/branches/newton20/engine/core/src/MessagePump.cpp
===================================================================
--- rl/branches/newton20/engine/core/src/MessagePump.cpp	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/engine/core/src/MessagePump.cpp	2008-10-19 16:35:21 UTC (rev 4563)
@@ -1,57 +1,126 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
- */
-#include &quot;stdinc.h&quot;
-
-#include &quot;MessagePump.h&quot;
-
-template&lt;&gt; rl::MessagePump* Ogre::Singleton&lt;rl::MessagePump&gt;::ms_Singleton = 0;
-
-namespace rl
-{
-    MessagePump::~MessagePump()
-    {
-
-        while(!mMessageQueue.empty())
-        {
-        
-            delete mMessageQueue.front();
-            mMessageQueue.pop();    
-        }
-
-        MessageHandlerMap::iterator it = mMessageHandlerMap.begin();
-        for( ; it != mMessageHandlerMap.end(); it++ )
-            if( it-&gt;second != NULL )
-                delete it-&gt;second;
-    }
-
-    void MessagePump::run(Ogre::Real elapsedTime)
-    {
-        static bool sending = false;
-        if(!sending)
-        {
-            sending = true;
-            sendPending();
-            sending = false;  
-        }
-    }
-
-    const Ogre::String&amp; MessagePump::getName() const
-    {
-        static Ogre::String name = &quot;MessagePump&quot;;
-        return name;
-    }
-
-}
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. <A HREF="http://www.team-pantheon.de">http://www.team-pantheon.de</A>
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  <A HREF="http://www.jpaulmorrison.com/fbp/artistic2.htm.">http://www.jpaulmorrison.com/fbp/artistic2.htm.</A>
+ */
+#include &quot;stdinc.h&quot;
+
+#include &quot;MessagePump.h&quot;
+
+template&lt;&gt; rl::MessagePump* Ogre::Singleton&lt;rl::MessagePump&gt;::ms_Singleton = 0;
+
+namespace rl
+{
+    MessagePump::~MessagePump()
+    {
+
+        while(!mMessageQueue.empty())
+        {
+        
+            delete mMessageQueue.front();
+            mMessageQueue.pop();    
+        }
+
+        MessageHandlerMap::iterator it = mMessageHandlerMap.begin();
+        for( ; it != mMessageHandlerMap.end(); it++ )
+            if( it-&gt;second != NULL )
+                delete it-&gt;second;
+    }
+
+    void MessagePump::run(Ogre::Real elapsedTime)
+    {
+        static bool sending = false;
+        if(!sending)
+        {
+            sending = true;
+            sendPending();
+            sending = false;  
+        }
+    }
+
+    const Ogre::String&amp; MessagePump::getName() const
+    {
+        static Ogre::String name = &quot;MessagePump&quot;;
+        return name;
+    }
+    
+    void MessagePump::sendPending()
+    {
+        while(!mMessageQueue.empty())
+        {
+            doSend(mMessageQueue.front());
+            mMessageQueue.pop();
+        }
+    }
+    
+    
+    MessagePump::MessageHandlerMapEntries* MessagePump::getOrCreateMapEntries(int id)
+    {
+        // if (id != 0x1000204){
+        //     LOG_MESSAGE(&quot;MessagePump&quot;, &quot;Create or get id &quot; + Ogre::StringConverter::toString(id));                
+        // }
+        MessageHandlerMap::iterator it = mMessageHandlerMap.find(id);
+        if(it == mMessageHandlerMap.end())
+        {
+            MessageHandlerMapEntries* entries = new MessageHandlerMapEntries();
+            mMessageHandlerMap[id] = entries;
+            return entries;
+        }
+        return it-&gt;second;
+    }
+    
+    bool MessagePump::doSend(MessageObjectBase* msg)
+    {
+        bool msgHandled = false;
+        MessageHandlerMapEntries* entries = getOrCreateMapEntries(msg-&gt;getMessageTypeId());
+        for(MessageHandlerMapEntries::iterator it = entries-&gt;begin(); it != entries-&gt;end(); ++it)
+        {
+            if((*it).handlerWrapper-&gt;Invoke(msg))
+            {
+                msgHandled = true;
+            }
+        }
+        delete msg;
+        return msgHandled;;
+    }
+    
+    void MessagePump::doPost(MessageObjectBase* msg)
+    {
+        mMessageQueue.push(msg);
+    }
+    
+    void MessagePump::disconnectHandler(int connectionId)
+    {
+        //not very performant...definitely needs improvement
+        for (MessageHandlerMap::iterator it = mMessageHandlerMap.begin();
+             it != mMessageHandlerMap.end(); ++it)
+        {
+            MessageHandlerMapEntries* en = it-&gt;second;
+            for (MessageHandlerMapEntries::iterator jt = en-&gt;begin(); jt != en-&gt;end(); ++jt)
+            {
+                if (jt-&gt;connectionId == connectionId)
+                {
+                    delete jt-&gt;handlerWrapper;
+                    en-&gt;erase(jt);
+                    if (en-&gt;empty())
+                    {
+                        delete en;
+                        mMessageHandlerMap.erase(it);
+                    }
+                    return;
+                }
+            }
+        }
+    }
+    
+}

Modified: rl/branches/newton20/engine/rules/src/Combat.cpp
===================================================================
--- rl/branches/newton20/engine/rules/src/Combat.cpp	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/engine/rules/src/Combat.cpp	2008-10-19 16:35:21 UTC (rev 4563)
@@ -72,9 +72,11 @@
 		  mNextActionId(0),
 		  mAnimationSequenceTicket(0)
     {
+        LOG_MESSAGE(&quot;Combat&quot;, &quot;Register message handler&quot;);
 		mLifeStateChangeConnection =
             MessagePump::getSingleton().addMessageHandler&lt;MessageType_GameObjectLifeStateChanged&gt;(
 			    boost::bind(&amp;Combat::onGameObjectLifeStateChanged, this, _1, _2, _3));
+        LOG_MESSAGE(&quot;Combat&quot;, &quot;Registering message handler done&quot;);
     }
 
     Combat::~Combat()

Modified: rl/branches/newton20/engine/rules/src/FetchItemJob.cpp
===================================================================
--- rl/branches/newton20/engine/rules/src/FetchItemJob.cpp	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/engine/rules/src/FetchItemJob.cpp	2008-10-19 16:35:21 UTC (rev 4563)
@@ -52,15 +52,34 @@
 			|| mItem-&gt;getState() == GOS_UNLOADED
 			|| mItem-&gt;getState() == GOS_LOADED)
 		{
+            if (!mItem) 
+            {
+                LOG_WARNING(&quot;FetchItemJob&quot;, &quot;Item not set or it has a strange state.&quot;);
+            }
+            else if (mTimeLeft &lt; 0)
+            {
+                LOG_MESSAGE(&quot;FetchItemJob&quot;, &quot;Time is up.&quot;);
+            }
+            else
+            {
+                LOG_WARNING(&quot;FetchItemJob&quot;, &quot;Item has a strange state (&quot; 
+                        + StringConverter::toString(mItem-&gt;getState()) + &quot;)&quot;);
+            }
+
 			// Stay put where ever we are.
 			mActor-&gt;setMovement(CreatureController::MT_STEHEN, Vector3::ZERO, Vector3::ZERO);
 			return true;
 		}
 
-		Vector3 targetPos = mItem-&gt;getPosition();
+        Item* target = mItem;
+        while (target-&gt;getState() == GOS_IN_POSSESSION)
+        {
+            target = target-&gt;getParentContainer();
+        }
+		Vector3 targetPos = target-&gt;getPosition();
 
 		// Are we there now?
-		Ogre::Real distance = MathUtil::distance(mItem-&gt;getWorldBoundingBox(),
+		Ogre::Real distance = MathUtil::distance(target-&gt;getWorldBoundingBox(),
 			mActor-&gt;getCreature()-&gt;getWorldBoundingBox());
 		if (distance &lt; 1.0f)
 		{
@@ -68,9 +87,9 @@
             
             if (mItem-&gt;getState() == GOS_IN_SCENE)
             {
-                    // @todo play pickup animation
-                    mActor-&gt;getCreature()-&gt;getInventory()-&gt;hold(mItem, mTargetSlot);
-                    return true;
+                // @todo play pickup animation
+                mActor-&gt;getCreature()-&gt;getInventory()-&gt;hold(mItem, mTargetSlot);
+                return true;
 			}
             else if (mItem-&gt;getState() == GOS_IN_POSSESSION)
 			{
@@ -86,8 +105,8 @@
             else if (mItem-&gt;getState() == GOS_READY
 					 || mItem-&gt;getState() == GOS_HELD)
 			{
-                    LOG_WARNING(&quot;FetchItemJob&quot;, &quot;Target item is held by someone&quot;);
-                    return true;
+                LOG_WARNING(&quot;FetchItemJob&quot;, &quot;Target item is held by someone&quot;);
+                return true;
             }
 
             return false;

Modified: rl/branches/newton20/engine/ui/src/UiSubsystem.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/UiSubsystem.cpp	2008-10-19 13:48:32 UTC (rev 4562)
+++ rl/branches/newton20/engine/ui/src/UiSubsystem.cpp	2008-10-19 16:35:21 UTC (rev 4563)
@@ -74,6 +74,7 @@
         mGuiResourceProvider(NULL),
         mGuiSystem(NULL)
     {
+        mWindowFactory = new WindowFactory();
         mSceneClearingConnection =
             MessagePump::getSingleton().addMessageHandler&lt;MessageType_SceneClearing&gt;(
 			    boost::bind(&amp;UiSubsystem::onBeforeClearScene, this));
@@ -86,7 +87,9 @@
         mActiveCharacterChangedConnection = 
             MessagePump::getSingleton().addMessageHandler&lt;MessageType_ActivePlayerCharChanged&gt;(
                 boost::bind(&amp;UiSubsystem::onActiveCharacterChanged, this, _1, _2));
-        mWindowFactory = new WindowFactory();
+        mAllPlayerCharactersDiedConnection =
+            MessagePump::getSingleton().addMessageHandler&lt;MessageType_AllPlayerCharsDied&gt;(
+                boost::bind(&amp;UiSubsystem::onAllPlayerCharactersDied, this));
     }
 
     UiSubsystem::~UiSubsystem()
@@ -110,7 +113,7 @@
         World* world = CoreSubsystem::getSingleton().getWorld();
         SceneManager* sceneMgr = world-&gt;getSceneManager();
         
-        CEGUI::System::setDefaultXMLParserName(&quot;XercesParser&quot;);
+//        CEGUI::System::setDefaultXMLParserName(&quot;XercesParser&quot;);
 
         LOG_MESSAGE2(Logger::UI,
             &quot;Initializing CEGUI Renderer.&quot;, &quot;UiSubsystem::initializeUiSubsystem&quot;);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001619.html">[Dsa-hl-svn] r4562 - in modules: . editortest
</A></li>
	<LI>Next message: <A HREF="001621.html">[Dsa-hl-svn] r4564 - in rl/trunk/editors/Lockenwickler: . src	src/media/icons
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1620">[ date ]</a>
              <a href="thread.html#1620">[ thread ]</a>
              <a href="subject.html#1620">[ subject ]</a>
              <a href="author.html#1620">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
