<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3047 - in rl/trunk/engine: core/src ui/include ui/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-February/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3047%20-%20in%20rl/trunk/engine%3A%20core/src%20ui/include%20ui/src&In-Reply-To=%3C200702141638.l1EGcB9N008969%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000117.html">
   <LINK REL="Next"  HREF="000119.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3047 - in rl/trunk/engine: core/src ui/include ui/src</H1>
    <B>chrber at BerliOS</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3047%20-%20in%20rl/trunk/engine%3A%20core/src%20ui/include%20ui/src&In-Reply-To=%3C200702141638.l1EGcB9N008969%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3047 - in rl/trunk/engine: core/src ui/include ui/src">chrber at mail.berlios.de
       </A><BR>
    <I>Wed Feb 14 17:38:11 CET 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000117.html">[Dsa-hl-svn] r3046 - modules/common/scripts
</A></li>
        <LI>Next message: <A HREF="000119.html">[Dsa-hl-svn] r3048 - modules/common/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#118">[ date ]</a>
              <a href="thread.html#118">[ thread ]</a>
              <a href="subject.html#118">[ subject ]</a>
              <a href="author.html#118">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: chrber
Date: 2007-02-14 17:38:10 +0100 (Wed, 14 Feb 2007)
New Revision: 3047

Modified:
   rl/trunk/engine/core/src/ConfigurationManager.cpp
   rl/trunk/engine/ui/include/CommandMapper.h
   rl/trunk/engine/ui/src/CommandMapper.cpp
Log:
Reworked CommandMapper so that it works with the new ConfiguratioManager


Modified: rl/trunk/engine/core/src/ConfigurationManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ConfigurationManager.cpp	2007-02-13 21:36:19 UTC (rev 3046)
+++ rl/trunk/engine/core/src/ConfigurationManager.cpp	2007-02-14 16:38:10 UTC (rev 3047)
@@ -75,6 +75,36 @@
         // Setup input default values
         mInputSettings.insert(make_pair(&quot;Mouse Sensitivity&quot;, &quot;4&quot;));
         mInputSettings.insert(make_pair(&quot;Mouse Invert&quot;, &quot;no&quot;));
+        mInputSettings.insert(make_pair(&quot;mov_turn_left&quot;, &quot;Q&quot;));
+        mInputSettings.insert(make_pair(&quot;mov_turn_right&quot;, &quot;E&quot;));
+        mInputSettings.insert(make_pair(&quot;mov_move_left&quot;, &quot;A&quot;));
+        mInputSettings.insert(make_pair(&quot;mov_move_right&quot;, &quot;D&quot;));
+        mInputSettings.insert(make_pair(&quot;mov_move_forward&quot;, &quot;W&quot;));
+        mInputSettings.insert(make_pair(&quot;mov_move_backward&quot;, &quot;S&quot;));
+        mInputSettings.insert(make_pair(&quot;mov_jump&quot;, &quot;Leertaste&quot;));
+        mInputSettings.insert(make_pair(&quot;mov_run&quot;, &quot;Umschalt links&quot;));
+        mInputSettings.insert(make_pair(&quot;mov_sneak&quot;, &quot;Strg links&quot;));
+        //mInputSettings.insert(make_pair(&quot;act_run_lock&quot;, &quot;&lt;,|,&gt;&quot;));
+        mInputSettings.insert(make_pair(&quot;act_quitgame&quot;, &quot;Ctrl+X&quot;));
+        mInputSettings.insert(make_pair(&quot;act_closecurrentwindow&quot;, &quot;Escape&quot;));
+        mInputSettings.insert(make_pair(&quot;act_toggleconsole&quot;, &quot;Tabulator&quot;));
+        mInputSettings.insert(make_pair(&quot;act_toggledebugwindow&quot;, &quot;F2&quot;));
+        mInputSettings.insert(make_pair(&quot;act_togglegamelogwindow&quot;, &quot;F3&quot;));
+        mInputSettings.insert(make_pair(&quot;act_toggleviewmode&quot;, &quot;F&quot;));
+        mInputSettings.insert(make_pair(&quot;act_resetcamera&quot;, &quot;0 (Nummernblock)&quot;));
+        mInputSettings.insert(make_pair(&quot;act_makescreenshot&quot;, &quot;P,Ctrl+P&quot;));
+        mInputSettings.insert(make_pair(&quot;act_togglecollisiondebug&quot;, &quot;L,Ctrl+L&quot;));
+        mInputSettings.insert(make_pair(&quot;act_toggledebugvisualisation&quot;, &quot;Ctrl+O&quot;));
+        mInputSettings.insert(make_pair(&quot;act_togglevanitymode&quot;, &quot;V&quot;));
+        mInputSettings.insert(make_pair(&quot;act_usecurrentobjectdefaultaction&quot;, &quot;R&quot;));
+        mInputSettings.insert(make_pair(&quot;act_toggleinventorywindow&quot;, &quot;I&quot;));
+        mInputSettings.insert(make_pair(&quot;act_showjournalwindow &quot;, &quot;J&quot;));
+        mInputSettings.insert(make_pair(&quot;act_showcharactersheet&quot;, &quot;C&quot;));
+        mInputSettings.insert(make_pair(&quot;act_togglecharacterstatewindow&quot;, &quot;O&quot;));
+        mInputSettings.insert(make_pair(&quot;act_toggleingameglobalmenu&quot;, &quot;F10&quot;));
+        mInputSettings.insert(make_pair(&quot;act_togglecharactercontroller&quot;, &quot;M&quot;));
+        mInputSettings.insert(make_pair(&quot;act_shownextdebugwindowpage &quot;, &quot;Ctrl+M&quot;));
+        mInputSettings.insert(make_pair(&quot;act_showobjectactions&quot;, &quot;U&quot;));
 
         setRastullahCfgPath();
     }
@@ -150,17 +180,9 @@
         if (!mRastullahCfgPath.empty())
         {
             ConfigFile* configfile = new ConfigFile();
-            std::vector&lt;Ogre::String&gt; cfg_paths;
 
-            if (mRastullahCfgPath.find(&quot;:&quot;) == std::string::npos)
-            {
-                cfg_paths.push_back(mRastullahCfgPath);
-            }
-            else
-            {
-                // Split the path at the ':' character
-                cfg_paths = Ogre::StringUtil::split(mRastullahCfgPath, &quot;:&quot;);
-            }
+            // Split the path at the ':' character
+            std::vector&lt;Ogre::String&gt; cfg_paths = Ogre::StringUtil::split(mRastullahCfgPath, &quot;:&quot;);
 
             for (unsigned int i = 0; i &lt; cfg_paths.size(); i++)
             {

Modified: rl/trunk/engine/ui/include/CommandMapper.h
===================================================================
--- rl/trunk/engine/ui/include/CommandMapper.h	2007-02-13 21:36:19 UTC (rev 3046)
+++ rl/trunk/engine/ui/include/CommandMapper.h	2007-02-14 16:38:10 UTC (rev 3047)
@@ -57,6 +57,11 @@
         CommandMapper();
         ~CommandMapper();
 
+        /**
+         * Creates the key -&gt; action mapping from the key-value list
+         *
+         * @param keylist key-value list of input options
+         */
         void buildCommandMapping(const Ogre::NameValuePairList&amp; keylist);
 
         void setMapping(MapType map, int code, const CeGuiString&amp; actionName);

Modified: rl/trunk/engine/ui/src/CommandMapper.cpp
===================================================================
--- rl/trunk/engine/ui/src/CommandMapper.cpp	2007-02-13 21:36:19 UTC (rev 3046)
+++ rl/trunk/engine/ui/src/CommandMapper.cpp	2007-02-14 16:38:10 UTC (rev 3047)
@@ -145,36 +145,51 @@
     void CommandMapper::buildCommandMapping(const Ogre::NameValuePairList&amp; keylist)
     {
         /** @Todo: Replace this with something not static */
-        mMovementCommands[InputManager::getSingleton().getScanCode(&quot;Q&quot;)] = getMovement(&quot;turn_left&quot;);
-        mMovementCommands[InputManager::getSingleton().getScanCode(&quot;E&quot;)] = getMovement(&quot;turn_right&quot;);
-        mMovementCommands[InputManager::getSingleton().getScanCode(&quot;W&quot;)] = getMovement(&quot;forward&quot;);
-        mMovementCommands[InputManager::getSingleton().getScanCode(&quot;S&quot;)] = getMovement(&quot;backward&quot;);
-        mMovementCommands[InputManager::getSingleton().getScanCode(&quot;A&quot;)] = getMovement(&quot;left&quot;);
-        mMovementCommands[InputManager::getSingleton().getScanCode(&quot;D&quot;)] = getMovement(&quot;right&quot;);
-        mMovementCommands[InputManager::getSingleton().getScanCode(&quot;Leertaste&quot;)] = getMovement(&quot;jump&quot;);
-
-        mKeyCommandsGlobal[getKeyCode(&quot;Ctrl+X&quot;)] = CeGuiString(&quot;quitgame&quot;);
+        /*
         mKeyCommandsGlobal[getKeyCode(&quot;F10&quot;)] = CeGuiString(&quot;toggleingameglobalmenu&quot;);
         mKeyCommandsGlobal[getKeyCode(&quot;I&quot;)] = CeGuiString(&quot;toggleinventorywindow&quot;);
         mKeyCommandsGlobal[getKeyCode(&quot;J&quot;)] = CeGuiString(&quot;showjournalwindow&quot;);
         mKeyCommandsGlobal[getKeyCode(&quot;C&quot;)] = CeGuiString(&quot;showcharactersheet&quot;);
         mKeyCommandsGlobal[getKeyCode(&quot;O&quot;)] = CeGuiString(&quot;togglecharacterstatewindow&quot;);
+        */
 
-        /*
-        for (ConfigFile::SettingsIterator it = cfgfile-&gt;getSettingsIterator(&quot;Movement&quot;);
-            it.hasMoreElements();)
+        std::vector&lt;Ogre::String&gt; keys;
+
+        // Extract global actions and movement actions from the list
+        for (Ogre::NameValuePairList::const_iterator it = keylist.begin(); it != keylist.end(); it++)
         {
-            String key = it.peekNextKey();
-            String setting = it.getNext();
+            // Split the path at the ',' character
+            keys = Ogre::StringUtil::split(it-&gt;second, &quot;,&quot;);
 
-            mMovementCommands[InputManager::getSingleton().getScanCode(key)] = getMovement(setting);
-            LOG_MESSAGE(Logger::UI,
-                Ogre::String(&quot;Key &quot;) + key    + &quot; (&quot;
-                + StringConverter::toString(InputManager::getSingleton().getScanCode(key))
-                + &quot;) is assigned to movement &quot;    + setting+&quot; (&quot;
-                + StringConverter::toString(getMovement(setting))+&quot;)&quot;);
+            // We got a movement action
+            if (it-&gt;first.find(&quot;mov_&quot;) != std::string::npos)
+            {
+                for (int i = 0; i &lt; keys.size(); i++)
+                {
+                    mMovementCommands[InputManager::getSingleton().getScanCode(keys[i])] = getMovement(it-&gt;first);
+                    LOG_MESSAGE(Logger::UI,
+                        Ogre::String(&quot;Key &quot;) + keys[i] + &quot; (&quot;
+                        + StringConverter::toString(InputManager::getSingleton().getScanCode(keys[i]))
+                        + &quot;) is assigned to movement &quot; + it-&gt;first +&quot; (&quot;
+                        + StringConverter::toString(getMovement(it-&gt;first))+&quot;)&quot;);
+                }
+            }
+
+            // We got a global action
+            if (it-&gt;first.find(&quot;act_&quot;) != std::string::npos)
+            {
+                for (int i = 0; i &lt; keys.size(); i++)
+                {
+                    mKeyCommandsGlobal[getKeyCode(keys[i])] = CeGuiString(it-&gt;first);
+                    LOG_MESSAGE(Logger::UI,
+                        Ogre::String(&quot;Key &quot;) + keys[i] + &quot; (&quot; + StringConverter::toString(getKeyCode(keys[i]))
+                        + &quot;) is assigned to command &quot; + it-&gt;first +&quot; globally&quot;);
+                }
+            }
         }
 
+        /*
+
         for (ConfigFile::SettingsIterator it = cfgfile-&gt;getSettingsIterator(&quot;Global keys&quot;);
             it.hasMoreElements();)
         {
@@ -271,43 +286,43 @@
 
     MovementState CommandMapper::getMovement(const Ogre::String &amp;movementDescription)
     {
-        if (movementDescription == &quot;left&quot;)
+        if (movementDescription == &quot;mov_move_left&quot;)
         {
             return MOVE_LEFT;
         }
-        else if (movementDescription == &quot;right&quot;)
+        else if (movementDescription == &quot;mov_move_right&quot;)
         {
             return MOVE_RIGHT;
         }
-        else if (movementDescription == &quot;forward&quot;)
+        else if (movementDescription == &quot;mov_move_forward&quot;)
         {
             return MOVE_FORWARD;
         }
-        else if (movementDescription == &quot;backward&quot;)
+        else if (movementDescription == &quot;mov_move_backward&quot;)
         {
             return MOVE_BACKWARD;
         }
-        else if (movementDescription == &quot;turn_left&quot;)
+        else if (movementDescription == &quot;mov_turn_left&quot;)
         {
             return TURN_LEFT;
         }
-        else if (movementDescription == &quot;turn_right&quot;)
+        else if (movementDescription == &quot;mov_turn_right&quot;)
         {
             return TURN_RIGHT;
         }
-        else if (movementDescription == &quot;run&quot;)
+        else if (movementDescription == &quot;mov_run&quot;)
         {
             return MOVE_RUN;
         }
-        else if (movementDescription == &quot;sneak&quot;)
+        else if (movementDescription == &quot;mov_sneak&quot;)
         {
             return MOVE_SNEAK;
         }
-        else if (movementDescription == &quot;jump&quot;)
+        else if (movementDescription == &quot;mov_jump&quot;)
         {
             return MOVE_JUMP;
         }
-        else if (movementDescription == &quot;run_lock&quot;)
+        else if (movementDescription == &quot;mov_run_lock&quot;)
         {
             return MOVE_RUN_LOCK;
         }


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000117.html">[Dsa-hl-svn] r3046 - modules/common/scripts
</A></li>
	<LI>Next message: <A HREF="000119.html">[Dsa-hl-svn] r3048 - modules/common/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#118">[ date ]</a>
              <a href="thread.html#118">[ thread ]</a>
              <a href="subject.html#118">[ subject ]</a>
              <a href="author.html#118">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
