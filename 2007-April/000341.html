<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3270 - modules/common/dsa modules/common/scripts	modules/regressiontest/scripts/maps modules/techdemo/dsa	modules/techdemo/scripts modules/techdemo/scripts/maps	rl/trunk/engine/core/include rl/trunk/engine/script/swig
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3270%20-%20modules/common/dsa%20modules/common/scripts%0A%09modules/regressiontest/scripts/maps%20modules/techdemo/dsa%0A%09modules/techdemo/scripts%20modules/techdemo/scripts/maps%0A%09rl/trunk/engine/core/include%20rl/trunk/engine/script/swig&In-Reply-To=%3C200704120839.l3C8d235007124%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000340.html">
   <LINK REL="Next"  HREF="000342.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3270 - modules/common/dsa modules/common/scripts	modules/regressiontest/scripts/maps modules/techdemo/dsa	modules/techdemo/scripts modules/techdemo/scripts/maps	rl/trunk/engine/core/include rl/trunk/engine/script/swig</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3270%20-%20modules/common/dsa%20modules/common/scripts%0A%09modules/regressiontest/scripts/maps%20modules/techdemo/dsa%0A%09modules/techdemo/scripts%20modules/techdemo/scripts/maps%0A%09rl/trunk/engine/core/include%20rl/trunk/engine/script/swig&In-Reply-To=%3C200704120839.l3C8d235007124%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3270 - modules/common/dsa modules/common/scripts	modules/regressiontest/scripts/maps modules/techdemo/dsa	modules/techdemo/scripts modules/techdemo/scripts/maps	rl/trunk/engine/core/include rl/trunk/engine/script/swig">blakharaz at mail.berlios.de
       </A><BR>
    <I>Thu Apr 12 10:39:02 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000340.html">[Dsa-hl-svn] r3269 - in modules: common/scripts/effects	regressiontest/scripts
</A></li>
        <LI>Next message: <A HREF="000342.html">[Dsa-hl-svn] r3271 - modules/techdemo2/scripts/maps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#341">[ date ]</a>
              <a href="thread.html#341">[ thread ]</a>
              <a href="subject.html#341">[ subject ]</a>
              <a href="author.html#341">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2007-04-12 10:38:35 +0200 (Thu, 12 Apr 2007)
New Revision: 3270

Added:
   modules/techdemo/dsa/techdemo.gof
Removed:
   modules/techdemo/scripts/maps/techdemo_bauer.rb
Modified:
   modules/common/dsa/gameobjectdefinitions.gof
   modules/common/scripts/truhe.rb
   modules/regressiontest/scripts/maps/regressiontest.rb
   modules/techdemo/scripts/heiltrank_tech.rb
   modules/techdemo/scripts/maps/techdemo.rb
   modules/techdemo/scripts/maps/techdemo_hoehle.rb
   modules/techdemo/scripts/maps/techdemo_hoehle_eingang.rb
   modules/techdemo/scripts/maps/techdemo_spinne.rb
   rl/trunk/engine/core/include/GameAreaTypes.h
   rl/trunk/engine/core/include/GameEventManager.h
   rl/trunk/engine/script/swig/RlCore.swig
Log:
Adapt techdemo (1) to gameobject system

Modified: modules/common/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/common/dsa/gameobjectdefinitions.gof	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/common/dsa/gameobjectdefinitions.gof	2007-04-12 08:38:35 UTC (rev 3270)
@@ -16,6 +16,16 @@
 		&lt;property name=&quot;inventorywindowtype&quot; type=&quot;STRING&quot; data=&quot;inventory_human.xml&quot;/&gt;
 	&lt;/gameobjectclass&gt;
 
+	&lt;gameobjectclass classid=&quot;chest&quot; baseclass=&quot;Chest&quot;&gt;
+	  &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Truhe&quot;/&gt;
+		&lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Eine Truhe&quot;/&gt;
+		&lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;convexhull&quot;/&gt;
+		&lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;0&quot;/&gt;
+		&lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;ver_truhe_gross01.mesh&quot;/&gt;
+&lt;!--		&lt;property name=&quot;sound&quot; type=&quot;STRING&quot; data=&quot;doorcreak.ogg&quot;/&gt;--&gt;
+	&lt;/gameobjectclass&gt;
+
+
 	&lt;gameobjectclass classid=&quot;torch&quot; baseclass=&quot;Torch&quot;&gt;
 		&lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;torch&quot;/&gt;
 		&lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;Torch&quot;/&gt;

Modified: modules/common/scripts/truhe.rb
===================================================================
--- modules/common/scripts/truhe.rb	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/common/scripts/truhe.rb	2007-04-12 08:38:35 UTC (rev 3270)
@@ -37,24 +37,23 @@
 end
 
 class Chest &lt; Container
-  def initialize(name, isOpen )
-    super(name, &quot;Eine Truhe&quot;);
+  def initialize(id)
+    super(id)
 
-    chestActor = $AM.createMeshActor( name, &quot;ver_truhe_gross01.mesh&quot;,  0, 0.0 ); 
-    $SCRIPT.log(&quot;truhe.rb - Aktor erstellt.&quot;);
-    setActor(chestActor);
-    $SCRIPT.log(&quot;truhe.rb - Aktor gesetzt&quot;);
-    soundActor = $AM.createSoundSampleActor(name+&quot;_knarzen&quot;,&quot;doorcreak.ogg&quot;);
-    chestActor.attachToSlot(soundActor,&quot;Bone01&quot;);
-    $SCRIPT.log(&quot;truhe.rb - Sound hinzugefuegt&quot;);
-
-    @mOpen = isOpen;
-
+    @mOpen = false;
+    
+    # @todo: Make these actions global actions (add to ActionManager)
     addAction(OpenContainerAction.new);
     addAction(CloseContainerAction.new);
     $SCRIPT.log(&quot;truhe.rb - Aktionen hinzugefuegt.&quot;);
   end
   
+  def placeIntoScene()
+    super()
+    soundActor = $AM.createSoundSampleActor(getActor().getName()+&quot;_knarzen&quot;,&quot;doorcreak.ogg&quot;);
+    getActor().attachToSlot(soundActor,&quot;Bone01&quot;);    
+  end
+  
   def setOpen( isOpen )
     @mOpen = isOpen;
     fireObjectStateChangeEvent();

Modified: modules/regressiontest/scripts/maps/regressiontest.rb
===================================================================
--- modules/regressiontest/scripts/maps/regressiontest.rb	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/regressiontest/scripts/maps/regressiontest.rb	2007-04-12 08:38:35 UTC (rev 3270)
@@ -13,6 +13,7 @@
 require 'JobSequenceTest.rb'
 require 'SoundTest.rb'
 require 'effecttest.rb'
+require 'LightzoneTest.rb'
 
 # Physik aktivieren
 $PM.setEnabled(true)
@@ -48,4 +49,7 @@
 JobSequenceTest.new([5, 0, -5])
 EffectTest.new([5, 0, 5])
 SoundTest.new([10, 0, 10])
+LightzoneTest.new([20, 0, 0])
+
+
 $SCRIPT.log(&quot;tests initialisiert.&quot;);

Added: modules/techdemo/dsa/techdemo.gof
===================================================================
--- modules/techdemo/dsa/techdemo.gof	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/techdemo/dsa/techdemo.gof	2007-04-12 08:38:35 UTC (rev 3270)
@@ -0,0 +1,59 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
+&lt;GameObjectDefinitions&gt;
+
+    &lt;gameobjectclass classid=&quot;ArnolfGrossschaedel&quot; baseclass=&quot;NPC&quot;&gt;
+    	&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Ein Bauer&quot;/&gt;
+    	&lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Ein Bauer&quot;/&gt;
+    	&lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;men_wirt_posed.mesh&quot;/&gt;
+        &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;0&quot;/&gt;
+        &lt;property name=&quot;dialogfile&quot; type=&quot;STRING&quot; data=&quot;bauer.xml&quot;/&gt;
+	    &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+    
+    &lt;gameobjectclass classid=&quot;Waldspinne&quot; baseclass=&quot;Waldspinne&quot;&gt;
+    	&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Waldspinne&quot;/&gt;
+    	&lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Eine gro&#195;&#159;e Spinne, die sich anscheinend vor irgendetwas &#195;&#164;ngstigt.&quot;/&gt;
+    	&lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;tie_waldspinne.mesh&quot;/&gt;
+      &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;0&quot;/&gt;
+	    &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+    
+    &lt;gameobjectclass classid=&quot;Heiltrank&quot; baseclass=&quot;Heiltrank&quot;&gt;
+    	&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Trank&quot;/&gt;
+    	&lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Eine Flasche mit einer geheimnisvollen Fl&#195;&#188;ssigkeit.&quot;/&gt;
+    	&lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;obj_heiltrank01.mesh&quot;/&gt;
+      &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;0&quot;/&gt;
+	    &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;none&quot;/&gt;
+	    &lt;property name=&quot;quality&quot; type=&quot;STRING&quot; data=&quot;A&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+    
+    &lt;gameobjectclass classid=&quot;torch&quot; baseclass=&quot;Torch&quot;&gt;
+    	&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Fackel&quot;/&gt;
+    	&lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Handels&#195;&#188;bliche Fackel zum Beleuchten der Umgebung.&quot;/&gt;
+    	&lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;ins_fackel_01.mesh&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+    
+    &lt;gameobjectclass classid=&quot;Fels&quot; baseclass=&quot;Rock&quot;&gt;
+    	&lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Fels&quot;/&gt;
+    	&lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Ein Fels&quot;/&gt;
+    	&lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;nat_stein_gross_01.mesh&quot;/&gt;
+      &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;4000&quot;/&gt;
+	    &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+    
+    &lt;gameobjectclass classid=&quot;switch3way&quot; baseclass=&quot;Switch3Way&quot;&gt;
+        &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Hebel&quot;/&gt;
+        &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Ein Hebel&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;arc_hebel_01.mesh&quot;/&gt;
+        &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;sphere&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+    
+    &lt;gameobjectclass classid=&quot;rockpile&quot; baseclass=&quot;RockPile&quot;&gt;
+        &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Steinhaufen&quot;/&gt;
+        &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Ein gro&#195;&#159;er Steinhaufen&quot;/&gt;
+        &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;Steinhaufen.mesh&quot;/&gt;
+        &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;convexhull&quot;/&gt;
+        &lt;property name=&quot;highlight&quot; type=&quot;BOOL&quot; data=&quot;false&quot;/&gt;
+    &lt;/gameobjectclass&gt;
+    
+&lt;/GameObjectDefinitions&gt;

Modified: modules/techdemo/scripts/heiltrank_tech.rb
===================================================================
--- modules/techdemo/scripts/heiltrank_tech.rb	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/techdemo/scripts/heiltrank_tech.rb	2007-04-12 08:38:35 UTC (rev 3270)
@@ -24,7 +24,7 @@
             when &quot;M&quot;
                lep = -$DM.roll(3, 0)
             when &quot;A&quot;
-               lep = $DM.roll(1, 0) # KL-1, GE-1 f&#252;r 1h
+               lep = $DM.roll(1, 0) # KL-1, GE-1 f&#239;&#191;&#189;r 1h
             when &quot;B&quot;
                lep = $DM.roll(2, 0)
             when &quot;C&quot;
@@ -44,11 +44,16 @@
 end
 
 class Heiltrank &lt; Item
-  def initialize(name, beschreibung, model, quality)
-    super(name, beschreibung)
-    trankActor = $AM.createMeshActor( name, model,  0, 0.0 );
-    setActor(trankActor)
-
-    addAction(HealAction.new(&quot;drink&quot;, &quot;Trinken&quot;, quality, 0, 0))
+  
+  def initialize(id)
+    super(id)
   end
+  
+  def setProperty(key, value)
+    if (key == &quot;quality&quot;)
+    	addAction(HealAction.new(&quot;drink&quot;, &quot;Trinken&quot;, value, 0, 0))
+    else
+    	super(key, value)
+    end
+  end
 end

Modified: modules/techdemo/scripts/maps/techdemo.rb
===================================================================
--- modules/techdemo/scripts/maps/techdemo.rb	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/techdemo/scripts/maps/techdemo.rb	2007-04-12 08:38:35 UTC (rev 3270)
@@ -2,6 +2,7 @@
 
 require 'player.rb'
 require 'hero.rb'
+require 'npc.rb'
 
 # Physik aktivieren
 $PM.setEnabled(true);
@@ -31,53 +32,76 @@
 $SCRIPT.log(&quot;Welten-Thema fertig&quot;);
 
 $SCRIPT.log(&quot;Create hero&quot;)
-$hero = $GOM.createGameObjectProxy(&quot;hero&quot;, 1);
+$hero = $GOM.createGameObjectProxy(&quot;hero&quot;, 1).getGameObject();
 
 $SCRIPT.log(&quot;Place hero into scene&quot;)
-$hero.getGameObject().placeIntoScene()
+$hero.setPosition([0, 0.7, 0])
+$hero.placeIntoScene()
 
 $SCRIPT.log(&quot;Prepare hero for being the active character&quot;)
-PlayerSettings.preparePlayer($hero.getGameObject())
+PlayerSettings.preparePlayer($hero)
 
 $SCRIPT.log(&quot;Set hero as active character&quot;)
-$UI.setActiveCharacter($hero.getGameObject())
+$UI.setActiveCharacter($hero)
 
 $World.setFog( World::FOG_EXP, [0.8,0.8,1.0,0.5], 0.00003, 0.4, 1.0);
 
 load &quot;techdemo_umgebung.rb&quot;
 load &quot;techdemo_quests.rb&quot;
+load &quot;techdemo_spinne.rb&quot;
+load &quot;techdemo_hoehle.rb&quot;
 
-load &quot;techdemo_bauer.rb&quot;
-$bauer = 
-$bauer = BauerArnolfGrossschaedel.new()
-$bauer.getActor().placeIntoScene([29.9182, -0.6554, 9.590], [[0, 1, 0], 280])
+$bauer = $GOM.createGameObjectProxy(&quot;ArnolfGrossschaedel&quot;).getGameObject()
+$bauer.setPosition([29.9182, -0.6554, 9.590])
+$bauer.setOrientation([[0, 1, 0], 280])
+$bauer.placeIntoScene();
 
-load &quot;techdemo_spinne.rb&quot;
-$waldspinne = Waldspinne.new()
+$waldspinne = $GOM.createGameObjectProxy(&quot;Waldspinne&quot;).getGameObject()
+$waldspinne.setPosition([-20.400, 3.430, -82.000])
+$waldspinne.placeIntoScene();
+$waldspinne.getActor().setScale(5.0, 5.0, 5.0)
 
-load &quot;techdemo_hoehle.rb&quot;
-$hebeltuer = Door.new(&quot;Eine T&#195;&#188;r&quot;, &quot;Eine T&#195;&#188;r, allerdings ist keine Klinke vorhanden&quot;, [141.950, 7.200, 32.550], [[0, 1, 0], 30])
-$hebeltuer.addActions(false, false)
-$hebel = Switch.new(&quot;HoehlenHebel&quot;)
-$hebel.getActor().placeIntoScene([114.800, 10.700, 34.750], [[0, 1, 0], 280] )
+
+$hebeltuer = $GOM.createGameObjectProxy(&quot;door&quot;).getGameObject();
+$hebeltuer.setPosition([141.95, 7.20, 32.55]);
+$hebeltuer.setOrientation([[0, 1, 0], 30]);
+$hebeltuer.setDescription(&quot;Eine T&#195;&#188;r, allerdings ist keine Klinke vorhanden&quot;)
+$hebeltuer.placeIntoScene()
+# $hebeltuer.addActions(false, false)
+
+$hebel = $GOM.createGameObjectProxy(&quot;switch3way&quot;).getGameObject();
+$hebel.setPosition([114.800, 10.700, 34.750])
+$hebel.setOrientation([[0, 1, 0], 280])
+$hebel.placeIntoScene()
 $hebel.getActor().roll(-90.0);
 $hebel.getActor().yaw(90.0);
 $tueroeffner = CaveDoorOpener.new($hebeltuer, $hebel)
 
 require &quot;truhe.rb&quot;
-$truhe = Chest.new( &quot;Truhe&quot;, false );
-$truhe.getActor().placeIntoScene([123.530, 9.500, 47.250]);
-$truhe.addItem(Torch.new(&quot;Fackel2&quot;))
+$truhe = $GOM.createGameObjectProxy(&quot;chest&quot;).getGameObject();
+$truhe.setPosition([123.530, 9.500, 47.250])
+$truhe.placeIntoScene();
+$truhe.addItem($GOM.createGameObjectProxy(&quot;torch&quot;).getGameObject())
 
 require &quot;techdemo_hoehle_eingang.rb&quot;
-luftfels1 = Rock.new(&quot;Fels1&quot;, &quot;nat_stein_gross_01.mesh&quot;, [105.510400390625, 26.0499194335938, 40.3499243164063], [[1.0, 0.0, 0.0], 0.0], false)
-luftfels2 = Rock.new(&quot;Fels2&quot;, &quot;nat_stein_gross_01.mesh&quot;, [99.82107421875, 21.3660180664063, 45.87017578125], [[1.0, 0.0, 0.0], 0.0], false)
-luftfels3 = Rock.new(&quot;Fels3&quot;, &quot;nat_stein_gross_01.mesh&quot;, [ 94.425087890625, 30.0978625488281, 44.10947265625], [[1.0, 0.0, 0.0], 0.0], false)
 
+trank = $GOM.createGameObjectProxy(&quot;Heiltrank&quot;).getGameObject()
+trank.setPosition([155.59, 6.75, 20.96]);
+trank.placeIntoScene();
+
+luftfels1 = $GOM.createGameObjectProxy(&quot;Fels&quot;).getGameObject()
+luftfels1.setPosition([105.51, 26.05, 40.35])
+luftfels2 = $GOM.createGameObjectProxy(&quot;Fels&quot;).getGameObject()
+luftfels2.setPosition([99.82, 21.37, 45.87])
+luftfels3 = $GOM.createGameObjectProxy(&quot;Fels&quot;).getGameObject()
+luftfels3.setPosition([94.43, 30.1, 44.11])
+
 $SCRIPT.log(&quot;Steinschlag: SteinschlagzoneListener erstellen&quot;);
 areaListener = SteinschlagzoneListener.new(luftfels1, luftfels2, luftfels3 );
 
-$felshaufen = RockPile.new([0.0, 0.0, 0.0], [[1.0, 0.0, 0.0], 0.0], [ 94.425087890625, 10.0978625488281, 44.10947265625 ])
+$felshaufen = $GOM.createGameObjectProxy(&quot;rockpile&quot;).getGameObject()
+$felshaufen.setPosition([94.43, 10.1, 44.11]);
+$felshaufen.placeIntoScene()
 $felshaufen.getActor().getPhysicalThing().setContactListener( 
 	RockpileContactListener.new($felshaufen, luftfels1, luftfels2, luftfels3) );
 
@@ -90,7 +114,7 @@
 
 
 $SCRIPT.log(&quot;Steinschlag: SteinschlagzoneListener hinzuf&#195;&#188;gen&quot;);
-$GameEveMgr.addSphereAreaListener( kugelDings, 4.000, areaListener, Actor::QGF_PLAYER );
+$GameEveMgr.addSphereAreaListener( kugelDings, 4.000, areaListener, RlScript::QUERYFLAG_PLAYER );
 
 $SCRIPT.log(&quot;map 'techdemo' initialisiert.&quot;);
 $WF.toggleCharacterStateWindow()

Deleted: modules/techdemo/scripts/maps/techdemo_bauer.rb
===================================================================
--- modules/techdemo/scripts/maps/techdemo_bauer.rb	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/techdemo/scripts/maps/techdemo_bauer.rb	2007-04-12 08:38:35 UTC (rev 3270)
@@ -1,10 +0,0 @@
-load( &quot;embed.rb&quot; );
-load( &quot;npc.rb&quot; );
-
-class BauerArnolfGrossschaedel &lt; Person
-  def initialize
-    super(&quot;Ein Bauer&quot;, &quot;Ein Bauer&quot;)
-    setActor($AM.createMeshActor(&quot;ArnolfGrossschaedel&quot;, &quot;men_wirt_posed.mesh&quot;, 4, 0.0))
-    addAction(TalkAction.new(&quot;Arnolf&quot;, &quot;bauer.xml&quot;))
-  end
-end
\ No newline at end of file

Modified: modules/techdemo/scripts/maps/techdemo_hoehle.rb
===================================================================
--- modules/techdemo/scripts/maps/techdemo_hoehle.rb	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/techdemo/scripts/maps/techdemo_hoehle.rb	2007-04-12 08:38:35 UTC (rev 3270)
@@ -3,9 +3,6 @@
 require &quot;heiltrank_tech.rb&quot;
 
 
-trank = Heiltrank.new( &quot;Trank&quot;, &quot;Eine Flasche mit einer geheimnisvollen Fluessigkeit&quot;, &quot;obj_heiltrank01.mesh&quot;, &quot;A&quot; );
-trank.getActor().placeIntoScene( 155.593017578125, 6.74539489746094, 20.964052734375, 1.0, 0.0, 0.0, 0.0 );
-
 class CaveDoorOpener &lt; ObjectStateChangeListener
 
   def initialize(door, switch)
@@ -46,28 +43,29 @@
 end
 
 class Torch &lt; Item
-  def initialize(name)
-    super(&quot;Fackel&quot;, &quot;Handelsuebliche Fackel zum Beleuchten der Umgebung&quot;);
-
-    torchActor = $AM.createMeshActor( name, &quot;ins_fackel_01.mesh&quot; );
-    $SCRIPT.log(&quot;actor erstellt.&quot;);
-
-    @fackellicht = $AM.createLightActor(&quot;Das Licht der Fackel&quot;, LightObject::LT_POINT );
-    @fackellicht.getControlledObject().setCastShadows(false);
-    @fackellicht.getControlledObject().setDiffuseColour(1.0,0.8,0.0);
-    @fackellicht.getControlledObject().setAttenuation(5.0, 0.1,  0.005, 0.0 );
-    
-    torchActor.attachToSlot( @fackellicht, &quot;SLOT_FAR_END&quot; );    
-    
-    setActor(torchActor);
-    $SCRIPT.log(&quot;actor gesetzt&quot;);
-    
-    setLit(false);
-    
-    addAction(UseTorchAction.new);
-    $SCRIPT.log(&quot;Aktion hinzugefuegt.&quot;);
+  def initialize(id)
+    super(id)
   end
   
+  def placeIntoScene()
+    super()
+    if (@fackellicht == nil)
+      @fackellicht = $AM.createLightActor(&quot;Das Licht der Fackel&quot;, LightObject::LT_POINT );
+      @fackellicht.getControlledObject().setCastShadows(false);
+      @fackellicht.getControlledObject().setDiffuseColour(1.0,0.8,0.0);
+      @fackellicht.getControlledObject().setAttenuation(5.0, 0.1,  0.005, 0.0 );
+      
+      getActor().attachToSlot( @fackellicht, &quot;SLOT_FAR_END&quot; );    
+      
+      $SCRIPT.log(&quot;actor gesetzt&quot;);
+      
+      setLit(false);
+      
+      addAction(UseTorchAction.new);
+      $SCRIPT.log(&quot;Aktion hinzugefuegt.&quot;);
+    end
+  end
+  
   def setLit(lit)
     @fackellicht.setVisible(lit)
     @lit = lit;

Modified: modules/techdemo/scripts/maps/techdemo_hoehle_eingang.rb
===================================================================
--- modules/techdemo/scripts/maps/techdemo_hoehle_eingang.rb	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/techdemo/scripts/maps/techdemo_hoehle_eingang.rb	2007-04-12 08:38:35 UTC (rev 3270)
@@ -1,29 +1,8 @@
 class Rock &lt; GameObject
-  def initialize(name, model, position, orientation, spawned)
-    super(name, &quot;Ein Fels&quot;)
-    @mPosition = position
-    @mOrientation = orientation
-    @mModel = model
-    @mSpawned = false
-
-    if (spawned)
-      spawn()
-    end
+  def initialize(id)
+    super(id)
   end
 
-  def spawn
-    if ( ! @mSpawned )
-      rockActor = $AM.createMeshActor( getName(), @mModel, PhysicsManager::GT_ELLIPSOID, 3000.0)
-      rockActor.getPhysicalThing().setGravityOverride(true)
-      setActor(rockActor)
-
-      rockActor.placeIntoScene(@mPosition, @mOrientation)
-
-      @mSpawned = true
-      setHighlightingEnabled(false)
-    end
-  end
-
   def setGravityState(active)
     if (active)
       getActor().getPhysicalThing().setGravityOverride(true, 0.0, -98.800, 0.0)
@@ -34,7 +13,7 @@
   end
 
   def startFalling()
-	setGravityState(true)
+	  setGravityState(true)
   end
 end
 
@@ -61,26 +40,20 @@
 
 
 class RockPile &lt; GameObject
-  def initialize(positionPile, orientation, positionParticles)
-    super(&quot;Steinhaufen&quot;, &quot;Ein gro&#195;&#159;er Steinhaufen&quot;)
 
-    @mRockPile = $AM.createMeshActor(&quot;Steinhaufen&quot;, &quot;Steinhaufen.mesh&quot;, PhysicsManager::GT_CONVEXHULL, 0.0)
-    @mRockPile.getPhysicalThing().setGravityOverride(true, 0.0, 0.0, 0.0)
-    @mRockPile.placeIntoScene(positionPile, orientation)
+  def placeIntoScene()
+    super()
 
-    @mPositionPart = positionParticles;
     @mSteinSchlagSound = $AM.createSoundSampleActor(&quot;SteinSchlagSound&quot;,&quot;steinschlag_wenig_zu_vielen.ogg&quot;);
     @mSteinSchlagSound.getControlledObject().load();
-    @mSteinSchlagSound.placeIntoScene( 	positionParticles[0], positionParticles[1], positionParticles[2], 1.0, 0.0, 0.0, 0.0 );
+    @mSteinSchlagSound.placeIntoScene( 	getPosition(), [1.0, 0.0, 0.0, 0.0] );
 
-    setActor(@mRockPile)
-    setHighlightingEnabled(false)
   end
 
   def collapse()
     @mDustCloud = $AM.createParticleSystemActor(&quot;Steinstaubwolke&quot;, &quot;Techdemo/Steinstaubwolke&quot;)
     @mSteinSchlagSound.getControlledObject().play();
-    @mDustCloud.placeIntoScene(@mPositionPart);
+    @mDustCloud.placeIntoScene(getPosition());
     @mDustCloud.getControlledObject().setActive(true)
 
     fallAnim = getActor().getControlledObject().startAnimation(&quot;Zusammenfallen&quot;, 0.5, 1);  

Modified: modules/techdemo/scripts/maps/techdemo_spinne.rb
===================================================================
--- modules/techdemo/scripts/maps/techdemo_spinne.rb	2007-04-12 01:09:16 UTC (rev 3269)
+++ modules/techdemo/scripts/maps/techdemo_spinne.rb	2007-04-12 08:38:35 UTC (rev 3270)
@@ -32,21 +32,26 @@
 
 
 class Waldspinne &lt; Creature
-    def initialize
-	super(&quot;Waldspinne&quot;, &quot;Eine gro&#195;&#159;e Spinne, die sich anscheinend vor irgendetwas &#195;&#164;ngstigt.&quot;)
-	actor = $AM.createMeshActor(&quot;Waldspinne&quot;, &quot;tie_waldspinne.mesh&quot;, PhysicsManager::GT_SPHERE, 0.0)
-	setActor(actor)
-	getActor().placeIntoScene(-20.400, 3.430, -82.000, 1.0, 0.0, 0.0, 0.0)	
-	getActor().setScale(5.0, 5.0, 5.0)
-	@mScareAction = ScareToDeathAction.new()
-	addAction(@mScareAction)
-	@mErschreckenSound = $AM.createSoundSampleActor(&quot;ErschreckenSound&quot;,&quot;erschrecken_buh_01.ogg&quot;);
+    def initialize(id)
+		super(id)
+		@mScareAction = ScareToDeathAction.new()
+		addAction(@mScareAction)
+    end
+    
+
+  def initSounds()    
+   	@mErschreckenSound = $AM.createSoundSampleActor(&quot;ErschreckenSound&quot;,&quot;erschrecken_buh_01.ogg&quot;);
 	getActor().attach(@mErschreckenSound);
 	@mSpinnenTodSound = $AM.createSoundSampleActor(&quot;SpinnenTotSound&quot;,&quot;spinne_todesschrei_01.ogg&quot;);
 	getActor().attach(@mSpinnenTodSound);
-    end
+  end
+  
 
   def getScared(player)
+    if (@mErschreckenSound == nil)
+      initSounds()
+    end
+  
 	#Player erschreckt die Spinne
 	@mErschreckenSound.getControlledObject().play();
 	

Modified: rl/trunk/engine/core/include/GameAreaTypes.h
===================================================================
--- rl/trunk/engine/core/include/GameAreaTypes.h	2007-04-12 01:09:16 UTC (rev 3269)
+++ rl/trunk/engine/core/include/GameAreaTypes.h	2007-04-12 08:38:35 UTC (rev 3270)
@@ -17,11 +17,17 @@
 #ifndef __GameAreaTypes_H__
 #define __GameAreaTypes_H__
 
-#include &quot;Actor.h&quot;
 #include &quot;CorePrerequisites.h&quot;
 
+#include &lt;OgreNewt_ContactCallback.h&gt;
+
+#include &quot;Actor.h&quot;
+
 namespace rl {
 
+	class MeshObject;
+	class PhysicalThing;
+
 /** GameAreaType
  * Verwaltet verschiedene Flaechenarten und Methoden die Aktoren innerhalb dieser Fl&#228;chen zu
  * sammeln. Dabei lassen sich die gefundenen Aktoren &#252;ber Masken beschr&#228;nken.
@@ -56,7 +62,6 @@
     //virtual setShowDebug() = 0;
     /// Gibt zur&#252;ck ob ein Debug-Objekt eingeblendet ist
     //virtual bool getShowDebug() const = 0;
-private:
 };
 
 /** GameSphereAreaType
@@ -92,6 +97,30 @@
     Ogre::SphereSceneQuery* mSphereQuery;
 };
 
+//class _RlCoreExport GameMeshAreaType : public GameAreaType
+//{
+//public:
+//	GameMeshAreaType(MeshObject* mo, PhysicalThing* testObj); ///@todo allow character change
+//	virtual ~GameMeshAreaType();
+//
+//	virtual ActorMap performQuery();
+//
+//	/// Setzt die genaue Position der Anfrage
+//    virtual void setQueryPosition( const Ogre::Vector3&amp; vec );
+//    /// Gibt die Position der Anfrage zur&#252;ck
+//    virtual const Ogre::Vector3&amp; getQueryPosition() const;   
+//
+//	/// Gibt die Anfrage-Maske zur&#252;ck, wird in Unterklassen implementiert
+//	virtual unsigned long getQueryMask() const { return 0xFFFFFFFF; }
+//    /// Setzt die Anfrage-Maske, wird in Unterklassen implementiert
+//	virtual void setQueryMask( unsigned long mask = 0xFFFFFFFF ) {}
+//
+//private:
+//	OgreNewt::CollisionPtr mCollision;
+//	PhysicalThing* mTestObj;
+//	Ogre::Vector3 mPosition;
+//};
+
 }
 
 #endif

Modified: rl/trunk/engine/core/include/GameEventManager.h
===================================================================
--- rl/trunk/engine/core/include/GameEventManager.h	2007-04-12 01:09:16 UTC (rev 3269)
+++ rl/trunk/engine/core/include/GameEventManager.h	2007-04-12 08:38:35 UTC (rev 3270)
@@ -28,6 +28,8 @@
 
 namespace rl {
 
+class PhysicalThing;
+
 typedef std::set&lt;GameAreaEventSource*&gt; GameAreaEventSourceList;
 
 /** GameEventManager
@@ -60,6 +62,8 @@
     void addSphereAreaListener( Actor* actor, Ogre::Real radius,
         GameAreaListener* list, unsigned long queryMask = 0xFFFFFFFF );
 
+	void addMeshAreaListener( Actor* meshactor, GameAreaListener* list, PhysicalThing* testObj );
+
     /** Entfernt an allen Areas diesen Listener
     *
     * @param list Der Listener an den GameAreaEventSource

Modified: rl/trunk/engine/script/swig/RlCore.swig
===================================================================
--- rl/trunk/engine/script/swig/RlCore.swig	2007-04-12 01:09:16 UTC (rev 3269)
+++ rl/trunk/engine/script/swig/RlCore.swig	2007-04-12 08:38:35 UTC (rev 3270)
@@ -226,6 +226,8 @@
 public:
     void addSphereAreaListener( rl::Actor* actor, Ogre::Real radius, 
 		rl::GameAreaListener* list, unsigned long queryMask = 0xFFFFFFFF );
+	//void addMeshAreaListener( rl::Actor* meshactor, rl::GameAreaListener* list, rl::PhysicalThing* testObj );
+	
     void removeAreaListener( rl::GameAreaListener* list );
     void removeAllAreas( rl::Actor* actor );
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000340.html">[Dsa-hl-svn] r3269 - in modules: common/scripts/effects	regressiontest/scripts
</A></li>
	<LI>Next message: <A HREF="000342.html">[Dsa-hl-svn] r3271 - modules/techdemo2/scripts/maps
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#341">[ date ]</a>
              <a href="thread.html#341">[ thread ]</a>
              <a href="subject.html#341">[ subject ]</a>
              <a href="author.html#341">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
