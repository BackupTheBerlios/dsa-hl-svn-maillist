<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3327 - modules/regressiontest/maps	modules/regressiontest/materials modules/regressiontest/scripts	modules/regressiontest/scripts/maps modules/techdemo/maps	modules/techdemo/scripts modules/techdemo/scripts/maps	rl/trunk/docs/documents rl/trunk/engine/rules/include	rl/trunk/engine/rules/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3327%20-%20modules/regressiontest/maps%0A%09modules/regressiontest/materials%20modules/regressiontest/scripts%0A%09modules/regressiontest/scripts/maps%20modules/techdemo/maps%0A%09modules/techdemo/scripts%20modules/techdemo/scripts/maps%0A%09rl/trunk/docs/documents%20rl/trunk/engine/rules/include%0A%09rl/trunk/engine/rules/src&In-Reply-To=%3C200704201242.l3KCgdnI017455%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000397.html">
   <LINK REL="Next"  HREF="000399.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3327 - modules/regressiontest/maps	modules/regressiontest/materials modules/regressiontest/scripts	modules/regressiontest/scripts/maps modules/techdemo/maps	modules/techdemo/scripts modules/techdemo/scripts/maps	rl/trunk/docs/documents rl/trunk/engine/rules/include	rl/trunk/engine/rules/src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3327%20-%20modules/regressiontest/maps%0A%09modules/regressiontest/materials%20modules/regressiontest/scripts%0A%09modules/regressiontest/scripts/maps%20modules/techdemo/maps%0A%09modules/techdemo/scripts%20modules/techdemo/scripts/maps%0A%09rl/trunk/docs/documents%20rl/trunk/engine/rules/include%0A%09rl/trunk/engine/rules/src&In-Reply-To=%3C200704201242.l3KCgdnI017455%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3327 - modules/regressiontest/maps	modules/regressiontest/materials modules/regressiontest/scripts	modules/regressiontest/scripts/maps modules/techdemo/maps	modules/techdemo/scripts modules/techdemo/scripts/maps	rl/trunk/docs/documents rl/trunk/engine/rules/include	rl/trunk/engine/rules/src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Fri Apr 20 14:42:39 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000397.html">[Dsa-hl-svn] r3326 - in rl/trunk/engine/core: include src
</A></li>
        <LI>Next message: <A HREF="000399.html">[Dsa-hl-svn] r3328 - in rl/trunk/engine: core/src script/swig	ui/include ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#398">[ date ]</a>
              <a href="thread.html#398">[ thread ]</a>
              <a href="subject.html#398">[ subject ]</a>
              <a href="author.html#398">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2007-04-20 14:42:29 +0200 (Fri, 20 Apr 2007)
New Revision: 3327

Added:
   modules/regressiontest/maps/regressiontest_lights.rlmap.xml
   modules/regressiontest/scripts/MapLoadingTest.rb
   modules/techdemo/maps/techdemo_lights.rlmap.xml
Modified:
   modules/regressiontest/materials/nx.grid.material
   modules/regressiontest/scripts/maps/regressiontest.rb
   modules/techdemo/scripts/maps/techdemo.rb
   modules/techdemo/scripts/moduleconfig.rb
   rl/trunk/docs/documents/scene_format_proposal.xml
   rl/trunk/engine/rules/include/MapLoader.h
   rl/trunk/engine/rules/src/MapLoader.cpp
Log:
MapLoader: added support for lights in scene file

Added: modules/regressiontest/maps/regressiontest_lights.rlmap.xml
===================================================================
--- modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-04-20 12:40:30 UTC (rev 3326)
+++ modules/regressiontest/maps/regressiontest_lights.rlmap.xml	2007-04-20 12:42:29 UTC (rev 3327)
@@ -0,0 +1,40 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
+&lt;rastullahmap formatVersion=&quot;0.4.0&quot;&gt;
+	&lt;nodes&gt;
+		&lt;node&gt;
+			&lt;position x=&quot;-10.0&quot; y=&quot;1&quot; z=&quot;-5.0&quot;/&gt;
+      &lt;light name=&quot;light1&quot; type=&quot;point&quot; visible=&quot;true&quot; castShadows=&quot;false&quot;&gt;
+        &lt;colourDiffuse r=&quot;1&quot; g=&quot;0&quot; b=&quot;0&quot; /&gt;
+				&lt;colourSpecular r=&quot;1&quot; g=&quot;0&quot; b=&quot;0&quot; /&gt;
+				&lt;lightAttenuation
+					range=&quot;5.0&quot;
+					constant=&quot;1.0&quot;
+					linear=&quot;0.0&quot;
+					quadratic=&quot;0.0&quot;
+				/&gt;
+      &lt;/light&gt;
+		&lt;/node&gt;
+		&lt;node&gt;
+			&lt;position x=&quot;-12.0&quot; y=&quot;1&quot; z=&quot;-5.0&quot;/&gt;
+      &lt;light name=&quot;light2&quot; type=&quot;spot&quot; visible=&quot;true&quot; castShadows=&quot;false&quot;&gt;
+        &lt;colourDiffuse r=&quot;0&quot; g=&quot;1&quot; b=&quot;0&quot; /&gt;
+				&lt;colourSpecular r=&quot;0&quot; g=&quot;1&quot; b=&quot;0&quot; /&gt;
+				&lt;lightAttenuation
+					range=&quot;10.0&quot;
+					constant=&quot;1.0&quot;
+					linear=&quot;0.0&quot;
+					quadratic=&quot;0.0&quot;
+				/&gt;
+				&lt;spotlightrange inner=&quot;10&quot; outer=&quot;20&quot; falloff=&quot;1&quot; /&gt;
+				&lt;direction x=&quot;0&quot; y=&quot;-1&quot; z=&quot;0.5&quot; /&gt;
+      &lt;/light&gt;
+		&lt;/node&gt;
+&lt;!--		&lt;node&gt;
+      &lt;light name=&quot;light3&quot; type=&quot;directional&quot; visible=&quot;true&quot; castShadows=&quot;false&quot;&gt;
+        &lt;colourDiffuse r=&quot;0&quot; g=&quot;0&quot; b=&quot;1&quot; /&gt;
+				&lt;colourSpecular r=&quot;0&quot; g=&quot;0&quot; b=&quot;1&quot; /&gt;
+				&lt;direction x=&quot;1&quot; y=&quot;-1&quot; z=&quot;0&quot; /&gt;
+      &lt;/light&gt;
+		&lt;/node&gt;--&gt;
+	&lt;/nodes&gt;
+&lt;/rastullahmap&gt;

Modified: modules/regressiontest/materials/nx.grid.material
===================================================================
--- modules/regressiontest/materials/nx.grid.material	2007-04-20 12:40:30 UTC (rev 3326)
+++ modules/regressiontest/materials/nx.grid.material	2007-04-20 12:42:29 UTC (rev 3327)
@@ -4,7 +4,7 @@
     {
         pass
         {
-            lighting off
+            //lighting off
             
             texture_unit
             {

Added: modules/regressiontest/scripts/MapLoadingTest.rb
===================================================================
--- modules/regressiontest/scripts/MapLoadingTest.rb	2007-04-20 12:40:30 UTC (rev 3326)
+++ modules/regressiontest/scripts/MapLoadingTest.rb	2007-04-20 12:42:29 UTC (rev 3327)
@@ -0,0 +1,9 @@
+require 'testcase.rb'
+
+class MapLoadingTest &lt; TestCase
+    def initialize(center)
+        super(center)
+
+        MapLoader.new().loadMap(&quot;regressiontest_lights.rlmap.xml&quot;, &quot;regressiontest&quot;);
+    end
+end

Modified: modules/regressiontest/scripts/maps/regressiontest.rb
===================================================================
--- modules/regressiontest/scripts/maps/regressiontest.rb	2007-04-20 12:40:30 UTC (rev 3326)
+++ modules/regressiontest/scripts/maps/regressiontest.rb	2007-04-20 12:42:29 UTC (rev 3327)
@@ -13,7 +13,8 @@
 require 'JobSequenceTest.rb'
 require 'SoundTest.rb'
 require 'effecttest.rb'
-require 'LightzoneTest.rb'
+#require 'LightzoneTest.rb'
+require 'MapLoadingTest.rb'
 
 # Physik aktivieren
 $PM.setEnabled(true)
@@ -49,7 +50,8 @@
 JobSequenceTest.new([5, 0, -5])
 EffectTest.new([5, 0, 5])
 SoundTest.new([10, 0, 10])
-LightzoneTest.new([20, 0, 0])
+#LightzoneTest.new([20, 0, 0])
+MapLoadingTest.new([-10, 0, -5])
 
 
 $SCRIPT.log(&quot;tests initialisiert.&quot;);

Added: modules/techdemo/maps/techdemo_lights.rlmap.xml
===================================================================
--- modules/techdemo/maps/techdemo_lights.rlmap.xml	2007-04-20 12:40:30 UTC (rev 3326)
+++ modules/techdemo/maps/techdemo_lights.rlmap.xml	2007-04-20 12:42:29 UTC (rev 3327)
@@ -0,0 +1,40 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
+&lt;rastullahmap formatVersion=&quot;0.4.0&quot;&gt;
+	&lt;nodes&gt;
+		&lt;node&gt;
+			&lt;position x=&quot;29.9182&quot; y=&quot;2&quot; z=&quot;9.590&quot;/&gt;
+      &lt;light name=&quot;light1&quot; type=&quot;point&quot; visible=&quot;true&quot; castShadows=&quot;false&quot;&gt;
+        &lt;colourDiffuse r=&quot;1&quot; g=&quot;0&quot; b=&quot;0&quot; /&gt;
+				&lt;colourSpecular r=&quot;1&quot; g=&quot;0&quot; b=&quot;0&quot; /&gt;
+				&lt;lightAttenuation
+					range=&quot;2.0&quot;
+					constant=&quot;1.0&quot;
+					linear=&quot;0.0&quot;
+					quadratic=&quot;0.0&quot;
+				/&gt;
+      &lt;/light&gt;
+		&lt;/node&gt;
+		&lt;node&gt;
+			&lt;position x=&quot;15.9182&quot; y=&quot;2&quot; z=&quot;9.590&quot;/&gt;
+      &lt;light name=&quot;light2&quot; type=&quot;spot&quot; visible=&quot;true&quot; castShadows=&quot;false&quot;&gt;
+        &lt;colourDiffuse r=&quot;0&quot; g=&quot;1&quot; b=&quot;0&quot; /&gt;
+				&lt;colourSpecular r=&quot;0&quot; g=&quot;1&quot; b=&quot;0&quot; /&gt;
+				&lt;lightAttenuation
+					range=&quot;20.0&quot;
+					constant=&quot;1.0&quot;
+					linear=&quot;0.0&quot;
+					quadratic=&quot;0.0&quot;
+				/&gt;
+				&lt;spotlightrange inner=&quot;20&quot; outer=&quot;40&quot; falloff=&quot;0.5&quot; /&gt;
+				&lt;direction x=&quot;0&quot; y=&quot;-1&quot; z=&quot;0.5&quot; /&gt;
+      &lt;/light&gt;
+		&lt;/node&gt;
+		&lt;node&gt;
+      &lt;light name=&quot;light3&quot; type=&quot;directional&quot; visible=&quot;true&quot; castShadows=&quot;false&quot;&gt;
+        &lt;colourDiffuse r=&quot;0&quot; g=&quot;0&quot; b=&quot;1&quot; /&gt;
+				&lt;colourSpecular r=&quot;0&quot; g=&quot;0&quot; b=&quot;1&quot; /&gt;
+				&lt;direction x=&quot;1&quot; y=&quot;-1&quot; z=&quot;0&quot; /&gt;
+      &lt;/light&gt;
+		&lt;/node&gt;
+	&lt;/nodes&gt;
+&lt;/rastullahmap&gt;

Modified: modules/techdemo/scripts/maps/techdemo.rb
===================================================================
--- modules/techdemo/scripts/maps/techdemo.rb	2007-04-20 12:40:30 UTC (rev 3326)
+++ modules/techdemo/scripts/maps/techdemo.rb	2007-04-20 12:42:29 UTC (rev 3327)
@@ -9,10 +9,10 @@
 $SCRIPT.log(&quot;skybox set&quot;);
 
 $SCRIPT.log(&quot;Tageslicht erstellen..&quot;);
-sunlight = $AM.createLightActor(&quot;sunlight&quot;, LightObject::LT_DIRECTIONAL);
-sunlight.getControlledObject().setDirection(0.7, -2.0, 0.8);
+#sunlight = $AM.createLightActor(&quot;sunlight&quot;, LightObject::LT_DIRECTIONAL);
+#sunlight.getControlledObject().setDirection(0.7, -2.0, 0.8);
 #sunlight.getControlledObject().setCastShadows(false);
-sunlight.getControlledObject().setDiffuseColour(1,1,1);
+#sunlight.getControlledObject().setDiffuseColour(1,1,1);
 # sunlight.getControlledObject().setDiffuseColour(0.8,0.8,0.7);
 $SCRIPT.log(&quot;Tageslicht erstellt.&quot;);
 

Modified: modules/techdemo/scripts/moduleconfig.rb
===================================================================
--- modules/techdemo/scripts/moduleconfig.rb	2007-04-20 12:40:30 UTC (rev 3326)
+++ modules/techdemo/scripts/moduleconfig.rb	2007-04-20 12:42:29 UTC (rev 3327)
@@ -37,6 +37,7 @@
         p &quot;Loading map with MapLoader&quot;
         # MapLoader.new().loadMap(&quot;techdemo_terrain.rlmap.xml&quot;, &quot;techdemo&quot;);
         MapLoader.new().loadMap(&quot;techdemo_gameobjects.rlmap.xml&quot;, &quot;techdemo&quot;);
+        MapLoader.new().loadMap(&quot;techdemo_lights.rlmap.xml&quot;, &quot;techdemo&quot;);
         p &quot;Done loading map&quot;
         
         load &quot;techdemo.rb&quot;

Modified: rl/trunk/docs/documents/scene_format_proposal.xml
===================================================================
--- rl/trunk/docs/documents/scene_format_proposal.xml	2007-04-20 12:40:30 UTC (rev 3326)
+++ rl/trunk/docs/documents/scene_format_proposal.xml	2007-04-20 12:42:29 UTC (rev 3327)
@@ -29,7 +29,7 @@
 			/&gt;
       
       &lt;!-- Definition der Physikproxies --&gt;
-	    &lt;collisions&gt;
+	    &lt;collisions type=&quot;custom&quot;&gt;
 	       &lt;!-- collision proxy consists of a box and a sphere --&gt;
 	       &lt;collision type=&quot;box&quot;&gt;
 	          &lt;scale x=&quot;-97.544470&quot; y=&quot;127.113457&quot; z=&quot;748.685760&quot;/&gt;
@@ -46,14 +46,12 @@
     &lt;!-- Light --&gt;
     &lt;node name=&quot;Omni02&quot;&gt;
 			&lt;position x=&quot;-196.095&quot; y=&quot;-90.1458&quot; z=&quot;563.122&quot; /&gt;
-			&lt;rotation qx=&quot;0.0&quot; qy=&quot;0.0&quot; qz=&quot;0.0&quot; qw=&quot;1.0&quot; /&gt;
 
 			&lt;light
 				name=&quot;Omni02&quot;
-				type=&quot;point&quot;
+				type=&quot;point&quot; 
 				visible=&quot;true&quot; 
-				castShadows=&quot;false&quot; &gt;
-				&lt;position x=&quot;0.0&quot; y=&quot;0.0&quot; z=&quot;0.0&quot; /&gt;
+				castShadows=&quot;false&quot; &gt; &lt;!-- type is point|spot|directional --&gt;
 				&lt;colourDiffuse r=&quot;0.3&quot; g=&quot;0.3&quot; b=&quot;0.3&quot; /&gt;
 				&lt;colourSpecular r=&quot;0.3&quot; g=&quot;0.3&quot; b=&quot;0.3&quot; /&gt;
 				&lt;lightAttenuation
@@ -62,7 +60,13 @@
 					linear=&quot;0.0&quot;
 					quadratic=&quot;0.0&quot;
 				/&gt;
-				&lt;!-- Spot und Directional--&gt;
+				
+				&lt;!-- nur bei type=&quot;spot&quot; --&gt;
+				&lt;spotlightrange inner=&quot;10&quot; outer=&quot;20&quot; falloff=&quot;1&quot; /&gt;
+				&lt;direction x=&quot;0&quot; y=&quot;-1&quot; z=&quot;0.5&quot; /&gt;
+				
+				&lt;!-- nur bei type=&quot;directional&quot; --&gt;
+				&lt;direction x=&quot;0&quot; y=&quot;-1&quot; z=&quot;0.5&quot; /&gt;
 			&lt;/light&gt;
 		&lt;/node&gt;
 		

Modified: rl/trunk/engine/rules/include/MapLoader.h
===================================================================
--- rl/trunk/engine/rules/include/MapLoader.h	2007-04-20 12:40:30 UTC (rev 3326)
+++ rl/trunk/engine/rules/include/MapLoader.h	2007-04-20 12:42:29 UTC (rev 3327)
@@ -53,7 +53,8 @@
         void processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects);
         Ogre::Vector3 processVector3(XERCES_CPP_NAMESPACE::DOMElement* nodeElem) const;
         Ogre::Quaternion processQuaternion(XERCES_CPP_NAMESPACE::DOMElement* nodeElem) const;
-
+        Ogre::ColourValue processColour(XERCES_CPP_NAMESPACE::DOMElement* colElem) const;
+        
         void createGameObject(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, XERCES_CPP_NAMESPACE::DOMElement* gameobjElem) const;
         void createSound(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, XERCES_CPP_NAMESPACE::DOMElement* gameobjElem) const;
         void createLight(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, XERCES_CPP_NAMESPACE::DOMElement* gameobjElem) const;

Modified: rl/trunk/engine/rules/src/MapLoader.cpp
===================================================================
--- rl/trunk/engine/rules/src/MapLoader.cpp	2007-04-20 12:40:30 UTC (rev 3326)
+++ rl/trunk/engine/rules/src/MapLoader.cpp	2007-04-20 12:42:29 UTC (rev 3327)
@@ -286,6 +286,7 @@
             LOG_WARNING(Logger::RULES, &quot;No orientation given for entity, used Identity&quot;);
         }
 
+        ///@todo static geometry groups
         SceneNode* parentNode = mSceneNode-&gt;createChildSceneNode(entName, position, orientation);
 
         ResourceGroupManager&amp; resGroupMgr = ResourceGroupManager::getSingleton();
@@ -322,7 +323,7 @@
         }
     }
 
-    void MapLoader::createSound(DOMElement* nodeElem, DOMElement* gameobjElem) const
+    void MapLoader::createSound(DOMElement* nodeElem, DOMElement* soundElem) const
     {
         LOG_DEBUG(Logger::RULES, 
             &quot;Processing sound node &quot; 
@@ -331,12 +332,113 @@
         ///@todo create sound
     }
 
-    void MapLoader::createLight(DOMElement* nodeElem, DOMElement* gameobjElem) const
+    void MapLoader::createLight(DOMElement* nodeElem, DOMElement* lightElem) const
     {
         LOG_DEBUG(Logger::RULES, 
             &quot;Processing light node &quot; 
                 + XmlHelper::getAttributeValueAsStdString(nodeElem, &quot;name&quot;));
+                
+        Ogre::String name = XmlHelper::getAttributeValueAsStdString(lightElem, &quot;name&quot;);
+        Ogre::String stype = XmlHelper::getAttributeValueAsStdString(lightElem, &quot;type&quot;);
+        bool visible = XmlHelper::getAttributeValueAsBool(lightElem, &quot;visible&quot;);
+        bool shadowCaster = XmlHelper::getAttributeValueAsBool(lightElem, &quot;castShadows&quot;);
         
+        LightObject::LightTypes type = LightObject::LT_DIRECTIONAL;
+        if (stype == &quot;point&quot;)
+        {
+            type = LightObject::LT_POINT;
+        }
+        else if (stype == &quot;directional&quot;)
+        {
+            type = LightObject::LT_DIRECTIONAL;
+        }
+        else if (stype == &quot;spot&quot;)
+        {
+            type = LightObject::LT_SPOTLIGHT;
+        }
+        else
+        {
+            LOG_ERROR(Logger::RULES, &quot;Could not create light.&quot;);
+            return;
+        }
+        Actor* lightActor = ActorManager::getSingleton().createLightActor(name, type);
+
+        DOMElement* posElem = XmlHelper::getChildNamed(nodeElem, &quot;position&quot;);
+        if (posElem != NULL)
+        {
+            lightActor-&gt;placeIntoScene(processVector3(posElem));
+        }
+        else
+        {
+            lightActor-&gt;placeIntoScene(Vector3::ZERO);
+        }
+
+        LightObject* light = static_cast&lt;LightObject*&gt;(lightActor-&gt;getControlledObject());
+
+        light-&gt;setCastShadows(shadowCaster);
+        light-&gt;setVisible(visible);
+        
+        DOMElement* diffElem = XmlHelper::getChildNamed(lightElem, &quot;colourDiffuse&quot;);
+        if (diffElem != NULL)
+        {
+            light-&gt;setDiffuseColour(processColour(diffElem));
+        }
+        
+        DOMElement* specElem = XmlHelper::getChildNamed(lightElem, &quot;colourSpecular&quot;);
+        if (specElem != NULL)
+        {
+            light-&gt;setSpecularColour(processColour(specElem));
+        }
+
+        DOMElement* attElem = XmlHelper::getChildNamed(lightElem, &quot;lightAttenuation&quot;);
+        if (attElem != NULL)
+        {
+            if (XmlHelper::hasAttribute(attElem, &quot;range&quot;)
+                &amp;&amp; XmlHelper::hasAttribute(attElem, &quot;constant&quot;)
+                &amp;&amp; XmlHelper::hasAttribute(attElem, &quot;linear&quot;) 
+                &amp;&amp; XmlHelper::hasAttribute(attElem, &quot;quadratic&quot;))
+            {
+                Ogre::Real range = XmlHelper::getAttributeValueAsReal(attElem, &quot;range&quot;);
+                Ogre::Real constant = XmlHelper::getAttributeValueAsReal(attElem, &quot;constant&quot;);
+                Ogre::Real linear = XmlHelper::getAttributeValueAsReal(attElem, &quot;linear&quot;);
+                Ogre::Real quadratic = XmlHelper::getAttributeValueAsReal(attElem, &quot;quadratic&quot;);
+
+                light-&gt;setAttenuation(range, constant, linear, quadratic);
+            }
+        }
+        ///@todo default attenuation?
+
+        if (stype == &quot;directional&quot;)
+        {
+            DOMElement* dirElem = XmlHelper::getChildNamed(lightElem, &quot;direction&quot;);
+            if (dirElem != NULL)
+            {
+                light-&gt;setDirection(processVector3(dirElem));
+            }
+            else
+            {
+                light-&gt;setDirection(Vector3::NEGATIVE_UNIT_Y);
+            }
+        }
+        else if (stype == &quot;spot&quot;)
+        {
+            DOMElement* rangeElem = XmlHelper::getChildNamed(lightElem, &quot;spotlightrange&quot;);
+            if (rangeElem != NULL)
+            {
+                Ogre::Real innerAngle = XmlHelper::getAttributeValueAsReal(rangeElem, &quot;inner&quot;);
+                Ogre::Real outerAngle = XmlHelper::getAttributeValueAsReal(rangeElem, &quot;outer&quot;);
+                if (XmlHelper::hasAttribute(rangeElem, &quot;falloff&quot;))
+                {
+                    light-&gt;setSpotlightRange(
+                        innerAngle, outerAngle, XmlHelper::getAttributeValueAsReal(rangeElem, &quot;falloff&quot;));
+                }
+                else
+                {
+                    light-&gt;setSpotlightRange(innerAngle, outerAngle);
+                }
+            }
+        }
+
         ///@todo create light
     }
 
@@ -387,10 +489,35 @@
 
         return rval;
     }
+    
+    ColourValue MapLoader::processColour(DOMElement* colElem) const
+    {
+        ColourValue rval(1, 1, 1, 1);
+        if (colElem != NULL)
+        {
+            if (XmlHelper::hasAttribute(colElem, &quot;r&quot;))
+            {
+                rval.r = XmlHelper::getAttributeValueAsReal(colElem, &quot;r&quot;);
+            }
+            if (XmlHelper::hasAttribute(colElem, &quot;g&quot;))
+            {
+                rval.g = XmlHelper::getAttributeValueAsReal(colElem, &quot;g&quot;);
+            }
+            if (XmlHelper::hasAttribute(colElem, &quot;b&quot;))
+            {
+                rval.b = XmlHelper::getAttributeValueAsReal(colElem, &quot;b&quot;);
+            }
+            if (XmlHelper::hasAttribute(colElem, &quot;a&quot;))
+            {
+                rval.a = XmlHelper::getAttributeValueAsReal(colElem, &quot;a&quot;);
+            }
+        }
+        return rval;
+    }
 
 	//void MapLoader::createCollision()
 	//{
- //       // ------- Falls n&#246;tig automatisch bodyproxy erstellen -------------
+ //       // ------- Falls n&#195;&#182;tig automatisch bodyproxy erstellen -------------
  //       // (wenn physical_body gesetzt wurde)
  //       OgreNewt::CollisionPtr collision = OgreNewt::CollisionPtr();
  //       OgreNewt::World *thisWorld = PhysicsManager::getSingleton()._getNewtonWorld();
@@ -413,21 +540,21 @@
  //               if (size.z &lt; PhysicsManager::NEWTON_GRID_WIDTH)
  //                   size.z = PhysicsManager::NEWTON_GRID_WIDTH;
 
- //               LOG_MESSAGE(Logger::CORE, &quot; Die Entity '&quot;+entName+&quot;' liegt in einer Ebene, verwende 'box' f&#252;r physical_body '&quot;+physical_body+&quot;' &quot;);
+ //               LOG_MESSAGE(Logger::CORE, &quot; Die Entity '&quot;+entName+&quot;' liegt in einer Ebene, verwende 'box' f&#195;&#188;r physical_body '&quot;+physical_body+&quot;' &quot;);
  //               forceBox = true;
  //           }
  //           const Quaternion orientation(0,0,0,0);// = parentNode-&gt;getOrientation();
  //           const Ogre::Vector3 pos = aab.getMinimum()* parentNode-&gt;getScale() + (size/2.0);
 
 
- //           // Pr&#252;fen, ob schon ein identischer Proxy erstellt wurde um diesen erneut zu verwenden
+ //           // Pr&#195;&#188;fen, ob schon ein identischer Proxy erstellt wurde um diesen erneut zu verwenden
  //           AlreadyUsedCollision &amp;aucol (mAutoCreatedCollisions[meshName]);
  //           if (aucol.Type.compare(physical_body) == 0  &amp;&amp;
  //               aucol.Scale == parentNode-&gt;getScale() &amp;&amp;
  //               (!forceBox)) // sicherheitshalber
  //           {
  //               collision = aucol.ColPtr;
- //               LOG_DEBUG(Logger::CORE, &quot; Schon fr&#252;her erstellten physical_body f&#252;r Entity '&quot;+entName+&quot;' wieder verwendet. &quot;);
+ //               LOG_DEBUG(Logger::CORE, &quot; Schon fr&#195;&#188;her erstellten physical_body f&#195;&#188;r Entity '&quot;+entName+&quot;' wieder verwendet. &quot;);
  //           }
  //           else
  //           {
@@ -436,13 +563,13 @@
  //               {
  //                   collision = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::Box(
  //                                    thisWorld, size, orientation, pos));
- //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'box' f&#252;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
+ //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'box' f&#195;&#188;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
  //               }
  //               else if (physical_body.compare(&quot;pyramid&quot;) == 0)
  //               {
  //                   collision = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::Pyramid(
  //                                   thisWorld, size, orientation, pos));
- //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'pyramid' f&#252;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
+ //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'pyramid' f&#195;&#188;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
  //               }
  //               else if (physical_body.compare(&quot;sphere&quot;) == 0)
  //               {
@@ -450,7 +577,7 @@
  //                   collision = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::Ellipsoid(
  //                                   thisWorld, Vector3(radius, radius, radius),
  //                                   orientation, pos));
- //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'sphere' f&#252;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
+ //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'sphere' f&#195;&#188;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
  //               }
  //               else if (physical_body.compare(&quot;ellipsoid&quot;) == 0)
  //               {
@@ -461,7 +588,7 @@
  //                   collision = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::Ellipsoid(
  //                                   thisWorld, s,
  //                                   orientation, pos));
- //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'ellipsoid' f&#252;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
+ //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'ellipsoid' f&#195;&#188;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
  //               }
  //               else if (physical_body.compare(&quot;capsule&quot;) == 0)
  //               {
@@ -473,7 +600,7 @@
  //                                   radius,
  //                                   height,
  //                                   orientation, pos));
- //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'capsule' f&#252;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
+ //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'capsule' f&#195;&#188;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
  //               }
  //               else if (physical_body.compare(&quot;convexhull&quot;) == 0)
  //               {
@@ -482,33 +609,33 @@
  //                                   newEnt,
  //                                   false));
  //                   //orientation, pos));
- //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'convexhull' f&#252;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
+ //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'convexhull' f&#195;&#188;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
  //               }
  //               else if (physical_body.compare(&quot;mesh&quot;) == 0 || physical_body.compare(&quot;auto&quot;))
  //               {
  //                   collision = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision(
  //                                   thisWorld, newEnt, false));
- //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'mesh' f&#252;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
+ //                   LOG_DEBUG(Logger::CORE, &quot; physical_body 'mesh' f&#195;&#188;r Entity '&quot;+entName+&quot;' erstellt. &quot;);
  //               }
  //               else
  //                   LOG_MESSAGE(Logger::CORE,
- //                       &quot; Der bodyproxy_type '&quot;+physical_body+&quot;'(aus userData) der Entity '&quot;+meshName+&quot;' ist ung&#252;ltig.&quot;);
+ //                       &quot; Der bodyproxy_type '&quot;+physical_body+&quot;'(aus userData) der Entity '&quot;+meshName+&quot;' ist ung&#195;&#188;ltig.&quot;);
 
- //               // proxy in die liste der schon erstellten proxies hinzuf&#252;gen
+ //               // proxy in die liste der schon erstellten proxies hinzuf&#195;&#188;gen
  //               aucol.ColPtr = collision;
  //               aucol.Scale = parentNode-&gt;getScale();
  //               aucol.Type = physical_body;
  //           }
  //       }
 
- //       // zur liste hinzuf&#252;gen
+ //       // zur liste hinzuf&#195;&#188;gen
  //       if (!collision.isNull())
  //       {
  //           mCollisions.push_back(collision);
  //       }
 
 
- //       // Zur Physik des Levels hinzuf&#252;gen
+ //       // Zur Physik des Levels hinzuf&#195;&#188;gen
  //       if (mCollisions.size() &gt; 0)
  //       {
  //           PhysicsManager::getSingleton().addLevelGeometry(newEnt, mCollisions);


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000397.html">[Dsa-hl-svn] r3326 - in rl/trunk/engine/core: include src
</A></li>
	<LI>Next message: <A HREF="000399.html">[Dsa-hl-svn] r3328 - in rl/trunk/engine: core/src script/swig	ui/include ui/src
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#398">[ date ]</a>
              <a href="thread.html#398">[ thread ]</a>
              <a href="subject.html#398">[ subject ]</a>
              <a href="author.html#398">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
