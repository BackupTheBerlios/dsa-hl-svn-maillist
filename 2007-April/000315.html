<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r3244 - modules/common/dsa modules/regressiontest/dsa	rl/trunk/engine/common/include rl/trunk/engine/common/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2007-April/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3244%20-%20modules/common/dsa%20modules/regressiontest/dsa%0A%09rl/trunk/engine/common/include%20rl/trunk/engine/common/src&In-Reply-To=%3C200704101641.l3AGfjqG011764%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000314.html">
   <LINK REL="Next"  HREF="000316.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r3244 - modules/common/dsa modules/regressiontest/dsa	rl/trunk/engine/common/include rl/trunk/engine/common/src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r3244%20-%20modules/common/dsa%20modules/regressiontest/dsa%0A%09rl/trunk/engine/common/include%20rl/trunk/engine/common/src&In-Reply-To=%3C200704101641.l3AGfjqG011764%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r3244 - modules/common/dsa modules/regressiontest/dsa	rl/trunk/engine/common/include rl/trunk/engine/common/src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Tue Apr 10 18:41:45 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000314.html">[Dsa-hl-svn] r3243 - in modules/techdemo/materials: . model
</A></li>
        <LI>Next message: <A HREF="000316.html">[Dsa-hl-svn] r3245 - rl/trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#315">[ date ]</a>
              <a href="thread.html#315">[ thread ]</a>
              <a href="subject.html#315">[ subject ]</a>
              <a href="author.html#315">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2007-04-10 18:41:29 +0200 (Tue, 10 Apr 2007)
New Revision: 3244

Modified:
   modules/common/dsa/gameobjectdefinitions.gof
   modules/regressiontest/dsa/gameobjectdefinitions.gof
   rl/trunk/engine/common/include/PropertyReader.h
   rl/trunk/engine/common/src/PropertyReader.cpp
Log:
Changed classid and baseclass into attributes

Modified: modules/common/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/common/dsa/gameobjectdefinitions.gof	2007-04-10 16:36:56 UTC (rev 3243)
+++ modules/common/dsa/gameobjectdefinitions.gof	2007-04-10 16:41:29 UTC (rev 3244)
@@ -2,8 +2,6 @@
 &lt;GameObjectDefinitions&gt;
 
 	&lt;gameobjectclass classid=&quot;door&quot; baseclass=&quot;Door&quot;&gt;
-		&lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;door&quot;/&gt;
-		&lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;Door&quot;/&gt;
 		&lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Eine T&#252;r&quot;/&gt;
 		&lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;convexhull&quot;/&gt;
 		&lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;arc_tuer_01.mesh&quot;/&gt;
@@ -13,8 +11,6 @@
 	&lt;/gameobjectclass&gt;
 
 	&lt;gameobjectclass classid=&quot;hero&quot; baseclass=&quot;Hero&quot;&gt;
-		&lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;hero&quot; /&gt;
-		&lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;Hero&quot; /&gt;
 		&lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot; /&gt;
 		&lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;75&quot;/&gt;
 		&lt;property name=&quot;inventorywindowtype&quot; type=&quot;STRING&quot; data=&quot;inventory_human.xml&quot;/&gt;

Modified: modules/regressiontest/dsa/gameobjectdefinitions.gof
===================================================================
--- modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-04-10 16:36:56 UTC (rev 3243)
+++ modules/regressiontest/dsa/gameobjectdefinitions.gof	2007-04-10 16:41:29 UTC (rev 3244)
@@ -1,17 +1,13 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot; ?&gt;
 &lt;GameObjectDefinitions&gt;
 
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;Holzscheit&quot;/&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;GameObject&quot; /&gt;
+    &lt;gameobjectclass classid=&quot;Holzscheit&quot; baseclass=&quot;GameObject&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Holzscheit&quot;/&gt;        
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Greater log of time check. (Very rare)&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;ver_holzscheit_01.mesh&quot;/&gt;
     &lt;/gameobjectclass&gt;
 
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;apple&quot;/&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;GameObject&quot; /&gt;
+    &lt;gameobjectclass classid=&quot;apple&quot; baseclass=&quot;GameObject&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Apfel&quot;/&gt;        
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Ein Apfel?&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;sphere.1m.mesh&quot;/&gt;
@@ -19,9 +15,7 @@
         &lt;property name=&quot;mass&quot; type=&quot;REAL&quot; data=&quot;65&quot;/&gt;
     &lt;/gameobjectclass&gt;
 
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;TestPerson&quot;/&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;NPC&quot;/&gt;
+    &lt;gameobjectclass classid=&quot;TestPerson&quot; baseclass=&quot;NPC&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;TestPerson&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Wenn man mal jemanden zum Reden braucht...&quot;/&gt;
         &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;ellipsoid&quot;/&gt;
@@ -34,9 +28,7 @@
         &lt;/property&gt;
     &lt;/gameobjectclass&gt;
 
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;TestPersonCapsule&quot;/&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;NPC&quot;/&gt;
+    &lt;gameobjectclass classid=&quot;TestPersonCapsule&quot; baseclass=&quot;NPC&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;TestPerson&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Wenn man mal jemanden zum Reden braucht...&quot;/&gt;
         &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;capsule&quot;/&gt;
@@ -49,18 +41,14 @@
         &lt;/property&gt;
     &lt;/gameobjectclass&gt;
 
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;switch3way&quot;/&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;Switch3Way&quot;/&gt;
+    &lt;gameobjectclass classid=&quot;switch3way&quot; baseclass=&quot;Switch3Way&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Hebel&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Ein Hebel&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;arc_hebel_01.mesh&quot;/&gt;
         &lt;property name=&quot;geometrytype&quot; type=&quot;STRING&quot; data=&quot;sphere&quot;/&gt;
     &lt;/gameobjectclass&gt;
 
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;shortsword&quot;/&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;Weapon&quot; /&gt;
+    &lt;gameobjectclass classid=&quot;shortsword&quot; baseclass=&quot;Weapon&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Kurzschwert&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Ein ordin&#228;res Kurzschwert - scharf, aber langweilig&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;waf_kurzschwert_01.mesh&quot;/&gt;
@@ -69,9 +57,7 @@
 		&lt;property name=&quot;size&quot; type=&quot;INTPAIR&quot; data=&quot;2,4&quot;/&gt;
     &lt;/gameobjectclass&gt;
 
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;leather backpack&quot;/&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;Container&quot;/&gt; 
+    &lt;gameobjectclass classid=&quot;leather backpack&quot; baseclass=&quot;Container&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Rucksack&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Ein Lederrucksack (oder so)&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;ins_rucksack.mesh&quot;/&gt;
@@ -86,18 +72,14 @@
     &lt;/gameobjectclass&gt;
 
     &lt;!-- ErrorHandlingTest --&gt;
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;ErrorHandling&quot;/&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;GameObject&quot; /&gt;
+    &lt;gameobjectclass classid=&quot;ErrorHandling&quot; baseclass=&quot;GameObject&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;ErrorHandling-TestCase&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;The ErrorHandling TestCase&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;arc_hebel_01.mesh&quot;/&gt;
     &lt;/gameobjectclass&gt;
 
     &lt;!-- JobSequenceTest --&gt;
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type=&quot;STRING&quot; data=&quot;JobSequenceTestChest&quot;/&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;GameObject&quot; /&gt;
+    &lt;gameobjectclass classid=&quot;JobSequenceTestChest&quot; baseclass=&quot;GameObject&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;JobSequence-Truhe&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Eine Truhe zum Test der JobSequence&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;ver_truhe_gross01.mesh&quot;/&gt;
@@ -105,9 +87,7 @@
     &lt;/gameobjectclass&gt;
     
     &lt;!-- EffectTest --&gt;
-    &lt;gameobjectclass&gt;
-        &lt;property name=&quot;classid&quot; type= &quot;STRING&quot; data=&quot;EffectTest&quot; /&gt;
-        &lt;property name=&quot;baseclass&quot; type=&quot;STRING&quot; data=&quot;GameObject&quot;/&gt;
+    &lt;gameobjectclass classid=&quot;EffectTest&quot; baseclass=&quot;GameObject&quot;&gt;
         &lt;property name=&quot;name&quot; type=&quot;STRING&quot; data=&quot;Bottich der Versteinerung&quot;/&gt;
         &lt;property name=&quot;description&quot; type=&quot;STRING&quot; data=&quot;Der Essigbottich der Versteinerung (Vorsicht!)&quot;/&gt;
         &lt;property name=&quot;meshfile&quot; type=&quot;STRING&quot; data=&quot;ver_essigbottich_01.mesh&quot;/&gt;

Modified: rl/trunk/engine/common/include/PropertyReader.h
===================================================================
--- rl/trunk/engine/common/include/PropertyReader.h	2007-04-10 16:36:56 UTC (rev 3243)
+++ rl/trunk/engine/common/include/PropertyReader.h	2007-04-10 16:41:29 UTC (rev 3244)
@@ -19,6 +19,7 @@
 
 #include &quot;CommonPrerequisites.h&quot;
 
+#include &lt;xercesc/dom/DOMAttr.hpp&gt;
 #include &lt;xercesc/dom/DOMElement.hpp&gt;
 
 namespace rl 
@@ -37,6 +38,7 @@
         std::vector&lt;PropertySet*&gt; getPropertySets();
 
         PropertyEntry processProperty(XERCES_CPP_NAMESPACE::DOMElement* domElem) const;
+		PropertyEntry processProperty(XERCES_CPP_NAMESPACE::DOMAttr* domAttr) const;
 
     private:
         std::vector&lt;PropertySet*&gt; mPropertySets;

Modified: rl/trunk/engine/common/src/PropertyReader.cpp
===================================================================
--- rl/trunk/engine/common/src/PropertyReader.cpp	2007-04-10 16:36:56 UTC (rev 3243)
+++ rl/trunk/engine/common/src/PropertyReader.cpp	2007-04-10 16:41:29 UTC (rev 3244)
@@ -55,8 +55,20 @@
     DOMNodeList* godefsXml = doc-&gt;getDocumentElement()-&gt;getElementsByTagName(AutoXMLCh(&quot;gameobjectclass&quot;).data());
     for (unsigned int idx = 0; idx &lt; godefsXml-&gt;getLength(); idx++)
     {
-        PropertySet* ps = new PropertySet();
-        DOMNodeList* godefChildren = static_cast&lt;DOMElement*&gt;(godefsXml-&gt;item(idx))-&gt;getChildNodes();
+		PropertySet* ps = new PropertySet();
+		DOMElement* curNode = static_cast&lt;DOMElement*&gt;(godefsXml-&gt;item(idx));
+		
+		const DOMNamedNodeMap* godefAttrs = curNode-&gt;getAttributes();
+		for (XMLSize_t attrIdx = 0; attrIdx &lt; godefAttrs-&gt;getLength(); attrIdx++)
+		{
+			PropertyEntry entry = processProperty(static_cast&lt;DOMAttr*&gt;(godefAttrs-&gt;item(attrIdx)));
+            if (entry.first != &quot;&quot;)
+            {
+                ps-&gt;setProperty(entry.first, entry.second);
+            }
+		}
+
+        DOMNodeList* godefChildren = curNode-&gt;getChildNodes();
         for (XMLSize_t childIdx = 0; childIdx &lt; godefChildren-&gt;getLength(); childIdx++)
         {
             DOMNode* curChild = godefChildren-&gt;item(childIdx);
@@ -82,6 +94,13 @@
     return mPropertySets;
 }
 
+PropertyEntry XmlPropertyReader::processProperty(XERCES_CPP_NAMESPACE::DOMAttr* domAttr) const
+{
+	return std::make_pair(
+		XmlHelper::transcodeToStdString(domAttr-&gt;getName()), 
+		Property(XmlHelper::transcodeToString(domAttr-&gt;getValue())));
+}
+
 PropertyEntry XmlPropertyReader::processProperty(XERCES_CPP_NAMESPACE::DOMElement* domElem) const
 {
     if (!XmlHelper::hasAttribute(domElem, &quot;type&quot;))


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000314.html">[Dsa-hl-svn] r3243 - in modules/techdemo/materials: . model
</A></li>
	<LI>Next message: <A HREF="000316.html">[Dsa-hl-svn] r3245 - rl/trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#315">[ date ]</a>
              <a href="thread.html#315">[ thread ]</a>
              <a href="subject.html#315">[ subject ]</a>
              <a href="author.html#315">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
