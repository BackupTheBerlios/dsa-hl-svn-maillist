<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Dsa-hl-svn] r4362 - in rl/trunk/engine: rules rules/include	rules/src script/swig ui ui/include ui/src
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/dsa-hl-svn/2008-April/index.html" >
   <LINK REL="made" HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4362%20-%20in%20rl/trunk/engine%3A%20rules%20rules/include%0A%09rules/src%20script/swig%20ui%20ui/include%20ui/src&In-Reply-To=%3C200804221949.m3MJnBa0027540%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001432.html">
   <LINK REL="Next"  HREF="001434.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Dsa-hl-svn] r4362 - in rl/trunk/engine: rules rules/include	rules/src script/swig ui ui/include ui/src</H1>
    <B>blakharaz at mail.berlios.de</B> 
    <A HREF="mailto:dsa-hl-svn%40lists.berlios.de?Subject=Re%3A%20%5BDsa-hl-svn%5D%20r4362%20-%20in%20rl/trunk/engine%3A%20rules%20rules/include%0A%09rules/src%20script/swig%20ui%20ui/include%20ui/src&In-Reply-To=%3C200804221949.m3MJnBa0027540%40sheep.berlios.de%3E"
       TITLE="[Dsa-hl-svn] r4362 - in rl/trunk/engine: rules rules/include	rules/src script/swig ui ui/include ui/src">blakharaz at mail.berlios.de
       </A><BR>
    <I>Tue Apr 22 21:49:11 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="001432.html">[Dsa-hl-svn] r4361 - rl/trunk/engine/rules/src
</A></li>
        <LI>Next message: <A HREF="001434.html">[Dsa-hl-svn] r4363 - modules/common/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1433">[ date ]</a>
              <a href="thread.html#1433">[ thread ]</a>
              <a href="subject.html#1433">[ subject ]</a>
              <a href="author.html#1433">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: blakharaz
Date: 2008-04-22 21:49:02 +0200 (Tue, 22 Apr 2008)
New Revision: 4362

Modified:
   rl/trunk/engine/rules/RlRules2005.vcproj
   rl/trunk/engine/rules/include/DsaDataLoader.h
   rl/trunk/engine/rules/include/DsaManager.h
   rl/trunk/engine/rules/src/CreatureController.cpp
   rl/trunk/engine/rules/src/DsaDataLoader.cpp
   rl/trunk/engine/rules/src/DsaManager.cpp
   rl/trunk/engine/rules/src/GameObjectManager.cpp
   rl/trunk/engine/script/swig/RlRules.head.swig
   rl/trunk/engine/script/swig/RlRules.swig
   rl/trunk/engine/script/swig/RlUi.swig
   rl/trunk/engine/ui/RlUI2005.vcproj
   rl/trunk/engine/ui/include/ActionChoiceWindow.h
   rl/trunk/engine/ui/include/CharacterSheetWindow.h
   rl/trunk/engine/ui/include/CombatControlState.h
   rl/trunk/engine/ui/include/ControlState.h
   rl/trunk/engine/ui/include/DialogControlState.h
   rl/trunk/engine/ui/include/FreeflightControlState.h
   rl/trunk/engine/ui/include/MovementControlState.h
   rl/trunk/engine/ui/include/UiMessages.h
   rl/trunk/engine/ui/include/UiSubsystem.h
   rl/trunk/engine/ui/include/WindowFactory.h
   rl/trunk/engine/ui/src/ActionChoiceWindow.cpp
   rl/trunk/engine/ui/src/CharacterSheetWindow.cpp
   rl/trunk/engine/ui/src/CombatControlState.cpp
   rl/trunk/engine/ui/src/CommandMapper.cpp
   rl/trunk/engine/ui/src/ControlState.cpp
   rl/trunk/engine/ui/src/DebugWindow.cpp
   rl/trunk/engine/ui/src/DialogControlState.cpp
   rl/trunk/engine/ui/src/FreeflightControlState.cpp
   rl/trunk/engine/ui/src/InputManager.cpp
   rl/trunk/engine/ui/src/MovementControlState.cpp
   rl/trunk/engine/ui/src/UiSubsystem.cpp
   rl/trunk/engine/ui/src/WindowFactory.cpp
Log:
Removed Person class, replaced by Creature (now you can steer the wolf)


Modified: rl/trunk/engine/rules/RlRules2005.vcproj
===================================================================
--- rl/trunk/engine/rules/RlRules2005.vcproj	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/rules/RlRules2005.vcproj	2008-04-22 19:49:02 UTC (rev 4362)
@@ -518,10 +518,6 @@
 					&gt;
 				&lt;/File&gt;
 				&lt;File
-					RelativePath=&quot;.\src\Person.cpp&quot;
-					&gt;
-				&lt;/File&gt;
-				&lt;File
 					RelativePath=&quot;.\src\Weapon.cpp&quot;
 					&gt;
 				&lt;/File&gt;
@@ -756,10 +752,6 @@
 					&gt;
 				&lt;/File&gt;
 				&lt;File
-					RelativePath=&quot;.\include\Person.h&quot;
-					&gt;
-				&lt;/File&gt;
-				&lt;File
 					RelativePath=&quot;.\include\Weapon.h&quot;
 					&gt;
 				&lt;/File&gt;

Modified: rl/trunk/engine/rules/include/DsaDataLoader.h
===================================================================
--- rl/trunk/engine/rules/include/DsaDataLoader.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/rules/include/DsaDataLoader.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -25,7 +25,7 @@
 namespace rl {
 
 	class Talent;
-	class Person;
+	class Creature;
 	class Kampftechnik;
 
     class XdimlLoader 
@@ -45,8 +45,8 @@
 		void initializeTalente(XERCES_CPP_NAMESPACE::DOMElement* rootTalente);
 		Talent* processTalent(int gruppe, XERCES_CPP_NAMESPACE::DOMElement* talentXml);
 
-		void initializePersonen(XERCES_CPP_NAMESPACE::DOMElement* rootPersonen);
-		Person* processPerson(XERCES_CPP_NAMESPACE::DOMElement* talentXml);
+		void initializeCreatures(XERCES_CPP_NAMESPACE::DOMElement* rootCreatures);
+		Creature* processCreature(XERCES_CPP_NAMESPACE::DOMElement* talentXml);
 			
 		void initializeKampftechniken(XERCES_CPP_NAMESPACE::DOMElement* rootKampftechniken);
 		Kampftechnik* processKampftechnik(XERCES_CPP_NAMESPACE::DOMElement* kampftechnikXml);

Modified: rl/trunk/engine/rules/include/DsaManager.h
===================================================================
--- rl/trunk/engine/rules/include/DsaManager.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/rules/include/DsaManager.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -77,7 +77,7 @@
         Talent* getTalent(const CeGuiString talentName) const;
         Kampftechnik* getKampftechnik(const CeGuiString kampftechnikName) const;
         Eigenschaft* getEigenschaft(const CeGuiString eigenschaftName) const;
-		Person* getPerson(int id) const;        
+		Creature* getCreature(int id) const;        
 				
 		int getSteigerKosten(int column, int from, int to) const;
 		int getSteigerKosten(int column, int from) const;
@@ -85,7 +85,7 @@
 		bool isRuleActive(Rule rule) const;
 
 		void _addTalent(Talent* talent);
-		void _addPerson(Person* person);
+		void _addCreature(Creature* creature);
 		void _addKampftechnik(Kampftechnik* kampftechnik);
 
     private:
@@ -94,13 +94,13 @@
         Ogre::Real mTimeScale;
 
         typedef std::map&lt;CeGuiString, Talent*&gt; TalentMap;
-		typedef std::map&lt;int, Person*&gt; PersonMap;
+		typedef std::map&lt;int, Creature*&gt; CreatureMap;
         typedef std::map&lt;CeGuiString, Kampftechnik*&gt; KampftechnikMap;
 		typedef std::map&lt;CeGuiString, Eigenschaft*&gt; EigenschaftMap;
 		EigenschaftMap mEigenschaften;
         TalentMap mTalente;
         KampftechnikMap mKampftechniken;
-		PersonMap mPersonen;
+		CreatureMap mCreatures;
 		unsigned int mSteigerkostenTabelle[SKT_COLUMNS][SKT_ROWS];
 
 		void initializeEigenschaften();

Modified: rl/trunk/engine/rules/src/CreatureController.cpp
===================================================================
--- rl/trunk/engine/rules/src/CreatureController.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/rules/src/CreatureController.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -2030,7 +2030,6 @@
                 setMovement(CreatureController::MT_NONE, Vector3::ZERO, Vector3::ZERO);
                 Creature::AnimationSpeedPair anim = mCreature-&gt;getAnimation(&quot;sterben&quot;);
                 setAnimation(anim.first, anim.second, 1, anim.first, 1.0f );
-                setAnimation(anim.first, anim.second, 1, anim.first, 1.0f );
             }
             return true;
         }

Modified: rl/trunk/engine/rules/src/DsaDataLoader.cpp
===================================================================
--- rl/trunk/engine/rules/src/DsaDataLoader.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/rules/src/DsaDataLoader.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -26,7 +26,7 @@
 
 #include &quot;DsaManager.h&quot;
 #include &quot;Talent.h&quot;
-#include &quot;Person.h&quot;
+#include &quot;Creature.h&quot;
 #include &quot;Kampftechnik.h&quot;
 #include &quot;RulesPrerequisites.h&quot;
 #include &quot;RulesSubsystem.h&quot;
@@ -58,7 +58,7 @@
 
 		initializeTalente(getChildNamed(dataDocumentContent, &quot;Talente&quot;));
 		initializeKampftechniken(getChildNamed(dataDocumentContent, &quot;Kampftechniken&quot;));
-		initializePersonen(getChildNamed(dataDocumentContent, &quot;Personen&quot;));
+		initializeCreatures(getChildNamed(dataDocumentContent, &quot;Personen&quot;));
 
 		doc-&gt;release();
 
@@ -207,7 +207,7 @@
 	}
 
 
-	void XdimlLoader::initializePersonen(DOMElement* rootPersons)
+	void XdimlLoader::initializeCreatures(DOMElement* rootPersons)
 	{
 		if (rootPersons == NULL)
 			return;
@@ -215,15 +215,15 @@
 		DOMNodeList* personenXml = rootPersons-&gt;getElementsByTagName(AutoXMLCh(&quot;Person&quot;).data());
 		for (unsigned int idx = 0; idx &lt; personenXml-&gt;getLength(); idx++)
 		{
-			Person* p =
-				processPerson(
+			Creature* p =
+				processCreature(
 					static_cast&lt;DOMElement*&gt;(personenXml-&gt;item(idx)));
-			DsaManager::getSingleton()._addPerson(p);
+			DsaManager::getSingleton()._addCreature(p);
 		}
 
 	}
 
-	Person* XdimlLoader::processPerson(DOMElement* personXml)
+	Creature* XdimlLoader::processCreature(DOMElement* personXml)
 	{
 		AutoXMLCh TALENT = &quot;Talent&quot;;
 		AutoXMLCh ID = &quot;ID&quot;;
@@ -236,7 +236,7 @@
 			getValueAsString(getChildNamed(personXml, &quot;Beschreibung&quot;));
 
         //@warning replace this by correct loading process
-		Person* rval = new Person(10000);
+		Creature* rval = new Creature(10000);
         rval-&gt;setName(name);
         rval-&gt;setDescription(desc);
 

Modified: rl/trunk/engine/rules/src/DsaManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/DsaManager.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/rules/src/DsaManager.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -20,7 +20,7 @@
 #include &quot;Eigenschaft.h&quot;
 #include &quot;Talent.h&quot;
 #include &quot;Kampftechnik.h&quot;
-#include &quot;Person.h&quot;
+#include &quot;Creature.h&quot;
 #include &quot;RulesSubsystem.h&quot;
 #include &quot;Date.h&quot;
 #include &quot;DsaDataLoader.h&quot;
@@ -45,7 +45,7 @@
         mEigenschaften(),
         mTalente(),
         mKampftechniken(),
-        mPersonen()
+        mCreatures()
     {
         //Zufallsgenerator initialisieren
         srand(static_cast&lt;unsigned int&gt;(time(NULL)));
@@ -59,7 +59,7 @@
 
     DsaManager::~DsaManager()
     {
-        for(PersonMap::iterator it = mPersonen.begin(); it != mPersonen.end(); ++it)
+        for (CreatureMap::iterator it = mCreatures.begin(); it != mCreatures.end(); ++it)
         {
             delete it-&gt;second;
         }
@@ -109,9 +109,9 @@
 		mTalente.insert(make_pair(talent-&gt;getName(), talent));
 	}
 
-	void DsaManager::_addPerson(Person* person)
+	void DsaManager::_addCreature(Creature* creature)
 	{
-		mPersonen.insert(make_pair(person-&gt;getId(), person));
+		mCreatures.insert(make_pair(creature-&gt;getId(), creature));
 	}
 
 	void DsaManager::_addKampftechnik(Kampftechnik* kampftechnik)
@@ -291,16 +291,16 @@
 		return sum;
 	}
 
-	Person* DsaManager::getPerson(int id) const
+	Creature* DsaManager::getCreature(int id) const
 	{
-		PersonMap::const_iterator it = mPersonen.find(id);
-        if (it != mPersonen.end())
+		CreatureMap::const_iterator it = mCreatures.find(id);
+        if (it != mCreatures.end())
         {
             return (*it).second;
         }
         else
         {
-            Throw(IllegalArgumentException, &quot;Person nicht gefunden.&quot;);
+            Throw(IllegalArgumentException, &quot;Creature not found.&quot;);
         }
 	}
 }

Modified: rl/trunk/engine/rules/src/GameObjectManager.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObjectManager.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/rules/src/GameObjectManager.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -26,7 +26,6 @@
 #include &quot;Exception.h&quot;
 #include &quot;GameObject.h&quot;
 #include &quot;Item.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;Properties.h&quot;
 #include &quot;Property.h&quot;
 #include &quot;RulesMessages.h&quot;
@@ -274,10 +273,6 @@
         {
             return new Creature(id);
         }
-        else if (classname == Person::CLASS_NAME)
-        {
-            return new Person(id);
-        }
         else if (classname == Weapon::CLASS_NAME)
         {
             return new Weapon(id);

Modified: rl/trunk/engine/script/swig/RlRules.head.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.head.swig	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/script/swig/RlRules.head.swig	2008-04-22 19:49:02 UTC (rev 4362)
@@ -40,7 +40,6 @@
 #include &quot;ObjectStateChangeEventSource.h&quot;
 #include &quot;ObjectStateChangeEvent.h&quot;
 #include &quot;ObjectStateChangeListener.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;Quest.h&quot;
 #include &quot;QuestBook.h&quot;
 #include &quot;QuestEvent.h&quot;

Modified: rl/trunk/engine/script/swig/RlRules.swig
===================================================================
--- rl/trunk/engine/script/swig/RlRules.swig	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/script/swig/RlRules.swig	2008-04-22 19:49:02 UTC (rev 4362)
@@ -108,7 +108,7 @@
       
         static DsaManager&amp; getSingleton();
         rl::Talent* getTalent(const rl::CeGuiString name) const;
-        rl::Person* getPerson(const int id) const;
+        rl::Creature* getCreature(const int id) const;
     };
     
     %feature(&quot;director&quot;) GameObjectFactory; 
@@ -774,27 +774,6 @@
         virtual void onAfterStateChange(GameObjectState oldState, GameObjectState newState);
    };
    
-   %feature(&quot;director&quot;) Person;
-   class Person : public Creature
-   {
-   public:
-        Person(unsigned int id);
-
-        rl::CeGuiString getRasse();
-        void setRasse(rl::CeGuiString rasse);
-        rl::CeGuiString getKultur();
-        void setKultur(rl::CeGuiString kultur);
-        rl::CeGuiString getProfession();
-        void setProfession(rl::CeGuiString profession);
-
-        virtual const rl::Property getProperty(const rl::CeGuiString&amp; key) const;
-        virtual void setProperty(const rl::CeGuiString&amp; key, const rl::Property&amp; value);
-        virtual rl::PropertyKeys getAllPropertyKeys() const;
-        
-        virtual void onBeforeStateChange(GameObjectState oldState, GameObjectState newState);
-        virtual void onAfterStateChange(GameObjectState oldState, GameObjectState newState);
-    };
-        
     %feature(&quot;director&quot;) ActionManager;
     class ActionManager
     {
@@ -927,11 +906,6 @@
 {
     rl::GameObject *pGameObject = static_cast&lt;rl::GameObject*&gt;(*ptr);
 
-    rl::Person *pPerson=dynamic_cast&lt;rl::Person*&gt;(pGameObject);
-    if (pPerson) {
-        *ptr=pPerson;
-        return SWIGTYPE_p_rl__Person;
-    }
     rl::Creature *pCreature=dynamic_cast&lt;rl::Creature*&gt;(pGameObject);
     if (pCreature) {
         *ptr=pCreature;

Modified: rl/trunk/engine/script/swig/RlUi.swig
===================================================================
--- rl/trunk/engine/script/swig/RlUi.swig	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/script/swig/RlUi.swig	2008-04-22 19:49:02 UTC (rev 4362)
@@ -45,8 +45,8 @@
     static UiSubsystem&amp; getSingleton(void);
     void initializeSubsystem();
 
-    rl::Person* getActiveCharacter();
-    void setActiveCharacter(rl::Person* chara);
+    rl::Creature* getActiveCharacter();
+    void setActiveCharacter(rl::Creature* chara);
 };
 
 enum ControlStateType 
@@ -89,7 +89,7 @@
     void showActionChoice(rl::GameObject* obj);
     void showCharacterActionChoice();
     void showCharacterSheet();
-    void showCharacterSheet(rl::Person* chara);
+    void showCharacterSheet(rl::Creature* chara);
     void showContainerContent(rl::Container* container);
     void showDescriptionWindow(rl::GameObject* obj);
     void showPropertiesWindow(rl::GameObject* obj);

Modified: rl/trunk/engine/ui/RlUI2005.vcproj
===================================================================
--- rl/trunk/engine/ui/RlUI2005.vcproj	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/RlUI2005.vcproj	2008-04-22 19:49:02 UTC (rev 4362)
@@ -1,7 +1,7 @@
 &lt;?xml version=&quot;1.0&quot; encoding=&quot;Windows-1252&quot;?&gt;
 &lt;VisualStudioProject
 	ProjectType=&quot;Visual C++&quot;
-	Version=&quot;8.00&quot;
+	Version=&quot;8,00&quot;
 	Name=&quot;RlUI&quot;
 	ProjectGUID=&quot;{53FE20F3-E726-44FE-BBEC-D29CAE210D25}&quot;
 	RootNamespace=&quot;RlUI&quot;

Modified: rl/trunk/engine/ui/include/ActionChoiceWindow.h
===================================================================
--- rl/trunk/engine/ui/include/ActionChoiceWindow.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/ActionChoiceWindow.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -27,13 +27,13 @@
 namespace rl {
 
 	class GameObject;
-	class Person;
+	class Creature;
 	class ActionGroup;
 
 	class _RlUiExport ActionChoiceWindow : public AbstractWindow
 	{
 	public:
-		ActionChoiceWindow(Person* actor);
+		ActionChoiceWindow(Creature* actor);
 		~ActionChoiceWindow();
 		
 		int showActionsOfObject(GameObject* object);
@@ -91,7 +91,7 @@
 		CEGUI::Window* mButtonArea;
 		CEGUI::Window* mHint;
 
-		Person* mActor;		
+		Creature* mActor;		
 		
 		class ActionNode
 		{

Modified: rl/trunk/engine/ui/include/CharacterSheetWindow.h
===================================================================
--- rl/trunk/engine/ui/include/CharacterSheetWindow.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/CharacterSheetWindow.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -25,7 +25,7 @@
 
 namespace rl {
 
-	class Person;
+	class Creature;
 	class ObjectStateChangeEvent;
 
 	class _RlUiExport CharacterSheetWindow : public AbstractWindow, public ObjectStateChangeListener
@@ -34,7 +34,7 @@
 		CharacterSheetWindow();
 		~CharacterSheetWindow();
 
-		void setCharacter(Person* character);
+		void setCharacter(Creature* character);
 
 		/**
 		 * Aktualisiert die Tabellenelemente in Talent- und Magietabellen
@@ -45,7 +45,7 @@
 		void objectStateChanged(ObjectStateChangeEvent* evt);
 
 	private:
-		Person* mCharacter;
+		Creature* mCharacter;
 
 		CEGUI::Window* mCharacterSheet;
 		CEGUI::Window* mTalentSheet;

Modified: rl/trunk/engine/ui/include/CombatControlState.h
===================================================================
--- rl/trunk/engine/ui/include/CombatControlState.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/CombatControlState.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -39,7 +39,7 @@
 		*  @throw NullPointerException if camera is NULL.
 		*  @warning Ownership of combat is taken by the CombatControlState.
 		*/
-		CombatControlState(CommandMapper* cmdMapper, Actor* camera, Person* character);
+		CombatControlState(CommandMapper* cmdMapper, Actor* camera, Creature* character);
 		virtual ~CombatControlState();
 
 		// Control state overrides

Modified: rl/trunk/engine/ui/include/ControlState.h
===================================================================
--- rl/trunk/engine/ui/include/ControlState.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/ControlState.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -37,7 +37,6 @@
     class Actor;
 	class CommandMapper;
 	class Creature;
-    class Person;
 
     /**
      * This class handles character control via user input.
@@ -51,7 +50,7 @@
          *  @throw NullPointerException if camera or character is NULL.
          *  @throw InvalidArgumentException if character is not placed in the scene.
          */
-        ControlState(CommandMapper* commandMapper, Actor* camera, Person* character,
+        ControlState(CommandMapper* commandMapper, Actor* camera, Creature* character,
             ControlStateType type);
 		virtual ~ControlState()= 0;
 
@@ -77,7 +76,7 @@
         /// returns wether cegui currently uses the mouse
         bool isMouseUsedByCegui() const;
 
-        Person* mCharacter;
+        Creature* mCharacter;
         int mCharacterId;
 
         Actor* mCameraActor;

Modified: rl/trunk/engine/ui/include/DialogControlState.h
===================================================================
--- rl/trunk/engine/ui/include/DialogControlState.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/DialogControlState.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -53,7 +53,7 @@
 		*  @throw NullPointerException if camera or character is NULL.
 		*  @throw InvalidArgumentException if character is not placed in the scene.
 		*/
-		DialogControlState(CommandMapper* cmdMapper, Actor* camera, Person* character);
+		DialogControlState(CommandMapper* cmdMapper, Actor* camera, Creature* character);
 		/// Dtor 
 		virtual ~DialogControlState();
 

Modified: rl/trunk/engine/ui/include/FreeflightControlState.h
===================================================================
--- rl/trunk/engine/ui/include/FreeflightControlState.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/FreeflightControlState.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -43,7 +43,7 @@
 		*  @throw NullPointerException if camera or character is NULL.
 		*  @throw InvalidArgumentException if character is not placed in the scene.
 		*/
-		FreeflightControlState(CommandMapper* cmdMapper, Actor* camera, Person* character);
+		FreeflightControlState(CommandMapper* cmdMapper, Actor* camera, Creature* character);
 		virtual ~FreeflightControlState();
 
         virtual void pause();

Modified: rl/trunk/engine/ui/include/MovementControlState.h
===================================================================
--- rl/trunk/engine/ui/include/MovementControlState.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/MovementControlState.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -50,7 +50,7 @@
          *  @throw NullPointerException if camera or character is NULL.
          *  @throw InvalidArgumentException if character is not placed in the scene.
          */
-        MovementControlState(CommandMapper* cmdMapper, Actor* camera, Person* character);
+        MovementControlState(CommandMapper* cmdMapper, Actor* camera, Creature* character);
         virtual ~MovementControlState();
 
         virtual void pause();

Modified: rl/trunk/engine/ui/include/UiMessages.h
===================================================================
--- rl/trunk/engine/ui/include/UiMessages.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/UiMessages.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -23,6 +23,7 @@
 namespace rl
 {
 	class Combatant;
+    class Creature;
 
 	// 0x04XXXXXX is mask for UI messages
     enum UiMessageTypeIds
@@ -36,7 +37,10 @@
 
         RLMSG_COMBAT_IO_ATTACK_OPPONENT = 0x04000103,
         RLMSG_COMBAT_IO_PARRY_OPPONENT = 0x04000104,
-        RLMSG_COMBAT_IO_END_TURN_REQUESTED = 0x04000105
+        RLMSG_COMBAT_IO_END_TURN_REQUESTED = 0x04000105,
+
+        // Character change
+        RLMSG_ACTIVE_CHARACTER_CHANGED = 0x04000201
     };
 
     /// Message sent after enemy action button has been pressed.
@@ -49,5 +53,7 @@
     typedef MessageType&lt;RLMSG_COMBAT_IO_ATTACK_OPPONENT, Combatant*&gt; MessageType_CombatIoAttackOpponent;
     typedef MessageType&lt;RLMSG_COMBAT_IO_PARRY_OPPONENT, Combatant*&gt; MessageType_CombatIoParryOpponent;
     typedef MessageType&lt;RLMSG_COMBAT_IO_END_TURN_REQUESTED&gt; MessageType_CombatIoEndTurnRequested;
+
+    typedef MessageType&lt;RLMSG_ACTIVE_CHARACTER_CHANGED, Creature*&gt; MessageType_ActiveCharacterChanged;
 }
 #endif

Modified: rl/trunk/engine/ui/include/UiSubsystem.h
===================================================================
--- rl/trunk/engine/ui/include/UiSubsystem.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/UiSubsystem.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -38,9 +38,6 @@
     class GameActor;
     class GameObject;
     class InputManager;
-    class Person;
-    class RBCombat;
-    class RTCombat;
     class WindowFactory;
     class WindowManager;
 
@@ -55,9 +52,9 @@
         virtual ~UiSubsystem();
 
         CEGUI::OgreCEGUIRenderer* getGUIRenderer();
-        Person* getActiveCharacter() const;
+        Creature* getActiveCharacter() const;
         ///@todo function feels misplaced here,
-        void setActiveCharacter(Person* person);
+        void setActiveCharacter(Creature* person);
 
         virtual bool onBeforeClearScene();
         virtual bool onBeforeGameObjectsLoaded();
@@ -66,7 +63,7 @@
         void initializeSubsystem();
 
     private:
-        Person* mCharacter;
+        Creature* mCharacter;
         int mCharacterId;
 
 	    MessagePump::ScopedConnection mSceneClearingConnection;

Modified: rl/trunk/engine/ui/include/WindowFactory.h
===================================================================
--- rl/trunk/engine/ui/include/WindowFactory.h	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/include/WindowFactory.h	2008-04-22 19:49:02 UTC (rev 4362)
@@ -47,7 +47,6 @@
     class LogWindow;
     class MainMenuWindow;
     class ObjectDescriptionWindow;
-    class Person;
     class GameSaveLoadWindow;
     class MainMenuLoadWindow;
     class WindowUpdater;
@@ -72,7 +71,7 @@
         void showAboutWindow();
         void showCharacterActionChoice();
         void showCharacterSheet();
-        void showCharacterSheet(Person* chara);
+        void showCharacterSheet(Creature* chara);
         void showContainerContent(Container* container);
         void showDescriptionWindow(GameObject* obj);
         void showPropertiesWindow(GameObject* obj);

Modified: rl/trunk/engine/ui/src/ActionChoiceWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/ActionChoiceWindow.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/ActionChoiceWindow.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -24,10 +24,10 @@
 
 #include &quot;Action.h&quot;
 #include &quot;ActionManager.h&quot;
+#include &quot;Creature.h&quot;
+#include &quot;Exception.h&quot;
 #include &quot;GameObject.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;UiSubsystem.h&quot;
-#include &quot;Exception.h&quot;
 
 
 using namespace CEGUI;
@@ -39,7 +39,7 @@
 	const int MAX_NUM_ACTIONS = 4;
 	const int MAX_NUM_SUBACTIONS = 7;
 
-	ActionChoiceWindow::ActionChoiceWindow(Person* actor)
+	ActionChoiceWindow::ActionChoiceWindow(Creature* actor)
 		:	AbstractWindow(&quot;actionchoicewindow.xml&quot;, WIT_MOUSE_INPUT),
 			mActor(actor)
 	{

Modified: rl/trunk/engine/ui/src/CharacterSheetWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/CharacterSheetWindow.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/CharacterSheetWindow.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -21,8 +21,8 @@
 #include &lt;CEGUIPropertyHelper.h&gt;
 #include &lt;elements/CEGUIListboxTextItem.h&gt;
 
+#include &quot;Creature.h&quot;
 #include &quot;DsaManager.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;InputManager.h&quot;
 #include &quot;Talent.h&quot;
 
@@ -35,7 +35,8 @@
 namespace rl {
 
 CharacterSheetWindow::CharacterSheetWindow()
-	: AbstractWindow(&quot;charactersheet.xml&quot;, WIT_MOUSE_INPUT)
+	: AbstractWindow(&quot;charactersheet.xml&quot;, WIT_MOUSE_INPUT),
+      mCharacter(NULL)
 {
 	mTalentTable = getMultiColumnList(&quot;CharacterSheet/TalentSheet/Table&quot;);
 	mTalentTable-&gt;addColumn((utf8*)&quot;Talent&quot;, 0, cegui_reldim(0.5));
@@ -73,17 +74,19 @@
 {
 }
 
-void CharacterSheetWindow::setCharacter(Person* person)
+void CharacterSheetWindow::setCharacter(Creature* creature)
 {
-	if (person == NULL)
+	if (creature == NULL)
 	{
-		if (mCharacter != NULL)
+		if (mCharacter != NULL) 
+        {
 			mCharacter-&gt;removeObjectStateChangeListener(this);
+        }
 	}
 	else
 	{
-		person-&gt;addObjectStateChangeListener(this);
-		mCharacter = person;
+		creature-&gt;addObjectStateChangeListener(this);
+		mCharacter = creature;
 		update();
 	}
 }
@@ -100,9 +103,9 @@
 void CharacterSheetWindow::updateValues()
 {
 	mName-&gt;setText(&quot;Name: &quot;+mCharacter-&gt;getName());
-    mRasse-&gt;setText(&quot;Rasse: &quot;+mCharacter-&gt;getRasse());
-    mKultur-&gt;setText(&quot;Kultur: &quot;+mCharacter-&gt;getKultur());
-    mProfession-&gt;setText(&quot;Profession: &quot;+mCharacter-&gt;getProfession());
+    mRasse-&gt;setText(&quot;&quot;); // bei Tieren...
+    mKultur-&gt;setText(&quot;&quot;);
+    mProfession-&gt;setText(&quot;&quot;);
     mEffekte-&gt;setText(&quot;Effekte:\n&quot;+mCharacter-&gt;getEffects());
 
 	mLE-&gt;setText(&quot;LeP: &quot;+

Modified: rl/trunk/engine/ui/src/CombatControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/CombatControlState.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/CombatControlState.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -28,7 +28,6 @@
 #include &quot;CreatureControllerManager.h&quot;
 #include &quot;InputManager.h&quot;
 #include &quot;MeshObject.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;PhysicalThing.h&quot;
 #include &quot;RulesMessages.h&quot;
 #include &quot;Selector.h&quot;
@@ -39,7 +38,7 @@
 
 namespace rl {
     CombatControlState::CombatControlState(CommandMapper* cmdMapper,
-        Actor* camera, Person* character)
+        Actor* camera, Creature* character)
         : ControlState(cmdMapper, camera, character, CST_COMBAT),
           Combatant(CombatManager::getSingleton().startCombat(),
 			CreatureControllerManager::getSingleton().getCreatureController(character)),

Modified: rl/trunk/engine/ui/src/CommandMapper.cpp
===================================================================
--- rl/trunk/engine/ui/src/CommandMapper.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/CommandMapper.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -21,7 +21,6 @@
 #include &quot;ConfigurationManager.h&quot;
 #include &quot;Exception.h&quot;
 #include &quot;InputManager.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;UiSubsystem.h&quot;
 
 using namespace Ogre;

Modified: rl/trunk/engine/ui/src/ControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/ControlState.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/ControlState.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -29,7 +29,6 @@
 #include &quot;Creature.h&quot;
 #include &quot;Exception.h&quot;
 #include &quot;InputManager.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;PhysicalThing.h&quot;
 #include &quot;RulesMessages.h&quot;
 #include &quot;WindowManager.h&quot;
@@ -42,7 +41,7 @@
     const Ogre::String ControlState::PROPERTY_CHARACTERID = &quot;characterid&quot;;
 
 	ControlState::ControlState(CommandMapper* commandMapper,
-        Actor* camera, Person* character, ControlStateType type)
+        Actor* camera, Creature* character, ControlStateType type)
 		: mCharacter(character),
         mCameraActor(camera),
 		mCharacterActor(NULL),
@@ -185,7 +184,7 @@
 
     bool ControlState::refetchCharacter()
     {
-        mCharacter = static_cast&lt;Person*&gt;(GameObjectManager::getSingleton().getGameObject(mCharacterId));
+        mCharacter = static_cast&lt;Creature*&gt;(GameObjectManager::getSingleton().getGameObject(mCharacterId));
 
         if (mCharacter != NULL)
 		{

Modified: rl/trunk/engine/ui/src/DebugWindow.cpp
===================================================================
--- rl/trunk/engine/ui/src/DebugWindow.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/DebugWindow.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -22,11 +22,11 @@
 #include &quot;InputManager.h&quot;
 #include &quot;GameLoop.h&quot;
 
-#include &quot;Person.h&quot;
 #include &quot;Actor.h&quot;
 #include &quot;ActorManager.h&quot;
 #include &quot;CameraObject.h&quot;
 #include &quot;CoreSubsystem.h&quot;
+#include &quot;Creature.h&quot;
 #include &quot;Exception.h&quot;
 #include &quot;MeshObject.h&quot;
 

Modified: rl/trunk/engine/ui/src/DialogControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/DialogControlState.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/DialogControlState.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -25,6 +25,7 @@
 #include &quot;CommandMapper.h&quot;
 #include &quot;ConfigurationManager.h&quot;
 #include &quot;CoreSubsystem.h&quot;
+#include &quot;Creature.h&quot;
 #include &quot;Dialog.h&quot;
 #include &quot;DialogElement.h&quot;
 #include &quot;DialogParagraph.h&quot;
@@ -35,7 +36,6 @@
 #include &quot;InputManager.h&quot;
 #include &quot;MeshAnimation.h&quot;
 #include &quot;MeshObject.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;PhysicalThing.h&quot;
 #include &quot;Sound.h&quot;
 #include &quot;SoundDriver.h&quot;
@@ -57,7 +57,7 @@
 namespace rl {
 
     DialogControlState::DialogControlState(CommandMapper* cmdMapper,
-        Actor* camera, Person* character)
+        Actor* camera, Creature* character)
         : ControlState(cmdMapper, camera, character, CST_DIALOG),
         mTargetCameraPosition(Vector3::ZERO),
         mTargetCameraDirection(Vector3::UNIT_Z),

Modified: rl/trunk/engine/ui/src/FreeflightControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/FreeflightControlState.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/FreeflightControlState.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -29,15 +29,13 @@
 #include &quot;CommandMapper.h&quot;
 #include &quot;MeshObject.h&quot;
 #include &quot;WindowManager.h&quot;
-#include &quot;Person.h&quot;
 
-
 using namespace Ogre;
 
 namespace rl {
 
 	FreeflightControlState::FreeflightControlState(CommandMapper* cmdMapper,
-        Actor* camera, Person* character)
+        Actor* camera, Creature* character)
 		: ControlState(cmdMapper, camera, character, CST_FREEFLIGHT),
 		mMovementSpeed(5.0f),
 		mSpeedRange(0.03f, 90.0f),

Modified: rl/trunk/engine/ui/src/InputManager.cpp
===================================================================
--- rl/trunk/engine/ui/src/InputManager.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/InputManager.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -386,7 +386,7 @@
     void InputManager::pushControlState(ControlStateType controlStateType)
     {
         Actor* camera = ActorManager::getSingleton().getActor(&quot;DefaultCamera&quot;);
-        Person* character = UiSubsystem::getSingleton().getActiveCharacter();
+        Creature* character = UiSubsystem::getSingleton().getActiveCharacter();
 
         ControlState* controller = NULL;
         switch (controlStateType)

Modified: rl/trunk/engine/ui/src/MovementControlState.cpp
===================================================================
--- rl/trunk/engine/ui/src/MovementControlState.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/MovementControlState.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -36,7 +36,6 @@
 #include &quot;MeshObject.h&quot;
 #include &quot;MeshAnimation.h&quot;
 #include &quot;MovementControlState.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;PhysicsManager.h&quot;
 #include &quot;PhysicsMaterialRaycast.h&quot;
 #include &quot;PhysicalThing.h&quot;
@@ -64,7 +63,7 @@
     }
 
     MovementControlState::MovementControlState(CommandMapper* cmdMapper,
-        Actor* camera, Person* character)
+        Actor* camera, Creature* character)
         : ControlState(cmdMapper, camera, character, CST_MOVEMENT),
         mController(NULL),
         mCharacterState(),

Modified: rl/trunk/engine/ui/src/UiSubsystem.cpp
===================================================================
--- rl/trunk/engine/ui/src/UiSubsystem.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/UiSubsystem.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -34,16 +34,17 @@
 #include &quot;CoreMessages.h&quot;
 #include &quot;CoreSubsystem.h&quot;
 #include &quot;ControlState.h&quot;
+#include &quot;Creature.h&quot;
 #include &quot;Exception.h&quot;
 #include &quot;GameLoop.h&quot;
+#include &quot;GameObjectManager.h&quot;
 #include &quot;InputManager.h&quot;
 #include &quot;Logger.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;ScriptWrapper.h&quot;
 #include &quot;SoundManager.h&quot;
+#include &quot;UiMessages.h&quot;
 #include &quot;WindowFactory.h&quot;
 #include &quot;WindowManager.h&quot;
-#include &quot;GameObjectManager.h&quot;
 
 using namespace Ogre;
 template&lt;&gt; rl::UiSubsystem* Singleton&lt;rl::UiSubsystem&gt;::ms_Singleton = 0;
@@ -142,18 +143,17 @@
         mWindowFactory-&gt;initialize();
     }
 
-
     CEGUI::OgreCEGUIRenderer* UiSubsystem::getGUIRenderer()
     {
         return mGuiRenderer;
     }
 
-    Person* UiSubsystem::getActiveCharacter() const
+    Creature* UiSubsystem::getActiveCharacter() const
     {
         return mCharacter;
     }
 
-    void UiSubsystem::setActiveCharacter(Person* person)
+    void UiSubsystem::setActiveCharacter(Creature* creature)
     {
         // Ensure we have a sound listener
         if (SoundManager::getSingleton().getListenerActor() == NULL)
@@ -161,28 +161,27 @@
             SoundManager::getSingleton().createListenerActor();
         }
 
-        // Nur wenn es sich veraendert hat
-        if( person != mCharacter )
+        if (creature != mCharacter )
         {
-            if( mCharacter != NULL )
+            if (mCharacter)
             {
                 ScriptWrapper::getSingleton().disowned( mCharacter );
                 mCharacter-&gt;getActor()-&gt;detach(SoundManager::getSingleton().getListenerActor());
                 mCharacter-&gt;setQueryFlags(mCharacter-&gt;getQueryFlags() &amp; (~QUERYFLAG_PLAYER));
             }
 
-            if (person == NULL)
+            if (!creature)
             {
                 mCharacter = NULL;
                 mInputManager-&gt;clearControlStates();
             }
             else
             {
-                ScriptWrapper::getSingleton().owned( person );
-                mCharacter = person;
+                ScriptWrapper::getSingleton().owned(creature);
+                mCharacter = creature;
                 mCharacter-&gt;addQueryFlag(QUERYFLAG_PLAYER);
 
-                mWindowFactory-&gt;setActiveCharacter(person);
+                mWindowFactory-&gt;setActiveCharacter(creature);
 
                 mCharacter-&gt;getActor()-&gt;attach(SoundManager::getSingleton().getListenerActor());
                 LOG_MESSAGE(Logger::UI, &quot;SoundListener attached.&quot;);
@@ -190,6 +189,8 @@
                 // Reset control stack for the new Character and set to movement.
                 mInputManager-&gt;setControlState(CST_MOVEMENT);
             }
+
+            MessagePump::getSingleton().sendMessage&lt;MessageType_ActiveCharacterChanged&gt;(creature);
         }
     }
 
@@ -205,14 +206,14 @@
 
     bool UiSubsystem::onGameObjectsLoaded()
     {
-        if(mCharacterId != -1)
+        if (mCharacterId != -1)
         {
-            Person* person = static_cast&lt;Person*&gt;(GameObjectManager::getSingleton().getGameObject(mCharacterId));
+            Creature* character = static_cast&lt;Creature*&gt;(GameObjectManager::getSingleton().getGameObject(mCharacterId));
 
-            ScriptWrapper::getSingleton().owned( person );
-            mCharacter = person;
+            ScriptWrapper::getSingleton().owned(character);
+            mCharacter = character;
 
-            mWindowFactory-&gt;setActiveCharacter(person);
+            mWindowFactory-&gt;setActiveCharacter(character);
 
             mCharacter-&gt;getActor()-&gt;attach(SoundManager::getSingleton().getListenerActor());
             LOG_MESSAGE(Logger::UI, &quot;SoundListener attached.&quot;);

Modified: rl/trunk/engine/ui/src/WindowFactory.cpp
===================================================================
--- rl/trunk/engine/ui/src/WindowFactory.cpp	2008-04-21 19:40:21 UTC (rev 4361)
+++ rl/trunk/engine/ui/src/WindowFactory.cpp	2008-04-22 19:49:02 UTC (rev 4362)
@@ -26,6 +26,7 @@
 #include &quot;CombatWindow.h&quot;
 #include &quot;Console.h&quot;
 #include &quot;CoreSubsystem.h&quot;
+#include &quot;Creature.h&quot;
 #include &quot;DebugWindow.h&quot;
 #include &quot;DialogControlState.h&quot;
 #include &quot;DialogWindow.h&quot;
@@ -48,7 +49,6 @@
 #include &quot;MainMenuEngineWindow.h&quot;
 #include &quot;MovableText.h&quot;
 #include &quot;ObjectDescriptionWindow.h&quot;
-#include &quot;Person.h&quot;
 #include &quot;PlaylistWindow.h&quot;
 #include &quot;QuestBook.h&quot;
 #include &quot;RubyInterpreter.h&quot;
@@ -271,11 +271,14 @@
         (new AboutWindow())-&gt;setVisible(true);
     }
 
-    void WindowFactory::showCharacterSheet(Person* chara)
+    void WindowFactory::showCharacterSheet(Creature* chara)
     {
-        CharacterSheetWindow* wnd = new CharacterSheetWindow();
-        wnd-&gt;setCharacter(chara);
-        wnd-&gt;setVisible(true);
+        if (!mCharacterSheet) 
+        {
+            mCharacterSheet = new CharacterSheetWindow();
+        }
+        mCharacterSheet-&gt;setCharacter(chara);
+        mCharacterSheet-&gt;setVisible(true);
     }
 
     void WindowFactory::showDescriptionWindow(GameObject* obj)
@@ -358,6 +361,16 @@
     void WindowFactory::setActiveCharacter(Creature* character)
     {
         mCharacterStateWindow-&gt;setCharacter(character);
+        if (mCharacterSheet) 
+        {
+            mCharacterSheet-&gt;setCharacter(character);
+        }
+
+        if (mInventoryWindow &amp;&amp; mInventoryWindow-&gt;isVisible())
+        {
+            toggleInventoryWindow();
+        }
+
         LOG_MESSAGE(Logger::UI, &quot;CharacterStateWindow updated&quot;);
     }
 


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001432.html">[Dsa-hl-svn] r4361 - rl/trunk/engine/rules/src
</A></li>
	<LI>Next message: <A HREF="001434.html">[Dsa-hl-svn] r4363 - modules/common/scripts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1433">[ date ]</a>
              <a href="thread.html#1433">[ thread ]</a>
              <a href="subject.html#1433">[ subject ]</a>
              <a href="author.html#1433">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/dsa-hl-svn">More information about the Dsa-hl-svn
mailing list</a><br>
</body></html>
