From alassion at mail.berlios.de  Wed Jul  2 21:45:24 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 21:45:24 +0200
Subject: [Dsa-hl-svn] r4413 - tools/blender_scripts
Message-ID: <200807021945.m62JjOQ1016730@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 21:45:18 +0200 (Wed, 02 Jul 2008)
New Revision: 4413

Removed:
   tools/blender_scripts/ogrelevelexport_kanalisation.py
Log:
- deleted to add new script

Deleted: tools/blender_scripts/ogrelevelexport_kanalisation.py
===================================================================
--- tools/blender_scripts/ogrelevelexport_kanalisation.py	2008-06-30 19:40:07 UTC (rev 4412)
+++ tools/blender_scripts/ogrelevelexport_kanalisation.py	2008-07-02 19:45:18 UTC (rev 4413)
@@ -1,5567 +0,0 @@
-#!BPY
-
-"""
-Name: 'Rastullah Quick Level Viewer Kanalisation'
-Blender: 242
-Group: 'Export'
-Tooltip: 'Exports Scene and non marked Meshes into kanalisation module and RL and starts theself afterwards'
-"""
-
-__author__ = ['Julius Schulz']
-__version__ = '0.0.1'
-__url__ = ['Project Page, http://www.rastullahs-lockenpracht.de/',
-	'Team Pantheon, http://www.team-pantheon.de/']
-__bpydoc__ = """\
-Exports Scene and non marked Meshes into kanalisation module and RL and starts theself afterwards
-"""
-
-# Copyright (C) 2006  Julius Schulz for Rastullahs Lockenpracht Modifications
-# Copyright (C) 2005  Michel Reimpell for Scene Exporter
-# Copyright (C) 2004-2005 Michael Reimpell for Mesh Exporter -- <M.Reimpell at tu-bs.de>
-# Copyright (C) 2003 Jens Hoffmann for Mesh Exporter -- <hoffmajs at gmx.de>
-# Copyright (C) 2003 Jean-Baptiste LAMY for Mesh Exporter -- jiba at tuxfamily.org
-#
-# This library is free software; you can redistribute it and/or
-# modify it under the terms of the GNU Lesser General Public
-# License as published by the Free Software Foundation; either
-# version 2.1 of the License, or (at your option) any later version.
-# 
-# This library is distributed in the hope that it will be useful,
-# but WITHOUT ANY WARRANTY; without even the implied warranty of
-# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
-# Lesser General Public License for more details.
-# 
-# You should have received a copy of the GNU Lesser General Public
-# License along with this library; if not, write to the Free Software
-# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
-
-# epydoc doc format
-__docformat__ = "javadoc en"
-
-######
-# imports
-######
-import sys
-
-try:
-	import Blender
-except ImportError:
-	sys.exit("Please run this script from within Blender!\nSee the script's manual for more information.")
-
-import os, math
-
-######
-# namespaces
-######
-from Blender import Draw
-from Blender import Mathutils
-from Blender import Registry
-from Blender.BGL import *
-
-######
-# globals
-rastullah_path = "E:\\Rastullah\\rl_dist_20071809\\"
-kanalisation_subpath = "modules\\kanalisation\\"
-kanalisation_substring = kanalisation_subpath + "maps"
-full_path = rastullah_path+kanalisation_substring
-OGRE_OPENGL_VERTEXCOLOUR = 0
-OGRE_XML_CONVERTER = 'E:\\Rastullah\\OgreCommandLineTools\\OgreXmlConverter.exe'
-OGRE_MESH_UPGRADE = 'E:\\Rastullah\\OgreCommandLineTools\\OgreMeshUpgrade.exe -t -td tagent'
-KEEP_SETTINGS = 0
-
-def hasProperty(object, name):
-	properties = object.getAllProperties()
-	for prop in properties:
-		if prop.getName() == name:
-			return 1
-	return 0
-######
-
-######
-# mesh export stuff
-class ReplacementScrollbar:
-    """Scrollbar replacement for Draw.Scrollbar
-       <ul>
-       <li> import Blender
-       <li> call eventFilter and buttonFilter in registered callbacks
-       </ul>
-
-       @author Michael Reimpell
-    """
-    def __init__(self, initialValue, minValue, maxValue, buttonUpEvent, buttonDownEvent):
-        """Constructor
-
-           @param initialValue    inital value
-           @param minValue        minimum value
-           @param maxValue        maxium value
-           @param buttonUpEvent   unique event number
-           @param buttonDownEvent unique event number
-        """
-        self.currentValue = initialValue
-        self.minValue = minValue
-        if maxValue > minValue:
-            self.maxValue = maxValue
-        else:
-            self.maxValue = self.minValue
-            self.minValue = maxValue
-        self.buttonUpEvent = buttonUpEvent
-        self.buttonDownEvent = buttonDownEvent
-        # private
-        self.guiRect = [0,0,0,0]
-        self.positionRect = [0,0,0,0]
-        self.markerRect = [0,0,0,0]
-        self.mousePressed = 0
-        self.mouseFocusX = 0
-        self.mouseFocusY = 0
-        self.markerFocusY = 0
-        self.mousePositionY = 0
-        return
-
-    def getCurrentValue(self):
-        """current marker position
-        """
-        return self.currentValue
-
-    def up(self, steps=1):
-        """move scrollbar up
-        """
-        if (steps > 0):
-            if ((self.currentValue - steps) > self.minValue):
-                self.currentValue -= steps
-            else:
-                self.currentValue = self.minValue
-        return
-
-    def down(self, steps=1):
-        """move scrollbar down
-        """
-        if (steps > 0):
-            if ((self.currentValue + steps) < self.maxValue):
-                self.currentValue += steps
-            else:
-                self.currentValue = self.maxValue
-        return
-
-    def draw(self, x, y, width, height):
-        """draw scrollbar
-        """
-        # get size of the GUI window to translate MOUSEX and MOUSEY events
-        guiRectBuffer = Blender.BGL.Buffer(GL_FLOAT, 4)
-        Blender.BGL.glGetFloatv(Blender.BGL.GL_SCISSOR_BOX, guiRectBuffer)
-        self.guiRect = [int(guiRectBuffer.list[0]), int(guiRectBuffer.list[1]), \
-                        int(guiRectBuffer.list[2]), int(guiRectBuffer.list[3])]
-        # relative position
-        self.positionRect = [ x, y, x + width, y + height]
-        # check minimal size:
-        # 2 square buttons,4 pixel borders and 1 pixel inside for inner and marker rectangles
-        if ((height > (2*(width+5))) and (width > 2*5)):
-            # keep track of remaining area
-            remainRect = self.positionRect[:]
-            # draw square buttons
-            Blender.Draw.Button("/\\", self.buttonUpEvent, x, y + (height-width), width, width, "scroll up")
-            remainRect[3] -=  width + 2
-            Blender.Draw.Button("\\/", self.buttonDownEvent, x, y, width, width, "scroll down")
-            remainRect[1] +=  width + 1
-            # draw inner rectangle
-            Blender.BGL.glColor3f(0.13,0.13,0.13) # dark grey
-            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-            remainRect[0] += 1
-            remainRect[3] -= 1
-            Blender.BGL.glColor3f(0.78,0.78,0.78) # light grey
-            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-            remainRect[1] += 1
-            remainRect[2] -= 1
-            Blender.BGL.glColor3f(0.48,0.48,0.48) # grey
-            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-            # draw marker rectangle
-            # calculate marker rectangle
-            innerHeight = remainRect[3]-remainRect[1]
-            markerHeight = innerHeight/(self.maxValue-self.minValue+1.0)
-            # markerRect
-            self.markerRect[0] = remainRect[0]
-            self.markerRect[1] = remainRect[1] + (self.maxValue - self.currentValue)*markerHeight
-            self.markerRect[2] = remainRect[2]
-            self.markerRect[3] = self.markerRect[1] + markerHeight
-            # clip markerRect to innerRect (catch all missed by one errors)
-            if self.markerRect[1] > remainRect[3]:
-                self.markerRect[1] = remainRect[3]
-            if self.markerRect[3] > remainRect[3]:
-                self.markerRect[3] = remainRect[3]
-            # draw markerRect
-            remainRect = self.markerRect
-            Blender.BGL.glColor3f(0.78,0.78,0.78) # light grey
-            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-            remainRect[0] += 1
-            remainRect[3] -= 1
-            Blender.BGL.glColor3f(0.13,0.13,0.13) # dark grey
-            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-            remainRect[1] += 1
-            remainRect[2] -= 1
-            # check if marker has foucs
-            if (self.mouseFocusX and self.mouseFocusY and (self.mousePositionY > self.markerRect[1]) and (self.mousePositionY < self.markerRect[3])):
-                Blender.BGL.glColor3f(0.64,0.64,0.64) # marker focus grey
-            else:
-                Blender.BGL.glColor3f(0.60,0.60,0.60) # marker grey
-            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-        else:
-            print "scrollbar draw size too small!"
-        return
-
-    def eventFilter(self, event, value):
-        """event filter for keyboard and mouse input events
-           call it inside the registered event function
-        """
-        if (value != 0):
-            # Buttons
-            if (event == Blender.Draw.PAGEUPKEY):
-                self.up(3)
-                Blender.Draw.Redraw(1)
-            elif (event == Blender.Draw.PAGEDOWNKEY):
-                self.down(3)
-                Blender.Draw.Redraw(1)
-            elif (event == Blender.Draw.UPARROWKEY):
-                self.up(1)
-                Blender.Draw.Redraw(1)
-            elif (event == Blender.Draw.DOWNARROWKEY):
-                self.down(1)
-                Blender.Draw.Redraw(1)
-            # Mouse
-            elif (event == Blender.Draw.MOUSEX):
-                # check if mouse is inside positionRect
-                if (value >= (self.guiRect[0] + self.positionRect[0])) and (value <= (self.guiRect[0] + self.positionRect[2])):
-                    # redraw if marker got focus
-                    if (not self.mouseFocusX) and self.mouseFocusY:
-                        Blender.Draw.Redraw(1)
-                    self.mouseFocusX = 1
-                else:
-                    # redraw if marker lost focus
-                    if self.mouseFocusX and self.mouseFocusY:
-                        Blender.Draw.Redraw(1)
-                    self.mouseFocusX = 0
-            elif (event == Blender.Draw.MOUSEY):
-                # check if mouse is inside positionRect
-                if (value >= (self.guiRect[1] + self.positionRect[1])) and (value <= (self.guiRect[1] + self.positionRect[3])):
-                    self.mouseFocusY = 1
-                    # relative mouse position
-                    self.mousePositionY = value - self.guiRect[1]
-                    if ((self.mousePositionY > self.markerRect[1]) and (self.mousePositionY < self.markerRect[3])):
-                        # redraw if marker got focus
-                        if self.mouseFocusX and (not self.markerFocusY):
-                            Blender.Draw.Redraw(1)
-                        self.markerFocusY = 1
-                    else:
-                        # redraw if marker lost focus
-                        if self.mouseFocusX and self.markerFocusY:
-                            Blender.Draw.Redraw(1)
-                        self.markerFocusY = 0
-                    # move marker
-                    if (self.mousePressed == 1):
-                        # calculate step from distance to marker
-                        if (self.mousePositionY > self.markerRect[3]):
-                            # up
-                            self.up(1)
-                            Blender.Draw.Draw()
-                        elif (self.mousePositionY < self.markerRect[1]):
-                            # down
-                            self.down(1)
-                            Blender.Draw.Draw()
-                        # redraw if marker lost focus
-                        if self.mouseFocusX and self.mouseFocusY:
-                            Blender.Draw.Redraw(1)
-                else:
-                    # redraw if marker lost focus
-                    if self.mouseFocusX and self.markerFocusY:
-                        Blender.Draw.Redraw(1)
-                    self.markerFocusY = 0
-                    self.mouseFocusY = 0
-            elif ((event == Blender.Draw.LEFTMOUSE) and (self.mouseFocusX == 1) and (self.mouseFocusY == 1)):
-                self.mousePressed = 1
-                # move marker
-                if (self.mousePositionY > self.markerRect[3]):
-                    # up
-                    self.up(1)
-                    Blender.Draw.Redraw(1)
-                elif (self.mousePositionY < self.markerRect[1]):
-                    # down
-                    self.down(1)
-                    Blender.Draw.Redraw(1)
-            elif (Blender.Get("version") >= 234):
-                if (event == Blender.Draw.WHEELUPMOUSE):
-                    self.up(1)
-                    Blender.Draw.Redraw(1)
-                elif (event == Blender.Draw.WHEELDOWNMOUSE):
-                    self.down(1)
-                    Blender.Draw.Redraw(1)
-        else: # released keys and buttons
-            if (event == Blender.Draw.LEFTMOUSE):
-                self.mousePressed = 0
-
-        return
-
-    def buttonFilter(self, event):
-        """button filter for Draw Button events
-           call it inside the registered button function
-        """
-        if (event  == self.buttonUpEvent):
-            self.up()
-            Blender.Draw.Redraw(1)
-        elif (event == self.buttonDownEvent):
-            self.down()
-            Blender.Draw.Redraw(1)
-        return
-
-class ArmatureAction:
-    """Resembles Blender's actions
-       <ul>
-       <li> import Blender, string
-       </ul>
-
-       @author Michael Reimpell
-    """
-    def __init__(self, name="", ipoDict=None):
-        """Constructor
-
-           @param name    the action name
-           @param ipoDict a dictionary with bone names as keys and action Ipos as values
-        """
-        self.firstKeyFrame = None
-        self.lastKeyFrame = None
-        self.name = name
-        # ipoDict[boneName] = Blender.Ipo
-        if ipoDict is None:
-            self.ipoDict = {}
-        else:
-            self.ipoDict = ipoDict
-            self._updateKeyFrameRange()
-        return
-
-    # private method
-    def _updateKeyFrameRange(self):
-        """Updates firstKeyFrame and lastKeyFrame considering the current IpoCurves.
-        """
-        self.firstKeyFrame = None
-        self.lastKeyFrame = None
-        if self.ipoDict is not None:
-            # check all bone Ipos
-            for ipo in self.ipoDict.values():
-                # check all IpoCurves
-                for ipoCurve in ipo.getCurves():
-                    # check first and last keyframe
-                    for bezTriple in ipoCurve.getPoints():
-                        iFrame = bezTriple.getPoints()[0]
-                        if ((iFrame < self.firstKeyFrame) or (self.firstKeyFrame is None)):
-                            self.firstKeyFrame = iFrame
-                        if ((iFrame > self.lastKeyFrame) or (self.lastKeyFrame is None)):
-                            self.lastKeyFrame = iFrame
-        if self.firstKeyFrame == None:
-            self.firstKeyFrame = 1
-        if self.lastKeyFrame == None:
-            self.lastKeyFrame = 1
-        return
-
-    # static method
-    def createArmatureActionDict(object):
-        """Creates a dictionary of possible actions belonging to an armature.
-           Static call with: ArmatureAction.createArmatureActionDict(object)
-
-           @param object a Blender.Object of type Armature
-           @return a dictionary of ArmatureAction objects with name as key and ArmatureAction as value
-        """
-        # create bone dict
-        #boneQueue = object.getData().bones
-        boneDict = object.getData().bones
-
-        boneNameList = boneDict.keys()
-        # check for available actions
-        armatureActionDict = {}
-        ## get linked action first
-        linkedAction = object.getAction()
-        if linkedAction is not None:
-            # check all bones
-            linkedActionIpoDict = linkedAction.getAllChannelIpos()
-            hasValidChannel = 0 # false
-            iBone = 0
-            while ((not hasValidChannel) and (iBone < len(boneNameList))):
-                if (linkedActionIpoDict.keys().count(boneNameList[iBone]) == 1):
-                    if linkedActionIpoDict[boneNameList[iBone]].getNcurves():
-                        hasValidChannel = 1 # true
-                    else:
-                        iBone += 1
-                else:
-                    iBone += 1
-            if hasValidChannel:
-                # add action
-                armatureActionDict[linkedAction.getName()] = ArmatureAction(linkedAction.getName(), linkedActionIpoDict)
-        ## get other actions != linked action
-        actionDict = Blender.Armature.NLA.GetActions()
-        for actionName in actionDict.keys():
-            # check if action is not linked action
-            if actionDict[actionName] is not linkedAction:
-                # check all bones
-                actionIpoDict = actionDict[actionName].getAllChannelIpos()
-                hasValidChannel = 0 # false
-                iBone = 0
-                while ((not hasValidChannel) and (iBone < len(boneNameList))):
-                    if (actionIpoDict.keys().count(boneNameList[iBone]) == 1):
-                        if actionIpoDict[boneNameList[iBone]].getNcurves():
-                            hasValidChannel = 1 # true
-                        else:
-                            iBone += 1
-                    else:
-                        iBone += 1
-                if hasValidChannel:
-
-                    # add action
-                    armatureActionDict[actionName] = ArmatureAction(actionName, actionIpoDict)
-        return armatureActionDict
-    createArmatureActionDict = staticmethod(createArmatureActionDict)
-
-class ArmatureActionActuator:
-    """Resembles Blender's action actuators.
-
-       @author Michael Reimpell
-    """
-    def __init__(self, name, startFrame, endFrame, armatureAction):
-        """Constructor
-
-           @param name           Animation name
-           @param startFrame     first frame of the animation
-           @param endFrame       last frame of the animation
-           @param armatureAction ArmatureAction object of the animation
-        """
-        self.name = name
-        self.startFrame = startFrame
-        self.endFrame = endFrame
-        self.armatureAction = armatureAction
-        return
-
-class ArmatureActionActuatorListView:
-    """Mangages a list of ArmatureActionActuators.
-       <ul>
-       <li> import Blender
-       <li> call eventFilter and buttonFilter in registered callbacks
-       </ul>
-
-       @author Michael Reimpell
-    """
-    def __init__(self, armatureActionDict, maxActuators, buttonEventRangeStart, armatureAnimationDictList=None):
-        """Constructor.
-
-           @param armatureActionDict        possible armature actuator actions
-           @param maxActuators              maximal number of actuator list elements
-           @param buttonEventRangeStart     first button event number.
-                                            The number of used event numbers is (3 + maxActuators*5)
-           @param armatureAnimationDictList list of armature animations (see getArmatureAnimationDictList())
-        """
-        self.armatureActionDict = armatureActionDict
-        self.maxActuators = maxActuators
-        self.buttonEventRangeStart = buttonEventRangeStart
-        self.armatureActionActuatorList = []
-        self.armatureActionMenuList = []
-        self.startFrameNumberButtonList = []
-        self.endFrameNumberButtonList = []
-        self.animationNameStringButtonList = []
-        # scrollbar values:
-        #   0:(len(self.armatureActionActuatorList)-1) = listIndex
-        #   len(self.armatureActionActuatorList) = addbuttonline
-        self.scrollbar = ReplacementScrollbar(0,0,0, self.buttonEventRangeStart+1, self.buttonEventRangeStart+2)
-        if armatureAnimationDictList is not None:
-            # rebuild ArmatureActionActuators for animationList animations
-            for animationDict in armatureAnimationDictList:
-                # check if Action is available
-                if self.armatureActionDict.has_key(animationDict['actionKey']):
-                    armatureActionActuator = ArmatureActionActuator(animationDict['name'], \
-                                                                    animationDict['startFrame'], \
-                                                                    animationDict['endFrame'], \
-                                                                    self.armatureActionDict[animationDict['actionKey']])
-                    self._addArmatureActionActuator(armatureActionActuator)
-        else:
-            # create default ArmatureActionActuators
-            for armatureAction in self.armatureActionDict.values():
-                # add default action
-                armatureActionActuator = ArmatureActionActuator(armatureAction.name, armatureAction.firstKeyFrame, armatureAction.lastKeyFrame, armatureAction)
-                self._addArmatureActionActuator(armatureActionActuator)
-        return
-
-    def refresh(self, armatureActionDict):
-        """Delete ArmatureActionActuators for removed Actions.
-
-           @param armatureActionDict possible ArmatureActuator actions
-        """
-        self.armatureActionDict = armatureActionDict
-        # delete ArmatureActionActuators for removed Actions
-        for armatureActionActuator in self.armatureActionActuatorList[:]:
-            # check if action is still available
-            if not self.armatureActionDict.has_key(armatureActionActuator.armatureAction.name):
-                # remove armatureActionActuator from lists
-                listIndex = self.armatureActionActuatorList.index(armatureActionActuator)
-                self._deleteArmatureActionActuator(listIndex)
-        Blender.Draw.Redraw(1)
-        return
-
-    def draw(self, x, y, width, height):
-        """draw actuatorList
-           use scrollbar if needed
-        """
-        # black border
-        minX = x
-        minY = y
-        maxX = x + width
-        maxY = y + height
-        minWidth = 441
-        if ((width - 5) > minWidth):
-            glColor3f(0.0,0.0,0.0)
-            glRectf(minX, minY, maxX - 22, maxY)
-            glColor3f(0.6,0.6,0.6) # Background: grey
-            glRectf(minX + 1, minY + 1, maxX - 23, maxY - 1)
-            x += 3
-            y += 3
-            width -= 5
-            height -= 6
-        else:
-            print "ArmatureActionActuatorListView draw size to small!"
-            glColor3f(0.0,0.0,0.0)
-            glRectf(minX, minY, maxX, maxY)
-            glColor3f(0.6,0.6,0.6) # Background: grey
-            glRectf(minX + 1, minY + 1, maxX, maxY - 1)
-            x += 3
-            y += 3
-            width -= 5
-            height -= 6
-        # Layout:
-        # |---- 105 ---|2|----80---|2|---80---|2|---- >80 ----|2|---60---|2|----20---|
-        # actionName   | startFrame | endFrame | animationName | [delete] | scrollbar
-        # [ add ]                                                         | scrollbar
-        if (len(self.armatureActionDict.keys()) > 0):
-            # construct actionMenu name
-            menuValue = 0
-            menuName = ""
-            for key in self.armatureActionDict.keys():
-                menuName += key + " %x" + ("%d" % menuValue) + "|"
-                menuValue +=1
-            # first line
-            lineY = y + height - 20
-            lineX = x
-            listIndex = self.scrollbar.getCurrentValue()
-            while ((listIndex < len(self.armatureActionActuatorList)) and (lineY >= y)):
-                # still armatureActionActuators left to draw
-                lineX = x
-                armatureActionActuator = self.armatureActionActuatorList[listIndex]
-                # draw actionMenu
-                event = self.buttonEventRangeStart + 3 + listIndex
-                menuValue = self.armatureActionDict.keys().index(armatureActionActuator.armatureAction.name)
-                self.armatureActionMenuList[listIndex] = Blender.Draw.Menu(menuName,event, x, lineY, 105, 20, menuValue, "Action name")
-                lineX += 107
-                # draw startFrameNumberButton
-                event = self.buttonEventRangeStart + 3 + self.maxActuators + listIndex
-                self.startFrameNumberButtonList[listIndex] = Blender.Draw.Number("Sta: ", event, lineX, lineY, 80, 20, \
-                                                         armatureActionActuator.startFrame, -18000, 18000, "Start frame")
-                lineX += 82
-                # draw endFrameNumberButton
-                event = self.buttonEventRangeStart + 3 + 2*self.maxActuators + listIndex
-                self.endFrameNumberButtonList[listIndex] = Blender.Draw.Number("End: ", event, lineX, lineY, 80, 20, \
-                                                         armatureActionActuator.endFrame, -18000, 18000, "End frame")
-                lineX += 82
-                # compute animationNameWidht
-                animationNameWidth = width - 271 - 85
-                if (animationNameWidth < 80):
-                    animationNameWidth = 80
-                # draw animationNameStringButton
-                event = self.buttonEventRangeStart + 3 + 3*self.maxActuators + listIndex
-                self.animationNameStringButtonList[listIndex] = Blender.Draw.String("",event, lineX, lineY, animationNameWidth, 20, \
-                                                                armatureActionActuator.name, 1000, "Animation export name")
-                lineX += animationNameWidth + 2
-                # draw deleteButton
-                event = self.buttonEventRangeStart + 3 + 4*self.maxActuators + listIndex
-                Draw.Button("Delete", event, lineX, lineY, 60, 20, "Delete export animation")
-                lineX += 62
-                # inc line
-                lineY -= 22
-                listIndex += 1
-            # draw add button
-            if (lineY >= y):
-                Draw.Button("Add", self.buttonEventRangeStart, x, lineY, 60, 20, "Add new export animation")
-        # draw scrollbar
-        if (width > minWidth):
-            # align left
-            self.scrollbar.draw(maxX - 20, minY, 20, (maxY - minY))
-        return
-
-    def eventFilter(self, event, value):
-        """event filter for keyboard and mouse input events
-           call it inside the registered event function
-        """
-        self.scrollbar.eventFilter(event,value)
-        return
-
-    def buttonFilter(self, event):
-        """button filter for Draw Button events
-           call it inside the registered button function
-        """
-        # button numbers = self.buttonEventRangeStart + buttonNumberOffset
-        # buttonNumberOffsets:
-        # addButton: 0
-        # scrollbar: 1 and 2
-        # actionMenu range: 3 <= event < 3 + maxActuators
-        # startFrameNumberButton range:  3 + maxActuators <= event < 3 + 2*maxActuators
-        # endFrameNumberButton range: 3 + 2*maxActuators <= event < 3 + 3*maxActuators
-        # animationNameStringButton range: 3 + 3*maxActuators <= event < 3 + 4*maxActuators
-        # deleteButton range: 3 + 4*maxActuators <= event < 3 + 5*maxActuators
-        self.scrollbar.buttonFilter(event)
-        relativeEvent = event - self.buttonEventRangeStart
-        if (relativeEvent == 0):
-            # add button pressed
-            if (len(self.armatureActionDict.keys()) > 0):
-                # add default ArmatureActionActuator
-                armatureAction = self.armatureActionDict[self.armatureActionDict.keys()[0]]
-                armatureActionActuator = ArmatureActionActuator(armatureAction.name, armatureAction.firstKeyFrame, armatureAction.lastKeyFrame, armatureAction)
-                self._addArmatureActionActuator(armatureActionActuator)
-                Blender.Draw.Redraw(1)
-        elif ((3 <= relativeEvent) and (relativeEvent < (3 + self.maxActuators))):
-            # actionMenu
-            listIndex = relativeEvent - 3
-            armatureActionActuator = self.armatureActionActuatorList[listIndex]
-            # button value is self.actionDict.keys().index
-            keyIndex = self.armatureActionMenuList[listIndex].val
-            key = self.armatureActionDict.keys()[keyIndex]
-            armatureActionActuator.armatureAction = self.armatureActionDict[key]
-            armatureActionActuator.startFrame = self.armatureActionDict[key].firstKeyFrame
-            armatureActionActuator.endFrame = self.armatureActionDict[key].lastKeyFrame
-            armatureActionActuator.name = self.armatureActionDict[key].name
-            self.armatureActionActuatorList[listIndex] = armatureActionActuator
-            Blender.Draw.Redraw(1)
-        elif (((3 + self.maxActuators) <= relativeEvent) and (relativeEvent < (3 + 2*self.maxActuators))):
-            # startFrameNumberButton
-            listIndex = relativeEvent - (3 + self.maxActuators)
-            armatureActionActuator = self.armatureActionActuatorList[listIndex]
-            armatureActionActuator.startFrame = self.startFrameNumberButtonList[listIndex].val
-            self.armatureActionActuatorList[listIndex] = armatureActionActuator
-        elif (((3 + 2*self.maxActuators) <= relativeEvent) and (relativeEvent < (3 + 3*self.maxActuators))):
-            # endFrameNumberButton
-            listIndex = relativeEvent - (3 + 2*self.maxActuators)
-            armatureActionActuator = self.armatureActionActuatorList[listIndex]
-            armatureActionActuator.endFrame = self.endFrameNumberButtonList[listIndex].val
-            self.armatureActionActuatorList[listIndex] = armatureActionActuator
-        elif (((3 + 3*self.maxActuators) <= relativeEvent) and (relativeEvent < (3 + 4*self.maxActuators))):
-            # animationNameStringButton
-            listIndex = relativeEvent - (3 + 3*self.maxActuators)
-            armatureActionActuator = self.armatureActionActuatorList[listIndex]
-            armatureActionActuator.name = self.animationNameStringButtonList[listIndex].val
-            self.armatureActionActuatorList[listIndex] = armatureActionActuator
-        elif (((3 + 4*self.maxActuators) <= relativeEvent) and (relativeEvent < (3 + 5*self.maxActuators))):
-            # deleteButton
-            listIndex = relativeEvent - (3 + 4*self.maxActuators)
-            self._deleteArmatureActionActuator(listIndex)
-            Blender.Draw.Redraw(1)
-        return
-
-    def getArmatureAnimationDictList(self):
-        """serialize the armatureActionActuatorList into a pickle storable list
-           Each item of the returned list is a dictionary with key-value pairs:
-           <ul>
-           <li>    name - ArmatureActionActuator.name
-           <li>    startFrame - ArmatureActionActuator.startFrame
-           <li>    endFrame - ArmatureActionActuator.endFrame
-           <li>    armatureActionKey - ArmatureActionActuator.armatureAction.name
-           </ul>
-
-           @return serialized actionActuatorList
-        """
-        animationDictList = []
-        for armatureActionActuator in self.armatureActionActuatorList:
-            # create animationDict
-            animationDict = {}
-            animationDict['name'] = armatureActionActuator.name
-            animationDict['startFrame'] = armatureActionActuator.startFrame
-            animationDict['endFrame'] = armatureActionActuator.endFrame
-            animationDict['actionKey'] = armatureActionActuator.armatureAction.name
-            animationDictList.append(animationDict)
-        return animationDictList
-
-    def setAnimationDictList(self, animationDictList):
-        """loads old AnimationDictList with actionKey = (ipoPrefix, ipoPostfix)
-
-           @see #getArmatureAnimationDictList()
-        """
-        # rebuild ArmatureActionActuators for animationList animations
-        for animationDict in animationDictList:
-            # check if Action is available
-            prefix, postfix = animationDict['actionKey']
-            armatureActionName = prefix+postfix
-            if self.armatureActionDict.has_key(armatureActionName):
-                armatureActionActuator = ArmatureActionActuator(animationDict['name'], \
-                                                                animationDict['startFrame'], \
-                                                                animationDict['endFrame'], \
-                                                                self.armatureActionDict[armatureActionName])
-                self._addArmatureActionActuator(armatureActionActuator)
-        return
-
-    # private methods
-    def _addArmatureActionActuator(self, armatureActionActuator):
-        """adds an ArmatureActionActuator to the list
-           <ul>
-           <li> call Blender.Draw.Redraw(1) afterwards
-           </ul>
-        """
-        if (len(self.armatureActionActuatorList) < self.maxActuators):
-            # check if armatureActionActuator.action is available
-            if armatureActionActuator.armatureAction.name in self.armatureActionDict.keys():
-                # create armatureActionMenu
-                # get ArmatureAction index in armatureActionDict.keys() list
-                armatureActionMenu = Draw.Create(self.armatureActionDict.keys().index(armatureActionActuator.armatureAction.name))
-                self.armatureActionMenuList.append(armatureActionMenu)
-                # create startFrameNumberButton
-                startFrameNumberButton = Draw.Create(int(armatureActionActuator.startFrame))
-                self.startFrameNumberButtonList.append(startFrameNumberButton)
-                # create endFrameNumberButton
-                endFrameNumberButton = Draw.Create(int(armatureActionActuator.endFrame))
-                self.endFrameNumberButtonList.append(endFrameNumberButton)
-                # create animationNameStringButton
-                animationNameStringButton = Draw.Create(armatureActionActuator.name)
-                self.animationNameStringButtonList.append(animationNameStringButton)
-                # append to armatureActionActuatorList
-                self.armatureActionActuatorList.append(armatureActionActuator)
-                # adjust scrollbar
-                scrollbarPosition = self.scrollbar.getCurrentValue()
-                self.scrollbar = ReplacementScrollbar(scrollbarPosition,0,len(self.armatureActionActuatorList), self.buttonEventRangeStart+1, self.buttonEventRangeStart+2)
-                # TODO: change scrollbarPosition in a way, such that the new actuator is visible
-            else:
-                print "Error: Could not add ArmatureActionActuator because ArmatureAction is not available!"
-        return
-
-    def _deleteArmatureActionActuator(self, listIndex):
-        """removes an ArmatureActionActuator from the list
-           <ul>
-           <li> call Blender.Draw.Redraw(1) afterwards
-           </ul>
-        """
-        # check listIndex
-        if ((len(self.armatureActionActuatorList) > 0) and (listIndex >= 0) and (listIndex < len(self.armatureActionActuatorList))):
-            # remove armatureActionMenu
-            self.armatureActionMenuList.pop(listIndex)
-            # remove startFrameNumberButton
-            self.startFrameNumberButtonList.pop(listIndex)
-            # remove endFrameNumberButton
-            self.endFrameNumberButtonList.pop(listIndex)
-            # remove animationNameStringButton
-            self.animationNameStringButtonList.pop(listIndex)
-            # remove armatureActionActuator
-            self.armatureActionActuatorList.pop(listIndex)
-            # adjust scrollbar
-            scrollbarPosition = self.scrollbar.getCurrentValue()
-            if (scrollbarPosition > len(self.armatureActionActuatorList)):
-                scrollbarPosition = len(self.armatureActionActuatorList)
-            self.scrollbar = ReplacementScrollbar(scrollbarPosition,0,len(self.armatureActionActuatorList), self.buttonEventRangeStart+1, self.buttonEventRangeStart+2)
-            return
-
-class Logger:
-    """Logs messages and status.
-
-       Logs messages as a list of strings and keeps track of the status.
-       Possible status values are info, warning and error.
-
-       @cvar INFO info status
-       @cvar WARNING warning status
-       @cvar ERROR error status
-    """
-    INFO, WARNING, ERROR = range(3)
-    def __init__(self):
-        """Constructor.
-        """
-        self.messageList = []
-        self.status = Logger.INFO
-        return
-    def logInfo(self, message):
-        """Logs an info message.
-
-           @param message message string
-        """
-        self.messageList.append((Logger.INFO, message))
-        return
-    def logWarning(self, message):
-        """Logs a warning message.
-
-           The status is set to <code>Logger.WARNING</code> if it is not already <code>Logger.ERROR</code>.
-
-           @param message message string
-        """
-        self.messageList.append((Logger.WARNING, "Warning: "+message))
-        if not self.status == Logger.ERROR:
-            self.status = Logger.WARNING
-        return
-    def logError(self, message):
-        """Logs an error message.
-
-           The status is set to <code>Logger.ERROR</code>.
-
-           @param message message string
-        """
-        self.messageList.append((Logger.ERROR, "Error: "+message))
-        self.status = Logger.ERROR
-        return
-    def getStatus(self):
-        """Gets the current status.
-
-           The status can be
-           <ul>
-           <li><code>Logger.INFO</code>
-           <li><code>Logger.WARNING</code>
-           <li><code>Logger.ERROR</code>
-           </ul>
-
-           @return status
-        """
-        return self.status
-    def getMessageList(self):
-        """Returns the list of log messages.
-
-           @return list of tuples (status, message)
-        """
-        return self.messageList
-
-class LogInterface:
-    def __init__(self):
-        self.loggerList = []
-    def addLogger(self, logger):
-        self.loggerList.append(logger)
-        return
-    def removeLogger(self, logger):
-        self.loggerList.remove(logger)
-        return
-    # protected
-    def _logInfo(self, message):
-        for logger in self.loggerList:
-            logger.logInfo(message)
-        return
-    def _logWarning(self, message):
-        for logger in self.loggerList:
-            logger.logWarning(message)
-        return
-    def _logError(self, message):
-        for logger in self.loggerList:
-            logger.logWarning(message)
-        return
-
-class PathName(LogInterface):
-    """Splits a pathname independent of the underlying os.
-
-       Blender saves pathnames in the os specific manner. Using os.path may result in problems
-       when the export is done on a different os than the creation of the .blend file.
-    """
-    def __init__(self, pathName):
-        self.pathName = pathName
-        LogInterface.__init__(self)
-        return
-    def dirname(self):
-        return os.path.dirname(self.pathName)
-    def basename(self):
-        baseName = os.path.basename(self.pathName)
-        # split from non-os directories
-        # \\
-        baseName = baseName.split('\\').pop()
-        # /
-        baseName = baseName.split('/').pop()
-        if (baseName != baseName.replace(' ','_')):
-            # replace whitespace with underscore
-            self._logWarning("Whitespaces in filename \"%s\" replaced with underscores." % baseName)
-            baseName = baseName.replace(' ','_')
-        return baseName
-    def path(self):
-        return self.pathName
-
-class ExportOptions:
-    """Encapsulates export options common to all objects.
-    """
-    # TODO: Model for GUI
-    def __init__(self, rotXAngle, rotYAngle, rotZAngle, scale, useWorldCoordinates, colouredAmbient, armatureExport, useGameEngineMaterials, exportPath, materialFilename):
-        """Constructor.
-        """
-        # floating point accuracy
-        self.accuracy = 1e-6
-        # export transformation
-        self.rotXAngle = rotXAngle
-        self.rotYAngle = rotYAngle
-        self.rotZAngle = rotZAngle
-        self.scale = scale
-        self.useWorldCoordinates = useWorldCoordinates
-        self.colouredAmbient = colouredAmbient
-        # file settings
-        self.exportPath = exportPath
-        self.materialFilename = materialFilename
-        self.armatureExport = armatureExport
-        self.useGameEngineMaterials = useGameEngineMaterials
-        return
-
-    def transformationMatrix(self):
-        """Returns the matrix representation for the additional transformation on export.
-        """
-        rotationMatrix = Mathutils.RotationMatrix(self.rotXAngle,4,'x')
-        rotationMatrix *= Mathutils.RotationMatrix(self.rotYAngle,4,'y')
-        rotationMatrix *= Mathutils.RotationMatrix(self.rotZAngle,4,'z')
-        scaleMatrix = Mathutils.Matrix([self.scale,0,0],[0,self.scale,0],[0,0,self.scale])
-        scaleMatrix.resize4x4()
-        return rotationMatrix*scaleMatrix
-
-class ObjectExporter:
-    """Interface. Exports a Blender object to Ogre.
-    """
-    def __init__(self, object):
-        """Constructor.
-
-           @param object Blender object to export.
-        """
-        self.object = object
-        return
-
-    def getName(self):
-        """Returns the name of the object.
-        """
-        return self.object.getName()
-
-    def getObjectMatrix(self):
-        """Returns the object matrix in worldspace.
-        """
-        return self.object.matrixWorld
-
-
-class MeshExporter(ObjectExporter):
-    """
-    """
-    def getName(self):
-        return self.object.getData().name
-
-class ArmatureExporter:
-    """Exports an armature of a mesh.
-    """
-    # TODO: Provide bone ids for vertex influences.
-    def __init__(self, meshObject, armatureObject):
-        """Constructor.
-
-          @param meshObject ObjectExporter.
-          @param armatureObject Blender armature object.
-        """
-        self.meshObject = meshObject
-        self.armatureObject = armatureObject
-        self.skeleton = None
-        return
-
-    def export(self, actionActuatorList, exportOptions, logger):
-        """Exports the armature.
-
-           @param actionActuatorList list of animations to export.
-           @param exportOptions global export options.
-           @param logger Logger Logger for log messages.
-        """
-        # convert Armature into Skeleton
-        name = None
-        if exportOptions.useWorldCoordinates:
-            name = self.armatureObject.getData().name
-        else:
-            name = self.meshObject.getName() + "-" + self.armatureObject.getData().name
-        skeleton = Skeleton(name)
-        skeleton = self._convertRestpose(skeleton, exportOptions, logger)
-
-        # convert ActionActuators into Animations
-        self._convertAnimations(skeleton, actionActuatorList, exportOptions, exportLogger)
-
-        # write to file
-        self._toFile(skeleton, exportOptions, exportLogger)
-
-        self.skeleton = skeleton
-        return
-
-    def _convertAnimations(self, skeleton, armatureActionActuatorList, exportOptions, exportLogger):
-        """Converts ActionActuators to Ogre animations.
-        """
-        # frames per second
-        fps = Blender.Scene.GetCurrent().getRenderingContext().framesPerSec()
-        # map armatureActionActuatorList to skeleton.animationsDict
-        for armatureActionActuator in armatureActionActuatorList:
-            # map armatureActionActuator to animation
-            if (not skeleton.animationsDict.has_key(armatureActionActuator.name)):
-                # create animation
-                animation = Animation(armatureActionActuator.name)
-                # map bones to tracks
-                for boneName in armatureActionActuator.armatureAction.ipoDict.keys():
-                    if (not(animation.tracksDict.has_key(boneName))):
-                        # get bone object
-                        if skeleton.bonesDict.has_key(boneName):
-                            # create track
-                            track = Track(animation, skeleton.bonesDict[boneName])
-                            # map ipocurves to keyframes
-                            # get ipo for that bone
-                            ipo = armatureActionActuator.armatureAction.ipoDict[boneName]
-                            # map curve names to curvepos
-                            curveId = {}
-                            index = 0
-                            have_quat = 0
-                            for curve in ipo.getCurves():
-                                try:
-                                    name = curve.getName()
-                                    if (name == "LocX" or name == "LocY" or name == "LocZ" or \
-                                    name == "SizeX" or name == "SizeY" or name == "SizeZ" or \
-                                    name == "QuatX" or name == "QuatY" or name == "QuatZ" or name == "QuatW"):
-                                        curveId[name] = index
-                                        index += 1
-                                    else:
-                                    # bug: 2.28 does not return "Quat*"...
-                                        if not have_quat:
-                                            curveId["QuatX"] = index
-                                            curveId["QuatY"] = index+1
-                                            curveId["QuatZ"] = index+2
-                                            curveId["QuatW"] = index+3
-                                            index += 4
-                                            have_quat = 1
-                                except TypeError:
-                                    # blender 2.32 does not implement IpoCurve.getName() for action Ipos
-                                    if not have_quat:
-                                        # no automatic assignments so far
-                                        # guess Ipo Names
-                                        nIpoCurves = ipo.getNcurves()
-                                        if nIpoCurves in [4,7,10]:
-                                            exportLogger.logWarning("IpoCurve.getName() not available!")
-                                            exportLogger.logWarning("The exporter tries to guess the IpoCurve names.")
-                                            if (nIpoCurves >= 7):
-                                                # not only Quats
-                                                # guess: Quats and Locs
-                                                curveId["LocX"] = index
-                                                curveId["LocY"] = index+1
-                                                curveId["LocZ"] = index+2
-                                                index += 3
-                                            if (nIpoCurves == 10):
-                                                # all possible Action IpoCurves
-                                                curveId["SizeX"] = index
-                                                curveId["SizeY"] = index+1
-                                                curveId["SizeZ"] = index+2
-                                                index += 3
-                                            if (nIpoCurves >= 4):
-                                                # at least 4 IpoCurves
-                                                # guess: 4 Quats
-                                                curveId["QuatX"] = index
-                                                curveId["QuatY"] = index+1
-                                                curveId["QuatZ"] = index+2
-                                                curveId["QuatW"] = index+3
-                                                index += 4
-                                            have_quat = 1
-                                        else:
-                                            exportLogger.logError("IpoCurve.getName() not available!")
-                                            exportLogger.logError("Could not guess the IpoCurve names. Other Blender versions may work.")
-                            # get all frame numbers between startFrame and endFrame where this ipo has a point in one of its curves
-                            frameNumberDict = {}
-                            for curveIndex in range(ipo.getNcurves()):
-                                for bez in range(ipo.getNBezPoints(curveIndex)):
-                                    frame = int(ipo.getCurveBeztriple(curveIndex, bez)[3])
-                                    frameNumberDict[frame] = frame
-                            frameNumberDict[armatureActionActuator.startFrame] = armatureActionActuator.startFrame
-                            frameNumberDict[armatureActionActuator.endFrame] = armatureActionActuator.endFrame
-                            # remove frame numbers not in the startFrame endFrame range
-                            if (armatureActionActuator.startFrame > armatureActionActuator.endFrame):
-                                minFrame = armatureActionActuator.endFrame
-                                maxFrame = armatureActionActuator.startFrame
-                            else:
-                                minFrame = armatureActionActuator.startFrame
-                                maxFrame = armatureActionActuator.endFrame
-                            for frameNumber in frameNumberDict.keys()[:]:
-                                if ((frameNumber < minFrame) or (frameNumber > maxFrame)):
-                                    del frameNumberDict[frameNumber]
-                            frameNumberList = frameNumberDict.keys()
-                            # convert frame numbers to seconds
-                            # frameNumberDict: key = export time, value = frame number
-                            frameNumberDict = {}
-                            for frameNumber in frameNumberList:
-                                if  (armatureActionActuator.startFrame <= armatureActionActuator.endFrame):
-                                    # forward animation
-                                    time = float(frameNumber-armatureActionActuator.startFrame)/fps
-                                else:
-                                    # backward animation
-                                    time = float(armatureActionActuator.endFrame-frameNumber)/fps
-                                # update animation duration
-                                if animation.duration < time:
-                                    animation.duration = time
-                                frameNumberDict[time] = frameNumber
-                            # create key frames
-                            timeList = frameNumberDict.keys()
-                            timeList.sort()
-                            for time in timeList:
-                                # Blender's ordering of transformations is deltaR*deltaS*deltaT
-                                # in the bone's coordinate system.
-                                frame = frameNumberDict[time]
-                                loc = ( 0.0, 0.0, 0.0 )
-                                rotQuat = Mathutils.Quaternion([1.0, 0.0, 0.0, 0.0])
-                                sizeX = 1.0
-                                sizeY = 1.0
-                                sizeZ = 1.0
-                                blenderLoc = [0, 0, 0]
-                                hasLocKey = 0 #false
-                                if curveId.has_key("LocX"):
-                                    blenderLoc[0] = ipo.EvaluateCurveOn(curveId["LocX"], frame)
-                                    hasLocKey = 1 #true
-                                if curveId.has_key("LocY"):
-                                    blenderLoc[1] = ipo.EvaluateCurveOn(curveId["LocY"], frame)
-                                    hasLocKey = 1 #true
-                                if curveId.has_key("LocZ"):
-                                    blenderLoc[2] = ipo.EvaluateCurveOn(curveId["LocZ"], frame)
-                                    hasLocKey = 1 #true
-                                if hasLocKey:
-                                    # Ogre's deltaT is in the bone's parent coordinate system
-                                    loc = point_by_matrix(blenderLoc, skeleton.bonesDict[boneName].conversionMatrix)
-                                if curveId.has_key("QuatX") and curveId.has_key("QuatY") and curveId.has_key("QuatZ") and curveId.has_key("QuatW"):
-                                    if not (Blender.Get("version") == 234):
-                                        rot = [ ipo.EvaluateCurveOn(curveId["QuatW"], frame), \
-                                                ipo.EvaluateCurveOn(curveId["QuatX"], frame), \
-                                                ipo.EvaluateCurveOn(curveId["QuatY"], frame), \
-                                                ipo.EvaluateCurveOn(curveId["QuatZ"], frame) ]
-                                        rotQuat = Mathutils.Quaternion(rot)
-                                    else:
-                                        # Blender 2.34 quaternion naming bug
-                                        rot = [ ipo.EvaluateCurveOn(curveId["QuatX"], frame), \
-                                                ipo.EvaluateCurveOn(curveId["QuatY"], frame), \
-                                                ipo.EvaluateCurveOn(curveId["QuatZ"], frame), \
-                                                ipo.EvaluateCurveOn(curveId["QuatW"], frame) ]
-                                        rotQuat = Mathutils.Quaternion(rot)
-                                    rotQuat.normalize()
-                                if curveId.has_key("SizeX"):
-                                    sizeX = ipo.EvaluateCurveOn(curveId["SizeX"], frame)
-                                if curveId.has_key("SizeY"):
-                                    sizeY = ipo.EvaluateCurveOn(curveId["SizeY"], frame)
-                                if curveId.has_key("SizeZ"):
-                                    sizeZ = ipo.EvaluateCurveOn(curveId["SizeZ"], frame)
-                                size = (sizeX, sizeY, sizeZ)
-                                KeyFrame(track, time, loc, rotQuat, size)
-                            # append track
-                            animation.tracksDict[boneName] = track
-                        else:
-                            # ipo name contains bone but armature doesn't
-                            exportLogger.logWarning("Unused action channel \"%s\" in action \"%s\" for skeleton \"%s\"." \
-                                             % (boneName, armatureActionActuator.armatureAction.name, skeleton.name))
-                    else:
-                        # track for that bone already exists
-                        exportLogger.logError("Ambiguous bone name \"%s\", track already exists." % boneName)
-                # append animation
-                skeleton.animationsDict[armatureActionActuator.name] = animation
-            else:
-                # animation export name already exists
-                exportLogger.logError("Ambiguous animation name \"%s\"." % armatureActionActuator.name)
-        return
-
-    def _convertRestpose(self, skeleton, exportOptions, logger):
-        """Calculate inital bone positions and rotations.
-        """
-        print "convert posed started"
-        obj = self.armatureObject
-        stack = []
-        matrix = None
-        matrix_one = Mathutils.Matrix([1.0, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, 1])
-        if exportOptions.useWorldCoordinates:
-            # world coordinates
-            matrix = obj.getMatrix("worldspace")
-        else:
-            # local mesh coordinates
-            armatureMatrix = obj.getMatrix("worldspace")
-            # Blender returns direct access to matrix but we only want a copy
-            # since we will be inverting it
-            inverseMeshMatrix = matrix_one * self.meshObject.getObjectMatrix()
-            inverseMeshMatrix.invert()
-            matrix = armatureMatrix*inverseMeshMatrix
-        # apply additional export transformation
-        matrix = matrix*exportOptions.transformationMatrix()
-        loc = [ 0.0, 0, 0 ]
-        parent = None
-
-        # get parent bones
-        #note: in Blender 2.4, bones returns a dictionary of all bones in an armature
-        boneDict = obj.getData().bones
-        for bbone in boneDict.values():
-            #print bbone, bbone.parent
-            if bbone.parent == None:
-                stack.append([bbone, parent, matrix, loc, 0, matrix_one])
-
-        # iterate through bones and build ogre equivalent bones
-        # blend bone matrix in armature space is perfect for ogre equivalency
-        #
-        while len(stack):
-            bbone, parent, accu_mat, parent_pos, parent_ds, invertedOgreTransformation = stack.pop()
-            # preconditions: (R : rotation, T : translation, S : scale, M: general transformation matrix)
-            #   accu_mat
-            #     points to the tail of the parents bone, i.e. for root bones
-            #     accu_mat = M_{object}*R_{additional on export}
-            #     and for child bones
-            #     accu_mat = T_{length of parent}*R_{parent}*T_{to head of parent}*M_{parent's parent}
-            #  invertedOgreTransformation
-            #    inverse of transformation done in Ogre so far, i.e. identity for root bones,
-            #    M^{-1}_{Ogre, parent's parent}*T^{-1}_{Ogre, parent}*R^{-1}_{Ogre, parent} for child bones.
-
-            head = bbone.head['BONESPACE']
-            tail = bbone.tail['BONESPACE']
-
-            # get the restmat
-            R_bmat = bbone.matrix['BONESPACE'].rotationPart()
-            rotQuat = R_bmat.toQuat()
-            R_bmat.resize4x4()
-
-            #get the bone's root offset (in the parent's coordinate system)
-            T_root = [ [       1,       0,       0,      0 ],
-            [       0,       1,       0,      0 ],
-            [       0,       0,       1,      0 ],
-            [ head[0], head[1], head[2],      1 ] ]
-
-            # get the bone length translation (length along y axis)
-            dx, dy, dz = tail[0] - head[0], tail[1] - head[1], tail[2] - head[2]
-            ds = math.sqrt(dx*dx + dy*dy + dz*dz)
-            T_len = [ [ 1,  0,  0,  0 ],
-                [ 0,  1,  0,  0 ],
-                [ 0,  0,  1,  0 ],
-                [ 0, ds,  0,  1 ] ]
-
-            # calculate bone points in world coordinates
-            accu_mat = matrix_multiply(accu_mat, T_root)
-            pos = point_by_matrix([ 0, 0, 0 ], accu_mat)
-
-            accu_mat = tmp_mat = matrix_multiply(accu_mat, R_bmat)
-            # tmp_mat = R_{bone}*T_{to head}*M_{parent}
-            accu_mat = matrix_multiply(accu_mat, T_len)
-
-            # local rotation and distance from parent bone
-            if parent:
-                rotQuat = bbone.matrix['BONESPACE'].rotationPart().toQuat()
-            else:
-                rotQuat = (bbone.matrix['BONESPACE'].rotationPart().resize4x4()*matrix).toQuat()
-
-            x, y, z = pos
-            # pos = loc * M_{Ogre}
-            loc = point_by_matrix([x, y, z], invertedOgreTransformation)
-            x, y, z = loc
-            ogreTranslationMatrix = [[ 1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [x, y, z, 1]]
-
-            # R_{Ogre} is either
-            # the rotation part of R_{bone}*T_{to_head}*M_{parent} for root bones or
-            # the rotation part of R_{bone}*T_{to_head} of child bones
-            ogreRotationMatrix = rotQuat.toMatrix()
-            ogreRotationMatrix.resize4x4()
-            invertedOgreTransformation = matrix_multiply(matrix_invert(ogreTranslationMatrix), invertedOgreTransformation)
-            parent = Bone(skeleton, parent, bbone.name, loc, rotQuat, matrix_multiply(invertedOgreTransformation, tmp_mat))
-            #print "bone created:", parent
-            # matrix_multiply(invertedOgreTransformation, tmp_mat) is R*T*M_{parent} M^{-1}_{Ogre}T^{-1}_{Ogre}.
-            # Necessary, since Ogre's delta location is in the Bone's parent coordinate system, i.e.
-            # deltaT_{Blender}*R*T*M = deltaT_{Ogre}*T_{Ogre}*M_{Ogre}
-            invertedOgreTransformation = matrix_multiply(matrix_invert(ogreRotationMatrix), invertedOgreTransformation)
-            if bbone.children is not None:
-                for child in bbone.children:
-                    # make sure child bone is attached to current parent
-                    if child.parent is not None:
-                        if child.parent.name == bbone.name:
-                            stack.append([child, parent, accu_mat, pos, ds, invertedOgreTransformation])
-        return skeleton
-
-    def _toFile(self, skeleton, exportOptions, exportLogger):
-        """Writes converted skeleton to file.
-        """
-        file = skeleton.name+".skeleton.xml"
-        exportLogger.logInfo("Skeleton \"%s\"" % file)
-        f = open(os.path.join(exportOptions.exportPath, file), "w")
-        f.write(tab(0)+"<skeleton>\n")
-        f.write(tab(1)+"<bones>\n")
-        for bone in skeleton.bones:
-            f.write(tab(2)+"<bone id=\"%d\" name=\"%s\">\n" % (bone.id, bone.name))
-
-            x, y, z = bone.loc
-            f.write(tab(3)+"<position x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % (x, y, z))
-
-            f.write(tab(3)+"<rotation angle=\"%.6f\">\n" % (bone.rotQuat.angle/360*2*math.pi))
-            f.write(tab(4)+"<axis x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(bone.rotQuat.axis))
-            f.write(tab(3)+"</rotation>\n")
-            f.write(tab(2)+"</bone>\n")
-        f.write(tab(1)+"</bones>\n")
-
-        f.write(tab(1)+"<bonehierarchy>\n")
-        for bone in skeleton.bones:
-            parent = bone.parent
-            if parent:
-                f.write(tab(2)+"<boneparent bone=\"%s\" parent=\"%s\"/>\n" % (bone.name, parent.name))
-        f.write(tab(1)+"</bonehierarchy>\n")
-
-        f.write(tab(1)+"<animations>\n")
-
-        for animation in skeleton.animationsDict.values():
-            name = animation.name
-
-            f.write(tab(2)+"<animation")
-            f.write(" name=\"%s\"" % name)
-            f.write(" length=\"%f\">\n" % animation.duration )
-
-            f.write(tab(3)+"<tracks>\n")
-            for track in animation.tracksDict.values():
-                f.write(tab(4)+"<track bone=\"%s\">\n" % track.bone.name)
-                f.write(tab(5)+"<keyframes>\n")
-
-                for keyframe in track.keyframes:
-                    f.write(tab(6)+"<keyframe time=\"%f\">\n" % keyframe.time)
-                    x, y, z = keyframe.loc
-                    f.write(tab(7)+"<translate x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % (x, y, z))
-                    f.write(tab(7)+"<rotate angle=\"%.6f\">\n" % (keyframe.rotQuat.angle/360*2*math.pi))
-
-                    f.write(tab(8)+"<axis x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(keyframe.rotQuat.axis))
-                    f.write(tab(7)+"</rotate>\n")
-
-                    f.write(tab(7)+"<scale x=\"%f\" y=\"%f\" z=\"%f\"/>\n" % keyframe.scale)
-
-                    f.write(tab(6)+"</keyframe>\n")
-
-                f.write(tab(5)+"</keyframes>\n")
-                f.write(tab(4)+"</track>\n");
-
-            f.write(tab(3)+"</tracks>\n");
-            f.write(tab(2)+"</animation>\n")
-
-        f.write(tab(1)+"</animations>\n")
-        f.write(tab(0)+"</skeleton>\n")
-        f.close()
-        convertXMLFile(os.path.join(exportOptions.exportPath, file))
-        return
-
-class ArmatureMeshExporter(ObjectExporter):
-    """Exports an armature object as mesh.
-
-       Converts a Blender armature into an animated Ogre mesh.
-    """
-    # TODO:    Use observer pattern for progress bar.
-    # TODO: Get bone ids from skeletonExporter class.
-    def __init__(self, armatureObject):
-        """Constructor.
-
-           @param armatureObject armature object to export.
-        """
-        # call base class constructor
-        ObjectExporter.__init__(self, armatureObject)
-        self.skeleton = None
-        return
-
-    def export(self, materialsDict, actionActuatorList, exportOptions, logger):
-        """Exports the mesh object.
-
-           @param materialsDict dictionary that contains already existing materials.
-           @param actionActuatorList list of animations to export.
-           @param exportOptions global export options.
-           @param logger Logger for log messages.
-           @return materialsDict with the new materials added.
-        """
-        # export skeleton
-        armatureExporter = ArmatureExporter(self, self.object)
-        armatureExporter.export(actionActuatorList, exportOptions, logger)
-        self.skeleton = armatureExporter.skeleton
-        self._convertToMesh(materialsDict, exportOptions, logger)
-        return materialsDict
-    def getName(self):
-        return self.object.getData().name
-
-    def _convertToMesh(self, materialsDict, exportOptions, logger):
-        """Creates meshes in form of the armature bones.
-        """
-        obj = self.object
-        stack = []
-        # list of bone data (boneName, startPosition, endPosition)
-        boneMeshList = []
-        matrix = None
-        if exportOptions.useWorldCoordinates:
-            # world coordinates
-            matrix = obj.getMatrix("worldspace")
-        else:
-            # local mesh coordinates
-            armatureMatrix = obj.getMatrix("worldspace")
-            matrix_one = Mathutils.Matrix([1.0, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, 1])
-            # note that blender returns direct access to the objects matrix but we only want
-            # a copy so force a copy
-            inverseMeshMatrix = matrix_one * self.getObjectMatrix()
-            inverseMeshMatrix.invert()
-            matrix = armatureMatrix * inverseMeshMatrix
-        # apply additional export transformation
-        matrix = matrix*exportOptions.transformationMatrix()
-        loc = [ 0.0, 0, 0 ]
-        parent = None
-
-        # get parent bones
-        boneDict = obj.getData().bones
-        for bbone in boneDict.values():
-            if bbone.parent == None:
-                stack.append([bbone, parent, matrix, loc, 0])
-
-        while len(stack):
-            bbone, parent, accu_mat, parent_pos, parent_ds = stack.pop()
-            # preconditions: (R : rotation, T : translation, S : scale, M: general transformation matrix)
-            #   accu_mat
-            #     points to the tail of the parents bone, i.e. for root bones
-            #     accu_mat = M_{object}*R_{additional on export}
-            #     and for child bones
-            #     accu_mat = T_{length of parent}*R_{parent}*T_{to head of parent}*M_{parent's parent}
-            #  invertedOgreTransformation
-            #    inverse of transformation done in Ogre so far, i.e. identity for root bones,
-            #    M^{-1}_{Ogre, parent's parent}*T^{-1}_{Ogre, parent}*R^{-1}_{Ogre, parent} for child bones.
-
-            head = bbone.head['BONESPACE']
-            tail = bbone.tail['BONESPACE']
-
-            # get the restmat
-            R_bmat = bbone.matrix['BONESPACE'].rotationPart()
-            rotQuat = R_bmat.toQuat()
-            R_bmat.resize4x4()
-
-            # get the bone's root offset (in the parent's coordinate system)
-            T_root = [ [       1,       0,       0,      0 ],
-            [       0,       1,       0,      0 ],
-            [       0,       0,       1,      0 ],
-            [ head[0], head[1], head[2],      1 ] ]
-
-            # get the bone length translation (length along y axis)
-            dx, dy, dz = tail[0] - head[0], tail[1] - head[1], tail[2] - head[2]
-            ds = math.sqrt(dx*dx + dy*dy + dz*dz)
-            T_len = [ [ 1,  0,  0,  0 ],
-                [ 0,  1,  0,  0 ],
-                [ 0,  0,  1,  0 ],
-                [ 0, ds,  0,  1 ] ]
-
-            # calculate bone points in world coordinates
-            accu_mat = matrix_multiply(accu_mat, T_root)
-            pos = point_by_matrix([ 0, 0, 0 ], accu_mat)
-
-            accu_mat = tmp_mat = matrix_multiply(accu_mat, R_bmat)
-            # tmp_mat = R_{bone}*T_{to head}*M_{parent}
-            accu_mat = matrix_multiply(accu_mat, T_len)
-            pos2 = point_by_matrix([ 0, 0, 0 ], accu_mat)
-            boneMeshList.append([bbone.name, pos, pos2])
-            if bbone.children is not None:
-                for child in bbone.children:
-                    # make sure child bone is attached to current parent
-                    if child.parent is not None:
-                        if child.parent.name == bbone.name:
-                            stack.append([child, parent, accu_mat, pos, ds])
-
-        self._createMeshFromBoneList(materialsDict, boneMeshList)
-        return
-
-    def _makeFace(self, submesh, name, p1, p2, p3):
-        normal = vector_normalize(vector_crossproduct(
-                [ p3[0] - p2[0], p3[1] - p2[1], p3[2] - p2[2] ],
-                [ p1[0] - p2[0], p1[1] - p2[1], p1[2] - p2[2] ]))
-        v1 = Vertex(submesh, XMLVertex(p1, normal))
-        v2 = Vertex(submesh, XMLVertex(p2, normal))
-        v3 = Vertex(submesh, XMLVertex(p3, normal))
-
-        id = self.skeleton.bonesDict[name]
-        v1.influences.append(Influence(id, 1.0))
-        v2.influences.append(Influence(id, 1.0))
-        v3.influences.append(Influence(id, 1.0))
-
-        Face(submesh, v1, v2, v3)
-        return
-
-    def _createMeshFromBoneList(self, materialsDict, boneMeshList):
-        matName = "SkeletonMaterial"
-        material = materialsDict.get(matName)
-        if not material:
-            material = DefaultMaterial(matName)
-            materialsDict[matName] = material
-
-        submesh = SubMesh(material)
-        for name, p1, p2 in boneMeshList:
-            axis = blender_bone2matrix(p1, p2, 0)
-            axis = matrix_translate(axis, p1)
-            dx, dy, dz = p1[0] - p2[0], p1[1] - p2[1], p1[2] - p2[2]
-            ds = math.sqrt(dx*dx + dy*dy + dz*dz)
-            d = 0.1 + 0.2 * (ds / 10.0)
-            c1 = point_by_matrix([-d, 0,-d], axis)
-            c2 = point_by_matrix([-d, 0, d], axis)
-            c3 = point_by_matrix([ d, 0, d], axis)
-            c4 = point_by_matrix([ d, 0,-d], axis)
-
-            self._makeFace(submesh, name, p2, c1, c2)
-            self._makeFace(submesh, name, p2, c2, c3)
-            self._makeFace(submesh, name, p2, c3, c4)
-            self._makeFace(submesh, name, p2, c4, c1)
-            self._makeFace(submesh, name, c3, c2, c1)
-            self._makeFace(submesh, name, c1, c4, c3)
-        mesh = Mesh([submesh], self.skeleton)
-        mesh.name = self.getName()
-        mesh.write()
-        return
-
-######
-# global variables
-######
-selectedObjectsList = Blender.Object.GetSelected()
-#selectedObjectsMenu = Draw.Create(0)
-#scrollbar = ReplacementScrollbar(0,0,0,0,0)
-# key: objectName, value: armatureName
-armatureDict = {}
-# key: armatureName, value: armatureActionActuatorListView
-# does only contain keys for the current selected objects
-armatureActionActuatorListViewDict = {}
-# key: armatureName, value: animationDictList
-armatureAnimationDictListDict = {}
-MAXACTUATORS = 100
-
-exportLogger = Logger()
-
-#######################################################################################
-## math functions
-
-def matrix_translate(m, v):
-  m[3][0] += v[0]
-  m[3][1] += v[1]
-  m[3][2] += v[2]
-  return m
-
-def matrix_multiply(b, a):
-  """ matrix_multiply(b, a) = a*b
-  """
-  return [ [
-    a[0][0] * b[0][0] + a[0][1] * b[1][0] + a[0][2] * b[2][0],
-    a[0][0] * b[0][1] + a[0][1] * b[1][1] + a[0][2] * b[2][1],
-    a[0][0] * b[0][2] + a[0][1] * b[1][2] + a[0][2] * b[2][2],
-    0.0,
-    ], [
-    a[1][0] * b[0][0] + a[1][1] * b[1][0] + a[1][2] * b[2][0],
-    a[1][0] * b[0][1] + a[1][1] * b[1][1] + a[1][2] * b[2][1],
-    a[1][0] * b[0][2] + a[1][1] * b[1][2] + a[1][2] * b[2][2],
-    0.0,
-    ], [
-    a[2][0] * b[0][0] + a[2][1] * b[1][0] + a[2][2] * b[2][0],
-    a[2][0] * b[0][1] + a[2][1] * b[1][1] + a[2][2] * b[2][1],
-    a[2][0] * b[0][2] + a[2][1] * b[1][2] + a[2][2] * b[2][2],
-     0.0,
-    ], [
-    a[3][0] * b[0][0] + a[3][1] * b[1][0] + a[3][2] * b[2][0] + b[3][0],
-    a[3][0] * b[0][1] + a[3][1] * b[1][1] + a[3][2] * b[2][1] + b[3][1],
-    a[3][0] * b[0][2] + a[3][1] * b[1][2] + a[3][2] * b[2][2] + b[3][2],
-    1.0,
-    ] ]
-
-def matrix_invert(m):
-  det = (m[0][0] * (m[1][1] * m[2][2] - m[2][1] * m[1][2])
-       - m[1][0] * (m[0][1] * m[2][2] - m[2][1] * m[0][2])
-       + m[2][0] * (m[0][1] * m[1][2] - m[1][1] * m[0][2]))
-  if det == 0.0: return None
-  det = 1.0 / det
-  r = [ [
-      det * (m[1][1] * m[2][2] - m[2][1] * m[1][2]),
-    - det * (m[0][1] * m[2][2] - m[2][1] * m[0][2]),
-      det * (m[0][1] * m[1][2] - m[1][1] * m[0][2]),
-      0.0,
-    ], [
-    - det * (m[1][0] * m[2][2] - m[2][0] * m[1][2]),
-      det * (m[0][0] * m[2][2] - m[2][0] * m[0][2]),
-    - det * (m[0][0] * m[1][2] - m[1][0] * m[0][2]),
-      0.0
-    ], [
-      det * (m[1][0] * m[2][1] - m[2][0] * m[1][1]),
-    - det * (m[0][0] * m[2][1] - m[2][0] * m[0][1]),
-      det * (m[0][0] * m[1][1] - m[1][0] * m[0][1]),
-      0.0,
-    ] ]
-  r.append([
-    -(m[3][0] * r[0][0] + m[3][1] * r[1][0] + m[3][2] * r[2][0]),
-    -(m[3][0] * r[0][1] + m[3][1] * r[1][1] + m[3][2] * r[2][1]),
-    -(m[3][0] * r[0][2] + m[3][1] * r[1][2] + m[3][2] * r[2][2]),
-    1.0,
-    ])
-  return r
-
-def matrix_transpose(m):
-  return [ [ m[0][0], m[1][0], m[2][0], m[3][0] ],
-           [ m[0][1], m[1][1], m[2][1], m[3][1] ],
-           [ m[0][2], m[1][2], m[2][2], m[3][2] ],
-           [ m[0][3], m[1][3], m[2][3], m[3][3] ] ]
-
-def matrix_rotate(axis, angle):
-  vx  = axis[0]
-  vy  = axis[1]
-  vz  = axis[2]
-  vx2 = vx * vx
-  vy2 = vy * vy
-  vz2 = vz * vz
-  cos = math.cos(angle)
-  sin = math.sin(angle)
-  co1 = 1.0 - cos
-  return [
-    [vx2 * co1 + cos,          vx * vy * co1 + vz * sin, vz * vx * co1 - vy * sin, 0.0],
-    [vx * vy * co1 - vz * sin, vy2 * co1 + cos,          vy * vz * co1 + vx * sin, 0.0],
-    [vz * vx * co1 + vy * sin, vy * vz * co1 - vx * sin, vz2 * co1 + cos,          0.0],
-    [0.0, 0.0, 0.0, 1.0],
-    ]
-
-def point_by_matrix(p, m):
-  return [p[0] * m[0][0] + p[1] * m[1][0] + p[2] * m[2][0] + m[3][0],
-          p[0] * m[0][1] + p[1] * m[1][1] + p[2] * m[2][1] + m[3][1],
-          p[0] * m[0][2] + p[1] * m[1][2] + p[2] * m[2][2] + m[3][2]]
-
-def vector_by_matrix(p, m):
-  return [p[0] * m[0][0] + p[1] * m[1][0] + p[2] * m[2][0],
-          p[0] * m[0][1] + p[1] * m[1][1] + p[2] * m[2][1],
-          p[0] * m[0][2] + p[1] * m[1][2] + p[2] * m[2][2]]
-
-def vector_normalize(v):
-  global exportLogger
-  l = math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2])
-  if l <= 0.000001:
-    exportLogger.logError("error in normalize")
-    return [0 , l, 0]
-  return [v[0] / l, v[1] / l, v[2] / l]
-
-def normal_by_matrix(n, m):
-  m = matrix_transpose(matrix_invert(m))
-  return vector_normalize(vector_by_matrix(n, m))
-
-
-def vector_dotproduct(v1, v2):
-  return v1[0] * v2[0] + v1[1] * v2[1] + v1[2] * v2[2]
-
-def vector_crossproduct(v1, v2):
-  return [
-    v1[1] * v2[2] - v1[2] * v2[1],
-    v1[2] * v2[0] - v1[0] * v2[2],
-    v1[0] * v2[1] - v1[1] * v2[0],
-    ]
-
-#######################################################################################
-## data structures
-
-class MaterialInterface:
-    def getName(self):
-        """Returns the material name.
-
-           @return Material name.
-        """
-        return
-    def write(self, f):
-        """Write material script entry.
-
-           @param f Material script file object to write into.
-        """
-        return
-
-class DefaultMaterial(MaterialInterface):
-    def __init__(self, name):
-        self.name = name
-        return
-    def getName(self):
-        return self.name
-    def write(self, f):
-        f.write("material %s\n" % self.getName())
-        f.write("{\n")
-        self.writeTechniques(f)
-        f.write("}\n")
-        return
-    def writeTechniques(self, f):
-        f.write(tab(1) + "technique\n" + tab(1) + "{\n")
-        f.write(tab(2) + "pass\n" + tab(2) + "{\n")
-        # empty pass
-        f.write(tab(2) + "}\n") # pass
-        f.write(tab(1) + "}\n") # technique
-        return
-
-class GameEngineMaterial(DefaultMaterial):
-    def __init__(self, blenderMesh, blenderFace):
-        self.mesh = blenderMesh
-        self.face = blenderFace
-        # check if a Blender material is assigned
-        try:
-            blenderMaterial = self.mesh.materials[self.face.mat]
-        except:
-            blenderMaterial = None
-        self.material = blenderMaterial
-        DefaultMaterial.__init__(self, self._createName())
-        return
-    def writeTechniques(self, f):
-        global exportOptions
-        mat = self.material
-        if (not(mat)
-            and not(self.mesh.vertexColors)
-            and not(self.mesh.vertexUV or self.mesh.faceUV)):
-            # default material
-            DefaultMaterial.writeTechniques(self, f)
-        else:
-            # default material
-            # SOLID, white, no specular
-            f.write(tab(1)+"technique\n")
-            f.write(tab(1)+"{\n")
-            f.write(tab(2)+"pass\n")
-            f.write(tab(2)+"{\n")
-            # ambient
-            # (not used in Blender's game engine)
-            if mat:
-                if (not(mat.mode & Blender.Material.Modes["TEXFACE"])
-                    and not(mat.mode & Blender.Material.Modes["VCOL_PAINT"])
-                    and (exportOptions.colouredAmbient)):
-                    ambientRGBList = mat.rgbCol
-                else:
-                    ambientRGBList = [1.0, 1.0, 1.0]
-                # ambient <- amb * ambient RGB
-                ambR = clamp(mat.amb * ambientRGBList[0])
-                ambG = clamp(mat.amb * ambientRGBList[1])
-                ambB = clamp(mat.amb * ambientRGBList[2])
-                ##f.write(tab(3)+"ambient %f %f %f\n" % (ambR, ambG, ambB))
-            # diffuse
-            # (Blender's game engine uses vertex colours
-            #  instead of diffuse colour.
-            #
-            #  diffuse is defined as
-            #  (mat->r, mat->g, mat->b)*(mat->emit + mat->ref)
-            #  but it's not used.)
-            if self.mesh.vertexColors:
-                #TODO: Broken in Blender 2.36.
-                # Blender does not handle "texface" mesh with vertexcolours
-                f.write(tab(3)+"diffuse vertexcolour\n")
-            elif mat:
-                if (not(mat.mode & Blender.Material.Modes["TEXFACE"])
-                    and not(mat.mode & Blender.Material.Modes["VCOL_PAINT"])):
-                    # diffuse <- rgbCol
-                    diffR = clamp(mat.rgbCol[0])
-                    diffG = clamp(mat.rgbCol[1])
-                    diffB = clamp(mat.rgbCol[2])
-                    f.write(tab(3)+"diffuse %f %f %f\n" % (diffR, diffG, diffB))
-                elif (mat.mode & Blender.Material.Modes["VCOL_PAINT"]):
-                    f.write(tab(3)+"diffuse vertexcolour\n")
-            if mat:
-                # specular <- spec * specCol, hard/4.0
-                specR = clamp(mat.spec * mat.specCol[0])
-                specG = clamp(mat.spec * mat.specCol[1])
-                specB = clamp(mat.spec * mat.specCol[2])
-                specShine = mat.hard/4.0
-                f.write(tab(3)+"specular %f %f %f %f\n" % (specR, specG, specB, specShine))
-                # emissive
-                # (not used in Blender's game engine)
-                if(not(mat.mode & Blender.Material.Modes["TEXFACE"])
-                    and not(mat.mode & Blender.Material.Modes["VCOL_PAINT"])):
-                    # emissive <-emit * rgbCol
-                    emR = clamp(mat.emit * mat.rgbCol[0])
-                    emG = clamp(mat.emit * mat.rgbCol[1])
-                    emB = clamp(mat.emit * mat.rgbCol[2])
-                    ##f.write(tab(3)+"emissive %f %f %f\n" % (emR, emG, emB))
-            # scene_blend <- transp
-            if (self.face.mode == Blender.NMesh.FaceTranspModes["ALPHA"]):
-                f.write(tab(3)+"scene_blend alpha_blend \n")
-            elif (self.face.mode == Blender.NMesh.FaceTranspModes["ADD"]):
-                #TODO: Broken in Blender 2.36.
-                #f.write(tab(3)+"scene_blend add\n")
-                pass
-            # cull_hardware/cull_software
-            if (self.face.mode & Blender.NMesh.FaceModes['TWOSIDE']):
-                f.write(tab(3) + "cull_hardware none\n")
-                f.write(tab(3) + "cull_software none\n")
-            # shading
-            # (Blender's game engine is initialized with glShadeModel(GL_FLAT))
-            ##f.write(tab(3) + "shading flat\n")
-            # texture
-            if (self.face.mode & Blender.NMesh.FaceModes['TEX']) and (self.face.image):
-                f.write(tab(3)+"texture_unit\n")
-                f.write(tab(3)+"{\n")
-                f.write(tab(4)+"texture %s\n" % PathName(self.face.image.filename).basename())
-                f.write(tab(3)+"}\n") # texture_unit
-            f.write(tab(2)+"}\n") # pass
-            f.write(tab(1)+"}\n") # technique
-        return
-    # private
-    def _createName(self):
-        """Create unique material name.
-
-           The name consists of several parts:
-           <OL>
-           <LI>rendering material name/</LI>
-           <LI>blend mode (ALPHA, ADD, SOLID)</LI>
-           <LI>/TEX</LI>
-           <LI>/texture file name</LI>
-           <LI>/VertCol</LI>
-           <LI>/TWOSIDE></LI>
-           </OL>
-        """
-        materialName = ''
-        # nonempty rendering material?
-        if self.material:
-            materialName += self.material.getName() + '/'
-        # blend mode
-        if (self.face.transp == Blender.NMesh.FaceTranspModes['ALPHA']):
-            materialName += 'ALPHA'
-        elif (self.face.transp == Blender.NMesh.FaceTranspModes['ADD']):
-            materialName += 'ADD'
-        else:
-            materialName += 'SOLID'
-        # TEX face mode and texture?
-        if (self.face.mode & Blender.NMesh.FaceModes['TEX']):
-            materialName += '/TEX'
-            if self.face.image:
-                materialName += '/' + PathName(self.face.image.filename).basename()
-        # vertex colours?
-        if self.mesh.vertexColors:
-            materialName += '/VertCol'
-        # two sided?
-        if (self.face.mode & Blender.NMesh.FaceModes['TWOSIDE']):
-            materialName += '/TWOSIDE'
-        return materialName
-
-class RenderingMaterial(DefaultMaterial):
-    def __init__(self, blenderMesh, blenderFace):
-        self.mesh = blenderMesh
-        self.face = blenderFace
-        self.key = 0
-        self.mTexUVCol = None
-        self.mTexUVNor = None
-        self.mTexUVCsp = None
-        self.material = self.mesh.materials[self.face.mat]
-        if self.material:
-            self._generateKey()
-            DefaultMaterial.__init__(self, self._createName())
-        else:
-            DefaultMaterial.__init__(self, 'None')
-        return
-    def writeTechniques(self, f):
-        # parse material
-        if self.key:
-            if self.TECHNIQUES.has_key(self.key):
-                techniques = self.TECHNIQUES[self.key]
-                techniques(self, f)
-            else:
-                # default
-                self.writeColours(f)
-        else:
-            # Halo or empty material
-            DefaultMaterial('').writeTechniques(f)
-        return
-    def writeColours(self, f):
-        global exportOptions
-        # receive_shadows
-        self.writeReceiveShadows(f, 1)
-        f.write(tab(1) + "technique\n" + tab(1) + "{\n")
-        f.write(tab(2) + "pass\n" + tab(2) + "{\n")
-        # ambient
-        if (exportOptions.colouredAmbient):
-            col = self.material.getRGBCol()
-        else:
-            col = [1.0, 1.0, 1.0]
-        self.writeAmbient(f, col, 3)
-        # diffuse
-        self.writeDiffuse(f, self.material.rgbCol, 3)
-        # specular
-        self.writeSpecular(f, 3)
-        # emissive
-        self.writeEmissive(f, self.material.rgbCol, 3)
-        # blend mode
-        self.writeSceneBlend(f,3)
-        # options
-        self.writeCommonOptions(f, 3)
-        # texture units
-        self.writeDiffuseTexture(f, 3)
-        f.write(tab(2) + "}\n") # pass
-        f.write(tab(1) + "}\n") # technique
-        return
-    def writeTexFace(self, f):
-        # preconditions: TEXFACE set
-        #
-        # Note that an additional Col texture replaces the
-        # TEXFACE texture instead of blend over according to alpha.
-        #
-        # (amb+emit)textureCol + diffuseLight*ref*textureCol + specular
-        #
-        imageFileName = None
-        if self.mTexUVCol:
-            # COL MTex replaces UV/Image Editor texture
-            imageFileName = PathName(self.mTexUVCol.tex.getImage().getFilename()).basename()
-        elif self.face.image:
-            # UV/Image Editor texture
-            imageFileName = PathName(self.face.image.filename).basename()
-
-        self.writeReceiveShadows(f, 1)
-        f.write(tab(1) + "technique\n" + tab(1) + "{\n")
-        col = [1.0, 1.0, 1.0]
-        # texture pass
-        f.write(tab(2) + "pass\n" + tab(2) + "{\n")
-        self.writeAmbient(f, col, 3)
-        self.writeDiffuse(f, col, 3)
-        if not(imageFileName):
-            self.writeSpecular(f, 3)
-        self.writeEmissive(f, col, 3)
-        self.writeSceneBlend(f,3)
-        self.writeCommonOptions(f, 3)
-        if imageFileName:
-            f.write(tab(3) + "texture_unit\n")
-            f.write(tab(3) + "{\n")
-            f.write(tab(4) + "texture %s\n" % imageFileName)
-            if self.mTexUVCol:
-                self.writeTextureAddressMode(f, self.mTexUVCol, 4)
-                self.writeTextureFiltering(f, self.mTexUVCol, 4)
-            # multiply with factors
-            f.write(tab(4) + "colour_op modulate\n")
-            f.write(tab(3) + "}\n") # texture_unit
-            f.write(tab(2) + "}\n") # texture pass
-            # specular pass
-            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
-            f.write(tab(3) + "ambient 0.0 0.0 0.0\n")
-            f.write(tab(3) + "diffuse 0.0 0.0 0.0\n")
-            self.writeSpecular(f, 3)
-            f.write(tab(3) + "scene_blend add\n")
-            hasAlpha = 0
-            if (self.material.getAlpha() < 1.0):
-                hasAlpha = 1
-            else:
-                for mtex in self.material.getTextures():
-                    if mtex:
-                        if ((mtex.tex.type == Blender.Texture.Types['IMAGE'])
-                            and (mtex.mapto & Blender.Texture.MapTo['ALPHA'])):
-                            hasAlpha = 1
-            if (hasAlpha):
-                f.write(tab(3) + "depth_write off\n")
-            self.writeCommonOptions(f, 3)
-        f.write(tab(2) + "}\n") # pass
-        f.write(tab(1) + "}\n") # technique
-        return
-    def writeVertexColours(self, f):
-        # preconditions: VCOL_PAINT set
-        #
-        # ambient = Amb*White resp. Amb*VCol if "Coloured Ambient"
-        # diffuse = Ref*VCol
-        # specular = Spec*SpeRGB, Hard/4.0
-        # emissive = Emit*VCol
-        # alpha = A
-        #
-        # Best match without vertex shader:
-        # ambient = Amb*white
-        # diffuse = Ref*VCol
-        # specular = Spec*SpeRGB, Hard/4.0
-        # emissive = black
-        # alpha = 1
-        #
-        self.writeReceiveShadows(f, 1)
-        f.write(tab(1) + "technique\n" + tab(1) + "{\n")
-        if (self.material.mode & Blender.Material.Modes['SHADELESS']):
-            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
-            self.writeCommonOptions(f,3)
-            f.write(tab(2) + "}\n")
-        else:
-            # vertex colour pass
-            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
-            f.write(tab(3) + "ambient 0.0 0.0 0.0\n")
-            f.write(tab(3) + "diffuse vertexcolour\n")
-            self.writeCommonOptions(f, 3)
-            f.write(tab(2) + "}\n") # vertex colour pass
-
-            # factor pass
-            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
-            f.write(tab(3) + "ambient 0.0 0.0 0.0\n")
-            ref = self.material.getRef()
-            f.write(tab(3) + "diffuse %f %f %f\n" % (ref, ref, ref))
-            f.write(tab(3) + "scene_blend modulate\n")
-            self.writeCommonOptions(f, 3)
-            f.write(tab(2) + "}\n") # factor pass
-
-            # ambient and specular pass
-            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
-            self.writeAmbient(f, [1.0, 1.0, 1.0], 3)
-            f.write(tab(3) + "diffuse 0.0 0.0 0.0\n")
-            self.writeSpecular(f, 3)
-            f.write(tab(3) + "scene_blend add\n")
-            self.writeCommonOptions(f, 3)
-            f.write(tab(2) + "}\n") # specular pass
-
-        f.write(tab(1) + "}\n") # technique
-        return
-    def writeNormalMap(self, f):
-        # preconditions COL and NOR textures
-        colImage = PathName(self.mTexUVCol.tex.image.filename).basename()
-        norImage = PathName(self.mTexUVNor.tex.image.filename).basename()
-        f.write("""    technique
-        {
-            pass
-            {
-                ambient 1 1 1
-                diffuse 0 0 0
-                specular 0 0 0 0
-                vertex_program_ref Ogre/BasicVertexPrograms/AmbientOneTexture
-                {
-                    param_named_auto worldViewProj worldviewproj_matrix
-                    param_named_auto ambient ambient_light_colour
-                }
-            }
-            pass
-            {
-                ambient 0 0 0
-                iteration once_per_light
-                scene_blend add
-                vertex_program_ref Examples/BumpMapVPSpecular
-                {
-                    param_named_auto lightPosition light_position_object_space 0
-                    param_named_auto eyePosition camera_position_object_space
-                    param_named_auto worldViewProj worldviewproj_matrix
-                }
-                fragment_program_ref Examples/BumpMapFPSpecular
-                {
-                    param_named_auto lightDiffuse light_diffuse_colour 0
-                    param_named_auto lightSpecular light_specular_colour 0
-                }
-                texture_unit
-                {
-                    texture %s
-                    colour_op replace
-                }
-                texture_unit
-                {
-                    cubic_texture nm.png combinedUVW
-                    tex_coord_set 1
-                    tex_address_mode clamp
-                }
-                texture_unit
-                {
-                    cubic_texture nm.png combinedUVW
-                    tex_coord_set 2
-                    tex_address_mode clamp
-                }
-            }
-            pass
-            {
-                lighting off
-                vertex_program_ref Ogre/BasicVertexPrograms/AmbientOneTexture
-                {
-                    param_named_auto worldViewProj worldviewproj_matrix
-                    param_named ambient float4 1 1 1 1
-                }
-                scene_blend dest_colour zero
-                texture_unit
-                {
-                    texture %s
-                }
-            }
-        }
-        technique
-        {
-            pass
-            {
-                ambient 1 1 1
-                diffuse 0 0 0
-                specular 0 0 0 0
-                vertex_program_ref Ogre/BasicVertexPrograms/AmbientOneTexture
-                {
-                    param_named_auto worldViewProj worldviewproj_matrix
-                    param_named_auto ambient ambient_light_colour
-                }
-            }
-            pass
-            {
-                ambient 0 0 0
-                iteration once_per_light
-                scene_blend add
-                vertex_program_ref Examples/BumpMapVP
-                {
-                    param_named_auto lightPosition light_position_object_space 0
-                    param_named_auto eyePosition camera_position_object_space
-                    param_named_auto worldViewProj worldviewproj_matrix
-                }
-                texture_unit
-                {
-                    texture %s
-                    colour_op replace
-                }
-                texture_unit
-                {
-                    cubic_texture nm.png combinedUVW
-                    tex_coord_set 1
-                    tex_address_mode clamp
-                    colour_op_ex dotproduct src_texture src_current
-                    colour_op_multipass_fallback dest_colour zero
-                }
-            }
-            pass
-            {
-                lighting off
-                vertex_program_ref Ogre/BasicVertexPrograms/AmbientOneTexture
-                {
-                    param_named_auto worldViewProj worldviewproj_matrix
-                    param_named ambient float4 1 1 1 1
-                }
-                scene_blend dest_colour zero
-                texture_unit
-                {
-                    texture %s
-                }
-            }
-        }
-    """ % (norImage, colImage, norImage, colImage))
-        return
-    def writeReceiveShadows(self, f, indent=0):
-        if (self.material.mode & Blender.Material.Modes["SHADOW"]):
-            f.write(tab(indent)+"receive_shadows on\n")
-        else:
-            f.write(tab(indent)+"receive_shadows off\n")
-        return
-    def writeAmbient(self, f, col, indent=0):
-        # ambient <- amb * ambient RGB
-        ambR = clamp(self.material.getAmb() * col[0])
-        ambG = clamp(self.material.getAmb() * col[1])
-        ambB = clamp(self.material.getAmb() * col[2])
-        if len(col) < 4:
-            alpha = self.material.getAlpha()
-        else:
-            alpha = col[3]
-        f.write(tab(indent)+"ambient %f %f %f %f\n" % (ambR, ambG, ambB, alpha))
-        return
-    def writeDiffuse(self, f, col, indent=0):
-        # diffuse = reflectivity*colour
-        diffR = clamp(col[0] * self.material.getRef())
-        diffG = clamp(col[1] * self.material.getRef())
-        diffB = clamp(col[2] * self.material.getRef())
-        if len(col) < 4:
-            alpha = self.material.getAlpha()
-        else:
-            alpha = col[3]
-        f.write(tab(indent)+"diffuse %f %f %f %f\n" % (diffR, diffG, diffB, alpha))
-        return
-    def writeSpecular(self, f, indent=0):
-        # specular <- spec * specCol, hard/4.0
-        specR = clamp(self.material.getSpec() * self.material.getSpecCol()[0])
-        specG = clamp(self.material.getSpec() * self.material.getSpecCol()[1])
-        specB = clamp(self.material.getSpec() * self.material.getSpecCol()[2])
-        specShine = self.material.getHardness()/4.0
-        alpha = self.material.getAlpha()
-        f.write(tab(indent)+"specular %f %f %f %f %f\n" % (specR, specG, specB, alpha, specShine))
-        return
-    def writeEmissive(self, f, col, indent=0):
-        # emissive <-emit * rgbCol
-        emR = clamp(self.material.getEmit() * col[0])
-        emG = clamp(self.material.getEmit() * col[1])
-        emB = clamp(self.material.getEmit() * col[2])
-        if len(col) < 4:
-            alpha = self.material.getAlpha()
-        else:
-            alpha = col[3]
-        f.write(tab(indent)+"emissive %f %f %f %f\n" % (emR, emG, emB, alpha))
-        return
-    def writeSceneBlend(self, f, indent=0):
-        hasAlpha = 0
-        if (self.material.getAlpha() < 1.0):
-            hasAlpha = 1
-        else:
-            for mtex in self.material.getTextures():
-                if mtex:
-                    if ((mtex.tex.type == Blender.Texture.Types['IMAGE'])
-                        and (mtex.mapto & Blender.Texture.MapTo['ALPHA'])):
-                        hasAlpha = 1
-        if (hasAlpha):
-            f.write(tab(indent) + "scene_blend alpha_blend\n")
-            f.write(tab(indent) + "depth_write off\n")
-        return
-    def writeCommonOptions(self, f, indent=0):
-        # Shadeless, ZInvert, NoMist, Env
-        # depth_func  <- ZINVERT; ENV
-        if (self.material.mode & Blender.Material.Modes['ENV']):
-            f.write(tab(indent)+"depth_func always_fail\n")
-        elif (self.material.mode & Blender.Material.Modes['ZINVERT']):
-            f.write(tab(indent)+"depth_func greater_equal\n")
-        # twoside
-        # 2.4 raises an exception if face.mode is accessed and mesh has no uv
-        try:
-            if (self.face.mode & Blender.NMesh.FaceModes['TWOSIDE']):
-                f.write(tab(3) + "cull_hardware none\n")
-                f.write(tab(3) + "cull_software none\n")
-        except:
-            pass
-        # lighting <- SHADELESS
-        if (self.material.mode & Blender.Material.Modes['SHADELESS']):
-            f.write(tab(indent)+"lighting off\n")
-        # fog_override <- NOMIST
-        if (self.material.mode & Blender.Material.Modes['NOMIST']):
-            f.write(tab(indent)+"fog_override true\n")
-        return
-    def writeDiffuseTexture(self, f, indent = 0):
-        if self.mTexUVCol:
-            f.write(tab(indent)+"texture_unit\n")
-            f.write(tab(indent)+"{\n")
-            f.write(tab(indent + 1) + "texture %s\n" % PathName(self.mTexUVCol.tex.getImage().getFilename()).basename())
-            self.writeTextureAddressMode(f, self.mTexUVCol, indent + 1)
-            self.writeTextureFiltering(f, self.mTexUVCol, indent + 1)
-            self.writeTextureColourOp(f, self.mTexUVCol, indent + 1)
-            f.write(tab(indent)+"}\n") # texture_unit
-        return
-    def writeTextureAddressMode(self, f, blenderMTex, indent = 0):
-        # tex_address_mode inside texture_unit
-        #
-        # EXTEND   | clamp
-        # CLIP     |
-        # CLIPCUBE |
-        # REPEAT   | wrap
-        #
-        if (blenderMTex.tex.extend & Blender.Texture.ExtendModes['REPEAT']):
-            f.write(tab(indent) + "tex_address_mode wrap\n")
-        elif (blenderMTex.tex.extend & Blender.Texture.ExtendModes['EXTEND']):
-            f.write(tab(indent) + "tex_address_mode clamp\n")
-        return
-    def writeTextureFiltering(self, f, blenderMTex, indent = 0):
-        # filtering inside texture_unit
-        #
-        # InterPol | MidMap | filtering
-        # ---------+--------+----------
-        #    yes   |   yes  | trilinear
-        #    yes   |   no   | linear linear none
-        #    no    |   yes  | bilinear
-        #    no    |   no   | none
-        #
-        if (blenderMTex.tex.imageFlags & Blender.Texture.ImageFlags['INTERPOL']):
-            if (blenderMTex.tex.imageFlags & Blender.Texture.ImageFlags['MIPMAP']):
-                f.write(tab(indent) + "filtering trilinear\n")
-            else:
-                f.write(tab(indent) + "filtering linear linear none\n")
-        else:
-            if (blenderMTex.tex.imageFlags & Blender.Texture.ImageFlags['MIPMAP']):
-                f.write(tab(indent) + "filtering bilinear\n")
-            else:
-                f.write(tab(indent) + "filtering none\n")
-        return
-    def writeTextureColourOp(self, f, blenderMTex, indent = 0):
-        # colour_op inside texture_unit
-        if ((blenderMTex.tex.imageFlags & Blender.Texture.ImageFlags['USEALPHA'])
-            and not(blenderMTex.mapto & Blender.Texture.MapTo['ALPHA'])):
-            f.write(tab(indent) + "colour_op alpha_blend\n")
-        return
-    # private
-    def _createName(self):
-        # must be called after _generateKey()
-        materialName = self.material.getName()
-        # two sided?
-        try:
-            if (self.face.mode & Blender.Mesh.FaceModes['TWOSIDE']):
-                materialName += '/TWOSIDE'
-        except:
-            pass
-        # use UV/Image Editor texture?
-        if ((self.key & self.TEXFACE) and not(self.key & self.IMAGEUVCOL)):
-            materialName += '/TEXFACE'
-            if self.face.image:
-                materialName += '/' + PathName(self.face.image.filename).basename()
-        return materialName
-    def _generateKey(self):
-        # generates key and populates mTex fields
-        if self.material:
-            if not(self.material.mode & Blender.Material.Modes['HALO']):
-                self.key |= self.NONHALO
-                if (self.material.mode & Blender.Material.Modes['VCOL_LIGHT']):
-                    self.key |= self.VCOLLIGHT
-                if (self.material.mode & Blender.Material.Modes['VCOL_PAINT']):
-                    self.key |= self.VCOLPAINT
-                if (self.material.mode & Blender.Material.Modes['TEXFACE']):
-                    self.key |= self.TEXFACE
-                # textures
-                for mtex in self.material.getTextures():
-                    if mtex:
-                        if (mtex.tex.type == Blender.Texture.Types['IMAGE']):
-                            if (mtex.texco & Blender.Texture.TexCo['UV']):
-                                if (mtex.mapto & Blender.Texture.MapTo['COL']):
-                                    self.key |= self.IMAGEUVCOL
-                                    self.mTexUVCol = mtex
-                                if (mtex.mapto & Blender.Texture.MapTo['NOR']):
-                                    # Check "Normal Map" image option
-                                    if (mtex.tex.imageFlags & 2048):
-                                        self.key |= self.IMAGEUVNOR
-                                        self.mTexUVNor = mtex
-                                    # else bumpmap
-                                if (mtex.mapto & Blender.Texture.MapTo['CSP']):
-                                    self.key |= self.IMAGEUVCSP
-                                    self.mTexUVCsp = mtex
-        return
-    NONHALO = 1
-    VCOLLIGHT = 2
-    VCOLPAINT = 4
-    TEXFACE = 8
-    IMAGEUVCOL = 16
-    IMAGEUVNOR = 32
-    IMAGEUVCSP = 64
-    # material techniques export methods
-    TECHNIQUES = {
-        NONHALO|IMAGEUVCOL : writeColours,
-        NONHALO|IMAGEUVCOL|IMAGEUVCSP : writeColours,
-        NONHALO|TEXFACE : writeTexFace,
-        NONHALO|TEXFACE|VCOLLIGHT : writeTexFace,
-        NONHALO|TEXFACE|IMAGEUVCOL : writeTexFace,
-        NONHALO|TEXFACE|IMAGEUVNOR : writeTexFace,
-        NONHALO|TEXFACE|IMAGEUVCSP : writeTexFace,
-        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVCOL : writeTexFace,
-        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVNOR : writeTexFace,
-        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVCSP : writeTexFace,
-        NONHALO|TEXFACE|IMAGEUVCOL|IMAGEUVCSP : writeTexFace,
-        NONHALO|TEXFACE|IMAGEUVNOR|IMAGEUVCSP : writeTexFace,
-        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVCOL|IMAGEUVCSP : writeTexFace,
-        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVNOR|IMAGEUVCSP : writeTexFace,
-        NONHALO|VCOLPAINT : writeVertexColours,
-        NONHALO|VCOLPAINT|VCOLLIGHT : writeVertexColours,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLPAINT : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|TEXFACE : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|IMAGEUVCSP : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|VCOLPAINT : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|TEXFACE : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|IMAGEUVCSP : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLPAINT|TEXFACE : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLPAINT|IMAGEUVCSP : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|TEXFACE|IMAGEUVCSP : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLPAINT|TEXFACE|IMAGEUVCSP : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|TEXFACE|IMAGEUVCSP : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|VCOLPAINT|IMAGEUVCSP : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|VCOLPAINT|TEXFACE : writeNormalMap,
-        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|VCOLPAINT|TEXFACE|IMAGEUVCSP : writeNormalMap
-        }
-
-class Mesh:
-    def __init__(self, submeshList, skeleton=None, nmesh=None):
-        """Constructor.
-
-           @param submeshList Submeshes.
-           @param nmesh Blender NMesh.
-        """
-        self.name = ''
-        self.submeshList = submeshList
-        self.skeleton = skeleton
-        # boolean
-        self.vertexColours = 0
-        # boolean
-        self.uvCoordinates = 0
-        # parse nmesh
-        self._parseMesh(nmesh)
-        return
-    def hasVertexColours(self):
-        return self.vertexColours
-    def hasUVCoordinates(self):
-        return self.uvCoordinates
-    def write(self):
-    	global exportOptions
-        # write_mesh(name, submeshes, skeleton):
-        global exportLogger
-        file = self.name + ".mesh.xml"
-        exportLogger.logInfo("Mesh \"%s\"" % file)
-
-        f = open(os.path.join(full_path, file), "w")
-        f.write(tab(0)+"<mesh>\n")
-        f.write(tab(1)+"<submeshes>\n")
-        for submesh in self.submeshList:
-            f.write(tab(2)+"<submesh")
-            f.write(" material=\"%s\"" % submesh.material.name)
-            f.write(" usesharedvertices=\"false\"")
-            f.write(" use32bitindexes=\"false\"")
-            f.write(" operationtype=\"triangle_list\"")
-            f.write(">\n")
-
-            f.write(tab(3)+"<faces count=\"%d\">\n" % len(submesh.faces))
-            for face in submesh.faces:
-                v1, v2, v3  = face.vertex1.id, face.vertex2.id, face.vertex3.id
-                f.write(tab(4)+"<face v1=\"%d\" v2=\"%d\" v3=\"%d\"/>\n" % (v1, v2, v3))
-            f.write(tab(3)+"</faces>\n")
-
-            f.write(tab(3)+"<geometry vertexcount=\"%d\">\n" % len(submesh.vertices))
-            if (exportOptions.armatureExport):
-                # use seperate vertexbuffer for position and normals when animated
-                f.write(tab(4)+"<vertexbuffer positions=\"true\" normals=\"true\">\n")
-                for v in submesh.vertices:
-                    f.write(XMLVertexStringView(v.xmlVertex).toString(5, ['normal','position']))
-                f.write(tab(4)+"</vertexbuffer>\n")
-                if (self.hasUVCoordinates() and self.hasVertexColours()):
-                    f.write(tab(4)+"<vertexbuffer")
-                    f.write(" texture_coord_dimensions_0=\"2\" texture_coords=\"1\"")
-                    f.write(" colours_diffuse=\"true\">\n")
-                    for v in submesh.vertices:
-                            f.write(XMLVertexStringView(v.xmlVertex).toString(5, ['texcoordList','colourDiffuse']))
-                    f.write(tab(4)+"</vertexbuffer>\n")
-                elif self.hasUVCoordinates():
-                    f.write(tab(4)+"<vertexbuffer")
-                    f.write(" texture_coord_dimensions_0=\"2\" texture_coords=\"1\">\n")
-                    for v in submesh.vertices:
-                            f.write(XMLVertexStringView(v.xmlVertex).toString(5, ['texcoordList']))
-                    f.write(tab(4)+"</vertexbuffer>\n")
-                elif self.hasVertexColours():
-                    f.write(tab(4)+"<vertexbuffer")
-                    f.write(" colours_diffuse=\"true\">\n")
-                    for v in submesh.vertices:
-                            f.write(XMLVertexStringView(v.xmlVertex).toString(5, ['colourDiffuse']))
-                    f.write(tab(4)+"</vertexbuffer>\n")
-            else:
-                # use only one vertex buffer if mesh is not animated
-                f.write(tab(4)+"<vertexbuffer ")
-                f.write("positions=\"true\" ")
-                f.write("normals=\"true\"")
-                if self.hasUVCoordinates():
-                    f.write(" texture_coord_dimensions_0=\"2\" texture_coords=\"1\"")
-                if self.hasVertexColours():
-                    f.write(" colours_diffuse=\"true\"")
-                f.write(">\n")
-                for v in submesh.vertices:
-                    f.write(XMLVertexStringView(v.xmlVertex).toString(5))
-                f.write(tab(4)+"</vertexbuffer>\n")
-            f.write(tab(3)+"</geometry>\n")
-
-            if self.skeleton:
-                f.write(tab(3)+"<boneassignments>\n")
-                for v in submesh.vertices:
-                    for influence in v.influences:
-                        f.write(tab(4)+"<vertexboneassignment ")
-                        f.write("vertexindex=\"%d\" boneindex=\"%d\" weight=\"%.6f\"/>\n"
-                            % (v.id, influence.bone.id, influence.weight))
-                f.write(tab(3)+"</boneassignments>\n")
-            f.write(tab(2)+"</submesh>\n")
-        f.write(tab(1)+"</submeshes>\n")
-
-        if self.skeleton:
-            f.write(tab(1)+"<skeletonlink name=\"%s.skeleton\"/>\n" % self.skeleton.name)
-
-        f.write(tab(0)+"</mesh>\n")
-        f.close()
-        convertXMLFile(os.path.join(full_path, file))
-        binFile = self.name + ".mesh"
-        upgradeXMLFile(os.path.join(full_path, binFile))
-        return
-    # private
-    def _parseMesh(self, mesh):
-        if mesh:
-            self.name = mesh.name
-            if mesh.vertexColors:
-                self.vertexColors = 1
-            if (mesh.faceUV or mesh.vertexUV):
-                self.uvCoordinates = 1
-        return
-
-class SubMesh:
-  def __init__(self, material):
-    self.material   = material
-    self.vertices   = []
-    self.faces      = []
-
-  def rename_vertices(self, new_vertices):
-    # Rename (change ID) of all vertices, such as self.vertices == new_vertices.
-    for i in range(len(new_vertices)): new_vertices[i].id = i
-    self.vertices = new_vertices
-
-class XMLVertex:
-    """Vertex in Ogre.
-
-       @cvar threshold Floating point precicsion.
-    """
-    threshold = 1e-6
-    def __init__(self, position=None, normal=None, colourDiffuse=None, colourSpecular=None, texcoordList=None):
-        """Constructor.
-
-           @param position       list with x, y and z coordinate of the position
-           @param normal         list with x, y and z coordinate of the normal vector
-           @param colourDiffuse  list with RGBA floats
-           @param colourSpecular list with RGBA floats
-           @param texcoordList   list of list with u and v texture coordinates.
-        """
-        self.elementDict = {}
-        if position:
-            self.elementDict['position'] = position
-        if normal:
-            self.elementDict['normal'] = normal
-        if colourDiffuse:
-            self.elementDict['colourDiffuse'] = colourDiffuse
-        if colourSpecular:
-            self.elementDict['colourSpecular'] = colourSpecular
-        if texcoordList:
-            self.elementDict['texcoordList'] = texcoordList
-        return
-    def hasPosition(self):
-        return self.elementDict.has_key('position')
-    def hasNormal(self):
-        return self.elementDict.has_key('normal')
-    def hasVertexColour(self):
-        return self.elementDict.has_key('colourDiffuse') or self.elementDict.has_key('colourSpecular')
-    def hasDiffuseColour(self):
-        return self.elementDict.has_key('colourDiffuse')
-    def hasSpecularColour(self):
-        return self.elementDict.has_key('colourSpecular')
-    def nTextureCoordinates(self):
-        nTextureCoordinates = 0
-        if self.elementDict.has_key('texcoordList'):
-            nTextureCoordinates = len(self.elementDict['texcoordList'])
-        return nTextureCoordinates
-    def __getitem__(self, key):
-        return self.elementDict[key]
-    def __ne__(self, other):
-        """Tests if it differs from another Vertex.
-
-           @param other the XMLVertex to compare with
-           @return <code>true</code> if they differ, else <code>false</code>
-        """
-        return not self.__eq__(other)
-    def __eq__(self, other):
-        """Tests if it is equal to another Vertex.
-
-           @param other the XMLVertex to compare with
-           @return <code>true</code> if they are equal, else <code>false</code>
-        """
-        areEqual = 0
-        if (self.getElements() == other.getElements()):
-            compared = 0
-            itemIterator = self.elementDict.iteritems()
-            while (not compared):
-                try:
-                    (element, value) = itemIterator.next()
-                    if element == 'position' or element == 'normal':
-                        otherValue = other[element]
-                        if ((math.fabs(value[0] - otherValue[0]) > XMLVertex.threshold) or
-                            (math.fabs(value[1] - otherValue[1]) > XMLVertex.threshold) or
-                            (math.fabs(value[2] - otherValue[2]) > XMLVertex.threshold)):
-                            # test fails
-                            compared = 1
-                    elif element == 'colourDiffuse' or element == 'colourSpecular':
-                        otherValue = other[element]
-                        if ((math.fabs(value[0] - otherValue[0]) > XMLVertex.threshold) or
-                            (math.fabs(value[1] - otherValue[1]) > XMLVertex.threshold) or
-                            (math.fabs(value[2] - otherValue[2]) > XMLVertex.threshold) or
-                            (math.fabs(value[3] - otherValue[3]) > XMLVertex.threshold)):
-                            # test fails
-                            compared = 1
-                    elif element == 'texcoordList':
-                        otherValue = other[element]
-                        if len(value) == len(otherValue):
-                            for uv, otherUV in zip(value, otherValue):
-                                if ((math.fabs(uv[0] - otherUV[0]) > XMLVertex.threshold) or
-                                    (math.fabs(uv[1] - otherUV[1]) > XMLVertex.threshold)):
-                                    # test fails
-                                    compared = 1
-                        else:
-                            # test fails
-                            compared = 1
-                    else:
-                        # test fails, unknown element
-                        compared = 1
-                except StopIteration:
-                    # objects are equal
-                    areEqual = 1
-                    compared = 1
-        return areEqual
-    # getter and setter
-    def getElements(self):
-        return self.elementDict.keys()
-    def getPosition(self):
-        return self.elementDict['position']
-    def getNormal(self):
-        return self.elementDict['normal']
-    def getColourDiffuse(self):
-        return self.elementDict['colourDiffuse']
-    def getColourSpecular(self):
-        return self.elementDict['colourSpecular']
-    def getTextureCoordinatesList(self):
-        return self.elementDict['texcoordList']
-    def setPosition(self, position):
-        if position:
-            self.elementDict['position'] = position
-        else:
-            del self.elementDict['position']
-        return
-    def setNormal(self, normal):
-        if normal:
-            self.elementDict['normal'] = normal
-        else:
-            del self.elementDict['normal']
-        return
-    def setColourDiffuse(self, colourDiffuse):
-        if colourDiffuse:
-            self.elementDict['colourDiffuse'] = colourDiffuse
-        else:
-            del self.colourDiffuse
-        return
-    def setColourSpecular(self, colourSpecular):
-        if colourSpecular:
-            self.elementDict['colourSpecular'] = colourSpecular
-        else:
-            del self.elementDict['colourSpecular']
-        return
-    # special getter and setter
-    def appendTextureCoordinates(self, uvList):
-        """Appends new texture coordinate.
-
-           @param uvList list with u and v coordinate
-           @return list index
-        """
-        if self.elementDict.has_key('texcoordList'):
-            self.elementDict['texcoordList'].append(uvList)
-        else:
-            self.elementDict['texcoordList'] = [uvList]
-        return (len(self.elementDict['texcoordList']) -1 )
-    def setTextureCorrdinates(self, index, uvList):
-        self.elementDict['texcoordList'][index] = uvList
-        return
-    def getTextureCoordinates(self, index=None):
-        return self.elementDict['texcoordList'][index]
-    def deleteTextureCoordinates(self, index=None):
-        """Delete texture coordinates.
-
-           Delete a pair or all texture coordinates of the vertex.
-
-           @param index the index of the texture coordinates in the vertex's list of
-                        texture coordinates. If <code>None</code> the complete list
-                        is deleted.
-        """
-        if (index != None):
-            del self.elementDict['texcoordList'][index]
-        else:
-            del self.elementDict['texcoordList']
-        return
-
-class XMLVertexStringView:
-    """Viewer class for textual representation of a XMLVertex.
-
-       @see XMLVertex
-    """
-    def __init__(self, xmlVertex):
-        if isinstance(xmlVertex, XMLVertex):
-            self.xmlVertex = xmlVertex
-        return
-    def __str__(self):
-        return self.toString()
-    def toString(self, indent=0, keyList=None):
-        """Returns textual representations of its XMLVertex.
-
-           @param indent Indentation level of the string.
-           @param keyList List of keys of elements to represent in the string.
-           @return string String representation of the XMLVertex.
-           @see XMLVertex#__init__
-        """
-        if not keyList:
-            keyList = self.xmlVertex.getElements()
-        else:
-            # remove unavailable elements
-            keyList = [key for key in keyList if key in self.xmlVertex.getElements()]
-        s = self._indent(indent) + "<vertex>\n"
-        if keyList.count('position'):
-            position = self.xmlVertex.getPosition()
-            s += self._indent(indent+1)+"<position x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(position)
-        if keyList.count('normal'):
-            normal = self.xmlVertex.getNormal()
-            s += self._indent(indent+1)+"<normal x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(normal)
-        if keyList.count('colourDiffuse'):
-            colourDiffuse = self.xmlVertex.getColourDiffuse()
-            if OGRE_OPENGL_VERTEXCOLOUR:
-                (r, g, b, a) = tuple(colourDiffuse)
-                s += self._indent(indent+1)+"<colour_diffuse value=\"%.6f %.6f %.6f %.6f\"/>\n" % (b, g, r, a)
-            else:
-                s += self._indent(indent+1)+"<colour_diffuse value=\"%.6f %.6f %.6f %.6f\"/>\n" % tuple(colourDiffuse)
-        if keyList.count('colourSpecular'):
-            colourSpecular = self.xmlVertex.getColourSpecular()
-            if OGRE_OPENGL_VERTEXCOLOUR:
-                (r, g, b, a) = tuple(colourSpecular)
-                s += self._indent(indent+1)+"<colour_specular value=\"%.6f %.6f %.6f %.6f\"/>\n" % (b, g, r, a)
-            else:
-                s += self._indent(indent+1)+"<colour_specular value=\"%.6f %.6f %.6f %.6f\"/>\n" % tuple(colourSpecular)
-        if keyList.count('texcoordList'):
-            for uv in self.xmlVertex.getTextureCoordinatesList():
-                s+=self._indent(indent+1)+"<texcoord u=\"%.6f\" v=\"%.6f\"/>\n" % tuple(uv)
-        s += self._indent(indent) + "</vertex>\n"
-        return s
-    def _indent(self, indent):
-        return "    "*indent
-
-class Vertex:
-  def __init__(self, submesh, xmlVertex):
-    self.xmlVertex = xmlVertex
-    self.influences = []
-
-    self.cloned_from = None
-    self.clones      = []
-    self.submesh = submesh
-    self.id = len(submesh.vertices)
-    submesh.vertices.append(self)
-
-class Influence:
-  def __init__(self, bone, weight):
-    self.bone   = bone
-    self.weight = weight
-
-class Face:
-  def __init__(self, submesh, vertex1, vertex2, vertex3):
-    self.vertex1 = vertex1
-    self.vertex2 = vertex2
-    self.vertex3 = vertex3
-    self.submesh = submesh
-    submesh.faces.append(self)
-
-class Skeleton:
-  def __init__(self, name):
-    self.name = name
-    self.bones = []
-    self.bonesDict = {}
-    self.animationsDict = {}
-
-class Bone:
-  def __init__(self, skeleton, parent, name, loc, rotQuat, conversionMatrix):
-    self.parent = parent
-    self.name   = name
-    self.loc = loc # offset from parent bone
-    self.rotQuat = rotQuat # axis as quaternion
-    self.children = []
-    self.conversionMatrix = conversionMatrix # converts Blender's local bone coordinates into Ogre's local bone coordinates
-
-    if parent:
-      parent.children.append(self)
-
-    self.id = len(skeleton.bones)
-    skeleton.bones.append(self)
-    skeleton.bonesDict[name] =self
-
-class Animation:
-  def __init__(self, name, duration = 0.0):
-    self.name     = name
-    self.duration = duration
-    self.tracksDict = {} # Map bone names to tracks
-
-class Track:
-  def __init__(self, animation, bone):
-    self.bone      = bone
-    self.keyframes = []
-
-    self.animation = animation
-    animation.tracksDict[bone.name] = self
-
-class KeyFrame:
-  def __init__(self, track, time, loc, rotQuat, scale):
-    self.time = time
-    self.loc  = loc
-    self.rotQuat  = rotQuat
-    self.scale = scale
-
-    self.track = track
-    track.keyframes.append(self)
-
-#######################################################################################
-## Armature stuff
-
-def blender_bone2matrix(head, tail, roll):
-  # Convert bone rest state (defined by bone.head, bone.tail and bone.roll)
-  # to a matrix (the more standard notation).
-  # Taken from blenkernel/intern/armature.c in Blender source.
-  # See also DNA_armature_types.h:47.
-
-  nor = vector_normalize([ tail[0] - head[0],
-                           tail[1] - head[1],
-                           tail[2] - head[2] ])
-
-  # Find Axis & Amount for bone matrix
-  target = [0.0, 1.0, 0.0]
-  axis = vector_crossproduct(target, nor)
-
-  # is nor a multiple of target?
-  if vector_dotproduct(axis, axis) > 0.0000000000001:
-    axis  = vector_normalize(axis)
-    theta = math.acos(vector_dotproduct(target, nor))
-    bMatrix = matrix_rotate(axis, theta)
-
-  else:
-    # point same direction, or opposite?
-    if vector_dotproduct(target, nor) > 0.0:
-      updown = 1.0
-    else:
-      updown = -1.0
-
-    # Quoted from Blender source : "I think this should work ..."
-    bMatrix = [ [updown,    0.0, 0.0, 0.0],
-                [   0.0, updown, 0.0, 0.0],
-                [   0.0,    0.0, 1.0, 0.0],
-                [   0.0,    0.0, 0.0, 1.0] ]
-
-  rMatrix = matrix_rotate(nor, roll)
-  return matrix_multiply(rMatrix, bMatrix)
-
-#######################################################################################
-## Mesh stuff
-def process_vert_influences(mesh, skeleton):
-    global verticesDict
-    global exportLogger
-
-    if skeleton:
-        # build bone influence dictionary
-
-        # get the bone names
-        # build influences tuples of bone name and influence
-        boneWeightDict = {}
-        for bone in skeleton.bones:
-            boneweights = []
-            try:
-                #boneweights = mesh.getVertsFromGroup(bone.name, 1, [face.v[i].index])
-                # get all weights for a bone.  getting weights for a specific vertex trashes
-                # blender after a few hundred calls
-                #print bone.name
-                boneweights = mesh.getVertsFromGroup(bone.name, 1)
-                boneWeightDict[bone.name] = dict(boneweights)
-            except:
-                pass
-
-        for vert_index, vertex in verticesDict.iteritems():
-            influences = []
-            for boneName, vertWeightDict in boneWeightDict.iteritems():
-                if vertWeightDict.has_key(vert_index):
-                    influences += [(boneName, vertWeightDict[vert_index])]
-            if not influences:
-                exportLogger.logError("Vertex in skinned mesh without influence, check your mesh!")
-            # limit influences to 4 bones per vertex
-            def cmpfunc(x, y):
-                xname, xweight = x
-                yname, yweight = y
-                return cmp(yweight, xweight)
-            # only want the weights with the most influence
-            influences.sort(cmpfunc)
-            # limits weights to maximum of 4
-            influences = influences[0:4]
-            # and make sure the sum is 1.0
-            total = 0.0
-            for name, weight in influences:
-                total += weight
-            for name, weight in influences:
-                vertex.influences.append(Influence(skeleton.bonesDict[name], weight/total))
-
-# remap vertices for faces
-def process_face(face, submesh, mesh, matrix, skeleton=None):
-    """Process a face of a mesh.
-
-       @param face Blender.NMesh.NMFace.
-       @param submesh SubMesh the face belongs to.
-       @param mesh Blender.Mesh.Mesh the face belongs to.
-       @param matrix Export translation.
-       @param skeleton Skeleton of the mesh (if any).
-    """
-    global verticesDict
-    global exportLogger
-    # threshold to compare floats
-    threshold = 1e-6
-    if len(face.v) in [ 3, 4 ]:
-        if not face.smooth:
-            # calculate the face normal.
-            p1 = face.v[0].co
-            p2 = face.v[1].co
-            p3 = face.v[2].co
-            faceNormal = vector_crossproduct(
-                [p3[0] - p2[0], p3[1] - p2[1], p3[2] - p2[2]],
-                [p1[0] - p2[0], p1[1] - p2[1], p1[2] - p2[2]],
-                )
-            faceNormal = normal_by_matrix(faceNormal, matrix)
-
-        face_vertices = [ 0, 0, 0, 0]
-        for i in range(len(face.v)):
-            # position
-            position  = point_by_matrix (face.v[i].co, matrix)
-            # Blender separates normal, uv coordinates and colour from vertice coordinates.
-            # normal
-            if face.smooth:
-                normal = normal_by_matrix(face.v[i].no, matrix)
-            else:
-                normal = faceNormal
-            xmlVertex = XMLVertex(position, normal)
-            # uv coordinates
-            if (mesh.vertexUV or mesh.faceUV):
-                uv = [0,0]
-                if mesh.vertexUV:
-                    # mesh has sticky/per vertex uv coordinates
-                    uv[0] = face.v[i].uvco[0]
-                    # origin is now in the top-left (Ogre v0.13.0)
-                    uv[1] = 1 - face.v[i].uvco[1]
-                else:
-                    # mesh has per face vertex uv coordinates
-                    uv[0] = face.uv[i][0]
-                    # origin is now in the top-left (Ogre v0.13.0)
-                    uv[1] = 1 - face.uv[i][1]
-                xmlVertex.appendTextureCoordinates(uv)
-            # vertex colour
-            if (mesh.vertexColors):
-                colour = face.col[i]
-                xmlVertex.setColourDiffuse([colour.r/255.0, colour.g/255.0, colour.b/255.0, colour.a/255.0])
-            # check if an equal xmlVertex already exist
-            # get vertex
-            if verticesDict.has_key(face.v[i].index):
-                # vertex already exists
-                vertex = verticesDict[face.v[i].index]
-                # compare xmlVertex to vertex and its clones
-                if (vertex.xmlVertex != xmlVertex):
-                    vertexFound = 0
-                    iClone = 0
-                    while ((iClone < len(vertex.clones)) and (not vertexFound)):
-                        clone = vertex.clones[iClone]
-                        if (clone.xmlVertex == xmlVertex):
-                            vertexFound = 1
-                            vertex = clone
-                        iClone += 1
-                    if not vertexFound:
-                        # create new clone
-                        clone = Vertex(submesh, xmlVertex)
-                        clone.cloned_from = vertex
-                        clone.influences = vertex.influences
-                        vertex.clones.append(clone)
-                        # write back to dictionary
-                        verticesDict[face.v[i].index] = vertex
-                        vertex = clone
-            else:
-                # vertex does not exist yet
-                # create vertex
-                vertex = Vertex(submesh, xmlVertex)
-                verticesDict[face.v[i].index] = vertex
-            # postcondition: vertex is current vertex
-            face_vertices[i] = vertex
-
-        if len(face.v) == 3:
-            Face(submesh, face_vertices[0], face_vertices[1], face_vertices[2])
-        elif len(face.v) == 4:
-            # Split faces with 4 vertices on the shortest edge
-            differenceVectorList = [[0,0,0],[0,0,0]]
-            for indexOffset in range(2):
-                for coordinate in range(3):
-                    differenceVectorList[indexOffset][coordinate] = face_vertices[indexOffset].xmlVertex.getPosition()[coordinate] \
-                                                                  - face_vertices[indexOffset+2].xmlVertex.getPosition()[coordinate]
-            if Mathutils.Vector(differenceVectorList[0]).length < Mathutils.Vector(differenceVectorList[1]).length:
-                Face(submesh, face_vertices[0], face_vertices[1], face_vertices[2])
-                Face(submesh, face_vertices[2], face_vertices[3], face_vertices[0])
-            else:
-                Face(submesh, face_vertices[0], face_vertices[1], face_vertices[3])
-                Face(submesh, face_vertices[3], face_vertices[1], face_vertices[2])
-    else:
-        exportLogger.logWarning("Ignored face with %d edges." % len(face.v))
-    return
-
-def export_mesh(object, exportOptions):
-    global verticesDict
-    global skeletonsDict
-    global materialsDict
-    global exportLogger
-
-    if (object.getType() == "Mesh"):
-        # is this mesh attached to an armature?
-        skeleton = None
-        if exportOptions.armatureExport:
-            parent = object.getParent()
-            #if parent and parent.getType() == "Armature" and (not skeletonsDict.has_key(parent.getName())):
-            if (parent and (parent.getType() == "Armature")):
-                if armatureActionActuatorListViewDict.has_key(parent.getName()):
-                    actionActuatorList = armatureActionActuatorListViewDict[parent.getName()].armatureActionActuatorList
-                    armatureExporter = ArmatureExporter(MeshExporter(object), parent)
-                    armatureExporter.export(actionActuatorList, exportOptions, exportLogger)
-                    skeleton = armatureExporter.skeleton
-
-        #Mesh of the object
-        #for 2.4 us Mesh instead of NMesh
-        data = object.getData(False, True)
-        matrix = None
-        if exportOptions.useWorldCoordinates:
-            matrix = object.getMatrix("worldspace")
-        else:
-            matrix = Mathutils.Matrix([1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1])
-        matrix = matrix*BASE_MATRIX
-        # materials of the object
-        # note: ogre assigns different textures and different facemodes
-        #       to different materials
-        objectMaterialDict = {}
-        # faces assign to objectMaterial keys
-        objectMaterialFacesDict = {}
-
-        # note: these are blender materials. Even if nMaterials = 0
-        #       the face can still have a texture (see above)
-        # meshMaterialList = data.getMaterials(1)
-        meshMaterialList = data.materials
-        # note: material slots may be empty, resp. meshMaterialList entries may be None
-        nMaterials = len(meshMaterialList)
-
-        # warn if mesh is a subdivision surface
-        #if (data.mode & Blender.Mesh.Modes['SUBSURF']):
-            #exportLogger.logWarning("Mesh \"%s\" is a subdivision surface. Convert it to mesh, if you want to export the subdivision result." % data.name)
-        # create ogre materials
-        for face in data.faces:
-            faceMaterial = None
-            # choose "rendering materials" or "game engine materials"
-            if not(exportOptions.useGameEngineMaterials):
-                # rendering materials
-                try:
-                    blenderMaterial = meshMaterialList[face.mat]
-                except:
-                    exportLogger.logError("Material assignment missing for object \"%s\"!" % data.name)
-                    blenderMaterial = None
-                if blenderMaterial:
-                    # non-empty material slot
-                    faceMaterial = RenderingMaterial(data, face)
-                else:
-                    faceMaterial = DefaultMaterial('default')
-            else:
-                # game engine materials
-                try:
-                    if face.image:
-                        if (not(face.mode & Blender.Mesh.FaceModes['INVISIBLE'])
-                            and not(face.flag & Blender.Mesh.FaceFlags['HIDE'])):
-                            faceMaterial = GameEngineMaterial(data, face)
-                    else:
-                        # check if a Blender material is assigned
-                        try:
-                            blenderMaterial = meshMaterialList[face.mat]
-                        except:
-                            blenderMaterial = None
-                        if blenderMaterial:
-                            faceMaterial = GameEngineMaterial(data, face)
-                        else:
-                             exportLogger.logWarning("Face of object \"%s\" without material assignment! Using default material." % data.name)
-                             faceMaterial = DefaultMaterial('default')
-                except:
-                    faceMaterial = DefaultMaterial('default')
-                    try:
-                        blenderMaterial = meshMaterialList[face.mat]
-                    except:
-                        exportLogger.logError("Material assignment missing for object \"%s\"!" % data.name)
-                        blenderMaterial = None
-                    if blenderMaterial:
-                        # non-empty material slot
-                        faceMaterial = RenderingMaterial(data, face)
-                    else:
-                        faceMaterial = DefaultMaterial('default')
-            if faceMaterial:
-                # insert into Dicts
-                materialName = faceMaterial.getName()
-                material = objectMaterialDict.get(materialName)
-                if material:
-                    # append faces
-                    faceList = objectMaterialFacesDict[materialName]
-                    faceList.append(face)
-                    objectMaterialFacesDict[materialName] = faceList
-                else:
-                    # create new faces list
-                    objectMaterialDict[materialName] = faceMaterial
-                    objectMaterialFacesDict[materialName] = [face]
-        # process faces
-        submeshes = []
-        for materialKey in objectMaterialDict.keys():
-            submesh = SubMesh(objectMaterialDict[materialKey])
-            verticesDict = {}
-            for face in objectMaterialFacesDict[materialKey]:
-                process_face(face, submesh, data, matrix, skeleton)
-            if len(submesh.faces):
-                # process verticesDict and add bone influences
-                process_vert_influences(data, skeleton)
-                submeshes.append(submesh)
-                # update global materialsDict
-                material = materialsDict.get(materialKey)
-                if not material:
-                    materialsDict[materialKey] = objectMaterialDict[materialKey]
-        # write mesh
-        if len(submeshes) == 0:
-            # no submeshes
-            exportLogger.logWarning("Mesh %s has no visible faces!" % data.name)
-        else:
-            # write mesh
-            mesh = Mesh(submeshes, skeleton, data)
-            mesh.write()
-    return
-
-#######################################################################################
-## file output
-
-def tab(tabsize):
-    return "\t" * tabsize
-
-def clamp(val):
-    if val < 0.0:
-        val = 0.0
-    if val > 1.0:
-        val = 1.0
-    return val
-
-def convertXMLFile(filename):
-    """Calls the OgreXMLConverter on a file.
-
-       If the script variable <code>OGRE_XML_CONVERTER</code> is nonempty, the
-       OgreXMLConverter is called to convert the given file.
-
-       @param filename filename of the XML file to convert.
-    """
-    global exportLogger
-    if OGRE_XML_CONVERTER != '':
-        commandLine = OGRE_XML_CONVERTER + ' "' + filename + '"'
-        exportLogger.logInfo("Running OgreXMLConverter: " + commandLine)
-        xmlConverter = os.popen(commandLine, 'r')
-        if xmlConverter == None:
-            exportLogger.logError('Could not run OgreXMLConverter!')
-        else:
-            for line in xmlConverter:
-                exportLogger.logInfo("OgreXMLConverter: " + line)
-            xmlConverter.close()
-    return
-
-def upgradeXMLFile(filename):
-    """Calls OgreMeshUpgrade on a file - adds tangents for normalmapping.
-
-       If the script variable <code>OGRE_MESH_UPGRADE</code> is nonempty, the
-       OgreMeshUpgrade is called to convert the given file.
-
-       @param filename filename of the XML file to convert.
-    """
-    global exportLogger
-    if OGRE_MESH_UPGRADE != '':
-        commandLine = OGRE_MESH_UPGRADE + ' "' + filename + '"'
-        exportLogger.logInfo("Running OgreMeshUpgrade: " + commandLine)
-        MeshUpgrade = os.popen(commandLine, 'r')
-        if MeshUpgrade == None:
-            exportLogger.logError('Could not run MeshUpgrade!')
-        else:
-            for line in MeshUpgrade:
-                exportLogger.logInfo("OgreMeshUpgrade: " + line)
-            xmlConverter.close()
-    return
-
-def write_materials():
-    global exportOptions, materialString, exportLogger
-    global materialsDict
-    file = exportOptions.materialFilename
-    exportLogger.logInfo("Materials \"%s\"" % file)
-    f = open(os.path.join(full_path, file), "w")
-    for material in materialsDict.values():
-        material.write(f)
-    f.close()
-    return
-
-#######################################################################################
-## main export
-
-def export(selectedObjectsList):
-    global  scaleNumber, rotXNumber, rotYNumber, rotZNumber
-    global materialsDict
-    global skeletonsDict
-    global BASE_MATRIX
-    global exportLogger
-    global exportOptions
-
-    materialsDict = {}
-    skeletonsDict = {}
-
-    # default: set matrix to 90 degree rotation around x-axis
-    # rotation order: x, y, z
-    # WARNING: Blender uses left multiplication!
-    rotationMatrix = Mathutils.RotationMatrix(-90.0,4,'x')
-    rotationMatrix *= Mathutils.RotationMatrix(0.0,4,'y')
-    rotationMatrix *= Mathutils.RotationMatrix(0.0,4,'z')
-    scaleMatrix = Mathutils.Matrix([1.0,0,0],[0,1.0,0],[0,0,1.0])
-    scaleMatrix.resize4x4()
-    BASE_MATRIX = rotationMatrix*scaleMatrix
-
-    #exportOptions = ExportOptions(rotXNumber.val, rotYNumber.val, rotZNumber.val, scaleNumber.val,
-    #    worldCoordinatesToggle.val, ambientToggle.val, pathString.val, materialString.val)
-    exportOptions = ExportOptions(0.0, 0.0, 0.0, 1.0, 0, 0, 0, 1, full_path, "kanalisation.material")
-    if not os.path.exists(full_path):
-      exportLogger.logError("Invalid path: "+full_path)
-    else:
-      exportLogger.logInfo("Exporting selected objects into \"" + full_path + "\":")
-      n = 0
-      for obj in selectedObjectsList:
-          if obj:
-              if obj.getType() == "Mesh":
-                  exportLogger.logInfo("Exporting object \"%s\":" % obj.getName())
-                  export_mesh(obj, exportOptions)
-                  n = 1
-              elif obj.getType() == "Armature":
-                  exportLogger.logInfo("Exporting object \"%s\":" % obj.getName())
-                  actionActuatorList = armatureActionActuatorListViewDict[obj.getName()].armatureActionActuatorList
-                  armatureMeshExporter = ArmatureMeshExporter(obj)
-                  armatureMeshExporter.export(materialsDict, actionActuatorList, exportOptions, exportLogger)
-      if n == 0:
-          exportLogger.logWarning("No mesh objects selected!")
-      if len(materialsDict) == 0:
-          exportLogger.logWarning("No materials or textures defined!")
-      else:
-          print "Here would material export come"
-          write_materials()
-
-      exportLogger.logInfo("Finished.")
-    return exportLogger.getStatus()
-
-######
-# scene export classes
-######
-class Action:
-	"""Action interface.
-	
-	   Actions encapsulate user requests.
-	"""
-	def __init__(self):
-		"""Constructor.
-		"""
-		return
-	def execute(self):
-		"""Executes the action.
-		"""
-		return
-	
-class QuitAction(Action):
-	"""Quits the windowing system.
-	"""
-	def execute(self):
-		Blender.Draw.Exit()
-		return
-
-class Model:
-	"""Model interface.
-	"""
-	def __init__(self):
-		self.viewList = []
-		return
-	def addView(self, view):
-		self.viewList.append(view)
-		return
-	def removeView(self, view):
-		if view in self.viewList:
-			self.viewList.remove(view)
-		return
-	# protected
-	def _notify(self):
-		"""Notify views.
-		"""
-		for view in self.viewList:
-			view.update()
-		return
-
-class View:
-	"""View interface.
-	"""
-	def __init__(self):
-		return
-	def update(self):
-		return
-
-class Widget:
-	"""Widget interface.
-	
-	   @cvar INFINITY Infinity value for size hints.
-	"""
-	INFINITY = 2147483647
-	def __init__(self):
-		"""Constructor.
-		"""
-		return
-	def draw(self, screenRectangle):
-		"""Draws the widget into an area of the screen.
-		
-		   @param screenRectangle Area of the screen to draw into.
-		          The screenRectangle is a list of the integers
-		          <code>[xl, yl, xu, yu]</code>, where (xl,yl) is
-		          the lower left corner of the area and (xu, yu) is
-		          the upper right corner of the area.
-		"""
-		return
-	def eventFilter(self, event, value):
-		"""Called from event callback function.
-		
-		   @see Blender.Draw.Register
-		"""
-		return
-	def addButtons(self, parent):
-		"""Registers widget buttons at the parent.
-		
-		   @param parent Parent widget or screen.
-		"""
-		return
-	def removeButtons(self, parent):
-		"""Removes widget buttons from parent.
-		
-		   @param parent Parent widget or screen.
-		"""
-		return
-	def getMaximumSize(self):
-		"""Returns the maximum size of this widget.
-		
-		   @return List of integers <code>[width, height]</code>.
-		"""
-		return [Widget.INFINITY, Widget.INFINITY]
-	def getMinimumSize(self):
-		"""Returns the minimum size of this widget.
-		
-		   @return List of integers <code>[width, height]</code>.
-		"""
-		return [0, 0]
-	def getPreferredSize(self):
-		"""Returns the preferred size of this widget.
-		
-		   @return List of integers <code>[width, height]</code>.
-		"""
-		return [0, 0]
-
-class VerticalLayout(Widget):
-	"""Widget that manages vertically stacked child widgets.
-	"""
-	def __init__(self):
-		"""Constructor.
-		"""
-		# widgetDict key: name, value: Widget
-		self.widgetDict = {}
-		# displayList list of widget names in the order to draw them
-		self.displayList = []
-		# parent to register buttons to.
-		self.parent = None
-		return
-	def addWidget(self, widget, name):
-		"""Adds a child widget to this layout.
-		
-		   The child widget is appended below all other widgets.
-		
-		   @param widget Widget to add.
-		   @param name Unique name for the widget.
-		"""
-		self.widgetDict[name] = widget
-		if name not in self.displayList:
-			self.displayList.append(name)
-		# register to known parent
-		if self.parent:
-			widget.addButtons(self.parent)
-		return
-	def removeWidget(self, name):
-		"""Removes a child widget from this layout.
-		
-		   @param name Name of the widget to remove.
-		   @see addWidget
-		"""
-		if self.widgetDict.has_key(name):
-			if self.parent:
-				self.widgetDict[name].removeButtons(self.parent)
-			del self.widgetDict[name]
-			del self.displayList[self.displayList.index(name)]
-		return
-	def addButtons(self, parent):
-		self.parent = parent
-		for widget in self.widgetDict.values():
-			widget.addButtons(self.parent)
-		return
-	def removeButtons(self, parent):
-		for widget in self.widgetDict.values():
-			widget.removeButtons(self.parent)
-		return
-	def draw(self, screenRectangle):
-		# split height for the child widgets
-		minimumSize = self.getMinimumSize()
-		height = screenRectangle[3]- screenRectangle[1]
-		additionalHeight = height - minimumSize[1]
-		stretchWidgetList = []
-		extraHeight = 0
-		# get widgets with unlimited preferred height
-		if (additionalHeight > 0):
-			stretchWidgetList = [name for (name, w) in self.widgetDict.items() if w.getPreferredSize()[1] >= Widget.INFINITY]
-			if (len(stretchWidgetList) > 0):
-				# give equal extra height to widgets with unlimited preferred height
-				extraHeight = additionalHeight / len(stretchWidgetList)
-		# draw widgets with minimum or minimum plus extra size
-		y = screenRectangle[3]
-		dy = 0
-		for name in self.displayList:
-			widget = self.widgetDict[name]
-			dy = widget.getMinimumSize()[1]
-			if (name in stretchWidgetList):
-				dy += extraHeight
-			widget.draw([screenRectangle[0], y-dy, screenRectangle[2], y])
-			y -= dy
-		return
-	def eventFilter(self, event, value):
-		for widget in self.widgetDict.values():
-			widget.eventFilter(event, value)
-		return
-	def getMaximumSize(self):
-		size = [0, 0]
-		for widget in self.widgetDict.values():
-			if (size[0] < widget.getMaximumSize()[0]):
-				size[0] = widget.getMaximumSize()[0]
-			size[1] += widget.getMaximumSize()[1]
-		return size
-	def getMinimumSize(self):
-		size = [0, 0]
-		for widget in self.widgetDict.values():
-			if (size[0] < widget.getMinimumSize()[0]):
-				size[0] = widget.getMinimumSize()[0]
-			size[1] += widget.getMinimumSize()[1]
-		return size
-	def getPreferredSize(self):
-		size = [0, 0]
-		for widget in self.widgetDict.values():
-			if (size[0] < widget.getPreferredSize()[0]):
-				size[0] = widget.getPreferredSize()[0]
-			size[1] += widget.getPreferredSize()[1]
-		return size
-
-class HorizontalLayout(Widget):
-	"""Widget that manages horizontally stacked child widgets.
-	"""
-	def __init__(self):
-		"""Constructor.
-		"""
-		# widgetDict key: name, value: Widget
-		self.widgetDict = {}
-		# displayList list of widget names in the order to draw them
-		self.displayList = []
-		# parent to register buttons to.
-		self.parent = None
-		return
-	def addWidget(self, widget, name):
-		"""Adds a child widget to this layout.
-		
-		   The child widget is appended below all other widgets.
-		
-		   @param widget Widget to add.
-		   @param name Unique name for the widget.
-		"""
-		self.widgetDict[name] = widget
-		if name not in self.displayList:
-			self.displayList.append(name)
-		if self.parent:
-			widget.addButtons(self.parent)
-		return
-	def removeWidget(self, name):
-		"""Removes a child widget from this layout.
-		
-		   @param name Name of the widget to remove.
-		   @see addWidget
-		"""
-		if self.widgetDict.has_key(name):
-			if self.parent:
-				self.widgetDict[name].removeButtons(self.parent)
-			del self.widgetDict[name]
-			del self.displayList[self.displayList.index(name)]
-		return
-	def addButtons(self, parent):
-		self.parent = parent
-		for widget in self.widgetDict.values():
-			widget.addButtons(self.parent)
-		return
-	def removeButtons(self, parent):
-		for widget in self.widgetDict.values():
-			widget.removeButtons(self.parent)
-		return
-	def draw(self, screenRectangle):
-		# split height for the child widgets
-		minimumSize = self.getMinimumSize()
-		width = screenRectangle[2]- screenRectangle[0]
-		additionalWidth = width - minimumSize[0]
-		stretchWidgetList = []
-		extraWidth = 0
-		# get widgets with unlimited preferred height
-		if (additionalWidth > 0):
-			stretchWidgetList = [name for (name, w) in self.widgetDict.items() if w.getPreferredSize()[0] >= Widget.INFINITY]
-			if (len(stretchWidgetList) > 0):
-				# give equal extra height to widgets with unlimited preferred height
-				extraWidth = additionalWidth / len(stretchWidgetList)
-		# draw widgets with minimum or minimum plus extra size
-		x = screenRectangle[0]
-		dx = 0
-		for name in self.displayList:
-			widget = self.widgetDict[name]
-			dx = widget.getMinimumSize()[0]
-			if (name in stretchWidgetList):
-				dx += extraWidth
-			widget.draw([x, screenRectangle[1], x+dx, screenRectangle[3]])
-			x += dx
-		return
-	def eventFilter(self, event, value):
-		for widget in self.widgetDict.values():
-			widget.eventFilter(event, value)
-		return
-	def getMaximumSize(self):
-		size = [0, 0]
-		for widget in self.widgetDict.values():
-			size[0] += widget.getMaximumSize()[0]
-			if (size[1] < widget.getMaximumSize()[1]):
-				size[1] = widget.getMaximumSize()[1]
-		return size
-	def getMinimumSize(self):
-		size = [0, 0]
-		for widget in self.widgetDict.values():
-			size[0] += widget.getMinimumSize()[0]
-			if (size[1] < widget.getMinimumSize()[1]):
-				size[1] = widget.getMinimumSize()[1]
-		return size
-	def getPreferredSize(self):
-		size = [0, 0]
-		for widget in self.widgetDict.values():
-			size[0] += widget.getPreferredSize()[0]
-			if (size[1] < widget.getPreferredSize()[1]):
-				size[1] = widget.getPreferredSize()[1]
-		return size
-
-class HorizontalRatioLayout(Widget):
-	"""Widget that manages horizontally stacked child widgets.
-	
-	   The drawing area is distributed among the childs with a given ratio.
-	"""
-	def __init__(self):
-		# widgetDict key: name, value: [Widget, ratio]
-		self.widgetDict = {}
-		# displayList list of widget names in the order to draw them
-		self.displayList = []
-		# parent to register buttons to.
-		self.parent = None
-		return
-	def addWidget(self, ratio, widget, name):
-		"""Adds a child widget to this layout.
-		
-		   The child widget is appended right to all other widgets.
-		   The ratios must sum up to one.
-		
-		   @param ratio Ratio of screen width to occupy with this widget. 
-		   @param widget Widget to add.
-		   @param name Unique name for the widget.
-		"""
-		self.widgetDict[name] = [widget, ratio]
-		if name not in self.displayList:
-			self.displayList.append(name)
-		if self.parent:
-			widget.addButtons(self.parent)
-		return
-	def removeWidget(self, name):
-		"""Removes a child widget from this layout.
-		
-		   @param name Name of the widget to remove.
-		   @see addWidget
-		"""
-		if self.widgetDict.has_key(name):
-			if self.parent:
-				self.widgetDict[name].removeButtons(self.parent)
-			del self.widgetDict[name]
-			del self.displayList[self.displayList.index(name)]
-		return
-	def addButtons(self, parent):
-		self.parent = parent
-		for widget in self.widgetDict.values():
-			widget[0].addButtons(self.parent)
-		return
-	def removeButtons(self, parent):
-		for widget in self.widgetDict.values():
-			widget[0].removeButtons(self.parent)
-		return
-	def draw(self, screenRectangle):
-		# split height for the child widgets
-		minimumSize = self.getMinimumSize()
-		width = screenRectangle[2] - screenRectangle[0]
-		ratioSum = 0
-		x = screenRectangle[0]
-		dx = 0
-		for name in self.displayList:
-			[widget, ratio] = self.widgetDict[name]
-			ratioSum += ratio
-			if ratio >= 1:
-				dx = screenRectangle[2] - x + 1
-			else:
-				dx = int(ratio*width)
-			widget.draw([x, screenRectangle[1], x+dx-1, screenRectangle[3]])
-			x += dx
-		return
-	def eventFilter(self, event, value):
-		for [widget, ratio] in self.widgetDict.values():
-			widget.eventFilter(event, value)
-		return		
-	def getMaximumSize(self):
-		size = [0, 0]
-		for [widget, ratio] in self.widgetDict.values():
-			size[0] += widget.getMaximumSize()[0]
-			if (size[1] < widget.getMaximumSize()[1]):
-				size[1] = widget.getMaximumSize()[1]
-		return size
-	def getMinimumSize(self):
-		size = [0, 0]
-		for [widget, ratio] in self.widgetDict.values():
-			size[0] += widget.getMinimumSize()[0]
-			if (size[1] < widget.getMinimumSize()[1]):
-				size[1] = widget.getMinimumSize()[1]
-		return size
-	def getPreferredSize(self):
-		size = [Widget.INFINITY, 0]
-		for [widget, ratio] in self.widgetDict.values():
-			if (size[1] < widget.getPreferredSize()[1]):
-				size[1] = widget.getPreferredSize()[1]
-		return size
-
-class Spacer(Widget):
-	"""Occupies blank space on the screen.
-	"""
-	def __init__(self, minimumSize, maximumSize=None, preferredSize=None):
-		"""Constructor.
-		
-		   If maximum or preferred size is not given, the minimum size will be used instead.
-		"""
-		self.minimumSize = minimumSize
-		if maximumSize:
-			self.maximumSize = maximumSize
-		else:
-			self.maximumSize = minimumSize
-		if preferredSize:
-			self.preferredSize = preferredSize
-		else:
-			self.preferredSize = minimumSize
-	def getMaximumSize(self):
-		return self.maximumSize
-	def getMinimumSize(self):
-		return self.minimumSize
-	def getPreferredSize(self):
-		return self.preferredSize
-
-class Decorator(Widget):
-	"""Decorates a child widget.
-	"""
-	def __init__(self, childWidget):
-		self.childWidget = childWidget
-		return
-	def draw(self, screenRectangle):
-		self.childWidget.draw(screenRectangle)
-		return
-	def eventFilter(self, event, value):
-		self.childWidget.eventFilter(event, value)
-		return
-	def addButtons(self, parent):
-		self.childWidget.addButtons(parent)
-		return
-	def removeButtons(self, parent):
-		self.childWidget.removeButtons(parent)
-		return
-
-class Border(Decorator):
-	"""Border around widgets.
-	"""
-	def __init__(self, childWidget, borderSize=10):
-		"""Constructor.
-		
-		   @param childWidget Widget to decorate.
-		   @param borderSize Size of the border.
-		"""
-		Decorator.__init__(self, childWidget)
-		self.borderSize = borderSize
-		return
-	def draw(self, screenRectangle):
-		rect = screenRectangle[:]
-		rect[0] += self.borderSize
-		rect[1] += self.borderSize
-		rect[2] -= self.borderSize
-		rect[3] -= self.borderSize
-		self.childWidget.draw(rect)
-		return
-	def getMaximumSize(self):
-		size = self.childWidget.getMaximumSize()[:]
-		size[0] += 2*self.borderSize
-		size[1] += 2*self.borderSize
-		return size
-	def getMinimumSize(self):
-		size = self.childWidget.getMinimumSize()[:]
-		size[0] += 2*self.borderSize
-		size[1] += 2*self.borderSize
-		return size
-	def getPreferredSize(self):
-		size = self.childWidget.getPreferredSize()[:]
-		size[0] += 2*self.borderSize
-		size[1] += 2*self.borderSize
-		return size
-		
-class Box(Decorator):
-	"""Provides a border with an optional titel for a child widget.
-	"""
-	def __init__(self, childWidget, title=None):
-		"""Constructor.
-		
-		   @param childWidget Widget to decorate.
-		   @param title Optional frame title.
-		"""
-		Decorator.__init__(self, childWidget)
-		self.title = title
-		return
-	def draw(self, screenRectangle):
-		rect = screenRectangle[:]
-		if self.title:
-			# border and title
-			rect[0] += 3
-			rect[1] += 3
-			rect[2] -= 3
-			rect[3] -= 13
-			# title
-			titleWidth = Blender.Draw.GetStringWidth(self.title)
-			theme = Blender.Window.Theme.Get()[0]
-			glColor4ub(*theme.get('text').text)
-			glRasterPos2i(rect[0]+4, rect[3])
-			Blender.Draw.Text(self.title)
-			# border
-			glColor3f(0.0, 0.0, 0.0)
-			glBegin(GL_LINE_STRIP)
-			glVertex2i(rect[0]+6+titleWidth, rect[3]+5)
-			glVertex2i(rect[2], rect[3]+5)
-			glVertex2i(rect[2], rect[1])
-			glVertex2i(rect[0], rect[1])
-			glVertex2i(rect[0], rect[3]+5)
-			glVertex2i(rect[0]+3, rect[3]+5)
-			glEnd()
-			rect[0] += 3
-			rect[1] += 3
-			rect[2] -= 3
-			rect[3] -= 3
-		else:
-			# border only
-			glColor3f(0.0, 0.0, 0.0)
-			glBegin(GL_LINE_STRIP)
-			rect[0] += 3
-			rect[1] += 3
-			rect[2] -= 3
-			rect[3] -= 3
-			glVertex2i(rect[0], rect[1])
-			glVertex2i(rect[0], rect[3])
-			glVertex2i(rect[2], rect[3])
-			glVertex2i(rect[2], rect[1])
-			glVertex2i(rect[0], rect[1])
-			glEnd()
-			rect[0] += 3
-			rect[1] += 3
-			rect[2] -= 3
-			rect[3] -= 3
-		self.childWidget.draw(rect)
-		return
-	def getMaximumSize(self):
-		size = self.childWidget.getMaximumSize()[:]
-		size[0] += 12
-		size[1] += 12
-		if size[0] < self.getMinimumSize()[0]:
-			size[0] = self.getMinimumSize()[0]
-		return size
-	def getMinimumSize(self):
-		size = self.childWidget.getMinimumSize()[:]
-		# basic border size
-		size[0] += 12
-		size[1] += 12
-		# add title size
-		if self.title:
-			size[1] += 11
-			if (size[0] < (Blender.Draw.GetStringWidth(self.title)+16)):
-				size[0] = (Blender.Draw.GetStringWidth(self.title)+16)
-		return size
-	def getPreferredSize(self):
-		size = self.childWidget.getPreferredSize()[:]
-		size[0] += 12
-		size[1] += 12
-		if size[0] < self.getMinimumSize()[0]:
-			size[0] = self.getMinimumSize()[0]
-		return size
-
-class WidgetList(Widget):
-	"""Displays a list of vertically stacked widgets using a scrollbar if necessary.
-	"""
-	def __init__(self):
-		"""Constructor.
-		"""
-		# widgetDict key: name, value: Widget
-		self.widgetDict = {}
-		# displayList list of widget names in the order to draw them
-		self.displayList = []
-		# visible child widgets
-		self.visibleList = []
-		# parent to register buttons to.
-		self.parent = None
-		# scrollbar
-		self.scrollbar = VerticalScrollbar(0, 0, 0)
-		return
-	def addWidget(self, widget, name):
-		"""Adds a child widget to this layout.
-		
-		   The child widget is appended below all other widgets.
-		
-		   @param widget Widget to add.
-		   @param name Unique name for the widget.
-		"""
-		self.widgetDict[name] = widget
-		if name not in self.displayList:
-			self.displayList.append(name)
-		# register to known parent
-		if self.parent:
-			widget.addButtons(self.parent)
-		return
-	def removeWidget(self, name):
-		"""Removes a child widget from this layout.
-		
-		   @param name Name of the widget to remove.
-		   @see addWidget
-		"""
-		if self.widgetDict.has_key(name):
-			if self.parent:
-				self.widgetDict[name].removeButtons(self.parent)
-			del self.widgetDict[name]
-			del self.displayList[self.displayList.index(name)]
-		return
-	def addButtons(self, parent):
-		self.parent = parent
-		for widget in self.widgetDict.values():
-			widget.addButtons(self.parent)
-		self.scrollbar.addButtons(self.parent)
-		return
-	def removeButtons(self, parent):
-		for widget in self.widgetDict.values():
-			widget.removeButtons(self.parent)
-		self.scrollbar.removeButtons(self.parent)
-		return	
-	def draw(self, screenRectangle):
-		# draw a border
-		rect = screenRectangle[:]
-		glColor3f(0.0, 0.0, 0.0)
-		glBegin(GL_LINE_STRIP)
-		glVertex2i(rect[0], rect[3])
-		glVertex2i(rect[2], rect[3])
-		glVertex2i(rect[2], rect[1])
-		glVertex2i(rect[0], rect[1])
-		glVertex2i(rect[0], rect[3])
-		glVertex2i(rect[0], rect[3])
-		glEnd()
-		rect[0] += 1
-		rect[1] += 1
-		rect[2] -= 1
-		rect[3] -= 1
-		# calculate nFirstLines form screenRectangle and set scrollbar accordingly
-		firstLine = self.scrollbar.getCurrentValue()
-		# get list backwards until height is fully used
-		nLines = len(self.displayList)
-		height = rect[3] - rect[1]
-		iLine = -1
-		while ((iLine >= -nLines) and (height > 0)):
-			height -= self.widgetDict[self.displayList[iLine]].getMinimumSize()[1]
-			if height >= 0:
-				iLine -= 1
-		# nLines + iLine + 1 = nFirstLines - 1
-		if (firstLine > (nLines + iLine + 1)):
-			firstLine = nLines + iLine + 1
-		self.scrollbar.currentValue = firstLine
-		self.scrollbar.maximumValue = nLines + iLine + 1
-		self.scrollbar.draw([rect[2]-20, rect[1], rect[2], rect[3]])
-		# widgets
-		self.visibleList = []
-		height = rect[3] - rect[1]
-		iLine = firstLine
-		y = rect[3]
-		while ((iLine < nLines) and (height > 0)):
-			widget = self.widgetDict[self.displayList[iLine]]
-			dy = widget.getMinimumSize()[1]
-			height -= dy
-			if (height > 0):
-				widget.draw([rect[0], y - dy, rect[2]-21, y])
-				self.visibleList.append(widget)
-				y -= dy
-				iLine += 1
-		return
-	def eventFilter(self, event, value):
-		for widget in self.visibleList:
-			widget.eventFilter(event, value)	
-		self.scrollbar.eventFilter(event, value)
-		return
-	def getMinimumSize(self):
-		# max minimumSize()[0] + scrollbar and minimumSize[1] of childs
-		size = [0, 0]
-		for widget in self.widgetDict.values():
-			widgetSize = widget.getMinimumSize() 
-			if size[0] < widgetSize[0]:
-				size[0] = widgetSize[0]
-			if size[1] < widgetSize[1]:
-				size[1] = widgetSize[1]
-		# scrollbar
-		scrollbarSize = self.scrollbar.getMinimumSize()
-		size[0] += scrollbarSize[0]
-		if size[1] < scrollbarSize[1]:
-			size[1] = scrollbarSize[1]
-		return size
-	def getMaximumSize(self):
-		# max maximumSize()[0] and sum maximumSize()[1] of childs
-		return [0, 0]
-	def getPreferredSize(self):
-		# self.minimumSize()[0] and Widget.INFINITY for height
-		minimumSize = self.getMinimumSize()
-		return [minimumSize[0], Widget.INFINITY]
-	
-class Label(Widget):
-	"""Displays a text string.
-	"""
-	def __init__(self, string, fontSize='normal', fontColor=None):
-		"""Constructor.
-		
-		   @param string Text string to display.
-		   @param fontSize Size of the font used for display:
-		                  <code>'normal'</code>, <code>'small'</code> or <code>'tiny'</code>.
-		   @param fontColor List of font color values.
-		"""
-		self.string = string
-		self.fontSize = fontSize
-		self.fontColor = fontColor
-		return
-	def draw(self, screenRectangle):
-		if self.fontColor:
-			if (len(self.fontColor) == 3):
-				glColor3f(*self.fontColor)
-			else:
-				glColor4f(*self.fontColor)
-		else:
-			# theme font color
-			theme = Blender.Window.Theme.Get()[0]
-			glColor4ub(*theme.get('text').text)
-		glRasterPos2i(screenRectangle[0], screenRectangle[1]+3)
-		Blender.Draw.Text(self.string, self.fontSize)
-		return
-	def getMinimumSize(self):
-		return [Blender.Draw.GetStringWidth(self.string, self.fontSize), 11]
-	
-class Button(Widget):
-	"""Push button.
-	"""
-	def __init__(self, action, name, size, tooltip=None):
-		"""Constructor.
-		
-		   @param action Action to execute when the button is pushed.
-		   @param name Button name.
-		   @param size Minimum size of the button, <code>[width, height]</code>.
-		   @param tooltip Tooltip to display for the button.
-		"""
-		self.action = action
-		# Button event number
-		self.event = None
-		self.name = name
-		self.size = size
-		self.preferredSize = size
-		self.tooltip = tooltip
-		return
-	def draw(self, rect):
-		if self.tooltip:
-			Blender.Draw.PushButton(self.name, self.event, rect[0], rect[1], rect[2]-rect[0], rect[3]-rect[1]-1, self.tooltip)
-		else:
-			Blender.Draw.PushButton(self.name, self.event, rect[0], rect[1], rect[2]-rect[0], rect[3]-rect[1]-1)
-		return
-	def addButtons(self, parent):
-		self.event = parent.addButtonAction(self.action)
-		return
-	def getMinimumSize(self):
-		return self.size
-	def getPreferredSize(self):
-		return self.preferredSize
-
-class QuitButton(Button):
-	def eventFilter(self, event, value):
-		if (value != 0):
-			# pressed
-			if (event == Draw.ESCKEY):
-				self.action.execute()
-			if (event == Draw.QKEY):
-				self.action.execute()
-		return
-
-class CheckBox(Widget):
-	"""Two state toggle button.
-	
-	   To provide two way communication between the CheckBox and its parent widget
-	   you can use the following setup:
-	<pre>
-	Parent	CheckBox	OnChangeAction
-  	|--------------------->T            Action(self)
-  	|------->T             |            CheckBox(OnChangeAction, ...)
-  	|        |------------>|            OnChangeAction.execute()
-  	|<-------+-------------|            Parent.checkBoxChanged()
-  	|------->|             |            CheckBox.isChecked()
-	</pre>
-	"""
-	def __init__(self, onChangeAction, checked, name, size, tooltip=None):
-		# check status
-		self.checked = checked
-		self.action = CheckBox.CheckAction(self, onChangeAction)
-		self.name = name
-		self.size = size
-		self.tooltip = tooltip
-		self.event = None
-		return
-	def toggle(self):
-		self.checked = 1 - self.checked
-		Blender.Draw.Redraw(1)
-		return
-	def isChecked(self):
-		return self.checked
-	def draw(self, rect):
-		if self.tooltip:
-			Blender.Draw.Toggle(self.name, self.event, rect[0], rect[1], rect[2]-rect[0]-1, rect[3]-rect[1]-1, self.isChecked(), self.tooltip)
-		else:
-			Blender.Draw.Toggle(self.name, self.event, rect[0], rect[1], rect[2]-rect[0]-1, rect[3]-rect[1]-1, self.isChecked())
-		return
-	def addButtons(self, parent):
-		self.event = parent.addButtonAction(self.action)
-		return
-	def getMinimumSize(self):
-		return self.size
-	class CheckAction(Action):
-		def __init__(self, checkBox, action):
-			self.checkBox = checkBox
-			self.action = action
-			return
-		def execute(self):
-			self.checkBox.toggle()
-			self.action.execute()
-			return
-
-class StringButton(Button):
-	def __init__(self, string, action, name, size, tooltip=None):
-		"""Constructor.
-		
-		   @param string Initial string
-		   @param action Action to execute when the button is pushed.
-		   @param name Button name.
-		   @param size Minimum size of the button, <code>[width, height]</code>.
-		   @param tooltip Tooltip to display for the button.
-		"""
-		self.string = Blender.Draw.Create(string)
-		Button.__init__(self, action, name, size, tooltip)
-		return
-	def getString(self):
-		"""Returns current string.
-		"""
-		return self.string.val
-	def draw(self, rect):
-		if self.tooltip:
-			self.string = Blender.Draw.String(self.name, self.event, rect[0], rect[1], rect[2]-rect[0], rect[3]-rect[1]-1, self.string.val, 255, self.tooltip)
-		else:
-			self.string = Blender.Draw.String(self.name, self.event, rect[0], rect[1], rect[2]-rect[0], rect[3]-rect[1]-1, self.string.val, 255)
-		return
-	
-class BoundedValueModel(Model):
-	def __init__(self, minimum=0, maximum=0, initial=0):
-		Model.__init__(self)
-		self.minimum = minimum
-		self.maximum = maximum
-		self.value = None
-		self.setValue(initial)
-		return
-	def getMinimum(self):
-		return self.minimum
-	def getMaximum(self):
-		return self.maximum
-	def getValue(self):
-		return self.value
-	def setValue(self, value):
-		if (value != self.value):
-			if value < self.minimum:
-				self.value = self.minimum
-			elif value > self.maximum:
-				self.value = self.maximum
-			else:
-				self.value = value
-			self._notify()
-		return
-
-class NumberView(Widget, View):
-	def __init__(self, name, model, minSize, prefSize=None, maxSize=None, tooltip=None):
-		"""Constructor.
-		   @param model BoundedValueModel.
-		"""
-		Widget.__init__(self)
-		View.__init__(self)
-		self.model = model
-		self.model.addView(self)
-		self.numberButton = Blender.Draw.Create(self.model.getValue())
-		self.title = name
-		self.tooltip = tooltip
-		self.minSize = minSize
-		self.maxSize = maxSize or minSize
-		self.prefSize = prefSize or minSize
-		self.event = None
-		return
-	def addButtons(self, parent):
-		self.event = parent.addButtonAction(NumberView.SetAction(self))
-		return
-	def draw(self, rect):
-		if self.tooltip:
-			self.numberButton = Blender.Draw.Number(self.title, self.event, \
-				rect[0], rect[1], rect[2]-rect[0]-1, rect[3]-rect[1]-1, \
-				self.model.getValue(), self.model.getMinimum(), self.model.getMaximum(), self.tooltip)
-		else:
-			self.numberButton = Blender.Draw.Number(self.title, self.event, \
-				rect[0], rect[1], rect[2]-rect[0]-1, rect[3]-rect[1]-1, \
-				self.model.getValue(), self.model.getMinimum(), self.model.getMaximum())
-		return
-	def update(self):
-		Blender.Draw.Redraw(1)
-		return
-	def getMaximumSize(self):
-		return self.maxSize
-	def getMinimumSize(self):
-		return self.minSize
-	def getPreferredSize(self):
-		return self.prefSize
-	class SetAction(Action):
-		def __init__(self, view):
-			self.view = view
-			return
-		def execute(self):
-			self.view.model.setValue(self.view.numberButton.val)
-			return
-
-class VerticalScrollbar(Widget):
-	"""Scrollbar.
-	"""
-	def __init__(self, initial, minimum, maximum):
-		"""Constructor.
-		
-		   @param initial Initial value.
-		   @param minimum Minimum value.
-		   @param maximum Maximum value.
-		"""
-		self.currentValue = initial
-		self.minimumValue = minimum
-		self.maximumValue = maximum
-		# private
-		self.buttonUpEvent = None
-		self.buttonDownEvent = None
-		self.guiRect = [0,0,0,0]
-		self.positionRect = [0,0,0,0]
-		self.markerRect = [0,0,0,0]
-		self.mousePressed = 0
-		self.mouseFocusX = 0
-		self.mouseFocusY = 0
-		self.markerFocusY = 0
-		self.mousePositionY = 0
-		return
-	def getCurrentValue(self):
-		"""Returns current marker position.
-		"""
-		return self.currentValue
-	def up(self, steps=1):
-		"""Move scrollbar up.
-		"""
-		if (steps > 0):
-			if ((self.currentValue - steps) > self.minimumValue):
-				self.currentValue -= steps
-			else:
-				self.currentValue = self.minimumValue
-		return
-	def down(self, steps=1):
-		"""Move scrollbar down.
-		"""
-		if (steps > 0):
-			if ((self.currentValue + steps) < self.maximumValue): 
-				self.currentValue += steps
-			else:
-				self.currentValue = self.maximumValue
-		return
-	def draw(self, screenRectangle):
-		"""draw scrollbar
-		"""
-		# get size of the GUI window to translate MOUSEX and MOUSEY events
-		guiRectBuffer = Blender.BGL.Buffer(GL_FLOAT, 4)
-		Blender.BGL.glGetFloatv(Blender.BGL.GL_SCISSOR_BOX, guiRectBuffer)
-		self.guiRect = [int(guiRectBuffer.list[0]), int(guiRectBuffer.list[1]), \
-		                int(guiRectBuffer.list[2]), int(guiRectBuffer.list[3])]
-		# relative position
-		x = screenRectangle[0]
-		y = screenRectangle[1]
-		width = screenRectangle[2] - x
-		height = screenRectangle[3] - y
-		self.positionRect = screenRectangle
-		# check minimal size:
-		# 2 square buttons,4 pixel borders and 1 pixel inside for inner and marker rectangles
-		#if ((height > (2*(width+5))) and (width > 2*5)):
-		# keep track of remaining area
-		remainRect = self.positionRect[:]
-		# draw square buttons
-		Blender.Draw.Button("/\\", self.buttonUpEvent, x, y + (height-width), width, width, "scroll up") 
-		remainRect[3] -=  width + 2
-		Blender.Draw.Button("\\/", self.buttonDownEvent, x, y, width, width, "scroll down") 
-		remainRect[1] +=  width + 1
-		# draw inner rectangle
-		Blender.BGL.glColor3f(0.13,0.13,0.13) # dark grey
-		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-		remainRect[0] += 1
-		remainRect[3] -= 1
-		Blender.BGL.glColor3f(0.78,0.78,0.78) # light grey
-		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-		remainRect[1] += 1
-		remainRect[2] -= 1
-		Blender.BGL.glColor3f(0.48,0.48,0.48) # grey
-		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-		# draw marker rectangle
-		# calculate marker rectangle
-		innerHeight = remainRect[3]-remainRect[1]
-		markerHeight = innerHeight/(self.maximumValue-self.minimumValue+1.0)
-		# markerRect 
-		self.markerRect[0] = remainRect[0]
-		self.markerRect[1] = remainRect[1] + (self.maximumValue - self.currentValue)*markerHeight
-		self.markerRect[2] = remainRect[2]
-		self.markerRect[3] = self.markerRect[1] + markerHeight
-		# clip markerRect to innerRect (catch all missed by one errors)
-		if self.markerRect[1] > remainRect[3]:
-			self.markerRect[1] = remainRect[3]
-		if self.markerRect[3] > remainRect[3]:
-			self.markerRect[3] = remainRect[3]
-		# draw markerRect
-		remainRect = self.markerRect
-		Blender.BGL.glColor3f(0.78,0.78,0.78) # light grey
-		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-		remainRect[0] += 1
-		remainRect[3] -= 1
-		Blender.BGL.glColor3f(0.13,0.13,0.13) # dark grey
-		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-		remainRect[1] += 1
-		remainRect[2] -= 1
-		# check if marker has foucs
-		if (self.mouseFocusX and self.mouseFocusY and (self.mousePositionY > self.markerRect[1]) and (self.mousePositionY < self.markerRect[3])):
-			Blender.BGL.glColor3f(0.64,0.64,0.64) # marker focus grey
-		else:
-			Blender.BGL.glColor3f(0.60,0.60,0.60) # marker grey
-		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
-		return
-	def eventFilter(self, event, value):
-		"""event filter for keyboard and mouse input events
-		   call it inside the registered event function
-		"""
-		if (value != 0):
-			# Buttons
-			if (event == Blender.Draw.PAGEUPKEY):
-				self.up(3)
-				Blender.Draw.Redraw(1)
-			elif (event == Blender.Draw.PAGEDOWNKEY):
-				self.down(3)
-				Blender.Draw.Redraw(1)
-			elif (event == Blender.Draw.UPARROWKEY):
-				self.up(1)
-				Blender.Draw.Redraw(1)
-			elif (event == Blender.Draw.DOWNARROWKEY):
-				self.down(1)
-				Blender.Draw.Redraw(1)
-			# Mouse
-			elif (event == Blender.Draw.MOUSEX):
-				# check if mouse is inside positionRect
-				if (value >= (self.guiRect[0] + self.positionRect[0])) and (value <= (self.guiRect[0] + self.positionRect[2])):
-					# redraw if marker got focus
-					if (not self.mouseFocusX) and self.mouseFocusY:
-						Blender.Draw.Redraw(1)
-					self.mouseFocusX = 1
-				else:
-					# redraw if marker lost focus
-					if self.mouseFocusX and self.mouseFocusY:
-						Blender.Draw.Redraw(1)
-					self.mouseFocusX = 0
-			elif (event == Blender.Draw.MOUSEY):
-				# check if mouse is inside positionRect
-				if (value >= (self.guiRect[1] + self.positionRect[1])) and (value <= (self.guiRect[1] + self.positionRect[3])):
-					self.mouseFocusY = 1
-					# relative mouse position
-					self.mousePositionY = value - self.guiRect[1]
-					if ((self.mousePositionY > self.markerRect[1]) and (self.mousePositionY < self.markerRect[3])):
-						# redraw if marker got focus
-						if self.mouseFocusX and (not self.markerFocusY):
-							Blender.Draw.Redraw(1)
-						self.markerFocusY = 1
-					else:
-						# redraw if marker lost focus
-						if self.mouseFocusX and self.markerFocusY:
-							Blender.Draw.Redraw(1)
-						self.markerFocusY = 0
-					# move marker
-					if (self.mousePressed == 1):
-						# calculate step from distance to marker
-						if (self.mousePositionY > self.markerRect[3]):
-							# up
-							self.up(1)
-							Blender.Draw.Draw()
-						elif (self.mousePositionY < self.markerRect[1]):
-							# down
-							self.down(1)
-							Blender.Draw.Draw()
-						# redraw if marker lost focus
-						if self.mouseFocusX and self.mouseFocusY:
-							Blender.Draw.Redraw(1)
-				else:
-					# redraw if marker lost focus
-					if self.mouseFocusX and self.markerFocusY:
-						Blender.Draw.Redraw(1)
-					self.markerFocusY = 0
-					self.mouseFocusY = 0
-			elif ((event == Blender.Draw.LEFTMOUSE) and (self.mouseFocusX == 1) and (self.mouseFocusY == 1)):
-				self.mousePressed = 1
-				# move marker
-				if (self.mousePositionY > self.markerRect[3]):
-					# up
-					self.up(1)
-					Blender.Draw.Redraw(1)
-				elif (self.mousePositionY < self.markerRect[1]):
-					# down
-					self.down(1)
-					Blender.Draw.Redraw(1)
-			elif (Blender.Get("version") >= 234):
-				if (event == Blender.Draw.WHEELUPMOUSE):
-					self.up(1)
-					Blender.Draw.Redraw(1)
-				elif (event == Blender.Draw.WHEELDOWNMOUSE):
-					self.down(1)
-					Blender.Draw.Redraw(1)
-		else: # released keys and buttons
-			if (event == Blender.Draw.LEFTMOUSE):
-				self.mousePressed = 0
-		return
-	def getMinimumSize(self):
-		return [20, 60]
-	def getPreferredSize(self):
-		return [20, Widget.INFINITY]
-	def addButtons(self, parent):
-		self.buttonUpEvent = parent.addButtonAction(VerticalScrollbar.UpAction(self))
-		self.buttonDownEvent = parent.addButtonAction(VerticalScrollbar.DownAction(self))
-		return
-	class UpAction(Action):
-		def __init__(self, scrollbar):
-			self.scrollbar = scrollbar
-			return
-		def execute(self):
-			self.scrollbar.up()
-			Blender.Draw.Redraw(1)
-			return
-	class DownAction(Action):
-		def __init__(self, scrollbar):
-			self.scrollbar = scrollbar
-			return
-		def execute(self):
-			self.scrollbar.down()
-			Blender.Draw.Redraw(1)
-			return
-
-class ProgressBar(Widget):
-	def __init__(self):
-		Widget.__init__(self)
-		# percentage of attained progress
-		self.percent = 0.0
-		self.minimumSize = [104, 24]
-		self.preferredSize = [Widget.INFINITY, 15]
-		self.event = None
-		return
-	def progress(self, percent):
-		self.percent = percent
-		Blender.Draw.Redraw(1)
-		return
-	def draw(self, rect):
-		# border
-		glColor3f(0.0, 0.0, 0.0)
-		glBegin(GL_LINE_STRIP)
-		glVertex2i(rect[0], rect[1])
-		glVertex2i(rect[0], rect[3])
-		glVertex2i(rect[2], rect[3])
-		glVertex2i(rect[2], rect[1])
-		glVertex2i(rect[0], rect[1])
-		glEnd()
-		# percentage bar
-		width = rect[2] - rect[0] - 4
-		barWidth = int(width*self.percent)
-		Blender.Draw.Toggle("%d%%" % (self.percent*100), self.event, rect[0]+2, rect[1]+2, barWidth, rect[3]-rect[1]-4, 0) 
-		return
-	def addButtons(self, parent):
-		self.event = parent.addButtonAction(ProgressBar.NoToggle())
-	def getMinimumSize(self):
-		return self.minimumSize
-	def getPreferredSize(self):
-		return self.preferredSize
-	class NoToggle(Action):
-		def execute(self):
-			Blender.Draw.Redraw(1)
-			return
-
-class Screen:
-	"""Represents the complete script window.
-	
-	   A screen represents the complete script window. It handles
-	   drawing and events and can consist of several user interface
-	   components.
-	   
-	   @cvar current Current active screen.
-	"""
-	current = None
-	def __init__(self):
-		"""Constructor.
-		"""
-		# buttonHandler event number management
-		self.nButtonEvent = 0
-		# buttonEventDict key: iButtonEvent, value: Action
-		self.buttonEventDict = {}
-		# default widget layout
-		self.layout = VerticalLayout()
-		return
-	def activate(self):
-		"""Makes the current screen active.
-		
-		   This method calls Blender.Draw.Register to register itself to
-		   be responsible for windowing.
-		"""
-		self.layout.addButtons(self)
-		Screen.current = self
-		Blender.Draw.Register(self._draw, self._eventHandler, self._buttonHandler)
-		return
-	def addWidget(self, widget, name):
-		"""Adds a widget to this screen.
-		
-		   @param widget Widget to add to this screen.
-		   @param name Unique name for the widget.
-		"""
-		self.layout.addWidget(widget, name)
-		return
-	def removeWidget(self, name):
-		"""Removes widget from this screen.
-		
-		   @param name Name of the widget to remove.
-		   @see addWidget
-		"""
-		self.layout.removeWidget(name)
-		return
-	def addButtonAction(self, action):
-		"""Registers an action for a button event.
-		
-		   @param action Action to execute on receive of the returned button event number.
-		   @return eventNumber Event number to use for the button that corresponds to that action.
-		"""
-		# workaround for Blender 2.37 event 8 bug:
-		shiftEvents = 100
-		# get a free event number
-		if (len(self.buttonEventDict) == self.nButtonEvent):
-			self.nButtonEvent += 1
-			eventNumber = self.nButtonEvent + shiftEvents
-		else:
-			eventNumber = [(x+1+shiftEvents) for x in range(self.nButtonEvent) if (x+1+shiftEvents) not in self.buttonEventDict.keys()][0]
-		# assign action to that event
-		self.buttonEventDict[eventNumber] = action
-		return eventNumber
-	def removeButtonAction(self, eventNumber):
-		"""Action for the given event number will no longer be called.
-		
-		   @param eventNumber Event number for the action.
-		"""
-		if self.buttonEventDict.has_key(eventNumber):
-			del self.buttonEventDict[eventNumber]
-		return
-	# callbacks for Blender.Draw.Register
-	def _draw(self):
-		"""Draws the screen.
-		
-		   Callback function for Blender.Draw.Register
-		"""
-		# clear background
-		theme = Blender.Window.Theme.Get()[0]
-		bgColor = [color/255.0 for color in theme.get('buts').back]
-		glClearColor(*bgColor)
-		glClear(GL_COLOR_BUFFER_BIT)
-
-		# size of the script window
-		size = list(Blender.Window.GetAreaSize())
-		minimumSize = self.layout.getMinimumSize()
-		if size[0] < minimumSize[0]:
-			size[0] = minimumSize[0]
-		if size[1] < minimumSize[1]:
-			size[1] = minimumSize[1]
-		screenRect = [0, 0, size[0]-1, size[1]-1]
-		
-		# draw widgets
-		self.layout.draw(screenRect)
-		return
-	def _eventHandler(self, event, value):
-		"""Handles keyboard and mouse input events.
-		
-		   Callback function for Blender.Draw.Register
-		"""
-		self.layout.eventFilter(event, value)
-		return
-	def _buttonHandler(self, event):
-		"""Handles draw button events.
-		
-		   Callback function for Blender.Draw.Register
-		"""
-		if self.buttonEventDict.has_key(event):
-			self.buttonEventDict[event].execute()
-		return
-	
-###
-# specific classes
-class OgreFrame(Decorator):
-	"""Ogre Logo, Title and border.	"""
-	OGRE_LOGO = Buffer(GL_BYTE, [48,122*4],[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,64,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,0,0,0,127,0,1,0,127,0,2,0,127,2,5,2,127,2,5,2,127,4,6,4,127,5,8,5,127,8,11,8,127,8,11,8,127,3,5,3,127,2,3,2,127,0,1,0,127,0,1,0,127,0,1,0,127,0,1,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,1,2,1,127,4,6,4,127,10,13,10,127,18,22,18,127,23,28,23,127,24,30,24,127,25,31,25,127,25,31,25,127,26,32,26,127,26,32,26,127,26,32,26,127,25,31,25,127,24,30,24,127,18,23,18,127,3,5,3,127,4,6,4,127,8,11,8,127,9,12,9,127,13,17,13,127,17,22,17,127,15,19,15,127,7,9,7,127,1,2,1,127,0,0,0,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,2,4,2,127,4,6,4,127,18,22,18,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,18,22,18,127,15,19,15,127,20,26,20,127,25,31,25,127,26,32,26,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,26,32,26,127,24,30,24,127,16,20,16,127,4,5,4,127,0,0,0,95,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,1,1,1,127,13,15,13,127,12,15,12,127,24,29,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,3,5,3,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,1,1,1,127,19,24,19,127,11,15,11,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,17,21,17,127,22,28,22,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,3,5,3,127,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,20,24,20,127,16,20,16,127,20,25,20,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,22,28,22,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,3,5,3,127,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,64,5,7,5,127,26,32,26,127,15,19,15,127,41,48,41,127,38,45,38,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,3,4,3,127,0,0,0,127,58,66,58,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,1!
 05,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,127,20,24,20,127,27,34,27,127,26,32,26,127,47,55,47,127,47,55,47,127,39,46,39,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,11,16,11,127,0,1,0,127,3,3,3,127,94,106,94,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118!
 ,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,127,33,39,33,127,45,52,45,127,28,32,28,127,47,55,47,127,44,51,44,127,39,46,39,127,27,33,27,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,21,26,21,127,0,2,0,127,0,0,0,127,23,26,23,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,!
 105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,127,24,28,24,127,33,40,33,127,18,22,18,127,29,35,29,127,25,31,25,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,5,8,5,127,1,2,1,127,0,0,0,127,70,79,70,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,12!
 7,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,94,105,94,127,70,79,70,127,76,86,76,127,90,101,90,127,103,116,103,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,64,0,0,0,127,4,6,4,127,12,16,12,127,22,27,22,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,28,34,28,127,35,42,35,127,28,35,28,127,25,31,25,127,23,29,23,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,17,21,17,127,0,2,0,127,0,0,0,127,31,36,31,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,100,112,100,127,92,103,92,127,103,116,103,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127!
 ,105,118,105,127,105,118,105,127,105,118,105,127,100,112,100,127,81,92,81,127,68,77,68,127,65,73,65,127,65,73,65,127,76,86,76,127,78,88,78,127,83,94,83,127,92,103,92,127,85,95,85,127,31,35,31,127,6,7,6,127,6,7,6,127,13,14,13,127,13,14,13,127,19,21,19,127,26,29,26,127,26,29,26,127,48,54,48,127,96,108,96,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,70,78,70,127,3,3,3,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,12,13,11,127,23,26,23,127,36,40,36,127,49,55,49,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,64,0,0,0,127,2,4,2,127,16,20,16,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,26,33,26,127,59,68,59,127,81,91,81,127,87,98,87,127,86,96,86,127,80,90,80,127,71,79,71,127,59,66,59,127,36,41,35,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,31,24,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,5,8,5,127,0,1,0,127,18,20,18,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,91,103,91,127,58,65,58,127,29,33,29,127,6,7,6,127,0,0,0,127,0,0,0,127,1,2,1,127,22,24,22,127,54,61,54,127,94,106,94,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,88,99,88,127,51,58,51,127,18,21,!
 18,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,17,19,17,127,48,54,48,127,80,91,80,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,29,33,29,127,0,0,0,127,41,31,14,127,33,25,11,127,18,14,6,127,2,2,1,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,127,2,3,2,127,24,29,24,127,26,32,26,127,24,30,24,127,25,31,25,127,24,30,24,127,24,30,24,127,24,30,24,127,23,29,23,127,34,41,34,127,78,88,78,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,97,87,127,87,97,87,127,84,93,84,127,62,69,62,127,34,40,34,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,26,30,26,127,36,38,36,127,47,50,46,127,39,42,37,127,34,40,34,127,30,37,30,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,15,19,15,127,0,1,0,127,0,0,0,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,94,106,94,127,43,48,43,127,4,5,4,127,0,0,0,127,0,0,0,127,0,0,0,127,6,5,2,127,16,12,5,127,2,2,1,127,0,0,0,127,0,0,0,127,7,8,7,127,58,65,58,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,96,108,96,127,41,47,41,127,1,1,1,127,0,0,0,127,0,0,0,127,6,5,2,127,27,21,9,127,42,33,1!
 4,127,46,36,16,127,46,36,16,127,33,25,11,127,31,24,11,127,25,19,9,127,16,12,5,127,12,9,4,127,0,0,0,127,107,82,36,127,115,88,38,127,107,82,36,127,107,82,36,127,100,76,33,127,92,71,31,127,88,68,30,127,0,0,0,127,4,3,2,127,0,0,0,127,0,0,0,127,0,0,0,127,13,15,13,127,65,73,65,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,13,14,13,127,0,0,0,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,109,84,36,127,96,73,32,127,80,62,27,127,65,50,22,127,52,40,17,127,37,28,12,127,21,16,7,127,2,2,1,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,127,9,11,9,127,48,56,48,127,45,53,45,127,41,48,41,127,33,40,33,127,34,41,34,127,37,44,37,127,54,62,54,127,77,87,77,127,87,97,87,127,87,97,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,79,88,79,127,61,69,61,127,25,31,25,127,25,31,25,127,23,28,23,127,19,23,19,127,42,43,41,127,60,60,59,127,61,61,59,127,61,61,59,127,63,63,61,127,35,37,34,127,38,45,38,127,33,39,33,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,15,19,15,127,0,1,0,127,0,0,0,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,81,91,81,127,9,11,9,127,0,0,0,127,2,2,1,127,44,34,15,127,86,66,29,127,115,88,38,127,122,94,41,127,122,94,41,127,121,92,40,127,94,72,31,127,39,30,13,127,0,0,0,127,0,0,0,127,40,45,40,127,101,114,101,127,105,118,105,127,105,118,105,127,105,118,105,127,85,95,85,127,11,13,11,127,0,0,0,127,4,3,2,127,50,38,17,127,94,72,31,127,122,94,41,127,122,!
 94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,92,71,31,127,0,0,0,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,2,2,1,127,105,81,35,127,98,75,33,127,60,46,20,127,23,18,8,127,0,0,0,127,1,1,1,127,90,102,90,127,105,118,105,127,105,118,105,127,105,118,105,127,6,7,6,127,0,0,0,127,115,88,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,8,6,3,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,127,3,5,3,127,45,53,45,127,46,54,46,127,46,54,46,127,47,55,47,127,46,54,46,127,68,78,68,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,98,87,127,67,76,67,127,38,46,38,127,21,26,21,127,50,52,50,127,60,60,59,127,61,61,59,127,60,60,58,127,60,60,58,127,60,60,58,127,61,61,59,127,39,41,38,127,52,59,52,127,67,76,67,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,15,19,15,127,0,1,0,127,0,0,0,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,59,67,59,127,1,1,1,127,0,0,0,127,35,27,12,127,105,81,35,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,86,66,29,127,8,6,3,127,0,0,0,127,36,40,36,127,105,118,105,127,105,118,105,127,82,92,82,127,7,7,7,127,0,0,0,127,31,24,10,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,!
 94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,80,62,27,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,82,63,28,127,46,36,16,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,27,21,9,127,0,0,0,127,78,88,78,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,127,0,2,0,127,41,49,41,127,46,54,46,127,46,54,46,127,49,56,49,127,77,87,77,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,85,96,85,127,55,64,55,127,44,52,44,127,23,28,23,127,17,22,17,127,90,92,90,127,84,84,82,127,60,60,58,127,60,60,58,127,60,60,58,127,60,60,58,127,61,61,59,127,39,41,38,127,54,62,54,127,62,71,62,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,15,20,15,127,0,1,0,127,0,0,0,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,81,90,81,127,1,1,1,127,0,0,0,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,103,79,34,127,12,9,4,127,0,0,0,127,47,52,47,127,93,104,93,127,8,9,8,127,0,0,0,127,52,40,17,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,!
 41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,63,49,21,127,105,81,35,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,0,0,0,127,9,11,9,127,101,113,101,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,69,53,23,127,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,127,0,1,0,127,37,44,37,127,46,54,46,127,49,57,49,127,79,89,79,127,87,97,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,56,64,56,127,46,53,46,127,25,31,25,127,22,27,22,127,25,31,25,127,44,47,44,127,116,116,115,127,59,59,57,127,60,60,58,127,60,60,58,127,60,60,58,127,61,61,59,127,38,41,37,127,69,78,69,127,45,53,45,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,15,20,15,127,0,0,0,127,5,6,5,127,104,117,104,127,105,118,105,127,105,118,105,127,105,118,105,127,93,104,93,127,8,9,8,127,0,0,0,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,96,73,32,127,2,2,1,127,0,0,0,127,24,28,24,127,0,0,0,127,37,28,12,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122!
 ,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,10,8,3,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,88,68,30,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,39,30,13,127,0,0,0,127,43,49,43,127,105,118,105,127,105,118,105,127,105,118,105,127,93,105,93,127,0,0,0,127,14,11,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,39,30,13,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,64,0,1,0,127,21,25,21,127,48,57,49,127,82,92,82,127,87,97,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,97,87,127,87,98,87,127,60,69,60,127,43,50,43,127,29,36,29,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,116,116,116,127,71,71,70,127,60,60,58,127,60,60,58,127,60,60,58,127,62,62,60,127,30,32,29,127,75,85,75,127,29,36,29,127,25,31,25,127,24,30,24,127,24,30,24,127,23,28,23,127,10,14,10,127,0,0,0,127,40,45,40,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,33,38,33,127,0,0,0,127,39,30,13,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,67,52,23,127,0,0,0,127,0,0,0,127,10,8,3,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41!
 ,127,107,82,36,127,84,65,28,127,71,54,24,127,115,88,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,67,51,22,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,105,81,35,127,2,2,1,127,0,0,0,127,0,0,0,127,18,21,18,127,61,69,61,127,102,115,102,127,92,103,92,127,0,0,0,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,60,46,20,127,52,40,17,127,69,53,23,127,86,66,29,127,10,8,3,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,127,2,5,2,127,49,57,49,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,98,87,127,86,97,86,127,75,84,75,127,53,61,53,127,34,41,34,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,22,28,22,127,96,97,96,127,93,93,92,127,59,59,58,127,60,60,58,127,60,60,58,127,61,61,59,127,34,39,34,127,74,84,74,127,23,29,23,127,25,31,25,127,37,39,34,127,47,47,41,127,44,45,39,127,17,18,16,127,0,0,0,127,52,59,52,127,105,118,105,127,105,118,105,127,105,118,105,127,81,92,81,127,0,0,0,127,8,6,3,127,111,85,37,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,50,38,17,127,16,12,5,127,33,25,11,127,103,79,34,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,23,18,8,127,0,0,0,127,69,53,23,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,27,21,9,127,0,0,0,127!
 ,0,0,0,127,0,0,0,127,92,71,31,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,61,47,21,127,18,14,6,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,117,90,39,127,88,68,29,127,54,41,18,127,14,11,5,127,0,0,0,127,0,0,0,127,17,18,17,127,68,76,68,127,0,0,0,127,21,16,7,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,31,24,11,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,95,0,0,0,127,37,43,37,127,89,100,89,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,97,87,127,88,99,88,127,82,92,82,127,61,69,61,127,36,42,36,127,27,32,27,127,23,29,23,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,78,80,76,127,102,102,102,127,58,58,57,127,60,60,58,127,60,60,58,127,58,58,56,127,40,47,40,127,56,64,56,127,24,29,23,127,44,45,40,127,49,49,43,127,49,49,43,127,46,46,41,127,41,42,37,127,0,0,0,127,38,43,38,127,105,118,105,127,105,118,105,127,105,118,105,127,33,37,33,127,0,0,0,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,0,0,0,127,0,0,0,127,0,0,0,127,12,9,4,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,84,65,28,127,4,3,2,127,115,88,38,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,42,33,14,127,0,0,0,127,119,91,40,127,102,78,34,127,7!
 5,57,25,127,52,40,17,127,88,68,29,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,61,47,21,127,31,24,11,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,84,65,28,127,19,15,7,127,0,0,0,127,4,5,4,127,0,0,0,127,31,24,11,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,111,85,37,127,115,88,38,127,122,94,41,127,122,94,41,127,48,37,16,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,32,0,0,0,127,6,7,5,127,67,75,67,127,89,100,89,127,87,97,87,127,87,97,87,127,87,98,87,127,88,99,88,127,88,98,88,127,80,90,80,127,62,71,62,127,45,52,45,127,39,46,39,127,57,65,57,127,65,74,65,127,59,67,59,127,54,61,54,127,55,61,55,127,28,34,28,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,64,67,64,127,109,109,108,127,58,58,57,127,60,60,58,127,61,60,59,127,50,50,47,127,47,55,47,127,33,39,33,127,44,44,39,127,48,48,42,127,48,48,42,127,28,30,25,127,36,37,31,127,48,48,42,127,1,2,1,127,36,41,36,127,105,118,105,127,105,118,105,127,99,111,99,127,4,5,4,127,2,2,1,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,65,50,22,127,0,0,0,127,30,34,30,127,27,30,27,127,0,0,0,127,67,51,22,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,58,44,19,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,71,54,24,127,0,0,0,127,18,14,6,127,122,94,41,127,122,94,41,127,12!
 2,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,54,41,18,127,31,24,11,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,56,43,19,127,0,0,0,127,0,0,0,127,31,24,11,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,37,28,12,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,95,0,0,0,127,2,3,2,127,28,32,28,127,58,65,58,127,56,64,56,127,50,57,50,127,46,54,46,127,42,49,42,127,43,50,43,127,62,71,62,127,80,90,80,127,87,98,87,127,87,98,87,127,87,97,87,127,87,98,87,127,86,97,87,127,78,85,78,127,46,52,46,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,64,67,64,127,104,104,104,127,58,58,57,127,60,60,58,127,62,61,60,127,34,38,33,127,37,43,37,127,50,51,44,127,48,48,42,127,48,48,42,127,23,27,22,127,32,36,30,127,95,95,82,127,43,45,39,127,0,0,0,127,45,51,45,127,105,118,105,127,105,118,105,127,71,80,71,127,0,0,0,127,35,27,12,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,103,79,35,127,2,2,1,127,0,0,0,127,11,13,11,127,0,0,0,127,65,50,22,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,23,18,8,127,0,0,0,127,35,27,12,127,122,94,41,127,122,94,41,127,122,94,!
 41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,46,36,16,127,41,31,14,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,37,28,12,127,50,38,17,127,73,56,24,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,69,53,23,127,0,0,0,127,44,34,15,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,27,21,9,127,0,0,0,127,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,8,10,8,127,51,59,51,127,84,95,84,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,87,127,63,71,63,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,76,78,75,127,100,100,99,127,58,58,57,127,61,60,59,127,53,54,51,127,24,30,24,127,29,33,28,127,77,76,63,127,47,48,42,127,29,32,27,127,24,30,24,127,30,35,29,127,90,91,84,127,28,29,25,127,0,0,0,127,77,86,76,127,105,118,105,127,105,118,105,127,44,50,44,127,0,0,0,127,69,53,23,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,81,62,27,127,4,3,2,127,0,0,0,127,12,9,4,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,4,3,2,127,0,0,0,127,54,41,18,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,!
 127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,46,36,16,127,46,36,16,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,48,37,16,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,42,33,14,127,46,36,16,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,16,12,5,127,0,0,0,127,0,0,0,127,4,3,2,127,6,5,2,127,0,0,0,95,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,95,1,1,1,127,60,68,60,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,97,87,127,73,82,73,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,22,28,22,127,89,92,89,127,87,87,86,127,59,59,58,127,60,59,58,127,31,35,31,127,25,31,25,127,43,45,38,127,74,74,62,127,43,43,38,127,22,28,22,127,25,31,25,127,24,30,24,127,26,32,26,127,13,14,12,127,0,0,0,127,100,113,100,127,105,118,105,127,105,118,105,127,21,24,21,127,0,0,0,127,98,75,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,113,87,38,127,92,71,31,127,117,90,39,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,19,15,7,127,0,0,0,127,71,54,24,127,122,94,41,127,122,94,41,127,122,94,41,127,122,9!
 4,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,39,30,13,127,50,38,17,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,82,63,28,127,0,0,0,127,23,26,23,127,38,42,38,127,5,7,5,127,0,0,0,127,96,73,32,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,111,85,37,127,54,41,18,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,82,63,28,127,16,12,5,127,16,12,5,127,16,12,5,127,12,9,4,127,46,35,16,127,82,63,28,127,117,90,39,127,46,36,16,127,0,0,0,127,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,33,38,33,127,89,99,89,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,84,94,84,127,28,35,28,127,25,31,25,127,25,31,25,127,25,31,25,127,22,28,22,127,100,101,100,127,73,73,71,127,61,60,59,127,35,38,35,127,24,30,24,127,24,30,24,127,48,51,41,127,69,69,57,127,36,37,32,127,24,30,24,127,28,34,28,127,25,31,25,127,25,31,25,127,17,21,17,127,0,0,0,127,80,90,80,127,105,118,105,127,105,118,105,127,6,7,6,127,0,0,0,127,115,88,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,56,43,19,127,0,0,0,127,88,68,29,127,117,90,39,127,107,82,36,127,92,71,31,127,80,62,27!
 ,127,69,53,23,127,60,46,20,127,46,36,16,127,33,25,11,127,23,18,8,127,4,3,2,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,65,50,22,127,0,0,0,127,20,22,20,127,26,30,26,127,0,0,0,127,2,2,1,127,109,84,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,21,16,7,127,60,46,20,127,94,72,31,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,54,41,18,127,0,0,0,127,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,6,7,6,127,81,91,81,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,88,98,88,127,60,68,60,127,27,33,27,127,24,30,24,127,25,31,25,127,22,28,22,127,91,91,91,127,57,58,56,127,31,36,31,127,24,30,24,127,25,31,25,127,25,31,25,127,27,31,26,127,70,71,58,127,41,42,36,127,37,43,37,127,66,74,66,127,23,29,23,127,25,31,25,127,19,22,19,127,0,0,0,127,75,84,75,127,105,118,105,127,102,114,102,127,0,0,0,127,4,3,2,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,117,90,39,127,31,24,10,127,2,2,1,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,!
 127,0,0,0,127,0,0,0,127,0,0,0,127,4,3,2,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,46,36,16,127,0,0,0,127,0,0,0,127,0,0,0,127,8,6,3,127,73,56,24,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,61,47,21,127,0,0,0,127,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,45,52,45,127,87,98,88,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,82,92,82,127,46,54,46,127,34,41,34,127,25,31,25,127,25,31,25,127,26,30,26,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,33,37,31,127,48,48,42,127,43,43,38,127,66,74,65,127,23,29,23,127,25,31,25,127,20,25,20,127,0,0,0,127,70,78,70,127,105,118,105,127,92,103,92,127,0,0,0,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,86,66,29,127,48,37,16,127,31,24,11,127,16,12,5,127,23,18,8,127,33!
 ,25,11,127,52,40,17,127,71,54,24,127,96,73,32,127,117,90,39,127,63,49,21,127,73,56,24,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,88,68,29,127,77,59,26,127,77,59,26,127,90,69,30,127,117,90,39,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,73,56,24,127,0,0,0,127,0,0,0,32],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,25,28,25,127,88,99,88,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,98,87,127,70,79,70,127,46,54,46,127,47,55,47,127,45,52,45,127,30,37,30,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,44,52,44,127,72,81,72,127,70,79,70,127,23,29,23,127,25,31,25,127,21,25,21,127,0,0,0,127,66,73,65,127,105,118,105,127,92,103,92,127,0,0,0,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,1!
 27,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,80,62,27,127,77,59,26,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,0,0,0,127,0,0,0,64],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,1,0,127,64,72,64,127,87,97,87,127,86,97,86,127,86,97,86,127,87,97,87,127,86,97,86,127,86,96,86,127,85,95,85,127,71,80,71,127,47,55,47,127,46,54,46,127,46,54,46,127,46,54,46,127,47,55,47,127,31,38,31,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,59,67,59,127,77,87,77,127,58,66,58,127,25,31,25,127,25,31,25,127,22,27,22,127,0,0,0,127,48,54,48,127,105,118,105,127,92,103,92,127,0,0,0,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,!
 122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,80,62,27,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,92,71,31,127,0,0,0,127,0,0,0,64],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,127,14,16,14,127,88,99,88,127,88,98,88,127,88,98,88,127,72,82,72,127,51,59,51,127,52,61,52,127,55,63,55,127,47,55,47,127,45,53,45,127,45,53,45,127,46,54,46,127,46,54,46,127,46,54,46,127,45,53,45,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,37,44,37,127,76,86,76,127,73,82,73,127,32,39,32,127,23,29,23,127,2,2,2,127,30,34,30,95,105,118,105,64,98,111,98,64,0,0,0,95,4,3,2,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,!
 41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,115,88,38,127,92,71,31,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,0,0,0,127,0,0,0,64],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,21,24,21,127,55,62,55,127,51,57,50,127,64,72,64,127,86,96,86,127,85,95,85,127,84,94,84,127,86,96,86,127,84,95,84,127,82,92,82,127,75,85,75,127,52,60,52,127,46,54,46,127,46,54,46,127,45,53,45,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,29,36,29,127,28,34,28,127,24,30,24,127,62,71,62,127,88,99,88,127,66,75,66,127,24,30,24,127,8,11,8,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,105,81,35,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,!
 41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,100,76,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,107,82,36,127,0,0,0,127,0,0,0,64],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,31,36,31,127,35,40,35,127,33,36,32,127,31,34,31,127,47,55,47,127,51,59,51,127,47,55,47,127,39,46,39,127,29,36,29,127,37,43,37,127,52,60,52,127,77,87,77,127,49,58,49,127,46,54,46,127,40,48,40,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,29,35,29,127,80,90,80,127,59,67,59,127,24,30,24,127,24,30,24,127,76,86,76,127,87,98,87,127,39,46,39,127,17,22,17,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,75,57,25,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,79,60,26,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,9!
 4,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,71,55,24,127,103,79,35,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,117,90,39,127,0,0,0,127,0,0,0,64],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,41,48,41,127,69,79,69,127,39,45,39,127,47,54,47,127,77,87,77,127,86,97,86,127,88,97,87,127,87,97,86,127,82,93,83,127,57,65,57,127,25,31,25,127,24,30,24,127,26,32,26,127,26,32,26,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,75,85,75,127,87,98,87,127,67,75,67,127,23,29,23,127,23,29,23,127,56,64,56,127,85,95,85,127,75,84,75,127,24,30,24,127,3,3,3,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,127,29,22,10,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,8,6,3,127,109,84,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41!
 ,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,6,5,2,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,0,0,0,127,0,0,0,64],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,12,15,12,127,45,53,46,127,48,56,48,127,65,72,63,127,98,81,79,127,123,119,119,127,117,108,108,127,94,79,76,127,88,88,80,127,64,73,64,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,35,41,35,127,86,96,86,127,87,98,87,127,61,69,61,127,23,29,23,127,24,30,24,127,46,53,46,127,84,94,84,127,87,98,87,127,55,63,55,127,10,12,10,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,92,71,31,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,75,57,25,127,0,0,0,127,52,40,17,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,1!
 27,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,12,9,4,127,0,0,0,127,109,84,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,14,11,5,127,0,0,0,95],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,22,26,22,127,30,37,30,127,23,29,23,127,41,40,35,127,91,73,72,127,113,103,103,127,100,75,75,127,87,58,58,127,83,72,66,127,54,63,55,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,30,25,127,34,41,34,127,69,78,69,127,81,91,81,127,34,41,34,127,25,31,25,127,23,29,23,127,61,69,61,127,82,92,82,127,75,85,75,127,82,92,82,127,24,29,24,127,1,1,1,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,127,23,18,8,127,119,91,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,17,14,6,127,0,0,0,127,2,2,1,127,96,73,32,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41!
 ,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,75,58,25,127,6,5,2,127,0,0,0,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,18,14,6,127,0,0,0,127],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,24,29,24,127,48,56,48,127,28,34,28,127,24,30,24,127,25,31,25,127,36,37,32,127,68,55,52,127,82,63,62,127,80,52,52,127,81,82,74,127,28,34,28,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,23,29,23,127,25,31,25,127,24,30,24,127,25,31,25,127,24,29,24,127,56,64,56,127,87,97,87,127,70,79,70,127,88,99,88,127,49,57,49,127,10,12,10,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,44,34,15,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,67,52,23,127,0,0,0,127,0,0,0,95,0,0,0,127,12,9,4,127,109,84,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94!
 ,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,33,25,11,127,0,0,0,127,0,0,0,127,0,0,0,95,0,0,0,127,107,82,36,127,117,90,39,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,31,24,11,127,0,0,0,127],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,14,16,14,127,81,91,81,127,72,81,72,127,43,51,43,127,23,29,23,127,24,30,24,127,23,30,24,127,23,30,23,127,25,31,25,127,26,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,26,32,26,127,32,39,32,127,30,37,30,127,24,30,24,127,25,31,25,127,25,31,25,127,25,32,25,127,83,93,83,127,77,86,77,127,87,97,87,127,80,90,80,127,22,27,22,127,1,1,1,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,46,35,15,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,96,73,32,127,4,3,2,127,0,0,0,95,0,0,0,0,0,0,0,32,0,0,0,127,12,9,4,127,98,75,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,!
 127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,96,73,32,127,40,31,14,127,2,2,1,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,32,0,0,0,127,0,0,0,127,0,0,0,127,2,2,1,127,16,12,5,127,25,19,9,127,33,25,11,127,46,36,16,127,56,43,19,127,61,47,21,127,77,59,26,127,84,65,28,127,92,71,31,127,107,82,36,127,115,88,38,127,122,94,41,127,122,94,41,127,39,30,13,127,0,0,0,127],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,18,21,18,127,83,93,83,127,89,100,89,127,71,81,71,127,54,61,54,127,37,44,37,127,24,30,24,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,42,50,42,127,70,79,70,127,87,98,87,127,74,83,74,127,28,35,28,127,25,31,25,127,24,30,24,127,42,49,42,127,76,86,76,127,86,97,86,127,88,99,88,127,41,49,41,127,11,14,11,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,27,21,9,127,105,81,35,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,12,9,4,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,2,2,1,127,58,44,19,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,!
 122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,105,81,35,127,63,49,21,127,21,16,7,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,16,12,5,127,6,5,2,127,0,0,0,95],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,13,17,13,127,61,70,61,127,85,96,85,127,89,100,89,127,88,98,88,127,77,87,77,127,60,67,60,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,12,16,12,127,12,15,12,127,40,46,40,127,80,90,80,127,80,89,80,127,34,40,34,127,24,30,24,127,23,29,23,127,51,59,51,127,88,99,88,127,86,97,86,127,76,85,76,127,22,27,22,127,1,2,1,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,4,3,2,127,59,46,20,127,111,85,37,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,65,50,22,127,4,3,2,127,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,0,0,0,127,4,3,2,127,44,34,15,127,80,62,27,127,111,85,37,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,12!
 2,94,41,127,122,94,41,127,121,92,40,127,100,76,33,127,75,57,25,127,48,37,16,127,18,13,6,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,127,0,0,0,64,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,19,23,19,127,46,53,46,127,64,72,64,127,80,90,80,127,85,96,85,127,74,84,74,127,28,34,28,127,25,31,25,127,25,31,25,127,25,30,25,127,25,31,25,127,25,31,25,127,25,31,25,127,17,21,17,127,1,3,1,127,0,1,0,127,0,0,0,127,9,11,9,127,51,59,52,127,82,93,83,127,45,52,45,127,23,29,23,127,24,30,24,127,59,67,59,127,88,99,88,127,85,96,85,127,30,37,30,127,12,15,12,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,4,3,2,127,42,33,14,127,82,63,28,127,107,82,36,127,103,79,35,127,84,65,28,127,54,41,18,127,12,9,4,127,0,0,0,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,10,8,3,127,25,19,9,127,31,24,11,127,31,24,11,127,31,24,11,127,31,24,11,127,18,14,6,127,35,27,12,127,105,81,35,127,80,62,27,127,54,41,18,127,29,22,10,127,6,5,2,127,0,0,0,127,0,0,0,127,0,0,0,127,!
 0,0,0,95,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,8,10,8,127,33,39,33,127,44,51,44,127,46,53,46,127,44,52,44,127,39,46,39,127,25,30,25,127,25,31,25,127,25,31,25,127,24,30,24,127,15,19,15,127,5,7,5,127,0,1,0,127,0,0,0,127,0,0,0,95,0,0,0,64,0,0,0,64,0,1,0,127,21,24,21,127,66,74,66,127,57,66,57,127,24,30,24,127,23,29,23,127,52,60,52,127,40,47,40,127,24,30,24,127,23,28,23,127,1,2,1,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,95,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,64,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,11,13,11,127,23,28,23,127,33,39,33,127,36,43,36,127,23,29,23,127,20,26,20,127,11,15,11,127,3,4,3,127,0,1,0,127,0,0,0,127,0,0,0,95,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,3,5,3,127,37,41,37,127,58,66,58,127,27,33,27,127,24,30,24,127,26,32,26,127,25,31,25,127,25,31,25,127,8,9,8,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,0,1,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,12,15,12,127,42,49,42,127,32,39,32,127,24,30,24,127,25,31,25,127,25,31,25,127,18,22,18,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,2,2,2,127,23,27,23,127,37,43,37,127,26,33,26,127,25,31,25,127,24,30,24,127,4,4,4,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,4,5,4,127,24,28,23,127,29,35,29,127,25,31,25,127,12,16,12,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,4,4,4,127,11,14,11,127,16,20,16,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0],
-	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,64,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])
-	def __init__(self, childWidget, title):
-		"""Constructor.
-		
-		   @param title Header title.
-		"""
-		Decorator.__init__(self, childWidget)
-		self.title = title
-		self.border = 10
-		return
-	def draw(self, screenRectangle):
-		rect = screenRectangle[:]
-		rect[0] += self.border
-		rect[1] += self.border
-		rect[2] -= self.border
-		rect[3] -= self.border
-		# title
-		glColor3ub(210, 236, 210)
-		glRecti(rect[0],rect[3]-41,rect[2],rect[3]-17)
-		glColor3ub(50, 62, 50)
-		glRasterPos2i(rect[0]+126, rect[3]-34)
-		Blender.Draw.Text(self.title)
-		glRasterPos2i(rect[0]+127, rect[3]-34)
-		Blender.Draw.Text(self.title)
-		# logo
-		glRasterPos2i(rect[0]+1, rect[3]-48)	
-		glEnable(GL_BLEND)
-		glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)
-		glDrawPixels(122, 48, GL_RGBA, GL_BYTE, OgreFrame.OGRE_LOGO)
-		rect[3] -= 60
-		glDisable(GL_BLEND)
-		# child
-		self.childWidget.draw(rect)
-		return
-	def getMaximumSize(self):
-		size = self.childWidget.getMaximumSize()[:]
-		size[0] += 2*self.border
-		size[1] += 2*self.border + 60
-		width = 2*self.border + Blender.Draw.GetStringWidth(self.title) + 85
-		if size[0] < width:
-			size[0] = width
-		height = 60 + 2*self.border
-		if size[1] < height:
-			size[1] = height
-		return size
-	def getMinimumSize(self):
-		size = self.childWidget.getMinimumSize()[:]
-		size[0] += 2*self.border
-		size[1] += 2*self.border + 60
-		width = 2*self.border + Blender.Draw.GetStringWidth(self.title) + 85
-		if size[0] < width:
-			size[0] = width
-		height = 60 + 2*self.border
-		if size[1] < height:
-			size[1] = height
-		return size
-	def getPreferredSize(self):
-		size = self.childWidget.getPreferredSize()[:]
-		size[0] += 2*self.border
-		size[1] += 2*self.border + 60
-		width = 2*self.border + Blender.Draw.GetStringWidth(self.title) + 85
-		if size[0] < width:
-			size[0] = width
-		height = 60 + 2*self.border
-		if size[1] < height:
-			size[1] = height
-		return size
-
-class RoundedPanel(Widget):
-	def __init__(self, radius, color):
-		self.radius = radius
-		self.color = color
-		return
-	def draw(self, screenRect):
-		glEnable(GL_BLEND)
-		glColor4ub(*self.color)
-		if (((screenRect[2]-screenRect[0]) < 2*self.radius)
-			or ((screenRect[3]-screenRect[1]) < 2*self.radius)):
-			# drawing area to small for round edges
-			glRecti(*screenRect)
-		else:
-			glBegin(GL_POLYGON)
-			# upper left
-			glVertex2i(screenRect[0], screenRect[3] - self.radius)
-			glVertex2i(screenRect[0] + self.radius, screenRect[3])
-			# upper right
-			glVertex2i(screenRect[2] - self.radius, screenRect[3])
-			glVertex2i(screenRect[2], screenRect[3] - self.radius)
-			# lower right
-			glVertex2i(screenRect[2], screenRect[1] + self.radius)
-			glVertex2i(screenRect[2] - self.radius, screenRect[1])
-			# lower left
-			glVertex2i(screenRect[0] + self.radius, screenRect[1])
-			glVertex2i(screenRect[0], screenRect[1] + self.radius)
-			# close polygon
-			glVertex2i(screenRect[0], screenRect[3] - self.radius)
-			glEnd()
-		glDisable(GL_BLEND)
-		return
-
-class Selectable(Model):
-	"""Keeps track of selection status.
-	"""
-	def __init__(self, selected):
-		Model.__init__(self)
-		self.selected = selected
-		return
-	def isSelected(self):
-		return self.selected
-	def setSelected(self, selected):
-		self.selected = selected
-		self._notify()
-		return
-	def select(self):
-		self.selected = 1
-		self._notify()
-		return
-	def deselect(self):
-		self.selected = 0
-		self._notify()
-		return
-	
-class SelectableLabel(Widget, View):
-	def __init__(self, selectable, string):
-		"""Constructor.
-		
-		   @param selectable Model.
-		   @param string String to display.
-		"""
-		#Widget.__init__(self)
-		View.__init__(self)
-		self.string = string
-		self.selectable = selectable
-		# mouse focus indicator
-		self.mouseFocusX = 0
-		self.mouseFocusY = 0
-		# last drawing location
-		self.guiRect = [0, 0, 0, 0]
-		self.positionRect = [0, 0, 0, 0]
-		return
-	def draw(self, screenRectangle):
-		# get size of the GUI window to translate MOUSEX and MOUSEY events
-		guiRectBuffer = Blender.BGL.Buffer(GL_FLOAT, 4)
-		Blender.BGL.glGetFloatv(Blender.BGL.GL_SCISSOR_BOX, guiRectBuffer)
-		# replace element wise to avoid IndexError in eventFilter
-		self.guiRect[0] = int(guiRectBuffer.list[0])
-		self.guiRect[1] = int(guiRectBuffer.list[1])
-		self.guiRect[2] = int(guiRectBuffer.list[2])
-		self.guiRect[3]	= int(guiRectBuffer.list[3])
-		## differs by one:
-		## self.guiRect = Blender.Window.GetScreenInfo(Blender.Window.Types['SCRIPT'])[0]['vertices']
-		self.positionRect = screenRectangle
-		# draw panel and label
-		glEnable(GL_BLEND)
-		color = Blender.Window.Theme.Get()[0].get('ui').menu_back
-		glColor4ub(*color)
-		glRecti(*screenRectangle)
-		if (self.mouseFocusX and self.mouseFocusY):
-			color = Blender.Window.Theme.Get()[0].get('ui').menu_hilite
-		else: 
-			color = Blender.Window.Theme.Get()[0].get('ui').menu_item
-		glColor4ub(*color)
-		glRecti(screenRectangle[0], screenRectangle[1]+2, screenRectangle[2], screenRectangle[3]-2)
-		if self.selectable.isSelected():
-			color = [59, 89, 59, 128]
-			glColor4ub(*color)
-			glRecti(screenRectangle[0], screenRectangle[1]+2, screenRectangle[2], screenRectangle[3]-2)
-		color = Blender.Window.Theme.Get()[0].get('ui').menu_text
-		glColor4ub(*color)
-		glRasterPos2i(screenRectangle[0]+4, screenRectangle[1]+7)
-		Blender.Draw.Text(self.string)
-		glDisable(GL_BLEND)
-		return
-	def eventFilter(self, event, value):
-		"""Left mouse click on the label toggles selection status.
-		"""
-		if (value != 0):
-			# check focus
-			if (event == Blender.Draw.MOUSEX):
-				if ((value >= (self.guiRect[0] + self.positionRect[0]))
-					and (value <= (self.guiRect[0]) + self.positionRect[2])):
-					# redraw if widget got focus
-					if (not self.mouseFocusX) and self.mouseFocusY:
-						Blender.Draw.Redraw(1)
-					self.mouseFocusX = 1
-				else:
-					# redraw if widget lost focus
-					if self.mouseFocusX and self.mouseFocusY:
-						Blender.Draw.Redraw(1)
-					self.mouseFocusX = 0
-			elif (event == Blender.Draw.MOUSEY):
-				if ((value >= (self.guiRect[1] + self.positionRect[1]))
-					and (value <= (self.guiRect[1] + self.positionRect[3]))):
-					# redraw if marker got focus
-					if (not self.mouseFocusY) and self.mouseFocusX:
-						Blender.Draw.Redraw(1)
-					self.mouseFocusY = 1
-				else:
-					# redraw if marker lost focus
-					if self.mouseFocusX and self.mouseFocusY:
-						Blender.Draw.Redraw(1)
-					self.mouseFocusY = 0
-			# check selection
-			elif ((event == Blender.Draw.LEFTMOUSE)
-				and self.mouseFocusX and self.mouseFocusY):
-				self.selectable.setSelected(1 - self.selectable.isSelected())
-		return
-	def getMinimumSize(self):
-		return [Blender.Draw.GetStringWidth(self.string), 11+12]	
-	def update(self):
-		Blender.Draw.Redraw(1)
-		return
-
-########################################################################################
-
-class Logger:
-	"""Logs messages and status.
-	
-	   Logs messages as a list of strings and keeps track of the status.
-	   Possible status values are info, warning and error.
-	   
-	   @cvar INFO info status
-	   @cvar WARNING warning status
-	   @cvar ERROR error status
-	"""
-	INFO, WARNING, ERROR = range(3)
-	def __init__(self):
-		"""Constructor.
-		"""
-		self.messageList = []
-		self.status = Logger.INFO
-		return
-	def logInfo(self, message):
-		"""Logs an info message.
-		
-		   @param message message string
-		"""
-		self.messageList.append(message)
-		return		
-	def logWarning(self, message):
-		"""Logs a warning message.
-		
-		   The status is set to <code>Logger.WARNING</code> if it is not already <code>Logger.ERROR</code>.
-		   
-		   @param message message string
-		"""
-		self.messageList.append("Warning: "+message)
-		if not self.status == Logger.ERROR:
-			self.status = Logger.WARNING
-		return
-	def logError(self, message):
-		"""Logs an error message.
-		
-		   The status is set to <code>Logger.ERROR</code>.
-		   
-		   @param message message string
-		"""
-		self.messageList.append("Error: "+message)
-		self.status = Logger.ERROR
-		return
-	def getStatus(self):
-		"""Gets the current status.
-		
-		   The status can be
-		   <ul>
-		   <li><code>Logger.INFO</code>
-		   <li><code>Logger.WARNING</code>
-		   <li><code>Logger.ERROR</code>
-		   </ul>
-		   
-		   @return status
-		"""
-		return self.status
-	def getMessageList(self):
-		"""Returns the list of log messages.
-		
-		   @return list of strings
-		"""
-		return self.messageList
-
-# global logger instance
-exportLogger = Logger()
-
-class ExportSettings:
-	"""Global export settings.
-	"""
-	def __init__(self):
-		self.path = os.path.dirname(Blender.Get('filename'))
-		self.doProperties = 0
-		self.rotX = BoundedValueModel(-1000, 1000, 90)
-		self.rotY = BoundedValueModel(-1000, 1000, 0)
-		self.rotZ = BoundedValueModel(-1000, 1000, 0)
-		#self.load()
-		return
-	def load(self):
-		"""Load settings from registry, if available.
-		"""
-		settingsDict = Registry.GetKey('ogredotscene', True)
-		if settingsDict:
-			if settingsDict.has_key('path'):
-				self.path = settingsDict['path']
-			if settingsDict.has_key('doProperties'):
-				self.doProperties = settingsDict['doProperties']
-			if settingsDict.has_key('rotX'):
-				self.rotX.setValue(settingsDict['rotX'])
-			if settingsDict.has_key('rotY'):
-				self.rotY.setValue(settingsDict['rotY'])
-			if settingsDict.has_key('rotZ'):
-				self.rotZ.setValue(settingsDict['rotZ'])
-		return
-	def save(self):
-		"""Save settings to registry.
-		"""
-		settingsDict = {}
-		settingsDict['path'] = self.path
-		settingsDict['doProperties'] = self.doProperties
-		settingsDict['rotX'] = self.rotX.getValue()
-		settingsDict['rotY'] = self.rotY.getValue()
-		settingsDict['rotZ'] = self.rotZ.getValue()
-		Registry.SetKey('ogredotscene', settingsDict, True) 
-		return
-
-# Blender.Window.FileSelector does not accept type 'instancemethod' callbacks
-# set this to the instancemethod callback
-fileSelectorCallbackMethod = None
-def fileSelectorCallback(fileName):
-	"""FileSelector needs callback of PyFunction_Type
-	"""
-	fileSelectorCallbackMethod(fileName)
-	return
-
-class ObjectExporter(Model):
-	"""Interface. Exports a Blender object to Ogre.
-	"""
-	def __init__(self, object, enabled=1, children=None):
-		"""Constructor.
-		   
-		   @param object Blender object to export.
-		   @param enabled Only enabled objects are exported.
-		   @param children List of child ObjectExporters
-		"""
-		Model.__init__(self)
-		# blender object
-		self.object = object
-		# export status
-		self.enabled = enabled
-		# list of child ObjectExporters
-		self.children = children or []
-		return
-	def isEnabled(self):
-		return self.enabled
-	def setEnabled(self, enabled):
-		self.enabled = enabled
-		self._notify()
-		return
-	def getBlenderObject(self):
-		return self.object
-	def addChild(self, objectExporter):
-		self.children.append(objectExporter)
-		self._notify()
-		return
-	def removeChild(self, objectExporter):
-		if objectExporter in self.children:
-			self.children.remove(objectExporter)
-			self._notify()
-		return
-	def getChildren(self):
-		return self.children
-	def export(self, sceneExporter, fileObject, indent=0, parentTransform=Blender.Mathutils.Matrix([1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1])):
-		"""Append node element for this object and all enabled childrens into a given file.
-		
-		   @param sceneExporter Blender sceneExporter
-		   @param fileObject already opened XML file.
-		   @param indent indentation in the XML file.
-		   @param parentTransform transformations are exported in this coordinate system.
-		"""
-		if self.isEnabled():
-			fileObject.write(self._indent(indent) + "<node name=\"%s\">\n" % self.object.getName())
-			# create transformation matrix relative to parent
-			objectMatrix = self.object.getMatrix("worldspace")
-			euler = self.object.getEuler()
-			Mathutils.RotateEuler(euler, 1.57, 'x')
-			self.object.setEuler(euler)
-			objectMatrix = self.object.getMatrix("worldspace")
-			Mathutils.RotateEuler(euler, -1.57, 'x')
-			self.object.setEuler(euler)
-			inverseParentMatrix = Blender.Mathutils.Matrix(*parentTransform)
-			inverseParentMatrix.invert()
-			matrix = objectMatrix*inverseParentMatrix
-
-			# position
-			fileObject.write(self._indent(indent+1) + \
-							"<position x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(matrix.translationPart()))
-			# rotation
-			rot = matrix.toQuat()
-			fileObject.write(self._indent(indent+1) + \
-							"<rotation qx=\"%.6f\" qy=\"%.6f\" qz=\"%.6f\" qw=\"%.6f\"/>\n" % (rot.x, rot.y, rot.z, rot.w))
-			# scale
-			rot.inverse()
-			inverseRotationMatrix = rot.toMatrix()
-			inverseRotationMatrix.resize4x4()
-			scale = matrix*inverseRotationMatrix
-			fileObject.write(self._indent(indent+1) + \
-							"<scale x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % (scale[0][0], scale[1][1], scale[2][2]))
-			# specifics
-			self.writeSpecificNodeElements(sceneExporter, fileObject, indent+1)
-			# logic properties
-			self.writeUserData(sceneExporter, fileObject, indent+1)
-			for child in self.children:
-				child.export(sceneExporter, fileObject, indent+1, self.object.getMatrix("worldspace"))
-			fileObject.write(self._indent(indent)+"</node>\n")
-		else:
-			for child in self.children:
-				child.export(sceneExporter, fileObject, indent, parentTransform)
-		return
-	def writeSpecificNodeElements(self, sceneExporter, fileObject, indent=0):
-		"""Virtual method to write node elements that depend on the object type.
-		
-		   This method is called before the node element is closed. Overwrite
-		   this method in derived classes for specific object types.
-		"""
-		return
-	def propertyFilter(self, property):
-		"""Filter properties that should not be exported as user data.
-		
-		   @param property the property to test.
-		   @return <code>1</code> if filter applies, otherwise <code>0</code>.
-		"""
-		return 0
-	def writeUserData(self, sceneExporter, fileObject, indent=0):
-		"""Writes object propreties as userDataReference.
-		"""
-		if ((sceneExporter.settings.doProperties) and len(self.object.getAllProperties())):
-			fileObject.write(self._indent(indent) + "<userData>\n")
-			for property in self.object.getAllProperties():
-				if (property and not(self.propertyFilter(property))):
-					fileObject.write(self._indent(indent + 1) + 
-						"<property type=\"%s\" " % property.getType() +
-						"name=\"%s\" " % property.getName() +
-						"data=\"%s\"/>\n" % str(property.getData()))
-			fileObject.write(self._indent(indent) + "</userData>\n")
-		return
-	# protected
-	def _indent(self, indent):
-		return "  "*indent
-
-class MeshExporter(ObjectExporter):
-	def __init__(self, object, enabled=1, children=None):
-		ObjectExporter.__init__(self, object, enabled, children)
-		return
-	def writeSpecificNodeElements(self, sceneExporter, fileObject, indent=0):
-		fileObject.write(self._indent(indent) + "<entity name=\"%s\" meshFile=\"%s\"" \
-			% (self.object.getName(), self.object.data.name + ".mesh"))
-		# static property
-		pList = [p for p in self.object.getAllProperties() if (p.getType() == "BOOL" and p.getName() == "static")]
-		if len(pList):
-			fileObject.write(" static=\"")
-			if pList[0].getData():
-				fileObject.write("true\"")
-			else:
-				fileObject.write("false\"")
-		fileObject.write("/>\n")
-		return
-	def propertyFilter(self, property):
-		filter = 0
-		if ((property.getType() == "BOOL") and (property.getName() == "static")):
-			filter = 1
-		if ((property.getType() == "BOOL") and (property.getName() == "noMeshExport")):
-			filter = 1
-		return filter
-
-class LampExporter(ObjectExporter):
-	def __init__(self, object, enabled=1, children=None):
-		ObjectExporter.__init__(self, object, enabled, children)
-		return
-	def writeSpecificNodeElements(self, sceneExporter, fileObject, indent=0):
-		lamp = self.object.data
-		fileObject.write(self._indent(indent) + "<light name=\"%s\" " % lamp.getName()) 
-		# type specific parameters
-		if (lamp.getType() & lamp.Types['Sun']):
-			self._writeSunNodeElements(sceneExporter, fileObject, indent)
-		elif (lamp.getType() & lamp.Types['Spot']):
-			self._writeSpotNodeElements(sceneExporter, fileObject, indent)
-		else:
-			self._writeLampNodeElements(sceneExporter, fileObject, indent)
-		# close light
-		fileObject.write(self._indent(indent) + "</light>\n")
-		return
-	def _attenuation(self, lamp):
-		# attenuation calculation:
-		#
-		# OpenGL attenuation factor f = 1/(c+l*r+q*r^2),
-		# where r is the distance between the light source and the vertex to be lit.
-		#
-		# Ignore Sphere option as it can't be mapped to Ogre settings.
-		# Note: Multiply lamp colors with Blender's energy factor e.
-		#       => here: e=1.0
-		c = 1.0
-		l = 0.0
-		q = 0.0
-		if (lamp.getMode() & lamp.Modes['Quad']):
-				# Blender's intensity:
-				# f = e*d(d+Q1*r)*d^2/(d^2+Q2*r^2)
-				#   = e*d^3/(d^3 + Q1*d^2*r + d*Q2*r^2 + Q1*Q2*r^3)
-				# => approximately
-				# c = d^3/(e*d^3)  = 1/e
-				# l = Q1/(e*d)
-				# q = Q2/(e*d^2)
-				l = lamp.getQuad1()/lamp.getDist()
-				q = lamp.getQuad2()/(lamp.getDist()*lamp.getDist())
-		else:
-			# no quad, no sphere
-			# Blender's intensity:
-			# f = e*d/(d+r),
-			# where e is energy and d is distance.
-			# =>
-			# c = d/(e*d) = 1/e, l = 1/(e*d), q = 0
-			l = 1.0/lamp.getDist()
-		return (c, l, q)
-	def _colourDiffuse(self, lamp):
-		if (lamp.getMode() & lamp.Modes['NoDiffuse']):
-			color = (0, 0, 0)
-		else:
-			e = lamp.getEnergy()
-			rgb = lamp.col
-			color = (e*rgb[0], e*rgb[1], e*rgb[2])
-		return color
-	def _colourSpecular(self, lamp):
-		if (lamp.getMode() & lamp.Modes['NoSpecular']):
-			color = (0, 0, 0)
-		else:
-			e = lamp.getEnergy()
-			rgb = lamp.col
-			color = (e*rgb[0], e*rgb[1], e*rgb[2])
-		return color
-	def _writeLampNodeElements(self, sceneExporter, fileObject, indent=0):
-		# LT_POINT
-		fileObject.write("type=\"point\">\n")
-		lamp = self.object.data
-		fileObject.write(self._indent(indent+1) + \
-			"<colourDiffuse r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourDiffuse(lamp))
-		fileObject.write(self._indent(indent+1) + \
-			"<colourSpecular r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourSpecular(lamp))
-		fileObject.write(self._indent(indent+1) + \
-			"<lightAttenuation range=\"5000.0\" constant=\"%f\" linear=\"%f\" quadratic=\"%f\"/>\n" \
-			% self._attenuation(lamp))
-		return
-	def _writeSpotNodeElements(self, sceneExporter, fileObject, indent=0):
-		# LT_SPOT
-		fileObject.write("type=\"spot\" ")
-		lamp = self.object.data
-		# castShadows="true" only if Modes['Shadows'] is set
-		if (lamp.getMode() & lamp.Modes['Shadows']):
-			fileObject.write("castShadows=\"true\">\n")
-			range = lamp.getClipEnd()
-		else:
-			fileObject.write("castShadows=\"false\">\n")
-			range = 5000.0
-		# points locally in -z direction
-		fileObject.write(self._indent(indent+1) + "<normal x=\"0.0\" y=\"0.0\" z=\"-1.0\"/>\n")
-		fileObject.write(self._indent(indent+1) + \
-			"<colourDiffuse r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourDiffuse(lamp))
-		fileObject.write(self._indent(indent+1) + \
-			"<colourSpecular r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourSpecular(lamp))
-		# OpenGL parameters:
-		# GL_SPOT_CUTOFF = spotSize/2.0
-		# GL_SPOT_EXPONENT = 128.0*spotBlend
-		# but Ogre::GLRenderSystem Class only uses outer parameter
-		#angle = lamp.getSpotSize()*math.pi/180.0
-		# angle in degree
-		angle = lamp.getSpotSize()
-		fileObject.write(self._indent(indent+1) + \
-			"<lightRange inner=\"%f\" outer=\"%f\" falloff=\"1.0\"/>\n" % (angle, angle))
-		fileObject.write(self._indent(indent+1) +"<lightAttenuation range=\"%f\" " % range)
-		fileObject.write("constant=\"%f\" linear=\"%f\" quadratic=\"%f\"/>\n" \
-			% self._attenuation(lamp))
-		return
-	def _writeSunNodeElements(self, sceneExporter, fileObject, indent=0):
-		# LT_DIRECTIONAL
-		fileObject.write("type=\"directional\">\n")
-		lamp = self.object.data
-		# points locally in -z direction
-		fileObject.write(self._indent(indent+1) + "<normal x=\"0.0\" y=\"0.0\" z=\"-1.0\"/>\n")
-		fileObject.write(self._indent(indent+1) + \
-			"<colourDiffuse r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourDiffuse(lamp))
-		fileObject.write(self._indent(indent+1) + \
-			"<colourSpecular r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourSpecular(lamp))
-		return
-
-class CameraExporter(ObjectExporter):
-	def __init__(self, object, enabled=1, children=None):
-		ObjectExporter.__init__(self, object, enabled, children)
-		return
-	def writeSpecificNodeElements(self, sceneExporter, fileObject, indent=0):
-		# camera element
-		camera = self.object.data
-		fileObject.write(self._indent(indent) + "<camera name=\"%s\" " % camera.getName())
-		# fov calculation
-		render = sceneExporter.scene.getRenderingContext()
-		aspX = render.aspectRatioX()
-		aspY = render.aspectRatioY()
-		sizeX = render.imageSizeX()
-		sizeY = render.imageSizeY()
-		if (camera.getType()==0):
-			# perspective projection
-			# FOV calculation
-			#    .
-			#   /|
-			#  / |v = 16
-			# /a |
-			#.---'
-			#  u = lens
-			#
-			# => FOV = 2*a = 2*arctan(v/u)
-			#
-			# Blender's v is in direction of the larger image dimension.
-			# Ogre's FOV is definied in y direction. Therefore if 
-			# SizeX*AspX > SizeY*AspY the corresponding v in y direction is
-			# v_y = v*(SizeY*AspY)/(SizeX*AspX).
-			fovY = 0.0
-			if (sizeX*aspX > sizeY*aspY):
-				fovY = 2*math.atan(sizeY*aspY*16.0/(camera.getLens()*sizeX*aspX))
-			else:
-				fovY = 2*math.atan(16.0/camera.getLens())
-			# fov in degree
-			fovY = fovY*180.0/math.pi
-			# write fov
-			fileObject.write("fov=\"%f\"" % fovY)
-			fileObject.write(" projectionType=\"perspective\">\n")
-		else:
-			# orthographic projection
-			# FOV calculation 
-			# 
-			# In Blender, the displayed area is scale wide in the larger image direction,
-			# where scale is a ortho camera attribute.
-			#
-			# Ogre calculates the with and height of the displayed area from the
-			# FOVy and the near clipping plane.
-			#    .
-			#   /|
-			#  / |y
-			# /a |
-			#.---'
-			#  n
-			# Here n = near clipping plane and a = FOVy/2.
-			#
-			# Hence y = scale/2 and FOVy = 2*atan(scale/(2*n)).
-			fovY = 0.0
-			if (sizeX*aspX > sizeY*aspY):
-				# tan(FOVx/2.0) = x/n = y*a/n,
-				# where a is the aspect ratio.
-				# It follows that s/(n*a) = y/n = tan(FOVy/2.0).
-				fovY = 2.0*math.atan(sizeY*aspY*camera.getScale()/(2.0*camera.getClipStart()*sizeX*aspX))
-			else:
-				fovY = 2.0*math.atan(camera.getScale()/(2.0*camera.getClipStart()))
-			# fov in degree
-			fovY = fovY*180.0/math.pi
-			# write fov
-			fileObject.write("fov=\"%f\"" % fovY)
-			fileObject.write(" projectionType=\"orthographic\">\n")
-		# normal
-		# Blender's camera normal always points in -z direction locally.
-		fileObject.write(self._indent(indent + 1) + \
-			"<normal x=\"0.0\" y=\"0.0\" z=\"-1.0\"/>\n")
-		# default clipping
-		fileObject.write(self._indent(indent + 1) + \
-			"<clipping near=\"%f\" far=\"%f\"/>\n" % (camera.getClipStart(), camera.getClipEnd()))
-		# close camera
-		fileObject.write(self._indent(indent) + "</camera>\n")
-		return
-		
-class ObjectExporterFactory:
-	"""Creates ObjectExporter for different object types.
-	"""
-	def create(object, enabled):
-		"""Creates ObjecteExporter for the given Blender object.
-		
-		   @param object Blender object to export
-		   @return ObjectExporter on success, <code>None</code> on failure.
-		"""
-		exporter = None
-		if (object.getType() == "Mesh"):
-			exporter = MeshExporter(object, enabled)
-		elif (object.getType() == "Lamp"):
-			exporter = LampExporter(object, enabled)
-		elif (object.getType() == "Camera"):
-			exporter = CameraExporter(object, enabled)
-		elif (object.getType() == "Empty"):
-			exporter = ObjectExporter(object, enabled)
-		elif (object.getType() == "Armature"):
-			exporter = None
-		return exporter
-	create = staticmethod(create)
-
-class ObjectExporterTree(Model):
-	"""Creates tree of ObjectExporter for a Blender scene.
-	"""
-	ENABLEALL, ENABLENONE, ENABLESELECTION = range(3)
-	def __init__(self, scene, enable=ENABLESELECTION):
-		"""Constructor.
-		
-		   @param scene Blender.Scene.
-		   @param enable Initial export status.
-		"""
-		Model.__init__(self)
-		self.rootExporterList = []
-		# create exporter tree
-		# key: object name, value: ObjectExporter
-		exporterDict = {}
-		# 1.) create ObjectExporters for all exportable scene objects
-		selectedList = []
-		if Blender.Object.GetSelected():
-			selectedList = [object.getName() for object in Blender.Object.GetSelected()]
-		for object in scene.getChildren():
-			enabled = 0
-			if (enable == ObjectExporterTree.ENABLESELECTION):
-				if object.getName() in selectedList:
-					enabled = 1
-			elif (enable == ObjectExporterTree.ENABLEALL):
-				enabled = 1
-			exporter = ObjectExporterFactory.create(object, enabled)
-			if exporter:
-				# register object
-				exporterDict[object.getName()] = exporter
-		#  2.) create tree structure
-		for exporter in exporterDict.values():
-			# search for an exportable parent
-			object = exporter.getBlenderObject().getParent()
-			searchCompleted = 0
-			while not searchCompleted:
-				# object a Blender.Object (possible parent) or none
-				if object:
-					parentName = object.getName()
-					if exporterDict.has_key(parentName):
-						# exportable parent found
-						exporterDict[parentName].addChild(exporter)
-						searchCompleted = 1
-					else:
-						# try next possible parent
-						object = object.getParent()
-				else:
-					# exporter object has no exportable parent
-					self.rootExporterList.append(exporter)
-					searchCompleted = 1
-		return
-	def export(self, sceneExporter, fileObject, indent=0, parentTransform=Blender.Mathutils.Matrix([1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1])):
-		for exporter in self.rootExporterList:
-			exporter.export(sceneExporter, fileObject, indent, parentTransform)
-		return
-	def enableAll(self):
-		for exporter in self:
-			exporter.setEnabled(1)
-		self._notify()
-		return
-	def enableNone(self):
-		for exporter in self:
-			exporter.setEnabled(0)
-		self._notify()
-		return
-	def invertEnabled(self):
-		for exporter in self:
-			exporter.setEnabled(1 - exporter.isEnabled())
-		self._notify()
-		return
-	def enableLayer(self, layer):
-		#TODO
-		self._notify()
-		return
-	def disableLayer(self, layer):
-		self._notify()
-		#TODO
-		return
-	def __iter__(self):
-		return ObjectExporterTree.ObjectExporterTreeIterator(self)
-	class ObjectExporterTreeIterator:
-		def __init__(self, objectExporterTree):
-			self.stack = objectExporterTree.rootExporterList[:]
-			return
-		def next(self):
-			exporter = None
-			if len(self.stack):
-				exporter = self.stack.pop()
-				self.stack.extend(exporter.getChildren())
-			else:
-				raise StopIteration
-			return exporter
-
-class ProgressListener:
-	def __init__(self):
-		self.percent = 0.0
-		self.string = ''
-		self.viewList = []
-		return
-	def addView(self, view):
-		self.viewList.append(view)
-		return
-	def removeView(self, view):
-		if view in self.viewList:
-			self.viewList.remove(view)
-		return
-	def progress(self, percent, string):
-		self.percent = percent
-		self.string = string
-		# update views
-		self._notify()
-		return
-	# private
-	def _notify(self):
-		"""Notify views.
-		"""
-		for view in self.viewList:
-			view.update()
-		return
-
-class ProgressListenerView(Widget):
-	def __init__(self, progressListener):
-		self.listener = progressListener
-		self.listener.addView(self)
-		return
-	def update(self):
-		Blender.Draw.Redraw(1)
-		return
-
-class ProgressListenerProgressBar(ProgressBar, ProgressListenerView):
-	def __init__(self, progressListener):
-		ProgressListenerView.__init__(self, progressListener)
-		ProgressBar.__init__(self)
-		return
-	def update(self):
-		self.progress(self.listener.percent, self.listener.string)
-		ProgressListenerView.update(self)
-		return
-
-class ProgressListenerDoneButton(Button, ProgressListenerView):
-	def __init__(self, progressListener, action, name, size, tooltip=None):
-		ProgressListenerView.__init__(self, progressListener)
-		Button(self, action, name, size, tooltip)
-		if (self.listener.percent >= 100):
-			self.done = 1
-		else:
-			self.done = 0
-		return
-	def update(self):
-		if (self.listener.percent >= 100):
-			self.done = 1
-			ProgressListenerView.update(self)
-		return
-	def draw(self, rect):
-		if self.done:
-			Button.draw(self, rect)
-		return
-
-class SceneExporter:
-	"""Exports a scene to a dotScene XML file.
-	"""
-	def __init__(self, scene, settings, enable=ObjectExporterTree.ENABLESELECTION):
-		"""Constructor.
-		
-		   @param scene Blender.Scene.
-		   @param settings ExportSettings.
-		   @param enable Initial export status.
-		"""
-		self.scene = scene
-		self.settings = settings
-		self.tree = ObjectExporterTree(scene, enable)
-		return
-	def export(self):
-		"""Export the scene to dotScene XML file.
-		"""
-		# open scene xml file
-		#fileName = self.scene.getName() + ".xml"
-		fileName = "kanalisation.scene"
-		fileObject = open(os.path.join(self.settings.path, fileName), "w")
-		self._write(fileObject)
-		fileObject.close()
-		return
-	def addProgressListener(self, listener):
-		self.progressListenerList.append(listener)
-		return
-	def removeProgressListener(self, listener):
-		if listener in self.progressListenerList:
-			self.progressListenerList.remove(listener)
-		return
-	# private
-	def _progress(self, percent, string):
-		"""Report progress to the attached ProgressListeners.
-		"""
-		for listener in self.progressListenerList:
-			listener.progress(percent, string)
-		return
-	def _write(self, fileObject):
-		"""Write XML scene into the fileObject.
-		"""
-		# header
-		fileObject.write("<scene formatVersion=\"0.2.0\">\n")
-		# nodes
-		self._writeNodes(fileObject, 1)
-		# externals (material file)
-		self._writeExternals(fileObject, 1)
-		# environment
-		self._writeEnvironment(fileObject, 1)
-		# footer
-		fileObject.write("</scene>\n")
-		return
-	def _writeNodes(self, fileObject, indent=0):
-		fileObject.write(self._indent(indent) + "<nodes>\n")
-		# default: set matrix to 90 degree rotation around x-axis
-		# rotation order: x, y, z
-		# WARNING: Blender uses left multiplication!
-		rotationMatrix = Mathutils.RotationMatrix(self.settings.rotX.getValue(), 4, 'x')
-		rotationMatrix *= Mathutils.RotationMatrix(self.settings.rotY.getValue(), 4, 'y')
-		rotationMatrix *= Mathutils.RotationMatrix(self.settings.rotZ.getValue(), 4, 'z')
-		self.tree.export(self, fileObject, indent+1, rotationMatrix)
-		fileObject.write(self._indent(indent) + "</nodes>\n")
-		return
-	def _writeExternals(self, fileObject, indent=0):
-		fileObject.write(self._indent(indent) + "<externals>\n")
-		fileObject.write(self._indent(indent + 1) + "<item type=\"material\">\n")
-		fileObject.write(self._indent(indent + 2) + "<file name=\"%s\"/>\n" % (self.scene.getName()+".material"))
-		fileObject.write(self._indent(indent + 1) + "</item>\n")
-		fileObject.write(self._indent(indent) + "</externals>\n")
-		return
-	def _writeEnvironment(self, fileObject, indent=0):
-		self.scene.makeCurrent() 
-		world = Blender.World.GetCurrent()
-		if world:
-			fileObject.write(self._indent(indent) + "<environment>\n")
-			# can only get the active world of the current scene
-			if (world.mode & 1):
-				# Mist enabled
-				# Color = f*pixelColor + (1-f)*fogColor
-				#
-				# Blender's f factor:
-				# f = (1 - g((z - mistStart)/mistDepth))*(1-mistIntensity)
-				# where
-				# g(x)=x^2 for Qua,
-				# g(x)=x for Lin,
-				# g(x)=sqrt(x) for Sqr
-				# and z is the distance of the pixel to the camera.
-				#
-				# OpenGL's f factor:
-				# f = exp(-(density*z)) for GL_EXP,
-				# f = exp(-(density*z)^2) for GL_EXP2,
-				# f = (end - z)/(end - start) = (1 - (z - start)/(end - start)) for GL_LINEAR
-				#
-				# Assume depth and intensity is small and linear approximate
-				# all Blender mist types, i.e. ignore intensity and type.
-				mist = world.getMist() 
-				fileObject.write(self._indent(indent + 1) + \
-					"<fog linearStart=\"%f\" linearEnd=\"%f\" mode=\"linear\">\n" \
-					% (mist[1], mist[1]+mist[2]))
-				fileObject.write(self._indent(indent + 2) + \
-					"<colourDiffuse r=\"%f\" g=\"%f\" b=\"%f\"/>\n" \
-					% tuple(world.getHor()))
-				fileObject.write(self._indent(indent + 1) + "</fog>\n")
-			# ambient color
-			fileObject.write(self._indent(indent + 1) + \
-							"<colourAmbient r=\"%f\" g=\"%f\" b=\"%f\"/>\n" \
-							% tuple(world.getAmb()))
-			# horizon color
-			fileObject.write(self._indent(indent + 1) + \
-							"<colourBackground r=\"%f\" g=\"%f\" b=\"%f\"/>\n" \
-							% tuple(world.getHor()))
-			fileObject.write(self._indent(indent) + "</environment>\n")
-		return
-	def _indent(self, indent):
-		return "  "*indent
-
-########################################################################################
-class ExportAction(Action):
-	def __init__(self, sceneExporter):
-		self.sceneExporter = sceneExporter
-		return
-	def execute(self):
-		ExportAction.WaitScreen().activate()
-		#for f in os.listdir(full_path):
-		#	try:
-		#		os.remove(full_path+"\\"+f)
-		#	except:
-		#		pass
-		self.sceneExporter.export()
-		objects = Blender.Scene.GetCurrent().getChildren()
-		objects2 = []
-		for o in objects:
-			if hasProperty(o, "noMeshExport")==0:
-				objects2.append(o)
-		export(objects2)
-		ExportAction.DoneScreen().activate()
-		#try:
-		#	hero = Blender.Object.Get ('Hero')
-		#	heroPos = hero.getLocation()
-		#	heroPosString = "$hero.getActor().placeIntoScene([" + `heroPos[0]` + ", " + `heroPos[2]` + ", " + `-heroPos[1]` +"]);\n"
-		#except:
-		#	print "You should place an 'Hero'-Object. Default-Location (0, 0, 0) is used."
-		#	heroPosString = "$hero.getActor().placeIntoScene([0.0, 0.0, 0.0]);\n"
-		#scriptFile = open(rastullah_path + kanalisation_subpath + "scripts\\maps\\kanalisation.rb")
-		#lines = []
-		#for line in scriptFile:
-		#	lines.append(line)
-		#lines[17] = heroPosString
-		#scriptFile.close()
-		#scriptFile = open(rastullah_path + kanalisation_subpath + "scripts\\maps\\kanalisation.rb", "w")
-		#scriptFile.writelines(lines)
-		#scriptFile.close()
-		return
-	class WaitScreen(Screen):
-		def __init__(self):
-			global exportLogger
-			Screen.__init__(self)
-			self.addWidget(Label("Exporting, please wait!"), 'label')
-			i = 0
-			print exportLogger.getMessageList()
-			for x in exportLogger.getMessageList():
-				print x
-				self.addWidget(Label(x), 'label'+i)
-			
-			return
-
-	class DoneScreen(Screen):
-		def __init__(self):
-			Screen.__init__(self)
-			vLayout = VerticalLayout()
-			vLayout.addWidget(Label("Scene Exported!"), 'label1')
-			vLayout.addWidget(Label(" "), 'label2')
-			vLayout.addWidget(Label("Note: Don't forget to export all mesh objects with the ogreexport.py script."), 'label3')
-			vLayout.addWidget(Spacer([0,0], [Widget.INFINITY, Widget.INFINITY], [Widget.INFINITY, Widget.INFINITY]),'space')
-			hLayout = HorizontalLayout()
-			hLayout.addWidget(Button(ExportAction.QuitAction(), 'Quit without starting RL', [200, 30]),'quitButton')
-			hLayout.addWidget(Spacer([5.0,5.0], [5.0, 5.0], [5.0, 5.0]),'space')
-			hLayout.addWidget(Button(ExportAction.RLAction(), 'Quit and start RL with Map', [200, 30]),'RLStartButton')
-			vLayout.addWidget(hLayout,'buttonPanel')
-			self.addWidget(OgreFrame(vLayout, 'dotScene Exporter'),'ogreFrame')
-			return
-	class QuitAction(Action):
-		def __init__(self):
-			return
-		def execute(self):
-			Blender.Draw.Exit()
-			return
-	class RLAction(Action):
-		def __init__(self):
-			return
-		def execute(self):
-			oldpath = os.getcwd()
-			os.chdir(rastullah_path)
-			os.spawnl(os.P_NOWAIT, rastullah_path+"Rastullah.exe", "--module kanalisation")
-			os.chdir(oldpath)
-			Blender.Draw.Exit()
-			return
-
-if (__name__ == "__main__"):
-	exportSettings = ExportSettings()
-	exportSettings.doProperties = 1
-	exportSettings.path = full_path
-	sceneExporter = SceneExporter(Blender.Scene.getCurrent(), exportSettings)
-	exportAction = ExportAction(sceneExporter)
-	sceneExporter.tree.enableAll()
-	exportAction.execute()
-	
\ No newline at end of file



From alassion at mail.berlios.de  Wed Jul  2 21:45:42 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 21:45:42 +0200
Subject: [Dsa-hl-svn] r4414 - tools/blender_scripts
Message-ID: <200807021945.m62JjgIO016751@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 21:45:39 +0200 (Wed, 02 Jul 2008)
New Revision: 4414

Added:
   tools/blender_scripts/ogrelevelexport_kanalisation.py
Log:
- added new ogrelevelexport script

Added: tools/blender_scripts/ogrelevelexport_kanalisation.py
===================================================================
--- tools/blender_scripts/ogrelevelexport_kanalisation.py	2008-07-02 19:45:18 UTC (rev 4413)
+++ tools/blender_scripts/ogrelevelexport_kanalisation.py	2008-07-02 19:45:39 UTC (rev 4414)
@@ -0,0 +1,5567 @@
+#!BPY
+
+"""
+Name: 'Rastullah Quick Level Viewer Kanalisation'
+Blender: 242
+Group: 'Export'
+Tooltip: 'Exports Scene and non marked Meshes into kanalisation module and RL and starts theself afterwards'
+"""
+
+__author__ = ['Julius Schulz']
+__version__ = '0.0.1'
+__url__ = ['Project Page, http://www.rastullahs-lockenpracht.de/',
+	'Team Pantheon, http://www.team-pantheon.de/']
+__bpydoc__ = """\
+Exports Scene and non marked Meshes into kanalisation module and RL and starts theself afterwards
+"""
+
+# Copyright (C) 2006  Julius Schulz for Rastullahs Lockenpracht Modifications
+# Copyright (C) 2005  Michel Reimpell for Scene Exporter
+# Copyright (C) 2004-2005 Michael Reimpell for Mesh Exporter -- <M.Reimpell at tu-bs.de>
+# Copyright (C) 2003 Jens Hoffmann for Mesh Exporter -- <hoffmajs at gmx.de>
+# Copyright (C) 2003 Jean-Baptiste LAMY for Mesh Exporter -- jiba at tuxfamily.org
+#
+# This library is free software; you can redistribute it and/or
+# modify it under the terms of the GNU Lesser General Public
+# License as published by the Free Software Foundation; either
+# version 2.1 of the License, or (at your option) any later version.
+# 
+# This library is distributed in the hope that it will be useful,
+# but WITHOUT ANY WARRANTY; without even the implied warranty of
+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+# Lesser General Public License for more details.
+# 
+# You should have received a copy of the GNU Lesser General Public
+# License along with this library; if not, write to the Free Software
+# Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA
+
+# epydoc doc format
+__docformat__ = "javadoc en"
+
+######
+# imports
+######
+import sys
+
+try:
+	import Blender
+except ImportError:
+	sys.exit("Please run this script from within Blender!\nSee the script's manual for more information.")
+
+import os, math
+
+######
+# namespaces
+######
+from Blender import Draw
+from Blender import Mathutils
+from Blender import Registry
+from Blender.BGL import *
+
+######
+# globals
+rastullah_path = "D:\\Rastullah\\rl_dist_20071809\\"
+kanalisation_subpath = "modules\\kanalisation\\"
+kanalisation_substring = kanalisation_subpath + "maps"
+full_path = rastullah_path+kanalisation_substring
+OGRE_OPENGL_VERTEXCOLOUR = 0
+OGRE_XML_CONVERTER = 'D:\\Rastullah\\OgreCommandLineTools\\OgreXmlConverter.exe'
+OGRE_MESH_UPGRADE = 'D:\\Rastullah\\OgreCommandLineTools\\OgreMeshUpgrade.exe -t -td tagent'
+KEEP_SETTINGS = 0
+
+def hasProperty(object, name):
+	properties = object.getAllProperties()
+	for prop in properties:
+		if prop.getName() == name:
+			return 1
+	return 0
+######
+
+######
+# mesh export stuff
+class ReplacementScrollbar:
+    """Scrollbar replacement for Draw.Scrollbar
+       <ul>
+       <li> import Blender
+       <li> call eventFilter and buttonFilter in registered callbacks
+       </ul>
+
+       @author Michael Reimpell
+    """
+    def __init__(self, initialValue, minValue, maxValue, buttonUpEvent, buttonDownEvent):
+        """Constructor
+
+           @param initialValue    inital value
+           @param minValue        minimum value
+           @param maxValue        maxium value
+           @param buttonUpEvent   unique event number
+           @param buttonDownEvent unique event number
+        """
+        self.currentValue = initialValue
+        self.minValue = minValue
+        if maxValue > minValue:
+            self.maxValue = maxValue
+        else:
+            self.maxValue = self.minValue
+            self.minValue = maxValue
+        self.buttonUpEvent = buttonUpEvent
+        self.buttonDownEvent = buttonDownEvent
+        # private
+        self.guiRect = [0,0,0,0]
+        self.positionRect = [0,0,0,0]
+        self.markerRect = [0,0,0,0]
+        self.mousePressed = 0
+        self.mouseFocusX = 0
+        self.mouseFocusY = 0
+        self.markerFocusY = 0
+        self.mousePositionY = 0
+        return
+
+    def getCurrentValue(self):
+        """current marker position
+        """
+        return self.currentValue
+
+    def up(self, steps=1):
+        """move scrollbar up
+        """
+        if (steps > 0):
+            if ((self.currentValue - steps) > self.minValue):
+                self.currentValue -= steps
+            else:
+                self.currentValue = self.minValue
+        return
+
+    def down(self, steps=1):
+        """move scrollbar down
+        """
+        if (steps > 0):
+            if ((self.currentValue + steps) < self.maxValue):
+                self.currentValue += steps
+            else:
+                self.currentValue = self.maxValue
+        return
+
+    def draw(self, x, y, width, height):
+        """draw scrollbar
+        """
+        # get size of the GUI window to translate MOUSEX and MOUSEY events
+        guiRectBuffer = Blender.BGL.Buffer(GL_FLOAT, 4)
+        Blender.BGL.glGetFloatv(Blender.BGL.GL_SCISSOR_BOX, guiRectBuffer)
+        self.guiRect = [int(guiRectBuffer.list[0]), int(guiRectBuffer.list[1]), \
+                        int(guiRectBuffer.list[2]), int(guiRectBuffer.list[3])]
+        # relative position
+        self.positionRect = [ x, y, x + width, y + height]
+        # check minimal size:
+        # 2 square buttons,4 pixel borders and 1 pixel inside for inner and marker rectangles
+        if ((height > (2*(width+5))) and (width > 2*5)):
+            # keep track of remaining area
+            remainRect = self.positionRect[:]
+            # draw square buttons
+            Blender.Draw.Button("/\\", self.buttonUpEvent, x, y + (height-width), width, width, "scroll up")
+            remainRect[3] -=  width + 2
+            Blender.Draw.Button("\\/", self.buttonDownEvent, x, y, width, width, "scroll down")
+            remainRect[1] +=  width + 1
+            # draw inner rectangle
+            Blender.BGL.glColor3f(0.13,0.13,0.13) # dark grey
+            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+            remainRect[0] += 1
+            remainRect[3] -= 1
+            Blender.BGL.glColor3f(0.78,0.78,0.78) # light grey
+            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+            remainRect[1] += 1
+            remainRect[2] -= 1
+            Blender.BGL.glColor3f(0.48,0.48,0.48) # grey
+            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+            # draw marker rectangle
+            # calculate marker rectangle
+            innerHeight = remainRect[3]-remainRect[1]
+            markerHeight = innerHeight/(self.maxValue-self.minValue+1.0)
+            # markerRect
+            self.markerRect[0] = remainRect[0]
+            self.markerRect[1] = remainRect[1] + (self.maxValue - self.currentValue)*markerHeight
+            self.markerRect[2] = remainRect[2]
+            self.markerRect[3] = self.markerRect[1] + markerHeight
+            # clip markerRect to innerRect (catch all missed by one errors)
+            if self.markerRect[1] > remainRect[3]:
+                self.markerRect[1] = remainRect[3]
+            if self.markerRect[3] > remainRect[3]:
+                self.markerRect[3] = remainRect[3]
+            # draw markerRect
+            remainRect = self.markerRect
+            Blender.BGL.glColor3f(0.78,0.78,0.78) # light grey
+            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+            remainRect[0] += 1
+            remainRect[3] -= 1
+            Blender.BGL.glColor3f(0.13,0.13,0.13) # dark grey
+            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+            remainRect[1] += 1
+            remainRect[2] -= 1
+            # check if marker has foucs
+            if (self.mouseFocusX and self.mouseFocusY and (self.mousePositionY > self.markerRect[1]) and (self.mousePositionY < self.markerRect[3])):
+                Blender.BGL.glColor3f(0.64,0.64,0.64) # marker focus grey
+            else:
+                Blender.BGL.glColor3f(0.60,0.60,0.60) # marker grey
+            Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+        else:
+            print "scrollbar draw size too small!"
+        return
+
+    def eventFilter(self, event, value):
+        """event filter for keyboard and mouse input events
+           call it inside the registered event function
+        """
+        if (value != 0):
+            # Buttons
+            if (event == Blender.Draw.PAGEUPKEY):
+                self.up(3)
+                Blender.Draw.Redraw(1)
+            elif (event == Blender.Draw.PAGEDOWNKEY):
+                self.down(3)
+                Blender.Draw.Redraw(1)
+            elif (event == Blender.Draw.UPARROWKEY):
+                self.up(1)
+                Blender.Draw.Redraw(1)
+            elif (event == Blender.Draw.DOWNARROWKEY):
+                self.down(1)
+                Blender.Draw.Redraw(1)
+            # Mouse
+            elif (event == Blender.Draw.MOUSEX):
+                # check if mouse is inside positionRect
+                if (value >= (self.guiRect[0] + self.positionRect[0])) and (value <= (self.guiRect[0] + self.positionRect[2])):
+                    # redraw if marker got focus
+                    if (not self.mouseFocusX) and self.mouseFocusY:
+                        Blender.Draw.Redraw(1)
+                    self.mouseFocusX = 1
+                else:
+                    # redraw if marker lost focus
+                    if self.mouseFocusX and self.mouseFocusY:
+                        Blender.Draw.Redraw(1)
+                    self.mouseFocusX = 0
+            elif (event == Blender.Draw.MOUSEY):
+                # check if mouse is inside positionRect
+                if (value >= (self.guiRect[1] + self.positionRect[1])) and (value <= (self.guiRect[1] + self.positionRect[3])):
+                    self.mouseFocusY = 1
+                    # relative mouse position
+                    self.mousePositionY = value - self.guiRect[1]
+                    if ((self.mousePositionY > self.markerRect[1]) and (self.mousePositionY < self.markerRect[3])):
+                        # redraw if marker got focus
+                        if self.mouseFocusX and (not self.markerFocusY):
+                            Blender.Draw.Redraw(1)
+                        self.markerFocusY = 1
+                    else:
+                        # redraw if marker lost focus
+                        if self.mouseFocusX and self.markerFocusY:
+                            Blender.Draw.Redraw(1)
+                        self.markerFocusY = 0
+                    # move marker
+                    if (self.mousePressed == 1):
+                        # calculate step from distance to marker
+                        if (self.mousePositionY > self.markerRect[3]):
+                            # up
+                            self.up(1)
+                            Blender.Draw.Draw()
+                        elif (self.mousePositionY < self.markerRect[1]):
+                            # down
+                            self.down(1)
+                            Blender.Draw.Draw()
+                        # redraw if marker lost focus
+                        if self.mouseFocusX and self.mouseFocusY:
+                            Blender.Draw.Redraw(1)
+                else:
+                    # redraw if marker lost focus
+                    if self.mouseFocusX and self.markerFocusY:
+                        Blender.Draw.Redraw(1)
+                    self.markerFocusY = 0
+                    self.mouseFocusY = 0
+            elif ((event == Blender.Draw.LEFTMOUSE) and (self.mouseFocusX == 1) and (self.mouseFocusY == 1)):
+                self.mousePressed = 1
+                # move marker
+                if (self.mousePositionY > self.markerRect[3]):
+                    # up
+                    self.up(1)
+                    Blender.Draw.Redraw(1)
+                elif (self.mousePositionY < self.markerRect[1]):
+                    # down
+                    self.down(1)
+                    Blender.Draw.Redraw(1)
+            elif (Blender.Get("version") >= 234):
+                if (event == Blender.Draw.WHEELUPMOUSE):
+                    self.up(1)
+                    Blender.Draw.Redraw(1)
+                elif (event == Blender.Draw.WHEELDOWNMOUSE):
+                    self.down(1)
+                    Blender.Draw.Redraw(1)
+        else: # released keys and buttons
+            if (event == Blender.Draw.LEFTMOUSE):
+                self.mousePressed = 0
+
+        return
+
+    def buttonFilter(self, event):
+        """button filter for Draw Button events
+           call it inside the registered button function
+        """
+        if (event  == self.buttonUpEvent):
+            self.up()
+            Blender.Draw.Redraw(1)
+        elif (event == self.buttonDownEvent):
+            self.down()
+            Blender.Draw.Redraw(1)
+        return
+
+class ArmatureAction:
+    """Resembles Blender's actions
+       <ul>
+       <li> import Blender, string
+       </ul>
+
+       @author Michael Reimpell
+    """
+    def __init__(self, name="", ipoDict=None):
+        """Constructor
+
+           @param name    the action name
+           @param ipoDict a dictionary with bone names as keys and action Ipos as values
+        """
+        self.firstKeyFrame = None
+        self.lastKeyFrame = None
+        self.name = name
+        # ipoDict[boneName] = Blender.Ipo
+        if ipoDict is None:
+            self.ipoDict = {}
+        else:
+            self.ipoDict = ipoDict
+            self._updateKeyFrameRange()
+        return
+
+    # private method
+    def _updateKeyFrameRange(self):
+        """Updates firstKeyFrame and lastKeyFrame considering the current IpoCurves.
+        """
+        self.firstKeyFrame = None
+        self.lastKeyFrame = None
+        if self.ipoDict is not None:
+            # check all bone Ipos
+            for ipo in self.ipoDict.values():
+                # check all IpoCurves
+                for ipoCurve in ipo.getCurves():
+                    # check first and last keyframe
+                    for bezTriple in ipoCurve.getPoints():
+                        iFrame = bezTriple.getPoints()[0]
+                        if ((iFrame < self.firstKeyFrame) or (self.firstKeyFrame is None)):
+                            self.firstKeyFrame = iFrame
+                        if ((iFrame > self.lastKeyFrame) or (self.lastKeyFrame is None)):
+                            self.lastKeyFrame = iFrame
+        if self.firstKeyFrame == None:
+            self.firstKeyFrame = 1
+        if self.lastKeyFrame == None:
+            self.lastKeyFrame = 1
+        return
+
+    # static method
+    def createArmatureActionDict(object):
+        """Creates a dictionary of possible actions belonging to an armature.
+           Static call with: ArmatureAction.createArmatureActionDict(object)
+
+           @param object a Blender.Object of type Armature
+           @return a dictionary of ArmatureAction objects with name as key and ArmatureAction as value
+        """
+        # create bone dict
+        #boneQueue = object.getData().bones
+        boneDict = object.getData().bones
+
+        boneNameList = boneDict.keys()
+        # check for available actions
+        armatureActionDict = {}
+        ## get linked action first
+        linkedAction = object.getAction()
+        if linkedAction is not None:
+            # check all bones
+            linkedActionIpoDict = linkedAction.getAllChannelIpos()
+            hasValidChannel = 0 # false
+            iBone = 0
+            while ((not hasValidChannel) and (iBone < len(boneNameList))):
+                if (linkedActionIpoDict.keys().count(boneNameList[iBone]) == 1):
+                    if linkedActionIpoDict[boneNameList[iBone]].getNcurves():
+                        hasValidChannel = 1 # true
+                    else:
+                        iBone += 1
+                else:
+                    iBone += 1
+            if hasValidChannel:
+                # add action
+                armatureActionDict[linkedAction.getName()] = ArmatureAction(linkedAction.getName(), linkedActionIpoDict)
+        ## get other actions != linked action
+        actionDict = Blender.Armature.NLA.GetActions()
+        for actionName in actionDict.keys():
+            # check if action is not linked action
+            if actionDict[actionName] is not linkedAction:
+                # check all bones
+                actionIpoDict = actionDict[actionName].getAllChannelIpos()
+                hasValidChannel = 0 # false
+                iBone = 0
+                while ((not hasValidChannel) and (iBone < len(boneNameList))):
+                    if (actionIpoDict.keys().count(boneNameList[iBone]) == 1):
+                        if actionIpoDict[boneNameList[iBone]].getNcurves():
+                            hasValidChannel = 1 # true
+                        else:
+                            iBone += 1
+                    else:
+                        iBone += 1
+                if hasValidChannel:
+
+                    # add action
+                    armatureActionDict[actionName] = ArmatureAction(actionName, actionIpoDict)
+        return armatureActionDict
+    createArmatureActionDict = staticmethod(createArmatureActionDict)
+
+class ArmatureActionActuator:
+    """Resembles Blender's action actuators.
+
+       @author Michael Reimpell
+    """
+    def __init__(self, name, startFrame, endFrame, armatureAction):
+        """Constructor
+
+           @param name           Animation name
+           @param startFrame     first frame of the animation
+           @param endFrame       last frame of the animation
+           @param armatureAction ArmatureAction object of the animation
+        """
+        self.name = name
+        self.startFrame = startFrame
+        self.endFrame = endFrame
+        self.armatureAction = armatureAction
+        return
+
+class ArmatureActionActuatorListView:
+    """Mangages a list of ArmatureActionActuators.
+       <ul>
+       <li> import Blender
+       <li> call eventFilter and buttonFilter in registered callbacks
+       </ul>
+
+       @author Michael Reimpell
+    """
+    def __init__(self, armatureActionDict, maxActuators, buttonEventRangeStart, armatureAnimationDictList=None):
+        """Constructor.
+
+           @param armatureActionDict        possible armature actuator actions
+           @param maxActuators              maximal number of actuator list elements
+           @param buttonEventRangeStart     first button event number.
+                                            The number of used event numbers is (3 + maxActuators*5)
+           @param armatureAnimationDictList list of armature animations (see getArmatureAnimationDictList())
+        """
+        self.armatureActionDict = armatureActionDict
+        self.maxActuators = maxActuators
+        self.buttonEventRangeStart = buttonEventRangeStart
+        self.armatureActionActuatorList = []
+        self.armatureActionMenuList = []
+        self.startFrameNumberButtonList = []
+        self.endFrameNumberButtonList = []
+        self.animationNameStringButtonList = []
+        # scrollbar values:
+        #   0:(len(self.armatureActionActuatorList)-1) = listIndex
+        #   len(self.armatureActionActuatorList) = addbuttonline
+        self.scrollbar = ReplacementScrollbar(0,0,0, self.buttonEventRangeStart+1, self.buttonEventRangeStart+2)
+        if armatureAnimationDictList is not None:
+            # rebuild ArmatureActionActuators for animationList animations
+            for animationDict in armatureAnimationDictList:
+                # check if Action is available
+                if self.armatureActionDict.has_key(animationDict['actionKey']):
+                    armatureActionActuator = ArmatureActionActuator(animationDict['name'], \
+                                                                    animationDict['startFrame'], \
+                                                                    animationDict['endFrame'], \
+                                                                    self.armatureActionDict[animationDict['actionKey']])
+                    self._addArmatureActionActuator(armatureActionActuator)
+        else:
+            # create default ArmatureActionActuators
+            for armatureAction in self.armatureActionDict.values():
+                # add default action
+                armatureActionActuator = ArmatureActionActuator(armatureAction.name, armatureAction.firstKeyFrame, armatureAction.lastKeyFrame, armatureAction)
+                self._addArmatureActionActuator(armatureActionActuator)
+        return
+
+    def refresh(self, armatureActionDict):
+        """Delete ArmatureActionActuators for removed Actions.
+
+           @param armatureActionDict possible ArmatureActuator actions
+        """
+        self.armatureActionDict = armatureActionDict
+        # delete ArmatureActionActuators for removed Actions
+        for armatureActionActuator in self.armatureActionActuatorList[:]:
+            # check if action is still available
+            if not self.armatureActionDict.has_key(armatureActionActuator.armatureAction.name):
+                # remove armatureActionActuator from lists
+                listIndex = self.armatureActionActuatorList.index(armatureActionActuator)
+                self._deleteArmatureActionActuator(listIndex)
+        Blender.Draw.Redraw(1)
+        return
+
+    def draw(self, x, y, width, height):
+        """draw actuatorList
+           use scrollbar if needed
+        """
+        # black border
+        minX = x
+        minY = y
+        maxX = x + width
+        maxY = y + height
+        minWidth = 441
+        if ((width - 5) > minWidth):
+            glColor3f(0.0,0.0,0.0)
+            glRectf(minX, minY, maxX - 22, maxY)
+            glColor3f(0.6,0.6,0.6) # Background: grey
+            glRectf(minX + 1, minY + 1, maxX - 23, maxY - 1)
+            x += 3
+            y += 3
+            width -= 5
+            height -= 6
+        else:
+            print "ArmatureActionActuatorListView draw size to small!"
+            glColor3f(0.0,0.0,0.0)
+            glRectf(minX, minY, maxX, maxY)
+            glColor3f(0.6,0.6,0.6) # Background: grey
+            glRectf(minX + 1, minY + 1, maxX, maxY - 1)
+            x += 3
+            y += 3
+            width -= 5
+            height -= 6
+        # Layout:
+        # |---- 105 ---|2|----80---|2|---80---|2|---- >80 ----|2|---60---|2|----20---|
+        # actionName   | startFrame | endFrame | animationName | [delete] | scrollbar
+        # [ add ]                                                         | scrollbar
+        if (len(self.armatureActionDict.keys()) > 0):
+            # construct actionMenu name
+            menuValue = 0
+            menuName = ""
+            for key in self.armatureActionDict.keys():
+                menuName += key + " %x" + ("%d" % menuValue) + "|"
+                menuValue +=1
+            # first line
+            lineY = y + height - 20
+            lineX = x
+            listIndex = self.scrollbar.getCurrentValue()
+            while ((listIndex < len(self.armatureActionActuatorList)) and (lineY >= y)):
+                # still armatureActionActuators left to draw
+                lineX = x
+                armatureActionActuator = self.armatureActionActuatorList[listIndex]
+                # draw actionMenu
+                event = self.buttonEventRangeStart + 3 + listIndex
+                menuValue = self.armatureActionDict.keys().index(armatureActionActuator.armatureAction.name)
+                self.armatureActionMenuList[listIndex] = Blender.Draw.Menu(menuName,event, x, lineY, 105, 20, menuValue, "Action name")
+                lineX += 107
+                # draw startFrameNumberButton
+                event = self.buttonEventRangeStart + 3 + self.maxActuators + listIndex
+                self.startFrameNumberButtonList[listIndex] = Blender.Draw.Number("Sta: ", event, lineX, lineY, 80, 20, \
+                                                         armatureActionActuator.startFrame, -18000, 18000, "Start frame")
+                lineX += 82
+                # draw endFrameNumberButton
+                event = self.buttonEventRangeStart + 3 + 2*self.maxActuators + listIndex
+                self.endFrameNumberButtonList[listIndex] = Blender.Draw.Number("End: ", event, lineX, lineY, 80, 20, \
+                                                         armatureActionActuator.endFrame, -18000, 18000, "End frame")
+                lineX += 82
+                # compute animationNameWidht
+                animationNameWidth = width - 271 - 85
+                if (animationNameWidth < 80):
+                    animationNameWidth = 80
+                # draw animationNameStringButton
+                event = self.buttonEventRangeStart + 3 + 3*self.maxActuators + listIndex
+                self.animationNameStringButtonList[listIndex] = Blender.Draw.String("",event, lineX, lineY, animationNameWidth, 20, \
+                                                                armatureActionActuator.name, 1000, "Animation export name")
+                lineX += animationNameWidth + 2
+                # draw deleteButton
+                event = self.buttonEventRangeStart + 3 + 4*self.maxActuators + listIndex
+                Draw.Button("Delete", event, lineX, lineY, 60, 20, "Delete export animation")
+                lineX += 62
+                # inc line
+                lineY -= 22
+                listIndex += 1
+            # draw add button
+            if (lineY >= y):
+                Draw.Button("Add", self.buttonEventRangeStart, x, lineY, 60, 20, "Add new export animation")
+        # draw scrollbar
+        if (width > minWidth):
+            # align left
+            self.scrollbar.draw(maxX - 20, minY, 20, (maxY - minY))
+        return
+
+    def eventFilter(self, event, value):
+        """event filter for keyboard and mouse input events
+           call it inside the registered event function
+        """
+        self.scrollbar.eventFilter(event,value)
+        return
+
+    def buttonFilter(self, event):
+        """button filter for Draw Button events
+           call it inside the registered button function
+        """
+        # button numbers = self.buttonEventRangeStart + buttonNumberOffset
+        # buttonNumberOffsets:
+        # addButton: 0
+        # scrollbar: 1 and 2
+        # actionMenu range: 3 <= event < 3 + maxActuators
+        # startFrameNumberButton range:  3 + maxActuators <= event < 3 + 2*maxActuators
+        # endFrameNumberButton range: 3 + 2*maxActuators <= event < 3 + 3*maxActuators
+        # animationNameStringButton range: 3 + 3*maxActuators <= event < 3 + 4*maxActuators
+        # deleteButton range: 3 + 4*maxActuators <= event < 3 + 5*maxActuators
+        self.scrollbar.buttonFilter(event)
+        relativeEvent = event - self.buttonEventRangeStart
+        if (relativeEvent == 0):
+            # add button pressed
+            if (len(self.armatureActionDict.keys()) > 0):
+                # add default ArmatureActionActuator
+                armatureAction = self.armatureActionDict[self.armatureActionDict.keys()[0]]
+                armatureActionActuator = ArmatureActionActuator(armatureAction.name, armatureAction.firstKeyFrame, armatureAction.lastKeyFrame, armatureAction)
+                self._addArmatureActionActuator(armatureActionActuator)
+                Blender.Draw.Redraw(1)
+        elif ((3 <= relativeEvent) and (relativeEvent < (3 + self.maxActuators))):
+            # actionMenu
+            listIndex = relativeEvent - 3
+            armatureActionActuator = self.armatureActionActuatorList[listIndex]
+            # button value is self.actionDict.keys().index
+            keyIndex = self.armatureActionMenuList[listIndex].val
+            key = self.armatureActionDict.keys()[keyIndex]
+            armatureActionActuator.armatureAction = self.armatureActionDict[key]
+            armatureActionActuator.startFrame = self.armatureActionDict[key].firstKeyFrame
+            armatureActionActuator.endFrame = self.armatureActionDict[key].lastKeyFrame
+            armatureActionActuator.name = self.armatureActionDict[key].name
+            self.armatureActionActuatorList[listIndex] = armatureActionActuator
+            Blender.Draw.Redraw(1)
+        elif (((3 + self.maxActuators) <= relativeEvent) and (relativeEvent < (3 + 2*self.maxActuators))):
+            # startFrameNumberButton
+            listIndex = relativeEvent - (3 + self.maxActuators)
+            armatureActionActuator = self.armatureActionActuatorList[listIndex]
+            armatureActionActuator.startFrame = self.startFrameNumberButtonList[listIndex].val
+            self.armatureActionActuatorList[listIndex] = armatureActionActuator
+        elif (((3 + 2*self.maxActuators) <= relativeEvent) and (relativeEvent < (3 + 3*self.maxActuators))):
+            # endFrameNumberButton
+            listIndex = relativeEvent - (3 + 2*self.maxActuators)
+            armatureActionActuator = self.armatureActionActuatorList[listIndex]
+            armatureActionActuator.endFrame = self.endFrameNumberButtonList[listIndex].val
+            self.armatureActionActuatorList[listIndex] = armatureActionActuator
+        elif (((3 + 3*self.maxActuators) <= relativeEvent) and (relativeEvent < (3 + 4*self.maxActuators))):
+            # animationNameStringButton
+            listIndex = relativeEvent - (3 + 3*self.maxActuators)
+            armatureActionActuator = self.armatureActionActuatorList[listIndex]
+            armatureActionActuator.name = self.animationNameStringButtonList[listIndex].val
+            self.armatureActionActuatorList[listIndex] = armatureActionActuator
+        elif (((3 + 4*self.maxActuators) <= relativeEvent) and (relativeEvent < (3 + 5*self.maxActuators))):
+            # deleteButton
+            listIndex = relativeEvent - (3 + 4*self.maxActuators)
+            self._deleteArmatureActionActuator(listIndex)
+            Blender.Draw.Redraw(1)
+        return
+
+    def getArmatureAnimationDictList(self):
+        """serialize the armatureActionActuatorList into a pickle storable list
+           Each item of the returned list is a dictionary with key-value pairs:
+           <ul>
+           <li>    name - ArmatureActionActuator.name
+           <li>    startFrame - ArmatureActionActuator.startFrame
+           <li>    endFrame - ArmatureActionActuator.endFrame
+           <li>    armatureActionKey - ArmatureActionActuator.armatureAction.name
+           </ul>
+
+           @return serialized actionActuatorList
+        """
+        animationDictList = []
+        for armatureActionActuator in self.armatureActionActuatorList:
+            # create animationDict
+            animationDict = {}
+            animationDict['name'] = armatureActionActuator.name
+            animationDict['startFrame'] = armatureActionActuator.startFrame
+            animationDict['endFrame'] = armatureActionActuator.endFrame
+            animationDict['actionKey'] = armatureActionActuator.armatureAction.name
+            animationDictList.append(animationDict)
+        return animationDictList
+
+    def setAnimationDictList(self, animationDictList):
+        """loads old AnimationDictList with actionKey = (ipoPrefix, ipoPostfix)
+
+           @see #getArmatureAnimationDictList()
+        """
+        # rebuild ArmatureActionActuators for animationList animations
+        for animationDict in animationDictList:
+            # check if Action is available
+            prefix, postfix = animationDict['actionKey']
+            armatureActionName = prefix+postfix
+            if self.armatureActionDict.has_key(armatureActionName):
+                armatureActionActuator = ArmatureActionActuator(animationDict['name'], \
+                                                                animationDict['startFrame'], \
+                                                                animationDict['endFrame'], \
+                                                                self.armatureActionDict[armatureActionName])
+                self._addArmatureActionActuator(armatureActionActuator)
+        return
+
+    # private methods
+    def _addArmatureActionActuator(self, armatureActionActuator):
+        """adds an ArmatureActionActuator to the list
+           <ul>
+           <li> call Blender.Draw.Redraw(1) afterwards
+           </ul>
+        """
+        if (len(self.armatureActionActuatorList) < self.maxActuators):
+            # check if armatureActionActuator.action is available
+            if armatureActionActuator.armatureAction.name in self.armatureActionDict.keys():
+                # create armatureActionMenu
+                # get ArmatureAction index in armatureActionDict.keys() list
+                armatureActionMenu = Draw.Create(self.armatureActionDict.keys().index(armatureActionActuator.armatureAction.name))
+                self.armatureActionMenuList.append(armatureActionMenu)
+                # create startFrameNumberButton
+                startFrameNumberButton = Draw.Create(int(armatureActionActuator.startFrame))
+                self.startFrameNumberButtonList.append(startFrameNumberButton)
+                # create endFrameNumberButton
+                endFrameNumberButton = Draw.Create(int(armatureActionActuator.endFrame))
+                self.endFrameNumberButtonList.append(endFrameNumberButton)
+                # create animationNameStringButton
+                animationNameStringButton = Draw.Create(armatureActionActuator.name)
+                self.animationNameStringButtonList.append(animationNameStringButton)
+                # append to armatureActionActuatorList
+                self.armatureActionActuatorList.append(armatureActionActuator)
+                # adjust scrollbar
+                scrollbarPosition = self.scrollbar.getCurrentValue()
+                self.scrollbar = ReplacementScrollbar(scrollbarPosition,0,len(self.armatureActionActuatorList), self.buttonEventRangeStart+1, self.buttonEventRangeStart+2)
+                # TODO: change scrollbarPosition in a way, such that the new actuator is visible
+            else:
+                print "Error: Could not add ArmatureActionActuator because ArmatureAction is not available!"
+        return
+
+    def _deleteArmatureActionActuator(self, listIndex):
+        """removes an ArmatureActionActuator from the list
+           <ul>
+           <li> call Blender.Draw.Redraw(1) afterwards
+           </ul>
+        """
+        # check listIndex
+        if ((len(self.armatureActionActuatorList) > 0) and (listIndex >= 0) and (listIndex < len(self.armatureActionActuatorList))):
+            # remove armatureActionMenu
+            self.armatureActionMenuList.pop(listIndex)
+            # remove startFrameNumberButton
+            self.startFrameNumberButtonList.pop(listIndex)
+            # remove endFrameNumberButton
+            self.endFrameNumberButtonList.pop(listIndex)
+            # remove animationNameStringButton
+            self.animationNameStringButtonList.pop(listIndex)
+            # remove armatureActionActuator
+            self.armatureActionActuatorList.pop(listIndex)
+            # adjust scrollbar
+            scrollbarPosition = self.scrollbar.getCurrentValue()
+            if (scrollbarPosition > len(self.armatureActionActuatorList)):
+                scrollbarPosition = len(self.armatureActionActuatorList)
+            self.scrollbar = ReplacementScrollbar(scrollbarPosition,0,len(self.armatureActionActuatorList), self.buttonEventRangeStart+1, self.buttonEventRangeStart+2)
+            return
+
+class Logger:
+    """Logs messages and status.
+
+       Logs messages as a list of strings and keeps track of the status.
+       Possible status values are info, warning and error.
+
+       @cvar INFO info status
+       @cvar WARNING warning status
+       @cvar ERROR error status
+    """
+    INFO, WARNING, ERROR = range(3)
+    def __init__(self):
+        """Constructor.
+        """
+        self.messageList = []
+        self.status = Logger.INFO
+        return
+    def logInfo(self, message):
+        """Logs an info message.
+
+           @param message message string
+        """
+        self.messageList.append((Logger.INFO, message))
+        return
+    def logWarning(self, message):
+        """Logs a warning message.
+
+           The status is set to <code>Logger.WARNING</code> if it is not already <code>Logger.ERROR</code>.
+
+           @param message message string
+        """
+        self.messageList.append((Logger.WARNING, "Warning: "+message))
+        if not self.status == Logger.ERROR:
+            self.status = Logger.WARNING
+        return
+    def logError(self, message):
+        """Logs an error message.
+
+           The status is set to <code>Logger.ERROR</code>.
+
+           @param message message string
+        """
+        self.messageList.append((Logger.ERROR, "Error: "+message))
+        self.status = Logger.ERROR
+        return
+    def getStatus(self):
+        """Gets the current status.
+
+           The status can be
+           <ul>
+           <li><code>Logger.INFO</code>
+           <li><code>Logger.WARNING</code>
+           <li><code>Logger.ERROR</code>
+           </ul>
+
+           @return status
+        """
+        return self.status
+    def getMessageList(self):
+        """Returns the list of log messages.
+
+           @return list of tuples (status, message)
+        """
+        return self.messageList
+
+class LogInterface:
+    def __init__(self):
+        self.loggerList = []
+    def addLogger(self, logger):
+        self.loggerList.append(logger)
+        return
+    def removeLogger(self, logger):
+        self.loggerList.remove(logger)
+        return
+    # protected
+    def _logInfo(self, message):
+        for logger in self.loggerList:
+            logger.logInfo(message)
+        return
+    def _logWarning(self, message):
+        for logger in self.loggerList:
+            logger.logWarning(message)
+        return
+    def _logError(self, message):
+        for logger in self.loggerList:
+            logger.logWarning(message)
+        return
+
+class PathName(LogInterface):
+    """Splits a pathname independent of the underlying os.
+
+       Blender saves pathnames in the os specific manner. Using os.path may result in problems
+       when the export is done on a different os than the creation of the .blend file.
+    """
+    def __init__(self, pathName):
+        self.pathName = pathName
+        LogInterface.__init__(self)
+        return
+    def dirname(self):
+        return os.path.dirname(self.pathName)
+    def basename(self):
+        baseName = os.path.basename(self.pathName)
+        # split from non-os directories
+        # \\
+        baseName = baseName.split('\\').pop()
+        # /
+        baseName = baseName.split('/').pop()
+        if (baseName != baseName.replace(' ','_')):
+            # replace whitespace with underscore
+            self._logWarning("Whitespaces in filename \"%s\" replaced with underscores." % baseName)
+            baseName = baseName.replace(' ','_')
+        return baseName
+    def path(self):
+        return self.pathName
+
+class ExportOptions:
+    """Encapsulates export options common to all objects.
+    """
+    # TODO: Model for GUI
+    def __init__(self, rotXAngle, rotYAngle, rotZAngle, scale, useWorldCoordinates, colouredAmbient, armatureExport, useGameEngineMaterials, exportPath, materialFilename):
+        """Constructor.
+        """
+        # floating point accuracy
+        self.accuracy = 1e-6
+        # export transformation
+        self.rotXAngle = rotXAngle
+        self.rotYAngle = rotYAngle
+        self.rotZAngle = rotZAngle
+        self.scale = scale
+        self.useWorldCoordinates = useWorldCoordinates
+        self.colouredAmbient = colouredAmbient
+        # file settings
+        self.exportPath = exportPath
+        self.materialFilename = materialFilename
+        self.armatureExport = armatureExport
+        self.useGameEngineMaterials = useGameEngineMaterials
+        return
+
+    def transformationMatrix(self):
+        """Returns the matrix representation for the additional transformation on export.
+        """
+        rotationMatrix = Mathutils.RotationMatrix(self.rotXAngle,4,'x')
+        rotationMatrix *= Mathutils.RotationMatrix(self.rotYAngle,4,'y')
+        rotationMatrix *= Mathutils.RotationMatrix(self.rotZAngle,4,'z')
+        scaleMatrix = Mathutils.Matrix([self.scale,0,0],[0,self.scale,0],[0,0,self.scale])
+        scaleMatrix.resize4x4()
+        return rotationMatrix*scaleMatrix
+
+class ObjectExporter:
+    """Interface. Exports a Blender object to Ogre.
+    """
+    def __init__(self, object):
+        """Constructor.
+
+           @param object Blender object to export.
+        """
+        self.object = object
+        return
+
+    def getName(self):
+        """Returns the name of the object.
+        """
+        return self.object.getName()
+
+    def getObjectMatrix(self):
+        """Returns the object matrix in worldspace.
+        """
+        return self.object.matrixWorld
+
+
+class MeshExporter(ObjectExporter):
+    """
+    """
+    def getName(self):
+        return self.object.getData().name
+
+class ArmatureExporter:
+    """Exports an armature of a mesh.
+    """
+    # TODO: Provide bone ids for vertex influences.
+    def __init__(self, meshObject, armatureObject):
+        """Constructor.
+
+          @param meshObject ObjectExporter.
+          @param armatureObject Blender armature object.
+        """
+        self.meshObject = meshObject
+        self.armatureObject = armatureObject
+        self.skeleton = None
+        return
+
+    def export(self, actionActuatorList, exportOptions, logger):
+        """Exports the armature.
+
+           @param actionActuatorList list of animations to export.
+           @param exportOptions global export options.
+           @param logger Logger Logger for log messages.
+        """
+        # convert Armature into Skeleton
+        name = None
+        if exportOptions.useWorldCoordinates:
+            name = self.armatureObject.getData().name
+        else:
+            name = self.meshObject.getName() + "-" + self.armatureObject.getData().name
+        skeleton = Skeleton(name)
+        skeleton = self._convertRestpose(skeleton, exportOptions, logger)
+
+        # convert ActionActuators into Animations
+        self._convertAnimations(skeleton, actionActuatorList, exportOptions, exportLogger)
+
+        # write to file
+        self._toFile(skeleton, exportOptions, exportLogger)
+
+        self.skeleton = skeleton
+        return
+
+    def _convertAnimations(self, skeleton, armatureActionActuatorList, exportOptions, exportLogger):
+        """Converts ActionActuators to Ogre animations.
+        """
+        # frames per second
+        fps = Blender.Scene.GetCurrent().getRenderingContext().framesPerSec()
+        # map armatureActionActuatorList to skeleton.animationsDict
+        for armatureActionActuator in armatureActionActuatorList:
+            # map armatureActionActuator to animation
+            if (not skeleton.animationsDict.has_key(armatureActionActuator.name)):
+                # create animation
+                animation = Animation(armatureActionActuator.name)
+                # map bones to tracks
+                for boneName in armatureActionActuator.armatureAction.ipoDict.keys():
+                    if (not(animation.tracksDict.has_key(boneName))):
+                        # get bone object
+                        if skeleton.bonesDict.has_key(boneName):
+                            # create track
+                            track = Track(animation, skeleton.bonesDict[boneName])
+                            # map ipocurves to keyframes
+                            # get ipo for that bone
+                            ipo = armatureActionActuator.armatureAction.ipoDict[boneName]
+                            # map curve names to curvepos
+                            curveId = {}
+                            index = 0
+                            have_quat = 0
+                            for curve in ipo.getCurves():
+                                try:
+                                    name = curve.getName()
+                                    if (name == "LocX" or name == "LocY" or name == "LocZ" or \
+                                    name == "SizeX" or name == "SizeY" or name == "SizeZ" or \
+                                    name == "QuatX" or name == "QuatY" or name == "QuatZ" or name == "QuatW"):
+                                        curveId[name] = index
+                                        index += 1
+                                    else:
+                                    # bug: 2.28 does not return "Quat*"...
+                                        if not have_quat:
+                                            curveId["QuatX"] = index
+                                            curveId["QuatY"] = index+1
+                                            curveId["QuatZ"] = index+2
+                                            curveId["QuatW"] = index+3
+                                            index += 4
+                                            have_quat = 1
+                                except TypeError:
+                                    # blender 2.32 does not implement IpoCurve.getName() for action Ipos
+                                    if not have_quat:
+                                        # no automatic assignments so far
+                                        # guess Ipo Names
+                                        nIpoCurves = ipo.getNcurves()
+                                        if nIpoCurves in [4,7,10]:
+                                            exportLogger.logWarning("IpoCurve.getName() not available!")
+                                            exportLogger.logWarning("The exporter tries to guess the IpoCurve names.")
+                                            if (nIpoCurves >= 7):
+                                                # not only Quats
+                                                # guess: Quats and Locs
+                                                curveId["LocX"] = index
+                                                curveId["LocY"] = index+1
+                                                curveId["LocZ"] = index+2
+                                                index += 3
+                                            if (nIpoCurves == 10):
+                                                # all possible Action IpoCurves
+                                                curveId["SizeX"] = index
+                                                curveId["SizeY"] = index+1
+                                                curveId["SizeZ"] = index+2
+                                                index += 3
+                                            if (nIpoCurves >= 4):
+                                                # at least 4 IpoCurves
+                                                # guess: 4 Quats
+                                                curveId["QuatX"] = index
+                                                curveId["QuatY"] = index+1
+                                                curveId["QuatZ"] = index+2
+                                                curveId["QuatW"] = index+3
+                                                index += 4
+                                            have_quat = 1
+                                        else:
+                                            exportLogger.logError("IpoCurve.getName() not available!")
+                                            exportLogger.logError("Could not guess the IpoCurve names. Other Blender versions may work.")
+                            # get all frame numbers between startFrame and endFrame where this ipo has a point in one of its curves
+                            frameNumberDict = {}
+                            for curveIndex in range(ipo.getNcurves()):
+                                for bez in range(ipo.getNBezPoints(curveIndex)):
+                                    frame = int(ipo.getCurveBeztriple(curveIndex, bez)[3])
+                                    frameNumberDict[frame] = frame
+                            frameNumberDict[armatureActionActuator.startFrame] = armatureActionActuator.startFrame
+                            frameNumberDict[armatureActionActuator.endFrame] = armatureActionActuator.endFrame
+                            # remove frame numbers not in the startFrame endFrame range
+                            if (armatureActionActuator.startFrame > armatureActionActuator.endFrame):
+                                minFrame = armatureActionActuator.endFrame
+                                maxFrame = armatureActionActuator.startFrame
+                            else:
+                                minFrame = armatureActionActuator.startFrame
+                                maxFrame = armatureActionActuator.endFrame
+                            for frameNumber in frameNumberDict.keys()[:]:
+                                if ((frameNumber < minFrame) or (frameNumber > maxFrame)):
+                                    del frameNumberDict[frameNumber]
+                            frameNumberList = frameNumberDict.keys()
+                            # convert frame numbers to seconds
+                            # frameNumberDict: key = export time, value = frame number
+                            frameNumberDict = {}
+                            for frameNumber in frameNumberList:
+                                if  (armatureActionActuator.startFrame <= armatureActionActuator.endFrame):
+                                    # forward animation
+                                    time = float(frameNumber-armatureActionActuator.startFrame)/fps
+                                else:
+                                    # backward animation
+                                    time = float(armatureActionActuator.endFrame-frameNumber)/fps
+                                # update animation duration
+                                if animation.duration < time:
+                                    animation.duration = time
+                                frameNumberDict[time] = frameNumber
+                            # create key frames
+                            timeList = frameNumberDict.keys()
+                            timeList.sort()
+                            for time in timeList:
+                                # Blender's ordering of transformations is deltaR*deltaS*deltaT
+                                # in the bone's coordinate system.
+                                frame = frameNumberDict[time]
+                                loc = ( 0.0, 0.0, 0.0 )
+                                rotQuat = Mathutils.Quaternion([1.0, 0.0, 0.0, 0.0])
+                                sizeX = 1.0
+                                sizeY = 1.0
+                                sizeZ = 1.0
+                                blenderLoc = [0, 0, 0]
+                                hasLocKey = 0 #false
+                                if curveId.has_key("LocX"):
+                                    blenderLoc[0] = ipo.EvaluateCurveOn(curveId["LocX"], frame)
+                                    hasLocKey = 1 #true
+                                if curveId.has_key("LocY"):
+                                    blenderLoc[1] = ipo.EvaluateCurveOn(curveId["LocY"], frame)
+                                    hasLocKey = 1 #true
+                                if curveId.has_key("LocZ"):
+                                    blenderLoc[2] = ipo.EvaluateCurveOn(curveId["LocZ"], frame)
+                                    hasLocKey = 1 #true
+                                if hasLocKey:
+                                    # Ogre's deltaT is in the bone's parent coordinate system
+                                    loc = point_by_matrix(blenderLoc, skeleton.bonesDict[boneName].conversionMatrix)
+                                if curveId.has_key("QuatX") and curveId.has_key("QuatY") and curveId.has_key("QuatZ") and curveId.has_key("QuatW"):
+                                    if not (Blender.Get("version") == 234):
+                                        rot = [ ipo.EvaluateCurveOn(curveId["QuatW"], frame), \
+                                                ipo.EvaluateCurveOn(curveId["QuatX"], frame), \
+                                                ipo.EvaluateCurveOn(curveId["QuatY"], frame), \
+                                                ipo.EvaluateCurveOn(curveId["QuatZ"], frame) ]
+                                        rotQuat = Mathutils.Quaternion(rot)
+                                    else:
+                                        # Blender 2.34 quaternion naming bug
+                                        rot = [ ipo.EvaluateCurveOn(curveId["QuatX"], frame), \
+                                                ipo.EvaluateCurveOn(curveId["QuatY"], frame), \
+                                                ipo.EvaluateCurveOn(curveId["QuatZ"], frame), \
+                                                ipo.EvaluateCurveOn(curveId["QuatW"], frame) ]
+                                        rotQuat = Mathutils.Quaternion(rot)
+                                    rotQuat.normalize()
+                                if curveId.has_key("SizeX"):
+                                    sizeX = ipo.EvaluateCurveOn(curveId["SizeX"], frame)
+                                if curveId.has_key("SizeY"):
+                                    sizeY = ipo.EvaluateCurveOn(curveId["SizeY"], frame)
+                                if curveId.has_key("SizeZ"):
+                                    sizeZ = ipo.EvaluateCurveOn(curveId["SizeZ"], frame)
+                                size = (sizeX, sizeY, sizeZ)
+                                KeyFrame(track, time, loc, rotQuat, size)
+                            # append track
+                            animation.tracksDict[boneName] = track
+                        else:
+                            # ipo name contains bone but armature doesn't
+                            exportLogger.logWarning("Unused action channel \"%s\" in action \"%s\" for skeleton \"%s\"." \
+                                             % (boneName, armatureActionActuator.armatureAction.name, skeleton.name))
+                    else:
+                        # track for that bone already exists
+                        exportLogger.logError("Ambiguous bone name \"%s\", track already exists." % boneName)
+                # append animation
+                skeleton.animationsDict[armatureActionActuator.name] = animation
+            else:
+                # animation export name already exists
+                exportLogger.logError("Ambiguous animation name \"%s\"." % armatureActionActuator.name)
+        return
+
+    def _convertRestpose(self, skeleton, exportOptions, logger):
+        """Calculate inital bone positions and rotations.
+        """
+        print "convert posed started"
+        obj = self.armatureObject
+        stack = []
+        matrix = None
+        matrix_one = Mathutils.Matrix([1.0, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, 1])
+        if exportOptions.useWorldCoordinates:
+            # world coordinates
+            matrix = obj.getMatrix("worldspace")
+        else:
+            # local mesh coordinates
+            armatureMatrix = obj.getMatrix("worldspace")
+            # Blender returns direct access to matrix but we only want a copy
+            # since we will be inverting it
+            inverseMeshMatrix = matrix_one * self.meshObject.getObjectMatrix()
+            inverseMeshMatrix.invert()
+            matrix = armatureMatrix*inverseMeshMatrix
+        # apply additional export transformation
+        matrix = matrix*exportOptions.transformationMatrix()
+        loc = [ 0.0, 0, 0 ]
+        parent = None
+
+        # get parent bones
+        #note: in Blender 2.4, bones returns a dictionary of all bones in an armature
+        boneDict = obj.getData().bones
+        for bbone in boneDict.values():
+            #print bbone, bbone.parent
+            if bbone.parent == None:
+                stack.append([bbone, parent, matrix, loc, 0, matrix_one])
+
+        # iterate through bones and build ogre equivalent bones
+        # blend bone matrix in armature space is perfect for ogre equivalency
+        #
+        while len(stack):
+            bbone, parent, accu_mat, parent_pos, parent_ds, invertedOgreTransformation = stack.pop()
+            # preconditions: (R : rotation, T : translation, S : scale, M: general transformation matrix)
+            #   accu_mat
+            #     points to the tail of the parents bone, i.e. for root bones
+            #     accu_mat = M_{object}*R_{additional on export}
+            #     and for child bones
+            #     accu_mat = T_{length of parent}*R_{parent}*T_{to head of parent}*M_{parent's parent}
+            #  invertedOgreTransformation
+            #    inverse of transformation done in Ogre so far, i.e. identity for root bones,
+            #    M^{-1}_{Ogre, parent's parent}*T^{-1}_{Ogre, parent}*R^{-1}_{Ogre, parent} for child bones.
+
+            head = bbone.head['BONESPACE']
+            tail = bbone.tail['BONESPACE']
+
+            # get the restmat
+            R_bmat = bbone.matrix['BONESPACE'].rotationPart()
+            rotQuat = R_bmat.toQuat()
+            R_bmat.resize4x4()
+
+            #get the bone's root offset (in the parent's coordinate system)
+            T_root = [ [       1,       0,       0,      0 ],
+            [       0,       1,       0,      0 ],
+            [       0,       0,       1,      0 ],
+            [ head[0], head[1], head[2],      1 ] ]
+
+            # get the bone length translation (length along y axis)
+            dx, dy, dz = tail[0] - head[0], tail[1] - head[1], tail[2] - head[2]
+            ds = math.sqrt(dx*dx + dy*dy + dz*dz)
+            T_len = [ [ 1,  0,  0,  0 ],
+                [ 0,  1,  0,  0 ],
+                [ 0,  0,  1,  0 ],
+                [ 0, ds,  0,  1 ] ]
+
+            # calculate bone points in world coordinates
+            accu_mat = matrix_multiply(accu_mat, T_root)
+            pos = point_by_matrix([ 0, 0, 0 ], accu_mat)
+
+            accu_mat = tmp_mat = matrix_multiply(accu_mat, R_bmat)
+            # tmp_mat = R_{bone}*T_{to head}*M_{parent}
+            accu_mat = matrix_multiply(accu_mat, T_len)
+
+            # local rotation and distance from parent bone
+            if parent:
+                rotQuat = bbone.matrix['BONESPACE'].rotationPart().toQuat()
+            else:
+                rotQuat = (bbone.matrix['BONESPACE'].rotationPart().resize4x4()*matrix).toQuat()
+
+            x, y, z = pos
+            # pos = loc * M_{Ogre}
+            loc = point_by_matrix([x, y, z], invertedOgreTransformation)
+            x, y, z = loc
+            ogreTranslationMatrix = [[ 1, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [x, y, z, 1]]
+
+            # R_{Ogre} is either
+            # the rotation part of R_{bone}*T_{to_head}*M_{parent} for root bones or
+            # the rotation part of R_{bone}*T_{to_head} of child bones
+            ogreRotationMatrix = rotQuat.toMatrix()
+            ogreRotationMatrix.resize4x4()
+            invertedOgreTransformation = matrix_multiply(matrix_invert(ogreTranslationMatrix), invertedOgreTransformation)
+            parent = Bone(skeleton, parent, bbone.name, loc, rotQuat, matrix_multiply(invertedOgreTransformation, tmp_mat))
+            #print "bone created:", parent
+            # matrix_multiply(invertedOgreTransformation, tmp_mat) is R*T*M_{parent} M^{-1}_{Ogre}T^{-1}_{Ogre}.
+            # Necessary, since Ogre's delta location is in the Bone's parent coordinate system, i.e.
+            # deltaT_{Blender}*R*T*M = deltaT_{Ogre}*T_{Ogre}*M_{Ogre}
+            invertedOgreTransformation = matrix_multiply(matrix_invert(ogreRotationMatrix), invertedOgreTransformation)
+            if bbone.children is not None:
+                for child in bbone.children:
+                    # make sure child bone is attached to current parent
+                    if child.parent is not None:
+                        if child.parent.name == bbone.name:
+                            stack.append([child, parent, accu_mat, pos, ds, invertedOgreTransformation])
+        return skeleton
+
+    def _toFile(self, skeleton, exportOptions, exportLogger):
+        """Writes converted skeleton to file.
+        """
+        file = skeleton.name+".skeleton.xml"
+        exportLogger.logInfo("Skeleton \"%s\"" % file)
+        f = open(os.path.join(exportOptions.exportPath, file), "w")
+        f.write(tab(0)+"<skeleton>\n")
+        f.write(tab(1)+"<bones>\n")
+        for bone in skeleton.bones:
+            f.write(tab(2)+"<bone id=\"%d\" name=\"%s\">\n" % (bone.id, bone.name))
+
+            x, y, z = bone.loc
+            f.write(tab(3)+"<position x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % (x, y, z))
+
+            f.write(tab(3)+"<rotation angle=\"%.6f\">\n" % (bone.rotQuat.angle/360*2*math.pi))
+            f.write(tab(4)+"<axis x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(bone.rotQuat.axis))
+            f.write(tab(3)+"</rotation>\n")
+            f.write(tab(2)+"</bone>\n")
+        f.write(tab(1)+"</bones>\n")
+
+        f.write(tab(1)+"<bonehierarchy>\n")
+        for bone in skeleton.bones:
+            parent = bone.parent
+            if parent:
+                f.write(tab(2)+"<boneparent bone=\"%s\" parent=\"%s\"/>\n" % (bone.name, parent.name))
+        f.write(tab(1)+"</bonehierarchy>\n")
+
+        f.write(tab(1)+"<animations>\n")
+
+        for animation in skeleton.animationsDict.values():
+            name = animation.name
+
+            f.write(tab(2)+"<animation")
+            f.write(" name=\"%s\"" % name)
+            f.write(" length=\"%f\">\n" % animation.duration )
+
+            f.write(tab(3)+"<tracks>\n")
+            for track in animation.tracksDict.values():
+                f.write(tab(4)+"<track bone=\"%s\">\n" % track.bone.name)
+                f.write(tab(5)+"<keyframes>\n")
+
+                for keyframe in track.keyframes:
+                    f.write(tab(6)+"<keyframe time=\"%f\">\n" % keyframe.time)
+                    x, y, z = keyframe.loc
+                    f.write(tab(7)+"<translate x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % (x, y, z))
+                    f.write(tab(7)+"<rotate angle=\"%.6f\">\n" % (keyframe.rotQuat.angle/360*2*math.pi))
+
+                    f.write(tab(8)+"<axis x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(keyframe.rotQuat.axis))
+                    f.write(tab(7)+"</rotate>\n")
+
+                    f.write(tab(7)+"<scale x=\"%f\" y=\"%f\" z=\"%f\"/>\n" % keyframe.scale)
+
+                    f.write(tab(6)+"</keyframe>\n")
+
+                f.write(tab(5)+"</keyframes>\n")
+                f.write(tab(4)+"</track>\n");
+
+            f.write(tab(3)+"</tracks>\n");
+            f.write(tab(2)+"</animation>\n")
+
+        f.write(tab(1)+"</animations>\n")
+        f.write(tab(0)+"</skeleton>\n")
+        f.close()
+        convertXMLFile(os.path.join(exportOptions.exportPath, file))
+        return
+
+class ArmatureMeshExporter(ObjectExporter):
+    """Exports an armature object as mesh.
+
+       Converts a Blender armature into an animated Ogre mesh.
+    """
+    # TODO:    Use observer pattern for progress bar.
+    # TODO: Get bone ids from skeletonExporter class.
+    def __init__(self, armatureObject):
+        """Constructor.
+
+           @param armatureObject armature object to export.
+        """
+        # call base class constructor
+        ObjectExporter.__init__(self, armatureObject)
+        self.skeleton = None
+        return
+
+    def export(self, materialsDict, actionActuatorList, exportOptions, logger):
+        """Exports the mesh object.
+
+           @param materialsDict dictionary that contains already existing materials.
+           @param actionActuatorList list of animations to export.
+           @param exportOptions global export options.
+           @param logger Logger for log messages.
+           @return materialsDict with the new materials added.
+        """
+        # export skeleton
+        armatureExporter = ArmatureExporter(self, self.object)
+        armatureExporter.export(actionActuatorList, exportOptions, logger)
+        self.skeleton = armatureExporter.skeleton
+        self._convertToMesh(materialsDict, exportOptions, logger)
+        return materialsDict
+    def getName(self):
+        return self.object.getData().name
+
+    def _convertToMesh(self, materialsDict, exportOptions, logger):
+        """Creates meshes in form of the armature bones.
+        """
+        obj = self.object
+        stack = []
+        # list of bone data (boneName, startPosition, endPosition)
+        boneMeshList = []
+        matrix = None
+        if exportOptions.useWorldCoordinates:
+            # world coordinates
+            matrix = obj.getMatrix("worldspace")
+        else:
+            # local mesh coordinates
+            armatureMatrix = obj.getMatrix("worldspace")
+            matrix_one = Mathutils.Matrix([1.0, 0, 0, 0], [0, 1, 0, 0], [0, 0, 1, 0], [0, 0, 0, 1])
+            # note that blender returns direct access to the objects matrix but we only want
+            # a copy so force a copy
+            inverseMeshMatrix = matrix_one * self.getObjectMatrix()
+            inverseMeshMatrix.invert()
+            matrix = armatureMatrix * inverseMeshMatrix
+        # apply additional export transformation
+        matrix = matrix*exportOptions.transformationMatrix()
+        loc = [ 0.0, 0, 0 ]
+        parent = None
+
+        # get parent bones
+        boneDict = obj.getData().bones
+        for bbone in boneDict.values():
+            if bbone.parent == None:
+                stack.append([bbone, parent, matrix, loc, 0])
+
+        while len(stack):
+            bbone, parent, accu_mat, parent_pos, parent_ds = stack.pop()
+            # preconditions: (R : rotation, T : translation, S : scale, M: general transformation matrix)
+            #   accu_mat
+            #     points to the tail of the parents bone, i.e. for root bones
+            #     accu_mat = M_{object}*R_{additional on export}
+            #     and for child bones
+            #     accu_mat = T_{length of parent}*R_{parent}*T_{to head of parent}*M_{parent's parent}
+            #  invertedOgreTransformation
+            #    inverse of transformation done in Ogre so far, i.e. identity for root bones,
+            #    M^{-1}_{Ogre, parent's parent}*T^{-1}_{Ogre, parent}*R^{-1}_{Ogre, parent} for child bones.
+
+            head = bbone.head['BONESPACE']
+            tail = bbone.tail['BONESPACE']
+
+            # get the restmat
+            R_bmat = bbone.matrix['BONESPACE'].rotationPart()
+            rotQuat = R_bmat.toQuat()
+            R_bmat.resize4x4()
+
+            # get the bone's root offset (in the parent's coordinate system)
+            T_root = [ [       1,       0,       0,      0 ],
+            [       0,       1,       0,      0 ],
+            [       0,       0,       1,      0 ],
+            [ head[0], head[1], head[2],      1 ] ]
+
+            # get the bone length translation (length along y axis)
+            dx, dy, dz = tail[0] - head[0], tail[1] - head[1], tail[2] - head[2]
+            ds = math.sqrt(dx*dx + dy*dy + dz*dz)
+            T_len = [ [ 1,  0,  0,  0 ],
+                [ 0,  1,  0,  0 ],
+                [ 0,  0,  1,  0 ],
+                [ 0, ds,  0,  1 ] ]
+
+            # calculate bone points in world coordinates
+            accu_mat = matrix_multiply(accu_mat, T_root)
+            pos = point_by_matrix([ 0, 0, 0 ], accu_mat)
+
+            accu_mat = tmp_mat = matrix_multiply(accu_mat, R_bmat)
+            # tmp_mat = R_{bone}*T_{to head}*M_{parent}
+            accu_mat = matrix_multiply(accu_mat, T_len)
+            pos2 = point_by_matrix([ 0, 0, 0 ], accu_mat)
+            boneMeshList.append([bbone.name, pos, pos2])
+            if bbone.children is not None:
+                for child in bbone.children:
+                    # make sure child bone is attached to current parent
+                    if child.parent is not None:
+                        if child.parent.name == bbone.name:
+                            stack.append([child, parent, accu_mat, pos, ds])
+
+        self._createMeshFromBoneList(materialsDict, boneMeshList)
+        return
+
+    def _makeFace(self, submesh, name, p1, p2, p3):
+        normal = vector_normalize(vector_crossproduct(
+                [ p3[0] - p2[0], p3[1] - p2[1], p3[2] - p2[2] ],
+                [ p1[0] - p2[0], p1[1] - p2[1], p1[2] - p2[2] ]))
+        v1 = Vertex(submesh, XMLVertex(p1, normal))
+        v2 = Vertex(submesh, XMLVertex(p2, normal))
+        v3 = Vertex(submesh, XMLVertex(p3, normal))
+
+        id = self.skeleton.bonesDict[name]
+        v1.influences.append(Influence(id, 1.0))
+        v2.influences.append(Influence(id, 1.0))
+        v3.influences.append(Influence(id, 1.0))
+
+        Face(submesh, v1, v2, v3)
+        return
+
+    def _createMeshFromBoneList(self, materialsDict, boneMeshList):
+        matName = "SkeletonMaterial"
+        material = materialsDict.get(matName)
+        if not material:
+            material = DefaultMaterial(matName)
+            materialsDict[matName] = material
+
+        submesh = SubMesh(material)
+        for name, p1, p2 in boneMeshList:
+            axis = blender_bone2matrix(p1, p2, 0)
+            axis = matrix_translate(axis, p1)
+            dx, dy, dz = p1[0] - p2[0], p1[1] - p2[1], p1[2] - p2[2]
+            ds = math.sqrt(dx*dx + dy*dy + dz*dz)
+            d = 0.1 + 0.2 * (ds / 10.0)
+            c1 = point_by_matrix([-d, 0,-d], axis)
+            c2 = point_by_matrix([-d, 0, d], axis)
+            c3 = point_by_matrix([ d, 0, d], axis)
+            c4 = point_by_matrix([ d, 0,-d], axis)
+
+            self._makeFace(submesh, name, p2, c1, c2)
+            self._makeFace(submesh, name, p2, c2, c3)
+            self._makeFace(submesh, name, p2, c3, c4)
+            self._makeFace(submesh, name, p2, c4, c1)
+            self._makeFace(submesh, name, c3, c2, c1)
+            self._makeFace(submesh, name, c1, c4, c3)
+        mesh = Mesh([submesh], self.skeleton)
+        mesh.name = self.getName()
+        mesh.write()
+        return
+
+######
+# global variables
+######
+selectedObjectsList = Blender.Object.GetSelected()
+#selectedObjectsMenu = Draw.Create(0)
+#scrollbar = ReplacementScrollbar(0,0,0,0,0)
+# key: objectName, value: armatureName
+armatureDict = {}
+# key: armatureName, value: armatureActionActuatorListView
+# does only contain keys for the current selected objects
+armatureActionActuatorListViewDict = {}
+# key: armatureName, value: animationDictList
+armatureAnimationDictListDict = {}
+MAXACTUATORS = 100
+
+exportLogger = Logger()
+
+#######################################################################################
+## math functions
+
+def matrix_translate(m, v):
+  m[3][0] += v[0]
+  m[3][1] += v[1]
+  m[3][2] += v[2]
+  return m
+
+def matrix_multiply(b, a):
+  """ matrix_multiply(b, a) = a*b
+  """
+  return [ [
+    a[0][0] * b[0][0] + a[0][1] * b[1][0] + a[0][2] * b[2][0],
+    a[0][0] * b[0][1] + a[0][1] * b[1][1] + a[0][2] * b[2][1],
+    a[0][0] * b[0][2] + a[0][1] * b[1][2] + a[0][2] * b[2][2],
+    0.0,
+    ], [
+    a[1][0] * b[0][0] + a[1][1] * b[1][0] + a[1][2] * b[2][0],
+    a[1][0] * b[0][1] + a[1][1] * b[1][1] + a[1][2] * b[2][1],
+    a[1][0] * b[0][2] + a[1][1] * b[1][2] + a[1][2] * b[2][2],
+    0.0,
+    ], [
+    a[2][0] * b[0][0] + a[2][1] * b[1][0] + a[2][2] * b[2][0],
+    a[2][0] * b[0][1] + a[2][1] * b[1][1] + a[2][2] * b[2][1],
+    a[2][0] * b[0][2] + a[2][1] * b[1][2] + a[2][2] * b[2][2],
+     0.0,
+    ], [
+    a[3][0] * b[0][0] + a[3][1] * b[1][0] + a[3][2] * b[2][0] + b[3][0],
+    a[3][0] * b[0][1] + a[3][1] * b[1][1] + a[3][2] * b[2][1] + b[3][1],
+    a[3][0] * b[0][2] + a[3][1] * b[1][2] + a[3][2] * b[2][2] + b[3][2],
+    1.0,
+    ] ]
+
+def matrix_invert(m):
+  det = (m[0][0] * (m[1][1] * m[2][2] - m[2][1] * m[1][2])
+       - m[1][0] * (m[0][1] * m[2][2] - m[2][1] * m[0][2])
+       + m[2][0] * (m[0][1] * m[1][2] - m[1][1] * m[0][2]))
+  if det == 0.0: return None
+  det = 1.0 / det
+  r = [ [
+      det * (m[1][1] * m[2][2] - m[2][1] * m[1][2]),
+    - det * (m[0][1] * m[2][2] - m[2][1] * m[0][2]),
+      det * (m[0][1] * m[1][2] - m[1][1] * m[0][2]),
+      0.0,
+    ], [
+    - det * (m[1][0] * m[2][2] - m[2][0] * m[1][2]),
+      det * (m[0][0] * m[2][2] - m[2][0] * m[0][2]),
+    - det * (m[0][0] * m[1][2] - m[1][0] * m[0][2]),
+      0.0
+    ], [
+      det * (m[1][0] * m[2][1] - m[2][0] * m[1][1]),
+    - det * (m[0][0] * m[2][1] - m[2][0] * m[0][1]),
+      det * (m[0][0] * m[1][1] - m[1][0] * m[0][1]),
+      0.0,
+    ] ]
+  r.append([
+    -(m[3][0] * r[0][0] + m[3][1] * r[1][0] + m[3][2] * r[2][0]),
+    -(m[3][0] * r[0][1] + m[3][1] * r[1][1] + m[3][2] * r[2][1]),
+    -(m[3][0] * r[0][2] + m[3][1] * r[1][2] + m[3][2] * r[2][2]),
+    1.0,
+    ])
+  return r
+
+def matrix_transpose(m):
+  return [ [ m[0][0], m[1][0], m[2][0], m[3][0] ],
+           [ m[0][1], m[1][1], m[2][1], m[3][1] ],
+           [ m[0][2], m[1][2], m[2][2], m[3][2] ],
+           [ m[0][3], m[1][3], m[2][3], m[3][3] ] ]
+
+def matrix_rotate(axis, angle):
+  vx  = axis[0]
+  vy  = axis[1]
+  vz  = axis[2]
+  vx2 = vx * vx
+  vy2 = vy * vy
+  vz2 = vz * vz
+  cos = math.cos(angle)
+  sin = math.sin(angle)
+  co1 = 1.0 - cos
+  return [
+    [vx2 * co1 + cos,          vx * vy * co1 + vz * sin, vz * vx * co1 - vy * sin, 0.0],
+    [vx * vy * co1 - vz * sin, vy2 * co1 + cos,          vy * vz * co1 + vx * sin, 0.0],
+    [vz * vx * co1 + vy * sin, vy * vz * co1 - vx * sin, vz2 * co1 + cos,          0.0],
+    [0.0, 0.0, 0.0, 1.0],
+    ]
+
+def point_by_matrix(p, m):
+  return [p[0] * m[0][0] + p[1] * m[1][0] + p[2] * m[2][0] + m[3][0],
+          p[0] * m[0][1] + p[1] * m[1][1] + p[2] * m[2][1] + m[3][1],
+          p[0] * m[0][2] + p[1] * m[1][2] + p[2] * m[2][2] + m[3][2]]
+
+def vector_by_matrix(p, m):
+  return [p[0] * m[0][0] + p[1] * m[1][0] + p[2] * m[2][0],
+          p[0] * m[0][1] + p[1] * m[1][1] + p[2] * m[2][1],
+          p[0] * m[0][2] + p[1] * m[1][2] + p[2] * m[2][2]]
+
+def vector_normalize(v):
+  global exportLogger
+  l = math.sqrt(v[0] * v[0] + v[1] * v[1] + v[2] * v[2])
+  if l <= 0.000001:
+    exportLogger.logError("error in normalize")
+    return [0 , l, 0]
+  return [v[0] / l, v[1] / l, v[2] / l]
+
+def normal_by_matrix(n, m):
+  m = matrix_transpose(matrix_invert(m))
+  return vector_normalize(vector_by_matrix(n, m))
+
+
+def vector_dotproduct(v1, v2):
+  return v1[0] * v2[0] + v1[1] * v2[1] + v1[2] * v2[2]
+
+def vector_crossproduct(v1, v2):
+  return [
+    v1[1] * v2[2] - v1[2] * v2[1],
+    v1[2] * v2[0] - v1[0] * v2[2],
+    v1[0] * v2[1] - v1[1] * v2[0],
+    ]
+
+#######################################################################################
+## data structures
+
+class MaterialInterface:
+    def getName(self):
+        """Returns the material name.
+
+           @return Material name.
+        """
+        return
+    def write(self, f):
+        """Write material script entry.
+
+           @param f Material script file object to write into.
+        """
+        return
+
+class DefaultMaterial(MaterialInterface):
+    def __init__(self, name):
+        self.name = name
+        return
+    def getName(self):
+        return self.name
+    def write(self, f):
+        f.write("material %s\n" % self.getName())
+        f.write("{\n")
+        self.writeTechniques(f)
+        f.write("}\n")
+        return
+    def writeTechniques(self, f):
+        f.write(tab(1) + "technique\n" + tab(1) + "{\n")
+        f.write(tab(2) + "pass\n" + tab(2) + "{\n")
+        # empty pass
+        f.write(tab(2) + "}\n") # pass
+        f.write(tab(1) + "}\n") # technique
+        return
+
+class GameEngineMaterial(DefaultMaterial):
+    def __init__(self, blenderMesh, blenderFace):
+        self.mesh = blenderMesh
+        self.face = blenderFace
+        # check if a Blender material is assigned
+        try:
+            blenderMaterial = self.mesh.materials[self.face.mat]
+        except:
+            blenderMaterial = None
+        self.material = blenderMaterial
+        DefaultMaterial.__init__(self, self._createName())
+        return
+    def writeTechniques(self, f):
+        global exportOptions
+        mat = self.material
+        if (not(mat)
+            and not(self.mesh.vertexColors)
+            and not(self.mesh.vertexUV or self.mesh.faceUV)):
+            # default material
+            DefaultMaterial.writeTechniques(self, f)
+        else:
+            # default material
+            # SOLID, white, no specular
+            f.write(tab(1)+"technique\n")
+            f.write(tab(1)+"{\n")
+            f.write(tab(2)+"pass\n")
+            f.write(tab(2)+"{\n")
+            # ambient
+            # (not used in Blender's game engine)
+            if mat:
+                if (not(mat.mode & Blender.Material.Modes["TEXFACE"])
+                    and not(mat.mode & Blender.Material.Modes["VCOL_PAINT"])
+                    and (exportOptions.colouredAmbient)):
+                    ambientRGBList = mat.rgbCol
+                else:
+                    ambientRGBList = [1.0, 1.0, 1.0]
+                # ambient <- amb * ambient RGB
+                ambR = clamp(mat.amb * ambientRGBList[0])
+                ambG = clamp(mat.amb * ambientRGBList[1])
+                ambB = clamp(mat.amb * ambientRGBList[2])
+                ##f.write(tab(3)+"ambient %f %f %f\n" % (ambR, ambG, ambB))
+            # diffuse
+            # (Blender's game engine uses vertex colours
+            #  instead of diffuse colour.
+            #
+            #  diffuse is defined as
+            #  (mat->r, mat->g, mat->b)*(mat->emit + mat->ref)
+            #  but it's not used.)
+            if self.mesh.vertexColors:
+                #TODO: Broken in Blender 2.36.
+                # Blender does not handle "texface" mesh with vertexcolours
+                f.write(tab(3)+"diffuse vertexcolour\n")
+            elif mat:
+                if (not(mat.mode & Blender.Material.Modes["TEXFACE"])
+                    and not(mat.mode & Blender.Material.Modes["VCOL_PAINT"])):
+                    # diffuse <- rgbCol
+                    diffR = clamp(mat.rgbCol[0])
+                    diffG = clamp(mat.rgbCol[1])
+                    diffB = clamp(mat.rgbCol[2])
+                    f.write(tab(3)+"diffuse %f %f %f\n" % (diffR, diffG, diffB))
+                elif (mat.mode & Blender.Material.Modes["VCOL_PAINT"]):
+                    f.write(tab(3)+"diffuse vertexcolour\n")
+            if mat:
+                # specular <- spec * specCol, hard/4.0
+                specR = clamp(mat.spec * mat.specCol[0])
+                specG = clamp(mat.spec * mat.specCol[1])
+                specB = clamp(mat.spec * mat.specCol[2])
+                specShine = mat.hard/4.0
+                f.write(tab(3)+"specular %f %f %f %f\n" % (specR, specG, specB, specShine))
+                # emissive
+                # (not used in Blender's game engine)
+                if(not(mat.mode & Blender.Material.Modes["TEXFACE"])
+                    and not(mat.mode & Blender.Material.Modes["VCOL_PAINT"])):
+                    # emissive <-emit * rgbCol
+                    emR = clamp(mat.emit * mat.rgbCol[0])
+                    emG = clamp(mat.emit * mat.rgbCol[1])
+                    emB = clamp(mat.emit * mat.rgbCol[2])
+                    ##f.write(tab(3)+"emissive %f %f %f\n" % (emR, emG, emB))
+            # scene_blend <- transp
+            if (self.face.mode == Blender.NMesh.FaceTranspModes["ALPHA"]):
+                f.write(tab(3)+"scene_blend alpha_blend \n")
+            elif (self.face.mode == Blender.NMesh.FaceTranspModes["ADD"]):
+                #TODO: Broken in Blender 2.36.
+                #f.write(tab(3)+"scene_blend add\n")
+                pass
+            # cull_hardware/cull_software
+            if (self.face.mode & Blender.NMesh.FaceModes['TWOSIDE']):
+                f.write(tab(3) + "cull_hardware none\n")
+                f.write(tab(3) + "cull_software none\n")
+            # shading
+            # (Blender's game engine is initialized with glShadeModel(GL_FLAT))
+            ##f.write(tab(3) + "shading flat\n")
+            # texture
+            if (self.face.mode & Blender.NMesh.FaceModes['TEX']) and (self.face.image):
+                f.write(tab(3)+"texture_unit\n")
+                f.write(tab(3)+"{\n")
+                f.write(tab(4)+"texture %s\n" % PathName(self.face.image.filename).basename())
+                f.write(tab(3)+"}\n") # texture_unit
+            f.write(tab(2)+"}\n") # pass
+            f.write(tab(1)+"}\n") # technique
+        return
+    # private
+    def _createName(self):
+        """Create unique material name.
+
+           The name consists of several parts:
+           <OL>
+           <LI>rendering material name/</LI>
+           <LI>blend mode (ALPHA, ADD, SOLID)</LI>
+           <LI>/TEX</LI>
+           <LI>/texture file name</LI>
+           <LI>/VertCol</LI>
+           <LI>/TWOSIDE></LI>
+           </OL>
+        """
+        materialName = ''
+        # nonempty rendering material?
+        if self.material:
+            materialName += self.material.getName() + '/'
+        # blend mode
+        if (self.face.transp == Blender.NMesh.FaceTranspModes['ALPHA']):
+            materialName += 'ALPHA'
+        elif (self.face.transp == Blender.NMesh.FaceTranspModes['ADD']):
+            materialName += 'ADD'
+        else:
+            materialName += 'SOLID'
+        # TEX face mode and texture?
+        if (self.face.mode & Blender.NMesh.FaceModes['TEX']):
+            materialName += '/TEX'
+            if self.face.image:
+                materialName += '/' + PathName(self.face.image.filename).basename()
+        # vertex colours?
+        if self.mesh.vertexColors:
+            materialName += '/VertCol'
+        # two sided?
+        if (self.face.mode & Blender.NMesh.FaceModes['TWOSIDE']):
+            materialName += '/TWOSIDE'
+        return materialName
+
+class RenderingMaterial(DefaultMaterial):
+    def __init__(self, blenderMesh, blenderFace):
+        self.mesh = blenderMesh
+        self.face = blenderFace
+        self.key = 0
+        self.mTexUVCol = None
+        self.mTexUVNor = None
+        self.mTexUVCsp = None
+        self.material = self.mesh.materials[self.face.mat]
+        if self.material:
+            self._generateKey()
+            DefaultMaterial.__init__(self, self._createName())
+        else:
+            DefaultMaterial.__init__(self, 'None')
+        return
+    def writeTechniques(self, f):
+        # parse material
+        if self.key:
+            if self.TECHNIQUES.has_key(self.key):
+                techniques = self.TECHNIQUES[self.key]
+                techniques(self, f)
+            else:
+                # default
+                self.writeColours(f)
+        else:
+            # Halo or empty material
+            DefaultMaterial('').writeTechniques(f)
+        return
+    def writeColours(self, f):
+        global exportOptions
+        # receive_shadows
+        self.writeReceiveShadows(f, 1)
+        f.write(tab(1) + "technique\n" + tab(1) + "{\n")
+        f.write(tab(2) + "pass\n" + tab(2) + "{\n")
+        # ambient
+        if (exportOptions.colouredAmbient):
+            col = self.material.getRGBCol()
+        else:
+            col = [1.0, 1.0, 1.0]
+        self.writeAmbient(f, col, 3)
+        # diffuse
+        self.writeDiffuse(f, self.material.rgbCol, 3)
+        # specular
+        self.writeSpecular(f, 3)
+        # emissive
+        self.writeEmissive(f, self.material.rgbCol, 3)
+        # blend mode
+        self.writeSceneBlend(f,3)
+        # options
+        self.writeCommonOptions(f, 3)
+        # texture units
+        self.writeDiffuseTexture(f, 3)
+        f.write(tab(2) + "}\n") # pass
+        f.write(tab(1) + "}\n") # technique
+        return
+    def writeTexFace(self, f):
+        # preconditions: TEXFACE set
+        #
+        # Note that an additional Col texture replaces the
+        # TEXFACE texture instead of blend over according to alpha.
+        #
+        # (amb+emit)textureCol + diffuseLight*ref*textureCol + specular
+        #
+        imageFileName = None
+        if self.mTexUVCol:
+            # COL MTex replaces UV/Image Editor texture
+            imageFileName = PathName(self.mTexUVCol.tex.getImage().getFilename()).basename()
+        elif self.face.image:
+            # UV/Image Editor texture
+            imageFileName = PathName(self.face.image.filename).basename()
+
+        self.writeReceiveShadows(f, 1)
+        f.write(tab(1) + "technique\n" + tab(1) + "{\n")
+        col = [1.0, 1.0, 1.0]
+        # texture pass
+        f.write(tab(2) + "pass\n" + tab(2) + "{\n")
+        self.writeAmbient(f, col, 3)
+        self.writeDiffuse(f, col, 3)
+        if not(imageFileName):
+            self.writeSpecular(f, 3)
+        self.writeEmissive(f, col, 3)
+        self.writeSceneBlend(f,3)
+        self.writeCommonOptions(f, 3)
+        if imageFileName:
+            f.write(tab(3) + "texture_unit\n")
+            f.write(tab(3) + "{\n")
+            f.write(tab(4) + "texture %s\n" % imageFileName)
+            if self.mTexUVCol:
+                self.writeTextureAddressMode(f, self.mTexUVCol, 4)
+                self.writeTextureFiltering(f, self.mTexUVCol, 4)
+            # multiply with factors
+            f.write(tab(4) + "colour_op modulate\n")
+            f.write(tab(3) + "}\n") # texture_unit
+            f.write(tab(2) + "}\n") # texture pass
+            # specular pass
+            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
+            f.write(tab(3) + "ambient 0.0 0.0 0.0\n")
+            f.write(tab(3) + "diffuse 0.0 0.0 0.0\n")
+            self.writeSpecular(f, 3)
+            f.write(tab(3) + "scene_blend add\n")
+            hasAlpha = 0
+            if (self.material.getAlpha() < 1.0):
+                hasAlpha = 1
+            else:
+                for mtex in self.material.getTextures():
+                    if mtex:
+                        if ((mtex.tex.type == Blender.Texture.Types['IMAGE'])
+                            and (mtex.mapto & Blender.Texture.MapTo['ALPHA'])):
+                            hasAlpha = 1
+            if (hasAlpha):
+                f.write(tab(3) + "depth_write off\n")
+            self.writeCommonOptions(f, 3)
+        f.write(tab(2) + "}\n") # pass
+        f.write(tab(1) + "}\n") # technique
+        return
+    def writeVertexColours(self, f):
+        # preconditions: VCOL_PAINT set
+        #
+        # ambient = Amb*White resp. Amb*VCol if "Coloured Ambient"
+        # diffuse = Ref*VCol
+        # specular = Spec*SpeRGB, Hard/4.0
+        # emissive = Emit*VCol
+        # alpha = A
+        #
+        # Best match without vertex shader:
+        # ambient = Amb*white
+        # diffuse = Ref*VCol
+        # specular = Spec*SpeRGB, Hard/4.0
+        # emissive = black
+        # alpha = 1
+        #
+        self.writeReceiveShadows(f, 1)
+        f.write(tab(1) + "technique\n" + tab(1) + "{\n")
+        if (self.material.mode & Blender.Material.Modes['SHADELESS']):
+            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
+            self.writeCommonOptions(f,3)
+            f.write(tab(2) + "}\n")
+        else:
+            # vertex colour pass
+            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
+            f.write(tab(3) + "ambient 0.0 0.0 0.0\n")
+            f.write(tab(3) + "diffuse vertexcolour\n")
+            self.writeCommonOptions(f, 3)
+            f.write(tab(2) + "}\n") # vertex colour pass
+
+            # factor pass
+            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
+            f.write(tab(3) + "ambient 0.0 0.0 0.0\n")
+            ref = self.material.getRef()
+            f.write(tab(3) + "diffuse %f %f %f\n" % (ref, ref, ref))
+            f.write(tab(3) + "scene_blend modulate\n")
+            self.writeCommonOptions(f, 3)
+            f.write(tab(2) + "}\n") # factor pass
+
+            # ambient and specular pass
+            f.write(tab(2) + "pass\n" + tab(2) + "{\n")
+            self.writeAmbient(f, [1.0, 1.0, 1.0], 3)
+            f.write(tab(3) + "diffuse 0.0 0.0 0.0\n")
+            self.writeSpecular(f, 3)
+            f.write(tab(3) + "scene_blend add\n")
+            self.writeCommonOptions(f, 3)
+            f.write(tab(2) + "}\n") # specular pass
+
+        f.write(tab(1) + "}\n") # technique
+        return
+    def writeNormalMap(self, f):
+        # preconditions COL and NOR textures
+        colImage = PathName(self.mTexUVCol.tex.image.filename).basename()
+        norImage = PathName(self.mTexUVNor.tex.image.filename).basename()
+        f.write("""    technique
+        {
+            pass
+            {
+                ambient 1 1 1
+                diffuse 0 0 0
+                specular 0 0 0 0
+                vertex_program_ref Ogre/BasicVertexPrograms/AmbientOneTexture
+                {
+                    param_named_auto worldViewProj worldviewproj_matrix
+                    param_named_auto ambient ambient_light_colour
+                }
+            }
+            pass
+            {
+                ambient 0 0 0
+                iteration once_per_light
+                scene_blend add
+                vertex_program_ref Examples/BumpMapVPSpecular
+                {
+                    param_named_auto lightPosition light_position_object_space 0
+                    param_named_auto eyePosition camera_position_object_space
+                    param_named_auto worldViewProj worldviewproj_matrix
+                }
+                fragment_program_ref Examples/BumpMapFPSpecular
+                {
+                    param_named_auto lightDiffuse light_diffuse_colour 0
+                    param_named_auto lightSpecular light_specular_colour 0
+                }
+                texture_unit
+                {
+                    texture %s
+                    colour_op replace
+                }
+                texture_unit
+                {
+                    cubic_texture nm.png combinedUVW
+                    tex_coord_set 1
+                    tex_address_mode clamp
+                }
+                texture_unit
+                {
+                    cubic_texture nm.png combinedUVW
+                    tex_coord_set 2
+                    tex_address_mode clamp
+                }
+            }
+            pass
+            {
+                lighting off
+                vertex_program_ref Ogre/BasicVertexPrograms/AmbientOneTexture
+                {
+                    param_named_auto worldViewProj worldviewproj_matrix
+                    param_named ambient float4 1 1 1 1
+                }
+                scene_blend dest_colour zero
+                texture_unit
+                {
+                    texture %s
+                }
+            }
+        }
+        technique
+        {
+            pass
+            {
+                ambient 1 1 1
+                diffuse 0 0 0
+                specular 0 0 0 0
+                vertex_program_ref Ogre/BasicVertexPrograms/AmbientOneTexture
+                {
+                    param_named_auto worldViewProj worldviewproj_matrix
+                    param_named_auto ambient ambient_light_colour
+                }
+            }
+            pass
+            {
+                ambient 0 0 0
+                iteration once_per_light
+                scene_blend add
+                vertex_program_ref Examples/BumpMapVP
+                {
+                    param_named_auto lightPosition light_position_object_space 0
+                    param_named_auto eyePosition camera_position_object_space
+                    param_named_auto worldViewProj worldviewproj_matrix
+                }
+                texture_unit
+                {
+                    texture %s
+                    colour_op replace
+                }
+                texture_unit
+                {
+                    cubic_texture nm.png combinedUVW
+                    tex_coord_set 1
+                    tex_address_mode clamp
+                    colour_op_ex dotproduct src_texture src_current
+                    colour_op_multipass_fallback dest_colour zero
+                }
+            }
+            pass
+            {
+                lighting off
+                vertex_program_ref Ogre/BasicVertexPrograms/AmbientOneTexture
+                {
+                    param_named_auto worldViewProj worldviewproj_matrix
+                    param_named ambient float4 1 1 1 1
+                }
+                scene_blend dest_colour zero
+                texture_unit
+                {
+                    texture %s
+                }
+            }
+        }
+    """ % (norImage, colImage, norImage, colImage))
+        return
+    def writeReceiveShadows(self, f, indent=0):
+        if (self.material.mode & Blender.Material.Modes["SHADOW"]):
+            f.write(tab(indent)+"receive_shadows on\n")
+        else:
+            f.write(tab(indent)+"receive_shadows off\n")
+        return
+    def writeAmbient(self, f, col, indent=0):
+        # ambient <- amb * ambient RGB
+        ambR = clamp(self.material.getAmb() * col[0])
+        ambG = clamp(self.material.getAmb() * col[1])
+        ambB = clamp(self.material.getAmb() * col[2])
+        if len(col) < 4:
+            alpha = self.material.getAlpha()
+        else:
+            alpha = col[3]
+        f.write(tab(indent)+"ambient %f %f %f %f\n" % (ambR, ambG, ambB, alpha))
+        return
+    def writeDiffuse(self, f, col, indent=0):
+        # diffuse = reflectivity*colour
+        diffR = clamp(col[0] * self.material.getRef())
+        diffG = clamp(col[1] * self.material.getRef())
+        diffB = clamp(col[2] * self.material.getRef())
+        if len(col) < 4:
+            alpha = self.material.getAlpha()
+        else:
+            alpha = col[3]
+        f.write(tab(indent)+"diffuse %f %f %f %f\n" % (diffR, diffG, diffB, alpha))
+        return
+    def writeSpecular(self, f, indent=0):
+        # specular <- spec * specCol, hard/4.0
+        specR = clamp(self.material.getSpec() * self.material.getSpecCol()[0])
+        specG = clamp(self.material.getSpec() * self.material.getSpecCol()[1])
+        specB = clamp(self.material.getSpec() * self.material.getSpecCol()[2])
+        specShine = self.material.getHardness()/4.0
+        alpha = self.material.getAlpha()
+        f.write(tab(indent)+"specular %f %f %f %f %f\n" % (specR, specG, specB, alpha, specShine))
+        return
+    def writeEmissive(self, f, col, indent=0):
+        # emissive <-emit * rgbCol
+        emR = clamp(self.material.getEmit() * col[0])
+        emG = clamp(self.material.getEmit() * col[1])
+        emB = clamp(self.material.getEmit() * col[2])
+        if len(col) < 4:
+            alpha = self.material.getAlpha()
+        else:
+            alpha = col[3]
+        f.write(tab(indent)+"emissive %f %f %f %f\n" % (emR, emG, emB, alpha))
+        return
+    def writeSceneBlend(self, f, indent=0):
+        hasAlpha = 0
+        if (self.material.getAlpha() < 1.0):
+            hasAlpha = 1
+        else:
+            for mtex in self.material.getTextures():
+                if mtex:
+                    if ((mtex.tex.type == Blender.Texture.Types['IMAGE'])
+                        and (mtex.mapto & Blender.Texture.MapTo['ALPHA'])):
+                        hasAlpha = 1
+        if (hasAlpha):
+            f.write(tab(indent) + "scene_blend alpha_blend\n")
+            f.write(tab(indent) + "depth_write off\n")
+        return
+    def writeCommonOptions(self, f, indent=0):
+        # Shadeless, ZInvert, NoMist, Env
+        # depth_func  <- ZINVERT; ENV
+        if (self.material.mode & Blender.Material.Modes['ENV']):
+            f.write(tab(indent)+"depth_func always_fail\n")
+        elif (self.material.mode & Blender.Material.Modes['ZINVERT']):
+            f.write(tab(indent)+"depth_func greater_equal\n")
+        # twoside
+        # 2.4 raises an exception if face.mode is accessed and mesh has no uv
+        try:
+            if (self.face.mode & Blender.NMesh.FaceModes['TWOSIDE']):
+                f.write(tab(3) + "cull_hardware none\n")
+                f.write(tab(3) + "cull_software none\n")
+        except:
+            pass
+        # lighting <- SHADELESS
+        if (self.material.mode & Blender.Material.Modes['SHADELESS']):
+            f.write(tab(indent)+"lighting off\n")
+        # fog_override <- NOMIST
+        if (self.material.mode & Blender.Material.Modes['NOMIST']):
+            f.write(tab(indent)+"fog_override true\n")
+        return
+    def writeDiffuseTexture(self, f, indent = 0):
+        if self.mTexUVCol:
+            f.write(tab(indent)+"texture_unit\n")
+            f.write(tab(indent)+"{\n")
+            f.write(tab(indent + 1) + "texture %s\n" % PathName(self.mTexUVCol.tex.getImage().getFilename()).basename())
+            self.writeTextureAddressMode(f, self.mTexUVCol, indent + 1)
+            self.writeTextureFiltering(f, self.mTexUVCol, indent + 1)
+            self.writeTextureColourOp(f, self.mTexUVCol, indent + 1)
+            f.write(tab(indent)+"}\n") # texture_unit
+        return
+    def writeTextureAddressMode(self, f, blenderMTex, indent = 0):
+        # tex_address_mode inside texture_unit
+        #
+        # EXTEND   | clamp
+        # CLIP     |
+        # CLIPCUBE |
+        # REPEAT   | wrap
+        #
+        if (blenderMTex.tex.extend & Blender.Texture.ExtendModes['REPEAT']):
+            f.write(tab(indent) + "tex_address_mode wrap\n")
+        elif (blenderMTex.tex.extend & Blender.Texture.ExtendModes['EXTEND']):
+            f.write(tab(indent) + "tex_address_mode clamp\n")
+        return
+    def writeTextureFiltering(self, f, blenderMTex, indent = 0):
+        # filtering inside texture_unit
+        #
+        # InterPol | MidMap | filtering
+        # ---------+--------+----------
+        #    yes   |   yes  | trilinear
+        #    yes   |   no   | linear linear none
+        #    no    |   yes  | bilinear
+        #    no    |   no   | none
+        #
+        if (blenderMTex.tex.imageFlags & Blender.Texture.ImageFlags['INTERPOL']):
+            if (blenderMTex.tex.imageFlags & Blender.Texture.ImageFlags['MIPMAP']):
+                f.write(tab(indent) + "filtering trilinear\n")
+            else:
+                f.write(tab(indent) + "filtering linear linear none\n")
+        else:
+            if (blenderMTex.tex.imageFlags & Blender.Texture.ImageFlags['MIPMAP']):
+                f.write(tab(indent) + "filtering bilinear\n")
+            else:
+                f.write(tab(indent) + "filtering none\n")
+        return
+    def writeTextureColourOp(self, f, blenderMTex, indent = 0):
+        # colour_op inside texture_unit
+        if ((blenderMTex.tex.imageFlags & Blender.Texture.ImageFlags['USEALPHA'])
+            and not(blenderMTex.mapto & Blender.Texture.MapTo['ALPHA'])):
+            f.write(tab(indent) + "colour_op alpha_blend\n")
+        return
+    # private
+    def _createName(self):
+        # must be called after _generateKey()
+        materialName = self.material.getName()
+        # two sided?
+        try:
+            if (self.face.mode & Blender.Mesh.FaceModes['TWOSIDE']):
+                materialName += '/TWOSIDE'
+        except:
+            pass
+        # use UV/Image Editor texture?
+        if ((self.key & self.TEXFACE) and not(self.key & self.IMAGEUVCOL)):
+            materialName += '/TEXFACE'
+            if self.face.image:
+                materialName += '/' + PathName(self.face.image.filename).basename()
+        return materialName
+    def _generateKey(self):
+        # generates key and populates mTex fields
+        if self.material:
+            if not(self.material.mode & Blender.Material.Modes['HALO']):
+                self.key |= self.NONHALO
+                if (self.material.mode & Blender.Material.Modes['VCOL_LIGHT']):
+                    self.key |= self.VCOLLIGHT
+                if (self.material.mode & Blender.Material.Modes['VCOL_PAINT']):
+                    self.key |= self.VCOLPAINT
+                if (self.material.mode & Blender.Material.Modes['TEXFACE']):
+                    self.key |= self.TEXFACE
+                # textures
+                for mtex in self.material.getTextures():
+                    if mtex:
+                        if (mtex.tex.type == Blender.Texture.Types['IMAGE']):
+                            if (mtex.texco & Blender.Texture.TexCo['UV']):
+                                if (mtex.mapto & Blender.Texture.MapTo['COL']):
+                                    self.key |= self.IMAGEUVCOL
+                                    self.mTexUVCol = mtex
+                                if (mtex.mapto & Blender.Texture.MapTo['NOR']):
+                                    # Check "Normal Map" image option
+                                    if (mtex.tex.imageFlags & 2048):
+                                        self.key |= self.IMAGEUVNOR
+                                        self.mTexUVNor = mtex
+                                    # else bumpmap
+                                if (mtex.mapto & Blender.Texture.MapTo['CSP']):
+                                    self.key |= self.IMAGEUVCSP
+                                    self.mTexUVCsp = mtex
+        return
+    NONHALO = 1
+    VCOLLIGHT = 2
+    VCOLPAINT = 4
+    TEXFACE = 8
+    IMAGEUVCOL = 16
+    IMAGEUVNOR = 32
+    IMAGEUVCSP = 64
+    # material techniques export methods
+    TECHNIQUES = {
+        NONHALO|IMAGEUVCOL : writeColours,
+        NONHALO|IMAGEUVCOL|IMAGEUVCSP : writeColours,
+        NONHALO|TEXFACE : writeTexFace,
+        NONHALO|TEXFACE|VCOLLIGHT : writeTexFace,
+        NONHALO|TEXFACE|IMAGEUVCOL : writeTexFace,
+        NONHALO|TEXFACE|IMAGEUVNOR : writeTexFace,
+        NONHALO|TEXFACE|IMAGEUVCSP : writeTexFace,
+        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVCOL : writeTexFace,
+        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVNOR : writeTexFace,
+        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVCSP : writeTexFace,
+        NONHALO|TEXFACE|IMAGEUVCOL|IMAGEUVCSP : writeTexFace,
+        NONHALO|TEXFACE|IMAGEUVNOR|IMAGEUVCSP : writeTexFace,
+        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVCOL|IMAGEUVCSP : writeTexFace,
+        NONHALO|TEXFACE|VCOLLIGHT|IMAGEUVNOR|IMAGEUVCSP : writeTexFace,
+        NONHALO|VCOLPAINT : writeVertexColours,
+        NONHALO|VCOLPAINT|VCOLLIGHT : writeVertexColours,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLPAINT : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|TEXFACE : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|IMAGEUVCSP : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|VCOLPAINT : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|TEXFACE : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|IMAGEUVCSP : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLPAINT|TEXFACE : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLPAINT|IMAGEUVCSP : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|TEXFACE|IMAGEUVCSP : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLPAINT|TEXFACE|IMAGEUVCSP : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|TEXFACE|IMAGEUVCSP : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|VCOLPAINT|IMAGEUVCSP : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|VCOLPAINT|TEXFACE : writeNormalMap,
+        NONHALO|IMAGEUVCOL|IMAGEUVNOR|VCOLLIGHT|VCOLPAINT|TEXFACE|IMAGEUVCSP : writeNormalMap
+        }
+
+class Mesh:
+    def __init__(self, submeshList, skeleton=None, nmesh=None):
+        """Constructor.
+
+           @param submeshList Submeshes.
+           @param nmesh Blender NMesh.
+        """
+        self.name = ''
+        self.submeshList = submeshList
+        self.skeleton = skeleton
+        # boolean
+        self.vertexColours = 0
+        # boolean
+        self.uvCoordinates = 0
+        # parse nmesh
+        self._parseMesh(nmesh)
+        return
+    def hasVertexColours(self):
+        return self.vertexColours
+    def hasUVCoordinates(self):
+        return self.uvCoordinates
+    def write(self):
+    	global exportOptions
+        # write_mesh(name, submeshes, skeleton):
+        global exportLogger
+        file = self.name + ".mesh.xml"
+        exportLogger.logInfo("Mesh \"%s\"" % file)
+
+        f = open(os.path.join(full_path, file), "w")
+        f.write(tab(0)+"<mesh>\n")
+        f.write(tab(1)+"<submeshes>\n")
+        for submesh in self.submeshList:
+            f.write(tab(2)+"<submesh")
+            f.write(" material=\"%s\"" % submesh.material.name)
+            f.write(" usesharedvertices=\"false\"")
+            f.write(" use32bitindexes=\"false\"")
+            f.write(" operationtype=\"triangle_list\"")
+            f.write(">\n")
+
+            f.write(tab(3)+"<faces count=\"%d\">\n" % len(submesh.faces))
+            for face in submesh.faces:
+                v1, v2, v3  = face.vertex1.id, face.vertex2.id, face.vertex3.id
+                f.write(tab(4)+"<face v1=\"%d\" v2=\"%d\" v3=\"%d\"/>\n" % (v1, v2, v3))
+            f.write(tab(3)+"</faces>\n")
+
+            f.write(tab(3)+"<geometry vertexcount=\"%d\">\n" % len(submesh.vertices))
+            if (exportOptions.armatureExport):
+                # use seperate vertexbuffer for position and normals when animated
+                f.write(tab(4)+"<vertexbuffer positions=\"true\" normals=\"true\">\n")
+                for v in submesh.vertices:
+                    f.write(XMLVertexStringView(v.xmlVertex).toString(5, ['normal','position']))
+                f.write(tab(4)+"</vertexbuffer>\n")
+                if (self.hasUVCoordinates() and self.hasVertexColours()):
+                    f.write(tab(4)+"<vertexbuffer")
+                    f.write(" texture_coord_dimensions_0=\"2\" texture_coords=\"1\"")
+                    f.write(" colours_diffuse=\"true\">\n")
+                    for v in submesh.vertices:
+                            f.write(XMLVertexStringView(v.xmlVertex).toString(5, ['texcoordList','colourDiffuse']))
+                    f.write(tab(4)+"</vertexbuffer>\n")
+                elif self.hasUVCoordinates():
+                    f.write(tab(4)+"<vertexbuffer")
+                    f.write(" texture_coord_dimensions_0=\"2\" texture_coords=\"1\">\n")
+                    for v in submesh.vertices:
+                            f.write(XMLVertexStringView(v.xmlVertex).toString(5, ['texcoordList']))
+                    f.write(tab(4)+"</vertexbuffer>\n")
+                elif self.hasVertexColours():
+                    f.write(tab(4)+"<vertexbuffer")
+                    f.write(" colours_diffuse=\"true\">\n")
+                    for v in submesh.vertices:
+                            f.write(XMLVertexStringView(v.xmlVertex).toString(5, ['colourDiffuse']))
+                    f.write(tab(4)+"</vertexbuffer>\n")
+            else:
+                # use only one vertex buffer if mesh is not animated
+                f.write(tab(4)+"<vertexbuffer ")
+                f.write("positions=\"true\" ")
+                f.write("normals=\"true\"")
+                if self.hasUVCoordinates():
+                    f.write(" texture_coord_dimensions_0=\"2\" texture_coords=\"1\"")
+                if self.hasVertexColours():
+                    f.write(" colours_diffuse=\"true\"")
+                f.write(">\n")
+                for v in submesh.vertices:
+                    f.write(XMLVertexStringView(v.xmlVertex).toString(5))
+                f.write(tab(4)+"</vertexbuffer>\n")
+            f.write(tab(3)+"</geometry>\n")
+
+            if self.skeleton:
+                f.write(tab(3)+"<boneassignments>\n")
+                for v in submesh.vertices:
+                    for influence in v.influences:
+                        f.write(tab(4)+"<vertexboneassignment ")
+                        f.write("vertexindex=\"%d\" boneindex=\"%d\" weight=\"%.6f\"/>\n"
+                            % (v.id, influence.bone.id, influence.weight))
+                f.write(tab(3)+"</boneassignments>\n")
+            f.write(tab(2)+"</submesh>\n")
+        f.write(tab(1)+"</submeshes>\n")
+
+        if self.skeleton:
+            f.write(tab(1)+"<skeletonlink name=\"%s.skeleton\"/>\n" % self.skeleton.name)
+
+        f.write(tab(0)+"</mesh>\n")
+        f.close()
+        convertXMLFile(os.path.join(full_path, file))
+        binFile = self.name + ".mesh"
+        upgradeXMLFile(os.path.join(full_path, binFile))
+        return
+    # private
+    def _parseMesh(self, mesh):
+        if mesh:
+            self.name = mesh.name
+            if mesh.vertexColors:
+                self.vertexColors = 1
+            if (mesh.faceUV or mesh.vertexUV):
+                self.uvCoordinates = 1
+        return
+
+class SubMesh:
+  def __init__(self, material):
+    self.material   = material
+    self.vertices   = []
+    self.faces      = []
+
+  def rename_vertices(self, new_vertices):
+    # Rename (change ID) of all vertices, such as self.vertices == new_vertices.
+    for i in range(len(new_vertices)): new_vertices[i].id = i
+    self.vertices = new_vertices
+
+class XMLVertex:
+    """Vertex in Ogre.
+
+       @cvar threshold Floating point precicsion.
+    """
+    threshold = 1e-6
+    def __init__(self, position=None, normal=None, colourDiffuse=None, colourSpecular=None, texcoordList=None):
+        """Constructor.
+
+           @param position       list with x, y and z coordinate of the position
+           @param normal         list with x, y and z coordinate of the normal vector
+           @param colourDiffuse  list with RGBA floats
+           @param colourSpecular list with RGBA floats
+           @param texcoordList   list of list with u and v texture coordinates.
+        """
+        self.elementDict = {}
+        if position:
+            self.elementDict['position'] = position
+        if normal:
+            self.elementDict['normal'] = normal
+        if colourDiffuse:
+            self.elementDict['colourDiffuse'] = colourDiffuse
+        if colourSpecular:
+            self.elementDict['colourSpecular'] = colourSpecular
+        if texcoordList:
+            self.elementDict['texcoordList'] = texcoordList
+        return
+    def hasPosition(self):
+        return self.elementDict.has_key('position')
+    def hasNormal(self):
+        return self.elementDict.has_key('normal')
+    def hasVertexColour(self):
+        return self.elementDict.has_key('colourDiffuse') or self.elementDict.has_key('colourSpecular')
+    def hasDiffuseColour(self):
+        return self.elementDict.has_key('colourDiffuse')
+    def hasSpecularColour(self):
+        return self.elementDict.has_key('colourSpecular')
+    def nTextureCoordinates(self):
+        nTextureCoordinates = 0
+        if self.elementDict.has_key('texcoordList'):
+            nTextureCoordinates = len(self.elementDict['texcoordList'])
+        return nTextureCoordinates
+    def __getitem__(self, key):
+        return self.elementDict[key]
+    def __ne__(self, other):
+        """Tests if it differs from another Vertex.
+
+           @param other the XMLVertex to compare with
+           @return <code>true</code> if they differ, else <code>false</code>
+        """
+        return not self.__eq__(other)
+    def __eq__(self, other):
+        """Tests if it is equal to another Vertex.
+
+           @param other the XMLVertex to compare with
+           @return <code>true</code> if they are equal, else <code>false</code>
+        """
+        areEqual = 0
+        if (self.getElements() == other.getElements()):
+            compared = 0
+            itemIterator = self.elementDict.iteritems()
+            while (not compared):
+                try:
+                    (element, value) = itemIterator.next()
+                    if element == 'position' or element == 'normal':
+                        otherValue = other[element]
+                        if ((math.fabs(value[0] - otherValue[0]) > XMLVertex.threshold) or
+                            (math.fabs(value[1] - otherValue[1]) > XMLVertex.threshold) or
+                            (math.fabs(value[2] - otherValue[2]) > XMLVertex.threshold)):
+                            # test fails
+                            compared = 1
+                    elif element == 'colourDiffuse' or element == 'colourSpecular':
+                        otherValue = other[element]
+                        if ((math.fabs(value[0] - otherValue[0]) > XMLVertex.threshold) or
+                            (math.fabs(value[1] - otherValue[1]) > XMLVertex.threshold) or
+                            (math.fabs(value[2] - otherValue[2]) > XMLVertex.threshold) or
+                            (math.fabs(value[3] - otherValue[3]) > XMLVertex.threshold)):
+                            # test fails
+                            compared = 1
+                    elif element == 'texcoordList':
+                        otherValue = other[element]
+                        if len(value) == len(otherValue):
+                            for uv, otherUV in zip(value, otherValue):
+                                if ((math.fabs(uv[0] - otherUV[0]) > XMLVertex.threshold) or
+                                    (math.fabs(uv[1] - otherUV[1]) > XMLVertex.threshold)):
+                                    # test fails
+                                    compared = 1
+                        else:
+                            # test fails
+                            compared = 1
+                    else:
+                        # test fails, unknown element
+                        compared = 1
+                except StopIteration:
+                    # objects are equal
+                    areEqual = 1
+                    compared = 1
+        return areEqual
+    # getter and setter
+    def getElements(self):
+        return self.elementDict.keys()
+    def getPosition(self):
+        return self.elementDict['position']
+    def getNormal(self):
+        return self.elementDict['normal']
+    def getColourDiffuse(self):
+        return self.elementDict['colourDiffuse']
+    def getColourSpecular(self):
+        return self.elementDict['colourSpecular']
+    def getTextureCoordinatesList(self):
+        return self.elementDict['texcoordList']
+    def setPosition(self, position):
+        if position:
+            self.elementDict['position'] = position
+        else:
+            del self.elementDict['position']
+        return
+    def setNormal(self, normal):
+        if normal:
+            self.elementDict['normal'] = normal
+        else:
+            del self.elementDict['normal']
+        return
+    def setColourDiffuse(self, colourDiffuse):
+        if colourDiffuse:
+            self.elementDict['colourDiffuse'] = colourDiffuse
+        else:
+            del self.colourDiffuse
+        return
+    def setColourSpecular(self, colourSpecular):
+        if colourSpecular:
+            self.elementDict['colourSpecular'] = colourSpecular
+        else:
+            del self.elementDict['colourSpecular']
+        return
+    # special getter and setter
+    def appendTextureCoordinates(self, uvList):
+        """Appends new texture coordinate.
+
+           @param uvList list with u and v coordinate
+           @return list index
+        """
+        if self.elementDict.has_key('texcoordList'):
+            self.elementDict['texcoordList'].append(uvList)
+        else:
+            self.elementDict['texcoordList'] = [uvList]
+        return (len(self.elementDict['texcoordList']) -1 )
+    def setTextureCorrdinates(self, index, uvList):
+        self.elementDict['texcoordList'][index] = uvList
+        return
+    def getTextureCoordinates(self, index=None):
+        return self.elementDict['texcoordList'][index]
+    def deleteTextureCoordinates(self, index=None):
+        """Delete texture coordinates.
+
+           Delete a pair or all texture coordinates of the vertex.
+
+           @param index the index of the texture coordinates in the vertex's list of
+                        texture coordinates. If <code>None</code> the complete list
+                        is deleted.
+        """
+        if (index != None):
+            del self.elementDict['texcoordList'][index]
+        else:
+            del self.elementDict['texcoordList']
+        return
+
+class XMLVertexStringView:
+    """Viewer class for textual representation of a XMLVertex.
+
+       @see XMLVertex
+    """
+    def __init__(self, xmlVertex):
+        if isinstance(xmlVertex, XMLVertex):
+            self.xmlVertex = xmlVertex
+        return
+    def __str__(self):
+        return self.toString()
+    def toString(self, indent=0, keyList=None):
+        """Returns textual representations of its XMLVertex.
+
+           @param indent Indentation level of the string.
+           @param keyList List of keys of elements to represent in the string.
+           @return string String representation of the XMLVertex.
+           @see XMLVertex#__init__
+        """
+        if not keyList:
+            keyList = self.xmlVertex.getElements()
+        else:
+            # remove unavailable elements
+            keyList = [key for key in keyList if key in self.xmlVertex.getElements()]
+        s = self._indent(indent) + "<vertex>\n"
+        if keyList.count('position'):
+            position = self.xmlVertex.getPosition()
+            s += self._indent(indent+1)+"<position x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(position)
+        if keyList.count('normal'):
+            normal = self.xmlVertex.getNormal()
+            s += self._indent(indent+1)+"<normal x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(normal)
+        if keyList.count('colourDiffuse'):
+            colourDiffuse = self.xmlVertex.getColourDiffuse()
+            if OGRE_OPENGL_VERTEXCOLOUR:
+                (r, g, b, a) = tuple(colourDiffuse)
+                s += self._indent(indent+1)+"<colour_diffuse value=\"%.6f %.6f %.6f %.6f\"/>\n" % (b, g, r, a)
+            else:
+                s += self._indent(indent+1)+"<colour_diffuse value=\"%.6f %.6f %.6f %.6f\"/>\n" % tuple(colourDiffuse)
+        if keyList.count('colourSpecular'):
+            colourSpecular = self.xmlVertex.getColourSpecular()
+            if OGRE_OPENGL_VERTEXCOLOUR:
+                (r, g, b, a) = tuple(colourSpecular)
+                s += self._indent(indent+1)+"<colour_specular value=\"%.6f %.6f %.6f %.6f\"/>\n" % (b, g, r, a)
+            else:
+                s += self._indent(indent+1)+"<colour_specular value=\"%.6f %.6f %.6f %.6f\"/>\n" % tuple(colourSpecular)
+        if keyList.count('texcoordList'):
+            for uv in self.xmlVertex.getTextureCoordinatesList():
+                s+=self._indent(indent+1)+"<texcoord u=\"%.6f\" v=\"%.6f\"/>\n" % tuple(uv)
+        s += self._indent(indent) + "</vertex>\n"
+        return s
+    def _indent(self, indent):
+        return "    "*indent
+
+class Vertex:
+  def __init__(self, submesh, xmlVertex):
+    self.xmlVertex = xmlVertex
+    self.influences = []
+
+    self.cloned_from = None
+    self.clones      = []
+    self.submesh = submesh
+    self.id = len(submesh.vertices)
+    submesh.vertices.append(self)
+
+class Influence:
+  def __init__(self, bone, weight):
+    self.bone   = bone
+    self.weight = weight
+
+class Face:
+  def __init__(self, submesh, vertex1, vertex2, vertex3):
+    self.vertex1 = vertex1
+    self.vertex2 = vertex2
+    self.vertex3 = vertex3
+    self.submesh = submesh
+    submesh.faces.append(self)
+
+class Skeleton:
+  def __init__(self, name):
+    self.name = name
+    self.bones = []
+    self.bonesDict = {}
+    self.animationsDict = {}
+
+class Bone:
+  def __init__(self, skeleton, parent, name, loc, rotQuat, conversionMatrix):
+    self.parent = parent
+    self.name   = name
+    self.loc = loc # offset from parent bone
+    self.rotQuat = rotQuat # axis as quaternion
+    self.children = []
+    self.conversionMatrix = conversionMatrix # converts Blender's local bone coordinates into Ogre's local bone coordinates
+
+    if parent:
+      parent.children.append(self)
+
+    self.id = len(skeleton.bones)
+    skeleton.bones.append(self)
+    skeleton.bonesDict[name] =self
+
+class Animation:
+  def __init__(self, name, duration = 0.0):
+    self.name     = name
+    self.duration = duration
+    self.tracksDict = {} # Map bone names to tracks
+
+class Track:
+  def __init__(self, animation, bone):
+    self.bone      = bone
+    self.keyframes = []
+
+    self.animation = animation
+    animation.tracksDict[bone.name] = self
+
+class KeyFrame:
+  def __init__(self, track, time, loc, rotQuat, scale):
+    self.time = time
+    self.loc  = loc
+    self.rotQuat  = rotQuat
+    self.scale = scale
+
+    self.track = track
+    track.keyframes.append(self)
+
+#######################################################################################
+## Armature stuff
+
+def blender_bone2matrix(head, tail, roll):
+  # Convert bone rest state (defined by bone.head, bone.tail and bone.roll)
+  # to a matrix (the more standard notation).
+  # Taken from blenkernel/intern/armature.c in Blender source.
+  # See also DNA_armature_types.h:47.
+
+  nor = vector_normalize([ tail[0] - head[0],
+                           tail[1] - head[1],
+                           tail[2] - head[2] ])
+
+  # Find Axis & Amount for bone matrix
+  target = [0.0, 1.0, 0.0]
+  axis = vector_crossproduct(target, nor)
+
+  # is nor a multiple of target?
+  if vector_dotproduct(axis, axis) > 0.0000000000001:
+    axis  = vector_normalize(axis)
+    theta = math.acos(vector_dotproduct(target, nor))
+    bMatrix = matrix_rotate(axis, theta)
+
+  else:
+    # point same direction, or opposite?
+    if vector_dotproduct(target, nor) > 0.0:
+      updown = 1.0
+    else:
+      updown = -1.0
+
+    # Quoted from Blender source : "I think this should work ..."
+    bMatrix = [ [updown,    0.0, 0.0, 0.0],
+                [   0.0, updown, 0.0, 0.0],
+                [   0.0,    0.0, 1.0, 0.0],
+                [   0.0,    0.0, 0.0, 1.0] ]
+
+  rMatrix = matrix_rotate(nor, roll)
+  return matrix_multiply(rMatrix, bMatrix)
+
+#######################################################################################
+## Mesh stuff
+def process_vert_influences(mesh, skeleton):
+    global verticesDict
+    global exportLogger
+
+    if skeleton:
+        # build bone influence dictionary
+
+        # get the bone names
+        # build influences tuples of bone name and influence
+        boneWeightDict = {}
+        for bone in skeleton.bones:
+            boneweights = []
+            try:
+                #boneweights = mesh.getVertsFromGroup(bone.name, 1, [face.v[i].index])
+                # get all weights for a bone.  getting weights for a specific vertex trashes
+                # blender after a few hundred calls
+                #print bone.name
+                boneweights = mesh.getVertsFromGroup(bone.name, 1)
+                boneWeightDict[bone.name] = dict(boneweights)
+            except:
+                pass
+
+        for vert_index, vertex in verticesDict.iteritems():
+            influences = []
+            for boneName, vertWeightDict in boneWeightDict.iteritems():
+                if vertWeightDict.has_key(vert_index):
+                    influences += [(boneName, vertWeightDict[vert_index])]
+            if not influences:
+                exportLogger.logError("Vertex in skinned mesh without influence, check your mesh!")
+            # limit influences to 4 bones per vertex
+            def cmpfunc(x, y):
+                xname, xweight = x
+                yname, yweight = y
+                return cmp(yweight, xweight)
+            # only want the weights with the most influence
+            influences.sort(cmpfunc)
+            # limits weights to maximum of 4
+            influences = influences[0:4]
+            # and make sure the sum is 1.0
+            total = 0.0
+            for name, weight in influences:
+                total += weight
+            for name, weight in influences:
+                vertex.influences.append(Influence(skeleton.bonesDict[name], weight/total))
+
+# remap vertices for faces
+def process_face(face, submesh, mesh, matrix, skeleton=None):
+    """Process a face of a mesh.
+
+       @param face Blender.NMesh.NMFace.
+       @param submesh SubMesh the face belongs to.
+       @param mesh Blender.Mesh.Mesh the face belongs to.
+       @param matrix Export translation.
+       @param skeleton Skeleton of the mesh (if any).
+    """
+    global verticesDict
+    global exportLogger
+    # threshold to compare floats
+    threshold = 1e-6
+    if len(face.v) in [ 3, 4 ]:
+        if not face.smooth:
+            # calculate the face normal.
+            p1 = face.v[0].co
+            p2 = face.v[1].co
+            p3 = face.v[2].co
+            faceNormal = vector_crossproduct(
+                [p3[0] - p2[0], p3[1] - p2[1], p3[2] - p2[2]],
+                [p1[0] - p2[0], p1[1] - p2[1], p1[2] - p2[2]],
+                )
+            faceNormal = normal_by_matrix(faceNormal, matrix)
+
+        face_vertices = [ 0, 0, 0, 0]
+        for i in range(len(face.v)):
+            # position
+            position  = point_by_matrix (face.v[i].co, matrix)
+            # Blender separates normal, uv coordinates and colour from vertice coordinates.
+            # normal
+            if face.smooth:
+                normal = normal_by_matrix(face.v[i].no, matrix)
+            else:
+                normal = faceNormal
+            xmlVertex = XMLVertex(position, normal)
+            # uv coordinates
+            if (mesh.vertexUV or mesh.faceUV):
+                uv = [0,0]
+                if mesh.vertexUV:
+                    # mesh has sticky/per vertex uv coordinates
+                    uv[0] = face.v[i].uvco[0]
+                    # origin is now in the top-left (Ogre v0.13.0)
+                    uv[1] = 1 - face.v[i].uvco[1]
+                else:
+                    # mesh has per face vertex uv coordinates
+                    uv[0] = face.uv[i][0]
+                    # origin is now in the top-left (Ogre v0.13.0)
+                    uv[1] = 1 - face.uv[i][1]
+                xmlVertex.appendTextureCoordinates(uv)
+            # vertex colour
+            if (mesh.vertexColors):
+                colour = face.col[i]
+                xmlVertex.setColourDiffuse([colour.r/255.0, colour.g/255.0, colour.b/255.0, colour.a/255.0])
+            # check if an equal xmlVertex already exist
+            # get vertex
+            if verticesDict.has_key(face.v[i].index):
+                # vertex already exists
+                vertex = verticesDict[face.v[i].index]
+                # compare xmlVertex to vertex and its clones
+                if (vertex.xmlVertex != xmlVertex):
+                    vertexFound = 0
+                    iClone = 0
+                    while ((iClone < len(vertex.clones)) and (not vertexFound)):
+                        clone = vertex.clones[iClone]
+                        if (clone.xmlVertex == xmlVertex):
+                            vertexFound = 1
+                            vertex = clone
+                        iClone += 1
+                    if not vertexFound:
+                        # create new clone
+                        clone = Vertex(submesh, xmlVertex)
+                        clone.cloned_from = vertex
+                        clone.influences = vertex.influences
+                        vertex.clones.append(clone)
+                        # write back to dictionary
+                        verticesDict[face.v[i].index] = vertex
+                        vertex = clone
+            else:
+                # vertex does not exist yet
+                # create vertex
+                vertex = Vertex(submesh, xmlVertex)
+                verticesDict[face.v[i].index] = vertex
+            # postcondition: vertex is current vertex
+            face_vertices[i] = vertex
+
+        if len(face.v) == 3:
+            Face(submesh, face_vertices[0], face_vertices[1], face_vertices[2])
+        elif len(face.v) == 4:
+            # Split faces with 4 vertices on the shortest edge
+            differenceVectorList = [[0,0,0],[0,0,0]]
+            for indexOffset in range(2):
+                for coordinate in range(3):
+                    differenceVectorList[indexOffset][coordinate] = face_vertices[indexOffset].xmlVertex.getPosition()[coordinate] \
+                                                                  - face_vertices[indexOffset+2].xmlVertex.getPosition()[coordinate]
+            if Mathutils.Vector(differenceVectorList[0]).length < Mathutils.Vector(differenceVectorList[1]).length:
+                Face(submesh, face_vertices[0], face_vertices[1], face_vertices[2])
+                Face(submesh, face_vertices[2], face_vertices[3], face_vertices[0])
+            else:
+                Face(submesh, face_vertices[0], face_vertices[1], face_vertices[3])
+                Face(submesh, face_vertices[3], face_vertices[1], face_vertices[2])
+    else:
+        exportLogger.logWarning("Ignored face with %d edges." % len(face.v))
+    return
+
+def export_mesh(object, exportOptions):
+    global verticesDict
+    global skeletonsDict
+    global materialsDict
+    global exportLogger
+
+    if (object.getType() == "Mesh"):
+        # is this mesh attached to an armature?
+        skeleton = None
+        if exportOptions.armatureExport:
+            parent = object.getParent()
+            #if parent and parent.getType() == "Armature" and (not skeletonsDict.has_key(parent.getName())):
+            if (parent and (parent.getType() == "Armature")):
+                if armatureActionActuatorListViewDict.has_key(parent.getName()):
+                    actionActuatorList = armatureActionActuatorListViewDict[parent.getName()].armatureActionActuatorList
+                    armatureExporter = ArmatureExporter(MeshExporter(object), parent)
+                    armatureExporter.export(actionActuatorList, exportOptions, exportLogger)
+                    skeleton = armatureExporter.skeleton
+
+        #Mesh of the object
+        #for 2.4 us Mesh instead of NMesh
+        data = object.getData(False, True)
+        matrix = None
+        if exportOptions.useWorldCoordinates:
+            matrix = object.getMatrix("worldspace")
+        else:
+            matrix = Mathutils.Matrix([1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1])
+        matrix = matrix*BASE_MATRIX
+        # materials of the object
+        # note: ogre assigns different textures and different facemodes
+        #       to different materials
+        objectMaterialDict = {}
+        # faces assign to objectMaterial keys
+        objectMaterialFacesDict = {}
+
+        # note: these are blender materials. Even if nMaterials = 0
+        #       the face can still have a texture (see above)
+        # meshMaterialList = data.getMaterials(1)
+        meshMaterialList = data.materials
+        # note: material slots may be empty, resp. meshMaterialList entries may be None
+        nMaterials = len(meshMaterialList)
+
+        # warn if mesh is a subdivision surface
+        #if (data.mode & Blender.Mesh.Modes['SUBSURF']):
+            #exportLogger.logWarning("Mesh \"%s\" is a subdivision surface. Convert it to mesh, if you want to export the subdivision result." % data.name)
+        # create ogre materials
+        for face in data.faces:
+            faceMaterial = None
+            # choose "rendering materials" or "game engine materials"
+            if not(exportOptions.useGameEngineMaterials):
+                # rendering materials
+                try:
+                    blenderMaterial = meshMaterialList[face.mat]
+                except:
+                    exportLogger.logError("Material assignment missing for object \"%s\"!" % data.name)
+                    blenderMaterial = None
+                if blenderMaterial:
+                    # non-empty material slot
+                    faceMaterial = RenderingMaterial(data, face)
+                else:
+                    faceMaterial = DefaultMaterial('default')
+            else:
+                # game engine materials
+                try:
+                    if face.image:
+                        if (not(face.mode & Blender.Mesh.FaceModes['INVISIBLE'])
+                            and not(face.flag & Blender.Mesh.FaceFlags['HIDE'])):
+                            faceMaterial = GameEngineMaterial(data, face)
+                    else:
+                        # check if a Blender material is assigned
+                        try:
+                            blenderMaterial = meshMaterialList[face.mat]
+                        except:
+                            blenderMaterial = None
+                        if blenderMaterial:
+                            faceMaterial = GameEngineMaterial(data, face)
+                        else:
+                             exportLogger.logWarning("Face of object \"%s\" without material assignment! Using default material." % data.name)
+                             faceMaterial = DefaultMaterial('default')
+                except:
+                    faceMaterial = DefaultMaterial('default')
+                    try:
+                        blenderMaterial = meshMaterialList[face.mat]
+                    except:
+                        exportLogger.logError("Material assignment missing for object \"%s\"!" % data.name)
+                        blenderMaterial = None
+                    if blenderMaterial:
+                        # non-empty material slot
+                        faceMaterial = RenderingMaterial(data, face)
+                    else:
+                        faceMaterial = DefaultMaterial('default')
+            if faceMaterial:
+                # insert into Dicts
+                materialName = faceMaterial.getName()
+                material = objectMaterialDict.get(materialName)
+                if material:
+                    # append faces
+                    faceList = objectMaterialFacesDict[materialName]
+                    faceList.append(face)
+                    objectMaterialFacesDict[materialName] = faceList
+                else:
+                    # create new faces list
+                    objectMaterialDict[materialName] = faceMaterial
+                    objectMaterialFacesDict[materialName] = [face]
+        # process faces
+        submeshes = []
+        for materialKey in objectMaterialDict.keys():
+            submesh = SubMesh(objectMaterialDict[materialKey])
+            verticesDict = {}
+            for face in objectMaterialFacesDict[materialKey]:
+                process_face(face, submesh, data, matrix, skeleton)
+            if len(submesh.faces):
+                # process verticesDict and add bone influences
+                process_vert_influences(data, skeleton)
+                submeshes.append(submesh)
+                # update global materialsDict
+                material = materialsDict.get(materialKey)
+                if not material:
+                    materialsDict[materialKey] = objectMaterialDict[materialKey]
+        # write mesh
+        if len(submeshes) == 0:
+            # no submeshes
+            exportLogger.logWarning("Mesh %s has no visible faces!" % data.name)
+        else:
+            # write mesh
+            mesh = Mesh(submeshes, skeleton, data)
+            mesh.write()
+    return
+
+#######################################################################################
+## file output
+
+def tab(tabsize):
+    return "\t" * tabsize
+
+def clamp(val):
+    if val < 0.0:
+        val = 0.0
+    if val > 1.0:
+        val = 1.0
+    return val
+
+def convertXMLFile(filename):
+    """Calls the OgreXMLConverter on a file.
+
+       If the script variable <code>OGRE_XML_CONVERTER</code> is nonempty, the
+       OgreXMLConverter is called to convert the given file.
+
+       @param filename filename of the XML file to convert.
+    """
+    global exportLogger
+    if OGRE_XML_CONVERTER != '':
+        commandLine = OGRE_XML_CONVERTER + ' "' + filename + '"'
+        exportLogger.logInfo("Running OgreXMLConverter: " + commandLine)
+        xmlConverter = os.popen(commandLine, 'r')
+        if xmlConverter == None:
+            exportLogger.logError('Could not run OgreXMLConverter!')
+        else:
+            for line in xmlConverter:
+                exportLogger.logInfo("OgreXMLConverter: " + line)
+            xmlConverter.close()
+    return
+
+def upgradeXMLFile(filename):
+    """Calls OgreMeshUpgrade on a file - adds tangents for normalmapping.
+
+       If the script variable <code>OGRE_MESH_UPGRADE</code> is nonempty, the
+       OgreMeshUpgrade is called to convert the given file.
+
+       @param filename filename of the XML file to convert.
+    """
+    global exportLogger
+    if OGRE_MESH_UPGRADE != '':
+        commandLine = OGRE_MESH_UPGRADE + ' "' + filename + '"'
+        exportLogger.logInfo("Running OgreMeshUpgrade: " + commandLine)
+        MeshUpgrade = os.popen(commandLine, 'r')
+        if MeshUpgrade == None:
+            exportLogger.logError('Could not run MeshUpgrade!')
+        else:
+            for line in MeshUpgrade:
+                exportLogger.logInfo("OgreMeshUpgrade: " + line)
+            xmlConverter.close()
+    return
+
+def write_materials():
+    global exportOptions, materialString, exportLogger
+    global materialsDict
+    file = exportOptions.materialFilename
+    exportLogger.logInfo("Materials \"%s\"" % file)
+    f = open(os.path.join(full_path, file), "w")
+    for material in materialsDict.values():
+        material.write(f)
+    f.close()
+    return
+
+#######################################################################################
+## main export
+
+def export(selectedObjectsList):
+    global  scaleNumber, rotXNumber, rotYNumber, rotZNumber
+    global materialsDict
+    global skeletonsDict
+    global BASE_MATRIX
+    global exportLogger
+    global exportOptions
+
+    materialsDict = {}
+    skeletonsDict = {}
+
+    # default: set matrix to 90 degree rotation around x-axis
+    # rotation order: x, y, z
+    # WARNING: Blender uses left multiplication!
+    rotationMatrix = Mathutils.RotationMatrix(-90.0,4,'x')
+    rotationMatrix *= Mathutils.RotationMatrix(0.0,4,'y')
+    rotationMatrix *= Mathutils.RotationMatrix(0.0,4,'z')
+    scaleMatrix = Mathutils.Matrix([1.0,0,0],[0,1.0,0],[0,0,1.0])
+    scaleMatrix.resize4x4()
+    BASE_MATRIX = rotationMatrix*scaleMatrix
+
+    #exportOptions = ExportOptions(rotXNumber.val, rotYNumber.val, rotZNumber.val, scaleNumber.val,
+    #    worldCoordinatesToggle.val, ambientToggle.val, pathString.val, materialString.val)
+    exportOptions = ExportOptions(0.0, 0.0, 0.0, 1.0, 0, 0, 0, 1, full_path, "kanalisation.material")
+    if not os.path.exists(full_path):
+      exportLogger.logError("Invalid path: "+full_path)
+    else:
+      exportLogger.logInfo("Exporting selected objects into \"" + full_path + "\":")
+      n = 0
+      for obj in selectedObjectsList:
+          if obj:
+              if obj.getType() == "Mesh":
+                  exportLogger.logInfo("Exporting object \"%s\":" % obj.getName())
+                  export_mesh(obj, exportOptions)
+                  n = 1
+              elif obj.getType() == "Armature":
+                  exportLogger.logInfo("Exporting object \"%s\":" % obj.getName())
+                  actionActuatorList = armatureActionActuatorListViewDict[obj.getName()].armatureActionActuatorList
+                  armatureMeshExporter = ArmatureMeshExporter(obj)
+                  armatureMeshExporter.export(materialsDict, actionActuatorList, exportOptions, exportLogger)
+      if n == 0:
+          exportLogger.logWarning("No mesh objects selected!")
+      if len(materialsDict) == 0:
+          exportLogger.logWarning("No materials or textures defined!")
+      else:
+          print "Here would material export come"
+          write_materials()
+
+      exportLogger.logInfo("Finished.")
+    return exportLogger.getStatus()
+
+######
+# scene export classes
+######
+class Action:
+	"""Action interface.
+	
+	   Actions encapsulate user requests.
+	"""
+	def __init__(self):
+		"""Constructor.
+		"""
+		return
+	def execute(self):
+		"""Executes the action.
+		"""
+		return
+	
+class QuitAction(Action):
+	"""Quits the windowing system.
+	"""
+	def execute(self):
+		Blender.Draw.Exit()
+		return
+
+class Model:
+	"""Model interface.
+	"""
+	def __init__(self):
+		self.viewList = []
+		return
+	def addView(self, view):
+		self.viewList.append(view)
+		return
+	def removeView(self, view):
+		if view in self.viewList:
+			self.viewList.remove(view)
+		return
+	# protected
+	def _notify(self):
+		"""Notify views.
+		"""
+		for view in self.viewList:
+			view.update()
+		return
+
+class View:
+	"""View interface.
+	"""
+	def __init__(self):
+		return
+	def update(self):
+		return
+
+class Widget:
+	"""Widget interface.
+	
+	   @cvar INFINITY Infinity value for size hints.
+	"""
+	INFINITY = 2147483647
+	def __init__(self):
+		"""Constructor.
+		"""
+		return
+	def draw(self, screenRectangle):
+		"""Draws the widget into an area of the screen.
+		
+		   @param screenRectangle Area of the screen to draw into.
+		          The screenRectangle is a list of the integers
+		          <code>[xl, yl, xu, yu]</code>, where (xl,yl) is
+		          the lower left corner of the area and (xu, yu) is
+		          the upper right corner of the area.
+		"""
+		return
+	def eventFilter(self, event, value):
+		"""Called from event callback function.
+		
+		   @see Blender.Draw.Register
+		"""
+		return
+	def addButtons(self, parent):
+		"""Registers widget buttons at the parent.
+		
+		   @param parent Parent widget or screen.
+		"""
+		return
+	def removeButtons(self, parent):
+		"""Removes widget buttons from parent.
+		
+		   @param parent Parent widget or screen.
+		"""
+		return
+	def getMaximumSize(self):
+		"""Returns the maximum size of this widget.
+		
+		   @return List of integers <code>[width, height]</code>.
+		"""
+		return [Widget.INFINITY, Widget.INFINITY]
+	def getMinimumSize(self):
+		"""Returns the minimum size of this widget.
+		
+		   @return List of integers <code>[width, height]</code>.
+		"""
+		return [0, 0]
+	def getPreferredSize(self):
+		"""Returns the preferred size of this widget.
+		
+		   @return List of integers <code>[width, height]</code>.
+		"""
+		return [0, 0]
+
+class VerticalLayout(Widget):
+	"""Widget that manages vertically stacked child widgets.
+	"""
+	def __init__(self):
+		"""Constructor.
+		"""
+		# widgetDict key: name, value: Widget
+		self.widgetDict = {}
+		# displayList list of widget names in the order to draw them
+		self.displayList = []
+		# parent to register buttons to.
+		self.parent = None
+		return
+	def addWidget(self, widget, name):
+		"""Adds a child widget to this layout.
+		
+		   The child widget is appended below all other widgets.
+		
+		   @param widget Widget to add.
+		   @param name Unique name for the widget.
+		"""
+		self.widgetDict[name] = widget
+		if name not in self.displayList:
+			self.displayList.append(name)
+		# register to known parent
+		if self.parent:
+			widget.addButtons(self.parent)
+		return
+	def removeWidget(self, name):
+		"""Removes a child widget from this layout.
+		
+		   @param name Name of the widget to remove.
+		   @see addWidget
+		"""
+		if self.widgetDict.has_key(name):
+			if self.parent:
+				self.widgetDict[name].removeButtons(self.parent)
+			del self.widgetDict[name]
+			del self.displayList[self.displayList.index(name)]
+		return
+	def addButtons(self, parent):
+		self.parent = parent
+		for widget in self.widgetDict.values():
+			widget.addButtons(self.parent)
+		return
+	def removeButtons(self, parent):
+		for widget in self.widgetDict.values():
+			widget.removeButtons(self.parent)
+		return
+	def draw(self, screenRectangle):
+		# split height for the child widgets
+		minimumSize = self.getMinimumSize()
+		height = screenRectangle[3]- screenRectangle[1]
+		additionalHeight = height - minimumSize[1]
+		stretchWidgetList = []
+		extraHeight = 0
+		# get widgets with unlimited preferred height
+		if (additionalHeight > 0):
+			stretchWidgetList = [name for (name, w) in self.widgetDict.items() if w.getPreferredSize()[1] >= Widget.INFINITY]
+			if (len(stretchWidgetList) > 0):
+				# give equal extra height to widgets with unlimited preferred height
+				extraHeight = additionalHeight / len(stretchWidgetList)
+		# draw widgets with minimum or minimum plus extra size
+		y = screenRectangle[3]
+		dy = 0
+		for name in self.displayList:
+			widget = self.widgetDict[name]
+			dy = widget.getMinimumSize()[1]
+			if (name in stretchWidgetList):
+				dy += extraHeight
+			widget.draw([screenRectangle[0], y-dy, screenRectangle[2], y])
+			y -= dy
+		return
+	def eventFilter(self, event, value):
+		for widget in self.widgetDict.values():
+			widget.eventFilter(event, value)
+		return
+	def getMaximumSize(self):
+		size = [0, 0]
+		for widget in self.widgetDict.values():
+			if (size[0] < widget.getMaximumSize()[0]):
+				size[0] = widget.getMaximumSize()[0]
+			size[1] += widget.getMaximumSize()[1]
+		return size
+	def getMinimumSize(self):
+		size = [0, 0]
+		for widget in self.widgetDict.values():
+			if (size[0] < widget.getMinimumSize()[0]):
+				size[0] = widget.getMinimumSize()[0]
+			size[1] += widget.getMinimumSize()[1]
+		return size
+	def getPreferredSize(self):
+		size = [0, 0]
+		for widget in self.widgetDict.values():
+			if (size[0] < widget.getPreferredSize()[0]):
+				size[0] = widget.getPreferredSize()[0]
+			size[1] += widget.getPreferredSize()[1]
+		return size
+
+class HorizontalLayout(Widget):
+	"""Widget that manages horizontally stacked child widgets.
+	"""
+	def __init__(self):
+		"""Constructor.
+		"""
+		# widgetDict key: name, value: Widget
+		self.widgetDict = {}
+		# displayList list of widget names in the order to draw them
+		self.displayList = []
+		# parent to register buttons to.
+		self.parent = None
+		return
+	def addWidget(self, widget, name):
+		"""Adds a child widget to this layout.
+		
+		   The child widget is appended below all other widgets.
+		
+		   @param widget Widget to add.
+		   @param name Unique name for the widget.
+		"""
+		self.widgetDict[name] = widget
+		if name not in self.displayList:
+			self.displayList.append(name)
+		if self.parent:
+			widget.addButtons(self.parent)
+		return
+	def removeWidget(self, name):
+		"""Removes a child widget from this layout.
+		
+		   @param name Name of the widget to remove.
+		   @see addWidget
+		"""
+		if self.widgetDict.has_key(name):
+			if self.parent:
+				self.widgetDict[name].removeButtons(self.parent)
+			del self.widgetDict[name]
+			del self.displayList[self.displayList.index(name)]
+		return
+	def addButtons(self, parent):
+		self.parent = parent
+		for widget in self.widgetDict.values():
+			widget.addButtons(self.parent)
+		return
+	def removeButtons(self, parent):
+		for widget in self.widgetDict.values():
+			widget.removeButtons(self.parent)
+		return
+	def draw(self, screenRectangle):
+		# split height for the child widgets
+		minimumSize = self.getMinimumSize()
+		width = screenRectangle[2]- screenRectangle[0]
+		additionalWidth = width - minimumSize[0]
+		stretchWidgetList = []
+		extraWidth = 0
+		# get widgets with unlimited preferred height
+		if (additionalWidth > 0):
+			stretchWidgetList = [name for (name, w) in self.widgetDict.items() if w.getPreferredSize()[0] >= Widget.INFINITY]
+			if (len(stretchWidgetList) > 0):
+				# give equal extra height to widgets with unlimited preferred height
+				extraWidth = additionalWidth / len(stretchWidgetList)
+		# draw widgets with minimum or minimum plus extra size
+		x = screenRectangle[0]
+		dx = 0
+		for name in self.displayList:
+			widget = self.widgetDict[name]
+			dx = widget.getMinimumSize()[0]
+			if (name in stretchWidgetList):
+				dx += extraWidth
+			widget.draw([x, screenRectangle[1], x+dx, screenRectangle[3]])
+			x += dx
+		return
+	def eventFilter(self, event, value):
+		for widget in self.widgetDict.values():
+			widget.eventFilter(event, value)
+		return
+	def getMaximumSize(self):
+		size = [0, 0]
+		for widget in self.widgetDict.values():
+			size[0] += widget.getMaximumSize()[0]
+			if (size[1] < widget.getMaximumSize()[1]):
+				size[1] = widget.getMaximumSize()[1]
+		return size
+	def getMinimumSize(self):
+		size = [0, 0]
+		for widget in self.widgetDict.values():
+			size[0] += widget.getMinimumSize()[0]
+			if (size[1] < widget.getMinimumSize()[1]):
+				size[1] = widget.getMinimumSize()[1]
+		return size
+	def getPreferredSize(self):
+		size = [0, 0]
+		for widget in self.widgetDict.values():
+			size[0] += widget.getPreferredSize()[0]
+			if (size[1] < widget.getPreferredSize()[1]):
+				size[1] = widget.getPreferredSize()[1]
+		return size
+
+class HorizontalRatioLayout(Widget):
+	"""Widget that manages horizontally stacked child widgets.
+	
+	   The drawing area is distributed among the childs with a given ratio.
+	"""
+	def __init__(self):
+		# widgetDict key: name, value: [Widget, ratio]
+		self.widgetDict = {}
+		# displayList list of widget names in the order to draw them
+		self.displayList = []
+		# parent to register buttons to.
+		self.parent = None
+		return
+	def addWidget(self, ratio, widget, name):
+		"""Adds a child widget to this layout.
+		
+		   The child widget is appended right to all other widgets.
+		   The ratios must sum up to one.
+		
+		   @param ratio Ratio of screen width to occupy with this widget. 
+		   @param widget Widget to add.
+		   @param name Unique name for the widget.
+		"""
+		self.widgetDict[name] = [widget, ratio]
+		if name not in self.displayList:
+			self.displayList.append(name)
+		if self.parent:
+			widget.addButtons(self.parent)
+		return
+	def removeWidget(self, name):
+		"""Removes a child widget from this layout.
+		
+		   @param name Name of the widget to remove.
+		   @see addWidget
+		"""
+		if self.widgetDict.has_key(name):
+			if self.parent:
+				self.widgetDict[name].removeButtons(self.parent)
+			del self.widgetDict[name]
+			del self.displayList[self.displayList.index(name)]
+		return
+	def addButtons(self, parent):
+		self.parent = parent
+		for widget in self.widgetDict.values():
+			widget[0].addButtons(self.parent)
+		return
+	def removeButtons(self, parent):
+		for widget in self.widgetDict.values():
+			widget[0].removeButtons(self.parent)
+		return
+	def draw(self, screenRectangle):
+		# split height for the child widgets
+		minimumSize = self.getMinimumSize()
+		width = screenRectangle[2] - screenRectangle[0]
+		ratioSum = 0
+		x = screenRectangle[0]
+		dx = 0
+		for name in self.displayList:
+			[widget, ratio] = self.widgetDict[name]
+			ratioSum += ratio
+			if ratio >= 1:
+				dx = screenRectangle[2] - x + 1
+			else:
+				dx = int(ratio*width)
+			widget.draw([x, screenRectangle[1], x+dx-1, screenRectangle[3]])
+			x += dx
+		return
+	def eventFilter(self, event, value):
+		for [widget, ratio] in self.widgetDict.values():
+			widget.eventFilter(event, value)
+		return		
+	def getMaximumSize(self):
+		size = [0, 0]
+		for [widget, ratio] in self.widgetDict.values():
+			size[0] += widget.getMaximumSize()[0]
+			if (size[1] < widget.getMaximumSize()[1]):
+				size[1] = widget.getMaximumSize()[1]
+		return size
+	def getMinimumSize(self):
+		size = [0, 0]
+		for [widget, ratio] in self.widgetDict.values():
+			size[0] += widget.getMinimumSize()[0]
+			if (size[1] < widget.getMinimumSize()[1]):
+				size[1] = widget.getMinimumSize()[1]
+		return size
+	def getPreferredSize(self):
+		size = [Widget.INFINITY, 0]
+		for [widget, ratio] in self.widgetDict.values():
+			if (size[1] < widget.getPreferredSize()[1]):
+				size[1] = widget.getPreferredSize()[1]
+		return size
+
+class Spacer(Widget):
+	"""Occupies blank space on the screen.
+	"""
+	def __init__(self, minimumSize, maximumSize=None, preferredSize=None):
+		"""Constructor.
+		
+		   If maximum or preferred size is not given, the minimum size will be used instead.
+		"""
+		self.minimumSize = minimumSize
+		if maximumSize:
+			self.maximumSize = maximumSize
+		else:
+			self.maximumSize = minimumSize
+		if preferredSize:
+			self.preferredSize = preferredSize
+		else:
+			self.preferredSize = minimumSize
+	def getMaximumSize(self):
+		return self.maximumSize
+	def getMinimumSize(self):
+		return self.minimumSize
+	def getPreferredSize(self):
+		return self.preferredSize
+
+class Decorator(Widget):
+	"""Decorates a child widget.
+	"""
+	def __init__(self, childWidget):
+		self.childWidget = childWidget
+		return
+	def draw(self, screenRectangle):
+		self.childWidget.draw(screenRectangle)
+		return
+	def eventFilter(self, event, value):
+		self.childWidget.eventFilter(event, value)
+		return
+	def addButtons(self, parent):
+		self.childWidget.addButtons(parent)
+		return
+	def removeButtons(self, parent):
+		self.childWidget.removeButtons(parent)
+		return
+
+class Border(Decorator):
+	"""Border around widgets.
+	"""
+	def __init__(self, childWidget, borderSize=10):
+		"""Constructor.
+		
+		   @param childWidget Widget to decorate.
+		   @param borderSize Size of the border.
+		"""
+		Decorator.__init__(self, childWidget)
+		self.borderSize = borderSize
+		return
+	def draw(self, screenRectangle):
+		rect = screenRectangle[:]
+		rect[0] += self.borderSize
+		rect[1] += self.borderSize
+		rect[2] -= self.borderSize
+		rect[3] -= self.borderSize
+		self.childWidget.draw(rect)
+		return
+	def getMaximumSize(self):
+		size = self.childWidget.getMaximumSize()[:]
+		size[0] += 2*self.borderSize
+		size[1] += 2*self.borderSize
+		return size
+	def getMinimumSize(self):
+		size = self.childWidget.getMinimumSize()[:]
+		size[0] += 2*self.borderSize
+		size[1] += 2*self.borderSize
+		return size
+	def getPreferredSize(self):
+		size = self.childWidget.getPreferredSize()[:]
+		size[0] += 2*self.borderSize
+		size[1] += 2*self.borderSize
+		return size
+		
+class Box(Decorator):
+	"""Provides a border with an optional titel for a child widget.
+	"""
+	def __init__(self, childWidget, title=None):
+		"""Constructor.
+		
+		   @param childWidget Widget to decorate.
+		   @param title Optional frame title.
+		"""
+		Decorator.__init__(self, childWidget)
+		self.title = title
+		return
+	def draw(self, screenRectangle):
+		rect = screenRectangle[:]
+		if self.title:
+			# border and title
+			rect[0] += 3
+			rect[1] += 3
+			rect[2] -= 3
+			rect[3] -= 13
+			# title
+			titleWidth = Blender.Draw.GetStringWidth(self.title)
+			theme = Blender.Window.Theme.Get()[0]
+			glColor4ub(*theme.get('text').text)
+			glRasterPos2i(rect[0]+4, rect[3])
+			Blender.Draw.Text(self.title)
+			# border
+			glColor3f(0.0, 0.0, 0.0)
+			glBegin(GL_LINE_STRIP)
+			glVertex2i(rect[0]+6+titleWidth, rect[3]+5)
+			glVertex2i(rect[2], rect[3]+5)
+			glVertex2i(rect[2], rect[1])
+			glVertex2i(rect[0], rect[1])
+			glVertex2i(rect[0], rect[3]+5)
+			glVertex2i(rect[0]+3, rect[3]+5)
+			glEnd()
+			rect[0] += 3
+			rect[1] += 3
+			rect[2] -= 3
+			rect[3] -= 3
+		else:
+			# border only
+			glColor3f(0.0, 0.0, 0.0)
+			glBegin(GL_LINE_STRIP)
+			rect[0] += 3
+			rect[1] += 3
+			rect[2] -= 3
+			rect[3] -= 3
+			glVertex2i(rect[0], rect[1])
+			glVertex2i(rect[0], rect[3])
+			glVertex2i(rect[2], rect[3])
+			glVertex2i(rect[2], rect[1])
+			glVertex2i(rect[0], rect[1])
+			glEnd()
+			rect[0] += 3
+			rect[1] += 3
+			rect[2] -= 3
+			rect[3] -= 3
+		self.childWidget.draw(rect)
+		return
+	def getMaximumSize(self):
+		size = self.childWidget.getMaximumSize()[:]
+		size[0] += 12
+		size[1] += 12
+		if size[0] < self.getMinimumSize()[0]:
+			size[0] = self.getMinimumSize()[0]
+		return size
+	def getMinimumSize(self):
+		size = self.childWidget.getMinimumSize()[:]
+		# basic border size
+		size[0] += 12
+		size[1] += 12
+		# add title size
+		if self.title:
+			size[1] += 11
+			if (size[0] < (Blender.Draw.GetStringWidth(self.title)+16)):
+				size[0] = (Blender.Draw.GetStringWidth(self.title)+16)
+		return size
+	def getPreferredSize(self):
+		size = self.childWidget.getPreferredSize()[:]
+		size[0] += 12
+		size[1] += 12
+		if size[0] < self.getMinimumSize()[0]:
+			size[0] = self.getMinimumSize()[0]
+		return size
+
+class WidgetList(Widget):
+	"""Displays a list of vertically stacked widgets using a scrollbar if necessary.
+	"""
+	def __init__(self):
+		"""Constructor.
+		"""
+		# widgetDict key: name, value: Widget
+		self.widgetDict = {}
+		# displayList list of widget names in the order to draw them
+		self.displayList = []
+		# visible child widgets
+		self.visibleList = []
+		# parent to register buttons to.
+		self.parent = None
+		# scrollbar
+		self.scrollbar = VerticalScrollbar(0, 0, 0)
+		return
+	def addWidget(self, widget, name):
+		"""Adds a child widget to this layout.
+		
+		   The child widget is appended below all other widgets.
+		
+		   @param widget Widget to add.
+		   @param name Unique name for the widget.
+		"""
+		self.widgetDict[name] = widget
+		if name not in self.displayList:
+			self.displayList.append(name)
+		# register to known parent
+		if self.parent:
+			widget.addButtons(self.parent)
+		return
+	def removeWidget(self, name):
+		"""Removes a child widget from this layout.
+		
+		   @param name Name of the widget to remove.
+		   @see addWidget
+		"""
+		if self.widgetDict.has_key(name):
+			if self.parent:
+				self.widgetDict[name].removeButtons(self.parent)
+			del self.widgetDict[name]
+			del self.displayList[self.displayList.index(name)]
+		return
+	def addButtons(self, parent):
+		self.parent = parent
+		for widget in self.widgetDict.values():
+			widget.addButtons(self.parent)
+		self.scrollbar.addButtons(self.parent)
+		return
+	def removeButtons(self, parent):
+		for widget in self.widgetDict.values():
+			widget.removeButtons(self.parent)
+		self.scrollbar.removeButtons(self.parent)
+		return	
+	def draw(self, screenRectangle):
+		# draw a border
+		rect = screenRectangle[:]
+		glColor3f(0.0, 0.0, 0.0)
+		glBegin(GL_LINE_STRIP)
+		glVertex2i(rect[0], rect[3])
+		glVertex2i(rect[2], rect[3])
+		glVertex2i(rect[2], rect[1])
+		glVertex2i(rect[0], rect[1])
+		glVertex2i(rect[0], rect[3])
+		glVertex2i(rect[0], rect[3])
+		glEnd()
+		rect[0] += 1
+		rect[1] += 1
+		rect[2] -= 1
+		rect[3] -= 1
+		# calculate nFirstLines form screenRectangle and set scrollbar accordingly
+		firstLine = self.scrollbar.getCurrentValue()
+		# get list backwards until height is fully used
+		nLines = len(self.displayList)
+		height = rect[3] - rect[1]
+		iLine = -1
+		while ((iLine >= -nLines) and (height > 0)):
+			height -= self.widgetDict[self.displayList[iLine]].getMinimumSize()[1]
+			if height >= 0:
+				iLine -= 1
+		# nLines + iLine + 1 = nFirstLines - 1
+		if (firstLine > (nLines + iLine + 1)):
+			firstLine = nLines + iLine + 1
+		self.scrollbar.currentValue = firstLine
+		self.scrollbar.maximumValue = nLines + iLine + 1
+		self.scrollbar.draw([rect[2]-20, rect[1], rect[2], rect[3]])
+		# widgets
+		self.visibleList = []
+		height = rect[3] - rect[1]
+		iLine = firstLine
+		y = rect[3]
+		while ((iLine < nLines) and (height > 0)):
+			widget = self.widgetDict[self.displayList[iLine]]
+			dy = widget.getMinimumSize()[1]
+			height -= dy
+			if (height > 0):
+				widget.draw([rect[0], y - dy, rect[2]-21, y])
+				self.visibleList.append(widget)
+				y -= dy
+				iLine += 1
+		return
+	def eventFilter(self, event, value):
+		for widget in self.visibleList:
+			widget.eventFilter(event, value)	
+		self.scrollbar.eventFilter(event, value)
+		return
+	def getMinimumSize(self):
+		# max minimumSize()[0] + scrollbar and minimumSize[1] of childs
+		size = [0, 0]
+		for widget in self.widgetDict.values():
+			widgetSize = widget.getMinimumSize() 
+			if size[0] < widgetSize[0]:
+				size[0] = widgetSize[0]
+			if size[1] < widgetSize[1]:
+				size[1] = widgetSize[1]
+		# scrollbar
+		scrollbarSize = self.scrollbar.getMinimumSize()
+		size[0] += scrollbarSize[0]
+		if size[1] < scrollbarSize[1]:
+			size[1] = scrollbarSize[1]
+		return size
+	def getMaximumSize(self):
+		# max maximumSize()[0] and sum maximumSize()[1] of childs
+		return [0, 0]
+	def getPreferredSize(self):
+		# self.minimumSize()[0] and Widget.INFINITY for height
+		minimumSize = self.getMinimumSize()
+		return [minimumSize[0], Widget.INFINITY]
+	
+class Label(Widget):
+	"""Displays a text string.
+	"""
+	def __init__(self, string, fontSize='normal', fontColor=None):
+		"""Constructor.
+		
+		   @param string Text string to display.
+		   @param fontSize Size of the font used for display:
+		                  <code>'normal'</code>, <code>'small'</code> or <code>'tiny'</code>.
+		   @param fontColor List of font color values.
+		"""
+		self.string = string
+		self.fontSize = fontSize
+		self.fontColor = fontColor
+		return
+	def draw(self, screenRectangle):
+		if self.fontColor:
+			if (len(self.fontColor) == 3):
+				glColor3f(*self.fontColor)
+			else:
+				glColor4f(*self.fontColor)
+		else:
+			# theme font color
+			theme = Blender.Window.Theme.Get()[0]
+			glColor4ub(*theme.get('text').text)
+		glRasterPos2i(screenRectangle[0], screenRectangle[1]+3)
+		Blender.Draw.Text(self.string, self.fontSize)
+		return
+	def getMinimumSize(self):
+		return [Blender.Draw.GetStringWidth(self.string, self.fontSize), 11]
+	
+class Button(Widget):
+	"""Push button.
+	"""
+	def __init__(self, action, name, size, tooltip=None):
+		"""Constructor.
+		
+		   @param action Action to execute when the button is pushed.
+		   @param name Button name.
+		   @param size Minimum size of the button, <code>[width, height]</code>.
+		   @param tooltip Tooltip to display for the button.
+		"""
+		self.action = action
+		# Button event number
+		self.event = None
+		self.name = name
+		self.size = size
+		self.preferredSize = size
+		self.tooltip = tooltip
+		return
+	def draw(self, rect):
+		if self.tooltip:
+			Blender.Draw.PushButton(self.name, self.event, rect[0], rect[1], rect[2]-rect[0], rect[3]-rect[1]-1, self.tooltip)
+		else:
+			Blender.Draw.PushButton(self.name, self.event, rect[0], rect[1], rect[2]-rect[0], rect[3]-rect[1]-1)
+		return
+	def addButtons(self, parent):
+		self.event = parent.addButtonAction(self.action)
+		return
+	def getMinimumSize(self):
+		return self.size
+	def getPreferredSize(self):
+		return self.preferredSize
+
+class QuitButton(Button):
+	def eventFilter(self, event, value):
+		if (value != 0):
+			# pressed
+			if (event == Draw.ESCKEY):
+				self.action.execute()
+			if (event == Draw.QKEY):
+				self.action.execute()
+		return
+
+class CheckBox(Widget):
+	"""Two state toggle button.
+	
+	   To provide two way communication between the CheckBox and its parent widget
+	   you can use the following setup:
+	<pre>
+	Parent	CheckBox	OnChangeAction
+  	|--------------------->T            Action(self)
+  	|------->T             |            CheckBox(OnChangeAction, ...)
+  	|        |------------>|            OnChangeAction.execute()
+  	|<-------+-------------|            Parent.checkBoxChanged()
+  	|------->|             |            CheckBox.isChecked()
+	</pre>
+	"""
+	def __init__(self, onChangeAction, checked, name, size, tooltip=None):
+		# check status
+		self.checked = checked
+		self.action = CheckBox.CheckAction(self, onChangeAction)
+		self.name = name
+		self.size = size
+		self.tooltip = tooltip
+		self.event = None
+		return
+	def toggle(self):
+		self.checked = 1 - self.checked
+		Blender.Draw.Redraw(1)
+		return
+	def isChecked(self):
+		return self.checked
+	def draw(self, rect):
+		if self.tooltip:
+			Blender.Draw.Toggle(self.name, self.event, rect[0], rect[1], rect[2]-rect[0]-1, rect[3]-rect[1]-1, self.isChecked(), self.tooltip)
+		else:
+			Blender.Draw.Toggle(self.name, self.event, rect[0], rect[1], rect[2]-rect[0]-1, rect[3]-rect[1]-1, self.isChecked())
+		return
+	def addButtons(self, parent):
+		self.event = parent.addButtonAction(self.action)
+		return
+	def getMinimumSize(self):
+		return self.size
+	class CheckAction(Action):
+		def __init__(self, checkBox, action):
+			self.checkBox = checkBox
+			self.action = action
+			return
+		def execute(self):
+			self.checkBox.toggle()
+			self.action.execute()
+			return
+
+class StringButton(Button):
+	def __init__(self, string, action, name, size, tooltip=None):
+		"""Constructor.
+		
+		   @param string Initial string
+		   @param action Action to execute when the button is pushed.
+		   @param name Button name.
+		   @param size Minimum size of the button, <code>[width, height]</code>.
+		   @param tooltip Tooltip to display for the button.
+		"""
+		self.string = Blender.Draw.Create(string)
+		Button.__init__(self, action, name, size, tooltip)
+		return
+	def getString(self):
+		"""Returns current string.
+		"""
+		return self.string.val
+	def draw(self, rect):
+		if self.tooltip:
+			self.string = Blender.Draw.String(self.name, self.event, rect[0], rect[1], rect[2]-rect[0], rect[3]-rect[1]-1, self.string.val, 255, self.tooltip)
+		else:
+			self.string = Blender.Draw.String(self.name, self.event, rect[0], rect[1], rect[2]-rect[0], rect[3]-rect[1]-1, self.string.val, 255)
+		return
+	
+class BoundedValueModel(Model):
+	def __init__(self, minimum=0, maximum=0, initial=0):
+		Model.__init__(self)
+		self.minimum = minimum
+		self.maximum = maximum
+		self.value = None
+		self.setValue(initial)
+		return
+	def getMinimum(self):
+		return self.minimum
+	def getMaximum(self):
+		return self.maximum
+	def getValue(self):
+		return self.value
+	def setValue(self, value):
+		if (value != self.value):
+			if value < self.minimum:
+				self.value = self.minimum
+			elif value > self.maximum:
+				self.value = self.maximum
+			else:
+				self.value = value
+			self._notify()
+		return
+
+class NumberView(Widget, View):
+	def __init__(self, name, model, minSize, prefSize=None, maxSize=None, tooltip=None):
+		"""Constructor.
+		   @param model BoundedValueModel.
+		"""
+		Widget.__init__(self)
+		View.__init__(self)
+		self.model = model
+		self.model.addView(self)
+		self.numberButton = Blender.Draw.Create(self.model.getValue())
+		self.title = name
+		self.tooltip = tooltip
+		self.minSize = minSize
+		self.maxSize = maxSize or minSize
+		self.prefSize = prefSize or minSize
+		self.event = None
+		return
+	def addButtons(self, parent):
+		self.event = parent.addButtonAction(NumberView.SetAction(self))
+		return
+	def draw(self, rect):
+		if self.tooltip:
+			self.numberButton = Blender.Draw.Number(self.title, self.event, \
+				rect[0], rect[1], rect[2]-rect[0]-1, rect[3]-rect[1]-1, \
+				self.model.getValue(), self.model.getMinimum(), self.model.getMaximum(), self.tooltip)
+		else:
+			self.numberButton = Blender.Draw.Number(self.title, self.event, \
+				rect[0], rect[1], rect[2]-rect[0]-1, rect[3]-rect[1]-1, \
+				self.model.getValue(), self.model.getMinimum(), self.model.getMaximum())
+		return
+	def update(self):
+		Blender.Draw.Redraw(1)
+		return
+	def getMaximumSize(self):
+		return self.maxSize
+	def getMinimumSize(self):
+		return self.minSize
+	def getPreferredSize(self):
+		return self.prefSize
+	class SetAction(Action):
+		def __init__(self, view):
+			self.view = view
+			return
+		def execute(self):
+			self.view.model.setValue(self.view.numberButton.val)
+			return
+
+class VerticalScrollbar(Widget):
+	"""Scrollbar.
+	"""
+	def __init__(self, initial, minimum, maximum):
+		"""Constructor.
+		
+		   @param initial Initial value.
+		   @param minimum Minimum value.
+		   @param maximum Maximum value.
+		"""
+		self.currentValue = initial
+		self.minimumValue = minimum
+		self.maximumValue = maximum
+		# private
+		self.buttonUpEvent = None
+		self.buttonDownEvent = None
+		self.guiRect = [0,0,0,0]
+		self.positionRect = [0,0,0,0]
+		self.markerRect = [0,0,0,0]
+		self.mousePressed = 0
+		self.mouseFocusX = 0
+		self.mouseFocusY = 0
+		self.markerFocusY = 0
+		self.mousePositionY = 0
+		return
+	def getCurrentValue(self):
+		"""Returns current marker position.
+		"""
+		return self.currentValue
+	def up(self, steps=1):
+		"""Move scrollbar up.
+		"""
+		if (steps > 0):
+			if ((self.currentValue - steps) > self.minimumValue):
+				self.currentValue -= steps
+			else:
+				self.currentValue = self.minimumValue
+		return
+	def down(self, steps=1):
+		"""Move scrollbar down.
+		"""
+		if (steps > 0):
+			if ((self.currentValue + steps) < self.maximumValue): 
+				self.currentValue += steps
+			else:
+				self.currentValue = self.maximumValue
+		return
+	def draw(self, screenRectangle):
+		"""draw scrollbar
+		"""
+		# get size of the GUI window to translate MOUSEX and MOUSEY events
+		guiRectBuffer = Blender.BGL.Buffer(GL_FLOAT, 4)
+		Blender.BGL.glGetFloatv(Blender.BGL.GL_SCISSOR_BOX, guiRectBuffer)
+		self.guiRect = [int(guiRectBuffer.list[0]), int(guiRectBuffer.list[1]), \
+		                int(guiRectBuffer.list[2]), int(guiRectBuffer.list[3])]
+		# relative position
+		x = screenRectangle[0]
+		y = screenRectangle[1]
+		width = screenRectangle[2] - x
+		height = screenRectangle[3] - y
+		self.positionRect = screenRectangle
+		# check minimal size:
+		# 2 square buttons,4 pixel borders and 1 pixel inside for inner and marker rectangles
+		#if ((height > (2*(width+5))) and (width > 2*5)):
+		# keep track of remaining area
+		remainRect = self.positionRect[:]
+		# draw square buttons
+		Blender.Draw.Button("/\\", self.buttonUpEvent, x, y + (height-width), width, width, "scroll up") 
+		remainRect[3] -=  width + 2
+		Blender.Draw.Button("\\/", self.buttonDownEvent, x, y, width, width, "scroll down") 
+		remainRect[1] +=  width + 1
+		# draw inner rectangle
+		Blender.BGL.glColor3f(0.13,0.13,0.13) # dark grey
+		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+		remainRect[0] += 1
+		remainRect[3] -= 1
+		Blender.BGL.glColor3f(0.78,0.78,0.78) # light grey
+		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+		remainRect[1] += 1
+		remainRect[2] -= 1
+		Blender.BGL.glColor3f(0.48,0.48,0.48) # grey
+		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+		# draw marker rectangle
+		# calculate marker rectangle
+		innerHeight = remainRect[3]-remainRect[1]
+		markerHeight = innerHeight/(self.maximumValue-self.minimumValue+1.0)
+		# markerRect 
+		self.markerRect[0] = remainRect[0]
+		self.markerRect[1] = remainRect[1] + (self.maximumValue - self.currentValue)*markerHeight
+		self.markerRect[2] = remainRect[2]
+		self.markerRect[3] = self.markerRect[1] + markerHeight
+		# clip markerRect to innerRect (catch all missed by one errors)
+		if self.markerRect[1] > remainRect[3]:
+			self.markerRect[1] = remainRect[3]
+		if self.markerRect[3] > remainRect[3]:
+			self.markerRect[3] = remainRect[3]
+		# draw markerRect
+		remainRect = self.markerRect
+		Blender.BGL.glColor3f(0.78,0.78,0.78) # light grey
+		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+		remainRect[0] += 1
+		remainRect[3] -= 1
+		Blender.BGL.glColor3f(0.13,0.13,0.13) # dark grey
+		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+		remainRect[1] += 1
+		remainRect[2] -= 1
+		# check if marker has foucs
+		if (self.mouseFocusX and self.mouseFocusY and (self.mousePositionY > self.markerRect[1]) and (self.mousePositionY < self.markerRect[3])):
+			Blender.BGL.glColor3f(0.64,0.64,0.64) # marker focus grey
+		else:
+			Blender.BGL.glColor3f(0.60,0.60,0.60) # marker grey
+		Blender.BGL.glRectf(remainRect[0], remainRect[1], remainRect[2], remainRect[3])
+		return
+	def eventFilter(self, event, value):
+		"""event filter for keyboard and mouse input events
+		   call it inside the registered event function
+		"""
+		if (value != 0):
+			# Buttons
+			if (event == Blender.Draw.PAGEUPKEY):
+				self.up(3)
+				Blender.Draw.Redraw(1)
+			elif (event == Blender.Draw.PAGEDOWNKEY):
+				self.down(3)
+				Blender.Draw.Redraw(1)
+			elif (event == Blender.Draw.UPARROWKEY):
+				self.up(1)
+				Blender.Draw.Redraw(1)
+			elif (event == Blender.Draw.DOWNARROWKEY):
+				self.down(1)
+				Blender.Draw.Redraw(1)
+			# Mouse
+			elif (event == Blender.Draw.MOUSEX):
+				# check if mouse is inside positionRect
+				if (value >= (self.guiRect[0] + self.positionRect[0])) and (value <= (self.guiRect[0] + self.positionRect[2])):
+					# redraw if marker got focus
+					if (not self.mouseFocusX) and self.mouseFocusY:
+						Blender.Draw.Redraw(1)
+					self.mouseFocusX = 1
+				else:
+					# redraw if marker lost focus
+					if self.mouseFocusX and self.mouseFocusY:
+						Blender.Draw.Redraw(1)
+					self.mouseFocusX = 0
+			elif (event == Blender.Draw.MOUSEY):
+				# check if mouse is inside positionRect
+				if (value >= (self.guiRect[1] + self.positionRect[1])) and (value <= (self.guiRect[1] + self.positionRect[3])):
+					self.mouseFocusY = 1
+					# relative mouse position
+					self.mousePositionY = value - self.guiRect[1]
+					if ((self.mousePositionY > self.markerRect[1]) and (self.mousePositionY < self.markerRect[3])):
+						# redraw if marker got focus
+						if self.mouseFocusX and (not self.markerFocusY):
+							Blender.Draw.Redraw(1)
+						self.markerFocusY = 1
+					else:
+						# redraw if marker lost focus
+						if self.mouseFocusX and self.markerFocusY:
+							Blender.Draw.Redraw(1)
+						self.markerFocusY = 0
+					# move marker
+					if (self.mousePressed == 1):
+						# calculate step from distance to marker
+						if (self.mousePositionY > self.markerRect[3]):
+							# up
+							self.up(1)
+							Blender.Draw.Draw()
+						elif (self.mousePositionY < self.markerRect[1]):
+							# down
+							self.down(1)
+							Blender.Draw.Draw()
+						# redraw if marker lost focus
+						if self.mouseFocusX and self.mouseFocusY:
+							Blender.Draw.Redraw(1)
+				else:
+					# redraw if marker lost focus
+					if self.mouseFocusX and self.markerFocusY:
+						Blender.Draw.Redraw(1)
+					self.markerFocusY = 0
+					self.mouseFocusY = 0
+			elif ((event == Blender.Draw.LEFTMOUSE) and (self.mouseFocusX == 1) and (self.mouseFocusY == 1)):
+				self.mousePressed = 1
+				# move marker
+				if (self.mousePositionY > self.markerRect[3]):
+					# up
+					self.up(1)
+					Blender.Draw.Redraw(1)
+				elif (self.mousePositionY < self.markerRect[1]):
+					# down
+					self.down(1)
+					Blender.Draw.Redraw(1)
+			elif (Blender.Get("version") >= 234):
+				if (event == Blender.Draw.WHEELUPMOUSE):
+					self.up(1)
+					Blender.Draw.Redraw(1)
+				elif (event == Blender.Draw.WHEELDOWNMOUSE):
+					self.down(1)
+					Blender.Draw.Redraw(1)
+		else: # released keys and buttons
+			if (event == Blender.Draw.LEFTMOUSE):
+				self.mousePressed = 0
+		return
+	def getMinimumSize(self):
+		return [20, 60]
+	def getPreferredSize(self):
+		return [20, Widget.INFINITY]
+	def addButtons(self, parent):
+		self.buttonUpEvent = parent.addButtonAction(VerticalScrollbar.UpAction(self))
+		self.buttonDownEvent = parent.addButtonAction(VerticalScrollbar.DownAction(self))
+		return
+	class UpAction(Action):
+		def __init__(self, scrollbar):
+			self.scrollbar = scrollbar
+			return
+		def execute(self):
+			self.scrollbar.up()
+			Blender.Draw.Redraw(1)
+			return
+	class DownAction(Action):
+		def __init__(self, scrollbar):
+			self.scrollbar = scrollbar
+			return
+		def execute(self):
+			self.scrollbar.down()
+			Blender.Draw.Redraw(1)
+			return
+
+class ProgressBar(Widget):
+	def __init__(self):
+		Widget.__init__(self)
+		# percentage of attained progress
+		self.percent = 0.0
+		self.minimumSize = [104, 24]
+		self.preferredSize = [Widget.INFINITY, 15]
+		self.event = None
+		return
+	def progress(self, percent):
+		self.percent = percent
+		Blender.Draw.Redraw(1)
+		return
+	def draw(self, rect):
+		# border
+		glColor3f(0.0, 0.0, 0.0)
+		glBegin(GL_LINE_STRIP)
+		glVertex2i(rect[0], rect[1])
+		glVertex2i(rect[0], rect[3])
+		glVertex2i(rect[2], rect[3])
+		glVertex2i(rect[2], rect[1])
+		glVertex2i(rect[0], rect[1])
+		glEnd()
+		# percentage bar
+		width = rect[2] - rect[0] - 4
+		barWidth = int(width*self.percent)
+		Blender.Draw.Toggle("%d%%" % (self.percent*100), self.event, rect[0]+2, rect[1]+2, barWidth, rect[3]-rect[1]-4, 0) 
+		return
+	def addButtons(self, parent):
+		self.event = parent.addButtonAction(ProgressBar.NoToggle())
+	def getMinimumSize(self):
+		return self.minimumSize
+	def getPreferredSize(self):
+		return self.preferredSize
+	class NoToggle(Action):
+		def execute(self):
+			Blender.Draw.Redraw(1)
+			return
+
+class Screen:
+	"""Represents the complete script window.
+	
+	   A screen represents the complete script window. It handles
+	   drawing and events and can consist of several user interface
+	   components.
+	   
+	   @cvar current Current active screen.
+	"""
+	current = None
+	def __init__(self):
+		"""Constructor.
+		"""
+		# buttonHandler event number management
+		self.nButtonEvent = 0
+		# buttonEventDict key: iButtonEvent, value: Action
+		self.buttonEventDict = {}
+		# default widget layout
+		self.layout = VerticalLayout()
+		return
+	def activate(self):
+		"""Makes the current screen active.
+		
+		   This method calls Blender.Draw.Register to register itself to
+		   be responsible for windowing.
+		"""
+		self.layout.addButtons(self)
+		Screen.current = self
+		Blender.Draw.Register(self._draw, self._eventHandler, self._buttonHandler)
+		return
+	def addWidget(self, widget, name):
+		"""Adds a widget to this screen.
+		
+		   @param widget Widget to add to this screen.
+		   @param name Unique name for the widget.
+		"""
+		self.layout.addWidget(widget, name)
+		return
+	def removeWidget(self, name):
+		"""Removes widget from this screen.
+		
+		   @param name Name of the widget to remove.
+		   @see addWidget
+		"""
+		self.layout.removeWidget(name)
+		return
+	def addButtonAction(self, action):
+		"""Registers an action for a button event.
+		
+		   @param action Action to execute on receive of the returned button event number.
+		   @return eventNumber Event number to use for the button that corresponds to that action.
+		"""
+		# workaround for Blender 2.37 event 8 bug:
+		shiftEvents = 100
+		# get a free event number
+		if (len(self.buttonEventDict) == self.nButtonEvent):
+			self.nButtonEvent += 1
+			eventNumber = self.nButtonEvent + shiftEvents
+		else:
+			eventNumber = [(x+1+shiftEvents) for x in range(self.nButtonEvent) if (x+1+shiftEvents) not in self.buttonEventDict.keys()][0]
+		# assign action to that event
+		self.buttonEventDict[eventNumber] = action
+		return eventNumber
+	def removeButtonAction(self, eventNumber):
+		"""Action for the given event number will no longer be called.
+		
+		   @param eventNumber Event number for the action.
+		"""
+		if self.buttonEventDict.has_key(eventNumber):
+			del self.buttonEventDict[eventNumber]
+		return
+	# callbacks for Blender.Draw.Register
+	def _draw(self):
+		"""Draws the screen.
+		
+		   Callback function for Blender.Draw.Register
+		"""
+		# clear background
+		theme = Blender.Window.Theme.Get()[0]
+		bgColor = [color/255.0 for color in theme.get('buts').back]
+		glClearColor(*bgColor)
+		glClear(GL_COLOR_BUFFER_BIT)
+
+		# size of the script window
+		size = list(Blender.Window.GetAreaSize())
+		minimumSize = self.layout.getMinimumSize()
+		if size[0] < minimumSize[0]:
+			size[0] = minimumSize[0]
+		if size[1] < minimumSize[1]:
+			size[1] = minimumSize[1]
+		screenRect = [0, 0, size[0]-1, size[1]-1]
+		
+		# draw widgets
+		self.layout.draw(screenRect)
+		return
+	def _eventHandler(self, event, value):
+		"""Handles keyboard and mouse input events.
+		
+		   Callback function for Blender.Draw.Register
+		"""
+		self.layout.eventFilter(event, value)
+		return
+	def _buttonHandler(self, event):
+		"""Handles draw button events.
+		
+		   Callback function for Blender.Draw.Register
+		"""
+		if self.buttonEventDict.has_key(event):
+			self.buttonEventDict[event].execute()
+		return
+	
+###
+# specific classes
+class OgreFrame(Decorator):
+	"""Ogre Logo, Title and border.	"""
+	OGRE_LOGO = Buffer(GL_BYTE, [48,122*4],[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,64,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,0,0,0,127,0,1,0,127,0,2,0,127,2,5,2,127,2,5,2,127,4,6,4,127,5,8,5,127,8,11,8,127,8,11,8,127,3,5,3,127,2,3,2,127,0,1,0,127,0,1,0,127,0,1,0,127,0,1,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,1,2,1,127,4,6,4,127,10,13,10,127,18,22,18,127,23,28,23,127,24,30,24,127,25,31,25,127,25,31,25,127,26,32,26,127,26,32,26,127,26,32,26,127,25,31,25,127,24,30,24,127,18,23,18,127,3,5,3,127,4,6,4,127,8,11,8,127,9,12,9,127,13,17,13,127,17,22,17,127,15,19,15,127,7,9,7,127,1,2,1,127,0,0,0,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,2,4,2,127,4,6,4,127,18,22,18,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,18,22,18,127,15,19,15,127,20,26,20,127,25,31,25,127,26,32,26,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,26,32,26,127,24,30,24,127,16,20,16,127,4,5,4,127,0,0,0,95,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,1,1,1,127,13,15,13,127,12,15,12,127,24,29,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,3,5,3,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,1,1,1,127,19,24,19,127,11,15,11,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,17,21,17,127,22,28,22,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,3,5,3,127,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,20,24,20,127,16,20,16,127,20,25,20,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,22,28,22,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,3,5,3,127,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,64,5,7,5,127,26,32,26,127,15,19,15,127,41,48,41,127,38,45,38,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,3,4,3,127,0,0,0,127,58,66,58,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,1!
 05,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,127,20,24,20,127,27,34,27,127,26,32,26,127,47,55,47,127,47,55,47,127,39,46,39,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,11,16,11,127,0,1,0,127,3,3,3,127,94,106,94,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118!
 ,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,127,33,39,33,127,45,52,45,127,28,32,28,127,47,55,47,127,44,51,44,127,39,46,39,127,27,33,27,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,21,26,21,127,0,2,0,127,0,0,0,127,23,26,23,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,!
 105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,127,24,28,24,127,33,40,33,127,18,22,18,127,29,35,29,127,25,31,25,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,5,8,5,127,1,2,1,127,0,0,0,127,70,79,70,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,12!
 7,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,94,105,94,127,70,79,70,127,76,86,76,127,90,101,90,127,103,116,103,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,64,0,0,0,127,4,6,4,127,12,16,12,127,22,27,22,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,28,34,28,127,35,42,35,127,28,35,28,127,25,31,25,127,23,29,23,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,17,21,17,127,0,2,0,127,0,0,0,127,31,36,31,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,100,112,100,127,92,103,92,127,103,116,103,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127!
 ,105,118,105,127,105,118,105,127,105,118,105,127,100,112,100,127,81,92,81,127,68,77,68,127,65,73,65,127,65,73,65,127,76,86,76,127,78,88,78,127,83,94,83,127,92,103,92,127,85,95,85,127,31,35,31,127,6,7,6,127,6,7,6,127,13,14,13,127,13,14,13,127,19,21,19,127,26,29,26,127,26,29,26,127,48,54,48,127,96,108,96,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,70,78,70,127,3,3,3,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,12,13,11,127,23,26,23,127,36,40,36,127,49,55,49,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,64,0,0,0,127,2,4,2,127,16,20,16,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,26,33,26,127,59,68,59,127,81,91,81,127,87,98,87,127,86,96,86,127,80,90,80,127,71,79,71,127,59,66,59,127,36,41,35,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,31,24,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,5,8,5,127,0,1,0,127,18,20,18,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,91,103,91,127,58,65,58,127,29,33,29,127,6,7,6,127,0,0,0,127,0,0,0,127,1,2,1,127,22,24,22,127,54,61,54,127,94,106,94,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,88,99,88,127,51,58,51,127,18,21,!
 18,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,17,19,17,127,48,54,48,127,80,91,80,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,29,33,29,127,0,0,0,127,41,31,14,127,33,25,11,127,18,14,6,127,2,2,1,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,127,2,3,2,127,24,29,24,127,26,32,26,127,24,30,24,127,25,31,25,127,24,30,24,127,24,30,24,127,24,30,24,127,23,29,23,127,34,41,34,127,78,88,78,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,97,87,127,87,97,87,127,84,93,84,127,62,69,62,127,34,40,34,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,28,23,127,26,30,26,127,36,38,36,127,47,50,46,127,39,42,37,127,34,40,34,127,30,37,30,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,15,19,15,127,0,1,0,127,0,0,0,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,94,106,94,127,43,48,43,127,4,5,4,127,0,0,0,127,0,0,0,127,0,0,0,127,6,5,2,127,16,12,5,127,2,2,1,127,0,0,0,127,0,0,0,127,7,8,7,127,58,65,58,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,96,108,96,127,41,47,41,127,1,1,1,127,0,0,0,127,0,0,0,127,6,5,2,127,27,21,9,127,42,33,1!
 4,127,46,36,16,127,46,36,16,127,33,25,11,127,31,24,11,127,25,19,9,127,16,12,5,127,12,9,4,127,0,0,0,127,107,82,36,127,115,88,38,127,107,82,36,127,107,82,36,127,100,76,33,127,92,71,31,127,88,68,30,127,0,0,0,127,4,3,2,127,0,0,0,127,0,0,0,127,0,0,0,127,13,15,13,127,65,73,65,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,13,14,13,127,0,0,0,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,109,84,36,127,96,73,32,127,80,62,27,127,65,50,22,127,52,40,17,127,37,28,12,127,21,16,7,127,2,2,1,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,127,9,11,9,127,48,56,48,127,45,53,45,127,41,48,41,127,33,40,33,127,34,41,34,127,37,44,37,127,54,62,54,127,77,87,77,127,87,97,87,127,87,97,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,79,88,79,127,61,69,61,127,25,31,25,127,25,31,25,127,23,28,23,127,19,23,19,127,42,43,41,127,60,60,59,127,61,61,59,127,61,61,59,127,63,63,61,127,35,37,34,127,38,45,38,127,33,39,33,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,15,19,15,127,0,1,0,127,0,0,0,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,81,91,81,127,9,11,9,127,0,0,0,127,2,2,1,127,44,34,15,127,86,66,29,127,115,88,38,127,122,94,41,127,122,94,41,127,121,92,40,127,94,72,31,127,39,30,13,127,0,0,0,127,0,0,0,127,40,45,40,127,101,114,101,127,105,118,105,127,105,118,105,127,105,118,105,127,85,95,85,127,11,13,11,127,0,0,0,127,4,3,2,127,50,38,17,127,94,72,31,127,122,94,41,127,122,!
 94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,92,71,31,127,0,0,0,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,2,2,1,127,105,81,35,127,98,75,33,127,60,46,20,127,23,18,8,127,0,0,0,127,1,1,1,127,90,102,90,127,105,118,105,127,105,118,105,127,105,118,105,127,6,7,6,127,0,0,0,127,115,88,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,8,6,3,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,127,3,5,3,127,45,53,45,127,46,54,46,127,46,54,46,127,47,55,47,127,46,54,46,127,68,78,68,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,98,87,127,67,76,67,127,38,46,38,127,21,26,21,127,50,52,50,127,60,60,59,127,61,61,59,127,60,60,58,127,60,60,58,127,60,60,58,127,61,61,59,127,39,41,38,127,52,59,52,127,67,76,67,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,15,19,15,127,0,1,0,127,0,0,0,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,59,67,59,127,1,1,1,127,0,0,0,127,35,27,12,127,105,81,35,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,86,66,29,127,8,6,3,127,0,0,0,127,36,40,36,127,105,118,105,127,105,118,105,127,82,92,82,127,7,7,7,127,0,0,0,127,31,24,10,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,!
 94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,80,62,27,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,82,63,28,127,46,36,16,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,27,21,9,127,0,0,0,127,78,88,78,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,127,0,2,0,127,41,49,41,127,46,54,46,127,46,54,46,127,49,56,49,127,77,87,77,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,85,96,85,127,55,64,55,127,44,52,44,127,23,28,23,127,17,22,17,127,90,92,90,127,84,84,82,127,60,60,58,127,60,60,58,127,60,60,58,127,60,60,58,127,61,61,59,127,39,41,38,127,54,62,54,127,62,71,62,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,15,20,15,127,0,1,0,127,0,0,0,127,102,115,102,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,81,90,81,127,1,1,1,127,0,0,0,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,103,79,34,127,12,9,4,127,0,0,0,127,47,52,47,127,93,104,93,127,8,9,8,127,0,0,0,127,52,40,17,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,!
 41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,63,49,21,127,105,81,35,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,0,0,0,127,9,11,9,127,101,113,101,127,105,118,105,127,105,118,105,127,105,118,105,127,0,0,0,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,69,53,23,127,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,127,0,1,0,127,37,44,37,127,46,54,46,127,49,57,49,127,79,89,79,127,87,97,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,56,64,56,127,46,53,46,127,25,31,25,127,22,27,22,127,25,31,25,127,44,47,44,127,116,116,115,127,59,59,57,127,60,60,58,127,60,60,58,127,60,60,58,127,61,61,59,127,38,41,37,127,69,78,69,127,45,53,45,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,15,20,15,127,0,0,0,127,5,6,5,127,104,117,104,127,105,118,105,127,105,118,105,127,105,118,105,127,93,104,93,127,8,9,8,127,0,0,0,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,96,73,32,127,2,2,1,127,0,0,0,127,24,28,24,127,0,0,0,127,37,28,12,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122!
 ,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,10,8,3,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,88,68,30,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,39,30,13,127,0,0,0,127,43,49,43,127,105,118,105,127,105,118,105,127,105,118,105,127,93,105,93,127,0,0,0,127,14,11,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,39,30,13,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,64,0,1,0,127,21,25,21,127,48,57,49,127,82,92,82,127,87,97,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,97,87,127,87,98,87,127,60,69,60,127,43,50,43,127,29,36,29,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,116,116,116,127,71,71,70,127,60,60,58,127,60,60,58,127,60,60,58,127,62,62,60,127,30,32,29,127,75,85,75,127,29,36,29,127,25,31,25,127,24,30,24,127,24,30,24,127,23,28,23,127,10,14,10,127,0,0,0,127,40,45,40,127,105,118,105,127,105,118,105,127,105,118,105,127,105,118,105,127,33,38,33,127,0,0,0,127,39,30,13,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,67,52,23,127,0,0,0,127,0,0,0,127,10,8,3,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41!
 ,127,107,82,36,127,84,65,28,127,71,54,24,127,115,88,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,67,51,22,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,105,81,35,127,2,2,1,127,0,0,0,127,0,0,0,127,18,21,18,127,61,69,61,127,102,115,102,127,92,103,92,127,0,0,0,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,60,46,20,127,52,40,17,127,69,53,23,127,86,66,29,127,10,8,3,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,127,2,5,2,127,49,57,49,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,98,87,127,86,97,86,127,75,84,75,127,53,61,53,127,34,41,34,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,22,28,22,127,96,97,96,127,93,93,92,127,59,59,58,127,60,60,58,127,60,60,58,127,61,61,59,127,34,39,34,127,74,84,74,127,23,29,23,127,25,31,25,127,37,39,34,127,47,47,41,127,44,45,39,127,17,18,16,127,0,0,0,127,52,59,52,127,105,118,105,127,105,118,105,127,105,118,105,127,81,92,81,127,0,0,0,127,8,6,3,127,111,85,37,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,50,38,17,127,16,12,5,127,33,25,11,127,103,79,34,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,23,18,8,127,0,0,0,127,69,53,23,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,27,21,9,127,0,0,0,127!
 ,0,0,0,127,0,0,0,127,92,71,31,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,61,47,21,127,18,14,6,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,117,90,39,127,88,68,29,127,54,41,18,127,14,11,5,127,0,0,0,127,0,0,0,127,17,18,17,127,68,76,68,127,0,0,0,127,21,16,7,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,31,24,11,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,95,0,0,0,127,37,43,37,127,89,100,89,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,97,87,127,88,99,88,127,82,92,82,127,61,69,61,127,36,42,36,127,27,32,27,127,23,29,23,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,78,80,76,127,102,102,102,127,58,58,57,127,60,60,58,127,60,60,58,127,58,58,56,127,40,47,40,127,56,64,56,127,24,29,23,127,44,45,40,127,49,49,43,127,49,49,43,127,46,46,41,127,41,42,37,127,0,0,0,127,38,43,38,127,105,118,105,127,105,118,105,127,105,118,105,127,33,37,33,127,0,0,0,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,0,0,0,127,0,0,0,127,0,0,0,127,12,9,4,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,84,65,28,127,4,3,2,127,115,88,38,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,42,33,14,127,0,0,0,127,119,91,40,127,102,78,34,127,7!
 5,57,25,127,52,40,17,127,88,68,29,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,61,47,21,127,31,24,11,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,84,65,28,127,19,15,7,127,0,0,0,127,4,5,4,127,0,0,0,127,31,24,11,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,111,85,37,127,115,88,38,127,122,94,41,127,122,94,41,127,48,37,16,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,32,0,0,0,127,6,7,5,127,67,75,67,127,89,100,89,127,87,97,87,127,87,97,87,127,87,98,87,127,88,99,88,127,88,98,88,127,80,90,80,127,62,71,62,127,45,52,45,127,39,46,39,127,57,65,57,127,65,74,65,127,59,67,59,127,54,61,54,127,55,61,55,127,28,34,28,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,64,67,64,127,109,109,108,127,58,58,57,127,60,60,58,127,61,60,59,127,50,50,47,127,47,55,47,127,33,39,33,127,44,44,39,127,48,48,42,127,48,48,42,127,28,30,25,127,36,37,31,127,48,48,42,127,1,2,1,127,36,41,36,127,105,118,105,127,105,118,105,127,99,111,99,127,4,5,4,127,2,2,1,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,65,50,22,127,0,0,0,127,30,34,30,127,27,30,27,127,0,0,0,127,67,51,22,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,58,44,19,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,71,54,24,127,0,0,0,127,18,14,6,127,122,94,41,127,122,94,41,127,12!
 2,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,54,41,18,127,31,24,11,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,56,43,19,127,0,0,0,127,0,0,0,127,31,24,11,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,37,28,12,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,95,0,0,0,127,2,3,2,127,28,32,28,127,58,65,58,127,56,64,56,127,50,57,50,127,46,54,46,127,42,49,42,127,43,50,43,127,62,71,62,127,80,90,80,127,87,98,87,127,87,98,87,127,87,97,87,127,87,98,87,127,86,97,87,127,78,85,78,127,46,52,46,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,64,67,64,127,104,104,104,127,58,58,57,127,60,60,58,127,62,61,60,127,34,38,33,127,37,43,37,127,50,51,44,127,48,48,42,127,48,48,42,127,23,27,22,127,32,36,30,127,95,95,82,127,43,45,39,127,0,0,0,127,45,51,45,127,105,118,105,127,105,118,105,127,71,80,71,127,0,0,0,127,35,27,12,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,103,79,35,127,2,2,1,127,0,0,0,127,11,13,11,127,0,0,0,127,65,50,22,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,23,18,8,127,0,0,0,127,35,27,12,127,122,94,41,127,122,94,41,127,122,94,!
 41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,46,36,16,127,41,31,14,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,37,28,12,127,50,38,17,127,73,56,24,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,69,53,23,127,0,0,0,127,44,34,15,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,27,21,9,127,0,0,0,127,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,8,10,8,127,51,59,51,127,84,95,84,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,87,127,63,71,63,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,76,78,75,127,100,100,99,127,58,58,57,127,61,60,59,127,53,54,51,127,24,30,24,127,29,33,28,127,77,76,63,127,47,48,42,127,29,32,27,127,24,30,24,127,30,35,29,127,90,91,84,127,28,29,25,127,0,0,0,127,77,86,76,127,105,118,105,127,105,118,105,127,44,50,44,127,0,0,0,127,69,53,23,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,81,62,27,127,4,3,2,127,0,0,0,127,12,9,4,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,4,3,2,127,0,0,0,127,54,41,18,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,!
 127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,46,36,16,127,46,36,16,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,48,37,16,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,42,33,14,127,46,36,16,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,16,12,5,127,0,0,0,127,0,0,0,127,4,3,2,127,6,5,2,127,0,0,0,95,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,95,1,1,1,127,60,68,60,127,87,98,87,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,97,87,127,73,82,73,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,22,28,22,127,89,92,89,127,87,87,86,127,59,59,58,127,60,59,58,127,31,35,31,127,25,31,25,127,43,45,38,127,74,74,62,127,43,43,38,127,22,28,22,127,25,31,25,127,24,30,24,127,26,32,26,127,13,14,12,127,0,0,0,127,100,113,100,127,105,118,105,127,105,118,105,127,21,24,21,127,0,0,0,127,98,75,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,113,87,38,127,92,71,31,127,117,90,39,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,19,15,7,127,0,0,0,127,71,54,24,127,122,94,41,127,122,94,41,127,122,94,41,127,122,9!
 4,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,39,30,13,127,50,38,17,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,82,63,28,127,0,0,0,127,23,26,23,127,38,42,38,127,5,7,5,127,0,0,0,127,96,73,32,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,111,85,37,127,54,41,18,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,82,63,28,127,16,12,5,127,16,12,5,127,16,12,5,127,12,9,4,127,46,35,16,127,82,63,28,127,117,90,39,127,46,36,16,127,0,0,0,127,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,33,38,33,127,89,99,89,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,84,94,84,127,28,35,28,127,25,31,25,127,25,31,25,127,25,31,25,127,22,28,22,127,100,101,100,127,73,73,71,127,61,60,59,127,35,38,35,127,24,30,24,127,24,30,24,127,48,51,41,127,69,69,57,127,36,37,32,127,24,30,24,127,28,34,28,127,25,31,25,127,25,31,25,127,17,21,17,127,0,0,0,127,80,90,80,127,105,118,105,127,105,118,105,127,6,7,6,127,0,0,0,127,115,88,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,56,43,19,127,0,0,0,127,88,68,29,127,117,90,39,127,107,82,36,127,92,71,31,127,80,62,27!
 ,127,69,53,23,127,60,46,20,127,46,36,16,127,33,25,11,127,23,18,8,127,4,3,2,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,65,50,22,127,0,0,0,127,20,22,20,127,26,30,26,127,0,0,0,127,2,2,1,127,109,84,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,21,16,7,127,60,46,20,127,94,72,31,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,54,41,18,127,0,0,0,127,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,6,7,6,127,81,91,81,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,88,98,88,127,60,68,60,127,27,33,27,127,24,30,24,127,25,31,25,127,22,28,22,127,91,91,91,127,57,58,56,127,31,36,31,127,24,30,24,127,25,31,25,127,25,31,25,127,27,31,26,127,70,71,58,127,41,42,36,127,37,43,37,127,66,74,66,127,23,29,23,127,25,31,25,127,19,22,19,127,0,0,0,127,75,84,75,127,105,118,105,127,102,114,102,127,0,0,0,127,4,3,2,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,117,90,39,127,31,24,10,127,2,2,1,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,!
 127,0,0,0,127,0,0,0,127,0,0,0,127,4,3,2,127,61,47,21,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,46,36,16,127,0,0,0,127,0,0,0,127,0,0,0,127,8,6,3,127,73,56,24,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,61,47,21,127,0,0,0,127,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,45,52,45,127,87,98,88,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,82,92,82,127,46,54,46,127,34,41,34,127,25,31,25,127,25,31,25,127,26,30,26,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,33,37,31,127,48,48,42,127,43,43,38,127,66,74,65,127,23,29,23,127,25,31,25,127,20,25,20,127,0,0,0,127,70,78,70,127,105,118,105,127,92,103,92,127,0,0,0,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,86,66,29,127,48,37,16,127,31,24,11,127,16,12,5,127,23,18,8,127,33!
 ,25,11,127,52,40,17,127,71,54,24,127,96,73,32,127,117,90,39,127,63,49,21,127,73,56,24,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,88,68,29,127,77,59,26,127,77,59,26,127,90,69,30,127,117,90,39,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,73,56,24,127,0,0,0,127,0,0,0,32],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,25,28,25,127,88,99,88,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,86,97,86,127,87,98,87,127,70,79,70,127,46,54,46,127,47,55,47,127,45,52,45,127,30,37,30,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,44,52,44,127,72,81,72,127,70,79,70,127,23,29,23,127,25,31,25,127,21,25,21,127,0,0,0,127,66,73,65,127,105,118,105,127,92,103,92,127,0,0,0,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,1!
 27,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,80,62,27,127,77,59,26,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,77,59,26,127,0,0,0,127,0,0,0,64],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,1,0,127,64,72,64,127,87,97,87,127,86,97,86,127,86,97,86,127,87,97,87,127,86,97,86,127,86,96,86,127,85,95,85,127,71,80,71,127,47,55,47,127,46,54,46,127,46,54,46,127,46,54,46,127,47,55,47,127,31,38,31,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,23,29,23,127,59,67,59,127,77,87,77,127,58,66,58,127,25,31,25,127,25,31,25,127,22,27,22,127,0,0,0,127,48,54,48,127,105,118,105,127,92,103,92,127,0,0,0,127,16,12,5,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,!
 122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,80,62,27,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,92,71,31,127,0,0,0,127,0,0,0,64],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,127,14,16,14,127,88,99,88,127,88,98,88,127,88,98,88,127,72,82,72,127,51,59,51,127,52,61,52,127,55,63,55,127,47,55,47,127,45,53,45,127,45,53,45,127,46,54,46,127,46,54,46,127,46,54,46,127,45,53,45,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,37,44,37,127,76,86,76,127,73,82,73,127,32,39,32,127,23,29,23,127,2,2,2,127,30,34,30,95,105,118,105,64,98,111,98,64,0,0,0,95,4,3,2,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,!
 41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,115,88,38,127,92,71,31,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,0,0,0,127,0,0,0,64],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,21,24,21,127,55,62,55,127,51,57,50,127,64,72,64,127,86,96,86,127,85,95,85,127,84,94,84,127,86,96,86,127,84,95,84,127,82,92,82,127,75,85,75,127,52,60,52,127,46,54,46,127,46,54,46,127,45,53,45,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,29,36,29,127,28,34,28,127,24,30,24,127,62,71,62,127,88,99,88,127,66,75,66,127,24,30,24,127,8,11,8,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,105,81,35,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,!
 41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,100,76,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,107,82,36,127,0,0,0,127,0,0,0,64],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,31,36,31,127,35,40,35,127,33,36,32,127,31,34,31,127,47,55,47,127,51,59,51,127,47,55,47,127,39,46,39,127,29,36,29,127,37,43,37,127,52,60,52,127,77,87,77,127,49,58,49,127,46,54,46,127,40,48,40,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,29,35,29,127,80,90,80,127,59,67,59,127,24,30,24,127,24,30,24,127,76,86,76,127,87,98,87,127,39,46,39,127,17,22,17,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,75,57,25,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,79,60,26,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,9!
 4,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,71,55,24,127,103,79,35,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,117,90,39,127,0,0,0,127,0,0,0,64],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,127,41,48,41,127,69,79,69,127,39,45,39,127,47,54,47,127,77,87,77,127,86,97,86,127,88,97,87,127,87,97,86,127,82,93,83,127,57,65,57,127,25,31,25,127,24,30,24,127,26,32,26,127,26,32,26,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,75,85,75,127,87,98,87,127,67,75,67,127,23,29,23,127,23,29,23,127,56,64,56,127,85,95,85,127,75,84,75,127,24,30,24,127,3,3,3,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,127,29,22,10,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,8,6,3,127,109,84,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41!
 ,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,6,5,2,127,107,82,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,0,0,0,127,0,0,0,64],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,12,15,12,127,45,53,46,127,48,56,48,127,65,72,63,127,98,81,79,127,123,119,119,127,117,108,108,127,94,79,76,127,88,88,80,127,64,73,64,127,24,30,24,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,35,41,35,127,86,96,86,127,87,98,87,127,61,69,61,127,23,29,23,127,24,30,24,127,46,53,46,127,84,94,84,127,87,98,87,127,55,63,55,127,10,12,10,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,92,71,31,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,75,57,25,127,0,0,0,127,52,40,17,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,1!
 27,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,12,9,4,127,0,0,0,127,109,84,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,14,11,5,127,0,0,0,95],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,22,26,22,127,30,37,30,127,23,29,23,127,41,40,35,127,91,73,72,127,113,103,103,127,100,75,75,127,87,58,58,127,83,72,66,127,54,63,55,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,30,25,127,34,41,34,127,69,78,69,127,81,91,81,127,34,41,34,127,25,31,25,127,23,29,23,127,61,69,61,127,82,92,82,127,75,85,75,127,82,92,82,127,24,29,24,127,1,1,1,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,127,23,18,8,127,119,91,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,121,92,40,127,17,14,6,127,0,0,0,127,2,2,1,127,96,73,32,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41!
 ,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,75,58,25,127,6,5,2,127,0,0,0,127,0,0,0,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,18,14,6,127,0,0,0,127],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,24,29,24,127,48,56,48,127,28,34,28,127,24,30,24,127,25,31,25,127,36,37,32,127,68,55,52,127,82,63,62,127,80,52,52,127,81,82,74,127,28,34,28,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,23,29,23,127,25,31,25,127,24,30,24,127,25,31,25,127,24,29,24,127,56,64,56,127,87,97,87,127,70,79,70,127,88,99,88,127,49,57,49,127,10,12,10,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,44,34,15,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,67,52,23,127,0,0,0,127,0,0,0,95,0,0,0,127,12,9,4,127,109,84,36,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94!
 ,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,100,76,33,127,33,25,11,127,0,0,0,127,0,0,0,127,0,0,0,95,0,0,0,127,107,82,36,127,117,90,39,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,31,24,11,127,0,0,0,127],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,14,16,14,127,81,91,81,127,72,81,72,127,43,51,43,127,23,29,23,127,24,30,24,127,23,30,24,127,23,30,23,127,25,31,25,127,26,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,26,32,26,127,32,39,32,127,30,37,30,127,24,30,24,127,25,31,25,127,25,31,25,127,25,32,25,127,83,93,83,127,77,86,77,127,87,97,87,127,80,90,80,127,22,27,22,127,1,1,1,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,46,35,15,127,121,92,40,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,96,73,32,127,4,3,2,127,0,0,0,95,0,0,0,0,0,0,0,32,0,0,0,127,12,9,4,127,98,75,33,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,!
 127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,96,73,32,127,40,31,14,127,2,2,1,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,32,0,0,0,127,0,0,0,127,0,0,0,127,2,2,1,127,16,12,5,127,25,19,9,127,33,25,11,127,46,36,16,127,56,43,19,127,61,47,21,127,77,59,26,127,84,65,28,127,92,71,31,127,107,82,36,127,115,88,38,127,122,94,41,127,122,94,41,127,39,30,13,127,0,0,0,127],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,18,21,18,127,83,93,83,127,89,100,89,127,71,81,71,127,54,61,54,127,37,44,37,127,24,30,24,127,23,29,23,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,24,30,24,127,42,50,42,127,70,79,70,127,87,98,87,127,74,83,74,127,28,35,28,127,25,31,25,127,24,30,24,127,42,49,42,127,76,86,76,127,86,97,86,127,88,99,88,127,41,49,41,127,11,14,11,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,27,21,9,127,105,81,35,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,98,75,33,127,12,9,4,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,2,2,1,127,58,44,19,127,113,87,38,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,!
 122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,105,81,35,127,63,49,21,127,21,16,7,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,16,12,5,127,6,5,2,127,0,0,0,95],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,13,17,13,127,61,70,61,127,85,96,85,127,89,100,89,127,88,98,88,127,77,87,77,127,60,67,60,127,26,32,26,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,25,31,25,127,12,16,12,127,12,15,12,127,40,46,40,127,80,90,80,127,80,89,80,127,34,40,34,127,24,30,24,127,23,29,23,127,51,59,51,127,88,99,88,127,86,97,86,127,76,85,76,127,22,27,22,127,1,2,1,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,4,3,2,127,59,46,20,127,111,85,37,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,119,91,40,127,65,50,22,127,4,3,2,127,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,95,0,0,0,127,4,3,2,127,44,34,15,127,80,62,27,127,111,85,37,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,122,94,41,127,12!
 2,94,41,127,122,94,41,127,121,92,40,127,100,76,33,127,75,57,25,127,48,37,16,127,18,13,6,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,127,0,0,0,64,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,127,19,23,19,127,46,53,46,127,64,72,64,127,80,90,80,127,85,96,85,127,74,84,74,127,28,34,28,127,25,31,25,127,25,31,25,127,25,30,25,127,25,31,25,127,25,31,25,127,25,31,25,127,17,21,17,127,1,3,1,127,0,1,0,127,0,0,0,127,9,11,9,127,51,59,52,127,82,93,83,127,45,52,45,127,23,29,23,127,24,30,24,127,59,67,59,127,88,99,88,127,85,96,85,127,30,37,30,127,12,15,12,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,4,3,2,127,42,33,14,127,82,63,28,127,107,82,36,127,103,79,35,127,84,65,28,127,54,41,18,127,12,9,4,127,0,0,0,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,10,8,3,127,25,19,9,127,31,24,11,127,31,24,11,127,31,24,11,127,31,24,11,127,18,14,6,127,35,27,12,127,105,81,35,127,80,62,27,127,54,41,18,127,29,22,10,127,6,5,2,127,0,0,0,127,0,0,0,127,0,0,0,127,!
 0,0,0,95,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,8,10,8,127,33,39,33,127,44,51,44,127,46,53,46,127,44,52,44,127,39,46,39,127,25,30,25,127,25,31,25,127,25,31,25,127,24,30,24,127,15,19,15,127,5,7,5,127,0,1,0,127,0,0,0,127,0,0,0,95,0,0,0,64,0,0,0,64,0,1,0,127,21,24,21,127,66,74,66,127,57,66,57,127,24,30,24,127,23,29,23,127,52,60,52,127,40,47,40,127,24,30,24,127,23,28,23,127,1,2,1,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,95,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,64,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,11,13,11,127,23,28,23,127,33,39,33,127,36,43,36,127,23,29,23,127,20,26,20,127,11,15,11,127,3,4,3,127,0,1,0,127,0,0,0,127,0,0,0,95,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,3,5,3,127,37,41,37,127,58,66,58,127,27,33,27,127,24,30,24,127,26,32,26,127,25,31,25,127,25,31,25,127,8,9,8,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,0,0,0,127,0,0,0,127,0,0,0,127,0,1,0,127,0,0,0,127,0,0,0,127,0,0,0,127,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,127,12,15,12,127,42,49,42,127,32,39,32,127,24,30,24,127,25,31,25,127,25,31,25,127,18,22,18,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,2,2,2,127,23,27,23,127,37,43,37,127,26,33,26,127,25,31,25,127,24,30,24,127,4,4,4,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,4,5,4,127,24,28,23,127,29,35,29,127,25,31,25,127,12,16,12,127,0,0,0,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0!
 ,0,0,0,0,0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,95,4,4,4,127,11,14,11,127,16,20,16,127,0,0,0,127,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,!
 0,0,0],
+	[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,32,0,0,0,64,0,0,0,127,0,0,0,32,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])
+	def __init__(self, childWidget, title):
+		"""Constructor.
+		
+		   @param title Header title.
+		"""
+		Decorator.__init__(self, childWidget)
+		self.title = title
+		self.border = 10
+		return
+	def draw(self, screenRectangle):
+		rect = screenRectangle[:]
+		rect[0] += self.border
+		rect[1] += self.border
+		rect[2] -= self.border
+		rect[3] -= self.border
+		# title
+		glColor3ub(210, 236, 210)
+		glRecti(rect[0],rect[3]-41,rect[2],rect[3]-17)
+		glColor3ub(50, 62, 50)
+		glRasterPos2i(rect[0]+126, rect[3]-34)
+		Blender.Draw.Text(self.title)
+		glRasterPos2i(rect[0]+127, rect[3]-34)
+		Blender.Draw.Text(self.title)
+		# logo
+		glRasterPos2i(rect[0]+1, rect[3]-48)	
+		glEnable(GL_BLEND)
+		glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA)
+		glDrawPixels(122, 48, GL_RGBA, GL_BYTE, OgreFrame.OGRE_LOGO)
+		rect[3] -= 60
+		glDisable(GL_BLEND)
+		# child
+		self.childWidget.draw(rect)
+		return
+	def getMaximumSize(self):
+		size = self.childWidget.getMaximumSize()[:]
+		size[0] += 2*self.border
+		size[1] += 2*self.border + 60
+		width = 2*self.border + Blender.Draw.GetStringWidth(self.title) + 85
+		if size[0] < width:
+			size[0] = width
+		height = 60 + 2*self.border
+		if size[1] < height:
+			size[1] = height
+		return size
+	def getMinimumSize(self):
+		size = self.childWidget.getMinimumSize()[:]
+		size[0] += 2*self.border
+		size[1] += 2*self.border + 60
+		width = 2*self.border + Blender.Draw.GetStringWidth(self.title) + 85
+		if size[0] < width:
+			size[0] = width
+		height = 60 + 2*self.border
+		if size[1] < height:
+			size[1] = height
+		return size
+	def getPreferredSize(self):
+		size = self.childWidget.getPreferredSize()[:]
+		size[0] += 2*self.border
+		size[1] += 2*self.border + 60
+		width = 2*self.border + Blender.Draw.GetStringWidth(self.title) + 85
+		if size[0] < width:
+			size[0] = width
+		height = 60 + 2*self.border
+		if size[1] < height:
+			size[1] = height
+		return size
+
+class RoundedPanel(Widget):
+	def __init__(self, radius, color):
+		self.radius = radius
+		self.color = color
+		return
+	def draw(self, screenRect):
+		glEnable(GL_BLEND)
+		glColor4ub(*self.color)
+		if (((screenRect[2]-screenRect[0]) < 2*self.radius)
+			or ((screenRect[3]-screenRect[1]) < 2*self.radius)):
+			# drawing area to small for round edges
+			glRecti(*screenRect)
+		else:
+			glBegin(GL_POLYGON)
+			# upper left
+			glVertex2i(screenRect[0], screenRect[3] - self.radius)
+			glVertex2i(screenRect[0] + self.radius, screenRect[3])
+			# upper right
+			glVertex2i(screenRect[2] - self.radius, screenRect[3])
+			glVertex2i(screenRect[2], screenRect[3] - self.radius)
+			# lower right
+			glVertex2i(screenRect[2], screenRect[1] + self.radius)
+			glVertex2i(screenRect[2] - self.radius, screenRect[1])
+			# lower left
+			glVertex2i(screenRect[0] + self.radius, screenRect[1])
+			glVertex2i(screenRect[0], screenRect[1] + self.radius)
+			# close polygon
+			glVertex2i(screenRect[0], screenRect[3] - self.radius)
+			glEnd()
+		glDisable(GL_BLEND)
+		return
+
+class Selectable(Model):
+	"""Keeps track of selection status.
+	"""
+	def __init__(self, selected):
+		Model.__init__(self)
+		self.selected = selected
+		return
+	def isSelected(self):
+		return self.selected
+	def setSelected(self, selected):
+		self.selected = selected
+		self._notify()
+		return
+	def select(self):
+		self.selected = 1
+		self._notify()
+		return
+	def deselect(self):
+		self.selected = 0
+		self._notify()
+		return
+	
+class SelectableLabel(Widget, View):
+	def __init__(self, selectable, string):
+		"""Constructor.
+		
+		   @param selectable Model.
+		   @param string String to display.
+		"""
+		#Widget.__init__(self)
+		View.__init__(self)
+		self.string = string
+		self.selectable = selectable
+		# mouse focus indicator
+		self.mouseFocusX = 0
+		self.mouseFocusY = 0
+		# last drawing location
+		self.guiRect = [0, 0, 0, 0]
+		self.positionRect = [0, 0, 0, 0]
+		return
+	def draw(self, screenRectangle):
+		# get size of the GUI window to translate MOUSEX and MOUSEY events
+		guiRectBuffer = Blender.BGL.Buffer(GL_FLOAT, 4)
+		Blender.BGL.glGetFloatv(Blender.BGL.GL_SCISSOR_BOX, guiRectBuffer)
+		# replace element wise to avoid IndexError in eventFilter
+		self.guiRect[0] = int(guiRectBuffer.list[0])
+		self.guiRect[1] = int(guiRectBuffer.list[1])
+		self.guiRect[2] = int(guiRectBuffer.list[2])
+		self.guiRect[3]	= int(guiRectBuffer.list[3])
+		## differs by one:
+		## self.guiRect = Blender.Window.GetScreenInfo(Blender.Window.Types['SCRIPT'])[0]['vertices']
+		self.positionRect = screenRectangle
+		# draw panel and label
+		glEnable(GL_BLEND)
+		color = Blender.Window.Theme.Get()[0].get('ui').menu_back
+		glColor4ub(*color)
+		glRecti(*screenRectangle)
+		if (self.mouseFocusX and self.mouseFocusY):
+			color = Blender.Window.Theme.Get()[0].get('ui').menu_hilite
+		else: 
+			color = Blender.Window.Theme.Get()[0].get('ui').menu_item
+		glColor4ub(*color)
+		glRecti(screenRectangle[0], screenRectangle[1]+2, screenRectangle[2], screenRectangle[3]-2)
+		if self.selectable.isSelected():
+			color = [59, 89, 59, 128]
+			glColor4ub(*color)
+			glRecti(screenRectangle[0], screenRectangle[1]+2, screenRectangle[2], screenRectangle[3]-2)
+		color = Blender.Window.Theme.Get()[0].get('ui').menu_text
+		glColor4ub(*color)
+		glRasterPos2i(screenRectangle[0]+4, screenRectangle[1]+7)
+		Blender.Draw.Text(self.string)
+		glDisable(GL_BLEND)
+		return
+	def eventFilter(self, event, value):
+		"""Left mouse click on the label toggles selection status.
+		"""
+		if (value != 0):
+			# check focus
+			if (event == Blender.Draw.MOUSEX):
+				if ((value >= (self.guiRect[0] + self.positionRect[0]))
+					and (value <= (self.guiRect[0]) + self.positionRect[2])):
+					# redraw if widget got focus
+					if (not self.mouseFocusX) and self.mouseFocusY:
+						Blender.Draw.Redraw(1)
+					self.mouseFocusX = 1
+				else:
+					# redraw if widget lost focus
+					if self.mouseFocusX and self.mouseFocusY:
+						Blender.Draw.Redraw(1)
+					self.mouseFocusX = 0
+			elif (event == Blender.Draw.MOUSEY):
+				if ((value >= (self.guiRect[1] + self.positionRect[1]))
+					and (value <= (self.guiRect[1] + self.positionRect[3]))):
+					# redraw if marker got focus
+					if (not self.mouseFocusY) and self.mouseFocusX:
+						Blender.Draw.Redraw(1)
+					self.mouseFocusY = 1
+				else:
+					# redraw if marker lost focus
+					if self.mouseFocusX and self.mouseFocusY:
+						Blender.Draw.Redraw(1)
+					self.mouseFocusY = 0
+			# check selection
+			elif ((event == Blender.Draw.LEFTMOUSE)
+				and self.mouseFocusX and self.mouseFocusY):
+				self.selectable.setSelected(1 - self.selectable.isSelected())
+		return
+	def getMinimumSize(self):
+		return [Blender.Draw.GetStringWidth(self.string), 11+12]	
+	def update(self):
+		Blender.Draw.Redraw(1)
+		return
+
+########################################################################################
+
+class Logger:
+	"""Logs messages and status.
+	
+	   Logs messages as a list of strings and keeps track of the status.
+	   Possible status values are info, warning and error.
+	   
+	   @cvar INFO info status
+	   @cvar WARNING warning status
+	   @cvar ERROR error status
+	"""
+	INFO, WARNING, ERROR = range(3)
+	def __init__(self):
+		"""Constructor.
+		"""
+		self.messageList = []
+		self.status = Logger.INFO
+		return
+	def logInfo(self, message):
+		"""Logs an info message.
+		
+		   @param message message string
+		"""
+		self.messageList.append(message)
+		return		
+	def logWarning(self, message):
+		"""Logs a warning message.
+		
+		   The status is set to <code>Logger.WARNING</code> if it is not already <code>Logger.ERROR</code>.
+		   
+		   @param message message string
+		"""
+		self.messageList.append("Warning: "+message)
+		if not self.status == Logger.ERROR:
+			self.status = Logger.WARNING
+		return
+	def logError(self, message):
+		"""Logs an error message.
+		
+		   The status is set to <code>Logger.ERROR</code>.
+		   
+		   @param message message string
+		"""
+		self.messageList.append("Error: "+message)
+		self.status = Logger.ERROR
+		return
+	def getStatus(self):
+		"""Gets the current status.
+		
+		   The status can be
+		   <ul>
+		   <li><code>Logger.INFO</code>
+		   <li><code>Logger.WARNING</code>
+		   <li><code>Logger.ERROR</code>
+		   </ul>
+		   
+		   @return status
+		"""
+		return self.status
+	def getMessageList(self):
+		"""Returns the list of log messages.
+		
+		   @return list of strings
+		"""
+		return self.messageList
+
+# global logger instance
+exportLogger = Logger()
+
+class ExportSettings:
+	"""Global export settings.
+	"""
+	def __init__(self):
+		self.path = os.path.dirname(Blender.Get('filename'))
+		self.doProperties = 0
+		self.rotX = BoundedValueModel(-1000, 1000, 90)
+		self.rotY = BoundedValueModel(-1000, 1000, 0)
+		self.rotZ = BoundedValueModel(-1000, 1000, 0)
+		#self.load()
+		return
+	def load(self):
+		"""Load settings from registry, if available.
+		"""
+		settingsDict = Registry.GetKey('ogredotscene', True)
+		if settingsDict:
+			if settingsDict.has_key('path'):
+				self.path = settingsDict['path']
+			if settingsDict.has_key('doProperties'):
+				self.doProperties = settingsDict['doProperties']
+			if settingsDict.has_key('rotX'):
+				self.rotX.setValue(settingsDict['rotX'])
+			if settingsDict.has_key('rotY'):
+				self.rotY.setValue(settingsDict['rotY'])
+			if settingsDict.has_key('rotZ'):
+				self.rotZ.setValue(settingsDict['rotZ'])
+		return
+	def save(self):
+		"""Save settings to registry.
+		"""
+		settingsDict = {}
+		settingsDict['path'] = self.path
+		settingsDict['doProperties'] = self.doProperties
+		settingsDict['rotX'] = self.rotX.getValue()
+		settingsDict['rotY'] = self.rotY.getValue()
+		settingsDict['rotZ'] = self.rotZ.getValue()
+		Registry.SetKey('ogredotscene', settingsDict, True) 
+		return
+
+# Blender.Window.FileSelector does not accept type 'instancemethod' callbacks
+# set this to the instancemethod callback
+fileSelectorCallbackMethod = None
+def fileSelectorCallback(fileName):
+	"""FileSelector needs callback of PyFunction_Type
+	"""
+	fileSelectorCallbackMethod(fileName)
+	return
+
+class ObjectExporter(Model):
+	"""Interface. Exports a Blender object to Ogre.
+	"""
+	def __init__(self, object, enabled=1, children=None):
+		"""Constructor.
+		   
+		   @param object Blender object to export.
+		   @param enabled Only enabled objects are exported.
+		   @param children List of child ObjectExporters
+		"""
+		Model.__init__(self)
+		# blender object
+		self.object = object
+		# export status
+		self.enabled = enabled
+		# list of child ObjectExporters
+		self.children = children or []
+		return
+	def isEnabled(self):
+		return self.enabled
+	def setEnabled(self, enabled):
+		self.enabled = enabled
+		self._notify()
+		return
+	def getBlenderObject(self):
+		return self.object
+	def addChild(self, objectExporter):
+		self.children.append(objectExporter)
+		self._notify()
+		return
+	def removeChild(self, objectExporter):
+		if objectExporter in self.children:
+			self.children.remove(objectExporter)
+			self._notify()
+		return
+	def getChildren(self):
+		return self.children
+	def export(self, sceneExporter, fileObject, indent=0, parentTransform=Blender.Mathutils.Matrix([1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1])):
+		"""Append node element for this object and all enabled childrens into a given file.
+		
+		   @param sceneExporter Blender sceneExporter
+		   @param fileObject already opened XML file.
+		   @param indent indentation in the XML file.
+		   @param parentTransform transformations are exported in this coordinate system.
+		"""
+		if self.isEnabled():
+			fileObject.write(self._indent(indent) + "<node name=\"%s\">\n" % self.object.getName())
+			# create transformation matrix relative to parent
+			objectMatrix = self.object.getMatrix("worldspace")
+			euler = self.object.getEuler()
+			Mathutils.RotateEuler(euler, 1.57, 'x')
+			self.object.setEuler(euler)
+			objectMatrix = self.object.getMatrix("worldspace")
+			Mathutils.RotateEuler(euler, -1.57, 'x')
+			self.object.setEuler(euler)
+			inverseParentMatrix = Blender.Mathutils.Matrix(*parentTransform)
+			inverseParentMatrix.invert()
+			matrix = objectMatrix*inverseParentMatrix
+
+			# position
+			fileObject.write(self._indent(indent+1) + \
+							"<position x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % tuple(matrix.translationPart()))
+			# rotation
+			rot = matrix.toQuat()
+			fileObject.write(self._indent(indent+1) + \
+							"<rotation qx=\"%.6f\" qy=\"%.6f\" qz=\"%.6f\" qw=\"%.6f\"/>\n" % (rot.x, rot.y, rot.z, rot.w))
+			# scale
+			rot.inverse()
+			inverseRotationMatrix = rot.toMatrix()
+			inverseRotationMatrix.resize4x4()
+			scale = matrix*inverseRotationMatrix
+			fileObject.write(self._indent(indent+1) + \
+							"<scale x=\"%.6f\" y=\"%.6f\" z=\"%.6f\"/>\n" % (scale[0][0], scale[1][1], scale[2][2]))
+			# specifics
+			self.writeSpecificNodeElements(sceneExporter, fileObject, indent+1)
+			# logic properties
+			self.writeUserData(sceneExporter, fileObject, indent+1)
+			for child in self.children:
+				child.export(sceneExporter, fileObject, indent+1, self.object.getMatrix("worldspace"))
+			fileObject.write(self._indent(indent)+"</node>\n")
+		else:
+			for child in self.children:
+				child.export(sceneExporter, fileObject, indent, parentTransform)
+		return
+	def writeSpecificNodeElements(self, sceneExporter, fileObject, indent=0):
+		"""Virtual method to write node elements that depend on the object type.
+		
+		   This method is called before the node element is closed. Overwrite
+		   this method in derived classes for specific object types.
+		"""
+		return
+	def propertyFilter(self, property):
+		"""Filter properties that should not be exported as user data.
+		
+		   @param property the property to test.
+		   @return <code>1</code> if filter applies, otherwise <code>0</code>.
+		"""
+		return 0
+	def writeUserData(self, sceneExporter, fileObject, indent=0):
+		"""Writes object propreties as userDataReference.
+		"""
+		if ((sceneExporter.settings.doProperties) and len(self.object.getAllProperties())):
+			fileObject.write(self._indent(indent) + "<userData>\n")
+			for property in self.object.getAllProperties():
+				if (property and not(self.propertyFilter(property))):
+					fileObject.write(self._indent(indent + 1) + 
+						"<property type=\"%s\" " % property.getType() +
+						"name=\"%s\" " % property.getName() +
+						"data=\"%s\"/>\n" % str(property.getData()))
+			fileObject.write(self._indent(indent) + "</userData>\n")
+		return
+	# protected
+	def _indent(self, indent):
+		return "  "*indent
+
+class MeshExporter(ObjectExporter):
+	def __init__(self, object, enabled=1, children=None):
+		ObjectExporter.__init__(self, object, enabled, children)
+		return
+	def writeSpecificNodeElements(self, sceneExporter, fileObject, indent=0):
+		fileObject.write(self._indent(indent) + "<entity name=\"%s\" meshFile=\"%s\"" \
+			% (self.object.getName(), self.object.data.name + ".mesh"))
+		# static property
+		pList = [p for p in self.object.getAllProperties() if (p.getType() == "BOOL" and p.getName() == "static")]
+		if len(pList):
+			fileObject.write(" static=\"")
+			if pList[0].getData():
+				fileObject.write("true\"")
+			else:
+				fileObject.write("false\"")
+		fileObject.write("/>\n")
+		return
+	def propertyFilter(self, property):
+		filter = 0
+		if ((property.getType() == "BOOL") and (property.getName() == "static")):
+			filter = 1
+		if ((property.getType() == "BOOL") and (property.getName() == "noMeshExport")):
+			filter = 1
+		return filter
+
+class LampExporter(ObjectExporter):
+	def __init__(self, object, enabled=1, children=None):
+		ObjectExporter.__init__(self, object, enabled, children)
+		return
+	def writeSpecificNodeElements(self, sceneExporter, fileObject, indent=0):
+		lamp = self.object.data
+		fileObject.write(self._indent(indent) + "<light name=\"%s\" " % lamp.getName()) 
+		# type specific parameters
+		if (lamp.getType() & lamp.Types['Sun']):
+			self._writeSunNodeElements(sceneExporter, fileObject, indent)
+		elif (lamp.getType() & lamp.Types['Spot']):
+			self._writeSpotNodeElements(sceneExporter, fileObject, indent)
+		else:
+			self._writeLampNodeElements(sceneExporter, fileObject, indent)
+		# close light
+		fileObject.write(self._indent(indent) + "</light>\n")
+		return
+	def _attenuation(self, lamp):
+		# attenuation calculation:
+		#
+		# OpenGL attenuation factor f = 1/(c+l*r+q*r^2),
+		# where r is the distance between the light source and the vertex to be lit.
+		#
+		# Ignore Sphere option as it can't be mapped to Ogre settings.
+		# Note: Multiply lamp colors with Blender's energy factor e.
+		#       => here: e=1.0
+		c = 1.0
+		l = 0.0
+		q = 0.0
+		if (lamp.getMode() & lamp.Modes['Quad']):
+				# Blender's intensity:
+				# f = e*d(d+Q1*r)*d^2/(d^2+Q2*r^2)
+				#   = e*d^3/(d^3 + Q1*d^2*r + d*Q2*r^2 + Q1*Q2*r^3)
+				# => approximately
+				# c = d^3/(e*d^3)  = 1/e
+				# l = Q1/(e*d)
+				# q = Q2/(e*d^2)
+				l = lamp.getQuad1()/lamp.getDist()
+				q = lamp.getQuad2()/(lamp.getDist()*lamp.getDist())
+		else:
+			# no quad, no sphere
+			# Blender's intensity:
+			# f = e*d/(d+r),
+			# where e is energy and d is distance.
+			# =>
+			# c = d/(e*d) = 1/e, l = 1/(e*d), q = 0
+			l = 1.0/lamp.getDist()
+		return (c, l, q)
+	def _colourDiffuse(self, lamp):
+		if (lamp.getMode() & lamp.Modes['NoDiffuse']):
+			color = (0, 0, 0)
+		else:
+			e = lamp.getEnergy()
+			rgb = lamp.col
+			color = (e*rgb[0], e*rgb[1], e*rgb[2])
+		return color
+	def _colourSpecular(self, lamp):
+		if (lamp.getMode() & lamp.Modes['NoSpecular']):
+			color = (0, 0, 0)
+		else:
+			e = lamp.getEnergy()
+			rgb = lamp.col
+			color = (e*rgb[0], e*rgb[1], e*rgb[2])
+		return color
+	def _writeLampNodeElements(self, sceneExporter, fileObject, indent=0):
+		# LT_POINT
+		fileObject.write("type=\"point\">\n")
+		lamp = self.object.data
+		fileObject.write(self._indent(indent+1) + \
+			"<colourDiffuse r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourDiffuse(lamp))
+		fileObject.write(self._indent(indent+1) + \
+			"<colourSpecular r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourSpecular(lamp))
+		fileObject.write(self._indent(indent+1) + \
+			"<lightAttenuation range=\"5000.0\" constant=\"%f\" linear=\"%f\" quadratic=\"%f\"/>\n" \
+			% self._attenuation(lamp))
+		return
+	def _writeSpotNodeElements(self, sceneExporter, fileObject, indent=0):
+		# LT_SPOT
+		fileObject.write("type=\"spot\" ")
+		lamp = self.object.data
+		# castShadows="true" only if Modes['Shadows'] is set
+		if (lamp.getMode() & lamp.Modes['Shadows']):
+			fileObject.write("castShadows=\"true\">\n")
+			range = lamp.getClipEnd()
+		else:
+			fileObject.write("castShadows=\"false\">\n")
+			range = 5000.0
+		# points locally in -z direction
+		fileObject.write(self._indent(indent+1) + "<normal x=\"0.0\" y=\"0.0\" z=\"-1.0\"/>\n")
+		fileObject.write(self._indent(indent+1) + \
+			"<colourDiffuse r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourDiffuse(lamp))
+		fileObject.write(self._indent(indent+1) + \
+			"<colourSpecular r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourSpecular(lamp))
+		# OpenGL parameters:
+		# GL_SPOT_CUTOFF = spotSize/2.0
+		# GL_SPOT_EXPONENT = 128.0*spotBlend
+		# but Ogre::GLRenderSystem Class only uses outer parameter
+		#angle = lamp.getSpotSize()*math.pi/180.0
+		# angle in degree
+		angle = lamp.getSpotSize()
+		fileObject.write(self._indent(indent+1) + \
+			"<lightRange inner=\"%f\" outer=\"%f\" falloff=\"1.0\"/>\n" % (angle, angle))
+		fileObject.write(self._indent(indent+1) +"<lightAttenuation range=\"%f\" " % range)
+		fileObject.write("constant=\"%f\" linear=\"%f\" quadratic=\"%f\"/>\n" \
+			% self._attenuation(lamp))
+		return
+	def _writeSunNodeElements(self, sceneExporter, fileObject, indent=0):
+		# LT_DIRECTIONAL
+		fileObject.write("type=\"directional\">\n")
+		lamp = self.object.data
+		# points locally in -z direction
+		fileObject.write(self._indent(indent+1) + "<normal x=\"0.0\" y=\"0.0\" z=\"-1.0\"/>\n")
+		fileObject.write(self._indent(indent+1) + \
+			"<colourDiffuse r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourDiffuse(lamp))
+		fileObject.write(self._indent(indent+1) + \
+			"<colourSpecular r=\"%f\" g=\"%f\" b=\"%f\"/>\n" % self._colourSpecular(lamp))
+		return
+
+class CameraExporter(ObjectExporter):
+	def __init__(self, object, enabled=1, children=None):
+		ObjectExporter.__init__(self, object, enabled, children)
+		return
+	def writeSpecificNodeElements(self, sceneExporter, fileObject, indent=0):
+		# camera element
+		camera = self.object.data
+		fileObject.write(self._indent(indent) + "<camera name=\"%s\" " % camera.getName())
+		# fov calculation
+		render = sceneExporter.scene.getRenderingContext()
+		aspX = render.aspectRatioX()
+		aspY = render.aspectRatioY()
+		sizeX = render.imageSizeX()
+		sizeY = render.imageSizeY()
+		if (camera.getType()==0):
+			# perspective projection
+			# FOV calculation
+			#    .
+			#   /|
+			#  / |v = 16
+			# /a |
+			#.---'
+			#  u = lens
+			#
+			# => FOV = 2*a = 2*arctan(v/u)
+			#
+			# Blender's v is in direction of the larger image dimension.
+			# Ogre's FOV is definied in y direction. Therefore if 
+			# SizeX*AspX > SizeY*AspY the corresponding v in y direction is
+			# v_y = v*(SizeY*AspY)/(SizeX*AspX).
+			fovY = 0.0
+			if (sizeX*aspX > sizeY*aspY):
+				fovY = 2*math.atan(sizeY*aspY*16.0/(camera.getLens()*sizeX*aspX))
+			else:
+				fovY = 2*math.atan(16.0/camera.getLens())
+			# fov in degree
+			fovY = fovY*180.0/math.pi
+			# write fov
+			fileObject.write("fov=\"%f\"" % fovY)
+			fileObject.write(" projectionType=\"perspective\">\n")
+		else:
+			# orthographic projection
+			# FOV calculation 
+			# 
+			# In Blender, the displayed area is scale wide in the larger image direction,
+			# where scale is a ortho camera attribute.
+			#
+			# Ogre calculates the with and height of the displayed area from the
+			# FOVy and the near clipping plane.
+			#    .
+			#   /|
+			#  / |y
+			# /a |
+			#.---'
+			#  n
+			# Here n = near clipping plane and a = FOVy/2.
+			#
+			# Hence y = scale/2 and FOVy = 2*atan(scale/(2*n)).
+			fovY = 0.0
+			if (sizeX*aspX > sizeY*aspY):
+				# tan(FOVx/2.0) = x/n = y*a/n,
+				# where a is the aspect ratio.
+				# It follows that s/(n*a) = y/n = tan(FOVy/2.0).
+				fovY = 2.0*math.atan(sizeY*aspY*camera.getScale()/(2.0*camera.getClipStart()*sizeX*aspX))
+			else:
+				fovY = 2.0*math.atan(camera.getScale()/(2.0*camera.getClipStart()))
+			# fov in degree
+			fovY = fovY*180.0/math.pi
+			# write fov
+			fileObject.write("fov=\"%f\"" % fovY)
+			fileObject.write(" projectionType=\"orthographic\">\n")
+		# normal
+		# Blender's camera normal always points in -z direction locally.
+		fileObject.write(self._indent(indent + 1) + \
+			"<normal x=\"0.0\" y=\"0.0\" z=\"-1.0\"/>\n")
+		# default clipping
+		fileObject.write(self._indent(indent + 1) + \
+			"<clipping near=\"%f\" far=\"%f\"/>\n" % (camera.getClipStart(), camera.getClipEnd()))
+		# close camera
+		fileObject.write(self._indent(indent) + "</camera>\n")
+		return
+		
+class ObjectExporterFactory:
+	"""Creates ObjectExporter for different object types.
+	"""
+	def create(object, enabled):
+		"""Creates ObjecteExporter for the given Blender object.
+		
+		   @param object Blender object to export
+		   @return ObjectExporter on success, <code>None</code> on failure.
+		"""
+		exporter = None
+		if (object.getType() == "Mesh"):
+			exporter = MeshExporter(object, enabled)
+		elif (object.getType() == "Lamp"):
+			exporter = LampExporter(object, enabled)
+		elif (object.getType() == "Camera"):
+			exporter = CameraExporter(object, enabled)
+		elif (object.getType() == "Empty"):
+			exporter = ObjectExporter(object, enabled)
+		elif (object.getType() == "Armature"):
+			exporter = None
+		return exporter
+	create = staticmethod(create)
+
+class ObjectExporterTree(Model):
+	"""Creates tree of ObjectExporter for a Blender scene.
+	"""
+	ENABLEALL, ENABLENONE, ENABLESELECTION = range(3)
+	def __init__(self, scene, enable=ENABLESELECTION):
+		"""Constructor.
+		
+		   @param scene Blender.Scene.
+		   @param enable Initial export status.
+		"""
+		Model.__init__(self)
+		self.rootExporterList = []
+		# create exporter tree
+		# key: object name, value: ObjectExporter
+		exporterDict = {}
+		# 1.) create ObjectExporters for all exportable scene objects
+		selectedList = []
+		if Blender.Object.GetSelected():
+			selectedList = [object.getName() for object in Blender.Object.GetSelected()]
+		for object in scene.getChildren():
+			enabled = 0
+			if (enable == ObjectExporterTree.ENABLESELECTION):
+				if object.getName() in selectedList:
+					enabled = 1
+			elif (enable == ObjectExporterTree.ENABLEALL):
+				enabled = 1
+			exporter = ObjectExporterFactory.create(object, enabled)
+			if exporter:
+				# register object
+				exporterDict[object.getName()] = exporter
+		#  2.) create tree structure
+		for exporter in exporterDict.values():
+			# search for an exportable parent
+			object = exporter.getBlenderObject().getParent()
+			searchCompleted = 0
+			while not searchCompleted:
+				# object a Blender.Object (possible parent) or none
+				if object:
+					parentName = object.getName()
+					if exporterDict.has_key(parentName):
+						# exportable parent found
+						exporterDict[parentName].addChild(exporter)
+						searchCompleted = 1
+					else:
+						# try next possible parent
+						object = object.getParent()
+				else:
+					# exporter object has no exportable parent
+					self.rootExporterList.append(exporter)
+					searchCompleted = 1
+		return
+	def export(self, sceneExporter, fileObject, indent=0, parentTransform=Blender.Mathutils.Matrix([1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1])):
+		for exporter in self.rootExporterList:
+			exporter.export(sceneExporter, fileObject, indent, parentTransform)
+		return
+	def enableAll(self):
+		for exporter in self:
+			exporter.setEnabled(1)
+		self._notify()
+		return
+	def enableNone(self):
+		for exporter in self:
+			exporter.setEnabled(0)
+		self._notify()
+		return
+	def invertEnabled(self):
+		for exporter in self:
+			exporter.setEnabled(1 - exporter.isEnabled())
+		self._notify()
+		return
+	def enableLayer(self, layer):
+		#TODO
+		self._notify()
+		return
+	def disableLayer(self, layer):
+		self._notify()
+		#TODO
+		return
+	def __iter__(self):
+		return ObjectExporterTree.ObjectExporterTreeIterator(self)
+	class ObjectExporterTreeIterator:
+		def __init__(self, objectExporterTree):
+			self.stack = objectExporterTree.rootExporterList[:]
+			return
+		def next(self):
+			exporter = None
+			if len(self.stack):
+				exporter = self.stack.pop()
+				self.stack.extend(exporter.getChildren())
+			else:
+				raise StopIteration
+			return exporter
+
+class ProgressListener:
+	def __init__(self):
+		self.percent = 0.0
+		self.string = ''
+		self.viewList = []
+		return
+	def addView(self, view):
+		self.viewList.append(view)
+		return
+	def removeView(self, view):
+		if view in self.viewList:
+			self.viewList.remove(view)
+		return
+	def progress(self, percent, string):
+		self.percent = percent
+		self.string = string
+		# update views
+		self._notify()
+		return
+	# private
+	def _notify(self):
+		"""Notify views.
+		"""
+		for view in self.viewList:
+			view.update()
+		return
+
+class ProgressListenerView(Widget):
+	def __init__(self, progressListener):
+		self.listener = progressListener
+		self.listener.addView(self)
+		return
+	def update(self):
+		Blender.Draw.Redraw(1)
+		return
+
+class ProgressListenerProgressBar(ProgressBar, ProgressListenerView):
+	def __init__(self, progressListener):
+		ProgressListenerView.__init__(self, progressListener)
+		ProgressBar.__init__(self)
+		return
+	def update(self):
+		self.progress(self.listener.percent, self.listener.string)
+		ProgressListenerView.update(self)
+		return
+
+class ProgressListenerDoneButton(Button, ProgressListenerView):
+	def __init__(self, progressListener, action, name, size, tooltip=None):
+		ProgressListenerView.__init__(self, progressListener)
+		Button(self, action, name, size, tooltip)
+		if (self.listener.percent >= 100):
+			self.done = 1
+		else:
+			self.done = 0
+		return
+	def update(self):
+		if (self.listener.percent >= 100):
+			self.done = 1
+			ProgressListenerView.update(self)
+		return
+	def draw(self, rect):
+		if self.done:
+			Button.draw(self, rect)
+		return
+
+class SceneExporter:
+	"""Exports a scene to a dotScene XML file.
+	"""
+	def __init__(self, scene, settings, enable=ObjectExporterTree.ENABLESELECTION):
+		"""Constructor.
+		
+		   @param scene Blender.Scene.
+		   @param settings ExportSettings.
+		   @param enable Initial export status.
+		"""
+		self.scene = scene
+		self.settings = settings
+		self.tree = ObjectExporterTree(scene, enable)
+		return
+	def export(self):
+		"""Export the scene to dotScene XML file.
+		"""
+		# open scene xml file
+		#fileName = self.scene.getName() + ".xml"
+		fileName = "kanalisation.scene"
+		fileObject = open(os.path.join(self.settings.path, fileName), "w")
+		self._write(fileObject)
+		fileObject.close()
+		return
+	def addProgressListener(self, listener):
+		self.progressListenerList.append(listener)
+		return
+	def removeProgressListener(self, listener):
+		if listener in self.progressListenerList:
+			self.progressListenerList.remove(listener)
+		return
+	# private
+	def _progress(self, percent, string):
+		"""Report progress to the attached ProgressListeners.
+		"""
+		for listener in self.progressListenerList:
+			listener.progress(percent, string)
+		return
+	def _write(self, fileObject):
+		"""Write XML scene into the fileObject.
+		"""
+		# header
+		fileObject.write("<scene formatVersion=\"0.2.0\">\n")
+		# nodes
+		self._writeNodes(fileObject, 1)
+		# externals (material file)
+		self._writeExternals(fileObject, 1)
+		# environment
+		self._writeEnvironment(fileObject, 1)
+		# footer
+		fileObject.write("</scene>\n")
+		return
+	def _writeNodes(self, fileObject, indent=0):
+		fileObject.write(self._indent(indent) + "<nodes>\n")
+		# default: set matrix to 90 degree rotation around x-axis
+		# rotation order: x, y, z
+		# WARNING: Blender uses left multiplication!
+		rotationMatrix = Mathutils.RotationMatrix(self.settings.rotX.getValue(), 4, 'x')
+		rotationMatrix *= Mathutils.RotationMatrix(self.settings.rotY.getValue(), 4, 'y')
+		rotationMatrix *= Mathutils.RotationMatrix(self.settings.rotZ.getValue(), 4, 'z')
+		self.tree.export(self, fileObject, indent+1, rotationMatrix)
+		fileObject.write(self._indent(indent) + "</nodes>\n")
+		return
+	def _writeExternals(self, fileObject, indent=0):
+		fileObject.write(self._indent(indent) + "<externals>\n")
+		fileObject.write(self._indent(indent + 1) + "<item type=\"material\">\n")
+		fileObject.write(self._indent(indent + 2) + "<file name=\"%s\"/>\n" % (self.scene.getName()+".material"))
+		fileObject.write(self._indent(indent + 1) + "</item>\n")
+		fileObject.write(self._indent(indent) + "</externals>\n")
+		return
+	def _writeEnvironment(self, fileObject, indent=0):
+		self.scene.makeCurrent() 
+		world = Blender.World.GetCurrent()
+		if world:
+			fileObject.write(self._indent(indent) + "<environment>\n")
+			# can only get the active world of the current scene
+			if (world.mode & 1):
+				# Mist enabled
+				# Color = f*pixelColor + (1-f)*fogColor
+				#
+				# Blender's f factor:
+				# f = (1 - g((z - mistStart)/mistDepth))*(1-mistIntensity)
+				# where
+				# g(x)=x^2 for Qua,
+				# g(x)=x for Lin,
+				# g(x)=sqrt(x) for Sqr
+				# and z is the distance of the pixel to the camera.
+				#
+				# OpenGL's f factor:
+				# f = exp(-(density*z)) for GL_EXP,
+				# f = exp(-(density*z)^2) for GL_EXP2,
+				# f = (end - z)/(end - start) = (1 - (z - start)/(end - start)) for GL_LINEAR
+				#
+				# Assume depth and intensity is small and linear approximate
+				# all Blender mist types, i.e. ignore intensity and type.
+				mist = world.getMist() 
+				fileObject.write(self._indent(indent + 1) + \
+					"<fog linearStart=\"%f\" linearEnd=\"%f\" mode=\"linear\">\n" \
+					% (mist[1], mist[1]+mist[2]))
+				fileObject.write(self._indent(indent + 2) + \
+					"<colourDiffuse r=\"%f\" g=\"%f\" b=\"%f\"/>\n" \
+					% tuple(world.getHor()))
+				fileObject.write(self._indent(indent + 1) + "</fog>\n")
+			# ambient color
+			fileObject.write(self._indent(indent + 1) + \
+							"<colourAmbient r=\"%f\" g=\"%f\" b=\"%f\"/>\n" \
+							% tuple(world.getAmb()))
+			# horizon color
+			fileObject.write(self._indent(indent + 1) + \
+							"<colourBackground r=\"%f\" g=\"%f\" b=\"%f\"/>\n" \
+							% tuple(world.getHor()))
+			fileObject.write(self._indent(indent) + "</environment>\n")
+		return
+	def _indent(self, indent):
+		return "  "*indent
+
+########################################################################################
+class ExportAction(Action):
+	def __init__(self, sceneExporter):
+		self.sceneExporter = sceneExporter
+		return
+	def execute(self):
+		ExportAction.WaitScreen().activate()
+		#for f in os.listdir(full_path):
+		#	try:
+		#		os.remove(full_path+"\\"+f)
+		#	except:
+		#		pass
+		self.sceneExporter.export()
+		objects = Blender.Scene.GetCurrent().getChildren()
+		objects2 = []
+		for o in objects:
+			if hasProperty(o, "noMeshExport")==0:
+				objects2.append(o)
+		export(objects2)
+		ExportAction.DoneScreen().activate()
+		#try:
+		#	hero = Blender.Object.Get ('Hero')
+		#	heroPos = hero.getLocation()
+		#	heroPosString = "$hero.getActor().placeIntoScene([" + `heroPos[0]` + ", " + `heroPos[2]` + ", " + `-heroPos[1]` +"]);\n"
+		#except:
+		#	print "You should place an 'Hero'-Object. Default-Location (0, 0, 0) is used."
+		#	heroPosString = "$hero.getActor().placeIntoScene([0.0, 0.0, 0.0]);\n"
+		#scriptFile = open(rastullah_path + kanalisation_subpath + "scripts\\maps\\kanalisation.rb")
+		#lines = []
+		#for line in scriptFile:
+		#	lines.append(line)
+		#lines[17] = heroPosString
+		#scriptFile.close()
+		#scriptFile = open(rastullah_path + kanalisation_subpath + "scripts\\maps\\kanalisation.rb", "w")
+		#scriptFile.writelines(lines)
+		#scriptFile.close()
+		return
+	class WaitScreen(Screen):
+		def __init__(self):
+			global exportLogger
+			Screen.__init__(self)
+			self.addWidget(Label("Exporting, please wait!"), 'label')
+			i = 0
+			print exportLogger.getMessageList()
+			for x in exportLogger.getMessageList():
+				print x
+				self.addWidget(Label(x), 'label'+i)
+			
+			return
+
+	class DoneScreen(Screen):
+		def __init__(self):
+			Screen.__init__(self)
+			vLayout = VerticalLayout()
+			vLayout.addWidget(Label("Scene Exported!"), 'label1')
+			vLayout.addWidget(Label(" "), 'label2')
+			vLayout.addWidget(Label("Note: Don't forget to export all mesh objects with the ogreexport.py script."), 'label3')
+			vLayout.addWidget(Spacer([0,0], [Widget.INFINITY, Widget.INFINITY], [Widget.INFINITY, Widget.INFINITY]),'space')
+			hLayout = HorizontalLayout()
+			hLayout.addWidget(Button(ExportAction.QuitAction(), 'Quit without starting RL', [200, 30]),'quitButton')
+			hLayout.addWidget(Spacer([5.0,5.0], [5.0, 5.0], [5.0, 5.0]),'space')
+			hLayout.addWidget(Button(ExportAction.RLAction(), 'Quit and start RL with Map', [200, 30]),'RLStartButton')
+			vLayout.addWidget(hLayout,'buttonPanel')
+			self.addWidget(OgreFrame(vLayout, 'dotScene Exporter'),'ogreFrame')
+			return
+	class QuitAction(Action):
+		def __init__(self):
+			return
+		def execute(self):
+			Blender.Draw.Exit()
+			return
+	class RLAction(Action):
+		def __init__(self):
+			return
+		def execute(self):
+			oldpath = os.getcwd()
+			os.chdir(rastullah_path)
+			os.spawnl(os.P_NOWAIT, rastullah_path+"Rastullah.exe", "--module kanalisation")
+			os.chdir(oldpath)
+			Blender.Draw.Exit()
+			return
+
+if (__name__ == "__main__"):
+	exportSettings = ExportSettings()
+	exportSettings.doProperties = 1
+	exportSettings.path = full_path
+	sceneExporter = SceneExporter(Blender.Scene.getCurrent(), exportSettings)
+	exportAction = ExportAction(sceneExporter)
+	sceneExporter.tree.enableAll()
+	exportAction.execute()
+	
\ No newline at end of file



From tanis at mail.berlios.de  Wed Jul  2 21:53:55 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Wed, 2 Jul 2008 21:53:55 +0200
Subject: [Dsa-hl-svn] r4415 - tools/blender_scripts
Message-ID: <200807021953.m62Jrt0m017400@sheep.berlios.de>

Author: tanis
Date: 2008-07-02 21:53:53 +0200 (Wed, 02 Jul 2008)
New Revision: 4415

Modified:
   tools/blender_scripts/ogrelevelexport_kanalisation.py
Log:
Fixed an error in exporter.

Modified: tools/blender_scripts/ogrelevelexport_kanalisation.py
===================================================================
--- tools/blender_scripts/ogrelevelexport_kanalisation.py	2008-07-02 19:45:39 UTC (rev 4414)
+++ tools/blender_scripts/ogrelevelexport_kanalisation.py	2008-07-02 19:53:53 UTC (rev 4415)
@@ -3090,13 +3090,13 @@
     if OGRE_MESH_UPGRADE != '':
         commandLine = OGRE_MESH_UPGRADE + ' "' + filename + '"'
         exportLogger.logInfo("Running OgreMeshUpgrade: " + commandLine)
-        MeshUpgrade = os.popen(commandLine, 'r')
-        if MeshUpgrade == None:
+        meshUpgrade = os.popen(commandLine, 'r')
+        if meshUpgrade == None:
             exportLogger.logError('Could not run MeshUpgrade!')
         else:
             for line in MeshUpgrade:
                 exportLogger.logInfo("OgreMeshUpgrade: " + line)
-            xmlConverter.close()
+            meshUpgrade.close()
     return
 
 def write_materials():



From tanis at mail.berlios.de  Wed Jul  2 21:59:51 2008
From: tanis at mail.berlios.de (tanis at mail.berlios.de)
Date: Wed, 2 Jul 2008 21:59:51 +0200
Subject: [Dsa-hl-svn] r4416 - tools/blender_scripts
Message-ID: <200807021959.m62JxpfI018075@sheep.berlios.de>

Author: tanis
Date: 2008-07-02 21:59:49 +0200 (Wed, 02 Jul 2008)
New Revision: 4416

Modified:
   tools/blender_scripts/ogrelevelexport_kanalisation.py
Log:
fix of last fix.

Modified: tools/blender_scripts/ogrelevelexport_kanalisation.py
===================================================================
--- tools/blender_scripts/ogrelevelexport_kanalisation.py	2008-07-02 19:53:53 UTC (rev 4415)
+++ tools/blender_scripts/ogrelevelexport_kanalisation.py	2008-07-02 19:59:49 UTC (rev 4416)
@@ -3094,7 +3094,7 @@
         if meshUpgrade == None:
             exportLogger.logError('Could not run MeshUpgrade!')
         else:
-            for line in MeshUpgrade:
+            for line in meshUpgrade:
                 exportLogger.logInfo("OgreMeshUpgrade: " + line)
             meshUpgrade.close()
     return



From alassion at mail.berlios.de  Wed Jul  2 22:59:16 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 22:59:16 +0200
Subject: [Dsa-hl-svn] r4417 - modules/kanalisation/maps
Message-ID: <200807022059.m62KxG7a022771@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 22:58:59 +0200 (Wed, 02 Jul 2008)
New Revision: 4417

Removed:
   modules/kanalisation/maps/Circle.mesh
   modules/kanalisation/maps/Cube.003.mesh
   modules/kanalisation/maps/Cube.008.mesh
   modules/kanalisation/maps/Cube.009.mesh
   modules/kanalisation/maps/Cube.010.mesh
   modules/kanalisation/maps/Cube.013.mesh
   modules/kanalisation/maps/Cube.032.mesh
   modules/kanalisation/maps/Cube.mesh
   modules/kanalisation/maps/Plane.002.mesh
   modules/kanalisation/maps/Plane.mesh
   modules/kanalisation/maps/boden_fels.001.mesh
   modules/kanalisation/maps/boden_fels.002.mesh
   modules/kanalisation/maps/boden_komplett.mesh
   modules/kanalisation/maps/brocken.mesh
   modules/kanalisation/maps/bruecke.mesh
   modules/kanalisation/maps/brunnen.mesh
   modules/kanalisation/maps/durchbruch.mesh
   modules/kanalisation/maps/durchbruch_02.mesh
   modules/kanalisation/maps/fackeln.001.mesh
   modules/kanalisation/maps/fackeln.002.mesh
   modules/kanalisation/maps/fackeln.003.mesh
   modules/kanalisation/maps/fackeln.004.mesh
   modules/kanalisation/maps/fackeln.mesh
   modules/kanalisation/maps/farn.mesh
   modules/kanalisation/maps/felswaende.mesh
   modules/kanalisation/maps/gaenge_komplett.017.mesh
   modules/kanalisation/maps/gaenge_komplett.mesh
   modules/kanalisation/maps/grasbueschel.mesh
   modules/kanalisation/maps/kana_lights.rlmap.xml
   modules/kanalisation/maps/kanalisation.material
   modules/kanalisation/maps/kanalisation_scene.xml
   modules/kanalisation/maps/kisten_01.mesh
   modules/kanalisation/maps/moderbalken_01.mesh
   modules/kanalisation/maps/pilze.001.mesh
   modules/kanalisation/maps/randsteine_01.mesh
   modules/kanalisation/maps/randsteine_02.mesh
   modules/kanalisation/maps/randsteine_03.001.mesh
   modules/kanalisation/maps/randsteine_03.002.mesh
   modules/kanalisation/maps/randsteine_03.mesh
   modules/kanalisation/maps/randsteine_04.001.mesh
   modules/kanalisation/maps/randsteine_04.mesh
   modules/kanalisation/maps/raum_01.mesh
   modules/kanalisation/maps/rostkette.mesh
   modules/kanalisation/maps/saeule_01.002.mesh
   modules/kanalisation/maps/saeule_01.003.mesh
   modules/kanalisation/maps/saeule_01.011.mesh
   modules/kanalisation/maps/saeule_01.mesh
   modules/kanalisation/maps/saeule_05.mesh
   modules/kanalisation/maps/saeule_06.mesh
   modules/kanalisation/maps/saeule_07.003.mesh
   modules/kanalisation/maps/saeule_07.mesh
   modules/kanalisation/maps/saeule_08.mesh
   modules/kanalisation/maps/saeule_09.004.mesh
   modules/kanalisation/maps/saeulen.004.mesh
   modules/kanalisation/maps/smuggler.mesh
   modules/kanalisation/maps/stuetzbalken.mesh
   modules/kanalisation/maps/stuetzpfeiler_quer.mesh
   modules/kanalisation/maps/stuetzwand.mesh
   modules/kanalisation/maps/torboegen.002.mesh
   modules/kanalisation/maps/treppe_01.mesh
   modules/kanalisation/maps/treppe_02.mesh
   modules/kanalisation/maps/treppe_gemauert.mesh
   modules/kanalisation/maps/tuern.mesh
   modules/kanalisation/maps/wand_03.mesh
   modules/kanalisation/maps/wand_04.mesh
   modules/kanalisation/maps/wurzeln_02.mesh
   modules/kanalisation/maps/wurzeln_alle.mesh
   modules/kanalisation/maps/wurzeln_klein.mesh
Log:
- deleted -

Deleted: modules/kanalisation/maps/Circle.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/Cube.003.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/Cube.008.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/Cube.009.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/Cube.010.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/Cube.013.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/Cube.032.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/Cube.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/Plane.002.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/Plane.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/boden_fels.001.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/boden_fels.002.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/boden_komplett.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/brocken.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/bruecke.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/brunnen.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/durchbruch.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/durchbruch_02.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/fackeln.001.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/fackeln.002.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/fackeln.003.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/fackeln.004.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/fackeln.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/farn.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/felswaende.mesh
===================================================================
--- modules/kanalisation/maps/felswaende.mesh	2008-07-02 19:59:49 UTC (rev 4416)
+++ modules/kanalisation/maps/felswaende.mesh	2008-07-02 20:58:59 UTC (rev 4417)
@@ -1,316 +0,0 @@
-
-
-
-
-		
-			  !!!" #!#$!!$"$%"#&$&'$$'%'(%))**++),*,-**-+-.+,/-/0-.-1-010/2/3202124156768795:57:78;8<;:7=7;=>9?9:?@>A>?A?:B:=BA?C?BC;<D<ED=;F;DFDEGEHGFDIDGIB=J=FJCBKBJKJFLFILJLKLMKN@O@AOPNQNOQOARACRQOSORSTPUPQUVTWTUWUQXQSXWUYUXYRCZCKZSR[RZ[ZK\KM\[Z]Z\]XS^S[^YX_X^_^[`[]`_^a^`abVcVWcbcdcedcWfWYfecgcfgdeheihhijikjegigliilklmkfYnY_ngfofnon_p_aponqnpqlgrgorlrmrsmrotoqtsrurtuGHvHwvIGxGvxvwywzyxv{vy{IxLx|LL|M|}Mx{|{~||~}~}yz?z??{y?y??????????????{?~??~~??6
??????????????????????????????????????????????????????????????????????????????????????????????????????????
-?		
-?
-?
-????
-???????? ? ??!? ! ""! # "#
-
-
-
-
-
-	
-		?
-
-
-
-  !!"""#!$"$%""%#%&#'#'('(#&'&)'('*')*$+%+,%%,&,-&+.,./,,/-/0-&-)-1)*)2)121-3-032141345(5556(*5*755767866699 9: 6898;99;:;<:*272=77=8=>8=2?24?=?>?@>;8A8>A<;B;AB>@A@CABADACDEFGFHGIEJEGJGHKHLKJGMGKMNIOIJOPNQNOQOJRJMRKLSLTSMKUKSUSTVTWVUSXSVXRMURUYUXZUZYPQ[Q\[][^[\^^\_\`_]^a^baabcbdc^_b_ebbedefd_`g`hghigijg_gegkeekfklfkgmgjmlknkmnWoVopVVpXpqXorprsppsqs
?)?)	???Q?1?=???At??????@??????I????JB?>Vc?>u?~????<	G????Aj?.????@?b?4K?>?Ai????>O???R?E??=??a?`?A3s?Kw?@(&?s?F?aR<?ta(??=1?vX?????<
-*?J?A~?a?L??@ q??]???l????>??3???t????=??????A*S>??@????ND???/O????X?P?j?l?}?'=?w???A?f'???@?????"??=t??6J???w?{?t???=????A	H>h??@@?????.?K?}=???S??.R?A<? ?w?Azm&?V?@?b??{??)V???t?w???k?'%<??????]@?:1?b?W@#?=????XY????>?-?>A?? d????)=??f@???\?A@/?N>1??>sGc?
-?R@9??7?3 at N??>?&7???#???>??????=??$?*?B?a?:@?]???G2@?C?>?$1?N?????>iT,??T?=b>??O?0-?@V????1c?b???hc?????L?y?m ???5
-=???>	?o???@???????k????]???u? ~R??????=<??>`w?57?@????'?Y???j???u???*??d???x???q????/>6|?2??@??B??@@????mXk???$??*?>N(x?s??? =>
-v{?G?@t???3@sw??v??b?=F?>??k??2I?????c~?(??@???M?$@:#???A??>???>?Z?????=	???w?N<A5???+@?F?J??B[N>$H?>P?5???"=????pv??A???~?7@??:??x-????=?U?>?X? ??aY???y?Y
-A:?(?~Q@FB?><?j?=?u????>??W??!?? K>s?w?#?@??D?j?L@?????E????#??>??l????=
-??=?}??pw?:?A*o???????>?k?????????:??o????=&/~???	A??????4@???>?**?od?	7I>?????>?0???F???AV~@VL@??>q^?q?<?/?=???????????}?G?=
-????;??<?jK???z?????i???{?[X9>?|8=??E?????<????????3{????><?i???}?U??=???????>I???8??=qS??	???}?~W?>?)????????<???R(??5???'?=??	?4???N?~??mB?????????D???????????k=?
-????=Q?U?s??>X?s?RSW?`	C=??	?"?q@4?~??>'23??
-?>? e???????>V
-|??O?=C?&>?k@??(??r?>h???-Z?>??^?u=????>?i?@0?=|?>N?t@?;??#?>?B*?er?>?Up?$????>%o|??Ea=?? >??h@???>?D?>o?W?S>N?T??????>?M[?}"?=?(
-??A?<$&?A-V?To?	P???N????=)??<??@N??????]2>>?????Y???)?????_N{???>???????J?@?W?=??1;?????H?x?@??c??;=???;f?????????==a	?.???i?x?<?????~??n????(??@A???@??=? ????)??j?B?
-1????a?,??I?h???9{??n?g<R??F"??K}??Xx?pBi??y???g??+????%@?_>??????-???{???J??c*??V?={?u???K>?`@?;>w?}<"??w/?;??>?d?????z??<]i?<OZ@?w@?)>???=???3R??>?~??`(~??f????"UP??H???]?=^???Y2??J?}?A+
-?3x???#==C?<???"x?h?0??~?????J-=???<.&??(??a?$=?q??? ??B???0?o??
-[????=??????:??<???=?1>??|? ?w????>??u???O>?=???#??<Z??"V=k??=h?}?2?A???>ut?????g=6?:>??o???bS?s???
-??N~?????m?=?????????v??I?=^I?>w???E=????Ct?????[D?=u/=?u=N?t?w??>????h?<?'=t?&?????S=0cJ=^?=?U~?t?A??'?>??h??<?CA=?????W?????=???92?m?`????w??A?<??~?'??=???;?|2?z?????=G?<xBo?]???`A???<1~???=???<?$?<??	???<?"Z=?b?=?}?du????>???)?S<-fU=)"??V??V??=`
-Lw??0D??8y???`>??=?d?(??Qi?=??'??X|??*A??bC??Gz??J>o??=u???,???C??S?=???%|?]w?????s??>s?>?k????????f=??a?Ly?,?@?????
-o{??'>???=Ee???"??W{?ocs??:R??z??	?W?B??t???d??R??O?o?/5??Z4?????9???\u???
-??6??P?~??C???????>Fx???i?;??+???73~?p??>	?A??<{??c*??7??G?>???r??R;?ur6?8?w??e?>x?????u?N at 6?0?[???Y?x????:=?.?{?<???>=?=w?@???{???1?0?$??ZP??g
-??P=??3???5???{?G??=0h??u???f??L9?????@???@cBL=??>_?}?H?x?@??-???Gj;?O=??u??G????@D?=?R,>?z?i?x?<???3-~?c?^;???=???>o?@a??@?=??E>3nz?j?B?
-1??I6???e;Ef?=wN?>?I????@c??=?g>n?w??mB????2~???X;???=eQh?+??????@??K>??>;?w??Xx?pBi?t?z???I;?N>??>z????@?@?$>??$>?Hy??7B?vi???|??3W;X?'>>^????@og?@?<2?>w?{???J??????Sn;???<jK???J??X??@??-<0??>??v??L????????p;ehE<?K?????u?~@
-?G<?IW>9Bz?????i?"??'?;;?'V<??o?@a??@BU????>w?;??>?d?????vy~;JtX??X??I????@???????>?v?~W?>?)??G~?P??;!	??z?*?z????@?@???2;[>?uu????><?i??S{??*?;c?B?3???@???@?????F>?Xy??>?~??H1~?=?;?????!???G????@1z^??U>at?A+
-q?:h?;?l???????<?M?@E????h=?u??I?=^I?>?nu?F??;??????~?U?;??@???=8?{???}?t?w??>b?}?<;M??=m?>2????@lZI>]R????y?t?A??'?>%?z?????U1K>W??<???}??@r>?Cu=l?|???w??A?<:}?i??;?$>f?>?????`?@s?W>mr>?Uw??`A???<8z??b?;?$[>?l??e?@?2^>??????w?du????>??y?}?`?3?a>????y?????@(c\>??J>??t?????$?<??y???|?S?]>??1?w?
-Lw??0D???r???=???>4H?>???9~@???>?#o>?qk??*A??bC???q????<???>qVp?@???2?@???>?A?=?ph?]w???G%h?s?t=???>?9?>)>
-?K=y@b?>?"?=E/s?,?@??????Mt?4??<S{?>?1??'??/mu@??;{L>??z??	?W?B???????2?P????v
-?Dq@????gC?=Dk}???
-??6????? ?M???
-?8?W???)|@????cb=?)p?p??>	?A?x?o??s?????-?9????V{@????D?{=Am??e?>x???^Nl?????X????%???Z???0?@??????????v?>=?=w?@??v??|???~?????????/(?@"n??bY?4d?G??=0h???}d??!p?????d???????(?@?????~??b?=S????L?3c?`|??_?~??}?8????)?@?b8?un?o??>??3????UT?????'?n????"???D??@??????{???&>??????5?}P?fj#?
-b|??:????n?@??O#q?0??>c-?5?8??)???V??2[s?????S???~I?@?E>?pq?u????<???????>Kv??I????????@9??=?D???????<?5??s??u??<??~???w?x???4?f@????B?????2?>????6????>C?k??J?????&Qf@???>??Z?\:F???	>?.2??n????*>?'{?8.s??~@K@?*?
-?>??b8=S?b>????rB????W?]??X???OK@(|&??B?cR={?k>??,????D5???P?/1??"U???3 at 8J
-?7??>{?>??>???>??=?8??o?g?]3!?Gs????2@?5	?P
-=?o-?????=2?????~??,?ge??'???^??=??}?`??@?0??o-??N?=???=&?}????????0q??
-??=??~?T??????Y??C?<??}?????[D????:??x=?
-v??E?>??o=el?a?H??h????u?[5>=???V?d@?n?>?Ql??	>+P>GrM?|n???b??7}??c>Y???C?I at Y??>a?-C?<0??>?=J????;T*??e??1???SZ??V?a@?<?W|??B,>p?(>`g?M7??Hd,?@K|???g?Yi???*F@??f~?S???K?>H?d?#I]=@??=z?}??^?$b?????@k??>^?r??!>???U????????C?0z?jh??v??6/?@??Y>XSy?9??=	?6?????8u@?`k??+?~??4^?@???m?{@C?=???*<???=}w?????<?>?W??????Y???V??@A?\>??y??A?<??.?K???R)????????s???????!?@?I>??u?#?N>X??????????6?i??Sw????? a??~W|@$Dy=??|?=???o?=?U??JQ?=?>?U|?znM?{???L^@}?A?-_{???;?l0>@????<z"?????B?"????A at 3n??Z?l?y?o?Q/?>B???+?=;?Y>@?x??1??????]]@??o??Zt?>B=?l at 4>l!???x?=??,>?X{??E??35?? '@@??????k???]?m??>%\?????=??F>??y????>#???/@???>??u??????>S^G????<?5='??L??>????vS@??=~??
-?Q>??y?????????[?@(?.?;|??A=???>Dic?????w??????_?>?+?????t?*>?e|??<b??8M??|??<?_??@?????>uw??k???rG>?x???
-??N5?<PG??Ng=I?>??|?<.??ZI?????yv?I*?9a?=k???]?Fd?O?????Jy??????????1?=P4?}~<? 8??e?7???ge???S~?t?A?>????%@[????o???`?$??>px??u!?=/?K>C?y?O?>?????,?	@s?\???y?:"={
-?Jp??^?>F?8?
-d???2???????p???=?]??B#L???j>?}w?@3????X??4S?c?g?9?=s9~?
-?B>??u?{O?}???}W??>1?m>v??????????9?"?>??m??1??????s?64f>[??>l?a??0-???5????>??j????????o?s??&{>>?>og????Zg???%<?k?????{??Q5>?NV?1????n??D1??Bz????????e
-K>?QU?E???????????Dz??w??I???D??>8KY??1y????=??q?T??+?K??w??	?~??~??5????sa?R??=?x??r[?????4?????&> ?i>H?u?H?v??F??+l??P>??m?????T???????b?>??>WYf?????
-????????!??%{?3???
-????????=?.?=?	~??????#???<?*y?V?j??6???@???
->Q???I?}??T_???????@??z?-
->??>q???'?????>??1;
-????????$D?????}??m'???P?&?@H??????
-????r<?u??????J6?;?m?5A(??5???????u???=???LQR??U
-@????????Q<~??L ??w$?$??=??~????<=???u?????=?????4????|??IE???'??????w?di?????H??T
-=??X=?????l?/?o=?[J??z?????????=c{??R?=???k???bh??`???L?{?=(L?????J???z?i????=???-????0f?????X??S j??????????%?}???<??
->c)??	T??z?>??|?|}??Q??????2=??}?q??=eR??|???????58??u{????}??0??h??t?????p??>H??????>&??)0??????]Xr????N???*1=??Z?6<??M??????b??Q?I?#???l?~?I?)?C????p-?F
-u?S7??h>????/???o=k>?s??$y?.?Xr?t????v???6>+N?I/??y@????2??:?-?x???9A[???G??@x?>Q?z?O?
->w???????l?u;?????}?n?9A?[????@5??=?a{?u"!>????$_????k;??!???|??2A?J?????@?>?uy???5>6???r??ZW?;M?6?$?{???2A???n??@5B?=ex???d>N???????p&?;??d???y?<?9Ap_??m?@C?>>?jz????=??:?{g????T:??????~??$3A]4???E?@xB?>1Ay???>Z?G??^???`k;X????}?hI,Az
-?@{?
-1i@??d>??x?r?=?Q?J???^@?;,????|?9A?9???IJ@?Kg>?x?JB?=??=?o??;?:<?O???z?<W3A+????yN@?sw>??w?-"?=WA?=?6????!<?Q??Pi?w?,A]???xk@?	Y>`?x? b?=$Dy???%??y?;?????`~??-A\????~Q@?R>??y??q?=l??=??'?>SD<?q???\??%A???????@?A{=(,u?R??>????{?????E??<????u??%A9??????@??=?q????>m??9?E<??x??????r?~8&A:?????@
-??>?]???E<N?8?????.:A=???h^@?qA>ML{?lB?<!x?>????|#<????????3Ac???@?bC>?G{??4<???>?8???[?;??????-Al???0c5@?)A>ML{?8??<?v>??&?E?0<Y???b??+-AW?????@_y >1?|??c}?>?#%?'??:x	=	??:A:A????kf??*?$>E?|???	?($?????"??:?@=?????3A?????????I>?f}?s??1?????	?T:?P=????$:A?R??=,??F
->??{?)???amP??u???}??l?=??~?x3A???;??????=?}??"??iWM??T??P???@??=??~???,A????N??3?=?}?S#t??????"??r???tt=???(?,A`[??q????y><?|?WB??5	J????7??????=7?~?H?&A?????+7 at Vb????~??o=}Ak>???? ?<Ar?0??{&A????2Y@k?h=??
-M>oa>
-l??I??sI??oK>?.?@??>a?p??A?P??c???!>??p??=???%???](>?/?????>?r?I&Ab??:??@c=??}?Y?>K??[??>?
-??>??9}?>TA???????@w???o?RF?>f-?????>?	(?#????~o???A???@?@?L???x?????#@???>??~<>?=q ~?
-A??????@7o?>??-??n"??B?>1??Zh>?6!??C??A?P???,???r?=?g{?3?!???<????$??{/!>??|??TA??????????E=?q??b??f?D??N;?xa
-?>??p?|?A?????e???=??o???????????>B???C?>?p?6?A?\?????=???<\;q?S????????g?>?H??N??>YKq?K?A,??????u????n?>?????U??>%???0F?>O?n?_A??????
-?<?ey?Q?f?cCg?=*???????f>`y???A=e??{??a?I?`?w?VJ??I?????6C??	M>??w?x?A>???:?p????B^s??R????m?,?9?%?!????>??t??LA???????A2?w?s?T?????????9?????gW?>?Aw?}*A+????W?=???M?n??y??t`???+?{&H????>[?n??Q	A????v???@?[???j?g??!x???]"??<?????>??j?q?AZb???=W??s0o??1????????A?????>?Fq??%A|c????????fio?r?????????K?P?8???>rp???@? ??P??@?Q?~pv?@?f>!#????w?????Q.Z??x????@{???(?@?!????x???g>t_????|?????K`??x?J%?@??Z?}@>"?=??g??v?>Q????o??????.???tg?0??@{???(?@["W?
-	??|??;?h?!??>?v?J??@{??$	@J?"???A?	R??K???????$????>o?=??@????@k??*???I???u?4?'?d??????N?>??i?J??@{??7????????a?S"I?9_4?m????>`??T?=}?~?J??@{??o????e????s?i????[????????]?=?.~??e?@&???g~e?&s\?c?g??????v?L5g??-?<???>?m?o?@?b?????>?????9q?PS[?/????j??3???g>?\y??y?@A(???~?>??????r?B7?????v???Z_s?
-?
-??@?,????e@SY>x?y?"??=R(>?	&?k?<,P???p??x?@.?????i@??I>??y??r?=?P?=??b???B<[5??P?~????@???5|J at v?k>??x??q?=?7z>?<&??<< ?~??|????@S\???O@?Kh>??x?["?=Y5h>??d??AY<?????L??F?@:??w?k@??
->?c|??R?=?\>?uF=??<????~?A??@R??????@Z??S?x?aq>?v????$>?C?<q???x????@i???|??@?????x?t?{>??2???)>h?e<?$|??x?\W?@???????@?????{?Wz=>???<?<!>5??<}?=?F?{?G??@*??>??@?????%z??M>I??????>|?Y<??N???z?"??@????"?@??????x?mf>A0??@?>?8_<3?g??Xy?>h?@=?????@??F?`{??t<?J?<???>?=????x?????@G?????k@?!???~??1?=?p?=??>??<?Y????~?B|?@????R@;g???x??"q=?'X>vq>?<?D??`K????@???? ?i@?"??NGh?Tr?*??=??>?_?=?>w?|????@#???xQ@?W???X????pV>3??>bI=???%??G?@+????N-@??e>?y?#Y=1?>_&? AB<	?S??????@?i??Ra2@?jk>0?x???A=H??>B`e??%9<?(<???? S?@`????e@
-C>?:{???<???>??&????;????????@_B??A@??E>k*{??<???>?d????;???????@???6@?>?|???V=o?>?D=o]<?yP?????@@???=@??>K}?B
-??????'???:??N
-=]????@??????????>;m}??!?L??w?d???&??=Z???>?@?R??=,??F
->??{?)?????:?sL&???C??U?==?~????@???;???Rb?=C}????=?8??rb??d4?u??=Y?~????@n???????Q?=?!~?H2??I-??yO=????]??=???I?@?????u???=?~?Nb??.s6?6"X=??C????=?8~?X??@6\???7 at 1
-???{????=??>?j>?v<?h??yG~????@????j?@??<???
-u?8?k>?V?>?B?>?????wl??y?P?@-????e???A?=??|?c??UK??/!>0G
-??w>??}????@E????c??@??<??|?+??x?4???%>i1Y???>(?|?V??@???????.?=???Cu??$????>b??x?s=?????@????????R?=??x?M?b??2?Z?>?>??M?a>&?y???@????Q?M??>??{?Z???W??K$??i?@?>C?}?\?@??????P????=i?{?
-??W??qX??u??93>?}??\?@???/??>???=@?{?S???t?wf"?Y???`?>}????@9_??i?>z?N=??{?s/?)zt???K??v??An.>:9|???@??????U?'??<e6|??i.??V?M?c=?Y??.>?=|?
-?????g~?#??t|??q?1>}|??=?=?_~?P??@V??A?????<?i}????Q???;?>??e???> g}?r`?@&????`???A?<?5~?R???????>?>?r??I?=?;~???@vS??	??@??????~???Z=r7?????>???<??`?X??@??@????u?@:8??fx??Zw>?j.????>\n<??w??ax????@l???Q?@6rm?$q?4?y???<tA?>??=R?o>c=x??o@!??\X?@???=????g<d??z??>??$?y?k???kcm@$G?????@]2?=@r????>?1??:
->??????5???,?%??rV}??5@???I?@??,?r????>c-?5?8??f????`u?|7@&Q???b?@?b*=J??}????<?5?!????p=??~??CP at ir????f@???>??S??*??2?>????[??G??>5ya??
-O@?@~K@???>?*e???=S?b>???V!????????v6@?`????e@?>??]?Y?E???	>?.2? ????w(>?({??67@????B?J at f?#???B?.?={?k>??,?Oz?????}?2??@v????5@?????FL????>???>qr?>l?`?;???u?]?"??@X????@y?	?I?]????>OW?>r??>x1??????`???m@?
-?f?I????1?>c??>?u??????K???s@?l????@q
-;??&?@?B???-????=k~??b?=Q????>d????????~?a??@\??????????=?tx??Z??i.????>&o??&lY>!z??9u@???g???V?>??p?\??>???1_?>?2?<^???v?s??s@?????q??lz>??v??d?v,????>DN??j?c>??y??:\@S???????	?>p?k?
-H>T???=?7}=#YG?8?z?d?D at F?r?~????]?>	?w??=K??3?*????;:????f??@????h?t?(?8=uxt?t)???HO?e??>w???f??>??t????@?X??W??>??????z???J???n?sg?>_x`?L
->+P>GrM?yj?????P}?!@?????H at 3k?>i?e????=0??>?=J?>u???d?Ma}?#?@????p?`@???5y??:B>p?(>`g?;>???@??Y{???@????1E@?:1???{?Rb=?K?>H?d??????5?9??????{??A:?@???1??G=	?6??????~??=VD???????{???(?@
-d?????<c?=?A??d@&??%??>DQ???~?!????s??U??e?<???=?,??g?????B?T????	r?OZ??
-=
-??????p=
-??@?r??
-w??N?=?????y??S?=}?K???????0?y??@???m!<L?????????S????=?????mv???-?V;?@Z??2?=,d~?2>
-???4{>&a?@???<?c?=?}?????u?k??0?i??=??=?Hj?^gs>??@
-?r=?r?=wK~?p	??yo??~???=???=KV??]?K?[??@?"???k{>?7w?
-?????????~??}?=0]??8?e???P?6K?@T????q?=?????;UF??~????=?????$?@F
-?=$?h@???>!#<?=v?s+<??K?c?u?
-?>??l??j??2U???3v?????@??>?c?@X?#???{@&6?pz?>S[N???W??'????[??????>?F?@IG?}??@s??>P?>	Ne??????^???
-r??"???z?>???@???7a?@|??=??5>?{?????N??g?~??
->??<>?5y?W>??'???;}?????2?=wu?@??>??u@D?2?=d?Y?,b\?/T??Y????:?t??@?FA>Ta?@?"?>X8>Og??"??x)]??k????d??>???@r?????x@?R?>Y?d? ?W???_???)??^X?????W???/?@?7z????@???>d"%??.u?*t???3?8 at s?????>?>
->KR?c?%@?x(?Wp@~???n?>AbO?a??=??N?m?\P>?%?????U?????@a??RC[?j?e?KY??F{?>>?a??&>5o??D?v?z???JT?@fN????	?c}o???????>?+l??->v?????@P?:??b at ao?>'K]>?Z?.)???>!pa???
-?+|?>I??@?????^@qY??5?>??:?1??!?>R?N??d)????^.??????@?@??6r-??vT? &????T>??O?u?3>?[??z??????Q??@6r???bB???k?nR????>~wg??$R>??????A@<???k(A at u???^?=	?k?j?>X??=^-m?=C6=CX???"????U[?@????m?????O?r??@a=?tO?>36>?????????T?@?Q??????J?m??? ?B!>?vj?qs>9???	k?@tF??,B@??S???
-?Q?-?r>?????zQ??h@=/??,bn@I??C
-[????n?>,;?@?@?????@j??|Bv=][?)u???a?>?bZ??"???
-=??=:?A	N????@????>"????T???%?????r??<?v??J?AG?????@ ?9?????x?=????\`{?oF?<??????A"*??c?@S???????Uo?M??>?1|?:???&e=z??+4?@3??>?=?@?Y=l?>?}?9???J[????|=j{=???@}	u>9^?@<j?\>V?v?k???ZJ^???|????=??????@?.w>???@???>?B????_????=?Y?Kl????????>???@2<F????@??>,?J>?Ai?z??(?3???m?qj<?+?>G>?@?FO?bJ?@H???b>2Vw??????8?Y$}????=<???.?@V?W??[?@????<r?X?6?=?k6???X??3o?y???A ?N>?u?@n?>\????X????>'Y???}???]=???=]?At`i??<?@???>w-????m???>y?6?pfu?_ at d?E??>?Au?????@?'<]SP>??z???K?????????<?e?<BYA??????@???=za>Rx???I??z????~?R??;???=u?%A"l???@JBB>8J?>??f?7x??x????z??????O>??&A?????T?@V?Z>???>??i?By?g,??O|y???2??Ce>5'A??9??s?@x?,>??>j3r??y?J`{???{?%?k;??4>?n0A????K?@?"?>?3y>??s????s???C{????;??F>??/A1`??X:?@?	>O;|>.?u?V???q????W}?$i?<??>?W9A???????@??)>3?>??w?g???????<|???<?f0>?8AoK???H?@-"?=?"?=??|????"?????~????<K?=??1A?)????@?x>?>?Kn?)%??#?w???w?????bj?>?:A?`*???@]?}>?k>	?p?
-??7?m@?????????p?v??2?h=??k?6?F>????.??@?D??og?@???????[?j??v???p>=?f??}/>e??.?A?}??o\@?????a???v??.>??????s?Z$>?????Ax??>?U@
-+e>b?>?XY??A?>???=?Qy?o???>?Z>?AA??	??5S@?bL=???=?????>??6????FwU<kUP=3A%???g@~??>???>W?[????"?<?8d?=?F????>??(Ak?1? ?{@v???R?=$|?z?y?P????|??k=U7?-r*A????x@???<}?x>?@x?~9???\?>?????<YO?<s?2At?2??v?@qq?>???={fu?
-
-A$???Y?>??W?Y??>?r????>U?<?X?g]??(??="*A.S????>y?????>c?t?Z?????F???MT???=LAf1????>y?<,*?>]q?aS??X?<W????;"??
-=n	???^A??)????>???6>??{??O?h?_>???
-`?;2z<?c'Agb:??g>2??>?J?>?_?Su??w@>p?p??G?<a????/A1`??X?Q??9	>l#~>,?u??r???k??d?|???/=j???n0A????l???
-H>??>4?r??A????q=8?y?@?P=??[??8AoK??%]s?-"?=?"?=??|??D??_?????~?x??<?x???W9A????j?[?@?)>X:?>!?w?$?????=?{??Y?<?s2???1AP?)?l\??nN?>?"?>Lnl????1zn>wHu???.=h????:A?`*?????y?>cr>?&p?????Do>.%w????:?}????A?|[>?p?>}Zu?????vpx??xK?(??>x??VK<??u>(4'A??A>?+?>?m>?S_>??r?H?~?Q??>%?x?!~m;??s?wA?2T????>???????F\h?)ZE?|,?p;k??7????>b?'Ay?????&*?(?M?e??????>????;r$*=??2AqWO>UO>???>
-?s>?Qi??V??{??>;p?????????j?:A.?W>;?;??>U?2>?o????????>?s?r*_?z@???O2A?o}???^>2?>???=??j????????Hl?P??6??5;A??|???<???>??=?o?J??Ug?W8p??4??????@Na%???>>?????"d=>?m?D??5:?sMn?2
-@??RE????>
-?c?@??=?at?u?y????/Z\>?
-Ar1????>2"?=uv?>?d????>??9???}?|??<L?P?Anj$?$F?=^?J>?F?>??m?]?	?CY<?oox?!/?=cWl?daAiU???=_????=???mY?1??>?Iq???}????<>?RA@??????q>???u?N?F?y?j?A?x?e?y=?:i????@?^??d??<?!
-A?H???\?rj??V?P???n?P8?=z???<t???[?H?>?A???????J>t#?=??y?1??>\?????z???<fN?N?A??????J?\Z?>?bj>
-@??:~????m????? A?6???T?>??<???>(Iw?N*^???k???$??<
-a????=.~?=k=6?<9??0???????r??
-???K at dY???m?==???????d[~??:?>?????~??P=?W?=??C@??oe?<??T??R??>?x?)?>???=?vy? ??=0?\>+/v@????!?=???=t@????~?c???Z?P?~?"K7<?.??8.v@!X??0??=,??<?"*>?U|??j?_??=???G?;?V???7@??G??@??V???????*Y?-O>?j?>?i?M??=Bz?>
-???4{>I????+z>xc?=??v??????H?>??w???<$?}??Hj?^gs> ?8??='?=s?}?E???>Y??-?V<cw?I@???>????"Y>v???
-9>(w?????u?c?LX{?'F??"e@?N*?@D?????#?B>J{C>?v??????=ER{?????#?@?C??@??H?O$???>E?`>t	w??????;}>?X}??J??o????@9|??.=???>?2L>]?p?@kj?]??>Mv?on??????{??@V?????{???7=tb?=n?}??;???^????AG:?C9????@????mV????=k?'>??{????????=wb?#r??????,}?@V?????{??
->??<>?5y??????|?><?}?o????I??@.?Q>?'?=?A?=?J>??y??,?????>??~?>????+??R??@?S>?'>???>?q?>?m?#/k?b?>??r??@??????i??@???(?#>?ch>S@>??t??q?o,??My??)??Ff?W??@??q?L?A>?A?=??9>`?z?P??!?"?????i<?e??
-}#????@??h>mV???RD>zR?=?cz????????>A@{???????C??@??\?f?=6rM><??=??y?,??y? ???z?????x?M????@?a\?-???&??>*?o??)v?S?????$v?sYR?X???;?j???%?[?@?S"I?????+?,H???E???[???KC=	q???4$?&??:???=??=??~??!??oC??~?sf.??????@l%(?????p":=?}?>??s??u(???@???~?1i??L???D?v?z???????????????|??	???r???~??^1??d?=K???Wx???(A???}??b/??E??????Gr?8??sM??u=z?@@??(???D???????>&?8???O>h?7??=\?1+?=5?>?z???????PB?{??H?B${?n?S????}?,?V?>4i??@3??????G?/??q??;?{?!?a?'?????{?j0V??_,>??#?????t??:+?
-??1z????j????D|???Z??a%>?{?????l???_?["??]x?(W?^f?? ?y??Q??J[>!Y(@?e?/5>?)??>?R??Fk???>?????p??*????>@Z?@?0????>?g>?i+>H?u???y?e?B?})y??R??mk?<??@?c/?4?^>?!1>$B?=??z??????
-
-
-<+@
-Y??
-q?
-???<=??C>s =

-???>?4??
-??
-???SW??
-??fQE??Pt??m?
-=
-A?=

-?
-S??[?>
-=??q??/?<?
-?={2>
-?~???>
-	??\9??_??T>
-
-
-
-
->?T`=?P%>
-???,?,->
-`>o????\????=
-W=SI?
-=??????<APq?
-=H?X?2=V???C?
-??t?=
-?<?S;??M???'=
->
-?
->
-?D<?3N?????J?
-"?E{A>??
?
-???T?
-???F?

-=??X?
-?m?&2?>
-'<!?a???'<?>
-?/q?>
-??	?(>
-?<?S;??M??K8)>
-
-
-
-
-
-
-
-
-
-
-????>
-??=?z?>
-??t?=???
-?S??ko?^e?>

-???y~b?p???G?
-??`=qZ??????
-??
-?=
-?=?S??O#>
-????n?
-??[6?=???????
->??????S?,?b=
-=?#C?({?????
-
-
-
-
-???q???
-VO=?c?=?Tc?:?>
-y>
-=VI~?8</>
-?q9?<???f@
-
-
-?>x??????>
-
-
-
-
-"??/?@
-?=??<(?V????
-?=`??>??>?
-
-
->??m?<??>?W??
-
-
-
-
-
-
-
-
-
-
-=??|>??o?
-??
-?>?`??
-???
-l??
-??
-??`=?Z?>9??<
-w>
-????>@Z>
-??sz>?v?>
->?p]=??>?\?
-=W?>????
-2	??-??b?>???<
-J>
-??>???=
-=??>?Y?>A?_=
-?{?t>U??
->n?"<???>?zH?

-?
-9?<? ??
-F=A}?=?P>??
-w?
-
-
-
-
-
-
-


?

-

-
-
-
-
-
-
-
-


-

-
-


?

-
-
-
-
-
-
-
-
-
-
-
-
-


u

-
-
-
-
-
-
-
-
-
-
-

-
-
-
-
-
-
-
-
-
-
-
-

-
-
-


Z
\ No newline at end of file

Deleted: modules/kanalisation/maps/gaenge_komplett.017.mesh
===================================================================
--- modules/kanalisation/maps/gaenge_komplett.017.mesh	2008-07-02 19:59:49 UTC (rev 4416)
+++ modules/kanalisation/maps/gaenge_komplett.017.mesh	2008-07-02 20:58:59 UTC (rev 4417)
@@ -1,43 +0,0 @@
-
-
-
-
-
-
-???j?t?@?;W??l?)?>6?>
-QvA"r????YA???>?k???@????????7Df?,?=????;vAp??j?TAG?>??????X?u???Gs???Rb?)&
->T????A??????@A??r?	?,???>??@L??????>?W?>?pa????A?u????DA5?g??????O>??@5?????>???>GrH?"7yAS?@ []A/N?>('N???^+???@??L?h?O?=z,??F??A??
-PA?/!?&?6?????q?@?o???5&?3?%???c?A?	@?TA?9?&T0?%;????@?(???(@???&?jY??`}?A??@L?lA?	????H??
-??Z??sK??O?f???l?C????0?A??@?XA_??>??w?+???@??????T???????=|?Ap#??
-?pA????.X?,?@?dw??2w????c???~?h???
-???j?;?e>??5??:m????&?????A?$???t`A*??>J?O??6h??M?>?%?>??m?'??????]??A|?????jAk?i??i=>???>Y?=?e?>??>?????>j?l|?Ar??YoAA?i?a??=???>???=?4????>?/8>7yi????A?u????DA5?g??????O>~?1????>???=?????!u???A??????@A??r?	?,???>?s??v??>???>?">Qrq?M*?A ~~??87A?Y?>?>{n??k??"?>?.p???>0???%X?A???}?;AJ??>?q?>?4^?.8S??X>??c?
-L??S??F??A??
-??????r????A??-@?HA
-PA?/!?&?6?????1[?|G>????+?y<?)h???A?p5@??OA?|'?{0??:???A??=?<X???????4h?:?A77/@i?VA??>?Yn)?o?????>?*-=
-?s??>A?u??0?A??@?XA_??>??w?+??	?>??A>^'???>?2???AzR"@??]A?S???$??=?]?>??=??z???z>??w??
-?8e?>?3p?Y?>????m?A???.;>AK???h?S>?cd??????$?>>hi?c?_:N?>???Ahy????BA
-??????%?=??i?????n??>:?A77/@i?VA??>?Yn)?o??????>?????????>??b???A?p5@??OA?|'?{0??:????
-"?A?
-/@l
-
-
-
-
-
-
-?
-?A
-K>?A?>?n?>?r0?
-?A
-
-
-
-
-
-
-
-
-
-
-
-
\ No newline at end of file

Deleted: modules/kanalisation/maps/gaenge_komplett.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/grasbueschel.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/kana_lights.rlmap.xml
===================================================================
--- modules/kanalisation/maps/kana_lights.rlmap.xml	2008-07-02 19:59:49 UTC (rev 4416)
+++ modules/kanalisation/maps/kana_lights.rlmap.xml	2008-07-02 20:58:59 UTC (rev 4417)
@@ -1,50 +0,0 @@
-<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
-<rastullahmap formatVersion="0.4.0">
-	<nodes>
-		<light name="fackkellicht" type="point" visible="true"
-			castShadows="false">
-			<position x="-1.39" y="6.06" z="12.84" />
-			<colourDiffuse r="0.8" g="0.7" b="0.5" />
-			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="8" constant="0.79" linear="-0.21" quadratic="0.268" />
-		</light>
-		<light name="fackkellicht2" type="point" visible="true"
-			castShadows="false">
-			<position x="11.39" y="6.06" z="9.75" />
-			<colourDiffuse r="0.8" g="0.7" b="0.5" />
-			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="8" constant="0.79" linear="-0.21" quadratic="0.268" />
-		</light>
-		<light name="fackkellicht3" type="point" visible="true"
-			castShadows="false">
-			<position x="-22.48" y="4.60" z="23.10" />
-			<colourDiffuse r="0.8" g="0.7" b="0.5" />
-			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="8" constant="0.79" linear="-0.21" quadratic="0.268" />
-		</light>
-		<light name="fackkellicht4" type="point" visible="true"
-			castShadows="false">
-			<position x="36.49" y="7.37" z="30.27" />
-			<colourDiffuse r="0.8" g="0.7" b="0.5" />
-			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="8" constant="0.79" linear="-0.21" quadratic="0.268" />
-		</light>
-		<light name="fackkellicht5" type="point" visible="true"
-			castShadows="false">
-			<position x="59.78" y="7.14" z="28.66" />
-			<colourDiffuse r="0.8" g="0.7" b="0.5" />
-			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="8" constant="0.79" linear="-0.21" quadratic="0.268" />
-		</light>
-	</nodes>
-	<zones>
-		<zone name="default">
-			<light name="fackkellicht"/>
-			<light name="fackkellicht2"/>
-			<light name="fackkellicht3"/>
-			<light name="fackkellicht4"/>
-			<light name="fackkellicht5"/>
-			<light name="fackkellicht6"/>
-		</zone>
-	</zones>
-</rastullahmap>

Deleted: modules/kanalisation/maps/kanalisation.material
===================================================================
--- modules/kanalisation/maps/kanalisation.material	2008-07-02 19:59:49 UTC (rev 4416)
+++ modules/kanalisation/maps/kanalisation.material	2008-07-02 20:58:59 UTC (rev 4417)
@@ -1,324 +0,0 @@
-material wurzeln_02/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap baumstamm_kana.png
-set_texture_alias NormalMap baumstamm_kana_normal.png
-}
-material treppe_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material waende_raum_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material Material.009/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material saeulen_tempelgang/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material smuggler/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material grasbueschel/SOLID/TEX/grasbueschel_kana.png
-{ 
-   technique 
-   { 
-      pass 
-      { 
-      ambient 0.609804 0.609804 0.609804 1
-			diffuse 0.631373 0.631373 0.631373 1
-			specular 0 0 0 1 10
-                         // Rendert beidseitig 
-         cull_hardware none 
-         cull_software none 
-	 alpha_rejection greater 215 
-
-         texture_unit 
-         { 
-            texture grasbueschel_kana.png             
-	    filtering linear linear linear 
-         } 
-      } 
-   } 
-material stuetzwand/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material smuggler/SOLID/TEX/pflaster_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap pflaster_kana.png
-set_texture_alias NormalMap pflaster_kana_normal.png
-}
-material rostkette/SOLID/TEX/rust.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap rust_kana.png
-set_texture_alias NormalMap rust_kana_normal.png
-}
-material felswaende/SOLID/TEX/felsen2_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap felsen2_kana.png
-set_texture_alias NormalMap felsen_kana_normal.png
-}
-material tempelgang_treppe/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material randsteine_03/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material Material.007/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material randsteine_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material brunnen/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material torboegen/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material brocken/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material SOLID/TEX/pflaster_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap pflaster_kana.png
-set_texture_alias NormalMap pflaster_kana_normal.png
-}
-material wurzeln_texturen/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap baumstamm_kana.png
-set_texture_alias NormalMap baumstamm_kana_normal.png
-}
-material Material.015/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material Material.014/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material tempelgang_decke/SOLID
-{
-	technique
-	{
-		pass
-		{
-			diffuse 0.800000 0.800000 0.800000
-			specular 0.500000 0.500000 0.500000 12.500000
-		}
-	}
-}
-material saeulen_texturen/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material randsteine_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material boden_kana/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material farn/SOLID/TEX/farn.png
-{ 
-   technique 
-   { 
-      pass 
-      { 
-      ambient 0.609804 0.609804 0.609804 1
-			diffuse 0.631373 0.631373 0.631373 1
-			specular 0 0 0 1 10
-                         // Rendert beidseitig 
-         cull_hardware none 
-         cull_software none 
-	 alpha_rejection greater 215 
-
-         texture_unit 
-         { 
-            texture farn.png             
-	    filtering linear linear linear 
-         } 
-      } 
-   } 
-material treppe_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material sauelen_13/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material gaenge_komplett/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material saeulen_raum_01/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material tempelgang_waende/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material fackeln/SOLID
-{
-	technique
-	{
-		pass
-		{
-			diffuse 0.800000 0.800000 0.800000
-			specular 0.500000 0.500000 0.500000 12.500000
-		}
-	}
-}
-material boden_13/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material randsteine_04/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material tempelgang_randsteine/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material wurzeln_alle/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap baumstamm_kana.png
-set_texture_alias NormalMap baumstamm_kana_normal.png
-}
-material kisten_01/SOLID/TEX/kiste_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap kiste_kana.png
-set_texture_alias NormalMap kiste_kana_normal.png
-}
-material saeulen_raum_02.001/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material tempelgang_ende/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material boden_komplett/SOLID/TEX/boden_kana.png/VertCol: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap boden_kana.png
-set_texture_alias NormalMap boden_kana_normal.png
-}
-material wurzeln_klein/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap baumstamm_kana.png
-set_texture_alias NormalMap baumstamm_kana_normal.png
-}
-material stuetzbalken/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap baumstamm_kana.png
-set_texture_alias NormalMap baumstamm_kana_normal.png
-}
-material pilze/SOLID/TEX/pilz.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap pilz3.png
-set_texture_alias NormalMap pilz_normal.png
-}
-material Material.016/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material Material.017/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material tempelgang_decke/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material durchbruch_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material fackeln/SOLID/TEX/fackel_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap fackel_kana.png
-set_texture_alias NormalMap fackel_kana_normal.png
-}
-material stuetzpfeiler_quer/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap baumstamm_kana.png
-set_texture_alias NormalMap baumstamm_kana_normal.png
-}
-material saeulen_raum_01_02/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap saeule_kana.png
-set_texture_alias NormalMap saeule_kana_normal.png
-}
-material SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material boden_komplett.001/SOLID/TEX/boden_kana.png/VertCol: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap boden_kana.png
-set_texture_alias NormalMap boden_kana_normal.png
-}
-material saeulen_texturen/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
-material moderbalken_01/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap baumstamm_kana.png
-set_texture_alias NormalMap baumstamm_kana_normal.png
-}
-material durchbruch/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
-{
-set_texture_alias DiffuseMap wand_kana.png
-set_texture_alias NormalMap wand_kana_normal.png
-}
\ No newline at end of file

Deleted: modules/kanalisation/maps/kanalisation_scene.xml
===================================================================
--- modules/kanalisation/maps/kanalisation_scene.xml	2008-07-02 19:59:49 UTC (rev 4416)
+++ modules/kanalisation/maps/kanalisation_scene.xml	2008-07-02 20:58:59 UTC (rev 4417)
@@ -1,199 +0,0 @@
-<scene formatVersion="0.4.0">
-    <nodes>
-<entity name="saeule_06" meshfile="saeule_06.mesh">
-<position x="4.381933" y="4.065433" z="14.409163"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="tempelgang_saeulen" meshfile="saeule_01.011.mesh">
-<position x="86.45091" y="4.425117" z="25.15601"/><rotation qw="0.013434" qx="0.0" qy="0.99991" qz="3.98E-4"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="felsen_hoehle" meshfile="felswaende.mesh">
-<position x="30.294416" y="7.783535" z="26.360363"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="weg2_raum_02" meshfile="stuetzwand.mesh">
-<position x="0.0" y="-0.112965" z="64.74804"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="bruecke" meshfile="bruecke.mesh">
-<position x="2.822959" y="3.865546" z="7.881136"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="tempelgang_waende" meshfile="Cube.003.mesh">
-<position x="85.57365" y="0.0" z="34.131252"/><rotation qw="0.708878" qx="-2.82E-4" qy="0.705331" qz="2.81E-4"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="pilze" meshfile="pilze.001.mesh">
-<position x="6.899021" y="-0.0085" z="13.837756"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="tempelgang_ende" meshfile="Plane.mesh">
-<position x="100.34652" y="0.0" z="28.579805"/><rotation qw="0.707388" qx="0.706825" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="stuetzbalken" meshfile="stuetzbalken.mesh">
-<position x="38.6939" y="9.522685" z="30.678297"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="randsteine_04.001" meshfile="randsteine_04.001.mesh">
-<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="wand_durchbruch" meshfile="durchbruch.mesh">
-<position x="42.21736" y="7.263124" z="28.25212"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="Plane.005" meshfile="Plane.002.mesh">
-<position x="117.91695" y="0.0" z="-67.640434"/><rotation qw="0.705645" qx="-2.81E-4" qy="-0.708565" qz="-2.82E-4"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="kisten_smuggler" meshfile="kisten_01.mesh">
-<position x="4.292805" y="-9.415191" z="25.15733"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="wurzeln_03" meshfile="wurzeln_klein.mesh">
-<position x="3.815631" y="3.215424" z="3.961683"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="opferschrein" meshfile="Circle.mesh">
-<position x="90.470825" y="-0.240725" z="27.35746"/><rotation qw="0.705645" qx="-2.81E-4" qy="-0.708565" qz="-2.82E-4"/><scale x="0.640502" y="0.640502" z="0.640502"/>
-</entity>
-<entity name="gaenge_01.018" meshfile="gaenge_komplett.017.mesh">
-<position x="-11.712984" y="2.751104" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="tempelgang_randsteine" meshfile="Cube.009.mesh">
-<position x="94.63357" y="3.752965" z="32.216892"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="saeule_01" meshfile="saeule_01.mesh">
-<position x="7.874129" y="9.400857" z="16.403053"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="torboegen.002" meshfile="torboegen.002.mesh">
-<position x="-2.584131" y="2.751112" z="27.977468"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="boden_felswand" meshfile="boden_komplett.mesh">
-<position x="37.711838" y="5.930392" z="27.968113"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="tempelgang_decke" meshfile="Cube.mesh">
-<position x="94.64457" y="4.292408" z="25.715137"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="saeulen.002" meshfile="saeulen.004.mesh">
-<position x="0.743736" y="4.219784" z="8.508488"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="brocken" meshfile="brocken.mesh">
-<position x="45.444912" y="3.694921" z="29.209862"/><rotation qw="0.994933" qx="-3.96E-4" qy="-0.100537" qz="-4.0E-5"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="fackeln_g2.001" meshfile="fackeln.002.mesh">
-<position x="2.625504" y="3.107027" z="55.503487"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="fackeln_g2.002" meshfile="fackeln.003.mesh">
-<position x="2.625504" y="3.107027" z="59.728394"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="fackeln_g2.003" meshfile="fackeln.004.mesh">
-<position x="39.97495" y="5.598745" z="29.590656"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="saeulen_smuggler" meshfile="saeule_01.002.mesh">
-<position x="-27.566433" y="7.446745" z="22.737108"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="fackeln" meshfile="fackeln.mesh">
-<position x="15.234941" y="3.107023" z="15.800744"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="saeule_07" meshfile="saeule_07.mesh">
-<position x="1.174055" y="10.726652" z="6.341633"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="gaenge_01.019" meshfile="gaenge_komplett.mesh">
-<position x="-11.712984" y="2.751104" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="saeule_05" meshfile="saeule_05.mesh">
-<position x="7.897333" y="9.400856" z="3.944559"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="farn" meshfile="farn.mesh">
-<position x="-2.434886" y="-1.413306" z="2.648438"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="decke_raum_02" meshfile="Cube.013.mesh">
-<position x="4.733883" y="6.611897" z="56.931644"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="moderholz" meshfile="moderbalken_01.mesh">
-<position x="37.592186" y="5.74956" z="32.072422"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="durchbruch_02" meshfile="durchbruch_02.mesh">
-<position x="43.158157" y="6.466876" z="27.790565"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="saeule_07.003" meshfile="saeule_07.003.mesh">
-<position x="-21.940147" y="9.0571" z="25.939947"/><rotation qw="0.921111" qx="-3.67E-4" qy="0.389299" qz="1.55E-4"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="brunnen" meshfile="brunnen.mesh">
-<position x="140.5463" y="74.190155" z="378.74002"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="rostkette" meshfile="rostkette.mesh">
-<position x="11.600312" y="7.469563" z="10.76639"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="raum_02" meshfile="wand_03.mesh">
-<position x="4.733883" y="6.611897" z="56.931644"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="grasbueschel" meshfile="grasbueschel.mesh">
-<position x="-6.029057" y="3.39713" z="36.149834"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="saeule_08" meshfile="saeule_08.mesh">
-<position x="-1.495595" y="9.400857" z="12.471745"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="randsteine_03.001" meshfile="Cube.008.mesh">
-<position x="0.27986" y="1.563207" z="7.637593"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="randsteine_03.002" meshfile="randsteine_03.001.mesh">
-<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="randsteine_03.003" meshfile="randsteine_03.002.mesh">
-<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="smuggler_boden" meshfile="Cube.010.mesh">
-<position x="-21.569408" y="4.746182" z="26.013494"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="raum_01" meshfile="raum_01.mesh">
-<position x="-11.712984" y="2.751104" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="boden_felswand.002" meshfile="boden_fels.002.mesh">
-<position x="37.711838" y="5.930392" z="27.968113"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="wurzeln_02.002" meshfile="wurzeln_02.mesh">
-<position x="2.693319" y="4.398726" z="13.058824"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="randsteine_01" meshfile="randsteine_01.mesh">
-<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="decke_eingang" meshfile="Cube.032.mesh">
-<position x="1.517232" y="1.741509" z="4.047132"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="randsteine_03" meshfile="randsteine_03.mesh">
-<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="randsteine_02" meshfile="randsteine_02.mesh">
-<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="randsteine_04" meshfile="randsteine_04.mesh">
-<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="tempelgang_treppe" meshfile="treppe_gemauert.mesh">
-<position x="53.427147" y="7.565333" z="30.14977"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="saeule_09.003" meshfile="saeule_09.004.mesh">
-<position x="10.100182" y="8.280133" z="50.980743"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="stuetzpfeiler_quer" meshfile="stuetzpfeiler_quer.mesh">
-<position x="28.036366" y="8.417215" z="36.681553"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="gaenge_01.001" meshfile="wand_04.mesh">
-<position x="-11.351809" y="2.751104" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="treppe.001" meshfile="treppe_01.mesh">
-<position x="19.946918" y="4.835266" z="9.672138"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="tuern" meshfile="tuern.mesh">
-<position x="12.966056" y="4.342111" z="16.671421"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="wurzeln" meshfile="wurzeln_alle.mesh">
-<position x="3.815631" y="3.215424" z="3.961683"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="treppe" meshfile="treppe_02.mesh">
-<position x="3.062176" y="3.107023" z="6.686421"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="saeule_10" meshfile="saeule_01.003.mesh">
-<position x="14.990063" y="9.400858" z="12.870321"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="smuggler_wand" meshfile="smuggler.mesh">
-<position x="-21.569408" y="4.746182" z="26.013494"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="fackeln_g2" meshfile="fackeln.001.mesh">
-<position x="15.234941" y="3.107023" z="15.800744"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-<entity name="tempelgang_boden" meshfile="boden_fels.001.mesh">
-<position x="37.711838" y="5.930392" z="27.968113"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
-    </nodes>
-</scene>
\ No newline at end of file

Deleted: modules/kanalisation/maps/kisten_01.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/moderbalken_01.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/pilze.001.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/randsteine_01.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/randsteine_02.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/randsteine_03.001.mesh
===================================================================
--- modules/kanalisation/maps/randsteine_03.001.mesh	2008-07-02 19:59:49 UTC (rev 4416)
+++ modules/kanalisation/maps/randsteine_03.001.mesh	2008-07-02 20:58:59 UTC (rev 4417)
@@ -1,26 +0,0 @@
-
-
-
-
-
-
->???>}?j????$??>??}?'???L?>??@@6?, at GKB?Ad=?l?
-???,r??O?>7?}?(]???>?_B at 6?,@?B
-
-
-
-
-
-
-??;m?Y=?a[??w??
-
-
-
-
-
-
-
-
-
-
-
\ No newline at end of file

Deleted: modules/kanalisation/maps/randsteine_03.002.mesh
===================================================================
--- modules/kanalisation/maps/randsteine_03.002.mesh	2008-07-02 19:59:49 UTC (rev 4416)
+++ modules/kanalisation/maps/randsteine_03.002.mesh	2008-07-02 20:58:59 UTC (rev 4417)
@@ -1,28 +0,0 @@
-
-
-
-
-
-
-Z???{?Pr?=?J?DJ?A9?`@?Ba?	??j?T???h??@?^?
-????A?[;@??B???k? ?}?8 ?@W????|?8_?=y???L?Ar?^@3?By!????>x?j?=?@?DE???|????=??
-?>?A?di@}UB??7?'??>??i????@?aG?u?{????=y?#?j?A;F@?VB?y ?B??1?|?3??@???e?{?`??=Z!??c?A?%V@?xB3???9j?&???6?@,?Z??}??=?A?????A?eV@??BQ2??M?~?????@?>????|?C$?=j?
-J}????=y/????xA??K at sXB???J'j??????@g[??}??J?=????yA?,L@??BQ2??M?~??v??@"o??}??7?=v?????yA?h&@?6B??????X?
-
-
-
-
-
-
-s=?w???@
-
-
-
-
-
-
-
-
-
-
-
\ No newline at end of file

Deleted: modules/kanalisation/maps/randsteine_03.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/randsteine_04.001.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/randsteine_04.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/raum_01.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/rostkette.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_01.002.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_01.003.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_01.011.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_01.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_05.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_06.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_07.003.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_07.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_08.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeule_09.004.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/saeulen.004.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/smuggler.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/stuetzbalken.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/stuetzpfeiler_quer.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/stuetzwand.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/torboegen.002.mesh
===================================================================
--- modules/kanalisation/maps/torboegen.002.mesh	2008-07-02 19:59:49 UTC (rev 4416)
+++ modules/kanalisation/maps/torboegen.002.mesh	2008-07-02 20:58:59 UTC (rev 4417)
@@ -1,1742 +0,0 @@
-
-
-
-
-
- !##!"$%''%&()++)*,-//-.01223045667489::;8<=??=>@ABBC@DEGGEFHIKKIJLMOOMNPQRRSPTUVVWTXYZZ[X\]^^_\`abbc`deggefhijjkhlmnnolpqrrsptuvvwtxyzz{x|}}~????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
-
- !##!"$%''%&()**+(,-../,01331245775689;;9:<=??=>@ACCABDEFFGDHIJJKHLMNNOLPQSSQRTUWWUVXYZZ[X\]__]^`accabdeggefhikkijlmoomnpqrrsptuvvwtxyzz{x|}}~????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
-
- !##!"$%&&'$()**+(,-../,01331245775689;;9:<=??=>@ACCABDEFFGDHIKKIJLMOOMNPQRRSPTUVVWTXYZZ[X\]__]^`accabdeggefhikkijlmoomnpqrrsptuvvwtxy{{yz|}}~????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
-
- !##!"$%&&'$()**+(,-../,01331245775689::;8<=??=>@ACCABDEGGEFHIKKIJLMOOMNPQRRSPTUVVWTXYZZ[X\]__]^`accabdeffgdhijjkhlmnnolpqssqrtuwwuvxy{{yz|}}~????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
- !""# $%''%&()**+(,-../,01223045667489::;8<=??=>@ACCABDEGGEFHIJJKHLMNNOLPQSSQRTUWWUVXY[[YZ\]__]^`accabdeffgdhijjkhlmnnolpqssqrtuwwuvxyzz{x|}}~????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
-
- !##!"$%''%&()++)*,-//-.01223045667489::;8<=??=>@ABBC@DEGGEFHIKKIJLMOOMNPQRRSPTUVVWTXYZZ[X\]^^_\`abbc`deggefhijjkhlmnnolpqrrsptuvvwtxyzz{x|}}~????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
-
- !##!"$%''%&()**+(,-../,01331245775689;;9:<=??=>@ACCABDEFFGDHIJJKHLMNNOLPQSSQRTUWWUVXYZZ[X\]__]^`accabdeggefhikkijlmoomnpqrrsptuvvwtxyzz{x|}}~????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
- !""# $%''%&()++)*,-//-.01223045667489::;8<=>>?<@ABBC@DEGGEFHIJJKHLMNNOLPQRRSPTUVVWTXYZZ[X\]__]^`accabdeggefhijjkhlmnnolpqssqrtuwwuvxy{{yz|}}~????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
-	
-																																	 	!	#	#	!	"	$	%	&	&	'	$	(	)	*	*	+	(	,	-	.	.	/	,	0	1	3	3	1	2	4	5	7	7	5	6	8	9	:	:	;	8	<	=	?	?	=	>	@	A	C	C	A	B	D	E	G	G	E	F	H	I	K	K	I	J	L	M	O	O	M	N	P	Q	R	R	S	P	T	U	V	V	W	T	X	Y	Z	Z	[	X	\	]	_	_	]	^	`	a	b	b	c	`	d	e	g	g	e	f	h	i	k	k	i	j	l	m	o	o	m	n	p	q	r	r	s	p	t	u	v	v	w	t	x	y	z	z	{	x	|	}	~	~		|	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	?	
-
-
-
-
-
-
-
-
-
-
-
-
-	
-
-
-	
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
- 
-!
-"
-"
-#
- 
-$
-%
-'
-'
-%
-&
-(
-)
-*
-*
-+
-(
-,
--
-.
-.
-/
-,
-0
-1
-2
-2
-3
-0
-4
-5
-6
-6
-7
-4
-8
-9
-:
-:
-;
-8
-<
-=
-?
-?
-=
->
-@
-A
-C
-C
-A
-B
-D
-E
-G
-G
-E
-F
-H
-I
-J
-J
-K
-H
-L
-M
-N
-N
-O
-L
-P
-Q
-S
-S
-Q
-R
-T
-U
-W
-W
-U
-V
-X
-Y
-[
-[
-Y
-Z
-\
-]
-_
-_
-]
-^
-`
-a
-c
-c
-a
-b
-d
-e
-f
-f
-g
-d
-h
-i
-j
-j
-k
-h
-l
-m
-n
-n
-o
-l
-p
-q
-s
-s
-q
-r
-t
-u
-w
-w
-u
-v
-x
-y
-z
-z
-{
-x
-|
-}
-
-
-}
-~
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-?
-
-
- !##!"$%''%&()++)*,-//-.01223045667489::;8<=??=>@ABBC@DEGGEFHIKKIJLMOOMNPQRRSPTUVVWTXYZZ[X\]^^_\`abbc`deggefhijjkhlmnnolpqrrsptuvvwtxyzz{x|}}~????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????????
-
-
-
-?W?]?????????>^?>????f?????yA?< ?A:=@??U?????<?????
-?W??fx??;?????>^?>??en??-???%o??e
-?????t??I???Ag?l?????:??@??@)X?A????
-???????=???QDg?H?????:x(?@u?@KX?A????
-????<?B>?????Ag?l?????:???@?
-????>??=??????g???????:&??@??@?7W?f
-=??Q<g???
-=??Q<g???j
-=??Q<g?????=?????i?????=???fi?@?^@?#X?f
-=??Q<g???t??I???oi??????????R?@?X????V??Z?<????V???????
-??r????=?`??MMg??h???2??9o?@?Z??yX??X
-??r?????>/???Q4g?8???l4????@???vW??X
-??r????<???>Hg?l;???5???R?@?X????V??X
-??r???????
-?W?
-?W?A?9??{????;??s???????2R????
??3g?]????4??R?@B??4?h??-;??4<?????<???>]g??>??R?4?a?A????$Di???;>??R=?Q{???<???>%i?7????A??BA!?????f???;>??R=?Q{??????
-???Q?V???j
-???Q?V???
-???Q?V???t??I???oi???????????@9?@??i??
-???Q?V?????=?????i?@??7??????@9?@??i????:??
-;??????=???KDg?e???}G:??@Q?@]?i????:??
-;????t??I???Ag?????~8:N??@|)"@s?i????:??
-;???>??=????|?g?????~):0b?@?@?i????:??
-;???<?B>?????Ag?????~8:
-??=,GH??!?<?B>??????m??????????3A? @?h?
-??=,GH??!?>??=??????m?k???r???+?	A?@??f?
-??=,GH??!??t??I????m???????????A/M	@?)g?
-??=,GH??!????=????m?$???4????A?e@ag????<*?}=?u??
-'??BA!?????f?K;5>?C?=*?z??????
- ?@???????w?? <??m^;?????
-?G???!E9f?L=>??=????8(>?i????n??2?@M?@(?G???!E9f?L=<?B>?????)>??????n????@?$	@???G???!E9f?L=???=????+>?????n?S??@vo@8??G???!E9f?L=?t??I???)>??????n??J?@~r @??
-?
-?n?"??@??@???
-??G???t??I??
-W???????#g??G?@??@????????
-??G?????=???Y??e???\&g???@u?@????????
-??G??<?B>????
-W???????#g?Z?@?
-??G??>??=????U???????!g?k+?@??@?c?Lk??Q<>[???
- ?@?????????|?7????>?????
-??????J?????>/????M??G???qg?X?@?????b?????J????<???>D??;???f?#??@?X??n?,?????J???????
-<U0Z>?z?!|??f????,??W?????@????G,???
-<U0Z>?z?[`S?{g????AG?4Q?????@6"???v????
-<U0Z>?z?$T??`?????,??W????u?@g???f????
-<U0Z>?z???|??`?????O?{???-??@9????WO??)???>?}??S??`?????Q<j?;??@n????9O??)???>?}?a3|??`?????DC<?y?;?\?@)???r?>??)???>?}???w??!????Q<j?;
- ?@????????)???>?}???N??!????\?<?Z?;k+?@??@?c??7!<Pn?>?#i?Ny??0?=?????[???Zh?@??@_?~??7!<Pn?>?#i?<KP?}@?=???k?~????@????G,??7!<Pn?>?#i?[`S?{g??????[???#??@?X??n?,??7!<Pn?>?#i?!|??f?????-?7????d?@?^@N?????5<??/?c
-:?,Ju???'???????(?????@U?@5^????5<??/?c
-:???L??t'???????????Zh?@??@_?~???5<??/?c
-:?<KP?}@?=??????(??k+?@??@?c???5<??/?c
-:?Ny??0?=???v?b??Z?@?
-?oK?;??v?????[?P??}???????<e0?;???@? @??
-?oK?;??v?????tAy?o????????<o??;?H?@J?%@;???oK?;??v???????z??????6?<y??;??@?q%@L??oK?;??v??????R?????????<o??;S??@vo@8??w?;?d?^h???N?eT)?????r<?/?;B??@?@,??w?;?d?^h???v?Y)????,\<???;???@? @??
-?w?;?d?^h??tAy?o???????E<?{?;?J?@~r @??
-?w?;?d?^h??[?P??}?????,\<???;?0?@>=@?[.?3&:??#???D??;K??"?=????<J??;?m?@?e@?=.?3&:??#???D?z?s?~?=????J<w??;B??@?@,??3&:??#???D??v?Y)?????<J??;S??@vo@8??3&:??#???D??N?eT)????P?<6?;
- ?@????????Z?Me?>??q???N??!????v?<???;?\?@)???r?>??Z?Me?>??q???w??!?????y<S??;?m?@?e@?=.??Z?Me?>??q?z?s?~?=????<???;?0?@>=@?[.??Z?Me?>??q??;K??"?=????y<S??;??@?q%@L????%<?{?o?9>??s??????yO?e????H?@J?%@;?????%<?{?o?9>?;K?4?????Y??l??IZ?@|)"@??????%<?{?o?9>!ZK?C9?????yO?e???Z?@?
-???a?Q?>???{?B??ogg??~l;??{??{>>Np?@?????a?Q?>???{??????5???l;??{??{>>??@K???hb??a?Q?>???{?Q??>Z?7?~?l;??{??{>>X?@?????b??a?Q?>???{??&?>?Ei???l;??{??{>>s?@?V????1????;\??:~?Q??>Z?7?p+&?O~?q<??bK?@??????1????;\??:~??&?>?Ei??,&?O~?p<??v?@~s??MH>????;\??:~?B??ogg?p+&?O~?q<?????@J???Vf>????;\??:~??????5?B*&?O~?q<??X?@?????b??7!?rn???#i??&?>?Ei?[i?;?&i?g?>??@K???hb??7!?rn???#i?Q??>Z?7?,??;?&i?g?>?'?@???_???7!?rn???#i?1}/?$G6????;?&i?g?>???@?X???D???7!?rn???#i?D2$?>?g?,??;?&i?g?>???@?X???D???5???/?t
-:?D2$?>?g?C?=?9??\/??'?@???_???5???/?t
-:?1}/?$G6??!?=?9??\/????@>?@?????5???/?t
-:??????6??$?=?9??\/??G?@??@????5???/?t
-:??????@h??!?=?9??\/??G?@??@????2?M?l?RH???????@h???l=?D???dl????@>?@?????2?M?l?RH???????6?I?l=?D???dl?}J?@?@?T???2?M?l?RH??????:8??l=?D???dl???@u?@????2?M?l?RH??(????i?I?l=?D???dl?"??@??@???oK????v????>?????9??????????v?<?@*?@.???oK????v????>????k??????????v??o?@??@??oK????v????>(????i??????????v??2?@M?@(?oK????v????>????:8?<????????v??2?@M?@(?M????d?h?>????:8?8~k<?k????d??o?@??@??M????d?h?>(????i?~k<?k????d?u??@4M	@???M????d?h?>?????@h?8~k<?k????d????@?$	@???M????d?h?>?????6?U~k<?k????d??+?@????@?#???%???#?&?D?D2$?>?g????~xD?uI#????@????L$???%???#?&?D?1}/?$G6???zxD?rI#????@?$	@?????%???#?&?D??????6?&??wxD?oI#?u??@4M	@?????%???#?&?D??????@h???zxD?rI#????@????L$?=Z;0????q?1}/?$G6??a????q??????+?@????@?#?=Z;0????q?D2$?>?g??Z????q?????bK?@??????1?=Z;0????q??&?>?Ei?OT????q?????s?@?V????1?=Z;0????q?Q??>Z?7??Z????q???????@u?@?????%???{???9?(????i?h?=??9???{?}J?@?@?T????%???{???9?????:8?{?=??9???!
 {?<?@*?@.?????%???{???9??????9???=??9???{?"??@??@?????%???{???9?????k?{?=??9???{?Np?@????????4<k??<???>/???4??????g????@6"???v??????4<k??<??=?`???6?oh??Q(g???@????G,?????4<k??<?????
-;?A?<???=???.T??????N&g????@U?@5^???????
-;?A?<?t??I??(R???????#g?IZ?@|)"@?????????
-;?A?<>??=????!P???????!g?}J?@?@?T???????
-;?A?<<?B>????(R???????#g??H?@J?%@;???
-?
-?G??zlK?Z?L?>??=?????$>??????n?B??@?@,??G??zlK?Z?L??t??I???&>?????n?u??@4M	@???G??zlK?Z?L????=???F(>?e????n??m?@?e@?=.??|??}=?IT<?
-???<?n?u??@4M	@????|??}=?IT<???=???d+????v?n?B??@?@,???|??}=?IT<?t??I??5?-??C??8?n??\?@)???r?>??|??C?=,???????
-8??=<>??=???????;????|k?????_?@???{???
-8??=<<?B>????`??;?~????k??Ox?&@?N??{???
-8??=<cA?>R??????;????|k??il?x?$@#???{???
-8??=<>^?>???>?;???'kk????%@??.?????	S????<?
-??\??<??;??=>??=????:?????????i??7L???@?<??\??<??;??=<?B>????6???D?????i?s???	@???\??<??;??=???=???1????|??.?i?Fz???@???\??<??;??=?t??I??6???D?????i???6?? @p[
-???T?????E=>??=??????H?u???~j??il?x?$@#?????T?????E=>^?>???~H??2???lj??Ox?&@?N????T?????E=cA?>R?????H?u???~j??7L???@?<???T?????E=<?B>????z?H???????j?S#t??R@??????????--??t??I????G?y???M?k???~???	@iR????????--????=?????G?$???}?k?????_?@?????????--?<?B>??????G?y???M?k?}?? @??????????--?>??=????&?G??????k???0?4?@????????%<??9??
-n??U??n?k??~?(b??;r8?'??'?P???)??????
-?C??<??y??c?[?P??}??????i<T?Z?U????? @??
-?C??<??y??c?tAy?o???????i<??Z??D??8.%@LS??C??<??y??c???z??????Ti<??Z??il?x?$@#???C??<??y??c??R????????i<??Z?Fz???@?????<EHi??????N?eT)????R?h<?4Z?[?????@4?????<EHi??????v?Y)??????h<?dZ?U????? @??
-????<EHi?????tAy?o????????h<??Z???6?? @p[
-????<EHi?????[?P??}???????h<?dZ????%@??.?@??<??+?P?=??;K??"?=????jh<H?Y?yx???e@?7/?@??<??+?P?=?z?s?~?=????h<?NY?[?????@4??@??<??+?P?=??v?Y)?????jh<H?Y?Fz???@??@??<??+?P?=??N?eT)????b,h<??Y????`????A????<???>
-?m???N??!?????/i<?X????????-?A????<???>
-?m???w??!????
-?m?z?s?~?=???Iph<r?X????%@??.????<???>
-?m??;K??"?=???
-@??????':3?'?g_A??j???E????1?h<?W???~???	@iR????':3?'?g_A??~?>??E????b?h<1?W???~???	@iR??N
-??W{h?U???~?>??E?????!i< ?W?3???w
-@????N
-??W{h?U???j???E?????i<?xW??u???@????N
-??W{h?U??p{????????i<nW?????_?@???N
-??W{h?U?????>3???????i<?xW??Ox?&@?N??*?????y?lc>>?"????????i??,W<?????e@????*?????y?lc>l?>???????i?#W<?>????@x?*?????y?lc>>?>=????????i??,W<?7L???@?<?*?????y?lc>?4$?????????i??TW<?7L???@?<?????4Hi?	??>?4$???????j?rW<?>????@x?????4Hi?	??>>?>=???????j?^jW<EH??;9
-@?U?????4Hi?	??> ??>BG????j?rW<s???	@??????4Hi?	??>]?&?hG?????j??yW<H???
-@?U?@???_?+??=? ??>BG????Aj??W<?dO??????9%?6????l????m??%)??h=???
-@???????j?%?IG9=???=??? "??????m?3???w
-@????????;-<???=?????G?R???t?k?C<????@???????;-<?t??I???G?????E?k??Y???? @?t??????;-<>??=??????G??????k??u???@????????;-<<?B>?????G?????E?k??D??8.%@LS???????<??E?>^?>????H??2???lj?U????? @??
-??????<??E?>??=??????H?2???~j??>????@x??????<??E?<?B>??????H???????j??????e@?????????<??E?cA?>R?????H?2???~j??>????@x??\??+?;;???<?B>??????????????i?U????? @??
-??\??+?;;???>??=????????,???|?i?[?????@4???\??+?;;????t??I????????????i?EH??;9
-@?U??\??+?;;??????=????????}???i?yx???e@?7/??l????=[(???
-@?U??l????=[(?????=???.???????9j?[?????@4???l????=[(???t??I????
-??y<:8?@??>??=?????|k?K????Lz??$??_?@???y<:8?@??<?B>??????k?:????z?&T??&@?>??y<:8?@??cA?>R????|k?K????Lz?????x?$@????y<:8?@??>^?>???kk?U??t?y??!??%@<l??a??<?
-S?????
-S?????j
-S??????<???>Lqi?M8????=??3?`??????a??<?
-S?????????
-??.?W???????>??=??????k????o<"K?4?@\??2?C?8?%<????
-???R?>F{h??\??t??@??+?2<f?k?R???b???? @??"??R?>F{h??\?!ZK?C9???3<??k?I??&?????@o.??R?>F{h??\???L??t'?+?2<f?k?R??A????R@?????R?>F{h??\?,Ju???'??#2<E?k?Z??????? @H???c???y?N+??[?P??}??50?hi<???????? @?b??c???y?N+??tAy?o???820??i<????A??8.%@?0??c???y?N+????z???:F0?M
-i<???????x?$@?????c???y?N+???R????820??i<???D???@eo??????EHi??8???N?eT)???/?	?h<????????@????????EHi??8???v?Y)???/?X?h<???????? @?b?????EHi??8??tAy?o?????/???h<???????? @H??????EHi??8??[?P??}????/?X?h<????!??%@<l??3k=? ',?n????;K??"?=??.?=?h<???1!??e@[???3k=? ',?n???z?s?~?="?.??fh<????????@????3k=? ',?n????v?Y)?b /?,h<???D???@eo??3k=? ',?n????N?eT)?"?.??fh<?????3?`????????m??l?>??w???N??!??3.???h<????3??????q???m??l?>??w???w??!??.?)/i<???1!??e@[?????m??l?>??w?z?s?~?=?3.???h<????!??%@<l????m??l?>??w??;K??"?=?Z.??jh<???????x?$@?????ld>+?y?!?<???s?????3<??j?S???A??8.%@?0??ld>+?y?!?<??;K?4??H?3<
-???ld>+?y?!?<??t??@??\v3<??j?V???t??????_a??aQ}????v
-??^?>?`????-?h?i<????????????C-?aQ}????v
-?????`????-?+ni<?????7?/j????t?aQ}????v
-??-????>??-??Ji<??? ?6??????K??aQ}????v
-?%?>???>??-?+ni<???P?&?????????|?&q&???Q<??%?o??>C?-<%?i??????&??a???Y??|?&q&???Q<?U?>???>??-<A?i??????7?????o+=??|?&q&???Q<?!?>?`??q?-<[?i????U?7?????b????|?&q&???Q<('"??`????-<A?i???? ?6??????K???nm?k??-???%?>???>??-?!Ri<?????7?/j????t??nm?k??-????-????>??-??i<?????t?0????\??nm?k??-???????1=@?-???h<????t??????M???nm?k??-??????>;1=??-??i<????t??????M??W_A?D?'???:???>;1=?^-??h<?????t?0????\?W_A?D?'???:????1=&D-?m?h<???????w
- at b?"?W_A?D?'???:?j???E??)-???h<????W????	@/??W_A?D?'???:?~?>??E?&D-?m?h<????W????	@/???R??F{h?\T<?~?>??E???,?di<???????w
- at b?"??R??F{h?\T<?j???E???,??i<????????@U??R??F{h?\T<p{???????,?"i<????$??_?@????R??F{h?\T<???>3?????,??i<???&T??&@?>???c>??y?N+?<>?"???
-?,<??i????????e@+0$??c>??y?N+?<l?>???w,<?i????&?????@P?M??c>??y?N+?<>?>=???
-?,<??i????9?????@?q???c>??y?N+?<?4$????d?,<??i????9?????@?q?????>EHi??8?<?4$????>?,<-j????&?????@P?M????>EHi??8?<>?>=????,<6j?????M??9
-@??????>EHi??8?< ??>BG?>?,<-j???????	@??????>EHi??8?<]?&?hG?v?,<$j?????m?
-@???fk=??&,????< ??>BG?}%-<`j????O>?????2t????m??l????w<?%)??h=??-<?Cj?????m?
-j??????&??a???Y???m??l????w<?U?>???>y?-<n?i????P?&??????????m??l????w<??%?o??>??-<?
-j?????$??_?@????ld?+?y?S?<<???>3?????,?QNi<????????@U??ld?+?y?S?<<p{???????,??Ki<???????e@+0$??ld?+?y?S?<<?????L?,?Ii<???&T??&@?>???ld?+?y?S?<<???>'????,??Ki<????????????C-???T<?y<??????>/???
-?k?????i??<?Ia??v??P8;???T<?y<?????=?`??%?k??~??s??<K??????=+????T<?y<????????
-?k?????i??<??7?/j????t???T<?y<?????<???>??k??X??Y??<??&??a???Y?QN??r=`????<???>@)i?????P?=?3??????q?QN??r=`???????
- at b?"?}?C=?%???????=???	?m????3	'=????w
- at b?"???W<??;??????=???/?k?A????o<&?????@o.???W<??;????t??I????k??????o<?b???? @??"???W<??;???>??=??????k?????&o<?????@U???W<??;???<?B>??????k??????o<?A??8.%@?0??(;?"??<??>^?>???tj??2??a?>=????? @?b??(;?"??<??>??=????:?j?\?????>=&?????@P?M??(;?"??<??<?B>??????j???????>=????e@+0$??(;?"??<??cA?>R???:?j?\?????>=&?????@P?M?:Y???<?;{h?<?B>?????i????????=????? @?b?:Y???<?;{h?>??=??????i?(???
-??=?????@????:Y???<?;{h??t??I???i????????=?M??9
-@???:Y???<?;{h????=???V?i?=}?????=1!??e@[???C?????;?d??
-@???C?????;?d????=?????i?????W?=?????@????C?????;?d??t??I???ui??b??|??=?3??????q??u???S=????????
-?@???]??<???;??<?B>?????g?FW???o?<N??@x)"@???]??<???;??>??=????1?f??????Y?<??
-;??????=???<Dg?????`?:??@Q?@????+?:??
-;????t??I???Ag?????X?:N??@x)"@????+?:??
-;???>??=????k?g?????O?:.b?@
-?@????+?:??
-;???<?B>?????Ag?????X?:???@???
-?I?Q?V???j
-?I?Q?V???
-?I?Q?V???t??I???oi???????????@9?@H??!!
-?I?Q?V?????=?????i?@??Q????R?@B??b??&R?????9V????<???>i?g?. ??B???_??@???????&R?????9V???????
-?@?????9>?{?l???p{?????
-?@????\?>=?l?o??:p{?????Z1?<
??0?=|'??-#?y?????@??@???&i?Pn?>7S??<KP?}@?=[^??e?e??_??@???????&i?Pn?>7S??[`S?{g?|'??-#?y???R?@?X???w??&i?Pn?>7S??!|??f??????0?????:A9?????????|?J?>???<?S??`??_??<<???}WA????!????|?J?>???<a3|??`????<?4<????BA!???2???|?J?>???<??w??!?_??<<????%A??????????|?J?>???<??N??!?>??<n?<????R?@?X???w???z?U0Z>??!|??f???????????_??@????????z?U0Z>??[`S?{g??????H????Z.?@W"??????z?U0Z>??$T??`???????????????@#g??O???z?U0Z>????|??`??s???)P???????@#g??O????
-???r????=?`??NMg??h??N???9o?@?Z??g????
-???r?????>/???\4g????a?????@???e?????
-???r????<???>\g?;??u????R?@?X???w????
-???r???????
-=?Q<g???
-=?Q<g???j
-=?Q<g?????=?????i?????????fi?@?^@u??Z
-=?Q<g???t??I???oi?????E???fi?@?^@u???????2?????t??I???Ag?j???_
-}???????j????aS???3?sf??S=*W8??????
-@=??f?~????;??????=???????????}Gi?k????@^?f?~????;????t??I??Z]???b??^?h????2?@6????~???;vR??<?B>????~+???????&i?hh???!@?~????~???;vR??>??=????*?????l$i?k????@^???~???;vR???t??I??~+???????&i?;,?a?
-@=????~???;vR?????=????,??.}??)i????!&@iR??aS?[??<????>^?>??????3??Sj?hh???!@?~??aS?[??<????>??=???????t????"j????2?@6??aS?[??<????<?B>????<
-??????Q4j?I??I*@L???aS?[??<????cA?>R??????t????"j????8?
-@/5??b?????;?AQ????=???O^<??????k?????a@?U??b?????;?AQ??t??I??mZ<????}?k?<????!@*??b?????;?AQ?>??=?????V<????L?k??????@?N??b?????;?AQ?<?B>????mZ<????}?k???)??so????c?%?,H?<?j
-@/5?????c?%?,H?<???=????Q??????n?t??
-???V1??????o;3?;??<???>
-??)???	l?<??"???????????o;3?;?????
-???V1????9?y<?bT???<???>Z??;LY????k?o??Dm@???r???+?y???d????>3???????Ji<?o??????@?N??r???+?y???d?p{?????????Di<?i?I??I*@L???r???+?y???d?????????[?i<mc??]???@ }??r???+?y???d????>'??????Di<?i?o?5????2?L? ??l????m??%)??h=????8j??=m????????L? ??l????m?C ?>"q=???;?i??=?*?????OX&?L? ??l????m??U?>???>?????i???=`??/??5?%?L? ??l????m???%?o??>???;?i??=m????????1?R',?==?C ?>"q=???2j?B?=o?5????2?1?R',?==??%)??h=????j???=?????
-@??1?R',?==?]?&?hG????2j?B?=;,?a?
-@=??1?R',?==? ??>BG?????Nj???=???o@????,???EHi??^?>?4$???????.j??q=???2?@6??,???EHi??^?>>?>=??????0j??k=;,?a?
-@=??,???EHi??^?> ??>BG????.j??q=?????
-@??,???EHi??^?>]?&?hG????,j??w=?]???@ }????????y???b>>?"??????T?i?f^=I??I*@L?????????y???b>l?>???????i?tV=???2?@6????????y???b>>?>=??????T?i?f^=???o@??????????y???b>?4$????????i?Xf=????|
-@????g;F{h?:]???~?>??E?????'i<Tv????8?
-@/5??g;F{h?:]???j???E????q$i<kt??????@?N??g;F{h?:]??p{????????? i<?r?o??Dm@???g;F{h?:]?????>3??????q$i<kt??p?H???}l????<e?'??PA????>;1=?????h<????)??so????<e?'??PA?????1=???m?h<F?????8?
-@/5?????<e?'??PA??j???E????*?h<s??????|
-@???????<e?'??PA??~?>??E????m?h<F??r?C????.?i?<<k???Rm?%?>???>????Ni<_??t??
-???V1?i?<<k???Rm??-????>???i<?????)??so?i?<<k???Rm?????1=?????h<j???p?H???}l?i?<<k???Rm????>;1=???i<???`??/??5?%??8?&q&??g|???%?o??>???&?i?t?=?*?????OX&??8?&q&??g|??U?>???>?????i???=????>????7??8?&q&??g|??!?>?`???????i???=/R?B????6??8?&q&??g|?('"??`???????i???=?????-??j?=???#-}??^?>?`??????i<????;?????U??j?=???#-}?????`?????)ji<???t??
-???V1?j?=???#-}??-????>???MHi<u??r?C????.?j?=???#-}?%?>???>???)ji<???6R???%@-????;+?y?/?d>??s???????j??)=???!&@iR????;+?y?/?d>?;K?4?????c?j??4=<????!@*????;+?y?/?d>!ZK?C9??????j??)=?~?g?!@??????;+?y?/?d>?t??@???????j?J=A????????2??? =?l?>??m???N??!?????h<??????aS???3??? =?l?>??m???w??!?????9i<??????
-|?!|??f????Xj??=<??"????????	?{/>
-|?[`S?{g?t???j?	?=?I??????WC???	?{/>
-|?$T??`?????Xj??=f??????9???	?{/>
-|???|??`???????i?0?=f??????9?????P?t?T<??=?`??1??;?????k??????-??????P?t?T<???>/???{?;??????k?r?C????.?????P?t?T<??<???>???;?U??0?k??j?M???????????P?t?T<?????
-@???????j?%<Va?????=????l??????n?L???!@??????j?%<Va???t??I??????????S?m?L???!@???Q??:??nRQ<?t??I??`<????u?k?????|
-@????Q??:??nRQ<???=????c<l?????k?o??Dm@???Q??:??nRQ<<?B>????`<????u?k??~?g?!@????Q??:??nRQ<>??=????-\<???F?k?
-@????~?E???O?=???=???:,???|?? )i???P@Qi???~?E???O?=?t??I???*??,????&i?o?5????2???~??????=?j
-@????~??????=???=???2????????Gi?t.?D?@[	 ??f??S?oG8=?
-??D3@j?????;	?7????<?B>????	?k??~???;-z
-@????M<?S?????
-@??@h}=????????
-??b@???@h}=????????t??I????i??b???Xs=?T??&@?l??@h}=??????????=?????i?????c?s=O@?%%@????U?y=?<??#??>??=????X?i??????p=?n??5@?8??U?y=?<??#??<?B>??????i???????p=?T??&@?l??U?y=?<??#?????=?????i?}??#?p=?
-??b@???U?y=?<??#???t??I????i???????p=O@?%%@????+O =????G??>??=??????j?O???P"&=gk
-??D3@j??????s??????<?B>????}?k?>?????<u,????$@wi?????s??????>??=????N?k?????K?<??????@A????^?8?%<????
-i<???gk
-??b@???????4Hi?0p??N?eT)??)??D?h<???O
-???@Xs??????4Hi?0p??v?Y)?@???H?h<???E??D%@C=??????4Hi?0p?tAy?o???????M?h<???O@?%%@????????4Hi?0p?[?P??}??@???H?h<???????
-@???q=? ',?-N??;K??"?=0b????h<???~???M@?	??q=? ',?-N?z?s?~?=????dh<???O
-???@Xs???q=? ',?-N??v?Y)??5??V*h<????
-??b@????q=? ',?-N??N?eT)?????dh<????????????????m??l?>????N??!??g?? ?h<???c???S??R?????m??l?>????w??!????l3i<???~???M@?	???m??l?>??z?s?~?=?g?? ?h<???????
-@????m??l?>???;K??"?=D????dh<???gk
-??D3@j???8J??F{h?OZ8<???>3??????? i<???-z
-??D3@j???Xd?+?y???T<???>3????c??EIi<???)??v@????Xd?+?y???T<p{?????`V???Gi<????~
-???@Xs??a?y??;#???t??I????i?X?????p=?Y??i@G???a?y??;#?????=?????i??|??o?p=~???M@?	??o}????;????
-???@Xs???o}????;????t??I????i?|b???as=c???S??R???Y?M??S=????????
-;'????@??@???l8<???>??=????8}k???????;?%????"@???@???l8<???>^?>??Zlk?????;A????@'??@???l8<???cA?>R???8}k???????;????m??"??@??M??S=????????
<??%?o??>?]?;Qj????Q?????????@?q=??&,?Q1N<C ?>"q=_}?;?<j???????K>??bY?@?q=??&,?Q1N<?%)??h=???;Pj????&???a@???@?q=??&,?Q1N<]?&?hG?_}?;?<j?????????@E?@?q=??&,?Q1N< ??>BG??<?;7`j????WJ??@+?@???>EHi?0p<?4$???????;=j?????N?81@`??@???>EHi?0p<>?>=????c?;?j?????????@E?@???>EHi?0p< ??>BG????;=j????&???a@???@???>EHi?0p<]?&?hG????;?j????*8???N@?o?@?-c>??y??{r<>?"?????;z?i????A????@'??@?-c>??y??{r<l?>??-??;U?i?????N?81@`??@?-c>??y??{r<>?>=?????;z?i????WJ??@+?@?-c>??y??{r<?4$????{8?;??i?????????<@?Y?@J??F{h?OZ8<?~?>??E?A???i<???h????z@+??@J??F{h?OZ8<?j???E?D???i<???????.@z??@J??F{h?OZ8<p{?????F????i<???>?????@:y?@J??F{h?OZ8<???>3???D???i<???}1??h\?????@?]A?D?'????;???>;1=??????h<???R:???????a?@?]A?D?'????;????1=?q???h<???h????z@+??@?]A?D?'????;?j???E??H??Q?h<????????<@?Y?@?]A?D?'????;?~?>??E??q???h<???W????n??{??@eom?]k????:%?>???>????uYi<???.???????&?@eom?]k????:?-????>?[??$i<?!
 ??R:???????a?@eom?]k????:????1=?????h<???}1??h\?????@eom?]k????:???>;1=?[??$i<???W?`???8?@1?|?&q&?:?;??%?o??>???;?i?????[?j??????@1?|?&q&?:?;?U?>???>`??;X?i?????}?7?????@1?|?&q&?:?;?!?>?`?????;??i?????y?????d??@1?|?&q&?:?;('"??`??`??;X?i????u??,???j ?@?S}????u
-?>?@8?@??m??l?>? ??;K??"?=`????dh<?????
-?>?@8?@?q=?1',??5N??;K??"?=0{???h<???=?o?@x??@?q=?1',??5N?z?s?~?=?????fh<???;????@??@?q=?1',??5N??v?Y)??B???/h<????{???@^??@?q=?1',??5N??N?eT)??????fh<????{???@^??@????4Hi?0p??N?eT)??"????h<???;????@??@????4Hi?0p??v?Y)?S???y?h<???????@???@????4Hi?0p?tAy?o???
-????h<???J?p?@j?@????4Hi?0p?[?P??}??S???y?h<???J?p?@j?@?-c???y??{r?[?P??}???(???i<???????@???@?-c???y??{r?tAy?o????J???i<????%????"@???@?-c???y??{r???z????l???i<????????"@mX?@?-c???y??{r??R?????J???i<???E??q?@?c?@J?>W{h?OZ8??t??@??}V?;s?k????'????@??@J?>W{h?OZ8?!ZK?C9??vR?;l????RF????@???@J?>W{h?OZ8???L??t'?}V?;s?k????{=???a@?=?@J?>W{h?OZ8?,Ju???'??Z?;h?k????{=???a@?=?@?]A?D?'?????,Ju???'????;??l????RF????@???@?]A?D?'???????L??t'?=??;?#m?????=???@?)?@?]A?D?'?????<KP?}@?=???;??l????5????@???@?]A?D?'?????Ny??0?=???;??k????5????@???@vom?<k?>-??Ny??0?=K?;??k?????=???@?)?@vom?<k?>-??<KP?}@?=?
-?;cnl????h$???F?????@vom?<k?>-??[`S?{g?K?;??k???????>???K\?@vom?<k?>-??!|??f?s??;+?j????u???7??y??@4/{?q?E>?~???S??`?????|bi<??????F???A?@4/{?q?E>?~??a3|??`??3?????i<???????m??"??@4/{?q?E>?~????w??!????|bi<?????? ?????@4/{?q?E>?~????N??!????f(i<??????>???K\?@v6|?{/>??:!|??f????;?j????h$???F?????@v6|?{/>??:[`S?{g?~#?;??j?????>??Sw???|?@v6|?{/>??:$T??`?????;?j?????5???h??U??@v6|?{/>??:??|??`??$??;?i?????5???h??U??@????'?P?-????=?`??o?k?q?????<u??,???j ?@????'?P?-?????>/?????k?>?????<W????n??{??@????'?P?-????<???>?k?V??+?<???>???K\?@????'?P?-???????
-?>?@8?@rl}=???????
-?>?@8?@ ?M<?S?????
-A????S????;?
-A??????_?1??
??1?k??j<????q?@7?@????F{h?c%???t??@??????k?6/h<x6????@???@????F{h?c%??!ZK?C9?????-?k???g<??????@??@????F{h?c%????L??t'?????k?6/h<????a@?6?@????F{h?c%??,Ju???'??????k???h<????p?@?	A? /???y??kc>[?P??}??????i<v?j??@????@??A? /???y??kc>tAy?o??????ai<??j?9????"@???@? /???y??kc>??z??????i<B?j?C?????"@n?@? /???y??kc>?R???????ai<??j??????@JyA????4Hi?,??>?N?eT)??????h<(Ck???????@?iA????4Hi?,??>?v?Y)??????h<Wk??@????@??A????4Hi?,??>tAy?o??????n?h<??j?????p?@?	A????4Hi?,??>[?P??}???????h<Wk?q??>?@A?
-A?F?:1',??x=??;K??"?=???6?h<l????o?@z?
-A?F?:1',??x=?z?s?~?=???rh<O?k???????@?iA?F?:1',??x=??v?Y)?????7h<??k??????@JyA?F?:1',??x=??N?eT)????rh<O?k?B5?? ???J?A??<?l?>x?m???N??!??????h<??l?6????m???xA??<?l?>x?m???w??!????O+i<??l????o?@z?
-A??<?l?>x?m?z?s?~?=?????h<??l?q??>?@A?
-A??<?l?>x?m??;K??"?=???]jh<*yl?C?????"@n?@>???+?y??d???s??????J?j?R+g<9????"@???@>???+?y??d??;K?4?????!?j??g<x6????@???@>???+?y??d?!ZK?C9?????J?j?R+g<????q?@7?@>???+?y??d??t??@?????s?j??Qg<????,????o?@/?<????J}??^?>?`??|??/?i<W?l?????????]P?@/?<????J}?????`??~??zri<a?l?SY?????;??@/?<????J}??-????>???Vi<l?l?]????n?????@/?<????J}?%?>???>~??zri<a?l??/???_???RA??C??p&???|???%?o??>w??R?i?k?l<????j????BA??C??p&???|??U?>???>z????i???l<?(??7????aA??C??p&???|??!?>?`??}???i???l<????????qA??C??p&???|?('"??`??z????i???l<]????n?????@???<]k??cm?%?>???>??CXi<?m?SY?????;??@???<]k??cm??-????>????i<? m???????????@???<]k??cm?????1=?????h<?=m????h\???,?@???<]k??cm????>;1=????i<? m????h\???,?@??<D?'??MA????>;1=~??
-?h<?|m???????????@??<D?'??MA?????1=~??C?h<{?m??Z???z@eo?@??<D?'??MA??j???E?~??|?h<b?m??????<@???@??<D?'??MA??~?>??E?~??C?h<{?m??????<@???@???<F{h?c%?>?~?>??E?t??'#i<f?m??Z???z@eo?@???<F{h?c%?>?j???E?t???i<??m?????.@+??@???<F{h?c%?>p{?????s???i<?n???????@???@???<F{h?c%?>???>3???t???i<??m?I????N@}/?@? /<??y??kc?>?"???c???i??Vn<=?????@??@? /<??y??kc?l?>??b????i??kn<!??81@?6A? /<??y??kc?>?>=???c???i??Vn<)????@zFA? /<??y??kc??4$????e??O?i??An<)????@zFA???;4Hi?,????4$????d??Qj?tn<!??81@?6A???;4Hi?,???>?>=???b??Tj??.n<?i????@W?A???;4Hi?,??? ??>BG?d??Qj?tn<????a@?A???;4Hi?,???]?&?hG?f??Nj??m<s?????????A?F???&,??x=?C ?>"q=i??;Cj?i?m<2??K>????A?F???&,??x=??%)??h=n??j??hm<????a@?A?F???&,??x=?]?&?hG?i??;Cj?i?m<?i????@W?A?F???&,??x=? ??>BG?e??kjj??m<2??K>????A????l??x?m??%)??h=o??V<j??2m<s?????????A????l??x?m?C ?>"q=s??j??m<????j????BA????l??x?m??U?>???>v????i?m<?/???_???RA?!
 ???l??x?m???%?o??>s??j??m<??????@???@%=?<+?y??d>???>3???o???Ii<n?????.@+??@%=?<+?y??d>p{?????o??,Ei<#+n?=?????@??@%=?<+?y??d>?????n???@i<6>n?I????N@}/?@%=?<+?y??d>???>'??o??,Ei<#+n?????????]P?@????y<?????>/???A?'=?????qk?M??Sw????@????y<????=?`??
-?'=?~????k??????F????@????y<???????
-A??????;l?1=?
-A????S=????
-m???e?X??A?'=@??y???~?6??=?8?=???<
-q??OX?SB>?}}???>?_??D?A?v@?'@??<be?>?
-q??.9?\YB>?}???>tAm??#?A??>@;!@??<be?>?
-q???;?}y	?	?|?i?>u?{????A*UA@??@??<be?>?
-q?L?Z??x	??}???>tAm?K ?A5??@^????1????PqH??pU?????0~}???>??^??m?A?2?@????1????PqH??O6??X???~}???>??^??D?A?v@?'@?1????PqH??.9?\YB>0~}???>??^?\??A??y@??@?1????PqH??OX?SB>?}}?4?>v?^?Z??A???@M2???7??`rc????>?T?????0}????=_???d??Aj#?@?4???7??`rc????>?h5?????+|???>?????m?A?2?@????7??`rc????>?O6??X???0}????=_???K ?A5??@^????7??`rc????>?pU?????\~?h"?=vs??h??Az	?@y"h??????s?t????j9??6??(|?	??Y)?=rP?AB??@?'r??????s?t???uxX?%;??(|????+?=?p?A?u?@????????s?t???s?Y?&V???(|?????,?=??A???@???????s?t?????:??S???(|????+?=s?A???@?*??+?o^??k??Nz7?????(|?????7?=}W?Af]?@?/#??+?o^??k??j?V?????(|?P???2?=rP?AB??@?'r??+?o^??k??uxX?%;??(|????i-?=h??Az	?@y"h??+?o^??k???j9??6??(|?P???2?=k??A??s at k??>4?)??????V?PQ5?F;>(|?x???M?=t??A@?p@??>4?)??????V??_T??	;>(|?????S?=}W?Af]?@?/#?4?)??????V?j?V????(|?x???M?=s?A???@?*?4?)??????V?Nz7?????'|?L???G?=X??A?'=@??y?????U?>?#l?5&8????	(|????5d?=bN?A\Y:@Z??<????U?>?#l??4W????'(|?}???h!
 ?=t??A@?p@??>????U?>?#l??_T??	;>	(|????5d?=k??A??s at k??>????U?>?#l?PQ5?F;>?'|?t???_?=??A???@??"T???Cw??]u>?rT?&V??J+|???>????p?A?u?@???"T???Cw??]u>PQ5?@P??[+|?9?>R???d??Aj#?@?4??"T???Cw??]u>?h5????J+|???>???Z??A???@M2??"T???Cw??]u>?T????8+|??>??????A???&?@??????C?{??S?>????O(|?????h?=?Y?A7U??|+!@??????C?{????????\(|????h?=???A?_@@]?@??????C?{?????x?>O(|?????h?=wW?A.C@?^@??????C?{??X?>?x?>B(|????Zi?=?F?A?9@???>1}>??T???w????i??>a(|?R?>zm?????A E6@~??>1}>??T???w???>???>W(|???>?l???W?A????(T?1}>??T???w??=?>????M(|?a?>l????A?`???`U?1}>??T???w????????W(|???>?l??wW?A.C@?^@b?????O?n??X?>?x?>2?|?an?????=???A?_@@]?@b?????O?n?????x?>/(|????sn?=?K?AS?j@?@b?????O?n??????>2?|?an?????=.??A?`m@??@b?????O?n????>'?>??|?l???v?=.??A?`m@??@`?=?? ???F????>'?>?{}????Gd_=?K?AS?j@?@`?=?? ???F??????>?{}?????i_=???A?t~@?t??`?=?? ???F?zR??????{}?F??:o_=R?A???@??`?=?? ???F???>?????{}?????i_=R?A???@?????=??!
 R??+???>?????{}??????_=???A?t~@?t?????=??R??+?zR???????|?!
 ?'??U?=
z?AK?@4??????=??R??+??"??? ???{??T ????=o??AD??@???????=??R??+?(??>;? ???|??'??U?=-x?A???@;????%>wk???>?n?&V??	(|??>????7??Alh?@?????%>wk???>?9?>?T??
-?z????A E6@~??>?}?x????>]5?=5??>??=???? j?bN?A\Y:@Z??<?}?x????>???<
-??fN>???=??'>???{???v?h??D?A?v@?'@??z?
-??fN>??;???=???P?????e??m?A?2?@?????z?
-??fN>t]?=Na?????????@b????A?t~@?t????z?
-??fN>T7'>=??9???P?????e????A?t~@?t??`9z?#M?o?$>T7'>=??9:G???????g??m?A?2?@???`9z?#M?o?$>t]?=Na??Z????,h?d??Aj#?@?4??`9z?#M?o?$>3T5>??E???????????h?z?AK?@4???`9z?#M?o?$>c*}>?,??Z????,h??p?A?u?@?????|??#??T?=C8?>&V???W>?????j?rP?AB??@?'r???|??#??T?=3T5>??E?{?>????vyl????Al?@W=????|??#??T?=c*}>?,???{>kR??Q?m?7??Alh?@?????|??#??T?=?V?>??$?{?>????vyl????Al?@W=??=}?I????=c*}>?,??
????=?A?h@?%=@+???L??9?<?B>????Y`???????=?t?A5@{@q?<@+???L??9?>??=????l`????)??=Oj?A??Y@??8 at m??dK<'3~??
-?i:???=?`??s`?????!??=??A[???E7@??????
-?i:????>/?????_??@??_??=?j?A?? @q?7@??????
-?i:???<???>??_?@??????=?(?Az?#@}6@??????
-?i:??????
-Z@?cM@??l????>?W?<KP?}@?=A??+?t??jB?AW'$@?0K@??l????>?W?[`S?{g?jY??<?l???(?Az?#@}6@??l????>?W?!|??f??q?"N?e????A.;r@?g;@??C??$???,Ju???'????Q;???????A
-fr at zP@??C??$?????L??t'?&??Z????????A?
-Z@?cM@??C??$???<KP?}@?=???Q;????Oj?A??Y@??8@??C??$???Ny??0?=??H??????t?A5@{@q?<@???>?h??????t??@??Ru??f??????Ak{@F?Q@???>?h?????!ZK?C9??7W????????A
-fr at zP@???>?h???????L??t'?Ru??f??????A.;r@?g;@???>?h?????,Ju???'?l???.???????A{gy at T>@????Tt??3w;[?P??}??{=r?<???&??AS?y at -?R@????Tt??3w;tAy?o???9=??<????"?A[{@??R@????Tt??3w;??z????
-=??<???M	?AP@??=@????Tt??3w;?R????9=??<???{_?A??n@??=@-C
??O?Fz??+???%)??h=???p??J???O?A^?]@??=@??O?Fz??+??]?&?hG????z?E??Ai?A:^@??R@??O?Fz??+?? ??>BG?)???=?????w?A?XI@]?=@F_u?????????%)??h=????Q?????Ao?I at 6YR@F_u????????C ?>"q=M?????T?????ARC@D?T at F_u?????????U?>???>??????X??>??Av@tF@@F_u??????????%?o??>M?????T???A?h@?%=@??Q??z??d?<???>3???|?=g3<7???5?A?Ah at j?Q@??Q??z??d?<p{???????=/<4???:?A:?k@??R@??Q??z??d?<???????=?*<1??!?AYjk@?=@??Q??z??d?<???>'????=/<4??S1?A?A ?r?K@???=?3<\9????>/???n?_?
-Z@?cM@???=??:p?~??
-Z@?cM@%!?=?WK?3~??
-fr at zP@%!?=?WK?3~??t??I???(b??{?????=?/?A7?`@??P@%!?=?WK?3~????=???'?b?0????G?=?/?A7?`@??P@??=<;?9????=???A`??????=???A
-fr at zP@??=<;?9??t??I??U`???????=??Ak{@F?Q@??=<;?9?>??=????g`????3??=?5?A?Ah at j?Q@??=<;?9?<?B>????U`???????=?"?A[{@??R@ ?)<?&?;???>^?>????j?L???]
-}n<?A8HS@~S?@kO<?????<?B>????8j?{???l|n<O5?An?L@?A?@kO<????????=???]:j?	}???{n<?f?A?[@i)?@kO<??????t??I??8j?{???l|n<j??A_c@!??@?????????>??=????1?j??????p{? 
???
?3N?Av?L@??@s??>EHi????? ??>BG???5?Uj????O5?An?L@?A?@s??>EHi?????]?&?hG???5??j????Bg?A?<@???@?`=?1',??_??C ?>"q=c?5??=j????^N?A??;@?6?@?`=?1',??_???%)??h=a?5??j????O5?An?L@?A?@?`=?1',??_??]?&?hG?c?5??=j????3N?Av?L@??@?`=?1',??_?? ??>BG?e?5?=ej????^N?A??;@?6?@H?m??l??1(??%)??h=y?5?	7j????Bg?A?<@???@H?m??l??1(?C ?>"q=??5??j?????A??@6>?@H?m??l??1(??U?>???>J?5???i????f?A?@@-{?@H?m??l??1(???%?o??>??5??j???????A?ES@??@?nc?+?y?N??<???>3???7?5=?Pi<??????A??S@??@?nc?+?y?N??<p{?????z?5=?Ji<???>?A3?V at c??@?nc?+?y?N??<???????5=Ei<???Y??A+?V at X<?@?nc?+?y?N??<???>'??z?5=?Ji<?????A?)8????@??=??y<$a????>/???}k??????-?=f??A??7?vE?@??=??y<$a???=?`???k?N~??o3?=?V?A?B@??@??=??y<$a??????
~??????
-???U??]j????A?@p?A?}~???P?Pq???????
-!i<]?=?`?Ax|E at xA"??=<k?>pyl?Ny??0?=???ik?G??<1?A{?E@?uA"??=<k?>pyl?<KP?}@?=?hel?i:???x?A?B@?A"??=<k?>pyl?[`S?{g????ik?G?????A?@p?A"??=<k?>pyl?!|??f????mj??S????A??Z@?|	ANF?=U?'?Sx@?,Ju???'?x?7?l???????A?.[@o?	ANF?=U?'?Sx@???L??t'????,m?????<1?A{?E@?uANF?=U?'?Sx@?<KP?}@?=x?7?l?????`?Ax|E at xANF?=U?'?Sx@?Ny??0?=Q???k????w??A?[c@??A?"E=F{h?I??>?t??@??B???k?????$??A??c@?OA?"E=F{h?I??>!ZK?C9??g??l????????A?.[@o?	A?"E=F{h?I??>??L??t'?B???k???????A??Z@?|	A?"E=F{h?I??>,Ju???'??e?k?????fw?A_c at pi?@34????y?
-?c?[?P??}????Wi<??=H?A?c at n&?@34????y?
-?c?tAy?o??????i<5?=?f?A?g@ ?
-?c???z?????oi<??=??A??g@?T
-?c??R???????i<5?=|e?A?[@G?@e???EHi??????N?eT)?Z?%?h<?,?=)6?A?\[@?@e???EHi??????v?Y)?q?C?h<?$?=H?A?c at n&?@e???EHi?????tAy?o?????]?h<A?=fw?A_c at pi?@e???EHi?????[?P??}??q?C?h<?$?=,Q?Ai?F at 3??@?X? ',?]?<??;K??"?=??h<?E?=?!?Ap?F at 2??@?X? ',?]?<?z?s?~?=+??uh< @?=)6?A?\[@?@?X? ',?]?<??v?Y)?=??Dh<?:?=|e?A?[@G?@?X? ',?]?<??N?eT)?+??uh< @?=P??AR?@W??@=e???l?>?m???N??!????h<?V?=???AU?@Wz?@=e???l?>?m???w??!???=&i<X[?=?!?Ap?F at 2??@=e???l?>?m?z?s?~?=???h<?V?=,Q?Ai?F at 3??@=e???l?>?m??;K??"?=???kh< R?=??A??g@?T
??g?An?L at Q??@	X=',?]?<?]?&?hG????>j?t??W8?Av?L at O??@	X=',?]?<? ??>BG?x??^j?x??W?A??;@???@?e?=?l???m??%)??h=???Cj?j???'?A?<@???@?e?=?l???m?C ?>"q=???j?ug?? ??A??@'?@?e?=?l???m??U?>???>????i??d??r??A?@@&U?@?e?=?l???m???%?o??>???j?ug?????A?ES at ZAB???y??Gb????>3???f?QOi<???=???A??S@?lAB???y??Gb?p{?????_??Ii<o??=(`?A3?V@?
?=<?B>????????	??*?j?$??A??c@?OA?	?B?7<C??=>??=????????"???W?j??f?A?g@ ?
-Ay?jM??}?=>??=????M{???????i??
-A"???????d+=>??=????QN0?????|?j?k?A??"@c?A"???????d+=>^?>??#J0?3???j???A?N@??A"???????d+=cA?>R???QN0?????|?j??
-???h????<?????
-???h????<??<???>BB??+???3i?WA???????@
-???h????<???>/???????\???ej?aEA?6???o?@
-???h????<??=?`??h???"???p?j?eA?g???6%Ac????P?k?????=?`??????^???P?k???AB???!Ac????P?k??????>/???1???H?????k??8A?n???rAc????P?k?????<???>????*V????k?YA????A? Ac????P?k????????
-AzT|<??y??"c?[?P??}?????0i<?????A??@,=
-AzT|<??y??"c?tAy?o??????5i<?5????A??"@?AzT|<??y??"c???z??????:i<P??k?A??"@c?AzT|<??y??"c??R???????5i<?5??%YA??@4?A?<?<EHi?S????N?eT)?????h<?????A??@??A?<?<EHi?S????v?Y)????-?h<?c????A??@,=
-A?<?<EHi?S???tAy?o??????W?h<?????A??@?D
-A?<?<EHi?S???[?P??}?????-?h<?c????A[?@`TAIo< ',?Do=??;K??"?=?????h<`=??<XA??@
???j??E?;??A???????@'f=??l???m??U?>???>?????i??x?;?AB`??\??@'f=??l???m???%?o??>????j??E?;??A??@dA;?J?+?y??`d????>3???????Hi<p????A?.@?\A;?J?+?y??`d?p{?????????Fi<|
-???A?@;?A;?J?+?y??`d?????????hDi<??????A?N@??A;?J?+?y??`d????>'??????Fi<|
-???A?????!A???y<???<???>/???!????????k???AGv???/%A???y<???<??=?`???????~??$?k?eA?F???? A???y<???<?????
-???????j?tAM??????@l??r=/??????>/???%???8???Lj??A>???hkA???G?o;[(=??<???>??2)????k?eA?F???? A???G?o;[(=?????
-A"?????<xa+?>??=????K0???????j??AU1@
-Ay?@4?;p{??>??=????&{???????i??A??@??Ay?@4?;p{???t??I???{???????i?8?A??@g_Ay?@4?;p{?????=????
-{? }??D?i?<XA??@
-????o<?#????@R?A??W????????<?B>????	?k?b???-o<o/??m?@M?A??W????????>??=??????k?????ko<5S???@9%?A&?C?8?%<????
-?>?????AVc	??wo?????????
-?k?L???^??<f?N???CH?A?bT?'?P?0?????>/???j?k???????<2V???n??x%?A?bT?'?P?0????<???>??k??U????<?<
-?>?????A?bT?'?P?0???????
-?>?????An4|??z/>`<<!|??f???-<?j??????
-??F??>8?An4|??z/>`<<[`S?{g??-<??j????|???Sw???b?An4|??z/>`<<$T??`????-<?j????,??i??uA?An4|??z/>`<<??|??`????-<?i??????F??7?????A?*{?q?E>?W??S??`????-?Xi<???=?F?5F?????A?*{?q?E>?W?a3|??`??P?-???i<???=?2??m??)H?A?*{?q?E>?W???w??!???-?Xi<?????2? ????&?A?*{?q?E>?W???N??!?q?-?\"i<???5S???@9%?A?nm?]k?>???;Ny??0?=
-??F??>8?A?nm?]k?>???;[`S?{g?
-?>?????A?nm?]k?>???;!|??f?XD.<
-i<???'?????"@(h?A?c???y?5)????z???ZN0?&i<???|(????"@?F?A?c???y?5)???R?????00??
-i<???(G???@?	?A????EHi??8???N?eT)???/?#?h<???uu???@?*?A????EHi??8???v?Y)?y?/??h<???Wz????@aO?A????EHi??8??tAy?o????/???h<??????l?@.?A????EHi??8??[?P??}??y?/??h<???nM ?:?@???A3k=? ',?n????;K??"?=,?.?m?h<????{ ?o?@??A3k=? ',?n???z?s?~?=??.??nh<???uu???@?*?A3k=? ',?n????v?Y)??/??,h<???(G???@?	?A3k=? ',?n????N?eT)???.??nh<?????2? ????&?A??m??l?>.x???N??!?B6.?
-?h<???=?2??m??)H?A??m??l?>.x???w??!??.??(i<????{ ?o?@??A??m??l?>.x?z?s?~?=B6.?
-?h<???nM ?:?@???A??m??l?>.x??;K??"?=?X.?H{h<???|(????"@?F?A?ld>+?y?S?<???s?????3<??j?R??'?????"@(h?A?ld>+?y?S?<??;K?4??(?3<??j?O??	?????@?n?A?ld>+?y?S?<?!ZK?C9????3<??j?R??o/??m?@M?A?ld>+?y?S?<??t??@???~3<??j?U??f?N???CH?AaQ}?????m
-??^?>?`????-?V?i<???????????i?AaQ}?????m
-?????`??k?-?hi<???V@??????F?AaQ}?????m
-??-????>#?-??Ci<???2V???n??x%?AaQ}?????m
-?%?>???>k?-?hi<?????%??_??2?A?|?&q&???Q<??%?o??>??-<??i??????%?b????S?A?|?&q&???Q<?U?>???>??-<^?i????&s6?7?????A?|?&q&???Q<?!?>?`??\?-<??i?????D6????????A?|?&q&???Q<('"??`????-<^?i????2V???n??x%?A?nm?k??f???%?>???>?-??Hi<???V@??????F?A?nm?k??f????-????>??-?,i<???C?{?????oR?A?nm?k??f???????1=??-???h<?????z?_\??&1?A?nm?k??f??????>;1=??-?,i<?????z?_\??&1?AF_A?D?'???:???>;1=h-???h<???C?{?????oR?AF_A?D?'???:????1=?H-???h<???m???z@?n?AF_A?D?'???:?j???E??)-???h<???????<@XM?AF_A?D?'???:?~?>??E??H-???h<???????<@XM?A?R??F{h??X<?~?>??E???,?\i<???m???z@?n?A?R??F{h??X<?j???E???,?i<???s????.@gs?A?R??F{h??X<p{???????,??i<????#????@R?A?R??F{h??X<???>3?????,?i<???????N@?L?A?c>??y?5)?<>?"???i?,<`?i??????????@?m?A?c>??y?5)?<l?>??p,<??i?????c??31@?Y?A?c>??y?5)?<>?>=???i?,<`?i????1???@i8?A?c>??y?5)?<?4$??????,<@?i????1???@i8?A??>EHi??8?<?4$????G?,<$j?????c??31@?Y?A??>EHi??8?<>?>=????,<,j???!
 ??3???@?;?A??>EHi??8?< ??>BG?G?,<$j????W??a@??A??>EHi??8?<]?&?hG?~?,<j????8???????AUk=??&,????<C ?>"q=?K-<;<j???????K>?????AUk=??&,????<?%)??h=?f-<rj????W??a@??AUk=??&,????<]?&?hG??K-<;<j?????3???@?;?AUk=??&,????< ??>BG??0-<Zj???????K>?????A??m??l????w<?%)??h=m?-<?>j????8???????A??m??l????w<C ?>"q=??-<^j??????%?b????S?A??m??l????w<?U?>???>\?-<??i??????%??_??2?A??m??l????w<??%?o??>??-<^j?????#????@R?A?ld?+?y?!?<<???>3?????,?Ii<???s????.@gs?A?ld?+?y?!?<<p{?????D?,??Ei<?????????@?m?A?ld?+?y?!?<<???????,??Bi<???????N@?L?A?ld?+?y?!?<<???>'??D?,??Ei<???????????i?A
-?T<9?y<??????>/?????k???????<|???Sw???b?A
-?T<9?y<?????=?`???k???+??<??
-??F??>8?A
-?T<9?y<????????
-?T<9?y<?????<???>??k??X????<??%?b????S?AJ??r=`????<???>)i?m?????==?2??m??)H?AJ??r=`???????
-??F??>8?A?l	=?o;????????
-??@l<l8?@??J_?=?2????|??	'?u????t??_?@???@l<l8?@??b-?=g,z???|??%??{??????&@???@l<l8?@??:??>?????|??	'?u????2??x?$@???@l<l8?@??N?v>????t?|?v(?%S???)%??%@??@0??<?
-S?????~}??%[??t|?Fw'?Q??<4f?????lh?@0??<?
-S?????.??U=,|?5#.??K?<9?*????Y@?@0??<?
-S????!?`???>c?{?0?4????<??7?i?????@0??<?
-S????*??????>,|?5#.??K?<4f?????lh?@?!?=?????d??.??U=?{?0H-?~??=?)%??%@??@?!?=?????d??~}??%[???{?w/? ??=)???@???@?!?=?????d?????????u?{???1????=gF??	@$??@?!?=?????d?s;?[	???{?w/? ??=??
-??@??W????????J_?=?2??7?|? $???e<??[?8?@?	?@2?C?8?%<????~}??%[??m}?????<="S???????:?@2?C?8?%<????.??U=J?}????<=??????	@h??@2?C?8?%<???s;?[	??m}?????<=????R@ ??@2?C?8?%<????????????Z}????x<=!?0b??r??@cd	???o????*??????>	?|??? ??	
-=??G??????
-?@cd	???o????!?`???>?j|??2'?-?	="S???????:?@cd	???o?????.??U=	?|??? ??	
-=??[?8?@?	?@cd	???o?????~}??%[???|??o?#
-=??7?i?????@?p?<?f?????*??????>r&|???.?PF?<9?*????Y@?@?p?<?f?????!?`???>4?{???4???<:?;????????@?p?<?f???????`????r&|???.?PF?<??L?]5??u??@?p?<?f??????~??z4??Jj|??i(?%??<Uh???t???}?@'kT???P?0???~??z4??w?|??,%?c[s<??????????@'kT???P?0????`????5?|?uW&??s<??G??????
-?@'kT???P?0??!?`???>??|?	?'???s<!?0b??r??@'kT???P?0??*??????>5?|?uW&??s<!?0b??r??@n4|??z/>`<<n?y?;????-<??i??????????????@n4|??z/>`<<?(Q??????-<?Jj????????v??99?@n4|??z/>`<<$T??`????-<??i????Uh???t???}?@n4|??z/>`<<??|??`??+?-<?i??????L?]5??u??@?*{?q?E>??W??S??`????-??4i<???&?L?]7??m?@?*{?q?E>??W?a3|??`????-???i<???8????>??@?*{?q?E>??W?n?y?;????-??4i<?????7?i?????@?*{?q?E>??W??(Q????m.???h<?????[?8?@?	?@?nm?]k?>-??;[xv????=[h.<??j?????\??7@x??@?nm?]k?>-??;z?M????=??.<??k??????????????@?nm?]k?>-??;?(Q????[h.<??j????!?0b??r??@?nm?]k?>-??;n?y?;???%.<D;j????????R@ ??@F_A?D?'?I??v?/m(??/<X?k?s???K????@?R?@F_A?D?'?I??4LM??d(??0<Q.l?h???\??7@x??@F_A?D?'?I??z?M????=?/<X?k?s????[?8?@?	?@F_A?D?'?I??[xv????=AE/<`:k????S??? @
-??@zR?>W{h??\???v??`??{D1<`%k?j???????? @?j?@zR?>W{h??\???M?W[????1<?Kk?d???K????@?R?@zR?>W{h??\?4LM??d(?{D1<`%k?j??????R@ ??@zR?>W{h??\?v?/m(?Q?0<?j?p????
-??@?ld>+?y?S?<???v??`??#?1<zj?m????????????@aQ}?????q
-?Y??>?`????-???i<??????????"U?@aQ}?????q
-???`????-??ni<????KH?/j??~??@aQ}?????q
-?Ow?j??>??-??Ki<?????G??????
-?@aQ}?????q
-?
-?@?nm?k??????
-@?i?@W_A?D?'????:??!??KF??*-?~?h<?????????	@h??@W_A?D?'????:???>?HF?J-???h<?????????	@h??@?R??F{h??X<???>?HF?[?,?3i<??????{
-@?i?@?R??F{h??X<??!??KF???,?di<????????@?}?@?R??F{h??X<2X!?????|?,??i<????t??_?@???@?R??F{h??X<mo?>8?????,?di<???????&@???@?c>??y?5)?<`? ?????,<?i????????e@Og?@?c>??y?5)?<??>???~,<+?i?????.????@%?@?c>??y?5)?<mo?>8?????,<?i?????????@?X?@?c>??y?5)?<2X!???????,<?i?????????@?X?@???>EHi??8?<2X!???????,<t
-j?????.????@%?@???>EHi??8?<mo?>8???9?,<Hj?????u??9
-@???@???>EHi??8?<???>?HF???,<t
-j????gF??	@$??@???>EHi??8?<??!??KF???,<?j???????
-@???@Uk=??&,????<???>?HF?(-<?\j????4f?????lh?@??m??l????w<X?!?K< =??-<|?j???????
-=?\??7@x??@oe	=?o;????~}??%[???|??n?~
-=???0??^??@oe	=?o;????.??U=?|?~? ?:
-=???0??^??@W?C=8?%?????.??U=O?}?*??I?<=?\??7@x??@W?C=8?%?????~}??%[??m}????I?<=?K????@?R?@W?C=8?%?????????????Z}?d?|<=???{
-@?i?@W?C=8?%????s;?[	??m}????I?<=???{
-@?i?@??W<???;???s;?[	???|??$?|?e<?K????@?R?@??W<???;???????????z?|??c$???e<?????? @?j?@??W<???;???J_?=?2??8?|? $?{?e<?????@?}?@??W<???;???b-?=g,z?z?|??c$???e<????8.%@nO?@|&;?T??<??N?v>????p!|???*?L?@=,?
-@???@.X???<?;{h?s;?[	???{??E/???=?X%??e@|??@C?????;?d??~}??%[???{?&w/????=???
-@???@C?????;?d?s;?[	???{?&w/????=?????@GT?@C?????;?d?????????z?{???1?3?=8????>??@?w???S=???*??????>,|?W#.?Y>?<??*??a?????@?w???S=???!?`???>d?{?S?4?@??<???
-=??4??n??W?AVc	?G?o????!?`???>?j|??1'?R?	=]jp?_\????AVc	?G?o?????.??U=?|??? ??
-=??H???@??AVc	?G?o?????~}??%[???|??o?B
-=?/? ???$?A?t?<?f?????*??????>q&|???.?rJ?<?#??_??e?A?t?<?f?????!?`???>4?{???4?2??<??3??????oA?t?<?f???????`????q&|???.?rJ?<#D??7??t}A?t?<?f??????~??z4??Ij|??i(?I?<?9b?i??O?A?sT???P?0???~??z4??z?|??,%??cs<???N?????A?sT???P?0????`????;?|??V&?H?s<??4??n??W?A?sT???P?0??!?`???>??|??'???s<?i??>???Q?A?sT???P?0??*??????>;?|??V&?H?s<?i??>???Q?An4|??z/>`<<n?y?;??"?-<??i????n
-?g<???????l?@??A????EHi??8????M?W[??bK1??	h<??????:?@y1A3k=? ',?????z?M????=bK/??h<??????o?@tA3k=? ',?????[xv????=?/?\?g<????????@1?A3k=? ',?????v?/m(??$0??g<???@????@?wA3k=? ',?????4LM??d(??/?\?g<????/? ???$?A??m??l?>??w??(Q?????i.??9h<???U0??m????A??m??l?>??w?n?y?;???'.???h<??????o?@tA??m??l?>??w?[xv????=?i.??9h<??????:?@y1A??m??l?>??w?z?M????=??.???g<?????????"@$?A?ld>+?y?S?<??bw???A?1<?~j?l??NA????"@?4A?ld>+?y?S?<???N?b???1<??j?k??8H????@?AA?ld>+?y?S?<???M?W[??A?1<?~j?l??????m?@d?A?ld>+?y?S?<???v??`??s?1<+|j?m?????N?????AaQ}?????q
-?Y??>?`???-?4?i<???????????7AaQ}?????q
-???`????-?ipi<?????5???????AaQ}?????q
-?Ow?j??>??-??Ei<?????4??n??W?AaQ}?????q
-?
-i<????#q?????D	AW_A?D?'???:X?!?K< =?Q-?b?h<???J)???z@?AAW_A?D?'???:??!??KF?#.-??h<????????<@?AW_A?D?'???:???>?HF??Q-?b?h<????????<@?A?R??F{h??X<???>?HF???,?@i<???J)???z@?AA?R??F{h??X<??!??KF???,??i<????<???.@5KA?R??F{h??X<2X!???????,?Di<???	?????@?A?R??F{h??X<mo?>8?????,??i<???LS???N@??A?c>??y?5)?<`? ?????,<??i??????????@]@A?c>??y?5)?<??>????,<?i???????31@?A?c>??y?5)?<mo?>8?????,<??i????a????@8?A?c>??y?5)?<2X!?????#?,<??i????a????@8?A???>EHi??8?<2X!???????,<j???????31@?A???>EHi??8?<mo?>8?????,<Vj?????????@?A???>EHi??8?<???>?HF???,<j????oc??a@|?A???>EHi??8?<??!??KF?
-?,<?
-j????PS???????ADk=?',????<v??>?D =B-<?@j????%?K>??`ADk=?',????<X?!?K< =ie-<?j????oc??a@|?ADk=?',????<??!??KF?B-<?@j?????????@?ADk=?',????<???>?HF??-<?gj????%?K>??`A??m??l????w<X?!?K< =?-<V>j????PS???????A??m??l????w<v??>?D =??-<3j?????B#?b????A??m??l????w<
-?T<?y<?????`??????|?.[&?>~z<ue?Sw???)A
-?T<?y<????~??z4???|?+%??>z<n
-?T<?y<???*??????>??|?.[&?>~z<??5???????A
-?T<?y<???!?`???>?|?C?'???z<?B#?b????A?T??!t=P??!?`???>2?{???4????<U0??m????A?T??!t=P??*??????>?'|???.???<UQD?5F???A?T??!t=P???~??z4???l|??6(?w?<=?3?7???k?A?T??!t=P????`?????'|???.???<??5???????A?g	=?o;???!?`???>?j|??1'??
-=n
-=?=I??@j?A?g	=?o;????~}??%[???|?vn??
-=?#q?????D	A?g	=?o;????.??U=?|??? ?V
-=?#q?????D	A2?C=j?%?????.??U=L?}??????<=?=I??@j?A2?C=j?%?????~}??%[??m}??????<=??????@L6A2?C=j?%?????????????Z}?T??x<=J)???z@?AA2?C=j?%????s;?[	??m}??????<=J)???z@?AA_?W<???;???s;?[	???|?!?$?x?e<??????@L6A_?W<???;?????????????|??b$???e<8H????@?AA_?W<???;???J_?=?2??>?|?}$?~?e<?<???.@5KA_?W<???;???b-?=g,z???|??b$???e<NA????"@?4Ap%;????<??N?v>????i!|?Q?*???@=?6????@'Ap%;????<??J_?=?2???0|??D)???@=???31@?Ap%;????<??b-?=g,z?q@|?i?'??z@=??????@]@Ap%;????<??:??>????0|??D)???@=???31@?A?X???U?;{h?b-?=g,z???{??/?x??=?6????@'A?X???U?;{h?J_?=?2????{??.???=?????@1?A?X???U?;{h???????????{??/?x??=?????@?A?X???U?;{h?s;?[	???{??E/????=???o?@tA6?????;?d??~}??%[???{?gv/?C??=PS???????A6?????;?d??.??U="?{??G-????=?????@?A6?????;?d?s;?[	???{?gv/?C??=?????@1?A6?????;?d???????????{???1??}?=U0??m????A?{???
-S=???*??????>,|??".?cC?<?B#?b????A?{???
-S=???!?`???>f?{??4?e??<PS???????A?{???
-S=????.??U=,|??".?cC?<???o?@tA?{???
-S=????~}??%[??t|??v'????<?<???.@5KAy?l8<@??b-?=g,z???|?d?%?_???8H????@?AAy?l8<@??J_?=?2????|??	'?7
-A????	S?U??;?~}??%[??a(;v'?~?|???V?K>????A????	S?U??;?.??U=?>;?".?+E|???T??_???RA????	S?U??;!?`???>PU;r?4??{?R?T? ???D?A????	S?U??;*??????>?>;?".?+E|???V?K>????A???i???l?1??.??U=H4=?F-??|??W?:?@<?
-A???i???l?1??~}??%[?=4=?u/??{?"oV???@EyA???i???l?1??????????4=p?1??{??V??a@?A???i???l?1?s;?[	?=4=?u/??{??U?p?@?	A???E??N&.?J_?=?2????0=-?.??
??9k???k<??U?q?@+?@????W{h?c%????v??`??????%k?*?i<??D???@???@????W{h?c%????M?W[??????Lk?-1i<`?E???@??@????W{h?c%??4LM??d(?????%k?*?i<sIV??a@z6?@????W{h?c%??v?/m(?????j?'?i<?U?p?@?	A? /???y??kc>??M?W[?????@?h<%?h??D???@??A? /???y??kc>??v??`?????r?h<??h?B`D???"@???@? /???y??kc>?bw????????h<?h?UjU???"@b?@? /???y??kc>??N?b?????r?h<??h?"oV???@EyA????4Hi?,??>4LM??d(????g-h<c?i?eE???@~iA????4Hi?,??>v?/m(?????h<`?i??D???@??A????4Hi?,??>??v??`???????g<^=i??U?p?@?	A????4Hi?,??>??M?W[??????h<`?i??W?:?@<?
-Ai??:1',??x=?z?M????=???8h<??k??	F?o?@u?
-Ai??:1',??x=?[xv????=?????g<?(k?eE???@~iAi??:1',??x=?v?/m(????Qg<??j?"oV???@EyAi??:1',??x=?4LM??d(??????g<?(k?R?T? ???D?A??<?l?>x?m??(Q???????<h<?fl?:?C??m??~xA??<?l?>x?m?n?y?;???????h<??l??	F?o?@u?
-A??<?l?>x?m?[xv????=???<h<?fl??W?:?@<?
-A??<?l?>x?m?z?M????=???$?g<{%l?UjU???"@b?@>???+?y??d??bw????????j?=?h<B`D???"@???@>???+?y??d???N?b???????j? ?h<??D???@???@>???+?y??d???M?W[???????j?=?h<??U?q?@+?@>???+?y??d???v??`??????|j?Y?h<?5W?,????o?@??<????J}?Y??>?`??}????i<&?l??+F?????PP?@??<????J}???`?????hi<??l?u?F?????0??@??<????J}?Ow?j??>????Ei<W?l???W??n?????@??<????J}?
-?h<?6m?1W?_\??s,?@??<]k??cm?v??>?D =????i<!$m?1W?_\??s,?@??<D?'??MA?v??>?D =}??W	i<?fm?k'F???????@??<D?'??MA?X?!?K< =~???h<}?m???D??z@[o?@??<D?'??MA???!??KF?~????h<Z?m??U??<@???@??<D?'??MA????>?HF?~???h<}?m??U??<@???@???<F{h??%?>???>?HF?t???i<??m???D??z@[o?@???<F{h??%?>??!??KF?t???i<??m?scD??.@ ??@???<F{h??%?>2X!?????t??^i<?n??mU???@???@???<F{h??%?>mo?>8???t???i<??m?`:U??N@q/?@%/<p?y??kc?`? ???d??N?i???n<M0D???@??@%/<p?y??kc???>??d??1?i?rLn<tD?31@?6A%/<p?y??kc?mo?>8???d??N?i???n<$~U??@tFA%/<p?y??kc?2X!?????e??j?i?3n<$~U??@tFA???;4Hi?,???2X!?????e??L	j??n<tD?31@?6A???;4Hi?,???mo?>8???d??lj?Tn<?E???@Q?A???;4Hi?,??????>?HF?e??L	j??n<?V??a@?A???;4Hi?,?????!??KF?g??,?i??m<??E???????Ai???',??x=?v??>?D =i??'8j???m<??V?K>????Ai???',??x=?X?!?K< =m??1j?uwm<?V??a@?Ai???',??x=???!??KF?i??'8j???m<?E???@Q?Ai???',??x=????>?HF?f??Wj???m<??V?K>????A~???l??x?m?X?!?K< =n??>j??@m<??E???????A~!
 ???l??x?m?v??>?D =r???j?e+m<??C?b????BA~???l??x?m?
???;?????????????=?b$?$||???D???@???@?????;???J_?=?2????=}$??~|?scD??.@ ??@?????;???b-?=g,z???=?b$?$||?B`D???"@???@??????<q?<N?v>???????<??*?^Z|??D???@??A??????<q?<J_?=?2??x??<?D)??i|?tD?31@?6A??????<q?<b-?=g,z?u?<??'?Zy|?M0D???@??@??????<q?<:??>???x??<?D)??i|?tD?31@?6A???E?;5$.=b-?=g,z???0=%/???{??D???@??A???E?;5$.=J_?=?2????0=??.??
-A??????;_?1=?~}??%[?b4=?v/?v?{???E???????A??????;_?1=?.??U=l4=?G-??|??E???@Q?A??????;_?1=s;?[	?b4=?v/?v?{?eE???@~iA??????;_?1=????????"4=M?1???{?:?C??m??~xA????S=???*??????>??>;?".?)E|???C?b????BA????S=???!?`???>?'U;?4??{???E???????A????S=????.??U=??>;?".?)E|??	F?o?@u?
-A????S=????~}??%[??=(;?v'?v?|?scD??.@ ??@Z??:8<?-??b-?=g,z?*S?<`?%???|???D???@???@Z??:8<?-??J_?=?2??$l?<?	'???|?B`D???"@???@Z??:8<?-??N?v>??????<?u(??x|?M0D???@??@Z??:8<?-??:??>???$l?<?	'???|?????m?@???@Z??:8??1?<J_?=?2??;p?<?'???|??????@`I?@Z??:8??1?<b-?=g,z?8W?<-?%???|?Gr???N@&??@Z??:8??1?<:??>???;p?<?'???|??????"@??@Z??:8??1?<N?v>????+??<cu(??x|??>??:?@??
-A????S?U??;?~}??%[??^(;?u'??|??U??K>???TA????S?U??;?.??U=??>;?".?,E|?-???_???A????S?U??;!?`???>_LU;<?4??{????? ????CA????S?U??;*??????>??>;?".?,E|??U??K>???TA???i???l?1??.??U=G4=BG-??|??>??:?@??
-A???i???l?1??~}??%[?=4=v/?v?{?v????@?4A???i???l?1??????????4=??1???{?i???a@r?A???i???l?1?s;?[	?=4=v/?v?{?<???l?@?A????<??N&.?J_?=?2????0=G?.??
-??F???p?@x???{/>I-|??(Q????t??`Fj??l<	???Sw??S??@x???{/>I-|?$T??`??x????i???l<@P??i?????@x???{/>I-|???|??`??}??;?i???l<????7??]LAs;<q?E>b,{??S??`??????2i<?l? ^W?5F???<As;<q?E>b,{?a3|??`??}????i<??l??????m???3As;<q?E>b,{?n?y?;??????2i<?l????? ????CAs;<q?E>b,{??(Q?????????h<h?l??&????@	??@????<k?>$cm?[xv????=q???j?acl<?W???@}??@????<k?>$cm?z?M????=k??X?k??l<P
-??F???p?@????<k?>$cm??(Q????q???j?acl<?]??>???:??@????<k?>$cm?n?y?;??w???>j???l<?????a@.??@???D?'??MA?v?/m(?x??"?k??k<i????@???@???D?'??MA?4LM??d(?w???9l??j<?W???@}??@???D?'??MA?z?M????=x??"?k??k<?&????@	??@???D?'??MA?[xv????=y??9k???k<????m?@???@????F{h?c%????v??`?????+/k?	{i<?T????@Um?@????F{h?c%????M?W[??????Rk?Z-i<i????@???@????F{h?c%??4LM??d(????+/k?	{i<?????a@.??@????F{h?c%??v?/m(????`k???i<<???l?@?A%/???y??kc>??M?W[???????h<w?h??????@N?A%/???y??kc>??v??`?????`?h<b?h???????"@?k?@%/???y??kc>?bw????????h<O?h??????"@??@%/???y??kc>??N?b?????`?h<b?h?v????@?4A???4Hi?,??>4LM??d(?????,h<??i?h????@?$A???4Hi?,??>v?/m(?????h<??i??????@N?A???4Hi?,??>??v??`?????b?g<]3i?<???l?@?A???4Hi?,??>??M?W[??????h<??i??>??:?@??
-A?F?:1',??x=?z?M????=???dh<??k?????o?@??
-A?F?:1',??x=?[xv????=?????g<k?h????@?$A?F?:1',??x=?v?/m(????g<P?j?v????@?4A?F?:1',??x=?4LM??d(??????g<k????? ????CA~?<?l?>x?m??(Q????????7h<grl??????m???3A~?<?l?>x?m?n?y?;?????x?h<??l?????o?@??
-A~?<?l?>x?m?[xv????=????7h<grl??>??:?@??
-A~?<?l?>x?m?z?M????=?????g<&/l??????"@??@>???+?y??d??bw??????mj??h<??????"@?k?@>???+?y??d???N?b?????O?j???h<?T????@Um?@>???+?y??d???M?W[?????mj??h<????m?@???@>???+?y??d???v??`??????}j?C?h<rM??N??????@/?<????J}?Y??>?`??|??=?i<??l???????????@/?<????J}???`??~??#ji<??l??????????@/?<????J}?Ow?j??>???	Hi<?
-j???m<37????@??A??;4Hi?,??????>?HF?g??Jj?O?m<i???a@r?A??;4Hi?,?????!??KF?g??Ij???m<???????6EA?F??',??x=?v??>?D =j???;j??m<?U??K>???TA?F??',??x=?X?!?K< =n??'j?Ugm<i???a@r?A?F??',??x=???!??KF?j???;j??m<37????@??A?F??',??x=????>?HF?f???]j???m<?U??K>???TA????l??x?m?X?!?K< =o???=j?3m<???????6EA????l??x?m?v??>?D =s??yj??m<?q??b???-?A????l??x?m?
-??F???p?@????y<??*??????> ?#=?[&?)d|??????????@????y<??!?`???>??#=x?'??W|??q??b???-?A???s=??G?!?`???>%?S;??4???{??????m???3A???s=??G?*??????>@2E;
-??F???p?@???G?o;7?o?*??????>h^o=?? ?Ta|??W???@}??@???G?o;7?o??~}??%[?5?o=?o???|??j?????????@???G?o;7?o??.??U=h^o=?? ?Ta|??j?????????@wN?j?%??5???.??U=4?=e??$ }??W???@}??@wN?j?%??5???~}??%[???=???}?i????@???@wN?j?%??5??????????n?=}???|??[???z@??@wN?j?%??5??s;?[	???=???}??[???z@??@??????;???s;?[	???=4?$?[y|?i????@???@??????;?????????????=?c$?||??T????@Um?@??????;???J_?=?2????=E $??~|??????.@?)?@??????;???b-?=g,z???=?c$?||???????"@?k?@??????<q?<N?v>???????<L?*?[Z|??????@N?A??????<q?<J_?=?2??x??<?D)??i|?"???31@?
-A???i??;_?1=?~}??%[?44=1w/?o?{????????6EA???i??;_?1=?.??U=>4=H-??|?37????@??A???i??;_?1=s;?[	?44=1w/?o?{?h????@?$A???i??;_?1=?????????
-A????S=????~}??%[?
->(;?v'?v?|??????.@?)?@Z??:8<?-??b-?=g,z?S?<??%???|??T????@Um?@Z??:8<?-??J_?=?2??$l?<?	'???|???????"@?k?@Z??:8<?-??N?v>??????<;v(??x|???????@???@Z??:8<?-??:??>???$l?<?	'???|?@
-
-
-
-
->!\?>
-
-
-
-??I??
-??={?u7?-;!B
->??@??????d?
-?????
-;c?=	?G>????
-;W?=2?G>D???
-
-
-@
-?%@8???;?1[?
-<???

?
-?
-
-
<?8?>x??<
-?^???

-???D-?)??>`?[@
->&??
-
-
-?

?
-
-
-?
-
-
-????,?y8?????
-?
-?
-
-
-??(?b:.??
-
-
-
-
-D??
-q?=%?{?O??:t/?

-
-?
-W?f@?=???<????
-???q???????I?m@

-9<?|??"C7?
-?
-?
-
-
-??=o???
-??W??>
?
-?????
-?}???
-??3??
-
-
-4;?t??
-
-
-
->l???
-
-
-

-?:?<6X%@
-
-??

-??I^w?Im?<aZ??
-??I^w?Im?<aZ??
-:??-???q?N???
-):k`T?????????
-?
-	
-	
-???-:g?q=w???
-)?]`T:??=?
-??
-??
-@
-)?
-)?
-
-
-
-:]?-???q??[?
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-?????d???l2?
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-??
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-?h??y;?
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-?{??l9??=
-
-
-
-?{??#9#??=
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-3>
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-???-:h?q=tb?
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-0:?z?p?d???>
-
-
-=
-=
-
-

-?:??z?B[e<?.?<
-<
-/<
-
-
-
-
-
-
-
-
-
-
-

-
-
-


-
-
-
-
-
-


-
-

-
-
-
-
-
-
-
-
-
-
-
-
-

-
-


-
-
-
-
-
-


-
-
-
-
-
-
-
-
-

-
-
-
-


-	
-	


-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-
-

\ No newline at end of file

Deleted: modules/kanalisation/maps/treppe_01.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/treppe_02.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/treppe_gemauert.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/tuern.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/wand_03.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/wand_04.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/wurzeln_02.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/wurzeln_alle.mesh
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/maps/wurzeln_klein.mesh
===================================================================
(Binary files differ)



From alassion at mail.berlios.de  Wed Jul  2 23:08:36 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:08:36 +0200
Subject: [Dsa-hl-svn] r4418 - modules
Message-ID: <200807022108.m62L8ai5023679@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:08:35 +0200 (Wed, 02 Jul 2008)
New Revision: 4418

Removed:
   modules/kanalisation/
Log:
- deleted whole sewer -



From alassion at mail.berlios.de  Wed Jul  2 23:27:12 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:27:12 +0200
Subject: [Dsa-hl-svn] r4419 - modules
Message-ID: <200807022127.m62LRCDs024774@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:27:11 +0200 (Wed, 02 Jul 2008)
New Revision: 4419

Added:
   modules/kanalisation/
Log:
new sewer



From alassion at mail.berlios.de  Wed Jul  2 23:27:59 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:27:59 +0200
Subject: [Dsa-hl-svn] r4420 - modules/kanalisation
Message-ID: <200807022127.m62LRxmo024795@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:27:56 +0200 (Wed, 02 Jul 2008)
New Revision: 4420

Added:
   modules/kanalisation/dialogs/
Log:




From alassion at mail.berlios.de  Wed Jul  2 23:28:08 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:28:08 +0200
Subject: [Dsa-hl-svn] r4421 - modules/kanalisation
Message-ID: <200807022128.m62LS8x2024806@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:28:07 +0200 (Wed, 02 Jul 2008)
New Revision: 4421

Added:
   modules/kanalisation/dsa/
Log:




From alassion at mail.berlios.de  Wed Jul  2 23:28:17 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:28:17 +0200
Subject: [Dsa-hl-svn] r4422 - modules/kanalisation
Message-ID: <200807022128.m62LSHli024817@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:28:15 +0200 (Wed, 02 Jul 2008)
New Revision: 4422

Added:
   modules/kanalisation/gui/
Log:




From alassion at mail.berlios.de  Wed Jul  2 23:28:37 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:28:37 +0200
Subject: [Dsa-hl-svn] r4423 - modules/kanalisation
Message-ID: <200807022128.m62LSbkf024828@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:28:37 +0200 (Wed, 02 Jul 2008)
New Revision: 4423

Added:
   modules/kanalisation/maps/
Log:




From alassion at mail.berlios.de  Wed Jul  2 23:28:48 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:28:48 +0200
Subject: [Dsa-hl-svn] r4424 - modules/kanalisation
Message-ID: <200807022128.m62LSmeh024856@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:28:47 +0200 (Wed, 02 Jul 2008)
New Revision: 4424

Added:
   modules/kanalisation/materials/
Log:




From alassion at mail.berlios.de  Wed Jul  2 23:29:05 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:29:05 +0200
Subject: [Dsa-hl-svn] r4425 - modules/kanalisation
Message-ID: <200807022129.m62LT5Wo024870@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:29:04 +0200 (Wed, 02 Jul 2008)
New Revision: 4425

Added:
   modules/kanalisation/models/
Log:




From alassion at mail.berlios.de  Wed Jul  2 23:29:14 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:29:14 +0200
Subject: [Dsa-hl-svn] r4426 - modules/kanalisation
Message-ID: <200807022129.m62LTEjT024881@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:29:13 +0200 (Wed, 02 Jul 2008)
New Revision: 4426

Added:
   modules/kanalisation/quests/
Log:




From alassion at mail.berlios.de  Wed Jul  2 23:29:24 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:29:24 +0200
Subject: [Dsa-hl-svn] r4427 - modules/kanalisation
Message-ID: <200807022129.m62LTOxV024895@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:29:22 +0200 (Wed, 02 Jul 2008)
New Revision: 4427

Added:
   modules/kanalisation/scripts/
Log:




From alassion at mail.berlios.de  Wed Jul  2 23:29:34 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:29:34 +0200
Subject: [Dsa-hl-svn] r4428 - modules/kanalisation
Message-ID: <200807022129.m62LTYSp024933@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:29:33 +0200 (Wed, 02 Jul 2008)
New Revision: 4428

Added:
   modules/kanalisation/sound/
Log:




From alassion at mail.berlios.de  Wed Jul  2 23:45:52 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Wed, 2 Jul 2008 23:45:52 +0200
Subject: [Dsa-hl-svn] r4429 - in modules/kanalisation: maps materials models
	scripts sound
Message-ID: <200807022145.m62Ljqpp026528@sheep.berlios.de>

Author: alassion
Date: 2008-07-02 23:39:21 +0200 (Wed, 02 Jul 2008)
New Revision: 4429

Added:
   modules/kanalisation/maps/Circle.011.mesh
   modules/kanalisation/maps/Circle.mesh
   modules/kanalisation/maps/Cube.001.mesh
   modules/kanalisation/maps/Cube.002.mesh
   modules/kanalisation/maps/Cube.003.mesh
   modules/kanalisation/maps/Cube.004.mesh
   modules/kanalisation/maps/Cube.005.mesh
   modules/kanalisation/maps/Cube.006.mesh
   modules/kanalisation/maps/Cube.007.mesh
   modules/kanalisation/maps/Cube.008.mesh
   modules/kanalisation/maps/Cube.009.mesh
   modules/kanalisation/maps/Cube.010.mesh
   modules/kanalisation/maps/Cube.011.mesh
   modules/kanalisation/maps/Cube.012.mesh
   modules/kanalisation/maps/Cube.013.mesh
   modules/kanalisation/maps/Cube.014.mesh
   modules/kanalisation/maps/Cube.015.mesh
   modules/kanalisation/maps/Cube.016.mesh
   modules/kanalisation/maps/Cube.019.mesh
   modules/kanalisation/maps/Cube.023.mesh
   modules/kanalisation/maps/Cube.025.mesh
   modules/kanalisation/maps/Cube.026.mesh
   modules/kanalisation/maps/Cube.027.mesh
   modules/kanalisation/maps/Cube.032.mesh
   modules/kanalisation/maps/Cube.mesh
   modules/kanalisation/maps/Plane.001.mesh
   modules/kanalisation/maps/Plane.002.mesh
   modules/kanalisation/maps/Plane.003.mesh
   modules/kanalisation/maps/Plane.007.mesh
   modules/kanalisation/maps/Plane.mesh
   modules/kanalisation/maps/boden_fels.001.mesh
   modules/kanalisation/maps/boden_fels.002.mesh
   modules/kanalisation/maps/boden_komplett.mesh
   modules/kanalisation/maps/brocken.001.mesh
   modules/kanalisation/maps/brocken.mesh
   modules/kanalisation/maps/bruecke.mesh
   modules/kanalisation/maps/brunnen.mesh
   modules/kanalisation/maps/durchbruch.mesh
   modules/kanalisation/maps/durchbruch_02.mesh
   modules/kanalisation/maps/durchgang.mesh
   modules/kanalisation/maps/fackeln.001.mesh
   modules/kanalisation/maps/fackeln.002.mesh
   modules/kanalisation/maps/fackeln.003.mesh
   modules/kanalisation/maps/fackeln.004.mesh
   modules/kanalisation/maps/fackeln.mesh
   modules/kanalisation/maps/farn.mesh
   modules/kanalisation/maps/felswaende.mesh
   modules/kanalisation/maps/gaenge_komplett.002.mesh
   modules/kanalisation/maps/gaenge_komplett.003.mesh
   modules/kanalisation/maps/gaenge_komplett.004.mesh
   modules/kanalisation/maps/gaenge_komplett.017.mesh
   modules/kanalisation/maps/gaenge_komplett.mesh
   modules/kanalisation/maps/grasbueschel.mesh
   modules/kanalisation/maps/kana_lights.rlmap.xml
   modules/kanalisation/maps/kanalisation.material
   modules/kanalisation/maps/kanalisation.scene
   modules/kanalisation/maps/kanalisation_scene.xml
   modules/kanalisation/maps/kisten_01.mesh
   modules/kanalisation/maps/matschboden.mesh
   modules/kanalisation/maps/moderbalken_01.mesh
   modules/kanalisation/maps/pilze.001.mesh
   modules/kanalisation/maps/randsteine_01.mesh
   modules/kanalisation/maps/randsteine_02.mesh
   modules/kanalisation/maps/randsteine_03.001.mesh
   modules/kanalisation/maps/randsteine_03.002.mesh
   modules/kanalisation/maps/randsteine_03.004.mesh
   modules/kanalisation/maps/randsteine_03.mesh
   modules/kanalisation/maps/randsteine_04.001.mesh
   modules/kanalisation/maps/randsteine_04.mesh
   modules/kanalisation/maps/raum_01.001.mesh
   modules/kanalisation/maps/raum_01.002.mesh
   modules/kanalisation/maps/raum_01.003.mesh
   modules/kanalisation/maps/raum_01.004.mesh
   modules/kanalisation/maps/raum_01.005.mesh
   modules/kanalisation/maps/raum_01.006.mesh
   modules/kanalisation/maps/raum_01.007.mesh
   modules/kanalisation/maps/raum_01.mesh
   modules/kanalisation/maps/rostkette.mesh
   modules/kanalisation/maps/saeule_01.001.mesh
   modules/kanalisation/maps/saeule_01.002.mesh
   modules/kanalisation/maps/saeule_01.003.mesh
   modules/kanalisation/maps/saeule_01.004.mesh
   modules/kanalisation/maps/saeule_01.011.mesh
   modules/kanalisation/maps/saeule_01.mesh
   modules/kanalisation/maps/saeule_05.mesh
   modules/kanalisation/maps/saeule_06.mesh
   modules/kanalisation/maps/saeule_07.001.mesh
   modules/kanalisation/maps/saeule_07.003.mesh
   modules/kanalisation/maps/saeule_07.mesh
   modules/kanalisation/maps/saeule_08.001.mesh
   modules/kanalisation/maps/saeule_08.mesh
   modules/kanalisation/maps/saeule_09.004.mesh
   modules/kanalisation/maps/saeulen.004.mesh
   modules/kanalisation/maps/saeulen.mesh
   modules/kanalisation/maps/smuggler.mesh
   modules/kanalisation/maps/stuetzbalken.mesh
   modules/kanalisation/maps/stuetzpfeiler_quer.mesh
   modules/kanalisation/maps/stuetzwand.mesh
   modules/kanalisation/maps/torboegen.002.mesh
   modules/kanalisation/maps/treppe_01.mesh
   modules/kanalisation/maps/treppe_02.mesh
   modules/kanalisation/maps/treppe_gemauert.001.mesh
   modules/kanalisation/maps/treppe_gemauert.003.mesh
   modules/kanalisation/maps/treppe_gemauert.mesh
   modules/kanalisation/maps/tuern.001.mesh
   modules/kanalisation/maps/tuern.mesh
   modules/kanalisation/maps/wand_03.mesh
   modules/kanalisation/maps/wand_04.mesh
   modules/kanalisation/maps/wasser.mesh
   modules/kanalisation/maps/wurzeln_02.mesh
   modules/kanalisation/maps/wurzeln_alle.001.mesh
   modules/kanalisation/maps/wurzeln_alle.mesh
   modules/kanalisation/maps/wurzeln_klein.mesh
   modules/kanalisation/materials/Normalmapping.program
   modules/kanalisation/materials/vlight.material
   modules/kanalisation/materials/vlight.particle
   modules/kanalisation/materials/waber.material
   modules/kanalisation/materials/waber.particle
   modules/kanalisation/models/axe_weap.mesh
   modules/kanalisation/models/breitschwert.mesh
   modules/kanalisation/models/breitschwert_stehend.mesh
   modules/kanalisation/models/fass_liegend.mesh
   modules/kanalisation/models/fass_stapel.mesh
   modules/kanalisation/models/fass_stehend.mesh
   modules/kanalisation/models/rostkette.mesh
   modules/kanalisation/models/schild.mesh
   modules/kanalisation/scripts/equip.rb
   modules/kanalisation/scripts/moduleconfig.rb
   modules/kanalisation/scripts/particle.rb
   modules/kanalisation/sound/kanal.ogg
Log:
- new sewer -

Added: modules/kanalisation/maps/Circle.011.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Circle.011.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Circle.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Circle.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.005.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.005.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.006.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.006.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.007.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.007.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.008.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.008.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.009.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.009.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.010.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.010.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.011.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.011.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.012.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.012.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.013.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.013.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.014.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.014.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.015.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.015.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.016.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.016.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.019.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.019.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.023.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.023.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.025.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.025.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.026.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.026.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.027.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.027.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.032.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.032.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Cube.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Cube.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Plane.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Plane.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Plane.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Plane.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Plane.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Plane.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Plane.007.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Plane.007.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/Plane.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/Plane.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/boden_fels.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/boden_fels.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/boden_fels.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/boden_fels.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/boden_komplett.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/boden_komplett.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/brocken.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/brocken.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/brocken.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/brocken.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/bruecke.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/bruecke.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/brunnen.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/brunnen.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/durchbruch.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/durchbruch.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/durchbruch_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/durchbruch_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/durchgang.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/durchgang.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/fackeln.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fackeln.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/fackeln.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fackeln.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/fackeln.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fackeln.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/fackeln.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fackeln.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/fackeln.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/fackeln.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/farn.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/farn.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/felswaende.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/felswaende.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/gaenge_komplett.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/gaenge_komplett.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/gaenge_komplett.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/gaenge_komplett.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/gaenge_komplett.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/gaenge_komplett.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/gaenge_komplett.017.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/gaenge_komplett.017.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/gaenge_komplett.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/gaenge_komplett.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/grasbueschel.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/grasbueschel.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/kana_lights.rlmap.xml
===================================================================
--- modules/kanalisation/maps/kana_lights.rlmap.xml	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/maps/kana_lights.rlmap.xml	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,65 @@
+<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
+<rastullahmap formatVersion="0.4.0">
+	<nodes>
+		<light name="fackkellicht" type="point" visible="true"
+			castShadows="false">
+			<position x="-1.39" y="6.06" z="12.84" />
+			<colourDiffuse r="0.8" g="0.7" b="0.5" />
+			<colourSpecular r="0.8" g="0.7" b="0.5" />
+			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
+		</light>
+		<light name="fackkellicht2" type="point" visible="true"
+			castShadows="false">
+			<position x="11.39" y="6.06" z="9.75" />
+			<colourDiffuse r="0.8" g="0.7" b="0.5" />
+			<colourSpecular r="0.8" g="0.7" b="0.5" />
+			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
+		</light>
+		<light name="fackkellicht3" type="point" visible="true"
+			castShadows="false">
+			<position x="-22.48" y="4.60" z="23.10" />
+			<colourDiffuse r="0.8" g="0.7" b="0.5" />
+			<colourSpecular r="0.8" g="0.7" b="0.5" />
+			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
+		</light>
+		<light name="fackkellicht4" type="point" visible="true"
+			castShadows="false">
+			<position x="36.49" y="7.37" z="30.27" />
+			<colourDiffuse r="0.8" g="0.7" b="0.5" />
+			<colourSpecular r="0.8" g="0.7" b="0.5" />
+			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
+		</light>
+		<light name="fackkellicht5" type="point" visible="true"
+			castShadows="false">
+			<position x="59.78" y="7.14" z="28.66" />
+			<colourDiffuse r="0.8" g="0.7" b="0.5" />
+			<colourSpecular r="0.8" g="0.7" b="0.5" />
+			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
+		</light>
+		<light name="fackkellicht6" type="point" visible="true"
+			castShadows="false">
+			<position x="-28.65" y="4.77" z="23.94" />
+			<colourDiffuse r="0.8" g="0.7" b="0.5" />
+			<colourSpecular r="0.8" g="0.7" b="0.5" />
+			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
+		</light>
+		<light name="fackkellicht7" type="point" visible="true"
+			castShadows="false">
+			<position x="-28.65" y="4.77" z="28.39" />
+			<colourDiffuse r="0.8" g="0.7" b="0.5" />
+			<colourSpecular r="0.8" g="0.7" b="0.5" />
+			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
+		</light>
+	</nodes>
+	<zones>
+		<zone name="default">
+			<light name="fackkellicht"/>
+			<light name="fackkellicht2"/>
+			<light name="fackkellicht3"/>
+			<light name="fackkellicht4"/>
+			<light name="fackkellicht5"/>
+			<light name="fackkellicht6"/>
+			<light name="fackkellicht7"/>
+		</zone>
+	</zones>
+</rastullahmap>

Added: modules/kanalisation/maps/kanalisation.material
===================================================================
--- modules/kanalisation/maps/kanalisation.material	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/maps/kanalisation.material	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,255 @@
+material matschboden/SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap boden_kana.png
+set_texture_alias NormalMap boden_kana_normal.png
+}
+material farn/ALPHA/TEX/farn.png
+{ 
+   technique 
+   { 
+      pass 
+      { 
+      ambient 0.609804 0.609804 0.609804 1
+			diffuse 0.631373 0.631373 0.631373 1
+			specular 0 0 0 1 10
+                         // Rendert beidseitig 
+         cull_hardware none 
+         cull_software none 
+	 alpha_rejection greater 215 
+
+         texture_unit 
+         { 
+            texture farn.png             
+	    filtering linear linear linear 
+         } 
+      } 
+   } 
+material wurzeln_02/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material treppe_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material fass_stehend/SOLID/TEX/fass_kanalisation.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap fass_kanalisation.png
+set_texture_alias NormalMap fass_kanalisation_normal.png
+}
+material Material.009/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material pilze/SOLID/TEX/pilz3.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap pilz3.png
+set_texture_alias NormalMap pilz_normal.png
+}
+material SOLID/TEX/boden_02_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap boden_02_kana.png
+set_texture_alias NormalMap boden_02_kana_normal.png
+}
+material tempelgang_treppe/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material randsteine_03/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material randsteine_01/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material brunnen/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material torboegen/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material brocken/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.015/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material Material/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material Material.014/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material wurzeln_texturen/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material randsteine_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material boden_kana/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material SOLID/TEX/boden_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material sauelen_13/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material saeulen_raum_01_02/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material saeulen_raum_01/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material tempelgang_waende/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material fackeln/SOLID: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap fackel_kana.png
+set_texture_alias NormalMap fackel_kana_normal.png
+}
+material boden_13/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material randsteine_04/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material tempelgang_randsteine/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material wurzeln_alle/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material felswaende/SOLID/TEX/felsen_3_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap felsen_3_kana.png
+set_texture_alias NormalMap felsen_3_kana_normal.png
+}
+material stuetzbalken/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material wurzeln_klein/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material tempelgang_decke/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material rostkette/SOLID/TEX/rust_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap rust_kana.png
+set_texture_alias NormalMap rust_kana_normal.png
+}
+material Material.016/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material saeulen_tempelgang/SOLID/TEX/saeule_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap saeule_kana.png
+set_texture_alias NormalMap saeule_kana_normal.png
+}
+material durchbruch_02/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material fackeln/SOLID/TEX/fackel_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap fackel_kana.png
+set_texture_alias NormalMap fackel_kana_normal.png
+}
+material SOLID/TEX/rust_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap rust_kana.png
+set_texture_alias NormalMap rust_kana_normal.png
+}
+material stuetzpfeiler_quer/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material gaenge_komplett/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material boden_komplett.001/SOLID/TEX/boden_kana.png/VertCol: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap boden_kana.png
+set_texture_alias NormalMap boden_kana_normal.png
+}
+material wasser/SOLID/TEX/Untitled : Wassershader
+{
+set_texture_alias Cubemap desert07.dds
+}
+material saeulen_texturen/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}
+material moderbalken_01/SOLID/TEX/baumstamm_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap baumstamm_kana.png
+set_texture_alias NormalMap baumstamm_kana_normal.png
+}
+material durchgang_kaputt/SOLID/TEX/wand_kana.png: Basic_Normalmapping_kana
+{
+set_texture_alias DiffuseMap wand_kana.png
+set_texture_alias NormalMap wand_kana_normal.png
+}

Added: modules/kanalisation/maps/kanalisation.scene
===================================================================
--- modules/kanalisation/maps/kanalisation.scene	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/maps/kanalisation.scene	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,535 @@
+<scene formatVersion="0.2.0">
+  <nodes>
+    <node name="bruecke">
+      <position x="2.892947" y="3.346505" z="7.881136"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="bruecke" meshFile="bruecke.mesh"/>
+    </node>
+    <node name="boden_komplett_oben">
+      <position x="4.907471" y="-33.657059" z="9.325613"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="boden_komplett_oben" meshFile="Plane.001.mesh"/>
+    </node>
+    <node name="wurzeln_03">
+      <position x="3.815631" y="3.215424" z="3.961683"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="wurzeln_03" meshFile="wurzeln_klein.mesh"/>
+    </node>
+    <node name="felsen_hoehle">
+      <position x="30.294416" y="7.783535" z="26.360363"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="felsen_hoehle" meshFile="felswaende.mesh"/>
+    </node>
+    <node name="saeule_08.001">
+      <position x="56.201435" y="9.379703" z="41.718800"/>
+      <rotation qx="-0.000281" qy="-0.708033" qz="-0.000282" qw="0.706179"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_08.001" meshFile="saeule_08.001.mesh"/>
+    </node>
+    <node name="pilze">
+      <position x="6.899021" y="-0.008500" z="13.837756"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="pilze" meshFile="pilze.001.mesh"/>
+    </node>
+    <node name="matschboden">
+      <position x="4.907471" y="-33.657059" z="9.325613"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="matschboden" meshFile="matschboden.mesh"/>
+    </node>
+    <node name="tuern.001">
+      <position x="51.963837" y="4.320960" z="56.169384"/>
+      <rotation qx="-0.000281" qy="-0.708033" qz="-0.000282" qw="0.706179"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tuern.001" meshFile="tuern.001.mesh"/>
+    </node>
+    <node name="boden_komplett_ob">
+      <position x="59.330944" y="-33.159164" z="48.060108"/>
+      <rotation qx="-0.000281" qy="-0.708033" qz="-0.000282" qw="0.706179"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="boden_komplett_ob" meshFile="Plane.007.mesh"/>
+    </node>
+    <node name="gaenge_01">
+      <position x="-14.217243" y="3.248992" z="38.873230"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gaenge_01" meshFile="gaenge_komplett.003.mesh"/>
+    </node>
+    <node name="saeulen.002">
+      <position x="0.813724" y="3.700742" z="8.508488"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeulen.002" meshFile="saeulen.004.mesh"/>
+    </node>
+    <node name="brunnen">
+      <position x="140.546295" y="74.190155" z="378.740021"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="brunnen" meshFile="brunnen.mesh"/>
+    </node>
+    <node name="boden_felswand.002">
+      <position x="37.711838" y="5.930392" z="27.968113"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="boden_felswand.002" meshFile="boden_fels.002.mesh"/>
+    </node>
+    <node name="gitter_zu.001">
+      <position x="-12.877804" y="2.514648" z="61.443035"/>
+      <rotation qx="-0.000230" qy="-0.815801" qz="-0.000325" qw="0.578332"/>
+      <scale x="0.192361" y="0.192361" z="0.192361"/>
+      <entity name="gitter_zu.001" meshFile="Cube.025.mesh"/>
+    </node>
+    <node name="tempelgang_decke.002">
+      <position x="16.682463" y="4.846837" z="56.490108"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="0.569132" y="0.569132" z="0.569132"/>
+      <entity name="tempelgang_decke.002" meshFile="Cube.002.mesh"/>
+    </node>
+    <node name="tempelgang_decke.001">
+      <position x="-15.229253" y="5.874734" z="24.490736"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="0.569132" y="0.569132" z="0.569132"/>
+      <entity name="tempelgang_decke.001" meshFile="Cube.012.mesh"/>
+    </node>
+    <node name="tempelgang_treppe.001">
+      <position x="-23.316332" y="7.303283" z="16.492294"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tempelgang_treppe.001" meshFile="treppe_gemauert.001.mesh"/>
+    </node>
+    <node name="tempelgang_treppe.002">
+      <position x="-36.382938" y="7.104270" z="27.145168"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="0.556166" y="0.556166" z="0.556166"/>
+      <entity name="tempelgang_treppe.002" meshFile="treppe_gemauert.003.mesh"/>
+    </node>
+    <node name="saeule_07">
+      <position x="1.244043" y="10.207610" z="6.341633"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_07" meshFile="saeule_07.mesh"/>
+    </node>
+    <node name="zugemauert">
+      <position x="82.312714" y="0.000001" z="26.776424"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="zugemauert" meshFile="Cube.001.mesh"/>
+    </node>
+    <node name="tempelgang_waende.001">
+      <position x="-20.391804" y="3.431791" z="29.280613"/>
+      <rotation qx="-0.000282" qy="0.705331" qz="0.000281" qw="0.708878"/>
+      <scale x="0.569131" y="0.569132" z="0.569132"/>
+      <entity name="tempelgang_waende.001" meshFile="Cube.011.mesh"/>
+    </node>
+    <node name="randsteine_04.001">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_04.001" meshFile="randsteine_04.001.mesh"/>
+    </node>
+    <node name="stuetzbalken">
+      <position x="38.693901" y="9.522685" z="30.678297"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="stuetzbalken" meshFile="stuetzbalken.mesh"/>
+    </node>
+    <node name="Plane.001">
+      <position x="-18.778461" y="3.790074" z="24.699961"/>
+      <rotation qx="0.502758" qy="-0.497222" qz="0.496826" qw="0.503159"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="Plane.001" meshFile="Plane.003.mesh"/>
+    </node>
+    <node name="gaenge_01.019">
+      <position x="-11.712984" y="2.751104" z="38.873230"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gaenge_01.019" meshFile="gaenge_komplett.mesh"/>
+    </node>
+    <node name="gaenge_01.018">
+      <position x="-11.712984" y="2.751104" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gaenge_01.018" meshFile="gaenge_komplett.017.mesh"/>
+    </node>
+    <node name="Cube">
+      <position x="-19.678776" y="3.064484" z="25.362461"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="Cube" meshFile="Cube.006.mesh"/>
+    </node>
+    <node name="torboegen.002">
+      <position x="-2.584131" y="2.751112" z="27.977468"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="torboegen.002" meshFile="torboegen.002.mesh"/>
+    </node>
+    <node name="tempelgang_decke">
+      <position x="94.644569" y="4.292408" z="25.715137"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tempelgang_decke" meshFile="Cube.mesh"/>
+    </node>
+    <node name="brocken">
+      <position x="45.444912" y="3.694921" z="29.209862"/>
+      <rotation qx="-0.000396" qy="-0.100537" qz="-0.000040" qw="0.994933"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="brocken" meshFile="brocken.mesh"/>
+    </node>
+    <node name="tempelgang_saeule">
+      <position x="-19.892523" y="5.950263" z="24.172520"/>
+      <rotation qx="-0.000005" qy="0.999910" qz="0.000398" qw="0.013436"/>
+      <scale x="0.569132" y="0.569132" z="0.569132"/>
+      <entity name="tempelgang_saeule" meshFile="saeule_01.001.mesh"/>
+    </node>
+    <node name="fackeln_g2.003">
+      <position x="39.974949" y="5.598745" z="29.590656"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="fackeln_g2.003" meshFile="fackeln.004.mesh"/>
+    </node>
+    <node name="fackeln_eingangshalle">
+      <position x="17.838156" y="1.844218" z="15.676789"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="fackeln_eingangshalle" meshFile="fackeln.001.mesh"/>
+    </node>
+    <node name="schmutzwasser">
+      <position x="-17.998871" y="2.354909" z="26.217978"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="schmutzwasser" meshFile="wasser.mesh"/>
+    </node>
+    <node name="raum_01.007">
+      <position x="-40.115147" y="5.383284" z="26.274029"/>
+      <rotation qx="-0.000335" qy="0.542295" qz="0.000216" qw="0.840188"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="raum_01.007" meshFile="raum_01.005.mesh"/>
+    </node>
+    <node name="raum_01.004">
+      <position x="29.826838" y="2.729950" z="31.432190"/>
+      <rotation qx="-0.000216" qy="-0.839887" qz="-0.000334" qw="0.542761"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="raum_01.004" meshFile="raum_01.004.mesh"/>
+    </node>
+    <node name="raum_01.005">
+      <position x="-11.642996" y="2.232062" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="raum_01.005" meshFile="raum_01.007.mesh"/>
+    </node>
+    <node name="raum_01.006">
+      <position x="29.826838" y="2.729950" z="31.432190"/>
+      <rotation qx="-0.000216" qy="-0.839887" qz="-0.000334" qw="0.542761"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="raum_01.006" meshFile="raum_01.006.mesh"/>
+    </node>
+    <node name="saeule_07.001">
+      <position x="62.324520" y="10.705501" z="44.404518"/>
+      <rotation qx="-0.000281" qy="-0.708033" qz="-0.000282" qw="0.706179"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_07.001" meshFile="saeule_07.001.mesh"/>
+    </node>
+    <node name="rostkette">
+      <position x="11.670300" y="6.950521" z="10.766390"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="rostkette" meshFile="rostkette.mesh"/>
+    </node>
+    <node name="raum_01.001">
+      <position x="-11.642996" y="2.232062" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="raum_01.001" meshFile="raum_01.001.mesh"/>
+    </node>
+    <node name="gitter_zu">
+      <position x="6.479543" y="2.514645" z="1.955386"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="0.208358" y="0.208358" z="0.208358"/>
+      <entity name="gitter_zu" meshFile="Cube.023.mesh"/>
+    </node>
+    <node name="raum_01.003">
+      <position x="29.826838" y="2.729950" z="31.432190"/>
+      <rotation qx="-0.000216" qy="-0.839887" qz="-0.000334" qw="0.542761"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="raum_01.003" meshFile="raum_01.003.mesh"/>
+    </node>
+    <node name="raum_01.002">
+      <position x="-11.642996" y="2.232062" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="raum_01.002" meshFile="raum_01.002.mesh"/>
+    </node>
+    <node name="wurzeln_02.002">
+      <position x="2.693319" y="4.398726" z="13.058824"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="wurzeln_02.002" meshFile="wurzeln_02.mesh"/>
+    </node>
+    <node name="faesser_tunnel_02">
+      <position x="57.166122" y="-0.837035" z="26.112844"/>
+      <rotation qx="0.694067" qy="0.133793" qz="-0.133686" qw="0.694621"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="faesser_tunnel_02" meshFile="Circle.011.mesh"/>
+    </node>
+    <node name="gaenge_01.002">
+      <position x="-14.217243" y="3.248992" z="38.873230"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gaenge_01.002" meshFile="gaenge_komplett.004.mesh"/>
+    </node>
+    <node name="gaenge_01.001">
+      <position x="-14.217243" y="3.248992" z="38.873230"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="gaenge_01.001" meshFile="gaenge_komplett.002.mesh"/>
+    </node>
+    <node name="eingangstuer">
+      <position x="-40.139088" y="6.390891" z="25.772146"/>
+      <rotation qx="-0.000796" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="-0.097711" y="1.000000" z="1.000000"/>
+      <entity name="eingangstuer" meshFile="Cube.005.mesh"/>
+    </node>
+    <node name="tempelgang_waende">
+      <position x="85.573647" y="0.000001" z="34.131252"/>
+      <rotation qx="-0.000282" qy="0.705331" qz="0.000281" qw="0.708878"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tempelgang_waende" meshFile="Cube.003.mesh"/>
+    </node>
+    <node name="saeule_01.001">
+      <position x="52.245560" y="9.379703" z="51.078178"/>
+      <rotation qx="-0.000281" qy="-0.708033" qz="-0.000282" qw="0.706179"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_01.001" meshFile="saeule_01.004.mesh"/>
+    </node>
+    <node name="tuern">
+      <position x="13.036044" y="3.823069" z="16.671421"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tuern" meshFile="tuern.mesh"/>
+    </node>
+    <node name="wurzeln.001">
+      <position x="64.697533" y="3.194272" z="47.052330"/>
+      <rotation qx="-0.000281" qy="-0.708033" qz="-0.000282" qw="0.706179"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="wurzeln.001" meshFile="wurzeln_alle.001.mesh"/>
+    </node>
+    <node name="randsteine_01">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_01" meshFile="randsteine_01.mesh"/>
+    </node>
+    <node name="randsteine_03">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_03" meshFile="randsteine_03.mesh"/>
+    </node>
+    <node name="randsteine_02">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_02" meshFile="randsteine_02.mesh"/>
+    </node>
+    <node name="randsteine_04">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_04" meshFile="randsteine_04.mesh"/>
+    </node>
+    <node name="tempelgang_treppe">
+      <position x="53.427147" y="7.565333" z="30.149771"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tempelgang_treppe" meshFile="treppe_gemauert.mesh"/>
+    </node>
+    <node name="gitter_zu.003">
+      <position x="66.714722" y="2.933403" z="49.673588"/>
+      <rotation qx="-0.000283" qy="-0.704666" qz="-0.000281" qw="0.709539"/>
+      <scale x="0.208358" y="0.208358" z="0.208358"/>
+      <entity name="gitter_zu.003" meshFile="Cube.027.mesh"/>
+    </node>
+    <node name="treppe">
+      <position x="3.132164" y="2.587981" z="6.686421"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="treppe" meshFile="treppe_02.mesh"/>
+    </node>
+    <node name="tempelgang_boden">
+      <position x="37.711838" y="5.930392" z="27.968113"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tempelgang_boden" meshFile="boden_fels.001.mesh"/>
+    </node>
+    <node name="tempelgang_saeulen">
+      <position x="86.450912" y="4.425117" z="25.156010"/>
+      <rotation qx="-0.000005" qy="0.999910" qz="0.000398" qw="0.013434"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tempelgang_saeulen" meshFile="saeule_01.011.mesh"/>
+    </node>
+    <node name="gitter_zu.002">
+      <position x="-5.445406" y="2.514649" z="67.096947"/>
+      <rotation qx="-0.000384" qy="-0.263938" qz="-0.000105" qw="0.964540"/>
+      <scale x="0.178084" y="0.178084" z="0.178084"/>
+      <entity name="gitter_zu.002" meshFile="Cube.026.mesh"/>
+    </node>
+    <node name="tempelgang_randst">
+      <position x="-15.235514" y="5.567721" z="28.191092"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="0.569132" y="0.569132" z="0.569132"/>
+      <entity name="tempelgang_randst" meshFile="Cube.007.mesh"/>
+    </node>
+    <node name="moderholz">
+      <position x="37.592186" y="6.026050" z="32.072422"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="moderholz" meshFile="moderbalken_01.mesh"/>
+    </node>
+    <node name="tempelgang_randsteine">
+      <position x="94.633568" y="3.752965" z="32.216892"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="tempelgang_randsteine" meshFile="Cube.009.mesh"/>
+    </node>
+    <node name="brocken.001">
+      <position x="83.844994" y="3.694921" z="29.906654"/>
+      <rotation qx="-0.000396" qy="-0.100537" qz="-0.000040" qw="0.994933"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="brocken.001" meshFile="brocken.001.mesh"/>
+    </node>
+    <node name="durchbruch_02">
+      <position x="43.158157" y="6.466876" z="27.790565"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="durchbruch_02" meshFile="durchbruch_02.mesh"/>
+    </node>
+    <node name="fackeln">
+      <position x="15.304930" y="2.587982" z="15.800744"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="fackeln" meshFile="fackeln.mesh"/>
+    </node>
+    <node name="Cube.001">
+      <position x="-19.678776" y="3.064484" z="25.362461"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="Cube.001" meshFile="Cube.014.mesh"/>
+    </node>
+    <node name="saeule_06">
+      <position x="4.451921" y="3.546391" z="14.409163"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_06" meshFile="saeule_06.mesh"/>
+    </node>
+    <node name="saeule_05">
+      <position x="7.967321" y="8.881814" z="3.944559"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_05" meshFile="saeule_05.mesh"/>
+    </node>
+    <node name="Cube.002">
+      <position x="-40.626343" y="0.000001" z="26.123762"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="Cube.002" meshFile="Cube.015.mesh"/>
+    </node>
+    <node name="Cube.005">
+      <position x="11.334853" y="2.948639" z="60.276592"/>
+      <rotation qx="-0.000000" qy="1.000000" qz="0.000398" qw="0.000001"/>
+      <scale x="1.000000" y="0.500934" z="1.000000"/>
+      <entity name="Cube.005" meshFile="Cube.019.mesh"/>
+    </node>
+    <node name="Cube.004">
+      <position x="42.812241" y="7.032636" z="33.160561"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="Cube.004" meshFile="durchgang.mesh"/>
+    </node>
+    <node name="saeule_01">
+      <position x="7.944117" y="8.881815" z="16.403053"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_01" meshFile="saeule_01.mesh"/>
+    </node>
+    <node name="Cube.006">
+      <position x="-0.045730" y="3.819188" z="61.176552"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="Cube.006" meshFile="Cube.004.mesh"/>
+    </node>
+    <node name="Cube.008">
+      <position x="0.144417" y="0.000002" z="55.632095"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="Cube.008" meshFile="Cube.016.mesh"/>
+    </node>
+    <node name="farn">
+      <position x="-2.364898" y="-1.932347" z="2.648438"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="farn" meshFile="farn.mesh"/>
+    </node>
+    <node name="raum_01">
+      <position x="-11.642996" y="2.232062" z="38.873230"/>
+      <rotation qx="-0.000389" qy="-0.208817" qz="-0.000083" qw="0.977955"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="raum_01" meshFile="raum_01.mesh"/>
+    </node>
+    <node name="saeule_08">
+      <position x="-1.425607" y="8.881815" z="12.471745"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeule_08" meshFile="saeule_08.mesh"/>
+    </node>
+    <node name="randsteine_03.001">
+      <position x="0.349848" y="1.044165" z="7.637593"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_03.001" meshFile="Cube.008.mesh"/>
+    </node>
+    <node name="randsteine_03.002">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_03.002" meshFile="randsteine_03.001.mesh"/>
+    </node>
+    <node name="randsteine_03.003">
+      <position x="-2.300682" y="0.000000" z="0.000000"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_03.003" meshFile="randsteine_03.002.mesh"/>
+    </node>
+    <node name="randsteine_03.005">
+      <position x="14.497040" y="0.000001" z="19.140228"/>
+      <rotation qx="-0.000398" qy="-0.007229" qz="-0.000003" qw="0.999974"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="randsteine_03.005" meshFile="randsteine_03.004.mesh"/>
+    </node>
+    <node name="saeulen">
+      <position x="60.158802" y="4.198632" z="43.968521"/>
+      <rotation qx="-0.000281" qy="-0.708033" qz="-0.000282" qw="0.706179"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="saeulen" meshFile="saeulen.mesh"/>
+    </node>
+    <node name="wurzeln">
+      <position x="3.885619" y="2.696382" z="3.961683"/>
+      <rotation qx="-0.000398" qy="0.000000" qz="0.000000" qw="1.000000"/>
+      <scale x="1.000000" y="1.000000" z="1.000000"/>
+      <entity name="wurzeln" meshFile="wurzeln_alle.mesh"/>
+    </node>
+  </nodes>
+  <externals>
+    <item type="material">
+      <file name="kanalisation.material"/>
+    </item>
+  </externals>
+  <environment>
+    <colourAmbient r="0.000000" g="0.000000" b="0.000000"/>
+    <colourBackground r="1.000000" g="1.000000" b="1.000000"/>
+  </environment>
+</scene>

Added: modules/kanalisation/maps/kanalisation_scene.xml
===================================================================
--- modules/kanalisation/maps/kanalisation_scene.xml	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/maps/kanalisation_scene.xml	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,265 @@
+<scene formatVersion="0.4.0">
+    <nodes>
+<entity name="bruecke" meshfile="bruecke.mesh">
+<position x="2.892947" y="3.346505" z="7.881136"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="boden_komplett_oben" meshfile="Plane.001.mesh">
+<position x="4.907471" y="-33.65706" z="9.325613"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="wurzeln_03" meshfile="wurzeln_klein.mesh">
+<position x="3.815631" y="3.215424" z="3.961683"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="felsen_hoehle" meshfile="felswaende.mesh">
+<position x="30.294416" y="7.783535" z="26.360363"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="saeule_08.001" meshfile="saeule_08.001.mesh">
+<position x="56.201435" y="9.379703" z="41.7188"/><rotation qw="0.706179" qx="-2.81E-4" qy="-0.708033" qz="-2.82E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="pilze" meshfile="pilze.001.mesh">
+<position x="6.899021" y="-0.0085" z="13.837756"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="matschboden" meshfile="matschboden.mesh">
+<position x="4.907471" y="-33.65706" z="9.325613"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tuern.001" meshfile="tuern.001.mesh">
+<position x="51.963837" y="4.32096" z="56.169384"/><rotation qw="0.706179" qx="-2.81E-4" qy="-0.708033" qz="-2.82E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="boden_komplett_ob" meshfile="Plane.007.mesh">
+<position x="59.330944" y="-33.159164" z="48.06011"/><rotation qw="0.706179" qx="-2.81E-4" qy="-0.708033" qz="-2.82E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="gaenge_01" meshfile="gaenge_komplett.003.mesh">
+<position x="-14.217243" y="3.248992" z="38.87323"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="saeulen.002" meshfile="saeulen.004.mesh">
+<position x="0.813724" y="3.700742" z="8.508488"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="brunnen" meshfile="brunnen.mesh">
+<position x="140.5463" y="74.190155" z="378.74002"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="boden_felswand.002" meshfile="boden_fels.002.mesh">
+<position x="37.711838" y="5.930392" z="27.968113"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="gitter_zu.001" meshfile="Cube.025.mesh">
+<position x="-12.877804" y="2.514648" z="61.443035"/><rotation qw="0.578332" qx="-2.3E-4" qy="-0.815801" qz="-3.25E-4"/><scale x="0.192361" y="0.192361" z="0.192361"/>
+</entity>
+<entity name="tempelgang_decke.002" meshfile="Cube.002.mesh">
+<position x="16.682463" y="4.846837" z="56.49011"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="0.569132" y="0.569132" z="0.569132"/>
+</entity>
+<entity name="tempelgang_decke.001" meshfile="Cube.012.mesh">
+<position x="-15.229253" y="5.874734" z="24.490736"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="0.569132" y="0.569132" z="0.569132"/>
+</entity>
+<entity name="tempelgang_treppe.001" meshfile="treppe_gemauert.001.mesh">
+<position x="-23.316332" y="7.303283" z="16.492294"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tempelgang_treppe.002" meshfile="treppe_gemauert.003.mesh">
+<position x="-36.38294" y="7.10427" z="27.145168"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="0.556166" y="0.556166" z="0.556166"/>
+</entity>
+<entity name="saeule_07" meshfile="saeule_07.mesh">
+<position x="1.244043" y="10.20761" z="6.341633"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="zugemauert" meshfile="Cube.001.mesh">
+<position x="82.31271" y="0.0" z="26.776424"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tempelgang_waende.001" meshfile="Cube.011.mesh">
+<position x="-20.391804" y="3.431791" z="29.280613"/><rotation qw="0.708878" qx="-2.82E-4" qy="0.705331" qz="2.81E-4"/><scale x="0.569131" y="0.569132" z="0.569132"/>
+</entity>
+<entity name="randsteine_04.001" meshfile="randsteine_04.001.mesh">
+<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="stuetzbalken" meshfile="stuetzbalken.mesh">
+<position x="38.6939" y="9.522685" z="30.678297"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="Plane.001" meshfile="Plane.003.mesh">
+<position x="-18.778461" y="3.790074" z="24.69996"/><rotation qw="0.503159" qx="0.502758" qy="-0.497222" qz="0.496826"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="gaenge_01.019" meshfile="gaenge_komplett.mesh">
+<position x="-11.712984" y="2.751104" z="38.87323"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="gaenge_01.018" meshfile="gaenge_komplett.017.mesh">
+<position x="-11.712984" y="2.751104" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="Cube" meshfile="Cube.006.mesh">
+<position x="-19.678776" y="3.064484" z="25.362461"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="torboegen.002" meshfile="torboegen.002.mesh">
+<position x="-2.584131" y="2.751112" z="27.977468"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tempelgang_decke" meshfile="Cube.mesh">
+<position x="94.64457" y="4.292408" z="25.715137"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="brocken" meshfile="brocken.mesh">
+<position x="45.444912" y="3.694921" z="29.209862"/><rotation qw="0.994933" qx="-3.96E-4" qy="-0.100537" qz="-4.0E-5"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tempelgang_saeule" meshfile="saeule_01.001.mesh">
+<position x="-19.892523" y="5.950263" z="24.17252"/><rotation qw="0.013436" qx="0.0" qy="0.99991" qz="3.98E-4"/><scale x="0.569132" y="0.569132" z="0.569132"/>
+</entity>
+<entity name="fackeln_g2.003" meshfile="fackeln.004.mesh">
+<position x="39.97495" y="5.598745" z="29.590656"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="fackeln_eingangshalle" meshfile="fackeln.001.mesh">
+<position x="17.838156" y="1.844218" z="15.676789"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="schmutzwasser" meshfile="wasser.mesh">
+<position x="-17.99887" y="2.354909" z="26.217978"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="raum_01.007" meshfile="raum_01.005.mesh">
+<position x="-40.115147" y="5.383284" z="26.274029"/><rotation qw="0.840188" qx="-3.35E-4" qy="0.542295" qz="2.16E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="raum_01.004" meshfile="raum_01.004.mesh">
+<position x="29.826838" y="2.72995" z="31.43219"/><rotation qw="0.542761" qx="-2.16E-4" qy="-0.839887" qz="-3.34E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="raum_01.005" meshfile="raum_01.007.mesh">
+<position x="-11.642996" y="2.232062" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="raum_01.006" meshfile="raum_01.006.mesh">
+<position x="29.826838" y="2.72995" z="31.43219"/><rotation qw="0.542761" qx="-2.16E-4" qy="-0.839887" qz="-3.34E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="saeule_07.001" meshfile="saeule_07.001.mesh">
+<position x="62.32452" y="10.705501" z="44.40452"/><rotation qw="0.706179" qx="-2.81E-4" qy="-0.708033" qz="-2.82E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="rostkette" meshfile="rostkette.mesh">
+<position x="11.6703" y="6.950521" z="10.76639"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="raum_01.001" meshfile="raum_01.001.mesh">
+<position x="-11.642996" y="2.232062" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="gitter_zu" meshfile="Cube.023.mesh">
+<position x="6.479543" y="2.514645" z="1.955386"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="0.208358" y="0.208358" z="0.208358"/>
+</entity>
+<entity name="raum_01.003" meshfile="raum_01.003.mesh">
+<position x="29.826838" y="2.72995" z="31.43219"/><rotation qw="0.542761" qx="-2.16E-4" qy="-0.839887" qz="-3.34E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="raum_01.002" meshfile="raum_01.002.mesh">
+<position x="-11.642996" y="2.232062" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="wurzeln_02.002" meshfile="wurzeln_02.mesh">
+<position x="2.693319" y="4.398726" z="13.058824"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="faesser_tunnel_02" meshfile="Circle.011.mesh">
+<position x="57.166122" y="-0.837035" z="26.112844"/><rotation qw="0.694621" qx="0.694067" qy="0.133793" qz="-0.133686"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="gaenge_01.002" meshfile="gaenge_komplett.004.mesh">
+<position x="-14.217243" y="3.248992" z="38.87323"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="gaenge_01.001" meshfile="gaenge_komplett.002.mesh">
+<position x="-14.217243" y="3.248992" z="38.87323"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="eingangstuer" meshfile="Cube.005.mesh">
+<position x="-40.139088" y="6.390891" z="25.772146"/><rotation qw="1.0" qx="-7.96E-4" qy="0.0" qz="0.0"/><scale x="-0.097711" y="1.0" z="1.0"/>
+</entity>
+<entity name="tempelgang_waende" meshfile="Cube.003.mesh">
+<position x="85.57365" y="0.0" z="34.131252"/><rotation qw="0.708878" qx="-2.82E-4" qy="0.705331" qz="2.81E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="saeule_01.001" meshfile="saeule_01.004.mesh">
+<position x="52.24556" y="9.379703" z="51.07818"/><rotation qw="0.706179" qx="-2.81E-4" qy="-0.708033" qz="-2.82E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tuern" meshfile="tuern.mesh">
+<position x="13.036044" y="3.823069" z="16.671421"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="wurzeln.001" meshfile="wurzeln_alle.001.mesh">
+<position x="64.69753" y="3.194272" z="47.05233"/><rotation qw="0.706179" qx="-2.81E-4" qy="-0.708033" qz="-2.82E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="randsteine_01" meshfile="randsteine_01.mesh">
+<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="randsteine_03" meshfile="randsteine_03.mesh">
+<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="randsteine_02" meshfile="randsteine_02.mesh">
+<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="randsteine_04" meshfile="randsteine_04.mesh">
+<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tempelgang_treppe" meshfile="treppe_gemauert.mesh">
+<position x="53.427147" y="7.565333" z="30.14977"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="gitter_zu.003" meshfile="Cube.027.mesh">
+<position x="66.71472" y="2.933403" z="49.673588"/><rotation qw="0.709539" qx="-2.83E-4" qy="-0.704666" qz="-2.81E-4"/><scale x="0.208358" y="0.208358" z="0.208358"/>
+</entity>
+<entity name="treppe" meshfile="treppe_02.mesh">
+<position x="3.132164" y="2.587981" z="6.686421"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tempelgang_boden" meshfile="boden_fels.001.mesh">
+<position x="37.711838" y="5.930392" z="27.968113"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tempelgang_saeulen" meshfile="saeule_01.011.mesh">
+<position x="86.45091" y="4.425117" z="25.15601"/><rotation qw="0.013434" qx="0.0" qy="0.99991" qz="3.98E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="gitter_zu.002" meshfile="Cube.026.mesh">
+<position x="-5.445406" y="2.514649" z="67.09695"/><rotation qw="0.96454" qx="-3.84E-4" qy="-0.263938" qz="-1.05E-4"/><scale x="0.178084" y="0.178084" z="0.178084"/>
+</entity>
+<entity name="tempelgang_randst" meshfile="Cube.007.mesh">
+<position x="-15.235514" y="5.567721" z="28.191092"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="0.569132" y="0.569132" z="0.569132"/>
+</entity>
+<entity name="moderholz" meshfile="moderbalken_01.mesh">
+<position x="37.592186" y="6.02605" z="32.072422"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="tempelgang_randsteine" meshfile="Cube.009.mesh">
+<position x="94.63357" y="3.752965" z="32.216892"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="brocken.001" meshfile="brocken.001.mesh">
+<position x="83.84499" y="3.694921" z="29.906654"/><rotation qw="0.994933" qx="-3.96E-4" qy="-0.100537" qz="-4.0E-5"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="durchbruch_02" meshfile="durchbruch_02.mesh">
+<position x="43.158157" y="6.466876" z="27.790565"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="fackeln" meshfile="fackeln.mesh">
+<position x="15.30493" y="2.587982" z="15.800744"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="Cube.001" meshfile="Cube.014.mesh">
+<position x="-19.678776" y="3.064484" z="25.362461"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="saeule_06" meshfile="saeule_06.mesh">
+<position x="4.451921" y="3.546391" z="14.409163"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="saeule_05" meshfile="saeule_05.mesh">
+<position x="7.967321" y="8.881814" z="3.944559"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="Cube.002" meshfile="Cube.015.mesh">
+<position x="-40.626343" y="0.0" z="26.123762"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="Cube.005" meshfile="Cube.019.mesh">
+<position x="11.334853" y="2.948639" z="60.276592"/><rotation qw="0.0" qx="0.0" qy="1.0" qz="3.98E-4"/><scale x="1.0" y="0.500934" z="1.0"/>
+</entity>
+<entity name="Cube.004" meshfile="durchgang.mesh">
+<position x="42.81224" y="7.032636" z="33.16056"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="saeule_01" meshfile="saeule_01.mesh">
+<position x="7.944117" y="8.881815" z="16.403053"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="Cube.006" meshfile="Cube.004.mesh">
+<position x="-0.04573" y="3.819188" z="61.17655"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="Cube.008" meshfile="Cube.016.mesh">
+<position x="0.144417" y="0.0" z="55.632095"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="farn" meshfile="farn.mesh">
+<position x="-2.364898" y="-1.932347" z="2.648438"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="raum_01" meshfile="raum_01.mesh">
+<position x="-11.642996" y="2.232062" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="saeule_08" meshfile="saeule_08.mesh">
+<position x="-1.425607" y="8.881815" z="12.471745"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="randsteine_03.001" meshfile="Cube.008.mesh">
+<position x="0.349848" y="1.044165" z="7.637593"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="randsteine_03.002" meshfile="randsteine_03.001.mesh">
+<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="randsteine_03.003" meshfile="randsteine_03.002.mesh">
+<position x="-2.300682" y="0.0" z="0.0"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="randsteine_03.005" meshfile="randsteine_03.004.mesh">
+<position x="14.49704" y="0.0" z="19.140228"/><rotation qw="0.999974" qx="-3.98E-4" qy="-0.007229" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="saeulen" meshfile="saeulen.mesh">
+<position x="60.158802" y="4.198632" z="43.96852"/><rotation qw="0.706179" qx="-2.81E-4" qy="-0.708033" qz="-2.82E-4"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+<entity name="wurzeln" meshfile="wurzeln_alle.mesh">
+<position x="3.885619" y="2.696382" z="3.961683"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
+</entity>
+    </nodes>
+</scene>
\ No newline at end of file

Added: modules/kanalisation/maps/kisten_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/kisten_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/matschboden.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/matschboden.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/moderbalken_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/moderbalken_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/pilze.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/pilze.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_03.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_03.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_03.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_03.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_03.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_03.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_03.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_03.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_04.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_04.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/randsteine_04.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/randsteine_04.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/raum_01.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/raum_01.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/raum_01.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/raum_01.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/raum_01.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/raum_01.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/raum_01.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/raum_01.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/raum_01.005.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/raum_01.005.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/raum_01.006.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/raum_01.006.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/raum_01.007.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/raum_01.007.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/raum_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/raum_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/rostkette.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/rostkette.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_01.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_01.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_01.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_01.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_01.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_01.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_01.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_01.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_01.011.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_01.011.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_05.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_05.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_06.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_06.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_07.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_07.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_07.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_07.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_07.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_07.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_08.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_08.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_08.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_08.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeule_09.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeule_09.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeulen.004.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeulen.004.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/saeulen.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/saeulen.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/smuggler.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/smuggler.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/stuetzbalken.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/stuetzbalken.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/stuetzpfeiler_quer.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/stuetzpfeiler_quer.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/stuetzwand.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/stuetzwand.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/torboegen.002.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/torboegen.002.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/treppe_01.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/treppe_01.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/treppe_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/treppe_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/treppe_gemauert.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/treppe_gemauert.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/treppe_gemauert.003.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/treppe_gemauert.003.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/treppe_gemauert.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/treppe_gemauert.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/tuern.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/tuern.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/tuern.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/tuern.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wand_03.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wand_03.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wand_04.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wand_04.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wasser.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wasser.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wurzeln_02.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wurzeln_02.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wurzeln_alle.001.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wurzeln_alle.001.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wurzeln_alle.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wurzeln_alle.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/maps/wurzeln_klein.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/maps/wurzeln_klein.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/Normalmapping.program
===================================================================
--- modules/kanalisation/materials/Normalmapping.program	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/materials/Normalmapping.program	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,114 @@
+material Basic_Normalmapping_kana 
+{
+	
+    technique hlsl
+    {
+	    lod_index 0
+        pass
+        {
+            vertex_program_ref Basic_Normalmapping_UV0_VS_HLSL
+            {
+                param_named_auto matViewProjection worldviewproj_matrix
+                param_named_auto LightPosition_0 light_position_object_space 0
+                param_named_auto LightPosition_1 light_position_object_space 1
+                param_named_auto LightPosition_2 light_position_object_space 2
+                
+                param_named_auto LightAttn_0 light_attenuation 0
+                param_named_auto LightAttn_1 light_attenuation 1
+                param_named_auto LightAttn_2 light_attenuation 2
+                
+                param_named_auto vViewPosition	 camera_position_object_space
+            }
+
+            fragment_program_ref Basic_Normalmapping_PS_HLSL
+            {
+                param_named_auto LightColor_0  light_diffuse_colour  0
+                param_named_auto LightColor_1  light_diffuse_colour  1
+                param_named_auto LightColor_2  light_diffuse_colour  2
+                
+                param_named groundcolor float4 0.01 0.01 0.01 1.0
+                param_named skycolor float4 0.1 0.1 0.1 1.0
+                param_named SpecColor float4 0.2 0.2 0.2 1.0
+                param_named SpecExp float 16.0
+            }
+			
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+
+            // Normal map
+            texture_unit NormalMap
+            {
+                texture_alias NormalMap
+            }
+        }
+    }
+    
+    technique hlsl1
+	{
+		lod_index 1
+		//Rendering Pass: Pass 0 (pass index: #0 )
+		pass
+		{
+			alpha_rejection greater 128
+			//DirectX 9.0 HLSL Pixel Shader ps_2_0
+			fragment_program_ref Basic_Pixel_Shader
+			{
+			}
+			//DirectX 9.0 HLSL Vertex Shader vs_2_0
+			vertex_program_ref Basic_Vertex_Shader
+			{
+				// param_named_auto
+
+				param_named_auto Light1_attenuation light_attenuation 0
+				param_named_auto Light1_color light_diffuse_colour 0
+				param_named_auto Light1_position light_position_object_space 0
+				param_named Light1_spec_power float 0.3
+				
+				param_named_auto Light2_attenuation light_attenuation 1
+				param_named_auto Light2_color light_diffuse_colour 1
+				param_named_auto Light2_position light_position_object_space 1
+				param_named Light2_spec_power float 0.3
+				
+				param_named_auto Light3_attenuation light_attenuation 2
+				param_named_auto Light3_color light_diffuse_colour 2
+				param_named_auto Light3_position light_position_object_space 2
+				param_named Light3_spec_power float 0.3
+				
+				
+				param_named_auto matViewProjection worldviewproj_matrix
+				param_named_auto vViewPosition camera_position_object_space
+				
+				
+				param_named skycolor float4 0.1 0.1 0.1 1.0
+				param_named groundcolor float4 0.010 0.010 0.010 1.0
+			}
+			
+			texture_unit
+			{
+				texture_alias DiffuseMap
+
+			}
+		}
+	}
+    
+
+    technique fixed_function
+    {
+	    lod_index 2
+        pass
+        {
+            ambient 0.1 0.1 0.1 1.0
+            diffuse 0.7 0.7 0.7 1.0
+            specular 0.3 0.3 0.3 1.0 16.0
+
+            // Base diffuse texture map
+            texture_unit DiffuseMap
+            {
+                texture_alias DiffuseMap
+            }
+        } 
+    }
+}
\ No newline at end of file

Added: modules/kanalisation/materials/vlight.material
===================================================================
--- modules/kanalisation/materials/vlight.material	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/materials/vlight.material	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,17 @@
+material vlight
+{
+	technique
+	{
+		pass
+		{
+			lighting off
+			depth_write off
+			scene_blend add
+
+			texture_unit
+			{
+				texture vlight01.png
+			}
+		}
+	}
+}
\ No newline at end of file

Added: modules/kanalisation/materials/vlight.particle
===================================================================
--- modules/kanalisation/materials/vlight.particle	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/materials/vlight.particle	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,67 @@
+vlight
+{
+	quota	10
+	material	vlight
+	particle_width	1.4
+	particle_height	2.5
+	cull_each	false
+	renderer	billboard
+	sorted	false
+	local_space	false
+	iteration_interval	0
+	nonvisible_update_timeout	0
+	billboard_type	oriented_common
+	billboard_origin	center
+	billboard_rotation_type	texcoord
+	common_direction	-0.4 1 0
+	common_up_vector	0 1 0
+	point_rendering	false
+	accurate_facing	false
+
+	emitter Ellipsoid
+	{
+		angle	0
+		colour	1 1 1 1
+		colour_range_start	1 1 1 1
+		colour_range_end	0.901961 0.870588 0.717647 1
+		direction	0.43003 -0.902815 0
+		emission_rate	2
+		position	0 0 0
+		velocity	0
+		velocity_min	0
+		velocity_max	0.2
+		time_to_live	5
+		time_to_live_min	5
+		time_to_live_max	5
+		duration	0
+		duration_min	0
+		duration_max	0
+		repeat_delay	0
+		repeat_delay_min	0
+		repeat_delay_max	0
+		width	0.8
+		height	0.8
+		depth	1
+	}
+
+	affector Scaler
+	{
+		rate	0.4
+	}
+
+	affector ColourInterpolator
+	{
+		colour0	0.929412 0.894118 0.819608 1
+		time0	0
+		colour1	0.992157 0.94902 0.776471 1
+		time1	0.2
+		colour2	0.968627 0.960784 0.909804 1
+		time2	0.4
+		colour3	0.929412 0.921569 0.803922 1
+		time3	0.6
+		colour4	0.972549 0.937255 0.862745 1
+		time4	0.8
+		colour5	0.94902 0.901961 0.866667 1
+		time5	1
+	}
+}

Added: modules/kanalisation/materials/waber.material
===================================================================
--- modules/kanalisation/materials/waber.material	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/materials/waber.material	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,17 @@
+material waber
+{
+	technique
+	{
+		pass
+		{
+			lighting off
+			depth_write off
+			scene_blend add
+
+			texture_unit
+			{
+				texture nebel.png
+			}
+		}
+	}
+}
\ No newline at end of file

Added: modules/kanalisation/materials/waber.particle
===================================================================
--- modules/kanalisation/materials/waber.particle	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/materials/waber.particle	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,66 @@
+waber
+{
+	quota	200
+	material	waber
+	particle_width	2
+	particle_height	2
+	cull_each	true
+	renderer	billboard
+	sorted	false
+	local_space	false
+	iteration_interval	0
+	nonvisible_update_timeout	0
+	billboard_type	point
+	billboard_origin	center
+	billboard_rotation_type	texcoord
+	common_up_vector	0 1 0
+	point_rendering	false
+	accurate_facing	false
+
+	emitter Ellipsoid
+	{
+		angle	180
+		colour	0 0 0 1
+		colour_range_start	0 0 0 1
+		colour_range_end	0 0 0 1
+		direction	1 0 0
+		emission_rate	32
+		position	0 0 0
+		velocity	0.2
+		velocity_min	0.2
+		velocity_max	0.3
+		time_to_live	6
+		time_to_live_min	6
+		time_to_live_max	6
+		duration	0
+		duration_min	0
+		duration_max	0
+		repeat_delay	0
+		repeat_delay_min	0
+		repeat_delay_max	0
+		width	1.2
+		height	10
+		depth	10
+	}
+
+	affector ColourInterpolator
+	{
+		colour0	0 0 0 1
+		time0	0
+		colour1	0.0196078 0.0196078 0.0196078 1
+		time1	0.2
+		colour2	0.0392157 0.0392157 0.0392157 1
+		time2	0.4
+		colour3	0.0823529 0.0823529 0.0823529 1
+		time3	0.6
+		colour4	0.0392157 0.0392157 0.0392157 1
+		time4	0.8
+		colour5	0 0 0 1
+		time5	1
+	}
+
+	affector Scaler
+	{
+		rate	0.1
+	}
+}

Added: modules/kanalisation/models/axe_weap.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/models/axe_weap.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/models/breitschwert.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/models/breitschwert.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/models/breitschwert_stehend.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/models/breitschwert_stehend.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/models/fass_liegend.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/models/fass_liegend.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/models/fass_stapel.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/models/fass_stapel.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/models/fass_stehend.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/models/fass_stehend.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/models/rostkette.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/models/rostkette.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/models/schild.mesh
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/models/schild.mesh
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/scripts/equip.rb
===================================================================
--- modules/kanalisation/scripts/equip.rb	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/scripts/equip.rb	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,17 @@
+require 'npc.rb'
+require 'torch.rb'
+require 'clothing.rb'
+
+hero = $UI.getActiveCharacter();
+
+itemToAdd = $GOM.createGameObject("men_human_female_legs_pants_01_long");
+hero.getInventory().hold(itemToAdd, "Trousers");
+
+itemToAdd = $GOM.createGameObject("men_human_female_feet_boots_01");
+hero.getInventory().hold(itemToAdd, "Boots");
+
+itemToAdd = $GOM.createGameObject("men_human_female_cloth_short");
+hero.getInventory().hold(itemToAdd, "Clothes");
+
+#itemToAdd = $GOM.createGameObject("torch");
+#hero.getInventory().hold(itemToAdd, "Right Hand");

Added: modules/kanalisation/scripts/moduleconfig.rb
===================================================================
--- modules/kanalisation/scripts/moduleconfig.rb	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/scripts/moduleconfig.rb	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,37 @@
+include RlScript
+
+class KanalisationModule < ContentModule
+    def initialize()
+        super("kanalisation", "Kanalisation", false, 200608012)
+    end
+
+    def getDependencies()
+        return ["common"];
+    end
+
+    def getTextureLocations()
+	return ["textures"];
+    end
+
+    def getModelLocations()
+	return ["Model"]
+    end
+
+    def getSoundLocations()
+	return ["Sound"]
+    end
+
+    def start()
+		require 'player.rb'
+		require 'mckhero.rb'
+		require 'torch.rb'
+        #$CORE.loadMap("Octree", "kanalisation.scene", "kanalisation");
+		loader = MapLoader.new("kanalisation");
+		loader.loadMap("kana_lights.rlmap.xml");
+		loader.loadMap("kanalisation_scene.xml");
+        load "kanalisation.rb"
+        $World = $CORE.getWorld();
+    end
+end
+
+CoreSubsystem.getSingleton().registerModule(KanalisationModule.new());

Added: modules/kanalisation/scripts/particle.rb
===================================================================
--- modules/kanalisation/scripts/particle.rb	2008-07-02 21:29:33 UTC (rev 4428)
+++ modules/kanalisation/scripts/particle.rb	2008-07-02 21:39:21 UTC (rev 4429)
@@ -0,0 +1,35 @@
+tavernfire1 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
+tavernfire1.placeIntoScene( -1.39,6.06,12.84, 0.5, 0.0, 0.0, 0.0 );
+
+tavernfire2 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
+tavernfire2.placeIntoScene( 11.39,6.06,9.75, 1.0, 0.0, 0.0, 0.0 );
+
+tavernfire3 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
+tavernfire3.placeIntoScene( -22.48,4.60,23.10, 1.0, 0.0, 0.0, 0.0 );
+
+tavernfire4 = $AM.createParticleSystemActor("tavernfire1", "vlight" );
+tavernfire4.placeIntoScene( -21.85,7.10,25.13, 1.0, 0.0, 0.0, 0.0 );
+
+tavernfire5 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
+tavernfire5.placeIntoScene( 36.49,7.37,30.27, 1.0, 0.0, 0.0, 0.0 );
+
+tavernfire6 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
+tavernfire6.placeIntoScene( -28.65,4.77,23.94, 1.0, 0.0, 0.0, 0.0 );
+
+tavernfire6 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
+tavernfire6.placeIntoScene( -28.65,4.77,28.39, 1.0, 0.0, 0.0, 0.0 );
+
+#waber01 = $AM.createParticleSystemActor("waber01", "waber" );
+#waber01.placeIntoScene( 8.73,3.73,10.36, 1.0, 0.0, 0.0, 0.0 );
+
+#glow1 = $AM.createParticleSystemActor("glow1", "glow01" );
+#glow1.placeIntoScene( 8.49,2.83,10.39, 1.0, 0.0, 0.0, 0.0 );
+
+#firelight = $AM.createLightActor("firelight", LightObject::LT_POINT);
+#firelight.placeIntoScene( 94.28, 5.65, -30.88, 1.0, 0.0, 0.0, 0.0 );
+#firelight.getControlledObject().setCastShadows(true);
+#firelight.getControlledObject().setAttenuation(4,1,1,1);
+
+#halter= $hero.getActor();
+#halter.attachToSlotAxisRot( rain, "l_oberarm", "SLOT_HANDLE", [0.0, 0.0, 0.0], [ 0.0, 0.0, 0.0 ], 0.0 );
+#halter.attachToSlotAxisRot( firelight, "l_oberarm", "SLOT_HANDLE", [0.0, 0.0, 0.0], [ 0.0, 0.0, 0.0 ], 0.0 );

Added: modules/kanalisation/sound/kanal.ogg
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/sound/kanal.ogg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From timm at mail.berlios.de  Thu Jul  3 09:16:55 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Thu, 3 Jul 2008 09:16:55 +0200
Subject: [Dsa-hl-svn] r4430 - in rl/trunk/engine: core/src rules/src
	script/src
Message-ID: <200807030716.m637Gtao010501@sheep.berlios.de>

Author: timm
Date: 2008-07-03 09:16:51 +0200 (Thu, 03 Jul 2008)
New Revision: 4430

Modified:
   rl/trunk/engine/core/src/ZoneManager.cpp
   rl/trunk/engine/rules/src/GameObject.cpp
   rl/trunk/engine/script/src/Scene.cpp
Log:
- fixed a crash when returning to scene
- started with caching the state of scenes

Modified: rl/trunk/engine/core/src/ZoneManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ZoneManager.cpp	2008-07-02 21:39:21 UTC (rev 4429)
+++ rl/trunk/engine/core/src/ZoneManager.cpp	2008-07-03 07:16:51 UTC (rev 4430)
@@ -136,9 +136,12 @@
     {
         for(ZoneMap::iterator it = mZones.begin(); it != mZones.end(); )
         {
+            if( isZoneActive(it->second) )
+                mActiveZones.remove(it->second);
             destroyZone((it++)->first);
         }
         mZones.clear();
+        mZonesIdMap.clear();
 
         std::list<Zone*>::iterator it = mZonesToDelete.begin();
         for( ; it != mZonesToDelete.end(); it++)

Modified: rl/trunk/engine/rules/src/GameObject.cpp
===================================================================
--- rl/trunk/engine/rules/src/GameObject.cpp	2008-07-02 21:39:21 UTC (rev 4429)
+++ rl/trunk/engine/rules/src/GameObject.cpp	2008-07-03 07:16:51 UTC (rev 4430)
@@ -42,6 +42,7 @@
     const Ogre::String GameObject::CLASS_NAME = "GameObject";
 
     const Ogre::String GameObject::PROPERTY_CLASS_ID = "classid";
+    const Ogre::String GameObject::PROPERTY_OBJECT_ID = "id";
     const Ogre::String GameObject::PROPERTY_BASE_CLASS = "baseclass";
     const Ogre::String GameObject::PROPERTY_POSITION = "position";
     const Ogre::String GameObject::PROPERTY_SCENE = "scene";

Modified: rl/trunk/engine/script/src/Scene.cpp
===================================================================
--- rl/trunk/engine/script/src/Scene.cpp	2008-07-02 21:39:21 UTC (rev 4429)
+++ rl/trunk/engine/script/src/Scene.cpp	2008-07-03 07:16:51 UTC (rev 4430)
@@ -70,7 +70,12 @@
             GameObject* cur = *it;
             if (cur->getState() == GOS_LOADED || cur->getState() == GOS_IN_SCENE)
             {
-                goProps.push_back(cur->getAllProperties()->toPropertyMap());
+                //Todo....
+                PropertyMap map;
+                map[GameObject::PROPERTY_CLASS_ID] = cur->getClassId();
+                map[GameObject::PROPERTY_OBJECT_ID] = cur->getId();
+                goProps.push_back(map);
+                //goProps.push_back(cur->getAllProperties()->toPropertyMap());
             }
         }
 
@@ -96,8 +101,8 @@
             {
                 PropertyRecord cur(it->toMap());
                 GameObject* go = GameObjectManager::getSingleton().createGameObject(
-                    cur.getProperty(GameObject::PROPERTY_BASE_CLASS).toString(),
-                    cur.getProperty(GameObject::PROPERTY_CLASS_ID).toInt());
+                    cur.getProperty(GameObject::PROPERTY_CLASS_ID).toString(),
+                    cur.getProperty(GameObject::PROPERTY_OBJECT_ID).toInt());
             }
         }
         else



From alassion at mail.berlios.de  Fri Jul  4 13:22:55 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Fri, 4 Jul 2008 13:22:55 +0200
Subject: [Dsa-hl-svn] r4431 - in modules/kanalisation: maps materials scripts
Message-ID: <200807041122.m64BMtKG000419@sheep.berlios.de>

Author: alassion
Date: 2008-07-04 13:22:11 +0200 (Fri, 04 Jul 2008)
New Revision: 4431

Added:
   modules/kanalisation/materials/Wassershader_Kanalisation.program
Modified:
   modules/kanalisation/maps/kana_lights.rlmap.xml
   modules/kanalisation/maps/kanalisation.material
   modules/kanalisation/maps/kanalisation_scene.xml
   modules/kanalisation/scripts/equip.rb
   modules/kanalisation/scripts/particle.rb
Log:
- added watershader, fixed a few errors -

Modified: modules/kanalisation/maps/kana_lights.rlmap.xml
===================================================================
--- modules/kanalisation/maps/kana_lights.rlmap.xml	2008-07-03 07:16:51 UTC (rev 4430)
+++ modules/kanalisation/maps/kana_lights.rlmap.xml	2008-07-04 11:22:11 UTC (rev 4431)
@@ -3,25 +3,19 @@
 	<nodes>
 		<light name="fackkellicht" type="point" visible="true"
 			castShadows="false">
-			<position x="-1.39" y="6.06" z="12.84" />
+			<position x="-1.39" y="5.54" z="12.84" />
 			<colourDiffuse r="0.8" g="0.7" b="0.5" />
 			<colourSpecular r="0.8" g="0.7" b="0.5" />
 			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
 		</light>
 		<light name="fackkellicht2" type="point" visible="true"
 			castShadows="false">
-			<position x="11.39" y="6.06" z="9.75" />
+			<position x="11.39" y="5.54" z="9.75" />
 			<colourDiffuse r="0.8" g="0.7" b="0.5" />
 			<colourSpecular r="0.8" g="0.7" b="0.5" />
 			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
 		</light>
-		<light name="fackkellicht3" type="point" visible="true"
-			castShadows="false">
-			<position x="-22.48" y="4.60" z="23.10" />
-			<colourDiffuse r="0.8" g="0.7" b="0.5" />
-			<colourSpecular r="0.8" g="0.7" b="0.5" />
-			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />
-		</light>
+
 		<light name="fackkellicht4" type="point" visible="true"
 			castShadows="false">
 			<position x="36.49" y="7.37" z="30.27" />

Modified: modules/kanalisation/maps/kanalisation.material
===================================================================
--- modules/kanalisation/maps/kanalisation.material	2008-07-03 07:16:51 UTC (rev 4430)
+++ modules/kanalisation/maps/kanalisation.material	2008-07-04 11:22:11 UTC (rev 4431)
@@ -234,7 +234,7 @@
 set_texture_alias DiffuseMap boden_kana.png
 set_texture_alias NormalMap boden_kana_normal.png
 }
-material wasser/SOLID/TEX/Untitled : Wassershader
+material wasser/SOLID/TEX/Untitled : Wassershader_Kanalisation
 {
 set_texture_alias Cubemap desert07.dds
 }
@@ -252,4 +252,4 @@
 {
 set_texture_alias DiffuseMap wand_kana.png
 set_texture_alias NormalMap wand_kana_normal.png
-}
+}
\ No newline at end of file

Modified: modules/kanalisation/maps/kanalisation_scene.xml
===================================================================
--- modules/kanalisation/maps/kanalisation_scene.xml	2008-07-03 07:16:51 UTC (rev 4430)
+++ modules/kanalisation/maps/kanalisation_scene.xml	2008-07-04 11:22:11 UTC (rev 4431)
@@ -100,6 +100,7 @@
 <position x="17.838156" y="1.844218" z="15.676789"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
 </entity>
 <entity name="schmutzwasser" meshfile="wasser.mesh">
+<physicsproxy type="none" />
 <position x="-17.99887" y="2.354909" z="26.217978"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
 </entity>
 <entity name="raum_01.007" meshfile="raum_01.005.mesh">
@@ -235,6 +236,7 @@
 <position x="0.144417" y="0.0" z="55.632095"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
 </entity>
 <entity name="farn" meshfile="farn.mesh">
+<physicsproxy type="none" />
 <position x="-2.364898" y="-1.932347" z="2.648438"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
 </entity>
 <entity name="raum_01" meshfile="raum_01.mesh">

Added: modules/kanalisation/materials/Wassershader_Kanalisation.program
===================================================================
--- modules/kanalisation/materials/Wassershader_Kanalisation.program	2008-07-03 07:16:51 UTC (rev 4430)
+++ modules/kanalisation/materials/Wassershader_Kanalisation.program	2008-07-04 11:22:11 UTC (rev 4431)
@@ -0,0 +1,22 @@
+material Wassershader_Kanalisation : Wassershader
+{	
+    technique hlsl
+    {
+        pass
+        {
+            fragment_program_ref Wassershader_Kanalisation_PS_HLSL
+            {
+                param_named reflectionexp float 3.0
+                param_named waterreflectcolor float4 0.45 0.42 0.42 0.6
+            }
+ 
+        }
+    }
+ 
+    technique fixed_function
+    {
+        pass
+        {
+            specular 0.15 0.15 0.15 1.0 12.0
+        } 
+    }
\ No newline at end of file

Modified: modules/kanalisation/scripts/equip.rb
===================================================================
--- modules/kanalisation/scripts/equip.rb	2008-07-03 07:16:51 UTC (rev 4430)
+++ modules/kanalisation/scripts/equip.rb	2008-07-04 11:22:11 UTC (rev 4431)
@@ -13,5 +13,5 @@
 itemToAdd = $GOM.createGameObject("men_human_female_cloth_short");
 hero.getInventory().hold(itemToAdd, "Clothes");
 
-#itemToAdd = $GOM.createGameObject("torch");
-#hero.getInventory().hold(itemToAdd, "Right Hand");
+itemToAdd = $GOM.createGameObject("torch");
+hero.getInventory().hold(itemToAdd, "Right Hand");

Modified: modules/kanalisation/scripts/particle.rb
===================================================================
--- modules/kanalisation/scripts/particle.rb	2008-07-03 07:16:51 UTC (rev 4430)
+++ modules/kanalisation/scripts/particle.rb	2008-07-04 11:22:11 UTC (rev 4431)
@@ -1,15 +1,14 @@
 tavernfire1 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
-tavernfire1.placeIntoScene( -1.39,6.06,12.84, 0.5, 0.0, 0.0, 0.0 );
+tavernfire1.placeIntoScene( -1.39,5.54,12.84, 0.5, 0.0, 0.0, 0.0 );
 
 tavernfire2 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
-tavernfire2.placeIntoScene( 11.39,6.06,9.75, 1.0, 0.0, 0.0, 0.0 );
+tavernfire2.placeIntoScene( 11.44,5.54,9.76, 1.0, 0.0, 0.0, 0.0 );
 
 tavernfire3 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
 tavernfire3.placeIntoScene( -22.48,4.60,23.10, 1.0, 0.0, 0.0, 0.0 );
 
-tavernfire4 = $AM.createParticleSystemActor("tavernfire1", "vlight" );
-tavernfire4.placeIntoScene( -21.85,7.10,25.13, 1.0, 0.0, 0.0, 0.0 );
 
+
 tavernfire5 = $AM.createParticleSystemActor("tavernfire1", "feuertest" );
 tavernfire5.placeIntoScene( 36.49,7.37,30.27, 1.0, 0.0, 0.0, 0.0 );
 
@@ -22,9 +21,6 @@
 #waber01 = $AM.createParticleSystemActor("waber01", "waber" );
 #waber01.placeIntoScene( 8.73,3.73,10.36, 1.0, 0.0, 0.0, 0.0 );
 
-#glow1 = $AM.createParticleSystemActor("glow1", "glow01" );
-#glow1.placeIntoScene( 8.49,2.83,10.39, 1.0, 0.0, 0.0, 0.0 );
-
 #firelight = $AM.createLightActor("firelight", LightObject::LT_POINT);
 #firelight.placeIntoScene( 94.28, 5.65, -30.88, 1.0, 0.0, 0.0, 0.0 );
 #firelight.getControlledObject().setCastShadows(true);



From alassion at mail.berlios.de  Fri Jul  4 13:25:43 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Fri, 4 Jul 2008 13:25:43 +0200
Subject: [Dsa-hl-svn] r4432 - modules/kanalisation/scripts
Message-ID: <200807041125.m64BPhfF006211@sheep.berlios.de>

Author: alassion
Date: 2008-07-04 13:25:41 +0200 (Fri, 04 Jul 2008)
New Revision: 4432

Added:
   modules/kanalisation/scripts/maps/
Log:
- added map directory -



From alassion at mail.berlios.de  Fri Jul  4 13:27:20 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Fri, 4 Jul 2008 13:27:20 +0200
Subject: [Dsa-hl-svn] r4433 - modules/kanalisation/scripts
Message-ID: <200807041127.m64BRK36009248@sheep.berlios.de>

Author: alassion
Date: 2008-07-04 13:27:11 +0200 (Fri, 04 Jul 2008)
New Revision: 4433

Removed:
   modules/kanalisation/scripts/maps/
Log:




From alassion at mail.berlios.de  Fri Jul  4 13:27:59 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Fri, 4 Jul 2008 13:27:59 +0200
Subject: [Dsa-hl-svn] r4434 - in modules/kanalisation/scripts: . maps
Message-ID: <200807041127.m64BRx4W010505@sheep.berlios.de>

Author: alassion
Date: 2008-07-04 13:27:51 +0200 (Fri, 04 Jul 2008)
New Revision: 4434

Added:
   modules/kanalisation/scripts/maps/
   modules/kanalisation/scripts/maps/kanalisation.rb
Log:
- added playerstart position -

Added: modules/kanalisation/scripts/maps/kanalisation.rb
===================================================================
--- modules/kanalisation/scripts/maps/kanalisation.rb	2008-07-04 11:27:11 UTC (rev 4433)
+++ modules/kanalisation/scripts/maps/kanalisation.rb	2008-07-04 11:27:51 UTC (rev 4434)
@@ -0,0 +1,62 @@
+load "embed.rb"
+$World = $CORE.getWorld()
+require 'player.rb'
+require 'mckhero.rb'
+require 'torch.rb'
+
+
+# Physik aktivieren
+$PM.setEnabled(true);
+
+#$SCRIPT.log("Tageslicht erstellen..");
+#sunlight = $AM.createLightActor("sunlight", LightObject::LT_DIRECTIONAL);
+#sunlight.getControlledObject().setCastShadows(true);
+#sunlight.getControlledObject().setSpecularColour(1.0,1.0,1.0);
+#sunlight.getControlledObject().setDiffuseColour(0.1,0.1,0.2);
+#$SCRIPT.log("Tageslicht erstellt.");
+
+#backlight = $AM.createLightActor("backlight", LightObject::LT_DIRECTIONAL);
+#backlight.getControlledObject().setDirection(0.17101, 0.873647, -0.969846);
+#backlight.getControlledObject().setCastShadows(false);
+#backlight.getControlledObject().setDiffuseColour(-0.3,-0.3,-0.3);
+
+$World.setFog( World::FOG_EXP, [0.658,0.7568,0.9137,1.0], 0.00049, 0.8, 1.0);
+$World.setAmbientLight( 0.08, 0.06, 0.05  );
+
+$SCRIPT.log("Sound laden");
+kanalLied = $AM.createSoundStreamActor( "KanalLied", "kanal.ogg" ); 
+kanalLied.getControlledObject().set3d(false);
+$SCRIPT.log(" Loopen");
+kanalLied.getControlledObject().setLooping( true );
+$SCRIPT.log(" Abspielen");
+kanalLied.getControlledObject().play();
+$SCRIPT.log("Sound fertig");
+
+$SCRIPT.log("Initialize hero");
+$hero = $GOM.createGameObject("mckhero", 1);
+$hero.placeIntoScene();
+$hero.setPosition([ -35.15, 2.69, 26.09]);
+$hero.setOrientation([ [ -4.43614335381426e-005, -0.999999940395355, -3.53998184436932e-005 ] , 67.3891525268555]);
+PlayerSettings.preparePlayer($hero);
+$UI.setActiveCharacter($hero)
+$SCRIPT.log("Create hero")
+
+$SCRIPT.log("Prepare hero for being the active character")
+PlayerSettings.preparePlayer($hero)
+
+$SCRIPT.log("Set hero as active character")
+$UI.setActiveCharacter($hero)
+
+$SCRIPT.log("Hero ready")
+
+$SCRIPT.log("Fackellicht erstellen..");
+fackellicht = $AM.createLightActor("Das Licht der Fackel", LightObject::LT_POINT );
+fackellicht.getControlledObject().setCastShadows(true);
+fackellicht.getControlledObject().setDiffuseColour(0.3,0.2,0.1);
+fackellicht.getControlledObject().setAttenuation(2.0, 0.79,  -0.21, 0.268 );
+$hero.getActor().attachToSlot( fackellicht, "Bip01 R SlotHand" );
+$SCRIPT.log("Fackellicht erstellt.");
+
+load "particle.rb"
+load "equip.rb"
+



From alassion at mail.berlios.de  Fri Jul  4 13:51:42 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Fri, 4 Jul 2008 13:51:42 +0200
Subject: [Dsa-hl-svn] r4435 - in modules/kanalisation/materials: . textures
Message-ID: <200807041151.m64BpgCi028361@sheep.berlios.de>

Author: alassion
Date: 2008-07-04 13:41:40 +0200 (Fri, 04 Jul 2008)
New Revision: 4435

Added:
   modules/kanalisation/materials/textures/
   modules/kanalisation/materials/textures/axe.png
   modules/kanalisation/materials/textures/axe_normal.png
   modules/kanalisation/materials/textures/axe_specularity.png
   modules/kanalisation/materials/textures/balken_kana.png
   modules/kanalisation/materials/textures/balken_kana_normal.png
   modules/kanalisation/materials/textures/baumstamm_kana.png
   modules/kanalisation/materials/textures/baumstamm_kana_normal.png
   modules/kanalisation/materials/textures/boden_02_kana.png
   modules/kanalisation/materials/textures/boden_02_kana_normal.png
   modules/kanalisation/materials/textures/boden_02_kana_spec.png
   modules/kanalisation/materials/textures/boden_kana.png
   modules/kanalisation/materials/textures/boden_kana_normal.png
   modules/kanalisation/materials/textures/breitschwert.png
   modules/kanalisation/materials/textures/breitschwert_normal.png
   modules/kanalisation/materials/textures/breitschwert_spec.png
   modules/kanalisation/materials/textures/dagger.png
   modules/kanalisation/materials/textures/dagger_normal.png
   modules/kanalisation/materials/textures/drop_shadow.png
   modules/kanalisation/materials/textures/dust.png
   modules/kanalisation/materials/textures/explosion.png
   modules/kanalisation/materials/textures/fackel_kana.png
   modules/kanalisation/materials/textures/fackel_kana_normal.png
   modules/kanalisation/materials/textures/fade_kana.png
   modules/kanalisation/materials/textures/farn.png
   modules/kanalisation/materials/textures/fass_kanalisation.png
   modules/kanalisation/materials/textures/fass_kanalisation_normal.png
   modules/kanalisation/materials/textures/fass_kanalisation_specularity.png
   modules/kanalisation/materials/textures/felsen2_kana.png
   modules/kanalisation/materials/textures/felsen2_kana_normal.png
   modules/kanalisation/materials/textures/felsen_kana.png
   modules/kanalisation/materials/textures/felsen_kana_normal.png
   modules/kanalisation/materials/textures/fence_kana.png
   modules/kanalisation/materials/textures/gras_kana.png
   modules/kanalisation/materials/textures/gras_kana_normal.png
   modules/kanalisation/materials/textures/grasbueschel_kana.png
   modules/kanalisation/materials/textures/kiesbett_kana.png
   modules/kanalisation/materials/textures/kiesbett_kana_normal.png
   modules/kanalisation/materials/textures/kiste_kana.png
   modules/kanalisation/materials/textures/kiste_kana_normal.png
   modules/kanalisation/materials/textures/kiste_moos_kana.png
   modules/kanalisation/materials/textures/kiste_moos_kana_normal.png
   modules/kanalisation/materials/textures/nat_wellen.dds
   modules/kanalisation/materials/textures/nebel.png
   modules/kanalisation/materials/textures/pflaster_kana.png
   modules/kanalisation/materials/textures/pflaster_kana_normal.png
   modules/kanalisation/materials/textures/pilz.png
   modules/kanalisation/materials/textures/pilz2.png
   modules/kanalisation/materials/textures/pilz3.png
   modules/kanalisation/materials/textures/pilz_normal.png
   modules/kanalisation/materials/textures/rust_kana.png
   modules/kanalisation/materials/textures/rust_kana_normal.png
   modules/kanalisation/materials/textures/rust_kana_spec.png
   modules/kanalisation/materials/textures/saeule_kana.png
   modules/kanalisation/materials/textures/saeule_kana2_normal.png
   modules/kanalisation/materials/textures/saeule_kana_normal.png
   modules/kanalisation/materials/textures/saeule_kana_spec.png
   modules/kanalisation/materials/textures/schild_kana.png
   modules/kanalisation/materials/textures/schild_kana_normal.png
   modules/kanalisation/materials/textures/schild_kana_spec.png
   modules/kanalisation/materials/textures/schild_normal.png
   modules/kanalisation/materials/textures/vlight01.png
   modules/kanalisation/materials/textures/wand_kana.png
   modules/kanalisation/materials/textures/wand_kana_normal.png
   modules/kanalisation/materials/textures/wurzeln_klein.png
Modified:
   modules/kanalisation/materials/Wassershader_Kanalisation.program
Log:


Modified: modules/kanalisation/materials/Wassershader_Kanalisation.program
===================================================================
--- modules/kanalisation/materials/Wassershader_Kanalisation.program	2008-07-04 11:27:51 UTC (rev 4434)
+++ modules/kanalisation/materials/Wassershader_Kanalisation.program	2008-07-04 11:41:40 UTC (rev 4435)
@@ -7,7 +7,7 @@
             fragment_program_ref Wassershader_Kanalisation_PS_HLSL
             {
                 param_named reflectionexp float 3.0
-                param_named waterreflectcolor float4 0.45 0.42 0.42 0.6
+                param_named waterreflectcolor float4 0.55 0.52 0.52 0.6
             }
  
         }

Added: modules/kanalisation/materials/textures/axe.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/axe.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/axe_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/axe_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/axe_specularity.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/axe_specularity.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/balken_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/balken_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/balken_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/balken_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/baumstamm_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/baumstamm_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/baumstamm_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/baumstamm_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/boden_02_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/boden_02_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/boden_02_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/boden_02_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/boden_02_kana_spec.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/boden_02_kana_spec.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/boden_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/boden_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/boden_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/boden_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/breitschwert.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/breitschwert.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/breitschwert_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/breitschwert_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/breitschwert_spec.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/breitschwert_spec.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/dagger.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/dagger.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/dagger_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/dagger_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/drop_shadow.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/drop_shadow.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/dust.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/dust.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/explosion.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/explosion.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/fackel_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/fackel_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/fackel_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/fackel_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/fade_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/fade_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/farn.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/farn.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/fass_kanalisation.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/fass_kanalisation.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/fass_kanalisation_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/fass_kanalisation_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/fass_kanalisation_specularity.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/fass_kanalisation_specularity.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/felsen2_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/felsen2_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/felsen2_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/felsen2_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/felsen_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/felsen_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/felsen_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/felsen_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/fence_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/fence_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/gras_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/gras_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/gras_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/gras_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/grasbueschel_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/grasbueschel_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/kiesbett_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/kiesbett_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/kiesbett_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/kiesbett_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/kiste_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/kiste_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/kiste_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/kiste_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/kiste_moos_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/kiste_moos_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/kiste_moos_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/kiste_moos_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/nat_wellen.dds
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/nat_wellen.dds
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/nebel.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/nebel.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/pflaster_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/pflaster_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/pflaster_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/pflaster_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/pilz.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/pilz.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/pilz2.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/pilz2.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/pilz3.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/pilz3.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/pilz_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/pilz_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/rust_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/rust_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/rust_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/rust_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/rust_kana_spec.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/rust_kana_spec.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/saeule_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/saeule_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/saeule_kana2_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/saeule_kana2_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/saeule_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/saeule_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/saeule_kana_spec.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/saeule_kana_spec.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/schild_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/schild_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/schild_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/schild_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/schild_kana_spec.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/schild_kana_spec.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/schild_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/schild_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/vlight01.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/vlight01.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/wand_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/wand_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/wand_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/wand_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/wurzeln_klein.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/wurzeln_klein.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream



From kamui at mail.berlios.de  Sun Jul  6 11:45:41 2008
From: kamui at mail.berlios.de (kamui at mail.berlios.de)
Date: Sun, 6 Jul 2008 11:45:41 +0200
Subject: [Dsa-hl-svn] r4436 - modules/common/gui/imagesets
Message-ID: <200807060945.m669jfHL007193@sheep.berlios.de>

Author: kamui
Date: 2008-07-06 11:45:38 +0200 (Sun, 06 Jul 2008)
New Revision: 4436

Modified:
   modules/common/gui/imagesets/RastullahLook.imageset
   modules/common/gui/imagesets/RastullahLook.png
Log:
closed gap at window border

Modified: modules/common/gui/imagesets/RastullahLook.imageset
===================================================================
--- modules/common/gui/imagesets/RastullahLook.imageset	2008-07-04 11:41:40 UTC (rev 4435)
+++ modules/common/gui/imagesets/RastullahLook.imageset	2008-07-06 09:45:38 UTC (rev 4436)
@@ -5,7 +5,7 @@
     <Image Name="GenericBrush"  XPos="40" YPos="350" Width="1" Height="1" />
 
     <!-- Rastullah/FrameWindow -->
-    <Image Name="WindowBackground" XPos="256" YPos="1" Width="254" Height="254" />    
+    <Image Name="WindowBackground" XPos="40" YPos="295" Width="5" Height="5" />    
     <Image Name="WindowLeftEdge" XPos="30" YPos="302" Width="18" Height="2" />
     <Image Name="WindowRightEdge" XPos="56" YPos="302" Width="18" Height="2" />
     <Image Name="WindowTopEdge" XPos="51" YPos="281" Width="2" Height="18"  />

Modified: modules/common/gui/imagesets/RastullahLook.png
===================================================================
(Binary files differ)



From blakharaz at mail.berlios.de  Sun Jul  6 23:10:54 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Sun, 6 Jul 2008 23:10:54 +0200
Subject: [Dsa-hl-svn] r4437 - in rl/trunk: Mac/Rastullah.xcodeproj
	engine/core/include engine/core/src engine/startup/src
Message-ID: <200807062110.m66LAsFZ000303@sheep.berlios.de>

Author: blakharaz
Date: 2008-07-06 23:10:49 +0200 (Sun, 06 Jul 2008)
New Revision: 4437

Modified:
   rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj
   rl/trunk/engine/core/include/ConfigurationManager.h
   rl/trunk/engine/core/src/ConfigurationManager.cpp
   rl/trunk/engine/core/src/RubyInterpreter.cpp
   rl/trunk/engine/startup/src/RastullahMain.cpp
Log:
Mac OS X: Use paths relative to started executable to support application bundles?\226?\128?\168Xcode project: added "copy frameworks" target

Modified: rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj
===================================================================
--- rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj	2008-07-06 09:45:38 UTC (rev 4436)
+++ rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj	2008-07-06 21:10:49 UTC (rev 4437)
@@ -429,19 +429,6 @@
 		44D8147A0BF7B62F00534175 /* Trigger.h in Headers */ = {isa = PBXBuildFile; fileRef = 44D814750BF7B62F00534175 /* Trigger.h */; };
 		44D8147B0BF7B62F00534175 /* Zone.h in Headers */ = {isa = PBXBuildFile; fileRef = 44D814760BF7B62F00534175 /* Zone.h */; };
 		44D8147C0BF7B62F00534175 /* ZoneManager.h in Headers */ = {isa = PBXBuildFile; fileRef = 44D814770BF7B62F00534175 /* ZoneManager.h */; };
-		48187AAB0D885CBB00CE6689 /* libRlCommon.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAAB20BD0E0FB00C6D4A0 /* libRlCommon.dylib */; };
-		48187AAC0D885CBB00CE6689 /* libRlCore.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAB610BD0E2DA00C6D4A0 /* libRlCore.dylib */; };
-		48187AAD0D885CBB00CE6689 /* libRlAi.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAC270BD0E3FF00C6D4A0 /* libRlAi.dylib */; };
-		48187AAE0D885CBB00CE6689 /* libRlRules.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAC370BD0E44900C6D4A0 /* libRlRules.dylib */; };
-		48187AAF0D885CBB00CE6689 /* libRlUi.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAC3E0BD0E46000C6D4A0 /* libRlUi.dylib */; };
-		483514870D8AED510077477D /* OIS.framework in Resources */ = {isa = PBXBuildFile; fileRef = 4857E4E40D46A664009D376D /* OIS.framework */; };
-		483514890D8AED510077477D /* libmeshmagick.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 440785DD0C09D231006E496D /* libmeshmagick.dylib */; };
-		4835148A0D8AED510077477D /* libruby.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 483646A10D83D57800912FEC /* libruby.dylib */; };
-		4835148B0D8AED510077477D /* OgreCEGUIRenderer.framework in Resources */ = {isa = PBXBuildFile; fileRef = 444EB3720BD1784A00C6D4A0 /* OgreCEGUIRenderer.framework */; };
-		4835148C0D8AED510077477D /* OpenSteer.framework in Resources */ = {isa = PBXBuildFile; fileRef = 444EB0DA0BD119BB00C6D4A0 /* OpenSteer.framework */; };
-		4835148D0D8AED510077477D /* CEGUI.framework in Resources */ = {isa = PBXBuildFile; fileRef = 444EAEBD0BD0F09900C6D4A0 /* CEGUI.framework */; };
-		4835148E0D8AED510077477D /* Ogre.framework in Resources */ = {isa = PBXBuildFile; fileRef = 444EAEBE0BD0F09900C6D4A0 /* Ogre.framework */; };
-		4835148F0D8AED510077477D /* OgreNewt.framework in Resources */ = {isa = PBXBuildFile; fileRef = 444EB0880BD1153500C6D4A0 /* OgreNewt.framework */; };
 		483646990D83D13700912FEC /* ContentLoader.h in Headers */ = {isa = PBXBuildFile; fileRef = 483646960D83D13700912FEC /* ContentLoader.h */; };
 		4836469A0D83D13700912FEC /* SoundStitching.h in Headers */ = {isa = PBXBuildFile; fileRef = 483646970D83D13700912FEC /* SoundStitching.h */; };
 		4836469B0D83D13700912FEC /* StartAnimationJob.h in Headers */ = {isa = PBXBuildFile; fileRef = 483646980D83D13700912FEC /* StartAnimationJob.h */; };
@@ -549,6 +536,21 @@
 		483D86A70D8C3DA200F3629E /* Fmod4Sound.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 483D869A0D8C3DA200F3629E /* Fmod4Sound.cpp */; };
 		483D86A80D8C3DA200F3629E /* Fmod4SoundStitching.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 483D869B0D8C3DA200F3629E /* Fmod4SoundStitching.cpp */; };
 		483D87CE0D8C564400F3629E /* libRlScript.dylib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48570C1B0D8A6C5400096E35 /* libRlScript.dylib */; };
+		484D8D0B0E1E05F400BCFC2B /* OgreCEGUIRenderer.framework in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 444EB3720BD1784A00C6D4A0 /* OgreCEGUIRenderer.framework */; };
+		484D8D0C0E1E05F400BCFC2B /* OpenSteer.framework in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 444EB0DA0BD119BB00C6D4A0 /* OpenSteer.framework */; };
+		484D8D0D0E1E05F400BCFC2B /* CEGUI.framework in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 444EAEBD0BD0F09900C6D4A0 /* CEGUI.framework */; };
+		484D8D0E0E1E05F400BCFC2B /* Ogre.framework in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 444EAEBE0BD0F09900C6D4A0 /* Ogre.framework */; };
+		484D8D0F0E1E05F400BCFC2B /* OgreNewt.framework in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 444EB0880BD1153500C6D4A0 /* OgreNewt.framework */; };
+		484D92140E1E060200BCFC2B /* Xerces.framework in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 4836CBC80D8FB0BE002FE5D7 /* Xerces.framework */; };
+		484D92150E1E060200BCFC2B /* OIS.framework in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 4857E4E40D46A664009D376D /* OIS.framework */; };
+		484D921E0E1E078100BCFC2B /* libRlCommon.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAAB20BD0E0FB00C6D4A0 /* libRlCommon.dylib */; };
+		484D921F0E1E078100BCFC2B /* libRlCore.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAB610BD0E2DA00C6D4A0 /* libRlCore.dylib */; };
+		484D92200E1E078100BCFC2B /* libRlAi.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAC270BD0E3FF00C6D4A0 /* libRlAi.dylib */; };
+		484D92210E1E078100BCFC2B /* libRlRules.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAC370BD0E44900C6D4A0 /* libRlRules.dylib */; };
+		484D92220E1E078100BCFC2B /* libRlUi.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 444EAC3E0BD0E46000C6D4A0 /* libRlUi.dylib */; };
+		484D92230E1E078100BCFC2B /* libRlScript.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 48570C1B0D8A6C5400096E35 /* libRlScript.dylib */; };
+		484D92240E1E078100BCFC2B /* libRlFmod4Driver.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 483D86700D8C3A3300F3629E /* libRlFmod4Driver.dylib */; };
+		484D92250E1E078100BCFC2B /* RlScript.bundle in Resources */ = {isa = PBXBuildFile; fileRef = 483D87C90D8C55E500F3629E /* RlScript.bundle */; };
 		484FE6BA0E17BC8800FA880F /* Carbon.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = 484FE6B90E17BC8800FA880F /* Carbon.framework */; };
 		484FE6BB0E17BC8800FA880F /* Carbon.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = 484FE6B90E17BC8800FA880F /* Carbon.framework */; };
 		484FE6BC0E17BC8800FA880F /* Carbon.framework in Frameworks */ = {isa = PBXBuildFile; fileRef = 484FE6B90E17BC8800FA880F /* Carbon.framework */; };
@@ -656,9 +658,6 @@
 		48A52CC20E0EF77E008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
 		48A52CC30E0EF785008DBDD8 /* libboost_system.lib in Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */; };
 		48B5F63A0DAF48AF00D05C95 /* Info.plist in Resources */ = {isa = PBXBuildFile; fileRef = 8D0C4E960486CD37000505A6 /* Info.plist */; };
-		48B5F6520DAF4D2D00D05C95 /* libRlScript.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 48570C1B0D8A6C5400096E35 /* libRlScript.dylib */; };
-		48B5F6530DAF4D3500D05C95 /* libRlFmod4Driver.dylib in Resources */ = {isa = PBXBuildFile; fileRef = 483D86700D8C3A3300F3629E /* libRlFmod4Driver.dylib */; };
-		48B5F6540DAF4D4400D05C95 /* RlScript.bundle in Resources */ = {isa = PBXBuildFile; fileRef = 483D87C90D8C55E500F3629E /* RlScript.bundle */; };
 		48B772DD0D58350B000A3B97 /* XmlProcessor.h in Headers */ = {isa = PBXBuildFile; fileRef = 48B772DA0D58350B000A3B97 /* XmlProcessor.h */; };
 		48B772DE0D58350B000A3B97 /* XmlPropertyReader.h in Headers */ = {isa = PBXBuildFile; fileRef = 48B772DB0D58350B000A3B97 /* XmlPropertyReader.h */; };
 		48B772DF0D58350B000A3B97 /* XmlPropertyWriter.h in Headers */ = {isa = PBXBuildFile; fileRef = 48B772DC0D58350B000A3B97 /* XmlPropertyWriter.h */; };
@@ -820,6 +819,26 @@
 		};
 /* End PBXContainerItemProxy section */
 
+/* Begin PBXCopyFilesBuildPhase section */
+		484D8D0A0E1E058D00BCFC2B /* Copy Frameworks */ = {
+			isa = PBXCopyFilesBuildPhase;
+			buildActionMask = 2147483647;
+			dstPath = "";
+			dstSubfolderSpec = 10;
+			files = (
+				484D92140E1E060200BCFC2B /* Xerces.framework in Copy Frameworks */,
+				484D92150E1E060200BCFC2B /* OIS.framework in Copy Frameworks */,
+				484D8D0B0E1E05F400BCFC2B /* OgreCEGUIRenderer.framework in Copy Frameworks */,
+				484D8D0C0E1E05F400BCFC2B /* OpenSteer.framework in Copy Frameworks */,
+				484D8D0D0E1E05F400BCFC2B /* CEGUI.framework in Copy Frameworks */,
+				484D8D0E0E1E05F400BCFC2B /* Ogre.framework in Copy Frameworks */,
+				484D8D0F0E1E05F400BCFC2B /* OgreNewt.framework in Copy Frameworks */,
+			);
+			name = "Copy Frameworks";
+			runOnlyForDeploymentPostprocessing = 0;
+		};
+/* End PBXCopyFilesBuildPhase section */
+
 /* Begin PBXFileReference section */
 		0867D6ABFE840B52C02AAC07 /* English */ = {isa = PBXFileReference; fileEncoding = 10; lastKnownFileType = text.plist.strings; name = English; path = English.lproj/InfoPlist.strings; sourceTree = "<group>"; };
 		1870340FFE93FCAF11CA0CD7 /* English */ = {isa = PBXFileReference; lastKnownFileType = wrapper.nib; name = English; path = English.lproj/main.nib; sourceTree = "<group>"; };
@@ -1670,12 +1689,12 @@
 			isa = PBXGroup;
 			children = (
 				485A056A0D71EDC40024198D /* MessageObject.h */,
+				485A057E0D71EDF20024198D /* MessagePump.cpp */,
 				485A056B0D71EDC40024198D /* MessagePump.h */,
 				485A056C0D71EDC40024198D /* MessageType.h */,
 				48B772E00D583521000A3B97 /* XmlProcessor.cpp */,
 				48B772E10D583521000A3B97 /* XmlPropertyReader.cpp */,
 				48B772E20D583521000A3B97 /* XmlPropertyWriter.cpp */,
-				485A057E0D71EDF20024198D /* MessagePump.cpp */,
 				48B772DA0D58350B000A3B97 /* XmlProcessor.h */,
 				48B772DB0D58350B000A3B97 /* XmlPropertyReader.h */,
 				48B772DC0D58350B000A3B97 /* XmlPropertyWriter.h */,
@@ -2848,6 +2867,7 @@
 				8D0C4E8C0486CD37000505A6 /* Resources */,
 				8D0C4E8F0486CD37000505A6 /* Sources */,
 				8D0C4E910486CD37000505A6 /* Frameworks */,
+				484D8D0A0E1E058D00BCFC2B /* Copy Frameworks */,
 			);
 			buildRules = (
 			);
@@ -2900,22 +2920,14 @@
 			isa = PBXResourcesBuildPhase;
 			buildActionMask = 2147483647;
 			files = (
-				48B5F6540DAF4D4400D05C95 /* RlScript.bundle in Resources */,
-				48B5F6530DAF4D3500D05C95 /* libRlFmod4Driver.dylib in Resources */,
-				48B5F6520DAF4D2D00D05C95 /* libRlScript.dylib in Resources */,
-				48187AAB0D885CBB00CE6689 /* libRlCommon.dylib in Resources */,
-				48187AAC0D885CBB00CE6689 /* libRlCore.dylib in Resources */,
-				483514870D8AED510077477D /* OIS.framework in Resources */,
-				483514890D8AED510077477D /* libmeshmagick.dylib in Resources */,
-				4835148A0D8AED510077477D /* libruby.dylib in Resources */,
-				4835148B0D8AED510077477D /* OgreCEGUIRenderer.framework in Resources */,
-				4835148C0D8AED510077477D /* OpenSteer.framework in Resources */,
-				4835148D0D8AED510077477D /* CEGUI.framework in Resources */,
-				4835148E0D8AED510077477D /* Ogre.framework in Resources */,
-				4835148F0D8AED510077477D /* OgreNewt.framework in Resources */,
-				48187AAD0D885CBB00CE6689 /* libRlAi.dylib in Resources */,
-				48187AAE0D885CBB00CE6689 /* libRlRules.dylib in Resources */,
-				48187AAF0D885CBB00CE6689 /* libRlUi.dylib in Resources */,
+				484D921E0E1E078100BCFC2B /* libRlCommon.dylib in Resources */,
+				484D921F0E1E078100BCFC2B /* libRlCore.dylib in Resources */,
+				484D92200E1E078100BCFC2B /* libRlAi.dylib in Resources */,
+				484D92210E1E078100BCFC2B /* libRlRules.dylib in Resources */,
+				484D92220E1E078100BCFC2B /* libRlUi.dylib in Resources */,
+				484D92230E1E078100BCFC2B /* libRlScript.dylib in Resources */,
+				484D92240E1E078100BCFC2B /* libRlFmod4Driver.dylib in Resources */,
+				484D92250E1E078100BCFC2B /* RlScript.bundle in Resources */,
 				8D0C4E8D0486CD37000505A6 /* InfoPlist.strings in Resources */,
 				8D0C4E8E0486CD37000505A6 /* main.nib in Resources */,
 				48D409CE0D9E483300AE5340 /* modules in Resources */,

Modified: rl/trunk/engine/core/include/ConfigurationManager.h
===================================================================
--- rl/trunk/engine/core/include/ConfigurationManager.h	2008-07-06 09:45:38 UTC (rev 4436)
+++ rl/trunk/engine/core/include/ConfigurationManager.h	2008-07-06 21:10:49 UTC (rev 4437)
@@ -1,292 +1,303 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
- *
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
- */
-
-/**
- * \file ConfigurationManager.h
- *
- * Declaration of the ConfigurationManager subsystem
- */
-
-#ifndef __RL_CONFIGURATIONMANAGER_H__
-#define __RL_CONFIGURATIONMANAGER_H__
-
-#include "CorePrerequisites.h"
-#include "ConfigFile.h"
-
-#include <boost/filesystem/operations.hpp>
-#include <boost/filesystem/exception.hpp>
-
-namespace fs = boost::filesystem;
-
-namespace rl
-{
-    /**
-     * The ConfigurationManager subsystem class
-     *
-     * It provides a convenient way for other subsystems to access values read from the
-     * configuration files. If no configuration file is available, sane default values are
-     * provided so that Rastullah will work properly on most systems.
-     */
-    class _RlCoreExport ConfigurationManager : public Ogre::Singleton<ConfigurationManager>
-    {
-        public:
-
-            ~ConfigurationManager();
-
-            /**
-             * Returns a pointer to the single instance of the
-             * ConfigurationManager.
-             *
-             * The ConfigurationManager object is created, if it does not
-             * exist.
-             *
-             * @return Pointer to ConfigurationManager object
-             */
-            static ConfigurationManager* getSingletonPtr();
-
-            /**
-             * Returns a reference to the single instance of the
-             * ConfigurationManager.
-             *
-             * The ConfigurationManager object is created, if it does not
-             * exist.
-             *
-             * @return Reference to ConfigurationManager object
-             */
-            static ConfigurationManager& getSingleton();
-
-            /**
-             * Returns the filename for the log written by Ogre
-             *
-             * @return filename of Ogre's logfile
-             */
-            Ogre::String getOgreLogFile() const;
-
-            /**
-             * Returns the filename for the log written by Rastullah
-             *
-             * @return filename of Rastullah's logfile
-             */
-            Ogre::String getRastullahLogFile() const;
-
-            /**
-             * Returns the filename for the log written by CEGUI
-             *
-             * @return filename of CEGUI's logfile
-             */
-            Ogre::String getCeguiLogFile() const;
-
-            /**
-             * Returns a list of paths, were Rastullah configuration files
-             * reside
-             *
-             * The list is seperated via the : character and has to be
-             * processed, before usage
-             *
-             * @return colon seperated path of Rastullah configuration
-             *         directories
-             */
-            Ogre::String getRastullahCfgPath() const;
-
-            /**
-             * Returns the root of the Rastullah modules directory
-             *
-             * @return directory where Rastullah modules reside
-             */
-            Ogre::String getModulesRootDirectory() const;
-
-            /**
-             * Returns the directory where Rastullah stores all its log files
-             *
-             * @return directoy where Rastullah logfiles are stored
-             */
-            Ogre::String getRastullahLogDirectory() const;
-
-            /**
-             * Adds a key-value pair to the list specified by section
-             *
-             * If the key already exists in the list, its value will be updated
-             *
-             * @param section The section where the key-value pair will be inserted
-             * @param key The key of the key-value pair
-             * @param value The value of the key-value pair
-             */
-            void addSetting(const Ogre::String& section, const Ogre::String& key, const Ogre::String& value);
-
-            /**
-             * Returns the string value for a specific key in a specific section
-             *
-             * @param section The sections key-value list, which is searched
-             * @param key The key, for which a value will be returned
-             * @return string value for the specific key in the specific section
-             */
-            Ogre::String getStringSetting(const Ogre::String& section, const Ogre::String& key) const;
-
-            /**
-             * Returns the int value for a specific key in a specific section
-             *
-             * @param section The sections key-value list, which is searched
-             * @param key The key, for which a value will be returned
-             * @return int value for the specific key in the specific section
-             */
-            int getIntSetting(const Ogre::String& section, const Ogre::String& key) const;
-
-            /**
-             * Returns the boolean value for a specific key in a specific section
-             *
-             * @param section The sections key-value list, which is searched
-             * @param key The key, for which a value will be returned
-             * @return boolean value for the specific key in the specific section
-             */
-            bool getBoolSetting(const Ogre::String& section, const Ogre::String& key) const;
-
-            /**
-             * Returns the real value for a specific key in a specific section
-             *
-             * @param section The sections key-value list, which is searched
-             * @param key The key, for which a value will be returned
-             * @return real value for the specific key in the specific section
-             */
-            Ogre::Real getRealSetting(const Ogre::String& section, const Ogre::String& key) const;
-
-            /**
-             * Returns a pointer to the settings of the named section.
-             * @param section name of the section to get settings of.
-             * @return key-value list of graphic settings
-             */
-            Ogre::NameValuePairList getSettings(const Ogre::String& section) const;
-
-            /**
-             * Returns a pointer to the video settings
-             * @return key-value list of graphic settings
-             */
-            Ogre::NameValuePairList* getVideoSettings() const;
-
-            /**
-             * Returns a list of Ogre plugins specific to the OS
-             *
-             * @return vector of plugin names
-             */
-            Ogre::StringVector getPluginList() const;
-
-            /**
-             * Returns the list of Rastullah game modules
-             *
-             * @return vector of module names
-             */
-            Ogre::StringVector getModuleList() const;
-
-            /**
-             * Returns the filename of the current keymap file used by
-             * Rastullah
-             *
-             * @return filename of keymap file
-             */
-            Ogre::String getKeymap() const;
-
-            /**
-             * Returns the log level specifying how verbose the created
-             * logfiles are
-             *
-             * @return verbosity level of logfiles
-             */
-            Logger::LogLevel getLogLevel() const;
-
-            /**
-             * Loads configuration files from the configuration directories
-             *
-             * Loads up to four configuration files (systemwide, user, current
-             * directory, module) and sets certain settings for the game
-             */
-            void loadConfig();
-
-            /**
-             * Saves a configuration file in OS specific directory
-             */
-            void saveConfig() const;
-
-        private:
-
-            /**
-             * Constructs a new ConfigurationManager object.
-             *
-             * Sets the name for the Ogre, Rastullah and CEGUI logfiles
-             * and the Rastullah configuration file. The path
-             * where configuration files might be reside is also set.
-             */
-            ConfigurationManager();
-
-            /**
-             * Sets the path where configuration files may reside
-             * based on the operating system.
-             */
-            void setRastullahCfgPath();
-
-            /**
-             * Adds the specified path to the Rastullah configuration path
-             * variable.
-             *
-             * All values are seperated via a colon.
-             *
-             * @param cfg_dir Directory where a configuration file may reside
-             */
-            void addToCfgPath(const std::string& cfg_dir);
-
-            /**
-             * Adds a plugin to the plugin list, correctly adds _d for Windows if compiled
-             * in debug mode
-             *
-             * @param plugin the plugin to add (name without _d or file extension)
-             * @param pluginDir the directory in which the plugin dll is located
-             */
-            void addPlugin(const Ogre::String& plugin, const Ogre::String& pluginDir);
-
-            /**
-             * Check if a specified file exists.
-             *
-             * @param filename File being checked for existence
-             * @return true if file exists, false otherwise
-             */
-            bool checkForFile(const std::string& filename);
-
-            /**
-             * Searches for a specific key in a specific section
-             *
-             * @param section The sections key-value list, which is searched
-             * @param key The key, for which a value will be returned
-             * @return value if key exits, otherwise NULL
-             */
-            Ogre::String findSetting(const Ogre::String& section, const Ogre::String& key) const;
-
-            Ogre::String mRastullahCfgFile;           //!< Filename of the Rastullah configuration file
-            Ogre::String mOgreLogFile;                //!< Filename of the logfile written by OGRE
-            Ogre::String mRastullahLogFile;           //!< Filename of the logfile written by Rastullah
-            Ogre::String mCeguiLogFile;               //!< Filename of the logfile written by CEGUI
-            Ogre::String mModulesCfgFile;             //!< Filename of the Module configuration file
-            Ogre::String mModulesRootDirectory;       //!< Directory where Rastullah's modules reside
-            Ogre::String mRastullahLogDirectory;      //!< Directory where all logfiles are stored
-            Ogre::String mRastullahCfgPath;           //!< List of directories containing Rastullah configuration files
-            Ogre::String mOgrePluginDirectory;        //!< Directory where OGRE stores its plugins
-            Ogre::StringVector mModuleList;           //!< List of Rastullah game modules
-            Ogre::StringVector mPluginList;           //!< List of OGRE Plugins, which will be loaded by CoreSubsystem
-
-            typedef std::map<Ogre::String, Ogre::NameValuePairList> SectionMap;
-            /// Stores settings per section in a NameValuePairList
-            SectionMap mSettings;                     
-    };
-}
-
-#endif
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+ *
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+
+/**
+ * \file ConfigurationManager.h
+ *
+ * Declaration of the ConfigurationManager subsystem
+ */
+
+#ifndef __RL_CONFIGURATIONMANAGER_H__
+#define __RL_CONFIGURATIONMANAGER_H__
+
+#include "CorePrerequisites.h"
+#include "ConfigFile.h"
+
+#include <boost/filesystem/operations.hpp>
+#include <boost/filesystem/exception.hpp>
+
+namespace fs = boost::filesystem;
+
+namespace rl
+{
+    /**
+     * The ConfigurationManager subsystem class
+     *
+     * It provides a convenient way for other subsystems to access values read from the
+     * configuration files. If no configuration file is available, sane default values are
+     * provided so that Rastullah will work properly on most systems.
+     */
+    class _RlCoreExport ConfigurationManager : public Ogre::Singleton<ConfigurationManager>
+    {
+        public:
+
+            ~ConfigurationManager();
+
+            /**
+             * Returns a pointer to the single instance of the
+             * ConfigurationManager.
+             *
+             * The ConfigurationManager object is created, if it does not
+             * exist.
+             *
+             * @return Pointer to ConfigurationManager object
+             */
+            static ConfigurationManager* getSingletonPtr();
+
+            /**
+             * Returns a reference to the single instance of the
+             * ConfigurationManager.
+             *
+             * The ConfigurationManager object is created, if it does not
+             * exist.
+             *
+             * @return Reference to ConfigurationManager object
+             */
+            static ConfigurationManager& getSingleton();
+
+            /**
+             * Returns the filename for the log written by Ogre
+             *
+             * @return filename of Ogre's logfile
+             */
+            Ogre::String getOgreLogFile() const;
+
+            /**
+             * Returns the filename for the log written by Rastullah
+             *
+             * @return filename of Rastullah's logfile
+             */
+            Ogre::String getRastullahLogFile() const;
+
+            /**
+             * Returns the filename for the log written by CEGUI
+             *
+             * @return filename of CEGUI's logfile
+             */
+            Ogre::String getCeguiLogFile() const;
+
+            /**
+             * Returns a list of paths, were Rastullah configuration files
+             * reside
+             *
+             * The list is seperated via the : character and has to be
+             * processed, before usage
+             *
+             * @return colon seperated path of Rastullah configuration
+             *         directories
+             */
+            Ogre::String getRastullahCfgPath() const;
+
+            /**
+             * Returns the root of the Rastullah modules directory
+             *
+             * @return directory where Rastullah modules reside
+             */
+            Ogre::String getModulesRootDirectory() const;
+
+            /**
+             * Returns the directory where Rastullah stores all its log files
+             *
+             * @return directoy where Rastullah logfiles are stored
+             */
+            Ogre::String getRastullahLogDirectory() const;
+
+            /**
+             * Adds a key-value pair to the list specified by section
+             *
+             * If the key already exists in the list, its value will be updated
+             *
+             * @param section The section where the key-value pair will be inserted
+             * @param key The key of the key-value pair
+             * @param value The value of the key-value pair
+             */
+            void addSetting(const Ogre::String& section, const Ogre::String& key, const Ogre::String& value);
+
+            /**
+             * Returns the string value for a specific key in a specific section
+             *
+             * @param section The sections key-value list, which is searched
+             * @param key The key, for which a value will be returned
+             * @return string value for the specific key in the specific section
+             */
+            Ogre::String getStringSetting(const Ogre::String& section, const Ogre::String& key) const;
+
+            /**
+             * Returns the int value for a specific key in a specific section
+             *
+             * @param section The sections key-value list, which is searched
+             * @param key The key, for which a value will be returned
+             * @return int value for the specific key in the specific section
+             */
+            int getIntSetting(const Ogre::String& section, const Ogre::String& key) const;
+
+            /**
+             * Returns the boolean value for a specific key in a specific section
+             *
+             * @param section The sections key-value list, which is searched
+             * @param key The key, for which a value will be returned
+             * @return boolean value for the specific key in the specific section
+             */
+            bool getBoolSetting(const Ogre::String& section, const Ogre::String& key) const;
+
+            /**
+             * Returns the real value for a specific key in a specific section
+             *
+             * @param section The sections key-value list, which is searched
+             * @param key The key, for which a value will be returned
+             * @return real value for the specific key in the specific section
+             */
+            Ogre::Real getRealSetting(const Ogre::String& section, const Ogre::String& key) const;
+
+            /**
+             * Returns a pointer to the settings of the named section.
+             * @param section name of the section to get settings of.
+             * @return key-value list of graphic settings
+             */
+            Ogre::NameValuePairList getSettings(const Ogre::String& section) const;
+
+            /**
+             * Returns a pointer to the video settings
+             * @return key-value list of graphic settings
+             */
+            Ogre::NameValuePairList* getVideoSettings() const;
+
+            /**
+             * Returns a list of Ogre plugins specific to the OS
+             *
+             * @return vector of plugin names
+             */
+            Ogre::StringVector getPluginList() const;
+
+            /**
+             * Returns the list of Rastullah game modules
+             *
+             * @return vector of module names
+             */
+            Ogre::StringVector getModuleList() const;
+
+            /**
+             * Returns the filename of the current keymap file used by
+             * Rastullah
+             *
+             * @return filename of keymap file
+             */
+            Ogre::String getKeymap() const;
+
+            /**
+             * Returns the log level specifying how verbose the created
+             * logfiles are
+             *
+             * @return verbosity level of logfiles
+             */
+            Logger::LogLevel getLogLevel() const;
+
+            /**
+             * Loads configuration files from the configuration directories
+             *
+             * Loads up to four configuration files (systemwide, user, current
+             * directory, module) and sets certain settings for the game
+             */
+            void loadConfig();
+
+            /**
+             * Saves a configuration file in OS specific directory
+             */
+            void saveConfig() const;
+			
+			/**
+			 * Set the path of the started RL executable
+			 */
+			void setExecutablePath(const Ogre::String& path);
+	
+			/**
+			 * Set the path of the started RL executable
+			 */
+			const Ogre::String& getExecutablePath() const;
+	
+        private:
+
+            /**
+             * Constructs a new ConfigurationManager object.
+             *
+             * Sets the name for the Ogre, Rastullah and CEGUI logfiles
+             * and the Rastullah configuration file. The path
+             * where configuration files might be reside is also set.
+             */
+            ConfigurationManager();
+
+            /**
+             * Sets the path where configuration files may reside
+             * based on the operating system.
+             */
+            void setRastullahCfgPath();
+
+            /**
+             * Adds the specified path to the Rastullah configuration path
+             * variable.
+             *
+             * All values are seperated via a colon.
+             *
+             * @param cfg_dir Directory where a configuration file may reside
+             */
+            void addToCfgPath(const std::string& cfg_dir);
+
+            /**
+             * Adds a plugin to the plugin list, correctly adds _d for Windows if compiled
+             * in debug mode
+             *
+             * @param plugin the plugin to add (name without _d or file extension)
+             * @param pluginDir the directory in which the plugin dll is located
+             */
+            void addPlugin(const Ogre::String& plugin, const Ogre::String& pluginDir);
+
+            /**
+             * Check if a specified file exists.
+             *
+             * @param filename File being checked for existence
+             * @return true if file exists, false otherwise
+             */
+            bool checkForFile(const std::string& filename);
+
+            /**
+             * Searches for a specific key in a specific section
+             *
+             * @param section The sections key-value list, which is searched
+             * @param key The key, for which a value will be returned
+             * @return value if key exits, otherwise NULL
+             */
+            Ogre::String findSetting(const Ogre::String& section, const Ogre::String& key) const;
+			
+			Ogre::String mExecutablePath;             //!< Filename of the running RL executable
+            Ogre::String mRastullahCfgFile;           //!< Filename of the Rastullah configuration file
+            Ogre::String mOgreLogFile;                //!< Filename of the logfile written by OGRE
+            Ogre::String mRastullahLogFile;           //!< Filename of the logfile written by Rastullah
+            Ogre::String mCeguiLogFile;               //!< Filename of the logfile written by CEGUI
+            Ogre::String mModulesCfgFile;             //!< Filename of the Module configuration file
+            Ogre::String mModulesRootDirectory;       //!< Directory where Rastullah's modules reside
+            Ogre::String mRastullahLogDirectory;      //!< Directory where all logfiles are stored
+            Ogre::String mRastullahCfgPath;           //!< List of directories containing Rastullah configuration files
+            Ogre::String mOgrePluginDirectory;        //!< Directory where OGRE stores its plugins
+            Ogre::StringVector mModuleList;           //!< List of Rastullah game modules
+            Ogre::StringVector mPluginList;           //!< List of OGRE Plugins, which will be loaded by CoreSubsystem
+
+            typedef std::map<Ogre::String, Ogre::NameValuePairList> SectionMap;
+            /// Stores settings per section in a NameValuePairList
+            SectionMap mSettings;                     
+    };
+}
+
+#endif

Modified: rl/trunk/engine/core/src/ConfigurationManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ConfigurationManager.cpp	2008-07-06 09:45:38 UTC (rev 4436)
+++ rl/trunk/engine/core/src/ConfigurationManager.cpp	2008-07-06 21:10:49 UTC (rev 4437)
@@ -51,6 +51,7 @@
     ConfigurationManager::ConfigurationManager()
     {
         // Filenames for log and configuration files
+		mExecutablePath = "./";
         mRastullahCfgFile = "rastullah.conf";
         mOgreLogFile = "ogre.log";
         mCeguiLogFile = "cegui.log";
@@ -382,12 +383,25 @@
     {
         return Ogre::String("config/keymap-german.xml");
     }
+	
+	void ConfigurationManager::setExecutablePath(const Ogre::String& path)
+	{
+		mExecutablePath = path;
+	}
 
+	const Ogre::String& ConfigurationManager::getExecutablePath() const
+	{
+		return mExecutablePath;
+	}
+
     void ConfigurationManager::setRastullahCfgPath()
     {
         // First try: Current directory
         addToCfgPath("./");
 
+#		if OGRE_PLATFORM == OGRE_PLATFORM_APPLE
+		addToCfgPath(mExecutablePath + "/../Resources/modules/config/");
+#		endif
 #       if OGRE_PLATFORM != OGRE_PLATFORM_WIN32
         // Check system wide /etc/rastullah directory
         addToCfgPath("/etc/rastullah/");
@@ -421,9 +435,12 @@
     {
         try {
 #           if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
+			std::cout << "Checking for " << fs::complete(filename);
             if (fs::exists(filename))
 #           else
-            if (fs::exists(fs::path(filename, fs::portable_posix_name)))
+			std::cout << "Checking for " << 
+				fs::complete(fs::path(filename, fs::portable_posix_name)).string();
+			if (fs::exists(fs::path(filename, fs::portable_posix_name)))
 #           endif
             {
                 return true;

Modified: rl/trunk/engine/core/src/RubyInterpreter.cpp
===================================================================
--- rl/trunk/engine/core/src/RubyInterpreter.cpp	2008-07-06 09:45:38 UTC (rev 4436)
+++ rl/trunk/engine/core/src/RubyInterpreter.cpp	2008-07-06 21:10:49 UTC (rev 4437)
@@ -55,6 +55,10 @@
 
     // UTF 8 aktivieren
     execute( "$KCODE = 'u'" );
+	
+	#if OGRE_PLATFORM == OGRE_PLATFORM_APPLE
+	addSearchPath(ConfigurationManager::getSingleton().getExecutablePath()+"/../Resources");
+	#endif
 
     //Skript-Verzeichnisse der  Dateien duerfen auch in /script liegen
     ModuleMap modules = CoreSubsystem::getSingleton().getAllModules();
@@ -92,6 +96,7 @@
 
 void RubyInterpreter::addSearchPath(const Ogre::String& path)
 {
+	LOG_DEBUG("RubyInterpreter", "Search path "+path+" added.");
     ruby_incpush(path.c_str());
 }
 

Modified: rl/trunk/engine/startup/src/RastullahMain.cpp
===================================================================
--- rl/trunk/engine/startup/src/RastullahMain.cpp	2008-07-06 09:45:38 UTC (rev 4436)
+++ rl/trunk/engine/startup/src/RastullahMain.cpp	2008-07-06 21:10:49 UTC (rev 4437)
@@ -37,7 +37,7 @@
     #include <shellapi.h>
 #endif
 
-void startupRl(bool developerMode, Ogre::String module)
+void startupRl(bool developerMode, Ogre::String module, Ogre::String executablePath)
 {
     rl::CoreSubsystem* core = NULL;
     rl::RulesSubsystem* rules = NULL;
@@ -49,6 +49,7 @@
 #ifndef _DEBUG
     try {
 #endif // #ifndef _DEBUG
+		rl::ConfigurationManager::getSingleton().setExecutablePath(executablePath);
         rl::ConfigurationManager::getSingleton().loadConfig();
 
         Ogre::String logDir = rl::ConfigurationManager::getSingleton().getRastullahLogDirectory();
@@ -151,12 +152,15 @@
 
 }
 
-void analyzeParameters(int argc, char** argv, bool& developerMode, Ogre::String& startModule)
+void analyzeParameters(int argc, char** argv, 
+	bool& developerMode, Ogre::String& startModule, Ogre::String& executablePath)
 {
     developerMode = false;
     startModule = "";
+	Ogre::String executable = argv[0];
+	executablePath = executable.substr(0, executable.find_last_of("/"));
 
-    for (int argIdx = 0; argIdx < argc; argIdx++)
+    for (int argIdx = 1; argIdx < argc; argIdx++)
     {
         if (strncmp(argv[argIdx], "--dev", 5) == 0)
             developerMode = true;
@@ -183,7 +187,8 @@
 
     bool developer;
     Ogre::String module;
-    analyzeParameters(argc, argv, developer, module);
+	Ogre::String executablePath;
+    analyzeParameters(argc, argv, developer, module, executablePath);
 
     for (int argIdx = 0; argIdx < argc; argIdx++)
     {
@@ -192,7 +197,7 @@
     delete[] argv;
     LocalFree(argList);
 
-    startupRl(developer, module);
+    startupRl(developer, module, executablePath);
 
     return 0;
 }
@@ -203,9 +208,10 @@
 {
     bool developer;
     Ogre::String module;
+	Ogre::String executablePath;
 
-    analyzeParameters(argc, argv, developer, module);
-    startupRl(developer, module);
+    analyzeParameters(argc, argv, developer, module, executablePath);
+    startupRl(developer, module, executablePath);
 
     return 0;
 }



From blakharaz at mail.berlios.de  Tue Jul  8 20:43:17 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 8 Jul 2008 20:43:17 +0200
Subject: [Dsa-hl-svn] r4438 - in rl/trunk/engine: core/include core/src
	startup/src
Message-ID: <200807081843.m68IhHCD030726@sheep.berlios.de>

Author: blakharaz
Date: 2008-07-08 20:43:14 +0200 (Tue, 08 Jul 2008)
New Revision: 4438

Modified:
   rl/trunk/engine/core/include/ConfigurationManager.h
   rl/trunk/engine/core/src/ConfigurationManager.cpp
   rl/trunk/engine/startup/src/RastullahMain.cpp
Log:
Use boost::filesystem to make getting the executable path portable

Modified: rl/trunk/engine/core/include/ConfigurationManager.h
===================================================================
--- rl/trunk/engine/core/include/ConfigurationManager.h	2008-07-06 21:10:49 UTC (rev 4437)
+++ rl/trunk/engine/core/include/ConfigurationManager.h	2008-07-08 18:43:14 UTC (rev 4438)
@@ -219,9 +219,9 @@
             void saveConfig() const;
 			
 			/**
-			 * Set the path of the started RL executable
+			 * Extract the path of the started RL executable
 			 */
-			void setExecutablePath(const Ogre::String& path);
+			void setExecutable(const Ogre::String& executableFile);
 	
 			/**
 			 * Set the path of the started RL executable

Modified: rl/trunk/engine/core/src/ConfigurationManager.cpp
===================================================================
--- rl/trunk/engine/core/src/ConfigurationManager.cpp	2008-07-06 21:10:49 UTC (rev 4437)
+++ rl/trunk/engine/core/src/ConfigurationManager.cpp	2008-07-08 18:43:14 UTC (rev 4438)
@@ -384,9 +384,11 @@
         return Ogre::String("config/keymap-german.xml");
     }
 	
-	void ConfigurationManager::setExecutablePath(const Ogre::String& path)
+	void ConfigurationManager::setExecutable(const Ogre::String& path)
 	{
-		mExecutablePath = path;
+		fs::path exeAbsolute(path, fs::portable_posix_name);
+		
+		mExecutablePath = exeAbsolute.remove_leaf().string();
 	}
 
 	const Ogre::String& ConfigurationManager::getExecutablePath() const

Modified: rl/trunk/engine/startup/src/RastullahMain.cpp
===================================================================
--- rl/trunk/engine/startup/src/RastullahMain.cpp	2008-07-06 21:10:49 UTC (rev 4437)
+++ rl/trunk/engine/startup/src/RastullahMain.cpp	2008-07-08 18:43:14 UTC (rev 4438)
@@ -37,7 +37,7 @@
     #include <shellapi.h>
 #endif
 
-void startupRl(bool developerMode, Ogre::String module, Ogre::String executablePath)
+void startupRl(bool developerMode, const Ogre::String& module, const Ogre::String& executable)
 {
     rl::CoreSubsystem* core = NULL;
     rl::RulesSubsystem* rules = NULL;
@@ -49,7 +49,7 @@
 #ifndef _DEBUG
     try {
 #endif // #ifndef _DEBUG
-		rl::ConfigurationManager::getSingleton().setExecutablePath(executablePath);
+		rl::ConfigurationManager::getSingleton().setExecutable(executable);
         rl::ConfigurationManager::getSingleton().loadConfig();
 
         Ogre::String logDir = rl::ConfigurationManager::getSingleton().getRastullahLogDirectory();
@@ -153,12 +153,11 @@
 }
 
 void analyzeParameters(int argc, char** argv, 
-	bool& developerMode, Ogre::String& startModule, Ogre::String& executablePath)
+	bool& developerMode, Ogre::String& startModule, Ogre::String& executable)
 {
     developerMode = false;
     startModule = "";
-	Ogre::String executable = argv[0];
-	executablePath = executable.substr(0, executable.find_last_of("/"));
+	executable = argv[0];
 
     for (int argIdx = 1; argIdx < argc; argIdx++)
     {
@@ -187,8 +186,8 @@
 
     bool developer;
     Ogre::String module;
-	Ogre::String executablePath;
-    analyzeParameters(argc, argv, developer, module, executablePath);
+	Ogre::String executable;
+    analyzeParameters(argc, argv, developer, module, executable);
 
     for (int argIdx = 0; argIdx < argc; argIdx++)
     {
@@ -197,7 +196,7 @@
     delete[] argv;
     LocalFree(argList);
 
-    startupRl(developer, module, executablePath);
+    startupRl(developer, module, executable);
 
     return 0;
 }
@@ -208,10 +207,10 @@
 {
     bool developer;
     Ogre::String module;
-	Ogre::String executablePath;
+	Ogre::String executable;
 
-    analyzeParameters(argc, argv, developer, module, executablePath);
-    startupRl(developer, module, executablePath);
+    analyzeParameters(argc, argv, developer, module, executable);
+    startupRl(developer, module, executable);
 
     return 0;
 }



From blakharaz at mail.berlios.de  Tue Jul  8 20:45:34 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 8 Jul 2008 20:45:34 +0200
Subject: [Dsa-hl-svn] r4439 - in rl/trunk/Mac: . tools
Message-ID: <200807081845.m68IjYIF030930@sheep.berlios.de>

Author: blakharaz
Date: 2008-07-08 20:45:32 +0200 (Tue, 08 Jul 2008)
New Revision: 4439

Added:
   rl/trunk/Mac/tools/
   rl/trunk/Mac/tools/renameinstalldirs.sh
Log:
Added build phase and script to change frameworks and libs installation paths to relative paths

Added: rl/trunk/Mac/tools/renameinstalldirs.sh
===================================================================
--- rl/trunk/Mac/tools/renameinstalldirs.sh	2008-07-08 18:43:14 UTC (rev 4438)
+++ rl/trunk/Mac/tools/renameinstalldirs.sh	2008-07-08 18:45:32 UTC (rev 4439)
@@ -0,0 +1,12 @@
+#!/bin/sh
+RASTULLAH_APP_NAME=$1
+
+#TODO: Replace the absolute source paths to something with olist -L $RASTULLAH_APP_NAME and grep
+
+echo Changing library installation directories for $RASTULLAH_APP_NAME
+install_name_tool -change /Library/Frameworks/CEGUI.framework/Versions/A/CEGUI @executable_path/../Frameworks/CEGUI.framework/Versions/A/CEGUI $RASTULLAH_APP_NAME
+install_name_tool -change libboost_system-mt-1_35.dylib @executable_path/../Frameworks/libboost_system-mt-1_35.dylib $RASTULLAH_APP_NAME
+install_name_tool -change /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/libruby.1.dylib @executable_path/../Frameworks/libruby.1.dylib $RASTULLAH_APP_NAME
+install_name_tool -change /Users/blakharaz/Library/Frameworks/OgreNewt.framework/Versions/A/OgreNewt @executable_path/../Frameworks/OgreNewt.framework/Versions/A/OgreNewt $RASTULLAH_APP_NAME
+install_name_tool -change /Users/blakharaz/Library/Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer @executable_path/../Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer $RASTULLAH_APP_NAME
+echo done.
\ No newline at end of file


Property changes on: rl/trunk/Mac/tools/renameinstalldirs.sh
___________________________________________________________________
Name: svn:executable
   + *



From blakharaz at mail.berlios.de  Tue Jul  8 20:45:50 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Tue, 8 Jul 2008 20:45:50 +0200
Subject: [Dsa-hl-svn] r4440 - rl/trunk/Mac/Rastullah.xcodeproj
Message-ID: <200807081845.m68IjoPC030951@sheep.berlios.de>

Author: blakharaz
Date: 2008-07-08 20:45:48 +0200 (Tue, 08 Jul 2008)
New Revision: 4440

Modified:
   rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj
Log:
Added build phase and script to change frameworks/libs installation paths to relative paths

Modified: rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj
===================================================================
--- rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj	2008-07-08 18:45:32 UTC (rev 4439)
+++ rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj	2008-07-08 18:45:48 UTC (rev 4440)
@@ -664,6 +664,8 @@
 		48B772E30D583521000A3B97 /* XmlProcessor.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48B772E00D583521000A3B97 /* XmlProcessor.cpp */; };
 		48B772E40D583521000A3B97 /* XmlPropertyReader.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48B772E10D583521000A3B97 /* XmlPropertyReader.cpp */; };
 		48B772E50D583521000A3B97 /* XmlPropertyWriter.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48B772E20D583521000A3B97 /* XmlPropertyWriter.cpp */; };
+		48D0BDC70E23375E00863824 /* libruby.dylib in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 483646A10D83D57800912FEC /* libruby.dylib */; };
+		48D0BDE60E23378700863824 /* libboost_filesystem.dylib in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52B210E0EDA0E008DBDD8 /* libboost_filesystem.dylib */; };
 		48D34A630D90F5D500C89477 /* SaveGameData.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D34A610D90F5D500C89477 /* SaveGameData.h */; };
 		48D34A640D90F5D500C89477 /* SaveGameData.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D34A620D90F5D500C89477 /* SaveGameData.cpp */; };
 		48D34A7D0D91C7D800C89477 /* SaveGameFile.h in Headers */ = {isa = PBXBuildFile; fileRef = 485A056E0D71EDC40024198D /* SaveGameFile.h */; };
@@ -826,6 +828,8 @@
 			dstPath = "";
 			dstSubfolderSpec = 10;
 			files = (
+				48D0BDE60E23378700863824 /* libboost_filesystem.dylib in Copy Frameworks */,
+				48D0BDC70E23375E00863824 /* libruby.dylib in Copy Frameworks */,
 				484D92140E1E060200BCFC2B /* Xerces.framework in Copy Frameworks */,
 				484D92150E1E060200BCFC2B /* OIS.framework in Copy Frameworks */,
 				484D8D0B0E1E05F400BCFC2B /* OgreCEGUIRenderer.framework in Copy Frameworks */,
@@ -2868,6 +2872,7 @@
 				8D0C4E8F0486CD37000505A6 /* Sources */,
 				8D0C4E910486CD37000505A6 /* Frameworks */,
 				484D8D0A0E1E058D00BCFC2B /* Copy Frameworks */,
+				48D0BDF20E2342F600863824 /* ShellScript */,
 			);
 			buildRules = (
 			);
@@ -2951,6 +2956,19 @@
 			shellPath = /bin/sh;
 			shellScript = "pwd\ncd ../engine/script/swig\n/usr/local/bin/swig -ruby -minherit -c++ -Fmicrosoft -addextern RlExports.i";
 		};
+		48D0BDF20E2342F600863824 /* ShellScript */ = {
+			isa = PBXShellScriptBuildPhase;
+			buildActionMask = 2147483647;
+			files = (
+			);
+			inputPaths = (
+			);
+			outputPaths = (
+			);
+			runOnlyForDeploymentPostprocessing = 0;
+			shellPath = /bin/sh;
+			shellScript = "${SOURCE_ROOT}/tools/renameinstalldirs.sh ${BUILT_PRODUCTS_DIR}/Rastullah.app/Contents/MacOS/Rastullah\n";
+		};
 /* End PBXShellScriptBuildPhase section */
 
 /* Begin PBXSourcesBuildPhase section */



From timm at mail.berlios.de  Thu Jul 10 10:49:50 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Thu, 10 Jul 2008 10:49:50 +0200
Subject: [Dsa-hl-svn] r4441 - in rl/trunk/engine: common common/include
	common/src core core/src
Message-ID: <200807100849.m6A8noFR003231@sheep.berlios.de>

Author: timm
Date: 2008-07-10 10:49:42 +0200 (Thu, 10 Jul 2008)
New Revision: 4441

Added:
   rl/trunk/engine/common/include/WriteableDataStream.h
   rl/trunk/engine/common/include/WriteableDataStreamFormatTarget.h
   rl/trunk/engine/common/include/WriteableFileSystemArchiv.h
   rl/trunk/engine/common/src/WriteableDataStream.cpp
   rl/trunk/engine/common/src/WriteableDataStreamFormatTarget.cpp
   rl/trunk/engine/common/src/WriteableFileSystemArchiv.cpp
Modified:
   rl/trunk/engine/common/RlCommon2005.vcproj
   rl/trunk/engine/core/RlCore2005.vcproj
   rl/trunk/engine/core/src/CoreSubsystem.cpp
Log:
Introducing write able streams

Modified: rl/trunk/engine/common/RlCommon2005.vcproj
===================================================================
--- rl/trunk/engine/common/RlCommon2005.vcproj	2008-07-08 18:45:48 UTC (rev 4440)
+++ rl/trunk/engine/common/RlCommon2005.vcproj	2008-07-10 08:49:42 UTC (rev 4441)
@@ -367,6 +367,18 @@
 				</FileConfiguration>
 			</File>
 			<File
+				RelativePath=".\src\WriteableDataStream.cpp"
+				>
+			</File>
+			<File
+				RelativePath=".\src\WriteableDataStreamFormatTarget.cpp"
+				>
+			</File>
+			<File
+				RelativePath=".\src\WriteableFileSystemArchiv.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\XmlProcessor.cpp"
 				>
 			</File>
@@ -475,6 +487,18 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\WriteableDataStream.h"
+				>
+			</File>
+			<File
+				RelativePath=".\include\WriteableDataStreamFormatTarget.h"
+				>
+			</File>
+			<File
+				RelativePath=".\include\WriteableFileSystemArchiv.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\XmlProcessor.h"
 				>
 			</File>

Added: rl/trunk/engine/common/include/WriteableDataStream.h
===================================================================
--- rl/trunk/engine/common/include/WriteableDataStream.h	2008-07-08 18:45:48 UTC (rev 4440)
+++ rl/trunk/engine/common/include/WriteableDataStream.h	2008-07-10 08:49:42 UTC (rev 4441)
@@ -0,0 +1,75 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "CommonPrerequisites.h"
+
+#include <OgreDataStream.h>
+#include <iostream>
+
+namespace rl
+{
+    class _RlCommonExport WriteableDataStream : public Ogre::DataStream
+    {
+    public:
+        virtual void write(void* buf, size_t count) = 0;
+        virtual void flush() = 0;
+    };
+
+    typedef Ogre::SharedPtr<WriteableDataStream> WriteableDataStreamPtr;
+
+    class _RlCommonExport WriteableFileStreamDataStream : public WriteableDataStream
+    {
+    protected:
+		std::fstream* mpStream;
+        bool mFreeOnClose;	
+    public:
+        WriteableFileStreamDataStream(std::fstream* s, 
+            bool freeOnClose = true);
+
+        WriteableFileStreamDataStream(const Ogre::String& name, 
+            std::fstream* s, 
+            bool freeOnClose = true);
+
+        WriteableFileStreamDataStream(const Ogre::String& name, 
+            std::fstream* s, 
+            size_t size, 
+            bool freeOnClose = true);
+
+        ~WriteableFileStreamDataStream();
+
+		size_t read(void* buf, size_t count);
+
+        size_t readLine(char* buf, size_t maxCount, const Ogre::String& delim = "\n");
+		
+		void skip(long count);
+	
+	    void seek( size_t pos );
+
+		size_t tell(void) const;
+
+	    bool eof(void) const;
+
+        void close(void);
+
+        std::fstream* getFStream();
+
+        void write(void* buf, size_t count);
+
+        void flush();
+    };
+
+    typedef Ogre::SharedPtr<WriteableFileStreamDataStream> WriteableFileStreamDataStreamPtr;
+}
\ No newline at end of file

Added: rl/trunk/engine/common/include/WriteableDataStreamFormatTarget.h
===================================================================
--- rl/trunk/engine/common/include/WriteableDataStreamFormatTarget.h	2008-07-08 18:45:48 UTC (rev 4440)
+++ rl/trunk/engine/common/include/WriteableDataStreamFormatTarget.h	2008-07-10 08:49:42 UTC (rev 4441)
@@ -0,0 +1,32 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+
+#include <xercesc/framework/XMLFormatter.hpp>
+#include "WriteableDataStream.h"
+
+namespace rl
+{
+    class WriteableDataStreamFormatTarget : public XERCES_CPP_NAMESPACE::XMLFormatTarget
+    {
+    public:
+        WriteableDataStreamFormatTarget(WriteableDataStreamPtr stream);
+        void writeChars (const XMLByte *const toWrite, const unsigned int count, XERCES_CPP_NAMESPACE::XMLFormatter *const formatter);
+        void flush ();
+    protected:
+        WriteableDataStreamPtr mStream;
+    };
+}
\ No newline at end of file

Added: rl/trunk/engine/common/include/WriteableFileSystemArchiv.h
===================================================================
--- rl/trunk/engine/common/include/WriteableFileSystemArchiv.h	2008-07-08 18:45:48 UTC (rev 4440)
+++ rl/trunk/engine/common/include/WriteableFileSystemArchiv.h	2008-07-10 08:49:42 UTC (rev 4441)
@@ -0,0 +1,60 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#ifndef __WriteableFileSystemArchive_H__
+#define __WriteableFileSystemArchive_H__
+
+#include "CommonPrerequisites.h"
+
+#include "OgreFileSystem.h"
+
+namespace rl {
+
+    /** Specialisation of the Archive class to allow reading of files from 
+        filesystem folders / directories.
+    */
+    class _RlCommonExport WriteableFileSystemArchive : public Ogre::FileSystemArchive 
+    {
+    protected:
+    public:
+        WriteableFileSystemArchive(const Ogre::String& name, const Ogre::String& archType );
+        virtual ~WriteableFileSystemArchive();
+
+        /// @copydoc Archive::open
+        Ogre::DataStreamPtr open(const Ogre::String& filename) const;
+    };
+
+    /** Specialisation of ArchiveFactory for FileSystem files. */
+    //class _OgrePrivate WriteableFileSystemArchiveFactory : public ArchiveFactory
+    class _RlCommonExport WriteableFileSystemArchiveFactory : public Ogre::ArchiveFactory
+    {
+    public:
+        virtual ~WriteableFileSystemArchiveFactory() {}
+        /// @copydoc FactoryObj::getType
+        const Ogre::String& getType(void) const;
+        /// @copydoc FactoryObj::createInstance
+        Ogre::Archive *createInstance( const Ogre::String& name ) 
+        {
+            return new WriteableFileSystemArchive(name, "WriteableFileSystem");
+        }
+        /// @copydoc FactoryObj::destroyInstance
+        void destroyInstance( Ogre::Archive* arch) { delete arch; }
+    };
+
+
+}
+
+#endif

Added: rl/trunk/engine/common/src/WriteableDataStream.cpp
===================================================================
--- rl/trunk/engine/common/src/WriteableDataStream.cpp	2008-07-08 18:45:48 UTC (rev 4440)
+++ rl/trunk/engine/common/src/WriteableDataStream.cpp	2008-07-10 08:49:42 UTC (rev 4441)
@@ -0,0 +1,194 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+
+#include "stdinc.h"
+
+#include "WriteableDataStream.h"
+
+using namespace Ogre;
+
+namespace rl
+{
+    WriteableFileStreamDataStream::WriteableFileStreamDataStream(std::fstream* s, 
+            bool freeOnClose)
+    {
+        mpStream->seekg(0, std::ios_base::end);
+        mSize = mpStream->tellg();
+        mpStream->seekg(0, std::ios_base::beg);
+    }
+
+    WriteableFileStreamDataStream::WriteableFileStreamDataStream(const Ogre::String& name, 
+            std::fstream* s, 
+            bool freeOnClose)
+    {
+        mpStream->seekg(0, std::ios_base::end);
+        mSize = mpStream->tellg();
+        mpStream->seekg(0, std::ios_base::beg);
+    }
+
+    WriteableFileStreamDataStream::WriteableFileStreamDataStream(const Ogre::String& name, 
+            std::fstream* s, 
+            size_t size, 
+            bool freeOnClose)
+    {
+        mSize = size;
+    }
+
+    WriteableFileStreamDataStream::~WriteableFileStreamDataStream()
+    {
+        close();
+    }
+
+	size_t WriteableFileStreamDataStream::read(void* buf, size_t count)
+    {
+        mpStream->read(static_cast<char*>(buf), static_cast<std::streamsize>(count));
+        return mpStream->gcount();
+    }
+
+    size_t WriteableFileStreamDataStream::readLine(char* buf, size_t maxCount, const Ogre::String& delim)
+    {
+        if (delim.empty())
+		{
+			OGRE_EXCEPT(Exception::ERR_INVALIDPARAMS, "No delimiter provided",
+				"FileStreamDataStream::readLine");
+		}
+		if (delim.size() > 1)
+		{
+			LogManager::getSingleton().logMessage(
+				"WARNING: FileStreamDataStream::readLine - using only first delimeter");
+		}
+		// Deal with both Unix & Windows LFs
+		bool trimCR = false;
+		if (delim.at(0) == '\n') 
+		{
+			trimCR = true;
+		}
+		// maxCount + 1 since count excludes terminator in getline
+		mpStream->getline(buf, static_cast<std::streamsize>(maxCount+1), delim.at(0));
+		size_t ret = mpStream->gcount();
+		// three options
+		// 1) we had an eof before we read a whole line
+		// 2) we ran out of buffer space
+		// 3) we read a whole line - in this case the delim character is taken from the stream but not written in the buffer so the read data is of length ret-1 and thus ends at index ret-2
+		// in all cases the buffer will be null terminated for us
+
+		if (mpStream->eof()) 
+		{
+			// no problem
+		}
+		else if (mpStream->fail())
+		{
+			// Did we fail because of maxCount hit? No - no terminating character
+			// in included in the count in this case
+			if (ret == maxCount)
+			{
+				// clear failbit for next time 
+				mpStream->clear();
+			}
+			else
+			{
+				OGRE_EXCEPT(Exception::ERR_INTERNAL_ERROR, 
+					"Streaming error occurred", 
+					"FileStreamDataStream::readLine");
+			}
+		}
+		else 
+		{
+			// we need to adjust ret because we want to use it as a
+			// pointer to the terminating null character and it is
+			// currently the length of the data read from the stream
+			// i.e. 1 more than the length of the data in the buffer and
+			// hence 1 more than the _index_ of the NULL character
+			--ret;
+		}
+
+		// trim off CR if we found CR/LF
+		if (trimCR && buf[ret-1] == '\r')
+		{
+			--ret;
+			buf[ret] = '\0';
+		}
+		return ret;
+    }
+		
+	void WriteableFileStreamDataStream::skip(long count)
+    {
+        #if defined(STLPORT)
+		// Workaround for STLport issues: After reached eof of file stream,
+		// it's seems the stream was putted in intermediate state, and will be
+		// fail if try to repositioning relative to current position.
+		// Note: tellg() fail in this case too.
+		if (mpStream->eof())
+		{
+			mpStream->clear();
+			// Use seek relative to either begin or end to bring the stream
+			// back to normal state.
+			mpStream->seekg(0, std::ios::end);
+		}
+#endif 		
+		mpStream->clear(); //Clear fail status in case eof was set
+		mpStream->seekg(static_cast<std::ifstream::pos_type>(count), std::ios::cur);
+    }
+	
+	void WriteableFileStreamDataStream::seek( size_t pos )
+    {
+        mpStream->clear(); //Clear fail status in case eof was set
+        mpStream->seekg(static_cast<std::streamoff>(pos), std::ios::beg);
+    }
+
+	size_t WriteableFileStreamDataStream::tell(void) const
+    {
+        mpStream->clear(); //Clear fail status in case eof was set
+		return mpStream->tellg();
+    }
+
+	bool WriteableFileStreamDataStream::eof(void) const
+    {
+        return mpStream->eof();
+    }
+
+    void WriteableFileStreamDataStream::close(void)
+    {
+        if (mpStream)
+        {
+            mpStream->close();
+            if (mFreeOnClose)
+            {
+                // delete the stream too
+                delete mpStream;
+                mpStream = 0;
+            }
+        }
+    }
+
+    std::fstream* WriteableFileStreamDataStream::getFStream()
+    {
+        return mpStream;
+    }
+
+    void WriteableFileStreamDataStream::write(void* buf, size_t count)
+    {
+        mpStream->clear();
+        mpStream->write(static_cast<char*>(buf), static_cast<std::streamsize>(count));   
+    }
+
+    void WriteableFileStreamDataStream::flush()
+    {
+        mpStream->clear();
+        mpStream->flush();
+    }
+}

Added: rl/trunk/engine/common/src/WriteableDataStreamFormatTarget.cpp
===================================================================
--- rl/trunk/engine/common/src/WriteableDataStreamFormatTarget.cpp	2008-07-08 18:45:48 UTC (rev 4440)
+++ rl/trunk/engine/common/src/WriteableDataStreamFormatTarget.cpp	2008-07-10 08:49:42 UTC (rev 4441)
@@ -0,0 +1,35 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+
+#include "stdinc.h" //precompiled header
+
+#include "WriteableDataStreamFormatTarget.h"
+
+namespace rl
+{
+    WriteableDataStreamFormatTarget::WriteableDataStreamFormatTarget(WriteableDataStreamPtr stream)
+    {
+        mStream = stream;
+    }
+
+    void WriteableDataStreamFormatTarget::writeChars (const XMLByte *const toWrite, const unsigned int count, XERCES_CPP_NAMESPACE::XMLFormatter *const formatter)
+    {
+    }
+
+    void WriteableDataStreamFormatTarget::flush ()
+    {
+    }
+}
\ No newline at end of file

Added: rl/trunk/engine/common/src/WriteableFileSystemArchiv.cpp
===================================================================
--- rl/trunk/engine/common/src/WriteableFileSystemArchiv.cpp	2008-07-08 18:45:48 UTC (rev 4440)
+++ rl/trunk/engine/common/src/WriteableFileSystemArchiv.cpp	2008-07-10 08:49:42 UTC (rev 4441)
@@ -0,0 +1,114 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h"
+
+#include "OgreStableHeaders.h"
+#include "OgreLogManager.h"
+#include "OgreException.h"
+#include "OgreStringVector.h"
+#include "OgreRoot.h"
+
+#include <sys/types.h>
+#include <sys/stat.h>
+
+#if OGRE_PLATFORM == OGRE_PLATFORM_LINUX || OGRE_PLATFORM == OGRE_PLATFORM_APPLE
+#   include "OgreSearchOps.h"
+#   include <sys/param.h>
+#   define MAX_PATH MAXPATHLEN
+#endif
+
+#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
+#   include <windows.h>
+#   include <direct.h>
+#   include <io.h>
+#endif
+
+#include "WriteableFileSystemArchiv.h"
+#include "WriteableFileStreamDataStream.h"
+
+using namespace Ogre;
+
+namespace rl 
+{
+    static bool is_reserved_dir (const char *fn)
+    {
+        return (fn [0] == '.' && (fn [1] == 0 || (fn [1] == '.' && fn [2] == 0)));
+    }
+
+    static bool is_absolute_path(const char* path)
+    {
+#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
+        if (isalpha(uchar(path[0])) && path[1] == ':')
+            return true;
+#endif
+        return path[0] == '/' || path[0] == '\\';
+    }
+
+    static String concatenate_path(const String& base, const String& name)
+    {
+        if (base.empty() || is_absolute_path(name.c_str()))
+            return name;
+        else
+            return base + '/' + name;
+    }
+
+
+
+    WriteableFileSystemArchive::WriteableFileSystemArchive(const Ogre::String& name, const Ogre::String& archType ) : Ogre::FileSystemArchive(name, archType)
+    {
+    }
+
+    WriteableFileSystemArchive::~WriteableFileSystemArchive()
+    {
+    }
+
+    DataStreamPtr WriteableFileSystemArchive::open(const String& filename) const
+    {
+        String full_path = concatenate_path(mName, filename);
+
+        // Use filesystem to determine size 
+        // (quicker than streaming to the end and back)
+        struct stat tagStat;
+	int ret = stat(full_path.c_str(), &tagStat);
+        assert(ret == 0 && "Problem getting file size" );
+
+        // Always open in binary mode
+        std::fstream *origStream = new std::fstream();
+        origStream->open(full_path.c_str(), std::ios::in | std::ios::out | std::ios::binary);
+
+        // Should check ensure open succeeded, in case fail for some reason.
+        if (origStream->fail())
+        {
+            delete origStream;
+            OGRE_EXCEPT(Exception::ERR_FILE_NOT_FOUND,
+                "Cannot open file: " + filename,
+                "WriteableFileSystemArchive::open");
+        }
+
+        /// Construct return stream, tell it to delete on destroy
+        WriteableFileStreamDataStream* stream = new WriteableFileStreamDataStream(filename,
+            origStream, tagStat.st_size, true);
+        return DataStreamPtr(stream);
+    }
+    
+    const String& WriteableFileSystemArchiveFactory::getType(void) const
+    {
+        static String name = "FileSystem";
+        return name;
+    }
+
+}

Modified: rl/trunk/engine/core/RlCore2005.vcproj
===================================================================
--- rl/trunk/engine/core/RlCore2005.vcproj	2008-07-08 18:45:48 UTC (rev 4440)
+++ rl/trunk/engine/core/RlCore2005.vcproj	2008-07-10 08:49:42 UTC (rev 4441)
@@ -568,6 +568,22 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\SaveAble.h"
+				>
+			</File>
+			<File
+				RelativePath=".\include\SaveAbleCollection.h"
+				>
+			</File>
+			<File
+				RelativePath=".\include\SaveAbleFactory.h"
+				>
+			</File>
+			<File
+				RelativePath=".\include\SaveAbleManager.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\SaveGameData.h"
 				>
 			</File>
@@ -873,6 +889,22 @@
 				>
 			</File>
 			<File
+				RelativePath=".\src\SaveAble.cpp"
+				>
+			</File>
+			<File
+				RelativePath=".\src\SaveAbleCollection.cpp"
+				>
+			</File>
+			<File
+				RelativePath=".\src\SaveAbleFactory.cpp"
+				>
+			</File>
+			<File
+				RelativePath=".\src\SaveAbleManager.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\SaveGameData.cpp"
 				>
 			</File>

Modified: rl/trunk/engine/core/src/CoreSubsystem.cpp
===================================================================
--- rl/trunk/engine/core/src/CoreSubsystem.cpp	2008-07-08 18:45:48 UTC (rev 4440)
+++ rl/trunk/engine/core/src/CoreSubsystem.cpp	2008-07-10 08:49:42 UTC (rev 4441)
@@ -39,6 +39,7 @@
 #include "ScriptWrapper.h"
 #include "SoundManager.h"
 #include "TimeSource.h"
+#include "WriteableFileSystemArchiv.h"
 #include "ZoneManager.h"
 
 #include <ctime>
@@ -182,6 +183,9 @@
         // to load plugins.cfg and ogre.cfg
         mOgreRoot = new Root("", "", ConfigurationManager::getSingleton().getOgreLogFile());
 
+        WriteableFileSystemArchiveFactory* factory = new WriteableFileSystemArchiveFactory();
+        ArchiveManager::getSingleton().addArchiveFactory(factory);
+
         // Load Ogre plugins
         Ogre::StringVector pluginList = ConfigurationManager::getSingleton().getPluginList();
         for (Ogre::StringVector::const_iterator it = pluginList.begin(); it < pluginList.end(); it++)



From timm at mail.berlios.de  Thu Jul 10 11:08:01 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Thu, 10 Jul 2008 11:08:01 +0200
Subject: [Dsa-hl-svn] r4442 - in rl/trunk/engine/core: include src
Message-ID: <200807100908.m6A981ej006076@sheep.berlios.de>

Author: timm
Date: 2008-07-10 11:07:56 +0200 (Thu, 10 Jul 2008)
New Revision: 4442

Added:
   rl/trunk/engine/core/include/SaveAble.h
   rl/trunk/engine/core/include/SaveAbleCollection.h
   rl/trunk/engine/core/include/SaveAbleFactory.h
   rl/trunk/engine/core/include/SaveAbleManager.h
   rl/trunk/engine/core/src/SaveAble.cpp
   rl/trunk/engine/core/src/SaveAbleCollection.cpp
   rl/trunk/engine/core/src/SaveAbleFactory.cpp
   rl/trunk/engine/core/src/SaveAbleManager.cpp
Log:
committed missing files (just empty)

Added: rl/trunk/engine/core/include/SaveAble.h
===================================================================
--- rl/trunk/engine/core/include/SaveAble.h	2008-07-10 08:49:42 UTC (rev 4441)
+++ rl/trunk/engine/core/include/SaveAble.h	2008-07-10 09:07:56 UTC (rev 4442)
@@ -0,0 +1,15 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
\ No newline at end of file

Added: rl/trunk/engine/core/include/SaveAbleCollection.h
===================================================================

Added: rl/trunk/engine/core/include/SaveAbleFactory.h
===================================================================

Added: rl/trunk/engine/core/include/SaveAbleManager.h
===================================================================

Added: rl/trunk/engine/core/src/SaveAble.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveAble.cpp	2008-07-10 08:49:42 UTC (rev 4441)
+++ rl/trunk/engine/core/src/SaveAble.cpp	2008-07-10 09:07:56 UTC (rev 4442)
@@ -0,0 +1,31 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+
+#include "stdinc.h" //precompiled header
+
+#include "SaveAble.h"
+
+#include "Property.h"
+#include "Properties.h"
+
+class SaveAble
+{
+public:
+    void setSaveAble(bool enable);
+    bool isSaveAble();
+protected:
+    bool mIsSaveAble;
+};
\ No newline at end of file

Added: rl/trunk/engine/core/src/SaveAbleCollection.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveAbleCollection.cpp	2008-07-10 08:49:42 UTC (rev 4441)
+++ rl/trunk/engine/core/src/SaveAbleCollection.cpp	2008-07-10 09:07:56 UTC (rev 4442)
@@ -0,0 +1,17 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h"
\ No newline at end of file

Added: rl/trunk/engine/core/src/SaveAbleFactory.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveAbleFactory.cpp	2008-07-10 08:49:42 UTC (rev 4441)
+++ rl/trunk/engine/core/src/SaveAbleFactory.cpp	2008-07-10 09:07:56 UTC (rev 4442)
@@ -0,0 +1,17 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h"
\ No newline at end of file

Added: rl/trunk/engine/core/src/SaveAbleManager.cpp
===================================================================
--- rl/trunk/engine/core/src/SaveAbleManager.cpp	2008-07-10 08:49:42 UTC (rev 4441)
+++ rl/trunk/engine/core/src/SaveAbleManager.cpp	2008-07-10 09:07:56 UTC (rev 4442)
@@ -0,0 +1,17 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h"
\ No newline at end of file



From timm at mail.berlios.de  Thu Jul 10 11:13:09 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Thu, 10 Jul 2008 11:13:09 +0200
Subject: [Dsa-hl-svn] r4443 - in rl/trunk/engine: common/include common/src
	core/include core/src
Message-ID: <200807100913.m6A9D9s9006580@sheep.berlios.de>

Author: timm
Date: 2008-07-10 11:13:03 +0200 (Thu, 10 Jul 2008)
New Revision: 4443

Modified:
   rl/trunk/engine/common/include/Makefile.am
   rl/trunk/engine/common/src/Makefile.am
   rl/trunk/engine/core/include/Makefile.am
   rl/trunk/engine/core/src/Makefile.am
Log:
updated Linux makefiles

Modified: rl/trunk/engine/common/include/Makefile.am
===================================================================
--- rl/trunk/engine/common/include/Makefile.am	2008-07-10 09:07:56 UTC (rev 4442)
+++ rl/trunk/engine/common/include/Makefile.am	2008-07-10 09:13:03 UTC (rev 4443)
@@ -18,6 +18,9 @@
     ScriptWrapper.h \
 	Sleep.h \
 	Tripel.h \
+	WriteableDataStream.h \
+	WriteableDataStreamFormatTarget.h \
+	WriteableFileSystemArchiv.h \
 	XmlProcessor.h \
     XmlPropertyReader.h \
 	XmlPropertyWriter.h \

Modified: rl/trunk/engine/common/src/Makefile.am
===================================================================
--- rl/trunk/engine/common/src/Makefile.am	2008-07-10 09:07:56 UTC (rev 4442)
+++ rl/trunk/engine/common/src/Makefile.am	2008-07-10 09:13:03 UTC (rev 4443)
@@ -14,6 +14,9 @@
   Properties.cpp \
   Property.cpp \
   ScriptWrapper.cpp \
+  WriteableDataStream.cpp \
+  WriteableDataStreamFormatTarget.cpp \
+  WriteableFileSystemArchiv.cpp \
   XmlProcessor.cpp \
   XmlPropertyReader.cpp \
   XmlPropertyWriter.cpp \

Modified: rl/trunk/engine/core/include/Makefile.am
===================================================================
--- rl/trunk/engine/core/include/Makefile.am	2008-07-10 09:07:56 UTC (rev 4442)
+++ rl/trunk/engine/core/include/Makefile.am	2008-07-10 09:13:03 UTC (rev 4443)
@@ -55,6 +55,10 @@
 	PrimitiveObject.h \
 	QuadTree.h \
 	RubyInterpreter.h \
+	SaveAble.h \
+	SaveAbleCollection.h \
+	SaveAbleFactory.h \
+	SaveAbleManager.h \
 	SaveGameFile.h \
 	SaveGameFileReader.h \
 	SaveGameFileWriter.h \

Modified: rl/trunk/engine/core/src/Makefile.am
===================================================================
--- rl/trunk/engine/core/src/Makefile.am	2008-07-10 09:07:56 UTC (rev 4442)
+++ rl/trunk/engine/core/src/Makefile.am	2008-07-10 09:13:03 UTC (rev 4443)
@@ -54,6 +54,10 @@
 	PolynomicSoundFadeFunctor.cpp \
 	PrimitiveObject.cpp \
 	RubyInterpreter.cpp \
+	SaveAble.cpp \
+	SaveAbleCollection.cpp \
+	SaveAbleFactory.cpp \
+	SaveAbleManager.cpp \
 	SaveGameFile.cpp \
 	SaveGameFileReader.cpp \
 	SaveGameFileWriter.cpp \



From timm at mail.berlios.de  Thu Jul 10 11:47:01 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Thu, 10 Jul 2008 11:47:01 +0200
Subject: [Dsa-hl-svn] r4444 - rl/trunk/engine/common/src
Message-ID: <200807100947.m6A9l1Tn010121@sheep.berlios.de>

Author: timm
Date: 2008-07-10 11:46:59 +0200 (Thu, 10 Jul 2008)
New Revision: 4444

Modified:
   rl/trunk/engine/common/src/WriteableDataStreamFormatTarget.cpp
Log:
WriteableDataStreamFormatTarget can write and flush now

Modified: rl/trunk/engine/common/src/WriteableDataStreamFormatTarget.cpp
===================================================================
--- rl/trunk/engine/common/src/WriteableDataStreamFormatTarget.cpp	2008-07-10 09:13:03 UTC (rev 4443)
+++ rl/trunk/engine/common/src/WriteableDataStreamFormatTarget.cpp	2008-07-10 09:46:59 UTC (rev 4444)
@@ -27,9 +27,11 @@
 
     void WriteableDataStreamFormatTarget::writeChars (const XMLByte *const toWrite, const unsigned int count, XERCES_CPP_NAMESPACE::XMLFormatter *const formatter)
     {
+        mStream->write((char*)toWrite, count);
     }
 
     void WriteableDataStreamFormatTarget::flush ()
     {
+        mStream->flush();
     }
 }
\ No newline at end of file



From blakharaz at mail.berlios.de  Fri Jul 11 21:42:41 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Fri, 11 Jul 2008 21:42:41 +0200
Subject: [Dsa-hl-svn] r4445 - in rl/trunk/engine/common: include src
Message-ID: <200807111942.m6BJgfUF008358@sheep.berlios.de>

Author: blakharaz
Date: 2008-07-11 21:42:39 +0200 (Fri, 11 Jul 2008)
New Revision: 4445

Modified:
   rl/trunk/engine/common/include/WriteableDataStream.h
   rl/trunk/engine/common/include/WriteableFileSystemArchiv.h
   rl/trunk/engine/common/src/WriteableFileSystemArchiv.cpp
Log:
Make the WriteableDataStream changes compile on Mac OS X

Modified: rl/trunk/engine/common/include/WriteableDataStream.h
===================================================================
--- rl/trunk/engine/common/include/WriteableDataStream.h	2008-07-10 09:46:59 UTC (rev 4444)
+++ rl/trunk/engine/common/include/WriteableDataStream.h	2008-07-11 19:42:39 UTC (rev 4445)
@@ -16,7 +16,6 @@
 
 #include "CommonPrerequisites.h"
 
-#include <OgreDataStream.h>
 #include <iostream>
 
 namespace rl

Modified: rl/trunk/engine/common/include/WriteableFileSystemArchiv.h
===================================================================
--- rl/trunk/engine/common/include/WriteableFileSystemArchiv.h	2008-07-10 09:46:59 UTC (rev 4444)
+++ rl/trunk/engine/common/include/WriteableFileSystemArchiv.h	2008-07-11 19:42:39 UTC (rev 4445)
@@ -1,60 +1,64 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
-*
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#ifndef __WriteableFileSystemArchive_H__
-#define __WriteableFileSystemArchive_H__
-
-#include "CommonPrerequisites.h"
-
-#include "OgreFileSystem.h"
-
-namespace rl {
-
-    /** Specialisation of the Archive class to allow reading of files from 
-        filesystem folders / directories.
-    */
-    class _RlCommonExport WriteableFileSystemArchive : public Ogre::FileSystemArchive 
-    {
-    protected:
-    public:
-        WriteableFileSystemArchive(const Ogre::String& name, const Ogre::String& archType );
-        virtual ~WriteableFileSystemArchive();
-
-        /// @copydoc Archive::open
-        Ogre::DataStreamPtr open(const Ogre::String& filename) const;
-    };
-
-    /** Specialisation of ArchiveFactory for FileSystem files. */
-    //class _OgrePrivate WriteableFileSystemArchiveFactory : public ArchiveFactory
-    class _RlCommonExport WriteableFileSystemArchiveFactory : public Ogre::ArchiveFactory
-    {
-    public:
-        virtual ~WriteableFileSystemArchiveFactory() {}
-        /// @copydoc FactoryObj::getType
-        const Ogre::String& getType(void) const;
-        /// @copydoc FactoryObj::createInstance
-        Ogre::Archive *createInstance( const Ogre::String& name ) 
-        {
-            return new WriteableFileSystemArchive(name, "WriteableFileSystem");
-        }
-        /// @copydoc FactoryObj::destroyInstance
-        void destroyInstance( Ogre::Archive* arch) { delete arch; }
-    };
-
-
-}
-
-#endif
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#ifndef __WriteableFileSystemArchive_H__
+#define __WriteableFileSystemArchive_H__
+
+#include "CommonPrerequisites.h"
+
+#ifdef __APPLE__
+#include <Ogre/OgreFileSystem.h>
+#else
+#include <OgreFileSystem.h>
+#endif
+
+namespace rl {
+
+    /** Specialisation of the Archive class to allow reading of files from 
+        filesystem folders / directories.
+    */
+    class _RlCommonExport WriteableFileSystemArchive : public Ogre::FileSystemArchive 
+    {
+    protected:
+    public:
+        WriteableFileSystemArchive(const Ogre::String& name, const Ogre::String& archType );
+        virtual ~WriteableFileSystemArchive();
+
+        /// @copydoc Archive::open
+        Ogre::DataStreamPtr open(const Ogre::String& filename) const;
+    };
+
+    /** Specialisation of ArchiveFactory for FileSystem files. */
+    //class _OgrePrivate WriteableFileSystemArchiveFactory : public ArchiveFactory
+    class _RlCommonExport WriteableFileSystemArchiveFactory : public Ogre::ArchiveFactory
+    {
+    public:
+        virtual ~WriteableFileSystemArchiveFactory() {}
+        /// @copydoc FactoryObj::getType
+        const Ogre::String& getType(void) const;
+        /// @copydoc FactoryObj::createInstance
+        Ogre::Archive *createInstance( const Ogre::String& name ) 
+        {
+            return new WriteableFileSystemArchive(name, "WriteableFileSystem");
+        }
+        /// @copydoc FactoryObj::destroyInstance
+        void destroyInstance( Ogre::Archive* arch) { delete arch; }
+    };
+
+
+}
+
+#endif

Modified: rl/trunk/engine/common/src/WriteableFileSystemArchiv.cpp
===================================================================
--- rl/trunk/engine/common/src/WriteableFileSystemArchiv.cpp	2008-07-10 09:46:59 UTC (rev 4444)
+++ rl/trunk/engine/common/src/WriteableFileSystemArchiv.cpp	2008-07-11 19:42:39 UTC (rev 4445)
@@ -1,114 +1,108 @@
-/* This source file is part of Rastullahs Lockenpracht.
-* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
-*
-*  This program is free software; you can redistribute it and/or modify
-*  it under the terms of the Clarified Artistic License.
-*
-*  This program is distributed in the hope that it will be useful,
-*  but WITHOUT ANY WARRANTY; without even the implied warranty of
-*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
-*  Clarified Artistic License for more details.
-*
-*  You should have received a copy of the Clarified Artistic License
-*  along with this program; if not you can get it here
-*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
-*/
-
-#include "stdinc.h"
-
-#include "OgreStableHeaders.h"
-#include "OgreLogManager.h"
-#include "OgreException.h"
-#include "OgreStringVector.h"
-#include "OgreRoot.h"
-
-#include <sys/types.h>
-#include <sys/stat.h>
-
-#if OGRE_PLATFORM == OGRE_PLATFORM_LINUX || OGRE_PLATFORM == OGRE_PLATFORM_APPLE
-#   include "OgreSearchOps.h"
-#   include <sys/param.h>
-#   define MAX_PATH MAXPATHLEN
-#endif
-
-#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
-#   include <windows.h>
-#   include <direct.h>
-#   include <io.h>
-#endif
-
-#include "WriteableFileSystemArchiv.h"
-#include "WriteableFileStreamDataStream.h"
-
-using namespace Ogre;
-
-namespace rl 
-{
-    static bool is_reserved_dir (const char *fn)
-    {
-        return (fn [0] == '.' && (fn [1] == 0 || (fn [1] == '.' && fn [2] == 0)));
-    }
-
-    static bool is_absolute_path(const char* path)
-    {
-#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
-        if (isalpha(uchar(path[0])) && path[1] == ':')
-            return true;
-#endif
-        return path[0] == '/' || path[0] == '\\';
-    }
-
-    static String concatenate_path(const String& base, const String& name)
-    {
-        if (base.empty() || is_absolute_path(name.c_str()))
-            return name;
-        else
-            return base + '/' + name;
-    }
-
-
-
-    WriteableFileSystemArchive::WriteableFileSystemArchive(const Ogre::String& name, const Ogre::String& archType ) : Ogre::FileSystemArchive(name, archType)
-    {
-    }
-
-    WriteableFileSystemArchive::~WriteableFileSystemArchive()
-    {
-    }
-
-    DataStreamPtr WriteableFileSystemArchive::open(const String& filename) const
-    {
-        String full_path = concatenate_path(mName, filename);
-
-        // Use filesystem to determine size 
-        // (quicker than streaming to the end and back)
-        struct stat tagStat;
-	int ret = stat(full_path.c_str(), &tagStat);
-        assert(ret == 0 && "Problem getting file size" );
-
-        // Always open in binary mode
-        std::fstream *origStream = new std::fstream();
-        origStream->open(full_path.c_str(), std::ios::in | std::ios::out | std::ios::binary);
-
-        // Should check ensure open succeeded, in case fail for some reason.
-        if (origStream->fail())
-        {
-            delete origStream;
-            OGRE_EXCEPT(Exception::ERR_FILE_NOT_FOUND,
-                "Cannot open file: " + filename,
-                "WriteableFileSystemArchive::open");
-        }
-
-        /// Construct return stream, tell it to delete on destroy
-        WriteableFileStreamDataStream* stream = new WriteableFileStreamDataStream(filename,
-            origStream, tagStat.st_size, true);
-        return DataStreamPtr(stream);
-    }
-    
-    const String& WriteableFileSystemArchiveFactory::getType(void) const
-    {
-        static String name = "FileSystem";
-        return name;
-    }
-
-}
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h"
+
+#include <sys/types.h>
+#include <sys/stat.h>
+
+#include "WriteableFileSystemArchiv.h"
+
+#if OGRE_PLATFORM == OGRE_PLATFORM_LINUX || OGRE_PLATFORM == OGRE_PLATFORM_APPLE
+#   include <sys/param.h>
+#   define MAX_PATH MAXPATHLEN
+#endif
+
+#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
+#   include <windows.h>
+#   include <direct.h>
+#   include <io.h>
+#endif
+
+#include "WriteableDataStream.h"
+
+using namespace Ogre;
+
+namespace rl 
+{
+    static bool is_reserved_dir (const char *fn)
+    {
+        return (fn [0] == '.' && (fn [1] == 0 || (fn [1] == '.' && fn [2] == 0)));
+    }
+
+    static bool is_absolute_path(const char* path)
+    {
+#if OGRE_PLATFORM == OGRE_PLATFORM_WIN32
+        if (isalpha(uchar(path[0])) && path[1] == ':')
+            return true;
+#endif
+        return path[0] == '/' || path[0] == '\\';
+    }
+
+    static String concatenate_path(const String& base, const String& name)
+    {
+        if (base.empty() || is_absolute_path(name.c_str()))
+            return name;
+        else
+            return base + '/' + name;
+    }
+
+
+
+    WriteableFileSystemArchive::WriteableFileSystemArchive(const Ogre::String& name, const Ogre::String& archType ) : Ogre::FileSystemArchive(name, archType)
+    {
+    }
+
+    WriteableFileSystemArchive::~WriteableFileSystemArchive()
+    {
+    }
+
+    DataStreamPtr WriteableFileSystemArchive::open(const String& filename) const
+    {
+        String full_path = concatenate_path(mName, filename);
+
+        // Use filesystem to determine size 
+        // (quicker than streaming to the end and back)
+        struct stat tagStat;
+	int ret = stat(full_path.c_str(), &tagStat);
+        assert(ret == 0 && "Problem getting file size" );
+
+        // Always open in binary mode
+        std::fstream *origStream = new std::fstream();
+        origStream->open(full_path.c_str(), std::ios::in | std::ios::out | std::ios::binary);
+
+        // Should check ensure open succeeded, in case fail for some reason.
+        if (origStream->fail())
+        {
+            delete origStream;
+            OGRE_EXCEPT(Exception::ERR_FILE_NOT_FOUND,
+                "Cannot open file: " + filename,
+                "WriteableFileSystemArchive::open");
+        }
+
+        /// Construct return stream, tell it to delete on destroy
+        WriteableFileStreamDataStream* stream = new WriteableFileStreamDataStream(filename,
+            origStream, tagStat.st_size, true);
+        return DataStreamPtr(stream);
+    }
+    
+    const String& WriteableFileSystemArchiveFactory::getType(void) const
+    {
+        static String name = "FileSystem";
+        return name;
+    }
+
+}



From blakharaz at mail.berlios.de  Fri Jul 11 21:59:43 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Fri, 11 Jul 2008 21:59:43 +0200
Subject: [Dsa-hl-svn] r4446 - in rl/trunk: Mac/Rastullah.xcodeproj
	engine/ai/include engine/ai/src
Message-ID: <200807111959.m6BJxhYS010677@sheep.berlios.de>

Author: blakharaz
Date: 2008-07-11 21:59:08 +0200 (Fri, 11 Jul 2008)
New Revision: 4446

Added:
   rl/trunk/engine/ai/include/DialogLoader.h
   rl/trunk/engine/ai/src/DialogLoader.cpp
Modified:
   rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj
   rl/trunk/engine/ai/include/DialogManager.h
   rl/trunk/engine/ai/include/Makefile.am
   rl/trunk/engine/ai/src/AiSubsystem.cpp
   rl/trunk/engine/ai/src/DialogManager.cpp
   rl/trunk/engine/ai/src/Makefile.am
Log:
Extracted DialogLoader from DialogManager 

Modified: rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj
===================================================================
--- rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj	2008-07-11 19:42:39 UTC (rev 4445)
+++ rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj	2008-07-11 19:59:08 UTC (rev 4446)
@@ -666,6 +666,22 @@
 		48B772E50D583521000A3B97 /* XmlPropertyWriter.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48B772E20D583521000A3B97 /* XmlPropertyWriter.cpp */; };
 		48D0BDC70E23375E00863824 /* libruby.dylib in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 483646A10D83D57800912FEC /* libruby.dylib */; };
 		48D0BDE60E23378700863824 /* libboost_filesystem.dylib in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52B210E0EDA0E008DBDD8 /* libboost_filesystem.dylib */; };
+		48D0BE2C0E273C5E00863824 /* SaveAble.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D0BE280E273C5E00863824 /* SaveAble.h */; };
+		48D0BE2D0E273C5E00863824 /* SaveAbleCollection.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D0BE290E273C5E00863824 /* SaveAbleCollection.h */; };
+		48D0BE2E0E273C5E00863824 /* SaveAbleFactory.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D0BE2A0E273C5E00863824 /* SaveAbleFactory.h */; };
+		48D0BE2F0E273C5E00863824 /* SaveAbleManager.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D0BE2B0E273C5E00863824 /* SaveAbleManager.h */; };
+		48D0BE330E273C8000863824 /* WriteableDataStream.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D0BE300E273C8000863824 /* WriteableDataStream.h */; };
+		48D0BE340E273C8000863824 /* WriteableDataStreamFormatTarget.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D0BE310E273C8000863824 /* WriteableDataStreamFormatTarget.h */; };
+		48D0BE350E273C8000863824 /* WriteableFileSystemArchiv.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D0BE320E273C8000863824 /* WriteableFileSystemArchiv.h */; };
+		48D0BE390E273C9700863824 /* WriteableDataStream.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D0BE360E273C9700863824 /* WriteableDataStream.cpp */; };
+		48D0BE3A0E273C9700863824 /* WriteableDataStreamFormatTarget.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D0BE370E273C9700863824 /* WriteableDataStreamFormatTarget.cpp */; };
+		48D0BE3B0E273C9700863824 /* WriteableFileSystemArchiv.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D0BE380E273C9700863824 /* WriteableFileSystemArchiv.cpp */; };
+		48D0BE400E273CB000863824 /* SaveAble.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D0BE3C0E273CB000863824 /* SaveAble.cpp */; };
+		48D0BE410E273CB000863824 /* SaveAbleCollection.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D0BE3D0E273CB000863824 /* SaveAbleCollection.cpp */; };
+		48D0BE420E273CB000863824 /* SaveAbleFactory.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D0BE3E0E273CB000863824 /* SaveAbleFactory.cpp */; };
+		48D0BE430E273CB000863824 /* SaveAbleManager.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D0BE3F0E273CB000863824 /* SaveAbleManager.cpp */; };
+		48D0BE690E273FF400863824 /* DialogLoader.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D0BE680E273FF400863824 /* DialogLoader.h */; };
+		48D0BE6D0E27401E00863824 /* DialogLoader.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D0BE6B0E27401E00863824 /* DialogLoader.cpp */; };
 		48D34A630D90F5D500C89477 /* SaveGameData.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D34A610D90F5D500C89477 /* SaveGameData.h */; };
 		48D34A640D90F5D500C89477 /* SaveGameData.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48D34A620D90F5D500C89477 /* SaveGameData.cpp */; };
 		48D34A7D0D91C7D800C89477 /* SaveGameFile.h in Headers */ = {isa = PBXBuildFile; fileRef = 485A056E0D71EDC40024198D /* SaveGameFile.h */; };
@@ -1457,6 +1473,22 @@
 		48B772E00D583521000A3B97 /* XmlProcessor.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = XmlProcessor.cpp; path = ../engine/common/src/XmlProcessor.cpp; sourceTree = SOURCE_ROOT; };
 		48B772E10D583521000A3B97 /* XmlPropertyReader.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = XmlPropertyReader.cpp; path = ../engine/common/src/XmlPropertyReader.cpp; sourceTree = SOURCE_ROOT; };
 		48B772E20D583521000A3B97 /* XmlPropertyWriter.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = XmlPropertyWriter.cpp; path = ../engine/common/src/XmlPropertyWriter.cpp; sourceTree = SOURCE_ROOT; };
+		48D0BE280E273C5E00863824 /* SaveAble.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = SaveAble.h; path = ../engine/core/include/SaveAble.h; sourceTree = SOURCE_ROOT; };
+		48D0BE290E273C5E00863824 /* SaveAbleCollection.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = SaveAbleCollection.h; path = ../engine/core/include/SaveAbleCollection.h; sourceTree = SOURCE_ROOT; };
+		48D0BE2A0E273C5E00863824 /* SaveAbleFactory.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = SaveAbleFactory.h; path = ../engine/core/include/SaveAbleFactory.h; sourceTree = SOURCE_ROOT; };
+		48D0BE2B0E273C5E00863824 /* SaveAbleManager.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = SaveAbleManager.h; path = ../engine/core/include/SaveAbleManager.h; sourceTree = SOURCE_ROOT; };
+		48D0BE300E273C8000863824 /* WriteableDataStream.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = WriteableDataStream.h; path = ../engine/common/include/WriteableDataStream.h; sourceTree = SOURCE_ROOT; };
+		48D0BE310E273C8000863824 /* WriteableDataStreamFormatTarget.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = WriteableDataStreamFormatTarget.h; path = ../engine/common/include/WriteableDataStreamFormatTarget.h; sourceTree = SOURCE_ROOT; };
+		48D0BE320E273C8000863824 /* WriteableFileSystemArchiv.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = WriteableFileSystemArchiv.h; path = ../engine/common/include/WriteableFileSystemArchiv.h; sourceTree = SOURCE_ROOT; };
+		48D0BE360E273C9700863824 /* WriteableDataStream.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = WriteableDataStream.cpp; path = ../engine/common/src/WriteableDataStream.cpp; sourceTree = SOURCE_ROOT; };
+		48D0BE370E273C9700863824 /* WriteableDataStreamFormatTarget.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = WriteableDataStreamFormatTarget.cpp; path = ../engine/common/src/WriteableDataStreamFormatTarget.cpp; sourceTree = SOURCE_ROOT; };
+		48D0BE380E273C9700863824 /* WriteableFileSystemArchiv.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = WriteableFileSystemArchiv.cpp; path = ../engine/common/src/WriteableFileSystemArchiv.cpp; sourceTree = SOURCE_ROOT; };
+		48D0BE3C0E273CB000863824 /* SaveAble.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = SaveAble.cpp; path = ../engine/core/src/SaveAble.cpp; sourceTree = SOURCE_ROOT; };
+		48D0BE3D0E273CB000863824 /* SaveAbleCollection.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = SaveAbleCollection.cpp; path = ../engine/core/src/SaveAbleCollection.cpp; sourceTree = SOURCE_ROOT; };
+		48D0BE3E0E273CB000863824 /* SaveAbleFactory.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = SaveAbleFactory.cpp; path = ../engine/core/src/SaveAbleFactory.cpp; sourceTree = SOURCE_ROOT; };
+		48D0BE3F0E273CB000863824 /* SaveAbleManager.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = SaveAbleManager.cpp; path = ../engine/core/src/SaveAbleManager.cpp; sourceTree = SOURCE_ROOT; };
+		48D0BE680E273FF400863824 /* DialogLoader.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = DialogLoader.h; path = ../engine/ai/include/DialogLoader.h; sourceTree = SOURCE_ROOT; };
+		48D0BE6B0E27401E00863824 /* DialogLoader.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = DialogLoader.cpp; path = ../engine/ai/src/DialogLoader.cpp; sourceTree = SOURCE_ROOT; };
 		48D34A610D90F5D500C89477 /* SaveGameData.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = SaveGameData.h; path = ../engine/core/include/SaveGameData.h; sourceTree = SOURCE_ROOT; };
 		48D34A620D90F5D500C89477 /* SaveGameData.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = SaveGameData.cpp; path = ../engine/core/src/SaveGameData.cpp; sourceTree = SOURCE_ROOT; };
 		48D401810D9E483200AE5340 /* modules */ = {isa = PBXFileReference; lastKnownFileType = folder; name = modules; path = ../../../modules; sourceTree = SOURCE_ROOT; };
@@ -1692,6 +1724,12 @@
 		444EAB1F0BD0E25C00C6D4A0 /* RlCommon */ = {
 			isa = PBXGroup;
 			children = (
+				48D0BE360E273C9700863824 /* WriteableDataStream.cpp */,
+				48D0BE370E273C9700863824 /* WriteableDataStreamFormatTarget.cpp */,
+				48D0BE380E273C9700863824 /* WriteableFileSystemArchiv.cpp */,
+				48D0BE300E273C8000863824 /* WriteableDataStream.h */,
+				48D0BE310E273C8000863824 /* WriteableDataStreamFormatTarget.h */,
+				48D0BE320E273C8000863824 /* WriteableFileSystemArchiv.h */,
 				485A056A0D71EDC40024198D /* MessageObject.h */,
 				485A057E0D71EDF20024198D /* MessagePump.cpp */,
 				485A056B0D71EDC40024198D /* MessagePump.h */,
@@ -1742,6 +1780,14 @@
 		444EAB200BD0E27400C6D4A0 /* RlCore */ = {
 			isa = PBXGroup;
 			children = (
+				48D0BE3C0E273CB000863824 /* SaveAble.cpp */,
+				48D0BE3D0E273CB000863824 /* SaveAbleCollection.cpp */,
+				48D0BE3E0E273CB000863824 /* SaveAbleFactory.cpp */,
+				48D0BE3F0E273CB000863824 /* SaveAbleManager.cpp */,
+				48D0BE280E273C5E00863824 /* SaveAble.h */,
+				48D0BE290E273C5E00863824 /* SaveAbleCollection.h */,
+				48D0BE2A0E273C5E00863824 /* SaveAbleFactory.h */,
+				48D0BE2B0E273C5E00863824 /* SaveAbleManager.h */,
 				485A05860D71EDF20024198D /* Trigger.cpp */,
 				48389C100D86798600AFAB66 /* SoundStitchingObject.cpp */,
 				48389C0E0D86797000AFAB66 /* SoundStitchingObject.h */,
@@ -1976,6 +2022,8 @@
 				444EAC680BD0E52E00C6D4A0 /* WayPointGraph.cpp */,
 				444EAC690BD0E52E00C6D4A0 /* WayPointGraphManager.cpp */,
 				444EAC6A0BD0E52E00C6D4A0 /* WayPointNode.cpp */,
+				48D0BE680E273FF400863824 /* DialogLoader.h */,
+				48D0BE6B0E27401E00863824 /* DialogLoader.cpp */,
 			);
 			name = RlAi;
 			sourceTree = "<group>";
@@ -2388,6 +2436,9 @@
 				485A05740D71EDC40024198D /* MessageObject.h in Headers */,
 				485A05750D71EDC40024198D /* MessagePump.h in Headers */,
 				485A05760D71EDC40024198D /* MessageType.h in Headers */,
+				48D0BE330E273C8000863824 /* WriteableDataStream.h in Headers */,
+				48D0BE340E273C8000863824 /* WriteableDataStreamFormatTarget.h in Headers */,
+				48D0BE350E273C8000863824 /* WriteableFileSystemArchiv.h in Headers */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
@@ -2476,6 +2527,10 @@
 				48D34A7F0D91C7D800C89477 /* SaveGameFileReader.h in Headers */,
 				48D34A800D91C7D800C89477 /* SaveGameFileWriter.h in Headers */,
 				48D34A810D91C7D800C89477 /* SaveGameManager.h in Headers */,
+				48D0BE2C0E273C5E00863824 /* SaveAble.h in Headers */,
+				48D0BE2D0E273C5E00863824 /* SaveAbleCollection.h in Headers */,
+				48D0BE2E0E273C5E00863824 /* SaveAbleFactory.h in Headers */,
+				48D0BE2F0E273C5E00863824 /* SaveAbleManager.h in Headers */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
@@ -2521,6 +2576,7 @@
 				483D31620D85B398003477A0 /* DialogVariable.h in Headers */,
 				483D31630D85B398003477A0 /* SimpleVehicle.h in Headers */,
 				483D31640D85B398003477A0 /* WalkPathBehaviour.h in Headers */,
+				48D0BE690E273FF400863824 /* DialogLoader.h in Headers */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
@@ -2992,6 +3048,9 @@
 				48B772E40D583521000A3B97 /* XmlPropertyReader.cpp in Sources */,
 				48B772E50D583521000A3B97 /* XmlPropertyWriter.cpp in Sources */,
 				485A05880D71EDF20024198D /* MessagePump.cpp in Sources */,
+				48D0BE390E273C9700863824 /* WriteableDataStream.cpp in Sources */,
+				48D0BE3A0E273C9700863824 /* WriteableDataStreamFormatTarget.cpp in Sources */,
+				48D0BE3B0E273C9700863824 /* WriteableFileSystemArchiv.cpp in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
@@ -3072,6 +3131,10 @@
 				48389C290D867B1A00AFAB66 /* Trigger.cpp in Sources */,
 				48389C2C0D867B2A00AFAB66 /* PolynomicSoundFadeFunctor.cpp in Sources */,
 				48D34A640D90F5D500C89477 /* SaveGameData.cpp in Sources */,
+				48D0BE400E273CB000863824 /* SaveAble.cpp in Sources */,
+				48D0BE410E273CB000863824 /* SaveAbleCollection.cpp in Sources */,
+				48D0BE420E273CB000863824 /* SaveAbleFactory.cpp in Sources */,
+				48D0BE430E273CB000863824 /* SaveAbleManager.cpp in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};
@@ -3113,6 +3176,7 @@
 				48389BC00D8675E700AFAB66 /* DialogParagraph.cpp in Sources */,
 				48389BC10D8675E700AFAB66 /* DialogResponse.cpp in Sources */,
 				48389BC20D8675E700AFAB66 /* DialogVariable.cpp in Sources */,
+				48D0BE6D0E27401E00863824 /* DialogLoader.cpp in Sources */,
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 		};

Added: rl/trunk/engine/ai/include/DialogLoader.h
===================================================================
--- rl/trunk/engine/ai/include/DialogLoader.h	2008-07-11 19:42:39 UTC (rev 4445)
+++ rl/trunk/engine/ai/include/DialogLoader.h	2008-07-11 19:59:08 UTC (rev 4446)
@@ -0,0 +1,95 @@
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+#ifndef __DialogLoader_H__
+#define __DialogLoader_H__
+
+#include "AiPrerequisites.h"
+
+#include "Properties.h"
+#include "XmlProcessor.h"
+ 
+namespace rl 
+{
+	class Creature;
+    class Dialog;
+    class DialogCondition;
+    class DialogElement;
+    class DialogImplication;
+    class DialogOption;
+    class DialogParagraph;
+    class DialogResponse;
+    class DialogVariable;
+	class Property;
+
+
+	class DialogLoader : public Ogre::ScriptLoader, private XmlProcessor
+	{
+	public:
+		DialogLoader();
+		~DialogLoader();
+	
+		virtual const Ogre::StringVector& getScriptPatterns() const;
+        virtual void parseScript(Ogre::DataStreamPtr& stream, const Ogre::String& groupName);
+		virtual Ogre::Real getLoadingOrder() const;
+		
+		Dialog* createDialog(const Ogre::String& name, const std::vector<Creature*>& pcs, const std::vector<Creature*>& npcs) const;
+
+	private: 
+		class DialogPrototype
+        {
+        public:
+            DialogPrototype();
+            ~DialogPrototype();
+            void addOption(DialogOption* option);
+            DialogOption* getOption(const CeGuiString& id) const;
+            void addResponse(DialogResponse* option);
+            DialogResponse* getResponse(const CeGuiString& id) const;
+
+            void setStartResponse(DialogResponse* response);
+            Dialog* createDialog(const std::vector<Creature*>& pcs, const std::vector<Creature*>& npcs);
+            void setProperty(const CeGuiString& key, const Property& value);
+
+        private:
+            std::map<CeGuiString, DialogOption*> mOptionCache;
+            std::map<CeGuiString, DialogResponse*> mResponseCache;
+            DialogResponse* mDialogStart;
+            PropertyRecord mPropertyVariables;
+        };
+		
+        void processDialog(XERCES_CPP_NAMESPACE::DOMElement* dialogXml);
+        DialogResponse* processResponseClasses(XERCES_CPP_NAMESPACE::DOMNode *node, DialogPrototype* dialogPrototype);
+        DialogResponse* processResponse(XERCES_CPP_NAMESPACE::DOMElement* responseXml, DialogPrototype* dialogPrototype, bool subelements);
+        DialogResponse* processSwitchResponse(XERCES_CPP_NAMESPACE::DOMElement* switchRespXml, DialogPrototype* dialogPrototype);
+        DialogOption* processOptionClasses(XERCES_CPP_NAMESPACE::DOMNode *node, DialogPrototype *dialogPrototype);
+        DialogOption* processOption(XERCES_CPP_NAMESPACE::DOMElement* optionXml, DialogPrototype* dialogPrototype, bool subelements);
+        DialogOption* processSwitchOption(XERCES_CPP_NAMESPACE::DOMElement* switchOptXml, DialogPrototype* dialogPrototype);
+        DialogCondition* processIf(XERCES_CPP_NAMESPACE::DOMElement *ifXml);
+        DialogCondition* processCase(XERCES_CPP_NAMESPACE::DOMElement *caseXml);
+        DialogVariable* processVariableClasses(XERCES_CPP_NAMESPACE::DOMElement* variableXml);
+        DialogCondition* processConditionClasses(XERCES_CPP_NAMESPACE::DOMElement* conditionXml);
+        DialogParagraph* processParagraph(XERCES_CPP_NAMESPACE::DOMElement* paragraphXml);
+        DialogImplication* processImplicationClasses(XERCES_CPP_NAMESPACE::DOMNode* implicationXml);
+        void processTranslation(DialogElement* element, XERCES_CPP_NAMESPACE::DOMNode* translationXml);
+        void createDialogVariable(XERCES_CPP_NAMESPACE::DOMElement* variableXml, DialogPrototype* dialogPrototype);
+        void processElementNodes(XERCES_CPP_NAMESPACE::DOMElement* dialogXml, const Ogre::String& nodeName, DialogPrototype* dialogPrototype);
+
+        Ogre::StringVector mScriptPatterns;
+        std::map<Ogre::String, DialogPrototype*> mDialogs;
+
+	};
+}
+
+#endif //__DialogLoader_H__

Modified: rl/trunk/engine/ai/include/DialogManager.h
===================================================================
--- rl/trunk/engine/ai/include/DialogManager.h	2008-07-11 19:42:39 UTC (rev 4445)
+++ rl/trunk/engine/ai/include/DialogManager.h	2008-07-11 19:59:08 UTC (rev 4446)
@@ -1,129 +1,80 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
- */
-#ifndef __DialogManager_H__
-#define __DialogManager_H__
-
-#include "AiPrerequisites.h"
-
-#include "Properties.h"
-#include "SaveGameData.h"
-#include "XmlProcessor.h"
-
-namespace rl
-{
-    class Creature;
-    class Dialog;
-    class DialogCondition;
-    class DialogElement;
-    class DialogImplication;
-    class DialogOption;
-    class DialogParagraph;
-    class DialogResponse;
-    class DialogVariable;
-
-    class _RlAiExport DialogManager 
-        : public Ogre::Singleton<DialogManager>, 
-        public Ogre::ScriptLoader, 
-        public PropertyHolder,
-        public SaveGameData,
-        private XmlProcessor
-    {
-    public:
-        static const Ogre::String PROPERTY_DIALOGS;
-        static const Ogre::String PROPERTY_DIALOG;
-        static const Ogre::String PROPERTY_DIALOG_NAME;
-        static const Ogre::String PROPERTY_NPCS;
-
-        DialogManager();
-        ~DialogManager();
-
-        virtual const Ogre::StringVector& getScriptPatterns() const;
-        virtual void parseScript(Ogre::DataStreamPtr& stream, const Ogre::String& groupName);
-		virtual Ogre::Real getLoadingOrder() const;
-        Dialog* createDialog(const Ogre::String& name, rl::Creature* npc, rl::Creature* pc);
-        Dialog* createDialog(const Ogre::String& name, const std::vector<Creature*>& pcs, const std::vector<Creature*>& npcs);
-
-        virtual const Property getProperty(const CeGuiString& key) const;
-        virtual void setProperty(const CeGuiString& key, const Property& value);
-        virtual PropertyKeys getAllPropertyKeys() const;
-        virtual void writeData(SaveGameFileWriter *writer);
-        virtual void readData(SaveGameFileReader* reader);
-        virtual CeGuiString getXmlNodeIdentifier() const;
-        virtual int getPriority() const;
-
-    private:
-
-        class DialogPrototype
-        {
-        public:
-            DialogPrototype();
-            ~DialogPrototype();
-            void addOption(DialogOption* option);
-            DialogOption* getOption(const CeGuiString& id) const;
-            void addResponse(DialogResponse* option);
-            DialogResponse* getResponse(const CeGuiString& id) const;
-
-            void setStartResponse(DialogResponse* response);
-            Dialog* createDialog(const std::vector<Creature*>& pcs, const std::vector<Creature*>& npcs);
-            void setProperty(const CeGuiString& key, const Property& value);
-
-        private:
-            std::map<CeGuiString, DialogOption*> mOptionCache;
-            std::map<CeGuiString, DialogResponse*> mResponseCache;
-            DialogResponse* mDialogStart;
-            PropertyRecord mPropertyVariables;
-        };
-
-        class DialogConfiguration
-        {
-        public:
-            DialogConfiguration(const Ogre::String& name, const std::vector<Creature*>& npcs);
-
-            const Ogre::String& getName() const;
-            const std::vector<Creature*>& getNpcs() const;
-            
-            bool operator==(const DialogConfiguration&) const;
-            bool operator<(const DialogConfiguration&) const;
-        private:
-            Ogre::String mDialogName;
-            std::vector<Creature*> mNpcs;
-        };
-
-        void processDialog(XERCES_CPP_NAMESPACE::DOMElement* dialogXml);
-        DialogResponse* processResponseClasses(XERCES_CPP_NAMESPACE::DOMNode *node, DialogPrototype* dialogPrototype);
-        DialogResponse* processResponse(XERCES_CPP_NAMESPACE::DOMElement* responseXml, DialogPrototype* dialogPrototype, bool subelements);
-        DialogResponse* processSwitchResponse(XERCES_CPP_NAMESPACE::DOMElement* switchRespXml, DialogPrototype* dialogPrototype);
-        DialogOption* processOptionClasses(XERCES_CPP_NAMESPACE::DOMNode *node, DialogPrototype *dialogPrototype);
-        DialogOption* processOption(XERCES_CPP_NAMESPACE::DOMElement* optionXml, DialogPrototype* dialogPrototype, bool subelements);
-        DialogOption* processSwitchOption(XERCES_CPP_NAMESPACE::DOMElement* switchOptXml, DialogPrototype* dialogPrototype);
-        DialogCondition* processIf(XERCES_CPP_NAMESPACE::DOMElement *ifXml);
-        DialogCondition* processCase(XERCES_CPP_NAMESPACE::DOMElement *caseXml);
-        DialogVariable* processVariableClasses(XERCES_CPP_NAMESPACE::DOMElement* variableXml);
-        DialogCondition* processConditionClasses(XERCES_CPP_NAMESPACE::DOMElement* conditionXml);
-        DialogParagraph* processParagraph(XERCES_CPP_NAMESPACE::DOMElement* paragraphXml);
-        DialogImplication* processImplicationClasses(XERCES_CPP_NAMESPACE::DOMNode* implicationXml);
-        void processTranslation(DialogElement* element, XERCES_CPP_NAMESPACE::DOMNode* translationXml);
-        void createDialogVariable(XERCES_CPP_NAMESPACE::DOMElement* variableXml, DialogPrototype* dialogPrototype);
-        void processElementNodes(XERCES_CPP_NAMESPACE::DOMElement* dialogXml, const Ogre::String& nodeName, DialogPrototype* dialogPrototype);
-
-        Ogre::StringVector mScriptPatterns;
-        std::map<Ogre::String, DialogPrototype*> mDialogs;
-        std::map<DialogConfiguration, Dialog*> mDialogStates;
-    };
-
-}
-
-#endif // __DialogManager_H__
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+#ifndef __DialogManager_H__
+#define __DialogManager_H__
+
+#include "AiPrerequisites.h"
+
+#include "Properties.h"
+#include "SaveGameData.h"
+#include "XmlProcessor.h"
+
+namespace rl
+{
+    class Creature;
+	class Dialog;
+	class DialogLoader;
+
+    class _RlAiExport DialogManager 
+        : public Ogre::Singleton<DialogManager>, 
+        public PropertyHolder,
+        public SaveGameData
+    {
+    public:
+        static const Ogre::String PROPERTY_DIALOGS;
+        static const Ogre::String PROPERTY_DIALOG;
+        static const Ogre::String PROPERTY_DIALOG_NAME;
+        static const Ogre::String PROPERTY_NPCS;
+
+        DialogManager();
+        ~DialogManager();
+
+        Dialog* createDialog(const Ogre::String& name, rl::Creature* npc, rl::Creature* pc);
+        Dialog* createDialog(const Ogre::String& name, const std::vector<Creature*>& pcs, const std::vector<Creature*>& npcs);
+
+        virtual const Property getProperty(const CeGuiString& key) const;
+        virtual void setProperty(const CeGuiString& key, const Property& value);
+        virtual PropertyKeys getAllPropertyKeys() const;
+        virtual void writeData(SaveGameFileWriter *writer);
+        virtual void readData(SaveGameFileReader* reader);
+        virtual CeGuiString getXmlNodeIdentifier() const;
+        virtual int getPriority() const;
+
+    private:
+ 
+        class DialogConfiguration
+        {
+        public:
+            DialogConfiguration(const Ogre::String& name, const std::vector<Creature*>& npcs);
+
+            const Ogre::String& getName() const;
+            const std::vector<Creature*>& getNpcs() const;
+            
+            bool operator==(const DialogConfiguration&) const;
+            bool operator<(const DialogConfiguration&) const;
+        private:
+            Ogre::String mDialogName;
+            std::vector<Creature*> mNpcs;
+        };
+
+
+        std::map<DialogConfiguration, Dialog*> mDialogStates;
+		DialogLoader* mDialogLoader;
+    };
+
+}
+
+#endif // __DialogManager_H__

Modified: rl/trunk/engine/ai/include/Makefile.am
===================================================================
--- rl/trunk/engine/ai/include/Makefile.am	2008-07-11 19:42:39 UTC (rev 4445)
+++ rl/trunk/engine/ai/include/Makefile.am	2008-07-11 19:59:08 UTC (rev 4446)
@@ -19,6 +19,7 @@
 	DialogElement.h \
 	DialogElementSelection.h \
 	DialogImplication.h \
+	DialogLoader.h \
 	DialogManager.h \
 	DialogOption.h \
 	DialogResponse.h \

Modified: rl/trunk/engine/ai/src/AiSubsystem.cpp
===================================================================
--- rl/trunk/engine/ai/src/AiSubsystem.cpp	2008-07-11 19:42:39 UTC (rev 4445)
+++ rl/trunk/engine/ai/src/AiSubsystem.cpp	2008-07-11 19:59:08 UTC (rev 4446)
@@ -72,7 +72,6 @@
 	mWayPointGraphManager = new WayPointGraphManager();
     mWorld = new AiWorld();
     mDialogManager = new DialogManager();
-    Ogre::ResourceGroupManager::getSingleton()._registerScriptLoader(mDialogManager);
 
     mSceneLoadedConnection =
         MessagePump::getSingleton().addMessageHandler<MessageType_SceneLoaded>(

Added: rl/trunk/engine/ai/src/DialogLoader.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogLoader.cpp	2008-07-11 19:42:39 UTC (rev 4445)
+++ rl/trunk/engine/ai/src/DialogLoader.cpp	2008-07-11 19:59:08 UTC (rev 4446)
@@ -0,0 +1,739 @@
+/*
+ *  DialogLoader.cpp
+ *  Rastullah
+ *
+ *  Created by Sascha Kolewa on 11.07.08.
+ *  Copyright 2008 __MyCompanyName__. All rights reserved.
+ *
+ */
+#include <xercesc/dom/DOM.hpp>
+
+#include "DialogLoader.h"
+
+#include "ConfigurationManager.h"
+#include "Dialog.h"
+#include "DialogCondition.h"
+#include "DialogElement.h"
+#include "DialogImplication.h"
+#include "DialogOption.h"
+#include "DialogParagraph.h"
+#include "DialogResponse.h"
+#include "DialogVariable.h"
+#include "XmlPropertyReader.h"
+
+using namespace Ogre;
+using namespace XERCES_CPP_NAMESPACE;
+
+namespace rl
+{
+	DialogLoader::DialogLoader()
+	      : XmlProcessor(), ScriptLoader()
+    {
+        mScriptPatterns.push_back("*.dialog");
+  	}
+	
+    DialogLoader::~DialogLoader()
+    {
+		std::map<Ogre::String, DialogPrototype*>::iterator itr = mDialogs.begin();
+        std::map<Ogre::String, DialogPrototype*>::iterator end = mDialogs.end();
+        for(; itr != end; ++itr)
+        {
+			DialogPrototype* p = itr->second;
+			delete p;
+		}
+        mDialogs.clear();
+	}
+ 
+    const StringVector& DialogLoader::getScriptPatterns() const
+    {
+        return mScriptPatterns;
+    }
+    
+	Ogre::Real DialogLoader::getLoadingOrder() const
+    {
+        return 1000;
+    }
+
+    void DialogLoader::parseScript(DataStreamPtr& stream, const Ogre::String& groupName)
+    {
+        initializeXml();
+
+        DOMDocument* doc = loadDocument(stream);
+        if (doc)
+        {
+            DOMNodeList* dialogNodes = doc->getElementsByTagName(AutoXMLCh("dialog").data());
+
+            for (XMLSize_t i = 0; i < dialogNodes->getLength(); ++i)
+            {
+                DOMNode* cur = dialogNodes->item(i);
+                processDialog(static_cast<DOMElement*>(cur));
+            }
+        }
+
+        shutdownXml();
+    }
+	
+	Dialog* DialogLoader::createDialog(const String& name, const std::vector<Creature*>& pcs, 
+		const std::vector<Creature*>& npcs) const
+	{
+		std::map<Ogre::String, DialogPrototype*>::const_iterator it =
+			mDialogs.find(name);
+			
+		if (it == mDialogs.end())
+		{
+			return NULL;
+		}
+		
+		return it->second->createDialog(pcs, npcs);
+	}
+	
+    void DialogLoader::processDialog(DOMElement* dialogElem)
+    {
+        DialogPrototype* dialogPrototype = new DialogPrototype();
+        Ogre::String name = getAttributeValueAsStdString(dialogElem, "name");
+        mDialogs[name] = dialogPrototype;
+
+        // first step: process all possible references
+        processElementNodes(dialogElem, "option", dialogPrototype);
+        processElementNodes(dialogElem, "switchoption", dialogPrototype);
+        processElementNodes(dialogElem, "response", dialogPrototype);
+        processElementNodes(dialogElem, "switchresponse", dialogPrototype);
+
+        for (DOMNode* curChild = dialogElem->getFirstChild(); curChild != NULL; curChild = curChild->getNextSibling())
+        {
+            if (hasNodeName(curChild, "variable"))
+            {
+                createDialogVariable(static_cast<DOMElement*>(curChild), dialogPrototype);
+            }
+            else if (hasNodeName(curChild, "option"))
+            {
+                processOption(static_cast<DOMElement*>(curChild), dialogPrototype, true);
+            }
+            else if (hasNodeName(curChild, "switchoption"))
+            {
+                processSwitchOption(static_cast<DOMElement*>(curChild), dialogPrototype);
+            }
+            else if (hasNodeName(curChild, "response"))
+            {
+                processResponse(static_cast<DOMElement*>(curChild), dialogPrototype, true);
+            }
+            else if (hasNodeName(curChild, "switchresponse"))
+            {
+                processSwitchResponse(static_cast<DOMElement*>(curChild), dialogPrototype);
+            }
+            else if (hasNodeName(curChild, "start"))
+            {
+                for (DOMNode* curChildChild = curChild->getFirstChild(); curChildChild != NULL; 
+                    curChildChild = curChildChild->getNextSibling())
+                {
+                    DialogResponse *response = processResponseClasses(curChildChild, dialogPrototype);
+                    if (response)
+                    {
+                        dialogPrototype->setStartResponse(response);
+                    }
+                }
+            }
+        }
+        LOG_MESSAGE(Logger::AI, "Processed Dialog "+ name);
+    }
+
+    void DialogLoader::processElementNodes(XERCES_CPP_NAMESPACE::DOMElement* dialogXml, const Ogre::String& nodeName, DialogPrototype* dialogPrototype)
+    {
+        DOMNodeList* dialogElemNodes = dialogXml->getElementsByTagName(AutoXMLCh(nodeName.c_str()).data());
+        for (XMLSize_t i = 0; i < dialogElemNodes->getLength(); ++i)
+        {
+            DOMElement* dialogElemXml = static_cast<DOMElement*>(dialogElemNodes->item(i));
+            if (!hasAttribute(dialogElemXml, "id"))
+            {
+                Throw(WrongFormatException, "option/switchoption/response/switchresponse node without id found");
+            }
+            CeGuiString id = getAttributeValueAsString(dialogElemXml, "id");
+            CeGuiString text = getValueAsString(dialogElemXml);
+
+            if (hasNodeName(dialogElemXml, "switchoption"))
+            {
+                DialogOption* option = new DialogSelection<DialogOption>(id);
+                option->setLabel(text);
+                dialogPrototype->addOption(option);
+            }
+            else if (hasNodeName(dialogElemXml, "option"))
+            {
+                bool isAutoSelected = getAttributeValueAsBool(dialogElemXml, "autoSelect");
+                DialogOption* option = new DialogOption(id, isAutoSelected);
+                if (hasAttribute(dialogElemXml, "label"))
+                {
+                    option->setLabel(getAttributeValueAsString(dialogElemXml, "label"));
+                }
+                else
+                {
+                    option->setLabel(text);
+                }
+                dialogPrototype->addOption(option);
+            }
+            else if (hasNodeName(dialogElemXml, "response"))
+            {
+                dialogPrototype->addResponse(new DialogResponse(id));
+            }
+            else if (hasNodeName(dialogElemXml, "switchresponse"))
+            {
+                dialogPrototype->addResponse(new DialogResponseSelection(id));
+            }
+        }
+        
+    }
+
+    DialogResponse* DialogLoader::processResponseClasses(DOMNode *node, DialogPrototype *dialogPrototype)
+    {
+        DialogResponse* response = NULL;
+        if (hasNodeName(node, "response"))
+        {
+            response = processResponse(static_cast<DOMElement*>(node), dialogPrototype, true);
+        }
+        else if (hasNodeName(node, "gotoresponse"))
+        {
+            response = processResponse(static_cast<DOMElement*>(node), dialogPrototype, false);
+        }
+        else if (hasNodeName(node, "switchresponse"))
+        {
+            response = processSwitchResponse(static_cast<DOMElement*>(node), dialogPrototype);
+        }
+        return response;
+    }
+
+    DialogResponse* DialogLoader::processResponse(DOMElement *responseXml, DialogLoader::DialogPrototype *dialogPrototype, bool subelements)
+    {
+        CeGuiString id = getAttributeValueAsString(responseXml, "id");
+
+        DialogResponse* response = dialogPrototype->getResponse(id);
+
+        if (!response)  Throw(IllegalArgumentException, CeGuiString("No response with ID "+ id).c_str());
+        
+        bool languageDefined = false;
+        DOMElement* defaultLanguage = NULL;
+        if (subelements)
+        {
+            bool paragraphsDefined = false;
+
+            for (DOMNode* cur = responseXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
+            {
+                DialogOption* option = processOptionClasses(cur, dialogPrototype);
+                if (option)
+                {
+                    response->addOption(option);
+                    continue;
+                }
+
+                DialogImplication* implication = processImplicationClasses(cur);
+                if (implication)
+                {
+                    response->addImplication(implication);
+                    continue;
+                }
+
+                if (hasNodeName(cur, "p"))
+                {
+                    response->addParagraph(processParagraph(static_cast<DOMElement*>(cur)));
+                    paragraphsDefined = true;
+                }
+                // process translations
+                else if (hasNodeName(cur, "t"))
+                {
+                    DOMElement* translation = static_cast<DOMElement*>(cur);
+                    // check loca
+                    if(getAttributeValueAsStdString(translation, "language") 
+                        == ConfigurationManager::getSingleton().getStringSetting("Localization", "language"))
+                    {
+                        processTranslation(response, translation);
+                        languageDefined = true;
+                    }
+                    // set german as default language
+                    if(getAttributeValueAsStdString(translation, "language") == "de")
+                    {
+                        defaultLanguage = translation;
+                    }
+                    paragraphsDefined = true;
+                }
+                else if (hasNodeName(cur, "gotoresponse"))
+                {
+                    CeGuiString id = getAttributeValueAsString(static_cast<DOMElement*>(cur), "id");
+                    response->addParagraph(new DialogGotoResponse(dialogPrototype->getResponse(id)));
+                }
+            }
+
+            if (!paragraphsDefined)
+            {
+                CeGuiString responseXmlText = getValueAsString(responseXml);
+                response->addParagraph(new DialogParagraph(responseXmlText));
+            }
+        }            
+        // use german as the default language if german is not set as
+        // default language but no other language was found!
+        if(!languageDefined && defaultLanguage != NULL 
+            && ConfigurationManager::getSingleton().getStringSetting("Localization", "language") != "de")
+        {
+            processTranslation(response, defaultLanguage);
+            languageDefined = true;
+        }
+
+        return response;
+    }
+
+    DialogResponse* DialogLoader::processSwitchResponse(XERCES_CPP_NAMESPACE::DOMElement* switchRespXml, DialogPrototype* dialogPrototype)
+    {
+        CeGuiString id = getAttributeValueAsString(switchRespXml, "id");
+        DialogSelection<DialogResponse>* response = dynamic_cast<DialogSelection<DialogResponse>*>(dialogPrototype->getResponse(id));
+
+        if (!response)  Throw(IllegalArgumentException, CeGuiString("No switchresponse with ID "+ id).c_str());
+
+        for (DOMNode* cur = switchRespXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
+        {
+            DialogVariable* variable = processVariableClasses(static_cast<DOMElement*>(cur));
+            if (variable != NULL)
+            {
+                response->setVariable(variable);
+            }
+            else if (hasNodeName(cur, "case"))
+            {
+                DialogCondition* condition = processCase(static_cast<DOMElement*>(cur));
+                for (DOMNode* caseChild = cur->getFirstChild(); caseChild != NULL; caseChild = caseChild->getNextSibling())
+                {
+                    DialogResponse* responseCase = processResponseClasses(caseChild, dialogPrototype);
+                    if (responseCase)
+                    {
+                         response->addElement(condition, responseCase);
+                         break;
+                    }
+                }               
+            }
+        }
+
+
+        return response;
+    }
+
+    DialogOption* DialogLoader::processOptionClasses(DOMNode *node, DialogPrototype *dialogPrototype)
+    {
+        DialogOption* option = NULL;
+        if (hasNodeName(node, "option"))
+        {
+            option = processOption(static_cast<DOMElement*>(node), dialogPrototype, true);
+        }
+        else if (hasNodeName(node, "optionref"))
+        {
+            option = processOption(static_cast<DOMElement*>(node), dialogPrototype, false);
+        }
+        else if (hasNodeName(node, "switchoption"))
+        {
+            option = processSwitchOption(static_cast<DOMElement*>(node), dialogPrototype);
+        }
+        return option;
+    }
+
+    DialogOption* DialogLoader::processOption(DOMElement *optionXml, DialogLoader::DialogPrototype *dialogPrototype, bool subelements)
+    {
+        CeGuiString id = getAttributeValueAsString(optionXml, "id");
+
+        DialogOption* option = dialogPrototype->getOption(id);
+
+        if (!option)    Throw(IllegalArgumentException, CeGuiString("No option with ID "+ id).c_str());
+
+        bool languageDefined = false;
+        DOMElement* defaultLanguage = NULL;
+
+        if (subelements)
+        {
+            bool paragraphsDefined = false;
+
+            for (DOMNode* cur = optionXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
+            {
+                DialogResponse* response = processResponseClasses(cur, dialogPrototype);
+                if (response)
+                {
+                    option->setResponse(response);
+                }
+                else if (hasNodeName(cur, "if"))
+                {
+                    option->setPrecondition(processIf(static_cast<DOMElement*>(cur)));
+                }
+                else if (hasNodeName(cur, "p"))
+                {
+                    option->addParagraph(processParagraph(static_cast<DOMElement*>(cur)));
+                    paragraphsDefined = true;
+                }
+                // process translations
+                else if (hasNodeName(cur, "t"))
+                {
+                    DOMElement* translation = static_cast<DOMElement*>(cur);
+                    // check loca
+                    if(getAttributeValueAsStdString(translation, "language") 
+                        == ConfigurationManager::getSingleton().getStringSetting("Localization", "language"))
+                    {
+                        defaultLanguage = translation;
+                        processTranslation(option, translation);
+                        std::string label = getAttributeValueAsStdString(translation, "label");
+                        if(!label.empty())
+                        {
+                            option->setLabel(label);
+                        }
+                        languageDefined = true;
+                    }
+                    // set german as default language
+                    if(getAttributeValueAsStdString(translation, "language") == "de")
+                    {
+                        defaultLanguage = translation;
+                    }
+                    paragraphsDefined = true;
+                }
+            }
+
+            if (!paragraphsDefined)
+            {
+                CeGuiString optionXmlText = getValueAsString(optionXml);
+                option->addParagraph(new DialogParagraph(optionXmlText));
+            }
+        }
+        // use german as the default language if german is not set as
+        // default language but no other language was found!
+        if(!languageDefined && defaultLanguage != NULL 
+            && ConfigurationManager::getSingleton().getStringSetting("Localization", "language") != "de")
+        {
+            processTranslation(option, defaultLanguage);
+            std::string label = getAttributeValueAsStdString(defaultLanguage, "label");
+            if(!label.empty())
+            {
+                option->setLabel(label);
+            }
+            languageDefined = true;
+        }
+
+        return option;
+    }
+
+    DialogOption* DialogLoader::processSwitchOption(DOMElement *switchOptXml, DialogLoader::DialogPrototype *dialogPrototype)
+    {
+        CeGuiString id = getAttributeValueAsString(switchOptXml, "id");
+        DialogOptionSelection* option = dynamic_cast<DialogOptionSelection*>(dialogPrototype->getOption(id));
+
+        if (!option) Throw(IllegalArgumentException, CeGuiString("No switchoption with ID "+ id).c_str());
+
+        for (DOMNode* cur = switchOptXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
+        {
+            DialogVariable* variable = processVariableClasses(static_cast<DOMElement*>(cur));
+            if (variable != NULL)
+            {
+                option->setVariable(variable);
+            }
+            else if (hasNodeName(cur, "case"))
+            {
+                DialogCondition* condition = processCase(static_cast<DOMElement*>(cur));
+                for (DOMNode* caseChild = cur->getFirstChild(); caseChild != NULL; caseChild = caseChild->getNextSibling())
+                {
+                    DialogOption* optionCase = processOptionClasses(caseChild, dialogPrototype);
+                    if (optionCase)
+                    {
+                         option->addElement(condition, optionCase);
+                         break;
+                    }
+                }               
+            }
+            // process translations
+            else if (hasNodeName(cur, "t"))
+            {
+                DOMElement* translation = static_cast<DOMElement*>(cur);
+                // check loca
+                if(getAttributeValueAsStdString(translation, "language") == 
+                    ConfigurationManager::getSingleton().getStringSetting("Localization", "language"))
+                {
+                    std::string label = getAttributeValueAsStdString(translation, "label");
+                    if(!label.empty())
+                    {
+                        option->setLabel(label);
+                    }
+                } 
+            }
+        }
+            
+        return option;
+    }
+
+    void DialogLoader::createDialogVariable(DOMElement *variableXml, DialogLoader::DialogPrototype *dialogPrototype)
+    {
+        XmlPropertyReader reader;
+        PropertyEntry entry = reader.processProperty(variableXml);
+        dialogPrototype->setProperty(entry.first, entry.second);
+    }
+
+    DialogCondition* DialogLoader::processIf(DOMElement *ifXml)
+    {
+        DialogCondition* cond = NULL;
+        DialogVariable* var = NULL;
+
+        for (DOMNode* cur = ifXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
+        {
+            if (cur->getNodeType() == DOMNode::ELEMENT_NODE)
+            {
+                DOMElement* curElem = static_cast<DOMElement*>(cur);
+
+                DialogCondition* curCond = processConditionClasses(curElem);
+                if (curCond)
+                {
+                    cond = curCond;
+                }
+
+                DialogVariable* curVar = processVariableClasses(curElem);
+                if (curVar)
+                {
+                    var = curVar;
+                }
+            }
+        }
+
+        cond->setVariable(var);
+        return cond;
+    }
+
+    DialogParagraph* DialogLoader::processParagraph(DOMElement* paragraphXml)
+    {
+        Ogre::String voicefile = "";
+        if (hasAttribute(paragraphXml, "voicefile"))
+        {
+            voicefile = getAttributeValueAsStdString(paragraphXml, "voicefile");
+        }
+        return new DialogParagraph(getValueAsString(paragraphXml), voicefile);
+    }
+
+    DialogCondition* DialogLoader::processCase(DOMElement *caseXml)
+    {
+        DialogCondition* cond = NULL;
+
+        for (DOMNode* cur = caseXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
+        {
+            if (cur->getNodeType() == DOMNode::ELEMENT_NODE)
+            {
+                DialogCondition* curCond = processConditionClasses(static_cast<DOMElement*>(cur));
+                if (curCond)
+                {
+                    cond = curCond;
+                }
+            }
+        }
+
+        return cond;
+    }
+
+    DialogLoader::DialogPrototype::DialogPrototype()
+    {
+    }
+
+    DialogLoader::DialogPrototype::~DialogPrototype()
+    {
+        std::map<CeGuiString, DialogOption*>::iterator it;
+        for( it = mOptionCache.begin(); it != mOptionCache.end(); it++ )
+            if( it->second != NULL )
+                delete it->second;
+
+        std::map<CeGuiString, DialogResponse*>::iterator it1;
+        for( it1 = mResponseCache.begin(); it1 != mResponseCache.end(); it1++ )
+            if( it1->second != NULL )
+                delete it1->second;
+    }
+
+    void DialogLoader::DialogPrototype::addOption(DialogOption* option)
+    {
+        if (mOptionCache.find(option->getId()) != mOptionCache.end())
+        {
+            Throw(IllegalArgumentException, 
+                CeGuiString("Duplicate option/switchoption ID "+ option->getId()).c_str());
+        }
+        mOptionCache[option->getId()] = option;
+    }
+
+    DialogOption* DialogLoader::DialogPrototype::getOption(const CeGuiString& id) const
+    {
+        std::map<CeGuiString, DialogOption*>::const_iterator it = mOptionCache.find(id);
+        if (it == mOptionCache.end())
+        {
+            return NULL;
+        }
+        return it->second;
+    }
+
+    void DialogLoader::DialogPrototype::addResponse(DialogResponse* response)
+    {
+        if (mResponseCache.find(response->getId()) != mResponseCache.end())
+        {
+            Throw(IllegalArgumentException, 
+                CeGuiString("Duplicate Response/switchResponse ID "+ response->getId()).c_str());
+        }
+        mResponseCache[response->getId()] = response;
+    }
+
+    DialogResponse* DialogLoader::DialogPrototype::getResponse(const CeGuiString& id) const
+    {
+        std::map<CeGuiString, DialogResponse*>::const_iterator it = mResponseCache.find(id);
+        if (it == mResponseCache.end())
+        {
+            return NULL;
+        }
+        return it->second;
+    }
+
+    Dialog* DialogLoader::DialogPrototype::createDialog(const std::vector<Creature*>& pcs, const std::vector<Creature*>& npcs)
+    {
+        Dialog* dialog = new Dialog(pcs, npcs);
+        dialog->setStartResponse(mDialogStart);
+        
+        for (PropertyRecord::PropertyRecordMap::const_iterator it = mPropertyVariables.begin(); 
+            it != mPropertyVariables.end(); ++it)
+        {
+            dialog->setProperty(it->first, it->second);
+        }
+
+        return dialog;
+    }
+
+    void DialogLoader::DialogPrototype::setProperty(const CeGuiString& key, const Property& value)
+    {
+        mPropertyVariables.setProperty(key, value);
+    }
+
+    void DialogLoader::DialogPrototype::setStartResponse(DialogResponse* start)
+    {
+        mDialogStart = start;
+    }
+
+
+    DialogCondition* DialogLoader::processConditionClasses(DOMElement* conditionXml)
+    {
+        if (hasNodeName(conditionXml, "equals"))
+        {
+            return new DialogConditionEquals(
+                getAttributeValueAsString(conditionXml, "value"));
+        }
+        else if (hasNodeName(conditionXml, "inrange"))
+        {
+            return new DialogConditionInRange(
+                getAttributeValueAsReal(conditionXml, "from"),
+                getAttributeValueAsReal(conditionXml, "to"));
+        }
+        else if (hasNodeName(conditionXml, "lower"))
+        {
+            return new DialogConditionLowerThan(
+                getAttributeValueAsReal(conditionXml, "value"));
+        }
+        else if (hasNodeName(conditionXml, "lowereq"))
+        {
+            return new DialogConditionLowerOrEquals(
+                getAttributeValueAsReal(conditionXml, "value"));
+        }
+        else if (hasNodeName(conditionXml, "greater"))
+        {
+            return new DialogConditionGreaterThan(
+                getAttributeValueAsReal(conditionXml, "value"));
+        }
+        else if (hasNodeName(conditionXml, "greatereq"))
+        {
+            return new DialogConditionGreaterOrEquals(
+                getAttributeValueAsReal(conditionXml, "value"));
+        }
+
+        return NULL;
+    }
+
+    DialogVariable* DialogLoader::processVariableClasses(DOMElement* variableXml)
+    {
+        if (hasNodeName(variableXml, "dialogvariable"))
+        {
+            return new DialogPropertyVariable(getAttributeValueAsStdString(variableXml, "name"));
+        }
+        else if (hasNodeName(variableXml, "queststate"))
+        {
+            Ogre::String questId = getAttributeValueAsStdString(variableXml, "quest");
+            Ogre::String prop = getAttributeValueAsStdString(variableXml, "property");
+            return new QuestStateVariable(questId, prop);
+        }
+        else if (hasNodeName(variableXml, "attributecheck"))
+        {
+            CeGuiString attr = getAttributeValueAsString(variableXml, "attribute");
+            CeGuiString target = getAttributeValueAsString(variableXml, "target");
+            int modifier = 0;
+            if (hasAttribute(variableXml, "modifier"))
+            {
+                modifier = getAttributeValueAsInteger(variableXml, "modifier");
+            }
+            return new EigenschaftsProbeVariable(attr, modifier, target);
+        }
+        else if (hasNodeName(variableXml, "talentcheck"))
+        {
+            CeGuiString attr = getAttributeValueAsString(variableXml, "talent");
+            CeGuiString target = getAttributeValueAsString(variableXml, "target");
+            int modifier = 0;
+            if (hasAttribute(variableXml, "modifier"))
+            {
+                modifier = getAttributeValueAsInteger(variableXml, "modifier");
+            }
+            return new TalentProbeVariable(attr, modifier, target);
+        }
+
+        return NULL;
+    }
+
+
+    DialogImplication* DialogLoader::processImplicationClasses(DOMNode* implicationXml)
+    {
+        if (implicationXml->getNodeType() == DOMNode::ELEMENT_NODE)
+        {
+            DOMElement* implicationElem = static_cast<DOMElement*>(implicationXml);
+
+            if (hasNodeName(implicationElem, "setvariable"))
+            {
+                Ogre::String variableName = getAttributeValueAsStdString(implicationElem, "name");
+                CeGuiString variableValue = getAttributeValueAsString(implicationElem, "value");
+                return new DialogVariableAssignment(variableName, variableValue);
+            }
+            else if (hasNodeName(implicationElem, "incvariable"))
+            {
+                Ogre::String variableName = getAttributeValueAsStdString(implicationElem, "name");
+                CeGuiString variableValue = getAttributeValueAsString(implicationElem, "value");
+                return new DialogVariableIncrease(variableName, variableValue);
+            }
+            else if (hasNodeName(implicationElem, "decvariable"))
+            {
+                Ogre::String variableName = getAttributeValueAsStdString(implicationElem, "name");
+                CeGuiString variableValue = getAttributeValueAsString(implicationElem, "value");
+                return new DialogVariableDecrease(variableName, variableValue);
+            }
+            else if (hasNodeName(implicationElem, "setoptionactive"))
+            {
+                CeGuiString id = getAttributeValueAsString(implicationElem, "id");
+                bool value = getAttributeValueAsBool(implicationElem, "value");
+                return new DialogElementActivation(id, value, true);
+            }
+			else if (hasNodeName(implicationElem, "exit"))
+			{
+				return new DialogExit();
+			}
+            else if (hasNodeName(implicationElem, "changequest"))
+            {
+                Ogre::String questId = getAttributeValueAsStdString(implicationElem, "quest");
+                Ogre::String prop = getAttributeValueAsStdString(implicationElem, "property");
+                CeGuiString newvalue = getAttributeValueAsString(implicationElem, "newvalue");
+                return new QuestPropertyAssignment(questId, prop, newvalue);
+            }
+        }
+
+        return NULL;
+    }
+
+    void DialogLoader::processTranslation(DialogElement* element, DOMNode* translationXml)
+    {
+        for (DOMNode* cur = translationXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
+        {
+            if (hasNodeName(cur, "p"))
+            {
+                element->addParagraph(processParagraph(static_cast<DOMElement*>(cur)));
+            }
+        }
+    }
+
+}
\ No newline at end of file

Modified: rl/trunk/engine/ai/src/DialogManager.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogManager.cpp	2008-07-11 19:42:39 UTC (rev 4445)
+++ rl/trunk/engine/ai/src/DialogManager.cpp	2008-07-11 19:59:08 UTC (rev 4446)
@@ -1,886 +1,194 @@
-/* This source file is part of Rastullahs Lockenpracht.
- * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
- * 
- *  This program is free software; you can redistribute it and/or modify
- *  it under the terms of the Clarified Artistic License.
- *
- *  This program is distributed in the hope that it will be useful,
- *  but WITHOUT ANY WARRANTY; without even the implied warranty of
- *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- *  Clarified Artistic License for more details.
- *
- *  You should have received a copy of the Clarified Artistic License
- *  along with this program; if not you can get it here
- *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
- */
-#include "stdinc.h"
-
-#include "DialogManager.h"
-
-#include <xercesc/dom/DOM.hpp>
-
-#include "Creature.h"
-#include "Dialog.h"
-#include "DialogCondition.h"
-#include "DialogElement.h"
-#include "DialogImplication.h"
-#include "DialogOption.h"
-#include "DialogParagraph.h"
-#include "DialogResponse.h"
-#include "DialogVariable.h"
-#include "GameObjectManager.h"
-#include "XmlPropertyReader.h"
-#include "ConfigurationManager.h"
-#include "SaveGameManager.h"
-
-using namespace Ogre;
-using namespace XERCES_CPP_NAMESPACE;
-
-template<>
-    rl::DialogManager* Ogre::Singleton<rl::DialogManager>::ms_Singleton = NULL;
-
-namespace rl
-{
-    const Ogre::String DialogManager::PROPERTY_DIALOGS = "dialogs";
-    const Ogre::String DialogManager::PROPERTY_DIALOG = "dialog";
-    const Ogre::String DialogManager::PROPERTY_DIALOG_NAME = "name";
-    const Ogre::String DialogManager::PROPERTY_NPCS = "npc";
-
-    DialogManager::DialogManager()
-        : XmlProcessor(), ScriptLoader()
-    {
-        mScriptPatterns.push_back("*.dialog");
-        SaveGameManager::getSingleton().registerSaveGameData(this);
-    }
-
-    DialogManager::~DialogManager()
-    {
-        SaveGameManager::getSingleton().unregisterSaveGameData(this);
-        {
-            std::map<Ogre::String, DialogPrototype*>::iterator itr = mDialogs.begin();
-            std::map<Ogre::String, DialogPrototype*>::iterator end = mDialogs.end();
-            for(; itr != end; ++itr)
-            {
-                DialogPrototype* p = itr->second;
-                //delete (*itr->second);
-            }
-            mDialogs.clear();
-        }
-        {
-            std::map<DialogConfiguration, Dialog*>::iterator itr = mDialogStates.begin();
-            std::map<DialogConfiguration, Dialog*>::iterator end = mDialogStates.end();
-            for(; itr != end; ++itr)
-            {
-                //delete (*itr->second);
-            }
-            mDialogStates.clear();
-        }
-    }
-
-    const StringVector& DialogManager::getScriptPatterns() const
-    {
-        return mScriptPatterns;
-    }
-    
-	Ogre::Real DialogManager::getLoadingOrder() const
-    {
-        return 1000;
-    }
-
-    void DialogManager::parseScript(DataStreamPtr& stream, const Ogre::String& groupName)
-    {
-        initializeXml();
-
-        DOMDocument* doc = loadDocument(stream);
-        if (doc)
-        {
-            DOMNodeList* dialogNodes = doc->getElementsByTagName(AutoXMLCh("dialog").data());
-
-            for (XMLSize_t i = 0; i < dialogNodes->getLength(); ++i)
-            {
-                DOMNode* cur = dialogNodes->item(i);
-                processDialog(static_cast<DOMElement*>(cur));
-            }
-        }
-
-        shutdownXml();
-    }
-
-    const Property DialogManager::getProperty(const CeGuiString& key) const
-    {
-        if (key == DialogManager::PROPERTY_DIALOGS)
-        {
-            PropertyArray vec;
-            for (std::map<DialogConfiguration, Dialog*>::const_iterator it
-                = mDialogStates.begin(); it != mDialogStates.end(); ++it)
-            {
-                PropertyMap curDialogProp;
-                PropertyRecordPtr dialogProps = it->second->getAllProperties();
-                curDialogProp[DialogManager::PROPERTY_DIALOG] = dialogProps->toPropertyMap();
-                curDialogProp[DialogManager::PROPERTY_DIALOG_NAME] = Property(it->first.getName());
-
-                PropertyArray npcs;
-
-                for (std::vector<Creature*>::const_iterator itNpc = it->first.getNpcs().begin();
-                    itNpc != it->first.getNpcs().end(); ++itNpc)
-                {
-                    npcs.push_back(GameObjectManager::getSingleton().toProperty(*itNpc));
-                }
-
-                curDialogProp[DialogManager::PROPERTY_NPCS] = Property(npcs);
-            }
-
-            return Property(vec);
-        }
-
-        Throw(IllegalArgumentException, key + " is not a property of DialogManager");
-    }
-
-    PropertyKeys DialogManager::getAllPropertyKeys() const
-    {
-        PropertyKeys keys;
-        keys.insert(DialogManager::PROPERTY_DIALOGS);
-        return keys;
-    }
-
-    void DialogManager::setProperty(const CeGuiString& key, const Property& value)
-    {
-        ///@todo implement
-    }
-
-    void DialogManager::writeData(SaveGameFileWriter *writer)
-    {
-        LOG_MESSAGE(Logger::RULES, "Saving dialogs");
-
-        PropertyRecordPtr set = getAllProperties();
-        writer->writeEachProperty(this, set->toPropertyMap());
-    }
-
-    void DialogManager::readData(SaveGameFileReader* reader)
-    {
-        LOG_MESSAGE(Logger::RULES, "Loading dialogs");
-
-        PropertyRecordPtr properties = reader->getAllPropertiesAsRecord(this);
-        setProperties(properties);
-    }
-
-    int DialogManager::getPriority() const
-    {
-        return 50;
-    }
-
-    CeGuiString DialogManager::getXmlNodeIdentifier() const
-    {
-        return "dialogs";
-    }
-
-
-    void DialogManager::processDialog(DOMElement* dialogElem)
-    {
-        DialogPrototype* dialogPrototype = new DialogPrototype();
-        Ogre::String name = getAttributeValueAsStdString(dialogElem, "name");
-        mDialogs[name] = dialogPrototype;
-
-        // first step: process all possible references
-        processElementNodes(dialogElem, "option", dialogPrototype);
-        processElementNodes(dialogElem, "switchoption", dialogPrototype);
-        processElementNodes(dialogElem, "response", dialogPrototype);
-        processElementNodes(dialogElem, "switchresponse", dialogPrototype);
-
-        for (DOMNode* curChild = dialogElem->getFirstChild(); curChild != NULL; curChild = curChild->getNextSibling())
-        {
-            if (hasNodeName(curChild, "variable"))
-            {
-                createDialogVariable(static_cast<DOMElement*>(curChild), dialogPrototype);
-            }
-            else if (hasNodeName(curChild, "option"))
-            {
-                processOption(static_cast<DOMElement*>(curChild), dialogPrototype, true);
-            }
-            else if (hasNodeName(curChild, "switchoption"))
-            {
-                processSwitchOption(static_cast<DOMElement*>(curChild), dialogPrototype);
-            }
-            else if (hasNodeName(curChild, "response"))
-            {
-                processResponse(static_cast<DOMElement*>(curChild), dialogPrototype, true);
-            }
-            else if (hasNodeName(curChild, "switchresponse"))
-            {
-                processSwitchResponse(static_cast<DOMElement*>(curChild), dialogPrototype);
-            }
-            else if (hasNodeName(curChild, "start"))
-            {
-                for (DOMNode* curChildChild = curChild->getFirstChild(); curChildChild != NULL; 
-                    curChildChild = curChildChild->getNextSibling())
-                {
-                    DialogResponse *response = processResponseClasses(curChildChild, dialogPrototype);
-                    if (response)
-                    {
-                        dialogPrototype->setStartResponse(response);
-                    }
-                }
-            }
-        }
-        LOG_MESSAGE(Logger::AI, "Processed Dialog "+ name);
-    }
-
-    void DialogManager::processElementNodes(XERCES_CPP_NAMESPACE::DOMElement* dialogXml, const Ogre::String& nodeName, DialogPrototype* dialogPrototype)
-    {
-        DOMNodeList* dialogElemNodes = dialogXml->getElementsByTagName(AutoXMLCh(nodeName.c_str()).data());
-        for (XMLSize_t i = 0; i < dialogElemNodes->getLength(); ++i)
-        {
-            DOMElement* dialogElemXml = static_cast<DOMElement*>(dialogElemNodes->item(i));
-            if (!hasAttribute(dialogElemXml, "id"))
-            {
-                Throw(WrongFormatException, "option/switchoption/response/switchresponse node without id found");
-            }
-            CeGuiString id = getAttributeValueAsString(dialogElemXml, "id");
-            CeGuiString text = getValueAsString(dialogElemXml);
-
-            if (hasNodeName(dialogElemXml, "switchoption"))
-            {
-                DialogOption* option = new DialogSelection<DialogOption>(id);
-                option->setLabel(text);
-                dialogPrototype->addOption(option);
-            }
-            else if (hasNodeName(dialogElemXml, "option"))
-            {
-                bool isAutoSelected = getAttributeValueAsBool(dialogElemXml, "autoSelect");
-                DialogOption* option = new DialogOption(id, isAutoSelected);
-                if (hasAttribute(dialogElemXml, "label"))
-                {
-                    option->setLabel(getAttributeValueAsString(dialogElemXml, "label"));
-                }
-                else
-                {
-                    option->setLabel(text);
-                }
-                dialogPrototype->addOption(option);
-            }
-            else if (hasNodeName(dialogElemXml, "response"))
-            {
-                dialogPrototype->addResponse(new DialogResponse(id));
-            }
-            else if (hasNodeName(dialogElemXml, "switchresponse"))
-            {
-                dialogPrototype->addResponse(new DialogResponseSelection(id));
-            }
-        }
-        
-    }
-
-    DialogResponse* DialogManager::processResponseClasses(DOMNode *node, DialogPrototype *dialogPrototype)
-    {
-        DialogResponse* response = NULL;
-        if (hasNodeName(node, "response"))
-        {
-            response = processResponse(static_cast<DOMElement*>(node), dialogPrototype, true);
-        }
-        else if (hasNodeName(node, "gotoresponse"))
-        {
-            response = processResponse(static_cast<DOMElement*>(node), dialogPrototype, false);
-        }
-        else if (hasNodeName(node, "switchresponse"))
-        {
-            response = processSwitchResponse(static_cast<DOMElement*>(node), dialogPrototype);
-        }
-        return response;
-    }
-
-    DialogResponse* DialogManager::processResponse(DOMElement *responseXml, DialogManager::DialogPrototype *dialogPrototype, bool subelements)
-    {
-        CeGuiString id = getAttributeValueAsString(responseXml, "id");
-
-        DialogResponse* response = dialogPrototype->getResponse(id);
-
-        if (!response)  Throw(IllegalArgumentException, CeGuiString("No response with ID "+ id).c_str());
-        
-        bool languageDefined = false;
-        DOMElement* defaultLanguage = NULL;
-        if (subelements)
-        {
-            bool paragraphsDefined = false;
-
-            for (DOMNode* cur = responseXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
-            {
-                DialogOption* option = processOptionClasses(cur, dialogPrototype);
-                if (option)
-                {
-                    response->addOption(option);
-                    continue;
-                }
-
-                DialogImplication* implication = processImplicationClasses(cur);
-                if (implication)
-                {
-                    response->addImplication(implication);
-                    continue;
-                }
-
-                if (hasNodeName(cur, "p"))
-                {
-                    response->addParagraph(processParagraph(static_cast<DOMElement*>(cur)));
-                    paragraphsDefined = true;
-                }
-                // process translations
-                else if (hasNodeName(cur, "t"))
-                {
-                    DOMElement* translation = static_cast<DOMElement*>(cur);
-                    // check loca
-                    if(getAttributeValueAsStdString(translation, "language") 
-                        == ConfigurationManager::getSingleton().getStringSetting("Localization", "language"))
-                    {
-                        processTranslation(response, translation);
-                        languageDefined = true;
-                    }
-                    // set german as default language
-                    if(getAttributeValueAsStdString(translation, "language") == "de")
-                    {
-                        defaultLanguage = translation;
-                    }
-                    paragraphsDefined = true;
-                }
-                else if (hasNodeName(cur, "gotoresponse"))
-                {
-                    CeGuiString id = getAttributeValueAsString(static_cast<DOMElement*>(cur), "id");
-                    response->addParagraph(new DialogGotoResponse(dialogPrototype->getResponse(id)));
-                }
-            }
-
-            if (!paragraphsDefined)
-            {
-                CeGuiString responseXmlText = getValueAsString(responseXml);
-                response->addParagraph(new DialogParagraph(responseXmlText));
-            }
-        }            
-        // use german as the default language if german is not set as
-        // default language but no other language was found!
-        if(!languageDefined && defaultLanguage != NULL 
-            && ConfigurationManager::getSingleton().getStringSetting("Localization", "language") != "de")
-        {
-            processTranslation(response, defaultLanguage);
-            languageDefined = true;
-        }
-
-        return response;
-    }
-
-    DialogResponse* DialogManager::processSwitchResponse(XERCES_CPP_NAMESPACE::DOMElement* switchRespXml, DialogPrototype* dialogPrototype)
-    {
-        CeGuiString id = getAttributeValueAsString(switchRespXml, "id");
-        DialogSelection<DialogResponse>* response = dynamic_cast<DialogSelection<DialogResponse>*>(dialogPrototype->getResponse(id));
-
-        if (!response)  Throw(IllegalArgumentException, CeGuiString("No switchresponse with ID "+ id).c_str());
-
-        for (DOMNode* cur = switchRespXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
-        {
-            DialogVariable* variable = processVariableClasses(static_cast<DOMElement*>(cur));
-            if (variable != NULL)
-            {
-                response->setVariable(variable);
-            }
-            else if (hasNodeName(cur, "case"))
-            {
-                DialogCondition* condition = processCase(static_cast<DOMElement*>(cur));
-                for (DOMNode* caseChild = cur->getFirstChild(); caseChild != NULL; caseChild = caseChild->getNextSibling())
-                {
-                    DialogResponse* responseCase = processResponseClasses(caseChild, dialogPrototype);
-                    if (responseCase)
-                    {
-                         response->addElement(condition, responseCase);
-                         break;
-                    }
-                }               
-            }
-        }
-
-
-        return response;
-    }
-
-    DialogOption* DialogManager::processOptionClasses(DOMNode *node, DialogPrototype *dialogPrototype)
-    {
-        DialogOption* option = NULL;
-        if (hasNodeName(node, "option"))
-        {
-            option = processOption(static_cast<DOMElement*>(node), dialogPrototype, true);
-        }
-        else if (hasNodeName(node, "optionref"))
-        {
-            option = processOption(static_cast<DOMElement*>(node), dialogPrototype, false);
-        }
-        else if (hasNodeName(node, "switchoption"))
-        {
-            option = processSwitchOption(static_cast<DOMElement*>(node), dialogPrototype);
-        }
-        return option;
-    }
-
-    DialogOption* DialogManager::processOption(DOMElement *optionXml, DialogManager::DialogPrototype *dialogPrototype, bool subelements)
-    {
-        CeGuiString id = getAttributeValueAsString(optionXml, "id");
-
-        DialogOption* option = dialogPrototype->getOption(id);
-
-        if (!option)    Throw(IllegalArgumentException, CeGuiString("No option with ID "+ id).c_str());
-
-        bool languageDefined = false;
-        DOMElement* defaultLanguage = NULL;
-
-        if (subelements)
-        {
-            bool paragraphsDefined = false;
-
-            for (DOMNode* cur = optionXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
-            {
-                DialogResponse* response = processResponseClasses(cur, dialogPrototype);
-                if (response)
-                {
-                    option->setResponse(response);
-                }
-                else if (hasNodeName(cur, "if"))
-                {
-                    option->setPrecondition(processIf(static_cast<DOMElement*>(cur)));
-                }
-                else if (hasNodeName(cur, "p"))
-                {
-                    option->addParagraph(processParagraph(static_cast<DOMElement*>(cur)));
-                    paragraphsDefined = true;
-                }
-                // process translations
-                else if (hasNodeName(cur, "t"))
-                {
-                    DOMElement* translation = static_cast<DOMElement*>(cur);
-                    // check loca
-                    if(getAttributeValueAsStdString(translation, "language") 
-                        == ConfigurationManager::getSingleton().getStringSetting("Localization", "language"))
-                    {
-                        defaultLanguage = translation;
-                        processTranslation(option, translation);
-                        std::string label = getAttributeValueAsStdString(translation, "label");
-                        if(!label.empty())
-                        {
-                            option->setLabel(label);
-                        }
-                        languageDefined = true;
-                    }
-                    // set german as default language
-                    if(getAttributeValueAsStdString(translation, "language") == "de")
-                    {
-                        defaultLanguage = translation;
-                    }
-                    paragraphsDefined = true;
-                }
-            }
-
-            if (!paragraphsDefined)
-            {
-                CeGuiString optionXmlText = getValueAsString(optionXml);
-                option->addParagraph(new DialogParagraph(optionXmlText));
-            }
-        }
-        // use german as the default language if german is not set as
-        // default language but no other language was found!
-        if(!languageDefined && defaultLanguage != NULL 
-            && ConfigurationManager::getSingleton().getStringSetting("Localization", "language") != "de")
-        {
-            processTranslation(option, defaultLanguage);
-            std::string label = getAttributeValueAsStdString(defaultLanguage, "label");
-            if(!label.empty())
-            {
-                option->setLabel(label);
-            }
-            languageDefined = true;
-        }
-
-        return option;
-    }
-
-    DialogOption* DialogManager::processSwitchOption(DOMElement *switchOptXml, DialogManager::DialogPrototype *dialogPrototype)
-    {
-        CeGuiString id = getAttributeValueAsString(switchOptXml, "id");
-        DialogOptionSelection* option = dynamic_cast<DialogOptionSelection*>(dialogPrototype->getOption(id));
-
-        if (!option) Throw(IllegalArgumentException, CeGuiString("No switchoption with ID "+ id).c_str());
-
-        for (DOMNode* cur = switchOptXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
-        {
-            DialogVariable* variable = processVariableClasses(static_cast<DOMElement*>(cur));
-            if (variable != NULL)
-            {
-                option->setVariable(variable);
-            }
-            else if (hasNodeName(cur, "case"))
-            {
-                DialogCondition* condition = processCase(static_cast<DOMElement*>(cur));
-                for (DOMNode* caseChild = cur->getFirstChild(); caseChild != NULL; caseChild = caseChild->getNextSibling())
-                {
-                    DialogOption* optionCase = processOptionClasses(caseChild, dialogPrototype);
-                    if (optionCase)
-                    {
-                         option->addElement(condition, optionCase);
-                         break;
-                    }
-                }               
-            }
-            // process translations
-            else if (hasNodeName(cur, "t"))
-            {
-                DOMElement* translation = static_cast<DOMElement*>(cur);
-                // check loca
-                if(getAttributeValueAsStdString(translation, "language") == 
-                    ConfigurationManager::getSingleton().getStringSetting("Localization", "language"))
-                {
-                    std::string label = getAttributeValueAsStdString(translation, "label");
-                    if(!label.empty())
-                    {
-                        option->setLabel(label);
-                    }
-                } 
-            }
-        }
-            
-        return option;
-    }
-
-    void DialogManager::createDialogVariable(DOMElement *variableXml, DialogManager::DialogPrototype *dialogPrototype)
-    {
-        XmlPropertyReader reader;
-        PropertyEntry entry = reader.processProperty(variableXml);
-        dialogPrototype->setProperty(entry.first, entry.second);
-    }
-
-    DialogCondition* DialogManager::processIf(DOMElement *ifXml)
-    {
-        DialogCondition* cond = NULL;
-        DialogVariable* var = NULL;
-
-        for (DOMNode* cur = ifXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
-        {
-            if (cur->getNodeType() == DOMNode::ELEMENT_NODE)
-            {
-                DOMElement* curElem = static_cast<DOMElement*>(cur);
-
-                DialogCondition* curCond = processConditionClasses(curElem);
-                if (curCond)
-                {
-                    cond = curCond;
-                }
-
-                DialogVariable* curVar = processVariableClasses(curElem);
-                if (curVar)
-                {
-                    var = curVar;
-                }
-            }
-        }
-
-        cond->setVariable(var);
-        return cond;
-    }
-
-    DialogParagraph* DialogManager::processParagraph(DOMElement* paragraphXml)
-    {
-        Ogre::String voicefile = "";
-        if (hasAttribute(paragraphXml, "voicefile"))
-        {
-            voicefile = getAttributeValueAsStdString(paragraphXml, "voicefile");
-        }
-        return new DialogParagraph(getValueAsString(paragraphXml), voicefile);
-    }
-
-    DialogCondition* DialogManager::processCase(DOMElement *caseXml)
-    {
-        DialogCondition* cond = NULL;
-
-        for (DOMNode* cur = caseXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
-        {
-            if (cur->getNodeType() == DOMNode::ELEMENT_NODE)
-            {
-                DialogCondition* curCond = processConditionClasses(static_cast<DOMElement*>(cur));
-                if (curCond)
-                {
-                    cond = curCond;
-                }
-            }
-        }
-
-        return cond;
-    }
-
-    Dialog* DialogManager::createDialog(const Ogre::String& name, Creature* npc, Creature* pc)
-    {
-        std::vector<Creature*> npcs;
-        npcs.push_back(npc);
-        std::vector<Creature*> pcs;
-        pcs.push_back(pc);
-
-        return createDialog(name, npcs, pcs);
-    }
-
-    Dialog* DialogManager::createDialog(const Ogre::String& name, const std::vector<Creature*>& pcs, const std::vector<Creature*>& npcs)
-    {
-        std::map<DialogConfiguration, Dialog*>::iterator it 
-            = mDialogStates.find(DialogConfiguration(name, npcs));
-
-        Dialog* dialog;
-        if (it != mDialogStates.end())
-        {
-            dialog = (*it).second;
-        }
-        else 
-        {
-            std::map<Ogre::String, DialogPrototype*>::iterator it = mDialogs.find(name);
-            if (it == mDialogs.end())
-            {
-                return NULL;
-            }
-
-            dialog = it->second->createDialog(pcs, npcs); ///@todo save dialogs
-            dialog->initialize();
-            mDialogStates[DialogConfiguration(name, npcs)] = dialog;
-        }
-		return dialog;
-    }
-
-    DialogManager::DialogPrototype::DialogPrototype()
-    {
-    }
-
-    DialogManager::DialogPrototype::~DialogPrototype()
-    {
-        std::map<CeGuiString, DialogOption*>::iterator it;
-        for( it = mOptionCache.begin(); it != mOptionCache.end(); it++ )
-            if( it->second != NULL )
-                delete it->second;
-
-        std::map<CeGuiString, DialogResponse*>::iterator it1;
-        for( it1 = mResponseCache.begin(); it1 != mResponseCache.end(); it1++ )
-            if( it1->second != NULL )
-                delete it1->second;
-    }
-
-    void DialogManager::DialogPrototype::addOption(DialogOption* option)
-    {
-        if (mOptionCache.find(option->getId()) != mOptionCache.end())
-        {
-            Throw(IllegalArgumentException, 
-                CeGuiString("Duplicate option/switchoption ID "+ option->getId()).c_str());
-        }
-        mOptionCache[option->getId()] = option;
-    }
-
-    DialogOption* DialogManager::DialogPrototype::getOption(const CeGuiString& id) const
-    {
-        std::map<CeGuiString, DialogOption*>::const_iterator it = mOptionCache.find(id);
-        if (it == mOptionCache.end())
-        {
-            return NULL;
-        }
-        return it->second;
-    }
-
-    void DialogManager::DialogPrototype::addResponse(DialogResponse* response)
-    {
-        if (mResponseCache.find(response->getId()) != mResponseCache.end())
-        {
-            Throw(IllegalArgumentException, 
-                CeGuiString("Duplicate Response/switchResponse ID "+ response->getId()).c_str());
-        }
-        mResponseCache[response->getId()] = response;
-    }
-
-    DialogResponse* DialogManager::DialogPrototype::getResponse(const CeGuiString& id) const
-    {
-        std::map<CeGuiString, DialogResponse*>::const_iterator it = mResponseCache.find(id);
-        if (it == mResponseCache.end())
-        {
-            return NULL;
-        }
-        return it->second;
-    }
-
-    Dialog* DialogManager::DialogPrototype::createDialog(const std::vector<Creature*>& pcs, const std::vector<Creature*>& npcs)
-    {
-        Dialog* dialog = new Dialog(pcs, npcs);
-        dialog->setStartResponse(mDialogStart);
-        
-        for (PropertyRecord::PropertyRecordMap::const_iterator it = mPropertyVariables.begin(); 
-            it != mPropertyVariables.end(); ++it)
-        {
-            dialog->setProperty(it->first, it->second);
-        }
-
-        return dialog;
-    }
-
-    void DialogManager::DialogPrototype::setProperty(const CeGuiString& key, const Property& value)
-    {
-        mPropertyVariables.setProperty(key, value);
-    }
-
-    void DialogManager::DialogPrototype::setStartResponse(DialogResponse* start)
-    {
-        mDialogStart = start;
-    }
-
-    DialogManager::DialogConfiguration::DialogConfiguration(const Ogre::String& name, const std::vector<Creature*>& npcs)
-        : mDialogName(name), mNpcs(npcs)
-    {
-    }
-
-    const Ogre::String& DialogManager::DialogConfiguration::getName() const
-    {
-        return mDialogName;
-    }
-
-    const std::vector<Creature*>& DialogManager::DialogConfiguration::getNpcs() const
-    {
-        return mNpcs;
-    }
-
-    bool DialogManager::DialogConfiguration::operator <(const rl::DialogManager::DialogConfiguration & other) const
-    {
-        return mDialogName < other.mDialogName;
-    }
-
-    bool DialogManager::DialogConfiguration::operator ==(const rl::DialogManager::DialogConfiguration & other) const
-    {
-        return (mDialogName == other.mDialogName) 
-            && (mNpcs == other.mNpcs);
-    }
-
-    DialogCondition* DialogManager::processConditionClasses(DOMElement* conditionXml)
-    {
-        if (hasNodeName(conditionXml, "equals"))
-        {
-            return new DialogConditionEquals(
-                getAttributeValueAsString(conditionXml, "value"));
-        }
-        else if (hasNodeName(conditionXml, "inrange"))
-        {
-            return new DialogConditionInRange(
-                getAttributeValueAsReal(conditionXml, "from"),
-                getAttributeValueAsReal(conditionXml, "to"));
-        }
-        else if (hasNodeName(conditionXml, "lower"))
-        {
-            return new DialogConditionLowerThan(
-                getAttributeValueAsReal(conditionXml, "value"));
-        }
-        else if (hasNodeName(conditionXml, "lowereq"))
-        {
-            return new DialogConditionLowerOrEquals(
-                getAttributeValueAsReal(conditionXml, "value"));
-        }
-        else if (hasNodeName(conditionXml, "greater"))
-        {
-            return new DialogConditionGreaterThan(
-                getAttributeValueAsReal(conditionXml, "value"));
-        }
-        else if (hasNodeName(conditionXml, "greatereq"))
-        {
-            return new DialogConditionGreaterOrEquals(
-                getAttributeValueAsReal(conditionXml, "value"));
-        }
-
-        return NULL;
-    }
-
-    DialogVariable* DialogManager::processVariableClasses(DOMElement* variableXml)
-    {
-        if (hasNodeName(variableXml, "dialogvariable"))
-        {
-            return new DialogPropertyVariable(getAttributeValueAsStdString(variableXml, "name"));
-        }
-        else if (hasNodeName(variableXml, "queststate"))
-        {
-            Ogre::String questId = getAttributeValueAsStdString(variableXml, "quest");
-            Ogre::String prop = getAttributeValueAsStdString(variableXml, "property");
-            return new QuestStateVariable(questId, prop);
-        }
-        else if (hasNodeName(variableXml, "attributecheck"))
-        {
-            CeGuiString attr = getAttributeValueAsString(variableXml, "attribute");
-            CeGuiString target = getAttributeValueAsString(variableXml, "target");
-            int modifier = 0;
-            if (hasAttribute(variableXml, "modifier"))
-            {
-                modifier = getAttributeValueAsInteger(variableXml, "modifier");
-            }
-            return new EigenschaftsProbeVariable(attr, modifier, target);
-        }
-        else if (hasNodeName(variableXml, "talentcheck"))
-        {
-            CeGuiString attr = getAttributeValueAsString(variableXml, "talent");
-            CeGuiString target = getAttributeValueAsString(variableXml, "target");
-            int modifier = 0;
-            if (hasAttribute(variableXml, "modifier"))
-            {
-                modifier = getAttributeValueAsInteger(variableXml, "modifier");
-            }
-            return new TalentProbeVariable(attr, modifier, target);
-        }
-
-        return NULL;
-    }
-
-
-    DialogImplication* DialogManager::processImplicationClasses(DOMNode* implicationXml)
-    {
-        if (implicationXml->getNodeType() == DOMNode::ELEMENT_NODE)
-        {
-            DOMElement* implicationElem = static_cast<DOMElement*>(implicationXml);
-
-            if (hasNodeName(implicationElem, "setvariable"))
-            {
-                Ogre::String variableName = getAttributeValueAsStdString(implicationElem, "name");
-                CeGuiString variableValue = getAttributeValueAsString(implicationElem, "value");
-                return new DialogVariableAssignment(variableName, variableValue);
-            }
-            else if (hasNodeName(implicationElem, "incvariable"))
-            {
-                Ogre::String variableName = getAttributeValueAsStdString(implicationElem, "name");
-                CeGuiString variableValue = getAttributeValueAsString(implicationElem, "value");
-                return new DialogVariableIncrease(variableName, variableValue);
-            }
-            else if (hasNodeName(implicationElem, "decvariable"))
-            {
-                Ogre::String variableName = getAttributeValueAsStdString(implicationElem, "name");
-                CeGuiString variableValue = getAttributeValueAsString(implicationElem, "value");
-                return new DialogVariableDecrease(variableName, variableValue);
-            }
-            else if (hasNodeName(implicationElem, "setoptionactive"))
-            {
-                CeGuiString id = getAttributeValueAsString(implicationElem, "id");
-                bool value = getAttributeValueAsBool(implicationElem, "value");
-                return new DialogElementActivation(id, value, true);
-            }
-			else if (hasNodeName(implicationElem, "exit"))
-			{
-				return new DialogExit();
-			}
-            else if (hasNodeName(implicationElem, "changequest"))
-            {
-                Ogre::String questId = getAttributeValueAsStdString(implicationElem, "quest");
-                Ogre::String prop = getAttributeValueAsStdString(implicationElem, "property");
-                CeGuiString newvalue = getAttributeValueAsString(implicationElem, "newvalue");
-                return new QuestPropertyAssignment(questId, prop, newvalue);
-            }
-        }
-
-        return NULL;
-    }
-
-    void DialogManager::processTranslation(DialogElement* element, DOMNode* translationXml)
-    {
-        for (DOMNode* cur = translationXml->getFirstChild(); cur != NULL; cur = cur->getNextSibling())
-        {
-            if (hasNodeName(cur, "p"))
-            {
-                element->addParagraph(processParagraph(static_cast<DOMElement*>(cur)));
-            }
-        }
-    }
-}
+/* This source file is part of Rastullahs Lockenpracht.
+ * Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+ * 
+ *  This program is free software; you can redistribute it and/or modify
+ *  it under the terms of the Clarified Artistic License.
+ *
+ *  This program is distributed in the hope that it will be useful,
+ *  but WITHOUT ANY WARRANTY; without even the implied warranty of
+ *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ *  Clarified Artistic License for more details.
+ *
+ *  You should have received a copy of the Clarified Artistic License
+ *  along with this program; if not you can get it here
+ *  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+ */
+#include "stdinc.h"
+
+#include "DialogManager.h"
+
+
+#include "Creature.h"
+#include "Dialog.h"
+#include "DialogLoader.h"
+#include "GameObjectManager.h"
+#include "SaveGameManager.h"
+
+using namespace Ogre;
+using namespace XERCES_CPP_NAMESPACE;
+
+template<>
+    rl::DialogManager* Ogre::Singleton<rl::DialogManager>::ms_Singleton = NULL;
+
+namespace rl
+{
+    const Ogre::String DialogManager::PROPERTY_DIALOGS = "dialogs";
+    const Ogre::String DialogManager::PROPERTY_DIALOG = "dialog";
+    const Ogre::String DialogManager::PROPERTY_DIALOG_NAME = "name";
+    const Ogre::String DialogManager::PROPERTY_NPCS = "npc";
+
+    DialogManager::DialogManager()
+    {
+		mDialogLoader = new DialogLoader();
+		Ogre::ResourceGroupManager::getSingleton()._registerScriptLoader(
+			mDialogLoader);
+        SaveGameManager::getSingleton().registerSaveGameData(this);
+    }
+
+    DialogManager::~DialogManager()
+    {
+		Ogre::ResourceGroupManager::getSingleton()._unregisterScriptLoader(
+			mDialogLoader);
+		delete mDialogLoader;
+        SaveGameManager::getSingleton().unregisterSaveGameData(this);
+		std::map<DialogConfiguration, Dialog*>::iterator itr = mDialogStates.begin();
+		std::map<DialogConfiguration, Dialog*>::iterator end = mDialogStates.end();
+		for(; itr != end; ++itr)
+		{
+			delete itr->second;
+		}
+		mDialogStates.clear();
+    }
+
+
+    const Property DialogManager::getProperty(const CeGuiString& key) const
+    {
+        if (key == DialogManager::PROPERTY_DIALOGS)
+        {
+            PropertyArray vec;
+            for (std::map<DialogConfiguration, Dialog*>::const_iterator it
+                = mDialogStates.begin(); it != mDialogStates.end(); ++it)
+            {
+                PropertyMap curDialogProp;
+                PropertyRecordPtr dialogProps = it->second->getAllProperties();
+                curDialogProp[DialogManager::PROPERTY_DIALOG] = dialogProps->toPropertyMap();
+                curDialogProp[DialogManager::PROPERTY_DIALOG_NAME] = Property(it->first.getName());
+
+                PropertyArray npcs;
+
+                for (std::vector<Creature*>::const_iterator itNpc = it->first.getNpcs().begin();
+                    itNpc != it->first.getNpcs().end(); ++itNpc)
+                {
+                    npcs.push_back(GameObjectManager::getSingleton().toProperty(*itNpc));
+                }
+
+                curDialogProp[DialogManager::PROPERTY_NPCS] = Property(npcs);
+            }
+
+            return Property(vec);
+        }
+
+        Throw(IllegalArgumentException, key + " is not a property of DialogManager");
+    }
+	
+	int DialogManager::getPriority() const
+	{
+		return 50;
+	}
+
+    PropertyKeys DialogManager::getAllPropertyKeys() const
+    {
+        PropertyKeys keys;
+        keys.insert(DialogManager::PROPERTY_DIALOGS);
+        return keys;
+    }
+
+    void DialogManager::setProperty(const CeGuiString& key, const Property& value)
+    {
+        ///@todo implement
+    }
+
+    void DialogManager::writeData(SaveGameFileWriter *writer)
+    {
+        LOG_MESSAGE(Logger::RULES, "Saving dialogs");
+
+        PropertyRecordPtr set = getAllProperties();
+        writer->writeEachProperty(this, set->toPropertyMap());
+    }
+
+    void DialogManager::readData(SaveGameFileReader* reader)
+    {
+        LOG_MESSAGE(Logger::RULES, "Loading dialogs");
+
+        PropertyRecordPtr properties = reader->getAllPropertiesAsRecord(this);
+        setProperties(properties);
+    }
+
+    CeGuiString DialogManager::getXmlNodeIdentifier() const
+    {
+        return "dialogs";
+    }
+
+    Dialog* DialogManager::createDialog(const Ogre::String& name, Creature* npc, Creature* pc)
+    {
+        std::vector<Creature*> npcs;
+        npcs.push_back(npc);
+        std::vector<Creature*> pcs;
+        pcs.push_back(pc);
+
+        return createDialog(name, npcs, pcs);
+    }
+
+    Dialog* DialogManager::createDialog(const Ogre::String& name, const std::vector<Creature*>& pcs, const std::vector<Creature*>& npcs)
+    {
+        std::map<DialogConfiguration, Dialog*>::iterator it 
+            = mDialogStates.find(DialogConfiguration(name, npcs));
+
+        Dialog* dialog;
+        if (it != mDialogStates.end())
+        {
+            dialog = (*it).second;
+        }
+        else 
+        {
+			dialog = mDialogLoader->createDialog(name, pcs, npcs); ///@todo save dialogs
+			
+			if (!dialog) 
+			{
+				return NULL;
+			}
+			
+            dialog->initialize();
+            mDialogStates[DialogConfiguration(name, npcs)] = dialog;
+        }
+		return dialog;
+    }
+	
+    DialogManager::DialogConfiguration::DialogConfiguration(const Ogre::String& name, const std::vector<Creature*>& npcs)
+        : mDialogName(name), mNpcs(npcs)
+    {
+    }
+
+    const Ogre::String& DialogManager::DialogConfiguration::getName() const
+    {
+        return mDialogName;
+    }
+
+    const std::vector<Creature*>& DialogManager::DialogConfiguration::getNpcs() const
+    {
+        return mNpcs;
+    }
+
+    bool DialogManager::DialogConfiguration::operator <(const rl::DialogManager::DialogConfiguration & other) const
+    {
+        return mDialogName < other.mDialogName;
+    }
+
+    bool DialogManager::DialogConfiguration::operator ==(const rl::DialogManager::DialogConfiguration & other) const
+    {
+        return (mDialogName == other.mDialogName) 
+            && (mNpcs == other.mNpcs);
+    }
+
+
+}

Modified: rl/trunk/engine/ai/src/Makefile.am
===================================================================
--- rl/trunk/engine/ai/src/Makefile.am	2008-07-11 19:42:39 UTC (rev 4445)
+++ rl/trunk/engine/ai/src/Makefile.am	2008-07-11 19:59:08 UTC (rev 4446)
@@ -21,6 +21,7 @@
 	DialogCondition.cpp \
 	DialogElement.cpp \
 	DialogImplication.cpp \
+	DialogLoader.cpp \
 	DialogManager.cpp \
 	DialogOption.cpp \
 	DialogParagraph.cpp \



From blakharaz at mail.berlios.de  Fri Jul 11 22:02:50 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Fri, 11 Jul 2008 22:02:50 +0200
Subject: [Dsa-hl-svn] r4447 - in rl/trunk/engine/ai: include src
Message-ID: <200807112002.m6BK2odb011228@sheep.berlios.de>

Author: blakharaz
Date: 2008-07-11 22:02:48 +0200 (Fri, 11 Jul 2008)
New Revision: 4447

Modified:
   rl/trunk/engine/ai/include/DialogVariable.h
   rl/trunk/engine/ai/src/DialogLoader.cpp
   rl/trunk/engine/ai/src/DialogVariable.cpp
Log:
Added RandomVariable to dialog

Modified: rl/trunk/engine/ai/include/DialogVariable.h
===================================================================
--- rl/trunk/engine/ai/include/DialogVariable.h	2008-07-11 19:59:08 UTC (rev 4446)
+++ rl/trunk/engine/ai/include/DialogVariable.h	2008-07-11 20:02:48 UTC (rev 4447)
@@ -95,6 +95,18 @@
         CeGuiString mTarget;
         int mModifier;
     };
+	
+	class RandomVariable : public DialogVariable
+	{
+	public:
+		RandomVariable(int maximum);
+		
+	protected:
+		virtual Property calculateValue(Dialog* dialog);
+		
+	private:
+		int mMaximum;
+	};
 }
 
 #endif //__DialogVariable_H__

Modified: rl/trunk/engine/ai/src/DialogLoader.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogLoader.cpp	2008-07-11 19:59:08 UTC (rev 4446)
+++ rl/trunk/engine/ai/src/DialogLoader.cpp	2008-07-11 20:02:48 UTC (rev 4447)
@@ -674,6 +674,11 @@
             }
             return new TalentProbeVariable(attr, modifier, target);
         }
+		else if (hasNodeName(variableXml, "random"))
+		{
+			int maximum = getAttributeValueAsInteger(variableXml, "maximum");
+			return new RandomVariable(maximum);
+		}
 
         return NULL;
     }

Modified: rl/trunk/engine/ai/src/DialogVariable.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogVariable.cpp	2008-07-11 19:59:08 UTC (rev 4446)
+++ rl/trunk/engine/ai/src/DialogVariable.cpp	2008-07-11 20:02:48 UTC (rev 4447)
@@ -117,4 +117,15 @@
         if(cr == NULL) { cr = dialog->getPc(0);}
         return Property(cr->doEigenschaftsprobe(mEigenschaft, mModifier));
     }
+	
+	RandomVariable::RandomVariable(int maximum)
+		: DialogVariable("random"), mMaximum(maximum)
+	{
+	}
+	
+	Property RandomVariable::calculateValue(Dialog* dialog)
+	{
+		double d = std::rand();
+        return Property(static_cast<int>(d * mMaximum / RAND_MAX) + 1);
+	}
 }



From melven at mail.berlios.de  Mon Jul 14 15:41:25 2008
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Mon, 14 Jul 2008 15:41:25 +0200
Subject: [Dsa-hl-svn] r4448 - rl/branches
Message-ID: <200807141341.m6EDfPWX018054@sheep.berlios.de>

Author: melven
Date: 2008-07-14 15:41:24 +0200 (Mon, 14 Jul 2008)
New Revision: 4448

Added:
   rl/branches/newton20/
Log:
Add branch for newton2.0


Copied: rl/branches/newton20 (from rev 4447, rl/trunk)



From melven at mail.berlios.de  Mon Jul 14 15:46:10 2008
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Mon, 14 Jul 2008 15:46:10 +0200
Subject: [Dsa-hl-svn] r4449 - in rl/branches/newton20/engine: ai/src
	core/include core/src rules/include rules/src script/src
	ui/include ui/src
Message-ID: <200807141346.m6EDkAKY018367@sheep.berlios.de>

Author: melven
Date: 2008-07-14 15:45:55 +0200 (Mon, 14 Jul 2008)
New Revision: 4449

Modified:
   rl/branches/newton20/engine/ai/src/PhysicalObstacle.cpp
   rl/branches/newton20/engine/core/include/GameEventManager.h
   rl/branches/newton20/engine/core/include/GameLoop.h
   rl/branches/newton20/engine/core/include/PhysicalThing.h
   rl/branches/newton20/engine/core/include/PhysicsController.h
   rl/branches/newton20/engine/core/include/PhysicsGenericContactCallback.h
   rl/branches/newton20/engine/core/include/PhysicsManager.h
   rl/branches/newton20/engine/core/src/DotSceneLoader.cpp
   rl/branches/newton20/engine/core/src/GameEventManager.cpp
   rl/branches/newton20/engine/core/src/GameLoop.cpp
   rl/branches/newton20/engine/core/src/PhysicalThing.cpp
   rl/branches/newton20/engine/core/src/PhysicsGenericContactCallback.cpp
   rl/branches/newton20/engine/core/src/PhysicsManager.cpp
   rl/branches/newton20/engine/rules/include/CreatureController.h
   rl/branches/newton20/engine/rules/include/CreatureControllerManager.h
   rl/branches/newton20/engine/rules/src/CreatureController.cpp
   rl/branches/newton20/engine/rules/src/CreatureControllerManager.cpp
   rl/branches/newton20/engine/rules/src/RotateMovement.cpp
   rl/branches/newton20/engine/rules/src/StandAroundMovement.cpp
   rl/branches/newton20/engine/script/src/EntityNodeProcessor.cpp
   rl/branches/newton20/engine/ui/include/FreeflightControlState.h
   rl/branches/newton20/engine/ui/include/MovementControlState.h
   rl/branches/newton20/engine/ui/src/ControlState.cpp
   rl/branches/newton20/engine/ui/src/FreeflightControlState.cpp
   rl/branches/newton20/engine/ui/src/MovementControlState.cpp
Log:
changes for newton2.0 ... not completely working yet, (ogrenewt for newton2.0 needed to use this, if you want to try this branch, ask me)


Modified: rl/branches/newton20/engine/ai/src/PhysicalObstacle.cpp
===================================================================
--- rl/branches/newton20/engine/ai/src/PhysicalObstacle.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/ai/src/PhysicalObstacle.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -70,8 +70,8 @@
         Quaternion orientation;
         body->getPositionOrientation(position, orientation);
 
-    	OgreNewt::CollisionPtr collision = body->getCollision();
-    	RlAssert(collision.getPointer(), "Body has no collision!");
+    	const OgreNewt::Collision* collision = body->getCollision();
+    	RlAssert(collision, "Body has no collision!");
     	AxisAlignedBox box = collision->getAABB();
     	Ogre::Vector3 dims = box.getMaximum() - box.getMinimum();
     	OpenSteer::BoxObstacle *obstacle = new OpenSteer::BoxObstacle(dims[0], dims[1], dims[2]);

Modified: rl/branches/newton20/engine/core/include/GameEventManager.h
===================================================================
--- rl/branches/newton20/engine/core/include/GameEventManager.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/include/GameEventManager.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -131,7 +131,7 @@
 
 
     /// newton collision callback function
-    int userProcess();
+    int userProcess(Ogre::Real timestep, int threadid);
 
     /// notify about newton world update
     void notifyNewtonWorldUpdate();

Modified: rl/branches/newton20/engine/core/include/GameLoop.h
===================================================================
--- rl/branches/newton20/engine/core/include/GameLoop.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/include/GameLoop.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -116,6 +116,7 @@
     unsigned long mSmoothedFrames;
     /// Time cap for frame time, to prevent interpolation problems during spikes.
     Ogre::Real mMaxFrameTime;
+    Ogre::Real mMinFrameTime;
     bool mQuitRequested;
     bool mPaused;
 

Modified: rl/branches/newton20/engine/core/include/PhysicalThing.h
===================================================================
--- rl/branches/newton20/engine/core/include/PhysicalThing.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/include/PhysicalThing.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -120,7 +120,7 @@
         void _detachFromSceneNode(Ogre::SceneNode* node);
 
 		/** ForceCallback for mBody (OgreNewt::Body). */
-        void onApplyForceAndTorque();
+        void onApplyForceAndTorque(float timeStep);
         void addForce(const Ogre::Vector3& force);
 
         void freeze();

Modified: rl/branches/newton20/engine/core/include/PhysicsController.h
===================================================================
--- rl/branches/newton20/engine/core/include/PhysicsController.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/include/PhysicsController.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -39,7 +39,7 @@
 		 * to be applied to the associated PhysicalThing object.
 		 * @param thing PhysicalThing to apply force and torque to.
 		 */
-        virtual void OnApplyForceAndTorque(PhysicalThing* thing) = 0;
+        virtual void OnApplyForceAndTorque(PhysicalThing* thing, float timestep) = 0;
     };
 }
 

Modified: rl/branches/newton20/engine/core/include/PhysicsGenericContactCallback.h
===================================================================
--- rl/branches/newton20/engine/core/include/PhysicsGenericContactCallback.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/include/PhysicsGenericContactCallback.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -32,7 +32,7 @@
     {
     public:
         int userBegin();
-        int userProcess();
+        int userProcess( Ogre::Real timeStep, int threadid);
         /// This function calls the contact listeners. So any specialised listener overriding
         /// this one, has to call it explicitly.
         void userEnd();

Modified: rl/branches/newton20/engine/core/include/PhysicsManager.h
===================================================================
--- rl/branches/newton20/engine/core/include/PhysicsManager.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/include/PhysicsManager.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -143,11 +143,11 @@
         // Newton callbacks ...
         /// generic force callback. Gravity is applied and the force,
         /// applied via PhysicalThing interface.
-        static void genericForceCallback(OgreNewt::Body* body);
+        static void genericForceCallback(OgreNewt::Body* body, float timeStep, int threadIndex);
 
         /// special force callback for controlled characters (or monsters even)
         /// those bodies have up vector and are controlled using inverse dynamics
-        static void controlledForceCallback(OgreNewt::Body* body);
+        static void controlledForceCallback(OgreNewt::Body* body, float timeStep, int threadIndex);
 
         OgreNewt::World* _getNewtonWorld() const;
 
@@ -288,6 +288,7 @@
         struct CollisionInUse
         {
         public:
+            CollisionInUse() : colPtr(NULL), geomType(GT_NONE) {}
             GeometryType geomType;  //! primitive type
             OgreNewt::CollisionPtr colPtr;          //! the collision primitve
         };

Modified: rl/branches/newton20/engine/core/src/DotSceneLoader.cpp
===================================================================
--- rl/branches/newton20/engine/core/src/DotSceneLoader.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/src/DotSceneLoader.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -492,7 +492,7 @@
                 child = child->getNextSibling();
                 continue;
             }
-            collision.setNull();
+            collision = NULL;
             // am Anfang steht ein Node mit dem Typ
             std::string typeAsString = transcodeToStdString(child->getNodeName());
 
@@ -701,21 +701,21 @@
                 {
                     LOG_MESSAGE(Logger::CORE,
                         " Mesh-Collisions in <collisions> werden momentan noch nicht unterst?tzt (Eintrag wird ignoriert).");
-                    collision.setNull();
+                    collision = NULL;
                 }
 /*
                 else if (typeAsString.compare("meshhull") == 0)  // automatische convexhull mit daten aus mesh
                 {
                     LOG_MESSAGE(Logger::CORE,
                         " Entityhull-Collisions werden momentan noch nicht unterst?tzt (Eintrag wird ignoriert).");
-                    collision.setNull();
+                    collision = NULL;
                 }
 */
                 else
                 {
                     LOG_MESSAGE(Logger::CORE,
                         " > Parse Error beim Erstellen einer Collision; ung?ltiger typ: '"+typeAsString+"' !");
-                    collision.setNull();
+                    collision = NULL;
                     //return OgreNewt::CollisionPtr(NULL);
                 }
 
@@ -723,7 +723,7 @@
 
 
             // Collision dem vektor hinzuf?gen
-            if (!collision.isNull())
+            if (collision != NULL)
                 mCollisions.push_back(collision);
 
             child = child->getNextSibling();
@@ -868,9 +868,7 @@
                 {
                     collision = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::ConvexHull(
                                     thisWorld,
-                                    newEnt,
-                                    false));
-                    //orientation, pos));
+                                    newEnt));
                     LOG_DEBUG(Logger::CORE, " physical_body 'convexhull' f?r Entity '"+entName+"' erstellt. ");
                 }
                 else if (physical_body.compare("mesh") == 0 || physical_body.compare("auto"))
@@ -891,7 +889,7 @@
         }
 
         // zur liste hinzuf?gen
-        if (!collision.isNull())
+        if (collision != NULL)
         {
             mCollisions.push_back(collision);
         }
@@ -906,7 +904,7 @@
 
 
         // wieder aus der liste entfernen, falls mehrere entities hier definiert werden
-        if (!collision.isNull())
+        if (collision != NULL)
         {
             mCollisions.pop_back();
         }

Modified: rl/branches/newton20/engine/core/src/GameEventManager.cpp
===================================================================
--- rl/branches/newton20/engine/core/src/GameEventManager.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/src/GameEventManager.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -50,7 +50,7 @@
         physicsManager->createMaterialPair(area_mat, lev_mat)->setDefaultCollidable(0);// ->setContactCallback(this);
 
         // set collision-debug color
-        physicsManager->getNewtonDebugger()->setMaterialColor(area_mat, Ogre::ColourValue::Green);
+        //physicsManager->getNewtonDebugger()->setMaterialColor(area_mat, Ogre::ColourValue::Green);
     }
 
     GameEventManager::~GameEventManager( )
@@ -275,7 +275,7 @@
         return NAME;
     }
 
-    int GameEventManager::userProcess()
+    int GameEventManager::userProcess(Real timestep, int)
     {
         NewtonBodyGameAreaMap::iterator it = mBodyGameAreaMap.find(m_body0);
         if( it != mBodyGameAreaMap.end() )

Modified: rl/branches/newton20/engine/core/src/GameLoop.cpp
===================================================================
--- rl/branches/newton20/engine/core/src/GameLoop.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/src/GameLoop.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -40,6 +40,7 @@
           mLastTimes(),
           mSmoothedFrames(3),
           mMaxFrameTime(0.1f),
+          mMinFrameTime(1.0/60),
           mQuitRequested(false),
           mPaused(false)
     {
@@ -138,6 +139,16 @@
         if( elapsedTime < mGameTime )
             unsmoothedFrameTime = 1;
 
+        if( unsmoothedFrameTime < mMinFrameTime*1000 )
+        {
+            usleep(floor(1000*(mMinFrameTime*1000 - unsmoothedFrameTime)));
+            elapsedTime = mTimer->getMilliseconds();
+            unsmoothedFrameTime = elapsedTime - mGameTime;
+            if( elapsedTime < mGameTime )
+                unsmoothedFrameTime = 1;
+        }
+
+
         if( unsmoothedFrameTime > mMaxFrameTime*1000 )
         {
             LOG_DEBUG(Logger::CORE, "The current frame time was truncated at maximum.");

Modified: rl/branches/newton20/engine/core/src/PhysicalThing.cpp
===================================================================
--- rl/branches/newton20/engine/core/src/PhysicalThing.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/src/PhysicalThing.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -145,7 +145,7 @@
 
     void PhysicalThing::_attachToSceneNode(Ogre::SceneNode* node)
     {
-        mBody->attachToNode(node);
+        mBody->attachNode(node);
     }
 
     void PhysicalThing::_attachToBone(MeshObject* object, const std::string& boneName )
@@ -189,7 +189,7 @@
         mUpVectorJoint = NULL;
     }
 
-    void PhysicalThing::onApplyForceAndTorque()
+    void PhysicalThing::onApplyForceAndTorque(float timestep)
     {
         Vector3 gravity = mOverrideGravity ?
             mGravity : PhysicsManager::getSingleton().getGravity();
@@ -199,7 +199,7 @@
 
     void PhysicalThing::addForce(const Ogre::Vector3& force)
     {
-        mBody->unFreeze();
+        //mBody->unFreeze();
         mPendingForce += force;
     }
 
@@ -210,8 +210,10 @@
 
     void PhysicalThing::setMass(Ogre::Real mass)
     {
+        Vector3 inertia;
+        mBody->getMassMatrix(mMass, inertia);
         mMass = mass;
-        mBody->setMass(mass);
+        mBody->setMassMatrix(mass, inertia);
     }
 
     void PhysicalThing::setGravityOverride(bool override, const Vector3& gravity)
@@ -306,12 +308,12 @@
 
     void PhysicalThing::freeze()
     {
-        mBody->freeze();
+        //mBody->freeze();
     }
 
     void PhysicalThing::unfreeze()
     {
-        mBody->unFreeze();
+        //mBody->unFreeze();
     }
 
     void PhysicalThing::setContactListener(PhysicsContactListener* listener)
@@ -482,10 +484,10 @@
         {
             // prepare for control
             mPhysicsController = controller;
-            mBody->setAutoFreeze(0);
-            mBody->unFreeze();
-            mBody->setLinearDamping(0.0f);
-            mBody->setAngularDamping(Vector3::ZERO);
+            //mBody->setAutoFreeze(0);
+            //mBody->unFreeze();
+            //mBody->setLinearDamping(0.0f);
+            //mBody->setAngularDamping(Vector3::ZERO);
 
             mBody->setCustomForceAndTorqueCallback( PhysicsManager::controlledForceCallback );
 

Modified: rl/branches/newton20/engine/core/src/PhysicsGenericContactCallback.cpp
===================================================================
--- rl/branches/newton20/engine/core/src/PhysicsGenericContactCallback.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/src/PhysicsGenericContactCallback.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -20,6 +20,9 @@
 #include "Actor.h"
 #include "PhysicalThing.h"
 
+
+using namespace Ogre;
+
 namespace rl
 {
     int PhysicsGenericContactCallback::userBegin()
@@ -27,7 +30,7 @@
         return 1;
     }
 
-    int PhysicsGenericContactCallback::userProcess()
+    int PhysicsGenericContactCallback::userProcess(Real timeStep, int)
     {
         return 1;
     }

Modified: rl/branches/newton20/engine/core/src/PhysicsManager.cpp
===================================================================
--- rl/branches/newton20/engine/core/src/PhysicsManager.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/core/src/PhysicsManager.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -99,7 +99,7 @@
         // setup level material
         createMaterialID("level");
 
-        mNewtonDebugger->setMaterialColor(getMaterialID("level"), Ogre::ColourValue::Blue);
+        //mNewtonDebugger->setMaterialColor(getMaterialID("level"), Ogre::ColourValue::Blue);
 
         // below here starts 'old' stale fix code that should be removed
 
@@ -306,15 +306,15 @@
 
         for( size_t i = 0; i < collisions.size(); i++)
         {
-		    if( collisions[i].isNull() )
+		    if( collisions[i] == NULL )
                 continue;
 
             OgreNewt::CollisionPtr collision = collisions[i];
 
-		    OgreNewt::Body* body = new OgreNewt::Body(mWorld, collision );
+            OgreNewt::Body* body = new OgreNewt::Body(mWorld, collision );
 
 
-            body->attachToNode(node);
+            body->attachNode(node);
             body->setPositionOrientation(node->getWorldPosition(),
                 node->getWorldOrientation());
             body->setMaterialGroupID(getMaterialID("level"));
@@ -364,26 +364,23 @@
 		*/
     }
 
-    // adopted from the chararcter demo in the newton sdk
-    // copyright 2000-2004
-    // By Julio Jerez
-    void PhysicsManager::genericForceCallback(OgreNewt::Body* body)
+    void PhysicsManager::genericForceCallback(OgreNewt::Body* body, float timestep, int)
     {
         // apply saved forces in the PhysicalThing
         PhysicalThing* thing =
             static_cast<Actor*>(body->getUserData())->getPhysicalThing();
 
-        thing->onApplyForceAndTorque();
+        thing->onApplyForceAndTorque(timestep);
     }
 
-    void PhysicsManager::controlledForceCallback(OgreNewt::Body* body)
+    void PhysicsManager::controlledForceCallback(OgreNewt::Body* body, float timestep, int)
     {
         PhysicalThing* thing =
             static_cast<Actor*>(body->getUserData())->getPhysicalThing();
 
         if (thing->getPhysicsController())
         {
-            thing->getPhysicsController()->OnApplyForceAndTorque(thing);
+            thing->getPhysicsController()->OnApplyForceAndTorque(thing, timestep);
         }
         else
         {
@@ -480,7 +477,8 @@
         CollisionInUse &usedcol (mCollisionPrimitives[collisionName]);
         // log some performance warning if collisionname is equal, but geomtype different ?
 
-        if (! usedcol.colPtr.isNull() )
+        if( false )
+//        if ( usedcol.colPtr != NULL )
         {
             if ( usedcol.geomType != geomType )
             {   // when geometry types mismatch, issue performance warning
@@ -495,7 +493,27 @@
 
                 if( inertia )
                 {
+
                     // we must set inertia here, the calling function doesn't know we are not creating a new collision
+                    switch(usedcol.geomType)
+                    {
+                    case GT_BOX: // from createBox
+                    case GT_CAPSULE: // from createCapsule
+                    case GT_CONVEXHULL: // from createCollisionFromEntity
+                    case GT_ELLIPSOID: // from createEllipsoid
+                    case GT_PYRAMID: // createPyramid
+                    case GT_SPHERE:
+                        {
+                            Vector3 inert_offs=Vector3::ZERO;
+                            static_cast<OgreNewt::ConvexCollision*>(rval)->calculateInertialMatrix(*inertia, inert_offs);
+                        }
+                        break;
+                    case GT_MESH:
+                    case GT_NONE:
+                        *inertia = Ogre::Vector3::ZERO;
+                        break;
+                    }
+/*
                     Ogre::AxisAlignedBox aabb(entity->getBoundingBox());
                     Vector3 size( aabb.getSize() );
                     switch(usedcol.geomType)
@@ -539,11 +557,12 @@
                         }
                         break;
                     }
+*/
                 }
             }
         }
 
-        if (rval.isNull())
+//        if ( rval == NULL )
         {
             // if there is none, then create a new collision object
             rval = mPhysicsCollisionFactory->createCollisionFromEntity(
@@ -568,7 +587,8 @@
         CollisionInUse &usedcol (mCollisionPrimitives[name]);
         // log some performance warning if collisionname is equal, but geomtype different ?
 
-        if (! usedcol.colPtr.isNull() )
+        if( false )
+//        if ( usedcol.colPtr != NULL )
         {
             if ( usedcol.geomType != geomType )
             {   // when geometry types mismatch, issue performance warning
@@ -582,7 +602,7 @@
             }
         }
 
-        if (rval.isNull())
+//        if ( rval == NULL )
         {
             // if there is none, then create a new collision object
             rval = mPhysicsCollisionFactory->createCollisionFromAABB(
@@ -804,14 +824,12 @@
 			// calculate the convex hull of the animated mesh
 			rval = CollisionPtr(new OgreNewt::CollisionPrimitives::ConvexHull(
                 PhysicsManager::getSingleton()._getNewtonWorld(),
-				entity, entity->hasSkeleton(), *orientation, *offset));
+				entity, /*entity->hasSkeleton(),*/ *orientation, *offset));
 
 			if (inertia != NULL)
 			{
-				*inertia = Vector3(
-				size.x*size.x/6.0f,
-				size.y*size.y/6.0f,
-				size.z*size.z/6.0f) * Mass;
+                            Vector3 inert_offs=Vector3::ZERO;
+                            static_cast<OgreNewt::ConvexCollision*>(rval)->calculateInertialMatrix(*inertia, inert_offs);
 			}
         }
         else if (geomType == GT_MESH)
@@ -821,14 +839,14 @@
 
             rval = CollisionPtr(new OgreNewt::CollisionPrimitives::TreeCollision(
                 PhysicsManager::getSingleton()._getNewtonWorld(),
-                entity, false, true));
+                entity, false/*, true */ ));
         }
         else
         {
             Throw(IllegalArgumentException, "unknown geometry type.");
         }
 
-        if (rval.isNull())
+        if ( rval == NULL )
         {
             LOG_DEBUG(Logger::CORE, " creating collision primitiv '"+
                 PhysicsManager::convertGeometryTypeToString(geomType)+"' for Entity '"+
@@ -860,13 +878,18 @@
 			offset = &object_offset;
 		if (! orientation)
 			orientation = &object_orientation;
-        if (inertia)
-            *inertia = OgreNewt::MomentOfInertia::CalcBoxSolid(mass, aabb.getSize());
 
-		// a box collision primitiv has got it's coordinate system at it's center, so we need to shift it
-		return CollisionPtr(new OgreNewt::CollisionPrimitives::Box(
+        // a box collision primitiv has got it's coordinate system at it's center, so we need to shift it
+        OgreNewt::CollisionPtr rval(new OgreNewt::CollisionPrimitives::Box(
             PhysicsManager::getSingleton()._getNewtonWorld(),
             aabb.getSize(), *orientation, *offset));
+        if (inertia)
+        {
+            Vector3 inert_offs=Vector3::ZERO;
+            static_cast<OgreNewt::ConvexCollision*>(rval)->calculateInertialMatrix(*inertia, inert_offs);
+        }
+
+        return rval;
     }
 
     OgreNewt::CollisionPtr PhysicsCollisionFactory::createPyramid(const Ogre::AxisAlignedBox& aabb,
@@ -886,12 +909,17 @@
 			offset = &object_offset;
 		if (! orientation)
 			orientation = &object_orientation;
-        if (inertia)
-            *inertia = Ogre::Vector3(size.x,size.y/2.0f, size.z) * mass;
 
-        return CollisionPtr(new OgreNewt::CollisionPrimitives::Pyramid(
+        OgreNewt::CollisionPtr rval(new OgreNewt::CollisionPrimitives::Pyramid(
             PhysicsManager::getSingleton()._getNewtonWorld(),
             size, *orientation, *offset));
+        if (inertia)
+        {
+            Vector3 inert_offs=Vector3::ZERO;
+            static_cast<OgreNewt::ConvexCollision*>(rval)->calculateInertialMatrix(*inertia, inert_offs);
+        }
+
+        return rval;
     }
 
     OgreNewt::CollisionPtr PhysicsCollisionFactory::createSphere(const Ogre::AxisAlignedBox& aabb,
@@ -914,14 +942,17 @@
 			offset = &object_offset;
 		if (! orientation)
 			orientation = &object_orientation;
+ 
+        // a sphere primitiv has got its coordinate system at its center, so shift it with radius
+        OgreNewt::CollisionPtr rval(new OgreNewt::CollisionPrimitives::Ellipsoid(
+            PhysicsManager::getSingleton()._getNewtonWorld(),
+            Vector3(radius, radius, radius), *orientation, *offset));
         if (inertia)
-            //*inertia = OgreNewt::MomentOfInertia::CalcSphereSolid(Mass,radius);
-            *inertia = mass * Vector3(radius*radius, radius*radius, radius*radius);
-
-		// a sphere primitiv has got its coordinate system at its center, so shift it with radius
-        return CollisionPtr(new OgreNewt::CollisionPrimitives::Ellipsoid(
-    		PhysicsManager::getSingleton()._getNewtonWorld(),
-            Vector3(radius, radius, radius), *orientation, *offset));
+        {
+            Vector3 inert_offs=Vector3::ZERO;
+            static_cast<OgreNewt::ConvexCollision*>(rval)->calculateInertialMatrix(*inertia, inert_offs);
+        }
+        return rval;
     }
 
     OgreNewt::CollisionPtr PhysicsCollisionFactory::createEllipsoid(const Ogre::AxisAlignedBox& aabb,
@@ -945,13 +976,19 @@
 			offset = &object_offset;
 		if (! orientation)
 			orientation = &object_orientation;
-        if (inertia)
-            *inertia = Vector3(s.x*s.x, s.y*s.y, s.z*s.z) * mass;
 
         // an ellipsoid primitiv has got its coordinate system at its center, so shift it with radius
-        return CollisionPtr(new OgreNewt::CollisionPrimitives::Ellipsoid(
+        OgreNewt::CollisionPtr rval(new OgreNewt::CollisionPrimitives::Ellipsoid(
             PhysicsManager::getSingleton()._getNewtonWorld(),
             s, *orientation, *offset));
+
+        if (inertia)
+        {
+            Vector3 inert_offs=Vector3::ZERO;
+            static_cast<OgreNewt::ConvexCollision*>(rval)->calculateInertialMatrix(*inertia, inert_offs);
+        }
+
+        return rval;
     }
 
     OgreNewt::CollisionPtr PhysicsCollisionFactory::createCapsule(const Ogre::AxisAlignedBox& aabb,
@@ -975,16 +1012,21 @@
     		offset = &object_offset;
 		if (! orientation)
 			orientation = &object_orientation;
-        if (inertia) {
-            double sradius = radius*radius;
-			*inertia = Vector3(sradius, size.y*size.y, sradius) * mass;
-        }
 
-		// an capsule primitiv has got its coordinate system at its center, so shift it with radius
-		// additionally it is x axis aligned, so rotate it 90 degrees around z axis
-		return CollisionPtr(new OgreNewt::CollisionPrimitives::Capsule(
+
+        // an capsule primitiv has got its coordinate system at its center, so shift it with radius
+        // additionally it is x axis aligned, so rotate it 90 degrees around z axis
+        OgreNewt::CollisionPtr rval(new OgreNewt::CollisionPrimitives::Capsule(
             PhysicsManager::getSingleton()._getNewtonWorld(),
             radius, height, *orientation, *offset));
+
+        if (inertia)
+        {
+            Vector3 inert_offs=Vector3::ZERO;
+            static_cast<OgreNewt::ConvexCollision*>(rval)->calculateInertialMatrix(*inertia, inert_offs);
+        }
+        return rval;
     }
 
 }
+

Modified: rl/branches/newton20/engine/rules/include/CreatureController.h
===================================================================
--- rl/branches/newton20/engine/rules/include/CreatureController.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/rules/include/CreatureController.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -52,10 +52,10 @@
         bool run(Ogre::Real elapsedTime);
 
         /// Newton force and torque callback
-        void OnApplyForceAndTorque(PhysicalThing* thing);
+        void OnApplyForceAndTorque(PhysicalThing* thing, float timestep);
 
         /// Newton contact callback called by the movingCreatureManager
-        int userProcess();
+        int userProcess(Ogre::Real timestep, int threadid);
 
         Creature* getCreature() {return mCreature;}
         bool refetchCreature();

Modified: rl/branches/newton20/engine/rules/include/CreatureControllerManager.h
===================================================================
--- rl/branches/newton20/engine/rules/include/CreatureControllerManager.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/rules/include/CreatureControllerManager.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -60,7 +60,7 @@
         const Ogre::String& getName() const;
 
         // Newton Contact Callback
-        int userProcess();
+        int userProcess(Ogre::Real timestep, int threadid);
     protected:
         typedef std::map<Creature*, CreatureController*> ControllerMap;
         ControllerMap mControllers;

Modified: rl/branches/newton20/engine/rules/src/CreatureController.cpp
===================================================================
--- rl/branches/newton20/engine/rules/src/CreatureController.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/rules/src/CreatureController.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -80,7 +80,10 @@
 
         mCreature->getActor()->getPhysicalThing()->setPhysicsController(this);
 
+//        mCreature->getActor()->getPhysicalThing()->_getBody()->setAngularDamping(0*Vector3::UNIT_SCALE);
+        mCreature->getActor()->getPhysicalThing()->_getBody()->setContinuousCollisionMode(1);
 
+
         std::pair<MovementType, AbstractMovement*> movementPair;
         movementPair.first = MT_NONE;
         movementPair.second = NULL;
@@ -154,6 +157,8 @@
                 mCreature->getActor()->getPhysicalThing()->setPhysicsController(NULL);
 
                 mCreature->getActor()->getPhysicalThing()->setMaterialID(mOldMaterialId);
+        
+//                mCreature->getActor()->getPhysicalThing()->_getBody()->setAngularDamping(0.1*Vector3::UNIT_SCALE);
             }
         }
     }
@@ -359,14 +364,13 @@
         return false;
     }
 
-    void CreatureController::OnApplyForceAndTorque(PhysicalThing* thing)
+    void CreatureController::OnApplyForceAndTorque(PhysicalThing* thing, float timestep)
     {
         Vector3 force, torque;
         OgreNewt::Body *body = thing->_getBody();
         force = Vector3::ZERO;
         torque = Vector3::ZERO;
         OgreNewt::World *world = PhysicsManager::getSingleton()._getNewtonWorld();
-        Real timestep = world->getTimeStep();
         Real mass;
         Vector3 inertia;
         body->getMassMatrix(mass, inertia);
@@ -387,8 +391,9 @@
         body->setTorque(torque);
     }
 
-    int CreatureController::userProcess()
+    int CreatureController::userProcess(Real timestep, int threadid)
     {
+
         // own collision handling (floor, in order to get information for mAbstractLocation)
         Vector3 point;
         Vector3 normal;
@@ -419,7 +424,29 @@
                 mLastFloorContact = time;
             }
         }
+/*
+        setContactFrictionState(0,0);
+        setContactFrictionState(0,1);
+        setContactTangentAcceleration(0, 0);
+        setContactTangentAcceleration(0, 1);
+        setContactNormalDirection(((Vector3::UNIT_Y.dotProduct(point-charPos)*Vector3::UNIT_Y + charPos) - point).normalisedCopy());
+        setContactNormalAcceleration(0);
 
+std::ostringstream oss;
+Vector3 vec1, vec2;
+oss << " Collision: Point: " << point
+    << "  \t Normal: " << normal
+    << "  \t Force: " << getContactForce()
+    << "  \t Normal-Speed: " << getContactNormalSpeed()
+    << "  \t Contact-Speed: " << point
+    << "  \t Contact-Normal: " << normal;
+getContactTangentDirections(vec1, vec2);
+oss << "  \t Tangent-Directions: " << vec1 << " " << vec2;
+LOG_MESSAGE(Logger::RULES, oss.str());
+*/
+        setContactFrictionState(0,0);
+        setContactFrictionState(0,1);
+/*
         if( stepHeight < 0.4 )
         {
             if(stepHeight > 0.01f) // experimantal value, 
@@ -437,7 +464,6 @@
                 setContactFrictionState(1,0);
                 setContactFrictionState(1,1);
             }
-            //setContactTangentAcceleration(5);
             //setContactElasticity(0.0f);
         }
         else
@@ -455,6 +481,7 @@
                 setContactFrictionState(0,1);
             }
         }
+*/
 
         if(mMovement != NULL)
         {
@@ -464,7 +491,7 @@
             // for processing this contact. Should probably be solved in OgreNewt directly.
             OgreNewt::ContactCallback *movement = mMovement;
             *movement = (OgreNewt::ContactCallback)(*this);
-            return movement->userProcess();
+            return movement->userProcess(timestep, threadid);
         }
 
         // return one to tell Newton we want to accept this contact

Modified: rl/branches/newton20/engine/rules/src/CreatureControllerManager.cpp
===================================================================
--- rl/branches/newton20/engine/rules/src/CreatureControllerManager.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/rules/src/CreatureControllerManager.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -44,15 +44,30 @@
 
         physicsManager->createMaterialPair(char_mat, def_mat)->setContactCallback(this);
         physicsManager->createMaterialPair(char_mat, level_mat)->setContactCallback(this);
-        
-        physicsManager->getMaterialPair(char_mat, def_mat)->setDefaultFriction(0.8f,0.4f);
-        physicsManager->getMaterialPair(char_mat, level_mat)->setDefaultFriction(0.8f,0.4f);
+        physicsManager->createMaterialPair(char_mat, char_mat); //->setContactCallback(this);
+
+        physicsManager->getMaterialPair(char_mat, def_mat)->setDefaultFriction(0.0f,0.0f);
+        physicsManager->getMaterialPair(char_mat, level_mat)->setDefaultFriction(0.0f,0.0f);
+        physicsManager->getMaterialPair(char_mat, char_mat)->setDefaultFriction(0.0f,0.0f);
         physicsManager->getMaterialPair(char_mat, def_mat)->setDefaultElasticity(0.0f);
         physicsManager->getMaterialPair(char_mat, level_mat)->setDefaultElasticity(0.0f);
-        physicsManager->getMaterialPair(char_mat, def_mat)->setDefaultSoftness(1.0f);
-        physicsManager->getMaterialPair(char_mat, level_mat)->setDefaultSoftness(1.0f);
+        physicsManager->getMaterialPair(char_mat, char_mat)->setDefaultElasticity(0.0f);
+        physicsManager->getMaterialPair(char_mat, def_mat)->setDefaultSoftness(0.5f);
+        physicsManager->getMaterialPair(char_mat, level_mat)->setDefaultSoftness(0.5f);
+        physicsManager->getMaterialPair(char_mat, char_mat)->setDefaultSoftness(0.5f);
 
-        physicsManager->getNewtonDebugger()->setMaterialColor(char_mat, Ogre::ColourValue::Red);
+/*        
+        physicsManager->getMaterialPair(char_mat, def_mat)->setDefaultFriction(0.8f,0.4f);
+        physicsManager->getMaterialPair(char_mat, level_mat)->setDefaultFriction(0.8f,0.4f);
+        physicsManager->getMaterialPair(char_mat, char_mat)->setDefaultFriction(0.8f,0.4f);
+        physicsManager->getMaterialPair(char_mat, def_mat)->setDefaultElasticity(0.01f);
+        physicsManager->getMaterialPair(char_mat, level_mat)->setDefaultElasticity(0.01f);
+        physicsManager->getMaterialPair(char_mat, char_mat)->setDefaultElasticity(0.01);
+        physicsManager->getMaterialPair(char_mat, def_mat)->setDefaultSoftness(0.8f);
+        physicsManager->getMaterialPair(char_mat, level_mat)->setDefaultSoftness(0.8f);
+        physicsManager->getMaterialPair(char_mat, char_mat)->setDefaultSoftness(0.8f);
+*/
+        //physicsManager->getNewtonDebugger()->setMaterialColor(char_mat, Ogre::ColourValue::Red);
     }
 
     CreatureControllerManager::~CreatureControllerManager()
@@ -146,7 +161,7 @@
         }
     }
 
-    int CreatureControllerManager::userProcess()
+    int CreatureControllerManager::userProcess(Real timestep, int threadid)
     {
         Actor *actor = static_cast<Actor*>(m_body0->getUserData());
         if( actor != NULL )
@@ -159,8 +174,8 @@
                 // for the controllers to work. This is because these members are used by OgreNewt functions
                 // for processing this contact. Should probably be solved in OgreNewt directly.
                 OgreNewt::ContactCallback* controller = it->second;
-                *controller = (OgreNewt::ContactCallback)(*this);
-                return controller->userProcess();
+               *controller = (OgreNewt::ContactCallback)(*this);
+                return controller->userProcess(timestep, threadid);
             }
         }
 

Modified: rl/branches/newton20/engine/rules/src/RotateMovement.cpp
===================================================================
--- rl/branches/newton20/engine/rules/src/RotateMovement.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/rules/src/RotateMovement.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -28,7 +28,7 @@
     RotateMovement::RotateMovement(CreatureController *creature) : AbstractMovement(creature), mYaw(0)
     {
         mRotLinearSpringK = 600.0f;
-        Real relationCoefficient = 1.0f;
+        Real relationCoefficient = 1.1f;
         mRotLinearDampingK = relationCoefficient * 2.0f * Math::Sqrt(mRotLinearSpringK);
     }
 

Modified: rl/branches/newton20/engine/rules/src/StandAroundMovement.cpp
===================================================================
--- rl/branches/newton20/engine/rules/src/StandAroundMovement.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/rules/src/StandAroundMovement.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -44,14 +44,14 @@
     {
         AbstractMovement::activate();
         getRotationMovement()->activate();
-        getStepRecognitionMovement()->activate();
+        //getStepRecognitionMovement()->activate();
     }
 
     void StandAroundMovement::deactivate()
     {
         AbstractMovement::deactivate();
         getRotationMovement()->deactivate();
-        getStepRecognitionMovement()->deactivate();
+        //getStepRecognitionMovement()->deactivate();
     }
 
     bool StandAroundMovement::calculateBaseVelocity(Real &velocity)
@@ -89,7 +89,7 @@
         // (changing direction during slow movement makes char slide sideways)
         force.y = 0;
 
-        getStepRecognitionMovement()->calculateForceAndTorque(force, torque, timestep);
+        //getStepRecognitionMovement()->calculateForceAndTorque(force, torque, timestep);
     }
 
     bool StandAroundMovement::run(Ogre::Real elapsedTime,  Ogre::Vector3 direction, Ogre::Vector3 rotation)
@@ -104,9 +104,9 @@
         if( getRotationMovement()->isPossible() )
             if( getRotationMovement()->run(elapsedTime, direction, rotation) )
                 ret = true;
-        if( getStepRecognitionMovement()->isPossible() )
-            if (getStepRecognitionMovement()->run(elapsedTime, direction, rotation) )
-                ret = true;
+        //if( getStepRecognitionMovement()->isPossible() )
+        //    if (getStepRecognitionMovement()->run(elapsedTime, direction, rotation) )
+        //        ret = true;
         return ret;
     }
 

Modified: rl/branches/newton20/engine/script/src/EntityNodeProcessor.cpp
===================================================================
--- rl/branches/newton20/engine/script/src/EntityNodeProcessor.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/script/src/EntityNodeProcessor.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -250,9 +250,7 @@
                 {
                     collision = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::ConvexHull(
                                     thisWorld,
-                                    entity,
-                                    false));
-                    //orientation, pos));
+                                    entity));
                     LOG_DEBUG(Logger::RULES, "Created physics proxy type 'convexhull' for entity '"+entity->getName()+"'.");
                 }
                 else if (physicsProxyType == "mesh" || physicsProxyType == "auto")
@@ -274,7 +272,7 @@
             }
         }
 
-        if (!collision.isNull())
+        if ( collision != NULL )
         {
             collisions.push_back(collision);
         }

Modified: rl/branches/newton20/engine/ui/include/FreeflightControlState.h
===================================================================
--- rl/branches/newton20/engine/ui/include/FreeflightControlState.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/ui/include/FreeflightControlState.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -59,10 +59,10 @@
 
         /// This is the OgreNewt contact process callback for the combination
         /// Character <-> Level
-        int userProcess();
+        int userProcess(Ogre::Real timestep, int threadid);
 
         /// Newton force and torque callback
-        void OnApplyForceAndTorque(PhysicalThing* thing);
+        void OnApplyForceAndTorque(PhysicalThing* thing, float timestep);
 
 	private:		
 		int mCurrentMovementState;

Modified: rl/branches/newton20/engine/ui/include/MovementControlState.h
===================================================================
--- rl/branches/newton20/engine/ui/include/MovementControlState.h	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/ui/include/MovementControlState.h	2008-07-14 13:45:55 UTC (rev 4449)
@@ -60,10 +60,10 @@
 
         /// This is the OgreNewt contact process callback for the combination
         /// Character <-> Level
-        int userProcess();
+        int userProcess(Ogre::Real timestep, int threadid);
 
         /// Newton force and torque callback
-        void OnApplyForceAndTorque(PhysicalThing* thing);
+        void OnApplyForceAndTorque(PhysicalThing* thing, float timestep);
 
         /// First oder Third person view.
         void setViewMode(ViewMode mode);

Modified: rl/branches/newton20/engine/ui/src/ControlState.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/ControlState.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/ui/src/ControlState.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -108,9 +108,9 @@
             PhysicsManager::getSingleton().getMaterialID("camera"),
             PhysicsManager::getSingleton().getMaterialID("character"))->setDefaultCollidable(0);
 
-        PhysicsManager::getSingleton().getNewtonDebugger()->setMaterialColor(
-            PhysicsManager::getSingleton().getMaterialID("camera"),
-            Ogre::ColourValue::Black);
+        //PhysicsManager::getSingleton().getNewtonDebugger()->setMaterialColor(
+        //    PhysicsManager::getSingleton().getMaterialID("camera"),
+        //    Ogre::ColourValue::Black);
 	}
 
     ControlState::~ControlState()

Modified: rl/branches/newton20/engine/ui/src/FreeflightControlState.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/FreeflightControlState.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/ui/src/FreeflightControlState.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -286,7 +286,7 @@
         return retval;
 	}
 
-    int FreeflightControlState::userProcess()
+    int FreeflightControlState::userProcess(Real timestep, int)
     {
         if (m_body0 == mCamBody || m_body1 == mCamBody)
         {
@@ -307,14 +307,11 @@
 
 
 
-    void FreeflightControlState::OnApplyForceAndTorque(PhysicalThing* thing)
+    void FreeflightControlState::OnApplyForceAndTorque(PhysicalThing* thing, float timestep)
     {
         OgreNewt::World* world = PhysicsManager::getSingleton()._getNewtonWorld();
         OgreNewt::Body* body = thing->_getBody();
 
-        // Get the current world timestep
-        Real timestep = world->getTimeStep();
-
         if (body == mCamBody)
         {
             // apply camera force

Modified: rl/branches/newton20/engine/ui/src/MovementControlState.cpp
===================================================================
--- rl/branches/newton20/engine/ui/src/MovementControlState.cpp	2008-07-14 13:41:24 UTC (rev 4448)
+++ rl/branches/newton20/engine/ui/src/MovementControlState.cpp	2008-07-14 13:45:55 UTC (rev 4449)
@@ -224,18 +224,21 @@
         mat_pair->setContactCallback(this);
         mat_pair->setDefaultCollidable(1);
         mat_pair->setDefaultFriction(0,0);
+        mat_pair->setDefaultFriction(0,1);
         mat_pair = PhysicsManager::getSingleton().createMaterialPair(
             PhysicsManager::getSingleton().getMaterialID("camera"),
             PhysicsManager::getSingleton().getMaterialID("level"));
         mat_pair->setContactCallback(this);
         mat_pair->setDefaultCollidable(1);
         mat_pair->setDefaultFriction(0,0);
+        mat_pair->setDefaultFriction(0,1);
         mat_pair = PhysicsManager::getSingleton().createMaterialPair(
             PhysicsManager::getSingleton().getMaterialID("camera"),
             PhysicsManager::getSingleton().getMaterialID("character"));
         mat_pair->setContactCallback(this);
         mat_pair->setDefaultCollidable(1);
         mat_pair->setDefaultFriction(0,0);
+        mat_pair->setDefaultFriction(0,1);
 
         mCharacterState.mCurrentMovementState = MOVE_NONE;
 
@@ -698,7 +701,7 @@
 
     // -------------------------------------------------------------
     // character collision moved to CreatureController(Manager)
-    int MovementControlState::userProcess()
+    int MovementControlState::userProcess(Real timestep, int)
     {
         if( mViewMode == VM_FIRST_PERSON )
             return 0;
@@ -719,10 +722,9 @@
 
     //------------------------------------------------------------------------
     // character callback moved to CreatureController
-    void MovementControlState::OnApplyForceAndTorque(PhysicalThing* thing)
+    void MovementControlState::OnApplyForceAndTorque(PhysicalThing* thing, float timestep)
     {
         OgreNewt::World* world = PhysicsManager::getSingleton()._getNewtonWorld();
-        Real timestep = world->getTimeStep();
 
         calculateCamera(timestep);
 



From alassion at mail.berlios.de  Tue Jul 15 19:52:37 2008
From: alassion at mail.berlios.de (alassion at mail.berlios.de)
Date: Tue, 15 Jul 2008 19:52:37 +0200
Subject: [Dsa-hl-svn] r4450 - in modules/kanalisation: maps
	materials/textures scripts/maps
Message-ID: <200807151752.m6FHqbWc004028@sheep.berlios.de>

Author: alassion
Date: 2008-07-15 19:51:42 +0200 (Tue, 15 Jul 2008)
New Revision: 4450

Added:
   modules/kanalisation/materials/textures/erdeboden_02.jpg
   modules/kanalisation/materials/textures/erdeboden_02_normal.jpg.png
   modules/kanalisation/materials/textures/felsen_3_kana.png
   modules/kanalisation/materials/textures/felsen_3_kana_normal.png
   modules/kanalisation/materials/textures/wand_kana_spec.png
Removed:
   modules/kanalisation/materials/textures/fence_kana.png
   modules/kanalisation/materials/textures/kiste_moos_kana.png
Modified:
   modules/kanalisation/maps/kana_lights.rlmap.xml
   modules/kanalisation/maps/kanalisation_scene.xml
   modules/kanalisation/scripts/maps/kanalisation.rb
Log:
- few changes -

Modified: modules/kanalisation/maps/kana_lights.rlmap.xml
===================================================================
--- modules/kanalisation/maps/kana_lights.rlmap.xml	2008-07-14 13:45:55 UTC (rev 4449)
+++ modules/kanalisation/maps/kana_lights.rlmap.xml	2008-07-15 17:51:42 UTC (rev 4450)
@@ -3,7 +3,7 @@
 	<nodes>
 		<light name="fackkellicht" type="point" visible="true"
 			castShadows="false">
-			<position x="-1.39" y="5.54" z="12.84" />
+			<position x="-1.39" y="4.92" z="12.84" />
 			<colourDiffuse r="0.8" g="0.7" b="0.5" />
 			<colourSpecular r="0.8" g="0.7" b="0.5" />
 			<lightAttenuation range="8" constant="1" linear="0" quadratic=".034" />

Modified: modules/kanalisation/maps/kanalisation_scene.xml
===================================================================
--- modules/kanalisation/maps/kanalisation_scene.xml	2008-07-14 13:45:55 UTC (rev 4449)
+++ modules/kanalisation/maps/kanalisation_scene.xml	2008-07-15 17:51:42 UTC (rev 4450)
@@ -1,5 +1,8 @@
 <scene formatVersion="0.4.0">
     <nodes>
+<entity name="Spinne" meshfile="tie_waldspinne.mesh">
+<position x="83.61" y="-1.05" z="28.88"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="8.0" y="8.0" z="8.0"/>
+</entity>
 <entity name="bruecke" meshfile="bruecke.mesh">
 <position x="2.892947" y="3.346505" z="7.881136"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
 </entity>
@@ -118,9 +121,6 @@
 <entity name="saeule_07.001" meshfile="saeule_07.001.mesh">
 <position x="62.32452" y="10.705501" z="44.40452"/><rotation qw="0.706179" qx="-2.81E-4" qy="-0.708033" qz="-2.82E-4"/><scale x="1.0" y="1.0" z="1.0"/>
 </entity>
-<entity name="rostkette" meshfile="rostkette.mesh">
-<position x="11.6703" y="6.950521" z="10.76639"/><rotation qw="1.0" qx="-3.98E-4" qy="0.0" qz="0.0"/><scale x="1.0" y="1.0" z="1.0"/>
-</entity>
 <entity name="raum_01.001" meshfile="raum_01.001.mesh">
 <position x="-11.642996" y="2.232062" z="38.87323"/><rotation qw="0.977955" qx="-3.89E-4" qy="-0.208817" qz="-8.3E-5"/><scale x="1.0" y="1.0" z="1.0"/>
 </entity>

Added: modules/kanalisation/materials/textures/erdeboden_02.jpg
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/erdeboden_02.jpg
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/erdeboden_02_normal.jpg.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/erdeboden_02_normal.jpg.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/felsen_3_kana.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/felsen_3_kana.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: modules/kanalisation/materials/textures/felsen_3_kana_normal.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/felsen_3_kana_normal.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Deleted: modules/kanalisation/materials/textures/fence_kana.png
===================================================================
(Binary files differ)

Deleted: modules/kanalisation/materials/textures/kiste_moos_kana.png
===================================================================
(Binary files differ)

Added: modules/kanalisation/materials/textures/wand_kana_spec.png
===================================================================
(Binary files differ)


Property changes on: modules/kanalisation/materials/textures/wand_kana_spec.png
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Modified: modules/kanalisation/scripts/maps/kanalisation.rb
===================================================================
--- modules/kanalisation/scripts/maps/kanalisation.rb	2008-07-14 13:45:55 UTC (rev 4449)
+++ modules/kanalisation/scripts/maps/kanalisation.rb	2008-07-15 17:51:42 UTC (rev 4450)
@@ -49,13 +49,13 @@
 
 $SCRIPT.log("Hero ready")
 
-$SCRIPT.log("Fackellicht erstellen..");
-fackellicht = $AM.createLightActor("Das Licht der Fackel", LightObject::LT_POINT );
-fackellicht.getControlledObject().setCastShadows(true);
-fackellicht.getControlledObject().setDiffuseColour(0.3,0.2,0.1);
-fackellicht.getControlledObject().setAttenuation(2.0, 0.79,  -0.21, 0.268 );
-$hero.getActor().attachToSlot( fackellicht, "Bip01 R SlotHand" );
-$SCRIPT.log("Fackellicht erstellt.");
+#$SCRIPT.log("Fackellicht erstellen..");
+#fackellicht = $AM.createLightActor("Das Licht der Fackel", LightObject::LT_POINT );
+#fackellicht.getControlledObject().setCastShadows(true);
+#fackellicht.getControlledObject().setDiffuseColour(0.3,0.2,0.1);
+#fackellicht.getControlledObject().setAttenuation(2.0, 0.79,  -0.21, 0.268 );
+#$hero.getActor().attachToSlot( fackellicht, "Bip01 R SlotHand" );
+#$SCRIPT.log("Fackellicht erstellt.");
 
 load "particle.rb"
 load "equip.rb"



From melven at mail.berlios.de  Tue Jul 15 22:23:25 2008
From: melven at mail.berlios.de (melven at mail.berlios.de)
Date: Tue, 15 Jul 2008 22:23:25 +0200
Subject: [Dsa-hl-svn] r4451 - modules/regressiontest/scripts
Message-ID: <200807152023.m6FKNPL6024406@sheep.berlios.de>

Author: melven
Date: 2008-07-15 22:23:24 +0200 (Tue, 15 Jul 2008)
New Revision: 4451

Modified:
   modules/regressiontest/scripts/InventoryTest.rb
Log:
added log-message


Modified: modules/regressiontest/scripts/InventoryTest.rb
===================================================================
--- modules/regressiontest/scripts/InventoryTest.rb	2008-07-15 17:51:42 UTC (rev 4450)
+++ modules/regressiontest/scripts/InventoryTest.rb	2008-07-15 20:23:24 UTC (rev 4451)
@@ -3,6 +3,7 @@
 
 class InventoryTest < TestCase
   def execute()
+    $SCRIPT.log("InventoryTest started.");
     hero = $UI.getActiveCharacter();
     backpack = $GOM.createGameObject("leather backpack");
     #backpack.addAction(ShowContainerContentAction.new());



From timm at mail.berlios.de  Wed Jul 16 09:57:15 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Wed, 16 Jul 2008 09:57:15 +0200
Subject: [Dsa-hl-svn] r4452 - in rl/trunk/engine/ai: . src
Message-ID: <200807160757.m6G7vFve009994@sheep.berlios.de>

Author: timm
Date: 2008-07-16 09:57:06 +0200 (Wed, 16 Jul 2008)
New Revision: 4452

Modified:
   rl/trunk/engine/ai/RlAI2005.vcproj
   rl/trunk/engine/ai/src/DialogLoader.cpp
Log:
inserted precompiled header into DialogLoader.cpp and updated msvc proj

Modified: rl/trunk/engine/ai/RlAI2005.vcproj
===================================================================
--- rl/trunk/engine/ai/RlAI2005.vcproj	2008-07-15 20:23:24 UTC (rev 4451)
+++ rl/trunk/engine/ai/RlAI2005.vcproj	2008-07-16 07:57:06 UTC (rev 4452)
@@ -363,6 +363,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\src\DialogLoader.cpp"
+				>
+			</File>
+			<File
 				RelativePath=".\src\DialogManager.cpp"
 				>
 			</File>
@@ -533,6 +537,10 @@
 				>
 			</File>
 			<File
+				RelativePath=".\include\DialogLoader.h"
+				>
+			</File>
+			<File
 				RelativePath=".\include\DialogManager.h"
 				>
 			</File>

Modified: rl/trunk/engine/ai/src/DialogLoader.cpp
===================================================================
--- rl/trunk/engine/ai/src/DialogLoader.cpp	2008-07-15 20:23:24 UTC (rev 4451)
+++ rl/trunk/engine/ai/src/DialogLoader.cpp	2008-07-16 07:57:06 UTC (rev 4452)
@@ -1,11 +1,21 @@
-/*
- *  DialogLoader.cpp
- *  Rastullah
- *
- *  Created by Sascha Kolewa on 11.07.08.
- *  Copyright 2008 __MyCompanyName__. All rights reserved.
- *
- */
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+* 
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+
+#include "stdinc.h"
+
 #include <xercesc/dom/DOM.hpp>
 
 #include "DialogLoader.h"



From blakharaz at mail.berlios.de  Wed Jul 16 21:24:05 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Wed, 16 Jul 2008 21:24:05 +0200
Subject: [Dsa-hl-svn] r4453 - rl/trunk/Mac/tools
Message-ID: <200807161924.m6GJO5qp003173@sheep.berlios.de>

Author: blakharaz
Date: 2008-07-16 21:24:04 +0200 (Wed, 16 Jul 2008)
New Revision: 4453

Modified:
   rl/trunk/Mac/tools/renameinstalldirs.sh
Log:
Mac OS X: More renamings for linked libraries (FreeType)

Modified: rl/trunk/Mac/tools/renameinstalldirs.sh
===================================================================
--- rl/trunk/Mac/tools/renameinstalldirs.sh	2008-07-16 07:57:06 UTC (rev 4452)
+++ rl/trunk/Mac/tools/renameinstalldirs.sh	2008-07-16 19:24:04 UTC (rev 4453)
@@ -1,12 +1,23 @@
 #!/bin/sh
-RASTULLAH_APP_NAME=$1
+RASTULLAH_APP_DIR=$1
+RASTULLAH_APP_NAME=$2
+RASTULLAH_APP_BIN=${RASTULLAH_APP_DIR}/${RASTULLAH_APP_NAME}
+CEGUI_BIN=${RASTULLAH_APP_DIR}/../Frameworks/CEGUI.framework/CEGUI
 
 #TODO: Replace the absolute source paths to something with olist -L $RASTULLAH_APP_NAME and grep
 
 echo Changing library installation directories for $RASTULLAH_APP_NAME
-install_name_tool -change /Library/Frameworks/CEGUI.framework/Versions/A/CEGUI @executable_path/../Frameworks/CEGUI.framework/Versions/A/CEGUI $RASTULLAH_APP_NAME
-install_name_tool -change libboost_system-mt-1_35.dylib @executable_path/../Frameworks/libboost_system-mt-1_35.dylib $RASTULLAH_APP_NAME
-install_name_tool -change /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/libruby.1.dylib @executable_path/../Frameworks/libruby.1.dylib $RASTULLAH_APP_NAME
-install_name_tool -change /Users/blakharaz/Library/Frameworks/OgreNewt.framework/Versions/A/OgreNewt @executable_path/../Frameworks/OgreNewt.framework/Versions/A/OgreNewt $RASTULLAH_APP_NAME
-install_name_tool -change /Users/blakharaz/Library/Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer @executable_path/../Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer $RASTULLAH_APP_NAME
+
+# RL Application binary
+install_name_tool -change /Library/Frameworks/CEGUI.framework/Versions/A/CEGUI @executable_path/../Frameworks/CEGUI.framework/Versions/A/CEGUI $RASTULLAH_APP_BIN
+install_name_tool -change libboost_system-mt-1_35.dylib @executable_path/../Frameworks/libboost_system-mt-1_35.dylib $RASTULLAH_APP_BIN
+install_name_tool -change /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/lib/libruby.1.dylib @executable_path/../Frameworks/libruby.1.dylib $RASTULLAH_APP_BIN
+install_name_tool -change /Users/blakharaz/Library/Frameworks/OgreNewt.framework/Versions/A/OgreNewt @executable_path/../Frameworks/OgreNewt.framework/Versions/A/OgreNewt $RASTULLAH_APP_BIN
+install_name_tool -change /Users/blakharaz/Library/Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer @executable_path/../Frameworks/OpenSteer.framework/Versions/0.8/OpenSteer $RASTULLAH_APP_BIN
+
+# CEGUI
+install_name_tool -change /Library/Frameworks/CEGUI.framework/Versions/A/CEGUI @executable_path/../Frameworks/CEGUI.framework/Versions/A/CEGUI ${CEGUI_BIN}
+install_name_tool -change /Library/Frameworks/FreeType.framework/Versions/2.3/FreeType @executable_path/../Frameworks/FreeType.framework/Versions/2.3/FreeType ${CEGUI_BIN}
+
+
 echo done.
\ No newline at end of file



From blakharaz at mail.berlios.de  Wed Jul 16 21:24:12 2008
From: blakharaz at mail.berlios.de (blakharaz at mail.berlios.de)
Date: Wed, 16 Jul 2008 21:24:12 +0200
Subject: [Dsa-hl-svn] r4454 - rl/trunk/Mac/Rastullah.xcodeproj
Message-ID: <200807161924.m6GJOC0M003302@sheep.berlios.de>

Author: blakharaz
Date: 2008-07-16 21:24:11 +0200 (Wed, 16 Jul 2008)
New Revision: 4454

Modified:
   rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj
Log:
Mac OS X: More renamings for linked libraries (FreeType)

Modified: rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj
===================================================================
--- rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj	2008-07-16 19:24:04 UTC (rev 4453)
+++ rl/trunk/Mac/Rastullah.xcodeproj/project.pbxproj	2008-07-16 19:24:11 UTC (rev 4454)
@@ -664,6 +664,7 @@
 		48B772E30D583521000A3B97 /* XmlProcessor.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48B772E00D583521000A3B97 /* XmlProcessor.cpp */; };
 		48B772E40D583521000A3B97 /* XmlPropertyReader.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48B772E10D583521000A3B97 /* XmlPropertyReader.cpp */; };
 		48B772E50D583521000A3B97 /* XmlPropertyWriter.cpp in Sources */ = {isa = PBXBuildFile; fileRef = 48B772E20D583521000A3B97 /* XmlPropertyWriter.cpp */; };
+		48CFBF8F0E2E869000CD0C51 /* FreeType.framework in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 48CFBF8E0E2E869000CD0C51 /* FreeType.framework */; };
 		48D0BDC70E23375E00863824 /* libruby.dylib in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 483646A10D83D57800912FEC /* libruby.dylib */; };
 		48D0BDE60E23378700863824 /* libboost_filesystem.dylib in Copy Frameworks */ = {isa = PBXBuildFile; fileRef = 48A52B210E0EDA0E008DBDD8 /* libboost_filesystem.dylib */; };
 		48D0BE2C0E273C5E00863824 /* SaveAble.h in Headers */ = {isa = PBXBuildFile; fileRef = 48D0BE280E273C5E00863824 /* SaveAble.h */; };
@@ -844,6 +845,7 @@
 			dstPath = "";
 			dstSubfolderSpec = 10;
 			files = (
+				48CFBF8F0E2E869000CD0C51 /* FreeType.framework in Copy Frameworks */,
 				48D0BDE60E23378700863824 /* libboost_filesystem.dylib in Copy Frameworks */,
 				48D0BDC70E23375E00863824 /* libruby.dylib in Copy Frameworks */,
 				484D92140E1E060200BCFC2B /* Xerces.framework in Copy Frameworks */,
@@ -1473,6 +1475,8 @@
 		48B772E00D583521000A3B97 /* XmlProcessor.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = XmlProcessor.cpp; path = ../engine/common/src/XmlProcessor.cpp; sourceTree = SOURCE_ROOT; };
 		48B772E10D583521000A3B97 /* XmlPropertyReader.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = XmlPropertyReader.cpp; path = ../engine/common/src/XmlPropertyReader.cpp; sourceTree = SOURCE_ROOT; };
 		48B772E20D583521000A3B97 /* XmlPropertyWriter.cpp */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.cpp.cpp; name = XmlPropertyWriter.cpp; path = ../engine/common/src/XmlPropertyWriter.cpp; sourceTree = SOURCE_ROOT; };
+		48CFBF8E0E2E869000CD0C51 /* FreeType.framework */ = {isa = PBXFileReference; lastKnownFileType = wrapper.framework; name = FreeType.framework; path = /Library/Frameworks/FreeType.framework; sourceTree = "<absolute>"; };
+		48CFBFD70E2E87BB00CD0C51 /* renameinstalldirs.sh */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = text.script.sh; name = renameinstalldirs.sh; path = tools/renameinstalldirs.sh; sourceTree = "<group>"; };
 		48D0BE280E273C5E00863824 /* SaveAble.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = SaveAble.h; path = ../engine/core/include/SaveAble.h; sourceTree = SOURCE_ROOT; };
 		48D0BE290E273C5E00863824 /* SaveAbleCollection.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = SaveAbleCollection.h; path = ../engine/core/include/SaveAbleCollection.h; sourceTree = SOURCE_ROOT; };
 		48D0BE2A0E273C5E00863824 /* SaveAbleFactory.h */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.c.h; name = SaveAbleFactory.h; path = ../engine/core/include/SaveAbleFactory.h; sourceTree = SOURCE_ROOT; };
@@ -1678,6 +1682,7 @@
 		20286C2AFDCF999611CA2CEA /* Sources */ = {
 			isa = PBXGroup;
 			children = (
+				48CFBFD60E2E87A800CD0C51 /* Scripts */,
 				483D86890D8C3DA200F3629E /* RlFmod4Driver */,
 				444EAC220BD0E3E000C6D4A0 /* RlAi */,
 				444EAB1F0BD0E25C00C6D4A0 /* RlCommon */,
@@ -1705,6 +1710,7 @@
 		20286C32FDCF999611CA2CEA /* External Frameworks and Libraries */ = {
 			isa = PBXGroup;
 			children = (
+				48CFBF8E0E2E869000CD0C51 /* FreeType.framework */,
 				484FE6B90E17BC8800FA880F /* Carbon.framework */,
 				48A52CAF0E0EF55C008DBDD8 /* libboost_system.lib */,
 				48A52B210E0EDA0E008DBDD8 /* libboost_filesystem.dylib */,
@@ -2402,6 +2408,14 @@
 			path = src;
 			sourceTree = "<group>";
 		};
+		48CFBFD60E2E87A800CD0C51 /* Scripts */ = {
+			isa = PBXGroup;
+			children = (
+				48CFBFD70E2E87BB00CD0C51 /* renameinstalldirs.sh */,
+			);
+			name = Scripts;
+			sourceTree = "<group>";
+		};
 /* End PBXGroup section */
 
 /* Begin PBXHeadersBuildPhase section */
@@ -3023,7 +3037,7 @@
 			);
 			runOnlyForDeploymentPostprocessing = 0;
 			shellPath = /bin/sh;
-			shellScript = "${SOURCE_ROOT}/tools/renameinstalldirs.sh ${BUILT_PRODUCTS_DIR}/Rastullah.app/Contents/MacOS/Rastullah\n";
+			shellScript = "${SOURCE_ROOT}/tools/renameinstalldirs.sh ${BUILT_PRODUCTS_DIR}/Rastullah.app/Contents/MacOS Rastullah\n";
 		};
 /* End PBXShellScriptBuildPhase section */
 



From timm at mail.berlios.de  Fri Jul 25 10:43:02 2008
From: timm at mail.berlios.de (timm at mail.berlios.de)
Date: Fri, 25 Jul 2008 10:43:02 +0200
Subject: [Dsa-hl-svn] r4455 - in rl/trunk/engine/script: . include src
Message-ID: <200807250843.m6P8h2OH018712@sheep.berlios.de>

Author: timm
Date: 2008-07-25 10:42:37 +0200 (Fri, 25 Jul 2008)
New Revision: 4455

Added:
   rl/trunk/engine/script/include/PlaneNodeProcessor.h
   rl/trunk/engine/script/src/PlaneNodeProcessor.cpp
Modified:
   rl/trunk/engine/script/RlScript2005.vcproj
   rl/trunk/engine/script/include/AbstractMapNodeProcessor.h
   rl/trunk/engine/script/include/Makefile.am
   rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp
   rl/trunk/engine/script/src/Makefile.am
   rl/trunk/engine/script/src/MapLoader.cpp
Log:
Added the plane loading feature to maploader

Modified: rl/trunk/engine/script/RlScript2005.vcproj
===================================================================
--- rl/trunk/engine/script/RlScript2005.vcproj	2008-07-16 19:24:11 UTC (rev 4454)
+++ rl/trunk/engine/script/RlScript2005.vcproj	2008-07-25 08:42:37 UTC (rev 4455)
@@ -355,6 +355,10 @@
 					>
 				</File>
 				<File
+					RelativePath=".\src\PlaneNodeProcessor.cpp"
+					>
+				</File>
+				<File
 					RelativePath=".\src\Scene.cpp"
 					>
 				</File>
@@ -462,6 +466,10 @@
 					>
 				</File>
 				<File
+					RelativePath=".\include\PlaneNodeProcessor.h"
+					>
+				</File>
+				<File
 					RelativePath=".\include\Scene.h"
 					>
 				</File>

Modified: rl/trunk/engine/script/include/AbstractMapNodeProcessor.h
===================================================================
--- rl/trunk/engine/script/include/AbstractMapNodeProcessor.h	2008-07-16 19:24:11 UTC (rev 4454)
+++ rl/trunk/engine/script/include/AbstractMapNodeProcessor.h	2008-07-25 08:42:37 UTC (rev 4455)
@@ -42,6 +42,7 @@
     
         Ogre::String getRandomName(const Ogre::String& baseName) const;
         Ogre::Vector3 processVector3(XERCES_CPP_NAMESPACE::DOMElement* nodeElem) const;
+		Ogre::Vector2 processVector2(XERCES_CPP_NAMESPACE::DOMElement* nodeElem) const;
         Ogre::Quaternion processQuaternion(XERCES_CPP_NAMESPACE::DOMElement* nodeElem) const;
         Ogre::ColourValue processColour(XERCES_CPP_NAMESPACE::DOMElement* colElem) const;
         

Modified: rl/trunk/engine/script/include/Makefile.am
===================================================================
--- rl/trunk/engine/script/include/Makefile.am	2008-07-16 19:24:11 UTC (rev 4454)
+++ rl/trunk/engine/script/include/Makefile.am	2008-07-25 08:42:37 UTC (rev 4455)
@@ -1,25 +1,26 @@
-noinst_HEADERS = \
-	AbstractMapNodeProcessor.h \
-	EntityNodeProcessor.h \
-	EnvironmentProcessor.h \
-	GameObjectNodeProcessor.h \
-	LightNodeProcessor.h \
-	MapLoader.h \
-	ParticleSystemNodeProcessor.h \
-	TriggerFactory.h \
-	Scene.h \
-	SceneLoader.h \
-	SceneManager.h \
-	ScriptObjectMarker.h \
-	ScriptPrerequisites.h \
-	ScriptSubsystem.h \
-	SoundNodeProcessor.h \
-	WaypointProcessor.h \
-	UnifiedFactory.h \
-	ZoneProcessor.h
-
-CLEANFILES = stdinc.h.gch
-all-local: stdinc.h.gch
-stdinc.h.gch: $(noinst_HEADERS) stdinc.h
-	@echo Creating GCH file
-	g++ -I. stdinc.h
+noinst_HEADERS = \
+	AbstractMapNodeProcessor.h \
+	EntityNodeProcessor.h \
+	EnvironmentProcessor.h \
+	GameObjectNodeProcessor.h \
+	LightNodeProcessor.h \
+	MapLoader.h \
+	ParticleSystemNodeProcessor.h \
+	PlaneNodeProcessor.h \
+	TriggerFactory.h \
+	Scene.h \
+	SceneLoader.h \
+	SceneManager.h \
+	ScriptObjectMarker.h \
+	ScriptPrerequisites.h \
+	ScriptSubsystem.h \
+	SoundNodeProcessor.h \
+	WaypointProcessor.h \
+	UnifiedFactory.h \
+	ZoneProcessor.h
+
+CLEANFILES = stdinc.h.gch
+all-local: stdinc.h.gch
+stdinc.h.gch: $(noinst_HEADERS) stdinc.h
+	@echo Creating GCH file
+	g++ -I. stdinc.h

Added: rl/trunk/engine/script/include/PlaneNodeProcessor.h
===================================================================
--- rl/trunk/engine/script/include/PlaneNodeProcessor.h	2008-07-16 19:24:11 UTC (rev 4454)
+++ rl/trunk/engine/script/include/PlaneNodeProcessor.h	2008-07-25 08:42:37 UTC (rev 4455)
@@ -0,0 +1,47 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+#ifndef __PlaneNodeProcessor_H__
+#define __PlaneNodeProcessor_H__
+
+#include <xercesc/dom/DOMElement.hpp>
+
+#include "ScriptPrerequisites.h"
+
+#ifdef __APPLE__
+#   include <OgreNewt/OgreNewt.h>
+#else
+#   include <OgreNewt.h>
+#endif
+
+#include "AbstractMapNodeProcessor.h"
+
+namespace rl
+{
+    class PlaneNodeProcessor : public AbstractMapNodeProcessor
+    {
+    public:
+        PlaneNodeProcessor(const Ogre::String& resourcegroup);
+
+        virtual bool processNode(XERCES_CPP_NAMESPACE::DOMElement* nodeElem, bool loadGameObjects);
+
+    private:
+        Ogre::String mResourceGroup;
+
+        void createCollision(Ogre::Entity* entity, XERCES_CPP_NAMESPACE::DOMElement* physicsProxyElem);
+	};
+}
+
+#endif // __PlaneNodeProcessor_H__

Modified: rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp	2008-07-16 19:24:11 UTC (rev 4454)
+++ rl/trunk/engine/script/src/AbstractMapNodeProcessor.cpp	2008-07-25 08:42:37 UTC (rev 4455)
@@ -55,6 +55,24 @@
         return rval;
     }
 
+	Vector2 AbstractMapNodeProcessor::processVector2(DOMElement* vec2Elem) const
+    {
+        Vector2 rval(Vector2::ZERO);
+        if (vec2Elem != NULL)
+        {
+            if (hasAttribute(vec2Elem, "x"))
+            {
+                rval.x = getAttributeValueAsReal(vec2Elem, "x");
+            }
+            if (hasAttribute(vec2Elem, "y"))
+            {
+                rval.y = getAttributeValueAsReal(vec2Elem, "y");
+            }
+        }
+
+        return rval;
+    }
+
     Quaternion AbstractMapNodeProcessor::processQuaternion(DOMElement* quatElem) const
     {
         Quaternion rval(Quaternion::IDENTITY);

Modified: rl/trunk/engine/script/src/Makefile.am
===================================================================
--- rl/trunk/engine/script/src/Makefile.am	2008-07-16 19:24:11 UTC (rev 4454)
+++ rl/trunk/engine/script/src/Makefile.am	2008-07-25 08:42:37 UTC (rev 4455)
@@ -1,32 +1,33 @@
-INCLUDES = $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(OgreNewt_CFLAGS) $(OIS_CFLAGS) \
-	$(STLPORT_CFLAGS) $(BOOST_CPPFLAGS) -I../include -I../../common/include \
-	-I../../core/include -I../../rules/include -I../../ui/include \
-	-I../../ai/include
-
-lib_LTLIBRARIES = libRlScript.la
-libRlScript_la_LDFLAGS = \
-    $(top_builddir)/engine/common/src/libRlCommon.la \
-    $(top_builddir)/engine/core/src/libRlCore.la \
-    $(top_builddir)/engine/ui/src/libRlUi.la \
-    $(top_builddir)/engine/rules/src/libRlRules.la \
-    $(CEGUI_LIBS) $(OGRE_LIBS) $(RUBY_LIBS) $(LIBS) \
-    -Wl,--defsym -Wl,Init_libRlScript=Init_RlScript
-	
-libRlScript_la_SOURCES = \
-	AbstractMapNodeProcessor.cpp \
-	EntityNodeProcessor.cpp \
-	EnvironmentProcessor.cpp \
-	GameObjectNodeProcessor.cpp \
-	LightNodeProcessor.cpp \
-	MapLoader.cpp \
-	ParticleSystemNodeProcessor.cpp \
-	Scene.cpp \
-	SceneLoader.cpp \
-	SceneManager.cpp \
-	ScriptSubsystem.cpp \
-	ScriptObjectMarker.cpp \
-	SoundNodeProcessor.cpp \
-	TriggerFactory.cpp \
-	WaypointProcessor.cpp \
-	ZoneProcessor.cpp \
-	../swig/RlExports.cxx 
+INCLUDES = $(CEGUI_CFLAGS) $(RUBY_CFLAGS) $(OGRE_CFLAGS) $(OgreNewt_CFLAGS) $(OIS_CFLAGS) \
+	$(STLPORT_CFLAGS) $(BOOST_CPPFLAGS) -I../include -I../../common/include \
+	-I../../core/include -I../../rules/include -I../../ui/include \
+	-I../../ai/include
+
+lib_LTLIBRARIES = libRlScript.la
+libRlScript_la_LDFLAGS = \
+    $(top_builddir)/engine/common/src/libRlCommon.la \
+    $(top_builddir)/engine/core/src/libRlCore.la \
+    $(top_builddir)/engine/ui/src/libRlUi.la \
+    $(top_builddir)/engine/rules/src/libRlRules.la \
+    $(CEGUI_LIBS) $(OGRE_LIBS) $(RUBY_LIBS) $(LIBS) \
+    -Wl,--defsym -Wl,Init_libRlScript=Init_RlScript
+	
+libRlScript_la_SOURCES = \
+	AbstractMapNodeProcessor.cpp \
+	EntityNodeProcessor.cpp \
+	EnvironmentProcessor.cpp \
+	GameObjectNodeProcessor.cpp \
+	LightNodeProcessor.cpp \
+	MapLoader.cpp \
+	ParticleSystemNodeProcessor.cpp \
+	PlaneNodeProcessor.cpp \
+	Scene.cpp \
+	SceneLoader.cpp \
+	SceneManager.cpp \
+	ScriptSubsystem.cpp \
+	ScriptObjectMarker.cpp \
+	SoundNodeProcessor.cpp \
+	TriggerFactory.cpp \
+	WaypointProcessor.cpp \
+	ZoneProcessor.cpp \
+	../swig/RlExports.cxx 

Modified: rl/trunk/engine/script/src/MapLoader.cpp
===================================================================
--- rl/trunk/engine/script/src/MapLoader.cpp	2008-07-16 19:24:11 UTC (rev 4454)
+++ rl/trunk/engine/script/src/MapLoader.cpp	2008-07-25 08:42:37 UTC (rev 4455)
@@ -37,6 +37,7 @@
 #include "ZoneProcessor.h"
 #include "ContentModule.h"
 #include "RubyInterpreter.h"
+#include "PlaneNodeProcessor.h"
 
 using namespace Ogre;
 using namespace XERCES_CPP_NAMESPACE;
@@ -83,6 +84,7 @@
         mNodeProcessors.push_back(new SoundNodeProcessor());
         mNodeProcessors.push_back(new LightNodeProcessor());
 		mNodeProcessors.push_back(new ParticleSystemNodeProcessor());
+		mNodeProcessors.push_back(new PlaneNodeProcessor(resourceGroup));
 
         RequestedSceneChangeConnection = MessagePump::getSingleton().addMessageHandler<MessageType_SceneChangeRequested>(
             boost::bind(&MapLoader::changeScene, this, _1));

Added: rl/trunk/engine/script/src/PlaneNodeProcessor.cpp
===================================================================
--- rl/trunk/engine/script/src/PlaneNodeProcessor.cpp	2008-07-16 19:24:11 UTC (rev 4454)
+++ rl/trunk/engine/script/src/PlaneNodeProcessor.cpp	2008-07-25 08:42:37 UTC (rev 4455)
@@ -0,0 +1,157 @@
+/* This source file is part of Rastullahs Lockenpracht.
+* Copyright (C) 2003-2008 Team Pantheon. http://www.team-pantheon.de
+*
+*  This program is free software; you can redistribute it and/or modify
+*  it under the terms of the Clarified Artistic License.
+*
+*  This program is distributed in the hope that it will be useful,
+*  but WITHOUT ANY WARRANTY; without even the implied warranty of
+*  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+*  Clarified Artistic License for more details.
+*
+*  You should have received a copy of the Clarified Artistic License
+*  along with this program; if not you can get it here
+*  http://www.jpaulmorrison.com/fbp/artistic2.htm.
+*/
+#include "stdinc.h" //precompiled header
+
+#include "PlaneNodeProcessor.h"
+
+#include <xercesc/dom/DOM.hpp>
+
+#include "CoreSubsystem.h"
+#include "PhysicsManager.h"
+#include "World.h"
+
+using namespace Ogre;
+using namespace XERCES_CPP_NAMESPACE;
+
+namespace rl
+{
+	PlaneNodeProcessor::PlaneNodeProcessor(const Ogre::String &resourcegroup)
+	{
+	}
+
+	bool PlaneNodeProcessor::processNode(xercesc_2_7::DOMElement *nodeElem, bool loadGameObjects)
+	{
+		if (!hasNodeName(nodeElem, "plane"))
+        {
+            return false;
+        }
+
+		Ogre::String entName = getAttributeValueAsStdString(nodeElem, "name");
+
+		LOG_DEBUG(Logger::RULES,
+            "Processing plane node "
+                + entName);
+		if(entName=="")
+		{
+			entName = getRandomName("Plane");
+		}
+
+		Quaternion orientation(Quaternion::IDENTITY);
+		Vector3 position(Vector3::ZERO);
+		Vector2 scale(1,1);
+
+		DOMElement* oriElem = getChildNamed(nodeElem, "rotation");
+        if (oriElem != NULL)
+        {
+            orientation = processQuaternion(oriElem);
+        }
+        else
+        {
+            LOG_WARNING(Logger::RULES, "No orientation given for plane, used Identity");
+        }
+
+		DOMElement* posElem = getChildNamed(nodeElem, "position");
+        if (posElem != NULL)
+        {
+            position = processVector3(posElem);
+        }
+		else
+        {
+            LOG_WARNING(Logger::RULES, "No position given for plane, used (0,0,0)");
+        }
+
+		DOMElement* scaleElem = getChildNamed(nodeElem, "scale");
+        if (posElem != NULL)
+        {
+            scale = processVector2(posElem);
+        }
+		else
+        {
+            LOG_WARNING(Logger::RULES, "No scale given for plane, used (0,0)");
+        }
+
+		while(!MeshManager::getSingleton().getByName(entName).isNull())
+		{
+			entName = getRandomName("Plane");
+		}
+
+		SceneNode* node = getRootSceneNode()->createChildSceneNode(entName, position, orientation);
+
+		Plane* plane = new MovablePlane(entName);
+		plane->d = 0;
+		plane->normal = Vector3::UNIT_Y;
+
+		MeshManager::getSingleton().createPlane(entName, mResourceGroup, *plane, 1, 1, 1, 1, true, 1, 1, 1, Vector3::UNIT_Z);
+
+		Entity* ent = CoreSubsystem::getSingleton().getWorld()->getSceneManager()->createEntity(entName, entName);
+
+		LOG_DEBUG(Logger::RULES, " Loaded plane "+entName);
+
+		node->attachObject(ent);
+
+		createCollision(ent, getChildNamed(nodeElem, "physicsproxy"));
+
+		DOMElement* materialElem = getChildNamed(nodeElem, "material");
+		if(materialElem)
+		{
+			ent->setMaterialName(getAttributeValueAsStdString(materialElem, "name"));
+		}
+		else
+        {
+            LOG_WARNING(Logger::RULES, "No material given for plane "+entName);
+        }
+
+		node->scale(scale.x,1,scale.y);
+
+		return true;
+	}
+
+	void PlaneNodeProcessor::createCollision(Ogre::Entity *entity, xercesc_2_7::DOMElement *physicsProxyElem)
+	{
+		bool collisionEnabled = false;
+		if (physicsProxyElem == NULL || !hasAttribute(physicsProxyElem, "type"))
+			collisionEnabled = true;
+		else if(getAttributeValueAsBool(physicsProxyElem, "collision"))
+			collisionEnabled = true;
+		if(collisionEnabled)
+		{
+			std::vector<OgreNewt::CollisionPtr> collisions;
+			OgreNewt::CollisionPtr collision = OgreNewt::CollisionPtr();
+			OgreNewt::World* world = PhysicsManager::getSingleton()._getNewtonWorld();
+
+			const AxisAlignedBox &aab = entity->getMesh()->getBounds();
+			Ogre::Node* parentNode = entity->getParentNode();
+			Ogre::Vector3 size = (aab.getMaximum() - aab.getMinimum()) * parentNode->getScale();
+
+			const Quaternion orientation(0,0,0,0);// = parentNode->getOrientation();
+			const Ogre::Vector3 pos = aab.getMinimum() * parentNode->getScale() + (size/2.0);
+
+			collision = OgreNewt::CollisionPtr(new OgreNewt::CollisionPrimitives::Box(world, size, orientation, pos));
+
+			if (!collision.isNull())
+			{
+				collisions.push_back(collision);
+			}
+
+			// Add to physics of map
+			if (collisions.size() > 0)
+			{
+				PhysicsManager::getSingleton().addLevelGeometry(entity, collisions);
+				LOG_DEBUG(Logger::RULES, " Plane '"+entity->getName()+"' in levelGeometry geladen");
+			}
+		}
+	}
+}
\ No newline at end of file



